(window.unifiedSearch_bundle_jsonpfunction=window.unifiedSearch_bundle_jsonpfunction||[]).push([[6],{117:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(118);case"v8light":return a(120)}},118:function(e,t,a){var s=a(22),r=a(119);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);s(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},119:function(e,t,a){(t=a(23)(!1)).push([e.i,'.kbnSavedQueryManagement__listWrapper{max-height:416px;overflow-y:hidden}.kbnSavedQueryManagement__text{padding:12px 12px 6px}.kbnSavedQueryManagement__list{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:inherit;overflow-x:hidden;overflow-y:auto;padding:6px 4px!important;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.kbnSavedQueryManagement__list::-webkit-scrollbar{height:16px;width:16px}.kbnSavedQueryManagement__list::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.kbnSavedQueryManagement__list::-webkit-scrollbar-corner,.kbnSavedQueryManagement__list::-webkit-scrollbar-track{background-color:#0000}.kbnSavedQueryManagement__list:focus{outline:none}.kbnSavedQueryManagement__list[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},120:function(e,t,a){var s=a(22),r=a(121);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);s(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},121:function(e,t,a){(t=a(23)(!1)).push([e.i,'.kbnSavedQueryManagement__listWrapper{max-height:416px;overflow-y:hidden}.kbnSavedQueryManagement__text{padding:12px 12px 6px}.kbnSavedQueryManagement__list{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:inherit;overflow-x:hidden;overflow-y:auto;padding:6px 4px!important;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.kbnSavedQueryManagement__list::-webkit-scrollbar{height:16px;width:16px}.kbnSavedQueryManagement__list::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.kbnSavedQueryManagement__list::-webkit-scrollbar-corner,.kbnSavedQueryManagement__list::-webkit-scrollbar-track{background-color:#0000}.kbnSavedQueryManagement__list:focus{outline:none}.kbnSavedQueryManagement__list[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},122:function(e,t,a){"use strict";var s=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function r(e,t){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!((r=e[a])===(i=t[a])||s(r)&&s(i)))return!1;var r,i;return!0}e.exports=function(e,t){void 0===t&&(t=r);var a=null;function s(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];if(a&&a.lastThis===this&&t(s,a.lastArgs))return a.lastResult;var i=e.apply(this,s);return a={lastResult:i,lastArgs:s,lastThis:this},i}return s.clear=function(){a=null},s}},133:function(e,t,a){"use strict";a.r(t);var s=a(6),r=a.n(s),i=a(5),n=a(4),o=a(38),l=a.n(o),u=a(1),d=a.n(u),c=a(2),p=a(122),h=a.n(p),b=a(14),g=a(37),y=a(9),v=a(3),m=a(0);function f({savedQuery:e,savedQueryService:t,onSave:a,onClose:s,showFilterOption:r=!0,showTimeFilterOption:n=!0}){var o,l,p;const[h,b]=Object(u.useState)(null!==(o=null==e?void 0:e.attributes.title)&&void 0!==o?o:""),[g,y]=Object(u.useState)([]),[f,S]=Object(u.useState)(Boolean(null===(l=null==e?void 0:e.attributes.filters)||void 0===l||l)),[j,F]=Object(u.useState)(Boolean(null!==(p=null==e?void 0:e.attributes.timefilter)&&void 0!==p&&p)),[Q,x]=Object(u.useState)([]),O=v.i18n.translate("unifiedSearch.search.searchBar.savedQueryForm.titleConflictText",{defaultMessage:"Name conflicts with an existing saved query"}),w=v.i18n.translate("unifiedSearch.search.searchBar.savedQueryForm.titleExistsText",{defaultMessage:"Name is required."});Object(u.useEffect)((()=>{(async()=>{const e=await t.getAllSavedQueries(),a=Object(i.sortBy)(e,"attributes.title");y(a)})()}),[t]);const B=Object(u.useCallback)((()=>{const t=[];return g.find((t=>!e&&t.attributes.title===h))&&t.push(O),h||t.push(w),Object(i.isEqual)(t,Q)?!Q.length:(x(t),!1)}),[g,Q,h,e,O,w]),q=Object(u.useCallback)((()=>{B()&&(a({id:null==e?void 0:e.id,title:h,description:"",shouldIncludeFilters:f,shouldIncludeTimefilter:j}),s())}),[B,a,s,null==e?void 0:e.id,h,f,j]),C=Object(u.useCallback)((e=>{x([]),b(e.target.value)}),[]),M=Object(u.useCallback)((()=>{const e=h.trim();h.length>e.length&&b(e)}),[h]),T=Q.length>0,R=Object(m.jsx)(c.EuiForm,{isInvalid:T,error:Q,"data-test-subj":"saveQueryForm"},Object(m.jsx)(c.EuiFormRow,{label:v.i18n.translate("unifiedSearch.search.searchBar.savedQueryNameLabelText",{defaultMessage:"Name"}),helpText:v.i18n.translate("unifiedSearch.search.searchBar.savedQueryNameHelpText",{defaultMessage:"Name cannot contain a leading or trailing whitespace and must be unique."}),isInvalid:T,display:"rowCompressed"},Object(m.jsx)(c.EuiFieldText,{disabled:!!e,value:h,name:"title",onChange:C,"data-test-subj":"saveQueryFormTitle",isInvalid:T,onBlur:M,compressed:!0})),r&&Object(m.jsx)(c.EuiFormRow,{display:"rowCompressed"},Object(m.jsx)(c.EuiSwitch,{name:"shouldIncludeFilters",label:v.i18n.translate("unifiedSearch.search.searchBar.savedQueryIncludeFiltersLabelText",{defaultMessage:"Include filters"}),checked:f,onChange:()=>{S(!f)},"data-test-subj":"saveQueryFormIncludeFiltersOption"})),n&&Object(m.jsx)(c.EuiFormRow,{display:"rowCompressed"},Object(m.jsx)(c.EuiSwitch,{name:"shouldIncludeTimefilter",label:v.i18n.translate("unifiedSearch.search.searchBar.savedQueryIncludeTimeFilterLabelText",{defaultMessage:"Include time filter"}),checked:j,onChange:()=>{F(!j)},"data-test-subj":"saveQueryFormIncludeTimeFilterOption"})),Object(m.jsx)(c.EuiFormRow,null,Object(m.jsx)(c.EuiButton,{fullWidth:!0,size:"s",onClick:q,fill:!0,"data-test-subj":"savedQueryFormSaveButton",disabled:T},v.i18n.translate("unifiedSearch.search.searchBar.savedQueryFormSaveButtonText",{defaultMessage:"Save saved query"}))));return Object(m.jsx)(d.a.Fragment,null,R)}a(117);const S=[{start:"now/d",end:"now/d",label:"Today"},{start:"now/w",end:"now/w",label:"This week"},{start:"now/M",end:"now/M",label:"This month"},{start:"now/y",end:"now/y",label:"This year"},{start:"now-1d/d",end:"now-1d/d",label:"Yesterday"},{start:"now/w",end:"now",label:"Week to date"},{start:"now/M",end:"now",label:"Month to date"},{start:"now/y",end:"now",label:"Year to date"}],j=(e,t)=>{let a=e.title;const s=c.usePrettyDuration;var r,i;return e.description&&(a+=`; ${e.description}`),e.timefilter&&(a+=`; ${s({timeFrom:null===(r=e.timefilter)||void 0===r?void 0:r.from,timeTo:null===(i=e.timefilter)||void 0===i?void 0:i.to,quickRanges:S,dateFormat:t})}`),a};var F={name:"11qlldo",styles:"opacity:0.2;filter:grayscale(100%);&:hover,&:focus:focus-visible{opacity:1;filter:grayscale(0%);}"};function Q({showSaveQuery:e,loadedSavedQuery:t,onLoad:a,onClearSavedQuery:s,savedQueryService:r,onClose:n,hasFiltersOrQuery:o}){const l=Object(y.useKibana)(),[p,h]=Object(u.useState)([]),[b,g]=Object(u.useState)(t),[f,S]=Object(u.useState)(null),[Q,x]=Object(u.useState)(!1),O=Object(u.useRef)((()=>{})),{uiSettings:w,http:B,application:q}=l.services,C=w.get("dateFormat");Object(u.useEffect)((()=>{(async()=>{O.current();let e=!1;O.current=()=>{e=!0};const t=await r.getAllSavedQueries();if(e)return;const a=Object(i.sortBy)(t,"attributes.title");h(a)})()}),[r]);const M=Object(u.useCallback)((()=>{b&&(a(b),n())}),[a,b,n]),T=Object(u.useCallback)((e=>{g(e)}),[]),R=Object(u.useCallback)((e=>{x(!0),S(e)}),[]),k=Object(u.useCallback)((e=>{(async e=>{O.current(),h(p.filter((t=>t.id!==e))),t&&t.id===e&&s(),await r.deleteSavedQuery(e)})(e)}),[t,s,p,r]),P=v.i18n.translate("unifiedSearch.search.searchBar.savedQueryDescriptionText",{defaultMessage:"Save query text and filters that you want to use again."}),_=v.i18n.translate("unifiedSearch.search.searchBar.savedQueryNoSavedQueriesText",{defaultMessage:"No saved queries."})+" "+P,E=q.capabilities.savedObjectsManagement.edit;return Object(m.jsx)(d.a.Fragment,null,p.length>0?Object(m.jsx)(d.a.Fragment,null,Object(m.jsx)("div",{className:"kbnSavedQueryManagement__listWrapper","data-test-subj":"saved-query-management-list"},Object(m.jsx)(c.EuiSelectable,{"aria-label":"Basic example",options:(()=>{const a=p.filter((e=>!t||e.id!==t.id));return(t&&a.length!==p.length?[t,...a]:[...a]).map((t=>({key:t.id,label:t.attributes.title,title:j(t.attributes,C),"data-test-subj":`load-saved-query-${t.attributes.title}-button`,value:t.id,checked:b&&t.id===b.id?"on":void 0,data:{attributes:t.attributes},append:!!e&&Object(m.jsx)(c.EuiButtonIcon,{css:F,iconType:"trash","aria-label":`Delete ${t.attributes.title}`,"data-test-subj":`delete-saved-query-${t.attributes.title}-button`,title:`Delete ${t.attributes.title}`,onClick:()=>R(t),color:"danger"})})))})(),searchable:!0,singleSelection:"always",onChange:e=>{const t=e.find((({checked:e})=>e));t&&T(p.find((e=>e.id===t.value)))},searchProps:{compressed:!0,placeholder:v.i18n.translate("unifiedSearch.query.queryBar.indexPattern.findFilterSet",{defaultMessage:"Find a saved query"})},listProps:{isVirtualized:!0},renderOption:e=>Object(m.jsx)(d.a.Fragment,null,e.attributes?(e=>{let t=e.title;return e.description&&(t=Object(m.jsx)(d.a.Fragment,null,t," ",Object(m.jsx)(c.EuiIcon,{type:"iInCircle",color:"subdued",size:"s"}))),e.timefilter&&(t=Object(m.jsx)(d.a.Fragment,null,t," ",Object(m.jsx)(c.EuiIcon,{type:"clock",color:"subdued",size:"s"}))),t})(e.attributes):e.label)},((e,t)=>Object(m.jsx)(d.a.Fragment,null,Object(m.jsx)(c.EuiPanel,{style:{paddingBottom:0},color:"transparent",paddingSize:"s"},t),e))))):Object(m.jsx)(d.a.Fragment,null,Object(m.jsx)(c.EuiText,{size:"s",color:"subdued",className:"kbnSavedQueryManagement__text","data-test-subj":"saved-query-management-empty"},Object(m.jsx)("p",null,_))),Object(m.jsx)(c.EuiPopoverFooter,{paddingSize:"s"},Object(m.jsx)(c.EuiFlexGroup,{gutterSize:"s",justifyContent:E?"spaceBetween":"flexEnd"},E&&Object(m.jsx)(c.EuiFlexItem,{grow:!1},Object(m.jsx)(c.EuiButtonEmpty,{href:B.basePath.prepend('/app/management/kibana/objects?initialQuery=type:("query")'),size:"s"},"Manage")),Object(m.jsx)(c.EuiFlexItem,{grow:!1},Object(m.jsx)(c.EuiButton,{size:"s",fill:!0,onClick:M,disabled:!b,"aria-label":v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverApplyFilterSetLabel",{defaultMessage:"Apply saved query"}),"data-test-subj":"saved-query-management-apply-changes-button"},o?v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverReplaceFilterSetLabel",{defaultMessage:"Replace with selected saved query"}):v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverApplyFilterSetLabel",{defaultMessage:"Apply saved query"}))))),Q&&f&&Object(m.jsx)(c.EuiConfirmModal,{title:v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverConfirmDeletionTitle",{defaultMessage:'Delete "{savedQueryName}"?',values:{savedQueryName:f.attributes.title}}),confirmButtonText:v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverConfirmDeletionConfirmButtonText",{defaultMessage:"Delete"}),cancelButtonText:v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverConfirmDeletionCancelButtonText",{defaultMessage:"Cancel"}),onConfirm:()=>{k(f.id),x(!1)},buttonColor:"danger",onCancel:()=>{x(!1)}}))}var x=a(8),O=a.n(x),w=a(17),B=a(63),q=a(65);const C={"filter-sets-pinAllFilters":"pinFilter","filter-sets-unpinAllFilters":"pinFilter","filter-sets-enableAllFilters":"disableFilter","filter-sets-disableAllFilters":"disableFilter","filter-sets-invertAllFilters":"negateFilter","filter-sets-removeAllFilters":"deleteFilter"};var M=a(67);function T({language:e,nonKqlMode:t,dateRangeFrom:a,dateRangeTo:s,onQueryChange:r,onQueryBarSubmit:n,savedQueryService:o,saveAsNewQueryFormComponent:l,saveFormComponent:p,manageFilterSetComponent:h,hiddenPanelOptions:f,openQueryBarMenu:S,toggleFilterBarMenuPopover:j,onFiltersUpdated:F,filters:Q,query:x,savedQuery:T,onClearSavedQuery:R,showQueryInput:k,showFilterBar:P,showSaveQuery:_,indexPatterns:E,timeRangeForSuggestionsOverride:I,buttonProps:L,isDisabled:A}){const[D,N]=Object(u.useState)("menu");Object(u.useEffect)((()=>{S&&N("menu")}),[S]);const U=Object(c.useGeneratedHtmlId)({prefix:"normalContextMenuPopover"}),K=()=>{j(!1)},z=v.i18n.translate("unifiedSearch.filter.options.filterSetButtonLabel",{defaultMessage:"Saved query menu"}),Y=Object(m.jsx)(c.EuiToolTip,{delay:"long",content:z},Object(m.jsx)(c.EuiButtonIcon,O()({size:"m",display:"empty",onClick:()=>{j(!S)},isDisabled:A},L,{iconType:"filter","aria-label":z,"data-test-subj":"showQueryBarMenu"}))),$=function({filters:e,savedQuery:t,language:a,dateRangeFrom:s,dateRangeTo:r,query:n,showSaveQuery:o,showFilterBar:l,showQueryInput:p,savedQueryService:h,saveAsNewQueryFormComponent:f,manageFilterSetComponent:S,hiddenPanelOptions:j,nonKqlMode:F,closePopover:Q,onQueryBarSubmit:x,onFiltersUpdated:O,onClearSavedQuery:M,onQueryChange:T,setRenderedComponent:R}){const k=Object(y.useKibana)(),{appName:P,usageCollection:_,uiSettings:E,http:I,storage:L}=k.services,A=null==_?void 0:_.reportUiCounter.bind(_,P),D=Object(u.useRef)((()=>{})),[N,U]=Object(u.useState)([]),[K,z]=Object(u.useState)(!1),[Y,$]=Object(u.useState)(!1);Object(u.useEffect)((()=>{p&&l&&(async()=>{D.current();let e=!1;D.current=()=>{e=!0};const{queries:t}=await h.findSavedQueries("");e||U(t.reverse().slice(0,5))})()}),[h,t,p,l]),Object(u.useEffect)((()=>{if(t){var a,s,r,o;let l=(null==e?void 0:e.length)!==(null===(a=t.attributes)||void 0===a||null===(s=a.filters)||void 0===s?void 0:s.length);(null==e?void 0:e.length)===(null===(r=t.attributes)||void 0===r||null===(o=r.filters)||void 0===o?void 0:o.length)&&(l=Boolean(null==e?void 0:e.some(((e,a)=>{var s,r,n;return!Object(i.isEqual)(e.query,null===(s=t.attributes)||void 0===s||null===(r=s.filters)||void 0===r||null===(n=r[a])||void 0===n?void 0:n.query)})))),l||!Object(i.isEqual)(n,null==t?void 0:t.attributes.query)?$(!0):$(!1)}}),[e,n,t,null==t?void 0:t.attributes.filters,null==t?void 0:t.attributes.query]),Object(u.useEffect)((()=>{const t=Boolean(e&&e.length>0),a=Boolean(n&&n.query);z(t||a)}),[e,M,n,t]);const G=()=>{const e=E.get(w.UI_SETTINGS.TIMEPICKER_TIME_DEFAULTS);return{from:s||e.from,to:r||e.to}},W=Object(u.useCallback)((()=>{R("saveAsNewForm")}),[R]),H=Object(u.useCallback)((()=>{R("saveForm")}),[R]),V=v.i18n.translate("unifiedSearch.query.queryBar.luceneLanguageName",{defaultMessage:"Lucene"}),J=v.i18n.translate("unifiedSearch.query.queryBar.kqlLanguageName",{defaultMessage:"KQL"}),X=[{name:v.i18n.translate("unifiedSearch.filter.options.addFilterButtonLabel",{defaultMessage:"Add filter"}),icon:"plus",onClick:()=>{R("addFilter")}},{name:v.i18n.translate("unifiedSearch.filter.options.applyAllFiltersButtonLabel",{defaultMessage:"Apply to all"}),icon:"filter",panel:2,disabled:!Boolean(e&&e.length>0),"data-test-subj":"filter-sets-applyToAllFilters"}],Z=[{name:t?v.i18n.translate("unifiedSearch.filter.options.loadOtherFilterSetLabel",{defaultMessage:"Load other saved query"}):v.i18n.translate("unifiedSearch.filter.options.loadCurrentFilterSetLabel",{defaultMessage:"Load saved query"}),panel:4,width:350,icon:"filter","data-test-subj":"saved-query-management-load-button",disabled:!N.length},{name:t?v.i18n.translate("unifiedSearch.filter.options.saveAsNewFilterSetLabel",{defaultMessage:"Save as new"}):v.i18n.translate("unifiedSearch.filter.options.saveFilterSetLabel",{defaultMessage:"Save saved query"}),icon:"save",disabled:!Boolean(o)||!K||t&&!Y,panel:1,"data-test-subj":"saved-query-management-save-button"},{isSeparator:!0}],ee=[];l&&ee.push(...X),(l||p)&&ee.push({name:v.i18n.translate("unifiedSearch.filter.options.clearllFiltersButtonLabel",{defaultMessage:"Clear all"}),disabled:!K&&!Boolean(t),icon:"crossInACircleFilled","data-test-subj":"filter-sets-removeAllFilters",onClick:()=>{Q(),x({query:{query:"",language:a},dateRange:G()}),null==A||A(b.METRIC_TYPE.CLICK,"filter:remove_all"),null==O||O([]),null==M||M()}},{isSeparator:!0}),p&&l&&ee.push(...Z),p&&ee.push({name:`Language: ${"kuery"===a?J:V}`,panel:3,"data-test-subj":"switchQueryLanguageButton"});let te=[{id:0,title:Object(m.jsx)(d.a.Fragment,null,Object(m.jsx)(c.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(m.jsx)(c.EuiFlexItem,{grow:!1},Object(m.jsx)(c.EuiText,{color:t?"primary":"default",size:"s","data-test-subj":"savedQueryTitle"},Object(m.jsx)("strong",null,t?t.attributes.title:v.i18n.translate("unifiedSearch.search.searchBar.savedQuery",{defaultMessage:"Saved query"})))),t&&Y&&Boolean(o)&&K&&Object(m.jsx)(c.EuiFlexItem,{grow:!1},Object(m.jsx)(c.EuiFlexGroup,{direction:"row",gutterSize:"s",alignItems:"center",justifyContent:"center",responsive:!1,wrap:!1},Object(m.jsx)(c.EuiFlexItem,{grow:!1},Object(m.jsx)(c.EuiButton,{size:"s",fill:!0,onClick:H,"aria-label":v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverSaveChangesButtonAriaLabel",{defaultMessage:"Save changes to {title}",values:{title:null==t?void 0:t.attributes.title}}),"data-test-subj":"saved-query-management-save-changes-button"},v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverSaveChangesButtonText",{defaultMessage:"Save changes"}))),Object(m.jsx)(c.EuiFlexItem,{grow:!1},Object(m.jsx)(c.EuiButton,{size:"s",onClick:W,"aria-label":v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverSaveAsNewButtonAriaLabel",{defaultMessage:"Save as new saved query"}),"data-test-subj":"saved-query-management-save-as-new-button"},v.i18n.translate("unifiedSearch.search.searchBar.savedQueryPopoverSaveAsNewButtonText",{defaultMessage:"Save as new"}))))))),items:ee},{id:1,title:v.i18n.translate("unifiedSearch.filter.options.saveCurrentFilterSetLabel",{defaultMessage:"Save current saved query"}),disabled:!Boolean(o),content:Object(m.jsx)("div",{style:{padding:16}},f)},{id:2,initialFocusedItemIndex:1,title:v.i18n.translate("unifiedSearch.filter.options.applyAllFiltersButtonLabel",{defaultMessage:"Apply to all"}),items:[{name:v.i18n.translate("unifiedSearch.filter.options.enableAllFiltersButtonLabel",{defaultMessage:"Enable all"}),icon:"eye","data-test-subj":"filter-sets-enableAllFilters",onClick:()=>{Q(),(()=>{null==A||A(b.METRIC_TYPE.CLICK,"filter:enable_all");const t=null==e?void 0:e.map(g.enableFilter);t&&(null==O||O(t))})()}},{name:v.i18n.translate("unifiedSearch.filter.options.disableAllFiltersButtonLabel",{defaultMessage:"Disable all"}),"data-test-subj":"filter-sets-disableAllFilters",icon:"eyeClosed",onClick:()=>{Q(),(()=>{null==A||A(b.METRIC_TYPE.CLICK,"filter:disable_all");const t=null==e?void 0:e.map(g.disableFilter);t&&(null==O||O(t))})()}},{name:v.i18n.translate("unifiedSearch.filter.options.invertNegatedFiltersButtonLabel",{defaultMessage:"Invert inclusion"}),"data-test-subj":"filter-sets-invertAllFilters",icon:"invert",onClick:()=>{Q(),(()=>{null==A||A(b.METRIC_TYPE.CLICK,"filter:invert_all");const t=null==e?void 0:e.map(g.toggleFilterNegated);t&&(null==O||O(t))})()}},{name:v.i18n.translate("unifiedSearch.filter.options.pinAllFiltersButtonLabel",{defaultMessage:"Pin all"}),"data-test-subj":"filter-sets-pinAllFilters",icon:"pin",onClick:()=>{Q(),(()=>{null==A||A(b.METRIC_TYPE.CLICK,"filter:pin_all");const t=null==e?void 0:e.map(g.pinFilter);t&&(null==O||O(t))})()}},{name:v.i18n.translate("unifiedSearch.filter.options.unpinAllFiltersButtonLabel",{defaultMessage:"Unpin all"}),"data-test-subj":"filter-sets-unpinAllFilters",icon:"pin",onClick:()=>{Q(),(()=>{null==A||A(b.METRIC_TYPE.CLICK,"filter:unpin_all");const t=null==e?void 0:e.map(g.unpinFilter);t&&(null==O||O(t))})()}}]},{id:3,title:v.i18n.translate("unifiedSearch.filter.options.filterLanguageLabel",{defaultMessage:"Filter language"}),content:Object(m.jsx)(q.a,{language:a,onSelectLanguage:e=>{I.post("/api/kibana/kql_opt_in_stats",{body:JSON.stringify({opt_in:"kuery"===e})});const t=w.KIBANA_USER_QUERY_LANGUAGE_KEY;L.set(t,e);const s={query:"",language:e};T({query:{query:s.query,language:a},dateRange:G()}),x({query:{query:Object(B.a)(s.query),language:s.language},dateRange:G()})},nonKqlMode:F,isOnTopBarMenu:!0,deps:{docLinks:k.services.docLinks}})},{id:4,title:v.i18n.translate("unifiedSearch.filter.options.loadCurrentFilterSetLabel",{defaultMessage:"Load saved query"}),width:400,content:Object(m.jsx)("div",null,S)}];return j&&j.length>0&&(te=te.map((e=>{var t;return{...e,items:null===(t=e.items)||void 0===t?void 0:t.filter((e=>{if(!e["data-test-subj"])return!0;const t=C[e["data-test-subj"]];return!t||!j.includes(t)}))}}))),te}({filters:Q,savedQuery:T,language:e,dateRangeFrom:a,dateRangeTo:s,query:x,showSaveQuery:_,showFilterBar:P,showQueryInput:k,savedQueryService:o,saveAsNewQueryFormComponent:l,manageFilterSetComponent:h,hiddenPanelOptions:f,nonKqlMode:t,closePopover:K,onQueryBarSubmit:n,onFiltersUpdated:F,onClearSavedQuery:R,onQueryChange:r,setRenderedComponent:N});return Object(m.jsx)(d.a.Fragment,null,Object(m.jsx)(c.EuiPopover,{id:U,button:Y,isOpen:S,closePopover:K,panelPaddingSize:"none",anchorPosition:"downLeft",repositionOnScroll:!0,"data-test-subj":"queryBarMenuPopover"},(()=>{switch(D){case"menu":default:return Object(m.jsx)(c.EuiContextMenu,{initialPanelId:0,panels:$,"data-test-subj":"queryBarMenuPanel"});case"saveForm":return Object(m.jsx)(c.EuiContextMenuPanel,{items:[Object(m.jsx)("div",{style:{padding:16}},p)]});case"saveAsNewForm":return Object(m.jsx)(c.EuiContextMenuPanel,{items:[Object(m.jsx)("div",{style:{padding:16}},l)]});case"addFilter":return Object(m.jsx)(c.EuiContextMenuPanel,{items:[Object(m.jsx)(M.a,{indexPatterns:E,filters:Q,timeRangeForSuggestionsOverride:I,onFiltersUpdated:F,closePopover:K})]})}})()))}var R=a(126),k=a(16),P={name:"eivff4",styles:"display:none"},_={name:"1hcx8jb",styles:"padding:0"};class search_bar_SearchBarUI extends u.Component{constructor(...e){super(...e),r()(this,"services",this.props.kibana.services),r()(this,"savedQueryService",this.services.data.query.savedQueries),r()(this,"state",{isFiltersVisible:!0,openQueryBarMenu:!1,showSavedQueryPopover:!1,currentProps:this.props,query:this.props.query?{...this.props.query}:void 0,dateRangeFrom:Object(i.get)(this.props,"dateRangeFrom","now-15m"),dateRangeTo:Object(i.get)(this.props,"dateRangeTo","now")}),r()(this,"isDirty",(()=>!this.props.showDatePicker&&this.state.query&&this.props.query?!Object(i.isEqual)(this.state.query,this.props.query):this.state.query&&this.props.query&&!Object(i.isEqual)(this.state.query,this.props.query)||this.state.dateRangeFrom!==this.props.dateRangeFrom||this.state.dateRangeTo!==this.props.dateRangeTo)),r()(this,"onSave",(async(e,t=!1)=>{if(!this.state.query)return;const a={title:e.title,description:e.description,query:this.state.query};e.shouldIncludeFilters&&(a.filters=this.props.filters),e.shouldIncludeTimefilter&&void 0!==this.state.dateRangeTo&&void 0!==this.state.dateRangeFrom&&void 0!==this.props.refreshInterval&&void 0!==this.props.isRefreshPaused&&(a.timefilter={from:this.state.dateRangeFrom,to:this.state.dateRangeTo,refreshInterval:{value:this.props.refreshInterval,pause:this.props.isRefreshPaused}});try{let s;s=this.props.savedQuery&&!t?await this.savedQueryService.updateQuery(e.id,a):await this.savedQueryService.createQuery(a),this.services.notifications.toasts.addSuccess(`Your query "${s.attributes.title}" was saved`),this.props.onSaved&&this.props.onSaved(s)}catch(e){throw this.services.notifications.toasts.addDanger(`An error occured while saving your query: ${e.message}`),e}})),r()(this,"onQueryBarChange",(e=>{this.setState({query:e.query,dateRangeFrom:e.dateRange.from,dateRangeTo:e.dateRange.to}),this.props.onQueryChange&&this.props.onQueryChange(e)})),r()(this,"onTextLangQueryChange",(e=>{this.setState({query:e}),this.props.onQueryChange&&this.props.onQueryChange({query:e,dateRange:{from:this.state.dateRangeFrom,to:this.state.dateRangeTo}})})),r()(this,"toggleFilterBarMenuPopover",(e=>{this.setState({openQueryBarMenu:e})})),r()(this,"onTextLangQuerySubmit",(e=>{var t,a;null===(t=(a=this.props).onFiltersUpdated)||void 0===t||t.call(a,[]),this.setState({query:e},(()=>{this.props.onQuerySubmit&&this.props.onQuerySubmit({query:e,dateRange:{from:this.state.dateRangeFrom,to:this.state.dateRangeTo}})}))})),r()(this,"onQueryBarSubmit",(e=>{this.setState({query:e.query,dateRangeFrom:e.dateRange&&e.dateRange.from||this.state.dateRangeFrom,dateRangeTo:e.dateRange&&e.dateRange.to||this.state.dateRangeTo},(()=>{var e;this.props.onQuerySubmit&&this.props.onQuerySubmit({query:this.state.query,dateRange:{from:this.state.dateRangeFrom,to:this.state.dateRangeTo}}),null===(e=this.services.usageCollection)||void 0===e||e.reportUiCounter(this.services.appName,b.METRIC_TYPE.CLICK,"query_submitted")}))})),r()(this,"onLoadSavedQuery",(e=>{const t=Object(i.get)(e,"attributes.timefilter.from",this.state.dateRangeFrom),a=Object(i.get)(e,"attributes.timefilter.to",this.state.dateRangeTo);this.setState({query:e.attributes.query,dateRangeFrom:t,dateRangeTo:a}),this.props.onSavedQueryUpdated&&this.props.onSavedQueryUpdated(e)})),r()(this,"renderSavedQueryManagement",h()(((e,t,a)=>e&&Object(m.jsx)(Q,{showSaveQuery:t,loadedSavedQuery:a,onLoad:this.onLoadSavedQuery,savedQueryService:this.savedQueryService,onClearSavedQuery:e,onClose:()=>this.setState({openQueryBarMenu:!1}),hasFiltersOrQuery:this.hasFiltersOrQuery()}))))}static getDerivedStateFromProps(e,t){if(Object(i.isEqual)(t.currentProps,e))return null;let a=null;e.query&&Object(g.isOfQueryType)(e.query)&&e.query.query!==Object(i.get)(t,"currentProps.query.query")?a={query:e.query.query,language:e.query.language}:e.query&&t.query&&Object(g.isOfQueryType)(e.query)&&Object(g.isOfQueryType)(t.query)&&e.query.language!==t.query.language?a={query:"",language:e.query.language}:e.query&&!Object(g.isOfQueryType)(e.query)&&(a=e.query);let s=null;e.dateRangeFrom===Object(i.get)(t,"currentProps.dateRangeFrom")&&e.dateRangeTo===Object(i.get)(t,"currentProps.dateRangeTo")||(s={dateRangeFrom:e.dateRangeFrom,dateRangeTo:e.dateRangeTo});const r={currentProps:e};return a&&(r.query=a),s&&(r.dateRangeFrom=s.dateRangeFrom,r.dateRangeTo=s.dateRangeTo),r}componentWillUnmount(){this.renderSavedQueryManagement.clear()}shouldRenderFilterBar(){return this.props.showFilterBar&&this.props.filters&&this.props.indexPatterns&&Object(i.compact)(this.props.indexPatterns).length>0}shouldRenderTimeFilterInSavedQueryForm(){const{dateRangeFrom:e,dateRangeTo:t,showDatePicker:a,indexPatterns:s}=this.props;return!(!a&&void 0!==e&&void 0!==t)&&(null==s||!s.length||s.some((e=>Boolean(e.timeFieldName))))}shouldShowDatePickerAsBadge(){return this.shouldRenderFilterBar()&&!this.props.showQueryInput}render(){var e,t,a;const{theme:s}=this.props,r=!0===this.props.isScreenshotMode,i=(({euiTheme:e})=>({uniSearchBar:Object(m.css)("padding:",e.size.s,";position:relative;",""),detached:Object(m.css)("border-bottom:",e.border.thin,";",""),inPage:_,hidden:P}))(s),n=[i.uniSearchBar,this.props.displayStyle&&i[this.props.displayStyle],r&&i.hidden],o=l()("uniSearchBar",{"uniSearchBar--hidden":r,[`uniSearchBar--${this.props.displayStyle}`]:this.props.displayStyle}),u=!!this.props.showDatePicker&&void 0,d=Object(m.jsx)(f,{savedQueryService:this.savedQueryService,onSave:e=>this.onSave(e,!0),onClose:()=>this.setState({openQueryBarMenu:!1}),showFilterOption:this.props.showFilterBar,showTimeFilterOption:this.shouldRenderTimeFilterInSavedQueryForm()}),c=Object(m.jsx)(f,{savedQuery:this.props.savedQuery?this.props.savedQuery:void 0,savedQueryService:this.savedQueryService,onSave:this.onSave,onClose:()=>this.setState({openQueryBarMenu:!1}),showFilterOption:this.props.showFilterBar,showTimeFilterOption:this.shouldRenderTimeFilterInSavedQueryForm()}),p=this.props.showQueryMenu?Object(m.jsx)(T,{nonKqlMode:this.props.nonKqlMode,language:this.state.query&&Object(g.isOfQueryType)(null===(e=this.state)||void 0===e?void 0:e.query)?null===(t=this.state)||void 0===t||null===(a=t.query)||void 0===a?void 0:a.language:"kuery",onQueryChange:this.onQueryBarChange,onQueryBarSubmit:this.onQueryBarSubmit,dateRangeFrom:this.state.dateRangeFrom,dateRangeTo:this.state.dateRangeTo,savedQueryService:this.savedQueryService,saveAsNewQueryFormComponent:d,saveFormComponent:c,toggleFilterBarMenuPopover:this.toggleFilterBarMenuPopover,openQueryBarMenu:this.state.openQueryBarMenu,onFiltersUpdated:this.props.onFiltersUpdated,filters:this.props.filters,hiddenPanelOptions:this.props.hiddenFilterPanelOptions,query:this.state.query,savedQuery:this.props.savedQuery,onClearSavedQuery:this.props.onClearSavedQuery,showQueryInput:this.props.showQueryInput,showFilterBar:this.props.showFilterBar,showSaveQuery:this.props.showSaveQuery,isDisabled:this.props.isDisabled,buttonProps:{size:this.shouldShowDatePickerAsBadge()?"s":"m"},indexPatterns:this.props.indexPatterns,timeRangeForSuggestionsOverride:u,manageFilterSetComponent:this.props.showFilterBar&&this.state.query?this.renderSavedQueryManagement(this.props.onClearSavedQuery,this.props.showSaveQuery,this.props.savedQuery):void 0}):void 0;let h;return this.shouldRenderFilterBar()&&(h=this.shouldShowDatePickerAsBadge()?Object(m.jsx)(k.c,{filters:this.props.filters,onFiltersUpdated:this.props.onFiltersUpdated,indexPatterns:this.props.indexPatterns,timeRangeForSuggestionsOverride:u,hiddenPanelOptions:this.props.hiddenFilterPanelOptions,readOnly:this.props.isDisabled}):Object(m.jsx)(k.a,{afterQueryBar:!0,filters:this.props.filters,onFiltersUpdated:this.props.onFiltersUpdated,indexPatterns:this.props.indexPatterns,timeRangeForSuggestionsOverride:u,hiddenPanelOptions:this.props.hiddenFilterPanelOptions,isDisabled:this.props.isDisabled,"data-test-subj":"unifiedFilterBar"})),Object(m.jsx)("div",{className:o,css:n,"data-test-subj":"globalQueryBar"},Object(m.jsx)(R.default,{timeHistory:this.props.timeHistory,query:this.state.query,screenTitle:this.props.screenTitle,onSubmit:this.onQueryBarSubmit,indexPatterns:this.props.indexPatterns,isLoading:this.props.isLoading,fillSubmitButton:this.props.fillSubmitButton||!1,prepend:this.props.showFilterBar||this.props.showQueryInput?p:void 0,showDatePicker:this.props.showDatePicker,dateRangeFrom:this.state.dateRangeFrom,dateRangeTo:this.state.dateRangeTo,isRefreshPaused:this.props.isRefreshPaused,refreshInterval:this.props.refreshInterval,showAutoRefreshOnly:this.props.showAutoRefreshOnly,showQueryInput:this.props.showQueryInput,showAddFilter:this.props.showFilterBar,isDisabled:this.props.isDisabled,onRefresh:this.props.onRefresh,onRefreshChange:this.props.onRefreshChange,onChange:this.onQueryBarChange,isDirty:this.isDirty(),customSubmitButton:this.props.customSubmitButton?this.props.customSubmitButton:void 0,showSubmitButton:this.props.showSubmitButton,submitButtonStyle:this.props.submitButtonStyle,dataTestSubj:this.props.dataTestSubj,indicateNoData:this.props.indicateNoData,placeholder:this.props.placeholder,isClearable:this.props.isClearable,iconType:this.props.iconType,nonKqlMode:this.props.nonKqlMode,timeRangeForSuggestionsOverride:u,filters:this.props.filters,onFiltersUpdated:this.props.onFiltersUpdated,dataViewPickerComponentProps:this.props.dataViewPickerComponentProps,textBasedLanguageModeErrors:this.props.textBasedLanguageModeErrors,onTextBasedSavedAndExit:this.props.onTextBasedSavedAndExit,showDatePickerAsBadge:this.shouldShowDatePickerAsBadge(),filterBar:h,suggestionsSize:this.props.suggestionsSize,isScreenshotMode:this.props.isScreenshotMode,onTextLangQuerySubmit:this.onTextLangQuerySubmit,onTextLangQueryChange:this.onTextLangQueryChange}))}hasFiltersOrQuery(){const e=Boolean(this.props.filters&&this.props.filters.length>0),t=Boolean(this.state.query&&Object(g.isOfQueryType)(this.state.query)&&this.state.query.query);return e||t}}r()(search_bar_SearchBarUI,"defaultProps",{showQueryMenu:!0,showFilterBar:!0,showDatePicker:!0,showSubmitButton:!0,showAutoRefreshOnly:!1}),t.default=Object(n.injectI18n)(Object(c.withEuiTheme)(Object(y.withKibana)(search_bar_SearchBarUI)))}}]);