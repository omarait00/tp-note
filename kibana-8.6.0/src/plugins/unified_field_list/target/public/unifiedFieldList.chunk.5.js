(window.unifiedFieldList_bundle_jsonpfunction=window.unifiedFieldList_bundle_jsonpfunction||[]).push([[5],{44:function(e,t,i){"use strict";i.r(t),i.d(t,"loadFieldExisting",(function(){return o}));var a=i(6),n=i(12);function r(e,t){return e.fields.map((e=>({name:e.name,isScript:!!e.scripted,lang:e.lang,script:e.script,isMeta:t.includes(e.name)||"_id"===e.name,runtimeField:e.isMapped?void 0:e.runtimeField})))}function s(e,t,i,a){return{bool:{filter:e&&t&&i?[{range:{[e]:{format:"strict_date_optional_time",gte:t,lte:i}}},a]:[a]}}}function l(e,t){const i=new Set(e.map((e=>e.name)));return t.filter((e=>e.isScript||e.runtimeField||i.has(e.name))).map((e=>e.name))}function d(e,t){const i=new Set(t);for(const t of e){if(0===i.size)break;i.forEach((e=>{let a=t.fields;e.isMeta&&(a=t);const n=a[e.name];(Array.isArray(n)&&n.length||!Array.isArray(n)&&n)&&i.delete(e)}))}return t.filter((e=>!i.has(e))).map((e=>e.name))}const o=async({data:e,dslQuery:t,fromDate:i,toDate:o,timeFieldName:c,dataViewsService:m,uiSettingsClient:u,dataView:f})=>{const p=u.get(a.UI_SETTINGS.SEARCH_INCLUDE_FROZEN),F=u.get("lens:useFieldExistenceSampling"),g=u.get(a.UI_SETTINGS.META_FIELDS);return await async function({search:e,dataViewsService:t,dataView:i,dslQuery:a={match_all:{}},fromDate:n,toDate:o,timeFieldName:c,includeFrozen:m,metaFields:u,useSampling:f}){if(f)return async function({search:e,metaFields:t,dataView:i,dslQuery:a,fromDate:n,toDate:l,timeFieldName:o,includeFrozen:c}){const m=r(i,t),u=i.getRuntimeMappings(),f=await async function({search:e,index:t,dslQuery:i,timeFieldName:a,fromDate:n,toDate:r,fields:l,runtimeMappings:d,includeFrozen:o}){const c=s(a,n,r,i),m=l.filter((e=>e.isScript)),u=await e({index:t,...o?{ignore_throttled:!1}:{},body:{size:500,query:c,sort:a&&n&&r?[{[a]:"desc"}]:[],fields:["*"],_source:!1,runtime_mappings:d,script_fields:m.reduce(((e,t)=>(e[t.name]={script:{lang:t.lang,source:t.script}},e)),{}),track_total_hits:!1,timeout:"4500ms"}});return null==u?void 0:u.hits.hits}({search:e,fromDate:n,toDate:l,dslQuery:a,index:i.title,timeFieldName:o||i.timeFieldName,fields:m,runtimeMappings:u,includeFrozen:c});return{indexPatternTitle:i.title,existingFieldNames:d(f,m)}}({search:e,metaFields:u,dataView:i,dataViewsService:t,dslQuery:a,fromDate:n,toDate:o,timeFieldName:c,includeFrozen:m});const p=r(i,u),F=await t.getFieldsForIndexPattern(i,{pattern:"",filter:s(c,n,o,a)});return{indexPatternTitle:i.title,existingFieldNames:l(F,p)}}({dslQuery:t,fromDate:i,toDate:o,timeFieldName:c,dataViewsService:m,includeFrozen:p,useSampling:F,metaFields:g,dataView:f,search:async t=>(await Object(n.lastValueFrom)(e.search.search({params:t}))).rawResponse})}}}]);