!function(e){function t(t){for(var r,i,o=t[0],s=t[1],a=0,c=[];a<o.length;a++)i=o[a],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&c.push(n[i][0]),n[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(l&&l(t);c.length;)c.shift()()}var r={},n={0:0};function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(e){var t=[],r=n[e];if(0!==r)if(r)t.push(r[2]);else{var o=new Promise((function(t,i){r=n[e]=[t,i]}));t.push(r[2]=o);var s,a=document.createElement("script");a.charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.src=function(e){return i.p+"visTypeMetric.chunk."+e+".js"}(e);var l=new Error;s=function(t){a.onerror=a.onload=null,clearTimeout(c);var r=n[e];if(0!==r){if(r){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+i+": "+o+")",l.name="ChunkLoadError",l.type=i,l.request=o,r[1](l)}n[e]=void 0}};var c=setTimeout((function(){s({type:"timeout",target:a})}),12e4);a.onerror=a.onload=s,document.head.appendChild(a)}return Promise.all(t)},i.m=e,i.c=r,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var o=window.visTypeMetric_bundle_jsonpfunction=window.visTypeMetric_bundle_jsonpfunction||[],s=o.push.bind(o);o.push=t,o=o.slice();for(var a=0;a<o.length;a++)t(o[a]);var l=s;i(i.s=18)}([function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/charts/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/expressions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/visDefaultEditor/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/visualizations/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},function(e,t,r){e.exports=r(20)(2)},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/visualizations/common/utils");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/expressions/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){var n=r(21),i=r(22),o=i;o.v1=n,o.v4=i,e.exports=o},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){r(19),__kbnBundles__.define("plugin/visTypeMetric/public",r,23)},function(e,t,r){r.p=window.__kbnPublicPath__.visTypeMetric},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,r){var n,i,o=r(10),s=r(11),a=0,l=0;e.exports=function(e,t,r){var c=t&&r||0,u=t||[],d=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==p){var m=o();null==d&&(d=n=[1|m[0],m[1],m[2],m[3],m[4],m[5]]),null==p&&(p=i=16383&(m[6]<<8|m[7]))}var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),b=void 0!==e.nsecs?e.nsecs:l+1,f=g-a+(b-l)/1e4;if(f<0&&void 0===e.clockseq&&(p=p+1&16383),(f<0||g>a)&&void 0===e.nsecs&&(b=0),b>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=g,l=b,i=p;var v=(1e4*(268435455&(g+=122192928e5))+b)%4294967296;u[c++]=v>>>24&255,u[c++]=v>>>16&255,u[c++]=v>>>8&255,u[c++]=255&v;var j=g/4294967296*1e4&268435455;u[c++]=j>>>8&255,u[c++]=255&j,u[c++]=j>>>24&15|16,u[c++]=j>>>16&255,u[c++]=p>>>8|128,u[c++]=255&p;for(var _=0;_<6;++_)u[c+_]=d[_];return t||s(u)}},function(e,t,r){var n=r(10),i=r(11);e.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},function(e,t,r){"use strict";r.r(t),r.d(t,"plugin",(function(){return k}));var n=r(12),i=r.n(n),o=r(2),s=r(3),a=r(9),l=r(5),c=r.n(l),u=r(1),d=r(8),p=r(6),m=r(0);const g=[{id:s.ColorMode.None,label:o.i18n.translate("visTypeMetric.colorModes.noneOptionLabel",{defaultMessage:"None"})},{id:s.ColorMode.Labels,label:o.i18n.translate("visTypeMetric.colorModes.labelsOptionLabel",{defaultMessage:"Labels"})},{id:s.ColorMode.Background,label:o.i18n.translate("visTypeMetric.colorModes.backgroundOptionLabel",{defaultMessage:"Background"})}];function b({stateParams:e,setValue:t,setValidity:r,setTouched:n,uiState:i}){const a=Object(l.useCallback)(((r,n)=>t("metric",{...e.metric,[r]:n})),[t,e.metric]),b=Object(l.useCallback)(((t,r)=>a("labels",{...e.metric.labels,[t]:r})),[a,e.metric.labels]),f=Object(l.useCallback)(((t,r)=>a("style",{...e.metric.style,[t]:r})),[a,e.metric.style]),v=Object(l.useCallback)((e=>a("metricColorMode",e)),[a]),j=o.i18n.translate("visTypeMetric.params.color.useForLabel",{defaultMessage:"Use color for"});return Object(m.jsx)(c.a.Fragment,null,Object(m.jsx)(u.EuiPanel,{paddingSize:"s"},Object(m.jsx)(u.EuiTitle,{size:"xs"},Object(m.jsx)("h3",null,Object(m.jsx)(d.FormattedMessage,{id:"visTypeMetric.params.settingsTitle",defaultMessage:"Settings"}))),Object(m.jsx)(u.EuiSpacer,{size:"s"}),Object(m.jsx)(p.PercentageModeOption,{"data-test-subj":"metricPercentageMode",percentageMode:e.metric.percentageMode,formatPattern:e.metric.percentageFormatPattern,setValue:a}),Object(m.jsx)(p.SwitchOption,{label:o.i18n.translate("visTypeMetric.params.showTitleLabel",{defaultMessage:"Show title"}),paramName:"show",value:e.metric.labels.show,setValue:b})),Object(m.jsx)(u.EuiSpacer,{size:"s"}),Object(m.jsx)(u.EuiPanel,{paddingSize:"s"},Object(m.jsx)(u.EuiTitle,{size:"xs"},Object(m.jsx)("h3",null,Object(m.jsx)(d.FormattedMessage,{id:"visTypeMetric.params.rangesTitle",defaultMessage:"Ranges"}))),Object(m.jsx)(u.EuiSpacer,{size:"s"}),Object(m.jsx)(p.ColorRanges,{"data-test-subj":"metricColorRange",colorsRange:e.metric.colorsRange,setValue:a,setTouched:n,setValidity:r}),Object(m.jsx)(u.EuiFormRow,{fullWidth:!0,display:"rowCompressed",label:j},Object(m.jsx)(u.EuiButtonGroup,{buttonSize:"compressed",idSelected:e.metric.metricColorMode,isDisabled:1===e.metric.colorsRange.length,isFullWidth:!0,legend:j,options:g,onChange:v})),Object(m.jsx)(p.ColorSchemaOptions,{colorSchema:e.metric.colorSchema,colorSchemas:s.colorSchemas,disabled:1===e.metric.colorsRange.length||e.metric.metricColorMode===s.ColorMode.None,invertColors:e.metric.invertColors,setValue:a,showHelpText:!1,uiState:i})),Object(m.jsx)(u.EuiSpacer,{size:"s"}),Object(m.jsx)(u.EuiPanel,{paddingSize:"s"},Object(m.jsx)(u.EuiTitle,{size:"xs"},Object(m.jsx)("h3",null,Object(m.jsx)(d.FormattedMessage,{id:"visTypeMetric.params.style.styleTitle",defaultMessage:"Style"}))),Object(m.jsx)(u.EuiSpacer,{size:"s"}),Object(m.jsx)(p.RangeOption,{label:o.i18n.translate("visTypeMetric.params.style.fontSizeLabel",{defaultMessage:"Metric font size in points"}),min:12,max:120,paramName:"fontSize",value:e.metric.style.fontSize,setValue:f,showInput:!0,showLabels:!0,showValue:!1})))}var f=r(13),v=r(14),j=r(7),_=r(4),y=r(15);const O=e=>{const t=Object(_.buildExpressionFunction)("visdimension",{accessor:e.accessor});return e.format&&(t.addArgument("format",e.format.id),t.addArgument("formatParams",JSON.stringify(e.format.params))),Object(_.buildExpression)([t])},h=(e,t)=>{var r;const n=Object(j.getVisSchemas)(e,t),{percentageMode:i,percentageFormatPattern:o,colorSchema:a,metricColorMode:l,colorsRange:c,labels:u,invertColors:d,style:p}=e.params.metric;!0===Object(f.get)(e.params,"metric.percentageMode")&&n.metric.forEach((e=>{e.format={id:"percent",params:{pattern:o}}}));const m=c&&c.length>1,g=Object(_.buildExpressionFunction)("legacyMetricVis",{percentageMode:i,colorMode:m?l:s.ColorMode.None,showLabels:null!==(r=null==u?void 0:u.show)&&void 0!==r&&r});if(g.addArgument("font",Object(_.buildExpression)(`font family="${y.inter.value}"\n        weight="bold"\n        align="center"\n        sizeUnit="pt"\n        ${p?`size=${p.fontSize}`:""}`)),g.addArgument("labelFont",Object(_.buildExpression)('font size="14" align="center"')),c&&c.length){const e=Object(v.getStopsWithColorsFromRanges)(c,a,d),t=Object(_.buildExpressionFunction)("palette",{...e,range:"number",continuity:"none"});g.addArgument("palette",Object(_.buildExpression)([t]))}return n.group&&g.addArgument("bucket",O(n.group[0])),n.metric.forEach((e=>{g.addArgument("metric",O(e))})),Object(_.buildExpression)([g]).toAst()};var M=r(16),x=r.n(M),w=r(17);const[S,P]=Object(w.createGetterSetter)("dataViews"),T=e=>{if((e=>!!e.meta)(e)){const{meta:t,...r}=e;return r}return e},C=async(e,t)=>{var n;if(!t)return null;const i=S(),o=await Object(j.getDataViewByIndexPatternId)(null===(n=e.data.indexPattern)||void 0===n?void 0:n.id,i);if(!o)return null;const[{getColumnsFromVis:s,getPalette:a,getPercentageModeConfig:l},{getConfiguration:c}]=await Promise.all([j.convertToLensModule,r.e(1).then(r.bind(null,24))]),u=l(e.params.metric),d=s(e,t,o,{splits:["group"]},{dropEmptyRowsInDateHistogram:!0,...u});if(null===d)return null;const[p]=d;if(p.metrics.length>1||p.buckets.all.length>1)return null;if(p.metrics[0]){const e=p.columns.find((({columnId:e})=>e===p.metrics[0]));if("number"!==(null==e?void 0:e.dataType))return null}const m=x()(),g=o.id;return{type:"lnsMetric",layers:[{indexPatternId:g,layerId:m,columns:p.columns.map(T),columnOrder:[]}],configuration:c(m,e.params,a(e.params.metric,u),p),indexPatternIds:[g]}};class plugin_MetricVisPlugin{constructor(e){i()(this,"initializerContext",void 0),this.initializerContext=e}setup(e,{visualizations:t}){t.createBaseVisualization({name:"metric",title:o.i18n.translate("visTypeMetric.metricTitle",{defaultMessage:"Metric"}),icon:"visMetric",description:o.i18n.translate("visTypeMetric.metricDescription",{defaultMessage:"Show a calculation as a single number."}),fetchDatatable:!0,toExpressionAst:h,visConfig:{defaults:{addTooltip:!0,addLegend:!1,type:"metric",metric:{percentageMode:!1,useRanges:!1,colorSchema:s.ColorSchemas.GreenToRed,metricColorMode:s.ColorMode.None,colorsRange:[{from:0,to:1e4}],labels:{show:!0},invertColors:!1,style:{bgFill:"#000",bgColor:!1,labelColor:!1,subText:"",fontSize:60}}}},editorConfig:{enableDataViewChange:!0,optionsTemplate:b,schemas:[{group:a.AggGroupNames.Metrics,name:"metric",title:o.i18n.translate("visTypeMetric.schemas.metricTitle",{defaultMessage:"Metric"}),min:1,aggFilter:["!std_dev","!geo_centroid","!derivative","!serial_diff","!moving_avg","!cumulative_sum","!geo_bounds","!filtered_metric","!single_percentile","!single_percentile_rank"],aggSettings:{top_hits:{allowStrings:!0}},defaults:[{type:"count",schema:"metric"}]},{group:a.AggGroupNames.Buckets,name:"group",title:o.i18n.translate("visTypeMetric.schemas.splitGroupTitle",{defaultMessage:"Split group"}),min:0,max:1,aggFilter:["!geohash_grid","!geotile_grid","!filter","!sampler","!diversified_sampler","!rare_terms","!multi_terms","!significant_text"]}]},requiresSearch:!0,navigateToLens:async(e,t)=>e?C(e,t):null,getExpressionVariables:async(e,t)=>({canNavigateToLens:Boolean(null!=e&&e.params?await C(e,t):null)})})}start(e,{dataViews:t}){P(t)}}function k(e){return new plugin_MetricVisPlugin(e)}}]);