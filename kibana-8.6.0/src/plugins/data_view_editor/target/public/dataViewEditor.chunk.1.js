(window.dataViewEditor_bundle_jsonpfunction=window.dataViewEditor_bundle_jsonpfunction||[]).push([[1],{29:function(e,t,a){"use strict";a.r(t),a.d(t,"DataViewEditorServiceContext",(function(){return ge}));var i=a(3),n=a.n(i),s=a(23),l=a(4),r=a(6),d=a(38),o=a.n(d),c=a(25),u=a(30),p=a.n(u),h=a(24);async function m(e,t=300){let a;const i=t+5,n=(new Date).getTime();a=Array.isArray(e)?await Promise.all(e):await e;const s=(new Date).getTime();if(s-n<i){const e=i-(s-n);await new Promise((t=>setTimeout(t,e)))}return a}function g(e){return!!e.startsWith(".")||!!e.includes(":")&&e.split(":").reduce(((e,t)=>e||g(t)),!1)}function x(e,t){return(t?e:e.filter((e=>!g(e.name)))).slice(0,100)}function b(e,t,a,i=!1){const n=x(e,i),s=x(t,i),l=x(a,i);let r;return r=l.length?l:s.length?s:n,{allIndices:n,exactMatchedIndices:l,partialMatchedIndices:s,visibleIndices:r}}const f=e=>e.replace(/,\s+/g,",");var j=a(8),E=a.n(j),P=a(26),O=a.n(P),I=(a(32),a(0));let v=0;const y=Object(i.createContext)({addPanel:()=>()=>{}}),w=Object(i.createContext)({registerFooter:()=>{},registerContent:()=>{}}),M=({maxWidth:e,flyoutClassName:t,...a})=>{const n=Object(i.useMemo)((()=>{const e=document.getElementsByClassName(t);return 0===e.length?null:e.item(0)}),[t]),[s,l]=Object(i.useState)({}),d=Object(i.useCallback)((e=>{l((t=>{const{[e]:a,...i}=t;return i}))}),[]),o=Object(i.useCallback)((e=>{const t=v++;return l((a=>({...a,[t]:e}))),d.bind(null,t)}),[d]),c=Object(i.useMemo)((()=>({addPanel:o})),[o]);return Object(i.useLayoutEffect)((()=>{if(!n)return;const t=Math.min(100,Object.values(s).reduce(((e,{width:t=0})=>e+t),0)),a=e*t/100;n.style.maxWidth=`${a}px`}),[s,e,t,n]),Object(I.jsx)(y.Provider,{value:c},Object(I.jsx)(r.EuiFlexGroup,E()({className:"fieldEditor__flyoutPanels",gutterSize:"none"},a)))},_=({children:e,width:t,className:a="",backgroundColor:n,border:s,...l})=>{const[d,o]=Object(i.useState)({hasContent:!1,hasFooter:!1}),c=O()("fieldEditor__flyoutPanel",a,{"fieldEditor__flyoutPanel--pageBackground":"euiPageBackground"===n,"fieldEditor__flyoutPanel--emptyShade":"euiEmptyShade"===n,"fieldEditor__flyoutPanel--leftBorder":"left"===s,"fieldEditor__flyoutPanel--rightBorder":"right"===s,"fieldEditor__flyoutPanel--withContent":d.hasContent}),{addPanel:u}=(()=>{const e=Object(i.useContext)(y);if(void 0===e)throw new Error("<Panel /> must be used within a <Panels /> wrapper");return e})(),p=Object(i.useCallback)((()=>{o((e=>({...e,hasContent:!0})))}),[]),h=Object(i.useCallback)((()=>{o((e=>{if(!e.hasContent)throw new Error("You need to add a <FlyoutPanels.Content /> when you add a <FlyoutPanels.Footer />");return{...e,hasFooter:!0}}))}),[]);Object(i.useLayoutEffect)((()=>u({width:t})),[t,u]);const m={};return t&&(m.flexBasis=`${t}%`),Object(I.jsx)(r.EuiFlexItem,{style:m},Object(I.jsx)(w.Provider,{value:{registerContent:p,registerFooter:h}},Object(I.jsx)("div",E()({className:c},l),e)))};a(12);const F={title:{label:s.i18n.translate("indexPatternEditor.editor.form.titleLabel",{defaultMessage:"Index pattern"}),defaultValue:"",helpText:s.i18n.translate("indexPatternEditor.validations.titleHelpText",{defaultMessage:'Enter an index pattern that matches one or more data sources. Use an asterisk (*) to match multiple characters. Spaces and the characters , /, ?, ", <, >, | are not allowed.'}),validations:[{validator:l.f.emptyField(s.i18n.translate("indexPatternEditor.validations.titleIsRequiredErrorMessage",{defaultMessage:"An Index pattern is required."}))},{validator:(...e)=>{const[{value:t,path:a}]=e,i=s.i18n.translate("indexPatternEditor.validations.noSingleAstriskPattern",{defaultMessage:"A single '*' is not an allowed index pattern"});return"*"===t?{code:"ERR_FIELD_MISSING",path:a,message:i}:void 0}}]},name:{label:s.i18n.translate("indexPatternEditor.editor.form.nameLabel",{defaultMessage:"Name"}),defaultValue:"",validations:[]},timestampField:{label:s.i18n.translate("indexPatternEditor.editor.form.timeFieldLabel",{defaultMessage:"Timestamp field"}),helpText:s.i18n.translate("indexPatternEditor.editor.form.timestampFieldHelp",{defaultMessage:"Select a timestamp field for use with the global time filter."}),validations:[]},allowHidden:{label:s.i18n.translate("indexPatternEditor.editor.form.allowHiddenLabel",{defaultMessage:"Allow hidden and system indices"}),defaultValue:!1},id:{label:s.i18n.translate("indexPatternEditor.editor.form.customIdLabel",{defaultMessage:"Custom data view ID"}),helpText:s.i18n.translate("indexPatternEditor.editor.form.customIdHelp",{defaultMessage:"Kibana provides a unique identifier for each data view, or you can create your own."})},type:{label:s.i18n.translate("indexPatternEditor.editor.form.TypeLabel",{defaultMessage:"Data view type"}),defaultValue:h.INDEX_PATTERN_TYPE.DEFAULT},isAdHoc:{label:s.i18n.translate("indexPatternEditor.editor.form.IsAdHocLabel",{defaultMessage:"Creeate AdHoc DataView"}),defaultValue:!1,type:"hidden"}},T=e=>({validator:({value:t})=>{if(e.includes(t))return{message:s.i18n.translate("indexPatternEditor.dataViewExists.ValidationErrorMessage",{defaultMessage:"A data view with this name already exists."})}}}),C=({existingDataViewNames$:e})=>{const t=p()(e,[]),a=Object(i.useMemo)((()=>(({namesNotAllowed:e})=>{const t=F.name,a=[...t.validations,T(e)];return{...t,validations:a}})({namesNotAllowed:t})),[t]);return Object(I.jsx)(l.d,{path:"name",config:a,componentProps:{euiFieldProps:{"aria-label":s.i18n.translate("indexPatternEditor.form.nameAriaLabel",{defaultMessage:"Name field optional"})}}},(e=>{const{isInvalid:t,errorMessage:a}=Object(l.g)(e);return Object(I.jsx)(r.EuiFormRow,{label:e.label,fullWidth:!0,error:a,isInvalid:t},Object(I.jsx)(r.EuiFieldText,{value:e.value,onChange:t=>{e.setValue(t.target.value)},fullWidth:!0,"data-test-subj":"createIndexPatternNameInput"}))}))},S=e=>({validator:async({value:t})=>{if(e.length&&!t)return{message:s.i18n.translate("indexPatternEditor.requireTimestampOption.ValidationErrorMessage",{defaultMessage:"Select a timestamp field."})}}}),L=s.i18n.translate("indexPatternEditor.editor.form.noTimeFieldsLabel",{defaultMessage:"No matching data stream, index, or index alias has a timestamp field."}),R=s.i18n.translate("indexPatternEditor.editor.form.timeFieldHelp",{defaultMessage:"Select a timestamp field for use with the global time filter."}),N=({options$:e,isLoadingOptions$:t,isLoadingMatchedIndices$:a,matchedIndices$:d})=>{const o=p()(e,[]),c=p()(t,!1),u=p()(a,!1),h=!!p()(d,oe).exactMatchedIndices.length,m=o.map((({display:e,fieldName:t})=>({label:e,value:t}))),g=Object(i.useMemo)((()=>(e=>{const t=F.timestampField,a=[...t.validations,S(e)];return{...t,validations:a}})(o)),[o]),x=o.length?R:"",b=0!==o.length||u||c||!h?"":L;return Object(I.jsx)(l.d,{config:g,path:"timestampField"},(e=>{const{label:t,value:a,setValue:i}=e;if(void 0===a)return null;const{isInvalid:d,errorMessage:o}=Object(l.g)(e),u=!m.length,p=!!m.find((e=>e.value===a.value));if(!(a&&p||u)){const e=m.filter((e=>"@timestamp"===e.value));e.length&&i(e[0])}return Object(I.jsx)(n.a.Fragment,null,Object(I.jsx)(r.EuiFormRow,{label:t,error:u?null:o,isInvalid:!u&&d,fullWidth:!0},Object(I.jsx)(n.a.Fragment,null,Object(I.jsx)(r.EuiComboBox,{placeholder:s.i18n.translate("indexPatternEditor.editor.form.runtimeType.placeholderLabel",{defaultMessage:"Select a timestamp field"}),singleSelection:{asPlainText:!0},options:m,selectedOptions:a&&p?[a]:void 0,onChange:e=>{0!==e.length&&i(e[0])},isClearable:!1,isDisabled:u,"data-test-subj":"timestampField","aria-label":s.i18n.translate("indexPatternEditor.editor.form.timestampSelectAriaLabel",{defaultMessage:"Timestamp field"}),isLoading:c,fullWidth:!0}),Object(I.jsx)(r.EuiFormHelpText,null,b||x||Object(I.jsx)(n.a.Fragment,null," ")))))}))};var A=a(28),D=a(9);const V=Object(I.jsx)(r.EuiDescriptionList,{style:{whiteSpace:"nowrap"},"data-test-subj":"standardType"},Object(I.jsx)(r.EuiDescriptionListTitle,null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.typeSelect.standardTitle",defaultMessage:"Standard data view"})),Object(I.jsx)(r.EuiDescriptionListDescription,null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.typeSelect.standardDescription",defaultMessage:"Perform full aggregations against any data"}))),B=Object(I.jsx)(r.EuiDescriptionList,{style:{whiteSpace:"nowrap"},"data-test-subj":"rollupType"},Object(I.jsx)(r.EuiDescriptionListTitle,null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.typeSelect.rollupTitle",defaultMessage:"Rollup data view"})," ",Object(I.jsx)(r.EuiBadge,{color:A.euiLightVars.euiColorAccent},Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.typeSelect.betaLabel",defaultMessage:"Beta"}))),Object(I.jsx)(r.EuiDescriptionListDescription,null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.typeSelect.rollupDescription",defaultMessage:"Perform limited aggregations against summarized data"}))),$=({onChange:e})=>Object(I.jsx)(l.d,{path:"type"},(({label:t,value:a,setValue:i})=>void 0===a?null:Object(I.jsx)(n.a.Fragment,null,Object(I.jsx)(r.EuiFormRow,{label:t,fullWidth:!0},Object(I.jsx)(r.EuiSuperSelect,{"data-test-subj":"typeField",options:[{value:h.INDEX_PATTERN_TYPE.DEFAULT,inputDisplay:s.i18n.translate("indexPatternEditor.typeSelect.standard",{defaultMessage:"Standard"}),dropdownDisplay:V},{value:h.INDEX_PATTERN_TYPE.ROLLUP,inputDisplay:s.i18n.translate("indexPatternEditor.typeSelect.rollup",{defaultMessage:"Rollup"}),dropdownDisplay:B}],valueOfSelected:a,onChange:t=>{i(t),e(t)},"aria-label":s.i18n.translate("indexPatternEditor.editor.form.typeSelectAriaLabel",{defaultMessage:"Type field"}),fullWidth:!0}))))),k={message:s.i18n.translate("indexPatternEditor.rollupDataView.createIndex.noMatchError",{defaultMessage:"Rollup data view error: must match one rollup index"})},H={message:s.i18n.translate("indexPatternEditor.rollupDataView.createIndex.tooManyMatchesError",{defaultMessage:"Rollup data view error: can only match one rollup index"})},W={message:s.i18n.translate("indexPatternEditor.createIndex.noMatch",{defaultMessage:"Name must match one or more data streams, indices, or index aliases."})},Y=({rollupIndicesCapabilities:e,refreshMatchedIndices:t,isRollup:a})=>({validator:async({value:i})=>{const{matchedIndicesResult:n,newRollupIndexName:l}=await t(f(i)),r=Object.keys(e);if(0===n.exactMatchedIndices.length)return W;if(!a||!r||!r.length)return;const d=n.exactMatchedIndices.filter((e=>r.includes(e.name)));if(!d.length)return k;if(d.length>1)return H;const o=l&&e[l].error;return o?{message:s.i18n.translate("indexPatternEditor.rollup.uncaughtError",{defaultMessage:"Rollup data view error: {error}",values:{error:o}})}:void 0}}),U=({isRollup:e,matchedIndices$:t,rollupIndicesCapabilities:a,refreshMatchedIndices:n})=>{const[d,o]=Object(i.useState)(!1),c=p()(t,oe).exactMatchedIndices,u=Object(i.useMemo)((()=>(({isRollup:e,rollupIndicesCapabilities:t,refreshMatchedIndices:a})=>{const i=F.title,n=[...i.validations,Y({rollupIndicesCapabilities:t,refreshMatchedIndices:a,isRollup:e})];return{...i,validations:n}})({isRollup:e,matchedIndices:c,rollupIndicesCapabilities:a,refreshMatchedIndices:n})),[e,c,a,n]);return Object(I.jsx)(l.d,{path:"title",config:u,componentProps:{euiFieldProps:{"aria-label":s.i18n.translate("indexPatternEditor.form.titleAriaLabel",{defaultMessage:"Index pattern field"})}}},(e=>{const{isInvalid:t,errorMessage:a}=Object(l.g)(e);return Object(I.jsx)(r.EuiFormRow,{label:e.label,labelAppend:e.labelAppend,helpText:"function"==typeof e.helpText?e.helpText():e.helpText,error:a,isInvalid:t,fullWidth:!0},Object(I.jsx)(r.EuiFieldText,{isInvalid:t,value:e.value,onChange:t=>{let a=t.target.value;var i;1===a.length&&!d&&(i=a)&&/[a-z0-9]/i.test(i)&&1===i.length?(a+="*",o(!0),setTimeout((()=>t.target.setSelectionRange(1,1)))):["","*"].includes(a)&&d&&(a="",o(!1)),e.setValue(a)},isLoading:e.isValidating,fullWidth:!0,"data-test-subj":"createIndexPatternTitleInput"}))}))},z=({matchedIndices:{allIndices:e=[],exactMatchedIndices:t=[],partialMatchedIndices:a=[]},isIncludingSystemIndices:i,query:n,showSystemIndices:s})=>{let l,d,o;const c=e.length;return 0===n.length?(l=void 0,o="primary",d=c>=1?Object(I.jsx)("span",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.status.matchAnyLabel.matchAnyDetail",defaultMessage:"Your index pattern can match {sourceCount, plural, one {# source} other {# sources} }.",values:{sourceCount:c}})):!i&&s?Object(I.jsx)("span",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.status.noSystemIndicesWithPromptLabel",defaultMessage:"No data streams, indices, or index aliases match your index pattern."})):Object(I.jsx)("span",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.status.noSystemIndicesLabel",defaultMessage:"No data streams, indices, or index aliases match your index pattern."}))):t.length?(l="check",o="success",d=Object(I.jsx)("span",null," ",Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.status.successLabel.successDetail",defaultMessage:"Your index pattern matches {sourceCount} {sourceCount, plural, one {source} other {sources} }.",values:{sourceCount:t.length}}))):a.length?(l=void 0,o="primary",d=Object(I.jsx)("span",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.status.partialMatchLabel.partialMatchDetail",defaultMessage:"Your index pattern doesn't match any data streams, indices, or index aliases, but {strongIndices} {matchedIndicesLength, plural, one {is} other {are} } similar.",values:{matchedIndicesLength:a.length,strongIndices:Object(I.jsx)("strong",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.status.partialMatchLabel.strongIndicesLabel",defaultMessage:"{matchedIndicesLength, plural, one {source} other {# sources} }",values:{matchedIndicesLength:a.length}}))}}))):(l=void 0,o="warning",d=c?(e=>Object(I.jsx)("span",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.status.notMatchLabel.notMatchDetail",defaultMessage:"The index pattern you entered doesn't match any data streams, indices, or index aliases. You can match {strongIndices}.",values:{strongIndices:Object(I.jsx)("strong",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.status.notMatchLabel.allIndicesLabel",defaultMessage:"{indicesLength, plural, one {# source} other {# sources} }",values:{indicesLength:e}}))}})))(c):Object(I.jsx)("span",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.status.notMatchLabel.notMatchNoIndicesDetail",defaultMessage:"The index pattern you entered doesn't match any data streams, indices, or index aliases."}))),Object(I.jsx)(r.EuiCallOut,{size:"s",color:o,"data-test-subj":"createIndexPatternStatusMessage",iconType:l,title:d})};var X=a(31),G=a.n(X);const q=[5,10,20,50];class indices_list_IndicesList extends n.a.Component{constructor(e){super(e),G()(this,"pager",void 0),G()(this,"resetPageTo0",(()=>this.onChangePage(0))),G()(this,"onChangePage",(e=>{this.pager.goToPageIndex(e),this.setState({page:e})})),G()(this,"onChangePerPage",(e=>{this.pager.setItemsPerPage(e),this.setState({perPage:e}),this.resetPageTo0(),this.closePerPageControl()})),G()(this,"openPerPageControl",(()=>{this.setState({isPerPageControlOpen:!0})})),G()(this,"closePerPageControl",(()=>{this.setState({isPerPageControlOpen:!1})})),this.state={page:0,perPage:q[1],isPerPageControlOpen:!1},this.pager=new r.Pager(e.indices.length,this.state.perPage,this.state.page)}UNSAFE_componentWillReceiveProps(e){e.indices.length!==this.props.indices.length&&(this.pager.setTotalItems(e.indices.length),this.resetPageTo0())}renderPagination(){const{perPage:e,page:t,isPerPageControlOpen:a}=this.state,i=Object(I.jsx)(r.EuiButtonEmpty,{size:"s",color:"text",iconType:"arrowDown",iconSide:"right",onClick:this.openPerPageControl},Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.pagingLabel",defaultMessage:"Rows per page: {perPage}",values:{perPage:e}})),n=q.map((e=>Object(I.jsx)(r.EuiContextMenuItem,{key:e,icon:"empty",onClick:()=>this.onChangePerPage(e)},e))),s=this.pager.getTotalPages(),l=s>1?Object(I.jsx)(r.EuiFlexItem,{grow:!1},Object(I.jsx)(r.EuiPagination,{pageCount:s,activePage:t,onPageClick:this.onChangePage})):null;return Object(I.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},Object(I.jsx)(r.EuiFlexItem,{grow:!1},Object(I.jsx)(r.EuiPopover,{id:"customizablePagination",button:i,isOpen:a,closePopover:this.closePerPageControl,panelPaddingSize:"none"},Object(I.jsx)(r.EuiContextMenuPanel,{items:n}))),l)}highlightIndexName(e,t){if(!t)return e;const a=t.split(",").map((e=>e.trim()));let i=-1,n="";for(let t=0;t<a.length;t++){const s=a[t];if(n=s.endsWith("*")?s.substring(0,s.length-1):s,i=e.indexOf(n),-1!==i)break}if(-1===i)return e;const s=e.substring(0,i),l=e.substr(i+n.length);return Object(I.jsx)("span",null,s,Object(I.jsx)("strong",null,n),l)}render(){const{indices:e,query:t,...a}=this.props,i=e.slice(this.pager.firstItemIndex,this.pager.lastItemIndex+1).map(((e,a)=>Object(I.jsx)(r.EuiTableRow,{key:a},Object(I.jsx)(r.EuiTableRowCell,null,this.highlightIndexName(e.name,t)),Object(I.jsx)(r.EuiTableRowCell,null,e.tags.map((e=>Object(I.jsx)(r.EuiBadge,{key:`index_${a}_tag_${e.key}`,color:e.color},e.name)))))));return Object(I.jsx)("div",a,Object(I.jsx)(r.EuiTable,{responsive:!1,tableLayout:"auto"},Object(I.jsx)(r.EuiTableBody,null,i)),Object(I.jsx)(r.EuiSpacer,{size:"m"}),this.renderPagination())}}const K=({type:e,allowHidden:t,title:a="",matchedIndices$:i})=>{const s=p()(i,oe),l=s.visibleIndices.length||s.allIndices.length?Object(I.jsx)(n.a.Fragment,null,Object(I.jsx)(r.EuiSpacer,null),Object(I.jsx)(indices_list_IndicesList,{"data-test-subj":"createIndexPatternStep1IndicesList",query:a,indices:a.length?s.visibleIndices:s.allIndices})):Object(I.jsx)(n.a.Fragment,null);return Object(I.jsx)(n.a.Fragment,null,Object(I.jsx)(z,{matchedIndices:s,showSystemIndices:e!==h.INDEX_PATTERN_TYPE.ROLLUP,isIncludingSystemIndices:t,query:a}),l)},J=s.i18n.translate("indexPatternEditor.editor.flyoutCloseButtonLabel",{defaultMessage:"Close"}),Q=s.i18n.translate("indexPatternEditor.editor.flyoutSaveButtonLabel",{defaultMessage:"Save data view to Kibana"}),Z=s.i18n.translate("indexPatternEditor.editor.flyoutEditButtonLabel",{defaultMessage:"Save"}),ee=s.i18n.translate("indexPatternEditor.editor.flyoutEditUnpersistedButtonLabel",{defaultMessage:"Continue to use without saving"}),te=s.i18n.translate("indexPatternEditor.editor.flyoutExploreButtonLabel",{defaultMessage:"Use without saving"}),ae=({onCancel:e,onSubmit:t,submitDisabled:a,isEdit:i,allowAdHoc:n,isPersisted:l,canSave:d})=>Object(I.jsx)(r.EuiFlyoutFooter,{className:"indexPatternEditor__footer"},Object(I.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},Object(I.jsx)(r.EuiFlexItem,{grow:!1},Object(I.jsx)(r.EuiButtonEmpty,{iconType:"cross",flush:"left",onClick:e,"data-test-subj":"closeFlyoutButton"},J)),Object(I.jsx)(r.EuiFlexItem,{grow:!1},Object(I.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n&&Object(I.jsx)(r.EuiFlexItem,{grow:!1},Object(I.jsx)(r.EuiButton,{color:"primary",onClick:()=>{t(!0)},"data-test-subj":"exploreIndexPatternButton",disabled:a,title:s.i18n.translate("indexPatternEditor.editor.flyoutExploreButtonTitle",{defaultMessage:"Use this data view without creating a saved object"})},te)),(d||i&&!l)&&Object(I.jsx)(r.EuiFlexItem,{grow:!1},Object(I.jsx)(r.EuiButton,{color:"primary",onClick:()=>{t(!1)},"data-test-subj":"saveIndexPatternButton",fill:!0,disabled:a},i?l?Z:ee:Q)))))),ie=({children:e})=>{const[t,a]=Object(i.useState)(!1),l=Object(i.useCallback)((()=>{a(!t)}),[t]);return Object(I.jsx)(n.a.Fragment,null,Object(I.jsx)(r.EuiButtonEmpty,{onClick:l,flush:"left","data-test-subj":"toggleAdvancedSetting"},t?s.i18n.translate("indexPatternEditor.editor.form.advancedSettings.hideButtonLabel",{defaultMessage:"Hide advanced settings"}):s.i18n.translate("indexPatternEditor.editor.form.advancedSettings.showButtonLabel",{defaultMessage:"Show advanced settings"})),Object(I.jsx)("div",{style:{display:t?"block":"none"},"data-test-subj":"advancedSettings"},Object(I.jsx)(r.EuiSpacer,{size:"m"}),Object(I.jsx)("div",null,e)))},ne=s.i18n.translate("indexPatternEditor.form.allowHiddenAriaLabel",{defaultMessage:"Allow hidden and system indices"}),se=s.i18n.translate("indexPatternEditor.form.customIndexPatternIdLabel",{defaultMessage:"Custom data view ID"}),le=({disableAllowHidden:e,disableId:t,onAllowHiddenChange:a})=>Object(I.jsx)(ie,null,Object(I.jsx)(r.EuiFlexGroup,null,Object(I.jsx)(r.EuiFlexItem,null,Object(I.jsx)(l.d,{path:"allowHidden",component:l.c,"data-test-subj":"allowHiddenField",componentProps:{euiFieldProps:{"aria-label":ne,disabled:e}},onChange:a}))),Object(I.jsx)(r.EuiSpacer,{size:"m"}),Object(I.jsx)(r.EuiFlexGroup,null,Object(I.jsx)(r.EuiFlexItem,null,Object(I.jsx)(l.d,{path:"id",component:l.b,"data-test-subj":"savedObjectIdField",componentProps:{euiFieldProps:{"aria-label":se,disabled:t}}})))),re=s.i18n.translate("indexPatternEditor.rollupIndexPattern.warning.title",{defaultMessage:"Beta feature"}),de=()=>Object(I.jsx)(r.EuiCallOut,{title:re,color:"warning",iconType:"help"},Object(I.jsx)("p",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.rollupDataView.warning.textParagraphOne",defaultMessage:"Kibana has beta support for data views based on rollups. You might encounter\nissues using these in saved searches, visualizations, and dashboards. They\nare not supported in some advanced features, such as Timelion, and Machine Learning."})),Object(I.jsx)("p",null,Object(I.jsx)(D.FormattedMessage,{id:"indexPatternEditor.rollupDataView.warning.textParagraphTwo",defaultMessage:"You can match a rollup data view against one rollup index and zero or more\nregular indices. A rollup data view has limited metrics, fields, intervals, and\naggregations. A rollup index is limited to indices that have one job configuration,\nor multiple jobs with compatible configurations."}))),oe={allIndices:[],exactMatchedIndices:[],partialMatchedIndices:[],visibleIndices:[]},ce=s.i18n.translate("indexPatternEditor.title",{defaultMessage:"Create data view"}),ue=s.i18n.translate("indexPatternEditor.titleEditMode",{defaultMessage:"Edit data view"}),pe=({onSave:e,onCancel:t,defaultTypeIsRollup:a,requireTimestampField:d=!1,editData:o,allowAdHoc:u,showManagementLink:m})=>{var g;const{services:{application:x,dataViews:b,uiSettings:j,overlays:E}}=Object(l.k)(),{dataViewEditorService:P}=Object(i.useContext)(ge),O=b.getCanSaveSync(),{form:v}=Object(l.i)({defaultValue:{type:a?h.INDEX_PATTERN_TYPE.ROLLUP:h.INDEX_PATTERN_TYPE.DEFAULT,isAdHoc:!1,...o?{title:o.getIndexPattern(),id:o.id,name:o.name,...o.timeFieldName?{timestampField:{label:o.timeFieldName,value:o.timeFieldName}}:{}}:{}},schema:F,onSubmit:async(t,a)=>{var i;if(!a)return;const n=P.rollupIndicesCapabilities$.getValue(),l={title:f(t.title),timeFieldName:null===(i=t.timestampField)||void 0===i?void 0:i.value,id:t.id,name:t.name},r=k.current.getValue();T===h.INDEX_PATTERN_TYPE.ROLLUP&&r&&(l.type=h.INDEX_PATTERN_TYPE.ROLLUP,l.typeMeta={params:{rollup_index:r},aggs:n[r].aggs}),o&&o.getIndexPattern()!==t.title?(({dataViewName:e,overlays:t,onEdit:a})=>{t&&t.openConfirm(s.i18n.translate("indexPatternEditor.editDataView.editConfirmationModal.modalDescription",{defaultMessage:"Changing this data view can break other objects that depend on it."}),{confirmButtonText:s.i18n.translate("indexPatternEditor.editDataView.editConfirmationModal.confirmButton",{defaultMessage:"Confirm"}),title:s.i18n.translate("indexPatternEditor.editDataView.editConfirmationModal.editHeader",{defaultMessage:"Edit '{name}'",values:{name:e}}),buttonColor:"danger"}).then((async e=>{e&&a()}))})({dataViewName:t.name||t.title,overlays:E,onEdit:async()=>{await e(l,!t.isAdHoc)}}):await e(l,!t.isAdHoc)}}),[{title:y=F.title.defaultValue,allowHidden:w=F.allowHidden.defaultValue,type:T=F.type.defaultValue}]=Object(l.j)({form:v}),S=Object(i.useRef)(0),L=p()(P.isLoadingSources$,!0),R=Object(i.useRef)(new c.BehaviorSubject(!1)),A=Object(i.useRef)(new c.BehaviorSubject(!0)),D=Object(i.useRef)(new c.BehaviorSubject([])),V=p()(A.current,!0),B=p()(P.rollupIndicesCapabilities$,{}),k=Object(i.useRef)(new c.BehaviorSubject(void 0));Object(i.useEffect)((()=>{let e=!1;const t=P.matchedIndices$.subscribe((e=>{const t=o?o.title:y;P.loadTimestampFields(f(t),T,d,k.current.getValue())}));return P.loadIndices(y,w).then((t=>{e||P.matchedIndices$.next(t)})),P.loadDataViewNames(y).then((t=>{if(e)return;const a=o?t.filter((e=>e!==(null==o?void 0:o.name))):t;D.current.next(a),A.current.next(!1)})),()=>{e=!0,t.unsubscribe()}}),[o,T,y,w,d,P]);const H=Object(i.useCallback)((async e=>{let t;return(async(e="")=>{const a=++S.current;R.current.next(!0);const i=await P.getIndicesCached({pattern:"*",showAllIndices:w}),{matchedIndicesResult:n,exactMatched:s}=L?{matchedIndicesResult:oe,exactMatched:[]}:await me(e,w,i,P);if(a===S.current){if(T===h.INDEX_PATTERN_TYPE.ROLLUP){const e=await P.getIsRollupIndex(),a=s.filter((t=>e(t.name)));t=1===a.length?a[0].name:void 0,k.current.next(t)}else k.current.next(void 0);P.matchedIndices$.next(n),R.current.next(!1)}return{matchedIndicesResult:n,newRollupIndexName:t}})(e)}),[w,T,P,k,L,R]),W=Object(i.useCallback)((e=>{v.setFieldValue("title",""),v.setFieldValue("name",""),v.setFieldValue("timestampField",""),e===h.INDEX_PATTERN_TYPE.ROLLUP&&v.setFieldValue("allowHidden",!1)}),[v]);if(L||V)return Object(I.jsx)(r.EuiLoadingSpinner,{size:"xl"});const Y=j.isDeclared("rollups:enableIndexPatterns")&&j.get("rollups:enableIndexPatterns")&&(z=B,Object.keys(z)).length?Object(I.jsx)(n.a.Fragment,null,Object(I.jsx)(r.EuiSpacer,{size:"l"}),Object(I.jsx)(r.EuiFlexGroup,null,Object(I.jsx)(r.EuiFlexItem,null,Object(I.jsx)($,{onChange:W}))),T===h.INDEX_PATTERN_TYPE.ROLLUP?Object(I.jsx)(r.EuiFlexGroup,null,Object(I.jsx)(r.EuiFlexItem,null,Object(I.jsx)(de,null))):Object(I.jsx)(n.a.Fragment,null)):Object(I.jsx)(n.a.Fragment,null);var z;return Object(I.jsx)(M,{flyoutClassName:"indexPatternEditorFlyout",maxWidth:1180},Object(I.jsx)(_,{className:"fieldEditor__mainFlyoutPanel",border:"right"},Object(I.jsx)(r.EuiTitle,{"data-test-subj":"flyoutTitle"},Object(I.jsx)("h2",null,o?ue:ce)),m&&o&&o.id&&Object(I.jsx)(r.EuiLink,{href:x.getUrlForApp("management",{path:`/kibana/dataViews/dataView/${o.id}`})},s.i18n.translate("indexPatternEditor.goToManagementPage",{defaultMessage:"Manage settings and view field details"})),Object(I.jsx)(l.a,{form:v,className:"indexPatternEditor__form"},Object(I.jsx)(l.d,{path:"isAdHoc"}),Y,Object(I.jsx)(r.EuiSpacer,{size:"l"}),Object(I.jsx)(r.EuiFlexGroup,null,Object(I.jsx)(r.EuiFlexItem,null,Object(I.jsx)(C,{existingDataViewNames$:D.current}))),Object(I.jsx)(r.EuiSpacer,{size:"l"}),Object(I.jsx)(r.EuiFlexGroup,null,Object(I.jsx)(r.EuiFlexItem,null,Object(I.jsx)(U,{isRollup:(null===(g=v.getFields().type)||void 0===g?void 0:g.value)===h.INDEX_PATTERN_TYPE.ROLLUP,refreshMatchedIndices:H,matchedIndices$:P.matchedIndices$,rollupIndicesCapabilities:B}))),Object(I.jsx)(r.EuiSpacer,{size:"l"}),Object(I.jsx)(r.EuiFlexGroup,null,Object(I.jsx)(r.EuiFlexItem,null,Object(I.jsx)(N,{options$:P.timestampFieldOptions$,isLoadingOptions$:P.loadingTimestampFields$,isLoadingMatchedIndices$:R.current,matchedIndices$:P.matchedIndices$}))),Object(I.jsx)(le,{disableAllowHidden:T===h.INDEX_PATTERN_TYPE.ROLLUP,disableId:!!o,onAllowHiddenChange:()=>{v.getFields().title.validate()}})),Object(I.jsx)(ae,{onCancel:t,onSubmit:async e=>{const t=v.getFormData();t.name||(v.updateFieldValues({name:t.title}),await v.getFields().name.validate()),v.setFieldValue("isAdHoc",e||!1),v.submit()},submitDisabled:v.isSubmitted&&!v.isValid,isEdit:!!o,isPersisted:Boolean(o&&o.isPersisted()),allowAdHoc:u,canSave:O})),Object(I.jsx)(_,null,L?Object(I.jsx)(n.a.Fragment,null):Object(I.jsx)(K,{type:T,allowHidden:w,title:y,matchedIndices$:P.matchedIndices$})))},he=n.a.memo(pe),me=o()((async(e,t,a,i)=>{const n=[];if(null!=e&&e.endsWith("*")){const a=i.getIndicesCached({pattern:e,showAllIndices:t});n.push(a),n.push(Promise.resolve([]))}else{const a=i.getIndicesCached({pattern:e,showAllIndices:t}),s=i.getIndicesCached({pattern:`${e}*`,showAllIndices:t});n.push(a),n.push(s)}const[s,l]=await m(n);return{matchedIndicesResult:b(a,l,s,t),exactMatched:s,partialMatched:l}}),((e,t)=>e[0]===t[0]&&e[1]===t[1]));class data_view_editor_service_DataViewEditorService{constructor(e,t){G()(this,"rollupIndicesCapabilities$",new c.BehaviorSubject({})),G()(this,"isLoadingSources$",new c.BehaviorSubject(!1)),G()(this,"loadingTimestampFields$",new c.BehaviorSubject(!1)),G()(this,"timestampFieldOptions$",new c.Subject),G()(this,"matchedIndices$",new c.BehaviorSubject({allIndices:[],exactMatchedIndices:[],partialMatchedIndices:[],visibleIndices:[]})),G()(this,"rollupCapsResponse",void 0),G()(this,"currentLoadingTimestampFields",0),G()(this,"getRollupIndexCaps",(async()=>{let e={};try{e=await this.http.get("/api/rollup/indices")}catch(e){}return this.rollupIndicesCapabilities$.next(e),e})),G()(this,"getRollupIndices",(e=>Object.keys(e))),G()(this,"getIsRollupIndex",(async()=>{const e=await this.rollupCapsResponse;return t=>this.getRollupIndices(e).includes(t)})),G()(this,"loadMatchedIndices",(async(e,t,a)=>{const i=[];if(null!=e&&e.endsWith("*")){const a=this.getIndicesCached({pattern:e,showAllIndices:t});i.push(a),i.push(Promise.resolve([]))}else{const a=this.getIndicesCached({pattern:e,showAllIndices:t}),n=this.getIndicesCached({pattern:`${e}*`,showAllIndices:t});i.push(a),i.push(n)}const[n,s]=await m(i),l=b(a,s,n,t);return this.matchedIndices$.next(l),{matchedIndicesResult:l,exactMatched:n,partialMatched:s}})),G()(this,"loadIndices",(async(e,t)=>{const a=await this.getIndicesCached({pattern:"*",showAllIndices:t}),i=await this.loadMatchedIndices(e,t,a);this.isLoadingSources$.next(!1);const n=b(a,i.partialMatched,i.exactMatched,t);return this.matchedIndices$.next(n),n})),G()(this,"loadDataViewNames",(async e=>{const t=(await this.dataViews.getIdsWithTitle(!!e)).map((e=>e.name||e.title));return e?t.filter((t=>t!==e)):t})),G()(this,"getIndicesMemory",{}),G()(this,"getIndicesCached",(async e=>{const t=JSON.stringify(e),a=this.getIsRollupIndex().then((t=>this.dataViews.getIndices({...e,isRollupIndex:t})));return this.getIndicesMemory[t]=this.getIndicesMemory[t]||a,a.catch((()=>{delete this.getIndicesMemory[t]})),await a})),G()(this,"timeStampOptionsMemory",{}),G()(this,"getTimestampOptionsForWildcard",(async(e,t)=>function(e,t=!1){const a=e.filter((e=>"date"===e.type));if(0===a.length)return[];const i={display:s.i18n.translate("indexPatternEditor.createIndexPattern.stepTime.noTimeFieldOptionLabel",{defaultMessage:"--- I don't want to use the time filter ---"}),fieldName:""},n=a.map((e=>({display:e.name,fieldName:e.name})));return t||n.push(i),n}(await m(this.dataViews.getFieldsForWildcard(e)),t))),G()(this,"getTimestampOptionsForWildcardCached",(async(e,t)=>{const a=JSON.stringify(e)+t,i=this.getTimestampOptionsForWildcard(e,t);return this.timeStampOptionsMemory[a]=this.timeStampOptionsMemory[a]||i,i.catch((()=>{delete this.timeStampOptionsMemory[a]})),await i})),G()(this,"loadTimestampFields",(async(e,t,a,i)=>{if(0===this.matchedIndices$.getValue().exactMatchedIndices.length)return void this.timestampFieldOptions$.next([]);const n=++this.currentLoadingTimestampFields;this.loadingTimestampFields$.next(!0);const s={pattern:e};t===h.INDEX_PATTERN_TYPE.ROLLUP&&(s.type=h.INDEX_PATTERN_TYPE.ROLLUP,s.rollupIndex=i);let l=[];try{l=await this.getTimestampOptionsForWildcardCached(s,a)}finally{n===this.currentLoadingTimestampFields&&(this.timestampFieldOptions$.next(l),this.loadingTimestampFields$.next(!1))}})),this.http=e,this.dataViews=t,this.rollupCapsResponse=this.getRollupIndexCaps()}}const ge=n.a.createContext();t.default=({onSave:e,onCancel:t=(()=>{}),defaultTypeIsRollup:a,requireTimestampField:i=!1,editData:n,allowAdHocDataView:r,showManagementLink:d})=>{const{services:{dataViews:o,notifications:c,http:u}}=Object(l.k)();return Object(I.jsx)(ge.Provider,{value:{dataViewEditorService:new data_view_editor_service_DataViewEditorService(u,o)}},Object(I.jsx)(he,{onSave:async(t,a=!0)=>{try{let i;if(n){const{name:e="",timeFieldName:a,title:s=""}=t;n.setIndexPattern(s),n.name=e,n.timeFieldName=a,i=n.isPersisted()?await o.updateSavedObject(n):n}else i=a?await o.createAndSave(t):await o.create(t);if(i&&!(i instanceof Error)){if(a){const e=s.i18n.translate("indexPatternEditor.saved",{defaultMessage:"Saved '{indexPatternName}'",values:{indexPatternName:i.getName()}});c.toasts.addSuccess(e)}await e(i)}}catch(e){const t=s.i18n.translate("indexPatternEditor.dataView.unableSaveLabel",{defaultMessage:"Failed to save data view."});c.toasts.addDanger({title:t})}},onCancel:t,defaultTypeIsRollup:a,requireTimestampField:i,editData:n,showManagementLink:d,allowAdHoc:r||!1}))}},30:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(27),n=a(3),s=i.__importDefault(a(37));t.default=function(e,t){var a=n.useState(t),i=a[0],l=a[1];return s.default((function(){var t=e.subscribe(l);return function(){return t.unsubscribe()}}),[e]),i}},31:function(e,t,a){e.exports=a(14)(2)},32:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(33);case"v8light":return a(35)}},33:function(e,t,a){var i=a(10),n=a(34);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},34:function(e,t,a){(t=a(11)(!1)).push([e.i,".fieldEditor__flyoutPanels{height:100%}.fieldEditor__flyoutPanel{height:100%;overflow-y:auto;padding:24px 24px 0}.fieldEditor__flyoutPanel--pageBackground{background-color:#141519}.fieldEditor__flyoutPanel--emptyShade{background-color:#1d1e24}.fieldEditor__flyoutPanel--leftBorder{border-left:1px solid #343741}.fieldEditor__flyoutPanel--rightBorder{border-right:1px solid #343741}.fieldEditor__flyoutPanel--withContent{display:flex;flex-direction:column;overflow-y:hidden;padding:0}.fieldEditor__flyoutPanel__header{padding:0!important}.fieldEditor__flyoutPanel__content{flex:1;overflow-y:auto;padding:24px}.fieldEditor__flyoutPanel__footer{flex:0}",""]),e.exports=t},35:function(e,t,a){var i=a(10),n=a(36);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},36:function(e,t,a){(t=a(11)(!1)).push([e.i,".fieldEditor__flyoutPanels{height:100%}.fieldEditor__flyoutPanel{height:100%;overflow-y:auto;padding:24px 24px 0}.fieldEditor__flyoutPanel--pageBackground{background-color:#fafbfd}.fieldEditor__flyoutPanel--emptyShade{background-color:#fff}.fieldEditor__flyoutPanel--leftBorder{border-left:1px solid #d3dae6}.fieldEditor__flyoutPanel--rightBorder{border-right:1px solid #d3dae6}.fieldEditor__flyoutPanel--withContent{display:flex;flex-direction:column;overflow-y:hidden;padding:0}.fieldEditor__flyoutPanel__header{padding:0!important}.fieldEditor__flyoutPanel__content{flex:1;overflow-y:auto;padding:24px}.fieldEditor__flyoutPanel__footer{flex:0}",""]),e.exports=t},37:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(3),n="undefined"!=typeof window?i.useLayoutEffect:i.useEffect;t.default=n},38:function(e,t,a){"use strict";var i=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function n(e,t){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!((n=e[a])===(s=t[a])||i(n)&&i(s)))return!1;var n,s;return!0}e.exports=function(e,t){void 0===t&&(t=n);var a=null;function i(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];if(a&&a.lastThis===this&&t(i,a.lastArgs))return a.lastResult;var s=e.apply(this,i);return a={lastResult:s,lastArgs:i,lastThis:this},s}return i.clear=function(){a=null},i}}}]);