(window.controls_bundle_jsonpfunction=window.controls_bundle_jsonpfunction||[]).push([[6],{121:function(e,t,i){"use strict";i.r(t),i.d(t,"RangeSliderEmbeddable",(function(){return range_slider_embeddable_RangeSliderEmbeddable}));var a=i(0),n=i.n(a),r=i(9),l=i.n(r),s=i(28),d=i.n(s),o=i(5),c=i(49),u=i(4),h=i.n(u),p=i(24),g=i(30),b=i(27),m=i(25),S=i(1),x=i(26),_=i(18),f=i(36),v=i(3),w=i(6),j=i(46),O=i.n(j);const F=()=>S.i18n.translate("controls.rangeSlider.popover.clearRangeTitle",{defaultMessage:"Clear range"}),y=()=>S.i18n.translate("controls.rangeSlider.popover.noDataHelpText",{defaultMessage:"Selected range resulted in no data. No filter was applied."}),E=()=>S.i18n.translate("controls.rangeSlider.popover.noAvailableDataHelpText",{defaultMessage:"There is no data to display. Adjust the time range and filters."});var N=i(2);const A=()=>{var e;const[t,i]=Object(r.useState)((()=>e=>e)),a=Object(r.useRef)(null),{dataViews:{get:n}}=f.a.getServices(),{useEmbeddableDispatch:s,useEmbeddableSelector:d,actions:{setSelectedRange:o}}=Object(w.useReduxEmbeddableContext)(),c=s(),u=d((e=>e.output.dataViewId)),h=d((e=>e.componentState.field)),p=d((e=>e.explicitInput.id)),g=d((e=>e.componentState.isInvalid)),b=d((e=>e.componentState.max)),m=d((e=>e.componentState.min)),S=d((e=>e.explicitInput.title)),x=null!==(e=d((e=>e.explicitInput.value)))&&void 0!==e?e:["",""],_=""!==m&&""!==b,j=""!==x[0],A=""!==x[1],I=parseFloat(x[0]),V=parseFloat(x[1]),R=parseFloat(m),T=parseFloat(b),M=_?Math.floor(R):R,C=_?Math.ceil(T):T,[k,D]=Object(r.useState)(M),[P,z]=Object(r.useState)(C);O()((()=>{D(Math.min(M,isNaN(I)?1/0:I,isNaN(V)?1/0:V)),z(Math.max(C,isNaN(I)?-1/0:I,isNaN(V)?-1/0:V))}));let $="";_?g&&($=y()):$=E();const q=[j?String(I):_?String(M):"",A?String(V):_?String(C):""],L=[],B=[];return _&&(L.push({value:k,label:t(String(k))}),L.push({value:P,label:t(String(P))}),B.push({min:M,max:C,color:"success"})),Object(r.useEffect)((()=>{(async()=>{if(!u||!h)return;const e=await n(u);i((()=>{var t;return null!==(t=null==e?void 0:e.getFormatterForField(h).getConverterFor("text"))&&void 0!==t?t:e=>e}))})()}),[h,u,n]),Object(N.jsx)(l.a.Fragment,null,Object(N.jsx)(v.EuiPopoverTitle,{paddingSize:"s"},S),Object(N.jsx)(v.EuiFlexGroup,{className:"rangeSlider__actions",gutterSize:"none","data-test-subj":"rangeSlider-control-actions",responsive:!1},Object(N.jsx)(v.EuiFlexItem,null,Object(N.jsx)(v.EuiDualRange,{id:p,min:_?k:void 0,max:_?P:void 0,onChange:([e,t])=>{const i="number"==typeof e?String(e):x[0],a="number"==typeof t?String(t):x[1];c(o([i,a]))},value:q,ticks:_?L:void 0,levels:_?B:void 0,showTicks:_,disabled:!_,fullWidth:!0,ref:a,"data-test-subj":"rangeSlider__slider"}),Object(N.jsx)(v.EuiText,{size:"s",color:"default","data-test-subj":"rangeSlider__helpText"},$)),Object(N.jsx)(v.EuiFlexItem,{grow:!1},Object(N.jsx)(v.EuiToolTip,{content:F()},Object(N.jsx)(v.EuiButtonIcon,{iconType:"eraser",color:"danger",onClick:()=>{c(o(["",""]))},"aria-label":F(),"data-test-subj":"rangeSlider__clearRangeButton"})))))};i(85);const I="rangeSliderAnchor__fieldNumber--invalid",V=()=>{var e;const t=Object(r.useRef)(null),[i,a]=Object(r.useState)(!1),{useEmbeddableDispatch:n,useEmbeddableSelector:l,actions:{setSelectedRange:s}}=Object(w.useReduxEmbeddableContext)(),d=n(),o=l((e=>e.componentState.min)),c=l((e=>e.componentState.max)),u=l((e=>e.componentState.isInvalid)),h=l((e=>e.explicitInput.id)),p=null!==(e=l((e=>e.explicitInput.value)))&&void 0!==e?e:["",""],g=l((e=>e.output.loading)),b=""!==o&&""!==c,m=""!==p[0],S=""!==p[1],x=parseFloat(p[0]),_=parseFloat(p[1]),f=parseFloat(o),j=parseFloat(c),O=b?Math.floor(f):f,F=b?Math.ceil(j):j,y=Object(N.jsx)("button",{onClick:()=>a(!i),className:"rangeSliderAnchor__button","data-test-subj":`range-slider-control-${h}`},Object(N.jsx)(v.EuiFlexGroup,{gutterSize:"none",responsive:!1},Object(N.jsx)(v.EuiFlexItem,null,Object(N.jsx)(v.EuiFieldNumber,{controlOnly:!0,fullWidth:!0,className:`rangeSliderAnchor__fieldNumber ${m&&u?I:""}`,value:m?x:"",onChange:e=>{d(s([e.target.value,isNaN(_)?"":String(_)]))},disabled:g,placeholder:`${b?O:""}`,isInvalid:u,"data-test-subj":"rangeSlider__lowerBoundFieldNumber"})),Object(N.jsx)(v.EuiFlexItem,{grow:!1},Object(N.jsx)(v.EuiText,{className:"rangeSliderAnchor__delimiter",size:"s",color:"subdued"},"â†’")),Object(N.jsx)(v.EuiFlexItem,null,Object(N.jsx)(v.EuiFieldNumber,{controlOnly:!0,fullWidth:!0,className:`rangeSliderAnchor__fieldNumber ${S&&u?I:""}`,value:S?_:"",onChange:e=>{d(s([isNaN(x)?"":String(x),e.target.value]))},disabled:g,placeholder:`${b?F:""}`,isInvalid:u,"data-test-subj":"rangeSlider__upperBoundFieldNumber"})),g?Object(N.jsx)(v.EuiFlexItem,{grow:!1,className:"rangeSliderAnchor__spinner","data-test-subj":"range-slider-loading-spinner"},Object(N.jsx)(v.EuiLoadingSpinner,null)):null));return Object(N.jsx)(v.EuiInputPopover,{input:y,isOpen:i,display:"block",panelPaddingSize:"s",className:"rangeSlider__popoverOverride",anchorClassName:"rangeSlider__anchorOverride",panelClassName:"rangeSlider__panelOverride",closePopover:()=>a(!1),anchorPosition:"downCenter",attachToAnchor:!1,disableFocusTrap:!0,onPanelResize:()=>{null!=t&&t.current&&t.current.onResize()}},Object(N.jsx)(A,null))},R={setSelectedRange:(e,t)=>{e.explicitInput.value=t.payload},setField:(e,t)=>{e.componentState.field=t.payload},setDataViewId:(e,t)=>{e.output.dataViewId=t.payload},setLoading:(e,t)=>{e.output.loading=t.payload},setMinMax:(e,t)=>{e.componentState.min=t.payload.min,e.componentState.max=t.payload.max},publishFilters:(e,t)=>{e.output.filters=t.payload},setIsInvalid:(e,t)=>{e.componentState.isInvalid=t.payload}},T=(e,t)=>{if(!e||!t)return!1;const{filters:i,...a}=e,{filters:n,...r}=t;return!!h()(a,r)&&!!Object(m.compareFilters)(null!=n?n:[],null!=i?i:[],m.COMPARE_ALL_OPTIONS)};class range_slider_embeddable_RangeSliderEmbeddable extends b.Embeddable{constructor(e,t,i,a){super(t,i,a),n()(this,"type",_.RANGE_SLIDER_CONTROL),n()(this,"deferEmbeddableLoad",!0),n()(this,"subscriptions",new p.Subscription),n()(this,"node",void 0),n()(this,"dataService",void 0),n()(this,"dataViewsService",void 0),n()(this,"dataView",void 0),n()(this,"field",void 0),n()(this,"reduxEmbeddableTools",void 0),n()(this,"initialize",(async()=>{const e=this.getInput().value;e||this.setInitializationFinished(),this.runRangeSliderQuery().then((async()=>{e&&this.setInitializationFinished(),this.setupSubscriptions()}))})),n()(this,"setupSubscriptions",(()=>{const e=this.getInput$().pipe(Object(g.map)((e=>{var t;return{validate:!Boolean(null===(t=e.ignoreParentSettings)||void 0===t?void 0:t.ignoreValidations),lastReloadRequestTime:e.lastReloadRequestTime,dataViewId:e.dataViewId,fieldName:e.fieldName,timeRange:e.timeRange,timeslice:e.timeslice,filters:e.filters,query:e.query}})),Object(g.distinctUntilChanged)(T),Object(g.skip)(1));this.subscriptions.add(e.subscribe(this.runRangeSliderQuery)),this.subscriptions.add(this.getInput$().pipe(Object(g.debounceTime)(400),Object(g.distinctUntilChanged)(((e,t)=>Object(o.isEqual)(e.value,t.value))),Object(g.skip)(1)).subscribe(this.buildFilter))})),n()(this,"getCurrentDataViewAndField",(async()=>{const{getState:e,dispatch:t,actions:{setField:i,setDataViewId:a}}=this.reduxEmbeddableTools,{explicitInput:{dataViewId:n,fieldName:r}}=e();if(!this.dataView||this.dataView.id!==n)try{if(this.dataView=await this.dataViewsService.get(n),!this.dataView)throw new Error(S.i18n.translate("controls.rangeSlider.errors.dataViewNotFound",{defaultMessage:"Could not locate data view: {dataViewId}",values:{dataViewId:n}}));t(a(this.dataView.id))}catch(e){this.onFatalError(e)}var l,s;return this.field&&this.field.name===r||(this.field=null===(l=this.dataView)||void 0===l?void 0:l.getFieldByName(r),void 0===this.field&&this.onFatalError(new Error(S.i18n.translate("controls.rangeSlider.errors.fieldNotFound",{defaultMessage:"Could not locate field: {fieldName}",values:{fieldName:r}}))),t(i(null===(s=this.field)||void 0===s?void 0:s.toSpec()))),{dataView:this.dataView,field:this.field}})),n()(this,"runRangeSliderQuery",(async()=>{const{dispatch:e,actions:{setLoading:t,publishFilters:i,setMinMax:a}}=this.reduxEmbeddableTools;e(t(!0));const{dataView:n,field:r}=await this.getCurrentDataViewAndField();if(!n||!r)return;const l=this.getInput(),{ignoreParentSettings:s,fieldName:d,query:o,timeRange:u,timeslice:h}=l;let{filters:p=[]}=l;if(!r)throw Object(c.batch)((()=>{e(t(!1)),e(i([]))})),(e=>new Error(`field ${e} not found in index pattern`))(d);null!=s&&s.ignoreFilters&&(p=[]);const g=void 0!==h?{from:new Date(h[0]).toISOString(),to:new Date(h[1]).toISOString(),mode:"absolute"}:u;if((null==s||!s.ignoreTimerange)&&g){const e=this.dataService.timefilter.createFilter(n,g);e&&(p=p.concat(e))}const{min:b,max:m}=await this.fetchMinMax({dataView:n,field:r,filters:p,query:o});e(a({min:`${null!=b?b:""}`,max:`${null!=m?m:""}`})),await this.buildFilter()})),n()(this,"fetchMinMax",(async({dataView:e,field:t,filters:i,query:a})=>{const n=await this.dataService.searchSource.create();n.setField("size",0),n.setField("index",e),n.setField("filter",i),a&&n.setField("query",a);const r={};t&&(t.scripted?r.script={source:t.script,lang:t.lang}:r.field=t.name);const l={maxAgg:{max:r},minAgg:{min:r}};n.setField("aggs",l);const s=await Object(p.lastValueFrom)(n.fetch$());return{min:Object(o.get)(s,"rawResponse.aggregations.minAgg.value",""),max:Object(o.get)(s,"rawResponse.aggregations.maxAgg.value","")}})),n()(this,"buildFilter",(async()=>{const{dispatch:e,getState:t,actions:{setLoading:i,setIsInvalid:a,setDataViewId:n,publishFilters:r}}=this.reduxEmbeddableTools,{componentState:{min:l,max:s},explicitInput:{query:d,timeRange:u,filters:h=[],ignoreParentSettings:g,value:[b,S]=["",""]}}=t(),x=!Object(o.isEmpty)(l)&&!Object(o.isEmpty)(s),_=!Object(o.isEmpty)(b),f=!Object(o.isEmpty)(S),v=_||f,{dataView:w,field:j}=await this.getCurrentDataViewAndField();if(!w||!j)return;if(!x||!v)return void Object(c.batch)((()=>{e(i(!1)),e(a(!(null!=g&&g.ignoreValidations)&&v)),e(n(w.id)),e(r([]))}));const O={};b&&(O.gte=Math.max(parseFloat(b),parseFloat(l))),S&&(O.lte=Math.min(parseFloat(S),parseFloat(s)));const F=Object(m.buildRangeFilter)(j,O,w);if(F.meta.key=null==j?void 0:j.name,F.meta.type="range",F.meta.params=O,null==g||!g.ignoreValidations){const t=await this.dataService.searchSource.create();h.push(F);const l=this.dataService.timefilter.createFilter(w,u);l&&h.push(l),t.setField("size",0),t.setField("index",w),t.setField("filter",h),d&&t.setField("query",d);const{rawResponse:{hits:{total:s}}}=await Object(p.lastValueFrom)(t.fetch$());if(!("number"==typeof s?s:null==s?void 0:s.value))return void Object(c.batch)((()=>{e(i(!1)),e(a(!0)),e(n(w.id)),e(r([]))}))}Object(c.batch)((()=>{e(i(!1)),e(a(!1)),e(n(w.id)),e(r([F]))}))})),n()(this,"reload",(()=>{this.runRangeSliderQuery()})),n()(this,"destroy",(()=>{super.destroy(),this.subscriptions.unsubscribe(),this.reduxEmbeddableTools.cleanup()})),n()(this,"render",(e=>{this.node&&d.a.unmountComponentAtNode(this.node);const{Wrapper:t}=this.reduxEmbeddableTools;this.node=e;const i=f.a.getContextProvider();d.a.render(Object(N.jsx)(x.KibanaThemeProvider,{theme$:f.a.getServices().theme.theme$},Object(N.jsx)(i,null,Object(N.jsx)(t,null,Object(N.jsx)(V,null)))),e)})),({data:this.dataService,dataViews:this.dataViewsService}=f.a.getServices()),this.reduxEmbeddableTools=e.createTools({embeddable:this,reducers:R,initialComponentState:{min:"",max:"",isInvalid:!1}}),this.initialize()}isChained(){return!0}}},46:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(32).__importDefault(i(47));t.default=function(e){a.default((function(){e()}))}},47:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(9);t.default=function(e){a.useEffect(e,[])}},85:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(86);case"v8light":return i(88)}},86:function(e,t,i){var a=i(37),n=i(87);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},87:function(e,t,i){(t=i(38)(!1)).push([e.i,".rangeSlider__popoverOverride{height:100%;max-width:100%;width:100%}@media only screen and (min-width:768px) and (max-width:991px){.rangeSlider__panelOverride{min-width:480px}}@media only screen and (min-width:992px) and (max-width:1199px){.rangeSlider__panelOverride{min-width:480px}}@media only screen and (min-width:1200px){.rangeSlider__panelOverride{min-width:480px}}.rangeSlider__anchorOverride>div{height:100%}.rangeSliderAnchor__button{align-items:center;background-color:#16171c;border-radius:0 5px 5px 0;display:flex;height:100%;justify-content:space-between;width:100%}.rangeSliderAnchor__button .euiToolTipAnchor{width:100%}.rangeSliderAnchor__button .rangeSliderAnchor__delimiter{background-color:unset;padding:12px 0}.rangeSliderAnchor__button .rangeSliderAnchor__fieldNumber{background-color:unset;box-shadow:none;font-weight:700;text-align:center}.rangeSliderAnchor__button .rangeSliderAnchor__fieldNumber::placeholder{color:#535966;font-weight:400;text-decoration:none}.rangeSliderAnchor__button .rangeSliderAnchor__fieldNumber--invalid{color:#535966;font-weight:400;text-decoration:line-through}.rangeSliderAnchor__button .rangeSliderAnchor__spinner{padding-right:8px}",""]),e.exports=t},88:function(e,t,i){var a=i(37),n=i(89);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},89:function(e,t,i){(t=i(38)(!1)).push([e.i,".rangeSlider__popoverOverride{height:100%;max-width:100%;width:100%}@media only screen and (min-width:768px) and (max-width:991px){.rangeSlider__panelOverride{min-width:480px}}@media only screen and (min-width:992px) and (max-width:1199px){.rangeSlider__panelOverride{min-width:480px}}@media only screen and (min-width:1200px){.rangeSlider__panelOverride{min-width:480px}}.rangeSlider__anchorOverride>div{height:100%}.rangeSliderAnchor__button{align-items:center;background-color:#fbfcfd;border-radius:0 5px 5px 0;display:flex;height:100%;justify-content:space-between;width:100%}.rangeSliderAnchor__button .euiToolTipAnchor{width:100%}.rangeSliderAnchor__button .rangeSliderAnchor__delimiter{background-color:unset;padding:12px 0}.rangeSliderAnchor__button .rangeSliderAnchor__fieldNumber{background-color:unset;box-shadow:none;font-weight:700;text-align:center}.rangeSliderAnchor__button .rangeSliderAnchor__fieldNumber::placeholder{color:#98a2b3;font-weight:400;text-decoration:none}.rangeSliderAnchor__button .rangeSliderAnchor__fieldNumber--invalid{color:#98a2b3;font-weight:400;text-decoration:line-through}.rangeSliderAnchor__button .rangeSliderAnchor__spinner{padding-right:8px}",""]),e.exports=t}}]);