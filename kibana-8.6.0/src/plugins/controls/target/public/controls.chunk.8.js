(window.controls_bundle_jsonpfunction=window.controls_bundle_jsonpfunction||[]).push([[8],{39:function(e,t,i){"use strict";i.r(t),i.d(t,"providers",(function(){return g})),i.d(t,"pluginServices",(function(){return m})),i.d(t,"registry",(function(){return h}));var r=i(6),n=i(17),s=i(5),o=i(24),a=i(0),l=i.n(a),c=i(29),u=i.n(c),d=i(25);class options_list_service_OptionsListService{constructor(e){l()(this,"data",void 0),l()(this,"http",void 0),l()(this,"getRoundedTimeRange",(e=>({from:u.a.parse(e.from).startOf("minute").toISOString(),to:u.a.parse(e.to).endOf("minute").toISOString()}))),l()(this,"optionsListCacheResolver",(e=>{const{query:t,filters:i,timeRange:r,searchString:n,runPastTimeout:s,selectedOptions:o,field:{name:a},dataView:{title:l}}=e;return[...r?JSON.stringify(this.getRoundedTimeRange(r)):[],Math.floor(Date.now()/1e3/60),null==o?void 0:o.join(","),JSON.stringify(i),JSON.stringify(t),s,l,n,a].join("|")})),l()(this,"cachedOptionsListRequest",Object(s.memoize)((async(e,t)=>{const i=e.dataView.title,r=this.getRequestBody(e);return await this.http.fetch(`/api/kibana/controls/optionsList/${i}`,{body:JSON.stringify(r),signal:t,method:"POST"})}),this.optionsListCacheResolver)),l()(this,"getRequestBody",(e=>{const t=this.data.query.timefilter.timefilter,{query:i,filters:r,dataView:n,timeRange:s,field:o,...a}=e,l=s?t.createFilter(n,s):void 0,c=[...null!=r?r:[],...l?[l]:[]];return{...a,filters:[Object(d.buildEsQuery)(n,null!=i?i:[],null!=c?c:[])],fieldName:o.name,fieldSpec:o,textFieldName:o.textFieldName,runtimeFieldMap:n.toSpec().runtimeFieldMap}})),l()(this,"runOptionsListRequest",(async(e,t)=>{try{return await this.cachedOptionsListRequest(e,t)}catch(t){return this.cachedOptionsListRequest.cache.delete(this.optionsListCacheResolver(e)),{}}})),({data:this.data,http:this.http}=e)}}const g={controls:new r.PluginServiceProvider(n.b),data:new r.PluginServiceProvider((({startPlugins:e})=>{const{data:{query:t,search:i}}=e,{data:r}=e;return{fetchFieldRange:async(e,t,i)=>{const{ignoreParentSettings:n,query:a,timeRange:l}=i;let{filters:c=[]}=i;const u=e.getFieldByName(t);if(!u)throw new Error("Field Missing Error");if(l){const t=r.query.timefilter.timefilter.createFilter(e,l);t&&(c=c.concat(t))}const d=await r.search.searchSource.create();d.setField("size",0),d.setField("index",e);const g=(e=>{const t={};return e&&(e.scripted?t.script={source:e.script,lang:e.lang}:t.field=e.name),{maxAgg:{max:t},minAgg:{min:t}}})(u);d.setField("aggs",g),d.setField("filter",null!=n&&n.ignoreFilters?[]:c),d.setField("query",null!=n&&n.ignoreQuery?void 0:a);const m=await Object(o.lastValueFrom)(d.fetch$()),h=Object(s.get)(m,"rawResponse.aggregations.minAgg.value",void 0),f=Object(s.get)(m,"rawResponse.aggregations.maxAgg.value",void 0);return{min:null===h?void 0:h,max:null===f?void 0:f}},query:t,searchSource:i.searchSource,timefilter:t.timefilter.timefilter}})),dataViews:new r.PluginServiceProvider((({startPlugins:e})=>{const{dataViews:{get:t,getIdsWithTitle:i,getDefaultId:r}}=e;return{get:t,getDefaultId:r,getIdsWithTitle:i}})),http:new r.PluginServiceProvider((({coreStart:e})=>{const{http:{fetch:t}}=e;return{fetch:t}})),optionsList:new r.PluginServiceProvider(((e,t)=>new options_list_service_OptionsListService(t)),["data","http"]),overlays:new r.PluginServiceProvider((({coreStart:e})=>{const{overlays:{openFlyout:t,openConfirm:i}}=e;return{openFlyout:t,openConfirm:i}})),settings:new r.PluginServiceProvider((({coreStart:e})=>({getDateFormat:()=>e.uiSettings.get("dateFormat","MMM D, YYYY @ HH:mm:ss.SSS"),getTimezone:()=>e.uiSettings.get("dateFormat:tz","Browser"),getDefaultTimeRange:()=>e.uiSettings.get("timepicker:timeDefaults")||{from:"now-15m",to:"now"}}))),theme:new r.PluginServiceProvider((({coreStart:e})=>{const{theme:{theme$:t}}=e;return{theme$:t}})),embeddable:new r.PluginServiceProvider((({startPlugins:e})=>({getEmbeddableFactory:e.embeddable.getEmbeddableFactory}))),unifiedSearch:new r.PluginServiceProvider((({startPlugins:e})=>{const{unifiedSearch:{autocomplete:t}}=e;return{autocomplete:t}}))},m=new r.PluginServices,h=new r.PluginServiceRegistry(g)}}]);