(window.files_bundle_jsonpfunction=window.files_bundle_jsonpfunction||[]).push([[2],{27:function(e,t,i){"use strict";i.r(t),i.d(t,"UploadFile",(function(){return k}));var l=i(0),s=i.n(l),a=i(10),o=i(3),n=i(25),r=i(1),u=i(29),c=i.n(u),d=i(28),p=i(24);const b={defaultPickerLabel:p.i18n.translate("files.uploadFile.defaultFilePickerLabel",{defaultMessage:"Upload a file"}),upload:p.i18n.translate("files.uploadFile.uploadButtonLabel",{defaultMessage:"Upload"}),uploading:p.i18n.translate("files.uploadFile.uploadingButtonLabel",{defaultMessage:"Uploading"}),uploadComplete:p.i18n.translate("files.uploadFile.uploadCompleteButtonLabel",{defaultMessage:"Upload complete"}),retry:p.i18n.translate("files.uploadFile.retryButtonLabel",{defaultMessage:"Retry"}),clear:p.i18n.translate("files.uploadFile.clearButtonLabel",{defaultMessage:"Clear"}),cancel:p.i18n.translate("files.uploadFile.cancelButtonLabel",{defaultMessage:"Cancel"}),uploadDone:p.i18n.translate("files.uploadFile.uploadDoneToolTipContent",{defaultMessage:"Your file was successfully uploaded!"}),fileTooLarge:e=>p.i18n.translate("files.uploadFile.fileTooLargeErrorMessage",{defaultMessage:"File is too large. Maximum size is {expectedSize, plural, one {# byte} other {# bytes} }.",values:{expectedSize:e}})},f=s.a.createContext(null),j=()=>s.a.useContext(f),h=({onClick:e})=>{const t=j(),i=Object(d.a)(t.uploading$),l=Object(d.a)(t.error$),s=c()(t.done$),a=c()(t.files$,[]);return Object(r.jsx)(o.EuiButton,{key:"uploadButton",isLoading:i,color:s?"success":"primary",iconType:s?"checkInCircleFilled":void 0,disabled:Boolean(!a.length||l||s),onClick:e,size:"s","data-test-subj":"uploadButton"},s?b.uploadComplete:i?b.uploading:b.upload)},m=({onClick:e})=>{const t=j(),i=Object(d.a)(t.uploading$);return Object(r.jsx)(o.EuiButton,{key:"retryButton",size:"s","data-test-subj":"retryButton",disabled:i,onClick:e},b.retry)},g=({onClick:e,compressed:t})=>{const i=j(),l=!Object(d.a)(i.uploading$);return t?Object(r.jsx)(o.EuiButtonIcon,{color:"danger","data-test-subj":"cancelButtonIcon",disabled:l,iconType:"cross","aria-label":b.cancel,onClick:e}):Object(r.jsx)(o.EuiButton,{key:"cancelButton",size:"s","data-test-subj":"cancelButton",disabled:l,onClick:e,color:"danger"},b.cancel)},O=({onCancel:e,onUpload:t,immediate:i,compressed:l})=>{const s=j(),a=Object(d.a)(s.uploading$),o=c()(s.files$,[]),n=Boolean(o.some((e=>"upload_failed"===e.status)));return l||a?Object(r.jsx)(g,{compressed:l,onClick:e}):n?Object(r.jsx)(m,{onClick:t}):i?null:Object(r.jsx)(h,{onClick:t})},v=({onClick:e})=>Object(r.jsx)(o.EuiButtonEmpty,{size:"s","data-test-subj":"clearButton",onClick:e,color:"primary"},b.clear),{euiFormMaxWidth:x,euiButtonHeightSmall:w}=n.euiThemeVars,$={name:"ho1qnd",styles:"display:flex;flex-direction:row"},y=s.a.forwardRef((({compressed:e,meta:t,accept:i,immediate:l,allowClear:a=!1,multiple:n,initialFilePromptText:u,fullWidth:p},f)=>{const{euiTheme:h}=Object(o.useEuiTheme)(),m=j(),g=Object(d.a)(m.uploading$),y=Object(d.a)(m.error$),S=c()(m.done$),F=Boolean(y),B=null==y?void 0:y.message,C=Object(o.useGeneratedHtmlId)({prefix:"filesUploadFile"}),E=`${C}_error`;return Object(r.jsx)("div",{"data-test-subj":"filesUploadFile",css:[Object(r.css)("max-width:",p?"100%":x,";",""),e?$:void 0,"",""]},Object(r.jsx)(o.EuiFilePicker,{fullWidth:p,"aria-label":b.defaultPickerLabel,id:C,ref:f,onChange:e=>{m.setFiles(Array.from(null!=e?e:[])),l&&m.hasFiles()&&m.upload(t)},multiple:n,initialPromptText:u,isLoading:g,isInvalid:F,accept:i,disabled:Boolean((null==S?void 0:S.length)||g),"aria-describedby":B?E:void 0,display:e?"default":"large"}),Object(r.jsx)(o.EuiSpacer,{size:"s",css:e?Object(r.css)("width:",h.size.s,";",""):void 0}),Object(r.jsx)(o.EuiFlexGroup,{justifyContent:"flexStart",alignItems:e?"center":"flexStart",direction:e?void 0:"rowReverse",gutterSize:e?"none":"m",responsive:!1},Object(r.jsx)(o.EuiFlexItem,{grow:!1},Object(r.jsx)(O,{compressed:e,immediate:l,onCancel:m.abort,onUpload:()=>m.upload(t)})),!e&&Boolean(!S&&!g&&B)&&Object(r.jsx)(o.EuiFlexItem,null,Object(r.jsx)(o.EuiText,{"data-test-subj":"error",css:Object(r.css)("display:flex;align-items:center;min-height:",w,";",""),size:"s",color:"danger"},Object(r.jsx)("span",{id:E},B))),!e&&(null==S?void 0:S.length)&&a&&Object(r.jsx)(s.a.Fragment,null,Object(r.jsx)(o.EuiFlexItem,null)," ",Object(r.jsx)(o.EuiFlexItem,{grow:!1},Object(r.jsx)(v,{onClick:m.clear})))))}));var S=i(2),F=i.n(S),B=i(8),C=i(12),E=i(13);class simple_state_subject_SimpleStateSubject extends B.BehaviorSubject{constructor(e){super(e)}getSnapshot(){return this.getValue()}setState(e){this.next(Object(E.merge)({},this.getSnapshot(),e))}}class upload_state_UploadState{constructor(e,t,i={allowRepeatedUploads:!1},l=C.b){F()(this,"abort$",new B.Subject),F()(this,"files$$",new B.BehaviorSubject([])),F()(this,"files$",this.files$$.pipe(Object(B.switchMap)((e=>e.length?Object(B.zip)(...e):Object(B.of)([]))))),F()(this,"clear$",new B.Subject),F()(this,"error$",new B.BehaviorSubject(void 0)),F()(this,"uploading$",new B.BehaviorSubject(!1)),F()(this,"done$",new B.Subject),F()(this,"subscriptions",void 0),F()(this,"setFiles",(e=>{if(this.isUploading())throw new Error("Cannot update files while uploading");e.length||(this.done$.next(void 0),this.error$.next(void 0));const t=this.validateFiles(e);this.files$$.next(e.map((e=>{return i={file:e,status:"idle",error:t?new Error(t):void 0},new simple_state_subject_SimpleStateSubject(i);var i})))})),F()(this,"abort",(()=>{if(!this.isUploading())throw new Error("No upload in progress");this.abort$.next()})),F()(this,"clear",(()=>{this.setFiles([]),this.clear$.next()})),F()(this,"uploadFile",((e,t,i)=>{const l=new AbortController,s=l.signal,{file:a,status:o}=e.getValue();if(!["idle","upload_failed"].includes(o))return Object(B.of)(void 0);let n;e.setState({status:"uploading",error:void 0});const{name:r}={name:((u=a.name).substring(0,u.lastIndexOf("."))||u).trim().slice(0,256).replace(/[^a-z0-9\s]/gi,"_")};var u;const c=a.type||void 0,d=i;return Object(B.from)(Object(C.c)(a)?this.loadImageMetadata(a):Object(B.of)(void 0)).pipe(Object(B.mergeMap)((e=>this.client.create({kind:this.fileKind.id,name:r,mimeType:c,meta:e?{...e,...d}:d}))),Object(B.mergeMap)((e=>(n=e.file,Object(B.race)(t.pipe(Object(B.map)((()=>{throw l.abort(),new Error("Abort!")}))),this.client.upload({body:a,id:n.id,kind:this.fileKind.id,abortSignal:s,selfDestructOnAbort:!0,contentType:c}))))),Object(B.map)((()=>{var t;e.setState({status:"uploaded",id:null===(t=n)||void 0===t?void 0:t.id,fileJSON:n})})),Object(B.catchError)((t=>{const i="Abort!"===t.message;return e.setState({status:"upload_failed",error:i?void 0:t}),Object(B.of)(i?void 0:t)})))})),F()(this,"upload",(e=>{if(this.isUploading())throw new Error("Upload already in progress");const t=new B.ReplaySubject(1),i=this.abort$.subscribe(t),l=this.files$$.pipe(Object(B.take)(1),Object(B.switchMap)((i=>Object(B.forkJoin)(i.map((i=>this.uploadFile(i,t,e)))))),Object(B.map)((()=>{})),Object(B.finalize)((()=>{this.opts.allowRepeatedUploads&&this.clear(),i.unsubscribe()})),Object(B.shareReplay)());return l.subscribe(),l})),F()(this,"dispose",(()=>{for(const e of this.subscriptions)e.unsubscribe()})),this.fileKind=e,this.client=t,this.opts=i,this.loadImageMetadata=l;const s=this.files$$.pipe(Object(B.switchMap)((e=>Object(B.combineLatest)(e))));this.subscriptions=[s.pipe(Object(B.map)((e=>e.some((e=>"uploading"===e.status)))),Object(B.distinctUntilChanged)()).subscribe(this.uploading$),s.pipe(Object(B.map)((e=>{const t=e.find((e=>Boolean(e.error)));return t?t.error:void 0})),Object(B.filter)(Boolean)).subscribe(this.error$),s.pipe(Object(B.filter)((e=>Boolean(e.length)&&e.every((e=>"uploaded"===e.status)))),Object(B.map)((e=>e.map((e=>({id:e.id,kind:this.fileKind.id,fileJSON:e.fileJSON})))))).subscribe(this.done$)]}isUploading(){return this.uploading$.getValue()}validateFiles(e){if(null!=this.fileKind.maxSizeBytes&&e.some((e=>e.size>this.fileKind.maxSizeBytes)))return b.fileTooLarge(String(this.fileKind.maxSizeBytes))}hasFiles(){return this.files$$.getValue().length>0}}const k=({meta:e,onDone:t,onError:i,fullWidth:s,allowClear:o,onUploadEnd:n,onUploadStart:u,compressed:c=!1,kind:d,multiple:p=!1,initialPromptText:b,immediate:j=!1,allowRepeatedUploads:h=!1})=>{var m;const{registry:g,client:O}=Object(a.b)(),v=Object(l.useRef)(null),x=g.get(d),w=c||h,$=Object(l.useMemo)((()=>(({fileKind:e,client:t,imageMetadataFactory:i,...l})=>new upload_state_UploadState(e,t,l,i))({client:O,fileKind:x,allowRepeatedUploads:w})),[O,w,x]);return Object(l.useEffect)((()=>{const e=[$.clear$.subscribe((()=>{var e;null===(e=v.current)||void 0===e||e.removeFiles()})),$.done$.subscribe((e=>e&&t(e))),$.error$.subscribe((e=>e&&(null==i?void 0:i(e)))),$.uploading$.subscribe((e=>e?null==u?void 0:u():null==n?void 0:n()))];return()=>e.forEach((e=>e.unsubscribe()))}),[$,t,i,u,n]),Object(l.useEffect)((()=>$.dispose),[$]),Object(r.jsx)(f.Provider,{value:$},Object(r.jsx)(y,{compressed:c,ref:v,accept:null===(m=x.allowedMimeTypes)||void 0===m?void 0:m.join(","),meta:e,immediate:c||j,allowClear:o,fullWidth:s,initialFilePromptText:b,multiple:p}))};t.default=k},28:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var l=i(29),s=i.n(l);function a(e){return s()(e,e.getValue())}},29:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i(23),s=i(0),a=l.__importDefault(i(32));t.default=function(e,t){var i=s.useState(t),l=i[0],o=i[1];return a.default((function(){var t=e.subscribe(o);return function(){return t.unsubscribe()}}),[e]),l}},32:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i(0),s="undefined"!=typeof window?l.useLayoutEffect:l.useEffect;t.default=s}}]);