!function(e){function t(t){for(var n,i,s=t[0],o=t[1],a=0,u=[];a<s.length;a++)i=s[a],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(c&&c(t);u.length;)u.shift()()}var n={},r={0:0};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise((function(t,i){n=r[e]=[t,i]}));t.push(n[2]=s);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.src=function(e){return i.p+"telemetry.chunk."+e+".js"}(e);var c=new Error;o=function(t){a.onerror=a.onload=null,clearTimeout(u);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+i+": "+s+")",c.name="ChunkLoadError",c.type=i,c.request=s,n[1](c)}r[e]=void 0}};var u=setTimeout((function(){o({type:"timeout",target:a})}),12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var s=window.telemetry_bundle_jsonpfunction=window.telemetry_bundle_jsonpfunction||[],o=s.push.bind(s);s.push=t,s=s.slice();for(var a=0;a<s.length;a++)t(s[a]);var c=o;i(i.s=22)}([function(e,t,n){e.exports=n(4)(2)},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t,n){"use strict";n.r(t),n.d(t,"REPORT_INTERVAL_MS",(function(){return r})),n.d(t,"REPORT_INTERVAL_BUFFER_MS",(function(){return i})),n.d(t,"OPT_IN_POLL_INTERVAL_MS",(function(){return s})),n.d(t,"LOCALSTORAGE_KEY",(function(){return o})),n.d(t,"PATH_TO_ADVANCED_SETTINGS",(function(){return a})),n.d(t,"PAYLOAD_CONTENT_ENCODING",(function(){return c})),n.d(t,"ENDPOINT_VERSION",(function(){return u})),n.d(t,"ENDPOINT_STAGING",(function(){return l})),n.d(t,"ENDPOINT_PROD",(function(){return h})),n.d(t,"TELEMETRY_CHANNELS",(function(){return d}));const r=864e5,i=12e4,s=1e4,o="telemetry.data",a="/app/management/kibana/settings",c="aes256gcm",u="v2",l="https://telemetry-staging.elastic.co/",h="https://telemetry.elastic.co/",d={SNAPSHOT_CHANNEL:"xpack",OPT_IN_STATUS_CHANNEL:"opt_in_status"}},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t,n){e.exports=n(4)(445)},function(e,t,n){e.exports=n(4)(2745)},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,n){e.exports=n(4)(644)},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t,n){e.exports=n(4)(16)},function(e,t,n){e.exports=n(4)(17)},function(e,t,n){n.r(t);var r=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);function i({channelName:e,env:t}){const n=function(e){switch(e){case"prod":return r.ENDPOINT_PROD;case"staging":return r.ENDPOINT_STAGING;default:throw new Error(`Unknown telemetry endpoint env ${e}.`)}}(t),i=function(e){switch(e){case"snapshot":return r.TELEMETRY_CHANNELS.SNAPSHOT_CHANNEL;case"optInStatus":return r.TELEMETRY_CHANNELS.OPT_IN_STATUS_CHANNEL;default:throw new Error(`Unknown telemetry channel ${e}.`)}}(e);return`${n}${i}/${r.ENDPOINT_VERSION}/send`}},function(e,t,n){e.exports=n(4)(18)},function(e,t,n){e.exports=n(4)(2741)},function(e,t,n){e.exports=n(4)(2753)},function(e,t,n){e.exports=n(4)(10)},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t,n){n.r(t);var r=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},function(e,t,n){e.exports=n(4)(3)},function(e,t,n){n(23),__kbnBundles__.define("plugin/telemetry/public",n,24),__kbnBundles__.define("plugin/telemetry/common/constants",n,2)},function(e,t,n){n.p=window.__kbnPublicPath__.telemetry},function(e,t,n){"use strict";n.r(t),n.d(t,"plugin",(function(){return F}));var r=n(0),i=n.n(r),s=n(7),o=n.n(s),a=n(9),c=n.n(a),u=n(11),l=n.n(u),h=n(12),d=n.n(h),p=n(6),f=n.n(p),y=n(1),m=n(15),g=n.n(m),v=n(16),S=n.n(v),O=n(17),b=function(e){g()(n,e);var t=S()(n);function n(e,r){var i;return l()(this,n),(i=t.call(this,e)).code=r,i}return d()(n)}(n.n(O)()(Error));function I(e){return"".concat(e.map((function(e){return JSON.stringify(e)})).join("\n"),"\n")}var _=n(18),C=n.n(_);function N(e){return e.reduce((function(e,t){return e[t.event_type]?e[t.event_type]+=1:e[t.event_type]=1,e}),{})}var T=function(){function e(t,n){var r,s,o,a,c;l()(this,e),i()(this,"telemetryCounter$",new y.Subject),i()(this,"reportTelemetryCounters",(s=this.telemetryCounter$,o=e.shipperName,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.type,r=t.code,i=t.error,a=N(e);Object.entries(a).forEach((function(e){var t,a=C()(e,2),c=a[0],u=a[1];s.next({source:o,type:null!=n?n:i?"failed":"succeeded",code:null!==(t=null!=r?r:null==i?void 0:i.message)&&void 0!==t?t:"OK",count:u,event_type:c})}))})),i()(this,"url",void 0),i()(this,"internalQueue$",new y.Subject),i()(this,"flush$",new y.Subject),i()(this,"queueFlushed$",new y.Subject),i()(this,"isOptedIn$",new y.BehaviorSubject(void 0)),i()(this,"clusterUuid","UNKNOWN"),i()(this,"licenseId",void 0),this.options=t,this.initContext=n,this.setUpInternalQueueSubscriber(),this.url=(c=(a={sendTo:null!==(r=t.sendTo)&&void 0!==r?r:n.sendTo,channelName:t.channelName}).channelName,"".concat("production"===a.sendTo?"https://telemetry.elastic.co":"https://telemetry-staging.elastic.co","/v3/send/").concat(c))}var t,n,r;return d()(e,[{key:"extendContext",value:function(e){e.cluster_uuid&&(this.clusterUuid=e.cluster_uuid),e.license_id&&(this.licenseId=e.license_id)}},{key:"optIn",value:function(e){this.isOptedIn$.next(e)}},{key:"reportEvents",value:function(e){var t=this;e.forEach((function(e){t.internalQueue$.next(e)}))}},{key:"flush",value:(r=c()(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.flush$.isStopped){e.next=2;break}return e.abrupt("return");case 2:return t=Object(y.firstValueFrom)(this.queueFlushed$),this.flush$.next(),e.next=6,t;case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"shutdown",value:function(){this.internalQueue$.complete(),this.flush$.complete()}},{key:"setUpInternalQueueSubscriber",value:function(){var e=this;this.internalQueue$.pipe(Object(y.bufferWhen)((function(){return Object(y.merge)(e.flush$,Object(y.interval)(1e3).pipe(Object(y.skipWhile)((function(){return void 0===e.isOptedIn$.value}))))})),Object(y.concatMap)(function(){var t=c()(f.a.mark((function t(n){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!0===e.isOptedIn$.value&&n.length>0)){t.next=3;break}return t.next=3,e.sendEvents(n);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Object(y.map)((function(){return e.queueFlushed$.next()}))).subscribe()}},{key:"sendEvents",value:(n=c()(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.makeRequest(t);case 3:n=e.sent,this.reportTelemetryCounters(t,{code:n}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.reportTelemetryCounters(t,{code:e.t0.code,error:e.t0});case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return n.apply(this,arguments)})},{key:"makeRequest",value:(t=c()(f.a.mark((function t(n){var r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(this.url,o()(o()({method:"POST",body:I(n),headers:(i=this.clusterUuid,s=this.options.version,a=this.licenseId,o()({"content-type":"application/x-ndjson","x-elastic-cluster-id":i,"x-elastic-stack-version":s},a&&{"x-elastic-license-id":a}))},this.options.debug&&{query:{debug:!0}}),{},{keepalive:!0}));case 2:if(r=t.sent,!this.options.debug){t.next=11;break}return t.t0=this.initContext.logger,t.t1="[".concat(e.shipperName,"]: ").concat(r.status," - "),t.next=8,r.text();case 8:t.t2=t.sent,t.t3=t.t1.concat.call(t.t1,t.t2),t.t0.debug.call(t.t0,t.t3);case 11:if(r.ok){t.next=20;break}return t.t4=b,t.t5="".concat(r.status," - "),t.next=16,r.text();case 16:throw t.t6=t.sent,t.t7=t.t5.concat.call(t.t5,t.t6),t.t8="".concat(r.status),new t.t4(t.t7,t.t8);case 20:return t.abrupt("return","".concat(r.status));case 21:case"end":return t.stop()}var i,s,a}),t,this)}))),function(e){return t.apply(this,arguments)})}]),e}();i()(T,"shipperName","elastic_v3_browser");var w=n(19),E=n(20),j=n(2);function x(e){return!e||isNaN(e)||Date.now()-e>j.REPORT_INTERVAL_MS-j.REPORT_INTERVAL_BUFFER_MS}class telemetry_sender_TelemetrySender{static getRetryDelay(e){return 1e3*Math.min(Math.pow(2,e),64)*60}constructor(e,t){i()(this,"lastReported",void 0),i()(this,"storage",void 0),i()(this,"sendIfDue$",void 0),i()(this,"retryCount",0),i()(this,"updateLastReported",(e=>{this.lastReported=e,this.storage.set(j.LOCALSTORAGE_KEY,{lastReport:`${this.lastReported}`})})),i()(this,"isReportDue",(async()=>{if(!x(this.lastReported))return!1;const e=await this.telemetryService.fetchLastReported();return e&&this.updateLastReported(e),x(e)})),i()(this,"isActiveWindow",(()=>document.hasFocus())),i()(this,"shouldSendReport",(async()=>!!(this.isActiveWindow()&&this.telemetryService.canSendTelemetry()&&await this.isReportDue())&&(await this.refreshConfig(),this.telemetryService.canSendTelemetry()))),i()(this,"sendIfDue",(async()=>{await this.shouldSendReport()&&(this.updateLastReported(Date.now()),this.retryCount=0,await this.sendUsageData())})),i()(this,"sendUsageData",(async()=>{try{const e=this.telemetryService.getTelemetryUrl(),t=await this.telemetryService.fetchTelemetry();await Promise.all(t.map((async({clusterUuid:t,stats:n})=>await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Elastic-Stack-Version":this.telemetryService.currentKibanaVersion,"X-Elastic-Cluster-ID":t,"X-Elastic-Content-Encoding":j.PAYLOAD_CONTENT_ENCODING},body:n})))),await this.telemetryService.updateLastReported().catch((()=>{}))}catch(e){this.retryCount=this.retryCount+1,this.retryCount<20?window.setTimeout(this.sendUsageData,telemetry_sender_TelemetrySender.getRetryDelay(this.retryCount)):console.warn(`TelemetrySender.sendUsageData exceeds number of retry attempts with ${e.message}`)}})),i()(this,"startChecking",(()=>{this.sendIfDue$||(this.sendIfDue$=Object(y.merge)(Object(y.interval)(6e4),Object(y.fromEvent)(window,"focus")).pipe(Object(w.exhaustMap)(this.sendIfDue)).subscribe())})),i()(this,"stop",(()=>{var e;null===(e=this.sendIfDue$)||void 0===e||e.unsubscribe()})),this.telemetryService=e,this.refreshConfig=t,this.storage=new E.Storage(window.localStorage);const n=this.storage.get(j.LOCALSTORAGE_KEY);n&&(this.lastReported=parseInt(n.lastReport,10))}}var k=n(8),P=n(14);class telemetry_service_TelemetryService{constructor({config:e,http:t,isScreenshotMode:n,notifications:r,currentKibanaVersion:s,reportOptInStatusChange:o=!0}){i()(this,"http",void 0),i()(this,"reportOptInStatusChange",void 0),i()(this,"notifications",void 0),i()(this,"defaultConfig",void 0),i()(this,"isScreenshotMode",void 0),i()(this,"updatedConfig",void 0),i()(this,"currentKibanaVersion",void 0),i()(this,"getCanChangeOptInStatus",(()=>this.config.allowChangingOptInStatus)),i()(this,"getOptInStatusUrl",(()=>{const{sendUsageTo:e}=this.config;return Object(P.a)({channelName:"optInStatus",env:e})})),i()(this,"getTelemetryUrl",(()=>{const{sendUsageTo:e}=this.config;return Object(P.a)({channelName:"snapshot",env:e})})),i()(this,"getIsOptedIn",(()=>this.isOptedIn)),i()(this,"canSendTelemetry",(()=>!this.isScreenshotMode&&this.getIsOptedIn())),i()(this,"fetchLastReported",(async()=>{const e=await this.http.get("/api/telemetry/v2/last_reported");return null==e?void 0:e.lastReported})),i()(this,"updateLastReported",(async()=>this.http.put("/api/telemetry/v2/last_reported"))),i()(this,"fetchExample",(async()=>await this.fetchTelemetry({unencrypted:!0,refreshCache:!0}))),i()(this,"fetchTelemetry",(async({unencrypted:e=!1,refreshCache:t=!1}={})=>this.http.post("/api/telemetry/v2/clusters/_stats",{body:JSON.stringify({unencrypted:e,refreshCache:t})}))),i()(this,"setOptIn",(async e=>{if(!this.getCanChangeOptInStatus())return!1;try{const t=await this.http.post("/api/telemetry/v2/optIn",{body:JSON.stringify({enabled:e})});this.reportOptInStatusChange&&await this.reportOptInStatus(t),this.isOptedIn=e}catch(e){return this.notifications.toasts.addError(e,{title:k.i18n.translate("telemetry.optInErrorToastTitle",{defaultMessage:"Error"}),toastMessage:k.i18n.translate("telemetry.optInErrorToastText",{defaultMessage:"An error occurred while trying to set the usage statistics preference."})}),!1}return!0})),i()(this,"setUserHasSeenNotice",(async()=>{try{await this.http.put("/api/telemetry/v2/userHasSeenNotice"),this.userHasSeenOptedInNotice=!0}catch(e){this.notifications.toasts.addError(e,{title:k.i18n.translate("telemetry.optInNoticeSeenErrorTitle",{defaultMessage:"Error"}),toastMessage:k.i18n.translate("telemetry.optInNoticeSeenErrorToastText",{defaultMessage:"An error occurred dismissing the notice"})}),this.userHasSeenOptedInNotice=!1}})),i()(this,"reportOptInStatus",(async e=>{const t=this.getOptInStatusUrl();try{await Promise.all(e.map((async({clusterUuid:e,stats:n})=>await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-Elastic-Stack-Version":this.currentKibanaVersion,"X-Elastic-Cluster-ID":e,"X-Elastic-Content-Encoding":j.PAYLOAD_CONTENT_ENCODING},body:n}))))}catch(e){}})),this.defaultConfig=e,this.isScreenshotMode=n,this.reportOptInStatusChange=o,this.notifications=r,this.currentKibanaVersion=s,this.http=t}set config(e){this.updatedConfig=e}get config(){return{...this.defaultConfig,...this.updatedConfig}}get isOptedIn(){return Boolean(this.config.optIn)}set isOptedIn(e){this.config={...this.config,optIn:e}}get userHasSeenOptedInNotice(){return this.config.telemetryNotifyUserAboutOptInDefault}set userHasSeenOptedInNotice(e){this.config={...this.config,telemetryNotifyUserAboutOptInDefault:e}}getUserShouldSeeOptInNotice(){var e;return null!==(e=!this.config.hidePrivacyStatement&&this.config.telemetryNotifyUserAboutOptInDefault&&this.config.userCanChangeSettings)&&void 0!==e&&e}get userCanChangeSettings(){var e;return null!==(e=this.config.userCanChangeSettings)&&void 0!==e&&e}set userCanChangeSettings(e){this.config={...this.config,userCanChangeSettings:e}}}var R=n(5),A=n.n(R),D=n(13),U=n(10),B=n(3),L={name:"1azakc",styles:"text-align:center"},$=function(){var e=L;return Object(B.jsx)("div",{css:e},Object(B.jsx)(U.EuiLoadingSpinner,null))},M=n(21),V=n.n(M),H=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(B.jsx)($,null);return A.a.forwardRef((function(n,r){return Object(B.jsx)(U.EuiErrorBoundary,null,Object(B.jsx)(R.Suspense,{fallback:t},Object(B.jsx)(e,V()({},n,{ref:r}))))}))};class telemetry_notifications_TelemetryNotifications{constructor({http:e,overlays:t,theme:r,telemetryService:s,telemetryConstants:o}){i()(this,"http",void 0),i()(this,"overlays",void 0),i()(this,"theme",void 0),i()(this,"telemetryConstants",void 0),i()(this,"telemetryService",void 0),i()(this,"optedInNoticeBannerId",void 0),i()(this,"optInBannerId",void 0),i()(this,"shouldShowOptedInNoticeBanner",(()=>{const e=this.telemetryService.getUserShouldSeeOptInNotice();return!(void 0!==this.optedInNoticeBannerId)&&e})),i()(this,"renderOptedInNoticeBanner",(()=>{const e=function({onSeen:e,overlays:t,http:r,theme:i,telemetryConstants:s}){const o=H(A.a.lazy((()=>n.e(3).then(n.bind(null,34)).then((({OptedInNoticeBanner:e})=>({default:e})))))),a=Object(D.toMountPoint)(Object(B.jsx)(o,{onSeenBanner:e,http:r,telemetryConstants:s}),{theme$:i.theme$});return t.banners.add(a,1e4)}({http:this.http,onSeen:this.setOptedInNoticeSeen,overlays:this.overlays,theme:this.theme,telemetryConstants:this.telemetryConstants});this.optedInNoticeBannerId=e})),i()(this,"shouldShowOptInBanner",(()=>{const e=this.telemetryService.getIsOptedIn();return!(void 0!==this.optInBannerId)&&null===e})),i()(this,"renderOptInBanner",(()=>{const e=function({setOptIn:e,overlays:t,telemetryConstants:r}){const i=H(A.a.lazy((()=>n.e(2).then(n.bind(null,37)).then((({OptInBanner:e})=>({default:e})))))),s=Object(D.toMountPoint)(Object(B.jsx)(i,{onChangeOptInClick:e,telemetryConstants:r}));return t.banners.add(s,1e4)}({setOptIn:this.onSetOptInClick,overlays:this.overlays,telemetryConstants:this.telemetryConstants});this.optInBannerId=e})),i()(this,"onSetOptInClick",(async e=>{this.optInBannerId&&(this.overlays.banners.remove(this.optInBannerId),this.optInBannerId=void 0),await this.telemetryService.setOptIn(e)})),i()(this,"setOptedInNoticeSeen",(async()=>{this.optedInNoticeBannerId&&(this.overlays.banners.remove(this.optedInNoticeBannerId),this.optedInNoticeBannerId=void 0),await this.telemetryService.setUserHasSeenNotice()})),this.telemetryService=s,this.http=e,this.overlays=t,this.theme=r,this.telemetryConstants=o}}function K(e){return{getPrivacyStatementUrl:()=>e.links.legal.privacyStatement}}class plugin_TelemetryPlugin{constructor(e){i()(this,"currentKibanaVersion",void 0),i()(this,"config",void 0),i()(this,"telemetrySender",void 0),i()(this,"telemetryNotifications",void 0),i()(this,"telemetryService",void 0),i()(this,"canUserChangeSettings",!0),i()(this,"savedObjectsClient",void 0),this.currentKibanaVersion=e.env.packageInfo.version,this.config=e.config.get()}setup({analytics:e,http:t,notifications:r,getStartServices:i},{screenshotMode:s,home:o}){const a=this.config,c=this.currentKibanaVersion;let u;return this.telemetryService=new telemetry_service_TelemetryService({config:a,isScreenshotMode:s.isScreenshotMode(),http:t,notifications:r,currentKibanaVersion:c}),i().then((([{docLinks:e}])=>{u=K(e)})),e.registerContextProvider({name:"telemetry labels",context$:Object(y.of)({labels:this.config.labels}),schema:{labels:{type:"pass_through",_meta:{description:"Custom labels added to the telemetry.labels config in the kibana.yml"}}}}),e.registerShipper(T,{channelName:"kibana-browser",version:c,sendTo:"prod"===a.sendUsageTo?"production":"staging"}),this.telemetrySender=new telemetry_sender_TelemetrySender(this.telemetryService,(async()=>{await this.refreshConfig(),e.optIn({global:{enabled:this.telemetryService.isOptedIn}})})),o&&!this.config.hidePrivacyStatement&&(o.welcomeScreen.registerOnRendered((()=>{var e,t;null!==(e=this.telemetryService)&&void 0!==e&&e.userCanChangeSettings&&(null===(t=this.telemetryNotifications)||void 0===t||t.setOptedInNoticeSeen())})),o.welcomeScreen.registerTelemetryNoticeRenderer((()=>function(e,t,r){const i=H(A.a.lazy((()=>n.e(4).then(n.bind(null,35)).then((({WelcomeTelemetryNotice:e})=>({default:e}))))));return Object(B.jsx)(i,{telemetryService:e,telemetryConstants:r,addBasePath:t})}(this.telemetryService,t.basePath.prepend,u)))),{telemetryService:this.getTelemetryServicePublicApis()}}start({analytics:e,http:t,overlays:n,theme:r,application:i,savedObjects:s,docLinks:o}){if(!this.telemetryService)throw Error("Telemetry plugin failed to initialize properly.");this.canUserChangeSettings=this.getCanUserChangeSettings(i),this.telemetryService.userCanChangeSettings=this.canUserChangeSettings;const a=K(o),c=new telemetry_notifications_TelemetryNotifications({http:t,overlays:n,theme:r,telemetryService:this.telemetryService,telemetryConstants:a});return this.telemetryNotifications=c,this.savedObjectsClient=s.client,i.currentAppId$.subscribe((async()=>{if(this.getIsUnauthenticated(t))return;const n=await this.refreshConfig();e.optIn({global:{enabled:this.telemetryService.isOptedIn}});const r=null==n?void 0:n.banner;this.maybeStartTelemetryPoller(),r&&(this.maybeShowOptedInNotificationBanner(),this.maybeShowOptInBanner())})),{telemetryService:this.getTelemetryServicePublicApis(),telemetryNotifications:{setOptedInNoticeSeen:()=>c.setOptedInNoticeSeen()},telemetryConstants:a}}stop(){var e;null===(e=this.telemetrySender)||void 0===e||e.stop()}getTelemetryServicePublicApis(){const e=this.telemetryService;return{getIsOptedIn:()=>e.getIsOptedIn(),setOptIn:t=>e.setOptIn(t),canSendTelemetry:()=>e.canSendTelemetry(),userCanChangeSettings:e.userCanChangeSettings,getCanChangeOptInStatus:()=>e.getCanChangeOptInStatus(),fetchExample:()=>e.fetchExample()}}async refreshConfig(){if(this.savedObjectsClient&&this.telemetryService){const e=await this.getTelemetrySavedObject(this.savedObjectsClient),t=await this.updateConfigsBasedOnSavedObjects(e);return this.telemetryService.config=t,t}}getCanUserChangeSettings(e){var t,n,r;return null===(t=null===(n=e.capabilities)||void 0===n||null===(r=n.savedObjectsManagement)||void 0===r?void 0:r.edit)||void 0===t||t}getIsUnauthenticated(e){const{anonymousPaths:t}=e;return t.isAnonymous(window.location.pathname)}maybeStartTelemetryPoller(){this.telemetrySender&&this.telemetrySender.startChecking()}maybeShowOptedInNotificationBanner(){this.telemetryNotifications&&this.telemetryNotifications.shouldShowOptedInNoticeBanner()&&this.telemetryNotifications.renderOptedInNoticeBanner()}maybeShowOptInBanner(){this.telemetryNotifications&&this.telemetryNotifications.shouldShowOptInBanner()&&this.telemetryNotifications.renderOptInBanner()}async updateConfigsBasedOnSavedObjects(e){const t=this.config.sendUsageFrom,r=this.config.optIn,i=this.config.allowChangingOptInStatus,s=this.currentKibanaVersion,{getTelemetryAllowChangingOptInStatus:o,getTelemetryOptIn:a,getTelemetrySendUsageFrom:c}=await n.e(1).then(n.bind(null,36)),u=o({configTelemetryAllowChangingOptInStatus:i,telemetrySavedObject:e}),l=a({configTelemetryOptIn:r,allowChangingOptInStatus:u,telemetrySavedObject:e,currentKibanaVersion:s}),h=c({configTelemetrySendUsageFrom:t,telemetrySavedObject:e}),d=function({allowChangingOptInStatus:e,telemetrySavedObject:t,telemetryOptedIn:n,configTelemetryOptIn:r}){return!1!==e&&(!t||!0!==t.userHasSeenNotice)&&!0===n&&!0===r}({telemetrySavedObject:e,allowChangingOptInStatus:u,configTelemetryOptIn:r,telemetryOptedIn:l});return{...this.config,optIn:l,sendUsageFrom:h,telemetryNotifyUserAboutOptInDefault:d,userCanChangeSettings:this.canUserChangeSettings}}async getTelemetrySavedObject(e){try{const{savedObjects:[{attributes:t}]}=await e.bulkGet([{id:"telemetry",type:"telemetry"}]);return t}catch(e){const t=e[Symbol("SavedObjectsClientErrorCode")];if("SavedObjectsClient/notFound"===t)return null;if("SavedObjectsClient/forbidden"===t)return!1;throw e}}}function F(e){return new plugin_TelemetryPlugin(e)}},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact}]);