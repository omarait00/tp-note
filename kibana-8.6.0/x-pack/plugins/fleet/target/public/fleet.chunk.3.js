/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.fleet_bundle_jsonpfunction=window.fleet_bundle_jsonpfunction||[]).push([[3],{189:function(e,t,a){"use strict";t.decode=t.parse=a(362),t.encode=t.stringify=a(363)},359:function(e,t,a){"use strict";var n=a(360),l=a(361);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=y,t.resolve=function(e,t){return y(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?y(e,!1,!0).resolveObject(t):t},t.format=function(e){return l.isString(e)&&(e=y(e)),e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i;var s=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),d=["%","/","?",";","#"].concat(u),g=["/","?","#"],m=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,E={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},h=a(189);function y(e,t,a){if(e&&l.isObject(e)&&e instanceof i)return e;var n=new i;return n.parse(e,t,a),n}i.prototype.parse=function(e,t,a){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),r=-1!==i&&i<e.indexOf("#")?"?":"#",c=e.split(r);c[0]=c[0].replace(/\\/g,"/");var y=e=c.join(r);if(y=y.trim(),!a&&1===e.split("#").length){var x=o.exec(y);if(x)return this.path=y,this.href=y,this.pathname=x[1],x[2]?(this.search=x[2],this.query=t?h.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var v=s.exec(y);if(v){var k=(v=v[0]).toLowerCase();this.protocol=k,y=y.substr(v.length)}if(a||v||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var M="//"===y.substr(0,2);!M||v&&f[v]||(y=y.substr(2),this.slashes=!0)}if(!f[v]&&(M||v&&!b[v])){for(var F,S,I=-1,O=0;O<g.length;O++)-1!==(w=y.indexOf(g[O]))&&(-1===I||w<I)&&(I=w);for(-1!==(S=-1===I?y.lastIndexOf("@"):y.lastIndexOf("@",I))&&(F=y.slice(0,S),y=y.slice(S+1),this.auth=decodeURIComponent(F)),I=-1,O=0;O<d.length;O++){var w;-1!==(w=y.indexOf(d[O]))&&(-1===I||w<I)&&(I=w)}-1===I&&(I=y.length),this.host=y.slice(0,I),y=y.slice(I),this.parseHost(),this.hostname=this.hostname||"";var T="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!T)for(var j=this.hostname.split(/\./),C=(O=0,j.length);O<C;O++){var A=j[O];if(A&&!A.match(m)){for(var P="",L=0,D=A.length;L<D;L++)A.charCodeAt(L)>127?P+="x":P+=A[L];if(!P.match(m)){var _=j.slice(0,O),B=j.slice(O+1),N=A.match(p);N&&(_.push(N[1]),B.unshift(N[2])),B.length&&(y="/"+B.join(".")+y),this.hostname=_.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=n.toASCII(this.hostname));var R=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+R,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!E[k])for(O=0,C=u.length;O<C;O++){var H=u[O];if(-1!==y.indexOf(H)){var q=encodeURIComponent(H);q===H&&(q=escape(H)),y=y.split(H).join(q)}}var U=y.indexOf("#");-1!==U&&(this.hash=y.substr(U),y=y.slice(0,U));var G=y.indexOf("?");if(-1!==G?(this.search=y.substr(G),this.query=y.substr(G+1),t&&(this.query=h.parse(this.query)),y=y.slice(0,G)):t&&(this.search="",this.query={}),y&&(this.pathname=y),b[k]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){R=this.pathname||"";var W=this.search||"";this.path=R+W}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",a=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(s=h.stringify(this.query));var r=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||b[t])&&!1!==i?(i="//"+(i||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),r&&"?"!==r.charAt(0)&&(r="?"+r),t+i+(a=a.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(r=r.replace("#","%23"))+n},i.prototype.resolve=function(e){return this.resolveObject(y(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(l.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var a=new i,n=Object.keys(this),s=0;s<n.length;s++){var r=n[s];a[r]=this[r]}if(a.hash=e.hash,""===e.href)return a.href=a.format(),a;if(e.slashes&&!e.protocol){for(var o=Object.keys(e),c=0;c<o.length;c++){var u=o[c];"protocol"!==u&&(a[u]=e[u])}return b[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a}if(e.protocol&&e.protocol!==a.protocol){if(!b[e.protocol]){for(var d=Object.keys(e),g=0;g<d.length;g++){var m=d[g];a[m]=e[m]}return a.href=a.format(),a}if(a.protocol=e.protocol,e.host||f[e.protocol])a.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),a.pathname=p.join("/")}if(a.search=e.search,a.query=e.query,a.host=e.host||"",a.auth=e.auth,a.hostname=e.hostname||e.host,a.port=e.port,a.pathname||a.search){var E=a.pathname||"",h=a.search||"";a.path=E+h}return a.slashes=a.slashes||e.slashes,a.href=a.format(),a}var y=a.pathname&&"/"===a.pathname.charAt(0),x=e.host||e.pathname&&"/"===e.pathname.charAt(0),v=x||y||a.host&&e.pathname,k=v,M=a.pathname&&a.pathname.split("/")||[],F=(p=e.pathname&&e.pathname.split("/")||[],a.protocol&&!b[a.protocol]);if(F&&(a.hostname="",a.port=null,a.host&&(""===M[0]?M[0]=a.host:M.unshift(a.host)),a.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),v=v&&(""===p[0]||""===M[0])),x)a.host=e.host||""===e.host?e.host:a.host,a.hostname=e.hostname||""===e.hostname?e.hostname:a.hostname,a.search=e.search,a.query=e.query,M=p;else if(p.length)M||(M=[]),M.pop(),M=M.concat(p),a.search=e.search,a.query=e.query;else if(!l.isNullOrUndefined(e.search))return F&&(a.hostname=a.host=M.shift(),(T=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=T.shift(),a.host=a.hostname=T.shift())),a.search=e.search,a.query=e.query,l.isNull(a.pathname)&&l.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a;if(!M.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var S=M.slice(-1)[0],I=(a.host||e.host||M.length>1)&&("."===S||".."===S)||""===S,O=0,w=M.length;w>=0;w--)"."===(S=M[w])?M.splice(w,1):".."===S?(M.splice(w,1),O++):O&&(M.splice(w,1),O--);if(!v&&!k)for(;O--;O)M.unshift("..");!v||""===M[0]||M[0]&&"/"===M[0].charAt(0)||M.unshift(""),I&&"/"!==M.join("/").substr(-1)&&M.push("");var T,j=""===M[0]||M[0]&&"/"===M[0].charAt(0);return F&&(a.hostname=a.host=j?"":M.length?M.shift():"",(T=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=T.shift(),a.host=a.hostname=T.shift())),(v=v||a.host&&M.length)&&!j&&M.unshift(""),M.length?a.pathname=M.join("/"):(a.pathname=null,a.path=null),l.isNull(a.pathname)&&l.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=e.auth||a.auth,a.slashes=a.slashes||e.slashes,a.href=a.format(),a},i.prototype.parseHost=function(){var e=this.host,t=r.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},360:function(e,t,a){e.exports=a(36)(2732)},361:function(e,t,a){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},362:function(e,t,a){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,a,i){t=t||"&",a=a||"=";var s={};if("string"!=typeof e||0===e.length)return s;var r=/\+/g;e=e.split(t);var o=1e3;i&&"number"==typeof i.maxKeys&&(o=i.maxKeys);var c=e.length;o>0&&c>o&&(c=o);for(var u=0;u<c;++u){var d,g,m,p,E=e[u].replace(r,"%20"),f=E.indexOf(a);f>=0?(d=E.substr(0,f),g=E.substr(f+1)):(d=E,g=""),m=decodeURIComponent(d),p=decodeURIComponent(g),n(s,m)?l(s[m])?s[m].push(p):s[m]=[s[m],p]:s[m]=p}return s};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},363:function(e,t,a){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,a,r){return t=t||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),(function(s){var r=encodeURIComponent(n(s))+a;return l(e[s])?i(e[s],(function(e){return r+encodeURIComponent(n(e))})).join(t):r+encodeURIComponent(n(e[s]))})).join(t):r?encodeURIComponent(n(r))+a+encodeURIComponent(n(e)):""};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var a=[],n=0;n<e.length;n++)a.push(t(e[n],n));return a}var s=Object.keys||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.push(a);return t}},364:function(e,t,a){const n=a(52);e.exports=(e,t,a)=>n(e,t,a)>=0},365:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(39),l=a(0),i=n.__importDefault(a(64)),s=a(366),r={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};t.default=s.isClient&&window.ResizeObserver?function(){var e=l.useState(null),t=e[0],a=e[1],n=l.useState(r),s=n[0],o=n[1],c=l.useMemo((function(){return new window.ResizeObserver((function(e){if(e[0]){var t=e[0].contentRect,a=t.x,n=t.y,l=t.width,i=t.height,s=t.top,r=t.left,c=t.bottom,u=t.right;o({x:a,y:n,width:l,height:i,top:s,left:r,bottom:c,right:u})}}))}),[]);return i.default((function(){if(t)return c.observe(t),function(){c.disconnect()}}),[t]),[a,s]}:function(){return[function(){},r]}},366:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDeepEqual=t.off=t.on=t.isClient=void 0;var n=a(39).__importDefault(a(367));t.isClient="object"==typeof window,t.on=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.addEventListener.apply(e,t)},t.off=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.removeEventListener.apply(e,t)},t.isDeepEqual=n.default},367:function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var n,l,i;if(Array.isArray(t)){if((n=t.length)!=a.length)return!1;for(l=n;0!=l--;)if(!e(t[l],a[l]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((n=(i=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(l=n;0!=l--;)if(!Object.prototype.hasOwnProperty.call(a,i[l]))return!1;for(l=n;0!=l--;){var s=i[l];if(!("_owner"===s&&t.$$typeof||e(t[s],a[s])))return!1}return!0}return t!=t&&a!=a}},368:function(e,t,a){e.exports=a(36)(1813)},371:function(e,t,a){"use strict";a.r(t),a.d(t,"ProtectedRoute",(function(){return Wl})),a.d(t,"renderApp",(function(){return Vl})),a.d(t,"teardownFleet",(function(){return Kl}));var n=a(0),l=a.n(n),i=a(77),s=a.n(i),r=a(16),o=a(17),c=a(6),u=a(8),d=a(4),g=a(75),m=a.n(g),p=a(54),E=a.n(p),f=a(23),b=a(78),h=a(92),y=a(91),x=a(9),v=a(99),k=a(104),M=a(93),F=a.n(M),S=a(1),I=a(130),O=a(45);const w=m()(c.EuiFlyout).withConfig({displayName:"FlyoutWithHigherZIndex",componentId:"sc-4bxzaq-0"})(["z-index:",";"],(e=>e.theme.eui.euiZLevel5)),T=({onClose:e,as:t,...a})=>{const{notifications:i}=Object(o.Tb)(),s=Object(o.nb)().fleet.all,[r,g]=Object(n.useState)({name:"",description:"",namespace:"default",monitoring_enabled:Object.values(S.db)}),[m,p]=Object(n.useState)(!1),[E,f]=Object(n.useState)(!0),b=Object(k.h)(r),h=l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0,"aria-labelledby":"CreateAgentPolicyFlyoutTitle"},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"CreateAgentPolicyFlyoutTitle","data-test-subj":"createAgentPolicyFlyoutTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitle",defaultMessage:"Create agent policy"}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiText,{size:"s"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitleDescription",defaultMessage:"Agent policies are used to manage settings across a group of agents. You can add integrations to your agent policy to specify what data your agents collect. When you edit an agent policy, you can use Fleet to deploy updates to a specified group of agents."})))),x=l.a.createElement(c.EuiFlyoutBody,null,l.a.createElement(k.d,{agentPolicy:r,updateAgentPolicy:e=>{g({...r,...e})},withSysMonitoring:E,updateSysMonitoring:e=>f(e),validation:b})),{showDevtoolsRequest:v}=O.b.get(),M=Object(n.useMemo)((()=>Object(I.a)(r,E)),[r,E]),T=l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexGroup,{gutterSize:"none"},v?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.h,{isDisabled:m||Object.keys(b).length>0,description:d.i18n.translate("xpack.fleet.createAgentPolicy.devtoolsRequestDescription",{defaultMessage:"This Kibana request creates a new agent policy."}),request:M})):null,l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:m,isDisabled:!s||m||Object.keys(b).length>0,onClick:async()=>{p(!0);try{const{data:t,error:a}=await(async()=>await Object(o.j)(r,{withSysMonitoring:E}))();p(!1),t?(i.toasts.addSuccess(d.i18n.translate("xpack.fleet.createAgentPolicy.successNotificationTitle",{defaultMessage:"Agent policy '{name}' created",values:{name:r.name}})),e(t.item)):i.toasts.addDanger(a?a.message:d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}catch(e){p(!1),i.toasts.addDanger(d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}},"data-test-subj":"createAgentPolicyFlyoutBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.submitButtonLabel",defaultMessage:"Create agent policy"})))))));return l.a.createElement(w,F()({onClose:()=>e(),size:"l",maxWidth:400},a),h,x,T)},j=()=>{var e,t;Object(o.ob)("policies_list");const{getPath:a}=Object(o.Nb)(),i=Object(o.nb)().fleet.all,{agents:{enabled:s}}=Object(o.qb)(),{urlParams:g,toUrlParams:m}=Object(o.Wb)(),[p,E]=Object(n.useState)(Array.isArray(g.kuery)?g.kuery[g.kuery.length-1]:null!==(e=g.kuery)&&void 0!==e?e:""),{pagination:f,pageSizeOptions:b,setPagination:h}=Object(o.Pb)(),{sorting:v,setSorting:M}=Object(o.Sb)({field:"updated_at",direction:"desc"}),F=Object(r.useHistory)(),S="create"in g,I=Object(n.useCallback)((e=>{if(e!==S)if(e)F.push(`${a("policies_list")}?${m({...g,create:null})}`);else{const{create:e,...t}=g;F.push(`${a("policies_list")}?${m(t)}`)}}),[a,F,S,m,g]),{isLoading:O,data:w,resendRequest:j}=Object(o.vb)({page:f.currentPage,perPage:f.pageSize,sortField:null==v?void 0:v.field,sortOrder:null==v?void 0:v.direction,kuery:p,full:!0}),C=Object(n.useMemo)((()=>{const e=[{field:"name",sortable:!0,name:d.i18n.translate("xpack.fleet.agentPolicyList.nameColumnTitle",{defaultMessage:"Name"}),width:"20%",render:(e,t)=>l.a.createElement(y.f,{policy:t})},{field:"description",name:d.i18n.translate("xpack.fleet.agentPolicyList.descriptionColumnTitle",{defaultMessage:"Description"}),width:"35%",render:e=>l.a.createElement(c.EuiTextColor,{color:"subdued",className:"eui-textTruncate",title:e},e)},{field:"updated_at",sortable:!0,name:d.i18n.translate("xpack.fleet.agentPolicyList.updatedOnColumnTitle",{defaultMessage:"Last updated on"}),render:e=>l.a.createElement(u.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})},{field:"agents",name:d.i18n.translate("xpack.fleet.agentPolicyList.agentsColumnTitle",{defaultMessage:"Agents"}),dataType:"number",render:(e,t)=>l.a.createElement(k.g,{count:e,agentPolicyId:t.id})},{field:"package_policies",name:d.i18n.translate("xpack.fleet.agentPolicyList.packagePoliciesCountColumnTitle",{defaultMessage:"Integrations"}),dataType:"number",render:e=>e?e.length:0},{field:"actions",name:d.i18n.translate("xpack.fleet.agentPolicyList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>l.a.createElement(k.a,{agentPolicy:e,onCopySuccess:()=>j()})}]}];return s?e:e.filter((e=>!("field"in e)||"agents"!==e.field))}),[s,j]),A=Object(n.useMemo)((()=>l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",isDisabled:!i,onClick:()=>I(!0),"data-test-subj":"createAgentPolicyButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.addButton",defaultMessage:"Create agent policy"}))),[i,I]),P=Object(n.useMemo)((()=>l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",isDisabled:!i,onClick:()=>I(!0),"data-test-subj":"emptyPromptCreateAgentPolicyButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.addButton",defaultMessage:"Create agent policy"}))),[i,I]),L=Object(n.useMemo)((()=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noAgentPoliciesPrompt",defaultMessage:"No agent policies"})),actions:P})),[P]);return l.a.createElement(l.a.Fragment,null,S?l.a.createElement(T,{onClose:()=>{I(!1),j()}}):null,l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"m"},l.a.createElement(c.EuiFlexItem,{grow:4},l.a.createElement(y.u,{value:p,onChange:e=>{h({...f,currentPage:1}),E(e)},fieldPrefix:x.c})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"primary",iconType:"refresh",onClick:()=>j()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.reloadAgentPoliciesButtonText",defaultMessage:"Reload"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},A)),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{loading:O,hasActions:!0,noItemsMessage:O?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.loadingAgentPoliciesMessage",defaultMessage:"Loading agent policies…"}):p.trim()||0!==(null!==(t=null==w?void 0:w.total)&&void 0!==t?t:0)?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noFilteredAgentPoliciesPrompt",defaultMessage:"No agent policies found. {clearFiltersLink}",values:{clearFiltersLink:l.a.createElement(c.EuiLink,{onClick:()=>E("")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):L,items:w?w.items:[],itemId:"id",columns:C,isSelectable:!1,pagination:{pageIndex:f.currentPage-1,pageSize:f.pageSize,totalItemCount:w?w.total:0,pageSizeOptions:b},sorting:{sort:v},onChange:e=>{const t={...f,currentPage:e.page.index+1,pageSize:e.page.size};h(t),M(e.sort)}}))},C=l.a.createContext({refresh:()=>{}});var A=a(13),P=a(7);const L=(e,t)=>e.localeCompare(t),D=e=>({name:e,value:e}),_=({packagePolicies:e,agentPolicy:t,...a})=>{var i,s;const{application:r}=Object(o.Tb)(),g=Object(o.nb)().integrations.writeIntegrationPolicies,m=Object(o.nb)().integrations.readIntegrationPolicies,{updatableIntegrations:p}=Object(o.Ob)(),{getHref:E}=Object(o.Nb)(),f=Object(o.Qb)(),b=!(null!==(i=f.data)&&void 0!==i&&i.success)&&"MISSING_SECURITY"===(null===(s=f.data)||void 0===s?void 0:s.error),[h,x]=Object(n.useMemo)((()=>{const t=new Set;return[e.map((e=>{var a,n,l,i,s,r,o,c;e.namespace&&t.add(e.namespace);const u=p.get(null!==(a=null===(n=e.package)||void 0===n?void 0:n.name)&&void 0!==a?a:""),d=!!u&&u.policiesToUpgrade.some((({pkgPolicyId:t})=>t===e.id));return{...e,packageName:null!==(l=null===(i=e.package)||void 0===i?void 0:i.name)&&void 0!==l?l:"",packageTitle:null!==(s=null===(r=e.package)||void 0===r?void 0:r.title)&&void 0!==s?s:"",packageVersion:null!==(o=null===(c=e.package)||void 0===c?void 0:c.version)&&void 0!==o?o:"",hasUpgrade:d}})),[...t].sort(L).map(D)]}),[e,p]),v=Object(n.useMemo)((()=>[{field:"name",sortable:!0,truncateText:!0,name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.nameColumnTitle",{defaultMessage:"Name"}),render:(e,a)=>l.a.createElement(c.EuiLink,F()({title:e},m?{href:E("edit_integration",{policyId:t.id,packagePolicyId:a.id})}:{disabled:!0}),l.a.createElement("span",{className:"eui-textTruncate",title:e},e),a.description?l.a.createElement("span",null," ",l.a.createElement(c.EuiToolTip,{content:a.description},l.a.createElement(c.EuiIcon,{type:"help"}))):null)},{field:"packageTitle",sortable:!0,name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.packageNameColumnTitle",{defaultMessage:"Integration"}),render:(e,a)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{"data-test-subj":"PackagePoliciesTableLink",grow:!1},l.a.createElement(c.EuiLink,{href:a.package&&E("integration_details_overview",{pkgkey:Object(O.r)(a.package)})},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},a.package&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.r,{packageName:a.package.name,version:a.package.version,size:"m",tryApi:!0})),l.a.createElement(c.EuiFlexItem,{grow:!1},e),a.package&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.packageVersion",defaultMessage:"v{version}",values:{version:a.package.version}})))))),a.hasUpgrade&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.upgradeAvailable",{defaultMessage:"Upgrade Available"})},l.a.createElement(c.EuiIcon,{type:"alert",color:"warning"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{"data-test-subj":"PackagePoliciesTableUpgradeButton",size:"s",minWidth:"0",isDisabled:!g,href:`${E("upgrade_package_policy",{policyId:t.id,packagePolicyId:a.id})}?from=fleet-policy-list`},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.upgradeButton",defaultMessage:"Upgrade"})))))},{field:"namespace",name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?l.a.createElement(c.EuiBadge,{color:"hollow"},e):""},{name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>g?l.a.createElement(y.s,{agentPolicy:t,packagePolicy:e,upgradePackagePolicyHref:`${E("upgrade_package_policy",{policyId:t.id,packagePolicyId:e.id})}?from=fleet-policy-list`}):l.a.createElement(l.a.Fragment,null)}]}]),[t,E,g,m]);return l.a.createElement(c.EuiInMemoryTable,F()({itemId:"id",items:h,columns:v,sorting:{sort:{field:"name",direction:"asc"}}},a,{search:{toolsRight:t.is_managed?[]:[l.a.createElement(y.j,{key:"addPackagePolicyButton",fill:!0,isDisabled:!g,iconType:"plusInCircle",onClick:()=>{r.navigateToApp(A.INTEGRATIONS_PLUGIN_ID,{path:P.u.integrations_all({})[1],state:{forAgentPolicyId:t.id}})},"data-test-subj":"addPackagePolicyButton",tooltip:g?void 0:{content:b?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.epm.addPackagePolicyButtonSecurityRequiredTooltip",defaultMessage:"To add Elastic Agent Integrations, you must have security enabled and have the All privilege for Fleet. Contact your administrator."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.epm.addPackagePolicyButtonPrivilegesRequiredTooltip",defaultMessage:"Elastic Agent Integrations require the All privilege for Fleet and All privilege for Integrations. Contact your administrator."})}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.addPackagePolicyButtonText",defaultMessage:"Add integration"}))],box:{incremental:!0,schema:!0},filters:[{type:"field_value_selection",field:"namespace",name:"Namespace",options:x,multiSelect:"or",operator:"exact"}]},isSelectable:!1}))},B=Object(n.memo)((({policyId:e})=>{const{application:t}=Object(o.Tb)(),a=Object(o.nb)().integrations.writeIntegrationPolicies;return l.a.createElement(c.EuiEmptyPrompt,{iconType:"plusInCircle",title:l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstTitle",defaultMessage:"Add your first integration"})),body:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstMessage",defaultMessage:"This policy does not have any integrations yet."}),actions:l.a.createElement(c.EuiButton,{iconType:"plusInCircle",isDisabled:!a,fill:!0,onClick:()=>t.navigateToApp(x.k,{path:x.o.integrations_all({})[1],state:{forAgentPolicyId:e}}),"data-test-subj":"addPackagePolicyButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstButtonText",defaultMessage:"Add integration"}))})})),N=Object(n.memo)((({agentPolicy:e})=>(Object(o.ob)("policy_details",{policyName:e.name}),e.package_policies&&0!==e.package_policies.length?l.a.createElement(_,{agentPolicy:e,packagePolicies:e.package_policies}):l.a.createElement(B,{policyId:e.id}))));var R=a(11);const z=m.a.div.withConfig({displayName:"FormWrapper",componentId:"sc-1b9jodr-0"})(["max-width:800px;margin-right:auto;margin-left:auto;"]),H=Object(n.memo)((({agentPolicy:e})=>{Object(o.ob)("policy_details",{policyName:e.name});const{notifications:t}=Object(o.Tb)(),{agents:{enabled:a}}=Object(o.qb)(),i=Object(r.useHistory)(),{getPath:s}=Object(o.Nb)(),g=Object(o.nb)().fleet.all,m=Object(o.mb)(),[p,E]=Object(n.useState)({...e}),[f,b]=Object(n.useState)(!1),[h,x]=Object(n.useState)(!1),[v,M]=Object(n.useState)(0),[F,S]=Object(n.useState)(!0),w=Object(k.h)(p),T=async()=>{b(!0);try{const{name:e,description:a,namespace:n,monitoring_enabled:l,unenroll_timeout:i,data_output_id:s,monitoring_output_id:r,download_source_id:c,fleet_server_host_id:u}=p,{data:g,error:E}=await Object(o.jb)(p.id,{name:e,description:a,namespace:n,monitoring_enabled:l,unenroll_timeout:i,data_output_id:s,monitoring_output_id:r,download_source_id:c,fleet_server_host_id:u});g?(t.toasts.addSuccess(d.i18n.translate("xpack.fleet.editAgentPolicy.successNotificationTitle",{defaultMessage:"Successfully updated '{name}' settings",values:{name:p.name}})),m(),x(!1)):t.toasts.addDanger(E?E.message:d.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}catch(e){t.toasts.addDanger(d.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}b(!1)},{showDevtoolsRequest:j}=O.b.get(),C=Object(n.useMemo)((()=>Object(I.c)(p.id,Object(R.pick)(p,"name","description","namespace","monitoring_enabled","unenroll_timeout","data_output_id","monitoring_output_id","download_source_id","fleet_server_host_id"))),[p]);return l.a.createElement(z,null,v?l.a.createElement(k.f,{agentCount:v,agentPolicy:p,onConfirm:()=>{M(0),T()},onCancel:()=>{M(0),b(!1)}}):null,l.a.createElement(k.d,{agentPolicy:p,updateAgentPolicy:e=>{E({...p,...e}),x(!0)},withSysMonitoring:F,updateSysMonitoring:e=>S(e),validation:w,isEditing:!0,onDelete:()=>{i.push(s("policies_list"))}}),h?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiBottomBar,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.unsavedChangesText",defaultMessage:"You have unsaved changes"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",onClick:()=>{E({...e}),x(!1)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.cancelButtonText",defaultMessage:"Cancel"}))),j?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.h,{isDisabled:f||Object.keys(w).length>0,btnProps:{color:"ghost"},description:d.i18n.translate("xpack.fleet.editAgentPolicy.devtoolsRequestDescription",{defaultMessage:"This Kibana request updates an agent policy."}),request:C})):null,l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{onClick:async()=>{if(a){b(!0);const{data:e}=await Object(o.v)({policyId:p.id});null!=e&&e.results.total?M(e.results.total):await T()}else await T()},isLoading:f,isDisabled:!g||f||Object.keys(w).length>0,iconType:"save",color:"primary",fill:!0},f?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.savingButtonText",defaultMessage:"Saving…"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.saveButtonText",defaultMessage:"Save changes"})))))))):null)})),q=({isLoading:e,policyId:t,agentPolicy:a})=>{const{getHref:n}=Object(o.Nb)();return l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButtonEmpty,{iconType:"arrowLeft",href:n("policies_list"),flush:"left",size:"xs"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.viewAgentListTitle",defaultMessage:"View all agent policies"}))),l.a.createElement(c.EuiFlexItem,null,e?l.a.createElement(y.p,null):l.a.createElement(c.EuiFlexGroup,{alignItems:"center",wrap:!0,responsive:!1,gutterSize:"s"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiTitle,null,l.a.createElement("h1",null,a&&a.name||l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.policyDetailsTitle",defaultMessage:"Policy '{id}'",values:{id:t}})))),(null==a?void 0:a.is_managed)&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIconTip,{title:"Hosted agent policy",content:d.i18n.translate("xpack.fleet.policyDetails.policyDetailsHostedPolicyTooltip",{defaultMessage:"This policy is managed outside of Fleet. Most actions related to this policy are unavailable."}),type:"lock",size:"l",color:"subdued"})))),a&&a.description?l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiText,{color:"subdued",size:"s",className:"eui-textBreakWord"},a.description)):null)},U=m.a.div.withConfig({displayName:"Divider",componentId:"sc-1n9nfzq-0"})(["width:0;height:100%;border-left:",";"],(e=>e.theme.eui.euiBorderThin)),G=({isLoading:e,policyId:t,agentPolicy:a,agentStatus:n,addAgent:i,onCancelEnrollment:s,isAddAgentHelpPopoverOpen:g,setIsAddAgentHelpPopoverOpen:m})=>{var p;const{getPath:E}=Object(o.Nb)(),f=Object(r.useHistory)();if(!a)return null;const b=l.a.createElement(c.EuiLink,{onClick:i},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.addAgentButton",defaultMessage:"Add agent"}));return l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd",direction:"row"},[{label:d.i18n.translate("xpack.fleet.policyDetails.summary.revision",{defaultMessage:"Revision"}),content:null!==(p=null==a?void 0:a.revision)&&void 0!==p?p:0},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.integrations",{defaultMessage:"Integrations"}),content:l.a.createElement(c.EuiI18nNumber,{value:a&&a.package_policies&&a.package_policies.length||0})},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.usedBy",{defaultMessage:"Agents"}),content:n&&n.total?l.a.createElement(k.g,{count:n.total,agentPolicyId:a&&a.id||"",showAgentText:!0}):null!=a&&a.is_managed?l.a.createElement(k.g,{count:0,agentPolicyId:a&&a.id||"",showAgentText:!0}):l.a.createElement(y.a,{button:b,isOpen:g,offset:15,closePopover:()=>{m(!1)}})},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.lastUpdated",{defaultMessage:"Last updated on"}),content:a&&l.a.createElement(u.FormattedDate,{value:null==a?void 0:a.updated_at,year:"numeric",month:"short",day:"2-digit"})||""},{isDivider:!0},{content:a&&l.a.createElement(k.a,{agentPolicy:a,fullButton:!0,onCopySuccess:e=>{f.push(E("policy_details",{policyId:e.id}))},onCancelEnrollment:s})}].map(((e,t)=>{var a;return l.a.createElement(c.EuiFlexItem,{grow:!1,key:t},null!==(a=e.isDivider)&&void 0!==a&&a?l.a.createElement(U,null):e.label?l.a.createElement(c.EuiDescriptionList,{compressed:!0,textStyle:"reverse",style:{textAlign:"right"}},l.a.createElement(c.EuiDescriptionListTitle,{className:"eui-textNoWrap"},e.label),l.a.createElement(c.EuiDescriptionListDescription,{className:"eui-textNoWrap"},e.content)):e.content)})))},W=()=>{var e;const{params:{policyId:t,tabId:a=""}}=Object(r.useRouteMatch)(),{getHref:i}=Object(o.Nb)(),s=Object(o.Bb)(t),g=s.data?s.data.item:null,{isLoading:m,error:p,sendRequest:E}=s,f=new URLSearchParams(Object(r.useLocation)().search),b="true"===f.get("openEnrollmentFlyout"),h="true"===f.get("showAddAgentHelp"),[x]=Object(n.useState)(!1),[k,M]=Object(n.useState)(b),[F,S]=Object(n.useState)(h),I=function(e,t){const a=Object(o.Rb)({path:O.d.getStatusPath(),query:{policyId:e},method:"get"});return{isLoading:a.isLoading,data:a.data,error:a.error,refreshAgentStatus:()=>a.resendRequest}}(t),{refreshAgentStatus:w}=I,{application:{navigateToApp:T}}=Object(o.Tb)(),j=Object(o.Jb)(),A=null===(e=I.data)||void 0===e?void 0:e.results,{isReady:P}=Object(o.tb)(),L=Object(n.useMemo)((()=>{if(j&&j.onDoneNavigateTo&&P){const[e,t]=j.onDoneNavigateTo;return()=>T(e,t)}}),[P,T,j]),D=Object(n.useCallback)((()=>{S(!1),M(!0)}),[]),_=Object(n.useMemo)((()=>[{id:"integrations",name:d.i18n.translate("xpack.fleet.policyDetails.subTabs.packagePoliciesTabText",{defaultMessage:"Integrations"}),href:i("policy_details",{policyId:t,tabId:"integrations"}),isSelected:""===a||"integrations"===a},{id:"settings",name:d.i18n.translate("xpack.fleet.policyDetails.subTabs.settingsTabText",{defaultMessage:"Settings"}),href:i("policy_details",{policyId:t,tabId:"settings"}),isSelected:"settings"===a}]),[i,t,a]),B=Object(n.useMemo)((()=>x?l.a.createElement(r.Redirect,{to:"/"}):m?l.a.createElement(y.p,null):p?l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:p}):g?l.a.createElement(l.a.Fragment,null,k&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.c,{agentPolicy:g,onClose:L||(()=>M(!1))})),l.a.createElement($,{agentPolicy:g})):l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:d.i18n.translate("xpack.fleet.policyDetails.policyNotFoundErrorTitle",{defaultMessage:"Policy '{id}' not found",values:{id:t}})})),[x,m,p,g,k,L,t]),N=l.a.createElement(q,{agentPolicy:g,policyId:t,isLoading:m}),R=l.a.createElement(G,{agentPolicy:g,agentStatus:A,policyId:t,onCancelEnrollment:L,isLoading:m,isAddAgentHelpPopoverOpen:F,setIsAddAgentHelpPopoverOpen:S,addAgent:D});return l.a.createElement(o.a.Provider,{value:{refresh:E}},l.a.createElement(C.Provider,{value:{refresh:w}},l.a.createElement(v.c,{leftColumn:N,rightColumn:R,tabs:_},B)))},$=({agentPolicy:e})=>(Object(o.ob)("policy_details",{policyName:e.name}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:x.g.policy_details_settings,render:()=>l.a.createElement(H,{agentPolicy:e})}),l.a.createElement(r.Route,{path:x.g.policy_details,render:()=>l.a.createElement(N,{agentPolicy:e})})));var V=a(151);const K=Object(n.memo)((()=>{const{params:{packagePolicyId:e}}=Object(r.useRouteMatch)(),{search:t}=Object(r.useLocation)(),a=new URLSearchParams(t).get("from");let n;return a&&"fleet-policy-list"===a?n="upgrade-from-fleet-policy-list":a&&"integrations-policy-list"===a&&(n="upgrade-from-integrations-policy-list"),l.a.createElement(V.a,{packagePolicyId:e,from:n,forceUpgrade:!0})})),Y=()=>{Object(o.ob)("policies");const e=Object(r.useHistory)();return l.a.createElement(r.Router,{history:e},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:x.g.edit_integration},l.a.createElement(V.b,null)),l.a.createElement(r.Route,{path:x.g.upgrade_package_policy},l.a.createElement(K,null)),l.a.createElement(r.Route,{path:x.g.policy_details},l.a.createElement(W,null)),l.a.createElement(r.Route,{path:x.g.policies_list},l.a.createElement(v.a,{section:"agent_policies"},l.a.createElement(j,null)))))};var Q=a(56);const J=Object(n.memo)((({datastream:e})=>{const{dashboards:t}=e,a=l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardActionText",defaultMessage:"View dashboard"}),n=l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardsActionText",defaultMessage:"View dashboards"}),i=d.i18n.translate("xpack.fleet.dataStreamList.viewDashboardsPanelTitle",{defaultMessage:"View dashboards"}),s=d.i18n.translate("xpack.fleet.dataStreamList.viewInApmActionText",{defaultMessage:"View in APM"}),{isSuccessful:r,href:c}=Object(Q.a)(e);if(r&&c){const e=[{id:0,items:[{icon:"apmApp",href:c,name:s}]}];return l.a.createElement(y.g,{panels:e})}if(!t||0===t.length){const e=[{id:0,items:[{icon:"dashboardApp",disabled:!0,name:a}]}];return l.a.createElement(y.g,{panels:e})}if(1===t.length){const e=[{id:0,items:[{icon:"dashboardApp",href:Object(o.Kb)(`/dashboard/${t[0].id||""}`),name:a}]}];return l.a.createElement(y.g,{panels:e})}const g=[{id:0,items:[{icon:"dashboardApp",panel:1,name:n}]},{id:1,title:i,items:t.map((e=>({icon:"dashboardApp",href:Object(o.Kb)(`/dashboard/${e.id||""}`),name:e.title})))}];return l.a.createElement(y.g,{panels:g})})),Z=()=>{Object(o.ob)("data_streams");const{pagination:e,pageSizeOptions:t}=Object(o.Pb)(),{isLoading:a,data:i,resendRequest:s}=Object(o.wb)(),r=Object(n.useMemo)((()=>[{field:"dataset",sortable:!0,width:"25%",name:d.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"})},{field:"type",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"})},{field:"namespace",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?l.a.createElement(c.EuiBadge,{color:"hollow"},e):""},{field:"package",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),render:(e,t)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},t.package_version&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.r,{packageName:e,version:t.package_version,size:"m",tryApi:!0})),l.a.createElement(c.EuiFlexItem,{grow:!1},e))},{field:"last_activity_ms",sortable:!0,width:"25%",dataType:"date",name:d.i18n.translate("xpack.fleet.dataStreamList.lastActivityColumnTitle",{defaultMessage:"Last activity"}),render:e=>l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedDate,{value:e,year:"numeric",month:"short",day:"numeric"}),l.a.createElement(l.a.Fragment,null," @ "),l.a.createElement(u.FormattedTime,{value:e,hour:"numeric",minute:"numeric",second:"numeric"}))},{field:"size_in_bytes",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.sizeColumnTitle",{defaultMessage:"Size"}),render:(e,t)=>l.a.createElement(l.a.Fragment,null,t.size_in_bytes_formatted)},{name:d.i18n.translate("xpack.fleet.dataStreamList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>l.a.createElement(J,{datastream:e})}]}]),[]),g=Object(n.useMemo)((()=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.noDataStreamsPrompt",defaultMessage:"No data streams"}))})),[]),m={dataset:[],type:[],namespace:[],package:[]};if(i&&i.data_streams.length){const e={dataset:[],type:[],namespace:[],package:[]};i.data_streams.forEach((t=>{const{dataset:a,type:n,namespace:l,package:i}=t;e.dataset.includes(a)||e.dataset.push(a),e.type.includes(n)||e.type.push(n),e.namespace.includes(l)||e.namespace.push(l),e.package.includes(i)||e.package.push(i)}));for(const t in e)m[t]&&(m[t]=e[t].sort().map((e=>({value:e,name:e}))))}return l.a.createElement(c.EuiInMemoryTable,{loading:a,hasActions:!0,tableLayout:"auto",message:a?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.loadingDataStreamsMessage",defaultMessage:"Loading data streams…"}):i&&!i.data_streams.length?g:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.noFilteredDataStreamsMessage",defaultMessage:"No matching data streams found"}),items:i?i.data_streams:[],itemId:"index",columns:r,pagination:{initialPageSize:e.pageSize,pageSizeOptions:t},sorting:!0,search:{toolsRight:[l.a.createElement(c.EuiButton,{key:"reloadButton",color:"primary",iconType:"refresh",onClick:()=>s()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.reloadDataStreamsButtonText",defaultMessage:"Reload"}))],box:{placeholder:d.i18n.translate("xpack.fleet.dataStreamList.searchPlaceholderTitle",{defaultMessage:"Filter data streams"}),incremental:!0},filters:[{type:"field_value_selection",field:"dataset",name:d.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"}),multiSelect:"or",operator:"exact",options:m.dataset},{type:"field_value_selection",field:"type",name:d.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"}),multiSelect:"or",operator:"exact",options:m.type},{type:"field_value_selection",field:"namespace",name:d.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),multiSelect:"or",operator:"exact",options:m.namespace},{type:"field_value_selection",field:"package",name:d.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),multiSelect:"or",operator:"exact",options:m.package}]}})},X=()=>{const e=Object(r.useHistory)();return l.a.createElement(r.Router,{history:e},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:x.g.data_streams},l.a.createElement(v.a,{section:"data_streams"},l.a.createElement(Z,null)))))};var ee=a(111),te=a(156);const ae=({onClose:e,agents:t,agentCount:a})=>{const{notifications:i}=Object(o.Tb)(),[s,g]=Object(n.useState)(!1),m=Array.isArray(t)&&1===t.length,{getPath:p}=Object(o.Nb)(),E=Object(r.useHistory)();return l.a.createElement(c.EuiConfirmModal,{"data-test-subj":"requestDiagnosticsModal",title:m?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.singleTitle",defaultMessage:"Request diagnostics"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.multipleTitle",defaultMessage:"Request diagnostics for {count} agents",values:{count:a}}),onCancel:e,onConfirm:async function(){try{g(!0);const{error:a}=m?await Object(o.Y)(t[0].id):await Object(o.S)({agents:"string"==typeof t?t:t.map((e=>e.id))});if(a)throw a;g(!1);const n=d.i18n.translate("xpack.fleet.requestDiagnostics.successSingleNotificationTitle",{defaultMessage:"Request diagnostics submitted"});if(i.toasts.addSuccess(n),m){const e=p("agent_details_diagnostics",{agentId:t[0].id});E.push(e)}e()}catch(e){g(!1),i.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.requestDiagnostics.fatalErrorNotificationTitle",{defaultMessage:"Error requesting diagnostics {count, plural, one {agent} other {agents}}",values:{count:a}})})}},cancelButtonText:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonDisabled:s,confirmButtonText:m?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.confirmSingleButtonLabel",defaultMessage:"Request diagnostics"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.confirmMultipleButtonLabel",defaultMessage:"Request diagnostics for {count} agents",values:{count:a}}),buttonColor:"primary"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.description",defaultMessage:"Diagnostics files are stored in Elasticsearch, and as such can incur storage costs. Fleet will automatically remove old diagnostics files after 30 days."})))};var ne=a(79);const le=Object(c.euiPaletteColorBlindBehindText)(),ie={default:ne.euiLightVars.euiColorLightShade,primary:le[1],success:le[0],accent:le[2],warning:le[5],danger:le[9],inactive:ne.euiLightVars.euiColorDarkShade},se=["healthy","unhealthy","updating","offline","inactive"];function re(e){switch(e){case"healthy":return ie.success;case"offline":return ie.default;case"inactive":return ie.inactive;case"unhealthy":return ie.warning;case"updating":return ie.primary;default:throw new Error(`Insuported Agent status ${e}`)}}const oe=m()(c.EuiColorPaletteDisplay).withConfig({displayName:"StyledEuiColorPaletteDisplay",componentId:"sc-147tmhq-0"})(["&.ingest-agent-status-bar{border:none;border-radius:0;&:after{border:none;}}"]),ce=({agentStatus:e})=>{const t=Object(n.useMemo)((()=>se.reduce(((t,a)=>{const n=t.length>0?t[t.length-1].stop:0;return t.push({stop:n+(e[a]||0),color:re(a)}),t}),[])),[e]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(oe,{className:"ingest-agent-status-bar",size:"s",palette:t}))},ue=m.a.div.withConfig({displayName:"Divider",componentId:"sc-1tjpa1k-0"})(["width:0;height:",";border-left:",";"],(e=>e.theme.eui.euiSizeL),(e=>e.theme.eui.euiBorderThin)),de=m()(c.EuiFlexItem).withConfig({displayName:"FlexItem",componentId:"sc-1tjpa1k-1"})(["height:",";"],(e=>e.theme.eui.euiSizeL)),ge=m()(c.EuiButtonEmpty).withConfig({displayName:"Button",componentId:"sc-1tjpa1k-2"})([".euiButtonEmpty__text{font-size:",";}"],(e=>e.theme.eui.euiFontSizeXS)),me=({totalAgents:e,selectableAgents:t,selectionMode:a,setSelectionMode:n,selectedAgents:i,setSelectedAgents:s})=>{const r="manual"===a&&i.length===t&&t<e;return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{size:"xs",color:"subdued"},e>x.n?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgentsWithLimit",defaultMessage:"Showing {count} of {total} agents",values:{count:l.a.createElement(u.FormattedNumber,{value:x.n}),total:l.a.createElement(u.FormattedNumber,{value:e})}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgents",defaultMessage:"Showing {count, plural, one {# agent} other {# agents}}",values:{count:e}}))),"manual"===a&&i.length||"query"===a&&e>0?l.a.createElement(l.a.Fragment,null,l.a.createElement(de,{grow:!1},l.a.createElement(ue,null)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{size:"xs",color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.agentsSelected",defaultMessage:"{count, plural, one {# agent} other {# agents} =all {All agents}} selected",values:{count:"manual"===a?i.length:"all"}}))),r?l.a.createElement(l.a.Fragment,null,l.a.createElement(de,{grow:!1},l.a.createElement(ue,null)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ge,{size:"xs",flush:"left",onClick:()=>n("query")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.selectAll",defaultMessage:"Select everything on all pages"})))):null,l.a.createElement(de,{grow:!1},l.a.createElement(ue,null)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ge,{size:"xs",flush:"left",onClick:()=>{n("manual"),s([])}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.clearSelection",defaultMessage:"Clear selection"})))):l.a.createElement(de,{grow:!1})))},pe=Object(n.memo)((({agentStatus:e,showInactive:t})=>{const a=Object(n.useMemo)((()=>se.filter((e=>!!t||"inactive"!==e))),[t]);return l.a.createElement(c.EuiFlexGroup,{gutterSize:"m"},a.map((t=>l.a.createElement(c.EuiFlexItem,{key:t,grow:!1},l.a.createElement(Ee,{status:t,count:e[t]||0})))))})),Ee=Object(n.memo)((({status:e,count:t})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiHealth,{color:re(e)},l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},function(e){switch(e){case"healthy":return d.i18n.translate("xpack.fleet.agentStatus.healthyLabel",{defaultMessage:"Healthy"});case"offline":return d.i18n.translate("xpack.fleet.agentStatus.offlineLabel",{defaultMessage:"Offline"});case"inactive":return d.i18n.translate("xpack.fleet.agentStatus.inactiveLabel",{defaultMessage:"Inactive"});case"unhealthy":return d.i18n.translate("xpack.fleet.agentStatus.unhealthyLabel",{defaultMessage:"Unhealthy"});case"updating":return d.i18n.translate("xpack.fleet.agentStatus.updatingLabel",{defaultMessage:"Updating"});default:throw new Error(`Insuported Agent status ${e}`)}}(e)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiNotificationBadge,{size:"s",color:"subdued"},t))))))),fe=({agentStatus:e,totalAgents:t,selectableAgents:a,selectionMode:n,setSelectionMode:i,selectedAgents:s,setSelectedAgents:r,showInactive:o})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(me,{totalAgents:t,selectableAgents:a,selectionMode:n,setSelectionMode:i,selectedAgents:s,setSelectedAgents:r})),l.a.createElement(c.EuiFlexItem,{grow:!1},e&&l.a.createElement(pe,{showInactive:o,agentStatus:e}))),l.a.createElement(c.EuiSpacer,{size:"s"}),e&&l.a.createElement(ce,{agentStatus:e}));function be(e){return e.length>20?`${e.substring(0,20)}...`:e}function he(e){return e.replace(/[^a-zA-Z0-9 \-_]/g,"").slice(0,20)}const ye=()=>{const{notifications:e}=Object(o.Tb)(),t=Object(n.useCallback)((async(t,a,n,l)=>{try{const l=await t();if(l.error)throw l.error;const i=!l.data.actionId,s=null!=n?n:d.i18n.translate("xpack.fleet.updateAgentTags.successNotificationTitle",{defaultMessage:"Tag(s) updated"});e.toasts.addSuccess(s),a(i)}catch(t){const a=null!=l?l:d.i18n.translate("xpack.fleet.updateAgentTags.errorNotificationTitle",{defaultMessage:"Tag(s) update failed"});e.toasts.addError(t,{title:a})}}),[e.toasts]);return{updateTags:Object(n.useCallback)((async(e,a,n,l,i)=>{await t((async()=>await Object(o.ab)(e,{tags:a})),n,l,i)}),[t]),bulkUpdateTags:Object(n.useCallback)((async(e,a,n,l,i,s)=>{await t((async()=>await Object(o.P)({agents:e,tagsToAdd:a,tagsToRemove:n})),l,i,s)}),[t])}},xe=({tagName:e,isTagHovered:t,onTagsUpdated:a})=>{const[i,s]=Object(n.useState)(!1),[r,o]=Object(n.useState)(),[g,m]=Object(n.useState)(t),[p,E]=Object(n.useState)(e);Object(n.useEffect)((()=>{m(t||i)}),[t,i]),Object(n.useEffect)((()=>{E(e)}),[e]);const f=(e=!1)=>{s(!1),e?v():x(p)},b=ye(),h=b.bulkUpdateTags,y='tags:"{name}"',x=t=>{if(t===e||!t)return;const n=y.replace("{name}",e);h(n,[t],[e],(n=>a([t],[e],n)),d.i18n.translate("xpack.fleet.renameAgentTags.successNotificationTitle",{defaultMessage:"Tag renamed"}),d.i18n.translate("xpack.fleet.renameAgentTags.errorNotificationTitle",{defaultMessage:"Tag rename failed"}))},v=()=>{const t=y.replace("{name}",e);b.bulkUpdateTags(t,[],[e],(t=>a([],[e],t)),d.i18n.translate("xpack.fleet.deleteAgentTags.successNotificationTitle",{defaultMessage:"Tag deleted"}),d.i18n.translate("xpack.fleet.deleteAgentTags.errorNotificationTitle",{defaultMessage:"Tag delete failed"}))};return l.a.createElement(l.a.Fragment,null,g&&l.a.createElement(c.EuiButtonIcon,{iconType:"boxesHorizontal","aria-label":d.i18n.translate("xpack.fleet.tagOptions.tagOptionsToggleButtonLabel",{defaultMessage:"Tag Options"}),color:"text",onClick:e=>{o(e.currentTarget),s(!i)}}),i&&l.a.createElement(c.EuiWrappingPopover,{isOpen:!0,button:r,closePopover:f,anchorPosition:"downCenter"},l.a.createElement(c.EuiFlexGroup,{direction:"column",alignItems:"flexStart",gutterSize:"xs"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFieldText,{placeholder:d.i18n.translate("xpack.fleet.tagOptions.nameTextFieldPlaceholder",{defaultMessage:"Enter new name for tag"}),value:p,required:!0,onKeyDown:e=>{"Enter"===e.key&&f()},onChange:e=>{const t=e.currentTarget.value;E(he(t))}})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButtonEmpty,{size:"s",color:"danger",onClick:()=>{f(!0)}},l.a.createElement(c.EuiIcon,{type:"trash"})," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.tagOptions.deleteText",defaultMessage:"Delete tag"}))))))},ve=m()(c.EuiHighlight).withConfig({displayName:"TruncatedEuiHighlight",componentId:"sc-2x3rq-0"})(["width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"]),ke=({agentId:e,agents:t,allTags:a,selectedTags:i,button:s,onTagsUpdated:r,onClosePopover:o})=>{const g=Object(n.useCallback)(((e,t)=>e.map((e=>({label:e,checked:t.includes(e)?"on":void 0,onFocusBadge:!1})))),[]),[m,p]=Object(n.useState)(g(a,i)),[E,f]=Object(n.useState)(void 0),[b,h]=Object(n.useState)(!0),[y,x]=Object(n.useState)({}),v=ye();Object(n.useEffect)((()=>{p(g(a,i))}),[a,g,i]);const k=Object(n.useMemo)((()=>m.some((e=>e.label===E))),[m,E]),M=(e,t,n=!0,l=!1)=>{if(n)return r();const i=m.filter((e=>"on"===e.checked)).map((e=>e.label)),s=Object(R.difference)(i,t).concat(e),o=Object(R.uniq)(a.concat(s)),c=l?Object(R.difference)(o,t):o;p(g(c,s))},F=async(a,n,l,s)=>{if(e){const t=Object(R.difference)(i,n).concat(a);v.updateTags(e,t,(()=>r()),l,s)}else v.bulkUpdateTags(t,a,n,(e=>M(a,n,e)),l,s)},S=l.a.createElement(c.EuiButtonEmpty,{color:"text","data-test-subj":"createTagBtn",onClick:()=>{E&&F([E],[],d.i18n.translate("xpack.fleet.createAgentTags.successNotificationTitle",{defaultMessage:"Tag created"}),d.i18n.translate("xpack.fleet.createAgentTags.errorNotificationTitle",{defaultMessage:"Tag creation failed"}))}},l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIcon,{type:"plus"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.tagsAddRemove.createText",defaultMessage:'Create a new tag "{name}"',values:{name:E}}))));return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiWrappingPopover,{isOpen:b,button:s,closePopover:()=>{h(!1),o()},anchorPosition:"leftUp"},l.a.createElement(c.EuiSelectable,{onFocus:()=>{},"aria-label":d.i18n.translate("xpack.fleet.tagsAddRemove.selectableTagsLabel",{defaultMessage:"Add / remove tags"}),searchable:!0,searchProps:{"data-test-subj":"addRemoveTags",placeholder:d.i18n.translate("xpack.fleet.tagsAddRemove.findOrCreatePlaceholder",{defaultMessage:"Find or create tag..."}),onChange:e=>{f(he(e))},value:null!=E?E:""},options:m,renderOption:(e,t)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",onMouseEnter:()=>x({...y,[e.label]:!0}),onMouseLeave:()=>x({...y,[e.label]:!1})},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(ve,{search:t,onClick:()=>{const t="on"===e.checked?[]:[e.label],a="on"===e.checked?[e.label]:[];F(t,a)}},e.label)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(xe,{tagName:e.label,isTagHovered:y[e.label],onTagsUpdated:(e,t,a)=>M(e,t,a,!0)})))},((e,t)=>l.a.createElement(n.Fragment,null,t,e))),k&&0!==m.length||""===E?null:S))},Me=({totalAgents:e,totalInactiveAgents:t,selectionMode:a,currentQuery:i,selectedAgents:s,visibleAgents:r,refreshAgents:d,allTags:g,agentPolicies:m})=>{const p=Object(o.Mb)().hasAtLeast(S.P),[E,f]=Object(n.useState)(!1),b=()=>f(!1),[h,y]=Object(n.useState)(!1),[x,v]=Object(n.useState)(!1),[k,M]=Object(n.useState)({isOpen:!1,isScheduled:!1}),[F,I]=Object(n.useState)(!1),[w,T]=Object(n.useState)(!1),j="manual"===a?!!s.find((e=>e.active)):e>t,C=e-t,A="manual"===a?s.length:C,P="manual"===a?s:i,[L,D]=Object(n.useState)(),{diagnosticFileUploadEnabled:_}=O.b.get(),B=[{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.addRemoveTags","data-test-subj":"agentBulkActionsAddRemoveTags",defaultMessage:"Add / remove tags"}),icon:l.a.createElement(c.EuiIcon,{type:"tag",size:"m"}),disabled:!j,onClick:e=>{D(e.target.closest("button")),I(!F)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.reassignPolicy","data-test-subj":"agentBulkActionsReassign",defaultMessage:"Assign to new policy"}),icon:l.a.createElement(c.EuiIcon,{type:"pencil",size:"m"}),disabled:!j,onClick:()=>{b(),y(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.unenrollAgents","data-test-subj":"agentBulkActionsUnenroll",defaultMessage:"Unenroll {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:A}}),icon:l.a.createElement(c.EuiIcon,{type:"trash",size:"m"}),disabled:!j,onClick:()=>{b(),v(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.upgradeAgents","data-test-subj":"agentBulkActionsUpgrade",defaultMessage:"Upgrade {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:A}}),icon:l.a.createElement(c.EuiIcon,{type:"refresh",size:"m"}),disabled:!j,onClick:()=>{b(),M({isOpen:!0,isScheduled:!1})}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.scheduleUpgradeAgents","data-test-subj":"agentBulkActionsScheduleUpgrade",defaultMessage:"Schedule upgrade for {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:A}}),icon:l.a.createElement(c.EuiIcon,{type:"timeRefresh",size:"m"}),disabled:!j||!p,onClick:()=>{b(),M({isOpen:!0,isScheduled:!0})}}];_&&B.push({name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.requestDiagnostics","data-test-subj":"agentBulkActionsRequestDiagnostics",defaultMessage:"Request diagnostics for {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:A}}),icon:l.a.createElement(c.EuiIcon,{type:"trash",size:"m"}),disabled:!j,onClick:()=>{b(),T(!0)}});const N=[{id:0,items:B}],z=Object(n.useMemo)((()=>((e,t,a)=>{const n=e=>e.reduce(((e,t)=>{var n,l;return(e=>{const t=a.find((t=>t.id===e.policy_id));return!!t&&t.is_managed})(t)?e:e.length<1?null!==(l=t.tags)&&void 0!==l?l:[]:Object(R.intersection)(null!==(n=t.tags)&&void 0!==n?n:[],e)}),[]);return Array.isArray(e)?n(t.length>0?t.filter((t=>e.find((e=>e.id===t.id)))):e):n(t)})(P,null!=r?r:[],m)),[P,r,m]);return l.a.createElement(l.a.Fragment,null,h&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee.c,{agents:P,onClose:()=>{y(!1),d()}})),x&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee.d,{agents:P,agentCount:A,onClose:()=>{v(!1),d({refreshTags:!0})}})),k.isOpen&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee.e,{agents:P,agentCount:A,isScheduled:k.isScheduled,onClose:()=>{M({isOpen:!1,isScheduled:!1}),d()}})),F&&l.a.createElement(ke,{agents:Array.isArray(P)?P.map((e=>e.id)):P,allTags:null!=g?g:[],selectedTags:z,button:L,onTagsUpdated:()=>{d({refreshTags:!0})},onClosePopover:()=>{I(!1),b()}}),w&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ae,{agents:P,agentCount:A,onClose:()=>{T(!1)}})),l.a.createElement(c.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiPopover,{id:"agentBulkActionsMenu",button:l.a.createElement(c.EuiButton,{fill:!0,iconType:"arrowDown",iconSide:"right",onClick:()=>f(!E),"data-test-subj":"agentBulkActionsButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.actions",defaultMessage:"Actions"})),isOpen:E,closePopover:b,panelPaddingSize:"none",anchorPosition:"downLeft"},l.a.createElement(c.EuiContextMenu,{initialPanelId:0,panels:N})))))},Fe=({onClickAgentActivity:e,showAgentActivityTour:t})=>{const{uiSettings:a}=Object(o.Tb)(),[i,s]=Object(n.useState)(t),r=a.get("hideAgentActivityTour",!1);Object(n.useEffect)((()=>{s(t)}),[t,s]);const d=()=>{s({isOpen:!1}),a.set("hideAgentActivityTour",!0)};return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTourStep,{content:l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityButton.tourContent",defaultMessage:"Review in progress, completed, and scheduled agent action activity history here anytime."})),isStepOpen:!r&&i.isOpen,onFinish:d,minWidth:360,maxWidth:360,step:1,stepsTotal:1,title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityButton.tourTitle",defaultMessage:"Agent activity history"}),anchorPosition:"upCenter",footerAction:l.a.createElement(c.EuiButtonEmpty,{onClick:d},"OK"),anchor:"#agentActivityButton"}),l.a.createElement(c.EuiButtonEmpty,{onClick:()=>{e(),s({isOpen:!1})},"data-test-subj":"agentActivityButton",iconType:"clock",id:"agentActivityButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.agentActivityButton",defaultMessage:"Agent activity"})))},Se=[{status:"healthy",label:d.i18n.translate("xpack.fleet.agentList.statusHealthyFilterText",{defaultMessage:"Healthy"})},{status:"unhealthy",label:d.i18n.translate("xpack.fleet.agentList.statusUnhealthyFilterText",{defaultMessage:"Unhealthy"})},{status:"updating",label:d.i18n.translate("xpack.fleet.agentList.statusUpdatingFilterText",{defaultMessage:"Updating"})},{status:"offline",label:d.i18n.translate("xpack.fleet.agentList.statusOfflineFilterText",{defaultMessage:"Offline"})},{status:"inactive",label:d.i18n.translate("xpack.fleet.agentList.statusInactiveFilterText",{defaultMessage:"Inactive"})}],Ie=m()(c.EuiFilterSelectItem).withConfig({displayName:"ClearAllTagsFilterItem",componentId:"sc-1j1p1r8-0"})(["padding:",";"],(e=>e.theme.eui.euiSizeS)),Oe=m()(c.EuiFlexItem).withConfig({displayName:"FlexEndEuiFlexItem",componentId:"sc-1j1p1r8-1"})(["align-self:flex-end;"]),we=({agentPolicies:e,draftKuery:t,onDraftKueryChange:a,onSubmitSearch:i,selectedAgentPolicies:s,onSelectedAgentPoliciesChange:r,selectedStatus:o,onSelectedStatusChange:d,showUpgradeable:g,onShowUpgradeableChange:m,tags:p,selectedTags:E,onSelectedTagsChange:f,totalAgents:b,totalInactiveAgents:h,selectionMode:v,currentQuery:k,selectedAgents:M,refreshAgents:F,onClickAddAgent:S,onClickAddFleetServer:I,visibleAgents:O,onClickAgentActivity:w,showAgentActivityTour:T})=>{const[j,C]=Object(n.useState)(!1),[A,P]=Object(n.useState)(!1),[L,D]=Object(n.useState)(!1);return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{direction:"column"},l.a.createElement(Oe,null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Fe,{onClickAgentActivity:w,showAgentActivityTour:T})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiToolTip,{content:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addFleetServerButton.tooltip",defaultMessage:"Fleet Server is a component of the Elastic Stack used to centrally manage Elastic Agents"})},l.a.createElement(c.EuiButton,{onClick:I,"data-test-subj":"addFleetServerButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addFleetServerButton",defaultMessage:"Add Fleet Server"})))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiToolTip,{content:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addAgentButton.tooltip",defaultMessage:"Add Elastic Agents to your hosts to collect data and send it to the Elastic Stack"})},l.a.createElement(c.EuiButton,{fill:!0,onClick:S,"data-test-subj":"addAgentButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})))))),l.a.createElement(c.EuiFlexItem,{grow:4},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:6},l.a.createElement(y.u,{value:t,onChange:(e,t)=>{a(e),t&&i(e)},indexPattern:x.a,dataTestSubj:"agentList.queryInput"})),l.a.createElement(c.EuiFlexItem,{grow:2},l.a.createElement(c.EuiFilterGroup,null,l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>P(!A),isSelected:A,hasActiveFilters:o.length>0,disabled:0===e.length,"data-test-subj":"agentList.statusFilter"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.statusFilterText",defaultMessage:"Status"})),isOpen:A,closePopover:()=>P(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},Se.map((({label:e,status:t},a)=>l.a.createElement(c.EuiFilterSelectItem,{key:a,checked:o.includes(t)?"on":void 0,onClick:()=>{o.includes(t)?d([...o.filter((e=>e!==t))]):d([...o,t])}},e))))),l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>D(!L),isSelected:L,hasActiveFilters:E.length>0,numActiveFilters:E.length,numFilters:p.length,disabled:0===p.length,"data-test-subj":"agentList.tagsFilter"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.tagsFilterText",defaultMessage:"Tags"})),isOpen:L,closePopover:()=>D(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},l.a.createElement(l.a.Fragment,null,p.map(((e,t)=>l.a.createElement(c.EuiFilterSelectItem,{checked:E.includes(e)?"on":void 0,key:t,onClick:()=>{E.includes(e)?(e=>{f(E.filter((t=>t!==e)))})(e):(e=>{f([...E,e])})(e)}},e.length>20?l.a.createElement(c.EuiToolTip,{content:e},l.a.createElement("span",null,be(e))):e))),l.a.createElement(c.EuiHorizontalRule,{margin:"none"}),l.a.createElement(Ie,{showIcons:!1,onClick:()=>{f([])}},l.a.createElement(c.EuiFlexGroup,{alignItems:"center",justifyContent:"center",gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIcon,{type:"crossInACircleFilled",color:"danger",size:"s"})),l.a.createElement(c.EuiFlexItem,{grow:!1},"Clear all")))))),l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>C(!j),isSelected:j,hasActiveFilters:s.length>0,numActiveFilters:s.length,numFilters:e.length,disabled:0===e.length,"data-test-subj":"agentList.policyFilter"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.policyFilterText",defaultMessage:"Agent policy"})),isOpen:j,closePopover:()=>C(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},e.map(((e,t)=>l.a.createElement(c.EuiFilterSelectItem,{checked:s.includes(e.id)?"on":void 0,key:t,onClick:()=>{var t;s.includes(e.id)?(t=e.id,r(s.filter((e=>e!==t)))):(e=>{r([...s,e])})(e.id)}},e.name))))),l.a.createElement(c.EuiFilterButton,{hasActiveFilters:g,onClick:()=>{m(!g)},"data-test-subj":"agentList.showUpgradeable"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.showUpgradeableFilterLabel",defaultMessage:"Upgrade available"})))),"manual"===v&&M.length||"query"===v&&b>0?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Me,{totalAgents:b,totalInactiveAgents:h,selectionMode:v,currentQuery:k,selectedAgents:M,visibleAgents:O,refreshAgents:F,allTags:p,agentPolicies:e})):null))))},Te=m.a.div.withConfig({displayName:"Wrapped",componentId:"sc-nqotp2-0"})([".wrappedText{white-space:pre-wrap;}"]),je=({tags:e})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(Te,null,l.a.createElement(c.EuiToolTip,{anchorClassName:"wrappedText",content:l.a.createElement("span",{"data-test-subj":"agentTagsTooltip"},e.join(", "))},l.a.createElement("span",{"data-test-subj":"agentTags"},Object(R.take)(e,3).map(be).join(", "),e.length>3?` + ${e.length-3} more`:"")))),Ce=({agent:e,agentPolicy:t,onReassignClick:a,onUnenrollClick:i,onUpgradeClick:s,onAddRemoveTagsClick:r,onRequestDiagnosticsClick:d})=>{const{getHref:g}=Object(o.Nb)(),m=Object(o.nb)().fleet.all,p="unenrolling"===e.status,E=Object(o.Lb)(),[f,b]=Object(n.useState)(!1),{diagnosticFileUploadEnabled:h}=O.b.get(),x=[l.a.createElement(c.EuiContextMenuItem,{icon:"inspect",href:g("agent_details",{agentId:e.id}),key:"viewAgent"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.viewActionText",defaultMessage:"View agent"}))];return!1===(null==t?void 0:t.is_managed)&&(x.push(l.a.createElement(c.EuiContextMenuItem,{icon:"tag",onClick:e=>{r(e.target.closest("button"))},disabled:!e.active,key:"addRemoveTags"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addRemoveTagsActionText",defaultMessage:"Add / remove tags"})),l.a.createElement(c.EuiContextMenuItem,{icon:"pencil",onClick:()=>{a()},disabled:!e.active,key:"reassignPolicy"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),l.a.createElement(c.EuiContextMenuItem,{disabled:!m||!e.active,icon:"trash",onClick:()=>{i()}},p?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),l.a.createElement(c.EuiContextMenuItem,{icon:"refresh",disabled:!Object(O.l)(e,E),onClick:()=>{s()}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))),h&&x.push(l.a.createElement(c.EuiContextMenuItem,{icon:"download",disabled:!m,onClick:()=>{d()}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.diagnosticsOneButton",defaultMessage:"Request diagnostics .zip"})))),l.a.createElement(y.g,{isOpen:f,onChange:e=>b(e),items:x})},Ae=({hasFleetAllPrivileges:e,setEnrollmentFlyoutState:t})=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.noAgentsPrompt",defaultMessage:"No agents enrolled"})),actions:e?l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>t({isOpen:!0})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})):null}),Pe=()=>(new Date).toISOString().substring(0,10),Le=m()(c.EuiFlyoutBody).withConfig({displayName:"FullHeightFlyoutBody",componentId:"sc-1toqsy-0"})([".euiFlyoutBody__overflowContent{height:100%;}"]),De=m()(c.EuiFlyoutFooter).withConfig({displayName:"FlyoutFooterWPadding",componentId:"sc-1toqsy-1"})(["padding:16px 24px !important;"]),_e=({onClose:e,onAbortSuccess:t,refreshAgentActivity:a})=>{const{data:i}=Object(o.vb)({perPage:x.n}),{currentActions:s,abortUpgrade:r,isFirstLoading:g}=function(e,t){const[a,l]=Object(n.useState)([]),[i,s]=Object(n.useState)(!0),{notifications:r,overlays:c}=Object(o.Tb)(),u=Object(n.useCallback)((async()=>{try{const e=await Object(o.t)();if(s(!1),e.error)throw e.error;if(!e.data)throw new Error("No data");l(e.data.items)}catch(e){r.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.actionStatus.fetchRequestError",{defaultMessage:"An error happened while fetching action status"})})}}),[r.toasts]);i&&u(),Object(n.useEffect)((()=>{t&&u()}),[u,t]);const g=Object(n.useCallback)((async t=>{try{if(!await c.openConfirm(d.i18n.translate("xpack.fleet.currentUpgrade.confirmDescription",{defaultMessage:"This action will abort upgrade of {nbAgents, plural, one {# agent} other {# agents}}",values:{nbAgents:t.nbAgentsActioned-t.nbAgentsAck}}),{title:d.i18n.translate("xpack.fleet.currentUpgrade.confirmTitle",{defaultMessage:"Abort upgrade?"})}))return;await Object(o.T)(t.actionId),await Promise.all([u(),e()])}catch(e){r.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.currentUpgrade.abortRequestError",{defaultMessage:"An error happened while aborting upgrade"})})}}),[u,r.toasts,c,e]);return{currentActions:a,refreshActions:u,abortUpgrade:g,isFirstLoading:i}}(t,a),m=e=>{var t;const a=null==i?void 0:i.items.find((t=>t.id===e));return null!==(t=null==a?void 0:a.name)&&void 0!==t?t:e},p=s.map((e=>{var t;return{...e,newPolicyId:m(null!==(t=e.newPolicyId)&&void 0!==t?t:"")}})),E=p.filter((e=>"IN_PROGRESS"===e.status)),f=p.filter((e=>"IN_PROGRESS"!==e.status)),b=f.filter((e=>e.creationTime.startsWith(Pe()))),h=function(e){const t={};return e.filter((e=>!e.creationTime.startsWith(Pe()))).forEach((e=>{const a=e.creationTime.substring(0,10);t[a]||(t[a]=[]),t[a].push(e)})),t}(f);return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlyout,{"data-test-subj":"agentActivityFlyout",onClose:e,size:"m",paddingSize:"none"},l.a.createElement(c.EuiFlyoutHeader,{"aria-labelledby":"FleetAgentActivityFlyoutTitle"},l.a.createElement(c.EuiPanel,{borderRadius:"none",hasShadow:!1,hasBorder:!0},l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiTitle,{size:"l"},l.a.createElement("h1",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.title",defaultMessage:"Agent activity"})))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.activityLogText",defaultMessage:"Activity log of Elastic Agent operations will appear here."}))))))),l.a.createElement(Le,null,g?l.a.createElement(c.EuiFlexGroup,{direction:"row",justifyContent:"center",alignItems:"center",className:"eui-fullHeight"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(ee.i,null))):0===p.length?l.a.createElement(c.EuiFlexGroup,{direction:"column",justifyContent:"center",alignItems:"center",className:"eui-fullHeight"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiEmptyPrompt,{iconType:"clock",iconColor:"default",title:l.a.createElement("h2",null," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.noActivityText",defaultMessage:"No activity to display"})),titleSize:"m",body:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.noActivityDescription",defaultMessage:"Activity feed will appear here as agents are reassigned, upgraded, or unenrolled."})}))):null,E.length>0?l.a.createElement(Be,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.inProgressTitle",defaultMessage:"In progress"}),actions:E,abortUpgrade:r}):null,b.length>0?l.a.createElement(Be,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.todayTitle",defaultMessage:"Today"}),actions:b,abortUpgrade:r}):null,Object.keys(h).map((e=>l.a.createElement(Be,{key:e,title:l.a.createElement(u.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"}),actions:h[e],abortUpgrade:r})))),l.a.createElement(De,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexStart"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:e},l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.closeBtn",defaultMessage:"Close"}))))))))},Be=({title:e,actions:t,abortUpgrade:a})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiPanel,{color:"subdued",hasBorder:!0,borderRadius:"none"},l.a.createElement(c.EuiText,null,l.a.createElement("b",null,e))),t.map((e=>"UPGRADE"===e.type&&"IN_PROGRESS"===e.status?l.a.createElement(We,{action:e,abortUpgrade:a,key:e.actionId}):l.a.createElement(Ge,{action:e,key:e.actionId})))),Ne={POLICY_REASSIGN:{inProgressText:"Reassigning",completedText:"assigned to a new policy",cancelledText:"assignment"},UPGRADE:{inProgressText:"Upgrading",completedText:"upgraded",cancelledText:"upgrade"},UNENROLL:{inProgressText:"Unenrolling",completedText:"unenrolled",cancelledText:"unenrollment"},FORCE_UNENROLL:{inProgressText:"Force unenrolling",completedText:"force unenrolled",cancelledText:"force unenrollment"},UPDATE_TAGS:{inProgressText:"Updating tags of",completedText:"updated tags",cancelledText:"update tags"},CANCEL:{inProgressText:"Cancelling",completedText:"cancelled",cancelledText:""},REQUEST_DIAGNOSTICS:{inProgressText:"Requesting diagnostics for",completedText:"requested diagnostics",cancelledText:"request diagnostics"},SETTINGS:{inProgressText:"Updating settings of",completedText:"updated settings",cancelledText:"update settings"},POLICY_CHANGE:{inProgressText:"Changing policy of",completedText:"changed policy",cancelledText:"change policy"},INPUT_ACTION:{inProgressText:"Input action in progress of",completedText:"input action completed",cancelledText:"input action"},ACTION:{inProgressText:"Actioning",completedText:"actioned",cancelledText:"action"}},Re=e=>{var t;return null!==(t=Ne[null!=e?e:"ACTION"])&&void 0!==t?t:Ne.ACTION},ze="#0077CC",He=e=>e?l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})," ",l.a.createElement(u.FormattedTime,{value:e})):null,qe=e=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivity.inProgressTitle",defaultMessage:"{inProgressText} {nbAgents} {agents} {reassignText}{upgradeText}",values:{nbAgents:e.nbAgentsAck>=e.nbAgentsActioned?e.nbAgentsAck:0===e.nbAgentsAck?e.nbAgentsActioned:e.nbAgentsActioned-e.nbAgentsAck+" of "+e.nbAgentsActioned,agents:1===e.nbAgentsActioned?"agent":"agents",inProgressText:Re(e.type).inProgressText,reassignText:"POLICY_REASSIGN"===e.type&&e.newPolicyId?`to ${e.newPolicyId}`:"",upgradeText:"UPGRADE"===e.type?`to version ${e.version}`:""}}),Ue=e=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.startedDescription",defaultMessage:"Started on {date}.",values:{date:He(e)}}),Ge=({action:e})=>{const t=l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivity.completedTitle",defaultMessage:"{nbAgents} {agents} {completedText}",values:{nbAgents:e.nbAgentsAck===e.nbAgentsActioned?e.nbAgentsAck:e.nbAgentsAck+" of "+e.nbAgentsActioned,agents:1===e.nbAgentsActioned?"agent":"agents",completedText:Re(e.type).completedText}})),a=l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.completedDescription",defaultMessage:"Completed {date}",values:{date:He(e.completionTime)}}),n={IN_PROGRESS:{icon:l.a.createElement(c.EuiLoadingSpinner,{size:"m"}),title:l.a.createElement(c.EuiText,null,qe(e)),titleColor:ze,description:l.a.createElement(c.EuiText,{color:"subdued"},Ue(e.creationTime))},COMPLETE:{icon:l.a.createElement(c.EuiIcon,{size:"m",type:"checkInCircleFilled",color:"green"}),title:t,titleColor:"green",description:"POLICY_REASSIGN"===e.type&&e.newPolicyId?l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.reassignCompletedDescription",defaultMessage:"Assigned to {policy}.",values:{policy:e.newPolicyId}})," ",a)):l.a.createElement(c.EuiText,{color:"subdued"},a)},FAILED:{icon:l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"red"}),title:t,titleColor:"red",description:l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.failureDescription",defaultMessage:" A problem occurred during this operation."})," ",Ue(e.creationTime)))},CANCELLED:{icon:l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"grey"}),titleColor:"grey",title:l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.cancelledTitle",defaultMessage:"Agent {cancelledText} cancelled",values:{cancelledText:Re(e.type).cancelledText}})),description:l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.cancelledDescription",defaultMessage:"Cancelled on {date}",values:{date:He(e.cancellationTime)}}))},EXPIRED:{icon:l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"grey"}),titleColor:"grey",title:l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.expiredTitle",defaultMessage:"Agent {expiredText} expired",values:{expiredText:Re(e.type).cancelledText}})),description:l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.expiredDescription",defaultMessage:"Expired on {date}",values:{date:He(e.expiration)}}))}};return l.a.createElement(c.EuiPanel,{hasBorder:!0,borderRadius:"none"},l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{direction:"row",gutterSize:"m",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},n[e.status].icon),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{color:n[e.status].titleColor,"data-test-subj":"statusTitle"},n[e.status].title)))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"statusDescription"},n[e.status].description))))},We=({action:e,abortUpgrade:t})=>{const{docLinks:a}=Object(o.Tb)(),[i,s]=Object(n.useState)(!1),r=Object(n.useCallback)((async()=>{try{s(!0),await t(e)}finally{s(!1)}}),[e,t]),d=Object(n.useMemo)((()=>{if(!e.startTime)return!1;const t=Date.now();return new Date(e.startTime).getTime()>t}),[e]);return l.a.createElement(c.EuiPanel,{hasBorder:!0,borderRadius:"none"},l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{direction:"row",gutterSize:"m",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},d?l.a.createElement(c.EuiIcon,{type:"clock"}):l.a.createElement(c.EuiLoadingSpinner,{size:"m"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{color:ze,"data-test-subj":"upgradeInProgressTitle"},d&&e.startTime?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.scheduleTitle",defaultMessage:"{nbAgents} agents scheduled to upgrade to version {version}",values:{nbAgents:e.nbAgentsActioned-e.nbAgentsAck,version:e.version}}):qe(e))))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{direction:"column",alignItems:"flexStart"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"upgradeInProgressDescription"},l.a.createElement("p",null,d&&e.startTime?l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.scheduledDescription",defaultMessage:"Scheduled for "}),l.a.createElement("strong",null,He(e.startTime)),". "):l.a.createElement(l.a.Fragment,null,Ue(e.creationTime)," "),l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.upgradeDescription",defaultMessage:"{guideLink} about agent upgrades.",values:{guideLink:l.a.createElement(c.EuiLink,{href:a.links.fleet.upgradeElasticAgent,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.guideLink",defaultMessage:"Learn more"}))}})))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{size:"s",onClick:r,isLoading:i,"data-test-subj":"abortBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.abortUpgradeButtom",defaultMessage:"Abort upgrade"})))))))};function $e(e){return"string"!=typeof e?"-":e}const Ve=()=>{var e;const{notifications:t,cloud:a}=Object(o.Tb)();Object(o.ob)("agent_list");const{getHref:i}=Object(o.Nb)(),s=Object(o.Wb)().urlParams.kuery||"",r=Object(o.nb)().fleet.all,g=Object(o.Lb)(),[m,p]=Object(n.useState)(!1),[E,f]=Object(n.useState)(s),[b,h]=Object(n.useState)(s),[v,k]=Object(n.useState)("manual"),[M,F]=Object(n.useState)([]),S=Object(n.useRef)(null),{pagination:I,pageSizeOptions:w,setPagination:T}=Object(o.Pb)(),[j,C]=Object(n.useState)("enrolled_at"),[A,P]=Object(n.useState)("desc"),L="local_metadata.elastic.agent.version",D="local_metadata.host.hostname",_=Object(n.useCallback)((e=>{h(e),T({...I,currentPage:1})}),[h,I,T]),[B,N]=Object(n.useState)([]),[z,H]=Object(n.useState)([]),[q,U]=Object(n.useState)([]),G=b.trim()||B.length||z.length||q.length||m,W=Object(n.useCallback)((()=>{f(""),h(""),N([]),H([]),U([]),p(!1)}),[h,f,N,H,p]),[$,V]=Object(n.useState)({isOpen:!1}),[K,Y]=Object(n.useState)(!1),Q=Object(o.ub)(),[J,Z]=Object(n.useState)(void 0),[X,ne]=Object(n.useState)(void 0),[le,ie]=Object(n.useState)(void 0),[se,re]=Object(n.useState)(void 0),[oe,ce]=Object(n.useState)(),[ue,de]=Object(n.useState)(!1),[ge,me]=Object(n.useState)(void 0),pe=Object(n.useMemo)((()=>{let e=b.trim();if(B.length&&(e&&(e=`(${e}) and`),e=`${e} ${x.b}.policy_id : (${B.map((e=>`"${e}"`)).join(" or ")})`),q.length&&(e&&(e=`(${e}) and`),e=`${e} ${x.b}.tags : (${q.map((e=>`"${e}"`)).join(" or ")})`),z.length){const t=z.map((e=>{switch(e){case"healthy":return O.a.buildKueryForOnlineAgents();case"unhealthy":return O.a.buildKueryForErrorAgents();case"offline":return O.a.buildKueryForOfflineAgents();case"updating":return O.a.buildKueryForUpdatingAgents();case"inactive":return O.a.buildKueryForInactiveAgents()}})).filter((e=>void 0!==e)).join(" or ");e=e?`(${e}) and (${t})`:t}return e}),[b,B,q,z]),Ee=Object(n.useMemo)((()=>z.includes("inactive")),[z]),[be,he]=Object(n.useState)([]),[ye,xe]=Object(n.useState)(),[ve,Me]=Object(n.useState)(),[Fe,Se]=Object(n.useState)(!1),[Ie,Oe]=Object(n.useState)(0),[Te,Pe]=Object(n.useState)(0),[Le,De]=Object(n.useState)({isOpen:!1}),Be={sort:{field:j,direction:A}},Ne=Object(n.useRef)(!1),Re=Object(n.useRef)(0),ze=Object(n.useCallback)((({refreshTags:e=!1}={})=>{!async function(){if(Ne.current)return;Re.current++;const a=Re.current;Ne.current=!0;try{Se(!0);const[t,l,i]=await Promise.all([Object(o.y)({page:I.currentPage,perPage:I.pageSize,kuery:pe&&""!==pe?pe:void 0,sortField:(n=j,[L,D].includes(n)?`${n}.keyword`:n),sortOrder:A,showInactive:Ee,showUpgradeable:m}),Object(o.v)({kuery:pe&&""!==pe?pe:void 0}),Object(o.w)({kuery:pe&&""!==pe?pe:void 0,showInactive:Ee})]);if(Ne.current=!1,Re.current!==a)return;if(t.error)throw t.error;if(!t.data)throw new Error("Invalid GET /agents response");if(l.error)throw l.error;if(!l.data)throw new Error("Invalid GET /agents_status response");if(i.error)throw l.error;if(!i.data)throw new Error("Invalid GET /agent/tags response");xe({healthy:l.data.results.online,unhealthy:l.data.results.error,offline:l.data.results.offline,updating:l.data.results.updating,inactive:t.data.totalInactive});const s=i.data.items;ve&&!e&&Object(R.isEqual)(s,ve)||Me(s),he(t.data.items),Oe(t.data.total),Pe(t.data.totalInactive)}catch(e){t.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.agentList.errorFetchingDataTitle",{defaultMessage:"Error fetching agents"})})}var n;Se(!1)}()}),[I.currentPage,I.pageSize,pe,Ee,m,ve,t.toasts,j,A]);Object(n.useEffect)((()=>{ze();const e=setInterval((()=>{ze()}),3e4);return()=>clearInterval(e)}),[ze]);const He=Object(o.vb)({page:1,perPage:x.n,full:!0}),qe=Object(n.useMemo)((()=>He.data?He.data.items:[]),[He]),Ue=Object(n.useMemo)((()=>qe.reduce(((e,t)=>(e[t.id]=t,e)),{})),[qe]),Ge=e=>{if(!e.active)return!1;if(!e.policy_id)return!0;const t=Ue[e.policy_id];return!(!0===(null==t?void 0:t.is_managed))},We=Object(n.useMemo)((()=>{if(!X||!X.policy_id)return!1;const e=Ue[X.policy_id];return!!e&&Object(O.s)(e)}),[X,Ue]),{isUnhealthy:Ve}=Object(te.a)(),Ke=Object(n.useCallback)((()=>{Q.openFleetServerFlyout()}),[Q]),Ye=Object(n.useCallback)((()=>{Y(!0)}),[Y]),Qe=[{field:D,sortable:!0,name:d.i18n.translate("xpack.fleet.agentList.hostColumnTitle",{defaultMessage:"Host"}),width:"185px",render:(e,t)=>l.a.createElement(c.EuiLink,{href:i("agent_details",{agentId:t.id})},$e(e))},{field:"active",sortable:!1,width:"85px",name:d.i18n.translate("xpack.fleet.agentList.statusColumnTitle",{defaultMessage:"Status"}),render:(e,t)=>l.a.createElement(ee.a,{agent:t})},{field:"tags",sortable:!1,width:"210px",name:d.i18n.translate("xpack.fleet.agentList.tagsColumnTitle",{defaultMessage:"Tags"}),render:(e=[],t)=>l.a.createElement(je,{tags:e})},{field:"policy_id",sortable:!0,name:d.i18n.translate("xpack.fleet.agentList.policyColumnTitle",{defaultMessage:"Agent policy"}),width:"260px",render:(e,t)=>{const a=Ue[e],n=t.policy_revision&&(null==a?void 0:a.revision)>t.policy_revision;return l.a.createElement(c.EuiFlexGroup,{gutterSize:"none",style:{minWidth:0},direction:"column"},a&&l.a.createElement(y.f,{policy:a,agent:t}),n&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"warning"})," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.outOfDateLabel",defaultMessage:"Out-of-date"}))))}},{field:L,sortable:!0,width:"135px",name:d.i18n.translate("xpack.fleet.agentList.versionTitle",{defaultMessage:"Version"}),render:(e,t)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"none",style:{minWidth:0},direction:"column"},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},$e(e)),Ge(t)&&Object(O.l)(t,g)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"warning"})," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.agentUpgradeLabel",defaultMessage:"Upgrade available"}))):null)},{field:"last_checkin",sortable:!0,name:d.i18n.translate("xpack.fleet.agentList.lastCheckinTitle",{defaultMessage:"Last activity"}),width:"180px",render:(e,t)=>e?l.a.createElement(u.FormattedRelative,{value:e}):null},{name:d.i18n.translate("xpack.fleet.agentList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>{const t="string"==typeof e.policy_id?Ue[e.policy_id]:void 0;return(null==se?void 0:se.id)!==e.id||Object(R.isEqual)(e.tags,se.tags)||re(e),l.a.createElement(Ce,{agent:e,agentPolicy:t,onReassignClick:()=>Z(e),onUnenrollClick:()=>ne(e),onUpgradeClick:()=>ie(e),onAddRemoveTagsClick:t=>{ce(t),re(e),de(!ue)},onRequestDiagnosticsClick:()=>me(e)})}}],width:"100px"}],Je=({refreshTags:e=!1}={})=>{ze({refreshTags:e}),De({isOpen:!0})};return l.a.createElement(l.a.Fragment,null,K?l.a.createElement(c.EuiPortal,null,l.a.createElement(_e,{onAbortSuccess:ze,onClose:()=>Y(!1),refreshAgentActivity:Fe})):null,$.isOpen?l.a.createElement(c.EuiPortal,null,l.a.createElement(y.c,{agentPolicy:qe.find((e=>e.id===$.selectedPolicyId)),onClose:()=>{V({isOpen:!1}),ze(),He.resendRequest()}})):null,J&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee.c,{agents:[J],onClose:()=>{Z(void 0),Je()}})),X&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee.d,{agents:[X],agentCount:1,onClose:()=>{ne(void 0),Je({refreshTags:!0})},useForceUnenroll:"unenrolling"===X.status,hasFleetServer:We})),le&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee.e,{agents:[le],agentCount:1,onClose:()=>{ie(void 0),Je()}})),ge&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ae,{agents:[ge],agentCount:1,onClose:()=>{me(void 0)}})),ue&&l.a.createElement(ke,{agentId:null==se?void 0:se.id,allTags:null!=ve?ve:[],selectedTags:null!==(e=null==se?void 0:se.tags)&&void 0!==e?e:[],button:oe,onTagsUpdated:()=>{Je()},onClosePopover:()=>{de(!1)}}),Ve&&l.a.createElement(l.a.Fragment,null,null!=a&&a.deploymentUrl?l.a.createElement(ee.g,{deploymentUrl:a.deploymentUrl}):l.a.createElement(ee.h,{onClickAddFleetServer:Ke}),l.a.createElement(c.EuiSpacer,{size:"l"})),l.a.createElement(we,{agentPolicies:qe,draftKuery:E,onDraftKueryChange:f,onSubmitSearch:_,selectedAgentPolicies:B,onSelectedAgentPoliciesChange:N,selectedStatus:z,onSelectedStatusChange:H,showUpgradeable:m,onShowUpgradeableChange:p,tags:null!=ve?ve:[],selectedTags:q,onSelectedTagsChange:U,totalAgents:Ie,totalInactiveAgents:Te,selectionMode:v,currentQuery:pe,selectedAgents:M,refreshAgents:Je,onClickAddAgent:()=>V({isOpen:!0}),onClickAddFleetServer:Ke,visibleAgents:be,onClickAgentActivity:Ye,showAgentActivityTour:Le}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(fe,{showInactive:Ee,totalAgents:Ie,agentStatus:ye,selectableAgents:(null==be?void 0:be.filter(Ge).length)||0,selectionMode:v,setSelectionMode:k,selectedAgents:M,setSelectedAgents:e=>{null!=S&&S.current&&(S.current.setSelection(e),k("manual"))}}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiBasicTable,{ref:S,className:"fleet__agentList__table","data-test-subj":"fleetAgentListTable",loading:Fe,hasActions:!0,noItemsMessage:Fe&&1===Re.current?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.loadingAgentsMessage",defaultMessage:"Loading agents…"}):G?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.noFilteredAgentsPrompt",defaultMessage:"No agents found. {clearFiltersLink}",values:{clearFiltersLink:l.a.createElement(c.EuiLink,{onClick:()=>W()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):l.a.createElement(Ae,{hasFleetAllPrivileges:r,setEnrollmentFlyoutState:V}),items:Ie?m?be.filter((e=>Ge(e)&&Object(O.l)(e,g))):be:[],itemId:"id",columns:Qe,pagination:{pageIndex:I.currentPage-1,pageSize:I.pageSize,totalItemCount:Math.min(Ie,x.n),pageSizeOptions:w},isSelectable:!0,selection:{onSelectionChange:e=>{F(e),"query"===v&&e.length<M.length&&(M.length>0&&0===Object(R.differenceBy)(M,be,"id").length?k("manual"):null!=S&&S.current&&S.current.setSelection(be))},selectable:Ge,selectableMessage:(e,t)=>e?"":t.active?t.policy_id&&Ue[t.policy_id].is_managed?"This action is not available for agents enrolled in an externally managed agent policy":"":"This agent is not active"},onChange:({page:e,sort:t})=>{const a={...I,currentPage:e.index+1,pageSize:e.size};T(a),C(t.field),P(t.direction)},sorting:Be}))};var Ke=a(152);const Ye=l.a.createContext({refresh:()=>{}});var Qe=a(49);const Je="logs-elastic_agent-*,logs-elastic_agent.*-*",Ze="elastic_agent",Xe="elastic_agent.id",et={name:"data_stream.dataset",type:"string",aggregatable:!0},tt={name:"log.level",type:"string",aggregatable:!0},at="now-1d",nt="now",lt={start:at,end:nt,logLevels:[],datasets:[Ze],query:""},it={ERROR:"error",WARNING:"warning",INFO:"info",DEBUG:"debug"},st=["error","warning","warn","notice","info","debug"],rt=it.INFO;var ot=a(359),ct=a.n(ot),ut=a(189),dt=a(88),gt=a(365),mt=a.n(gt),pt=a(80),Et=a(364),ft=a.n(Et),bt=a(20),ht=a.n(bt),yt=a(89);const xt=Object(n.memo)((({selectedDatasets:e,onToggleDataset:t})=>{const{unifiedSearch:a}=Object(o.Tb)(),[i,s]=Object(n.useState)(!1),[r,u]=Object(n.useState)(!1),[g,m]=Object(n.useState)([Ze]),p=Object(n.useCallback)((()=>s((e=>!e))),[s]),E=Object(n.useCallback)((()=>s(!1)),[s]);return Object(n.useEffect)((()=>{(async()=>{u(!0);try{const e=await a.autocomplete.getValueSuggestions({indexPattern:{title:Je,fields:[et]},field:et,query:""});e.length>0&&m(e.sort())}catch(e){m([Ze])}u(!1)})()}),[a.autocomplete]),l.a.createElement(c.EuiPopover,{button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:p,isSelected:i,isLoading:r,numFilters:g.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},d.i18n.translate("xpack.fleet.agentLogs.datasetSelectText",{defaultMessage:"Dataset"})),isOpen:i,closePopover:E,panelPaddingSize:"none"},g.map((a=>l.a.createElement(c.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a))))})),vt=Object(n.memo)((({selectedLevels:e,onToggleLevel:t})=>{const{unifiedSearch:a}=Object(o.Tb)(),[i,s]=Object(n.useState)(!1),[r,u]=Object(n.useState)(!1),[g,m]=Object(n.useState)([]),p=Object(n.useCallback)((()=>s((e=>!e))),[]),E=Object(n.useCallback)((()=>s(!1)),[]);Object(n.useEffect)((()=>{(async()=>{u(!0);try{const t=await a.autocomplete.getValueSuggestions({indexPattern:{title:Je,fields:[tt]},field:tt,query:""});m((e=t,[...new Set([...st.filter((t=>e.includes(t))),...e.sort()])]))}catch(e){m([])}var e;u(!1)})()}),[a.autocomplete]);const f=l.a.createElement("div",{className:"euiFilterSelect__note"},l.a.createElement("div",{className:"euiFilterSelect__noteContent"},l.a.createElement(c.EuiIcon,{type:"minusInCircle"}),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement("p",null,d.i18n.translate("xpack.fleet.agentLogs.logLevelEmpty",{defaultMessage:"No Logs Found"})))),b=g.map((a=>l.a.createElement(c.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a)));return l.a.createElement(c.EuiPopover,{button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:p,isSelected:i,isLoading:r,numFilters:g.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},d.i18n.translate("xpack.fleet.agentLogs.logLevelSelectText",{defaultMessage:"Log level"})),isOpen:i,closePopover:E,panelPaddingSize:"none"},0===g.length?f:b)}));var kt=a(81);const Mt=[Xe,et.name,tt.name],Ft=Object(n.memo)((({query:e,isQueryValid:t,onUpdateQuery:a})=>{const{data:i,notifications:s,http:r,docLinks:c,uiSettings:u,unifiedSearch:g,storage:m,dataViews:p}=Object(o.Tb)(),[E,f]=Object(n.useState)();return Object(n.useEffect)((()=>{(async()=>{try{const e=(await i.dataViews.getFieldsForWildcard({pattern:Je})||[]).filter((e=>!Mt.includes(e.name)));f(e)}catch(e){f(void 0)}})()}),[i.dataViews]),l.a.createElement(kt.QueryStringInput,{iconType:"search",autoSubmit:!0,disableLanguageSwitcher:!0,indexPatterns:E?[{title:Je,fields:E}]:[],query:{query:e,language:"kuery"},isInvalid:!t,disableAutoFocus:!0,placeholder:d.i18n.translate("xpack.fleet.agentLogs.searchPlaceholderText",{defaultMessage:"Search logs…"}),onChange:e=>{a(e.query)},onSubmit:e=>{a(e.query,!0)},appName:d.i18n.translate("xpack.fleet.appTitle",{defaultMessage:"Fleet"}),deps:{unifiedSearch:g,notifications:s,http:r,docLinks:c,uiSettings:u,data:i,dataViews:p,storage:m}})})),St=Object.values(it),It=Object(n.memo)((({agent:e})=>{var t,a,i,s;const{notifications:r}=Object(o.Tb)(),[g,m]=Object(n.useState)(!1),[p,E]=Object(n.useState)(null!==(t=null===(a=e.local_metadata)||void 0===a||null===(i=a.elastic)||void 0===i||null===(s=i.agent)||void 0===s?void 0:s.log_level)&&void 0!==t?t:rt),[f,b]=Object(n.useState)(p),h=Object(n.useCallback)((()=>{m(!0),async function(){try{const t=await Object(o.L)(e.id,{action:{type:"SETTINGS",data:{log_level:f}}});if(t.error)throw t.error;E(f),r.toasts.addSuccess(d.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.successText",{defaultMessage:"Changed agent logging level to '{logLevel}'.",values:{logLevel:f}}))}catch(e){r.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.errorTitleText",{defaultMessage:"Error updating agent logging level"})})}m(!1)}()}),[r,f,e.id]);return l.a.createElement(c.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFormLabel,{htmlFor:"selectAgentLogLevel"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.selectLogLevelLabelText",defaultMessage:"Agent logging level"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiSelect,{disabled:g,compressed:!0,id:"selectAgentLogLevel",value:f,onChange:e=>{b(e.target.value)},options:St.map((e=>({text:e,value:e})))})),p!==f&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{flush:"left",size:"xs",isLoading:g,disabled:p===f,iconType:"refresh",onClick:h},g?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonLoadingText",defaultMessage:"Applying changes..."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonText",defaultMessage:"Apply changes"}))))})),Ot=m()(c.EuiFlexGroup).withConfig({displayName:"WrapperFlexGroup",componentId:"sc-mjo9ba-0"})(["height:100%;"]),wt=m()(c.EuiFlexItem).withConfig({displayName:"DatePickerFlexItem",componentId:"sc-mjo9ba-1"})(["max-width:312px;"]),Tt=Object(Qe.createStateContainerReactHelpers)(),jt=({agentPolicy:e})=>{const{getHref:t}=Object(o.Nb)();return l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiCallOut,{size:"m",color:"primary",iconType:"iInCircle",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutTitle",defaultMessage:"Log collection is disabled"})},e.is_managed?null:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutDescription",defaultMessage:"Update the agent's policy {settingsLink} to enable logs collection.",values:{settingsLink:l.a.createElement(c.EuiLink,{href:t("policy_details",{policyId:e.id,tabId:"settings"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.settingsLink",defaultMessage:"settings"}))}})))},Ct=Object(n.memo)((({agent:e,agentPolicy:t,state:a})=>{var i,s,r,d;const{data:g,application:m,http:p}=Object(o.Tb)(),{update:E}=Tt.useTransitions(),b=Object(n.useCallback)((e=>{const{min:t,max:a}=g.query.timefilter.timefilter.calculateBounds(e);return t&&a?{start:t.valueOf(),end:a.valueOf()}:void 0}),[g.query.timefilter.timefilter]),h=Object(n.useCallback)((e=>{b(e)&&E({start:e.from,end:e.to})}),[b,E]),[y,x]=Object(n.useState)(b({from:a.start,to:a.end})||b({from:at,to:nt}));Object(n.useEffect)((()=>{const e=b({from:a.start,to:a.end});e?x(e):h({from:at,to:nt})}),[a.start,a.end,b,h]);const v=Object(n.useCallback)((e=>{try{return Object(pt.fromKueryExpression)(e),!0}catch(e){return!1}}),[]),[k,M]=Object(n.useState)(a.query),[F,S]=Object(n.useState)(v(a.query)),I=Object(n.useCallback)(((e,t)=>{M(e),v(e)?(S(!0),t&&E({query:e})):S(!1)}),[v,E]),O=Object(n.useMemo)((()=>(({agentId:e,datasets:t,logLevels:a,userQuery:n})=>{const l=`elastic_agent.id:${e}`,i=t.length?t.map((e=>`${et.name}:${e}`)).join(" or "):`${et.name}:elastic_agent or ${et.name}:elastic_agent.*`,s=a.map((e=>`${tt.name}:${e}`)).join(" or "),r=`${l} and (${i})`,o=s?`${r} and (${s})`:r;return n?`(${o}) and (${n})`:o})({agentId:e.id,datasets:a.datasets,logLevels:a.logLevels,userQuery:a.query})),[e.id,a.datasets,a.logLevels,a.query]),w=Object(n.useMemo)((()=>p.basePath.prepend(ct.a.format({pathname:"/app/logs/stream",search:Object(ut.stringify)({logPosition:Object(dt.encode)({start:a.start,end:a.end,streamLive:!1}),logFilter:Object(dt.encode)({expression:O,kind:"kuery"})})}))),[p.basePath,a.start,a.end,O]),T=null===(i=e.local_metadata)||void 0===i||null===(s=i.elastic)||void 0===s||null===(r=s.agent)||void 0===r?void 0:r.version,j=Object(n.useMemo)((()=>{var e;if(!T)return!1;const t=null===(e=ht()(T))||void 0===e?void 0:e.version;return!!t&&ft()(t,"7.11.0")}),[T]),[C,{height:A}]=mt()(),P=Object(n.useMemo)((()=>Math.max(A,600)),[A]);return j?l.a.createElement(Ot,{direction:"column",gutterSize:"m"},t&&!(null!==(d=t.monitoring_enabled)&&void 0!==d&&d.includes("logs"))&&l.a.createElement(jt,{agentPolicy:t}),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexGroup,{gutterSize:"m"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Ft,{query:k,onUpdateQuery:I,isQueryValid:F})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFilterGroup,null,l.a.createElement(xt,{selectedDatasets:a.datasets,onToggleDataset:e=>{const t=[...a.datasets],n=t.indexOf(e);n>=0?(t.splice(n,1),E({datasets:t})):E({datasets:[...a.datasets,e]})}}),l.a.createElement(vt,{selectedLevels:a.logLevels,onToggleLevel:e=>{const t=[...a.logLevels],n=t.indexOf(e);n>=0?(t.splice(n,1),E({logLevels:t})):E({logLevels:[...a.logLevels,e]})}}))),l.a.createElement(wt,{grow:!1},l.a.createElement(c.EuiSuperDatePicker,{showUpdateButton:!1,start:a.start,end:a.end,onTimeChange:({start:e,end:t})=>{h({from:e,to:t})}})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(f.RedirectAppLinks,{application:m},l.a.createElement(c.EuiButtonEmpty,{href:w,iconType:"popout",flush:"both"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.openInLogsUiLinkText",defaultMessage:"Open in Logs"})))))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiPanel,{paddingSize:"none",panelRef:C},l.a.createElement(yt.LogStream,{logView:{type:"log-view-reference",logViewId:"default"},height:P,startTimestamp:y.start,endTimestamp:y.end,query:O}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(It,{agent:e}))):l.a.createElement(c.EuiCallOut,{size:"m",color:"warning",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.oldAgentWarningTitle",defaultMessage:"The Logs view requires Elastic Agent 7.11 or higher. To upgrade an agent, go to the Actions menu, or {downloadLink} a newer version.",values:{downloadLink:l.a.createElement(c.EuiLink,{href:"https://ela.st/download-elastic-agent",external:!0,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.downloadLink",defaultMessage:"download"}))}})})})),At=Object(n.memo)((({agent:e,agentPolicy:t})=>{const a=Object(n.useMemo)((()=>Object(Qe.createStateContainer)({...lt,...Object(Qe.getStateFromKbnUrl)("_q",window.location.href,{getFromHashQuery:!1})},{update:e=>t=>({...e,...t})})),[]),i=Object(n.useMemo)((()=>Tt.connect((e=>({state:e||lt})))(Ct)),[]),[s,r]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{const e=Object(Qe.createKbnUrlStateStorage)({useHashQuery:!1,useHash:!1}),{start:t,stop:n}=Object(Qe.syncState)({storageKey:"_q",stateContainer:a,stateStorage:e});return t(),r(!0),()=>{n(),a.set(lt)}}),[a]),l.a.createElement(Tt.Provider,{value:a},s?l.a.createElement(i,{agent:e,agentPolicy:t}):null)})),Pt=Object(n.memo)((({agent:e,assignFlyoutOpenByDefault:t=!1,onCancelReassign:a,agentPolicy:i})=>{const s=Object(o.nb)().fleet.all,r=Object(o.Lb)(),d=l.a.useContext(Ye).refresh,[g,m]=Object(n.useState)(t),[p,E]=Object(n.useState)(!1),[f,b]=Object(n.useState)(!1),[h,x]=Object(n.useState)(!1),v="unenrolling"===e.status,k=i&&Object(O.s)(i),{diagnosticFileUploadEnabled:M}=O.b.get(),F=Object(n.useMemo)((()=>a||(()=>m(!1))),[a,m]),S=[l.a.createElement(c.EuiContextMenuItem,{icon:"pencil",onClick:()=>{m(!0)},disabled:!e.active,key:"reassignPolicy"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),l.a.createElement(c.EuiContextMenuItem,{icon:"trash",disabled:!s||!e.active,onClick:()=>{E(!0)}},v?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),l.a.createElement(c.EuiContextMenuItem,{icon:"refresh",disabled:!Object(O.l)(e,r),onClick:()=>{b(!0)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))];return M&&S.push(l.a.createElement(c.EuiContextMenuItem,{icon:"download",disabled:!s,onClick:()=>{x(!0)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.diagnosticsOneButton",defaultMessage:"Request diagnostics .zip"}))),l.a.createElement(l.a.Fragment,null,g&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee.c,{agents:[e],onClose:F})),p&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee.d,{agents:[e],agentCount:1,onClose:()=>{E(!1),d()},useForceUnenroll:v,hasFleetServer:k})),f&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ee.e,{agents:[e],agentCount:1,onClose:()=>{b(!1),d()}})),h&&l.a.createElement(c.EuiPortal,null,l.a.createElement(ae,{agents:[e],agentCount:1,onClose:()=>{x(!1)}})),l.a.createElement(y.g,{button:{props:{iconType:"arrowDown",iconSide:"right",color:"primary"},children:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.actionsButton",defaultMessage:"Actions"})},items:S}))})),Lt=m()(c.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-19wc892-0"})(["min-width:0px;"]),Dt=Object(n.memo)((({agent:e,agentPolicy:t})=>{var a,n,i,s,r,g,m,p,E,f,b,h,x,v,k,M,F;const S=Object(o.Lb)();return l.a.createElement(c.EuiPanel,null,l.a.createElement(c.EuiDescriptionList,{compressed:!0},[{title:d.i18n.translate("xpack.fleet.agentDetails.statusLabel",{defaultMessage:"Status"}),description:l.a.createElement(ee.a,{agent:e,showOfflinePreviousStatus:!0})},{title:d.i18n.translate("xpack.fleet.agentDetails.lastActivityLabel",{defaultMessage:"Last activity"}),description:e.last_checkin?l.a.createElement(u.FormattedRelative,{value:new Date(e.last_checkin)}):"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.lastCheckinMessageLabel",{defaultMessage:"Last checkin message"}),description:e.last_checkin_message?e.last_checkin_message:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.hostIdLabel",{defaultMessage:"Agent ID"}),description:e.id},{title:d.i18n.translate("xpack.fleet.agentDetails.agentPolicyLabel",{defaultMessage:"Agent policy"}),description:t?l.a.createElement(y.f,{policy:t,agent:e}):e.policy_id||"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.versionLabel",{defaultMessage:"Agent version"}),description:"string"==typeof(null===(a=e.local_metadata)||void 0===a||null===(n=a.elastic)||void 0===n||null===(i=n.agent)||void 0===i?void 0:i.version)?l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},e.local_metadata.elastic.agent.version),Object(O.l)(e,S)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{position:"right",content:d.i18n.translate("xpack.fleet.agentList.agentUpgradeLabel",{defaultMessage:"Upgrade available"})},l.a.createElement(c.EuiIcon,{type:"alert",color:"warning"}))):null):"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.hostNameLabel",{defaultMessage:"Host name"}),description:"string"==typeof(null===(s=e.local_metadata)||void 0===s||null===(r=s.host)||void 0===r?void 0:r.hostname)?e.local_metadata.host.hostname:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.logLevel",{defaultMessage:"Logging level"}),description:"string"==typeof(null===(g=e.local_metadata)||void 0===g||null===(m=g.elastic)||void 0===m||null===(p=m.agent)||void 0===p?void 0:p.log_level)?e.local_metadata.elastic.agent.log_level:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.releaseLabel",{defaultMessage:"Agent release"}),description:"boolean"==typeof(null===(E=e.local_metadata)||void 0===E||null===(f=E.elastic)||void 0===f||null===(b=f.agent)||void 0===b?void 0:b.snapshot)?!0===e.local_metadata.elastic.agent.snapshot?"snapshot":"stable":"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.platformLabel",{defaultMessage:"Platform"}),description:"string"==typeof(null===(h=e.local_metadata)||void 0===h||null===(x=h.os)||void 0===x?void 0:x.platform)?e.local_metadata.os.platform:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.monitorLogsLabel",{defaultMessage:"Monitor logs"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)&&null!=t&&null!==(v=t.monitoring_enabled)&&void 0!==v&&v.includes("logs")?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsEnabledText",defaultMessage:"Enabled"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsDisabledText",defaultMessage:"Disabled"})},{title:d.i18n.translate("xpack.fleet.agentDetails.monitorMetricsLabel",{defaultMessage:"Monitor metrics"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)&&null!=t&&null!==(k=t.monitoring_enabled)&&void 0!==k&&k.includes("metrics")?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsEnabledText",defaultMessage:"Enabled"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsDisabledText",defaultMessage:"Disabled"})},{title:d.i18n.translate("xpack.fleet.agentDetails.tagsLabel",{defaultMessage:"Tags"}),description:(null!==(M=e.tags)&&void 0!==M?M:[]).length>0?l.a.createElement(je,{tags:null!==(F=e.tags)&&void 0!==F?F:[]}):"-"}].map((({title:e,description:t})=>{const a="string"==typeof t&&t.length>20?t:"";return l.a.createElement(c.EuiFlexGroup,null,l.a.createElement(Lt,{grow:3},l.a.createElement(c.EuiDescriptionListTitle,null,e)),l.a.createElement(Lt,{grow:7},l.a.createElement(c.EuiToolTip,{position:"top",content:a},l.a.createElement(c.EuiDescriptionListDescription,{className:"eui-textTruncate"},t))))}))))}));function _t(e){return"logfile"===e?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeLogText",{defaultMessage:"Logs"}):"endpoint"===e?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeEndpointText",{defaultMessage:"Endpoint"}):e.match(/\/metrics$/)?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeMetricsText",{defaultMessage:"Metrics"}):e}const Bt=m()(c.EuiAccordion).withConfig({displayName:"StyledEuiAccordion",componentId:"sc-12a1xr8-0"})([".euiAccordion__button{width:90%;}.euiAccordion__triggerWrapper{padding-left:",";}&.euiAccordion-isOpen{.euiAccordion__childWrapper{padding:",";padding-top:0px;}}.ingest-integration-title-button{padding:",";}.euiTableRow:last-child .euiTableRowCell{border-bottom:none;}.euiIEFlexWrapFix{min-width:0;}.euiAccordion__buttonContent{width:100%;}"],(e=>e.theme.eui.euiSizeM),(e=>e.theme.eui.euiSizeM),(e=>e.theme.eui.euiSizeS)),Nt=m()(c.EuiLink).withConfig({displayName:"StyledEuiLink",componentId:"sc-12a1xr8-1"})(["font-size:",";"],(e=>e.theme.eui.euiFontSizeS)),Rt=({id:e,title:t,children:a})=>l.a.createElement(c.EuiPanel,{paddingSize:"none"},l.a.createElement(Bt,{id:e,arrowDisplay:"left",buttonClassName:"ingest-integration-title-button",buttonContent:t},a)),zt=Object(n.memo)((({agent:e,agentPolicy:t,packagePolicy:a})=>{var i,s,r,g;const{getHref:m}=Object(o.Nb)(),p=Object(c.useEuiTheme)(),[E,f]=Object(n.useState)(!1),b=Object(o.Vb)(null!==(i=null===(s=a.package)||void 0===s?void 0:s.name)&&void 0!==i?i:"","package-policy-response"),h=Object(o.Vb)(null!==(r=null===(g=a.package)||void 0===g?void 0:g.name)&&void 0!==r?r:"","package-generic-errors-list"),x=Object(n.useMemo)((()=>b&&l.a.createElement(y.k,null,l.a.createElement(b.Component,{agent:e,onShowNeedsAttentionBadge:f}))),[e,b]),v=Object(n.useMemo)((()=>{var t;const n=[];return e.components?(Object(R.filter)(e.components,{type:null===(t=a.package)||void 0===t?void 0:t.name}).forEach((e=>{n.push(...Object(R.filter)(e.units,{status:"failed"}))})),n):n}),[e.components,a]),k=E||!!v.length,M=Object(n.useMemo)((()=>h&&l.a.createElement(y.k,null,l.a.createElement(h.Component,{packageErrors:v}))),[v,h]),F=[{label:l.a.createElement(c.EuiText,{size:"s"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetailsIntegrations.inputsTypeLabel",defaultMessage:"Inputs"})),id:"inputs",children:a.inputs.reduce(((t,a)=>{return a.enabled?[...t,{label:l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})},l.a.createElement(Nt,{href:m("agent_details",{agentId:e.id,tabId:"logs",logQuery:(n=a.type,"logfile"===n?"(datasets:!(elastic_agent.filebeat))":n.match(/\/metrics$/)?"(datasets:!(elastic_agent.metricbeat))":"osquery"===n?"(datasets:!(elastic_agent.osquerybeat))":n.match(/^synthetics\//)?"(datasets:!(elastic_agent.heartbeat))":"apm"===n?"(datasets:!(elastic_agent.apm_server))":"endpoint"===n?"(datasets:!(elastic_agent.endpoint_security))":"")}),"aria-label":d.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})},_t(a.type))),id:a.type}]:t;var n}),[])}];return l.a.createElement(Rt,{id:a.id,title:l.a.createElement(c.EuiTitle,{size:"xs"},l.a.createElement("h3",null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},a.package?l.a.createElement(y.r,{packageName:a.package.name,version:a.package.version,size:"l",tryApi:!0}):l.a.createElement(y.r,{size:"l",packageName:"default",version:"0"})),l.a.createElement(c.EuiFlexItem,{className:"eui-textTruncate"},l.a.createElement(c.EuiLink,{className:"eui-textTruncate","data-test-subj":"agentPolicyDetailsLink",href:m("edit_integration",{policyId:t.id,packagePolicyId:a.id})},a.name)),k&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiBadge,{color:p.euiTheme.colors.danger,iconType:"alert",iconSide:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetailsIntegrations.needsAttention.label",defaultMessage:"Needs attention"}))))))},l.a.createElement(c.EuiTreeView,{items:F,showExpansionArrows:!0,"aria-label":"inputsTreeView","aria-labelledby":"inputsTreeView"}),x,M,l.a.createElement(c.EuiSpacer,null))})),Ht=Object(n.memo)((({agent:e,agentPolicy:t})=>t&&t.package_policies?l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},t.package_policies.map((a=>l.a.createElement(c.EuiFlexItem,{grow:!1,key:a.id},l.a.createElement(zt,{agent:e,agentPolicy:t,packagePolicy:a}))))):null)),qt=m()(c.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-1svqtoc-0"})(["min-width:0px;"]),Ut=Object(n.memo)((({agent:e,agentPolicy:t})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{alignItems:"flexStart"},l.a.createElement(qt,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.overviewSectionTitle",defaultMessage:"Overview"}))),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(Dt,{agent:e,agentPolicy:t})),l.a.createElement(qt,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.integrationsSectionTitle",defaultMessage:"Integrations"}))),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(Ht,{agent:e,agentPolicy:t})))))),Gt=({agent:e,agentPolicy:t})=>{var a,n;const{isInstalled:i,link:s,isLoading:r}=function(e){const{isLoading:t,data:a}=Object(o.Eb)(S.A);return{isLoading:t,isInstalled:"installed"===(null==a?void 0:a.item.status),link:`${Object(o.Kb)(`/dashboard/${S.z}`)}?_a=(query:(language:kuery,query:'elastic_agent.id:${e.id}'))`}}(e),d=null!==(a=null==t||null===(n=t.monitoring_enabled)||void 0===n?void 0:n.length)&&void 0!==a&&a,g=i&&!r&&d?{href:s}:{disabled:!0},m=l.a.createElement(c.EuiButton,F()({fill:!0},g,{isLoading:r}),l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButtonLabel",defaultMessage:"View agent dashboard"}));return d?i?m:l.a.createElement(c.EuiToolTip,{content:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButton.disabledNoIntegrationTooltip",defaultMessage:"Agent dashboard not found, you need to install the elastic_agent integration."})},m):l.a.createElement(c.EuiToolTip,{content:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButton.disabledNoLogsAndMetricsTooltip",defaultMessage:"Logs and metrics for agent are not enabled in the agent policy."})},m)},Wt=m()(c.EuiFlexItem).withConfig({displayName:"FlexStartEuiFlexItem",componentId:"sc-fsolvf-0"})(["align-self:flex-start;"]),$t=({agent:e})=>{const{notifications:t}=Object(o.Tb)(),{getAbsolutePath:a}=Object(o.Nb)(),[i,s]=Object(n.useState)(!1),[r,g]=Object(n.useState)(!0),[m,p]=Object(n.useState)([]),[E,f]=Object(n.useState)([]),b=Object(n.useCallback)((async()=>{try{const t=await Object(o.x)(e.id),a=t.error;if(a)throw a;if(!t.data)throw new Error("No data");p(t.data.items),g(!1)}catch(e){t.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.requestDiagnostics.errorLoadingUploadsNotificationTitle",{defaultMessage:"Error loading diagnostics uploads"})})}}),[e.id,t.toasts]);Object(n.useEffect)((()=>{b();const e=setInterval((async()=>{b()}),1e4);return()=>{e&&clearInterval(e)}}),[b]),Object(n.useEffect)((()=>{f(m),E.length>0&&m.filter((e=>{const t=E.find((t=>t.id===e.id));return"READY"===e.status&&(!t||"READY"!==(null==t?void 0:t.status))})).forEach((e=>{t.toasts.addSuccess({title:d.i18n.translate("xpack.fleet.requestDiagnostics.readyNotificationTitle",{defaultMessage:"Agent diagnostics {name} ready",values:{name:e.name}})},{toastLifeTimeMs:5e3})}))}),[E,m,t.toasts]);const h=[{field:"id",name:"File",render:e=>{const t=m.find((t=>t.id===e));return"READY"===(null==t?void 0:t.status)?l.a.createElement(c.EuiLink,{href:a(null==t?void 0:t.filePath),download:!0,target:"_blank"},l.a.createElement(c.EuiIcon,{type:"download"}),"   ",null==t?void 0:t.name):"IN_PROGRESS"===(null==t?void 0:t.status)||"AWAITING_UPLOAD"===(null==t?void 0:t.status)?l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(c.EuiLoadingSpinner,null),"  ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.generatingText",defaultMessage:"Generating diagnostics file..."})):l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(c.EuiIcon,{type:"alert",color:"red"}),"  ",null==t?void 0:t.name)}},{field:"id",name:"Date",dataType:"date",render:e=>{const t=m.find((t=>t.id===e));return l.a.createElement(c.EuiText,{color:"READY"===(null==t?void 0:t.status)?"default":"subdued"},Object(c.formatDate)(null==t?void 0:t.createTime,"ll"))}}];return l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"l"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiCallOut,{iconType:"alert",color:"warning",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerSetup.calloutTitle",defaultMessage:"Agent diagnostics"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.calloutText",defaultMessage:"Diagnostics files are stored in Elasticsearch, and as such can incur storage costs. Fleet will automatically remove old diagnostics files after 30 days."}))),l.a.createElement(Wt,null,l.a.createElement(c.EuiButton,{fill:!0,size:"m",onClick:async function(){try{s(!0);const{error:a}=await Object(o.Y)(e.id);if(a)throw a;s(!1);const n=d.i18n.translate("xpack.fleet.requestDiagnostics.successSingleNotificationTitle",{defaultMessage:"Request diagnostics submitted"});t.toasts.addSuccess(n)}catch(e){s(!1),t.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.requestDiagnostics.fatalErrorNotificationTitle",{defaultMessage:"Error requesting diagnostics {count, plural, one {agent} other {agents}}",values:{count:1}})})}},disabled:i},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.diagnosticsOneButton",defaultMessage:"Request diagnostics .zip"}))),l.a.createElement(c.EuiFlexItem,null,r?l.a.createElement(c.EuiLoadingContent,{lines:3}):l.a.createElement(c.EuiBasicTable,{items:m,columns:h})))},Vt=()=>{var e,t,a;const{params:{agentId:i,tabId:s=""}}=Object(r.useRouteMatch)(),{getHref:g}=Object(o.Nb)(),{isLoading:m,isInitialRequest:p,error:E,data:f,resendRequest:b}=Object(o.Ab)(i,{pollIntervalMs:5e3}),{isLoading:h,data:x,sendRequest:k}=Object(o.Bb)(null==f||null===(e=f.item)||void 0===e?void 0:e.policy_id),{application:{navigateToApp:M}}=Object(o.Tb)(),F=Object(o.Jb)(),S="true"===new URLSearchParams(Object(r.useLocation)().search).get("openReassignFlyout"),I=Object(n.useCallback)((()=>{F&&F.onDoneNavigateTo&&M(F.onDoneNavigateTo[0],F.onDoneNavigateTo[1])}),[F,M]),{diagnosticFileUploadEnabled:w}=O.b.get(),T=null==f||null===(t=f.item)||void 0===t||null===(a=t.local_metadata)||void 0===a?void 0:a.host,j=Object(n.useMemo)((()=>l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButtonEmpty,{iconType:"arrowLeft",href:g("agent_list"),flush:"left",size:"xs"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewAgentListTitle",defaultMessage:"View all agents"}))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{className:"eui-textBreakWord"},l.a.createElement("h1",null,m&&p?l.a.createElement(y.p,null):"object"==typeof T&&"string"==typeof(null==T?void 0:T.hostname)?T.hostname:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsTitle",defaultMessage:"Agent '{id}'",values:{id:i}})))))),[T,i,g,p,m]),C=Object(n.useMemo)((()=>{var e;return f&&f.item?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",gutterSize:"s",direction:"row"},!h&&!(null!=x&&null!==(e=x.item)&&void 0!==e&&e.is_managed)&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Pt,{agent:f.item,agentPolicy:null==x?void 0:x.item,assignFlyoutOpenByDefault:S,onCancelReassign:F&&F.onDoneNavigateTo?I:void 0})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Gt,{agent:null==f?void 0:f.item,agentPolicy:null==x?void 0:x.item})))):void 0}),[x,f,g,h]),A=Object(n.useMemo)((()=>{const e=[{id:"details",name:d.i18n.translate("xpack.fleet.agentDetails.subTabs.detailsTab",{defaultMessage:"Agent details"}),href:g("agent_details",{agentId:i,tabId:"details"}),isSelected:!s||"details"===s},{id:"logs",name:d.i18n.translate("xpack.fleet.agentDetails.subTabs.logsTab",{defaultMessage:"Logs"}),href:g("agent_details_logs",{agentId:i,tabId:"logs"}),isSelected:"logs"===s}];return w&&e.push({id:"diagnostics",name:d.i18n.translate("xpack.fleet.agentDetails.subTabs.diagnosticsTab",{defaultMessage:"Diagnostics"}),href:g("agent_details_diagnostics",{agentId:i,tabId:"diagnostics"}),isSelected:"diagnostics"===s}),e}),[g,i,s,w]);return l.a.createElement(Ye.Provider,{value:{refresh:()=>{b(),k()}}},l.a.createElement(v.c,{leftColumn:j,rightColumn:C,tabs:A},m&&p?l.a.createElement(y.p,null):E?l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.unexceptedErrorTitle",defaultMessage:"Error loading agent"}),error:E}):f&&f.item?l.a.createElement(Kt,{agent:f.item,agentPolicy:null==x?void 0:x.item}):l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.agentNotFoundErrorTitle",defaultMessage:"Agent not found"}),error:d.i18n.translate("xpack.fleet.agentDetails.agentNotFoundErrorDescription",{defaultMessage:"Cannot find agent ID {agentId}",values:{agentId:i}})})))},Kt=({agent:e,agentPolicy:t})=>(Object(o.ob)("agent_details",{agentHost:"object"==typeof e.local_metadata.host&&"string"==typeof e.local_metadata.host.hostname?e.local_metadata.host.hostname:"-"}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:x.g.agent_details_logs,render:()=>l.a.createElement(At,{agent:e,agentPolicy:t})}),l.a.createElement(r.Route,{path:x.g.agent_details_diagnostics,render:()=>l.a.createElement($t,{agent:e})}),l.a.createElement(r.Route,{path:x.g.agent_details,render:()=>l.a.createElement(Ut,{agent:e,agentPolicy:t})}))),Yt=Object(r.withRouter)((({actionSection:e,title:t,modalClosePath:a,children:n})=>l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceAround"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiPageContent_Deprecated,null,l.a.createElement(c.EuiEmptyPrompt,{iconType:"logoBeats",title:l.a.createElement("h2",null,t),body:n,actions:e})))))),Qt=Object(u.injectI18n)((({intl:e})=>l.a.createElement(Yt,{title:e.formatMessage({id:"xpack.fleet.noAccess.accessDeniedTitle",defaultMessage:"Access denied"}),actionSection:[]},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.noAccess.accessDeniedDescription",defaultMessage:"You are not authorized to access Elastic Fleet. To use Elastic Fleet, you need a user role that contains All permissions for this application."}))))),Jt=()=>{var e;Object(o.ob)("agent_list");const t=Object(r.useHistory)(),{agents:a}=Object(o.qb)(),n=Object(o.nb)().fleet.all,i=Object(o.tb)(),s=Object(o.ub)();if(!a.enabled)return null;if(!i.missingRequirements&&i.isLoading)return l.a.createElement(y.p,null);if(i.error)return l.a.createElement(v.d,null,l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentsInitializationErrorMessageTitle",defaultMessage:"Unable to initialize central management for Elastic Agents"}),error:i.error}));const d=1===(null==i||null===(e=i.missingRequirements)||void 0===e?void 0:e.length)&&"fleet_server"===i.missingRequirements[0],g=i.forceDisplayInstructions||d;if(!d&&i.missingRequirements&&i.missingRequirements.length>0)return l.a.createElement(Ke.b,{missingRequirements:i.missingRequirements});if(!n)return l.a.createElement(Qt,null);const m=g?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>s.openEnrollmentFlyout(),"data-test-subj":"addAgentBtnTop"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addAgentButton",defaultMessage:"Add Agent"}))))):void 0;return l.a.createElement(r.Router,{history:t},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:x.g.agent_details},l.a.createElement(Vt,null)),l.a.createElement(r.Route,{path:x.g.agents},l.a.createElement(v.a,{section:"agents",rightColumn:m},g?l.a.createElement(Ke.a,{showEnrollmentRecommendation:!1}):l.a.createElement(Ve,null)))))};var Zt=a(21);var Xt=a(5),ea=a(108),ta=a(192),aa=a(105),na=a(112);function la({agentCount:e,selectedPolicyTab:t,newAgentPolicy:a,withSysMonitoring:l,queryParamsPolicyId:i,packageInfo:s}){const{notifications:c}=Object(o.Tb)(),u=Object(h.u)(),[g,m]=Object(n.useState)(),[p,E]=Object(n.useState)("VALID"),[f,b]=Object(n.useState)(),[y,x]=Object(n.useState)({name:"",description:"",namespace:"default",policy_id:"",enabled:!0,inputs:[]}),[v,k]=Object(n.useState)(),[M,F]=Object(n.useState)(!1),S=!!v&&Object(na.f)(v),I=Object(n.useCallback)((e=>{e?(b(e),s&&F(!1)):(F(!0),b(void 0)),console.debug("Agent policy updated",e)}),[s,b]),w=Object(n.useCallback)((e=>{if(s){const t=Object(na.d)(e||y,s,aa.safeLoad);return k(t),console.debug("Package policy validation results",t),t}}),[y,s]),T=Object(n.useCallback)((e=>{const a={...y,...e};x(a),console.debug("Package policy updated",a);const n=w(a),l=a.package,i=!!n&&Object(na.f)(n),s=a.policy_id&&""!==a.policy_id;!l||!s&&t!==ea.b.NEW||i?E("INVALID"):E("VALID")}),[y,E,w,t]),j=(e=>{const{packagePolicy:t,queryParamsPolicyId:a}=e,l=Object(o.Jb)(),i=Object(n.useRef)(!0),{getPath:s}=Object(o.Nb)(),c=Object(r.useHistory)(),{application:{navigateToApp:u}}=Object(o.Tb)();return Object(n.useEffect)((()=>()=>{i.current=!1}),[]),Object(n.useCallback)(((e,n=[])=>{if(!i.current)return;const r=s("policy_details",{policyId:t.policy_id});if(null!=l&&l.onSaveNavigateTo&&e){const[t,i]=l.onSaveNavigateTo;if(null!=i&&i.path){const s=function({path:e,policy:t,paramsToApply:a,mappingOptions:n={}}){const[l,i]=e.split("?"),s=Object(Zt.parse)(i);a.forEach((e=>{const a=n[e];if(a){const[n,o]=(l=e,i=a,r=t.policy_id,i?"boolean"==typeof i&&i?[l,"true"]:[i.renameKey?i.renameKey:l,i.policyIdAsValue?r:"true"]:[]);n&&o&&(s[n]=o)}var l,i,r}));const r=Object(Zt.stringify)(s);return l+(r?`?${r}`:"")}({path:a?r:i.path,policy:e,mappingOptions:l.onSaveQueryParams,paramsToApply:n});u(t,{...i,path:s})}else u(...l.onSaveNavigateTo)}else c.push(r)}),[t.policy_id,s,u,c,l,a])})({packagePolicy:y,queryParamsPolicyId:i}),C=Object(n.useCallback)((async({force:n,overrideCreatedAgentPolicy:i}={})=>{var r,g;if("VALID"===p&&S)return void E("INVALID");if(0!==e&&"CONFIRM"!==p)return void E("CONFIRM");let h=i;if(t===ea.b.NEW&&!i)try{var x,v;if(E("LOADING"),null!==(x=l||(null===(v=a.monitoring_enabled)||void 0===v?void 0:v.length))&&void 0!==x&&x){var k,M;const e=[];s&&e.push(s.name),l&&e.push(A.FLEET_SYSTEM_PACKAGE),null!==(k=null===(M=a.monitoring_enabled)||void 0===M?void 0:M.length)&&void 0!==k&&k&&e.push(A.FLEET_ELASTIC_AGENT_PACKAGE),e.length>0&&await Object(o.h)([...new Set(e)])}h=await async function({packagePolicy:e,newAgentPolicy:t,withSysMonitoring:a}){var n;const l=(null==e||null===(n=e.package)||void 0===n?void 0:n.name)===A.FLEET_SYSTEM_PACKAGE,i=await Object(o.j)(t,{withSysMonitoring:a&&!l});if(i.error)throw i.error;if(!i.data)throw new Error("Invalid agent policy creation no data");return i.data.item}({newAgentPolicy:a,packagePolicy:y,withSysMonitoring:l}),b(h),T({policy_id:h.id})}catch(e){return E("VALID"),void c.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"})})}E("LOADING");const{error:F,data:I}=await async function(e){return await Object(o.l)(e)}({...y,policy_id:null!==(r=null===(g=h)||void 0===g?void 0:g.id)&&void 0!==r?r:y.policy_id,force:n});if(E(e?"SUBMITTED":"SUBMITTED_NO_AGENTS"),F){if(Object(O.o)(F))return E("VALID"),void(await u(y.package)&&C({overrideCreatedAgentPolicy:h,force:!0}));c.toasts.addError(F,{title:"Error"}),E("VALID")}else{m(I.item);const t=e&&f;if(!t)return void E("SUBMITTED_NO_AGENTS");j(I.item),c.toasts.addSuccess({title:d.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationTitle",{defaultMessage:"'{packagePolicyName}' integration added.",values:{packagePolicyName:y.name}}),text:t?d.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationMessage",{defaultMessage:"Fleet will deploy updates to all agents that use the '{agentPolicyName}' policy.",values:{agentPolicyName:f.name}}):void 0,"data-test-subj":"packagePolicyCreateSuccessToast"})}}),[p,S,e,t,y,c.toasts,f,j,u,a,T,l,s]);return{agentPolicy:f,updateAgentPolicy:I,packagePolicy:y,updatePackagePolicy:T,savedPackagePolicy:g,onSubmit:C,formState:p,setFormState:E,hasErrors:S,validationResults:v,setValidationResults:k,hasAgentPolicyError:M,setHasAgentPolicyError:F,navigateAddAgent:e=>j(e,["openEnrollmentFlyout"]),navigateAddAgentHelp:e=>j(e,["showAddAgentHelp"])}}const ia=m()(c.EuiSteps).withConfig({displayName:"StepsWithLessPadding",componentId:"sc-clu1jx-0"})([".euiStep__content{padding-bottom:",";}@media (max-width:","){margin-bottom:100px;}"],(e=>e.theme.eui.euiSizeM),(e=>e.theme.eui.euiBreakpoints.m)),sa=m()(c.EuiBottomBar).withConfig({displayName:"CustomEuiBottomBar",componentId:"sc-clu1jx-1"})(["z-index:50;"]),ra=({from:e,queryParamsPolicyId:t,prerelease:a})=>{var i,s;const{agents:{enabled:g}}=Object(o.qb)(),{params:m}=Object(r.useRouteMatch)(),[p,E]=Object(n.useState)({name:"Agent policy 1",description:"",namespace:"default",monitoring_enabled:Object.values(S.db)}),[f,b]=Object(n.useState)(!0),h=Object(k.h)(p),[x,v]=Object(n.useState)(t?ea.b.EXISTING:ea.b.NEW),{pkgName:M,pkgVersion:w}=Object(Xt.M)(m.pkgkey),{data:T,error:j,isLoading:C}=Object(o.Eb)(M,w,{full:!0,prerelease:a}),A=Object(n.useMemo)((()=>{if(T&&T.item)return T.item}),[T]),[P,L]=Object(n.useState)(0),{onSubmit:D,updatePackagePolicy:_,packagePolicy:B,agentPolicy:N,updateAgentPolicy:R,savedPackagePolicy:z,formState:H,setFormState:q,navigateAddAgent:U,navigateAddAgentHelp:G,setHasAgentPolicyError:W,validationResults:$,hasAgentPolicyError:V}=la({agentCount:P,packageInfo:A,newAgentPolicy:p,selectedPolicyTab:x,withSysMonitoring:f,queryParamsPolicyId:t}),K=Object(n.useCallback)(((e,t)=>{e===ea.b.NEW&&(t.name&&""!==t.name.trim()&&t.namespace&&""!==t.namespace.trim()?W(!1):W(!0))}),[W]),Y=Object(n.useCallback)((e=>{const t={...p,...e};E(t),K(x,t)}),[E,K,p,x]),Q=Object(n.useCallback)((e=>{v(e),K(e,p)}),[v,K,p]),J=null==N?void 0:N.id,{cancelClickHandler:Z,cancelUrl:X}=(e=>{const{from:t,pkgkey:a,agentPolicyId:l}=e,{application:{navigateToApp:i}}=Object(o.Tb)(),s=Object(o.Jb)(),{getHref:r}=Object(o.Nb)();return{cancelClickHandler:Object(n.useCallback)((e=>{null!=s&&s.onCancelNavigateTo&&(e.preventDefault(),i(...s.onCancelNavigateTo))}),[s,i]),cancelUrl:Object(n.useMemo)((()=>s&&s.onCancelUrl?s.onCancelUrl:"policy"===t&&l?r("policy_details",{policyId:l}):r("integration_details_overview",{pkgkey:a})),[s,t,l,r,a])}})({from:e,pkgkey:m.pkgkey,agentPolicyId:J});Object(n.useEffect)((()=>{g&&J&&(async()=>{const{data:e}=await Object(o.v)({policyId:J});void 0!==(null==e?void 0:e.results.total)&&L(e.results.total)})()}),[J,g]);const ee=Object(n.useCallback)((({isValid:e,updatedPolicy:t})=>{_(t),q((t=>"VALID"!==t||e?t:"INVALID"))}),[_,q]),{devtoolRequest:te,devtoolRequestDescription:ae,showDevtoolsRequest:ne}=function({newAgentPolicy:e,packagePolicy:t,packageInfo:a,selectedPolicyTab:l,withSysMonitoring:i}){var s;const{showDevtoolsRequest:r}=O.b.get(),o=!S.K.includes(null!==(s=null==a?void 0:a.name)&&void 0!==s?s:"")&&r,[c,u]=Object(n.useMemo)((()=>{if(l===ea.b.NEW){var a;const n=(null==t||null===(a=t.package)||void 0===a?void 0:a.name)===S.I;return[`${Object(I.a)(e,i&&!n)}\n\n${Object(I.b)({...t})}`,d.i18n.translate("xpack.fleet.createPackagePolicy.devtoolsRequestWithAgentPolicyDescription",{defaultMessage:"These Kibana requests create a new agent policy and a new package policy."})]}return[Object(I.b)({...t}),d.i18n.translate("xpack.fleet.createPackagePolicy.devtoolsRequestDescription",{defaultMessage:"This Kibana request creates a new package policy."})]}),[t,e,i,l]);return{showDevtoolsRequest:o,devtoolRequest:c,devtoolRequestDescription:u}}({newAgentPolicy:p,packagePolicy:B,selectedPolicyTab:x,withSysMonitoring:f,packageInfo:A}),le=Object(n.useMemo)((()=>{var e;return m.integration?null==A||null===(e=A.policy_templates)||void 0===e?void 0:e.find((e=>e.name===m.integration)):void 0}),[null==A?void 0:A.policy_templates,m]),ie=Object(n.useMemo)((()=>({from:e,cancelUrl:X,onCancel:Z,agentPolicy:N,packageInfo:A,integrationInfo:le})),[N,Z,X,e,le,A]),se=Object(n.useMemo)((()=>l.a.createElement(ea.e,{agentPolicy:N,updateAgentPolicy:R,newAgentPolicy:p,updateNewAgentPolicy:Y,withSysMonitoring:f,updateSysMonitoring:e=>b(e),validation:h,packageInfo:A,setHasAgentPolicyError:W,updateSelectedTab:Q,selectedAgentPolicyId:t})),[A,N,R,p,Y,h,f,Q,t,W]),re=Object(o.Vb)(null!==(i=null===(s=B.package)||void 0===s?void 0:s.name)&&void 0!==i?i:"","package-policy-create"),oe=Object(n.useMemo)((()=>{var e;return C?l.a.createElement(y.p,null):A?l.a.createElement(l.a.Fragment,null,l.a.createElement(ea.d,{agentPolicy:N,packageInfo:A,packagePolicy:B,updatePackagePolicy:_,validationResults:$,submitAttempted:"INVALID"===H,integrationToEnable:null==le?void 0:le.name}),!re&&l.a.createElement(ea.c,{packageInfo:A,showOnlyIntegration:null==le?void 0:le.name,packagePolicy:B,updatePackagePolicy:_,validationResults:$,submitAttempted:"INVALID"===H}),re&&(null===(e=B.package)||void 0===e?void 0:e.name)&&l.a.createElement(y.k,null,l.a.createElement(re.Component,{newPolicy:B,onChange:ee}))):l.a.createElement("div",null)}),[C,N,A,B,_,$,H,null==le?void 0:le.name,re,ee]),ce=[{title:d.i18n.translate("xpack.fleet.createPackagePolicy.stepConfigurePackagePolicyTitle",{defaultMessage:"Configure integration"}),"data-test-subj":"dataCollectionSetupStep",children:oe},{title:d.i18n.translate("xpack.fleet.createPackagePolicy.stepSelectAgentPolicyTitle",{defaultMessage:"Where to add this integration?"}),children:se}];return j?l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:j}):l.a.createElement(ta.a,F()({},ie,{"data-test-subj":"createPackagePolicy"}),l.a.createElement(c.EuiErrorBoundary,null,"CONFIRM"===H&&N&&l.a.createElement(k.f,{agentCount:P,agentPolicy:N,onConfirm:D,onCancel:()=>q("VALID")}),"SUBMITTED_NO_AGENTS"===H&&N&&A&&l.a.createElement(ta.b,{packageInfo:A,agentPolicy:N,onConfirm:()=>U(z),onCancel:()=>G(z)}),A&&l.a.createElement(ea.a,{pkgTitle:(null==le?void 0:le.title)||A.title,pkgkey:Object(O.r)(A),integration:null==le?void 0:le.name}),l.a.createElement(ia,{steps:ce}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(sa,{"data-test-subj":"integrationsBottomBar"},l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},A&&("INVALID"===H||V)?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorOnSaveText",defaultMessage:"Your integration policy has errors. Please fix them before saving."}):null),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",href:X,onClick:Z,"data-test-subj":"createPackagePolicyCancelButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.cancelButton",defaultMessage:"Cancel"}))),ne?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.h,{request:te,description:ae,btnProps:{color:"ghost"}})):null,l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{onClick:()=>D(),isLoading:"LOADING"===H,disabled:"VALID"!==H||V||!$,iconType:"save",color:"primary",fill:!0,"data-test-subj":"createPackagePolicySaveButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.saveButton",defaultMessage:"Save and continue"})))))))))};var oa=a(12);const ca="fleet-first-agent-policy",ua=Object.freeze({id:ca,name:d.i18n.translate("xpack.fleet.createPackagePolicy.firstAgentPolicyNameText",{defaultMessage:"My first agent policy"}),namespace:"default",monitoring_enabled:["logs","metrics"]}),da=oa.m.bind(null,ua);const ga=e=>{const{discover:t}=Object(oa.oc)(),[a,l]=Object(n.useState)(null);return Object(n.useEffect)((()=>{(async()=>{if(t&&t.locator){const a=await t.locator.getUrl({indexPatternId:"logs-*",timeRange:{from:"now-1h",to:"now",mode:"relative"},filters:[{meta:{alias:"Recently enrolled agents",index:"logs-*"},query:{terms:{"agent.id":e}}}]});l(a)}})()}),[t,e]),a},ma=m()("h1").withConfig({displayName:"CentralTitle",componentId:"sc-n46lf8-0"})(["text-align:center;"]),pa=({children:e})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiTitle,{size:"l"},l.a.createElement(ma,null,e)),l.a.createElement(c.EuiSpacer,{size:"xl"})),Ea=m()(c.EuiText).withConfig({displayName:"SubtitleText",componentId:"sc-n46lf8-1"})(["max-width:250px;margin:0 auto;text-align:center;"]),fa=m()(c.EuiStepNumber).withConfig({displayName:"CenteredEuiStepNumber",componentId:"sc-n46lf8-2"})(["margin:0 auto;"]),ba=e=>l.a.createElement("div",{style:{margin:"0 auto"}},l.a.createElement(c.EuiImage,e)),ha=({children:e})=>{const t=Object(c.useIsWithinMaxBreakpoint)("s");return l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:t?"xs":"l",alignItems:"center",justifyContent:"center",wrap:!0},e)},ya=()=>{const{http:e}=Object(o.Tb)(),t=e.basePath.prepend("/plugins/fleet/assets/");return l.a.createElement(c.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceEvenly",gutterSize:"none"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ha,null,l.a.createElement(c.EuiFlexItem,null,l.a.createElement(fa,{status:"incomplete",number:1})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement("div",{style:{margin:"0 auto"}},l.a.createElement(ba,{alt:"Illustration of installing the Elastic Agent",src:t+"1_install_agent.svg"}))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{textAlign:"center"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentStepTitle",defaultMessage:"Install Elastic Agent"}))),l.a.createElement(Ea,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentStep",defaultMessage:"Install agents on the hosts that you want to connect to Elastic."}))))),l.a.createElement(c.EuiShowFor,{sizes:["s","xs"]},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiSpacer,{size:"xl"}))),l.a.createElement(c.EuiHideFor,{sizes:["s","xs"]},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ba,{alt:"Illustration of an arrow pointing from left to right",src:t+"arrow_right_curve_over.svg"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ha,null,l.a.createElement(c.EuiFlexItem,null,l.a.createElement(fa,{status:"incomplete",number:2})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(ba,{alt:"Illustration of adding an integration",src:t+"2_add_integration.svg"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{textAlign:"center"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationStepTitle",defaultMessage:"Add the integration"}))),l.a.createElement(Ea,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationStep",defaultMessage:"Make a few selections to finalize how Elastic receives your data."}))))),l.a.createElement(c.EuiShowFor,{sizes:["s","xs"]},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiSpacer,{size:"xl"}))),l.a.createElement(c.EuiHideFor,{sizes:["s","xs"]},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ba,{alt:"Illustration of an arrow pointing from left to right",src:t+"arrow_right_curve_under.svg"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(ha,null,l.a.createElement(c.EuiFlexItem,null,l.a.createElement(fa,{status:"incomplete",number:3})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(ba,{alt:"Illustration of a dashboard with data",src:t+"3_confirm_data.svg"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{textAlign:"center"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.confirmDataStepTitle",defaultMessage:"Confirm incoming data"}))),l.a.createElement(Ea,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.confirmDataStep",defaultMessage:"Explore and analyze the incoming data."}))))))},xa=m()("div").withConfig({displayName:"NotObscuredByBottomBar",componentId:"sc-n46lf8-3"})(["padding-bottom:100px;"]),va=()=>{const{docLinks:e}=Object(o.Tb)();return l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceAround"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiLink,{href:e.links.fleet.elasticAgent,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.learnMoreLink",defaultMessage:"Learn more about installing Elastic Agent"}))))},ka=({integrationInfo:e,packageInfo:t,isLoading:a,error:n,cancelUrl:i,cancelClickHandler:s,onNext:r})=>{if(n)return l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:n});const o=l.a.createElement(pa,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.pageTitle",defaultMessage:"Ready to add your first integration?"}));return l.a.createElement(v.c,{topContent:o},l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"xxl"}),l.a.createElement(c.EuiSpacer,{size:"xxl"}),l.a.createElement(ya,null),l.a.createElement(c.EuiSpacer,{size:"xxl"}),l.a.createElement(c.EuiSpacer,{size:"xxl"}),l.a.createElement(xa,null,l.a.createElement(va,null)),l.a.createElement(Ia,{cancelUrl:i,cancelMessage:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.skipAddAgentButton",defaultMessage:"Add integration only (skip agent installation)"}),cancelClickHandler:s,isLoading:a,onNext:r,noAnimation:!0,actionMessage:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentButton",defaultMessage:"Install Elastic Agent"})}),t&&l.a.createElement(ea.a,{pkgTitle:(null==e?void 0:e.title)||t.title,pkgkey:Object(O.r)(t),integration:null==e?void 0:e.name})))},Ma=m()(c.EuiBottomBar).withConfig({displayName:"CenteredRoundedBottomBar",componentId:"sc-1tr5jdr-0"})(["max-width:820px;margin:0 auto;border-radius:8px 8px 0px 0px;"]),Fa=m()(Ma).withConfig({displayName:"NoAnimationCenteredRoundedBottomBar",componentId:"sc-1tr5jdr-1"})(["animation-delay:-99s;#stop bottom bar flying in on step change"]),Sa=m()("div").withConfig({displayName:"NotObscuredByBottomBar",componentId:"sc-1tr5jdr-2"})(["padding-bottom:100px;"]),Ia=({isLoading:e,loadingMessage:t,onNext:a,cancelClickHandler:n,cancelUrl:i,actionMessage:s,cancelMessage:r,isDisabled:o=!1,noAnimation:d=!1})=>{const g=d?Fa:Ma;return l.a.createElement(g,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",size:"s",href:i,onClick:n},r||l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.backButton",defaultMessage:"Go back"})))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"primary",fill:!0,size:"m",isDisabled:o,isLoading:!o&&e,onClick:a},e?t||l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.loading",defaultMessage:"Loading..."}):s))))},Oa=({onNext:e,cancelClickHandler:t,cancelUrl:a,noAnimation:n=!1})=>{const i=n?Fa:Ma;return l.a.createElement(i,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",size:"s",href:a,onClick:t},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentStandaloneBottomBar.backButton",defaultMessage:"Go back"})))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"primary",fill:!0,size:"m",onClick:e},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentStandaloneBottomBar.viewIncomingDataBtn",defaultMessage:"View incoming data"})))))},wa=({pkgkey:e})=>{const t=e.includes(A.FLEET_KUBERNETES_PACKAGE),{getHref:a}=Object(oa.gc)(),{getAbsolutePath:n}=Object(oa.gc)();return l.a.createElement(Ma,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",size:"s",href:a("integrations_all")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.addAnotherIntegration",defaultMessage:"Add another integration"})))),!t&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"success",fill:!0,size:"m",href:a("integration_details_assets",{pkgkey:e})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.viewDataAssetsButtonText'",defaultMessage:"View assets"}))),t&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"success",fill:!0,size:"m",href:n("/app/dashboards#/view/kubernetes-f4dc26db-1b53-4ea2-a78b-1bfab8ea267c")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData. '",defaultMessage:"View Kubernetes metrics dashboards"})))))},Ta=({troubleshootLink:e,agentIds:t,integration:a})=>{const n=ga(t);return l.a.createElement(Ma,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",size:"s",href:e,iconType:"popout",target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.troubleshootLinkBottomBar",defaultMessage:"Troubleshooting guide"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"success",fill:!0,href:null!=n?n:""},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.discoverLogsLink",defaultMessage:"View incoming {integration} logs",values:{integration:null!=a?a:""}})))))},ja=e=>{const{packageInfo:t,integrationInfo:a,steps:n,currentStep:i,error:s}=e;if(s)return l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:s});const r=n[i].component,o=l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,{size:"l",className:"eui-textCenter"},l.a.createElement("h1",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.multiPageTitle",defaultMessage:"Set up {title} integration",values:{title:t.title}}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Pa,{currentStep:i,steps:n.map((e=>e.title))}),l.a.createElement(c.EuiSpacer,{size:"xl"}));return l.a.createElement(v.c,{topContent:o,restrictHeaderWidth:866,restrictWidth:866},l.a.createElement(r,e),t&&l.a.createElement(ea.a,{pkgTitle:(null==a?void 0:a.title)||t.title,pkgkey:Object(O.r)(t),integration:null==a?void 0:a.name}))},Ca=m()(c.EuiStepsHorizontal).withConfig({displayName:"NumberlessHorizontalSteps",componentId:"sc-13a0okp-0"})([".euiStepNumber{color:transparent;width:16px;height:16px;outline-color:#07c;}.euiStepHorizontal::before{width:calc(50% - 8px);top:32px;}.euiStepHorizontal::after{width:calc(50% - 8px);top:32px;}.euiStepHorizontal{padding:25px 16px 16px;}.euiStepHorizontal-isIncomplete .euiStepHorizontal__title{color:#69707d;}"]),Aa=(e,t,a)=>e===t?a?"complete":"current":e>t?"complete":"incomplete",Pa=({steps:e,currentStep:t=0,currentStepComplete:a=!1})=>{const n=e.map(((e,n)=>({title:e,status:Aa(t,n,a),onClick:()=>{}})));return l.a.createElement(Ca,{steps:n})};var La=a(134),Da=a(120),_a=a(155);var Ba=m()(c.EuiCodeBlock).withConfig({displayName:"_StyledEuiCodeBlock",componentId:"sc-90w1ry-1"})(["max-width:1100px;"]);const Na=e=>{const{cancelUrl:t,onNext:a,cancelClickHandler:i,setIsManaged:s,agentPolicy:r,enrollmentAPIKey:o,fleetServerHosts:g,enrolledAgentIds:p}=e,E=Object(oa.oc)(),{docLinks:f}=E,b=f.links.fleet.troubleshooting,h=Object(oa.ec)(),[x,v]=Object(n.useState)(!1),[k,M]=Object(n.useState)(!1);if(!o)return l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:"Enrollment API key not found"});const F="kubernetes"===e.packageInfo.name?"IS_KUBERNETES_MULTIPAGE":"IS_NOT_KUBERNETES",S=Object(_a.a)(o.api_key,g,h),I=[Object(Da.f)({installCommand:S,apiKeyData:{item:o},enrollToken:o.api_key,isK8s:F,selectedApiKeyId:o.id,isComplete:x||!!p.length,fullCopyButton:!0,onCopy:()=>v(!0)})];return"IS_KUBERNETES_MULTIPAGE"===F&&I.push((({isComplete:e,fullCopyButton:t,onCopy:a})=>{const[i,s]=Object(n.useState)(!1),r=m.a.pre.withConfig({displayName:"CommandCode",componentId:"sc-90w1ry-0"})({overflow:"auto"});return{status:e?"complete":void 0,title:d.i18n.translate("xpack.fleet.agentEnrollment.stepKubernetesApplyManifest",{defaultMessage:"Run the apply command"}),children:l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,null,l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentEnrollment.kubernetesCommandInstructions",defaultMessage:"From the directory where the manifest is downloaded, run the apply command."}),l.a.createElement(c.EuiSpacer,{size:"m"})),l.a.createElement(Ba,{onClick:()=>{a&&a()},fontSize:"m",isCopyable:!t,paddingSize:"m"},l.a.createElement(r,null,"kubectl apply -f elastic-agent-managed-kubernetes.yaml")),l.a.createElement(c.EuiSpacer,{size:"s"}),t&&l.a.createElement(c.EuiCopy,{textToCopy:"kubectl apply -f elastic-agent-managed-kubernetes.yaml"},(e=>l.a.createElement(c.EuiButton,{color:"primary",iconType:"copyClipboard",size:"m",onClick:()=>(e=>{e(),s(!0),a&&a()})(e)},i?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.copyButtonClicked",defaultMessage:"Copied"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.copyButton",defaultMessage:"Copy to clipboard"})))))}})({isComplete:k||!!p.length,fullCopyButton:!0,onCopy:()=>M(!0)})),I.push(Object(Da.a)({selectedPolicyId:null==r?void 0:r.id,troubleshootLink:b,agentCount:p.length,showLoading:!0,poll:x})),l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addIntegration.installAgentStepTitle",defaultMessage:"These steps configure and enroll the Elastic Agent in Fleet to automatically deploy updates and centrally manage the agent. As an alternative to Fleet, advanced users can run agents in {standaloneLink}.",values:{standaloneLink:l.a.createElement(c.EuiLink,{onClick:()=>s(!1)},"standalone mode")}})),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSteps,{steps:I}),!!p.length&&l.a.createElement(l.a.Fragment,null,l.a.createElement(Sa,null),l.a.createElement(Ia,{cancelUrl:t,cancelClickHandler:i,onNext:a,actionMessage:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationButton",defaultMessage:"Add the integration"})})))};var Ra=a(2);const za=e=>{const{setIsManaged:t,agentPolicy:a,cancelUrl:i,onNext:s,cancelClickHandler:r}=e,o=Object(oa.oc)(),d=Object(oa.ec)(),[g,m]=Object(n.useState)(""),[p,E]=Object(n.useState)(!1),[f,b]=Object(n.useState)(!1),[h,x]=Object(n.useState)();if(Object(n.useEffect)((()=>{!async function(){try{if(null==a||!a.id)return;const e={standalone:!0,kubernetes:!1},t=await Object(oa.I)(null==a?void 0:a.id,e);if(t.error)throw t.error;if(!t.data)throw new Error("No data while fetching full agent policy");x(t.data.item)}catch(e){o.notifications.toasts.addError(e,{title:"Error"})}}()}),[o.http.basePath,null==a?void 0:a.id,o.notifications.toasts]),Object(n.useEffect)((()=>{h&&m(Object(Ra.n)(h,aa.safeDump))}),[h]),!a)return l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:"Agent policy not provided"});const v=Object(_a.b)(d),k=o.http.basePath.prepend(`${Ra.c.getInfoFullDownloadPath(null==a?void 0:a.id)}?standalone=true`),M=[Object(Da.d)({selectedPolicyId:null==a?void 0:a.id,yaml:g,downloadLink:k,isComplete:f,onCopy:()=>b(!0)}),Object(Da.g)({installCommand:v,isComplete:g&&p,fullCopyButton:!0,onCopy:()=>E(!0)})];return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ua,{setIsManaged:t}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSteps,{steps:M}),p&&l.a.createElement(l.a.Fragment,null,l.a.createElement(Sa,null),l.a.createElement(Oa,{cancelUrl:i,onNext:s,cancelClickHandler:r})))},Ha=({children:e})=>{const[t,a]=Object(n.useState)(!1);return l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"column"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"row"},l.a.createElement(c.EuiFlexItem,null),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{size:"s",iconType:t?"arrowUp":"arrowDown",iconSide:"right",onClick:()=>a(!t),flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.stepConfigure.advancedOptionsToggleLinkText",defaultMessage:"Advanced options"}))))),t&&l.a.createElement(c.EuiFlexItem,null,e)))},qa=({error:e,title:t})=>l.a.createElement(y.i,{title:t||l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addIntegration.errorTitle",defaultMessage:"Error adding integration"}),error:e}),Ua=({setIsManaged:e})=>l.a.createElement(c.EuiCallOut,{title:"Setting up to run Elastic Agent in standalone mode",color:"primary",iconType:"iInCircle"},l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addIntegration.standaloneWarning",defaultMessage:"Setting up integrations by running Elastic Agent in standalone mode is advanced. When possible, we recommend using {link} instead. ",values:{link:l.a.createElement(c.EuiLink,{href:"#"},"Fleet-managed agents")}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiButton,{onClick:()=>e(!0),color:"primary"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addIntegration.switchToManagedButton",defaultMessage:"Enroll in Fleet instead (recommended)"})));var Ga=a(30),Wa=a(368),$a=a.n(Wa),Va=a(163);const Ka=({agentIds:e,troubleshootLink:t,packageInfo:a})=>{var n;const i=ga(e);return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,null,l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.title",defaultMessage:"Confirming data is taking longer than expected"}))),l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.body",defaultMessage:"If the system is not generating data, it may help to generate some to ensure data is being collected correctly. If you're having trouble, see our {troubleshootLink}, or you may check later by viewing {discoverLink}.",values:{troubleshootLink:l.a.createElement(c.EuiLink,{external:!0,href:t,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.troubleshootLink",defaultMessage:"troubleshooting guide"})),discoverLink:l.a.createElement(c.EuiLink,{external:!0,href:null!=i?i:"",target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.discoverLink",defaultMessage:"{integration} logs in Discover",values:{integration:null!==(n=null==a?void 0:a.title)&&void 0!==n?n:""}}))}})),l.a.createElement(Sa,null),l.a.createElement(Ta,{agentIds:e,troubleshootLink:t,integration:null==a?void 0:a.title}))},Ya=["agent.ephemeral_id","agent.id","elastic_agent.id","data_stream.namespace","@timestamp"],Qa=m()(c.EuiDescriptionList).withConfig({displayName:"CleanOverflowDescriptionList",componentId:"sc-1qg5bo1-0"})(["overflow:hidden;max-height:125px;word-break:break-all;white-space:pre-wrap;"]),Ja=m()("pre").withConfig({displayName:"CompressedPre",componentId:"sc-1qg5bo1-1"})(["&&&{background:none;padding:0 0;}"]),Za=({hit:e})=>{const t=$a()(Object(Ga.getFlattenedObject)(e._source),Ya),a=Object.entries(t).map((([e,t])=>({title:`${e}:`,description:JSON.stringify(t)})));return l.a.createElement("pre",null,l.a.createElement("code",null,l.a.createElement(Qa,{listItems:a,type:"inline",align:"left",compressed:!0})))},Xa=({hit:e})=>{const t=(null==e?void 0:e._source)||{},a=(null==t?void 0:t["@timestamp"])||"-";return l.a.createElement(c.EuiText,{size:"xs"},l.a.createElement(Ja,null,a?Object(c.formatDate)(a,"MMM D, YYYY @ HH:mm:ss.SSS"):"-"))},en=({dataPreview:e})=>{const t=e.slice(0,5);return l.a.createElement(l.a.Fragment,null,t.map((e=>l.a.createElement("div",{id:e._id},l.a.createElement(c.EuiFlexGroup,{gutterSize:"xs"},l.a.createElement(c.EuiFlexItem,{style:{minWidth:"220px"}},l.a.createElement(Xa,{hit:e})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Za,{hit:e}))),l.a.createElement(c.EuiHorizontalRule,{margin:"s"})))))},tn=({agentIds:e,packageInfo:t,agentDataConfirmed:a,setAgentDataConfirmed:n,troubleshootLink:i})=>{const{incomingData:s,dataPreview:r,isLoading:o,hasReachedTimeout:g}=Object(Va.b)(e,!0,5),{enrolledAgents:m,numAgentsWithData:p}=Object(Va.a)(s,t),E=Object(oa.cc)(null==t?void 0:t.name),{guidedOnboarding:f}=Object(oa.oc)();var b;return!o&&m>0&&p>0&&(n(!0),E&&(null===(b=f.guidedOnboardingApi)||void 0===b||b.completeGuidedOnboardingForIntegration(null==t?void 0:t.name))),a?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiCallOut,{"data-test-subj":"IncomingDataConfirmedCallOut",title:d.i18n.translate("xpack.fleet.confirmIncomingDataWithPreview.title",{defaultMessage:"Incoming data received from {numAgentsWithData} enrolled { numAgentsWithData, plural, one {agent} other {agents}}.",values:{numAgentsWithData:p}}),color:"success",iconType:"check"}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiText,null,l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.previewTitle",defaultMessage:"Preview of incoming data:"}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(en,{dataPreview:r})):l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,null,l.a.createElement(c.EuiCallOut,{size:"m",color:"primary",iconType:c.EuiLoadingSpinner,title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.listening",defaultMessage:"Listening for incoming data from enrolled agents..."})}),l.a.createElement(c.EuiSpacer,{size:"m"}),g?l.a.createElement(Ka,{agentIds:e,troubleshootLink:i,packageInfo:t}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.loading",defaultMessage:"It might take a few minutes for the data to get to Elasticsearch. If you're not seeing any, try generating some to verify. If you're having trouble connecting, check out the {link}.",values:{link:l.a.createElement(c.EuiLink,{target:"_blank",external:!0,href:i},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.troubleshootingLink",defaultMessage:"troubleshooting guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiLoadingContent,{lines:10}))},an=({troubleshootLink:e})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,null,l.a.createElement(c.EuiCallOut,{size:"m",color:"primary",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.title",defaultMessage:"Data preview is not available for standalone agents. "})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.description",defaultMessage:"You can check for agent data in the integration asset tab. If you're having trouble seeing data, check out the {link}.",values:{link:l.a.createElement(c.EuiLink,{target:"_blank",external:!0,href:e},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.troubleshootingLink",defaultMessage:"troubleshooting guide"}))}})))),nn={title:d.i18n.translate("xpack.fleet.createFirstPackagePolicy.installAgentStepTitle",{defaultMessage:"Install Elastic Agent"}),component:e=>{var t;const[a,i]=Object(n.useState)(e.isManaged),[s,r]=Object(n.useState)(!1),o=Object(La.b)((null===(t=e.agentPolicy)||void 0===t?void 0:t.id)||"",{noLowerTimeLimit:!0,pollImmediately:!0}),c=()=>{e.setEnrolledAgentIds(o),e.onNext()},u={...e,onNext:c,enrolledAgentIds:o,setIsManaged:s?i:e.setIsManaged};if(a)return l.a.createElement(Na,u);const d={...e,onNext:c,enrolledAgentIds:o,setIsManaged:e=>{e&&r(!0),i(e)}};return l.a.createElement(za,d)}},ln={title:d.i18n.translate("xpack.fleet.createFirstPackagePolicy.addIntegrationStepTitle",{defaultMessage:"Add the integration"}),component:e=>{var t;const{onNext:a,onBack:i,isManaged:s,setIsManaged:r,packageInfo:g,integrationInfo:m,agentPolicy:p}=e,[E,f]=Object(n.useState)(),{notifications:b}=Object(o.Tb)(),[x,v]=Object(n.useState)("VALID"),[k,M]=Object(n.useState)(),F=Object(h.u)(),[I,w]=Object(n.useState)({name:"",description:"",namespace:"default",policy_id:"",enabled:!0,inputs:[]}),T=Object(n.useCallback)((e=>{const t=Object(na.d)({...I,...e},g,aa.safeLoad);return M(t),console.debug("Package policy validation results",t),t}),[g,I]),j=Object(n.useCallback)((e=>{const t={...I,...e};w(t),console.debug("Package policy updated",t);const a=T(t),n=t.package,l=!!a&&Object(na.f)(a);v(n&&!l?"VALID":"INVALID")}),[I,T]),C=Object(n.useCallback)((async({force:e=!1}={})=>{const t=!!k&&Object(na.f)(k);if("VALID"===x&&t)return void v("INVALID");v("LOADING");const{error:n}=await(async({newPackagePolicy:e,force:t})=>{v("LOADING");const a=await Object(o.l)({...e,force:t});return v("SUBMITTED"),a})({newPackagePolicy:I,force:e});if(n){if(Object(Ra.v)(n))return void(await F(g)?C({force:!0}):v("VALID"));b.toasts.addError(n,{title:"Error"}),v("VALID")}else a()}),[k,x,I,b.toasts,F,g,a]);Object(n.useEffect)((()=>{(async()=>{if(!p)return;const{packagePolicy:e,error:t}=await(async(e,t,a)=>{const{data:n,error:l}=await Object(o.H)({perPage:S.bb,page:1,kuery:`${P.r}.package.name:${t.name}`}),i={name:Object(Xt.v)(t.name,null==n?void 0:n.items),description:"",namespace:"default",policy_id:e,enabled:!0,inputs:[]};return{packagePolicy:Object(O.q)(t,e,i.namespace,i.name,i.description,a),error:l}})(p.id,g,null==m?void 0:m.name);t&&f(t),j(e)})()}),[]);const A=Object(o.Vb)(null!==(t=g.name)&&void 0!==t?t:"","package-policy-create-multi-step"),L=Object(n.useMemo)((()=>A&&l.a.createElement(y.k,null,l.a.createElement(A.Component,null))),[A]),D=Object(n.useMemo)((()=>{if("endpoint"!==g.name)return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"l"}),l.a.createElement(ea.c,{packageInfo:g,showOnlyIntegration:null==m?void 0:m.name,packagePolicy:I,updatePackagePolicy:j,validationResults:k,submitAttempted:"INVALID"===x,noTopRule:!0}),k&&l.a.createElement(Ha,null,l.a.createElement(ea.d,{packageInfo:g,packagePolicy:I,updatePackagePolicy:j,validationResults:k,submitAttempted:"INVALID"===x,noAdvancedToggle:!0})))}),[x,null==m?void 0:m.name,g,I,j,k]);return p?E?l.a.createElement(qa,{error:E}):l.a.createElement(l.a.Fragment,null,s?null:l.a.createElement(Ua,{setIsManaged:r}),D,L,l.a.createElement(Sa,null),l.a.createElement(Ia,{cancelClickHandler:s?i:()=>r(!0),onNext:C,isLoading:"LOADING"===x,isDisabled:"INVALID"===x,loadingMessage:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.savingPackagePolicy",defaultMessage:"Saving policy..."}),actionMessage:s?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.confirmIncomingDataButton",defaultMessage:"Confirm incoming data"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.installAgentButton",defaultMessage:"Save and continue"})})):l.a.createElement(qa,{error:d.i18n.translate("xpack.fleet.addIntegration.noAgentPolicy",{defaultMessage:"Error creating agent policy."})})}},sn={title:d.i18n.translate("xpack.fleet.createFirstPackagePolicy.confirmDataStepTitle",{defaultMessage:"Confirm incoming data"}),component:e=>{const{enrolledAgentIds:t,packageInfo:a,isManaged:i}=e,s=Object(o.Tb)(),[r,c]=Object(n.useState)(!1),{docLinks:u}=s,d=u.links.fleet.troubleshooting,g=l.a.createElement(l.a.Fragment,null,l.a.createElement(Sa,null),l.a.createElement(wa,{pkgkey:`${a.name}-${a.version}`}));return i?l.a.createElement(l.a.Fragment,null,l.a.createElement(tn,{agentIds:t,packageInfo:a,agentDataConfirmed:r,setAgentDataConfirmed:c,troubleshootLink:d}),!!r&&g):l.a.createElement(l.a.Fragment,null,l.a.createElement(an,{troubleshootLink:d}),g)}},rn=[nn,ln,sn],on=[ln,nn,sn],cn=({from:e,queryParamsPolicyId:t,prerelease:a})=>{const{params:i}=Object(r.useRouteMatch)(),{pkgkey:s,policyId:c,integration:u}=i,{pkgName:d,pkgVersion:g}=Object(Xt.M)(s),[m,p]=Object(n.useState)(!0),[E,f]=Object(n.useState)(0),[b,h]=Object(n.useState)(!0),{getHref:y}=Object(o.Nb)(),[x,v]=Object(n.useState)([]),{data:k,error:M,isLoading:F}=Object(o.Eb)(d,g,{prerelease:a,full:!0}),{agentPolicy:S,enrollmentAPIKey:I,error:O,isLoading:w}=function(e){const[t,a]=Object(n.useState)({isLoading:!0});return Object(n.useEffect)((()=>{(async()=>{var t;const n=e||ca,{data:l,error:i}=await(async e=>{var t;let a,n;try{a=await Object(oa.H)(e),a.error&&(n=a.error)}catch(e){n=e}return n&&404!==n.statusCode?{error:n}:{data:null===(t=a)||void 0===t?void 0:t.data}})(n),s=null==l?void 0:l.item;if(e&&!s)return void a({isLoading:!1,error:new Error(`Agent policy ${n} not found`)});let r;if(i)return void a({isLoading:!1,error:i});if(!s){const{data:e,error:t}=await da();if(t)return void a({isLoading:!1,error:t});r=e.item}const o=s||r,{data:c,error:u}=await Object(oa.F)({page:1,perPage:1,kuery:`policy_id:${n}`});if(u)return void a({isLoading:!1,error:u});if(!c||null===(t=c.items)||void 0===t||!t.length)return void a({isLoading:!1,error:new Error(`No enrollment API key found for policy ${n}`)});const d=c.items[0];a({isLoading:!1,created:!!r,agentPolicy:o,enrollmentAPIKey:d})})()}),[e]),t}(t),T=Object(n.useMemo)((()=>null==k?void 0:k.item),[k]),j=Object(n.useMemo)((()=>{var e;if(u)return null==T||null===(e=T.policy_templates)||void 0===e?void 0:e.find((e=>e.name===u))}),[null==T?void 0:T.policy_templates,u]),{fleetServerHosts:C,isLoadingInitialRequest:A}=Object(o.sb)(S),P=y("add_integration_to_policy",{pkgkey:s,useMultiPageLayout:!1,...u?{integration:u}:{},...c?{agentPolicyId:c}:{}});if(m||!T)return l.a.createElement(ka,{isLoading:F||A||w,error:M||O,integrationInfo:j,packageInfo:T,cancelUrl:P,onNext:()=>{p(!1)}});const L=b?rn:on;return l.a.createElement(ja,{fleetServerHosts:C,agentPolicy:S,enrollmentAPIKey:I,currentStep:E,steps:L,packageInfo:T,integrationInfo:j,cancelUrl:P,onNext:()=>{E!==L.length-1&&f(E+1)},onBack:()=>{0!==E&&f(E-1)},isManaged:b,setIsManaged:e=>{h(e),f(0)},setEnrolledAgentIds:v,enrolledAgentIds:x})},un=()=>{const{search:e}=Object(r.useLocation)(),{params:t}=Object(r.useRouteMatch)(),a=Object(n.useMemo)((()=>new URLSearchParams(e)),[e]),i=Object(n.useMemo)((()=>a.has("useMultiPageLayout")),[a]),s=Object(n.useMemo)((()=>{var e;return null!==(e=a.get("policyId"))&&void 0!==e?e:void 0}),[a]),[c,u]=l.a.useState(!1),{data:d}=Object(o.Hb)();Object(n.useEffect)((()=>{const e=Boolean(null==d?void 0:d.item.prerelease_integrations_enabled);null!=d&&d.item&&u(e)}),[null==d?void 0:d.item]);const g={from:"policyId"in t||s?"policy":"package",queryParamsPolicyId:s,prerelease:c};return i?l.a.createElement(cn,g):l.a.createElement(ra,g)};var dn=a(137);const gn=e=>{const{onCancel:t,onConfirm:a,enrollmentKey:n}=e;return l.a.createElement(c.EuiConfirmModal,{title:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.title",{defaultMessage:"Revoke enrollment token"}),onCancel:t,onConfirm:a,cancelButtonText:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.deleteButton",{defaultMessage:"Revoke enrollment token"}),defaultFocusedButton:"confirm",buttonColor:"danger"},l.a.createElement(c.EuiCallOut,{title:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.description",{defaultMessage:"Are you sure you want to revoke {keyName}? New agents will no longer be able to be enrolled using this token.",values:{keyName:n.name}}),color:"danger"}))},mn=({apiKeyId:e})=>{const{notifications:t}=Object(o.Tb)(),[a,i]=Object(n.useState)("HIDDEN"),[s,r]=Object(n.useState)();return l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{color:"subdued",size:"xs"},"VISIBLE"===a?s:"•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••")),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{content:"VISIBLE"===a?d.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):d.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"})},l.a.createElement(c.EuiButtonIcon,{"aria-label":"VISIBLE"===a?d.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):d.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"}),color:"text",onClick:async()=>{if("VISIBLE"===a)i("HIDDEN");else if("HIDDEN"===a)try{var n;i("LOADING");const t=await Object(o.D)(e);if(t.error)throw t.error;r(null===(n=t.data)||void 0===n?void 0:n.item.api_key),i("VISIBLE")}catch(e){t.toasts.addError(e,{title:"Error"}),i("HIDDEN")}},iconType:"VISIBLE"===a?"eyeClosed":"eye"}))))},pn=({apiKey:e,refresh:t})=>{const{notifications:a}=Object(o.Tb)(),[i,s]=Object(n.useState)("CONFIRM_HIDDEN");return l.a.createElement(l.a.Fragment,null,"CONFIRM_VISIBLE"===i&&l.a.createElement(gn,{enrollmentKey:e,onCancel:()=>s("CONFIRM_HIDDEN"),onConfirm:async()=>{try{const t=await Object(o.p)(e.id);if(t.error)throw t.error}catch(e){a.toasts.addError(e,{title:"Error"})}s("CONFIRM_HIDDEN"),t()}}),l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"})},l.a.createElement(c.EuiButtonIcon,{"data-test-subj":"enrollmentTokenTable.revokeBtn","aria-label":d.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"}),onClick:()=>s("CONFIRM_VISIBLE"),iconType:"trash",color:"danger"})))},En=()=>{var e,t,a;Object(o.ob)("enrollment_tokens");const[i,s]=Object(n.useState)(!1),[r,g]=Object(n.useState)(""),{pagination:m,setPagination:p,pageSizeOptions:E}=Object(o.Pb)(),f=Object(o.yb)({page:m.currentPage,perPage:m.pageSize,kuery:""!==r.trim()?r:void 0}),b=Object(o.vb)({page:1,perPage:x.n}),h=b.data?b.data.items:[],k=h.reduce(((e,t)=>(e[t.id]=t,e)),{}),M=null!==(e=null==f||null===(t=f.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0,F=(null==f||null===(a=f.data)||void 0===a?void 0:a.items.filter((e=>{if(!h.length||!e.policy_id)return!1;const t=k[e.policy_id];return!(null!=t&&t.is_managed)})))||[],S=[{field:"name",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.nameTitle",{defaultMessage:"Name"}),render:e=>l.a.createElement("span",{className:"eui-textTruncate",title:e},e)},{field:"id",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.secretTitle",{defaultMessage:"Secret"}),width:"215px",render:e=>l.a.createElement(mn,{apiKeyId:e})},{field:"policy_id",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.policyTitle",{defaultMessage:"Agent policy"}),render:e=>{const t=k[e],a=t?t.name:e;return l.a.createElement("span",{className:"eui-textTruncate",title:a},a)}},{field:"created_at",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.createdAtTitle",{defaultMessage:"Created on"}),width:"150px",render:e=>e?l.a.createElement(u.FormattedDate,{year:"numeric",month:"short",day:"2-digit",value:e}):null},{field:"active",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.activeTitle",{defaultMessage:"Active"}),width:"70px",align:"center",render:e=>l.a.createElement(c.EuiIcon,{size:"m",color:e?"success":"danger",type:"dot"})},{field:"actions",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.actionsTitle",{defaultMessage:"Actions"}),width:"70px",render:(e,t)=>{const a=h.find((e=>e.id===t.policy_id));return t.active&&!(null!=a&&a.is_managed)&&l.a.createElement(pn,{apiKey:t,refresh:()=>f.resendRequest()})}}],I=f.isLoading&&f.isInitialRequest||b.isLoading&&b.isInitialRequest;return l.a.createElement(v.a,{section:"enrollment_tokens"},i&&l.a.createElement(y.q,{agentPolicies:h,onClose:e=>{s(!1),f.resendRequest()}}),l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.pageDescription",defaultMessage:"Create and revoke enrollment tokens. An enrollment token enables one or more agents to enroll in Fleet and send data."})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,{alignItems:"center"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(dn.a,{value:r,onChange:e=>{p({...m,currentPage:1}),g(e)},indexPattern:x.e})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{"data-test-subj":"createEnrollmentTokenButton",fill:!0,iconType:"plusInCircle",onClick:()=>s(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.newKeyButton",defaultMessage:"Create enrollment token"})))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{"data-test-subj":"enrollmentTokenListTable",loading:I,hasActions:!0,noItemsMessage:I?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.loadingTokensMessage",defaultMessage:"Loading enrollment tokens..."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.emptyMessage",defaultMessage:"No enrollment tokens found."}),items:M?F:[],itemId:"id",columns:S,pagination:{pageIndex:m.currentPage-1,pageSize:m.pageSize,totalItemCount:M,pageSizeOptions:E},onChange:({page:e})=>{const t={...m,currentPage:e.index+1,pageSize:e.size};p(t)}}))},fn=m()(c.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-e9lx5a-0"})(["max-width:250px;"]),bn=m()(c.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-e9lx5a-1"})(["min-width:0px;"]),hn=({fleetServerHosts:e,deleteFleetServerHost:t})=>{const{getHref:a}=Object(o.Nb)(),i=Object(n.useMemo)((()=>[{render:e=>l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},l.a.createElement(fn,{grow:!1},l.a.createElement("p",{title:e.name,className:"eui-textTruncate"},e.name)),e.is_preconfigured&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIconTip,{content:d.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.managedTooltip",{defaultMessage:"This Fleet server host is managed outside of Fleet. Please refer to your kibana config file for more info."}),type:"lock",size:"m",color:"subdued"}))),width:"288px",name:d.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.nameColumnTitle",{defaultMessage:"Name"})},{truncateText:!0,field:"host_urls",render:e=>l.a.createElement(bn,{direction:"column",gutterSize:"xs"},e.map((e=>l.a.createElement(c.EuiFlexItem,{key:e},l.a.createElement("p",{title:e,className:"eui-textTruncate"},e))))),name:d.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.hostUrlsColumnTitle",{defaultMessage:"Host URLs"})},{render:e=>e.is_default?l.a.createElement(c.EuiIcon,{type:"check","data-test-subj":"fleetServerHostTable.defaultIcon"}):null,width:"200px",name:d.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.defaultColumnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const n=!e.is_default&&!e.is_preconfigured;return l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},n&&l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:d.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.deleteButtonTitle",{defaultMessage:"Delete"}),"data-test-subj":"fleetServerHostsTable.delete.btn"})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"pencil",href:a("settings_edit_fleet_server_hosts",{itemId:e.id}),title:d.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"fleetServerHostsTable.edit.btn"})))},name:d.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.actionsColumnTitle",{defaultMessage:"Actions"})}]),[a,t]);return l.a.createElement(c.EuiBasicTable,{columns:i,items:e})},yn=({fleetServerHosts:e,deleteFleetServerHost:t})=>{const{docLinks:a}=Object(o.Tb)(),{getHref:n}=Object(o.Nb)();return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h4",{"data-test-subj":"fleetServerHostHeader"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionTitle",defaultMessage:"Fleet server hosts"}))),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement(c.EuiText,{color:"subdued",size:"m"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionSubtitle",defaultMessage:"Specify the URLs that your agents will use to connect to a Fleet Server. If multiple URLs exist, Fleet will show the first provided URL for enrollment purposes. For more information, see the {guideLink} .",values:{guideLink:l.a.createElement(c.EuiLink,{href:a.links.fleet.guide,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetUserGuideLink",defaultMessage:"Fleet and Elastic Agent Guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(hn,{fleetServerHosts:e,deleteFleetServerHost:t}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiButtonEmpty,{iconType:"plusInCircle",href:n("settings_create_fleet_server_hosts"),"data-test-subj":"settings.fleetServerHosts.addFleetServerHostBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostCreateButtonLabel",defaultMessage:"Add Fleet Server"})),l.a.createElement(c.EuiSpacer,{size:"m"}))},xn=l.a.memo((({output:e})=>{const t=Object(n.useMemo)((()=>{const t=[];return e.is_default&&t.push(l.a.createElement(vn,{key:"default-output"})),e.is_default_monitoring&&t.push(l.a.createElement(kn,{key:"default-monitoring-output"})),t}),[e]);return l.a.createElement(c.EuiBadgeGroup,{gutterSize:"xs"},t.map(((e,t)=>e)))})),vn=()=>l.a.createElement(c.EuiBadge,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultOutputBadgeTitle",defaultMessage:"Agent integrations"})),kn=()=>l.a.createElement(c.EuiBadge,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultMonitoringOutputBadgeTitle",defaultMessage:"Agent monitoring"})),Mn=m()(c.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-zxtmo5-0"})(["max-width:250px;"]),Fn=m()(c.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-zxtmo5-1"})(["min-width:0px;"]),Sn=({outputs:e,deleteOutput:t})=>{const{getHref:a}=Object(o.Nb)(),i=Object(n.useMemo)((()=>[{render:e=>l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},l.a.createElement(Mn,{grow:!1},l.a.createElement("p",{title:e.name,className:"eui-textTruncate"},e.name)),e.is_preconfigured&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIconTip,{content:d.i18n.translate("xpack.fleet.settings.outputsTable.managedTooltip",{defaultMessage:"This outputs is managed outside of Fleet."}),type:"lock",size:"m",color:"subdued"}))),width:"288px",name:d.i18n.translate("xpack.fleet.settings.outputsTable.nameColomnTitle",{defaultMessage:"Name"})},{width:"172px",render:e=>{return"elasticsearch"===(t=e.type)?d.i18n.translate("xpack.fleet.settings.outputsTable.elasticsearchTypeLabel",{defaultMessage:"Elasticsearch"}):t;var t},name:d.i18n.translate("xpack.fleet.settings.outputsTable.typeColomnTitle",{defaultMessage:"Type"})},{truncateText:!0,render:e=>l.a.createElement(Fn,{direction:"column",gutterSize:"xs"},(e.hosts||[]).map((e=>l.a.createElement(c.EuiFlexItem,{key:e},l.a.createElement("p",{title:e,className:"eui-textTruncate"},e))))),name:d.i18n.translate("xpack.fleet.settings.outputsTable.hostColomnTitle",{defaultMessage:"Hosts"})},{render:e=>l.a.createElement(xn,{output:e}),width:"200px",name:d.i18n.translate("xpack.fleet.settings.outputSection.defaultColomnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const n=!e.is_default&&!e.is_default_monitoring&&!e.is_preconfigured;return l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},n&&l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:d.i18n.translate("xpack.fleet.settings.outputSection.deleteButtonTitle",{defaultMessage:"Delete"})})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"pencil",href:a("settings_edit_outputs",{outputId:e.id}),title:d.i18n.translate("xpack.fleet.settings.outputSection.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"editOutputBtn"})))},name:d.i18n.translate("xpack.fleet.settings.outputSection.actionsColomnTitle",{defaultMessage:"Actions"})}]),[t,a]);return l.a.createElement(c.EuiBasicTable,{columns:i,items:e})},In=({outputs:e,deleteOutput:t})=>{const{getHref:a}=Object(o.Nb)();return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputSectionTitle",defaultMessage:"Outputs"}))),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement(c.EuiText,{color:"subdued",size:"m"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputSectionSubtitle",defaultMessage:"Specify where agents will send data."})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Sn,{outputs:e,deleteOutput:t}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiButtonEmpty,{iconType:"plusInCircle",href:a("settings_create_outputs"),"data-test-subj":"addOutputBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputCreateButtonLabel",defaultMessage:"Add output"})))},On=m()(c.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-7tdzg4-0"})(["max-width:250px;"]),wn=m()(c.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-7tdzg4-1"})(["min-width:0px;"]),Tn=({downloadSources:e,deleteDownloadSource:t})=>{const{getHref:a}=Object(o.Nb)(),i=Object(n.useMemo)((()=>[{render:e=>l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},l.a.createElement(On,{grow:!1},l.a.createElement("p",{title:e.name,className:"eui-textTruncate","data-test-subj":"editDownloadSourceTable.name"},e.name))),width:"288px",name:d.i18n.translate("xpack.fleet.settings.downloadSourcesTable.nameColumnTitle",{defaultMessage:"Name"})},{truncateText:!0,render:e=>l.a.createElement(wn,{direction:"column",gutterSize:"xs"},l.a.createElement(c.EuiFlexItem,{key:e.host},l.a.createElement("p",{title:e.host,className:"eui-textTruncate","data-test-subj":"editDownloadSourceTable.host"},e.host))),name:d.i18n.translate("xpack.fleet.settings.downloadSourcesTable.hostColumnTitle",{defaultMessage:"Host"})},{render:e=>e.is_default?l.a.createElement(c.EuiIcon,{type:"check","data-test-subj":"editDownloadSourceTable.defaultIcon"}):null,width:"200px",name:d.i18n.translate("xpack.fleet.settings.downloadSourcesTable.defaultColumnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const n=!e.is_default;return l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},n&&l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:d.i18n.translate("xpack.fleet.settings.downloadSourceSection.deleteButtonTitle",{defaultMessage:"Delete"}),"data-test-subj":"editDownloadSourceTable.delete.btn"})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"pencil",href:a("settings_edit_download_sources",{downloadSourceId:e.id}),title:d.i18n.translate("xpack.fleet.settings.downloadSourceSection.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"editDownloadSourceTable.edit.btn"})))},name:d.i18n.translate("xpack.fleet.settings.downloadSourceSection.actionsColumnTitle",{defaultMessage:"Actions"})}]),[t,a]);return l.a.createElement(c.EuiBasicTable,{columns:i,items:e,"data-test-subj":"AgentDownloadSourcesTable"})},jn=({downloadSources:e,deleteDownloadSource:t})=>{const{getHref:a}=Object(o.Nb)();return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.downloadSourcesSection.Title",defaultMessage:"Agent Binary Download"}))),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement(c.EuiText,{color:"subdued",size:"m"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.downloadSourcesSection.Subtitle",defaultMessage:"Specify where the agents will download their binary from. Checked default will apply to all policies unless overwritten."})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Tn,{downloadSources:e,deleteDownloadSource:t}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiButtonEmpty,{iconType:"plusInCircle",href:a("settings_create_download_sources"),"data-test-subj":"addDownloadSourcesBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.downloadSourcesSection.CreateButtonLabel",defaultMessage:"Add agent binary source"})))},Cn=({outputs:e,fleetServerHosts:t,deleteOutput:a,deleteFleetServerHost:n,downloadSources:i,deleteDownloadSource:s})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(yn,{fleetServerHosts:t,deleteFleetServerHost:n}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(In,{outputs:e,deleteOutput:a}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(jn,{downloadSources:i,deleteDownloadSource:s}));var An=a(109),Pn=a(123),Ln=a(158);const Dn=({onClose:e,fleetServerHost:t})=>{const{docLinks:a}=Object(o.Tb)(),n=Object(Ln.a)(t,e),{inputs:i}=n;return l.a.createElement(c.EuiFlyout,{maxWidth:670,onClose:e},l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",null,t?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.editTitle",defaultMessage:"Edit Fleet Server"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.addTitle",defaultMessage:"Add Fleet Server"})))),l.a.createElement(c.EuiFlyoutBody,null,l.a.createElement(c.EuiForm,{onSubmit:n.submit},l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.nameInputLabel",defaultMessage:"Name"})},i.nameInput.formRowProps),l.a.createElement(c.EuiFieldText,F()({"data-test-subj":"fleetServerHostsFlyout.nameInput",fullWidth:!0},i.nameInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}))),l.a.createElement(c.EuiFormRow,{fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.hostUrlLabel",defaultMessage:"URL"})},l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,{color:"subdued",size:"relative"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.description",defaultMessage:"Specify multiple URLs to scale out your deployment and provide automatic failover. If multiple URLs exist, Fleet shows the first provided URL for enrollment purposes. Enrolled Elastic Agents will connect to the URLs in round robin order until they connect successfully. For more information, see the {link} .",values:{link:l.a.createElement(c.EuiLink,{href:a.links.fleet.settingsFleetServerHostSettings,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.userGuideLink",defaultMessage:"Fleet and Elastic Agent Guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Pn.a,F()({},n.inputs.hostUrlsInput.props,{id:"fleet-server-inputs",placeholder:d.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.fleetServerHostsInputPlaceholder",{defaultMessage:"Specify host URL"})})))),l.a.createElement(c.EuiFormRow,F()({fullWidth:!0},i.isDefaultInput.formRowProps),l.a.createElement(c.EuiSwitch,F()({"data-test-subj":"fleetServerHostsFlyout.isDefaultSwitch"},i.isDefaultInput.props,{label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.defaultOutputSwitchLabel",defaultMessage:"Make this Fleet server the default one."})}))))),l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:n.isLoading,isDisabled:n.isDisabled,onClick:n.submit,"data-test-subj":"saveApplySettingsBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},_n=()=>{const{docLinks:e}=Object(o.Tb)();return l.a.createElement(Bn,{iconType:"iInCircle",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.calloutTitle",defaultMessage:"Additional Logstash configuration required"})},l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.description",defaultMessage:"Add an Elastic Agent pipeline configuration to Logstash to receive events from the Elastic Agent framework. {documentationLink}.",values:{documentationLink:l.a.createElement(c.EuiLink,{external:!0,href:e.links.logstash.inputElasticAgent},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.documentationLink",defaultMessage:"Learn more"}))}}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Nn,null)))},Bn=({children:e,...t})=>{const[a,i]=Object(n.useState)(!1);return l.a.createElement(c.EuiCallOut,t,l.a.createElement(c.EuiSpacer,{size:"s"}),a?l.a.createElement(c.EuiButton,{onClick:()=>i(!1)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.collapseInstructionsButtonLabel",defaultMessage:"Collapse steps"})):l.a.createElement(c.EuiButton,{onClick:()=>i(!0),fill:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.viewInstructionButtonLabel",defaultMessage:"View steps"})),a&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),e))},Nn=()=>{const{docLinks:e}=Object(o.Tb)(),t=function(){const[e,t]=Object(n.useState)(!1),[a,l]=Object(n.useState)(),{notifications:i}=Object(o.Tb)(),s=Object(n.useCallback)((async()=>{try{var e;t(!0);const a=await Object(o.W)();if(a.error)throw a.error;l(null===(e=a.data)||void 0===e?void 0:e.api_key)}catch(e){i.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.logstashInstructions.generateApiKeyError",{defaultMessage:"Impossible to generate an api key"})})}finally{t(!1)}}),[i.toasts]);return Object(n.useMemo)((()=>({isLoading:e,generateApiKey:s,apiKey:a})),[e,s,a])}(),a=Object(n.useMemo)((()=>{return[{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.apiKeyStepDescription",defaultMessage:"We recommend authorizing Logstash to output to Elasticsearch with minimal privileges for Elastic Agent."}),l.a.createElement(c.EuiSpacer,{size:"m"}),t.apiKey?l.a.createElement(c.EuiCodeBlock,{paddingSize:"m"},l.a.createElement("h5",null,"API Key"),t.apiKey,l.a.createElement("div",{className:"euiCodeBlock__controls"},l.a.createElement("div",{className:"euiCodeBlock__copyButton"},l.a.createElement(c.EuiCopy,{textToCopy:t.apiKey},(e=>l.a.createElement(c.EuiButtonIcon,{onClick:e,iconType:"copyClipboard",color:"text","aria-label":d.i18n.translate("xpack.fleet.settings.logstashInstructions.copyApiKeyButtonLabel",{defaultMessage:"Copy message"})})))))):l.a.createElement(c.EuiButton,{isLoading:t.isLoading,onClick:t.generateApiKey},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.generateApiKeyButtonLabel",defaultMessage:"Generate API key"})),l.a.createElement(c.EuiSpacer,{size:"m"}))},{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.editPipelineStepDescription",defaultMessage:"Next, open the {pipelineConfFile} file and insert the following content:",values:{pipelineConfFile:l.a.createElement(c.EuiCode,null,"elastic-agent-pipeline.conf")}}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiCodeBlock,{paddingSize:"m",language:"yaml",isCopyable:!0},(a=t.apiKey,'input {\n  elastic_agent {\n    port => 5044\n    ssl => true\n    ssl_certificate_authorities => ["<ca_path>"]\n    ssl_certificate => "<server_cert_path>"\n    ssl_key => "<server_cert_key_in_pkcs8>"\n    ssl_verify_mode => "force_peer"\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => "<es_host>"\n    api_key => "<api_key>"\n    data_stream => true\n    ssl => true\n    # cacert => "<elasticsearch_ca_path>"\n  }\n}'.replace("<api_key>",a||"<api_key>"))))},{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.addPipelineStepDescription",defaultMessage:"In your Logstash configuration directory, open the {pipelineFile} file and add the following configuration. Replace the path to your file.",values:{pipelineFile:l.a.createElement(c.EuiCode,null,"pipelines.yml")}}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiCodeBlock,{paddingSize:"m",language:"yaml",isCopyable:!0},'- pipeline.id: elastic-agent-pipeline\n  path.config: "/etc/path/to/elastic-agent-pipeline.conf"\n'))},{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.replaceStepDescription",defaultMessage:"Replace the parts between the brackets with your generated SSL certificate file paths. View {documentationLink} to generate the certificates.",values:{documentationLink:l.a.createElement(c.EuiLink,{external:!0,href:e.links.fleet.secureLogstash},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.ourDocumentationLink",defaultMessage:"our documentation"}))}}),l.a.createElement(c.EuiSpacer,{size:"m"}))},{children:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.saveAndRestartStepDescription",defaultMessage:"Save the pipeline and restart Logstash so the changes take effect."}),l.a.createElement(c.EuiSpacer,{size:"m"}))}];var a}),[t,e]);return l.a.createElement("ol",null,a.map(((e,t)=>l.a.createElement("li",{key:t},e.children))))},Rn=m.a.div.withConfig({displayName:"CodeEditorContainer",componentId:"sc-11vyk7j-0"})(["min-height:0;position:relative;height:116px;"]),zn=m()(c.EuiTextColor).attrs((e=>({color:"subdued",size:"xs"}))).withConfig({displayName:"CodeEditorPlaceholder",componentId:"sc-11vyk7j-1"})(["position:absolute;top:0;left:0;font-family:Menlo,Monaco,'Courier New',monospace;font-size:12px;line-height:21px;pointer-events:none;"]),Hn={minimap:{enabled:!1},ariaLabel:d.i18n.translate("xpack.fleet.settings.yamlCodeEditor",{defaultMessage:"YAML Code Editor"}),scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"indent",automaticLayout:!0,tabSize:2,lineNumbers:"off",lineNumbersMinChars:0,glyphMargin:!1,folding:!1,lineDecorationsWidth:0},qn=e=>{const{placeholder:t,disabled:a,...n}=e;return a?l.a.createElement(c.EuiCodeBlock,{style:{height:"116px"},language:"yaml",isCopyable:!1,paddingSize:"s"},l.a.createElement("pre",null,n.value)):l.a.createElement(Rn,null,l.a.createElement(f.CodeEditor,F()({languageId:"yaml",width:"100%",height:"116px",options:Hn},n)),(!n.value||""===n.value)&&l.a.createElement(zn,null,t))};function Un(e){const t=[],a={};if(e.forEach(((e,n)=>{try{if(!e)throw new Error("Host URL required");const t=new URL(e);if(!["http:","https:"].includes(t.protocol))throw new Error("Invalid protocol")}catch(e){t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.elasticHostError",{defaultMessage:"Invalid URL"}),index:n})}const l=a[e]||[];a[e]=[...l,n]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.elasticHostDuplicateError",{defaultMessage:"Duplicate URL"}),index:e})))})),0===e.length&&t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.elasticUrlRequiredError",{defaultMessage:"URL is required"})}),t.length)return t}function Gn(e){const t=[],a={};if(e.forEach(((e,n)=>{try{if(e.match(/^http([s]){0,1}:\/\//))return void t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostProtocolError",{defaultMessage:"Host address must begin with a domain name or IP address"}),index:n});if(new URL(`http://${e}`).host!==e)throw new Error("Invalid host")}catch(a){0===e.length?t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostRequiredError",{defaultMessage:"Host is required"}),index:n}):t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostError",{defaultMessage:"Invalid Host"}),index:n})}const l=a[e]||[];a[e]=[...l,n]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostDuplicateError",{defaultMessage:"Duplicate Host"}),index:e})))})),0===e.length&&t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.logstashHostRequiredError",{defaultMessage:"Host is required"})}),t.length)return t}function Wn(e){try{return void Object(aa.safeLoad)(e)}catch(e){return[d.i18n.translate("xpack.fleet.settings.outputForm.invalidYamlFormatErrorMessage",{defaultMessage:"Invalid YAML: {reason}",values:{reason:e.message}})]}}function $n(e){if(!e||""===e)return[d.i18n.translate("xpack.fleet.settings.outputForm.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}function Vn(e){if(""!==e&&!e.match(/^[a-zA-Z0-9]+$/))return[d.i18n.translate("xpack.fleet.settings.outputForm.caTrusterdFingerprintInvalidErrorMessage",{defaultMessage:"CA trusted fingerprint should be a base64 CA sha256 fingerprint"})]}function Kn(e){if(!e||""===e)return[d.i18n.translate("xpack.fleet.settings.outputForm.sslCertificateRequiredErrorMessage",{defaultMessage:"SSL certificate is required"})]}function Yn(e){if(!e||""===e)return[d.i18n.translate("xpack.fleet.settings.outputForm.sslKeyRequiredErrorMessage",{defaultMessage:"SSL key is required"})]}async function Qn(e){var t,a,n;let l=`${x.c}.data_output_id:"${e.id}" or ${x.c}.monitoring_output_id:"${e.id}"`;e.is_default&&(l+=` or (not ${x.c}.data_output_id:*)`);const i=await Object(o.u)({kuery:l,page:1,perPage:x.n});if(i.error)throw i.error;const s=null!==(t=null===(a=i.data)||void 0===a||null===(n=a.items)||void 0===n?void 0:n.length)&&void 0!==t?t:0;let r=0;if(s>0){var c,u,d;const e=await Object(o.y)({page:1,perPage:0,showInactive:!1,kuery:null===(c=i.data)||void 0===c?void 0:c.items.map((e=>`policy_id:"${e.id}"`)).join(" or ")});if(e.error)throw e.error;r=null!==(u=null===(d=e.data)||void 0===d?void 0:d.total)&&void 0!==u?u:0}return{agentPolicyCount:s,agentCount:r}}const Jn=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),Zn=({output:e,agentCount:t,agentPolicyCount:a})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.confirmModalText",defaultMessage:"This action will update {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:l.a.createElement("strong",null,e.name),agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}});const Xn=()=>{const{docLinks:e}=Object(o.Tb)();return l.a.createElement(c.EuiCallOut,{iconType:"alert",color:"warning",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.calloutTitle",defaultMessage:"Additional setup required"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.calloutDescription",defaultMessage:"You must configure an encryption key before configuring this output. {link}",values:{link:l.a.createElement(c.EuiLink,{href:e.links.kibana.secureSavedObject,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.link",defaultMessage:"Learn more"}))}}))},el=[{value:"elasticsearch",text:"Elasticsearch"},{value:"logstash",text:"Logstash"}],tl=({onClose:e,output:t})=>{Object(o.ob)("settings");const a=function(e,t){var a,i,s,r,c,u,g,m,p,E,f,b,h,y,x,v;const k=!(null!==(a=Object(o.tb)().missingOptionalFeatures)&&void 0!==a&&a.includes("encrypted_saved_object_encryption_key_required")),[M,F]=Object(n.useState)(!1),{notifications:S}=Object(o.Tb)(),{confirm:I}=Object(An.a)(),O=null!==(i=null==t?void 0:t.is_preconfigured)&&void 0!==i&&i,w=Object(o.Ib)(null!==(s=null==t?void 0:t.name)&&void 0!==s?s:"",$n,O),T=Object(o.Ib)(null!==(r=null==t?void 0:t.type)&&void 0!==r?r:"elasticsearch",void 0,O),j=Object(o.Ib)(null!==(c=null==t?void 0:t.config_yaml)&&void 0!==c?c:"",Wn,O),C=Object(o.Ub)(null!==(u=null==t?void 0:t.is_default)&&void 0!==u&&u,O||(null==t?void 0:t.is_default)),A=Object(o.Ub)(null!==(g=null==t?void 0:t.is_default_monitoring)&&void 0!==g&&g,O||(null==t?void 0:t.is_default_monitoring)),P=Object(o.Ib)(null!==(m=null==t?void 0:t.ca_trusted_fingerprint)&&void 0!==m?m:"",Vn,O),L=Object(o.pb)("esHostsComboxBox",null!==(p=null==t?void 0:t.hosts)&&void 0!==p?p:[],Un,O),D=Object(o.pb)("logstashHostsComboxBox",null!==(E=null==t?void 0:t.hosts)&&void 0!==E?E:[],Gn,O),_=Object(o.pb)("sslCertificateAuthoritiesComboxBox",null!==(f=null==t||null===(b=t.ssl)||void 0===b?void 0:b.certificate_authorities)&&void 0!==f?f:[],void 0,O),B=Object(o.Ib)(null!==(h=null==t||null===(y=t.ssl)||void 0===y?void 0:y.certificate)&&void 0!==h?h:"",Kn,O),N=Object(o.Ib)(null!==(x=null==t||null===(v=t.ssl)||void 0===v?void 0:v.key)&&void 0!==x?x:"",Yn,O),R="logstash"===T.value,z={nameInput:w,typeInput:T,elasticsearchUrlInput:L,logstashHostsInput:D,additionalYamlConfigInput:j,defaultOutputInput:C,defaultMonitoringOutputInput:A,caTrustedFingerprintInput:P,sslCertificateInput:B,sslKeyInput:N,sslCertificateAuthoritiesInput:_},H=Object.values(z).some((e=>e.hasChanged)),q=Object(n.useCallback)((()=>{const e=w.validate(),t=L.validate(),a=D.validate(),n=j.validate(),l=P.validate(),i=B.validate(),s=N.validate();return R?a&&n&&e&&i&&s:t&&n&&e&&l}),[R,w,B,N,L,D,j,P]),U=Object(n.useCallback)((async()=>{try{if(!q())return;F(!0);const a=R?{name:w.value,type:T.value,hosts:D.value,is_default:C.value,is_default_monitoring:A.value,config_yaml:j.value,ssl:{certificate:B.value,key:N.value,certificate_authorities:_.value.filter((e=>""!==e))}}:{name:w.value,type:T.value,hosts:L.value,is_default:C.value,is_default_monitoring:A.value,config_yaml:j.value,ca_trusted_fingerprint:P.value};if(t){if(!await async function(e,t){const{agentCount:a,agentPolicyCount:n}=await Qn(e);return t(l.a.createElement(Jn,null),l.a.createElement(Zn,{agentCount:a,agentPolicyCount:n,output:e}))}(t,I))return void F(!1);const e=await Object(o.db)(t.id,a);if(e.error)throw e.error}else{const e=await Object(o.X)(a);if(e.error)throw e.error}e(),F(!1)}catch(e){F(!1),S.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.outputForm.errorToastTitle",{defaultMessage:"Error while saving output"})})}}),[R,q,I,j.value,A.value,C.value,L.value,D.value,P.value,B.value,_.value,N.value,w.value,T.value,S.toasts,e,t]);return{inputs:z,submit:U,isLoading:M,hasEncryptedSavedObjectConfigured:k,isDisabled:M||O||t&&!H||R&&!k}}(e,t),i=a.inputs,{docLinks:s}=Object(o.Tb)(),r="logstash"===i.typeInput.value,g="elasticsearch"===i.typeInput.value,m=r&&!a.hasEncryptedSavedObjectConfigured;return l.a.createElement(c.EuiFlyout,{maxWidth:670,onClose:e},l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"FleetEditOutputFlyoutTitle"},t?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.editTitle",defaultMessage:"Edit output"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.createTitle",defaultMessage:"Add new output"})))),l.a.createElement(c.EuiFlyoutBody,null,(null==t?void 0:t.is_preconfigured)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiCallOut,{iconType:"lock",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutTitle",defaultMessage:"This output is managed outside of Fleet"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutDescription",defaultMessage:"Most actions related to this output are unavailable. Refer to your kibana config for more detail."})),l.a.createElement(c.EuiSpacer,{size:"m"})),l.a.createElement(c.EuiForm,null,l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.nameInputLabel",defaultMessage:"Name"})},i.nameInput.formRowProps),l.a.createElement(c.EuiFieldText,F()({"data-test-subj":"settingsOutputsFlyout.nameInput",fullWidth:!0},i.nameInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}))),l.a.createElement(c.EuiFormRow,{fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.typeInputLabel",defaultMessage:"Type"})},l.a.createElement(c.EuiSelect,F()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.typeInput"},i.typeInput.props,{options:el,placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.typeInputPlaceholder",{defaultMessage:"Specify type"})}))),m&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Xn,null)),r&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(_n,null),l.a.createElement(c.EuiSpacer,{size:"m"})),g&&l.a.createElement(Pn.a,F()({"data-test-subj":"settingsOutputsFlyout.hostUrlInput",label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.esHostsInputLabel",{defaultMessage:"Hosts"}),placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.esHostsInputPlaceholder",{defaultMessage:"Specify host URL"})},i.elasticsearchUrlInput.props)),r&&l.a.createElement(Pn.a,F()({placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.logstashHostsInputPlaceholder",{defaultMessage:"Specify host"}),sortable:!1,helpText:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.logstashHostsInputDescription",defaultMessage:"Specify the addresses that your agents will use to connect to Logstash. {guideLink}.",values:{guideLink:l.a.createElement(c.EuiLink,{href:s.links.fleet.settings,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetSettingsLink",defaultMessage:"Learn more"}))}}),label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.logstashHostsInputLabel",{defaultMessage:"Logstash hosts"})},i.logstashHostsInput.props)),g&&l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputLabel",defaultMessage:"Elasticsearch CA trusted fingerprint (optional)"})},i.caTrustedFingerprintInput.formRowProps),l.a.createElement(c.EuiFieldText,F()({fullWidth:!0},i.caTrustedFingerprintInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputPlaceholder",{defaultMessage:"Specify Elasticsearch CA trusted fingerprint"})}))),r&&l.a.createElement(Pn.a,F()({placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputPlaceholder",{defaultMessage:"Specify certificate authority"}),label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputLabel",{defaultMessage:"Server SSL certificate authorities (optional)"}),multiline:!0,sortable:!1},i.sslCertificateAuthoritiesInput.props)),r&&l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslCertificateInputLabel",defaultMessage:"Client SSL certificate"})},i.sslCertificateInput.formRowProps),l.a.createElement(c.EuiTextArea,F()({fullWidth:!0,rows:5},i.sslCertificateInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateInputPlaceholder",{defaultMessage:"Specify ssl certificate"})}))),r&&l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslKeyInputLabel",defaultMessage:"Client SSL certificate key"})},i.sslKeyInput.formRowProps),l.a.createElement(c.EuiTextArea,F()({fullWidth:!0,rows:5},i.sslKeyInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeyInputPlaceholder",{defaultMessage:"Specify certificate key"})}))),l.a.createElement(c.EuiFormRow,F()({label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputLabel",{defaultMessage:"Advanced YAML configuration"})},i.additionalYamlConfigInput.formRowProps,{fullWidth:!0}),l.a.createElement(qn,{value:i.additionalYamlConfigInput.value,onChange:i.additionalYamlConfigInput.setValue,disabled:i.additionalYamlConfigInput.props.disabled,placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputPlaceholder",{defaultMessage:"# YAML settings here will be added to the output section of each agent policy."})})),l.a.createElement(c.EuiFormRow,F()({fullWidth:!0},i.defaultOutputInput.formRowProps),l.a.createElement(c.EuiSwitch,F()({},i.defaultOutputInput.props,{label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentIntegrations}.",values:{boldAgentIntegrations:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentIntegrationsBold",defaultMessage:"agent integrations"}))}})}))),l.a.createElement(c.EuiFormRow,F()({fullWidth:!0},i.defaultMonitoringOutputInput.formRowProps),l.a.createElement(c.EuiSwitch,F()({},i.defaultMonitoringOutputInput.props,{label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultMontoringOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentMonitoring}.",values:{boldAgentMonitoring:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentMonitoringBold",defaultMessage:"agent monitoring"}))}})}))))),l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:e,flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:a.isLoading,isDisabled:a.isDisabled,onClick:a.submit,"data-test-subj":"saveApplySettingsBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},al=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),nl=({output:e,agentCount:t,agentPolicyCount:a})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalText",defaultMessage:"This action will delete {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:l.a.createElement("strong",null,e.name),agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}}),ll=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetServerHosts.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),il=({})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetServerHosts.confirmModalText",defaultMessage:"This action will change agent policies currently enrolled in this Fleet Server, to instead enroll in your default Fleet server. Are you sure you wish to continue?"});async function sl(e){var t,a,n;let l=`${x.c}.download_source_id:"${e.id}"`;e.is_default&&(l+=` or (not ${x.c}.download_source_id:*)`);const i=await Object(o.u)({kuery:l,page:1,perPage:x.n});if(i.error)throw i.error;const s=null!==(t=null===(a=i.data)||void 0===a||null===(n=a.items)||void 0===n?void 0:n.length)&&void 0!==t?t:0;let r=0;if(s>0){var c,u,d;const e=await Object(o.y)({page:1,perPage:0,showInactive:!1,kuery:null===(c=i.data)||void 0===c?void 0:c.items.map((e=>`policy_id:"${e.id}"`)).join(" or ")});if(e.error)throw e.error;r=null!==(u=null===(d=e.data)||void 0===d?void 0:d.total)&&void 0!==u?u:0}return{agentPolicyCount:s,agentCount:r}}const rl=({downloadSource:e,agentCount:t,agentPolicyCount:a})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.confirmModalText","data-test-subj":"editDownloadSourcesConfirmModal.confirmModalText",defaultMessage:"This action will update {downloadSourceName} agent binary source. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{downloadSourceName:l.a.createElement("strong",null,e.name),agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}});function ol(e){if(!e||""===e)return[d.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}function cl(e){try{if(!e)return[d.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.HostIsRequiredErrorMessage",{defaultMessage:"Host is required"})];const t=new URL(e);if(!["http:","https:"].includes(t.protocol))throw new Error("Invalid protocol")}catch(e){return[d.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.hostError",{defaultMessage:"Invalid URL"})]}}const ul=({onClose:e,downloadSource:t})=>{Object(o.ob)("settings");const a=function(e,t){var a,i,s;const[r,c]=Object(n.useState)(!1),{notifications:g}=Object(o.Tb)(),{confirm:m}=Object(An.a)(),p=Object(o.Ib)(null!==(a=null==t?void 0:t.name)&&void 0!==a?a:"",ol),E=Object(o.Ub)(null!==(i=null==t?void 0:t.is_default)&&void 0!==i&&i,null==t?void 0:t.is_default),f=Object(o.Ib)(null!==(s=null==t?void 0:t.host)&&void 0!==s?s:"",cl),b={nameInput:p,hostInput:f,defaultDownloadSourceInput:E},h=Object.values(b).some((e=>e.hasChanged)),y=Object(n.useCallback)((()=>{const e=p.validate(),t=f.validate();return e&&t}),[p,f]),x=Object(n.useCallback)((async()=>{try{if(!y())return;c(!0);const a={name:p.value.trim(),host:f.value.trim(),is_default:E.value};if(t){if(!await async function(e,t){const{agentCount:a,agentPolicyCount:n}=await sl(e);return t(l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),l.a.createElement(rl,{agentCount:a,agentPolicyCount:n,downloadSource:e}))}(t,m))return void c(!1);const e=await Object(o.bb)(t.id,a);if(e.error)throw e.error}else{const e=await Object(o.U)(a);if(e.error)throw e.error}e(),c(!1)}catch(e){c(!1),g.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.errorToastTitle",{defaultMessage:"Error while saving binary source"})})}}),[m,E.value,t,f.value,p.value,g.toasts,e,y]);return{inputs:b,submit:x,isLoading:r,isDisabled:r||t&&!h}}(e,t),i=a.inputs,{docLinks:s}=Object(o.Tb)();return l.a.createElement(c.EuiFlyout,{maxWidth:670,onClose:e},l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"FleetEditDownloadSourcesFlyoutTitle"},t?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.editTitle",defaultMessage:"Edit agent binary source","data-test-subj":"editDownloadSourcesFlyout.edit.title"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.createTitle",defaultMessage:"Add new agent binary source","data-test-subj":"editDownloadSourcesFlyout.add.title"})))),l.a.createElement(c.EuiFlyoutBody,null,l.a.createElement(c.EuiForm,null,l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.nameInputLabel",defaultMessage:"Name"})},i.nameInput.formRowProps),l.a.createElement(c.EuiFieldText,F()({"data-test-subj":"editDownloadSourcesFlyout.nameInput",fullWidth:!0},i.nameInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editDownloadSourcesFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}))),l.a.createElement(c.EuiFormRow,F()({fullWidth:!0,helpText:l.a.createElement(u.FormattedMessage,{"data-test-subj":"editDownloadSourcesFlyout.hostHelpText",id:"xpack.fleet.settings.editDownloadSourcesFlyout.hostsInputDescription",defaultMessage:"Address that your agents will use to download their binary from. Specify the path to the directory containing the binary. {guideLink}",values:{guideLink:l.a.createElement(c.EuiLink,{href:s.links.fleet.settings,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetSettingsLink",defaultMessage:"Learn more"}))}}),label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.hostInputLabel",defaultMessage:"Host"})},i.hostInput.formRowProps),l.a.createElement(c.EuiFieldText,F()({"data-test-subj":"editDownloadSourcesFlyout.hostInput",fullWidth:!0},i.hostInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editDownloadSourcesFlyout.hostsInputPlaceholder",{defaultMessage:"Specify host"})}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFormRow,F()({fullWidth:!0},i.defaultDownloadSourceInput.formRowProps),l.a.createElement(c.EuiSwitch,F()({"data-test-subj":"editDownloadSourcesFlyout.isDefaultSwitch"},i.defaultDownloadSourceInput.props,{label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.defaultSwitchLabel",defaultMessage:"Make this host the default for all agent policies."})}))))),l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:e,flush:"left","data-test-subj":"editDownloadSourcesFlyout.cancelBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:a.isLoading,isDisabled:a.isDisabled,onClick:a.submit,"data-test-subj":"editDownloadSourcesFlyout.submitBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},dl=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),gl=({downloadSource:e,agentCount:t,agentPolicyCount:a})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.confirmModalText",defaultMessage:"This action will delete {downloadSourceName} agent binary source. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{downloadSourceName:l.a.createElement("strong",null,e.name),agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}}),ml=Object(An.b)((()=>{var e,t,a;Object(o.ob)("settings");const i=Object(r.useHistory)(),s=Object(o.Db)(),u=Object(o.zb)(),g=Object(o.xb)(),m=Object(o.ub)(),{deleteOutput:p}=function(e){const{confirm:t}=Object(An.a)(),{notifications:a}=Object(o.Tb)();return{deleteOutput:Object(n.useCallback)((async n=>{try{const{agentCount:a,agentPolicyCount:i}=await Qn(n);if(!await t(l.a.createElement(al,null),l.a.createElement(nl,{output:n,agentCount:a,agentPolicyCount:i}),{buttonColor:"danger",confirmButtonText:d.i18n.translate("xpack.fleet.settings.deleteOutputs.confirmButtonLabel",{defaultMessage:"Delete and deploy"})}))return;const s=await Object(o.q)(n.id);if(s.error)throw s.error;e()}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.deleteOutputs.errorToastTitle",{defaultMessage:"Error deleting output"})})}}),[t,a.toasts,e])}}(s.resendRequest),{deleteDownloadSource:E}=function(e){const{confirm:t}=Object(An.a)(),{notifications:a}=Object(o.Tb)();return{deleteDownloadSource:Object(n.useCallback)((async n=>{try{const{agentCount:a,agentPolicyCount:i}=await sl(n);if(!await t(l.a.createElement(dl,null),l.a.createElement(gl,{"data-test-subj":"editDownloadSourcesDeleteModal.confirmModalText",downloadSource:n,agentCount:a,agentPolicyCount:i}),{buttonColor:"danger",confirmButtonText:d.i18n.translate("xpack.fleet.settings.deleteDownloadSource.confirmButtonLabel",{defaultMessage:"Delete and deploy"})}))return;const s=await Object(o.n)(n.id);if(s.error)throw s.error;e()}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.deleteDownloadSource.errorToastTitle",{defaultMessage:"Error deleting agent binary source."})})}}),[t,a.toasts,e])}}(g.resendRequest),{deleteFleetServerHost:f}=function(e){const{confirm:t}=Object(An.a)(),{notifications:a}=Object(o.Tb)();return{deleteFleetServerHost:Object(n.useCallback)((async n=>{try{if(!await t(l.a.createElement(ll,null),l.a.createElement(il,null),{buttonColor:"danger",confirmButtonText:d.i18n.translate("xpack.fleet.settings.deleteFleetServerHosts.confirmButtonLabel",{defaultMessage:"Delete and deploy changes"})}))return;const a=await Object(o.o)(n.id);if(a.error)throw a.error;e()}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.deleteFleetServerHosts.errorToastTitle",{defaultMessage:"Error deleting Fleet Server hosts"})})}}),[t,a.toasts,e])}}(u.resendRequest),b=s.resendRequest,h=g.resendRequest,k=u.resendRequest,M=Object(n.useCallback)((()=>{m.closeFleetServerFlyout(),b(),h(),k(),i.replace(x.o.settings()[1])}),[m,b,h,k,i]);return s.isLoading&&s.isInitialRequest||null===(e=s.data)||void 0===e||!e.items||u.isLoading&&u.isInitialRequest||null===(t=u.data)||void 0===t||!t.items||g.isLoading&&g.isInitialRequest||null===(a=g.data)||void 0===a||!a.items?l.a.createElement(v.a,{section:"settings"},l.a.createElement(y.p,null)):l.a.createElement(v.a,{section:"settings"},l.a.createElement(r.Router,{history:i},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:x.g.settings_edit_fleet_server_hosts},(e=>{var t;const a=null===(t=u.data)||void 0===t?void 0:t.items.find((t=>e.match.params.itemId===t.id));return a?l.a.createElement(c.EuiPortal,null,l.a.createElement(Dn,{onClose:M,fleetServerHost:a})):l.a.createElement(r.Redirect,{to:x.g.settings})})),l.a.createElement(r.Route,{path:x.g.settings_create_fleet_server_hosts},l.a.createElement(c.EuiPortal,null,l.a.createElement(y.l,{onClose:M}))),l.a.createElement(r.Route,{path:x.g.settings_create_outputs},l.a.createElement(c.EuiPortal,null,l.a.createElement(tl,{onClose:M}))),l.a.createElement(r.Route,{path:x.g.settings_edit_outputs},(e=>{var t;const a=null===(t=s.data)||void 0===t?void 0:t.items.find((t=>e.match.params.outputId===t.id));return a?l.a.createElement(c.EuiPortal,null,l.a.createElement(tl,{onClose:M,output:a})):l.a.createElement(r.Redirect,{to:x.g.settings})})),l.a.createElement(r.Route,{path:x.g.settings_create_download_sources},l.a.createElement(c.EuiPortal,null,l.a.createElement(ul,{onClose:M}))),l.a.createElement(r.Route,{path:x.g.settings_edit_download_sources},(e=>{var t;const a=null===(t=g.data)||void 0===t?void 0:t.items.find((t=>e.match.params.downloadSourceId===t.id));return a?l.a.createElement(c.EuiPortal,null,l.a.createElement(ul,{onClose:M,downloadSource:a})):l.a.createElement(r.Redirect,{to:x.g.settings})})))),l.a.createElement(Cn,{outputs:s.data.items,fleetServerHosts:u.data.items,deleteOutput:p,deleteFleetServerHost:f,downloadSources:g.data.items,deleteDownloadSource:E}))}));var pl=a(76),El=a(90);const fl=({value:e})=>l.a.createElement(f.CodeEditor,{isCopyable:!0,languageId:"",height:"600px",width:"100%",options:{minimap:{enabled:!1},scrollBeyondLastLine:!1,readOnly:!0,tabSize:2,lineNumbers:"off",lineNumbersMinChars:0,glyphMargin:!1,lineDecorationsWidth:0,overviewRulerBorder:!1},value:e}),bl=async()=>{const e=await Object(o.u)({full:!0,perPage:x.n,sortOrder:"asc"});if(e.error)throw new Error(e.error.message);return e},hl=()=>{var e,t;const{getHref:a}=Object(o.Nb)(),[i,s]=Object(n.useState)(),{data:r,status:g}=Object(pl.useQuery)(["debug-agent-policies"],bl),m=null!==(e=null==r||null===(t=r.data)||void 0===t?void 0:t.items)&&void 0!==e?e:[],p=m.map((e=>({label:`${e.name} - ${e.id}`,value:e.id}))),E=i?[p.find((e=>e.value===i))]:[],f=m.find((e=>e.id===i)),b=()=>{s(void 0),Dl.invalidateQueries(["debug-agent-policies"])};return"error"===g?l.a.createElement(c.EuiCallOut,{title:"Error",color:"danger"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.agentPolicyDebugger.fetchError",defaultMessage:"Error fetching Agent Policies"})):l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,{grow:!1},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.agentPolicyDebugger.description",defaultMessage:"Search for an Agent Policy using its name or {codeId} value. Use the code block below to diagnose any potential issues with the policy's configuration.",values:{codeId:l.a.createElement(c.EuiCode,null,"id")}}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart"},l.a.createElement(yl,{grow:!1},l.a.createElement(c.EuiComboBox,{"aria-label":d.i18n.translate("xpack.fleet.debug.agentPolicyDebugger.selectLabel",{defaultMessage:"Select an Agent Policy"}),placeholder:d.i18n.translate("xpack.fleet.debug.agentPolicyDebugger.selectLabel",{defaultMessage:"Select an Agent Policy"}),fullWidth:!0,options:p,singleSelection:{asPlainText:!0},selectedOptions:E,isLoading:"loading"===g,onChange:e=>{e.length?s(e[0].value):s(void 0)}})),i&&l.a.createElement(k.c,{hasFleetServer:Object(O.s)(f)},(e=>l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement("div",null,l.a.createElement(c.EuiButton,{color:"danger",onClick:()=>e(i,b)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyForm.deletePolicyActionText",defaultMessage:"Delete policy"}))))))),i&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiLink,{target:"_blank",href:a("policy_details",{policyId:i})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.agentPolicyDebugger.viewAgentPolicyLink",defaultMessage:"View Agent Policy in Fleet UI"})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(fl,{value:JSON.stringify(f,null,2)})))};var yl=m()(c.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-dwfocc-0"})(["min-width:600px;"]),xl=a(63);const vl=async()=>{var e;const t=await Object(o.I)({prerelease:!0});if(t.error)throw new Error(t.error.message);return null===(e=t.data)||void 0===e?void 0:e.items.filter((({status:e})=>"installed"===e))},kl=()=>{var e,t,a,i,s;const{http:r,notifications:g}=Object(o.Tb)(),{getHref:m}=Object(o.Nb)(),[p,E]=Object(n.useState)(),[f,b]=Object(n.useState)(!1),[h,y]=Object(n.useState)(!1),x=Object(pl.useQuery)(["debug-integrations"],vl),v=Object(pl.useMutation)((async e=>{const t=await Object(o.eb)(e.name,e.version,!0);if(t.error)throw g.toasts.addError(t.error,{title:d.i18n.translate("xpack.fleet.debug.integrationDebugger.uninstall.error",{defaultMessage:"Error uninstalling {integrationTitle}",values:{integrationTitle:e.title}}),toastMessage:t.error.message}),y(!1),new Error(t.error.message);return g.toasts.addSuccess(d.i18n.translate("xpack.fleet.debug.integrationDebugger.uninstall.success",{defaultMessage:"Successfully uninstalled {integrationTitle}",values:{integrationTitle:e.title}})),E(void 0),y(!1),Dl.invalidateQueries(["debug-integrations"]),t.data})),k=Object(pl.useMutation)((async e=>{const t=await Object(o.eb)(e.name,e.version,!0);if(t.error)throw g.toasts.addError(t.error,{title:d.i18n.translate("xpack.fleet.debug.integrationDebugger.reinstall.error",{defaultMessage:"Error reinstalling {integrationTitle}",values:{integrationTitle:e.title}}),toastMessage:t.error.message}),b(!1),new Error(t.error.message);const a=await Object(o.K)(e.name,e.version);if(a.error)throw g.toasts.addError(new Error(a.error.message),{title:d.i18n.translate("xpack.fleet.debug.integrationDebugger.reinstall.error",{defaultMessage:"Error reinstalling {integrationTitle}",values:{integrationTitle:e.title}}),toastMessage:a.error.message}),b(!1),new Error(a.error.message);return g.toasts.addSuccess(d.i18n.translate("xpack.fleet.debug.integrationDebugger.reinstall.success",{defaultMessage:"Successfully reinstalled {integrationTitle}",values:{integrationTitle:e.title}})),E(void 0),b(!1),Dl.invalidateQueries(["debug-integrations"]),a.data}));if("error"===x.status)return l.a.createElement(c.EuiCallOut,{title:"Error",color:"danger"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.fetchError",defaultMessage:"Error fetching installed Integrations"}));const M=null!==(e=null===(t=x.data)||void 0===t?void 0:t.map((e=>({label:e.name,value:e.id,icon:Object(xl.a)(e,r.basePath)}))))&&void 0!==e?e:[],F=p?[M.find((e=>e.value===p))]:[],S=null===(a=x.data)||void 0===a?void 0:a.find((e=>e.id===p));return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,{grow:!1},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.description",defaultMessage:"Use this tool to uninstall or reinstall installed integrations."})),l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.reinstallationDescription",defaultMessage:"Reinstalling an integration will uninstall and then immediately install it again. This can be useful in restoring broken or malformed integration installations when a user hasn't done much customization."}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart"},l.a.createElement(Ml,{grow:!1},l.a.createElement(c.EuiComboBox,{"aria-label":d.i18n.translate("xpack.fleet.debug.integrationDebugger.selectLabel",{defaultMessage:"Select an Integration"}),placeholder:d.i18n.translate("xpack.fleet.debug.integrationDebugger.selectLabel",{defaultMessage:"Select an Integration"}),fullWidth:!0,options:M,singleSelection:{asPlainText:!0},selectedOptions:F,isDisabled:"loading"===x.status,prepend:F.length>0?l.a.createElement(c.EuiButtonEmpty,null,l.a.createElement(c.EuiIcon,{type:null!==(i=null===(s=F[0])||void 0===s?void 0:s.icon)&&void 0!==i?i:"fleetApp"})):void 0,renderOption:(e,t,a)=>l.a.createElement("span",{className:a},l.a.createElement(c.EuiIcon,{type:e.icon})," ",l.a.createElement(c.EuiHighlight,{search:t},e.label)),onChange:e=>{e.length?E(e[0].value):E(void 0)}})),S&&l.a.createElement(c.EuiFlexGroup,null,l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"primary",onClick:()=>b(!0)},"Reinstall")),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"danger",onClick:()=>y(!0)},"Uninstall")),f&&l.a.createElement(c.EuiConfirmModal,{title:`Reinstall ${S.title}`,onCancel:()=>b(!1),onConfirm:()=>k.mutate(S),isLoading:k.isLoading,cancelButtonText:d.i18n.translate("xpack.fleet.debug.integrationDebugger.cancelReinstall",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.debug.integrationDebugger.confirmReinstall",{defaultMessage:"Reinstall"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.reinstallModal",defaultMessage:"Are you sure you want to reinstall {integrationTitle}?",values:{integrationTitle:S.title}})),h&&l.a.createElement(c.EuiConfirmModal,{title:`Uninstall ${S.title}`,onCancel:()=>y(!1),onConfirm:()=>v.mutate(S),isLoading:v.isLoading,cancelButtonText:d.i18n.translate("xpack.fleet.debug.integrationDebugger.cancelUninstall",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.debug.integrationDebugger.confirmUninstall",{defaultMessage:"Uninstall"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.uninstallModal",defaultMessage:"Are you sure you want to uninstall {integrationTitle}?",values:{integrationTitle:S.title}})))),S&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiLink,{target:"_blank",href:m("integration_details_overview",{pkgkey:Object(O.r)({name:S.name,version:S.version})})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.viewIntegrationLink",defaultMessage:"View integration settings in Integrations UI"}))))};var Ml=m()(c.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1h2nbcv-0"})(["min-width:600px;"]);const Fl=Object(n.forwardRef)((({name:e,setName:t,type:a,setNamesStatus:i},s)=>{const{data:r,refetch:u,status:g}=Object(pl.useQuery)(["debug-saved-object-names",a],(()=>(async e=>{var t;const a={size:0,query:{bool:{filter:{term:{type:e}}}},aggs:{names:{terms:{field:`${e}.name`,size:500}}}},n=await Object(o.fb)({method:"post",path:"/api/console/proxy",query:{path:"/.kibana/_search",method:"GET"},body:a});if(n.error)throw new Error(n.error.message);return null===(t=n.data)||void 0===t?void 0:t.aggregations.names.buckets})(a)),{refetchOnWindowFocus:!1});null==i||i(g),Object(n.useImperativeHandle)(s,(()=>({refetchNames:u})));const m=(null!=r?r:[]).map((e=>({label:e.key,value:e.key}))),p=m.find((t=>t.value===e)),E=p?[p]:[];return l.a.createElement(c.EuiComboBox,{prepend:"Name","aria-label":d.i18n.translate("xpack.fleet.debug.savedObjectDebugger.selectedSavedObjectLabel",{defaultMessage:"Select a Saved Object"}),placeholder:d.i18n.translate("xpack.fleet.debug.savedObjectDebugger.selectedSavedObjectLabel",{defaultMessage:"Select a Saved Object"}),fullWidth:!0,options:m,singleSelection:{asPlainText:!0},selectedOptions:E,isLoading:"loading"===g,onChange:e=>{e.length?t(e[0].value):t(void 0)}})})),Sl=()=>{const e=[{value:"ingest-agent-policies",text:d.i18n.translate("xpack.fleet.debug.savedObjectDebugger.agentPolicyLabel",{defaultMessage:"Agent policy"})},{value:"ingest-package-policies",text:d.i18n.translate("xpack.fleet.debug.savedObjectDebugger.packagePolicyLabel",{defaultMessage:"Integration policy"})},{value:"ingest-outputs",text:d.i18n.translate("xpack.fleet.debug.savedObjectDebugger.outputLabel",{defaultMessage:"Output"})},{value:"epm-packages",text:d.i18n.translate("xpack.fleet.debug.savedObjectDebugger.packageLabel",{defaultMessage:"Packages"})}],[t,a]=Object(n.useState)(e[0].value),[i,s]=Object(n.useState)(),[r,g]=Object(n.useState)(),m=Object(n.useRef)(),{data:p,status:E}=Object(pl.useQuery)(["debug-saved-objects",t,i],(()=>(async(e,t)=>{var a;if(!e||!t)return;const n={query:{bool:{must:{match:{[`${e}.name`]:t}},filter:{term:{type:e}}}}},l=await Object(o.fb)({method:"post",path:"/api/console/proxy",query:{path:"/.kibana/_search",method:"GET"},body:n});if(l.error)throw new Error(l.error.message);return null===(a=l.data)||void 0===a?void 0:a.hits})(t,i)));return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,{grow:!1},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.savedObjectDebugger.description",defaultMessage:"Search for Fleet-related saved objects by selecting a type and name. Use the code block below to diagnose any potential issues."}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart"},l.a.createElement(Il,{grow:!1},l.a.createElement(c.EuiFormRow,null,l.a.createElement(c.EuiSelect,{prepend:"Type",id:"soType",options:e,value:t,onChange:e=>(e=>{a(e.target.value),s(void 0),m.current.refetchNames()})(e),"aria-label":d.i18n.translate("xpack.fleet.debug.savedObjectDebugger.selectTypeLabel",{defaultMessage:"Select saved object type"})}))),l.a.createElement(Ol,{grow:!1},l.a.createElement(c.EuiFormRow,null,l.a.createElement(Fl,{name:i,setName:s,type:t,setNamesStatus:g,ref:m})))),("error"===E||"error"===r)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiCallOut,{title:"Error",color:"danger"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.savedObjectDebugger.fetchError",defaultMessage:"Error fetching Saved Objects"}))),(p||"loading"===E)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(fl,{value:JSON.stringify(p,null,2)})))};var Il=m()(c.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1ke6jnr-0"})(["min-width:300px;"]),Ol=m()(c.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem2",componentId:"sc-1ke6jnr-1"})(["min-width:400px;"]);const wl=async()=>{var e,t;const a=`${x.c}.is_preconfigured:true`,n=await Object(o.u)({kuery:a,perPage:x.n,full:!0});if(n.error)throw new Error(n.error.message);return null!==(e=null===(t=n.data)||void 0===t?void 0:t.items)&&void 0!==e?e:[]},Tl=()=>{var e,t,a,i;const{getHref:s}=Object(o.Nb)(),{notifications:r}=Object(o.Tb)(),[g,m]=Object(n.useState)(),[p,E]=Object(n.useState)(!1),[f,b]=Object(n.useState)(!1),h=Object(pl.useQuery)(["debug-preconfigured-policies"],wl),y=null!==(e=null===(t=h.data)||void 0===t?void 0:t.map((e=>({label:e.name,value:e.id}))))&&void 0!==e?e:[],x=g?[y.find((({value:e})=>e===g))]:[],v=null===(a=h.data)||void 0===a?void 0:a.find((e=>e.id===g)),k=Object(pl.useMutation)((async e=>{const t=await Object(o.hb)(e);if(t.error)throw r.toasts.addError(t.error,{title:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetError",{defaultMessage:"Error resetting policy"}),toastMessage:t.error.message}),new Error(t.error.message);return r.toasts.addSuccess(d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetSuccess",{defaultMessage:"Successfully reset policy"})),Dl.invalidateQueries(["debug-preconfigured-policies"]),m(void 0),E(!1),t.data})),M=Object(pl.useMutation)((async()=>{const e=await Object(o.gb)();if(e.error)throw r.toasts.addError(e.error,{title:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllError",{defaultMessage:"Error resetting policies"}),toastMessage:e.error.message}),new Error(e.error.message);return r.toasts.addSuccess(d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllSuccess",{defaultMessage:"Successfully reset policies"})),Dl.invalidateQueries(["debug-preconfigured-policies"]),m(void 0),b(!1),e.data}));return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,{grow:!1},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.description",defaultMessage:"This tool can be used to reset preconfigured policies that are managed via {codeKibanaYml}. This includes Fleet's default policies that may existin cloud environments.",values:{codeKibanaYml:l.a.createElement(c.EuiCode,null,"kibana.yml")}})),l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetInstructions",defaultMessage:'You may reset a single preconfigured policy or use the "Reset all" button to reset all preconfigured policies at once.'}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,null,l.a.createElement(jl,{grow:!1},l.a.createElement(c.EuiComboBox,{"aria-label":d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.selectLabel",{defaultMessage:"Select a preconfigured policy"}),placeholder:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.selectLabel",{defaultMessage:"Select a preconfigured policy"}),fullWidth:!0,options:y,singleSelection:{asPlainText:!0},selectedOptions:x,onChange:e=>{e.length?m(e[0].value):m(void 0)}})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement("div",null,l.a.createElement(c.EuiButton,{color:"warning",isDisabled:!g,onClick:()=>E(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetButton",defaultMessage:"Reset"})))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement("div",null,l.a.createElement(c.EuiButton,{color:"danger",isDisabled:!(null!==(i=h.data)&&void 0!==i&&i.length),onClick:()=>b(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetAllButton",defaultMessage:"Reset all"}))))),p&&v&&g&&l.a.createElement(c.EuiConfirmModal,{title:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetModalTitle",{defaultMessage:"Reset {policyName}",values:{policyName:v.name}}),onCancel:()=>E(!1),onConfirm:()=>k.mutate(g),isLoading:k.isLoading,cancelButtonText:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetModalCancel",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetModalConfirm",{defaultMessage:"Reset"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetModalBody",defaultMessage:"Are you sure you want to reset {policyName}?",values:{policyName:v.name}})),f&&l.a.createElement(c.EuiConfirmModal,{title:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllModalTitle",{defaultMessage:"Reset all preconfigured policies"}),onCancel:()=>b(!1),onConfirm:()=>M.mutate(),isLoading:M.isLoading,cancelButtonText:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllModalCancel",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllModalConfirm",{defaultMessage:"Reset all"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetAllModalBody",defaultMessage:"Are you sure you want to reset all preconfigured policies?"})),g&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiLink,{target:"_blank",href:s("policy_details",{policyId:g})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.viewAgentPolicyLink",defaultMessage:"View Agent Policy in Fleet UI"})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(fl,{value:JSON.stringify(v,null,2)})))};var jl=m()(c.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-pwyeug-0"})(["min-width:400px;"]);const Cl=()=>{var e,t,a,i;const s=[{label:".fleet-agents",value:".fleet-agents"},{label:".fleet-actions",value:".fleet-actions"}],[r,g]=Object(n.useState)(),{data:m,status:p}=Object(pl.useQuery)(["debug-indices",r],(()=>(async e=>{if(!e)return;const t=`/${e}/_search`;return await Object(o.fb)({method:"post",path:"/api/console/proxy",query:{path:t,method:"GET"}})})(r)),{retry:!1}),E=r?[s.find((e=>e.value===r))]:[];return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,{grow:!1},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.fleetIndexDebugger.description",defaultMessage:"Search for the contents of Fleet indices. Use the code block below to diagnose any potential issues. "}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,null,l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFormRow,null,l.a.createElement(c.EuiComboBox,{prepend:"Index","aria-label":d.i18n.translate("xpack.fleet.debug.fleetIndexDebugger.selectLabel",{defaultMessage:"Select an index"}),placeholder:d.i18n.translate("xpack.fleet.debug.fleetIndexDebugger.selectLabel",{defaultMessage:"Select an index"}),fullWidth:!0,options:s,singleSelection:{asPlainText:!0},selectedOptions:E,isLoading:"loading"===p,onChange:e=>{e.length?g(e[0].value):g(void 0)}})))),(null==m?void 0:m.error)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiCallOut,{title:"Error",color:"danger"},null!==(e=null==m||null===(t=m.error)||void 0===t||null===(a=t.error)||void 0===a?void 0:a.reason)&&void 0!==e?e:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.fleetIndexDebugger.fetchError",defaultMessage:"Error fetching index data"}))),m&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(fl,{value:JSON.stringify(null===(i=m.data)||void 0===i?void 0:i.hits,null,2)})))},Al=async()=>{var e,t;const a=await Object(o.F)();if(a.error)throw new Error(a.error.message);return null!==(e=null===(t=a.data)||void 0===t?void 0:t.items)&&void 0!==e?e:[]},Pl=()=>{var e;const{notifications:t}=Object(o.Tb)(),[a,i]=Object(n.useState)(),[s,r]=Object(n.useState)(!1),[g,m]=Object(n.useState)(!1),{data:p}=Object(pl.useQuery)(["debug-orphaned-policies"],Al),E=null!==(e=null==p?void 0:p.map((e=>({label:e.name,value:e.id}))))&&void 0!==e?e:[],f=a?[E.find((({value:e})=>e===a))]:[],b=null==p?void 0:p.find((e=>e.id===a)),h=Object(pl.useMutation)((async e=>{const a=await Object(o.r)({packagePolicyIds:[e],force:!0});if(a.error)throw t.toasts.addError(a.error,{title:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteError",{defaultMessage:"Error deleting policy"}),toastMessage:a.error.message}),new Error(a.error.message);return t.toasts.addSuccess(d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteSuccess",{defaultMessage:"Successfully deleted orphaned policy"})),Dl.invalidateQueries(["debug-orphaned-policies"]),i(void 0),r(!1),a.data})),y=Object(pl.useMutation)((async()=>{const e=await Object(o.r)({packagePolicyIds:null==p?void 0:p.map((e=>e.id)),force:!0});if(e.error)throw t.toasts.addError(e.error,{title:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllError",{defaultMessage:"Error deleting orphaned policies"}),toastMessage:e.error.message}),new Error(e.error.message);return t.toasts.addSuccess(d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllSuccess",{defaultMessage:"Successfully deleted all orphaned policies"})),Dl.invalidateQueries(["debug-orphaned-policies"]),i(void 0),m(!1),e.data}));return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiText,{grow:!1},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.description",defaultMessage:'This tool can be used to delete "orphaned" integration policies that have been unlinked from their parent agent policy objects'})),l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteOptions",defaultMessage:'You may delete a single orphaned integration policy or use the "Delete all" button to delete all orphaned integration policies at once.'}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,null,l.a.createElement(Ll,{grow:!1},l.a.createElement(c.EuiComboBox,{"aria-label":d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.selectLabel",{defaultMessage:"Select an orphaned integration policy"}),placeholder:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.selectLabel",{defaultMessage:"Select an orphaned integration policy"}),fullWidth:!0,options:E,singleSelection:{asPlainText:!0},selectedOptions:f,onChange:e=>{e.length?i(e[0].value):i(void 0)}})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement("div",null,l.a.createElement(c.EuiButton,{color:"warning",isDisabled:!a,onClick:()=>r(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteButton",defaultMessage:"Delete"})))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement("div",null,l.a.createElement(c.EuiButton,{color:"danger",isDisabled:!(null!=p&&p.length),onClick:()=>m(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllButton",defaultMessage:"Delete all"}))))),s&&b&&a&&l.a.createElement(c.EuiConfirmModal,{title:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteModalTitle",{defaultMessage:"Delete {policyName}",values:{policyName:b.name}}),onCancel:()=>r(!1),onConfirm:()=>h.mutate(a),isLoading:h.isLoading,cancelButtonText:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.cancelDelete",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.confirmDelete",{defaultMessage:"Delete"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteModalBody",defaultMessage:"Are you sure you want to delete {policyName}?",values:{policyName:b.name}})),g&&l.a.createElement(c.EuiConfirmModal,{title:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllModalTitle",{defaultMessage:"Delete all orphaned integration policies"}),onCancel:()=>m(!1),onConfirm:()=>y.mutate(),isLoading:y.isLoading,cancelButtonText:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.cancelDeleteAll",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.confirmDeleteAll",{defaultMessage:"Delete all"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllModalBody",defaultMessage:"Are you sure you want to delete all orphaned integration policies?"})),a&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(fl,{value:JSON.stringify(b,null,2)})))};var Ll=m()(c.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1m9frpo-0"})(["min-width:400px;"]);const Dl=new pl.QueryClient,_l=[{title:d.i18n.translate("xpack.fleet.debug.agentPolicyDebugger.title",{defaultMessage:"Agent Policy Debugger"}),id:"agentPolicyDebugger",component:l.a.createElement(hl,null)},{title:d.i18n.translate("xpack.fleet.debug.integrationDebugger.title",{defaultMessage:"Integration Debugger"}),id:"integrationDebugger",component:l.a.createElement(kl,null)},{title:d.i18n.translate("xpack.fleet.debug.savedObjectDebugger.title",{defaultMessage:"Saved Object Debugger"}),id:"savedObjectDebugger",component:l.a.createElement(Sl,null)},{title:d.i18n.translate("xpack.fleet.debug.fleetIndexDebugger.title",{defaultMessage:"Fleet Index Debugger"}),id:"fleetIndexDebugger",component:l.a.createElement(Cl,null)},{title:d.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.title",{defaultMessage:"Preconfiguration Debugger"}),id:"preconfigurationDebugger",component:l.a.createElement(Tl,null)},{title:d.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.title",{defaultMessage:"Orphaned Integration Policy Debugger"}),id:"orphanedIntegrationPolicyDebugger",component:l.a.createElement(Pl,null)}],Bl=()=>{const{chrome:e}=Object(o.Tb)(),{getHref:t}=Object(o.Nb)();return e.docTitle.change(["Debug","Fleet"]),l.a.createElement(pl.QueryClientProvider,{client:Dl},l.a.createElement(c.EuiPage,null,l.a.createElement(c.EuiPageBody,{panelled:!0},l.a.createElement(c.EuiPageHeader,{pageTitle:d.i18n.translate("xpack.fleet.debug.pageTitle",{defaultMessage:"Fleet Debugging Dashboard"}),iconType:"wrench"}),l.a.createElement(c.EuiCallOut,{color:"danger",iconType:"alert",title:"Danger zone"},l.a.createElement(c.EuiText,{grow:!1},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.dangerZone.description",defaultMessage:"This page provides an interface for directly managing Fleet's underlying data and diagnosing issues. Be aware that these debugging tools can be {strongDestructive} in nature and can result in {strongLossOfData}. Please proceed with caution.",values:{strongDestructive:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.dangerZone.destructive",defaultMessage:"destructive"})),strongLossOfData:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.dangerZone.lossOfData",defaultMessage:"loss of data"}))}}))),l.a.createElement(c.EuiSpacer,{size:"xl"}),_l.map((({title:e,id:t,component:a})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiAccordion,{id:t,initialIsOpen:!0,buttonContent:l.a.createElement(c.EuiTitle,{size:"l"},l.a.createElement("h2",null,e))},l.a.createElement(c.EuiSpacer,{size:"m"}),a),l.a.createElement(c.EuiHorizontalRule,null)))),l.a.createElement(c.EuiTitle,{size:"l"},l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.debug.usefulLinks.title",defaultMessage:"Useful links"}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiListGroup,{listItems:[{label:d.i18n.translate("xpack.fleet.debug.usefulLinks.viewAgents",{defaultMessage:"View Agents in Fleet UI"}),href:t("agent_list"),iconType:"agentApp",target:"_blank"},{label:d.i18n.translate("xpack.fleet.debug.usefulLinks.troubleshootingGuide",{defaultMessage:"Troubleshooting Guide"}),href:"https://www.elastic.co/guide/en/fleet/current/fleet-troubleshooting.html",iconType:"popout",target:"_blank"}]}))),l.a.createElement(El.ReactQueryDevtools,{initialIsOpen:!1}))},Nl=({isAddIntegrationsPath:e,children:t})=>l.a.createElement(c.EuiErrorBoundary,null,e?l.a.createElement(v.c,{leftColumn:l.a.createElement(v.b,null)},t):l.a.createElement(v.a,null,l.a.createElement(v.d,null,t))),Rl=m()(c.EuiPanel).withConfig({displayName:"Panel",componentId:"sc-11e0awm-0"})(["max-width:500px;margin-right:auto;margin-left:auto;"]),zl=Object(n.memo)((({error:e})=>"MISSING_SECURITY"===e?l.a.createElement(Ke.b,{missingRequirements:["security_required","api_keys"]}):"MISSING_PRIVILEGES"===e?l.a.createElement(Rl,{"data-test-subj":"missingPrivilegesPrompt"},l.a.createElement(c.EuiEmptyPrompt,{iconType:"securityApp",title:l.a.createElement("h2",{"data-test-subj":"missingPrivilegesPromptTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorTitle",defaultMessage:"Permission denied"})),body:l.a.createElement("p",{"data-test-subj":"missingPrivilegesPromptMessage"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorMessage",defaultMessage:"You are not authorized to access Fleet. It requires the {roleName1} Kibana privilege for Fleet, and the {roleName2} or {roleName1} privilege for Integrations.",values:{roleName1:l.a.createElement(c.EuiCode,null,'"All"'),roleName2:l.a.createElement(c.EuiCode,null,'"Read"')}}))})):l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionsRequestErrorMessageTitle",defaultMessage:"Unable to check permissions"}),error:d.i18n.translate("xpack.fleet.permissionsRequestErrorMessageDescription",{defaultMessage:"There was a problem checking Fleet permissions"})}))),Hl=Object(n.memo)((({children:e})=>{Object(o.ob)("base");const t=Object(o.Tb)(),{notifications:a}=t,i=Object(o.nb)().fleet.all,[s,c]=Object(n.useState)(!1),[g,m]=Object(n.useState)(),[p,E]=Object(n.useState)(!1),[f,b]=Object(n.useState)(null),h=!!Object(r.useRouteMatch)(x.g.add_integration_to_policy);return Object(n.useEffect)((()=>{(async()=>{c(!1),m(void 0),E(!1),b(null);try{var e;c(!0);const s=await Object(o.J)();if(c(!1),null!==(e=s.data)&&void 0!==e&&e.success){try{var t,n;const e=await Object(o.ib)();e.error&&b(e.error),null!==(t=e.data)&&void 0!==t&&null!==(n=t.nonFatalErrors)&&void 0!==n&&n.length&&a.toasts.addError(e.data.nonFatalErrors[0],{title:d.i18n.translate("xpack.fleet.setup.uiPreconfigurationErrorTitle",{defaultMessage:"Configuration error"})}),i||m("MISSING_PRIVILEGES")}catch(e){b(e)}E(!0)}else{var l;m((null===(l=s.data)||void 0===l?void 0:l.error)||"REQUEST_ERROR")}}catch(e){m("REQUEST_ERROR")}})()}),[a.toasts,i]),s||g?l.a.createElement(Nl,{isAddIntegrationsPath:h},s?l.a.createElement(y.p,null):l.a.createElement(zl,{error:g})):!p||f?l.a.createElement(Nl,{isAddIntegrationsPath:h},f?l.a.createElement(y.i,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.initializationErrorMessageTitle",defaultMessage:"Unable to initialize Fleet"}),error:f}):l.a.createElement(y.m,null)):l.a.createElement(l.a.Fragment,null,e)})),ql=Object(n.memo)((({children:e,startServices:t,config:a,history:n,kibanaVersion:i,extensions:s,routerHistory:u,theme$:d})=>{const g=E()(t.uiSettings.get$("theme:darkMode"));return l.a.createElement(f.RedirectAppLinks,{application:t.application},l.a.createElement(t.i18n.Context,null,l.a.createElement(f.KibanaContextProvider,{services:{...t}},l.a.createElement(c.EuiErrorBoundary,null,l.a.createElement(o.b.Provider,{value:a},l.a.createElement(o.e.Provider,{value:i},l.a.createElement(f.KibanaThemeProvider,{theme$:d},l.a.createElement(b.EuiThemeProvider,{darkMode:g},l.a.createElement(o.f.Provider,{value:s},l.a.createElement(o.c,null,l.a.createElement(r.Router,{history:n},l.a.createElement(h.e,{notifications:t.notifications,theme$:d},l.a.createElement(o.d,null,e)))))))))))))})),Ul=Object(n.memo)((({setHeaderActionMenu:e})=>{const t=Object(o.Tb)(),{TopNavMenu:a}=t.navigation.ui,n=[{label:d.i18n.translate("xpack.fleet.appNavigation.sendFeedbackButton",{defaultMessage:"Send feedback"}),iconType:"popout",run:()=>window.open("https://ela.st/fleet-feedback")}];return l.a.createElement(a,{appName:d.i18n.translate("xpack.fleet.appTitle",{defaultMessage:"Fleet"}),config:n,setMenuMountPoint:e})})),Gl=Object(n.memo)((({setHeaderActionMenu:e})=>{var t;const a=Object(o.ub)(),n=Object(o.tb)();return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ul,{setHeaderActionMenu:e}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:x.g.agents},l.a.createElement(Jt,null)),l.a.createElement(r.Route,{path:x.g.policies},l.a.createElement(Y,null)),l.a.createElement(r.Route,{path:x.g.enrollment_tokens},l.a.createElement(En,null)),l.a.createElement(r.Route,{path:x.g.data_streams},l.a.createElement(X,null)),l.a.createElement(r.Route,{path:x.g.settings},l.a.createElement(ml,null)),l.a.createElement(r.Route,{path:x.g.debug},l.a.createElement(Bl,null)),l.a.createElement(r.Route,{path:x.g.add_integration_to_policy},l.a.createElement(un,null)),l.a.createElement(r.Route,{render:({location:e})=>{if(!(""===e.pathname&&e.hash.length>0))return l.a.createElement(r.Redirect,{to:x.g.agents});const t=e.hash.replace(/^#(\/fleet)?/,"");return l.a.createElement(r.Redirect,{to:{...e,pathname:t,hash:void 0}})}})),a.isEnrollmentFlyoutOpen&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.c,{defaultMode:!n.isReady||null!==(t=n.missingRequirements)&&void 0!==t&&t.includes("fleet_server")?"standalone":"managed",isIntegrationFlow:!0,onClose:()=>a.closeEnrollmentFlyout()})),a.isFleetServerFlyoutOpen&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.l,{onClose:()=>a.closeFleetServerFlyout()})))})),Wl=({isAllowed:e=!1,restrictedPath:t="/",...a})=>e?l.a.createElement(r.Route,a):l.a.createElement(r.Redirect,{to:{pathname:t}}),$l=({startServices:e,config:t,history:a,kibanaVersion:n,extensions:i,setHeaderActionMenu:s,theme$:r})=>l.a.createElement(ql,{startServices:e,config:t,history:a,kibanaVersion:n,extensions:i,theme$:r},l.a.createElement(Hl,null,l.a.createElement(Gl,{setHeaderActionMenu:s})));function Vl(e,{element:t,history:a,setHeaderActionMenu:n,theme$:i},r,o,c){return s.a.render(l.a.createElement($l,{startServices:e,config:r,history:a,kibanaVersion:o,extensions:c,setHeaderActionMenu:n,theme$:i}),t),()=>{s.a.unmountComponentAtNode(t)}}const Kl=e=>{e.chrome.docTitle.reset(),e.chrome.setBreadcrumbs([]),o.g.stop()}}}]);