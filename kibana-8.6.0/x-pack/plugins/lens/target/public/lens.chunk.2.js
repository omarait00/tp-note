/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.lens_bundle_jsonpfunction=window.lens_bundle_jsonpfunction||[]).push([[2,14],Array(66).concat([function(e,t,a){e.exports=a(14)(1689)},function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return s}));function n(e,t){return`${e}---${t}`}function i(e){if(e.includes("---")){const t=e.split("---");return t[t.length-1]}return e}function s(e,t,a){e.columns.filter((e=>e.isTransposed)).reverse().forEach((({columnId:i})=>{const s=t.columns.findIndex((e=>e.id===i)),l=t.columns[s],r=a[l.id],{uniqueValues:o,uniqueRawValues:u}=function(e,t,a){const n=new Map;e.rows.forEach((e=>{const i=e[a];n.set(t.convert(e[a]),i)}));return{uniqueValues:[...n.keys()],uniqueRawValues:[...n.values()]}}(t,r,i),c=e.columns.filter((e=>e.transposable)),d=e.columns.filter((e=>!e.transposable&&e.columnId!==i));t.columns.splice(s,1),function(e,t,a,i,s,l,r){!function(e,t,a){e.columns=[...t],a[0].forEach(((t,n)=>{a.forEach((t=>{e.columns.push(t[n])}))}))}(e,t,a.map((e=>{const t=i.columns.find((t=>t.id===e.columnId)),a=s.map((a=>({...t,id:n(a,e.columnId),name:`${a} › ${t.name}`})));return i.columns.splice(i.columns.findIndex((t=>t.id===e.columnId)),1,...a),s.map(((a,i)=>({...e,columnId:n(a,e.columnId),originalColumnId:e.originalColumnId||e.columnId,originalName:e.originalName||t.name,bucketValues:[...e.bucketValues||[],{originalBucketColumn:r,value:l[i]}]})))})))}(e,d,c,t,o,u,l),function(e,t,a,i,s,l){const r=function(e,t,a){const n={};return e.rows.forEach((e=>{const i=t.map((t=>a[t.columnId].convert(e[t.columnId]))).join(",");n[i]||(n[i]=[]),n[i].push(e)})),n}(e,t,a);e.rows=function(e,t,a,i,s){return Object.values(e).map((e=>{const l={};return t.forEach((t=>{l[t.columnId]=e[0][t.columnId]})),e.forEach((e=>{const t=a.convert(e[i]);s.forEach((a=>{l[n(t,a.columnId)]=e[a.columnId]}))})),l}))}(r,t,i,s,l)}(t,d,a,r,i,c)}))}},,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(67);function i(e){return"number"==typeof e||null==e}function s(e,t){var a;const s=null==e?void 0:e.columns.find((e=>e.id===t||Object(n.a)(e.id)===t));return"number"===(null==s?void 0:s.meta.type)&&"date"!==(null==s||null===(a=s.meta.params)||void 0===a?void 0:a.id)&&(null==e?void 0:e.rows.every((e=>{const a=e[t];return i(a)||Array.isArray(a)&&a.every(i)})))}},function(e,t,a){"use strict";a.r(t),a.d(t,"YAxisModes",(function(){return s})),a.d(t,"SeriesTypes",(function(){return l})),a.d(t,"visualizationTypes",(function(){return u}));var n=a(0),i=a(60);const s={AUTO:"auto",LEFT:"left",RIGHT:"right",BOTTOM:"bottom"},l={BAR:"bar",LINE:"line",AREA:"area",BAR_STACKED:"bar_stacked",AREA_STACKED:"area_stacked",BAR_HORIZONTAL:"bar_horizontal",BAR_PERCENTAGE_STACKED:"bar_percentage_stacked",BAR_HORIZONTAL_STACKED:"bar_horizontal_stacked",AREA_PERCENTAGE_STACKED:"area_percentage_stacked",BAR_HORIZONTAL_PERCENTAGE_STACKED:"bar_horizontal_percentage_stacked"},r=n.i18n.translate("xpack.lens.xyVisualization.barGroupLabel",{defaultMessage:"Bar"}),o=n.i18n.translate("xpack.lens.xyVisualization.lineGroupLabel",{defaultMessage:"Line and area"}),u=[{id:"bar",icon:i.k,label:n.i18n.translate("xpack.lens.xyVisualization.barLabel",{defaultMessage:"Bar vertical"}),groupLabel:r,sortPriority:4},{id:"bar_horizontal",icon:i.m,label:n.i18n.translate("xpack.lens.xyVisualization.barHorizontalLabel",{defaultMessage:"H. Bar"}),fullLabel:n.i18n.translate("xpack.lens.xyVisualization.barHorizontalFullLabel",{defaultMessage:"Bar horizontal"}),groupLabel:r},{id:"bar_stacked",icon:i.r,label:n.i18n.translate("xpack.lens.xyVisualization.stackedBarLabel",{defaultMessage:"Bar vertical stacked"}),groupLabel:r},{id:"bar_percentage_stacked",icon:i.p,label:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarLabel",{defaultMessage:"Bar vertical percentage"}),groupLabel:r},{id:"bar_horizontal_stacked",icon:i.o,label:n.i18n.translate("xpack.lens.xyVisualization.stackedBarHorizontalLabel",{defaultMessage:"H. Stacked bar"}),fullLabel:n.i18n.translate("xpack.lens.xyVisualization.stackedBarHorizontalFullLabel",{defaultMessage:"Bar horizontal stacked"}),groupLabel:r},{id:"bar_horizontal_percentage_stacked",icon:i.n,label:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarHorizontalLabel",{defaultMessage:"H. Percentage bar"}),fullLabel:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageBarHorizontalFullLabel",{defaultMessage:"Bar horizontal percentage"}),groupLabel:r},{id:"area",icon:i.h,label:n.i18n.translate("xpack.lens.xyVisualization.areaLabel",{defaultMessage:"Area"}),groupLabel:o},{id:"area_stacked",icon:i.j,label:n.i18n.translate("xpack.lens.xyVisualization.stackedAreaLabel",{defaultMessage:"Area stacked"}),groupLabel:o},{id:"area_percentage_stacked",icon:i.i,label:n.i18n.translate("xpack.lens.xyVisualization.stackedPercentageAreaLabel",{defaultMessage:"Area percentage"}),groupLabel:o},{id:"line",icon:i.w,label:n.i18n.translate("xpack.lens.xyVisualization.lineLabel",{defaultMessage:"Line"}),groupLabel:o,sortPriority:2}]},,,,,,,,function(e,t){(function(t){e.exports=t}).call(this,{})},,,function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return r})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return u}));var n=a(0),i=a(67),s=a(75);function l(e,t,a){var n;const i=Object(s.a)(a,e)&&(null==t?void 0:t.summaryRow)||"none";return{summaryRow:i,summaryLabel:null!==(n=null==t?void 0:t.summaryLabel)&&void 0!==n?n:r(i)}}function r(e){return o().find((({value:t})=>e===t)).label}function o(){return[{value:"none",label:n.i18n.translate("xpack.lens.table.summaryRow.none",{defaultMessage:"None"}),"data-test-subj":"lns-datatable-summary-none"},{value:"count",label:n.i18n.translate("xpack.lens.table.summaryRow.count",{defaultMessage:"Value count"}),"data-test-subj":"lns-datatable-summary-count"},{value:"sum",label:n.i18n.translate("xpack.lens.table.summaryRow.sum",{defaultMessage:"Sum"}),"data-test-subj":"lns-datatable-summary-sum"},{value:"avg",label:n.i18n.translate("xpack.lens.table.summaryRow.average",{defaultMessage:"Average"}),"data-test-subj":"lns-datatable-summary-avg"},{value:"min",label:n.i18n.translate("xpack.lens.table.summaryRow.minimum",{defaultMessage:"Minimum"}),"data-test-subj":"lns-datatable-summary-min"},{value:"max",label:n.i18n.translate("xpack.lens.table.summaryRow.maximum",{defaultMessage:"Maximum"}),"data-test-subj":"lns-datatable-summary-max"}]}function u(e,t,a,n){const s=function(e,t,a){const n=a.filter((e=>null!=e[t])).flatMap((e=>e[t])),i=n.length,s=n.reduce(((e,t)=>e+t),0);switch(e){case"sum":return s;case"count":return i;case"avg":return s/i;case"min":return Math.min(...n);case"max":return Math.max(...n);default:throw Error("No summary function found")}}(e.summaryRow,e.columnId,t.rows);return"count"===e.summaryRow?n.convert(s):a[Object(i.a)(e.columnId)].convert(s)}},,,,,,,,,,,,,,,,,,function(e,t){e.exports={pow:function(e,t){if(null==t)throw new Error("Missing exponent");return Array.isArray(e)?e.map((e=>Math.pow(e,t))):Math.pow(e,t)}}},function(e,t){e.exports={eq:function(e,t){if(null==t)throw new Error("Missing b value");if(Array.isArray(e)){if(!Array.isArray(t))return e.every((e=>e===t));if(e.length!==t.length)throw new Error("Array length mismatch");return e.every(((e,a)=>e===t[a]))}return e===t}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n={number:{formatId:"number",decimalsToPattern:(e=2)=>0===e?"0,0":`0,0.${"0".repeat(e)}`},percent:{formatId:"percent",decimalsToPattern:(e=2)=>0===e?"0,0%":`0,0.${"0".repeat(e)}%`},bytes:{formatId:"bytes",decimalsToPattern:(e=2)=>0===e?"0,0b":`0,0.${"0".repeat(e)}b`},bits:{formatId:"number",decimalsToPattern:(e=2)=>0===e?"0,0bitd":`0,0.${"0".repeat(e)}bitd`}}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(352);case"v8light":return a(354)}},,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(212);case"v8light":return a(214)}},function(e,t,a){const n=a(239),i=a(242),s=["keyword","gray","hex"],l={};for(const e of Object.keys(i))l[[...i[e].labels].sort().join("")]=e;const r={};function o(e,t){if(!(this instanceof o))return new o(e,t);if(t&&t in s&&(t=null),t&&!(t in i))throw new Error("Unknown model: "+t);let a,u;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof o)this.model=e.model,this.color=[...e.color],this.valpha=e.valpha;else if("string"==typeof e){const t=n.get(e);if(null===t)throw new Error("Unable to parse color from string: "+e);this.model=t.model,u=i[this.model].channels,this.color=t.value.slice(0,u),this.valpha="number"==typeof t.value[u]?t.value[u]:1}else if(e.length>0){this.model=t||"rgb",u=i[this.model].channels;const a=Array.prototype.slice.call(e,0,u);this.color=p(a,u),this.valpha="number"==typeof e[u]?e[u]:1}else if("number"==typeof e)this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;const t=Object.keys(e);"alpha"in e&&(t.splice(t.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);const n=t.sort().join("");if(!(n in l))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=l[n];const{labels:s}=i[this.model],r=[];for(a=0;a<s.length;a++)r.push(e[s[a]]);this.color=p(r)}if(r[this.model])for(u=i[this.model].channels,a=0;a<u;a++){const e=r[this.model][a];e&&(this.color[a]=e(this.color[a]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}o.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(e){let t=this.model in n.to?this:this.rgb();t=t.round("number"==typeof e?e:1);const a=1===t.valpha?t.color:[...t.color,this.valpha];return n.to[t.model](a)},percentString(e){const t=this.rgb().round("number"==typeof e?e:1),a=1===t.valpha?t.color:[...t.color,this.valpha];return n.to.rgb.percent(a)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const e={},{channels:t}=i[this.model],{labels:a}=i[this.model];for(let n=0;n<t;n++)e[a[n]]=this.color[n];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray(){const e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject(){const e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round(e){return e=Math.max(e||0,0),new o([...this.color.map(u(e)),this.valpha],this.model)},alpha(e){return void 0!==e?new o([...this.color,Math.max(0,Math.min(1,e))],this.model):this.valpha},red:c("rgb",0,d(255)),green:c("rgb",1,d(255)),blue:c("rgb",2,d(255)),hue:c(["hsl","hsv","hsl","hwb","hcg"],0,(e=>(e%360+360)%360)),saturationl:c("hsl",1,d(100)),lightness:c("hsl",2,d(100)),saturationv:c("hsv",1,d(100)),value:c("hsv",2,d(100)),chroma:c("hcg",1,d(100)),gray:c("hcg",2,d(100)),white:c("hwb",1,d(100)),wblack:c("hwb",2,d(100)),cyan:c("cmyk",0,d(100)),magenta:c("cmyk",1,d(100)),yellow:c("cmyk",2,d(100)),black:c("cmyk",3,d(100)),x:c("xyz",0,d(95.047)),y:c("xyz",1,d(100)),z:c("xyz",2,d(108.833)),l:c("lab",0,d(100)),a:c("lab",1),b:c("lab",2),keyword(e){return void 0!==e?new o(e):i[this.model].keyword(this.color)},hex(e){return void 0!==e?new o(e):n.to.hex(this.rgb().round().color)},hexa(e){if(void 0!==e)return new o(e);const t=this.rgb().round().color;let a=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===a.length&&(a="0"+a),n.to.hex(t)+a},rgbNumber(){const e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity(){const e=this.rgb().color,t=[];for(const[a,n]of e.entries()){const e=n/255;t[a]=e<=.04045?e/12.92:((e+.055)/1.055)**2.4}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast(e){const t=this.luminosity(),a=e.luminosity();return t>a?(t+.05)/(a+.05):(a+.05)/(t+.05)},level(e){const t=this.contrast(e);return t>=7?"AAA":t>=4.5?"AA":""},isDark(){const e=this.rgb().color;return(2126*e[0]+7152*e[1]+722*e[2])/1e4<128},isLight(){return!this.isDark()},negate(){const e=this.rgb();for(let t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten(e){const t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken(e){const t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate(e){const t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate(e){const t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten(e){const t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken(e){const t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale(){const e=this.rgb().color,t=.3*e[0]+.59*e[1]+.11*e[2];return o.rgb(t,t,t)},fade(e){return this.alpha(this.valpha-this.valpha*e)},opaquer(e){return this.alpha(this.valpha+this.valpha*e)},rotate(e){const t=this.hsl();let a=t.color[0];return a=(a+e)%360,a=a<0?360+a:a,t.color[0]=a,t},mix(e,t){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);const a=e.rgb(),n=this.rgb(),i=void 0===t?.5:t,s=2*i-1,l=a.alpha()-n.alpha(),r=((s*l==-1?s:(s+l)/(1+s*l))+1)/2,u=1-r;return o.rgb(r*a.red()+u*n.red(),r*a.green()+u*n.green(),r*a.blue()+u*n.blue(),a.alpha()*i+n.alpha()*(1-i))}};for(const e of Object.keys(i)){if(s.includes(e))continue;const{channels:t}=i[e];o.prototype[e]=function(...t){return this.model===e?new o(this):t.length>0?new o(t,e):new o([...(a=i[this.model][e].raw(this.color),Array.isArray(a)?a:[a]),this.valpha],e);var a},o[e]=function(...a){let n=a[0];return"number"==typeof n&&(n=p(a,t)),new o(n,e)}}function u(e){return function(t){return function(e,t){return Number(e.toFixed(t))}(t,e)}}function c(e,t,a){e=Array.isArray(e)?e:[e];for(const n of e)(r[n]||(r[n]=[]))[t]=a;return e=e[0],function(n){let i;return void 0!==n?(a&&(n=a(n)),i=this[e](),i.color[t]=n,i):(i=this[e]().color[t],a&&(i=a(i)),i)}}function d(e){return function(t){return Math.max(0,Math.min(e,t))}}function p(e,t){for(let a=0;a<t;a++)"number"!=typeof e[a]&&(e[a]=0);return e}e.exports=o},function(e,t,a){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(e,t,a){const n=a(133),i={};for(const e of Object.keys(n))i[n[e]]=e;const s={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};e.exports=s;for(const e of Object.keys(s)){if(!("channels"in s[e]))throw new Error("missing channels property: "+e);if(!("labels"in s[e]))throw new Error("missing channel labels property: "+e);if(s[e].labels.length!==s[e].channels)throw new Error("channel and label counts mismatch: "+e);const{channels:t,labels:a}=s[e];delete s[e].channels,delete s[e].labels,Object.defineProperty(s[e],"channels",{value:t}),Object.defineProperty(s[e],"labels",{value:a})}s.rgb.hsl=function(e){const t=e[0]/255,a=e[1]/255,n=e[2]/255,i=Math.min(t,a,n),s=Math.max(t,a,n),l=s-i;let r,o;s===i?r=0:t===s?r=(a-n)/l:a===s?r=2+(n-t)/l:n===s&&(r=4+(t-a)/l),r=Math.min(60*r,360),r<0&&(r+=360);const u=(i+s)/2;return o=s===i?0:u<=.5?l/(s+i):l/(2-s-i),[r,100*o,100*u]},s.rgb.hsv=function(e){let t,a,n,i,s;const l=e[0]/255,r=e[1]/255,o=e[2]/255,u=Math.max(l,r,o),c=u-Math.min(l,r,o),d=function(e){return(u-e)/6/c+.5};return 0===c?(i=0,s=0):(s=c/u,t=d(l),a=d(r),n=d(o),l===u?i=n-a:r===u?i=1/3+t-n:o===u&&(i=2/3+a-t),i<0?i+=1:i>1&&(i-=1)),[360*i,100*s,100*u]},s.rgb.hwb=function(e){const t=e[0],a=e[1];let n=e[2];const i=s.rgb.hsl(e)[0],l=1/255*Math.min(t,Math.min(a,n));return n=1-1/255*Math.max(t,Math.max(a,n)),[i,100*l,100*n]},s.rgb.cmyk=function(e){const t=e[0]/255,a=e[1]/255,n=e[2]/255,i=Math.min(1-t,1-a,1-n);return[100*((1-t-i)/(1-i)||0),100*((1-a-i)/(1-i)||0),100*((1-n-i)/(1-i)||0),100*i]},s.rgb.keyword=function(e){const t=i[e];if(t)return t;let a,s=1/0;for(const t of Object.keys(n)){const i=(r=n[t],((l=e)[0]-r[0])**2+(l[1]-r[1])**2+(l[2]-r[2])**2);i<s&&(s=i,a=t)}var l,r;return a},s.keyword.rgb=function(e){return n[e]},s.rgb.xyz=function(e){let t=e[0]/255,a=e[1]/255,n=e[2]/255;return t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,a=a>.04045?((a+.055)/1.055)**2.4:a/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,[100*(.4124*t+.3576*a+.1805*n),100*(.2126*t+.7152*a+.0722*n),100*(.0193*t+.1192*a+.9505*n)]},s.rgb.lab=function(e){const t=s.rgb.xyz(e);let a=t[0],n=t[1],i=t[2];return a/=95.047,n/=100,i/=108.883,a=a>.008856?a**(1/3):7.787*a+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,i=i>.008856?i**(1/3):7.787*i+16/116,[116*n-16,500*(a-n),200*(n-i)]},s.hsl.rgb=function(e){const t=e[0]/360,a=e[1]/100,n=e[2]/100;let i,s,l;if(0===a)return l=255*n,[l,l,l];i=n<.5?n*(1+a):n+a-n*a;const r=2*n-i,o=[0,0,0];for(let e=0;e<3;e++)s=t+1/3*-(e-1),s<0&&s++,s>1&&s--,l=6*s<1?r+6*(i-r)*s:2*s<1?i:3*s<2?r+(i-r)*(2/3-s)*6:r,o[e]=255*l;return o},s.hsl.hsv=function(e){const t=e[0];let a=e[1]/100,n=e[2]/100,i=a;const s=Math.max(n,.01);return n*=2,a*=n<=1?n:2-n,i*=s<=1?s:2-s,[t,100*(0===n?2*i/(s+i):2*a/(n+a)),(n+a)/2*100]},s.hsv.rgb=function(e){const t=e[0]/60,a=e[1]/100;let n=e[2]/100;const i=Math.floor(t)%6,s=t-Math.floor(t),l=255*n*(1-a),r=255*n*(1-a*s),o=255*n*(1-a*(1-s));switch(n*=255,i){case 0:return[n,o,l];case 1:return[r,n,l];case 2:return[l,n,o];case 3:return[l,r,n];case 4:return[o,l,n];case 5:return[n,l,r]}},s.hsv.hsl=function(e){const t=e[0],a=e[1]/100,n=e[2]/100,i=Math.max(n,.01);let s,l;l=(2-a)*n;const r=(2-a)*i;return s=a*i,s/=r<=1?r:2-r,s=s||0,l/=2,[t,100*s,100*l]},s.hwb.rgb=function(e){const t=e[0]/360;let a=e[1]/100,n=e[2]/100;const i=a+n;let s;i>1&&(a/=i,n/=i);const l=Math.floor(6*t),r=1-n;s=6*t-l,0!=(1&l)&&(s=1-s);const o=a+s*(r-a);let u,c,d;switch(l){default:case 6:case 0:u=r,c=o,d=a;break;case 1:u=o,c=r,d=a;break;case 2:u=a,c=r,d=o;break;case 3:u=a,c=o,d=r;break;case 4:u=o,c=a,d=r;break;case 5:u=r,c=a,d=o}return[255*u,255*c,255*d]},s.cmyk.rgb=function(e){const t=e[0]/100,a=e[1]/100,n=e[2]/100,i=e[3]/100;return[255*(1-Math.min(1,t*(1-i)+i)),255*(1-Math.min(1,a*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i))]},s.xyz.rgb=function(e){const t=e[0]/100,a=e[1]/100,n=e[2]/100;let i,s,l;return i=3.2406*t+-1.5372*a+-.4986*n,s=-.9689*t+1.8758*a+.0415*n,l=.0557*t+-.204*a+1.057*n,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,i=Math.min(Math.max(0,i),1),s=Math.min(Math.max(0,s),1),l=Math.min(Math.max(0,l),1),[255*i,255*s,255*l]},s.xyz.lab=function(e){let t=e[0],a=e[1],n=e[2];return t/=95.047,a/=100,n/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,a=a>.008856?a**(1/3):7.787*a+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,[116*a-16,500*(t-a),200*(a-n)]},s.lab.xyz=function(e){let t,a,n;a=(e[0]+16)/116,t=e[1]/500+a,n=a-e[2]/200;const i=a**3,s=t**3,l=n**3;return a=i>.008856?i:(a-16/116)/7.787,t=s>.008856?s:(t-16/116)/7.787,n=l>.008856?l:(n-16/116)/7.787,t*=95.047,a*=100,n*=108.883,[t,a,n]},s.lab.lch=function(e){const t=e[0],a=e[1],n=e[2];let i;return i=360*Math.atan2(n,a)/2/Math.PI,i<0&&(i+=360),[t,Math.sqrt(a*a+n*n),i]},s.lch.lab=function(e){const t=e[0],a=e[1],n=e[2]/360*2*Math.PI;return[t,a*Math.cos(n),a*Math.sin(n)]},s.rgb.ansi16=function(e,t=null){const[a,n,i]=e;let l=null===t?s.rgb.hsv(e)[2]:t;if(l=Math.round(l/50),0===l)return 30;let r=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(a/255));return 2===l&&(r+=60),r},s.hsv.ansi16=function(e){return s.rgb.ansi16(s.hsv.rgb(e),e[2])},s.rgb.ansi256=function(e){const t=e[0],a=e[1],n=e[2];return t===a&&a===n?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(a/255*5)+Math.round(n/255*5)},s.ansi16.rgb=function(e){let t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),t=t/10.5*255,[t,t,t];const a=.5*(1+~~(e>50));return[(1&t)*a*255,(t>>1&1)*a*255,(t>>2&1)*a*255]},s.ansi256.rgb=function(e){if(e>=232){const t=10*(e-232)+8;return[t,t,t]}let t;return e-=16,[Math.floor(e/36)/5*255,Math.floor((t=e%36)/6)/5*255,t%6/5*255]},s.rgb.hex=function(e){const t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},s.hex.rgb=function(e){const t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let a=t[0];3===t[0].length&&(a=a.split("").map((e=>e+e)).join(""));const n=parseInt(a,16);return[n>>16&255,n>>8&255,255&n]},s.rgb.hcg=function(e){const t=e[0]/255,a=e[1]/255,n=e[2]/255,i=Math.max(Math.max(t,a),n),s=Math.min(Math.min(t,a),n),l=i-s;let r,o;return r=l<1?s/(1-l):0,o=l<=0?0:i===t?(a-n)/l%6:i===a?2+(n-t)/l:4+(t-a)/l,o/=6,o%=1,[360*o,100*l,100*r]},s.hsl.hcg=function(e){const t=e[1]/100,a=e[2]/100,n=a<.5?2*t*a:2*t*(1-a);let i=0;return n<1&&(i=(a-.5*n)/(1-n)),[e[0],100*n,100*i]},s.hsv.hcg=function(e){const t=e[1]/100,a=e[2]/100,n=t*a;let i=0;return n<1&&(i=(a-n)/(1-n)),[e[0],100*n,100*i]},s.hcg.rgb=function(e){const t=e[0]/360,a=e[1]/100,n=e[2]/100;if(0===a)return[255*n,255*n,255*n];const i=[0,0,0],s=t%1*6,l=s%1,r=1-l;let o=0;switch(Math.floor(s)){case 0:i[0]=1,i[1]=l,i[2]=0;break;case 1:i[0]=r,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=l;break;case 3:i[0]=0,i[1]=r,i[2]=1;break;case 4:i[0]=l,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=r}return o=(1-a)*n,[255*(a*i[0]+o),255*(a*i[1]+o),255*(a*i[2]+o)]},s.hcg.hsv=function(e){const t=e[1]/100,a=t+e[2]/100*(1-t);let n=0;return a>0&&(n=t/a),[e[0],100*n,100*a]},s.hcg.hsl=function(e){const t=e[1]/100,a=e[2]/100*(1-t)+.5*t;let n=0;return a>0&&a<.5?n=t/(2*a):a>=.5&&a<1&&(n=t/(2*(1-a))),[e[0],100*n,100*a]},s.hcg.hwb=function(e){const t=e[1]/100,a=t+e[2]/100*(1-t);return[e[0],100*(a-t),100*(1-a)]},s.hwb.hcg=function(e){const t=e[1]/100,a=1-e[2]/100,n=a-t;let i=0;return n<1&&(i=(a-n)/(1-n)),[e[0],100*n,100*i]},s.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},s.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},s.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},s.gray.hsl=function(e){return[0,0,e[0]]},s.gray.hsv=s.gray.hsl,s.gray.hwb=function(e){return[0,100,e[0]]},s.gray.cmyk=function(e){return[0,0,0,e[0]]},s.gray.lab=function(e){return[e[0],0,0]},s.gray.hex=function(e){const t=255&Math.round(e[0]/100*255),a=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(a.length)+a},s.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},function(e,t,a){const{get:n}=a(21),i=a(89),{functions:s}=a(264),{parse:l}=a(301),r=i((function(e,t){if(null==e)throw new Error("Missing expression");if("string"!=typeof e)throw new Error("Expression must be a string");try{return l(e,t)}catch(e){throw new Error(`Failed to parse expression. ${e.message}`)}}));function o(e,t,a){const i=Object.assign({},s,a);return function e(a){if("number"==typeof a)return a;if("function"===a.type)return function(t){const{name:a,args:n}=t,s=i[a];if(!s)throw new Error(`No such function: ${a}`);const l=n.map(e);return s.skipNumberValidation||u(l)?s(...l):NaN}(a);if("variable"===a.type){const e=function(e,t){const a=n(e,t);return void 0!==a?a:e[t]}(t,a.value);if(void 0===e)throw new Error(`Unknown variable: ${a.value}`);return e}if("namedArgument"===a.type)throw new Error(`Named arguments are not supported in tinymath itself, at ${a.name}`)}(e)}function u(e){return e.every((e=>Array.isArray(e)?u(e):"number"==typeof e&&!isNaN(e)))}e.exports={parse:r,evaluate:function(e,t={},a={}){return t=t||{},o(r(e),t,a)},interpret:o}},function(e,t){e.exports={add:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>e+t)):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e+t[a]))}return Array.isArray(e)?e.map((e=>e+t)):Array.isArray(t)?t.map((t=>t+e)):e+t}))}}},function(e,t){function a(e){if(Array.isArray(e))return e.length;throw new Error("Must pass an array")}a.skipNumberValidation=!0,e.exports={size:a}},function(e,t){const a=(e,t)=>Math.log(e)/Math.log(t);e.exports={log:function(e,t=Math.E){if(t<=0)throw new Error("Base out of range");if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Must be greater than 0");return a(e,t)}));if(e<0)throw new Error("Must be greater than 0");return a(e,t)}}},function(e,t){e.exports={max:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.max(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.max(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.max(e,t))):Array.isArray(t)?t.map((t=>Math.max(t,e))):Math.max(e,t)}))}}},function(e,t){e.exports={transpose:function(e,t){const a=e[t].length;return e[t].map(((t,n)=>e.map((e=>{if(Array.isArray(e)){if(e.length!==a)throw new Error("Array length mismatch");return e[n]}return e}))))}}},function(e,t){e.exports={min:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.min(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.min(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.min(e,t))):Array.isArray(t)?t.map((t=>Math.min(t,e))):Math.min(e,t)}))}}},function(e,t){e.exports={subtract:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e-t[a]))}return Array.isArray(e)?e.map((e=>e-t)):Array.isArray(t)?t.map((t=>e-t)):e-t}}},function(e,t){e.exports={lt:function(e,t){if(null==t)throw new Error("Missing b value");if(Array.isArray(e)){if(!Array.isArray(t))return e.every((e=>e<t));if(e.length!==t.length)throw new Error("Array length mismatch");return e.every(((e,a)=>e<t[a]))}return e<t}}},function(e,t){e.exports={gt:function(e,t){if(null==t)throw new Error("Missing b value");if(Array.isArray(e)){if(!Array.isArray(t))return e.every((e=>e>t));if(e.length!==t.length)throw new Error("Array length mismatch");return e.every(((e,a)=>e>t[a]))}return e>t}}},,,,,,,,,,,,,,function(e,t,a){"use strict";e.exports=function(e,t){return t||(t={}),"string"!=typeof(e=e&&e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},function(e,t,a){e.exports=a.p+"1cbd62546f764080f7071e03889e9de3.svg"},,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(165);case"v8light":return a(167)}},function(e,t,a){var n=a(55),i=a(166);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell--multiline{white-space:pre-wrap}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(168);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell--multiline{white-space:pre-wrap}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},,,,,,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(180);case"v8light":return a(182)}},function(e,t,a){var n=a(55),i=a(181);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsVisualizationContainer{overflow:auto hidden;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{height:16px;width:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer{border-radius:6px;display:flex;height:100%;overflow:auto;position:relative;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin;width:100%}.lnsExpressionRenderer::-webkit-scrollbar{height:16px;width:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{align-items:center;display:flex;flex-grow:1;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(183);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsVisualizationContainer{overflow:auto hidden;scrollbar-color:#69707d80 #0000;scrollbar-width:thin;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{height:16px;width:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer{border-radius:6px;display:flex;height:100%;overflow:auto;position:relative;scrollbar-color:#69707d80 #0000;scrollbar-width:thin;width:100%}.lnsExpressionRenderer::-webkit-scrollbar{height:16px;width:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{align-items:center;display:flex;flex-grow:1;justify-content:center;overflow:auto}.lnsSelectableErrorMessage{-webkit-user-select:text;user-select:text}",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(34),i=a(129),s=n.__importDefault(a(130));t.default=function(e,t){s.default(e,t,i.isDeepEqual)}},,function(e,t,a){var n=a(55),i=a(213);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(215);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(217);case"v8light":return a(219)}},function(e,t,a){var n=a(55),i=a(218);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(220);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(225);case"v8light":return a(227)}},function(e,t,a){var n=a(55),i=a(226);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(228);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(230);case"v8light":return a(232)}},function(e,t,a){var n=a(55),i=a(231);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(233);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(235);case"v8light":return a(237)}},function(e,t,a){var n=a(55),i=a(236);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsRowCompressedMargin+.lnsRowCompressedMargin{margin-top:8px}.lnsConfigPanelNoPadding{padding:0}.lnsConfigPanelDate__label{min-width:56px}.lnsConfigPanelAnnotations__addButton{margin-top:4px}.lnsConfigPanelAnnotations__fieldPicker{cursor:pointer}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(238);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsRowCompressedMargin+.lnsRowCompressedMargin{margin-top:8px}.lnsConfigPanelNoPadding{padding:0}.lnsConfigPanelDate__label{min-width:56px}.lnsConfigPanelAnnotations__addButton{margin-top:4px}.lnsConfigPanelAnnotations__fieldPicker{cursor:pointer}",""]),e.exports=t},function(e,t,a){var n=a(133),i=a(240),s=Object.hasOwnProperty,l={};for(var r in n)s.call(n,r)&&(l[n[r]]=r);var o=e.exports={to:{},get:{}};function u(e,t,a){return Math.min(Math.max(t,e),a)}function c(e){var t=Math.round(e).toString(16).toUpperCase();return t.length<2?"0"+t:t}o.get=function(e){var t,a;switch(e.substring(0,3).toLowerCase()){case"hsl":t=o.get.hsl(e),a="hsl";break;case"hwb":t=o.get.hwb(e),a="hwb";break;default:t=o.get.rgb(e),a="rgb"}return t?{model:a,value:t}:null},o.get.rgb=function(e){if(!e)return null;var t,a,i,l=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=t[2],t=t[1],a=0;a<3;a++){var r=2*a;l[a]=parseInt(t.slice(r,r+2),16)}i&&(l[3]=parseInt(i,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(i=(t=t[1])[3],a=0;a<3;a++)l[a]=parseInt(t[a]+t[a],16);i&&(l[3]=parseInt(i+i,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(a=0;a<3;a++)l[a]=parseInt(t[a+1],0);t[4]&&(t[5]?l[3]=.01*parseFloat(t[4]):l[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(t=e.match(/^(\w+)$/))?"transparent"===t[1]?[0,0,0,0]:s.call(n,t[1])?((l=n[t[1]])[3]=1,l):null:null;for(a=0;a<3;a++)l[a]=Math.round(2.55*parseFloat(t[a+1]));t[4]&&(t[5]?l[3]=.01*parseFloat(t[4]):l[3]=parseFloat(t[4]))}for(a=0;a<3;a++)l[a]=u(l[a],0,255);return l[3]=u(l[3],0,1),l},o.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,u(parseFloat(t[2]),0,100),u(parseFloat(t[3]),0,100),u(isNaN(a)?1:a,0,1)]}return null},o.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,u(parseFloat(t[2]),0,100),u(parseFloat(t[3]),0,100),u(isNaN(a)?1:a,0,1)]}return null},o.to.hex=function(){var e=i(arguments);return"#"+c(e[0])+c(e[1])+c(e[2])+(e[3]<1?c(Math.round(255*e[3])):"")},o.to.rgb=function(){var e=i(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},o.to.rgb.percent=function(){var e=i(arguments),t=Math.round(e[0]/255*100),a=Math.round(e[1]/255*100),n=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+a+"%, "+n+"%)":"rgba("+t+"%, "+a+"%, "+n+"%, "+e[3]+")"},o.to.hsl=function(){var e=i(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},o.to.hwb=function(){var e=i(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},o.to.keyword=function(e){return l[e.slice(0,3)]}},function(e,t,a){"use strict";var n=a(241),i=Array.prototype.concat,s=Array.prototype.slice,l=e.exports=function(e){for(var t=[],a=0,l=e.length;a<l;a++){var r=e[a];n(r)?t=i.call(t,s.call(r)):t.push(r)}return t};l.wrap=function(e){return function(){return e(l(arguments))}}},function(e,t){e.exports=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))}},function(e,t,a){const n=a(134),i=a(243),s={};Object.keys(n).forEach((e=>{s[e]={},Object.defineProperty(s[e],"channels",{value:n[e].channels}),Object.defineProperty(s[e],"labels",{value:n[e].labels});const t=i(e);Object.keys(t).forEach((a=>{const n=t[a];s[e][a]=function(e){const t=function(...t){const a=t[0];if(null==a)return a;a.length>1&&(t=a);const n=e(t);if("object"==typeof n)for(let e=n.length,t=0;t<e;t++)n[t]=Math.round(n[t]);return n};return"conversion"in e&&(t.conversion=e.conversion),t}(n),s[e][a].raw=function(e){const t=function(...t){const a=t[0];return null==a?a:(a.length>1&&(t=a),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(n)}))})),e.exports=s},function(e,t,a){const n=a(134);function i(e,t){return function(a){return t(e(a))}}function s(e,t){const a=[t[e].parent,e];let s=n[t[e].parent][e],l=t[e].parent;for(;t[l].parent;)a.unshift(t[l].parent),s=i(n[t[l].parent][l],s),l=t[l].parent;return s.conversion=a,s}e.exports=function(e){const t=function(e){const t=function(){const e={},t=Object.keys(n);for(let a=t.length,n=0;n<a;n++)e[t[n]]={distance:-1,parent:null};return e}(),a=[e];for(t[e].distance=0;a.length;){const e=a.pop(),i=Object.keys(n[e]);for(let n=i.length,s=0;s<n;s++){const n=i[s],l=t[n];-1===l.distance&&(l.distance=t[e].distance+1,l.parent=e,a.unshift(n))}}return t}(e),a={},i=Object.keys(t);for(let e=i.length,n=0;n<e;n++){const e=i[n];null!==t[e].parent&&(a[e]=s(e,t))}return a}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(245);case"v8light":return a(247)}},function(e,t,a){var n=a(55),i=a(246);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(248);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(250);case"v8light":return a(252)}},function(e,t,a){var n=a(55),i=a(251);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(253);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(255);case"v8light":return a(257)}},function(e,t,a){var n=a(55),i=a(256);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(258);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(260);case"v8light":return a(262)}},function(e,t,a){var n=a(55),i=a(261);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(263);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){const{abs:n}=a(265),{add:i}=a(136),{cbrt:s}=a(266),{ceil:l}=a(267),{clamp:r}=a(268),{cos:o}=a(269),{count:u}=a(270),{cube:c}=a(271),{defaults:d}=a(272),{degtorad:p}=a(273),{divide:m}=a(274),{exp:g}=a(275),{first:f}=a(276),{fix:b}=a(277),{floor:h}=a(278),{last:x}=a(279),{log:v}=a(138),{log10:y}=a(280),{max:j}=a(139),{mean:O}=a(281),{median:k}=a(282),{min:I}=a(141),{mod:T}=a(283),{mode:w}=a(284),{multiply:M}=a(285),{pi:C}=a(286),{pow:S}=a(105),{radtodeg:F}=a(287),{random:E}=a(288),{range:P}=a(289),{round:A}=a(290),{sin:_}=a(291),{size:L}=a(137),{sqrt:D}=a(292),{square:N}=a(293),{subtract:R}=a(142),{sum:B}=a(294),{tan:V}=a(295),{unique:z}=a(296),{eq:G,lt:q,gt:H,lte:$,gte:W,ifelse:U}=a(297);e.exports={functions:{abs:n,add:i,cbrt:s,ceil:l,clamp:r,cos:o,count:u,cube:c,degtorad:p,defaults:d,divide:m,exp:g,first:f,fix:b,floor:h,ifelse:U,last:x,log:v,log10:y,max:j,mean:O,median:k,min:I,mod:T,mode:w,multiply:M,pi:C,pow:S,radtodeg:F,random:E,range:P,round:A,sin:_,size:L,sqrt:D,square:N,subtract:R,sum:B,tan:V,unique:z,eq:G,lt:q,gt:H,lte:$,gte:W}}},function(e,t){e.exports={abs:function(e){return Array.isArray(e)?e.map((e=>Math.abs(e))):Math.abs(e)}}},function(e,t){e.exports={cbrt:function(e){return Array.isArray(e)?e.map((e=>Math.cbrt(e))):Math.cbrt(e)}}},function(e,t){e.exports={ceil:function(e){return Array.isArray(e)?e.map((e=>Math.ceil(e))):Math.ceil(e)}}},function(e,t){const a=(e,t,a)=>{if(t>a)throw new Error("Min must be less than max");return Math.min(Math.max(e,t),a)};e.exports={clamp:function(e,t,n){if(null===n)throw new Error("Missing maximum value. You may want to use the 'min' function instead");if(null===t)throw new Error("Missing minimum value. You may want to use the 'max' function instead");if(Array.isArray(n)){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==n.length||e.length!==t.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t[i],n)))}if(Array.isArray(e)){if(e.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t,n)))}if(Array.isArray(t)){if(t.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e,t[i],n)))}return n.map((n=>a(e,t,n)))}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,n)=>a(e,t[n])))}return Array.isArray(e)?e.map((e=>a(e,t,n))):Array.isArray(t)?t.map((t=>a(e,t,n))):a(e,t,n)}}},function(e,t){e.exports={cos:function(e){return Array.isArray(e)?e.map((e=>Math.cos(e))):Math.cos(e)}}},function(e,t,a){const{size:n}=a(137);function i(e){return n(e)}i.skipNumberValidation=!0,e.exports={count:i}},function(e,t,a){const{pow:n}=a(105);e.exports={cube:function(e){return n(e,3)}}},function(e,t){function a(e,t){return Array.isArray(e)?e.map((e=>null==e?t:e)):null==e?t:e}e.exports={defaults:a},a.skipNumberValidation=!0},function(e,t){e.exports={degtorad:function(e){return Array.isArray(e)?e.map((e=>e*Math.PI/180)):e*Math.PI/180}}},function(e,t){e.exports={divide:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e/t[a]}))}if(Array.isArray(t))return t.map((t=>{if(0===t)throw new Error("Cannot divide by 0");return e/t}));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e/t)):e/t}}},function(e,t){e.exports={exp:function(e){return Array.isArray(e)?e.map((e=>Math.exp(e))):Math.exp(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[0]:e}a.skipNumberValidation=!0,e.exports={first:a}},function(e,t){const a=e=>e>0?Math.floor(e):Math.ceil(e);e.exports={fix:function(e){return Array.isArray(e)?e.map((e=>a(e))):a(e)}}},function(e,t){e.exports={floor:function(e){return Array.isArray(e)?e.map((e=>Math.floor(e))):Math.floor(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[e.length-1]:e}a.skipNumberValidation=!0,e.exports={last:a}},function(e,t,a){const{log:n}=a(138);e.exports={log10:function(e){return n(e,10)}}},function(e,t,a){const{add:n}=a(136);e.exports={mean:function(...e){if(1===e.length)return Array.isArray(e[0])?n(e[0])/e[0].length:e[0];const t=n(...e);return Array.isArray(t)?t.map((t=>t/e.length)):t/e.length}}},function(e,t,a){const{transpose:n}=a(140),i=e=>{const t=e.length,a=Math.floor(t/2);return e.sort(((e,t)=>t-e)),t%2==0?(e[a]+e[a-1])/2:e[a]};e.exports={median:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={mod:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e%t[a]}))}if(Array.isArray(t))return t.map((t=>e%t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e%t)):e%t}}},function(e,t,a){const{transpose:n}=a(140),i=e=>{let t=0;const a={};return e.map((e=>{void 0===a[e]&&(a[e]=0),a[e]+=1,a[e]>t&&(t=a[e])})),Object.keys(a).filter((e=>a[e]===t)).map((e=>parseFloat(e))).sort(((e,t)=>e-t))};e.exports={mode:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={multiply:function(...e){return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e*t[a]))}return Array.isArray(e)?e.map((e=>e*t)):Array.isArray(t)?t.map((t=>t*e)):e*t}))}}},function(e,t){e.exports={pi:function(){return Math.PI}}},function(e,t){e.exports={radtodeg:function(e){return Array.isArray(e)?e.map((e=>180*e/Math.PI)):180*e/Math.PI}}},function(e,t){e.exports={random:function(e,t){if(null==e)return Math.random();if(null==t){if(e<0)throw new Error("Min is greater than max");return Math.random()*e}if(e>t)throw new Error("Min is greater than max");return Math.random()*(t-e)+e}}},function(e,t,a){const{max:n}=a(139),{min:i}=a(141),{subtract:s}=a(142);e.exports={range:function(...e){return s(n(...e),i(...e))}}},function(e,t){const a=(e,t=0)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t);e.exports={round:function(e,t){return Array.isArray(e)?e.map((e=>a(e,t))):a(e,t)}}},function(e,t){e.exports={sin:function(e){return Array.isArray(e)?e.map((e=>Math.sin(e))):Math.sin(e)}}},function(e,t){e.exports={sqrt:function(e){if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}));if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}}},function(e,t,a){const{pow:n}=a(105);e.exports={square:function(e){return n(e,2)}}},function(e,t){const a=(e,t)=>e+t;e.exports={sum:function(...e){return e.reduce(((e,t)=>Array.isArray(t)?e+t.reduce(a,0):e+t),0)}}},function(e,t){e.exports={tan:function(e){return Array.isArray(e)?e.map((e=>Math.tan(e))):Math.tan(e)}}},function(e,t){function a(e){return Array.isArray(e)?e.filter(((t,a)=>e.indexOf(t)===a)).length:1}a.skipNumberValidation=!0,e.exports={unique:a}},function(e,t,a){const{eq:n}=a(106),{lt:i}=a(143),{gt:s}=a(144),{lte:l}=a(298),{gte:r}=a(299),{ifelse:o}=a(300);e.exports={eq:n,lt:i,gt:s,lte:l,gte:r,ifelse:o}},function(e,t,a){const{eq:n}=a(106),{lt:i}=a(143);e.exports={lte:function(e,t){return n(e,t)||i(e,t)}}},function(e,t,a){const{eq:n}=a(106),{gt:i}=a(144);e.exports={gte:function(e,t){return n(e,t)||i(e,t)}}},function(e,t){function a(e,t,a){if("boolean"!=typeof e)throw Error("Condition clause is of the wrong type");if(null==t)throw new Error("Missing a value");if(null==a)throw new Error("Missing b value");return e?t:a}a.skipNumberValidation=!0,e.exports={ifelse:a}},function(e,t,a){"use strict";function n(e,t,a,i){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,n.prototype),s.expected=t,s.found=a,s.location=i,s.name="SyntaxError",s}function i(e,t,a){return a=a||" ",e.length>t?e:(t-=e.length,e+(a+=a.repeat(t)).slice(0,t))}!function(e,t){function a(){this.constructor=e}a.prototype=t.prototype,e.prototype=new a}(n,Error),n.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var a,n=null;for(a=0;a<e.length;a++)if(e[a].source===this.location.source){n=e[a].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,l=this.location.source+":"+s.line+":"+s.column;if(n){var r=this.location.end,o=i("",s.line.toString().length),u=n[s.line-1],c=s.line===r.line?r.column:u.length+1;t+="\n --\x3e "+l+"\n"+o+" |\n"+s.line+" | "+u+"\n"+o+" | "+i("",s.column-1)+i("",c-s.column,"^")}else t+="\n at "+l}return t},n.buildMessage=function(e,t){var a={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function l(e){return a[e.type](e)}return"Expected "+function(e){var t,a,n=e.map(l);if(n.sort(),n.length>0){for(t=1,a=1;t<n.length;t++)n[t-1]!==n[t]&&(n[a]=n[t],a++);n.length=a}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:n,parse:function(e,t){var a,i={},s=(t=void 0!==t?t:{}).grammarSource,l={start:be},r=be,o='"',u='\\"',c="'",d="\\'",p="=",m="-",g=/^[ \t\n\r]/,f=/^[0-9A-Za-z._@[\]\-]/,b=/^[^"]/,h=/^[^']/,x=/^[a-zA-Z_]/,v=/^[a-zA-Z_\-]/,y=/^[eE]/,j=/^[1-9]/,O=/^[0-9]/,k=pe("whitespace"),I=de([" ","\t","\n","\r"],!1,!1),T=(de([" "],!1,!1),de(['"',"'"],!1,!1),de([["A","Z"],["a","z"],"_","@",".","[","]","-"],!1,!1),de([["0","9"],["A","Z"],["a","z"],".","_","@","[","]","-"],!1,!1)),w=pe("literal"),M=ce('"',!1),C=ce('\\"',!1),S=de(['"'],!0,!1),F=ce("'",!1),E=ce("\\'",!1),P=de(["'"],!0,!1),A=ce(">",!1),_=ce("<",!1),L=ce("=",!1),D=ce("+",!1),N=ce("-",!1),R=ce("*",!1),B=ce("/",!1),V=ce("(",!1),z=ce(")",!1),G=pe("arguments"),q=ce(",",!1),H=de([["a","z"],["A","Z"],"_"],!1,!1),$=pe("function"),W=de([["a","z"],["A","Z"],"_","-"],!1,!1),U=pe("number"),X=de(["e","E"],!1,!1),Y=pe("exponent"),K=ce(".",!1),Q=ce("0",!1),Z=de([["1","9"]],!1,!1),J=de([["0","9"]],!1,!1),ee=function(e,t){return t},te=function(e){return e.join("")},ae=0,ne=0,ie=[{line:1,column:1}],se=0,le=[],re=0;if("startRule"in t){if(!(t.startRule in l))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=l[t.startRule]}function oe(){return e.substring(ne,ae)}function ue(){return ge(ne,ae)}function ce(e,t){return{type:"literal",text:e,ignoreCase:t}}function de(e,t,a){return{type:"class",parts:e,inverted:t,ignoreCase:a}}function pe(e){return{type:"other",description:e}}function me(t){var a,n=ie[t];if(n)return n;for(a=t-1;!ie[a];)a--;for(n={line:(n=ie[a]).line,column:n.column};a<t;)10===e.charCodeAt(a)?(n.line++,n.column=1):n.column++,a++;return ie[t]=n,n}function ge(e,t){var a=me(e),n=me(t);return{source:s,start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:n.line,column:n.column}}}function fe(e){ae<se||(ae>se&&(se=ae,le=[]),le.push(e))}function be(){return ve()}function he(){var t,a;for(re++,t=[],g.test(e.charAt(ae))?(a=e.charAt(ae),ae++):(a=i,0===re&&fe(I));a!==i;)t.push(a),g.test(e.charAt(ae))?(a=e.charAt(ae),ae++):(a=i,0===re&&fe(I));return re--,a=i,0===re&&fe(k),t}function xe(){var t;return f.test(e.charAt(ae))?(t=e.charAt(ae),ae++):(t=i,0===re&&fe(T)),t}function ve(){var t;return(t=function(){var t,a,n,s,l,r,o;return t=ae,he(),(a=ye())!==i?(n=ae,62===e.charCodeAt(ae)?(s=">",ae++):(s=i,0===re&&fe(A)),s===i&&(60===e.charCodeAt(ae)?(s="<",ae++):(s=i,0===re&&fe(_))),s!==i?(61===e.charCodeAt(ae)?(l=p,ae++):(l=i,0===re&&fe(L)),l===i&&(l=null),n=s=[s,l]):(ae=n,n=i),n===i&&(n=ae,61===e.charCodeAt(ae)?(s=p,ae++):(s=i,0===re&&fe(L)),s!==i?(61===e.charCodeAt(ae)?(l=p,ae++):(l=i,0===re&&fe(L)),l!==i?n=s=[s,l]:(ae=n,n=i)):(ae=n,n=i)),n!==i&&(s=ye())!==i?(l=he(),ne=t,r=a,o=s,t={type:"function",name:Se(n),args:[r,o],location:we(ue()),text:oe()}):(ae=t,t=i)):(ae=t,t=i),t}())===i&&(t=ye())===i&&(t=function(){var t,a,n,s;return t=ae,he(),40===e.charCodeAt(ae)?(a="(",ae++):(a=i,0===re&&fe(V)),a!==i?(he(),(n=ve())!==i?(he(),41===e.charCodeAt(ae)?(s=")",ae++):(s=i,0===re&&fe(z)),s!==i?(he(),ne=t,t=n):(ae=t,t=i)):(ae=t,t=i)):(ae=t,t=i),t}()),t}function ye(){var t;return(t=function(){var t,a,n,s,l,r;if(t=ae,he(),(a=je())!==i){if(n=[],s=ae,43===e.charCodeAt(ae)?(l="+",ae++):(l=i,0===re&&fe(D)),l===i&&(45===e.charCodeAt(ae)?(l=m,ae++):(l=i,0===re&&fe(N))),l!==i&&(r=je())!==i?s=l=[l,r]:(ae=s,s=i),s!==i)for(;s!==i;)n.push(s),s=ae,43===e.charCodeAt(ae)?(l="+",ae++):(l=i,0===re&&fe(D)),l===i&&(45===e.charCodeAt(ae)?(l=m,ae++):(l=i,0===re&&fe(N))),l!==i&&(r=je())!==i?s=l=[l,r]:(ae=s,s=i);else n=i;n!==i?(s=he(),ne=t,t=Ce(a,n)):(ae=t,t=i)}else ae=t,t=i;return t}())===i&&(t=je())===i&&(t=Oe()),t}function je(){var t,a,n,s,l,r;if(t=ae,he(),(a=Oe())!==i){for(n=[],s=ae,42===e.charCodeAt(ae)?(l="*",ae++):(l=i,0===re&&fe(R)),l===i&&(47===e.charCodeAt(ae)?(l="/",ae++):(l=i,0===re&&fe(B))),l!==i&&(r=Oe())!==i?s=l=[l,r]:(ae=s,s=i);s!==i;)n.push(s),s=ae,42===e.charCodeAt(ae)?(l="*",ae++):(l=i,0===re&&fe(R)),l===i&&(47===e.charCodeAt(ae)?(l="/",ae++):(l=i,0===re&&fe(B))),l!==i&&(r=Oe())!==i?s=l=[l,r]:(ae=s,s=i);s=he(),ne=t,t=Ce(a,n)}else ae=t,t=i;return t}function Oe(){var t;return(t=function(){var t,a,n,s;return t=ae,he(),40===e.charCodeAt(ae)?(a="(",ae++):(a=i,0===re&&fe(V)),a!==i?(he(),(n=ye())!==i?(he(),41===e.charCodeAt(ae)?(s=")",ae++):(s=i,0===re&&fe(z)),s!==i?(he(),ne=t,t=n):(ae=t,t=i)):(ae=t,t=i)):(ae=t,t=i),t}())===i&&(t=function(){var t,a,n,s,l,r;if(re++,t=ae,he(),a=[],v.test(e.charAt(ae))?(n=e.charAt(ae),ae++):(n=i,0===re&&fe(W)),n!==i)for(;n!==i;)a.push(n),v.test(e.charAt(ae))?(n=e.charAt(ae),ae++):(n=i,0===re&&fe(W));else a=i;return a!==i?(40===e.charCodeAt(ae)?(n="(",ae++):(n=i,0===re&&fe(V)),n!==i?(he(),s=function(){var t,a,n,s,l,r,o;if(re++,t=ae,(a=ke())!==i){for(n=[],s=ae,l=he(),44===e.charCodeAt(ae)?(r=",",ae++):(r=i,0===re&&fe(q)),r!==i?(he(),(o=ke())!==i?(ne=s,s=ee(0,o)):(ae=s,s=i)):(ae=s,s=i);s!==i;)n.push(s),s=ae,l=he(),44===e.charCodeAt(ae)?(r=",",ae++):(r=i,0===re&&fe(q)),r!==i?(he(),(o=ke())!==i?(ne=s,s=ee(0,o)):(ae=s,s=i)):(ae=s,s=i);s=he(),44===e.charCodeAt(ae)?(l=",",ae++):(l=i,0===re&&fe(q)),l===i&&(l=null),ne=t,t=[a].concat(n)}else ae=t,t=i;return re--,t===i&&(a=i,0===re&&fe(G)),t}(),s===i&&(s=null),he(),41===e.charCodeAt(ae)?(l=")",ae++):(l=i,0===re&&fe(z)),l!==i?(he(),ne=t,r=s,t={type:"function",name:a.join(""),args:r||[],location:we(ue()),text:oe()}):(ae=t,t=i)):(ae=t,t=i)):(ae=t,t=i),re--,t===i&&0===re&&fe($),t}())===i&&(t=function(){var t,a;return re++,t=ae,he(),(a=Ie())===i&&(a=function(){var t,a,n,s,l;if(t=ae,he(),34===e.charCodeAt(ae)?(a=o,ae++):(a=i,0===re&&fe(M)),a!==i){for(n=[],s=ae,e.substr(ae,2)===u?(l=u,ae+=2):(l=i,0===re&&fe(C)),l!==i&&(ne=s,l='"'),(s=l)===i&&(b.test(e.charAt(ae))?(s=e.charAt(ae),ae++):(s=i,0===re&&fe(S)));s!==i;)n.push(s),s=ae,e.substr(ae,2)===u?(l=u,ae+=2):(l=i,0===re&&fe(C)),l!==i&&(ne=s,l='"'),(s=l)===i&&(b.test(e.charAt(ae))?(s=e.charAt(ae),ae++):(s=i,0===re&&fe(S)));34===e.charCodeAt(ae)?(s=o,ae++):(s=i,0===re&&fe(M)),s!==i?(l=he(),ne=t,t={type:"variable",value:n.join(""),location:we(ue()),text:oe()}):(ae=t,t=i)}else ae=t,t=i;if(t===i){if(t=ae,he(),39===e.charCodeAt(ae)?(a=c,ae++):(a=i,0===re&&fe(F)),a!==i){for(n=[],s=ae,e.substr(ae,2)===d?(l=d,ae+=2):(l=i,0===re&&fe(E)),l!==i&&(ne=s,l="'"),(s=l)===i&&(h.test(e.charAt(ae))?(s=e.charAt(ae),ae++):(s=i,0===re&&fe(P)));s!==i;)n.push(s),s=ae,e.substr(ae,2)===d?(l=d,ae+=2):(l=i,0===re&&fe(E)),l!==i&&(ne=s,l="'"),(s=l)===i&&(h.test(e.charAt(ae))?(s=e.charAt(ae),ae++):(s=i,0===re&&fe(P)));39===e.charCodeAt(ae)?(s=c,ae++):(s=i,0===re&&fe(F)),s!==i?(l=he(),ne=t,t={type:"variable",value:n.join(""),location:we(ue()),text:oe()}):(ae=t,t=i)}else ae=t,t=i;if(t===i){if(t=ae,he(),a=[],(n=xe())!==i)for(;n!==i;)a.push(n),n=xe();else a=i;a!==i?(n=he(),ne=t,t={type:"variable",value:a.join(""),location:we(ue()),text:oe()}):(ae=t,t=i)}}return t}()),a!==i?(he(),ne=t,t=a):(ae=t,t=i),re--,t===i&&0===re&&fe(w),t}()),t}function ke(){var t,a,n,s,l,r;if(t=ae,a=[],x.test(e.charAt(ae))?(n=e.charAt(ae),ae++):(n=i,0===re&&fe(H)),n!==i)for(;n!==i;)a.push(n),x.test(e.charAt(ae))?(n=e.charAt(ae),ae++):(n=i,0===re&&fe(H));else a=i;return a!==i?(n=he(),61===e.charCodeAt(ae)?(s=p,ae++):(s=i,0===re&&fe(L)),s!==i?(he(),(l=Ie())===i&&(l=function(){var t,a,n,s,l;if(t=ae,34===e.charCodeAt(ae)?(a=o,ae++):(a=i,0===re&&fe(M)),a!==i){for(n=[],s=ae,e.substr(ae,2)===u?(l=u,ae+=2):(l=i,0===re&&fe(C)),l!==i&&(ne=s,l='"'),(s=l)===i&&(b.test(e.charAt(ae))?(s=e.charAt(ae),ae++):(s=i,0===re&&fe(S)));s!==i;)n.push(s),s=ae,e.substr(ae,2)===u?(l=u,ae+=2):(l=i,0===re&&fe(C)),l!==i&&(ne=s,l='"'),(s=l)===i&&(b.test(e.charAt(ae))?(s=e.charAt(ae),ae++):(s=i,0===re&&fe(S)));34===e.charCodeAt(ae)?(s=o,ae++):(s=i,0===re&&fe(M)),s!==i?(ne=t,t=te(n)):(ae=t,t=i)}else ae=t,t=i;if(t===i){if(t=ae,39===e.charCodeAt(ae)?(a=c,ae++):(a=i,0===re&&fe(F)),a!==i){for(n=[],s=ae,e.substr(ae,2)===d?(l=d,ae+=2):(l=i,0===re&&fe(E)),l!==i&&(ne=s,l="'"),(s=l)===i&&(h.test(e.charAt(ae))?(s=e.charAt(ae),ae++):(s=i,0===re&&fe(P)));s!==i;)n.push(s),s=ae,e.substr(ae,2)===d?(l=d,ae+=2):(l=i,0===re&&fe(E)),l!==i&&(ne=s,l="'"),(s=l)===i&&(h.test(e.charAt(ae))?(s=e.charAt(ae),ae++):(s=i,0===re&&fe(P)));39===e.charCodeAt(ae)?(s=c,ae++):(s=i,0===re&&fe(F)),s!==i?(ne=t,t=te(n)):(ae=t,t=i)}else ae=t,t=i;if(t===i){if(t=ae,a=[],(n=xe())!==i)for(;n!==i;)a.push(n),n=xe();else a=i;a!==i&&(ne=t,a=te(a)),t=a}}return t}()),l!==i?(he(),ne=t,r=l,t={type:"namedArgument",name:a.join(""),value:r,location:we(ue()),text:oe()}):(ae=t,t=i)):(ae=t,t=i)):(ae=t,t=i),t===i&&(t=ve()),t}function Ie(){var t,a,n,s,l;return re++,t=ae,45===e.charCodeAt(ae)?(a=m,ae++):(a=i,0===re&&fe(N)),a===i&&(a=null),n=function(){var t,a,n,s;if(48===e.charCodeAt(ae)?(t="0",ae++):(t=i,0===re&&fe(Q)),t===i)if(t=ae,j.test(e.charAt(ae))?(a=e.charAt(ae),ae++):(a=i,0===re&&fe(Z)),a!==i){for(n=[],s=Te();s!==i;)n.push(s),s=Te();t=a=[a,n]}else ae=t,t=i;return t}(),n!==i?(s=function(){var t,a,n,s;if(t=ae,46===e.charCodeAt(ae)?(a=".",ae++):(a=i,0===re&&fe(K)),a!==i){if(n=[],(s=Te())!==i)for(;s!==i;)n.push(s),s=Te();else n=i;n!==i?t=a=[a,n]:(ae=t,t=i)}else ae=t,t=i;return t}(),s===i&&(s=null),l=function(){var t,a,n,s,l;if(re++,t=ae,a=function(){var t;return y.test(e.charAt(ae))?(t=e.charAt(ae),ae++):(t=i,0===re&&fe(X)),t}(),a!==i){if(45===e.charCodeAt(ae)?(n=m,ae++):(n=i,0===re&&fe(N)),n===i&&(n=null),s=[],(l=Te())!==i)for(;l!==i;)s.push(l),l=Te();else s=i;s!==i?t=a=[a,n,s]:(ae=t,t=i)}else ae=t,t=i;return re--,t===i&&(a=i,0===re&&fe(Y)),t}(),l===i&&(l=null),ne=t,t=parseFloat(oe())):(ae=t,t=i),re--,t===i&&(a=i,0===re&&fe(U)),t}function Te(){var t;return O.test(e.charAt(ae))?(t=e.charAt(ae),ae++):(t=i,0===re&&fe(J)),t}function we(e){return{min:e.start.offset,max:e.end.offset}}const Me={"+":"add","-":"subtract","*":"multiply","/":"divide","<":"lt",">":"gt","==":"eq","<=":"lte",">=":"gte"};function Ce(e,t){const a=t.reduce(((e,[t,a])=>({type:"function",name:Me[t],args:[e,a]})),e);return"object"==typeof a&&(a.location=we(ue()),a.text=oe()),a}function Se([e,t]){return Me[e+(t||"")]}if((a=r())!==i&&ae===e.length)return a;throw a!==i&&ae<e.length&&fe({type:"end"}),function(e,t,a){return new n(n.buildMessage(e,t),e,t,a)}(le,se<e.length?e.charAt(se):null,se<e.length?ge(se,se+1):ge(se,se))}}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(303);case"v8light":return a(305)}},function(e,t,a){var n=a(55),i=a(304);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,'.documentation__docs{background:#1d1e24}.documentation__docsHeader{margin:0}.documentation__docs--inline{display:flex;flex-direction:column;z-index:1}.documentation__docs--overlay .documentation__docsContent{height:40vh;width:min(75vh,90vw)}.documentation__docs--inline .documentation__docsContent{flex:1;min-height:0}.documentation__docsContent>*+*{border-left:1px solid #343741}.documentation__docsSidebar{background:#25262e}.documentation__docsSidebarInner{min-height:0}.documentation__docsSidebarInner>*+*{border-top:1px solid #343741}.documentation__docsSearch{padding:16px}.documentation__docsNav{height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.documentation__docsNav::-webkit-scrollbar{height:16px;width:16px}.documentation__docsNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.documentation__docsNav::-webkit-scrollbar-corner,.documentation__docsNav::-webkit-scrollbar-track{background-color:#0000}.documentation__docsNav:focus{outline:none}.documentation__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsNavGroup{padding:16px}.documentation__docsNavGroup+.documentation__docsNavGroup{border-top:1px solid #343741}.documentation__docsNavGroupLink{font-weight:inherit}.documentation__docsText{height:100%;overflow-x:hidden;overflow-y:auto;padding:16px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.documentation__docsText::-webkit-scrollbar{height:16px;width:16px}.documentation__docsText::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.documentation__docsText::-webkit-scrollbar-corner,.documentation__docsText::-webkit-scrollbar-track{background-color:#0000}.documentation__docsText:focus{outline:none}.documentation__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsTextGroup,.documentation__docsTextItem{margin-top:40px}.documentation__docsTextGroup{border-top:1px solid #343741;padding-top:40px}.documentationOverflow{z-index:9001}',""]),e.exports=t},function(e,t,a){var n=a(55),i=a(306);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,'.documentation__docs{background:#fff}.documentation__docsHeader{margin:0}.documentation__docs--inline{display:flex;flex-direction:column;z-index:1}.documentation__docs--overlay .documentation__docsContent{height:40vh;width:min(75vh,90vw)}.documentation__docs--inline .documentation__docsContent{flex:1;min-height:0}.documentation__docsContent>*+*{border-left:1px solid #d3dae6}.documentation__docsSidebar{background:#f5f7fa}.documentation__docsSidebarInner{min-height:0}.documentation__docsSidebarInner>*+*{border-top:1px solid #d3dae6}.documentation__docsSearch{padding:16px}.documentation__docsNav{height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.documentation__docsNav::-webkit-scrollbar{height:16px;width:16px}.documentation__docsNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.documentation__docsNav::-webkit-scrollbar-corner,.documentation__docsNav::-webkit-scrollbar-track{background-color:#0000}.documentation__docsNav:focus{outline:none}.documentation__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsNavGroup{padding:16px}.documentation__docsNavGroup+.documentation__docsNavGroup{border-top:1px solid #d3dae6}.documentation__docsNavGroupLink{font-weight:inherit}.documentation__docsText{height:100%;overflow-x:hidden;overflow-y:auto;padding:16px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.documentation__docsText::-webkit-scrollbar{height:16px;width:16px}.documentation__docsText::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.documentation__docsText::-webkit-scrollbar-corner,.documentation__docsText::-webkit-scrollbar-track{background-color:#0000}.documentation__docsText:focus{outline:none}.documentation__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsTextGroup,.documentation__docsTextItem{margin-top:40px}.documentation__docsTextGroup{border-top:1px solid #d3dae6;padding-top:40px}.documentationOverflow{z-index:9001}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(308);case"v8light":return a(310)}},function(e,t,a){var n=a(55),i=a(309);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #343741}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #343741}.lnsFormula__editorFooter,.lnsFormula__editorHeader{padding:8px}.lnsFormula__editorFooter{background-color:#25262e;border-bottom-left-radius:6px;border-bottom-right-radius:6px;z-index:1}.lnsFormula__editorFooterGroup,.lnsFormula__editorHeaderGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{color:#7a7f89;font-family:Menlo,Monaco,Courier New,monospace;left:16px;pointer-events:none;position:absolute;right:0;top:0}.lnsFormula__warningText+.lnsFormula__warningText{border-top:1px solid #343741;margin-top:8px;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#1d1e24}.lnsFormulaOverflow{z-index:9001}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(311);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #d3dae6}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #d3dae6}.lnsFormula__editorFooter,.lnsFormula__editorHeader{padding:8px}.lnsFormula__editorFooter{background-color:#f5f7fa;border-bottom-left-radius:6px;border-bottom-right-radius:6px;z-index:1}.lnsFormula__editorFooterGroup,.lnsFormula__editorHeaderGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{color:#69707d;font-family:Menlo,Monaco,Courier New,monospace;left:16px;pointer-events:none;position:absolute;right:0;top:0}.lnsFormula__warningText+.lnsFormula__warningText{border-top:1px solid #d3dae6;margin-top:8px;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#fff}.lnsFormulaOverflow{z-index:9001}",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(34),i=a(8),s=n.__importDefault(a(126));t.default=function(e){var t=i.useRef(e);t.current=e,s.default((function(){return function(){return t.current()}}))}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(314);case"v8light":return a(316)}},function(e,t,a){var n=a(55),i=a(315);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#343741}.lnFieldSelect__option--nonExistant{background-color:#25262e}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(317);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#d3dae6}.lnFieldSelect__option--nonExistant{background-color:#f5f7fa}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(319);case"v8light":return a(321)}},function(e,t,a){var n=a(55),i=a(320);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(322);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(324);case"v8light":return a(326)}},function(e,t,a){var n=a(55),i=a(325);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(327);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(329);case"v8light":return a(331)}},function(e,t,a){var n=a(55),i=a(330);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__labelCustomRank{min-width:96px}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(332);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__labelCustomRank{min-width:96px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(334);case"v8light":return a(336)}},function(e,t,a){var n=a(55),i=a(335);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsRangesOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(337);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsRangesOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(339);case"v8light":return a(341)}},function(e,t,a){var n=a(55),i=a(340);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,'.lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:12px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.lnsHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,a){var n=a(55),i=a(342);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,'.lnsHelpPopover__panel{max-width:480px}.lnsHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:12px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.lnsHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,a){var n=a(344),i=a(345),s=a(346),l=a(347),r=a(348),o=a(349),u=a(350);u.alea=n,u.xor128=i,u.xorwow=s,u.xorshift7=l,u.xor4096=r,u.tychei=o,e.exports=u},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t,a=this,n=(t=4022871197,function(e){e=String(e);for(var a=0;a<e.length;a++){var n=.02519603282416938*(t+=e.charCodeAt(a));n-=t=n>>>0,t=(n*=t)>>>0,t+=4294967296*(n-=t)}return 2.3283064365386963e-10*(t>>>0)});a.next=function(){var e=2091639*a.s0+2.3283064365386963e-10*a.c;return a.s0=a.s1,a.s1=a.s2,a.s2=e-(a.c=0|e)},a.c=1,a.s0=n(" "),a.s1=n(" "),a.s2=n(" "),a.s0-=n(e),a.s0<0&&(a.s0+=1),a.s1-=n(e),a.s1<0&&(a.s1+=1),a.s2-=n(e),a.s2<0&&(a.s2+=1),n=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var a=new l(e),n=t&&t.state,i=a.next;return i.int32=function(){return 4294967296*a.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(66)&&a(84)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.alea=o}(0,e,a(66))}).call(this,a(77)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this,a="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:a+=e;for(var n=0;n<a.length+64;n++)t.x^=0|a.charCodeAt(n),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(66)&&a(84)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xor128=o}(0,e,a(66))}).call(this,a(77)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this,a="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:a+=e;for(var n=0;n<a.length+64;n++)t.x^=0|a.charCodeAt(n),n==a.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(66)&&a(84)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xorwow=o}(0,e,a(66))}).call(this,a(77)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this;t.next=function(){var e,a,n=t.x,i=t.i;return e=n[i],a=(e^=e>>>7)^e<<24,a^=(e=n[i+1&7])^e>>>10,a^=(e=n[i+3&7])^e>>>3,a^=(e=n[i+4&7])^e<<7,e=n[i+7&7],a^=(e^=e<<13)^e<<9,n[i]=a,t.i=i+1&7,a},function(e,t){var a,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,a=0;a<t.length;++a)n[7&a]=n[7&a]<<15^t.charCodeAt(a)+n[a+1&7]<<13;for(;n.length<8;)n.push(0);for(a=0;a<8&&0===n[a];++a);for(8==a?n[7]=-1:n[a],e.x=n,e.i=0,a=256;a>0;--a)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&(n.x&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(66)&&a(84)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xorshift7=o}(0,e,a(66))}).call(this,a(77)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this;t.next=function(){var e,a,n=t.w,i=t.X,s=t.i;return t.w=n=n+1640531527|0,a=i[s+34&127],e=i[s=s+1&127],a^=a<<13,e^=e<<17,a^=a>>>15,e^=e>>>12,a=i[s]=a^e,t.i=s,a+(n^n>>>16)|0},function(e,t){var a,n,i,s,l,r=[],o=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,o=Math.max(o,t.length)),i=0,s=-32;s<o;++s)t&&(n^=t.charCodeAt((s+32)%t.length)),0===s&&(l=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,s>=0&&(l=l+1640531527|0,i=0==(a=r[127&s]^=n+l)?i+1:0);for(i>=128&&(r[127&(t&&t.length||0)]=-1),i=127,s=512;s>0;--s)n=r[i+34&127],a=r[i=i+1&127],n^=n<<13,a^=a<<17,n^=n>>>15,a^=a>>>12,r[i]=n^a;e.w=l,e.X=r,e.i=i}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&(n.X&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(66)&&a(84)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xor4096=o}(0,e,a(66))}).call(this,a(77)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this,a="";t.next=function(){var e=t.b,a=t.c,n=t.d,i=t.a;return e=e<<25^e>>>7^a,a=a-n|0,n=n<<24^n>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^a,t.c=a=a-n|0,t.d=n<<16^a>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):a+=e;for(var n=0;n<a.length+20;n++)t.b^=0|a.charCodeAt(n),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(66)&&a(84)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.tychei=o}(0,e,a(66))}).call(this,a(77)(e))},function(e,t,a){var n;!function(i,s,l){var r,o=256,u=l.pow(o,6),c=l.pow(2,52),d=2*c,p=255;function m(e,t,a){var n=[],p=h(b((t=1==t?{entropy:!0}:t||{}).entropy?[e,x(s)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(o):(e=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(e)),x(e)}catch(e){var t=i.navigator,a=t&&t.plugins;return[+new Date,i,a,i.screen,x(s)]}}():e,3),n),m=new g(n),v=function(){for(var e=m.g(6),t=u,a=0;e<c;)e=(e+a)*o,t*=o,a=m.g(1);for(;e>=d;)e/=2,t/=2,a>>>=1;return(e+a)/t};return v.int32=function(){return 0|m.g(4)},v.quick=function(){return m.g(4)/4294967296},v.double=v,h(x(m.S),s),(t.pass||a||function(e,t,a,n){return n&&(n.S&&f(n,m),e.state=function(){return f(m,{})}),a?(l.random=e,t):e})(v,p,"global"in t?t.global:this==l,t.state)}function g(e){var t,a=e.length,n=this,i=0,s=n.i=n.j=0,l=n.S=[];for(a||(e=[a++]);i<o;)l[i]=i++;for(i=0;i<o;i++)l[i]=l[s=p&s+e[i%a]+(t=l[i])],l[s]=t;(n.g=function(e){for(var t,a=0,i=n.i,s=n.j,l=n.S;e--;)t=l[i=p&i+1],a=a*o+l[p&(l[i]=l[s=p&s+t])+(l[s]=t)];return n.i=i,n.j=s,a})(o)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function b(e,t){var a,n=[],i=typeof e;if(t&&"object"==i)for(a in e)try{n.push(b(e[a],t-1))}catch(e){}return n.length?n:"string"==i?e:e+"\0"}function h(e,t){for(var a,n=e+"",i=0;i<n.length;)t[p&i]=p&(a^=19*t[p&i])+n.charCodeAt(i++);return x(t)}function x(e){return String.fromCharCode.apply(0,e)}if(h(l.random(),s),e.exports){e.exports=m;try{r=a(351)}catch(e){}}else void 0===(n=function(){return m}.call(t,a,t,e))||(e.exports=n)}("undefined"!=typeof self?self:this,[],Math)},function(e,t){},function(e,t,a){var n=a(55),i=a(353);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{background:#1d1e24;padding:0 16px;position:sticky;top:0;z-index:1000}.lnsIndexPatternDimensionEditor-isFullscreen{bottom:0;left:0;position:absolute;right:0;top:0}.lnsIndexPatternDimensionEditor--padded{padding:16px}.lnsIndexPatternDimensionEditor--collapseNext{border-top:1px solid #343741;margin-bottom:-24px;margin-top:0!important}.lnsIndexPatternDimensionEditor--shaded{background-color:#25262e;border-bottom:1px solid #343741}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:12px}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-bottom:0;padding-top:0}.lnsIndexPatternDimensionEditor__warning{margin-bottom:16px;margin-top:8px}.lnsIndexPatternDimensionEditor__droppable{border-radius:6px;padding:4px}.lnsIndexPatternDimensionEditor__droppableItem{margin-right:8px}.lnsIndexPatternDimensionEditor-advancedOptions button:focus,.lnsIndexPatternDimensionEditor-advancedOptions button:hover{-webkit-text-decoration-color:#36a2ef;text-decoration-color:#36a2ef}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(355);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{background:#fff;padding:0 16px;position:sticky;top:0;z-index:1000}.lnsIndexPatternDimensionEditor-isFullscreen{bottom:0;left:0;position:absolute;right:0;top:0}.lnsIndexPatternDimensionEditor--padded{padding:16px}.lnsIndexPatternDimensionEditor--collapseNext{border-top:1px solid #d3dae6;margin-bottom:-24px;margin-top:0!important}.lnsIndexPatternDimensionEditor--shaded{background-color:#f5f7fa;border-bottom:1px solid #d3dae6}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:12px}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{padding-bottom:0;padding-top:0}.lnsIndexPatternDimensionEditor__warning{margin-bottom:16px;margin-top:8px}.lnsIndexPatternDimensionEditor__droppable{border-radius:6px;padding:4px}.lnsIndexPatternDimensionEditor__droppableItem{margin-right:8px}.lnsIndexPatternDimensionEditor-advancedOptions button:focus,.lnsIndexPatternDimensionEditor-advancedOptions button:hover{-webkit-text-decoration-color:#07c;text-decoration-color:#07c}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(357);case"v8light":return a(359)}},function(e,t,a){var n=a(55),i=a(358);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{height:100%;padding:16px 16px 0;width:100%}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{align-items:center;display:flex;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__textField{box-shadow:none;padding-left:40px;padding-right:40px}.lnsInnerIndexPatternDataPanel__filterType{border-bottom:1px solid #25262e;font-size:14px;padding:8px}.lnsInnerIndexPatternDataPanel__filterTypeInner{align-items:center;display:flex}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{display:inline;font-weight:600;padding-left:8px}.lnsFilterButton .euiFilterButton__textShift{min-width:0}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(360);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{height:100%;padding:16px 16px 0;width:100%}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{align-items:center;display:flex;margin-bottom:8px}.lnsInnerIndexPatternDataPanel__textField{box-shadow:none;padding-left:40px;padding-right:40px}.lnsInnerIndexPatternDataPanel__filterType{border-bottom:1px solid #f5f7fa;font-size:14px;padding:8px}.lnsInnerIndexPatternDataPanel__filterTypeInner{align-items:center;display:flex}.lnsInnerIndexPatternDataPanel__filterTypeInner .lnsFieldListPanel__fieldIcon{margin-right:8px}.lnsChangeIndexPatternPopover{width:320px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{display:inline;font-weight:600;padding-left:8px}.lnsFilterButton .euiFilterButton__textShift{min-width:0}",""]),e.exports=t},,,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(369);case"v8light":return a(371)}},function(e,t,a){var n=a(55),i=a(370);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,"@keyframes euiFlyoutAnimation{0%{opacity:0;transform:translateX(100%)}75%{opacity:1;transform:translateX(0)}}.lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton-isActive,.lnsFieldItem.kbnFieldButton:focus-within{outline:none}.lnsFieldItem.kbnFieldButton-isActive:focus-visible,.lnsFieldItem.kbnFieldButton:focus-within:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus{outline:none}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:#36a2ef33;outline:2px solid currentColor}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__name>span{outline-style:auto}.lnsFieldItem .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__name>span{outline:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{opacity:0;visibility:hidden}.lnsFieldItem:hover:not([class*=isActive]){cursor:grab}.lnsFieldItem:hover:not([class*=isActive]) .lnsFieldItem__infoIcon{opacity:1;transition:opacity .15s ease-in-out 1s;visibility:visible}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{opacity:0;visibility:hidden}.kbnFieldButton__name{transition:background-color .15s ease-in-out}.lnsFieldItem--missing{background:#1d1e24;color:#98a2b3}.lnsFieldItem__fieldPanel{max-width:300px;min-width:260px}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(372);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,"@keyframes euiFlyoutAnimation{0%{opacity:0;transform:translateX(100%)}75%{opacity:1;transform:translateX(0)}}.lnsFieldItem{width:100%}.lnsFieldItem.kbnFieldButton-isActive,.lnsFieldItem.kbnFieldButton:focus-within{outline:none}.lnsFieldItem.kbnFieldButton-isActive:focus-visible,.lnsFieldItem.kbnFieldButton:focus-within:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus{outline:none}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible{outline-style:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{background-color:#0077cc1a;outline:2px solid currentColor}.lnsFieldItem .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__name>span{outline-style:auto}.lnsFieldItem .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__name>span{outline:none}.lnsFieldItem .kbnFieldButton__button:focus .kbnFieldButton__name>span{text-decoration:underline}.lnsFieldItem .lnsFieldItem__infoIcon{opacity:0;visibility:hidden}.lnsFieldItem:hover:not([class*=isActive]){cursor:grab}.lnsFieldItem:hover:not([class*=isActive]) .lnsFieldItem__infoIcon{opacity:1;transition:opacity .15s ease-in-out 1s;visibility:visible}.kbnFieldButton.lnsDragDrop_ghost .lnsFieldItem__infoIcon{opacity:0;visibility:hidden}.kbnFieldButton__name{transition:background-color .15s ease-in-out}.lnsFieldItem--missing{background:#98a2b31a;color:#69707d}.lnsFieldItem__fieldPanel{max-width:300px;min-width:260px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(374);case"v8light":return a(376)}},function(e,t,a){var n=a(55),i=a(375);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,"@keyframes euiFlyoutAnimation{0%{opacity:0;transform:translateX(100%)}75%{opacity:1;transform:translateX(0)}}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop{border:1px solid #343741;border-radius:6px;padding:40px 64px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{background-color:#54b3991a;border:1px dashed #343741}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:#54b39940;border:1px dashed #54b399}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(377);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,"@keyframes euiFlyoutAnimation{0%{opacity:0;transform:translateX(100%)}75%{opacity:1;transform:translateX(0)}}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop{border:1px solid #d3dae6;border-radius:6px;padding:40px 64px}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isDropTarget{background-color:#54b3991a;border:1px dashed #d3dae6}.lnsVisualizeGeoFieldWorkspacePanel__dragDrop.lnsDragDrop-isActiveDropTarget{background-color:#54b39940;border:1px dashed #54b399}",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(8);t.default=function(e){var t=n.useRef();return n.useEffect((function(){t.current=e})),t.current}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var n,i,s;if(Array.isArray(t)){if((n=t.length)!=a.length)return!1;for(i=n;0!=i--;)if(!e(t[i],a[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((n=(s=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(a,s[i]))return!1;for(i=n;0!=i--;){var l=s[i];if(!e(t[l],a[l]))return!1}return!0}return t!=t&&a!=a}},function(e,t,a){e.exports=a(14)(644)},function(e,t,a){e.exports=a(14)(445)},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(455);case"v8light":return a(457)}},function(e,t,a){var n=a(55),i=a(456);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,'.kbnSolutionNav__flyout{background-color:#141519}.kbnSolutionNav{background:linear-gradient(160deg,#3437414d,#3437414d 32px,#f000 0),linear-gradient(175deg,#3437414d,#3437414d 16px,#f000 0);display:flex;flex-direction:column;height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.kbnSolutionNav::-webkit-scrollbar{height:16px;width:16px}.kbnSolutionNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.kbnSolutionNav::-webkit-scrollbar-corner,.kbnSolutionNav::-webkit-scrollbar-track{background-color:#0000}.kbnSolutionNav:focus{outline:none}.kbnSolutionNav[tabindex="0"]:focus:focus-visible{outline-style:auto}@media only screen and (min-width:768px) and (max-width:991px){.kbnSolutionNav{padding:24px;width:248px}}@media only screen and (min-width:992px) and (max-width:1199px){.kbnSolutionNav{padding:24px;width:248px}}@media only screen and (min-width:1200px){.kbnSolutionNav{padding:24px;width:248px}}.kbnSolutionNav .kbnSolutionNav__avatar{margin-right:16px}.kbnSolutionNav--hidden{opacity:0;pointer-events:none}@media screen and (prefers-reduced-motion:no-preference){.kbnSolutionNav--hidden{transition:opacity .15s cubic-bezier(.694,.0482,.335,1)}}',""]),e.exports=t},function(e,t,a){var n=a(55),i=a(458);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,'.kbnSolutionNav__flyout{background-color:#fafbfd}.kbnSolutionNav{background:linear-gradient(160deg,#d3dae64d,#d3dae64d 32px,#f000 0),linear-gradient(175deg,#d3dae64d,#d3dae64d 16px,#f000 0);display:flex;flex-direction:column;height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.kbnSolutionNav::-webkit-scrollbar{height:16px;width:16px}.kbnSolutionNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.kbnSolutionNav::-webkit-scrollbar-corner,.kbnSolutionNav::-webkit-scrollbar-track{background-color:#0000}.kbnSolutionNav:focus{outline:none}.kbnSolutionNav[tabindex="0"]:focus:focus-visible{outline-style:auto}@media only screen and (min-width:768px) and (max-width:991px){.kbnSolutionNav{padding:24px;width:248px}}@media only screen and (min-width:992px) and (max-width:1199px){.kbnSolutionNav{padding:24px;width:248px}}@media only screen and (min-width:1200px){.kbnSolutionNav{padding:24px;width:248px}}.kbnSolutionNav .kbnSolutionNav__avatar{margin-right:16px}.kbnSolutionNav--hidden{opacity:0;pointer-events:none}@media screen and (prefers-reduced-motion:no-preference){.kbnSolutionNav--hidden{transition:opacity .15s cubic-bezier(.694,.0482,.335,1)}}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(460);case"v8light":return a(462)}},function(e,t,a){var n=a(55),i=a(461);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){var n=a(56),i=a(158),s=a(159);t=n(!1);var l=i(s);t.push([e.i,".kbnSolutionAvatar{box-shadow:0 .7px 1.4px rgba(0,0,0,.175),0 1.9px 4px rgba(0,0,0,.125),0 4.5px 10px rgba(0,0,0,.125)}.kbnSolutionAvatar--xxl{background:#1d1e24 url("+l+") no-repeat;background-size:cover,125%;border-radius:100px;box-shadow:0 .9px 4px -1px #0003,0 2.6px 8px -1px #00000026,0 5.7px 12px -1px rgba(0,0,0,.125),0 15px 15px -1px #0000001a;display:inline-block;height:100px;line-height:100px;text-align:center;width:100px}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(463);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){var n=a(56),i=a(158),s=a(159);t=n(!1);var l=i(s);t.push([e.i,".kbnSolutionAvatar{box-shadow:0 .7px 1.4px #00000012,0 1.9px 4px #0000000d,0 4.5px 10px #0000000d}.kbnSolutionAvatar--xxl{background:#fff url("+l+") no-repeat;background-size:cover,125%;border-radius:100px;box-shadow:0 .9px 4px -1px #00000014,0 2.6px 8px -1px #0000000f,0 5.7px 12px -1px #0000000d,0 15px 15px -1px #0000000a;display:inline-block;height:100px;line-height:100px;text-align:center;width:100px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(465);case"v8light":return a(467)}},function(e,t,a){var n=a(55),i=a(466);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".kbnSolutionNavCollapseButton{left:232px;opacity:0;position:absolute;top:24px;z-index:2}@media screen and (prefers-reduced-motion:no-preference){.kbnSolutionNavCollapseButton{transition:opacity .15s,left .15s,background .15s}}.kbnSolutionNavCollapseButton:focus,.kbnSolutionNavCollapseButton:hover{transition-delay:0s!important}.kbnSolutionNavCollapseButton:focus,.kbnSolutionNavCollapseButton:hover,.kbnSolutionNav__sidebar:hover .kbnSolutionNavCollapseButton{left:224px;opacity:1}.kbnSolutionNav__sidebar:hover .kbnSolutionNavCollapseButton{transition-delay:.7s}.kbnSolutionNavCollapseButton:not(.kbnSolutionNavCollapseButton-isCollapsed){background-color:#1d1e24!important}.kbnSolutionNavCollapseButton-isCollapsed{align-items:flex-start;border-radius:0;bottom:0;height:100%;left:0!important;opacity:1!important;padding-top:32px;right:auto;top:0;transition-delay:0s!important;width:40px}",""]),e.exports=t},function(e,t,a){var n=a(55),i=a(468);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,".kbnSolutionNavCollapseButton{left:232px;opacity:0;position:absolute;top:24px;z-index:2}@media screen and (prefers-reduced-motion:no-preference){.kbnSolutionNavCollapseButton{transition:opacity .15s,left .15s,background .15s}}.kbnSolutionNavCollapseButton:focus,.kbnSolutionNavCollapseButton:hover{transition-delay:0s!important}.kbnSolutionNavCollapseButton:focus,.kbnSolutionNavCollapseButton:hover,.kbnSolutionNav__sidebar:hover .kbnSolutionNavCollapseButton{left:224px;opacity:1}.kbnSolutionNav__sidebar:hover .kbnSolutionNavCollapseButton{transition-delay:.7s}.kbnSolutionNavCollapseButton:not(.kbnSolutionNavCollapseButton-isCollapsed){background-color:#fff!important}.kbnSolutionNavCollapseButton-isCollapsed{align-items:flex-start;border-radius:0;bottom:0;height:100%;left:0!important;opacity:1!important;padding-top:32px;right:auto;top:0;transition-delay:0s!important;width:40px}",""]),e.exports=t},function(e,t,a){e.exports=a.p+"baad30acfe492601d08a0e839c9bb3f5.svg"},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(471);case"v8light":return a(473)}},function(e,t,a){var n=a(55),i=a(472);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,'.lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;height:100%;overflow:hidden}.lnsApp,.lnsApp__frame{display:flex;flex-direction:column}.lnsApp__frame{flex-grow:1;position:relative}.lensAnnotationIconFill{fill:#1d1e24}@media only screen and (min-width:768px) and (max-width:991px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width:992px) and (max-width:1199px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width:1200px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width:768px) and (max-width:991px){.lnsNavItem__goBack:after{border-right:1px solid #343741;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:992px) and (max-width:1199px){.lnsNavItem__goBack:after{border-right:1px solid #343741;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:1200px){.lnsNavItem__goBack:after{border-right:1px solid #343741;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}',""]),e.exports=t},function(e,t,a){var n=a(55),i=a(474);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(56)(!1)).push([e.i,'.lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;height:100%;overflow:hidden}.lnsApp,.lnsApp__frame{display:flex;flex-direction:column}.lnsApp__frame{flex-grow:1;position:relative}.lensAnnotationIconFill{fill:#fff}@media only screen and (min-width:768px) and (max-width:991px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width:992px) and (max-width:1199px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width:1200px){.lnsNavItem__goBack{margin-right:12px;position:relative}}@media only screen and (min-width:768px) and (max-width:991px){.lnsNavItem__goBack:after{border-right:1px solid #d3dae6;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:992px) and (max-width:1199px){.lnsNavItem__goBack:after{border-right:1px solid #d3dae6;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:1200px){.lnsNavItem__goBack:after{border-right:1px solid #d3dae6;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}',""]),e.exports=t},,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t),a.d(t,"getDatatableRenderer",(function(){return P})),a.d(t,"getDatatableVisualization",(function(){return Y})),a.d(t,"DatatableVisualization",(function(){return DatatableVisualization})),a.d(t,"legacyMetricSupportedTypes",(function(){return fe})),a.d(t,"getLegacyMetricVisualization",(function(){return xe})),a.d(t,"LegacyMetricVisualization",(function(){return LegacyMetricVisualization})),a.d(t,"DEFAULT_MAX_COLUMNS",(function(){return qe})),a.d(t,"showingBar",(function(){return He})),a.d(t,"getDefaultColor",(function(){return $e})),a.d(t,"supportedDataTypes",(function(){return We})),a.d(t,"metricLabel",(function(){return Ue})),a.d(t,"getMetricVisualization",(function(){return Je})),a.d(t,"MetricVisualization",(function(){return MetricVisualization})),a.d(t,"isCollapsed",(function(){return Rt})),a.d(t,"getPieVisualization",(function(){return Vt})),a.d(t,"PieVisualization",(function(){return PieVisualization})),a.d(t,"YAxisModes",(function(){return zt.YAxisModes})),a.d(t,"SeriesTypes",(function(){return zt.SeriesTypes})),a.d(t,"visualizationTypes",(function(){return zt.visualizationTypes})),a.d(t,"getXyVisualization",(function(){return Fi})),a.d(t,"XyVisualization",(function(){return xy_XyVisualization})),a.d(t,"isBucketed",(function(){return Yi})),a.d(t,"filterOperationsAxis",(function(){return Ki})),a.d(t,"isCellValueSupported",(function(){return Qi})),a.d(t,"getHeatmapVisualization",(function(){return Ji})),a.d(t,"HeatmapVisualization",(function(){return HeatmapVisualization})),a.d(t,"isNumericMetric",(function(){return cs})),a.d(t,"isNumericDynamicMetric",(function(){return ds})),a.d(t,"CHART_NAMES",(function(){return ps})),a.d(t,"getGaugeVisualization",(function(){return fs})),a.d(t,"GaugeVisualization",(function(){return gauge_GaugeVisualization})),a.d(t,"deleteColumn",(function(){return Or})),a.d(t,"columnToOperation",(function(){return kp})),a.d(t,"getSuffixFormatter",(function(){return _o})),a.d(t,"unitSuffixesLong",(function(){return Po})),a.d(t,"suffixFormatterId",(function(){return Ao})),a.d(t,"getFormBasedDatasource",(function(){return Ip})),a.d(t,"getTextBasedDatasource",(function(){return Lp})),a.d(t,"createFormulaPublicApi",(function(){return Rp})),a.d(t,"TextBasedDatasource",(function(){return text_based_TextBasedDatasource})),a.d(t,"FormBasedDatasource",(function(){return form_based_FormBasedDatasource})),a.d(t,"setUsageCollectionStart",(function(){return p.c})),a.d(t,"getUsageCollectionStart",(function(){return p.b})),a.d(t,"trackUiCounterEvents",(function(){return p.d})),a.d(t,"getExecutionContextEvents",(function(){return p.a})),a.d(t,"ErrorBoundary",(function(){return Vd.a})),a.d(t,"initMemoizedErrorNotification",(function(){return Vd.b})),a.d(t,"showMemoizedErrorNotification",(function(){return Vd.c})),a.d(t,"EditorFrame",(function(){return Bp.a})),a.d(t,"initializeDataViews",(function(){return Bp.d})),a.d(t,"initializeSources",(function(){return Bp.f})),a.d(t,"initializeVisualization",(function(){return Bp.g})),a.d(t,"initializeDatasources",(function(){return Bp.e})),a.d(t,"getDatasourceLayers",(function(){return Bp.b})),a.d(t,"persistedStateToExpression",(function(){return Bp.h})),a.d(t,"getMissingIndexPattern",(function(){return Bp.c})),a.d(t,"validateDatasourceAndVisualization",(function(){return Bp.i})),a.d(t,"EditorFrameService",(function(){return service_EditorFrameService})),a.d(t,"Embeddable",(function(){return embeddable_Embeddable})),a.d(t,"getLensServices",(function(){return jg})),a.d(t,"mountApp",(function(){return Og})),a.d(t,"getLensAttributeService",(function(){return Ig})),a.d(t,"SaveModalContainer",(function(){return bg.SaveModalContainer})),a.d(t,"runSaveLensVisualization",(function(){return bg.runSaveLensVisualization})),a.d(t,"removePinnedFilters",(function(){return bg.removePinnedFilters})),a.d(t,"isLensEmbeddable",(function(){return Tg})),a.d(t,"isCompatible",(function(){return wg})),a.d(t,"getHref",(function(){return Cg})),a.d(t,"getLocation",(function(){return Sg})),a.d(t,"execute",(function(){return Fg}));var n=a(12),i=a.n(n),s=a(8),l=a.n(s),r=a(25),o=a.n(r),u=a(0),c=a(22),d=a(13),p=a(80),m=(a(164),a(65)),g=a(210),f=a.n(g),b=a(7),h=a(43),x=a(60),v=(a(179),a(23)),y=a.n(v),j=a(2);function O({children:e,className:t,...a}){return Object(j.jsx)("div",i()({"data-test-subj":"lnsVisualizationContainer",className:y()(t,"lnsVisualizationContainer")},a),e)}var k=a(57),I=a(67),T=a(102),w=a(87);const M=l.a.createContext({}),C={border:"horizontal",header:"underline"},S=[10,20,30,50,100],F=e=>{var t,a,n;const i=Object(s.useRef)(null),l=e.interactive,[r,o]=Object(s.useState)({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection}),[c,d]=Object(s.useState)(e.data),[p,g]=Object(s.useState)(void 0);Object(s.useLayoutEffect)((()=>{setTimeout((()=>{e.renderComplete()}),300)}),[e]),Object(s.useEffect)((()=>{var t;g(e.args.pageSize?{pageIndex:0,pageSize:null!==(t=e.args.pageSize)&&void 0!==t?t:10}:void 0)}),[e.args.pageSize]),f()((()=>{o({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection})}),[e.args.columns,e.args.sortingColumnId,e.args.sortingDirection]),f()((()=>{d(e.data)}),[e.data]);const v=Object(s.useRef)(c);v.current=c,Object(s.useEffect)((()=>{if(!(null!=p&&p.pageIndex||null!=p&&p.pageSize))return;const e=Math.ceil(c.rows.length/p.pageSize)-1;g((t=>t?{pageIndex:t.pageIndex>e?e:t.pageIndex,pageSize:t.pageSize}:t))}),[null==p?void 0:p.pageIndex,null==p?void 0:p.pageSize,c.rows.length]);const F=Object(s.useRef)(e.untransposedData);F.current=e.untransposedData;const E=null===(t=e.rowHasRowClickTriggerActions)||void 0===t?void 0:t.some((e=>e)),{getType:P,dispatchEvent:A,renderMode:_,formatFactory:L}=e,D=Object(s.useMemo)((()=>c.columns.reduce(((e,t)=>{var a;return{...e,[t.id]:L(null===(a=t.meta)||void 0===a?void 0:a.params)}}),{})),[c,L]),N=Object(s.useCallback)((e=>{A({name:"filter",data:e})}),[A]),R=Object(s.useCallback)((e=>{A({name:"edit",data:e})}),[A]),B=Object(s.useCallback)((e=>R({action:"pagesize",size:e})),[R]),V=Object(s.useCallback)((e=>{g((t=>{if(t)return{pageSize:null==t?void 0:t.pageSize,pageIndex:e}}))}),[g]),z=Object(s.useCallback)((e=>{A({name:"tableRowContextMenuClick",data:e})}),[A]),G=Object(s.useMemo)((()=>l?((e,t)=>(a,n,i,s,l=!1)=>{const r={negate:l,data:[{row:s,column:i,value:n,table:e.current}]};t(r)})(v,N):void 0),[v,N,l]),q=Object(s.useMemo)((()=>l?((e,t)=>(a,n=!1)=>{if(!t.current)return;const i=t.current,s={negate:n,data:a.map((({originalBucketColumn:e,value:t})=>{const a=i.columns.findIndex((t=>t.id===e.id));return{row:i.rows.findIndex((a=>a[e.id]===t)),column:a,value:t,table:i}}))};e(s)})(N,F):void 0),[N,F,l]),H=Object(s.useMemo)((()=>r.columns.filter(((e,t)=>{var a,n,i;const s=v.current.columns[t];return(null==s||null===(a=s.meta)||void 0===a||null===(n=a.sourceParams)||void 0===n?void 0:n.type)&&"buckets"===(null===(i=P(s.meta.sourceParams.type))||void 0===i?void 0:i.type)})).map((e=>e.columnId))),[v,r,P]),$=0===c.rows.length||H.length&&e.data.rows.every((e=>H.every((t=>null==e[t])))),W=Object(s.useMemo)((()=>r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((e=>e.columnId))),[r]),{sortingColumnId:U,sortingDirection:X}=e.args,Y="edit"!==_,K=Object(s.useMemo)((()=>((e,t,a)=>n=>{const i=Object(I.a)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,width:n.width}:e))}),a({action:"resize",columnId:i,width:n.width})})(r,o,R)),[R,o,r]),Q=Object(s.useMemo)((()=>l?((e,t,a)=>n=>{const i=Object(I.a)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,hidden:!0}:e))}),a({action:"toggle",columnId:i})})(r,o,R):void 0),[R,o,r,l]),Z=Object(s.useMemo)((()=>{const e={};for(const a of c.columns){var t;e[a.id]="number"===a.meta.type&&null!=a.meta.field||null==a.meta.field&&"number"==typeof(null===(t=c.rows.find((e=>null!=e[a.id])))||void 0===t?void 0:t[a.id])}return e}),[c]),J=Object(s.useMemo)((()=>{const e={};return r.columns.forEach((t=>{t.alignment?e[t.columnId]=t.alignment:e[t.columnId]=Z[t.columnId]?"right":"left"})),e}),[r,Z]),ee=Object(s.useMemo)((()=>Object(k.A)(r.columns.filter((({columnId:e})=>Z[e])).map((({columnId:e})=>e)),e.data,I.a)),[e.data,Z,r]),te=null!==(a=e.args.headerRowHeight)&&void 0!==a?a:"single",ae=null!==(n=e.args.headerRowHeightLines)&&void 0!==n?n:1,ne=Object(s.useMemo)((()=>{var t;return((e,t,a,n,i,s,l,r,o,c,d,p,m,g,f)=>{const b=t.columns.reduce(((e,{id:t,name:a,meta:n},i)=>(e[t]={name:a,index:i,meta:n},e)),{}),h=({rowIndex:e,columnId:a})=>{var n,i;const s=null===(n=t.rows[e])||void 0===n?void 0:n[a],l=null==b?void 0:b[a];return{rowValue:s,contentsIsDefined:null!=s,cellContent:r(null==l||null===(i=l.meta)||void 0===i?void 0:i.params).convert(s)}};return l.map((e=>{const{name:t,index:r}=b[e],x=(null==f?void 0:f[r])||!1,v=s.columns.find((({columnId:t})=>t===e)),y=!x||!a||null!=v&&v.oneClickFilter?void 0:[({rowIndex:t,columnId:n,Component:i})=>{const{rowValue:s,contentsIsDefined:l,cellContent:o}=h({rowIndex:t,columnId:n}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueText",{defaultMessage:"Filter for value"}),d=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueAriaLabel",{defaultMessage:"Filter for value: {cellContent}",values:{cellContent:o}});return l&&Object(j.jsx)(i,{"aria-label":d,"data-test-subj":"lensDatatableFilterFor",onClick:()=>{a(e,s,r,t),null==g||g()},iconType:"plusInCircle"},c)},({rowIndex:t,columnId:n,Component:i})=>{const{rowValue:s,contentsIsDefined:l,cellContent:o}=h({rowIndex:t,columnId:n}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueText",{defaultMessage:"Filter out value"}),d=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueAriaLabel",{defaultMessage:"Filter out value: {cellContent}",values:{cellContent:o}});return l&&Object(j.jsx)(i,{"data-test-subj":"lensDatatableFilterOut","aria-label":d,onClick:()=>{a(e,s,r,t,!0),null==g||g()},iconType:"minusInCircle"},c)}],O=Boolean(null==v?void 0:v.originalColumnId),k=null==v?void 0:v.width,I=null==v?void 0:v.hidden,T=null==v?void 0:v.originalColumnId,w=[];if(w.push({color:"text",size:"xs",onClick:()=>o({columnId:T||e,width:void 0}),iconType:"empty",label:u.i18n.translate("xpack.lens.table.resize.reset",{defaultMessage:"Reset width"}),"data-test-subj":"lensDatatableResetWidth",isDisabled:null==k}),!O&&c&&w.push({color:"text",size:"xs",onClick:()=>c({columnId:T||e}),iconType:"eyeClosed",label:u.i18n.translate("xpack.lens.table.hide.hideLabel",{defaultMessage:"Hide"}),"data-test-subj":"lensDatatableHide",isDisabled:!I&&l.length<=1}),!i&&O&&null!=v&&v.bucketValues&&n){const e=null==v?void 0:v.bucketValues;w.push({color:"text",size:"xs",onClick:()=>n(e,!1),iconType:"plusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterForValueText",{defaultMessage:"Filter for column"}),"data-test-subj":"lensDatatableHide"}),w.push({color:"text",size:"xs",onClick:()=>n(e,!0),iconType:"minusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterOutValueText",{defaultMessage:"Filter out column"}),"data-test-subj":"lensDatatableHide"})}const M=d&&d[e],C="auto"===p||"custom"===p,S=Object(j.css)({..."custom"===p&&{WebkitLineClamp:m},...C&&{whiteSpace:"normal",display:"-webkit-box",WebkitBoxOrient:"vertical"},textAlign:M},"",""),F={id:e,cellActions:y,display:Object(j.jsx)("div",{css:S},t),displayAsText:t,actions:{showHide:!1,showMoveLeft:!1,showMoveRight:!1,showSortAsc:{label:u.i18n.translate("xpack.lens.table.sort.ascLabel",{defaultMessage:"Sort ascending"})},showSortDesc:{label:u.i18n.translate("xpack.lens.table.sort.descLabel",{defaultMessage:"Sort descending"})},additional:w}};return k&&(F.initialWidth=k),F}))})(0,c,G,q,Y,r,W,L,K,Q,J,te,ae,null===(t=i.current)||void 0===t?void 0:t.closeCellPopover,e.columnFilterable)}),[H,c,G,q,Y,r,W,L,K,Q,J,te,ae,e.columnFilterable]),ie=Object(s.useMemo)((()=>E&&z&&l?[{headerCellRender:()=>null,width:40,id:"trailingControlColumn",rowCellRender:function({rowIndex:e}){const{rowHasRowClickTriggerActions:t}=Object(s.useContext)(M);return Object(j.jsx)(b.EuiButtonIcon,{"aria-label":u.i18n.translate("xpack.lens.table.actionsLabel",{defaultMessage:"Show actions"}),iconType:t&&!t[e]?"empty":"boxesVertical",color:"text",onClick:()=>{z({rowIndex:e,table:v.current,columns:r.columns.map((e=>e.columnId))})}})}}]:[]),[v,z,r,E,l]),se=Object(s.useMemo)((()=>((e,t,a,n,i)=>{const l=n.get("theme:darkMode");return({rowIndex:n,columnId:r,setCellProps:o})=>{var u,c;const{table:d,alignments:p,minMaxByColumnId:m,getColorForValue:g,handleFilterClick:f}=Object(s.useContext)(a),h=null==d||null===(u=d.rows[n])||void 0===u?void 0:u[r],x=t.columns.findIndex((({columnId:e})=>e===r)),{colorMode:v,palette:O,oneClickFilter:k}=t.columns[x]||{},w=k&&f,M=null===(c=e[r])||void 0===c?void 0:c.convert(h,w?"text":"html"),C=p&&p[r];return Object(s.useEffect)((()=>{const e=Object(I.a)(r);if(null!=m&&m[e]&&"none"!==v&&null!=O&&O.params&&g){const t=g(Object(T.d)(h),O.params,m[e]);if(t){const e={["cell"===v?"backgroundColor":"color"]:t};"cell"===v&&t&&(e.color=Object(T.c)(t,l)),o({style:e})}}return()=>{null!=m&&m[e]&&o({style:{backgroundColor:void 0,color:void 0}})}}),[h,r,o,v,O,m,g]),w?Object(j.jsx)("div",{"data-test-subj":"lnsTableCellContent",className:y()({"lnsTableCell--multiline":i,[`lnsTableCell--${C}`]:!0})},Object(j.jsx)(b.EuiLink,{onClick:()=>{null==f||f(r,h,x,n)}},M)):Object(j.jsx)("div",{dangerouslySetInnerHTML:{__html:M},"data-test-subj":"lnsTableCellContent",className:y()({"lnsTableCell--multiline":i,[`lnsTableCell--${C}`]:!0})})}})(D,r,M,e.uiSettings,e.args.fitRowToContent)),[D,r,e.uiSettings,e.args.fitRowToContent]),le=Object(s.useMemo)((()=>({visibleColumns:W,setVisibleColumns:()=>{}})),[W]),re=Object(s.useMemo)((()=>((e,t,a)=>({columns:e&&"none"!==t?[{id:e,direction:t}]:[],onSort:t=>{const n=t.length<=1?t[0]:t[1],i=e!==((null==n?void 0:n.id)||""),s=n?n.direction:"none";return a({action:"sort",columnId:"none"!==s||i?null==n?void 0:n.id:void 0,direction:s})}}))(U,X,R)),[R,U,X]),oe=Object(s.useMemo)((()=>{const t=r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((t=>({columnId:t.columnId,summaryRowValue:t.summaryRowValue,...Object(w.c)(t.columnId,t,e.data)}))).filter((({summaryRow:e})=>"none"!==e));if(t.length){const e=Object.fromEntries(t.map((({summaryRowValue:e,summaryLabel:t,columnId:a})=>[a,""===t?`${e}`:`${t}: ${e}`])));return({columnId:t})=>{var a,n;const i=`lnsTableCell--${J&&J[t]}`,s=(null===(a=ne.find((({id:e})=>e===t)))||void 0===a||null===(n=a.displayAsText)||void 0===n?void 0:n.replace(/ /g,"-"))||t;return null!=e[t]?Object(j.jsx)("div",{className:`lnsTableCell ${i}`,"data-test-subj":`lnsDataTable-footer-${s}`},e[t]):null}}}),[r.columns,J,e.data,ne]);if($)return Object(j.jsx)(O,{className:"lnsDataTableContainer"},Object(j.jsx)(h.EmptyPlaceholder,{icon:x.s}));const ue=e.args.title||u.i18n.translate("xpack.lens.table.defaultAriaLabel",{defaultMessage:"Data table visualization"});return Object(j.jsx)(O,{className:"lnsDataTableContainer"},Object(j.jsx)(M.Provider,{value:{table:c,rowHasRowClickTriggerActions:e.rowHasRowClickTriggerActions,alignments:J,minMaxByColumnId:ee,getColorForValue:e.paletteService.get(m.a).getColorForValue,handleFilterClick:G}},Object(j.jsx)(b.EuiDataGrid,{"aria-label":ue,"data-test-subj":"lnsDataTable",rowHeightsOptions:{defaultHeight:e.args.fitRowToContent?"auto":e.args.rowHeightLines&&1!==e.args.rowHeightLines?{lineCount:e.args.rowHeightLines}:void 0},columns:ne,columnVisibility:le,trailingControlColumns:ie,rowCount:c.rows.length,renderCellValue:se,gridStyle:C,sorting:re,pagination:p&&{...p,pageSizeOptions:S,onChangeItemsPerPage:B,onChangePage:V},onColumnResize:K,toolbarVisibility:!1,renderFooterCellValue:oe,ref:i})))};async function E(e,t){if(e.rows.length)return Promise.all(e.columns.map((async(a,n)=>{var i;return Boolean(await(null===(i=t.hasCompatibleActions)||void 0===i?void 0:i.call(t,{name:"filter",data:{data:[{table:e,column:n,row:0}]}})))})))}const P=e=>({name:"lens_datatable_renderer",displayName:u.i18n.translate("xpack.lens.datatable.visualizationName",{defaultMessage:"Datatable"}),help:"",validate:()=>{},reuseDomNode:!0,render:async(t,a,n)=>{n.onDestroy((()=>o.a.unmountComponentAtNode(t)));const s=await e.getType,{hasCompatibleActions:l,isInteractive:r}=n;let u=[];l&&a.data&&(u=await Promise.all(a.data.rows.map((async(e,t)=>{try{return await l({name:"tableRowContextMenuClick",data:{rowIndex:t,table:a.data,columns:a.args.columns.map((e=>e.columnId))}})}catch{return!1}})))),o.a.render(Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(F,i()({},a,{formatFactory:e.formatFactory,dispatchEvent:n.event,renderMode:n.getRenderMode(),paletteService:e.paletteService,getType:s,rowHasRowClickTriggerActions:u,columnFilterable:await E(a.data,n),interactive:r(),uiSettings:e.uiSettings,renderComplete:()=>{Object(p.d)("table",n.getExecutionContext()),n.done()}})))),t)}});var A=a(5),_=a(24),L=a(31),D=a(75);a(131);const N=[{text:u.i18n.translate("xpack.lens.collapse.none",{defaultMessage:"None"}),value:""},{text:u.i18n.translate("xpack.lens.collapse.sum",{defaultMessage:"Sum"}),value:"sum"},{text:u.i18n.translate("xpack.lens.collapse.min",{defaultMessage:"Min"}),value:"min"},{text:u.i18n.translate("xpack.lens.collapse.max",{defaultMessage:"Max"}),value:"max"},{text:u.i18n.translate("xpack.lens.collapse.avg",{defaultMessage:"Average"}),value:"avg"}];function R({value:e,onChange:t}){return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{label:Object(j.jsx)(b.EuiToolTip,{delay:"long",position:"top",content:u.i18n.translate("xpack.lens.collapse.infoIcon",{defaultMessage:"Do not show this dimension in the visualization and aggregate all metric values which have the same value for this dimension into a single number."})},Object(j.jsx)("span",null,u.i18n.translate("xpack.lens.collapse.label",{defaultMessage:"Collapse by"}),"",Object(j.jsx)(b.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))),display:"rowCompressed",fullWidth:!0},Object(j.jsx)(b.EuiSelect,{fullWidth:!0,compressed:!0,"data-test-subj":"indexPattern-collapse-by",options:N,value:e,onChange:e=>{t(e.target.value)}})))}const B=Object(b.htmlIdGenerator)()();function V(e,t,a){return e.columns.map((e=>e.columnId===t?{...e,...a}:e))}function z(e){var t,a;const{state:n,setState:i,frame:r,accessor:o}=e,c=n.columns.find((({columnId:e})=>o===e)),[d,p]=Object(s.useState)(!1);if(!c)return null;if(c.isTransposed)return null;const g=null===(t=r.activeData)||void 0===t?void 0:t[n.layerId],f=Object(D.a)(g,o),h=(null==c?void 0:c.alignment)||(f?"right":"left"),x=(null==c?void 0:c.colorMode)||"none",v="none"!==x,y=r.datasourceLayers[n.layerId],O=Boolean(f&&!(null!=y&&null!==(a=y.getOperationForColumnId(o))&&void 0!==a&&a.isBucketed)),T=n.columns.filter((e=>!e.hidden)).length,w=n.columns.some((({isTransposed:e})=>e))?(null==g?void 0:g.columns.filter((({id:e})=>Object(I.a)(e)===o)).map((({id:e})=>e)))||[]:[o],M=Object(k.A)(w,g,I.a)[o],C=(null==c?void 0:c.palette)||{type:"palette",name:k.y.name},S=Object(k.w)(e.paletteService,C,M);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"})},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"}),"data-test-subj":"lnsDatatable_alignment_groups",name:"alignment",buttonSize:"compressed",options:[{id:`${B}left`,label:u.i18n.translate("xpack.lens.table.alignment.left",{defaultMessage:"Left"}),"data-test-subj":"lnsDatatable_alignment_groups_left"},{id:`${B}center`,label:u.i18n.translate("xpack.lens.table.alignment.center",{defaultMessage:"Center"}),"data-test-subj":"lnsDatatable_alignment_groups_center"},{id:`${B}right`,label:u.i18n.translate("xpack.lens.table.alignment.right",{defaultMessage:"Right"}),"data-test-subj":"lnsDatatable_alignment_groups_right"}],idSelected:`${B}${h}`,onChange:e=>{const t=e.replace(B,"");i({...n,columns:V(n,o,{alignment:t})})}})),O&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups",name:"dynamicColoring",buttonSize:"compressed",options:[{id:`${B}none`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_none"},{id:`${B}cell`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.cell",{defaultMessage:"Cell"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_cell"},{id:`${B}text`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_text"}],idSelected:`${B}${x}`,onChange:e=>{const t=e.replace(B,""),a={colorMode:t};null!=c&&c.palette||"none"===t||(a.palette={...C,params:{...C.params,stops:S}}),null!=c&&c.palette&&"none"===t&&(a.palette=void 0),i({...n,columns:V(n,o,a)})}})),v&&Object(j.jsx)(b.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteTableGradient.label",{defaultMessage:"Color"})},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsDatatable_dynamicColoring_palette",palette:S.map((({color:e})=>e)),type:m.i,onClick:()=>{p(!d)}})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsDatatable_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:()=>{p(!d)},size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(j.jsx)(k.n,{siblingRef:e.panelRef,isOpen:d,handleClose:()=>p(!d)},Object(j.jsx)(m.b,{palettes:e.paletteService,activePalette:C,dataBounds:M,setPalette:e=>{i({...n,columns:V(n,o,{palette:e})})}})))))),!c.isTransposed&&Object(j.jsx)(b.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),display:"columnCompressedSwitch"},Object(j.jsx)(b.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),showLabel:!1,"data-test-subj":"lns-table-column-hidden",checked:Boolean(null==c?void 0:c.hidden),disabled:!c.hidden&&T<=1,onChange:()=>{const e={...n,columns:n.columns.map((e=>e.columnId===o?{...e,hidden:!c.hidden}:e))};i(e)}})),"rows"===e.groupId&&Object(j.jsx)(b.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.columnFilterClickLabel",{defaultMessage:"Directly filter on click"}),display:"columnCompressedSwitch"},Object(j.jsx)(b.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.table.columnFilterClickLabel",{defaultMessage:"Directly filter on click"}),showLabel:!1,"data-test-subj":"lns-table-column-one-click-filter",checked:Boolean(null==c?void 0:c.oneClickFilter),disabled:c.hidden,onChange:()=>{const e={...n,columns:n.columns.map((e=>e.columnId===o?{...e,oneClickFilter:!c.oneClickFilter}:e))};i(e)}})))}function G(e){const{state:t,setState:a,accessor:n}=e,i=t.columns.find((({columnId:e})=>n===e));return i?i.isTransposed?null:Object(j.jsx)(l.a.Fragment,null,"rows"===e.groupId&&Object(j.jsx)(R,{value:i.collapseFn||"",onChange:e=>{a({...t,columns:V(t,n,{collapseFn:e})})}})):null}function q(e,t,a){return e.columns.map((e=>e.columnId===t?{...e,...a}:e))}function H(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,o=a.columns.find((({columnId:e})=>r===e)),c=Object(s.useCallback)((e=>{n({...a,columns:q(a,r,{summaryLabel:e})})}),[r,n,a]),{inputValue:d,handleInputChange:p}=Object(k.F)({onChange:c,value:null==o?void 0:o.summaryLabel},{allowFalsyValue:!0}),{euiTheme:m}=Object(b.useEuiTheme)();if(!o)return null;if(o.isTransposed)return null;const g=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],f=Object(D.a)(g,r),{summaryRow:h,summaryLabel:x}=Object(w.c)(r,o,g);return Object(j.jsx)(l.a.Fragment,null,f&&Object(j.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded lnsIndexPatternDimensionEditor--collapseNext"},Object(j.jsx)(b.EuiText,{size:"s",css:Object(j.css)("margin-bottom:",m.size.base,";","")},Object(j.jsx)("h4",null,u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingSummary",{defaultMessage:"Summary"}))),Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.label",{defaultMessage:"Summary Row"}),display:"columnCompressed"},Object(j.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"lnsDatatable_summaryrow_function",placeholder:u.i18n.translate("xpack.lens.indexPattern.fieldPlaceholder",{defaultMessage:"Field"}),options:Object(w.d)(),selectedOptions:[{label:Object(w.b)(h),value:h}],singleSelection:{asPlainText:!0},onChange:e=>{const t=e[0].value;n({...a,columns:q(a,r,{summaryRow:t})})}})),"none"!==h&&Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.customlabel",{defaultMessage:"Summary label"})},Object(j.jsx)(b.EuiFieldText,{fullWidth:!0,compressed:!0,"data-test-subj":"lnsDatatable_summaryrow_label",value:null!=d?d:x,onChange:e=>{p(e.target.value)}})))))}const $=Object(b.htmlIdGenerator)()();function W(e){const{label:t,rowHeight:a,rowHeightLines:n,onChangeRowHeight:i,onChangeRowHeightLines:s,maxRowHeight:r}=e,o=[{id:`${$}single`,label:u.i18n.translate("xpack.lens.table.rowHeight.single",{defaultMessage:"Single"}),"data-test-subj":"lnsDatatable_rowHeight_single"},{id:`${$}auto`,label:u.i18n.translate("xpack.lens.table.rowHeight.auto",{defaultMessage:"Auto fit"}),"data-test-subj":"lnsDatatable_rowHeight_auto"},{id:`${$}custom`,label:u.i18n.translate("xpack.lens.table.rowHeight.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsDatatable_rowHeight_custom"}];return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{label:t,display:"columnCompressed","data-test-subj":e["data-test-subj"]},Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:t,name:"legendLocation",buttonSize:"compressed",options:o,idSelected:`${$}${null!=a?a:"single"}`,onChange:e=>{const t=e.replace($,"");i(t)}}),"custom"===a?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"xs"}),Object(j.jsx)(b.EuiRange,{compressed:!0,fullWidth:!0,showInput:!0,min:1,max:null!=r?r:20,step:1,value:null!=n?n:2,onChange:e=>{const t=Number(e.currentTarget.value);s(t)},"data-test-subj":"lens-table-row-height-lineCountNumber"})):null)))}function U(e){var t;const{state:a,setState:n}=e,i=Object(s.useCallback)(((e,t,i)=>{const s="single"===e?1:"auto"!==e?2:void 0;n({...a,[t]:e,[i]:s})}),[n,a]),l=Object(s.useCallback)(((e,t)=>{n({...a,[t]:e})}),[n,a]),r=Object(s.useCallback)((()=>{var e;const t=null!==(e=a.paging)&&void 0!==e?e:{size:10,enabled:!1};n({...a,paging:{...t,enabled:!t.enabled}})}),[n,a]);return Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(j.jsx)(k.s,{title:u.i18n.translate("xpack.lens.table.valuesVisualOptions",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(j.jsx)(W,{rowHeight:a.headerRowHeight,rowHeightLines:a.headerRowHeightLines,label:u.i18n.translate("xpack.lens.table.visualOptionsHeaderRowHeightLabel",{defaultMessage:"Header row height"}),onChangeRowHeight:e=>i(e,"headerRowHeight","headerRowHeightLines"),onChangeRowHeightLines:e=>{l(e,"headerRowHeightLines")},"data-test-subj":"lnsHeaderHeightSettings",maxRowHeight:5}),Object(j.jsx)(W,{rowHeight:a.rowHeight,rowHeightLines:a.rowHeightLines,label:u.i18n.translate("xpack.lens.table.visualOptionsFitRowToContentLabel",{defaultMessage:"Cell row height"}),onChangeRowHeight:e=>i(e,"rowHeight","rowHeightLines"),onChangeRowHeightLines:e=>{l(e,"rowHeightLines")},"data-test-subj":"lnsRowHeightSettings"}),Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTable",{defaultMessage:"Paginate table"}),display:"columnCompressedSwitch"},Object(j.jsx)(b.EuiToolTip,{content:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTableTooltip",{defaultMessage:"Pagination is hidden if there are less than 10 items"}),position:"right"},Object(j.jsx)(b.EuiSwitch,{compressed:!0,"data-test-subj":"lens-table-pagination-switch",label:"",showLabel:!1,checked:Boolean(null===(t=a.paging)||void 0===t?void 0:t.enabled),onChange:r})))))}const X=u.i18n.translate("xpack.lens.datatable.label",{defaultMessage:"Table"}),Y=({paletteService:e,theme:t})=>({id:"lnsDatatable",visualizationTypes:[{id:"lnsDatatable",icon:x.s,label:X,groupLabel:u.i18n.translate("xpack.lens.datatable.groupLabel",{defaultMessage:"Tabular"}),sortPriority:5}],getVisualizationTypeId:()=>"lnsDatatable",getLayerIds:e=>[e.layerId],clearLayer:e=>({...e,columns:[]}),getDescription:()=>({icon:x.s,label:X}),switchVisualizationType:(e,t)=>t,triggers:[A.VIS_EVENT_TO_TRIGGER.filter,A.VIS_EVENT_TO_TRIGGER.tableRowContextMenuClick],initialize:(e,t)=>t||{columns:[],layerId:e(),layerType:_.LayerTypes.DATA},getSuggestions({table:e,state:t,keptLayerIds:a}){if(a.length>1||a.length&&e.layerId!==a[0]||t&&"unchanged"===e.changeType||e.columns.some((e=>e.operation.isStaticValue)))return[];const n={};t&&t.columns.forEach((e=>{n[e.columnId]=e}));const i=e.columns.findIndex((e=>{var t;return!(!n[e.columnId]||null!==(t=n[e.columnId])&&void 0!==t&&t.isTransposed)})),s=null==t?void 0:t.columns.some((e=>e.isTransposed)),l="unchanged"===e.changeType?u.i18n.translate("xpack.lens.datatable.suggestionLabel",{defaultMessage:"As table"}):u.i18n.translate("xpack.lens.datatable.visualizationOf",{defaultMessage:"Table {operations}",values:{operations:e.label||e.columns.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.datatable.conjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."}))}}),r=e.changeType,o="reduced"===r||"layers"===r?.3:"unchanged"===r?.5:1;return[{title:l,score:Math.min(e.columns.length,10)/10*.4*o,state:{...t||{},layerId:e.layerId,layerType:_.LayerTypes.DATA,columns:e.columns.map(((e,t)=>({...n[e.columnId]||{},isTransposed:s&&t<i,columnId:e.columnId})))},previewIcon:x.s,hide:!0}]},getConfiguration({state:e,frame:t,layerId:a}){const{sortedColumns:n,datasource:i}=K(e,t.datasourceLayers)||{},s={};return e.columns.forEach((e=>{s[e.columnId]=e})),n?{groups:[{groupId:"rows",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownRows",{defaultMessage:"Rows"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.datatable.breakdownRow",{defaultMessage:"Row"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownRows.description",{defaultMessage:"Split table rows by field. This is recommended for high cardinality breakdowns."}),layerId:e.layerId,accessors:n.filter((t=>{var a,n;return(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&!(null!==(n=e.columns.find((e=>e.columnId===t)))&&void 0!==n&&n.isTransposed)})).map((e=>({columnId:e,triggerIcon:s[e].hidden?"invisible":s[e].collapseFn?"aggregate":void 0}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_rows",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:1},{groupId:"columns",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownColumns",{defaultMessage:"Split metrics by"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.datatable.breakdownColumn",{defaultMessage:"Split metrics by"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownColumns.description",{defaultMessage:"Split metric columns by field. It's recommended to keep the number of columns low to avoid horizontal scrolling."}),layerId:e.layerId,accessors:n.filter((t=>{var a,n;return(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&(null===(n=e.columns.find((e=>e.columnId===t)))||void 0===n?void 0:n.isTransposed)})).map((e=>({columnId:e}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_columns",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:0},{groupId:"metrics",groupLabel:u.i18n.translate("xpack.lens.datatable.metrics",{defaultMessage:"Metrics"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.datatable.metric",{defaultMessage:"Metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.datatable.headingLabel",{defaultMessage:"Value"})},layerId:e.layerId,accessors:n.filter((e=>{var t;return!(null!==(t=i.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).map((e=>{var t,a;const n=s[e],i=null==n||null===(t=n.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops,l=Boolean("none"!==(null==n?void 0:n.colorMode)&&i);return{columnId:e,triggerIcon:null!=n&&n.hidden?"invisible":l?"colorBy":void 0,palette:l&&i?i.map((({color:e})=>e)):void 0}})),supportsMoreColumns:!0,filterOperations:e=>!e.isBucketed,isMetricDimension:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsDatatable_metrics",enableDimensionEditor:!0}]}:{groups:[]}},setDimension:({prevState:e,columnId:t,groupId:a,previousColumn:n})=>e.columns.some((e=>e.columnId===t||n&&e.columnId===n))?{...e,columns:e.columns.map((e=>e.columnId===t||e.columnId===n?{...e,columnId:t,isTransposed:"columns"===a}:e))}:{...e,columns:[...e.columns,{columnId:t,isTransposed:"columns"===a}]},removeDimension({prevState:e,columnId:t}){var a;return{...e,columns:e.columns.filter((e=>e.columnId!==t)),sorting:(null===(a=e.sorting)||void 0===a?void 0:a.columnId)===t?void 0:e.sorting}},renderDimensionEditor(a,n){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(z,i()({},n,{paletteService:e})))),a)},renderDimensionEditorAdditionalSection(a,n){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(H,i()({},n,{paletteService:e})))),a)},renderDimensionEditorDataExtra(a,n){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(G,i()({},n,{paletteService:e})))),a)},getSupportedLayers:()=>[{type:_.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.datatable.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,{title:n,description:i}={},s={}){var l,r,o,u,c,d,p;const{sortedColumns:g,datasource:f}=K(t,a,t.layerId)||{};if(null!=g&&g.length&&0===g.filter((e=>{var t;return!(null!==(t=f.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).length)return null;if(!s||0===Object.keys(s).length)return null;const b={};t.columns.forEach((e=>{b[e.columnId]=e}));const h=g.filter((e=>f.getOperationForColumnId(e))).map((e=>b[e])),x=s[t.layerId],v=h.filter((e=>e.collapseFn)).map((e=>Object(L.buildExpressionFunction)("lens_collapse",{by:h.filter((t=>{var a;return t.columnId!==e.columnId&&(null===(a=f.getOperationForColumnId(t.columnId))||void 0===a?void 0:a.isBucketed)})).map((e=>e.columnId)),metric:h.filter((e=>{var t;return!(null!==(t=f.getOperationForColumnId(e.columnId))&&void 0!==t&&t.isBucketed)})).map((e=>e.columnId)),fn:[e.collapseFn]}).toAst())),y=Object(L.buildExpressionFunction)("lens_datatable",{title:n||"",description:i||"",columns:h.filter((e=>!e.collapseFn)).map((t=>{var a,n,i,s,l,r,o,u,c,d;const p={...null===(a=t.palette)||void 0===a?void 0:a.params,colors:((null===(n=t.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null===(s=t.palette)||void 0===s||null===(l=s.params)||void 0===l?void 0:l.name)?((null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o?void 0:o.stops)||[]).map((({stop:e})=>e)):[],reverse:!1},g=f.getOperationForColumnId(t.columnId).sortingHint,b=null==t.summaryRow||"none"===t.summaryRow,h="number"===(null===(u=f.getOperationForColumnId(t.columnId))||void 0===u?void 0:u.dataType),x=Object(L.buildExpressionFunction)("lens_datatable_column",{columnId:t.columnId,hidden:t.hidden,oneClickFilter:t.oneClickFilter,width:t.width,isTransposed:t.isTransposed,transposable:!(null!==(c=f.getOperationForColumnId(t.columnId))&&void 0!==c&&c.isBucketed),alignment:t.alignment,colorMode:h&&t.colorMode?t.colorMode:"none",palette:e.get(m.a).toExpression(p),summaryRow:b?void 0:t.summaryRow,summaryLabel:b?void 0:null!==(d=t.summaryLabel)&&void 0!==d?d:Object(w.b)(t.summaryRow),sortingHint:g});return Object(L.buildExpression)([x]).toAst()})),sortingColumnId:(null===(l=t.sorting)||void 0===l?void 0:l.columnId)||"",sortingDirection:(null===(r=t.sorting)||void 0===r?void 0:r.direction)||"none",fitRowToContent:"auto"===t.rowHeight,headerRowHeight:null!==(o=t.headerRowHeight)&&void 0!==o?o:"single",rowHeightLines:t.rowHeight&&"single"!==t.rowHeight?null!==(u=t.rowHeightLines)&&void 0!==u?u:2:1,headerRowHeightLines:t.headerRowHeight&&"single"!==t.headerRowHeight?null!==(c=t.headerRowHeightLines)&&void 0!==c?c:2:1,pageSize:null!==(d=t.paging)&&void 0!==d&&d.enabled?t.paging.size:void 0}).toAst();return{type:"expression",chain:[...null!==(p=null==x?void 0:x.chain)&&void 0!==p?p:[],...v,y]}},getErrorMessages(e){},getRenderEventCounters(e){const t={color_by_value:!1,summary_row:!1};return e.columns.forEach((e=>{e.summaryRow&&"none"!==e.summaryRow&&(t.summary_row=!0),e.colorMode&&"none"!==e.colorMode&&(t.color_by_value=!0)})),Object.entries(t).reduce(((e,[t,a])=>(a&&e.push(`dimension_${t}`),e)),[])},renderToolbar(e,a){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(U,a))),e)},onEditAction(e,t){var a;switch(t.data.action){case"sort":return{...e,sorting:{columnId:t.data.columnId,direction:t.data.direction}};case"toggle":const n=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===n?{...e,hidden:!e.hidden}:e))};case"resize":const i=t.data.width,s=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===s?{...e,width:i}:e))};case"pagesize":return{...e,paging:{enabled:(null===(a=e.paging)||void 0===a?void 0:a.enabled)||!1,size:t.data.size}};default:return e}},getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(e){return{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:"table",...this.getDescription(e),dimensions:e.columns.map((e=>{let t=u.i18n.translate("xpack.lens.datatable.metric",{defaultMessage:"Metric"});return e.transposable||(t=e.isTransposed?u.i18n.translate("xpack.lens.datatable.breakdownColumns",{defaultMessage:"Split metrics by"}):u.i18n.translate("xpack.lens.datatable.breakdownRow",{defaultMessage:"Row"})),{id:e.columnId,name:t}}))}]}}});function K(e,t,a){const n=t[e.layerId],i=null==n?void 0:n.getTableSpec().map((({columnId:e})=>e));return{datasource:n,sortedColumns:Array.from(new Set(null==i?void 0:i.concat(e.columns.map((({columnId:e})=>e)))))}}class DatatableVisualization{setup(e,{expressions:t,formatFactory:n,editorFrame:i,charts:s}){i.registerVisualization((async()=>{const{getDatatableRenderer:i,getDatatableVisualization:l}=await Promise.resolve().then(a.bind(null,493)),r=await s.palettes.getPalettes();return t.registerRenderer((()=>i({formatFactory:n,theme:e.theme,getType:e.getStartServices().then((([e,{data:t}])=>t.search.aggs.types.get)),paletteService:r,uiSettings:e.uiSettings}))),l({paletteService:r,theme:e.theme})}))}}var Q=a(28),Z=a(38);function J({table:e,state:t,keptLayerIds:a}){return e.isMultiRow||a.length>1||a.length&&e.layerId!==a[0]||1!==e.columns.length||e.columns[0].operation.isBucketed||!fe.has(e.columns[0].operation.dataType)||e.columns[0].operation.isStaticValue||t&&"unchanged"===e.changeType?[]:[ee(e)]}function ee(e){const t=e.columns[0];return{title:e.label||t.operation.label,score:.1,previewIcon:x.x,state:{layerId:e.layerId,accessor:t.columnId,layerType:_.LayerTypes.DATA}}}const te={...k.y,maxSteps:5,name:"status",continuity:"all",rangeType:"number",steps:3};a(216);const ae=Object(b.htmlIdGenerator)()();function ne(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,[o,c]=Object(s.useState)(!1),d=Object(s.useCallback)((()=>{c(!o)}),[o]),p=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[g]=(null==p?void 0:p.rows)||[];if(null==r||null==g||!Object(D.a)(p,r))return null;const f=(null==a?void 0:a.colorMode)||Z.ColorMode.None,h=f!==Z.ColorMode.None,x={min:Math.min(2*g[r],0===g[r]?-50:0),max:Math.max(2*g[r],0===g[r]?100:0)},v=(null==a?void 0:a.palette)||{type:"palette",name:te.name,params:{...te,stops:void 0,colorStops:void 0,rangeMin:x.min,rangeMax:3*x.max/4}},y=Object(k.w)(e.paletteService,v,x);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups",name:"dynamicColoring",buttonSize:"compressed",options:[{id:`${ae}None`,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups_none"},{id:`${ae}Background`,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.background",{defaultMessage:"Fill"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups_background"},{id:`${ae}Labels`,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups_labels"}],idSelected:`${ae}${f}`,onChange:e=>{const t=e.replace(ae,""),i={colorMode:t};null!=a&&a.palette||t===Z.ColorMode.None||(i.palette={...v,params:{...v.params,stops:y.map(((e,t,a)=>({...e,stop:x.min+(0===t?0:a[t-1].stop)})))}}),null!=a&&a.palette&&t===Z.ColorMode.None&&(i.palette=void 0),n({...a,...i})}})),h&&Object(j.jsx)(b.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsLegacyMetric_dynamicColoring_palette",palette:y.map((({color:e})=>e)),type:m.i,onClick:d})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsLegacyMetric_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:d,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(j.jsx)(k.n,{siblingRef:e.panelRef,isOpen:o,handleClose:d},Object(j.jsx)(m.b,{palettes:e.paletteService,activePalette:v,dataBounds:x,setPalette:e=>{e.name!==m.a&&e.params&&e.params.rangeMin!==x.min&&(e.params.rangeMin=x.min),n({...a,palette:e})},showRangeTypeSelector:!1}))))))}const ie=[{id:"top",label:u.i18n.translate("xpack.lens.legacyMetric.titlePositions.top",{defaultMessage:"Top"})},{id:"bottom",label:u.i18n.translate("xpack.lens.legacyMetric.titlePositions.bottom",{defaultMessage:"Bottom"})}],se=({state:e,setState:t})=>{var a;return Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(j.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.legacyMetric.titlePositionLabel",{defaultMessage:"Title position"}))},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,"data-test-subj":"lnsMissingValuesSelect",legend:"This is a basic group",options:ie,idSelected:null!==(a=e.titlePosition)&&void 0!==a?a:"top",onChange:a=>{t({...e,titlePosition:a})},buttonSize:"compressed"}))},le="m",re=[{id:"xs",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.extraSmall",{defaultMessage:"XS"})},{id:"s",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.small",{defaultMessage:"S"})},{id:"m",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.medium",{defaultMessage:"M"})},{id:"l",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.large",{defaultMessage:"L"})},{id:"xl",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.extraLarge",{defaultMessage:"XL"})},{id:"xxl",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.xxl",{defaultMessage:"XXL"})}],oe=({state:e,setState:t})=>{var a;const n=re.findIndex((t=>t.id===(e.size||le))),i=a=>{t({...e,size:re[n+a].id})};return Object(j.jsx)(b.EuiSuperSelect,{append:Object(j.jsx)(b.EuiButtonIcon,{iconType:"plus",onClick:()=>i(1),isDisabled:n===re.length-1}),prepend:Object(j.jsx)(b.EuiButtonIcon,{iconType:"minus",onClick:()=>i(-1),isDisabled:0===n}),"data-test-subj":"lnsLegacyMetricSizeSelect",compressed:!0,options:re.map((e=>({value:e.id,dropdownDisplay:e.label,inputDisplay:e.label}))),valueOfSelected:null!==(a=e.size)&&void 0!==a?a:le,onChange:a=>{t({...e,size:a})},itemLayoutAlign:"top",hasDividers:!0,fullWidth:!0})},ue="left",ce=[{id:"left",label:u.i18n.translate("xpack.lens.legacyMetric.alignLabel.left",{defaultMessage:"Align left"}),iconType:"editorAlignLeft"},{id:"center",label:u.i18n.translate("xpack.lens.legacyMetric.alignLabel.center",{defaultMessage:"Align center"}),iconType:"editorAlignCenter"},{id:"right",label:u.i18n.translate("xpack.lens.legacyMetric.alignLabel.right",{defaultMessage:"Align right"}),iconType:"editorAlignRight"}],de=({state:e,setState:t})=>{var a;return Object(j.jsx)(b.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.legacyMetric.titleAlignLabel",{defaultMessage:"Align"}),options:ce,idSelected:null!==(a=e.textAlign)&&void 0!==a?a:ue,onChange:a=>{t({...e,textAlign:a})},isIconOnly:!0,buttonSize:"compressed"})},pe=({state:e,setState:t})=>Object(j.jsx)(b.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:Object(j.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.legacyMetric.textFormattingLabel",{defaultMessage:"Text formatting"}))},Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"s",responsive:!1},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(oe,{state:e,setState:t})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(de,{state:e,setState:t})))),me=({state:e,setState:t})=>Object(j.jsx)(k.t,{tooltipContent:u.i18n.translate("xpack.lens.shared.AppearanceLabel",{defaultMessage:"Appearance"}),condition:!0},Object(j.jsx)(k.s,{title:u.i18n.translate("xpack.lens.shared.metric.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsLegacyMetricAppearanceButton"},Object(j.jsx)(pe,{state:e,setState:t}),Object(j.jsx)(se,{state:e,setState:t}))),ge=Object(s.memo)((function(e){const{state:t,setState:a,frame:n}=e;return Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"m",justifyContent:"spaceBetween",responsive:!1},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"none",responsive:!1},Object(j.jsx)(me,{state:t,setState:a,datasourceLayers:n.datasourceLayers}))))})),fe=(Object(b.htmlIdGenerator)()(),new Set(["string","boolean","number","ip","date"])),be=e=>{const[t,a]=e.split(/(\d+)/).filter(Boolean);return{size:Number(t),sizeUnit:a}},he=(e,t,a,n,i={})=>{var s,l,r,o,u,c,d,p,g,f;if(!t.accessor)return null;const[b]=Object.values(a),h=i[t.layerId],x=b&&b.getOperationForColumnId(t.accessor),v=(null===(s=t.palette)||void 0===s||null===(l=s.params)||void 0===l?void 0:l.stops)||[],y=(null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o?void 0:o.name)===m.a,j="number"===(null==x?void 0:x.dataType),O={...null===(u=t.palette)||void 0===u?void 0:u.params,colors:v.map((({color:e})=>e)),stops:y||null==(null===(c=t.palette)||void 0===c||null===(d=c.params)||void 0===d?void 0:d.rangeMax)?v.map((({stop:e})=>e)):Object(m.m)(v,Math.max(null===(p=t.palette)||void 0===p||null===(g=p.params)||void 0===g?void 0:g.rangeMax,...v.map((({stop:e})=>e)))).map((({stop:e})=>e)),reverse:!1},k={xs:be(Q.euiThemeVars.euiFontSizeXS),s:be(Q.euiThemeVars.euiFontSizeS),m:be(Q.euiThemeVars.euiFontSizeM),l:be(Q.euiThemeVars.euiFontSizeL),xl:be(Q.euiThemeVars.euiFontSizeXL),xxl:be(Q.euiThemeVars.euiFontSizeXXL)},I=k[(null==t?void 0:t.size)||le],T={xs:2*k.xs.size,s:2.5*k.m.size,m:2.5*k.l.size,l:2.5*k.xl.size,xl:2.5*k.xxl.size,xxl:3*k.xxl.size}[(null==t?void 0:t.size)||le],w=Object(L.buildExpressionFunction)("font",{align:(null==t?void 0:t.textAlign)||ue,size:T,weight:"600",lHeight:1.5*T,sizeUnit:I.sizeUnit}),M=Object(L.buildExpressionFunction)("font",{align:(null==t?void 0:t.textAlign)||ue,size:I.size,lHeight:1.5*I.size,sizeUnit:I.sizeUnit}),C=Object(L.buildExpressionFunction)("visdimension",{accessor:t.accessor}),S=Object(L.buildExpressionFunction)("legacyMetricVis",{autoScaleMetricAlignment:null==t?void 0:t.autoScaleMetricAlignment,labelPosition:(null==t?void 0:t.titlePosition)||"top",font:Object(L.buildExpression)([w]),labelFont:Object(L.buildExpression)([M]),metric:Object(L.buildExpression)([C]),showLabels:!(null!=n&&n.mode)||"full"===(null==n?void 0:n.mode),colorMode:j&&(null==t?void 0:t.colorMode)||Z.ColorMode.None,autoScale:!0,colorFullBackground:!0,palette:null!=t&&t.colorMode&&(null==t?void 0:t.colorMode)!==Z.ColorMode.None?e.get(m.a).toExpression(O):void 0,percentageMode:!1});return{type:"expression",chain:[...null!==(f=null==h?void 0:h.chain)&&void 0!==f?f:[],S.toAst()]}},xe=({paletteService:e,theme:t})=>({id:"lnsLegacyMetric",visualizationTypes:[{id:"lnsLegacyMetric",icon:x.x,label:u.i18n.translate("xpack.lens.legacyMetric.label",{defaultMessage:"Legacy Metric"}),groupLabel:u.i18n.translate("xpack.lens.legacyMetric.groupLabel",{defaultMessage:"Goal and single value"})}],getVisualizationTypeId:()=>"lnsLegacyMetric",clearLayer:e=>({...e,accessor:void 0}),getLayerIds:e=>[e.layerId],getDescription:()=>({icon:x.x,label:u.i18n.translate("xpack.lens.legacyMetric.label",{defaultMessage:"Legacy Metric"})}),getSuggestions:J,initialize:(e,t)=>t||{layerId:e(),accessor:void 0,layerType:_.LayerTypes.DATA},triggers:[A.VIS_EVENT_TO_TRIGGER.filter],getConfiguration(e){var t,a;const n=null!=e.state.palette,i=(null===(t=e.state.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[];return{groups:[{groupId:"metric",dataTestSubj:"lnsLegacyMetric_metricDimensionPanel",paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.metric.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,groupLabel:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),layerId:e.state.layerId,accessors:e.state.accessor?[{columnId:e.state.accessor,triggerIcon:n?"colorBy":void 0,palette:n?i.map((({color:e})=>e)):void 0}]:[],supportsMoreColumns:!e.state.accessor,filterOperations:e=>!e.isBucketed&&fe.has(e.dataType),enableDimensionEditor:!0,requiredMinDimensionCount:1}]}},getSupportedLayers:()=>[{type:_.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.legacyMetric.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n,i)=>he(e,t,a,{...n},i),toPreviewExpression:(t,a,n)=>he(e,t,a,{mode:"reduced"},n),setDimension:({prevState:e,columnId:t})=>({...e,accessor:t}),removeDimension:({prevState:e})=>({...e,accessor:void 0,colorMode:Z.ColorMode.None,palette:void 0}),renderToolbar(e,a){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(ge,{state:a.state,setState:a.setState,frame:a.frame}))),e)},renderDimensionEditor(a,n){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(ne,i()({},n,{paletteService:e})))),a)},getErrorMessages(e){},getVisualizationInfo(e){const t=[];return e.accessor&&t.push({id:e.accessor,name:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"})}),{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:"metric",...this.getDescription(e),dimensions:t}]}}});class LegacyMetricVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getLegacyMetricVisualization:t}=await Promise.resolve().then(a.bind(null,493));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var ve=a(16);const ye=({table:e,state:t,keptLayerIds:a})=>{var n,i;const s=Boolean(t),l=e.columns.filter((({operation:e})=>We.has(e.dataType)&&!e.isBucketed)),r=e.columns.filter((({operation:e})=>e.isBucketed)),o=e.columns.filter((({operation:e})=>!We.has(e.dataType)&&!e.isBucketed)).length||r.length>1||l.length>2;if(!e.columns.length||((e,t)=>e.length>1||e.length&&t.layerId!==e[0])(a,e)||o||s&&"initial"===e.changeType&&l.length&&r.length||s&&"unchanged"===e.changeType)return[];const u={state:{...t,layerId:e.layerId,layerType:_.LayerTypes.DATA},title:Ue,previewIcon:x.x,score:.5,hide:!0},c={metricAccessor:null===(n=l[0])||void 0===n?void 0:n.columnId,breakdownByAccessor:null===(i=r[0])||void 0===i?void 0:i.columnId};return u.score+=.01*Object.values(c).filter(Boolean).length,[{...u,state:{...u.state,...c,secondaryMetricAccessor:void 0,maxAccessor:void 0}}]},je="lnsMetric",Oe="metric",ke="secondaryMetric",Ie="breakdownBy",Te="trendMetric",we="trendSecondaryMetric",Me="trendTime",Ce="trendBreakdownBy";var Se=a(48),Fe=a(45);const Ee={...k.y,name:"status",rangeType:"percent",steps:3,maxSteps:5,continuity:"all",colorStops:[],stops:[]},Pe={...k.y,name:"status",rangeType:"number",rangeMin:-1/0,rangeMax:1/0,steps:3,maxSteps:5,continuity:"all",colorStops:[],stops:[]};var Ae=a(128);function _e(e){const{state:t,accessor:a}=e,n=Object(b.htmlIdGenerator)()();switch(a){case null==t?void 0:t.metricAccessor:return Object(j.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_primary_metric"},Object(j.jsx)(Re,i()({},e,{idPrefix:n})));case t.secondaryMetricAccessor:return Object(j.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_secondary_metric"},Object(j.jsx)(Ne,i()({},e,{idPrefix:n})));case t.maxAccessor:return Object(j.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_maximum"},Object(j.jsx)(De,i()({},e,{idPrefix:n})));case t.breakdownByAccessor:return Object(j.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_breakdown"},Object(j.jsx)(Le,i()({},e,{idPrefix:n})));default:return null}}function Le({setState:e,state:t}){var a;const n=Object(s.useCallback)((a=>{e({...t,maxCols:parseInt(a,10)})}),[e,t]),{inputValue:i,handleInputChange:r}=Object(k.F)({onChange:n,value:String(null!==(a=t.maxCols)&&void 0!==a?a:qe)});return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.metric.maxColumns",{defaultMessage:"Layout columns"}),fullWidth:!0,display:"columnCompressed"},Object(j.jsx)(b.EuiFieldNumber,{compressed:!0,min:1,"data-test-subj":"lnsMetric_max_cols",value:i,onChange:({target:{value:e}})=>r(e)})),Object(j.jsx)(R,{value:t.collapseFn||"",onChange:a=>{e({...t,collapseFn:a})}}))}function De({setState:e,state:t,idPrefix:a}){return null}function Ne({accessor:e,idPrefix:t,frame:a,layerId:n,setState:i,state:s}){var r,o;const c=(null===(r=Object(Fe.getColumnByAccessor)(e,null===(o=a.activeData)||void 0===o?void 0:o[n].columns))||void 0===r?void 0:r.name)||"";return Object(j.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_secondary_metric"},Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.prefixText.label",{defaultMessage:"Prefix"})},Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.prefix.label",{defaultMessage:"Prefix"}),"data-test-subj":"lnsMetric_prefix_buttons",options:[{id:`${t}auto`,label:u.i18n.translate("xpack.lens.metric.prefix.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsMetric_prefix_auto",value:void 0},{id:`${t}custom`,label:u.i18n.translate("xpack.lens.metric.prefix.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsMetric_prefix_custom",value:c},{id:`${t}none`,label:u.i18n.translate("xpack.lens.metric.prefix.none",{defaultMessage:"None"}),"data-test-subj":"lnsMetric_prefix_none",value:""}],idSelected:`${t}${void 0===s.secondaryPrefix?"auto":""===s.secondaryPrefix?"none":"custom"}`,onChange:(e,t)=>{i({...s,secondaryPrefix:t})}}),Object(j.jsx)(b.EuiSpacer,{size:"s"}),s.secondaryPrefix&&Object(j.jsx)(Ae.a,{compressed:!0,value:s.secondaryPrefix,onChange:e=>{i({...s,secondaryPrefix:e})}}))))}function Re(e){var t,a,n,i,r,o;const{state:c,setState:d,frame:p,accessor:g,idPrefix:f}=e,[h,x]=Object(s.useState)(!1),v=null===(t=p.activeData)||void 0===t?void 0:t[c.layerId];if(null==g||!Object(D.a)(v,g))return null;const y=Boolean(null==c?void 0:c.palette),O=Boolean(c.maxAccessor||c.breakdownByAccessor&&!c.collapseFn||"percent"===(null==c||null===(a=c.palette)||void 0===a||null===(n=a.params)||void 0===n?void 0:n.rangeType)),I=(null==c?void 0:c.palette)||{type:"palette",name:(O?Ee:Pe).name,params:{...O?Ee:Pe}},T=Object(Se.getDataBoundsForPalette)({metric:c.metricAccessor,max:c.maxAccessor,breakdownBy:c.collapseFn?void 0:c.breakdownByAccessor},null===(i=p.activeData)||void 0===i?void 0:i[c.layerId]),w=Object(k.w)(e.paletteService,I,{min:null!==(r=T.min)&&void 0!==r?r:m.f,max:null!==(o=T.max)&&void 0!==o?o:m.e}),M=()=>x(!h);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.label",{defaultMessage:"Color mode"})},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.colorMode.label",{defaultMessage:"Color mode"}),"data-test-subj":"lnsMetric_color_mode_buttons",options:[{id:`${f}static`,label:u.i18n.translate("xpack.lens.metric.colorMode.static",{defaultMessage:"Static"}),"data-test-subj":"lnsMetric_color_mode_static"},{id:`${f}dynamic`,label:u.i18n.translate("xpack.lens.metric.colorMode.dynamic",{defaultMessage:"Dynamic"}),"data-test-subj":"lnsMetric_color_mode_dynamic"}],idSelected:`${f}${c.palette?"dynamic":"static"}`,onChange:e=>{const t="dynamic"===e.replace(f,"")?{palette:{...I,params:{...I.params,stops:w}}}:{palette:void 0};d({...c,color:void 0,...t})}})),!y&&Object(j.jsx)(Be,e),y&&Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsMetric_dynamicColoring_palette",palette:w.map((({color:e})=>e)),type:m.i,onClick:M})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsMetric_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:M,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(j.jsx)(k.n,{siblingRef:e.panelRef,isOpen:h,handleClose:M},Object(j.jsx)(m.b,{palettes:e.paletteService,activePalette:I,dataBounds:T,showRangeTypeSelector:O,setPalette:e=>{d({...c,palette:e})}}))))))}function Be({state:e,setState:t}){const a=u.i18n.translate("xpack.lens.metric.color",{defaultMessage:"Color"}),n=Object(s.useCallback)((a=>{t({...e,color:""===a?void 0:a})}),[t,e]),{inputValue:i,handleInputChange:l}=Object(k.F)({onChange:n,value:e.color||$e(e)},{allowFalsyValue:!0});return Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:a},Object(j.jsx)(b.EuiColorPicker,{fullWidth:!0,compressed:!0,isClearable:!1,onChange:e=>l(e),color:i,"aria-label":a,showAlpha:!1,swatches:Object(b.euiPaletteColorBlind)()}))}function Ve({state:e,datasource:t,setState:a,addLayer:n,removeLayer:i,accessor:s}){var r,o,c;const{euiTheme:d}=Object(b.useEuiTheme)();if(s!==e.metricAccessor)return null;const p=Object(b.htmlIdGenerator)()(),m=null==t?void 0:t.hasDefaultTimeField(),g=Boolean(e.metricAccessor&&(null==t||null===(r=t.getOperationForColumnId(e.metricAccessor))||void 0===r?void 0:r.hasReducedTimeRange)),f=Boolean(e.secondaryMetricAccessor&&(null==t||null===(o=t.getOperationForColumnId(e.secondaryMetricAccessor))||void 0===o?void 0:o.hasReducedTimeRange)),h=[],x=m&&!g&&!f;x||h.push(m?g?u.i18n.translate("xpack.lens.metric.supportingVis.metricHasReducedTimeRange",{defaultMessage:"Line visualizations cannot be used when a reduced time range is applied to the primary metric."}):f?u.i18n.translate("xpack.lens.metric.supportingVis.secondaryMetricHasReducedTimeRange",{defaultMessage:"Line visualizations cannot be used when a reduced time range is applied to the secondary metric."}):"":u.i18n.translate("xpack.lens.metric.supportingVis.needDefaultTimeField",{defaultMessage:"Line visualizations require use of a data view with a default time field."})),e.maxAccessor||h.push(u.i18n.translate("xpack.lens.metric.summportingVis.needMaxDimension",{defaultMessage:"Bar visualizations require a maximum value to be defined."}));const v=`${p}--`;return Object(j.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded lnsIndexPatternDimensionEditor--collapseNext"},Object(j.jsx)(b.EuiText,{size:"s",css:Object(j.css)("margin-bottom:",d.size.base,";","")},Object(j.jsx)("h4",null,u.i18n.translate("xpack.lens.metric.supportingVis.label",{defaultMessage:"Supporting visualization"}))),Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.supportingVis.type",{defaultMessage:"Type"}),helpText:h.map((e=>Object(j.jsx)("p",null,e)))},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.supportingVis.type",{defaultMessage:"Type"}),"data-test-subj":"lnsMetric_supporting_visualization_buttons",options:[{id:`${v}none`,label:u.i18n.translate("xpack.lens.metric.supportingVisualization.none",{defaultMessage:"None"}),"data-test-subj":"lnsMetric_supporting_visualization_none"},{id:`${v}trendline`,label:u.i18n.translate("xpack.lens.metric.supportingVisualization.trendline",{defaultMessage:"Line"}),isDisabled:!x,"data-test-subj":"lnsMetric_supporting_visualization_trendline"},{id:`${v}bar`,label:u.i18n.translate("xpack.lens.metric.supportingVisualization.bar",{defaultMessage:"Bar"}),isDisabled:!e.maxAccessor,"data-test-subj":"lnsMetric_supporting_visualization_bar"}],idSelected:`${v}${e.trendlineLayerId?"trendline":He(e)?"bar":"none"}`,onChange:t=>{switch(t.split("--")[1]){case"trendline":a({...e,showBar:!1}),n("metricTrendline");break;case"bar":a({...e,showBar:!0}),e.trendlineLayerId&&i(e.trendlineLayerId);break;case"none":a({...e,showBar:!1}),e.trendlineLayerId&&i(e.trendlineLayerId)}}})),He(e)&&Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.metric.progressDirectionLabel",{defaultMessage:"Bar orientation"}),fullWidth:!0,display:"columnCompressed"},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.progressDirectionLabel",{defaultMessage:"Bar orientation"}),"data-test-subj":"lnsMetric_progress_direction_buttons",name:"alignment",options:[{id:`${p}vertical`,label:u.i18n.translate("xpack.lens.metric.progressDirection.vertical",{defaultMessage:"Vertical"}),"data-test-subj":"lnsMetric_progress_bar_vertical"},{id:`${p}horizontal`,label:u.i18n.translate("xpack.lens.metric.progressDirection.horizontal",{defaultMessage:"Horizontal"}),"data-test-subj":"lnsMetric_progress_bar_horizontal"}],idSelected:`${p}${null!==(c=e.progressDirection)&&void 0!==c?c:"vertical"}`,onChange:t=>{const n=t.replace(p,"");a({...e,progressDirection:n})}}))))}function ze(e){const{state:t,setState:a}=e,n=Object(s.useCallback)((e=>a({...t,subtitle:e})),[a,t]),{inputValue:i,handleInputChange:l}=Object(k.F)({onChange:n,value:t.subtitle||""},{allowFalsyValue:!0}),r=Boolean(t.breakdownByAccessor);return Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},!r&&Object(j.jsx)(k.s,{title:u.i18n.translate("xpack.lens.metric.labels",{defaultMessage:"Labels"}),type:"labels",groupPosition:"none",buttonDataTestSubj:"lnsLabelsButton"},Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.metric.subtitleLabel",{defaultMessage:"Subtitle"}),fullWidth:!0,display:"columnCompressed"},Object(j.jsx)(b.EuiFieldText,{value:i,onChange:({target:{value:e}})=>l(e)}))))}var Ge=a(64);const qe=3,He=e=>Boolean(e.showBar&&e.maxAccessor),$e=e=>He(e)?Q.euiLightVars.euiColorPrimary:Q.euiThemeVars.euiColorLightestShade,We=new Set(["number"]),Ue=u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),Xe=u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),Ye=e=>{delete e.metricAccessor,delete e.palette,delete e.color},Ke=e=>{delete e.secondaryMetricAccessor,delete e.secondaryPrefix},Qe=e=>{delete e.maxAccessor,delete e.progressDirection,delete e.showBar},Ze=e=>{delete e.breakdownByAccessor,delete e.collapseFn,delete e.maxCols},Je=({paletteService:e,theme:t})=>({id:je,visualizationTypes:[{id:je,icon:x.x,label:Ue,groupLabel:Xe,showExperimentalBadge:!0,sortPriority:3}],getVisualizationTypeId:()=>je,clearLayer(e){const t={...e};return delete t.subtitle,Ye(t),Ke(t),Qe(t),Ze(t),t},getLayerIds:e=>e.trendlineLayerId?[e.layerId,e.trendlineLayerId]:[e.layerId],getDescription:()=>({icon:x.x,label:Ue}),getSuggestions:ye,initialize:(e,t,a)=>null!=t?t:{layerId:e(),layerType:ve.a.DATA,palette:a},triggers:[A.VIS_EVENT_TO_TRIGGER.filter],getConfiguration:e=>e.layerId===e.state.layerId?(e=>{const t=e=>!e.isBucketed&&We.has(e.dataType)&&!e.isStaticValue,a={disableExtraOptions:!0};return{groups:[{groupId:Oe,dataTestSubj:"lnsMetric_primaryMetricDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.primaryMetric.label",{defaultMessage:"Primary metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.primaryMetric.headingLabel",{defaultMessage:"Value"})},accessors:e.state.metricAccessor?[{columnId:e.state.metricAccessor,...(()=>{var t,a;const n=(null===(t=e.state.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[],i=!!e.state.color;return e.state.palette?{triggerIcon:"colorBy",palette:n.map((({color:e})=>e))}:i?{triggerIcon:"color",color:e.state.color}:{triggerIcon:"color",color:$e(e.state)}})()}]:[],supportsMoreColumns:!e.state.metricAccessor,filterOperations:t,isMetricDimension:!0,enableDimensionEditor:!0,enableFormatSelector:!0,formatSelectorOptions:a,requiredMinDimensionCount:1},{groupId:ke,dataTestSubj:"lnsMetric_secondaryMetricDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.metric.secondaryMetric",{defaultMessage:"Secondary metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.primaryMetric.headingLabel",{defaultMessage:"Value"})},accessors:e.state.secondaryMetricAccessor?[{columnId:e.state.secondaryMetricAccessor}]:[],supportsMoreColumns:!e.state.secondaryMetricAccessor,filterOperations:t,isMetricDimension:!0,enableDimensionEditor:!0,enableFormatSelector:!0,formatSelectorOptions:a},{groupId:"max",dataTestSubj:"lnsMetric_maxDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.metric.max",{defaultMessage:"Maximum value"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.primaryMetric.headingLabel",{defaultMessage:"Value"})},accessors:e.state.maxAccessor?[{columnId:e.state.maxAccessor}]:[],supportsMoreColumns:!e.state.maxAccessor,filterOperations:e=>!e.isBucketed&&We.has(e.dataType),enableDimensionEditor:!0,enableFormatSelector:!1,formatSelectorOptions:a,supportStaticValue:!0,prioritizedOperation:"max",groupTooltip:u.i18n.translate("xpack.lens.metric.maxTooltip",{defaultMessage:"If the maximum value is specified, the minimum value is fixed at zero."})},{groupId:Ie,dataTestSubj:"lnsMetric_breakdownByDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.metric.breakdownBy",{defaultMessage:"Break down by"}),accessors:e.state.breakdownByAccessor?[{columnId:e.state.breakdownByAccessor,triggerIcon:e.state.collapseFn?"aggregate":void 0}]:[],supportsMoreColumns:!e.state.breakdownByAccessor,filterOperations:e=>e.isBucketed,enableDimensionEditor:!0,enableFormatSelector:!0,formatSelectorOptions:a}]}})(e):(e=>({hidden:!0,groups:[{groupId:Te,groupLabel:u.i18n.translate("xpack.lens.primaryMetric.label",{defaultMessage:"Primary metric"}),accessors:e.state.trendlineMetricAccessor?[{columnId:e.state.trendlineMetricAccessor}]:[],supportsMoreColumns:!e.state.trendlineMetricAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:3},{groupId:we,groupLabel:u.i18n.translate("xpack.lens.metric.secondaryMetric",{defaultMessage:"Secondary metric"}),accessors:e.state.trendlineSecondaryMetricAccessor?[{columnId:e.state.trendlineSecondaryMetricAccessor}]:[],supportsMoreColumns:!e.state.trendlineSecondaryMetricAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:2},{groupId:Me,groupLabel:u.i18n.translate("xpack.lens.metric.timeField",{defaultMessage:"Time field"}),accessors:e.state.trendlineTimeAccessor?[{columnId:e.state.trendlineTimeAccessor}]:[],supportsMoreColumns:!e.state.trendlineTimeAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:1},{groupId:Ce,groupLabel:u.i18n.translate("xpack.lens.metric.breakdownBy",{defaultMessage:"Break down by"}),accessors:e.state.trendlineBreakdownByAccessor?[{columnId:e.state.trendlineBreakdownByAccessor}]:[],supportsMoreColumns:!e.state.trendlineBreakdownByAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:0}]}))(e),getLayerType:(e,t)=>(null==t?void 0:t.layerId)===e?t.layerType:(null==t?void 0:t.trendlineLayerId)===e?t.trendlineLayerType:void 0,getSupportedLayers:e=>[{type:ve.a.DATA,label:u.i18n.translate("xpack.lens.metric.addLayer",{defaultMessage:"Visualization"}),initialDimensions:e?[{groupId:"max",columnId:Object(Ge.a)(),staticValue:0}]:void 0,disabled:!0,canAddViaMenu:!0},{type:ve.a.METRIC_TRENDLINE,label:u.i18n.translate("xpack.lens.metric.layerType.trendLine",{defaultMessage:"Trendline"}),initialDimensions:[{groupId:Me,columnId:Object(Ge.a)(),autoTimeField:!0}],disabled:Boolean(null==e?void 0:e.trendlineLayerId),canAddViaMenu:!0}],appendLayer(e,t,a){if(a!==ve.a.METRIC_TRENDLINE)throw new Error(`Metric vis only supports layers of type ${ve.a.METRIC_TRENDLINE}!`);return{...e,trendlineLayerId:t,trendlineLayerType:a}},removeLayer:(e,t)=>({...e,...e.layerId===t&&{metricAccessor:void 0},trendlineLayerId:void 0,trendlineLayerType:void 0,trendlineMetricAccessor:void 0,trendlineTimeAccessor:void 0,trendlineBreakdownByAccessor:void 0}),getRemoveOperation:(e,t)=>t===e.trendlineLayerId?"remove":"clear",getLayersToLinkTo:(e,t)=>t===e.trendlineLayerId?[e.layerId]:[],getLinkedDimensions(e){if(!e.trendlineLayerId)return[];const t=[];return e.metricAccessor&&t.push({from:{columnId:e.metricAccessor,groupId:Oe,layerId:e.layerId},to:{columnId:e.trendlineMetricAccessor,groupId:Te,layerId:e.trendlineLayerId}}),e.secondaryMetricAccessor&&t.push({from:{columnId:e.secondaryMetricAccessor,groupId:ke,layerId:e.layerId},to:{columnId:e.trendlineSecondaryMetricAccessor,groupId:we,layerId:e.trendlineLayerId}}),e.breakdownByAccessor&&t.push({from:{columnId:e.breakdownByAccessor,groupId:Ie,layerId:e.layerId},to:{columnId:e.trendlineBreakdownByAccessor,groupId:Ce,layerId:e.trendlineLayerId}}),t},getLayersToRemoveOnIndexPatternChange:e=>e.trendlineLayerId?[e.trendlineLayerId]:[],toExpression:(t,a,n,i)=>((e,t,a,n={})=>{var i,s,l,r;if(!t.metricAccessor)return null;const o=a[t.layerId],u=n[t.layerId],c=t.breakdownByAccessor&&!t.collapseFn?null==o?void 0:o.getMaxPossibleNumValues(t.breakdownByAccessor):null,d=t.collapseFn?Object(L.buildExpressionFunction)("lens_collapse",(()=>{const e=[t.metricAccessor,t.secondaryMetricAccessor,t.maxAccessor].filter(Boolean),a=t.collapseFn,n=e.map((e=>{return e!==t.maxAccessor?a:Boolean(null==o||null===(n=o.getOperationForColumnId(t.maxAccessor))||void 0===n?void 0:n.isStaticValue)?"max":a;var n}));return{by:[],metric:e,fn:n}})()).toAst():void 0,p=((e,t)=>{const{trendlineLayerId:a,trendlineMetricAccessor:n,trendlineTimeAccessor:i}=e;if(!a||!n||!i)return;const s=t[a];if(!s)return;const l=Object(L.buildExpressionFunction)("metricTrendline",{metric:n,timeField:i,breakdownBy:e.trendlineBreakdownByAccessor&&!e.collapseFn?e.trendlineBreakdownByAccessor:void 0,inspectorTableId:a,table:[{...s,chain:[...s.chain,...e.collapseFn?[Object(L.buildExpressionFunction)("lens_collapse",{by:[i],metric:[n],fn:[e.collapseFn]}).toAst()]:[]]}]});return Object(L.buildExpression)([l]).toAst()})(t,n),g=Object(L.buildExpressionFunction)("metricVis",{metric:t.metricAccessor,secondaryMetric:t.secondaryMetricAccessor,secondaryPrefix:t.secondaryPrefix,max:He(t)?t.maxAccessor:void 0,breakdownBy:t.breakdownByAccessor&&!t.collapseFn?t.breakdownByAccessor:void 0,trendline:p?[p]:[],subtitle:null!==(i=t.subtitle)&&void 0!==i?i:void 0,progressDirection:t.progressDirection,color:t.color||$e(t),palette:null!==(s=t.palette)&&void 0!==s&&s.params?[e.get(m.a).toExpression((f=t.palette.params,{...f,colors:((null==f?void 0:f.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==f?void 0:f.name)?((null==f?void 0:f.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}))]:[],maxCols:null!==(l=t.maxCols)&&void 0!==l?l:qe,minTiles:null!=c?c:void 0,inspectorTableId:t.layerId});var f;return{type:"expression",chain:[...null!==(r=null==u?void 0:u.chain)&&void 0!==r?r:[],...d?[d]:[],g.toAst()]}})(e,t,a,i),setDimension({prevState:e,columnId:t,groupId:a}){const n={...e};switch(a){case Oe:n.metricAccessor=t;break;case ke:n.secondaryMetricAccessor=t;break;case"max":n.maxAccessor=t,e.trendlineLayerId||(n.showBar=!0);break;case Ie:n.breakdownByAccessor=t;break;case Me:n.trendlineTimeAccessor=t;break;case Te:n.trendlineMetricAccessor=t;break;case we:n.trendlineSecondaryMetricAccessor=t;break;case Ce:n.trendlineBreakdownByAccessor=t}return n},removeDimension({prevState:e,columnId:t}){const a={...e};return e.metricAccessor===t&&Ye(a),e.secondaryMetricAccessor===t&&Ke(a),e.maxAccessor===t&&Qe(a),e.breakdownByAccessor===t&&Ze(a),e.trendlineTimeAccessor===t&&delete a.trendlineTimeAccessor,e.trendlineMetricAccessor===t&&delete a.trendlineMetricAccessor,e.trendlineSecondaryMetricAccessor===t&&delete a.trendlineSecondaryMetricAccessor,e.trendlineBreakdownByAccessor===t&&delete a.trendlineBreakdownByAccessor,a},renderToolbar(e,a){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(ze,a))),e)},renderDimensionEditor(a,n){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(_e,i()({},n,{paletteService:e})))),a)},renderDimensionEditorAdditionalSection(e,a){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(Ve,a))),e)},getErrorMessages(e){},getDisplayOptions:()=>({noPanelTitle:!0,noPadding:!0}),getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(e){const t=[];return e.metricAccessor&&t.push({id:e.metricAccessor,name:u.i18n.translate("xpack.lens.primaryMetric.label",{defaultMessage:"Primary metric"})}),e.secondaryMetricAccessor&&t.push({id:e.secondaryMetricAccessor,name:u.i18n.translate("xpack.lens.metric.secondaryMetric",{defaultMessage:"Secondary metric"})}),e.maxAccessor&&t.push({id:e.maxAccessor,name:u.i18n.translate("xpack.lens.metric.max",{defaultMessage:"Maximum value"})}),e.breakdownByAccessor&&t.push({id:e.breakdownByAccessor,name:u.i18n.translate("xpack.lens.metric.breakdownBy",{defaultMessage:"Break down by"})}),{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:"metric",...this.getDescription(e),dimensions:t}]}}});class MetricVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getMetricVisualization:t}=await Promise.resolve().then(a.bind(null,493));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var et=a(29),tt=a(26),at=a(61);const nt=u.i18n.translate("xpack.lens.pie.groupLabel",{defaultMessage:"Proportion"}),it=[{value:at.b.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showCategoriesLabel",{defaultMessage:"Inside or outside"})},{value:at.b.INSIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.fitInsideOnlyLabel",{defaultMessage:"Inside only"})},{value:at.b.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],st=[{value:at.b.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showTreemapCategoriesLabel",{defaultMessage:"Show labels"})},{value:at.b.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],lt=[{value:at.j.HIDDEN,inputDisplay:u.i18n.translate("xpack.lens.pieChart.hiddenNumbersLabel",{defaultMessage:"Hide from chart"})},{value:at.j.PERCENT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showPercentValuesLabel",{defaultMessage:"Show percent"})},{value:at.j.VALUE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showFormatterValuesLabel",{defaultMessage:"Show value"})}],rt=[{id:"emptySizeRatioOption-small",value:at.f.SMALL,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.small",{defaultMessage:"Small"})},{id:"emptySizeRatioOption-medium",value:at.f.MEDIUM,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.medium",{defaultMessage:"Medium"})},{id:"emptySizeRatioOption-large",value:at.f.LARGE,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.large",{defaultMessage:"Large"})}],ot={donut:{icon:x.t,label:u.i18n.translate("xpack.lens.pie.donutLabel",{defaultMessage:"Donut"}),groupLabel:nt,maxBuckets:3,toolbarPopover:{categoryOptions:it,numberOptions:lt,emptySizeRatioOptions:rt},legend:{getShowLegendDefault:e=>e.length>1}},pie:{icon:x.A,label:u.i18n.translate("xpack.lens.pie.pielabel",{defaultMessage:"Pie"}),groupLabel:nt,maxBuckets:3,toolbarPopover:{categoryOptions:it,numberOptions:lt},legend:{getShowLegendDefault:e=>e.length>1}},treemap:{icon:x.B,label:u.i18n.translate("xpack.lens.pie.treemaplabel",{defaultMessage:"Treemap"}),groupLabel:nt,maxBuckets:2,toolbarPopover:{categoryOptions:st,numberOptions:lt},legend:{getShowLegendDefault:()=>!1}},mosaic:{icon:x.z,label:u.i18n.translate("xpack.lens.pie.mosaiclabel",{defaultMessage:"Mosaic"}),groupLabel:nt,maxBuckets:2,isExperimental:!0,toolbarPopover:{categoryOptions:[],numberOptions:lt},legend:{getShowLegendDefault:()=>!1}},waffle:{icon:x.D,label:u.i18n.translate("xpack.lens.pie.wafflelabel",{defaultMessage:"Waffle"}),groupLabel:nt,maxBuckets:1,isExperimental:!0,toolbarPopover:{isDisabled:!0,categoryOptions:[],numberOptions:[]},legend:{flat:!0,showValues:!0,hideNestedLegendSwitch:!0,getShowLegendDefault:()=>!0}}},ut=(e,t)=>{var a,n,i,s,l;return"showValues"in(null===(a=ot[t])||void 0===a?void 0:a.legend)&&(null===(n=null!==(i=e.showValuesInLegend)&&void 0!==i?i:null===(s=ot[t])||void 0===s||null===(l=s.legend)||void 0===l?void 0:l.showValues)||void 0===n||n)},ct=(e,t,a)=>{const n=e.rows.reduce(((e,a)=>Number(a[t])+e),0);return e.rows.some((e=>e[t]/n*100<a))};function dt(e,t,a){return 0===a?{...e,...t}:{...t,...e}}function pt(e,t){const a={truncateText:!0};return e?function(e){return"layerId"in e}(e)?Object.values((null===(n=t[e.layerId])||void 0===n?void 0:n.getVisualDefaults())||{}).reduce(dt,a):e.layers.flatMap((({layerId:e})=>{var a;return Object.values((null===(a=t[e])||void 0===a?void 0:a.getVisualDefaults())||{})})).reduce(dt,a):a;var n}const mt=(e,t)=>{const a={};return e.forEach((e=>{const n=null==t?void 0:t.getOperationForColumnId(e);null!=n&&n.label&&(a[e]=n.label)})),a},gt=(e,t,a="primaryGroups")=>{var n;const i=null==e?void 0:e.getTableSpec().map((({columnId:e})=>e)).filter((e=>{var n;return null===(n=t[a])||void 0===n?void 0:n.includes(e)}));return Array.from(new Set(null==i?void 0:i.concat(null!==(n=t[a])&&void 0!==n?n:[])))},ft=e=>Object(tt.buildExpression)([Object(tt.buildExpressionFunction)("visdimension",{accessor:e})]).toAst(),bt=(e,t,a)=>{var n;const i=!t.isPreview&&a.categoryDisplay!==at.b.HIDE,s=a.categoryDisplay!==at.b.HIDE?a.categoryDisplay:[],l=a.numberDisplay!==at.j.HIDDEN,r=a.numberDisplay!==at.j.HIDDEN?a.numberDisplay:[],o=null!==(n=a.percentDecimals)&&void 0!==n?n:2,u=Object(tt.buildExpressionFunction)("partitionLabels",{show:i,position:s,values:l,valuesFormat:r,percentDecimals:o});return[Object(tt.buildExpression)([u]).toAst()]},ht=(...e)=>{const[t]=bt(...e),[a]=t.chain;return[{...t,chain:[{...a,percentDecimals:2}]}]},xt=(e,t)=>t?[Object(tt.buildExpression)([Object(tt.buildExpressionFunction)("theme",{variable:"palette",default:e.get(t.name).toExpression(t.params)})]).toAst()]:[e.get("default").toExpression()],vt=(e,t,a,n,i,s)=>{var l,r;return{labels:bt(0,t,n),buckets:a.filter((({columnId:e})=>!Rt(e,n))).map((({columnId:e})=>e)).map(ft),metrics:(n.allowMultipleMetrics?n.metrics:[n.metrics[0]]).map(ft),metricsToLabels:JSON.stringify(mt(n.metrics,i[n.layerId])),legendDisplay:t.isPreview?at.i.HIDE:n.legendDisplay,legendPosition:n.legendPosition||et.Position.Right,maxLegendLines:null!==(l=n.legendMaxLines)&&void 0!==l?l:1,legendSize:n.legendSize,nestedLegend:!!n.nestedLegend,truncateLegend:null!==(r=n.truncateLegend)&&void 0!==r?r:pt(e,i).truncateText,palette:xt(s,e.palette),addTooltip:!0}};function yt(e,t,a,n={isPreview:!1},i){const s=e.layers[0],l=t[s.layerId],r=Array.from(new Set([gt(l,s,"primaryGroups"),s.secondaryGroups?gt(l,s,"secondaryGroups"):[]].flat())),o=r.map((e=>({columnId:e,operation:null==l?void 0:l.getOperationForColumnId(e)}))).filter((e=>!!e.operation));if(!s.metrics.length)return null;const u=((e,...t)=>({[at.k.PIE]:()=>((...e)=>Object(tt.buildExpression)([Object(tt.buildExpressionFunction)("pieVis",{...vt(...e),respectSourceOrder:!1,startFromSecondLargestSlice:!0,isDonut:!1})]).toAst())(e,...t),[at.k.DONUT]:()=>((...e)=>{var t;const[,,,a]=e;return Object(tt.buildExpression)([Object(tt.buildExpressionFunction)("pieVis",{...vt(...e),respectSourceOrder:!1,isDonut:!0,startFromSecondLargestSlice:!0,emptySizeRatio:null!==(t=a.emptySizeRatio)&&void 0!==t?t:at.f.SMALL})]).toAst()})(e,...t),[at.k.TREEMAP]:()=>((...e)=>{const[,,,t]=e;return Object(tt.buildExpression)([Object(tt.buildExpressionFunction)("treemapVis",{...vt(...e),nestedLegend:!!t.nestedLegend})]).toAst()})(e,...t),[at.k.MOSAIC]:()=>((...e)=>{const{metrics:t,...a}=vt(...e);return Object(tt.buildExpression)([Object(tt.buildExpressionFunction)("mosaicVis",{...{...a,metricsToLabels:void 0},metric:t,buckets:e[2].filter((({columnId:t})=>!Rt(t,e[3]))).reverse().map((e=>e.columnId)).map(ft)})]).toAst()})(e,...t),[at.k.WAFFLE]:()=>((...e)=>{const{buckets:t,nestedLegend:a,...n}=vt(...e),[i,s,,l]=e;return Object(tt.buildExpression)([Object(tt.buildExpressionFunction)("waffleVis",{...n,bucket:t,labels:ht(i,s,l),showValuesInLegend:ut(l,i.shape)})]).toAst()})(e,...t)}[e.shape]()))(e,n,o,s,t,a),c=i[s.layerId];return{type:"expression",chain:[...c?c.chain:[],...r.filter((e=>{var t;return null===(t=s.collapseFns)||void 0===t?void 0:t[e]})).map((e=>Object(tt.buildExpressionFunction)("lens_collapse",{by:r.filter((t=>t!==e)),metric:s.metrics,fn:[s.collapseFns[e]]}).toAst())),...u?u.chain:[]]}}var jt=a(21),Ot=a(18);function kt(e){return e.some((e=>"interval"===e.operation.scale))}function It(e){const t=[at.k.TREEMAP,at.k.WAFFLE,at.k.MOSAIC];return!!e&&t.includes(e)}const Tt=Math.max(...Object.values(ot).map((({maxBuckets:e})=>e)));function wt({table:e,state:t,keptLayerIds:a,mainPalette:n,subVisualizationId:i}){if(function({table:e,keptLayerIds:t,state:a}){return t.length>1||t.length&&e.layerId!==t[0]||"reorder"===e.changeType||e.columns.some((e=>e.operation.isStaticValue))}({table:e,state:t,keptLayerIds:a}))return[];const s=Boolean(t),[l,r]=Object(jt.partition)(e.columns.filter((e=>e.operation.isBucketed||"number"===e.operation.dataType)),(e=>e.operation.isBucketed));if(0===l.length&&0===r.length)return[];if(r.length>1&&!s||l.length>Tt)return[];const o=0===r.length||0===l.length;if(o&&t&&!i)return[];const c=r.map((({columnId:e})=>e)),d=[],p=(null==t||!t.shape||(m=t.shape,!["donut","pie","treemap","mosaic","waffle"].includes(m)))&&kt(e.columns);var m;if(l.length<=ot.pie.maxBuckets&&!It(i)){const a=function(e,t){var a;if(t)return t;let n;return 1===e.length||t||(n=at.k.PIE),null!==(a=n)&&void 0!==a?a:at.k.DONUT}(l,i),s={title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"As {chartName}",values:{chartName:ot[a].label},description:"chartName is already translated"}),score:t&&!It(t.shape)?.6:.4,state:{shape:a,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,layerType:Ot.layerTypes.DATA}:{layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,numberDisplay:at.j.PERCENT,categoryDisplay:at.b.DEFAULT,legendDisplay:at.i.DEFAULT,nestedLegend:!1,layerType:Ot.layerTypes.DATA}]},previewIcon:"bullseye",hide:"reduced"===e.changeType||kt(l)||t&&!It(t.shape)};d.push(s),d.push({...s,title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"As {chartName}",values:{chartName:ot[a===at.k.PIE?at.k.DONUT:at.k.PIE].label},description:"chartName is already translated"}),score:.1,state:{...s.state,shape:a===at.k.PIE?at.k.DONUT:at.k.PIE},hide:!0})}return l.length<=ot.treemap.maxBuckets&&(!i||i===at.k.TREEMAP)&&d.push({title:u.i18n.translate("xpack.lens.pie.treemapSuggestionLabel",{defaultMessage:"As Treemap"}),score:(null==t?void 0:t.shape)===at.k.TREEMAP?.7:.5,state:{shape:at.k.TREEMAP,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,categoryDisplay:t.layers[0].categoryDisplay===at.b.INSIDE?at.b.DEFAULT:t.layers[0].categoryDisplay,layerType:Ot.layerTypes.DATA}:{layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,numberDisplay:at.j.PERCENT,categoryDisplay:at.b.DEFAULT,legendDisplay:at.i.DEFAULT,nestedLegend:!1,layerType:Ot.layerTypes.DATA}]},previewIcon:"bullseye",hide:"reduced"===e.changeType||!t||kt(l)||t&&t.shape===at.k.TREEMAP}),l.length<=ot.mosaic.maxBuckets&&(!i||i===at.k.MOSAIC)&&d.push({title:u.i18n.translate("xpack.lens.pie.mosaicSuggestionLabel",{defaultMessage:"As Mosaic"}),score:(null==t?void 0:t.shape)===at.k.MOSAIC?.7:.5,state:{shape:at.k.MOSAIC,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l[0]?[l[0].columnId]:[],secondaryGroups:l[1]?[l[1].columnId]:[],metrics:c,categoryDisplay:at.b.DEFAULT,layerType:Ot.layerTypes.DATA,allowMultipleMetrics:!1}:{layerId:e.layerId,primaryGroups:l[0]?[l[0].columnId]:[],secondaryGroups:l[1]?[l[1].columnId]:[],metrics:c,numberDisplay:at.j.PERCENT,categoryDisplay:at.b.DEFAULT,legendDisplay:at.i.DEFAULT,nestedLegend:!1,layerType:Ot.layerTypes.DATA,allowMultipleMetrics:!1}]},previewIcon:"bullseye",hide:!0}),l.length<=ot.waffle.maxBuckets&&(!i||i===at.k.WAFFLE)&&d.push({title:u.i18n.translate("xpack.lens.pie.waffleSuggestionLabel",{defaultMessage:"As Waffle"}),score:(null==t?void 0:t.shape)===at.k.WAFFLE?.7:.5,state:{shape:at.k.WAFFLE,palette:n||(null==t?void 0:t.palette),layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,secondaryGroups:[],categoryDisplay:at.b.DEFAULT,layerType:Ot.layerTypes.DATA}:{layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,numberDisplay:at.j.PERCENT,categoryDisplay:at.b.DEFAULT,legendDisplay:at.i.DEFAULT,nestedLegend:!1,layerType:Ot.layerTypes.DATA}]},previewIcon:"bullseye",hide:!0}),[...d].map((e=>({...e,score:p?0:e.score+.05*l.length+.01*c.length}))).sort(((e,t)=>t.score-e.score)).map((e=>({...e,hide:p||o||e.hide})))}a(224);const Mt=[{id:"pieLegendDisplay-default",value:at.i.DEFAULT,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"pieLegendDisplay-show",value:at.i.SHOW,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"pieLegendDisplay-hide",value:at.i.HIDE,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.hide",{defaultMessage:"Hide"})}],Ct=u.i18n.translate("xpack.lens.pieChart.emptySizeRatioLabel",{defaultMessage:"Inner area size"});function St(e){var t,a,n,i,l,r,o;const{state:c,setState:d,frame:p}=e,m=c.layers[0],{categoryOptions:g,numberOptions:f,emptySizeRatioOptions:h,isDisabled:x}=ot[c.shape].toolbarPopover,v=m.legendSize,[y]=Object(s.useState)((()=>v===A.LegendSize.AUTO)),O=Object(s.useCallback)((e=>{d({...c,layers:[{...m,...e}]})}),[m,c,d]),I=Object(s.useCallback)((e=>O({categoryDisplay:e})),[O]),T=Object(s.useCallback)((e=>O({numberDisplay:e})),[O]),w=Object(s.useCallback)((e=>{O({percentDecimals:e})}),[O]),M=Object(s.useCallback)((e=>{O({legendDisplay:Mt.find((({id:t})=>t===e)).value})}),[O]),C=Object(s.useCallback)((e=>O({legendPosition:e})),[O]),S=Object(s.useCallback)((e=>O({nestedLegend:!m.nestedLegend})),[m,O]),F=Object(s.useCallback)((()=>{var e;const t=null===(e=m.truncateLegend)||void 0===e||e;O({truncateLegend:!t})}),[m,O]),E=Object(s.useCallback)((e=>O({legendMaxLines:e})),[O]),P=Object(s.useCallback)((e=>O({legendSize:e})),[O]),_=Object(s.useCallback)((()=>{O({showValuesInLegend:!ut(m,c.shape)})}),[m,c.shape,O]),L=Object(s.useCallback)((e=>{var t;const a=null==h||null===(t=h.find((({id:t})=>t===e)))||void 0===t?void 0:t.value;O({emptySizeRatio:a})}),[h,O]);if(!m)return null;const D=pt(c,p.datasourceLayers).truncateText;return Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(j.jsx)(k.s,{title:u.i18n.translate("xpack.lens.pieChart.valuesLabel",{defaultMessage:"Labels"}),isDisabled:Boolean(x),type:"labels",groupPosition:"left",buttonDataTestSubj:"lnsLabelsButton"},g.length?Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.labelPositionLabel",{defaultMessage:"Position"}),fullWidth:!0,display:"columnCompressed"},Object(j.jsx)(b.EuiSuperSelect,{compressed:!0,valueOfSelected:m.categoryDisplay,options:g,onChange:I})):null,f.length&&"hide"!==m.categoryDisplay?Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.numberLabels",{defaultMessage:"Values"}),fullWidth:!0,display:"columnCompressed"},Object(j.jsx)(b.EuiSuperSelect,{compressed:!0,valueOfSelected:m.numberDisplay,options:f,onChange:T})):null,f.length+g.length?Object(j.jsx)(b.EuiHorizontalRule,{margin:"s"}):null,Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.percentDecimalsLabel",{defaultMessage:"Maximum decimal places for percent"}),fullWidth:!0,display:"rowCompressed"},Object(j.jsx)(Ft,{value:null!==(t=m.percentDecimals)&&void 0!==t?t:2,setValue:w}))),null!=h&&h.length?Object(j.jsx)(k.s,{title:u.i18n.translate("xpack.lens.pieChart.visualOptionsLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"center",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(j.jsx)(b.EuiFormRow,{label:Ct,display:"columnCompressed",fullWidth:!0},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,name:"emptySizeRatio",buttonSize:"compressed",legend:Ct,options:h,idSelected:null!==(a=null===(n=h.find((({value:e})=>e===m.emptySizeRatio)))||void 0===n?void 0:n.id)&&void 0!==a?a:"emptySizeRatioOption-small",onChange:L,"data-test-subj":"lnsEmptySizeRatioButtonGroup"}))):null,Object(j.jsx)(k.j,{legendOptions:Mt,mode:m.legendDisplay,onDisplayChange:M,valueInLegend:ut(m,c.shape),renderValueInLegendSwitch:null!==(i="showValues"in(null===(l=ot[c.shape])||void 0===l?void 0:l.legend))&&void 0!==i&&i,onValueInLegendChange:_,position:m.legendPosition,onPositionChange:C,renderNestedLegendSwitch:!(null!==(r=ot[c.shape])&&void 0!==r&&r.legend.hideNestedLegendSwitch),nestedLegend:Boolean(m.nestedLegend),onNestedLegendChange:S,shouldTruncate:null!==(o=m.truncateLegend)&&void 0!==o?o:D,onTruncateLegendChange:F,maxLines:null==m?void 0:m.legendMaxLines,onMaxLinesChange:E,legendSize:v,onLegendSizeChange:P,showAutoLegendSizeOption:y}))}const Ft=({value:e,setValue:t})=>{const{inputValue:a,handleInputChange:n}=Object(k.F)({value:e,onChange:t},{allowFalsyValue:!0});return Object(j.jsx)(b.EuiRange,{"data-test-subj":"indexPattern-dimension-formatDecimals",value:a,min:0,max:10,showInput:!0,compressed:!0,onChange:e=>{n(Number(e.currentTarget.value))}})};function Et(e){const t=e.state.layers.find((t=>t.layerId===e.layerId));if(!t)return null;const a=t.primaryGroups.find((e=>!Rt(e,t)));return Object(j.jsx)(l.a.Fragment,null,e.accessor===a&&Object(j.jsx)(k.o,{palettes:e.paletteService,activePalette:e.state.palette,setPalette:t=>{e.setState({...e.state,palette:t})}}))}function Pt(e){var t,a;const n=e.state.layers.find((t=>t.layerId===e.layerId));return n?Object(j.jsx)(l.a.Fragment,null,[...n.primaryGroups,...null!==(t=n.secondaryGroups)&&void 0!==t?t:[]].includes(e.accessor)&&Object(j.jsx)(R,{value:(null==n||null===(a=n.collapseFns)||void 0===a?void 0:a[e.accessor])||"",onChange:t=>{e.setState({...e.state,layers:e.state.layers.map((a=>a.layerId!==e.layerId?a:{...a,collapseFns:{...a.collapseFns,[e.accessor]:t}}))})}})):null}function At(e){if(e.state.shape===at.k.MOSAIC)return null;const t=e.state.layers.find((t=>t.layerId===e.layerId));return t?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,null,Object(j.jsx)(b.EuiSwitch,{label:u.i18n.translate("xpack.lens.pieChart.multipleMetrics",{defaultMessage:"Multiple metrics"}),compressed:!0,checked:Boolean(t.allowMultipleMetrics),onChange:()=>{e.setState({...e.state,layers:e.state.layers.map((t=>t.layerId!==e.layerId?t:{...t,allowMultipleMetrics:!t.allowMultipleMetrics}))})}}))):null}const _t=u.i18n.translate("xpack.lens.pie.groupMetricLabelSingular",{defaultMessage:"Metric"});function Lt(e){return{layerId:e,primaryGroups:[],secondaryGroups:void 0,metrics:[],numberDisplay:at.j.PERCENT,categoryDisplay:at.b.DEFAULT,legendDisplay:at.i.DEFAULT,nestedLegend:!1,layerType:_.LayerTypes.DATA}}const Dt=e=>e.isBucketed,Nt=e=>!e.isBucketed&&"number"===e.dataType&&!e.isStaticValue,Rt=(e,t)=>{var a;return Boolean(null===(a=t.collapseFns)||void 0===a?void 0:a[e])},Bt=(e,t,a,n)=>{const i=t.primaryGroups.find((e=>!Rt(e,t)));e.forEach((e=>{i===e.columnId&&(e.triggerIcon="colorBy",e.palette=n.get((null==a?void 0:a.name)||"default").getCategoricalColors(10,null==a?void 0:a.params))}))},Vt=({paletteService:e,kibanaTheme:t})=>({id:"lnsPie",visualizationTypes:Object.entries(ot).map((([e,t])=>({id:e,icon:t.icon,label:t.label,groupLabel:t.groupLabel,showExperimentalBadge:t.isExperimental}))),getVisualizationTypeId:e=>e.shape,getLayerIds:e=>e.layers.map((e=>e.layerId)),clearLayer:e=>({shape:e.shape,layers:e.layers.map((e=>Lt(e.layerId)))}),getDescription(e){var t;return null!==(t=ot[e.shape])&&void 0!==t?t:ot.pie},switchVisualizationType:(e,t)=>({...t,shape:e}),triggers:[A.VIS_EVENT_TO_TRIGGER.filter],initialize:(e,t,a)=>t||{shape:at.k.DONUT,layers:[Lt(e())],palette:a},getMainPalette:e=>e?e.palette:void 0,getSuggestions:wt,getConfiguration({state:t,frame:a,layerId:n}){const i=t.layers.find((e=>e.layerId===n));if(!i)return{groups:[]};const s=a.datasourceLayers[i.layerId];return{groups:[(()=>{const a=gt(s,i).map((e=>({columnId:e,triggerIcon:Rt(e,i)?"aggregate":void 0})));a.length&&Bt(a,i,t.palette,e);const n={groupId:"primaryGroups",accessors:a,enableDimensionEditor:!0,filterOperations:Dt},l=i.metrics.length>1&&"mosaic"!==t.shape?1:0,r=a.reduce(((e,{columnId:t})=>e+(Rt(t,i)?0:1)),0)+l,o=i.metrics.length>1&&i.allowMultipleMetrics?{label:u.i18n.translate("xpack.lens.pie.multiMetricAccessorLabel",{defaultMessage:"{number} metrics",values:{number:i.metrics.length}})}:void 0;switch(t.shape){case"donut":case"pie":return{...n,groupLabel:u.i18n.translate("xpack.lens.pie.sliceGroupLabel",{defaultMessage:"Slice by"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.sliceDimensionGroupLabel",{defaultMessage:"Slice"}),fakeFinalAccessor:o,supportsMoreColumns:r<ot.pie.maxBuckets,dimensionsTooMany:r-ot.pie.maxBuckets,dataTestSubj:"lnsPie_sliceByDimensionPanel",hideGrouping:!0};case"mosaic":return{...n,groupLabel:u.i18n.translate("xpack.lens.pie.verticalAxisLabel",{defaultMessage:"Vertical axis"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.verticalAxisDimensionLabel",{defaultMessage:"Vertical axis"}),supportsMoreColumns:0===r,dimensionsTooMany:r-1,dataTestSubj:"lnsPie_verticalAxisDimensionPanel"};default:return{...n,groupLabel:u.i18n.translate("xpack.lens.pie.treemapGroupLabel",{defaultMessage:"Group by"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.treemapDimensionGroupLabel",{defaultMessage:"Group"}),fakeFinalAccessor:o,supportsMoreColumns:r<ot[t.shape].maxBuckets,dimensionsTooMany:r-ot[t.shape].maxBuckets,dataTestSubj:"lnsPie_groupByDimensionPanel",hideGrouping:"treemap"===t.shape}}})(),(()=>{const e=gt(s,i,"secondaryGroups").map((e=>({columnId:e,triggerIcon:Rt(e,i)?"aggregate":void 0}))),a={required:!0,groupId:"secondaryGroups",accessors:e,enableDimensionEditor:!0,filterOperations:Dt},n=e.reduce(((e,{columnId:t})=>e+(Rt(t,i)?0:1)),0);if("mosaic"===t.shape)return{...a,groupLabel:u.i18n.translate("xpack.lens.pie.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.horizontalAxisDimensionLabel",{defaultMessage:"Horizontal axis"}),supportsMoreColumns:0===n,dimensionsTooMany:n-1,dataTestSubj:"lnsPie_horizontalAxisDimensionPanel"}})(),(()=>{const a=i.metrics.map((e=>({columnId:e})));Bt(a,i,t.palette,e);const n=i.allowMultipleMetrics?u.i18n.translate("xpack.lens.pie.groupMetricLabel",{defaultMessage:"Metrics"}):_t;return{groupId:"metric",groupLabel:n,dimensionEditorGroupLabel:n,paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.pie.headingLabel",{defaultMessage:"Value"})},accessors:a,supportsMoreColumns:0===i.metrics.length||Boolean(i.allowMultipleMetrics),filterOperations:Nt,requiredMinDimensionCount:1,dimensionsTooMany:i.allowMultipleMetrics?0:i.metrics.length-1,dataTestSubj:"lnsPie_sizeByDimensionPanel",enableDimensionEditor:!0}})()].filter(Boolean)}},setDimension:({prevState:e,layerId:t,columnId:a,groupId:n})=>({...e,layers:e.layers.map((e=>{return e.layerId!==t?e:"primaryGroups"===n?{...e,primaryGroups:[...e.primaryGroups.filter((e=>e!==a)),a]}:"secondaryGroups"===n?{...e,secondaryGroups:[...(null===(i=e.secondaryGroups)||void 0===i?void 0:i.filter((e=>e!==a)))||[],a]}:{...e,metrics:[...e.metrics.filter((e=>e!==a)),a]};var i}))}),removeDimension({prevState:e,layerId:t,columnId:a}){var n,i,s;const l={...e},r=e.layers.find((e=>e.layerId===t));if(!r)return e;r.primaryGroups.includes(a)&&1===r.primaryGroups.length&&r.allowMultipleMetrics&&r.metrics.length&&delete l.palette;let o={...r};if(null!==(n=r.collapseFns)&&void 0!==n&&n[a]){const e={...r.collapseFns};delete e[a],o.collapseFns=e}return o={...o,primaryGroups:o.primaryGroups.filter((e=>e!==a)),secondaryGroups:null!==(i=null===(s=o.secondaryGroups)||void 0===s?void 0:s.filter((e=>e!==a)))&&void 0!==i?i:void 0,metrics:o.metrics.filter((e=>e!==a))},{...l,layers:l.layers.map((e=>e.layerId===t?o:e))}},renderDimensionEditor(a,n){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(Et,i()({},n,{paletteService:e})))),a)},renderDimensionEditorDataExtra(a,n){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(Pt,i()({},n,{paletteService:e})))),a)},getSupportedLayers:()=>[{type:_.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.pie.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},toExpression:(t,a,n,i)=>function(e,t,a,n={},i={}){return yt(e,t,a,{...n,isPreview:!1},i)}(t,a,e,n,i),toPreviewExpression:(t,a,n)=>function(e,t,a,n={}){return yt(e,t,a,{isPreview:!0},n)}(t,a,e,n),renderToolbar(e,a){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(St,a))),e)},renderLayerSettings(e,a){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(At,a))),e)},getWarningMessages(e,t){if(0===(null==e?void 0:e.layers.length)||!t.activeData)return;const a=[];for(const s of e.layers){var n,i;const{layerId:l,metrics:r}=s,o=null===(n=t.activeData[l])||void 0===n?void 0:n.rows,u=null===(i=t.activeData[l])||void 0===i?void 0:i.columns.find((({meta:e})=>"number"===(null==e?void 0:e.type)));if(!o||!r.length)break;u&&"waffle"===e.shape&&s.primaryGroups.length&&ct(t.activeData[l],u.id,1)&&a.push(Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.pie.smallValuesWarningMessage",defaultMessage:"Waffle charts are unable to effectively display small field values. To display all field values, use the Data table or Treemap."}));const d=r.map((e=>{if(o.some((t=>Array.isArray(t[e]))))return e})).filter(Boolean);if(d.length){const e=d.map((e=>{var a,n;return(null===(a=t.datasourceLayers[l])||void 0===a||null===(n=a.getOperationForColumnId(e))||void 0===n?void 0:n.label)||e}));a.push(Object(j.jsx)(c.FormattedMessage,{key:e.join(","),id:"xpack.lens.pie.arrayValues",defaultMessage:"The following dimensions contain array values: {label}. Your visualization may not render as expected.",values:{label:Object(j.jsx)("strong",null,e.join(", "))}}))}}return a},getSuggestionFromConvertToLensContext(e){const t=e.context;if(!function(e){return"lnsPie"===e.type}(t))return;if(!e.suggestions.length)return;const a=e.suggestions.find((e=>e.visualizationState.shape===t.configuration.shape));return a?{...a,visualizationState:{...a.visualizationState,...t.configuration}}:void 0},getErrorMessages:e=>e.layers.map((t=>{var a;return Array.from(new Set([...t.primaryGroups,...null!==(a=t.secondaryGroups)&&void 0!==a?a:[]])).filter((e=>!Rt(e,t))).length+(t.metrics.length>1?1:0)>ot[e.shape].maxBuckets})).some(Boolean)?[{shortMessage:u.i18n.translate("xpack.lens.pie.tooManyDimensions",{defaultMessage:"Your visualization has too many dimensions."}),longMessage:Object(j.jsx)("span",null,u.i18n.translate("xpack.lens.pie.tooManyDimensionsLong",{defaultMessage:"Your visualization has too many dimensions. Please follow the instructions in the layer panel."}),Object(j.jsx)(b.EuiSpacer,{size:"s"}),u.i18n.translate("xpack.lens.pie.collapsedDimensionsDontCount",{defaultMessage:"(Collapsed dimensions don't count toward this limit.)"}))}]:[],getVisualizationInfo(e){const t=e.layers[0],a=[];if(t.metrics.forEach((e=>{a.push({id:e,name:_t})})),"mosaic"===e.shape&&t.secondaryGroups&&t.secondaryGroups.length&&t.secondaryGroups.forEach((e=>{a.push({name:u.i18n.translate("xpack.lens.pie.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),id:e})})),t.primaryGroups&&t.primaryGroups.length){let n=u.i18n.translate("xpack.lens.pie.treemapGroupLabel",{defaultMessage:"Group by"});"mosaic"===e.shape&&(n=u.i18n.translate("xpack.lens.pie.verticalAxisLabel",{defaultMessage:"Vertical axis"})),"donut"!==e.shape&&"pie"!==e.shape||(n=u.i18n.translate("xpack.lens.pie.sliceGroupLabel",{defaultMessage:"Slice by"})),t.primaryGroups.forEach((e=>{a.push({name:n,id:e})}))}return{layers:[{layerId:t.layerId,layerType:t.layerType,chartType:e.shape,...this.getDescription(e),dimensions:a}]}}});class PieVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getPieVisualization:t}=await Promise.resolve().then(a.bind(null,493));return t({paletteService:await n.palettes.getPalettes(),kibanaTheme:e.theme})}))}}var zt=a(76),Gt=a(59),qt=a(32);function Ht(e,{isHorizontal:t}){const a=u.i18n.translate("xpack.lens.xyChart.verticalAxisLabel",{defaultMessage:"Vertical axis"}),n=u.i18n.translate("xpack.lens.xyChart.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});if("x"===e)return t?a:n;if("y"===e)return t?n:a;const i=u.i18n.translate("xpack.lens.xyChart.verticalLeftAxisLabel",{defaultMessage:"Vertical left axis"}),s=u.i18n.translate("xpack.lens.xyChart.verticalRightAxisLabel",{defaultMessage:"Vertical right axis"}),l=u.i18n.translate("xpack.lens.xyChart.horizontalLeftAxisLabel",{defaultMessage:"Horizontal top axis"}),r=u.i18n.translate("xpack.lens.xyChart.horizontalRightAxisLabel",{defaultMessage:"Horizontal bottom axis"});return"yLeft"===e?t?r:i:t?l:s}function $t(e,t,a){return n=>{const i=a[n.layerId];if(!n.xAccessor)return!1;const s=null==i?void 0:i.getOperationForColumnId(n.xAccessor);return Boolean(s&&(!t||s.dataType===t)&&s.scale===e)}}const Wt=e=>e.layerType===Ot.layerTypes.DATA||!e.layerType,Ut=e=>(e||[]).filter((e=>Wt(e))),Xt=e=>e.layerType===Ot.layerTypes.REFERENCELINE,Yt=e=>(e||[]).filter((e=>Xt(e))),Kt=e=>e.layerType===Ot.layerTypes.ANNOTATIONS,Qt=e=>(e||[]).filter((e=>Kt(e)));function Zt(e){var t;if(!e.layers.length)return null!==(t=zt.visualizationTypes.find((t=>t.id===e.preferredSeriesType)))&&void 0!==t?t:zt.visualizationTypes[0];const a=Ut(null==e?void 0:e.layers),n=zt.visualizationTypes.find((e=>e.id===(null==a?void 0:a[0].seriesType))),i=Object(jt.uniq)(a.map((e=>e.seriesType)));return n&&1===i.length?n:"mixed"}function Jt(e){if(!e)return{icon:ea,label:u.i18n.translate("xpack.lens.xyVisualization.xyLabel",{defaultMessage:"XY"})};const t=Zt(e);return"mixed"===t&&pa(e.layers)?{icon:x.m,label:u.i18n.translate("xpack.lens.xyVisualization.mixedBarHorizontalLabel",{defaultMessage:"Mixed bar horizontal"})}:"mixed"===t?{icon:x.y,label:u.i18n.translate("xpack.lens.xyVisualization.mixedLabel",{defaultMessage:"Mixed XY"})}:{icon:t.icon||ea,label:t.fullLabel||t.label}}const ea=x.r,ta="bar_stacked",aa={type:Ot.layerTypes.DATA,label:u.i18n.translate("xpack.lens.xyChart.addDataLayerLabel",{defaultMessage:"Visualization"}),icon:x.y};function na(e,t,a){const n=t.map((e=>e+1)).join(", ");switch(e){case"Break down":return{shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitShort",{defaultMessage:"Missing {axis}.",values:{axis:"Break down by axis"}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:"Break down by axis"}})};case"Y":return{shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYShort",{defaultMessage:"Missing {axis}.",values:{axis:Ht("y",{isHorizontal:a})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:Ht("y",{isHorizontal:a})}})}}return{shortMessage:"",longMessage:""}}const ia={[Ot.layerTypes.DATA]:({layerId:e,seriesType:t})=>({layerId:e,layerType:Ot.layerTypes.DATA,accessors:[],seriesType:t}),[Ot.layerTypes.REFERENCELINE]:({layerId:e})=>({layerId:e,layerType:Ot.layerTypes.REFERENCELINE,accessors:[]}),[Ot.layerTypes.ANNOTATIONS]:({layerId:e,indexPatternId:t})=>({layerId:e,layerType:Ot.layerTypes.ANNOTATIONS,annotations:[],indexPatternId:t,ignoreGlobalFilters:!0})};function sa({layerId:e,layerType:t=Ot.layerTypes.DATA,seriesType:a,indexPatternId:n}){return ia[t]({layerId:e,seriesType:a,indexPatternId:n})}function la(e,t){return e.layers.filter((({layerType:e=Ot.layerTypes.DATA})=>!t||e===t))}function ra(e,t,a){return t.every(a)||!t.some(a)?{valid:!0}:{valid:!1,payload:na(e,t.reduce(((e,t,n)=>(a(t)&&e.push(n),e)),[]),pa(t))}}const oa=e=>!e.isBucketed&&"number"===e.dataType,ua=e=>oa(e)&&!e.isStaticValue,ca=e=>e.isBucketed;function da(e){return"bar_horizontal"===e||"bar_horizontal_stacked"===e||"bar_horizontal_percentage_stacked"===e}function pa(e){return Ut(e).every((e=>da(e.seriesType)))}function ma(e){const t=zt.visualizationTypes.find((t=>t.id===e));if(!t)throw new Error(`Unknown series type ${e}`);return t.icon||"empty"}const ga=(e,t)=>{const a={};return e.accessors.concat(Wt(e)&&e.splitAccessor?[e.splitAccessor]:[]).forEach((e=>{const n=null==t?void 0:t.getOperationForColumnId(e);null!=n&&n.label&&(a[e]=n.label)})),a};function fa(e){return`xy-visualization-layer-${e}`}function ba(e,t){if(t&&"isVisualizeAction"in t)return e&&"indexPatternId"in e?e.indexPatternId:void 0}function ha(e,t,a,n,i){var s;if(null!=i&&i.invalid)return{invalid:!0,invalidMessages:i.invalidMessage?[i.invalidMessage]:void 0};const l={invalid:!1},r=e.layers.find((e=>e.layerId===a));if(!r||!Kt(r))return l;const o=r.annotations.find((({id:e})=>e===n));if(!o||!Object(qt.isQueryAnnotationConfig)(o))return l;const{dataViews:c}=t||{},d=c.indexPatterns[r.indexPatternId],p=[];null!=o.timeField&&""!==o.timeField||p.push(u.i18n.translate("xpack.lens.xyChart.annotationError.timeFieldEmpty",{defaultMessage:"Time field is missing"})),o.timeField&&!Boolean(d.getFieldByName(o.timeField))&&p.push(u.i18n.translate("xpack.lens.xyChart.annotationError.timeFieldNotFound",{defaultMessage:"Time field {timeField} not found in data view {dataView}",values:{timeField:o.timeField,dataView:d.title}}));const{isValid:m,error:g}=Object(k.H)(null==o?void 0:o.filter,d);if(!m&&g&&p.push(g),o.textField&&!Boolean(d.getFieldByName(o.textField))&&p.push(u.i18n.translate("xpack.lens.xyChart.annotationError.textFieldNotFound",{defaultMessage:"Text field {textField} not found in data view {dataView}",values:{textField:o.textField,dataView:d.title}})),null!==(s=o.extraFields)&&void 0!==s&&s.length){const e=[];for(const t of o.extraFields)Boolean(d.getFieldByName(t))||e.push(t);e.length&&p.push(u.i18n.translate("xpack.lens.xyChart.annotationError.tooltipFieldNotFound",{defaultMessage:"Tooltip {missingFields, plural, one {field} other {fields}} {missingTooltipFields} not found in data view {dataView}",values:{missingTooltipFields:e.join(", "),missingFields:e.length,dataView:d.title}}))}return p.length?{invalid:!0,invalidMessages:p}:l}const xa={document:0,date:1,string:2,ip:3,boolean:4,number:5,gauge:6,counter:7,histogram:8,geo_point:9,geo_shape:10,murmur3:11};function va({table:e,state:t,keptLayerIds:a,subVisualizationId:n,mainPalette:i,isFromContext:s}){if((!e.isMultiRow||e.columns.length<=1||e.columns.every((e=>"number"!==e.operation.dataType))||e.columns.some((e=>!xa.hasOwnProperty(e.operation.dataType))))&&t&&!n||e.columns.some((e=>e.operation.isStaticValue&&!s))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];const l=function(e,t,a,n,i){const[s,l]=Object(jt.partition)(e.columns,(e=>e.operation.isBucketed));if(1===s.length||2===s.length){const[s,r]=function(e,t){const a=t&&Ut(t.layers).find((({layerId:t})=>t===e.layerId)),n=e.columns.filter((e=>e.operation.isBucketed)),i=ja([...n].reverse());if(!a||"initial"===e.changeType)return i;if("reorder"===e.changeType)return n;const s=i.findIndex((({columnId:e})=>e===a.xAccessor)),l=s>-1&&i[s].operation.scale;if(l&&("interval"===l||"interval"!==i[0].operation.scale)){const[e]=i.splice(s,1);i.unshift(e)}const r=i.findIndex((({columnId:e})=>e===a.splitAccessor));if(r>-1){const[e]=i.splice(r,1);i.push(e)}return i}(e,a);return Oa({layerId:e.layerId,changeType:e.changeType,xValue:s,yValues:l,splitBy:r,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i})}if(0===s.length){const[s,[r,o]]=Object(jt.partition)(ja(l),(e=>"number"===e.operation.dataType&&!e.operation.isBucketed));return Oa({layerId:e.layerId,changeType:e.changeType,xValue:r,yValues:s,splitBy:o,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i})}}(e,a,t,n,i);return l&&l instanceof Array?l:l?[l]:[]}function ya(e){switch(e){case"bar_horizontal":return"bar";case"bar_horizontal_stacked":return"bar_stacked";case"bar":default:return"bar_horizontal";case"bar_horizontal_percentage_stacked":return"bar_percentage_stacked";case"bar_percentage_stacked":return"bar_horizontal_percentage_stacked"}}function ja(e){return[...e].sort(((e,t)=>xa[e.operation.dataType]-xa[t.operation.dataType]))}function Oa({layerId:e,changeType:t,xValue:a,yValues:n,splitBy:i,currentState:s,tableLabel:l,keptLayerIds:r,requestedSeriesType:o,mainPalette:c}){const d=function(e,t,a){const n=e.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.xySuggestions.yAxixConjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."})),i=(null==t?void 0:t.operation.label)||u.i18n.translate("xpack.lens.xySuggestions.emptyAxisTitle",{defaultMessage:"(empty)"});return a||("date"===(null==t?void 0:t.operation.dataType)?u.i18n.translate("xpack.lens.xySuggestions.dateSuggestion",{defaultMessage:"{yTitle} over {xTitle}",description:'Chart description for charts over time, like "Transfered bytes over log.timestamp"',values:{xTitle:i,yTitle:n}}):u.i18n.translate("xpack.lens.xySuggestions.nonDateSuggestion",{defaultMessage:"{yTitle} of {xTitle}",description:'Chart description for a value of some groups, like "Top URLs of top 5 countries"',values:{xTitle:i,yTitle:n}}))}(n,a,l),p=o||function(e,t,a){const n="bar_stacked",i=Ma(e,t),s=!(!i||!Wt(i))&&i.seriesType||e&&e.preferredSeriesType||n;return a&&a.operation.scale&&"ordinal"===a.operation.scale?s.startsWith("bar")?s:n:s}(s,e,a),m={currentState:s,seriesType:p,layerId:e,title:d,yValues:n,splitBy:i,changeType:t,xValue:a,keptLayerIds:r,mainPalette:i?c:void 0};if(!s&&"unchanged"===t)return zt.visualizationTypes.map((e=>({...Ta({...m,seriesType:e.id,hide:"bar_stacked"!==e.id||void 0}),title:e.label}))).sort(((e,t)=>"bar_stacked"===e.state.preferredSeriesType?-1:1));if(!s||"unchanged"!==t)return Ta(m);const g=[];if(!p.includes("bar")||a&&"ordinal"!==a.operation.scale){const e=function(e){switch(e){case"area":case"bar":case"bar_stacked":return"line";default:return"bar_stacked"}}(p);g.push(Ta({...m,seriesType:e,title:e.startsWith("bar")?u.i18n.translate("xpack.lens.xySuggestions.barChartTitle",{defaultMessage:"Bar chart"}):u.i18n.translate("xpack.lens.xySuggestions.lineChartTitle",{defaultMessage:"Line chart"})}))}else g.push(Ta({...m,title:u.i18n.translate("xpack.lens.xySuggestions.flipTitle",{defaultMessage:"Flip"}),seriesType:ya(p)}));if("line"!==p&&i&&!p.includes("percentage")&&g.push(Ta({...m,seriesType:ka(p),title:p.endsWith("stacked")?u.i18n.translate("xpack.lens.xySuggestions.unstackedChartTitle",{defaultMessage:"Unstacked"}):u.i18n.translate("xpack.lens.xySuggestions.stackedChartTitle",{defaultMessage:"Stacked"})})),"line"!==p&&p.includes("stacked")&&!p.includes("percentage")){var f;const e={...m};"ordinal"!==(null===(f=e.xValue)||void 0===f?void 0:f.operation.scale)||e.splitBy||(e.splitBy=e.xValue,delete e.xValue),g.push(Ta({...m,hide:!e.splitBy,seriesType:Ia(p),title:u.i18n.translate("xpack.lens.xySuggestions.asPercentageTitle",{defaultMessage:"Percentage"})}))}return g.concat(zt.visualizationTypes.filter((e=>!g.find((t=>t.state.preferredSeriesType===e.id)))).map((e=>({...Ta({...m,seriesType:e.id}),hide:!0}))))}function ka(e){switch(e){case"area":return"area_stacked";case"area_stacked":return"area";case"bar":return"bar_stacked";case"bar_stacked":return"bar";default:return e}}function Ia(e){switch(e){case"area_stacked":return"area_percentage_stacked";case"bar_stacked":return"bar_percentage_stacked";case"bar_horizontal_stacked":return"bar_horizontal_percentage_stacked";default:return e}}function Ta({currentState:e,seriesType:t,layerId:a,title:n,yValues:i,splitBy:s,changeType:l,xValue:r,keptLayerIds:o,hide:u,mainPalette:c}){var d,p,m,g;t.includes("percentage")&&"ordinal"===(null===(d=r)||void 0===d?void 0:d.operation.scale)&&!s&&(s=r,r=void 0);const f=Ma(e,a)||null,b=i.map((e=>e.columnId)),h={...f||{},palette:c||(f&&"palette"in f?f.palette:void 0),layerId:a,seriesType:t,xAccessor:null===(p=r)||void 0===p?void 0:p.columnId,splitAccessor:null===(m=s)||void 0===m?void 0:m.columnId,accessors:b,yConfig:f&&"yConfig"in f&&f.yConfig?f.yConfig.filter((({forAccessor:e})=>-1!==b.indexOf(e))):void 0,layerType:_.LayerTypes.DATA},x="date"===(null===(g=r)||void 0===g?void 0:g.operation.dataType)&&"interval"===r.operation.scale,v=e?e.layers.filter((e=>o.includes(e.layerId)||x&&e.layerType===_.LayerTypes.ANNOTATIONS)).map((e=>e.layerId===a?h:e)).map((e=>({...e,seriesType:t}))):[],y={legend:e?e.legend:{isVisible:!0,position:et.Position.Right},valueLabels:(null==e?void 0:e.valueLabels)||"hide",fittingFunction:(null==e?void 0:e.fittingFunction)||"None",curveType:null==e?void 0:e.curveType,fillOpacity:null==e?void 0:e.fillOpacity,xTitle:null==e?void 0:e.xTitle,yTitle:null==e?void 0:e.yTitle,yRightTitle:null==e?void 0:e.yRightTitle,hideEndzones:null==e?void 0:e.hideEndzones,showCurrentTimeMarker:null==e?void 0:e.showCurrentTimeMarker,valuesInLegend:null==e?void 0:e.valuesInLegend,yLeftExtent:null==e?void 0:e.yLeftExtent,yRightExtent:null==e?void 0:e.yRightExtent,yLeftScale:null==e?void 0:e.yLeftScale,yRightScale:null==e?void 0:e.yRightScale,axisTitlesVisibilitySettings:(null==e?void 0:e.axisTitlesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},tickLabelsVisibilitySettings:(null==e?void 0:e.tickLabelsVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},labelsOrientation:(null==e?void 0:e.labelsOrientation)||{x:0,yLeft:0,yRight:0},gridlinesVisibilitySettings:(null==e?void 0:e.gridlinesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},preferredSeriesType:t,layers:f&&Object.keys(f).length?v:[...v,h]};return{title:n,score:wa(i,s,l),hide:null!=u?u:!e&&"unchanged"!==l&&"extended"!==l||e&&"reduced"===l||0===i.length||!r&&!s,state:y,previewIcon:ma(t)}}function wa(e,t,a){const n="reduced"===a||"layers"===a?.3:"unchanged"===a?.5:1;return((e.length>1?2:1)+(t?1:0))/3*n}function Ma(e,t){return e&&e.layers.find((e=>e.layerId===t))}function Ca(e,t){return e.id===t.id}function Sa(e,t){const a={auto:[],left:[],right:[],bottom:[]};return null==e||e.forEach((e=>{const n=null==t?void 0:t[e.layerId];e.accessors.forEach((t=>{var i,s,l,r;const o=(null===(i=e.yConfig)||void 0===i||null===(s=i.find((e=>e.forAccessor===t)))||void 0===s?void 0:s.axisMode)||"auto";let u=(null==n||null===(l=n.columns.find((e=>e.id===t)))||void 0===l||null===(r=l.meta)||void 0===r?void 0:r.params)||{id:"number"};e.seriesType.includes("percentage")&&"percent"!==u.id&&(u={id:"percent",params:{pattern:"0.[00]%"}}),a[o].push({layer:e.layerId,accessor:t,fieldFormat:u})}))})),a.auto.forEach((e=>{0===a.left.length||t&&a.left.every((t=>Ca(t.fieldFormat,e.fieldFormat)))?a.left.push(e):0===a.right.length||t&&a.left.every((t=>Ca(t.fieldFormat,e.fieldFormat)))?a.right.push(e):a.right.length>=a.left.length?a.left.push(e):a.right.push(e)})),a}function Fa(e,t){return{inclusiveZeroError:e&&!Object(k.I)(t),boundaryError:!Object(k.G)(t)}}a(229);const Ea=[{id:"xy_axis_orientation_horizontal",value:0,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.horizontal",{defaultMessage:"Horizontal"})},{id:"xy_axis_orientation_vertical",value:-90,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.vertical",{defaultMessage:"Vertical"})},{id:"xy_axis_orientation_angled",value:-45,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.angled",{defaultMessage:"Angled"})}],Pa=Object(b.htmlIdGenerator)()(),Aa=({layers:e,axis:t,axisTitle:a,updateTitleState:n,toggleTickLabelsVisibility:i,toggleGridlinesVisibility:l,isDisabled:r,areTickLabelsVisible:o,areGridlinesVisible:c,isAxisTitleVisible:d,orientation:p,setOrientation:m,setEndzoneVisibility:g,endzonesVisible:f,setCurrentTimeMarkerVisibility:h,currentTimeMarkerVisible:v,extent:y,setExtent:O,hasBarOrAreaOnAxis:I,hasPercentageAxis:T,dataBounds:w,useMultilayerTimeAxis:M,scale:C,setScale:S})=>{const F=!(null==e||!e.length)&&pa(e),E=((e,t)=>{switch(e){case"yLeft":return{icon:t?x.b:x.c,groupPosition:"left",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}):u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}),buttonDataTestSubj:"lnsLeftAxisButton"};case"yRight":return{icon:t?x.e:x.d,groupPosition:"right",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.topAxisLabel",{defaultMessage:"Top axis"}):u.i18n.translate("xpack.lens.xyChart.rightAxisLabel",{defaultMessage:"Right axis"}),buttonDataTestSubj:"lnsRightAxisButton"};default:return{icon:t?x.c:x.b,groupPosition:"center",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}):u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}),buttonDataTestSubj:"lnsBottomAxisButton"}}})(t,F),P=Object(s.useCallback)((e=>{if(O&&e&&!Object(jt.isEqual)(e,y)){const{inclusiveZeroError:a,boundaryError:n}=Fa(I,e);"x"!==t&&"custom"===e.mode&&(n||a)||O(e)}}),[y,t,I,O]),{inputValue:A,handleInputChange:_}=Object(k.F)({value:y,onChange:P});return Object(j.jsx)(k.s,{title:E.popoverTitle,type:E.icon,groupPosition:E.groupPosition,isDisabled:r,buttonDataTestSubj:E.buttonDataTestSubj,panelClassName:"lnsVisToolbarAxis__popover"},Object(j.jsx)(k.a,{axis:t,axisTitle:a,updateTitleState:n,isAxisTitleVisible:d}),Object(j.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),fullWidth:!0},Object(j.jsx)(b.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisGridlines`,label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),onChange:()=>l(t),checked:c,showLabel:!1})),Object(j.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.tickLabels",{defaultMessage:"Tick labels"}),fullWidth:!0},Object(j.jsx)(b.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisTickLabels`,label:u.i18n.translate("xpack.lens.xyChart.tickLabels",{defaultMessage:"Tick labels"}),onChange:()=>i(t),checked:o,showLabel:!1})),!M&&o&&Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"})},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"}),"data-test-subj":"lnsXY_axisOrientation_groups",name:"axisOrientation",buttonSize:"compressed",options:Ea,idSelected:Ea.find((({value:e})=>e===p)).id,onChange:e=>{const a=Ea.find((({id:t})=>t===e)).value;m(t,a)}})),g&&Object(j.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),fullWidth:!0},Object(j.jsx)(b.EuiSwitch,{compressed:!0,"data-test-subj":"lnsshowEndzones",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),onChange:()=>g(!Boolean(f)),checked:Boolean(f),showLabel:!1})),h&&Object(j.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.showCurrenTimeMarker",{defaultMessage:"Show current time marker"}),fullWidth:!0},Object(j.jsx)(b.EuiSwitch,{compressed:!0,"data-test-subj":"lnsshowCurrentTimeMarker",label:u.i18n.translate("xpack.lens.xyChart.showCurrenTimeMarker",{defaultMessage:"Show current time marker"}),onChange:()=>h(!Boolean(v)),checked:Boolean(v),showLabel:!1})),S&&Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.setScale",{defaultMessage:"Axis scale"}),fullWidth:!0},Object(j.jsx)(b.EuiSelect,{compressed:!0,fullWidth:!0,"data-test-subj":"lnsshowEndzones","aria-label":u.i18n.translate("xpack.lens.xyChart.setScale",{defaultMessage:"Axis scale"}),options:[{text:u.i18n.translate("xpack.lens.xyChart.scaleLinear",{defaultMessage:"Linear"}),value:"linear"},{text:u.i18n.translate("xpack.lens.xyChart.scaleLog",{defaultMessage:"Logarithmic"}),value:"log"},{text:u.i18n.translate("xpack.lens.xyChart.scaleSquare",{defaultMessage:"Square root"}),value:"sqrt"}],onChange:e=>S(e.target.value),value:C})),A&&_&&("x"!==t?Object(j.jsx)(_a,{extent:A,setExtent:_,dataBounds:w,hasBarOrAreaOnAxis:I,hasPercentageAxis:T,testSubjPrefix:"lnsXY"}):Object(j.jsx)(k.b,{extent:A,setExtent:_,dataBounds:w,testSubjPrefix:"lnsXY"})))};function _a({extent:e,setExtent:t,dataBounds:a,hasBarOrAreaOnAxis:n,hasPercentageAxis:i,testSubjPrefix:s}){var r,o;const{inclusiveZeroError:c,boundaryError:d}=Fa(n,e);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.label",{defaultMessage:"Bounds"}),helpText:n?u.i18n.translate("xpack.lens.xyChart.axisExtent.disabledDataBoundsMessage",{defaultMessage:"Only line charts can be fit to the data bounds"}):void 0},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisExtent.label",{defaultMessage:"Bounds"}),"data-test-subj":`${s}_axisBounds_groups`,name:"axisBounds",buttonSize:"compressed",options:[{id:`${Pa}full`,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.full",{defaultMessage:"Full"}),"data-test-subj":`${s}_axisExtent_groups_full'`},{id:`${Pa}dataBounds`,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.dataBounds",{defaultMessage:"Data"}),"data-test-subj":`${s}_axisExtent_groups_DataBounds'`,isDisabled:n},{id:`${Pa}custom`,label:u.i18n.translate("xpack.lens.xyChart.axisExtent.custom",{defaultMessage:"Custom"}),"data-test-subj":`${s}_axisExtent_groups_custom'`,isDisabled:i}],idSelected:`${Pa}${n&&"dataBounds"===e.mode||i?"full":e.mode}`,onChange:n=>{const i=n.replace(Pa,"");t({...e,mode:i,lowerBound:"custom"===i&&a?Math.min(0,a.min):void 0,upperBound:"custom"===i&&a?a.max:void 0})}})),"custom"===(null==e?void 0:e.mode)&&!i&&Object(j.jsx)(k.q,{isInvalid:c||d,label:" ",helpText:!n||c&&!d?void 0:u.i18n.translate("xpack.lens.xyChart.inclusiveZero",{defaultMessage:"Bounds must include zero."}),error:d?u.i18n.translate("xpack.lens.xyChart.boundaryError",{defaultMessage:"Lower bound has to be larger than upper bound"}):n&&c?u.i18n.translate("xpack.lens.xyChart.inclusiveZero",{defaultMessage:"Bounds must include zero."}):void 0,testSubjLayout:`${s}_axisExtent_customBounds`,testSubjLower:`${s}_axisExtent_lowerBound`,testSubjUpper:`${s}_axisExtent_upperBound`,lowerValue:null!==(r=e.lowerBound)&&void 0!==r?r:"",onLowerValueChange:a=>{const n=Number(a.target.value),i=""===a.target.value||Number.isNaN(Number(n));t({...e,lowerBound:i?void 0:n})},onLowerValueBlur:()=>{void 0===e.lowerBound&&a&&t({...e,lowerBound:Math.min(0,a.min)})},upperValue:null!==(o=e.upperBound)&&void 0!==o?o:"",onUpperValueChange:a=>{const n=Number(a.target.value),i=""===a.target.value||Number.isNaN(Number(n));t({...e,upperBound:i?void 0:n})},onUpperValueBlur:()=>{void 0===e.upperBound&&a&&t({...e,upperBound:a.max})}}))}const La=[{id:"None",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.none",{defaultMessage:"Do not fill gaps"})},{id:"Zero",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.zero",{defaultMessage:"Fill gaps with zeros"})},{id:"Linear",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.linear",{defaultMessage:"Linear"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.linear",{defaultMessage:"Fill gaps with a line"})},{id:"Carry",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.carry",{defaultMessage:"Last"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.carry",{defaultMessage:"Fill gaps with the last value"})},{id:"Lookahead",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.lookahead",{defaultMessage:"Next"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.lookahead",{defaultMessage:"Fill gaps with the next value"})}],Da=[{id:"None",title:u.i18n.translate("xpack.lens.endValue.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.endValueDescription.none",{defaultMessage:"Do not extend series to the edge of the chart"})},{id:"Zero",title:u.i18n.translate("xpack.lens.endValue.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.endValueDescription.zero",{defaultMessage:"Extend series as zero to the edge of the chart"})},{id:"Nearest",title:u.i18n.translate("xpack.lens.endValue.nearest",{defaultMessage:"Nearest"}),description:u.i18n.translate("xpack.lens.endValueDescription.nearest",{defaultMessage:"Extend series with the first/last value to the edge of the chart"})}],Na=({onFittingFnChange:e,fittingFunction:t,emphasizeFitting:a,onEmphasizeFittingChange:n,onEndValueChange:i,endValue:s,isFittingEnabled:r=!0})=>Object(j.jsx)(l.a.Fragment,null,r&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",label:Object(j.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.xyChart.missingValuesLabel",{defaultMessage:"Missing values"})," ",Object(j.jsx)(b.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.xyChart.missingValuesLabelHelpText",{defaultMessage:"By default, area and line charts hide the gaps in the data. To fill the gap, make a selection."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"}))},Object(j.jsx)(b.EuiSuperSelect,{"data-test-subj":"lnsMissingValuesSelect",compressed:!0,options:La.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("strong",null,t),Object(j.jsx)(b.EuiText,{size:"xs",color:"subdued"},Object(j.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:t||"None",onChange:t=>e(t),itemLayoutAlign:"top",hasDividers:!0})),t&&"None"!==t&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.endValuesLabel",{defaultMessage:"End values"})},Object(j.jsx)(b.EuiSuperSelect,{"data-test-subj":"lnsEndValuesSelect",compressed:!0,options:Da.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("strong",null,t),Object(j.jsx)(b.EuiText,{size:"xs",color:"subdued"},Object(j.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:s||"None",onChange:e=>i(e),itemLayoutAlign:"top",hasDividers:!0})),Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),display:"columnCompressedSwitch"},Object(j.jsx)(b.EuiSwitch,{showLabel:!1,label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),checked:!a,onChange:()=>{n(!a)},compressed:!0}))))),Ra=({onChange:e,value:t,isCurveTypeEnabled:a=!0})=>a?Object(j.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.curveStyleLabel",{defaultMessage:"Curve lines"})},Object(j.jsx)(b.EuiSwitch,{showLabel:!1,label:"Curved",checked:"CURVE_MONOTONE_X"===t,compressed:!0,onChange:t=>{t.target.checked?e("CURVE_MONOTONE_X"):e("LINEAR")},"data-test-subj":"lnsCurveStyleToggle"})):null,Ba=({onChange:e,value:t,isFillOpacityEnabled:a=!0})=>{const{inputValue:n,handleInputChange:i}=Object(k.F)({value:t,onChange:e});return a?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.fillOpacityLabel",{defaultMessage:"Fill opacity"}),fullWidth:!0},Object(j.jsx)(b.EuiRange,{"data-test-subj":"lnsFillOpacity",value:n,min:.1,max:1,step:.1,showInput:!0,compressed:!0,fullWidth:!0,onChange:e=>{i(Number(e.currentTarget.value))}}))):null},Va=({state:e,setState:t,datasourceLayers:a})=>{var n,i;const s=Ut(e.layers),l=s.some((({seriesType:e})=>"area_percentage_stacked"===e)),r=s.some((({seriesType:e})=>["area_stacked","area","line","area_percentage_stacked"].includes(e))),o=s.some((({seriesType:e})=>["area_stacked","area","area_percentage_stacked"].includes(e))),c=Boolean(function(e=[],t){return!!t&&e.filter((({accessors:e})=>e.length)).some((({layerId:e,xAccessor:a})=>{var n;if(!a)return!1;const i=null===(n=t[e])||void 0===n?void 0:n.getOperationForColumnId(a);return i&&i.isBucketed&&i.scale&&"ordinal"!==i.scale}))}(s,a)),d=!r,p=r&&!l,m=r||l,g=function({isAreaPercentage:e,isHistogramSeries:t}){return t?u.i18n.translate("xpack.lens.xyChart.valuesHistogramDisabledHelpText",{defaultMessage:"This setting cannot be changed on histograms."}):e?u.i18n.translate("xpack.lens.xyChart.valuesPercentageDisabledHelpText",{defaultMessage:"This setting cannot be changed on percentage area charts."}):u.i18n.translate("xpack.lens.xyChart.valuesStackedDisabledHelpText",{defaultMessage:"This setting cannot be changed on stacked or percentage bar charts"})}({isAreaPercentage:l,isHistogramSeries:c}),f=!d&&!p&&!m;return Object(j.jsx)(k.t,{tooltipContent:g,condition:f},Object(j.jsx)(k.s,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton",isDisabled:f},Object(j.jsx)(Ra,{isCurveTypeEnabled:m,value:null==e?void 0:e.curveType,onChange:a=>{t({...e,curveType:a})}}),Object(j.jsx)(k.u,{isVisible:d,valueLabels:null!==(n=null==e?void 0:e.valueLabels)&&void 0!==n?n:"hide",onValueLabelChange:a=>{t({...e,valueLabels:a})}}),Object(j.jsx)(Na,{isFittingEnabled:p,fittingFunction:null==e?void 0:e.fittingFunction,emphasizeFitting:null==e?void 0:e.emphasizeFitting,endValue:null==e?void 0:e.endValue,onFittingFnChange:a=>{t({...e,fittingFunction:a})},onEmphasizeFittingChange:a=>{t({...e,emphasizeFitting:a})},onEndValueChange:a=>{t({...e,endValue:a})}}),Object(j.jsx)(Ba,{isFillOpacityEnabled:o,value:null!==(i=null==e?void 0:e.fillOpacity)&&void 0!==i?i:.3,onChange:a=>{t({...e,fillOpacity:a})}})))};function za(e){return null!=e&&"empty"!==e}const Ga=e=>{var t;return e.value?Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiIcon,{type:null!==(t=e.icon)&&void 0!==t?t:e.value})),Object(j.jsx)(b.EuiFlexItem,null,e.label)):null};function qa({value:e,onChange:t,customIconSet:a,defaultIcon:n="empty"}){var i;const s=a.find((t=>e===t.value))||a.find((e=>e.value===n));return Object(j.jsx)(b.EuiComboBox,{fullWidth:!0,"data-test-subj":"lns-icon-select",isClearable:!1,options:a,selectedOptions:[{label:s.label,value:s.value}],onChange:e=>{t(e[0].value)},singleSelection:{asPlainText:!0},renderOption:Ga,compressed:!0,prepend:za(s.value)?Object(j.jsx)(b.EuiIcon,{type:null!==(i=s.icon)&&void 0!==i?i:s.value}):void 0})}var Ha=a(35),$a=a.n(Ha);const Wa=u.i18n.translate("xpack.lens.xyChart.defaultAnnotationLabel",{defaultMessage:"Event"}),Ua=u.i18n.translate("xpack.lens.xyChart.defaultRangeAnnotationLabel",{defaultMessage:"Event range"}),Xa=(e,t)=>Boolean(e.length&&e.every((e=>e.xAccessor&&$t("interval","date",(null==t?void 0:t.datasourceLayers)||{})(e))));function Ya(e,t){const a=e.map((({layerId:e})=>e)),{activeData:n,dateRange:i}=t,s=$a()(i.fromDate).valueOf(),l=$a()(i.toDate).valueOf(),r=$a()((s+l)/2).toISOString();if(!n||Object.entries(n).filter((([e])=>a.includes(e))).every((([,{rows:e}])=>!e||!e.length)))return r;const o=(a.reduce(((t,a)=>{var i,s,l,r;const o=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,u=null===(s=n[a])||void 0===s||null===(l=s.rows)||void 0===l||null===(r=l[0])||void 0===r?void 0:r[o];return u&&u<t?u:t}),864e13)+a.reduce(((t,a)=>{var i,s,l,r,o,u;const c=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,d=null===(s=n[a])||void 0===s||null===(l=s.rows)||void 0===l||null===(r=l[(null==n||null===(o=n[a])||void 0===o||null===(u=o.rows)||void 0===u?void 0:u.length)-1])||void 0===r?void 0:r[c];return d&&d>t?d:t}),-864e13))/2;return s<o&&l>o?$a()(o).toISOString():r}const Ka=(e,t)=>{const a=Ut((null==e?void 0:e.layers)||[]),n=Xa(a,t),i=e&&n?[{groupId:"xAnnotations",columnId:Object(Ge.a)()}]:void 0;return{type:_.LayerTypes.ANNOTATIONS,label:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabel",{defaultMessage:"Annotations"}),icon:x.l,disabled:!n,toolTipContent:n?void 0:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),initialDimensions:i,noDatasource:!0}},Qa=(e,t,a)=>({filter:{type:"kibana_query",query:`${t}: *`,language:"kuery"},timeField:a,type:"query",key:{type:"point_in_time"},id:e,label:`${t}: *`}),Za=(e,t,a)=>a?{...a,id:e}:((e,t)=>({label:Wa,type:"manual",key:{type:"point_in_time",timestamp:t},icon:"triangle",id:e}))(e,t),Ja=({prevState:e,frame:t,source:a,target:n,dropType:i})=>{const s=e.layers.find((e=>e.layerId===n.layerId));if(!s||!Kt(s))return e;const l=s.annotations.find((({id:e})=>e===n.columnId)),r=t.dataViews.indexPatterns[s.indexPatternId];if(Object(Gt.isDraggedDataViewField)(a)){const t=r.timeFieldName;switch(i){case"field_add":return l||!t?e:{...e,layers:e.layers.map((e=>e.layerId===n.layerId?{...s,annotations:[...s.annotations,Qa(n.columnId,a.field.name,t)]}:e))};case"field_replace":return l&&t?{...e,layers:e.layers.map((e=>e.layerId===n.layerId?{...s,annotations:[...s.annotations.map((e=>e===l?{...l,...Qa(n.columnId,a.field.name,t)}:e))]}:e))}:e}return e}const o=e.layers.find((e=>e.layerId===a.layerId));if(!o||!Kt(o))return e;const u=o.annotations.find((({id:e})=>e===a.columnId));if(t.dataViews.indexPatterns[o.indexPatternId]!==r&&Object(qt.isQueryAnnotationConfig)(u))return e;switch(i){case"reorder":if(!l||!u||a.layerId!==n.layerId)return e;const i=s.annotations.filter((e=>e.id!==u.id)),r=i.findIndex((e=>e.id===l.id)),c=s.annotations.indexOf(u),d=s.annotations.indexOf(l);return i.splice(c<d?r+1:r,0,u),{...e,layers:e.layers.map((e=>e.layerId===n.layerId?{...s,annotations:i}:e))};case"swap_compatible":return l&&u?{...e,layers:e.layers.map((e=>Kt(e)&&Kt(s)?e.layerId===n.layerId?{...s,annotations:[...s.annotations.map((e=>e===l?u:e))]}:e.layerId===a.layerId?{...o,annotations:[...o.annotations.map((e=>e===u?l:e))]}:e:e))}:e;case"replace_compatible":return l&&u?{...e,layers:e.layers.map((e=>e.layerId===a.layerId?{...o,annotations:o.annotations.filter((e=>e!==u))}:e.layerId===n.layerId?{...s,annotations:[...s.annotations.map((e=>e===l?u:e))]}:e))}:e;case"duplicate_compatible":return l?e:{...e,layers:e.layers.map((a=>a.layerId===n.layerId?{...s,annotations:[...s.annotations,Za(n.columnId,Ya(Ut(e.layers),t),u)]}:a))};case"replace_duplicate_compatible":return l?{...e,layers:e.layers.map((a=>a.layerId===n.layerId?{...s,annotations:[...s.annotations.map((a=>a===l?Za(n.columnId,Ya(Ut(e.layers),t),u):a))]}:a))}:e;case"move_compatible":return l||!u?e:{...e,layers:e.layers.map((e=>e.layerId===a.layerId?{...o,annotations:o.annotations.filter((e=>e!==u))}:e.layerId===n.layerId?{...s,annotations:[...s.annotations,u]}:e))};default:return e}return e},en=e=>e.annotations.map((e=>(e=>({columnId:e.id,triggerIcon:e.isHidden?"invisible":"color",color:(null==e?void 0:e.color)||(Object(qt.isRangeAnnotationConfig)(e)?qt.defaultAnnotationRangeColor:qt.defaultAnnotationColor)}))(e))),tn=e=>{const t=Qt(e),a={},n={};return t.forEach((e=>{e.annotations&&e.annotations.forEach((e=>{a[e.id]=(e=>{let t=e;for(;n[t]>=0;){const a=++n[t];t=u.i18n.translate("xpack.lens.uniqueLabel",{defaultMessage:"{label} [{num}]",values:{label:e,num:a}})}return n[t]=0,t})(e.label)}))})),a};function an(e,t,a){const n=e.some($t("interval","number",t)),{right:i,left:s}=Sa(e,a);return{x:e.some((({xAccessor:e})=>null!=e))&&n,yLeft:s.length>0,yRight:i.length>0}}function nn(e,t,{activeData:a},n){if(!a)return 100;const{dataLayers:i,untouchedDataLayers:s,accessors:l}=function(e,t,a){switch(e){case"x":{const e=t.filter((({xAccessor:e})=>e));return{dataLayers:e.map((({accessors:e,xAccessor:t,...a})=>({...a,accessors:[t]}))),untouchedDataLayers:e,accessors:e.map((({xAccessor:e})=>e))}}case"yLeft":case"yRight":{const n="yLeft"===e?"left":"right",{[n]:i}=Sa(t,a),s=new Set(i.map((({layer:e})=>e))),l=t.filter((({layerId:e})=>s.has(e)));return{dataLayers:l,untouchedDataLayers:l,accessors:i.map((({accessor:e})=>e))}}}}(t,e,a);if("x"===t&&i.length&&!s.some(n))return 100;const r=function(e,t,a,n=!0,i=!0){if(e.length&&t.length){if(e.some((({seriesType:e})=>function(e){return"bar_percentage_stacked"===e||"bar_horizontal_percentage_stacked"===e||"area_percentage_stacked"===e}(e))))return.75;const{min:s,max:l}=function(e,t,a,n=!0){const i=new Set(t);let s,l;const[r,o]=Object(jt.partition)(e,(({seriesType:e})=>function(e){return e.includes("stacked")}(e)&&n));for(const{layerId:e,accessors:t}of o){const n=a[e];if(n)for(const e of t)if(i.has(e))for(const t of n.rows){const a=t[e];"number"==typeof a&&(l=null!=l?Math.max(a,l):a,s=null!=s?Math.min(a,s):a)}}const u={};for(const{layerId:e,accessors:t,xAccessor:n}of r){const s=a[e];if(s)for(const e of t)if(i.has(e))for(const t of s.rows){const a=t[e];let i="shared";var c;n&&(i=t[n]),"number"==typeof a&&(u[i]=null!==(c=u[i])&&void 0!==c?c:0,u[i]+=a)}}for(const e of Object.values(u))l=Math.max(e,l||0,0),s=Math.min(e,s||0,0);return{min:s,max:l}}(e,t,a,i);if(null!=s&&null!=l&&isFinite(s)&&isFinite(l)){const e=n?Math.min(0,s):s;return Number((e+.75*(l-e)).toFixed(2))}}}(i,l,a,"x"!==t,"x"!==t);return null!=r?r:100}const sn=(e,t)=>{const a=function(e,t,a,n){if(!t)return[];const i=an(Ut(t.layers),a,n);return[{id:"yReferenceLineLeft",label:"yLeft"},{id:"yReferenceLineRight",label:"yRight"},{id:"xReferenceLine",label:"x"}].filter((({label:e})=>i[e]))}(0,e,(null==t?void 0:t.datasourceLayers)||{},null==t?void 0:t.activeData),n=(null==e?void 0:e.layers)||[],i=Ut(n),s=i.filter((({accessors:e,xAccessor:t})=>e.length||t)),l=$t("interval","number",(null==t?void 0:t.datasourceLayers)||{}),r=e?a.map((({id:e,label:a})=>({groupId:e,columnId:Object(Ge.a)(),dataType:"number",label:Ht(a,{isHorizontal:pa(n)}),staticValue:nn(i,a,{activeData:null==t?void 0:t.activeData},l)}))):void 0;return{type:_.LayerTypes.REFERENCELINE,label:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabel",{defaultMessage:"Reference lines"}),icon:x.q,disabled:!s.length||!i.some(l)&&i.every((({accessors:e})=>!e.length)),toolTipContent:s.length?void 0:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabelDisabledHelp",{defaultMessage:"Add some data to enable reference layer"}),initialDimensions:r}},ln=(e,t=rn)=>({columnId:e,triggerIcon:"color",color:t}),rn=Q.euiLightVars.euiColorDarkShade;function on(e,t,a){const n={};return e.filter((e=>Wt(e))).forEach((e=>{var t;const a=(null===(t=e.palette)||void 0===t?void 0:t.name)||"default";n[a]||(n[a]=[]),n[a].push(e)})),Object(jt.mapValues)(n,(e=>{const n=e.map(((e,n)=>{var i;if(e.collapseFn||!e.splitAccessor)return{numberOfSeries:e.accessors.length,splits:[]};const s=e.splitAccessor,l=null===(i=t.tables[e.layerId])||void 0===i?void 0:i.columns.find((({id:e})=>e===s)),r=l&&a(l.meta.params),o=l&&t.tables[e.layerId]?Object(jt.uniq)(t.tables[e.layerId].rows.map((e=>{let t=e[s];var a;return t=t&&!(e=>null!=e&&"object"!=typeof e)(t)?null!==(a=null==r?void 0:r.convert(t))&&void 0!==a?a:t:String(t),t}))):[];return{numberOfSeries:(o.length||1)*e.accessors.length,splits:o}}));return{totalSeriesCount:n.reduce(((e,t)=>e+t.numberOfSeries),0),getRank(t,a,i){const s=e.findIndex((e=>t.layerId===e.layerId)),l=n[s].splits.indexOf(a);return(0===s?0:n.slice(0,s).reduce(((e,t)=>e+t.numberOfSeries),0))+(t.splitAccessor&&-1!==l?l*t.accessors.length:0)+t.accessors.indexOf(i)}}}))}function un(e){return{columnId:e,triggerIcon:"disabled"}}function cn(e,t,a,n,i){var s;if(Xt(e))return ln(t);if(Kt(e)){const a=e.annotations.find((e=>e.id===t));return{columnId:t,triggerIcon:null!=a&&a.isHidden?"invisible":"color",color:Object(qt.isRangeAnnotationConfig)(a)?qt.defaultAnnotationRangeColor:qt.defaultAnnotationColor}}const l=Wt(e)&&!e.collapseFn&&e.splitAccessor,r=e.palette||{type:"palette",name:"default"},o=null===(s=a[r.name])||void 0===s?void 0:s.totalSeriesCount;if(l)return un(t);const u=ga(e,n.datasourceLayers[e.layerId]),c=a[r.name].getRank(e,u[t]||t,t),d=null!=o?i.get(r.name).getCategoricalColor([{name:u[t]||t,rankAtDepth:c,totalSeriesAtDepth:o}],{maxDepth:1,totalSeries:o},r.params):void 0;return{columnId:t,triggerIcon:d?"color":"disabled",color:null!=d?d:void 0}}const dn=(e,t)=>{const a=e?e.getTableSpec().map((({columnId:e})=>e)).filter((e=>t.accessors.includes(e))):t.accessors;return Array.from(new Set(a.concat(t.accessors)))},pn=(e,t,a,n={},i,s)=>{if(!e||!e.layers.length)return null;const l={};return e.layers.forEach((e=>{l[e.layerId]={};const a=t[e.layerId];a&&a.getTableSpec().forEach((a=>{var n,i;const s=null!==(n=null===(i=t[e.layerId])||void 0===i?void 0:i.getOperationForColumnId(a.columnId))&&void 0!==n?n:null;l[e.layerId][a.columnId]=s}))})),fn(e,l,t,a,i,s)},mn={[_.LayerTypes.DATA]:e=>({...e,simpleView:!0}),[_.LayerTypes.REFERENCELINE]:e=>{var t;return{...e,simpleView:!0,yConfig:null===(t=e.yConfig)||void 0===t?void 0:t.map((({...e})=>({...e,lineWidth:1,icon:void 0,textVisibility:!1})))}},[_.LayerTypes.ANNOTATIONS]:e=>({...e,simpleView:!0})};function gn(e,t){if(!e)return t;if("ordinal"===e.scale)return et.ScaleType.Ordinal;if("interval"===e.scale||"ratio"===e.scale)return"date"===e.dataType?et.ScaleType.Time:et.ScaleType.Linear;switch(e.dataType){case"boolean":case"string":case"ip":return et.ScaleType.Ordinal;case"date":return et.ScaleType.Time;default:return et.ScaleType.Linear}}const fn=(e,t,a,n,i,s)=>{var l,r,o,u,c,d,p,m,g,f,b,h,x,v,y,j,O,I,T,w,M,C,S,F,E,P,_,D,N,R;const B=Ut(e.layers).filter((e=>Boolean(e.accessors.length))).map((e=>({...e,accessors:dn(a[e.layerId],e)}))),V=Yt(e.layers).filter((e=>Boolean(e.accessors.length))),z=tn(e.layers),G=Qt(e.layers).filter((e=>Boolean(e.annotations.length))).map((e=>({...e,annotations:e.annotations.map((t=>({...t,label:z[t.id],..."query"===t.type?{ignoreGlobalFilters:e.ignoreGlobalFilters}:{}})))})));if(!B.length)return null;const q=B.some((({yConfig:e})=>null==e?void 0:e.some((e=>e.axisMode===et.Position.Left)))),H=B.some((({yConfig:e})=>null==e?void 0:e.some((e=>e.axisMode===et.Position.Right)))),$=[{position:et.Position.Left,extent:null==e?void 0:e.yLeftExtent,showTitle:null===(l=null==e||null===(r=e.axisTitlesVisibilitySettings)||void 0===r?void 0:r.yLeft)||void 0===l||l,title:e.yTitle||"",showLabels:null===(o=null==e||null===(u=e.tickLabelsVisibilitySettings)||void 0===u?void 0:u.yLeft)||void 0===o||o,showGridLines:null===(c=null==e||null===(d=e.gridlinesVisibilitySettings)||void 0===d?void 0:d.yLeft)||void 0===c||c,labelsOrientation:null!==(p=null==e||null===(m=e.labelsOrientation)||void 0===m?void 0:m.yLeft)&&void 0!==p?p:0,scaleType:e.yLeftScale||"linear"},{position:et.Position.Right,extent:null==e?void 0:e.yRightExtent,showTitle:null===(g=null==e||null===(f=e.axisTitlesVisibilitySettings)||void 0===f?void 0:f.yRight)||void 0===g||g,title:e.yRightTitle||"",showLabels:null===(b=null==e||null===(h=e.tickLabelsVisibilitySettings)||void 0===h?void 0:h.yRight)||void 0===b||b,showGridLines:null===(x=null==e||null===(v=e.gridlinesVisibilitySettings)||void 0===v?void 0:v.yRight)||void 0===x||x,labelsOrientation:null!==(y=null==e||null===(j=e.labelsOrientation)||void 0===j?void 0:j.yRight)&&void 0!==y?y:0,scaleType:e.yRightScale||"linear"}];q&&$.push({id:et.Position.Left,position:et.Position.Left,...$[0]}),H&&$.push({id:et.Position.Right,position:et.Position.Right,...$[1]});const W=e=>{var t;return Object(qt.isManualPointAnnotationConfig)(e)||Object(qt.isRangeAnnotationConfig)(e)||e.filter&&""!==(null===(t=e.filter)||void 0===t?void 0:t.query)},U=Object(L.buildExpressionFunction)("legendConfig",{isVisible:e.legend.isVisible,showSingleSeries:e.legend.showSingleSeries,position:e.legend.isInside?[]:e.legend.position,isInside:e.legend.isInside?e.legend.isInside:void 0,legendSize:e.legend.isInside?void 0:e.legend.position===et.Position.Top||e.legend.position===et.Position.Bottom?A.LegendSize.AUTO:e.legend.legendSize?e.legend.legendSize:void 0,horizontalAlignment:e.legend.horizontalAlignment&&e.legend.isInside?e.legend.horizontalAlignment:void 0,verticalAlignment:e.legend.verticalAlignment&&e.legend.isInside?e.legend.verticalAlignment:void 0,floatingColumns:e.legend.floatingColumns&&e.legend.isInside?Math.min(5,e.legend.floatingColumns):[],maxLines:e.legend.maxLines,shouldTruncate:null!==(O=e.legend.shouldTruncate)&&void 0!==O?O:pt(e,a).truncateText}),X=Object(L.buildExpressionFunction)("xAxisConfig",{id:"x",position:"bottom",title:e.xTitle||"",showTitle:null===(I=null==e||null===(T=e.axisTitlesVisibilitySettings)||void 0===T?void 0:T.x)||void 0===I||I,showLabels:null===(w=null==e||null===(M=e.tickLabelsVisibilitySettings)||void 0===M?void 0:M.x)||void 0===w||w,showGridLines:null===(C=null==e||null===(S=e.gridlinesVisibilitySettings)||void 0===S?void 0:S.x)||void 0===C||C,labelsOrientation:null!==(F=null==e||null===(E=e.labelsOrientation)||void 0===E?void 0:E.x)&&void 0!==F?F:0,extent:e.xExtent?[Object(k.x)(e.xExtent)]:[]}),Y=Object(L.buildExpressionFunction)("layeredXyVis",{legend:Object(L.buildExpression)([U]).toAst(),fittingFunction:e.fittingFunction||"None",endValue:e.endValue||"None",emphasizeFitting:e.emphasizeFitting||!1,fillOpacity:e.fillOpacity||.3,valueLabels:(null==e?void 0:e.valueLabels)||"hide",hideEndzones:(null==e?void 0:e.hideEndzones)||!1,addTimeMarker:(null==e?void 0:e.showCurrentTimeMarker)||!1,valuesInLegend:(null==e?void 0:e.valuesInLegend)||!1,yAxisConfigs:[...bn($)],xAxisConfig:Object(L.buildExpression)([X]).toAst(),showTooltip:[],layers:[...B.map((s=>vn(s,$,a[s.layerId],t,n,i[s.layerId],e.curveType||"LINEAR"))),...V.map((e=>hn(e,a[e.layerId],i[e.layerId])))],annotations:G.length&&G.flatMap((e=>e.annotations.filter(W))).length?[Object(L.buildExpression)([Object(L.buildExpressionFunction)("event_annotations_result",{layers:G.map((e=>xn(e,s))),datatable:s.toFetchExpression({interval:(null===(P=B[0])||void 0===P?void 0:P.xAccessor)&&(null===(_=t[null===(N=B[0])||void 0===N?void 0:N.layerId])||void 0===_||null===(D=_[null===(R=B[0])||void 0===R?void 0:R.xAccessor])||void 0===D?void 0:D.interval)||"auto",groups:G.map((e=>({indexPatternId:e.indexPatternId,annotations:e.annotations.filter(W)})))})})]).toAst()]:[]});return Object(L.buildExpression)([Y]).toAst()},bn=e=>e.map((e=>{var t,a,n;return Object(L.buildExpression)([Object(L.buildExpressionFunction)("yAxisConfig",{id:e.id,position:e.position,extent:e.extent?Object(k.x)(e.extent):void 0,showTitle:null===(t=e.showTitle)||void 0===t||t,title:e.title,showLabels:null===(a=e.showLabels)||void 0===a||a,showGridLines:null===(n=e.showGridLines)||void 0===n||n,labelsOrientation:e.labelsOrientation,scaleType:e.scaleType})]).toAst()})),hn=(e,t,a)=>{const n=Object(L.buildExpressionFunction)("referenceLineLayer",{layerId:e.layerId,decorations:e.yConfig?e.yConfig.map((e=>jn(e,rn))):[],accessors:e.accessors,columnToLabel:JSON.stringify(ga(e,t)),...a&&a.chain.length?{table:a}:{}});return Object(L.buildExpression)([n]).toAst()},xn=(e,t)=>{const a=Object(L.buildExpressionFunction)("extendedAnnotationLayer",{simpleView:Boolean(e.simpleView),layerId:e.layerId,annotations:t.toExpression(e.annotations||[])});return Object(L.buildExpression)([a]).toAst()},vn=(e,t,a,n,i,s,l)=>{const r=ga(e,a),o=null==a?void 0:a.getOperationForColumnId(e.xAccessor),u=Boolean(o&&o.isBucketed&&o.scale&&"ordinal"!==o.scale),c=e.seriesType.split("_"),d=c[0],p=c.includes("percentage"),m=c.includes("stacked"),g=c.includes("horizontal"),f=Object(L.buildExpressionFunction)("lens_collapse",{by:e.xAccessor?[e.xAccessor]:[],metric:e.accessors,fn:[e.collapseFn]}),b=Object(L.buildExpressionFunction)("extendedDataLayer",{layerId:e.layerId,simpleView:Boolean(e.simpleView),xAccessor:e.xAccessor,xScaleType:gn(n[e.layerId][e.xAccessor],et.ScaleType.Linear),isHistogram:u,isPercentage:p,isStacked:m,isHorizontal:g,splitAccessors:e.collapseFn||!e.splitAccessor?void 0:[e.splitAccessor],decorations:e.yConfig?e.yConfig.map((e=>yn(e,t))):void 0,curveType:l,seriesType:d,showLines:"line"===d||"area"===d,accessors:e.accessors,columnToLabel:JSON.stringify(r),palette:Object(L.buildExpression)([e.palette?Object(L.buildExpressionFunction)("theme",{variable:"palette",default:[i.get(e.palette.name).toExpression(e.palette.params)]}):Object(L.buildExpressionFunction)("system_palette",{name:"default"})]).toAst()});return{type:"expression",chain:[...s?[...s.chain,...e.collapseFn?[f.toAst()]:[]]:[],b.toAst()]}},yn=(e,t,a)=>{var n,i;const s=null===(n=t.find((t=>t.id&&t.position===e.axisMode)))||void 0===n?void 0:n.id,l=Object(L.buildExpressionFunction)("dataDecorationConfig",{axisId:s,forAccessor:e.forAccessor,color:null!==(i=e.color)&&void 0!==i?i:a});return Object(L.buildExpression)([l]).toAst()},jn=(e,t)=>{var a;const n=Object(L.buildExpressionFunction)("referenceLineDecorationConfig",{forAccessor:e.forAccessor,position:e.axisMode,color:null!==(a=e.color)&&void 0!==a?a:t,lineStyle:e.lineStyle||"solid",lineWidth:e.lineWidth||1,fill:e.fill||"none",icon:za(e.icon)?e.icon:void 0,iconPosition:(za(e.icon)||e.textVisibility)&&e.iconPosition||"auto",textVisibility:e.textVisibility||!1});return Object(L.buildExpression)([n]).toAst()};function On(e,t,a){const n=[...e.layers];return n[a]=t,{...e,layers:n}}const kn=[{id:"xy_legend_auto",value:"auto",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"xy_legend_show",value:"show",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"xy_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.hide",{defaultMessage:"Hide"})}];function In(e,t,a){var n;return Boolean(null===(n=e.find((e=>e.groupId===t)))||void 0===n?void 0:n.series.some((({layer:e})=>Ut(null==a?void 0:a.layers).find((t=>t.layerId===e&&t.seriesType.includes("percentage"))))))}const Tn={x:"xTitle",yLeft:"yTitle",yRight:"yRightTitle"},wn=Object(s.memo)((function(e){var t,a,n,i,l,r,o,c,d,p,m,g,f,h,x,v,y,O,I,T,w,M,C,S,F,E;const{state:P,setState:_,frame:L,useLegacyTimeAxis:D}=e,N=Ut(null==P?void 0:P.layers),R=!(null==P||!P.layers.length)&&pa(P.layers),B=function(e,t,a,n){const i=Sa(e,a),s=[];return i.left.length>0&&s.push({groupId:"left",position:t?"bottom":"left",formatter:void 0,series:i.left.map((({fieldFormat:e,...t})=>t))}),i.right.length>0&&s.push({groupId:"right",position:t?"top":"right",formatter:void 0,series:i.right.map((({fieldFormat:e,...t})=>t))}),s}(N,R,L.activeData),V=function(e,t){const a={};return t.forEach((t=>{let n=Number.MAX_VALUE,i=Number.MIN_VALUE;t.series.forEach((t=>{var a;null==e||null===(a=e[t.layer])||void 0===a||a.rows.forEach((e=>{const a=e[t.accessor];Number.isNaN(a)||(a<n&&(n=a),a>i&&(i=a))}))})),n!==Number.MAX_VALUE&&i!==Number.MIN_VALUE&&(a[t.groupId]={min:Math.round(100*(n+Number.EPSILON))/100,max:Math.round(100*(i+Number.EPSILON))/100})})),a}(L.activeData,B),z=function(e=[],t){const a=e.reduce(((e,a)=>{const n=Object(k.B)(a.layerId,t,a.xAccessor);return n?{min:Math.min(e.min,n.min),max:Math.max(e.max,n.max)}:e}),{min:1/0,max:-1/0});if(isFinite(a.min)&&isFinite(a.max))return a}(N,L.activeData),G={x:null===(t=null==P||null===(a=P.tickLabelsVisibilitySettings)||void 0===a?void 0:a.x)||void 0===t||t,yLeft:null===(n=null==P||null===(i=P.tickLabelsVisibilitySettings)||void 0===i?void 0:i.yLeft)||void 0===n||n,yRight:null===(l=null==P||null===(r=P.tickLabelsVisibilitySettings)||void 0===r?void 0:r.yRight)||void 0===l||l},q=e=>{const t={...G,[e]:!G[e]};_({...P,tickLabelsVisibilitySettings:t})},H={x:null===(o=null==P||null===(c=P.gridlinesVisibilitySettings)||void 0===c?void 0:c.x)||void 0===o||o,yLeft:null===(d=null==P||null===(p=P.gridlinesVisibilitySettings)||void 0===p?void 0:p.yLeft)||void 0===d||d,yRight:null===(m=null==P||null===(g=P.gridlinesVisibilitySettings)||void 0===g?void 0:g.yRight)||void 0===m||m},$=e=>{const t={...H,[e]:!H[e]};_({...P,gridlinesVisibilitySettings:t})},W={x:null!==(f=null==P||null===(h=P.labelsOrientation)||void 0===h?void 0:h.x)&&void 0!==f?f:0,yLeft:null!==(x=null==P||null===(v=P.labelsOrientation)||void 0===v?void 0:v.yLeft)&&void 0!==x?x:0,yRight:null!==(y=null==P||null===(O=P.labelsOrientation)||void 0===O?void 0:O.yRight)&&void 0!==y?y:0},U=(e,t)=>{const a={...W,[e]:t};_({...P,labelsOrientation:a})},X=Object(s.useMemo)((()=>{var e,t,a,n,i,s;return{x:null===(e=null==P||null===(t=P.axisTitlesVisibilitySettings)||void 0===t?void 0:t.x)||void 0===e||e,yLeft:null===(a=null==P||null===(n=P.axisTitlesVisibilitySettings)||void 0===n?void 0:n.yLeft)||void 0===a||a,yRight:null===(i=null==P||null===(s=P.axisTitlesVisibilitySettings)||void 0===s?void 0:s.yRight)||void 0===i||i}}),[null==P||null===(I=P.axisTitlesVisibilitySettings)||void 0===I?void 0:I.x,null==P||null===(T=P.axisTitlesVisibilitySettings)||void 0===T?void 0:T.yLeft,null==P||null===(w=P.axisTitlesVisibilitySettings)||void 0===w?void 0:w.yRight]),Y=Object(s.useCallback)((({title:e,visible:t},a)=>_({...P,[Tn[a]]:e,axisTitlesVisibilitySettings:{...X,[a]:t}})),[X,_,P]),K=N.every((t=>{var a,n;return!t.xAccessor||"ordinal"!==gn(null!==(a=null===(n=e.frame.datasourceLayers[t.layerId])||void 0===n?void 0:n.getOperationForColumnId(t.xAccessor))&&void 0!==a?a:null,et.ScaleType.Linear)})),Q=N.every((t=>{var a,n;return t.xAccessor&&gn(null!==(a=null===(n=e.frame.datasourceLayers[t.layerId])||void 0===n?void 0:n.getOperationForColumnId(t.xAccessor))&&void 0!==a?a:null,et.ScaleType.Linear)===et.ScaleType.Time})),Z=Q?e=>{_({...P,hideEndzones:!e})}:void 0,J=Q?e=>{_({...P,showCurrentTimeMarker:e})}:void 0,ee=null==P||!P.legend.isVisible||null!=P&&P.legend.showSingleSeries?null!=P&&P.legend.isVisible?"show":"hide":"auto",te=Boolean(null===(M=B.find((e=>"left"===e.groupId)))||void 0===M||null===(C=M.series)||void 0===C?void 0:C.some((e=>{var t;const a=null===(t=N.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),ae=Object(s.useCallback)((e=>{_({...P,yLeftExtent:e})}),[_,P]),ne=Object(s.useCallback)((e=>{_({...P,xExtent:e})}),[_,P]),ie=Boolean(null===(S=B.find((e=>"right"===e.groupId)))||void 0===S||null===(F=S.series)||void 0===F?void 0:F.some((e=>{var t;const a=null===(t=N.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),se=Object(s.useCallback)((e=>{_({...P,yRightExtent:e})}),[_,P]),le=N.filter((e=>e.seriesType.includes("bar"))),re=le.length>1||le.some((e=>e.accessors.length>1||e.splitAccessor)),oe=N.some((({xAccessor:t,layerId:a,seriesType:n,splitAccessor:i})=>{var s,l;if(!t)return!1;const r=null!==(s=null===(l=e.frame.datasourceLayers[a])||void 0===l?void 0:l.getOperationForColumnId(t))&&void 0!==s?s:null;return gn(r,et.ScaleType.Linear)===et.ScaleType.Time&&(null==r?void 0:r.isBucketed)&&(n.includes("stacked")||!i)&&(n.includes("stacked")||!n.includes("bar")||!re)})),ue=N.some((({layerId:t,xAccessor:a})=>Object(k.C)(e.frame.datasourceLayers[t],a))),ce=pt(P,e.frame.datasourceLayers).truncateText,de=P.legend.legendSize,[pe]=Object(s.useState)((()=>de===A.LegendSize.AUTO));return Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(j.jsx)(Va,{state:P,setState:_,datasourceLayers:L.datasourceLayers}),Object(j.jsx)(k.j,{legendOptions:kn,mode:ee,location:null!=P&&P.legend.isInside?"inside":"outside",onLocationChange:e=>{_({...P,legend:{...P.legend,isInside:"inside"===e}})},onDisplayChange:e=>{const t=kn.find((({id:t})=>t===e)).value;"auto"===t?_({...P,legend:{...P.legend,isVisible:!0,showSingleSeries:!1}}):"show"===t?_({...P,legend:{...P.legend,isVisible:!0,showSingleSeries:!0}}):"hide"===t&&_({...P,legend:{...P.legend,isVisible:!1,showSingleSeries:!1}})},position:null==P?void 0:P.legend.position,horizontalAlignment:null==P?void 0:P.legend.horizontalAlignment,verticalAlignment:null==P?void 0:P.legend.verticalAlignment,floatingColumns:null==P?void 0:P.legend.floatingColumns,onFloatingColumnsChange:e=>{_({...P,legend:{...P.legend,floatingColumns:e}})},maxLines:null==P?void 0:P.legend.maxLines,onMaxLinesChange:e=>{_({...P,legend:{...P.legend,maxLines:e}})},shouldTruncate:null!==(E=null==P?void 0:P.legend.shouldTruncate)&&void 0!==E?E:ce,onTruncateLegendChange:()=>{var e;const t=null!==(e=null==P?void 0:P.legend.shouldTruncate)&&void 0!==e?e:ce;_({...P,legend:{...P.legend,shouldTruncate:!t}})},onPositionChange:e=>{_({...P,legend:{...P.legend,position:e}})},onAlignmentChange:e=>{const[t,a]=e.split("_"),n=t,i=a;_({...P,legend:{...P.legend,verticalAlignment:n,horizontalAlignment:i}})},renderValueInLegendSwitch:K,valueInLegend:null==P?void 0:P.valuesInLegend,onValueInLegendChange:()=>{_({...P,valuesInLegend:!P.valuesInLegend})},legendSize:de,onLegendSizeChange:e=>{_({...P,legend:{...P.legend,legendSize:e}})},showAutoLegendSizeOption:pe}))),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(j.jsx)(k.t,{tooltipContent:R?u.i18n.translate("xpack.lens.xyChart.bottomAxisDisabledHelpText",{defaultMessage:"This setting only applies when bottom axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.leftAxisDisabledHelpText",{defaultMessage:"This setting only applies when left axis is enabled."}),condition:0===Object.keys(B.find((e=>"left"===e.groupId))||{}).length},Object(j.jsx)(Aa,{axis:"yLeft",layers:null==P?void 0:P.layers,axisTitle:null==P?void 0:P.yTitle,updateTitleState:Y,areTickLabelsVisible:G.yLeft,toggleTickLabelsVisibility:q,areGridlinesVisible:H.yLeft,toggleGridlinesVisibility:$,isDisabled:0===Object.keys(B.find((e=>"left"===e.groupId))||{}).length,orientation:W.yLeft,setOrientation:U,isAxisTitleVisible:X.yLeft,extent:(null==P?void 0:P.yLeftExtent)||{mode:"full"},setExtent:ae,hasBarOrAreaOnAxis:te,dataBounds:V.left,hasPercentageAxis:In(B,"left",P),scale:null==P?void 0:P.yLeftScale,setScale:e=>{_({...P,yLeftScale:e})}})),Object(j.jsx)(Aa,{axis:"x",layers:null==P?void 0:P.layers,axisTitle:null==P?void 0:P.xTitle,updateTitleState:Y,areTickLabelsVisible:G.x,toggleTickLabelsVisibility:q,areGridlinesVisible:H.x,toggleGridlinesVisibility:$,orientation:W.x,setOrientation:U,isAxisTitleVisible:X.x,endzonesVisible:!(null!=P&&P.hideEndzones),setEndzoneVisibility:Z,currentTimeMarkerVisible:null==P?void 0:P.showCurrentTimeMarker,setCurrentTimeMarkerVisibility:J,hasBarOrAreaOnAxis:!1,hasPercentageAxis:!1,useMultilayerTimeAxis:oe&&!D&&!R,extent:ue?(null==P?void 0:P.xExtent)||{mode:"dataBounds"}:void 0,setExtent:ne,dataBounds:z}),Object(j.jsx)(k.t,{tooltipContent:R?u.i18n.translate("xpack.lens.xyChart.topAxisDisabledHelpText",{defaultMessage:"This setting only applies when top axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.rightAxisDisabledHelpText",{defaultMessage:"This setting only applies when right axis is enabled."}),condition:0===Object.keys(B.find((e=>"right"===e.groupId))||{}).length},Object(j.jsx)(Aa,{axis:"yRight",layers:null==P?void 0:P.layers,axisTitle:null==P?void 0:P.yRightTitle,updateTitleState:Y,areTickLabelsVisible:G.yRight,toggleTickLabelsVisibility:q,areGridlinesVisible:H.yRight,toggleGridlinesVisibility:$,isDisabled:0===Object.keys(B.find((e=>"right"===e.groupId))||{}).length,orientation:W.yRight,setOrientation:U,hasPercentageAxis:In(B,"right",P),isAxisTitleVisible:X.yRight,extent:(null==P?void 0:P.yRightExtent)||{mode:"full"},setExtent:se,hasBarOrAreaOnAxis:ie,dataBounds:V.right,scale:null==P?void 0:P.yRightScale,setScale:e=>{_({...P,yRightScale:e})}})))))}));var Mn=a(103),Cn=a.n(Mn);const Sn={auto:u.i18n.translate("xpack.lens.configPanel.color.tooltip.auto",{defaultMessage:"Lens automatically picks colors for you unless you specify a custom color."}),custom:u.i18n.translate("xpack.lens.configPanel.color.tooltip.custom",{defaultMessage:"Clear the custom color to return to “Auto” mode."}),disabled:u.i18n.translate("xpack.lens.configPanel.color.tooltip.disabled",{defaultMessage:'You are unable to apply custom colors to individual series when the layer includes a "Break down by" field.'})};const Fn=e=>{var t,a;return e&&((a=e)&&""!==a&&/^#/.test(a)&&function(e){try{return Cn()(e),!0}catch(e){return!1}}(a))&&(null===(t=Cn()(e))||void 0===t?void 0:t.alpha())||1},En=({label:e,disableHelpTooltip:t,disabled:a,setConfig:n,defaultColor:i,overwriteColor:r,showAlpha:o})=>{const[c,d]=Object(s.useState)(r||i),[p,m]=Object(s.useState)(r||i),[g,f]=Object(s.useState)(Fn(c)),h=Object(s.useRef)(!1);Object(s.useEffect)((()=>{h.current||r&&p&&r.toUpperCase()!==p.toUpperCase()&&(d(r),m(r.toUpperCase()),f(Fn(r))),h.current=!1}),[p,r,i]);const x=null!=e?e:u.i18n.translate("xpack.lens.xyChart.seriesColor.label",{defaultMessage:"Series color"}),v=Object(j.jsx)(b.EuiColorPicker,{fullWidth:!0,"data-test-subj":"indexPattern-dimension-colorPicker",compressed:!0,isClearable:Boolean(r),onChange:(e,t)=>{d(e),h.current=!0,t.isValid&&(m(t.hex.toUpperCase()),f(Fn(t.hex)),n({color:t.hex})),""===e&&n({color:void 0})},color:a?"":c,disabled:a,placeholder:(null==i?void 0:i.toUpperCase())||u.i18n.translate("xpack.lens.xyChart.seriesColor.auto",{defaultMessage:"Auto"}),"aria-label":x,showAlpha:o,swatches:1===g?Object(b.euiPaletteColorBlind)():Object(b.euiPaletteColorBlind)().map((e=>Cn()(e).alpha(g).hex()))});return Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(j.jsx)(k.t,{delay:"long",position:"top",tooltipContent:c&&!a?Sn.custom:Sn.auto,condition:!t},Object(j.jsx)("span",null,x,!t&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))))},a?Object(j.jsx)(b.EuiToolTip,{position:"top",content:Sn.disabled,delay:"long",anchorClassName:"eui-displayBlock"},v):v)},Pn=u.i18n.translate("xpack.lens.xyChart.markerPosition.above",{defaultMessage:"Top"}),An=u.i18n.translate("xpack.lens.xyChart.markerPosition.below",{defaultMessage:"Bottom"}),_n=u.i18n.translate("xpack.lens.xyChart.markerPosition.left",{defaultMessage:"Left"}),Ln=u.i18n.translate("xpack.lens.xyChart.markerPosition.right",{defaultMessage:"Right"});function Dn({isHorizontal:e,axisMode:t}){const a={id:`${gi}auto`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_markerPosition_auto"};return"bottom"===t?[{id:`${gi}below`,label:e?_n:An,"data-test-subj":"lnsXY_markerPosition_below"},a,{id:`${gi}above`,label:e?Ln:Pn,"data-test-subj":"lnsXY_markerPosition_above"}]:[{id:`${gi}left`,label:e?An:_n,"data-test-subj":"lnsXY_markerPosition_left"},a,{id:`${gi}right`,label:e?Pn:Ln,"data-test-subj":"lnsXY_markerPosition_right"}]}function Nn({currentConfig:e,setConfig:t,isQueryBased:a,children:n}){const[i,l]=Object(s.useState)(function({textField:e,textVisibility:t}={},a){return t?a&&e?"field":"name":"none"}(e,a)),r=[{id:`${gi}none`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.textVisibility.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_textVisibility_none"},{id:`${gi}name`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.textVisibility.name",{defaultMessage:"Name"}),"data-test-subj":"lnsXY_textVisibility_name"}];return a&&r.push({id:`${gi}field`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.textVisibility.field",{defaultMessage:"Field"}),"data-test-subj":"lnsXY_textVisibility_field"}),Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),display:"columnCompressed",fullWidth:!0},Object(j.jsx)("div",null,Object(j.jsx)(b.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),"data-test-subj":"lns-lineMarker-text-visibility",name:"textVisibilityStyle",buttonSize:"compressed",options:r,idSelected:i?`${gi}${i}`:`${gi}none`,onChange:a=>{const n=a.replace(gi,"");"none"===n?t({textVisibility:!1,textField:void 0}):"name"===n?t({textVisibility:!0,textField:void 0}):"field"===n&&t({textVisibility:Boolean(null==e?void 0:e.textField)}),l(n)},isFullWidth:!0}),null==n?void 0:n(i)))}function Rn({currentConfig:e,setConfig:t,customIconSet:a,defaultIcon:n="empty"}){return Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.icon",{defaultMessage:"Icon decoration"})},Object(j.jsx)(qa,{defaultIcon:n,customIconSet:a,value:null==e?void 0:e.icon,onChange:e=>{t({icon:e})}}))}function Bn({currentConfig:e,setConfig:t,isHorizontal:a}){return Object(j.jsx)(l.a.Fragment,null,za(null==e?void 0:e.icon)||null!=e&&e.textVisibility?Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,isDisabled:!(za(null==e?void 0:e.icon)||null!=e&&e.textVisibility),label:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"})},Object(j.jsx)(k.t,{tooltipContent:u.i18n.translate("xpack.lens.lineMarker.positionRequirementTooltip",{defaultMessage:"You must select an icon or show the name in order to alter its position"}),condition:!(za(null==e?void 0:e.icon)||null!=e&&e.textVisibility),position:"top",delay:"regular",display:"block"},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"}),"data-test-subj":"lnsXY_markerPosition",name:"markerPosition",isDisabled:!(za(null==e?void 0:e.icon)||null!=e&&e.textVisibility),buttonSize:"compressed",options:Dn({isHorizontal:a,axisMode:e.axisMode}),idSelected:`${gi}${(null==e?void 0:e.iconPosition)||"auto"}`,onChange:e=>{const a=e.replace(gi,"");t({iconPosition:a})}}))):null)}const Vn=({currentConfig:e,setConfig:t,isHorizontal:a})=>Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.label",{defaultMessage:"Line"})},Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"s",justifyContent:"spaceBetween",responsive:!1},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(Gn,{value:(null==e?void 0:e.lineWidth)||1,onChange:e=>{t({lineWidth:e})}})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.xyChart.lineStyle.label",{defaultMessage:"Line"}),"data-test-subj":"lnsXY_line_style",name:"lineStyle",buttonSize:"compressed",options:[{id:`${gi}solid`,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.solid",{defaultMessage:"Solid"}),"data-test-subj":"lnsXY_line_style_solid",iconType:"lineSolid"},{id:`${gi}dashed`,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.dashed",{defaultMessage:"Dashed"}),"data-test-subj":"lnsXY_line_style_dashed",iconType:"lineDashed"},{id:`${gi}dotted`,label:u.i18n.translate("xpack.lens.xyChart.lineStyle.dotted",{defaultMessage:"Dotted"}),"data-test-subj":"lnsXY_line_style_dotted",iconType:"lineDotted"}],idSelected:`${gi}${(null==e?void 0:e.lineStyle)||"solid"}`,onChange:e=>{const a=e.replace(gi,"");t({lineStyle:a})},isIconOnly:!0})))));function zn(e,t,a,n){return""===e?t:Math.max(1,Math.min(e,10))}const Gn=({value:e,onChange:t})=>{const[a,n]=Object(s.useState)(String(e));return Object(j.jsx)(b.EuiFieldNumber,{"data-test-subj":"lnsXYThickness",value:a,fullWidth:!0,min:1,max:10,step:1,append:"px",compressed:!0,onChange:({currentTarget:{value:e}})=>{n(e);const a=""===e?"":Number(e),i=zn(Number(e),Number(e));a===i&&t(i)},onBlur:()=>{if(a!==String(e)){const i=zn(""===a?a:Number(a),e);t(i),n(String(i))}}})},qn=[{value:"empty",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.noIconLabel",{defaultMessage:"None"})},{value:"asterisk",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"bell",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"editorComment",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"alert",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"flag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"tag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})}],Hn=e=>{var t;const{state:a,setState:n,layerId:r,accessor:o}=e,c=pa(a.layers),d=a.layers.findIndex((e=>e.layerId===r)),{inputValue:p,handleInputChange:m}=Object(k.F)({value:a,onChange:n}),g=p.layers.find((e=>e.layerId===r)),f=null==g||null===(t=g.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===o)),b=Object(s.useCallback)((e=>{if(null==e)return;const t=[...g.yConfig||[]],a=t.findIndex((e=>e.forAccessor===o));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:o,...e}),m(On(p,{...g,yConfig:t},d))}),[o,d,p,g,m]);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(Nn,{setConfig:b,currentConfig:f}),Object(j.jsx)(Rn,{setConfig:b,currentConfig:f,customIconSet:qn}),Object(j.jsx)(Bn,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(j.jsx)(Vn,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(j.jsx)(Wn,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(j.jsx)(En,i()({},e,{overwriteColor:null==f?void 0:f.color,defaultColor:rn,setConfig:b,disableHelpTooltip:!0,label:u.i18n.translate("xpack.lens.xyChart.lineColor.label",{defaultMessage:"Color"})})))};function $n({isHorizontal:e,axisMode:t}){const a=u.i18n.translate("xpack.lens.xyChart.fill.above",{defaultMessage:"Above"}),n=u.i18n.translate("xpack.lens.xyChart.fill.below",{defaultMessage:"Below"}),i=u.i18n.translate("xpack.lens.xyChart.fill.before",{defaultMessage:"Before"}),s=u.i18n.translate("xpack.lens.xyChart.fill.after",{defaultMessage:"After"}),l="bottom"===t||e?s:a,r="bottom"===t||e?i:n;return[{id:`${gi}none`,label:u.i18n.translate("xpack.lens.xyChart.fill.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_fill_none"},{id:`${gi}above`,label:l,"data-test-subj":"lnsXY_fill_above"},{id:`${gi}below`,label:r,"data-test-subj":"lnsXY_fill_below"}]}const Wn=({currentConfig:e,setConfig:t,isHorizontal:a})=>Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"})},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"}),"data-test-subj":"lnsXY_fill",name:"fill",buttonSize:"compressed",options:$n({isHorizontal:a,axisMode:null==e?void 0:e.axisMode}),idSelected:`${gi}${(null==e?void 0:e.fill)||"none"}`,onChange:e=>{const a=e.replace(gi,"");t({fill:a})}}));a(234);var Un=a(33),Xn=a(79);const Yn=[{value:"asterisk",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"alert",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"bell",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"circle",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.circleIconLabel",{defaultMessage:"Circle"}),icon:x.E,canFill:!0},{value:"editorComment",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"flag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"heart",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.heartLabel",{defaultMessage:"Heart"})},{value:"mapMarker",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.mapMarkerLabel",{defaultMessage:"Map Marker"})},{value:"pinFilled",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.mapPinLabel",{defaultMessage:"Map Pin"})},{value:"starEmpty",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.starLabel",{defaultMessage:"Star"})},{value:"starFilled",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.starFilledLabel",{defaultMessage:"Star filled"})},{value:"tag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})},{value:"triangle",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.triangleIconLabel",{defaultMessage:"Triangle"}),icon:x.F,shouldRotate:!0,canFill:!0}];var Kn=a(15),Qn=a(132),Zn=a.n(Qn);const Jn=(e=qt.defaultAnnotationColor)=>new Zn.a(Object(b.transparentize)(e,.1)).hexa(),ei=(e=qt.defaultAnnotationRangeColor)=>new Zn.a(Object(b.transparentize)(e,1)).hex(),ti=(e,t,{activeData:a,dateRange:n},i)=>{var s;const l=$a()(t).valueOf(),r=.1*($a()(n.toDate).valueOf()-$a()(n.fromDate).valueOf()),o=$a()(l+r).toISOString(),u=i.map((({layerId:e})=>e));if(!u.length||!a||Object.entries(a).filter((([e])=>u.includes(e))).every((([,{rows:e}])=>!e||!e.length)))return o;const c=null==a?void 0:a[u[0]].columns.find((e=>e.id===i[0].xAccessor));if(!c)return o;const d=null===(s=e.getDateHistogramMeta(c))||void 0===s?void 0:s.interval;if(!d)return o;const p=Kn.search.aggs.parseInterval(d);return p?$a()(l+3*p.as("milliseconds")).toISOString():o},ai=({annotation:e,datatableUtilities:t,onChange:a,frame:n,state:i})=>{const s=Object(qt.isRangeAnnotationConfig)(e);return Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",className:"lnsRowCompressedMargin"},Object(j.jsx)(b.EuiSwitch,{"data-test-subj":"lns-xyAnnotation-rangeSwitch",label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.xyChart.applyAsRange",{defaultMessage:"Apply as range"})),checked:s,onChange:()=>{if(s){const t={type:"manual",key:{type:"point_in_time",timestamp:e.key.timestamp},id:e.id,label:e.label===Ua?Wa:e.label,color:ei(e.color),isHidden:e.isHidden};a(t)}else if(e){const s=$a()(null==e?void 0:e.key.timestamp),l=Ut(i.layers),r={type:"manual",key:{type:"range",timestamp:e.key.timestamp,endTimestamp:ti(t,s.toISOString(),n,l)},id:e.id,label:e.label===Wa?Ua:e.label,color:Jn(e.color),isHidden:e.isHidden};a(r)}},compressed:!0}))},ni=({value:e,label:t,prependLabel:a,onChange:n,dataTestSubj:i="lnsXY_annotation_date_picker"})=>Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:t,className:"lnsRowCompressedMargin"},a?Object(j.jsx)(b.EuiFormControlLayout,{fullWidth:!0,className:"lnsConfigPanelNoPadding",prepend:Object(j.jsx)(b.EuiFormLabel,{className:"lnsConfigPanelDate__label"},a)},Object(j.jsx)(b.EuiDatePicker,{calendarClassName:Gt.DONT_CLOSE_DIMENSION_CONTAINER_ON_CLICK_CLASS,fullWidth:!0,showTimeSelect:!0,selected:e,onChange:n,dateFormat:"MMM D, YYYY @ HH:mm:ss.SSS","data-test-subj":i})):Object(j.jsx)(b.EuiDatePicker,{calendarClassName:Gt.DONT_CLOSE_DIMENSION_CONTAINER_ON_CLICK_CLASS,fullWidth:!0,showTimeSelect:!0,selected:e,onChange:n,dateFormat:"MMM D, YYYY @ HH:mm:ss.SSS","data-test-subj":i})),ii=({annotation:e,frame:t,state:a,onChange:n,datatableUtilities:i})=>{const s=Object(qt.isRangeAnnotationConfig)(e);return Object(j.jsx)(l.a.Fragment,null,s?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(ni,{dataTestSubj:"lns-xyAnnotation-fromTime",prependLabel:u.i18n.translate("xpack.lens.xyChart.annotationDate.from",{defaultMessage:"From"}),value:$a()(null==e?void 0:e.key.timestamp),onChange:t=>{if(t){const a=$a()(null==e?void 0:e.key.endTimestamp).valueOf();if(a<t.valueOf()){const i=a-$a()(null==e?void 0:e.key.timestamp).valueOf();n({key:{...(null==e?void 0:e.key)||{type:"range"},timestamp:t.toISOString(),endTimestamp:$a()(t.valueOf()+i).toISOString()}})}else n({key:{...(null==e?void 0:e.key)||{type:"range"},timestamp:t.toISOString()}})}},label:u.i18n.translate("xpack.lens.xyChart.annotationDate",{defaultMessage:"Annotation date"})}),Object(j.jsx)(ni,{dataTestSubj:"lns-xyAnnotation-toTime",prependLabel:u.i18n.translate("xpack.lens.xyChart.annotationDate.to",{defaultMessage:"To"}),value:$a()(null==e?void 0:e.key.endTimestamp),onChange:t=>{if(t){const a=$a()(null==e?void 0:e.key.timestamp).valueOf();if(a>t.valueOf()){const i=$a()(null==e?void 0:e.key.endTimestamp).valueOf()-a;n({key:{...(null==e?void 0:e.key)||{type:"range"},endTimestamp:t.toISOString(),timestamp:$a()(t.valueOf()-i).toISOString()}})}else n({key:{...(null==e?void 0:e.key)||{type:"range"},endTimestamp:t.toISOString()}})}}})):Object(j.jsx)(ni,{dataTestSubj:"lns-xyAnnotation-time",label:u.i18n.translate("xpack.lens.xyChart.annotationDate",{defaultMessage:"Annotation date"}),value:$a()(null==e?void 0:e.key.timestamp),onChange:t=>{t&&n({key:{...(null==e?void 0:e.key)||{type:"point_in_time"},timestamp:t.toISOString()}})}}),Object(j.jsx)(ai,{annotation:e,onChange:n,datatableUtilities:i,frame:t,state:a}))},si={query:"",language:"kuery"},li=({annotation:e,frame:t,state:a,onChange:n,layer:i,queryInputShouldOpen:s})=>{var r,o;const c=t.dataViews.indexPatterns[i.indexPatternId],{hasFieldData:d}=Object(Un.useExistingFieldsReader)(),p=c.fields.filter((e=>"date"===e.type&&e.displayName)).map((e=>({label:e.displayName,value:{type:"field",field:e.name,dataType:e.type},exists:d(c.id,e.name),compatible:!0,"data-test-subj":`lns-fieldOption-${e.name}`}))),m=(null==e?void 0:e.timeField)||c.timeFieldName||(null===(r=p[0])||void 0===r?void 0:r.value.field),g=!m||Boolean(c.getFieldByName(m));return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{hasChildLabel:!0,display:"rowCompressed",className:"lnsRowCompressedMargin",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.annotation.queryInput",{defaultMessage:"Annotation query"}),"data-test-subj":"annotation-query-based-query-input"},Object(j.jsx)(k.i,{initiallyOpen:s,label:"",inputFilter:null!==(o=null==e?void 0:e.filter)&&void 0!==o?o:si,onChange:e=>{n({filter:{type:"kibana_query",...e}})},"data-test-subj":"lnsXY-annotation-query-based-query-input",indexPattern:c})),Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.annotation.queryField",{defaultMessage:"Target date field"})},Object(j.jsx)(k.g,{options:p,selectedOptions:m?[{label:m,value:{type:"field",field:m}}]:[],onChoose:function(e){e&&n({timeField:e.field})},fieldIsInvalid:!g,"data-test-subj":"lnsXY-annotation-query-based-field-picker"})))},ri=Object(b.htmlIdGenerator)(),oi=new Set(["string","boolean","number","ip","date"]);function ui(e){return null!=e.value}function ci({currentConfig:e,setConfig:t,indexPattern:a,invalidFields:n}){const{hasFieldData:i}=Object(Un.useExistingFieldsReader)(),r=Object(s.useCallback)((a=>{t({...e,extraFields:a.filter(ui).map((({value:e})=>e))})}),[t,e]),{wrappedValues:o,rawValuesLookup:c}=Object(s.useMemo)((()=>{var t;const a=null!==(t=e.extraFields)&&void 0!==t?t:[];return{wrappedValues:a.map((e=>({id:ri(),value:e}))),rawValuesLookup:new Set(a)}}),[e]),{inputValue:d,handleInputChange:p}=Object(k.F)({onChange:r,value:o}),m=Object(s.useCallback)(((e,t=0)=>{const n=[...d];a.getFieldByName(e.field)&&(n[t]={id:ri(),value:e.field},p(n))}),[d,a,p]),g=Object(j.jsx)(k.m,{className:"lnsConfigPanelAnnotations__addButton","data-test-subj":"lnsXY-annotation-tooltip-add_field",onClick:()=>{p([...d,{id:ri(),value:void 0,isNew:!0}])},label:u.i18n.translate("xpack.lens.xyChart.annotation.tooltip.addField",{defaultMessage:"Add field"}),isDisabled:d.length>2});if(0===d.length)return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFlexItem,{grow:!0},Object(j.jsx)(b.EuiPanel,{color:"subdued",paddingSize:"s",className:"lnsConfigPanelAnnotations__noFieldsPrompt"},Object(j.jsx)(b.EuiText,{color:"subdued",size:"s",textAlign:"center"},u.i18n.translate("xpack.lens.xyChart.annotation.tooltip.noFields",{defaultMessage:"None selected"})))),g);const f=a.fields.filter((({displayName:e,type:t})=>e&&!c.has(e)&&oi.has(t))).map((e=>({label:e.displayName,value:{type:"field",field:e.name,dataType:e.type},exists:i(a.id,e.name),compatible:!0,"data-test-subj":`lnsXY-annotation-tooltip-fieldOption-${e.name}`}))).sort(((e,t)=>e.label.localeCompare(t.label)));return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(k.e,{onDragEnd:e=>{p(e)},droppableId:"ANNOTATION_TOOLTIP_DROPPABLE_AREA",items:d,bgColor:"subdued"},d.map((({id:e,value:t,isNew:n},i,s)=>{const l=!t||Boolean(a.getFieldByName(t));return Object(j.jsx)(k.f,{id:(null!=t?t:"newField")+e,key:(null!=t?t:"newField")+e,idx:i,onRemoveClick:()=>{p(s.filter(((e,t)=>t!==i)))},removeTitle:u.i18n.translate("xpack.lens.xyChart.annotation.tooltip.deleteButtonLabel",{defaultMessage:"Delete"}),isNotDraggable:s.length<2,Container:k.h,isInsidePanel:!0,"data-test-subj":`lnsXY-annotation-tooltip-${i}`},Object(j.jsx)(k.g,{selectedOptions:t?[{label:t,value:{type:"field",field:t}}]:[],options:f,onChoose:e=>{m(e,i)},fieldIsInvalid:!l,className:"lnsConfigPanelAnnotations__fieldPicker","data-test-subj":`lnsXY-annotation-tooltip-field-picker--${i}`,autoFocus:n&&null==t}))}))),g)}const di=e=>{var t;const{state:a,setState:n,layerId:r,accessor:o,frame:c}=e,d=pa(a.layers),{hasFieldData:p}=Object(Un.useExistingFieldsReader)(),{inputValue:m,handleInputChange:g}=Object(k.F)({value:a,onChange:n}),f=m.layers.findIndex((e=>e.layerId===r)),h=m.layers.find((e=>e.layerId===r)),x=null===(t=h.annotations)||void 0===t?void 0:t.find((e=>e.id===o)),v=Object(qt.isQueryAnnotationConfig)(x),y=Object(qt.isRangeAnnotationConfig)(x),[O,I]=l.a.useState(!1);Object(s.useEffect)((()=>{I(!v)}),[v]);const T=Object(s.useCallback)((e=>{if(null==e)return;const t=[...h.annotations||[]],a=t.findIndex((e=>e.id===o));if(-1===a)throw new Error("should never happen because annotation is created before config panel is opened");{const n=t[a];t[a]=(e=>Object(qt.isRangeAnnotationConfig)(e)?Object(jt.pick)(e,["type","label","key","id","isHidden","color","outside"]):Object(qt.isQueryAnnotationConfig)(e)?Object(jt.pick)(e,["type","id","label","key","timeField","isHidden","lineStyle","lineWidth","color","icon","textVisibility","textField","filter","extraFields","ignoreGlobalFilters"]):Object(jt.pick)(e,["type","id","label","key","isHidden","lineStyle","lineWidth","color","icon","textVisibility"]))({...n,...e})}g(On(m,{...h,annotations:t},f))}),[o,f,m,h,g]);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(k.d,{title:u.i18n.translate("xpack.lens.xyChart.placement",{defaultMessage:"Placement"})},Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.annotationDate.placementType",{defaultMessage:"Placement type"}),display:"rowCompressed",fullWidth:!0},Object(j.jsx)(b.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.xyChart.annotationDate.placementType",{defaultMessage:"Placement type"}),"data-test-subj":"lns-xyAnnotation-placementType",name:"placementType",buttonSize:"compressed",options:[{id:"lens_xyChart_annotation_manual",label:u.i18n.translate("xpack.lens.xyChart.annotation.manual",{defaultMessage:"Static date"}),"data-test-subj":"lnsXY_annotation_manual"},{id:"lens_xyChart_annotation_query",label:u.i18n.translate("xpack.lens.xyChart.annotation.query",{defaultMessage:"Custom query"}),"data-test-subj":"lnsXY_annotation_query"}],idSelected:`lens_xyChart_annotation_${null==x?void 0:x.type}`,onChange:e=>{const t=e.replace("lens_xyChart_annotation_","");if((null==x?void 0:x.type)!==t){if("query"===t){var a,n;const e=c.dataViews.indexPatterns[h.indexPatternId],i=Object(qt.isRangeAnnotationConfig)(x)?{label:x.label===Ua?Wa:x.label,color:ei(x.color)}:{};return T({type:t,timeField:null!==(a=e.timeFieldName||(null===(n=e.fields.find((({type:e})=>"date"===e)))||void 0===n?void 0:n.displayName))&&void 0!==a?a:"",key:{type:"point_in_time"},...i})}return T({type:t,key:{type:"point_in_time",timestamp:$a()().toISOString()}})}},isFullWidth:!0})),v?Object(j.jsx)(li,{annotation:x,onChange:T,frame:c,state:a,layer:h,queryInputShouldOpen:O}):Object(j.jsx)(ii,{annotation:x,onChange:T,datatableUtilities:e.datatableUtilities,frame:c,state:a})),Object(j.jsx)(k.d,{title:u.i18n.translate("xpack.lens.xyChart.appearance",{defaultMessage:"Appearance"})},Object(j.jsx)(k.l,{value:(null==x?void 0:x.label)||Wa,defaultValue:Wa,onChange:e=>{T({label:e})}}),!y&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(Rn,{setConfig:T,defaultIcon:"triangle",currentConfig:{axisMode:"bottom",...x},customIconSet:Yn}),Object(j.jsx)(Nn,{setConfig:T,currentConfig:{axisMode:"bottom",...x},isQueryBased:v},(e=>{if("field"!==e)return null;const t=c.dataViews.indexPatterns[h.indexPatternId],a=t.fields.filter((({displayName:e,type:t})=>e&&"document"!==t)).map((e=>({label:e.displayName,value:{type:"field",field:e.name,dataType:e.type},exists:p(t.id,e.name),compatible:!0,"data-test-subj":`lnsXY-annotation-fieldOption-${e.name}`}))),n=x.textField,i=!n||Boolean(t.getFieldByName(n));return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"xs"}),Object(j.jsx)(Xn.a,{selectedOptions:n?[{label:n,value:{type:"field",field:n}}]:[],options:a,onChoose:function(e){e&&T({textField:e.field,textVisibility:!0})},fieldIsInvalid:!i,"data-test-subj":"lnsXY-annotation-query-based-text-decoration-field-picker",autoFocus:!n}))})),Object(j.jsx)(Vn,{isHorizontal:d,setConfig:T,currentConfig:x})),y&&Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.fillStyle",{defaultMessage:"Fill"}),display:"columnCompressed",fullWidth:!0},Object(j.jsx)(b.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.xyChart.fillStyle",{defaultMessage:"Fill"}),"data-test-subj":"lns-xyAnnotation-fillStyle",name:"fillStyle",buttonSize:"compressed",options:[{id:"lens_xyChart_fillStyle_inside",label:u.i18n.translate("xpack.lens.xyChart.fillStyle.inside",{defaultMessage:"Inside"}),"data-test-subj":"lnsXY_fillStyle_inside"},{id:"lens_xyChart_fillStyle_outside",label:u.i18n.translate("xpack.lens.xyChart.fillStyle.outside",{defaultMessage:"Outside"}),"data-test-subj":"lnsXY_fillStyle_inside"}],idSelected:"lens_xyChart_fillStyle_"+(Boolean(null==x?void 0:x.outside)?"outside":"inside"),onChange:e=>{T({outside:"lens_xyChart_fillStyle_outside"===e})},isFullWidth:!0})),Object(j.jsx)(En,i()({},e,{overwriteColor:null==x?void 0:x.color,defaultColor:y?qt.defaultAnnotationRangeColor:qt.defaultAnnotationColor,showAlpha:y,setConfig:T,disableHelpTooltip:!0,label:u.i18n.translate("xpack.lens.xyChart.lineColor.label",{defaultMessage:"Color"})})),Object(j.jsx)(pi,{label:u.i18n.translate("xpack.lens.xyChart.annotation.hide",{defaultMessage:"Hide annotation"}),"data-test-subj":"lns-annotations-hide-annotation",value:Boolean(null==x?void 0:x.isHidden),onChange:e=>T({isHidden:e.target.checked})})),v&&x&&Object(j.jsx)(k.d,{title:u.i18n.translate("xpack.lens.xyChart.tooltip",{defaultMessage:"Tooltip"})},Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",className:"lnsRowCompressedMargin",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.annotation.tooltip",{defaultMessage:"Show additional fields"})},Object(j.jsx)(ci,{currentConfig:x,setConfig:T,indexPattern:c.dataViews.indexPatterns[h.indexPatternId]}))))},pi=({label:e,"data-test-subj":t,value:a,onChange:n})=>Object(j.jsx)(b.EuiFormRow,{label:e,display:"columnCompressedSwitch",fullWidth:!0},Object(j.jsx)(b.EuiSwitch,{compressed:!0,label:e,showLabel:!1,"data-test-subj":t,checked:a,onChange:n}));function mi(e,t,a){const n=[...e.layers];return n[a]=t,{...e,layers:n}}const gi=Object(b.htmlIdGenerator)()();function fi(e){const{state:t,layerId:a}=e,n=t.layers.findIndex((e=>e.layerId===a)),i=t.layers[n];return Kt(i)?Object(j.jsx)(di,e):Xt(i)?Object(j.jsx)(Hn,e):Object(j.jsx)(bi,e)}function bi(e){var t;const{state:a,setState:n,layerId:r,accessor:o}=e,c=a.layers.findIndex((e=>e.layerId===r)),d=a.layers[c],{inputValue:p,handleInputChange:m}=Object(k.F)({value:e.state,onChange:e.setState}),g=null==d||null===(t=d.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===o)),f=(null==g?void 0:g.axisMode)||"auto",h=Object(s.useCallback)((e=>{if(null==e)return;const t=[...d.yConfig||[]],a=t.findIndex((e=>e.forAccessor===o));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:o,...e}),m(mi(p,{...d,yConfig:t},c))}),[o,c,p,d,m]),x=((e,t)=>{var a,n,i,s;return Kt(e)?(null==e||null===(i=e.annotations)||void 0===i||null===(s=i.find((e=>e.id===t)))||void 0===s?void 0:s.color)||null:Wt(e)&&e.splitAccessor?null:(null==e||null===(a=e.yConfig)||void 0===a||null===(n=a.find((e=>e.forAccessor===t)))||void 0===n?void 0:n.color)||null})(d,o),v=Object(s.useMemo)((()=>{var t;const n=dn(e.frame.datasourceLayers[d.layerId],d),i=on(Ut(a.layers),{tables:null!==(t=e.frame.activeData)&&void 0!==t?t:{}},e.formatFactory);return cn({...d,accessors:n.filter((e=>d.accessors.includes(e)))},o,i,e.frame,e.paletteService).color}),[e.frame,e.paletteService,a.layers,o,e.formatFactory,d]),y=d;if("breakdown"===e.groupId)return Object(j.jsx)(l.a.Fragment,null,!d.collapseFn&&Object(j.jsx)(k.o,{palettes:e.paletteService,activePalette:null==y?void 0:y.palette,setPalette:e=>{n(mi(p,{...y,palette:e},c))}}));const O=pa(a.layers);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(En,i()({},e,{overwriteColor:x,defaultColor:v,disabled:Boolean(!y.collapseFn&&y.splitAccessor),setConfig:h})),Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"})},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"}),"data-test-subj":"lnsXY_axisSide_groups",name:"axisSide",buttonSize:"compressed",options:[{id:`${gi}left`,label:O?u.i18n.translate("xpack.lens.xyChart.axisSide.bottom",{defaultMessage:"Bottom"}):u.i18n.translate("xpack.lens.xyChart.axisSide.left",{defaultMessage:"Left"}),"data-test-subj":"lnsXY_axisSide_groups_left"},{id:`${gi}auto`,label:u.i18n.translate("xpack.lens.xyChart.axisSide.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_axisSide_groups_auto"},{id:`${gi}right`,label:O?u.i18n.translate("xpack.lens.xyChart.axisSide.top",{defaultMessage:"Top"}):u.i18n.translate("xpack.lens.xyChart.axisSide.right",{defaultMessage:"Right"}),"data-test-subj":"lnsXY_axisSide_groups_right"}],idSelected:`${gi}${f}`,onChange:e=>{const t=e.replace(gi,"");h({axisMode:t})}})))}function hi(e){const{state:t,layerId:a}=e,n=t.layers.findIndex((e=>e.layerId===a)),i=t.layers[n],{inputValue:s,handleInputChange:r}=Object(k.F)({value:e.state,onChange:e.setState});return"breakdown"===e.groupId?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(R,{value:i.collapseFn||"",onChange:e=>{r(mi(s,{...i,collapseFn:e},n))}})):null}function xi(e){const t=e.state.layers.find((t=>t.layerId===e.layerId));return t?Xt(t)?Object(j.jsx)(yi,null):Kt(t)?Object(j.jsx)(ji,null):Object(j.jsx)(ki,e):null}function vi(e){const t=e.state.layers.find((t=>t.layerId===e.layerId));return t&&Kt(t)?Object(j.jsx)(Oi,e):null}function yi(){return Object(j.jsx)(k.r,{icon:x.q,label:u.i18n.translate("xpack.lens.xyChart.layerReferenceLineLabel",{defaultMessage:"Reference lines"})})}function ji(){return Object(j.jsx)(k.r,{icon:x.l,label:u.i18n.translate("xpack.lens.xyChart.layerAnnotationsLabel",{defaultMessage:"Annotations"})})}function Oi({frame:e,state:t,layerId:a,onChangeIndexPattern:n}){const i=u.i18n.translate("xpack.lens.layerPanel.missingDataView",{defaultMessage:"Data view not found"}),s=t.layers.findIndex((e=>e.layerId===a)),l=t.layers[s],r=e.dataViews.indexPatterns[l.indexPatternId];return Object(j.jsx)(k.c,{"data-test-subj":"indexPattern-switcher",trigger:{label:(null==r?void 0:r.name)||i,title:(null==r?void 0:r.title)||i,"data-test-subj":"lns_layerIndexPatternLabel",size:"s",fontWeight:"normal"},indexPatternId:l.indexPatternId,indexPatternRefs:e.dataViews.indexPatternRefs,isMissingCurrent:!r,onChangeIndexPattern:n})}function ki(e){const[t,a]=Object(s.useState)(!1),{state:n,layerId:i}=e,r=n.layers.filter(Wt).find((e=>e.layerId===i)),o=n.layers.findIndex((e=>e===r)),c=zt.visualizationTypes.find((({id:e})=>e===r.seriesType)),d=pa(n.layers);return Object(j.jsx)(b.EuiPopover,{panelClassName:"lnsChangeIndexPatternPopover",button:Object(j.jsx)(Ii,{onClick:()=>a(!t),currentVisType:c}),isOpen:t,closePopover:()=>a(!1),display:"block",panelPaddingSize:"s",ownFocus:!0},Object(j.jsx)(b.EuiPopoverTitle,null,u.i18n.translate("xpack.lens.layerPanel.layerVisualizationType",{defaultMessage:"Layer visualization type"})),Object(j.jsx)("div",null,Object(j.jsx)(b.EuiSelectable,{singleSelection:"always",options:zt.visualizationTypes.filter((e=>da(e.id)===d)).map((e=>({value:e.id,key:e.id,checked:e.id===c.id?"on":void 0,prepend:Object(j.jsx)(b.EuiIcon,{type:e.icon}),label:e.fullLabel||e.label,"data-test-subj":`lnsXY_seriesType-${e.id}`}))),onChange:t=>{const i=t.find((({checked:e})=>"on"===e));if(!i)return;const s=i.value;e.setState(On(n,{...r,seriesType:s},o)),a(!1)}},(e=>Object(j.jsx)(l.a.Fragment,null,e)))))}const Ii=function({currentVisType:e,onClick:t}){return Object(j.jsx)(d.ToolbarButton,{"data-test-subj":"lns_layer_settings",title:e.fullLabel||e.label,onClick:t,fullWidth:!0,size:"s"},Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiIcon,{type:e.icon}),Object(j.jsx)(b.EuiText,{size:"s",className:"lnsLayerPanelChartSwitch_title"},e.fullLabel||e.label)))},Ti=Object(j.jsx)("p",null,u.i18n.translate("xpack.lens.configure.invalidConfigTooltip",{defaultMessage:"Invalid configuration."}),Object(j.jsx)("br",null),u.i18n.translate("xpack.lens.configure.invalidConfigTooltipClick",{defaultMessage:"Click for more details."})),wi=({id:e,label:t,isInvalid:a,hideTooltip:n,invalidMessage:i=Ti})=>a?Object(j.jsx)(b.EuiToolTip,{content:n?null:i,anchorClassName:"eui-displayBlock"},Object(j.jsx)(b.EuiText,{size:"s",color:"danger",id:e,className:"lnsLayerPanel__triggerText","data-test-subj":"lns-dimensionTrigger"},Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiIcon,{size:"s",type:"alert"})),Object(j.jsx)(b.EuiFlexItem,{grow:!0},t)))):Object(j.jsx)(b.EuiText,{size:"s",id:e,className:"lnsLayerPanel__triggerText","data-test-subj":"lns-dimensionTrigger"},Object(j.jsx)(b.EuiFlexItem,{grow:!0},Object(j.jsx)("span",null,Object(j.jsx)("span",{className:"lnsLayerPanel__triggerTextLabel"},t))));var Mi=a(88);const Ci="ignoreGlobalFilters",Si="keepGlobalFilters",Fi=({core:e,storage:t,data:a,paletteService:n,fieldFormats:s,useLegacyTimeAxis:l,kibanaTheme:o,eventAnnotationService:p,unifiedSearch:m})=>({id:"lnsXY",visualizationTypes:zt.visualizationTypes,getVisualizationTypeId(e){const t=Zt(e);return"mixed"===t?t:t.id},getLayerIds:e=>la(e).map((e=>e.layerId)),getRemoveOperation(e,t){const a=la(e,_.LayerTypes.DATA).map((e=>e.layerId));return a.includes(t)&&1===a.length?"clear":"remove"},removeLayer:(e,t)=>({...e,layers:e.layers.filter((e=>e.layerId!==t))}),cloneLayer(e,t,a,n){const i=e.layers.find((e=>e.layerId===t));if(i){Kt(i)&&i.annotations.forEach((e=>n.set(e.id,Object(Ge.a)())));const t=Object(Gt.renewIDs)(i,[...n.keys()],(e=>n.get(e)));return t.layerId=a,{...e,layers:[...e.layers,t]}}return e},appendLayer(e,t,a,n){var i,s;if("metricTrendline"===a)return e;const l=null===(i=Ut(e.layers))||void 0===i||null===(s=i[0])||void 0===s?void 0:s.seriesType;return{...e,layers:[...e.layers,sa({seriesType:l||e.preferredSeriesType,layerId:t,layerType:a,indexPatternId:n})]}},clearLayer:(e,t,a)=>({...e,layers:e.layers.map((n=>n.layerId!==t?n:sa({seriesType:e.preferredSeriesType,layerId:t,indexPatternId:a})))}),getPersistableState:e=>function(e){const t=[],a=[];return e.layers.forEach((e=>{if(Kt(e)){const{indexPatternId:n,...i}=e;t.push({type:"index-pattern",id:n,name:fa(e.layerId)}),a.push(i)}else a.push(e)})),{savedObjectReferences:t,state:{...e,layers:a}}}(e),fromPersistableState:(e,t,a)=>function(e,t,a){if(!t||!t.length)return e;const n=t.find((({type:e})=>"index-pattern"===e)).id;return{...e,layers:e.layers.map((e=>{var i;return Kt(e)?{...e,indexPatternId:ba(e,a)||(null===(i=t.find((({name:t})=>t===fa(e.layerId))))||void 0===i?void 0:i.id)||n}:e}))}}(e,t,a),getDescription:Jt,switchVisualizationType:(e,t)=>({...t,preferredSeriesType:e,layers:t.layers.map((t=>({...t,seriesType:e})))}),getSuggestions:va,triggers:[A.VIS_EVENT_TO_TRIGGER.filter,A.VIS_EVENT_TO_TRIGGER.brush],initialize:(e,t)=>t||{title:"Empty XY chart",legend:{isVisible:!0,position:et.Position.Right},valueLabels:"hide",preferredSeriesType:ta,layers:[{layerId:e(),accessors:[],position:et.Position.Top,seriesType:ta,showGridlines:!1,layerType:_.LayerTypes.DATA}]},getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},getSupportedLayers:(e,t)=>[aa,Ka(e,t),sn(e,t)],getSupportedActionsForLayer(e,t){const a=t.layers.findIndex((t=>t.layerId===e)),n=t.layers[a],i=[];return Kt(n)&&i.push(...(({state:e,layer:t,layerIndex:a})=>{const n=t.ignoreGlobalFilters?u.i18n.translate("xpack.lens.xyChart.annotations.keepGlobalFiltersLabel",{defaultMessage:"Keep global filters"}):u.i18n.translate("xpack.lens.xyChart.annotations.ignoreGlobalFiltersLabel",{defaultMessage:"Ignore global filters"});return[{id:t.ignoreGlobalFilters?Si:Ci,displayName:n,description:t.ignoreGlobalFilters?u.i18n.translate("xpack.lens.xyChart.annotations.keepGlobalFiltersDescription",{defaultMessage:"All the dimensions configured in this layer respect filters defined at kibana level."}):u.i18n.translate("xpack.lens.xyChart.annotations.ignoreGlobalFiltersDescription",{defaultMessage:"All the dimensions configured in this layer ignore filters defined at kibana level."}),icon:t.ignoreGlobalFilters?"filter":"filterIgnore",isCompatible:!0,"data-test-subj":t.ignoreGlobalFilters?"lnsXY_annotationLayer_keepFilters":"lnsXY_annotationLayer_ignoreFilters"}]})({state:t,layerIndex:a,layer:n})),i},onLayerAction:(e,t,a)=>[Ci,Si].includes(t)?{...a,layers:a.layers.map((t=>t.layerId===e?{...t,ignoreGlobalFilters:!t.ignoreGlobalFilters}:t))}:a,onIndexPatternChange(e,t,a){const n=e.layers.findIndex((e=>e.layerId===a)),i=e.layers[n];if(!i||!Kt(i))return e;const s=[...e.layers];return s[n]={...i,indexPatternId:t},{...e,layers:s}},getConfiguration({state:e,frame:t,layerId:a}){var i,l;const r=e.layers.find((e=>e.layerId===a));if(!r)return{groups:[]};if(Kt(r))return(({state:e,frame:t,layer:a})=>{const n=Xa(Ut(e.layers),t),i=Ht("x",{isHorizontal:pa(e.layers)}),s={buttonAriaLabel:u.i18n.translate("xpack.lens.indexPattern.addColumnAriaLabelClick",{defaultMessage:"Add an annotation to {groupLabel}",values:{groupLabel:i}}),buttonLabel:u.i18n.translate("xpack.lens.configure.emptyConfigClick",{defaultMessage:"Add an annotation"})};return{groups:[{groupId:"xAnnotations",groupLabel:i,dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.indexPattern.annotationsDimensionEditorLabel",{defaultMessage:"{groupLabel} annotation",values:{groupLabel:i}}),accessors:en(a),dataTestSubj:"lnsXY_xAnnotationsPanel",invalid:!n,invalidMessage:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),requiredMinDimensionCount:0,supportsMoreColumns:!0,supportFieldFormat:!1,enableDimensionEditor:!0,filterOperations:()=>!1,labels:s}]}})({state:e,frame:t,layer:r});const o=dn(t.datasourceLayers[r.layerId],r);if(Xt(r))return(({state:e,frame:t,layer:a,sortedAccessors:n})=>{const i=n.reduce(((e,t,a)=>(e[t]=a,e)),{}),{bottom:s,left:l,right:r}=Object(jt.groupBy)([...a.yConfig||[]].sort((({forAccessor:e},{forAccessor:t})=>i[e]-i[t])),(({axisMode:e})=>e)),o=function(e,t,a,n){if(!t)return[];const i=an(Ut(t.layers),a,n);return e.filter((({label:e,config:t})=>i[e]||(null==t?void 0:t.length))).map((e=>({...e,valid:i[e.label]})))}([{config:l,id:"yReferenceLineLeft",label:"yLeft",dataTestSubj:"lnsXY_yReferenceLineLeftPanel"},{config:r,id:"yReferenceLineRight",label:"yRight",dataTestSubj:"lnsXY_yReferenceLineRightPanel"},{config:s,id:"xReferenceLine",label:"x",dataTestSubj:"lnsXY_xReferenceLinePanel"}],e,t.datasourceLayers,t.activeData),c=pa(e.layers);return{groups:o.map((({config:e=[],id:t,label:a,dataTestSubj:n,valid:i})=>({groupId:t,groupLabel:Ht(a,{isHorizontal:c}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.indexPattern.referenceLineDimensionEditorLabel",{defaultMessage:"{groupLabel} reference line",values:{groupLabel:Ht(a,{isHorizontal:c})}}),accessors:e.map((({forAccessor:e,color:t})=>ln(e,t))),filterOperations:oa,supportsMoreColumns:!0,requiredMinDimensionCount:0,enableDimensionEditor:!0,supportStaticValue:!0,paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.indexPattern.staticValue.label",{defaultMessage:"Reference line value"})],headingLabel:u.i18n.translate("xpack.lens.staticValue.headingLabel",{defaultMessage:"Placement"})},supportFieldFormat:!1,dataTestSubj:n,invalid:!i,invalidMessage:"x"===a?u.i18n.translate("xpack.lens.configure.invalidBottomReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists or is no longer valid. You may move this reference line to another available axis or remove it."}):u.i18n.translate("xpack.lens.configure.invalidReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists. You may move this reference line to another available axis or remove it."}),requiresPreviousColumnOnDuplicate:!0})))}})({state:e,frame:t,layer:r,sortedAccessors:o});const c=Ei({state:e,frame:t,layer:r,fieldFormats:s,paletteService:n,accessors:o}),d=r,p=Ut(e.layers),m=pa(e.layers),{left:g,right:f}=Sa([r],t.activeData),b=Boolean(d.accessors.length<2||g.length&&g.length<2||f.length&&f.length<2)&&p.filter((e=>{if(Wt(e)&&e.seriesType===d.seriesType&&Boolean(e.xAccessor)===Boolean(d.xAccessor)&&Boolean(e.splitAccessor)===Boolean(d.splitAccessor)){const{left:a,right:n}=Sa([e],t.activeData);return e.accessors.length&&(Boolean(a.length)===Boolean(g.length)||Boolean(n.length)===Boolean(f.length))}return!1})).length<2;return{groups:[{groupId:"x",groupLabel:Ht("x",{isHorizontal:m}),accessors:d.xAccessor?[{columnId:d.xAccessor}]:[],filterOperations:ca,supportsMoreColumns:!d.xAccessor,dataTestSubj:"lnsXY_xDimensionPanel"},{groupId:"y",groupLabel:Ht("y",{isHorizontal:m}),accessors:c,filterOperations:ua,isMetricDimension:!0,supportsMoreColumns:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsXY_yDimensionPanel",enableDimensionEditor:!0},{groupId:"breakdown",groupLabel:u.i18n.translate("xpack.lens.xyChart.splitSeries",{defaultMessage:"Breakdown"}),accessors:d.splitAccessor?[{columnId:d.splitAccessor,triggerIcon:d.collapseFn?"aggregate":"colorBy",palette:d.collapseFn?void 0:n.get((null===(i=d.palette)||void 0===i?void 0:i.name)||"default").getCategoricalColors(10,null===(l=d.palette)||void 0===l?void 0:l.params)}]:[],filterOperations:ca,supportsMoreColumns:!d.splitAccessor,dataTestSubj:"lnsXY_splitDimensionPanel",requiredMinDimensionCount:d.seriesType.includes("percentage")&&b?1:0,enableDimensionEditor:!0}]}},getMainPalette:e=>{var t;if(e&&0!==e.layers.length)return null===(t=(e.layers||[]).find((e=>Wt(e))))||void 0===t?void 0:t.palette},getDropProps(e){if(!e.source)return;const t=e.source.indexPatternId,a=e.target.indexPatternId;if(a&&t===a){if(Object(Gt.isDraggedDataViewField)(e.source)){if("document"===e.source.field.type)return;return e.target.isNewColumn?{dropTypes:["field_add"]}:{dropTypes:["field_replace"]}}return Object(Gt.isOperationFromTheSameGroup)(e.source,e.target)?e.target.isNewColumn?{dropTypes:["duplicate_compatible"]}:{dropTypes:["reorder"]}:Object(Gt.isOperationFromCompatibleGroup)(e.source,e.target)?{dropTypes:e.target.isNewColumn?["move_compatible","duplicate_compatible"]:["replace_compatible","replace_duplicate_compatible","swap_compatible"]}:void 0}},onDrop(e){const t=e.prevState.layers.find((t=>t.layerId===e.target.layerId));if(!t)throw new Error("target layer should exist");return Kt(t)?(null==Ja?void 0:Ja(e))||e.prevState:Object(Mi.d)(e,this)},setDimension(e){const{prevState:t,layerId:a,columnId:n,groupId:i}=e,s=t.layers.find((e=>e.layerId===a));if(!s)return t;if(Xt(s))return(({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i})=>{var s,l;const r=e.layers.find((e=>e.layerId===t));if(!r||!Xt(r))return e;const o={...r};o.accessors=[...o.accessors.filter((e=>e!==a)),a];const u=null===(s=o.yConfig)||void 0===s?void 0:s.some((({forAccessor:e})=>e===a)),c=!!i&&(null===(l=Yt(e.layers).map((({yConfig:e})=>e)).flat())||void 0===l?void 0:l.find((e=>(null==e?void 0:e.forAccessor)===i)));if(!u){const e="xReferenceLine"===n?"bottom":"yReferenceLineRight"===n?"right":"left";o.yConfig=[...o.yConfig||[],{...c,forAccessor:a,axisMode:e}]}return{...e,layers:e.layers.map((e=>e.layerId===t?o:e))}})(e);if(Kt(s))return(({prevState:e,layerId:t,columnId:a,previousColumn:n,frame:i})=>{var s;const l=e.layers.find((e=>e.layerId===t));if(!l||!Kt(l))return e;const r=n?null===(s=l.annotations)||void 0===s?void 0:s.find((({id:e})=>e===n)):void 0;return{...e,layers:e.layers.map((n=>n.layerId===t?{...l,annotations:[...l.annotations,Za(a,Ya(Ut(e.layers),i),r)]}:n))}})(e);const l=Object.assign({},s);return"x"===i&&(l.xAccessor=n),"y"===i&&(l.accessors=[...l.accessors.filter((e=>e!==n)),n]),"breakdown"===i&&(l.splitAccessor=n),{...t,layers:t.layers.map((e=>e.layerId===a?l:e))}},removeDimension({prevState:e,layerId:t,columnId:a,frame:n}){const i=e.layers.find((e=>e.layerId===t));if(!i)return e;if(Kt(i)){const n={...i,annotations:i.annotations.filter((({id:e})=>e!==a))},s=e.layers.map((e=>e.layerId===t?n:e));return{...e,layers:s}}const s={...i};var l;Wt(s)&&(s.xAccessor===a?delete s.xAccessor:s.splitAccessor===a&&(delete s.splitAccessor,delete s.palette)),s.accessors.includes(a)&&(s.accessors=s.accessors.filter((e=>e!==a))),"yConfig"in s&&(s.yConfig=null===(l=s.yConfig)||void 0===l?void 0:l.filter((({forAccessor:e})=>e!==a)));let r=e.layers.map((e=>e.layerId===t?s:e));const o=an(Ut(e.layers),n.datasourceLayers,n.activeData);return Object.keys(o).every((e=>!o[e]))&&(r=r.filter((e=>Wt(e)||"accessors"in e&&e.accessors.length))),{...e,layers:r}},renderLayerPanel(e,t){const{onChangeIndexPattern:a,...n}=t;Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:o.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(vi,i()({},n,{onChangeIndexPattern:e=>{a(e)}})))),e)},renderLayerHeader(e,t){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:o.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(xi,t))),e)},renderToolbar(e,t){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:o.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(wn,i()({},t,{useLegacyTimeAxis:l})))),e)},renderDimensionEditor(i,l){const u={...l,datatableUtilities:a.datatableUtilities,formatFactory:s.deserialize,paletteService:n},p=l.state.layers.find((e=>e.layerId===l.layerId)),g=Xt(p)?Object(j.jsx)(Hn,u):Kt(p)?Object(j.jsx)(di,u):Object(j.jsx)(fi,u);Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:o.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(d.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:e.uiSettings,data:a,fieldFormats:s,savedObjects:e.savedObjects,docLinks:e.docLinks,http:e.http,unifiedSearch:m}},g))),i)},renderDimensionEditorDataExtra(i,l){const u={...l,datatableUtilities:a.datatableUtilities,formatFactory:s.deserialize,paletteService:n},p=l.state.layers.find((e=>e.layerId===l.layerId));Xt(p)||Kt(p)||Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:o.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(d.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:e.uiSettings,data:a,fieldFormats:s,savedObjects:e.savedObjects,docLinks:e.docLinks,http:e.http,unifiedSearch:m}},Object(j.jsx)(hi,u)))),i)},toExpression:(e,t,a,i={})=>pn(e,t,n,a,i,p),toPreviewExpression:(e,t,a={})=>function(e,t,a,n,i){return pn({...e,layers:e.layers.map((e=>((e,t)=>Wt(e)?t[Ot.layerTypes.DATA](e):Xt(e)?t[Ot.layerTypes.REFERENCELINE](e):t[Ot.layerTypes.ANNOTATIONS](e))(e,mn))),legend:{...e.legend,isVisible:!1},valueLabels:"hide"},t,a,{},n,i)}(e,t,n,a,p),validateColumn(e,t,a,n,i){const{invalid:s,invalidMessages:l}=ha(e,t,a,n,i);return s?{invalid:s,invalidMessage:l[0]}:{invalid:s}},getErrorMessages(e,t){const{datasourceLayers:a,dataViews:n}=t||{},i=[],s=Qt(e.layers);n&&s.forEach((t=>{t.annotations.forEach((a=>{var s;const l=ha(e,{dataViews:n},t.layerId,a.id);null!=l&&l.invalid&&null!==(s=l.invalidMessages)&&void 0!==s&&s.length&&i.push(...l.invalidMessages.map((e=>({shortMessage:e,longMessage:Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.xyChart.annotationError",defaultMessage:"Annotation {annotationName} has an error: {errorMessage}",values:{annotationName:a.label,errorMessage:e}})}))))}))}));const l=({accessors:e})=>null==e||0===e.length,r=Ut(e.layers),o=({splitAccessor:e,seriesType:t})=>t.includes("percentage")&&null==e;if(e&&e.layers.length>1){const e=[["Y",l],["Break down",o]],t=r.filter((({accessors:e,xAccessor:t,splitAccessor:a,layerType:n})=>e.length>0||null!=t||null!=a));for(const[a,n]of e){const e=ra(a,t,n);e.valid||i.push(e.payload)}}if(a&&e){i.push(...function(e,t){const a=Ut(e.layers),n=[],i=a.findIndex($t("interval","date",t)),s=a.findIndex($t("interval","number",t)),l=a.findIndex($t("ordinal",void 0,t));if(e.layers.length>1){const t=[i,s,l].filter((e=>e>=0)).sort(((e,t)=>e-t));if(t.length>1){const[a,...i]=t,s=Ht("x",{isHorizontal:pa(e.layers)});for(const e of i)n.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:s}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXLong",{defaultMessage:"The {axis} data in layer {firstLayer} is incompatible with the data in layer {secondLayer}. Select a new function for the {axis}.",values:{axis:s,firstLayer:a+1,secondLayer:e+1}})})}}return n}(e,a));for(const t of Ut(e.layers)){const n=a[t.layerId];if(n)for(const a of t.accessors){const t=n.getOperationForColumnId(a);t&&"number"!==t.dataType&&i.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:Ht("y",{isHorizontal:pa(e.layers)})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYLong",{defaultMessage:"The dimension {label} provided for the {axis} has the wrong data type. Expected number but have {dataType}",values:{label:t.label,dataType:t.dataType,axis:Ht("y",{isHorizontal:pa(e.layers)})}})})}}}return i.length?i:void 0},getWarningMessages(e,t){if(0===(null==e?void 0:e.layers.length)||!t.activeData)return;const a=[...Ut(e.layers),...Yt(e.layers)].filter((({accessors:e})=>e.length>0)),n=[];for(const e of a){var i;const{layerId:a,accessors:s}=e,l=(null===(i=t.activeData)||void 0===i?void 0:i[a])&&t.activeData[a].rows;if(!l)break;const r=ga(e,t.datasourceLayers[a]);for(const e of s)l.some((t=>Array.isArray(t[e])))&&n.push(r[e])}return n.map((e=>Object(j.jsx)(c.FormattedMessage,{key:e,id:"xpack.lens.xyVisualization.arrayValues",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(j.jsx)("strong",null,e)}})))},getUniqueLabels:e=>tn(e.layers),getUsedDataView(e,t){var a;return null===(a=Qt(e.layers).find((e=>e.layerId===t)))||void 0===a?void 0:a.indexPatternId},getUsedDataViews(e){var t;return null!==(t=null==e?void 0:e.layers.filter(Kt).map((({indexPatternId:e})=>e)))&&void 0!==t?t:[]},renderDimensionTrigger:({columnId:e,label:t,hideTooltip:a,invalid:n,invalidMessage:i})=>t?Object(j.jsx)(wi,{id:e,hideTooltip:a,isInvalid:n,invalidMessage:i,label:t||Wa}):null,getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(e){const t=pa(e.layers);return{layers:e.layers.map((e=>{const a=[];let n,i,s;if(Wt(e)){n=e.seriesType;const l=zt.visualizationTypes.find((e=>e.id===n));i=null==l?void 0:l.icon,s=(null==l?void 0:l.fullLabel)||(null==l?void 0:l.label),e.xAccessor&&a.push({name:Ht("x",{isHorizontal:t}),id:e.xAccessor}),e.accessors&&e.accessors.length&&e.accessors.forEach((e=>{a.push({name:Ht("y",{isHorizontal:t}),id:e})})),e.splitAccessor&&a.push({name:u.i18n.translate("xpack.lens.xyChart.splitSeries",{defaultMessage:"Breakdown"}),id:e.splitAccessor})}return Xt(e)&&e.accessors&&e.accessors.length&&(e.accessors.forEach((e=>{a.push({name:u.i18n.translate("xpack.lens.xyChart.layerReferenceLine",{defaultMessage:"Reference line"}),id:e})})),s=u.i18n.translate("xpack.lens.xyChart.layerReferenceLineLabel",{defaultMessage:"Reference lines"}),i=x.q),Kt(e)&&e.annotations&&e.annotations.length&&(e.annotations.forEach((e=>{a.push({name:u.i18n.translate("xpack.lens.xyChart.layerAnnotation",{defaultMessage:"Annotation"}),id:e.id})})),s=u.i18n.translate("xpack.lens.xyChart.layerAnnotationsLabel",{defaultMessage:"Annotations"}),i=x.l),{layerId:e.layerId,layerType:e.layerType,chartType:n,icon:i,label:s,dimensions:a}}))}}}),Ei=({accessors:e,frame:t,fieldFormats:a,paletteService:n,state:i,layer:s})=>{let l=e.map((e=>({columnId:e})));return t.activeData&&(l=function(e,t,a,n){if(Xt(a))return(e=>e.accessors.map((t=>{var a;const n=null===(a=e.yConfig)||void 0===a?void 0:a.find((e=>e.forAccessor===t));return ln(t,null==n?void 0:n.color)})))(a);if(Kt(a))return en(a);const i=!a.collapseFn&&a.splitAccessor;return a.accessors.map((s=>{var l;if(i)return un(s);const r=null===(l=a.yConfig)||void 0===l?void 0:l.find((e=>e.forAccessor===s));return null!=r&&r.color?{columnId:s,triggerIcon:"color",color:r.color}:cn(a,s,e,t,n)}))}(on(Ut(i.layers),{tables:t.activeData},a.deserialize),t,{...s,accessors:e.filter((e=>s.accessors.includes(e)))},n)),l};var Pi=a(10);class xy_XyVisualization{setup(e,{editorFrame:t}){t.registerVisualization((async()=>{const{getXyVisualization:t}=await Promise.resolve().then(a.bind(null,493)),[n,{charts:i,data:s,fieldFormats:l,eventAnnotation:r,unifiedSearch:o}]=await e.getStartServices(),[u,c]=await Promise.all([i.palettes.getPalettes(),r.getService()]),d=e.uiSettings.get(Z.LEGACY_TIME_AXIS);return t({core:n,data:s,storage:new Pi.Storage(localStorage),paletteService:u,eventAnnotationService:c,fieldFormats:l,useLegacyTimeAxis:d,kibanaTheme:e.theme,unifiedSearch:o})}))}}const Ai="temperature",_i=u.i18n.translate("xpack.lens.heatmap.groupLabel",{defaultMessage:"Heatmap"}),Li="heatmap",Di={heatmap:{shapeType:Li,icon:x.u,label:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:_i}},Ni="x",Ri="y",Bi="cell",Vi="heatmap_legend",zi="heatmap_grid",Gi=({table:e,state:t,keptLayerIds:a})=>{var n,i,s,l,r,o,c,d,p,m,g,f,b,h,x;if((null==t?void 0:t.shape)===Li&&(t.xAccessor||t.yAccessor||t.valueAccessor)&&"extended"!==e.changeType||e.columns.some((e=>e.operation.isStaticValue))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];if(t&&"unchanged"===e.changeType||a.length>1||a.length&&e.layerId!==a[0])return[];let v=0;const[y,j]=Object(jt.partition)(e.columns,(e=>e.operation.isBucketed));if(0===y.length&&0===j.length)return[];if(y.length>=3)return[];if(j.length>1)return[];const O=1===y.length&&0===j.length,k=0===y.length&&1===j.length,I=1===j.length&&y.length>0&&y.every((e=>"date"===e.operation.dataType)),T="reduced"===e.changeType||"reorder"===e.changeType||O||I||k,w={shape:Li,layerId:e.layerId,layerType:_.LayerTypes.DATA,legend:{isVisible:null===(n=null==t||null===(i=t.legend)||void 0===i?void 0:i.isVisible)||void 0===n||n,position:null!==(s=null==t||null===(l=t.legend)||void 0===l?void 0:l.position)&&void 0!==s?s:et.Position.Right,type:Vi},gridConfig:{type:zi,isCellLabelVisible:!1,isYAxisLabelVisible:null===(r=null==t||null===(o=t.gridConfig)||void 0===o?void 0:o.isYAxisLabelVisible)||void 0===r||r,isXAxisLabelVisible:null===(c=null==t||null===(d=t.gridConfig)||void 0===d?void 0:d.isXAxisLabelVisible)||void 0===c||c,isYAxisTitleVisible:null!==(p=null==t||null===(m=t.gridConfig)||void 0===m?void 0:m.isYAxisTitleVisible)&&void 0!==p&&p,isXAxisTitleVisible:null!==(g=null==t||null===(f=t.gridConfig)||void 0===f?void 0:f.isXAxisTitleVisible)&&void 0!==g&&g}},M=j.find((e=>"number"===e.operation.dataType));M&&(v+=.3,w.valueAccessor=M.columnId);const[C,S]=Object(jt.partition)(y,(e=>"interval"===e.operation.scale));return w.xAccessor=(null===(b=C[0])||void 0===b?void 0:b.columnId)||(null===(h=S[0])||void 0===h?void 0:h.columnId),w.yAccessor=null===(x=y.find((e=>e.columnId!==w.xAccessor)))||void 0===x?void 0:x.columnId,y.some((e=>"date"===e.operation.dataType))||(w.xAccessor&&(v+=.3),w.yAccessor&&(v+=.3)),[{state:w,title:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),hide:T,previewIcon:"empty",score:Number(v.toFixed(1))}]};a(244);const qi=[{id:"heatmap_legend_show",value:"show",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"heatmap_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.hide",{defaultMessage:"Hide"})}],Hi=Object(s.memo)((e=>{var t;const{state:a,setState:n,frame:i}=e,l=a.legend.isVisible?"show":"hide",r=pt(a,i.datasourceLayers).truncateText,o=null==a?void 0:a.legend.legendSize,[c]=Object(s.useState)((()=>o===A.LegendSize.AUTO));return Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(j.jsx)(k.s,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(j.jsx)(k.u,{valueLabels:null!=a&&a.gridConfig.isCellLabelVisible?"show":"hide",onValueLabelChange:e=>{n({...a,gridConfig:{...a.gridConfig,isCellLabelVisible:"show"===e}})}})),Object(j.jsx)(k.j,{groupPosition:"right",legendOptions:qi,mode:l,onDisplayChange:e=>{const t=qi.find((({id:t})=>t===e)).value;"show"===t?n({...a,legend:{...a.legend,isVisible:!0}}):"hide"===t&&n({...a,legend:{...a.legend,isVisible:!1}})},position:null==a?void 0:a.legend.position,onPositionChange:e=>{n({...a,legend:{...a.legend,position:e}})},maxLines:null==a?void 0:a.legend.maxLines,onMaxLinesChange:e=>{n({...a,legend:{...a.legend,maxLines:e}})},shouldTruncate:null!==(t=null==a?void 0:a.legend.shouldTruncate)&&void 0!==t?t:r,onTruncateLegendChange:()=>{var e;const t=null!==(e=a.legend.shouldTruncate)&&void 0!==e?e:r;n({...a,legend:{...a.legend,shouldTruncate:!t}})},legendSize:o,onLegendSizeChange:e=>{n({...a,legend:{...a.legend,legendSize:e}})},showAutoLegendSizeOption:c}))),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(j.jsx)(k.t,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.verticalAxisDisabledHelpText",{defaultMessage:"This setting only applies when vertical axis is enabled."}),condition:!Boolean(null==a?void 0:a.yAccessor)},Object(j.jsx)(k.s,{title:u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),type:x.c,groupPosition:"left",isDisabled:!Boolean(null==a?void 0:a.yAccessor),buttonDataTestSubj:"lnsHeatmapVerticalAxisButton",panelClassName:"lnsVisToolbarAxis__popover"},Object(j.jsx)(k.a,{axis:"yLeft",axisTitle:null==a?void 0:a.gridConfig.yTitle,updateTitleState:({title:e,visible:t})=>{n({...a,gridConfig:{...a.gridConfig,yTitle:e,isYAxisTitleVisible:t}})},isAxisTitleVisible:null==a?void 0:a.gridConfig.isYAxisTitleVisible}))),Object(j.jsx)(k.t,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.horizontalAxisDisabledHelpText",{defaultMessage:"This setting only applies when horizontal axis is enabled."}),condition:!Boolean(null==a?void 0:a.xAccessor)},Object(j.jsx)(k.s,{title:u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),type:x.b,groupPosition:"center",isDisabled:!Boolean(null==a?void 0:a.xAccessor),buttonDataTestSubj:"lnsHeatmapHorizontalAxisButton"},Object(j.jsx)(k.a,{axis:"x",axisTitle:null==a?void 0:a.gridConfig.xTitle,updateTitleState:({title:e,visible:t})=>n({...a,gridConfig:{...a.gridConfig,xTitle:e,isXAxisTitleVisible:t}}),isAxisTitleVisible:null==a?void 0:a.gridConfig.isXAxisTitleVisible}))))))}));function $i(e,t,a,n){if(null==t||null==a)return{displayStops:[],activePalette:n};const i=null!=n?n:{type:"palette",name:Ai,accessor:a},s=Object(k.A)([a],t)[a];return{displayStops:Object(k.w)(e,i,s),currentMinMax:s,activePalette:i}}function Wi(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,[o,c]=Object(s.useState)(!1);if((null==a?void 0:a.valueAccessor)!==r)return null;const d=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],{displayStops:p,activePalette:g,currentMinMax:f}=$i(e.paletteService,d,r,null!=a&&a.palette&&a.palette.accessor===r?a.palette:void 0);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteHeatmapGradient.label",{defaultMessage:"Color"})},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsHeatmap_dynamicColoring_palette",palette:p.map((({color:e})=>e)),type:m.i,onClick:()=>{c(!o)}})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsHeatmap_dynamicColoring_trigger","aria-label":u.i18n.translate("xpack.lens.paletteHeatmapGradient.customizeLong",{defaultMessage:"Edit palette"}),iconType:"controlsHorizontal",onClick:()=>{c(!o)},size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteHeatmapGradient.customize",{defaultMessage:"Edit"})),Object(j.jsx)(k.n,{siblingRef:e.panelRef,isOpen:o,handleClose:()=>c(!o)},g&&Object(j.jsx)(m.b,{palettes:e.paletteService,activePalette:g,dataBounds:f,setPalette:e=>{e.params&&!e.params.stops&&(e.params.stops=p),e.accessor=r,n({...a,palette:e})}}))))))}a(249);const Ui=u.i18n.translate("xpack.lens.heatmapVisualization.heatmapGroupLabel",{defaultMessage:"Magnitude"});function Xi(e){const t=u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),a=u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});return"x"===e?a:t}const Yi=e=>e.isBucketed&&"ordinal"===e.scale,Ki=e=>Yi(e)||"interval"===e.scale,Qi=e=>!Yi(e)&&("ordinal"===e.scale||"ratio"===e.scale)&&(e=>"number"===e.dataType&&!e.isStaticValue)(e);function Zi(e){return{...e,colors:((null==e?void 0:e.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==e?void 0:e.name)?((null==e?void 0:e.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}}const Ji=({paletteService:e,theme:t})=>({id:"lnsHeatmap",visualizationTypes:[{id:"heatmap",icon:x.u,label:u.i18n.translate("xpack.lens.heatmapVisualization.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:Ui,showExperimentalBadge:!1,sortPriority:1}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.valueAccessor,delete t.xAccessor,delete t.yAccessor,t},switchVisualizationType:(e,t)=>({...t,shape:e}),getDescription:e=>Di.heatmap,initialize:(e,t,a)=>t||{layerId:e(),layerType:_.LayerTypes.DATA,title:"Empty Heatmap chart",shape:Li,legend:{isVisible:!0,position:et.Position.Right,maxLines:1,type:Vi},gridConfig:{type:zi,isCellLabelVisible:!1,isYAxisLabelVisible:!0,isXAxisLabelVisible:!0,isYAxisTitleVisible:!0,isXAxisTitleVisible:!0}},getSuggestions:Gi,triggers:[A.VIS_EVENT_TO_TRIGGER.filter,A.VIS_EVENT_TO_TRIGGER.brush],getConfiguration({state:t,frame:a,layerId:n}){var i,s;const l=a.datasourceLayers[n];if(!(null==l?void 0:l.getTableSpec().map((({columnId:e})=>e))))return{groups:[]};const{displayStops:r,activePalette:o}=$i(e,null===(i=a.activeData)||void 0===i?void 0:i[t.layerId],t.valueAccessor,null!=t&&t.palette&&t.palette.accessor===t.valueAccessor?t.palette:void 0);return{groups:[{layerId:t.layerId,groupId:Ni,groupLabel:Xi(Ni),accessors:t.xAccessor?[{columnId:t.xAccessor}]:[],filterOperations:Ki,supportsMoreColumns:!t.xAccessor,requiredMinDimensionCount:1,dataTestSubj:"lnsHeatmap_xDimensionPanel"},{layerId:t.layerId,groupId:Ri,groupLabel:Xi(Ri),accessors:t.yAccessor?[{columnId:t.yAccessor}]:[],filterOperations:Ki,supportsMoreColumns:!t.yAccessor,requiredMinDimensionCount:0,dataTestSubj:"lnsHeatmap_yDimensionPanel"},{layerId:t.layerId,groupId:Bi,groupLabel:u.i18n.translate("xpack.lens.heatmap.cellValueLabel",{defaultMessage:"Cell value"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.heatmap.headingLabel",{defaultMessage:"Value"})},accessors:t.valueAccessor?[r.length&&(a.activeData||"number"!==(null==o||null===(s=o.params)||void 0===s?void 0:s.rangeType))?{columnId:t.valueAccessor,triggerIcon:"colorBy",palette:r.map((({color:e})=>e))}:{columnId:t.valueAccessor,triggerIcon:"none"}]:[],filterOperations:Qi,isMetricDimension:!0,supportsMoreColumns:!t.valueAccessor,enableDimensionEditor:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsHeatmap_cellPanel"}]}},setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const s={};return n===Ni&&(s.xAccessor=a),n===Ri&&(s.yAccessor=a),n===Bi&&(s.valueAccessor=a),{...e,...s}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.valueAccessor===a&&delete n.valueAccessor,e.xAccessor===a&&delete n.xAccessor,e.yAccessor===a&&delete n.yAccessor,n},renderDimensionEditor(a,n){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(Wi,i()({},n,{paletteService:e})))),a)},renderToolbar(e,a){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(Hi,a))),e)},getSupportedLayers:()=>[{type:_.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.heatmap.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,n,i={}){var s,l,r,o,u,c,d,p,g,f;const b=a[t.layerId],h=i[t.layerId];if(!(null==b?void 0:b.getTableSpec().map((({columnId:e})=>e)))||!t.valueAccessor)return null;const x=Object(L.buildExpressionFunction)("heatmap_legend",{isVisible:t.legend.isVisible,position:t.legend.position,legendSize:t.legend.legendSize}),v=Object(L.buildExpressionFunction)("heatmap_grid",{strokeWidth:t.gridConfig.strokeWidth,strokeColor:t.gridConfig.strokeColor,isCellLabelVisible:t.gridConfig.isCellLabelVisible,isYAxisLabelVisible:t.gridConfig.isYAxisLabelVisible,isYAxisTitleVisible:null!==(s=t.gridConfig.isYAxisTitleVisible)&&void 0!==s&&s,yTitle:t.gridConfig.yTitle,isXAxisLabelVisible:t.gridConfig.isXAxisLabelVisible,isXAxisTitleVisible:null!==(l=t.gridConfig.isXAxisTitleVisible)&&void 0!==l&&l,xTitle:t.gridConfig.xTitle}),y=Object(L.buildExpressionFunction)("heatmap",{xAccessor:null!==(r=t.xAccessor)&&void 0!==r?r:"",yAccessor:null!==(o=t.yAccessor)&&void 0!==o?o:"",valueAccessor:null!==(u=t.valueAccessor)&&void 0!==u?u:"",lastRangeIsRightOpen:null===(c=t.palette)||void 0===c||null===(d=c.params)||void 0===d||!d.continuity||["above","all"].includes(t.palette.params.continuity),palette:null!==(p=t.palette)&&void 0!==p&&p.params?e.get(m.a).toExpression(Zi(null===(g=t.palette)||void 0===g?void 0:g.params)):e.get(Ai).toExpression(),legend:Object(L.buildExpression)([x]),gridConfig:Object(L.buildExpression)([v])});return{type:"expression",chain:[...null!==(f=null==h?void 0:h.chain)&&void 0!==f?f:[],y.toAst()]}},toPreviewExpression(t,a,n={}){var i,s,l,r,o,u,c,d;const p=a[t.layerId],g=n[t.layerId];if(!(null==p?void 0:p.getTableSpec().map((({columnId:e})=>e)))||!t.valueAccessor)return null;const f=Object(L.buildExpressionFunction)("heatmap_legend",{isVisible:!1,position:"right"}),b=Object(L.buildExpressionFunction)("heatmap_grid",{strokeWidth:1,isCellLabelVisible:!1,isYAxisLabelVisible:!1,isYAxisTitleVisible:!1,yTitle:null!==(i=t.gridConfig.yTitle)&&void 0!==i?i:"",isXAxisLabelVisible:!1,isXAxisTitleVisible:!1,xTitle:null!==(s=t.gridConfig.xTitle)&&void 0!==s?s:""}),h=Object(L.buildExpressionFunction)("heatmap",{xAccessor:null!==(l=t.xAccessor)&&void 0!==l?l:"",yAccessor:null!==(r=t.yAccessor)&&void 0!==r?r:"",valueAccessor:null!==(o=t.valueAccessor)&&void 0!==o?o:"",legend:Object(L.buildExpression)([f]),gridConfig:Object(L.buildExpression)([b]),palette:null!==(u=t.palette)&&void 0!==u&&u.params?e.get(m.a).toExpression(Zi(null===(c=t.palette)||void 0===c?void 0:c.params)):e.get(Ai).toExpression()});return{type:"expression",chain:[...null!==(d=null==g?void 0:g.chain)&&void 0!==d?d:[],h.toAst()]}},getErrorMessages(e){if(!e.yAccessor&&!e.xAccessor&&!e.valueAccessor)return;const t=[];return e.xAccessor||t.push({shortMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorShortMessage",{defaultMessage:"Missing Horizontal axis."}),longMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorLongMessage",{defaultMessage:"Configuration for the horizontal axis is missing."})}),t.length?t:void 0},getWarningMessages(e,t){if(null==e||!e.layerId||!t.activeData||!e.valueAccessor)return;const a=t.activeData[e.layerId]&&t.activeData[e.layerId].rows;if(!a)return;const n=a.some((t=>Array.isArray(t[e.valueAccessor]))),i=t.datasourceLayers[e.layerId],s=null==i?void 0:i.getOperationForColumnId(e.valueAccessor);return n?[Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.heatmapVisualization.arrayValuesWarningMessage",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(j.jsx)("strong",null,null==s?void 0:s.label)}})]:void 0},getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(e){const t=[];return e.xAccessor&&t.push({id:e.xAccessor,name:Xi(Ni)}),e.yAccessor&&t.push({id:e.yAccessor,name:Xi(Ri)}),e.valueAccessor&&t.push({id:e.valueAccessor,name:u.i18n.translate("xpack.lens.heatmap.cellValueLabel",{defaultMessage:"Cell value"})}),{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:e.shape,...this.getDescription(e),dimensions:t}]}}});class HeatmapVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getHeatmapVisualization:t}=await Promise.resolve().then(a.bind(null,493));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var es=a(40),ts=a(46);const as=({table:e,state:t,keptLayerIds:a,subVisualizationId:n})=>{const i=Boolean(t&&(t.minAccessor||t.maxAccessor||t.goalAccessor||t.metricAccessor)),s=t&&[t.minAccessor,t.maxAccessor,t.goalAccessor,t.metricAccessor].filter(Boolean).length;if(((e,t)=>e.length>1||e.length&&t.layerId!==e[0])(a,e)||(e=>{var t,a;return"number"!==(null===(t=e.columns)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.operation.dataType)||e.columns.some((e=>e.operation.isBucketed))})(e)||t&&!i&&e.columns.length>1||i&&(s!==e.columns.length||"initial"===e.changeType))return[];const l=(null==t?void 0:t.shape)===es.GaugeShapes.VERTICAL_BULLET?es.GaugeShapes.VERTICAL_BULLET:es.GaugeShapes.HORIZONTAL_BULLET,r={state:{...t,shape:l,layerId:e.layerId,layerType:_.LayerTypes.DATA,ticksPosition:es.GaugeTicksPositions.AUTO,labelMajorMode:es.GaugeLabelMajorModes.AUTO},title:u.i18n.translate("xpack.lens.gauge.gaugeLabel",{defaultMessage:"Gauge"}),previewIcon:"empty",score:.5,hide:!i||void 0===(null==t?void 0:t.metricAccessor)};return i?[{...r,state:{...r.state,...t,shape:(null==t?void 0:t.shape)===es.GaugeShapes.VERTICAL_BULLET?es.GaugeShapes.HORIZONTAL_BULLET:es.GaugeShapes.VERTICAL_BULLET}}]:[{...r,state:{...r.state,metricAccessor:e.columns[0].columnId}},{...r,state:{...r.state,metricAccessor:e.columns[0].columnId,shape:(null==t?void 0:t.shape)===es.GaugeShapes.VERTICAL_BULLET?es.GaugeShapes.HORIZONTAL_BULLET:es.GaugeShapes.VERTICAL_BULLET}}]},ns="metric",is="goal";a(254);const ss=Object(s.memo)((e=>{var t,a,n;const{state:i,setState:l,frame:r}=e,o=i.layerId&&(null===(t=r.activeData)||void 0===t||null===(a=t[i.layerId])||void 0===a||null===(n=a.columns.find((e=>e.id===i.metricAccessor)))||void 0===n?void 0:n.name),[c,d]=Object(s.useState)((()=>i.labelMinor?"custom":"none")),{inputValue:p,handleInputChange:m}=Object(k.F)({onChange:l,value:i});return Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(j.jsx)(k.s,{handleClose:()=>{d(p.labelMinor?"custom":"none")},title:u.i18n.translate("xpack.lens.gauge.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",buttonDataTestSubj:"lnsVisualOptionsButton",panelClassName:"lnsGaugeToolbar__popover"},Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),fullWidth:!0},Object(j.jsx)(k.v,{header:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),dataTestSubj:"lnsToolbarGaugeLabelMajor",label:p.labelMajor||"",mode:p.labelMajorMode,placeholder:o||"",hasAutoOption:!0,handleChange:e=>{m({...p,labelMajor:e.label,labelMajorMode:e.mode})}})),Object(j.jsx)(b.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"})},Object(j.jsx)(k.v,{header:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"}),dataTestSubj:"lnsToolbarGaugeLabelMinor",label:p.labelMinor||"",mode:c,handleChange:e=>{m({...p,labelMinor:e.label}),d(e.mode)}}))))))})),ls={...k.y,rangeMin:0,rangeMax:100,name:"gray",steps:3,maxSteps:5},rs=e=>{const{minAccessor:t,maxAccessor:a,goalAccessor:n,metricAccessor:i}=null!=e?e:{};if(i||a||n||i)return{min:t,max:a,goal:n,metric:i}};function os(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,[o,c]=Object(s.useState)(!1);if((null==a?void 0:a.metricAccessor)!==r)return null;const d=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[p]=(null==d?void 0:d.rows)||[];if(null==r||null==p||!Object(D.a)(d,r))return null;const g=rs(a),f="palette"===(null==a?void 0:a.colorMode),h={min:Object(ts.getMinValue)(p,g),max:Object(ts.getMaxValue)(p,g)},x=(null==a?void 0:a.palette)||{type:"palette",name:ls.name,params:{...ls,continuity:"all",colorStops:void 0,stops:void 0,rangeMin:h.min,rangeMax:3*h.max/4}},v=Object(k.w)(e.paletteService,x,h),y=()=>c(!o);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.gauge.dynamicColoring.label",{defaultMessage:"Band colors"}),className:"lnsDynamicColoringRow"},Object(j.jsx)(b.EuiSwitch,{"data-test-subj":"lnsDynamicColoringGaugeSwitch",compressed:!0,label:"",showLabel:!1,checked:f,onChange:e=>{const{checked:t}=e.target,i=t?{palette:{...x,params:{...x.params,stops:v}},ticksPosition:es.GaugeTicksPositions.BANDS,colorMode:es.GaugeColorModes.PALETTE}:{ticksPosition:es.GaugeTicksPositions.AUTO,colorMode:es.GaugeColorModes.NONE};n({...a,...i})}})),f&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsGauge_dynamicColoring_palette",palette:v.map((({color:e})=>e)),type:m.i,onClick:y})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsGauge_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:y,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(j.jsx)(k.n,{siblingRef:e.panelRef,isOpen:o,handleClose:y},Object(j.jsx)(m.b,{palettes:e.paletteService,activePalette:x,dataBounds:h,setPalette:e=>{e.name!==m.a&&e.params&&e.params.rangeMin!==h.min&&(e.params.rangeMin=h.min),n({...a,palette:e})}}))))),Object(j.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",fullWidth:!0,label:Object(j.jsx)(k.t,{position:"top",tooltipContent:u.i18n.translate("xpack.lens.shared.ticksPositionOptionsTooltip",{defaultMessage:"Places ticks on each band border instead of distributing them evenly"}),condition:!0,delay:"regular"},Object(j.jsx)("span",null,u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),Object(j.jsx)(b.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(j.jsx)(b.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),"data-test-subj":"lens-toolbar-gauge-ticks-position-switch",showLabel:!1,checked:a.ticksPosition===es.GaugeTicksPositions.BANDS,onChange:()=>{n({...a,ticksPosition:a.ticksPosition===es.GaugeTicksPositions.BANDS?es.GaugeTicksPositions.AUTO:es.GaugeTicksPositions.BANDS})}}))))}a(259);const us=u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),cs=e=>!e.isBucketed&&"number"===e.dataType,ds=e=>cs(e)&&!e.isStaticValue,ps={horizontalBullet:{icon:x.v,label:u.i18n.translate("xpack.lens.gaugeHorizontal.gaugeLabel",{defaultMessage:"Gauge horizontal"}),groupLabel:us},verticalBullet:{icon:x.C,label:u.i18n.translate("xpack.lens.gaugeVertical.gaugeLabel",{defaultMessage:"Gauge vertical"}),groupLabel:us}},ms=(e,t)=>{if(!e||!t)return;const a=null==t?void 0:t.minAccessor,n=null==t?void 0:t.maxAccessor,i=a?Object(ts.getValueFromAccessor)(a,e):void 0,s=n?Object(ts.getValueFromAccessor)(n,e):void 0;if(null!=s&&null!=i&&void 0!==i){if(s<i)return{invalid:!0,invalidMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderMinGreaterMax",{defaultMessage:"Minimum value may not be greater than maximum value"})};if(s===i)return{invalid:!0,invalidMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderEqual",{defaultMessage:"Minimum and maximum values may not be equal"})}}},gs=(e,t,a,n,i={})=>{var s,l,r,o,u,c;const d=a[t.layerId],p=i[t.layerId];if(!(null==d?void 0:d.getTableSpec().map((({columnId:e})=>e)))||!t.metricAccessor)return null;const g=Object(L.buildExpressionFunction)("gauge",{metric:t.metricAccessor,min:t.minAccessor,max:t.maxAccessor,goal:t.goalAccessor,shape:null!==(s=t.shape)&&void 0!==s?s:es.GaugeShapes.HORIZONTAL_BULLET,colorMode:null!==(l=null==t?void 0:t.colorMode)&&void 0!==l?l:"none",palette:null!==(r=t.palette)&&void 0!==r&&r.params?e.get(m.a).toExpression((f=t.palette.params,{...f,colors:((null==f?void 0:f.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==f?void 0:f.name)?((null==f?void 0:f.stops)||[]).map((({stop:e})=>e)):[],reverse:!1})):void 0,ticksPosition:null!==(o=t.ticksPosition)&&void 0!==o?o:"auto",labelMinor:t.labelMinor,labelMajor:t.labelMajor,labelMajorMode:null!==(u=t.labelMajorMode)&&void 0!==u?u:"auto"});var f;return{type:"expression",chain:[...null!==(c=null==p?void 0:p.chain)&&void 0!==c?c:[],g.toAst()]}},fs=({paletteService:e,theme:t})=>({id:"lnsGauge",visualizationTypes:[{...ps.horizontalBullet,id:es.GaugeShapes.HORIZONTAL_BULLET,showExperimentalBadge:!0},{...ps.verticalBullet,id:es.GaugeShapes.VERTICAL_BULLET,showExperimentalBadge:!0}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.metricAccessor,delete t.minAccessor,delete t.maxAccessor,delete t.goalAccessor,delete t.palette,delete t.colorMode,t},getDescription:e=>e.shape===es.GaugeShapes.HORIZONTAL_BULLET?ps.horizontalBullet:ps.verticalBullet,switchVisualizationType:(e,t)=>({...t,shape:e===es.GaugeShapes.HORIZONTAL_BULLET?es.GaugeShapes.HORIZONTAL_BULLET:es.GaugeShapes.VERTICAL_BULLET}),initialize:(e,t,a)=>t||{layerId:e(),layerType:_.LayerTypes.DATA,shape:es.GaugeShapes.HORIZONTAL_BULLET,palette:a,ticksPosition:"auto",labelMajorMode:"auto"},getSuggestions:as,getConfiguration({state:t,frame:a}){var n,i,s,l,r;const o=Boolean("none"!==t.colorMode&&(null===(n=t.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)),c=null!=t&&t.layerId?null==a||null===(s=a.activeData)||void 0===s||null===(l=s[null==t?void 0:t.layerId])||void 0===l||null===(r=l.rows)||void 0===r?void 0:r[0]:void 0,{metricAccessor:d}=null!=t?t:{},p=rs(t);let m;if(null!=c&&null!=d&&null!=(null==t?void 0:t.palette)&&o){const a={min:Object(ts.getMinValue)(c,p),max:Object(ts.getMaxValue)(c,p)};m=Object(k.w)(e,null==t?void 0:t.palette,a).map((({color:e})=>e))}const g=ms(c,t)||{};return{groups:[{enableFormatSelector:!0,layerId:t.layerId,groupId:ns,groupLabel:u.i18n.translate("xpack.lens.gauge.metricLabel",{defaultMessage:"Metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:d?[m?{columnId:d,triggerIcon:"colorBy",palette:m}:{columnId:d,triggerIcon:"none"}]:[],filterOperations:ds,supportsMoreColumns:!d,requiredMinDimensionCount:1,dataTestSubj:"lnsGauge_metricDimensionPanel",enableDimensionEditor:!0},{supportStaticValue:!0,enableFormatSelector:!1,layerId:t.layerId,groupId:"min",groupLabel:u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"}),paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"})],headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:t.minAccessor?[{columnId:t.minAccessor}]:[],filterOperations:cs,supportsMoreColumns:!t.minAccessor,dataTestSubj:"lnsGauge_minDimensionPanel",prioritizedOperation:"min",suggestedValue:()=>t.metricAccessor?Object(ts.getMinValue)(c,p):void 0,...g},{supportStaticValue:!0,enableFormatSelector:!1,layerId:t.layerId,groupId:"max",groupLabel:u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"}),paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"})],headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:t.maxAccessor?[{columnId:t.maxAccessor}]:[],filterOperations:cs,supportsMoreColumns:!t.maxAccessor,dataTestSubj:"lnsGauge_maxDimensionPanel",prioritizedOperation:"max",suggestedValue:()=>t.metricAccessor?Object(ts.getMaxValue)(c,p):void 0,...g},{supportStaticValue:!0,enableFormatSelector:!1,layerId:t.layerId,groupId:is,groupLabel:u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"}),paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"})],headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:t.goalAccessor?[{columnId:t.goalAccessor}]:[],filterOperations:cs,supportsMoreColumns:!t.goalAccessor,requiredMinDimensionCount:0,dataTestSubj:"lnsGauge_goalDimensionPanel"}]}},setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const s={};return"min"===n&&(s.minAccessor=a),"max"===n&&(s.maxAccessor=a),n===is&&(s.goalAccessor=a),n===ns&&(s.metricAccessor=a),{...e,...s}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.goalAccessor===a&&delete n.goalAccessor,e.minAccessor===a&&delete n.minAccessor,e.maxAccessor===a&&delete n.maxAccessor,e.metricAccessor===a&&(delete n.metricAccessor,delete n.palette,delete n.colorMode,n.ticksPosition="auto"),n},renderDimensionEditor(a,n){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(os,i()({},n,{paletteService:e})))),a)},renderToolbar(e,a){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:t.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(ss,a))),e)},getSupportedLayers(e,t){var a,n,i;const s=null!=e&&e.layerId?null==t||null===(a=t.activeData)||void 0===a||null===(n=a[null==e?void 0:e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0]:void 0,l=rs(e),r=Object(ts.getMinValue)(s,l),o=Object(ts.getMaxValue)(s,l),c=Object(ts.getGoalValue)(s,l);return[{type:_.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.gauge.addLayer",{defaultMessage:"Visualization"}),initialDimensions:e?[{groupId:"min",columnId:Object(Ge.a)(),staticValue:r},{groupId:"max",columnId:Object(Ge.a)(),staticValue:o},{groupId:"goal",columnId:Object(Ge.a)(),staticValue:c}]:void 0}]},getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n,i={})=>gs(e,t,a,0,i),toPreviewExpression:(t,a,n={})=>gs(e,t,a,0,n),getErrorMessages(e){},getWarningMessages(e,t){var a,n,i;const{maxAccessor:s,minAccessor:l,goalAccessor:r,metricAccessor:o}=e;if(!(s||l||r||o))return;if(!o)return[];const u=null==t||null===(a=t.activeData)||void 0===a||null===(n=a[e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0];if(!u||ms(u,e))return[];const d=u[o],p=s&&u[s],m=l&&u[l],g=r&&u[r],f=[];return"number"==typeof m&&(m>d&&f.push([Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minValueGreaterMetricShortMessage",defaultMessage:"Minimum value is greater than metric value."})]),m>g&&f.push([Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minimumValueGreaterGoalShortMessage",defaultMessage:"Minimum value is greater than goal value."})])),"number"==typeof p&&(d>p&&f.push([Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.metricValueGreaterMaximumShortMessage",defaultMessage:"Metric value is greater than maximum value."})]),"number"==typeof g&&g>p&&f.push([Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.goalValueGreaterMaximumShortMessage",defaultMessage:"Goal value is greater than maximum value."})])),f},getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(e){const t=[];return e.metricAccessor&&t.push({id:e.metricAccessor,name:u.i18n.translate("xpack.lens.gauge.metricLabel",{defaultMessage:"Metric"})}),e.maxAccessor&&t.push({id:e.maxAccessor,name:u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"})}),e.minAccessor&&t.push({id:e.minAccessor,name:u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"})}),e.goalAccessor&&t.push({id:e.goalAccessor,name:u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"})}),{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:e.shape,...this.getDescription(e),dimensions:t}]}}});class gauge_GaugeVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getGaugeVisualization:t}=await Promise.resolve().then(a.bind(null,493));return t({paletteService:(e=>{const t=e=>e?new Zn.a(e).hex()+"80":"000000",a=e=>({...e,getCategoricalColor:(a,n,i)=>t(e.getCategoricalColor(a,n,i)),getCategoricalColors:(a,n)=>e.getCategoricalColors(a,n).map(t)});return{...e,get:t=>a(e.get(t)),getAll:()=>e.getAll().map((e=>a(e)))}})(await n.palettes.getPalettes()),theme:e.theme})}))}}var bs=a(36),hs=a(89),xs=a.n(hs),vs=a(135),ys=a(30),js=a(27);const Os=/[^0-9A-Za-z._@\[\]/]/;function ks(e){const{namedArgument:t,variable:a,function:n}=Object(jt.groupBy)(e,(e=>Object(jt.isObject)(e)?e.type:"variable"));return{namedArguments:t||[],variables:a||[],functions:n||[]}}function Is(e){return Object(jt.isObject)(e)?"function"!==e.type?e.value:e.name:e}function Ts(e,t,a,n){if(a&&e.filterable){const e="kql"in t?"kql":"lucene";t[e]?a.query&&(t[e]=`(${a.query}) AND (${t[e]})`):t["kuery"===a.language?"kql":a.language]=a.query}return n&&e.canReduceTimeRange&&!t.reducedTimeRange&&(t.reducedTimeRange=n),t}function ws(e,t=[]){const a=(e.operationParams||[]).reduce(((e,{name:t,type:a})=>(e[t]=a,e)),{});return t.reduce(((t,{name:n,value:i})=>(a[n]&&(t[n]=i),!e.filterable||"kql"!==n&&"lucene"!==n||(t[n]=i),e.shiftable&&"shift"===n&&(t[n]=i),e.canReduceTimeRange&&"reducedTimeRange"===n&&(t.reducedTimeRange=i),t)),{})}function Ms(e){return"number"===e?u.i18n.translate("xpack.lens.formula.number",{defaultMessage:"number"}):"string"===e?u.i18n.translate("xpack.lens.formula.string",{defaultMessage:"string"}):"boolean"===e?u.i18n.translate("xpack.lens.formula.boolean",{defaultMessage:"boolean"}):""}const Cs={add:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.addFunction.markdown",{defaultMessage:"\nAdds up two numbers.\nAlso works with `+` symbol.\n\nExample: Calculate the sum of two fields\n\n`sum(price) + sum(tax)`\n\nExample: Offset count by a static value\n\n`add(count(), 5)`\n    "})},subtract:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.subtractFunction.markdown",{defaultMessage:"\nSubtracts the first number from the second number.\nAlso works with `-` symbol.\n\nExample: Calculate the range of a field\n`subtract(max(bytes), min(bytes))`\n    "})},multiply:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.multiplyFunction.markdown",{defaultMessage:"\nMultiplies two numbers.\nAlso works with `*` symbol.\n\nExample: Calculate price after current tax rate\n`sum(bytes) * last_value(tax_rate)`\n\nExample: Calculate price after constant tax rate\n`multiply(sum(price), 1.2)`\n    "})},divide:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.divideFunction.markdown",{defaultMessage:"\nDivides the first number by the second number.\nAlso works with `/` symbol\n\nExample: Calculate profit margin\n`sum(profit) / sum(revenue)`\n\nExample: `divide(sum(bytes), 2)`\n    "})},abs:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.absFunction.markdown",{defaultMessage:"\nCalculates absolute value. A negative value is multiplied by -1, a positive value stays the same.\n\nExample: Calculate average distance to sea level `abs(average(altitude))`\n    "})},cbrt:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.cbrtFunction.markdown",{defaultMessage:"\nCube root of value.\n\nExample: Calculate side length from volume\n`cbrt(last_value(volume))`\n    "})},ceil:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.ceilFunction.markdown",{defaultMessage:"\nCeiling of value, rounds up.\n\nExample: Round up price to the next dollar\n`ceil(sum(price))`\n    "})},clamp:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.min",{defaultMessage:"min"}),type:Ms("number"),alternativeWhenMissing:"pick_max"},{name:u.i18n.translate("xpack.lens.formula.max",{defaultMessage:"max"}),type:Ms("number"),alternativeWhenMissing:"pick_min"}],help:u.i18n.translate("xpack.lens.formula.clampFunction.markdown",{defaultMessage:"\nLimits the value from a minimum to maximum.\n\nExample: Make sure to catch outliers\n```\nclamp(\n  average(bytes),\n  percentile(bytes, percentile=5),\n  percentile(bytes, percentile=95)\n)\n```\n"})},cube:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.cubeFunction.markdown",{defaultMessage:"\nCalculates the cube of a number.\n\nExample: Calculate volume from side length\n`cube(last_value(length))`\n    "})},exp:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.expFunction.markdown",{defaultMessage:"\nRaises *e* to the nth power.\n\nExample: Calculate the natural exponential function\n\n`exp(last_value(duration))`\n    "})},fix:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.fixFunction.markdown",{defaultMessage:"\nFor positive values, takes the floor. For negative values, takes the ceiling.\n\nExample: Rounding towards zero\n`fix(sum(profit))`\n    "})},floor:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.floorFunction.markdown",{defaultMessage:"\nRound down to nearest integer value\n\nExample: Round down a price\n`floor(sum(price))`\n    "})},log:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),optional:!0,defaultValue:"e",type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.logFunction.markdown",{defaultMessage:"\nLogarithm with optional base. The natural base *e* is used as default.\n\nExample: Calculate number of bits required to store values\n```\nlog(sum(bytes))\nlog(sum(bytes), 2)\n```\n    "})},mod:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.modFunction.markdown",{defaultMessage:"\nRemainder after dividing the function by a number\n\nExample: Calculate last three digits of a value\n`mod(sum(price), 1000)`\n    "})},pow:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.powFunction.markdown",{defaultMessage:"\nRaises the value to a certain power. The second argument is required\n\nExample: Calculate volume based on side length\n`pow(last_value(length), 3)`\n    "})},round:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.decimals",{defaultMessage:"decimals"}),optional:!0,defaultValue:0,type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.roundFunction.markdown",{defaultMessage:"\nRounds to a specific number of decimal places, default of 0\n\nExamples: Round to the cent\n```\nround(sum(bytes))\nround(sum(bytes), 2)\n```\n    "})},sqrt:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.sqrtFunction.markdown",{defaultMessage:"\nSquare root of a positive value only\n\nExample: Calculate side length based on area\n`sqrt(last_value(area))`\n    "})},square:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.squareFunction.markdown",{defaultMessage:"\nRaise the value to the 2nd power\n\nExample: Calculate area based on side length\n`square(last_value(length))`\n    "})},pick_max:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.maxFunction.markdown",{defaultMessage:"\nFinds the maximum value between two numbers.\n\nExample: Find the maximum between two fields averages\n`pick_max(average(bytes), average(memory))`\n        "})},pick_min:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.minFunction.markdown",{defaultMessage:"\nFinds the minimum value between two numbers.\n\nExample: Find the minimum between two fields averages\n`pick_min(average(bytes), average(memory))`\n    "})},defaults:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.defaultValue",{defaultMessage:"default"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.defaultFunction.markdown",{defaultMessage:"\nReturns a default numeric value when value is null.\n\nExample: Return -1 when a field has no data\n`defaults(average(bytes), -1)`\n"})},lt:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],outputType:Ms("boolean"),help:u.i18n.translate("xpack.lens.formula.ltFunction.markdown",{defaultMessage:"\nPerforms a lower than comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `<` symbol.\n\nExample: Returns true if the average of bytes is lower than the average amount of memory\n`average(bytes) <= average(memory)`\n\nExample: `lt(average(bytes), 1000)`\n    "})},gt:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],outputType:Ms("boolean"),help:u.i18n.translate("xpack.lens.formula.gtFunction.markdown",{defaultMessage:"\nPerforms a greater than comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `>` symbol.\n\nExample: Returns true if the average of bytes is greater than the average amount of memory\n`average(bytes) > average(memory)`\n\nExample: `gt(average(bytes), 1000)`\n    "})},eq:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],outputType:Ms("boolean"),help:u.i18n.translate("xpack.lens.formula.eqFunction.markdown",{defaultMessage:"\nPerforms an equality comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `==` symbol.\n\nExample: Returns true if the average of bytes is exactly the same amount of average memory\n`average(bytes) == average(memory)`\n\nExample: `eq(sum(bytes), 1000000)`\n    "})},lte:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],outputType:Ms("boolean"),help:u.i18n.translate("xpack.lens.formula.lteFunction.markdown",{defaultMessage:"\nPerforms a lower than or equal comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `<=` symbol.\n\nExample: Returns true if the average of bytes is lower than or equal to the average amount of memory\n`average(bytes) <= average(memory)`\n\nExample: `lte(average(bytes), 1000)`\n    "})},gte:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],outputType:Ms("boolean"),help:u.i18n.translate("xpack.lens.formula.gteFunction.markdown",{defaultMessage:"\nPerforms a greater than comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `>=` symbol.\n\nExample: Returns true if the average of bytes is greater than or equal to the average amount of memory\n`average(bytes) >= average(memory)`\n\nExample: `gte(average(bytes), 1000)`\n    "})},ifelse:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.condition",{defaultMessage:"condition"}),type:Ms("boolean")},{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:Ms("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:Ms("number")}],help:u.i18n.translate("xpack.lens.formula.ifElseFunction.markdown",{defaultMessage:"\nReturns a value depending on whether the element of condition is true or false.\n\nExample: Average revenue per customer but in some cases customer id is not provided which counts as additional customer\n`sum(total)/(unique_count(customer_id) + ifelse( count() > count(kql='customer_id:*'), 1, 0))`\n    "})}};function Ss(e){return null!=e}function Fs(e){return Object(jt.isObject)(e)&&"function"===e.type&&Cs[e.name]}function Es(e){return"string"==typeof e?[{type:"variable",value:e,text:e,location:{min:0,max:0}}]:null==e||"number"==typeof e||"namedArgument"===e.type?[]:"variable"===e.type?[e]:e.args.flatMap(Es)}function Ps(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>!e.hidden)))}function As(e){return[e.location].filter(Ss)}function _s(e,t){if(!Object(jt.isObject)(e))return typeof e;if("function"===e.type){var a;if(Cs[e.name])return null!==(a=Cs[e.name].outputType)&&void 0!==a?a:"number";if(t[e.name])return"number"}}const Ls=(e,t)=>{const[,...a]=e.split("="),n=(a||[""]).join(""),i=n.trim();if(i.length&&("'"!==i[0]||!/'\s*([^']+?)\s*'/.test(n))&&"''"!==i)return u.i18n.translate("xpack.lens.indexPattern.formulaOperationQueryError",{defaultMessage:"Single quotes are required for {language}='' at {rawQuery}",values:{language:t,rawQuery:e}})};function Ds({messageId:e,values:t,locations:a}){let n;const i=t;switch(e){case"wrongFirstArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongFirstArgument",{defaultMessage:"The first argument for {operation} should be a {type} name. Found {argument}",values:{operation:i.operation,type:i.type,argument:i.argument}});break;case"shouldNotHaveField":n=u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotRequired",{defaultMessage:"The operation {operation} does not accept any field as argument",values:{operation:i.operation}});break;case"cannotAcceptParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaParameterNotRequired",{defaultMessage:"The operation {operation} does not accept any parameter",values:{operation:i.operation}});break;case"missingParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionNotHandled",{defaultMessage:"The operation {operation} in the Formula is missing the following parameters: {params}",values:{operation:i.operation,params:i.params}});break;case"wrongTypeParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionWrongType",{defaultMessage:"The parameters for the operation {operation} in the Formula are of the wrong type: {params}",values:{operation:i.operation,params:i.params}});break;case"wrongTypeArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionWrongTypeArgument",{defaultMessage:"The {name} argument for the operation {operation} in the Formula is of the wrong type: {type} instead of {expectedType}",values:{operation:i.operation,name:i.name,type:i.type,expectedType:i.expectedType}});break;case"duplicateArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationDuplicateParams",{defaultMessage:"The parameters for the operation {operation} have been declared multiple times: {params}",values:{operation:i.operation,params:i.params}});break;case"missingField":n=u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotFound",{defaultMessage:"{variablesLength, plural, one {Field} other {Fields}} {variablesList} not found",values:{variablesLength:i.variablesLength,variablesList:i.variablesList}});break;case"missingOperation":n=u.i18n.translate("xpack.lens.indexPattern.operationsNotFound",{defaultMessage:"{operationLength, plural, one {Operation} other {Operations}} {operationsList} not found",values:{operationLength:i.operationLength,operationsList:i.operationsList}});break;case"fieldWithNoOperation":n=u.i18n.translate("xpack.lens.indexPattern.fieldNoOperation",{defaultMessage:"The field {field} cannot be used without operation",values:{field:i.field}});break;case"failedParsing":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionParseError",{defaultMessage:"The Formula {expression} cannot be parsed",values:{expression:i.expression}});break;case"tooManyArguments":n=u.i18n.translate("xpack.lens.indexPattern.formulaWithTooManyArguments",{defaultMessage:"The operation {operation} has too many arguments",values:{operation:i.operation}});break;case"missingMathArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaMathMissingArgument",{defaultMessage:"The operation {operation} in the Formula is missing {count} arguments: {params}",values:{operation:i.operation,count:i.count,params:i.params}});break;case"tooManyQueries":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationDoubleQueryError",{defaultMessage:"Use only one of kql= or lucene=, not both"});break;case"tooManyFirstArguments":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationTooManyFirstArguments",{defaultMessage:"The operation {operation} in the Formula requires a {supported, plural, one {single} other {supported}} {type}, found: {text}",values:{operation:i.operation,text:i.text,type:i.type,supported:i.supported||1}});break;case"wrongArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationwrongArgument",{defaultMessage:"The operation {operation} in the Formula does not support {type} parameters, found: {text}",values:{operation:i.operation,text:i.text,type:i.type}});break;case"wrongReturnedType":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongReturnedType",{defaultMessage:"The return value type of the operation {text} is not supported in Formula",values:{text:i.text}});break;case"filtersTypeConflict":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationFiltersTypeConflicts",{defaultMessage:'The Formula filter of type "{outerType}" is not compatible with the inner filter of type "{innerType}" from the {operation} operation',values:{operation:i.operation,outerType:i.outerType,innerType:i.innerType}});break;case"useAlternativeFunction":n=u.i18n.translate("xpack.lens.indexPattern.formulaUseAlternative",{defaultMessage:"The operation {operation} in the Formula is missing the {params} argument: use the {alternativeFn} operation instead",values:{operation:i.operation,params:i.params,alternativeFn:i.alternativeFn}});break;default:n="no Error found"}return{message:n,locations:a}}function Ns(e,t){let a;try{a=Object(vs.parse)(e)}catch(a){const n=((e,t)=>{const a=e.split("\n").join(""),n=/(kql|lucene)/,i=a.split(",").filter((e=>n.test(e))),s=Object.keys(t).some((e=>a.includes(e)));if(0===i.length||!s)return;const l=i.flatMap((e=>e.split("count").filter((e=>n.test(e))))),[r,o]=Object(jt.partition)(l,(e=>/kql/.test(e))),u=[];for(const e of r){const t=Ls(e,"kql");t&&u.push(t)}for(const e of o){const t=Ls(e,"lucene");t&&u.push(t)}return u.length?u:void 0})(e,t);return n?{root:null,error:{message:n[0],locations:[]}}:{root:null,error:Ds({messageId:"failedParsing",values:{expression:e},locations:[]})}}return{root:a,error:null}}function Rs(e,t,a,n,i){return[...Bs(e,t,a,n),...qs(e),...Hs(e,t,a,n,i)]}function Bs(e,t,a,n){const i=[],s=function(e,t){const a=(n=e,function e(t){return Object(jt.isObject)(t)&&"function"===t.type?[t,...t.args.flatMap(e)].filter(Ss):[]}(n)).filter((e=>!Fs(e)&&!t[e.name]));var n;return{names:Array.from(new Set(a.map((({name:e})=>e)))),locations:a.map((({location:e})=>e)).filter(Ss)}}(e,n);s.names.length&&i.push(Ds({messageId:"missingOperation",values:{operationLength:s.names.length,operationsList:s.names.join(", ")},locations:s.locations}));const l=Es(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e]));l.length&&i.push(Ds({messageId:"missingField",values:{variablesLength:l.length,variablesList:l.map((({value:e})=>e)).join(", ")},locations:l.map((({location:e})=>e))}));const r=function(e,t){const a=[];return Object(jt.isObject)(e)&&"variable"===e.type&&!t.has(e.value)&&a.push(Ds({messageId:"fieldWithNoOperation",values:{field:e.value},locations:[e.location]})),a}(e,new Set(l.map((({value:e})=>e))));return[...i,...r]}function Vs(e,t,a,n){const i=[],{conflicts:s,innerType:l,outerType:r}=function(e,t=[],a){const n=ws(e,t);if(!e.filterable||!a||!n.kql&&!n.lucene)return{conflicts:!1};const i="kuery"===a.language?"kql":a.language;return{conflicts:!(i in n),innerType:n.lucene?"lucene":"kql",outerType:i}}(t,a,n);return s&&l&&r&&i.push(Ds({messageId:"filtersTypeConflict",values:{operation:e.name,innerType:l,outerType:r},locations:As(e)})),i}function zs(e,t,a,n){const i=[],s=function(e,t=[]){return Us(e,t).filter((({isMissing:e,isRequired:t})=>e&&t))}(t,a);s.length&&i.push(Ds({messageId:"missingParameter",values:{operation:e.name,params:s.map((({name:e})=>e)).join(", ")},locations:As(e)}));const l=function(e,t=[]){return Us(e,t).filter((({isCorrectType:e,isMissing:t})=>!e&&!t))}(t,a);l.length&&i.push(Ds({messageId:"wrongTypeParameter",values:{operation:e.name,params:l.map((({name:e})=>e)).join(", ")},locations:As(e)}));const r=function(e=[]){const t=Object.create(null);for(const{name:a}of e){const e=t[a]||0;t[a]=e+1}const a=Object.keys(t);return e.length>a.length?a.filter((e=>t[e]>1)):[]}(a);r.length&&i.push(Ds({messageId:"duplicateArgument",values:{operation:e.name,params:r.join(", ")},locations:As(e)}));const o=function(e,t){const a=[];return(null!=e?e:[]).forEach((e=>{if("kql"===e.name||"lucene"===e.name){const n=(({value:e,name:t,text:a},n)=>{const i=Ls(a,t);if(i)return i;try{return void("kql"===t?Object(ys.toElasticsearchQuery)(Object(ys.fromKueryExpression)(e),n):Object(ys.luceneStringToDsl)(e))}catch(e){return e.message}})(e,t);n&&a.push({message:n,locations:[e.location]})}if("shift"===e.name&&"invalid"===Object(js.parseTimeShift)(e.value)&&a.push({message:u.i18n.translate("xpack.lens.indexPattern.invalidTimeShift",{defaultMessage:"Invalid time shift. Enter positive integer amount followed by one of the units s, m, h, d, w, M, y. For example 3h for 3 hours"}),locations:[e.location]}),"reducedTimeRange"===e.name){const t=Object(js.parseTimeShift)(e.value||"");"invalid"!==t&&"previous"!==t||a.push({message:u.i18n.translate("xpack.lens.indexPattern.invalidReducedTimeRange",{defaultMessage:"Invalid reduced time range. Enter positive integer amount followed by one of the units s, m, h, d, w, M, y. For example 3h for 3 hours"}),locations:[e.location]})}})),a}(a,n);o.length&&i.push(...o);const c=function(e){return e?e.filter((e=>"kql"===e.name||"lucene"===e.name)).length>1:void 0}(a);return c&&i.push(Ds({messageId:"tooManyQueries",values:{},locations:As(e)})),i}const Gs="number";function qs(e){var t;return Object(jt.isObject)(e)&&"function"===e.type&&e.text&&((null===(t=Cs[e.name])||void 0===t?void 0:t.outputType)||Gs)!==Gs?[Ds({messageId:"wrongReturnedType",values:{text:e.text},locations:As(e)})]:[]}function Hs(e,t,a,n,i){const s=Es(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e])),l=new Set(s.map((({value:e})=>e))),r=null==i?void 0:i.filter;return function e(t){if(!Object(jt.isObject)(t)||"function"!==t.type)return[];const i=n[t.name],s=[],{namedArguments:o,functions:c,variables:d}=ks(t.args),[p]=(null==t?void 0:t.args)||[];if(i){if("field"===i.input){if(Ks(p,"variable")){const e=Zs(t,d,{isFieldOperation:!0,firstArg:p,returnedType:Ws(i,a,p)});e.length&&s.push(...e)}else Fs(p)?s.push(Ds({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:"math operation"},locations:As(t)})):Xs(t)&&s.push(Ds({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:Is(p)||u.i18n.translate("xpack.lens.indexPattern.formulaNoFieldForOperation",{defaultMessage:"no field"})},locations:As(t)}));const e=Js(t,c,0,{isFieldOperation:!0,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),firstArgValidation:!1});if(e.length&&s.push(...e),!$s(i)&&o.length)s.push(Ds({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:As(t)}));else{const e=zs(t,i,o,a),n=Vs(t,i,o,r);s.push(...e,...n)}return s}if("fullReference"===i.input){const e=Boolean(!Ks(p,"function")||Fs(p)&&Qs(p,l,n).length);e&&s.push(Ds({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaOperationValue",{defaultMessage:"operation"}),argument:Is(p)||u.i18n.translate("xpack.lens.indexPattern.formulaNoOperation",{defaultMessage:"no operation"})},locations:As(t)}));const m=Js(t,c,i.requiredReferences?i.requiredReferences.length:1,{isFieldOperation:!1,firstArgValidation:e,type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})});if(m.length&&s.push(...m),!$s(i)&&o.length)s.push(Ds({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:As(t)}));else{const e=Zs(t,d,{isFieldOperation:!1,firstArg:p,returnedType:void 0}),n=zs(t,i,o,a),l=Vs(t,i,o,r);s.push(...e,...n,...l)}}return s.concat(e(c[0]))}return s.push(...Qs(t,l,n)),null!=c&&c.length?s.concat(c.flatMap((t=>e(t)))):s}(e)}function $s(e){return Boolean((e.operationParams||[]).length)||e.filterable}function Ws(e,t,a){var n;const i=Es(a);if(1!==i.length)return;const s=t.getFieldByName(Is(i[0]));return s?null===(n=e.getPossibleOperationForField(s))||void 0===n?void 0:n.scale:void 0}function Us(e,t=[]){var a;const n=ws(e,t),i=[...null!==(a=e.operationParams)&&void 0!==a?a:[]];return e.filterable&&i.push({name:"kql",type:"string",required:!1},{name:"lucene",type:"string",required:!1}),i.map((({name:e,type:t,required:a})=>({name:e,isMissing:!(e in n),isCorrectType:typeof n[e]===t,isRequired:a})))}function Xs(e){return Ys(e.name)}function Ys(e){return!["count"].includes(e)}function Ks(e,t){return Object(jt.isObject)(e)&&e.type===t}function Qs(e,t,a){const n=function(e){return function e(t){return Object(jt.isObject)(t)&&"function"===t.type&&Fs(t)?[t,...t.args.flatMap(e)].filter(Ss):[]}(e)}(e),i=[];return n.forEach((e=>{const{positionalArguments:n}=Cs[e.name],s=n.filter((({optional:e})=>!e));if(!e.args.length)return i.push(Ds({messageId:"missingMathArgument",values:{operation:e.name,count:s.length,params:s.map((({name:e})=>e)).join(", ")},locations:As(e)}));if(e.args.length>n.length&&i.push(Ds({messageId:"tooManyArguments",values:{operation:e.name},locations:As(e)})),n.some(((a,n)=>{const i=e.args[n];if(null!=i&&"number"!=typeof i)return"variable"===i.type&&!t.has(i.value)}))&&i.push(Ds({messageId:"shouldNotHaveField",values:{operation:e.name},locations:As(e)})),s.length>1&&e.args.length<s.length){const t=s.filter(((t,a)=>null==e.args[a])),[a,n]=Object(jt.partition)(t,(e=>null!=e.alternativeWhenMissing));if(n.length&&i.push(Ds({messageId:"missingMathArgument",values:{operation:e.name,count:s.length-e.args.length,params:n.map((({name:e})=>e)).join(", ")},locations:As(e)})),a.length){const[t]=a;i.push(Ds({messageId:"useAlternativeFunction",values:{operation:e.name,params:t.name,alternativeFn:t.alternativeWhenMissing},locations:As(e)}))}}const l=n.map((({type:t},n)=>{const i=e.args[n];if(null!=i){const e=_s(i,a);if(e&&e!==t)return n}})).filter(Ss);for(const t of l){const s=e.args[t];i.push(Ds({messageId:"wrongTypeArgument",values:{operation:e.name,name:n[t].name,type:_s(s,a)||"number",expectedType:n[t].type||""},locations:As(e)}))}})),i}function Zs(e,t,{isFieldOperation:a,firstArg:n,returnedType:i}){const s=t.filter((e=>Ks(e,"variable")&&!Fs(e))),l=[];var r;return a&&(s.length>1||1===s.length&&s[0]!==n)&&l.push(Ds({messageId:"tooManyFirstArguments",values:{operation:e.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),supported:1,text:s.map((({text:e})=>e)).join(", ")},locations:As(e)})),a&&1===s.length&&s[0]===n&&"ordinal"===i&&l.push(Ds({messageId:"wrongReturnedType",values:{text:null!==(r=e.text)&&void 0!==r?r:`${e.name}(${Is(n)})`},locations:As(e)})),!a&&s.length&&l.push(Ds({messageId:"wrongArgument",values:{operation:e.name,text:s.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"})},locations:As(e)})),l}function Js(e,t,a=0,{isFieldOperation:n,firstArgValidation:i,type:s}){const l=[],[r,o]=Object(jt.partition)(t,(e=>!Fs(e)));return r.length>a&&(n?l.push(Ds({messageId:"wrongArgument",values:{operation:e.name,text:r.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})},locations:As(e)})):l.push(Ds({messageId:"tooManyFirstArguments",values:{operation:e.name,type:s,supported:a,text:r.map((({text:e})=>e)).join(", ")},locations:As(e)}))),n&&(!i&&o.length||o.length>1)&&l.push(Ds({messageId:"wrongArgument",values:{operation:e.name,type:s,text:o.map((({text:e})=>e)).join(", ")},locations:As(e)})),l}var el=a(74),tl=a.n(el),al=a(73),nl=a.n(al);function il(e){var t=e.language,a=e.sections,n=Object(s.useState)(),i=tl()(n,2),r=i[0],o=i[1],c=Object(s.useRef)({});Object(s.useEffect)((function(){r&&c.current[r]&&c.current[r].scrollIntoView()}),[r]);var d=Object(s.useState)(""),p=tl()(d,2),m=p[0],g=p[1],f=m.trim().toLocaleLowerCase(),h=null==a?void 0:a.groups.map((function(e){var t=e.items.filter((function(e){return!f||e.label.toLocaleLowerCase().includes(f)}));return nl()(nl()({},e),{},{items:t})})).filter((function(e){return e.items.length>0||!f||e.label.toLocaleLowerCase().includes(f)}));return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiPopoverTitle,{className:"documentation__docsHeader",paddingSize:"m","data-test-subj":"language-documentation-title"},u.i18n.translate("languageDocumentationPopover.header",{defaultMessage:"{language} reference",values:{language:t}})),Object(j.jsx)(b.EuiFlexGroup,{className:"documentation__docsContent",gutterSize:"none",responsive:!1,alignItems:"stretch"},Object(j.jsx)(b.EuiFlexItem,{className:"documentation__docsSidebar",grow:1},Object(j.jsx)(b.EuiFlexGroup,{className:"documentation__docsSidebarInner",direction:"column",gutterSize:"none",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{className:"documentation__docsSearch",grow:!1},Object(j.jsx)(b.EuiFieldSearch,{value:m,onChange:function(e){g(e.target.value)},"data-test-subj":"language-documentation-navigation-search",placeholder:u.i18n.translate("languageDocumentationPopover.searchPlaceholder",{defaultMessage:"Search"})})),Object(j.jsx)(b.EuiFlexItem,{className:"documentation__docsNav"},null==h?void 0:h.map((function(e,t){return Object(j.jsx)("nav",{className:"documentation__docsNavGroup",key:e.label},Object(j.jsx)(b.EuiTitle,{size:"xxs","data-test-subj":"language-documentation-navigation-title"},Object(j.jsx)("h6",null,Object(j.jsx)(b.EuiLink,{className:"documentation__docsNavGroupLink",color:"text",onClick:function(){o(e.label)}},Object(j.jsx)(b.EuiHighlight,{search:m},e.label)))),e.items.length?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiListGroup,{gutterSize:"none"},e.items.map((function(e){return Object(j.jsx)(b.EuiListGroupItem,{key:e.label,label:Object(j.jsx)(b.EuiHighlight,{search:m},e.label),size:"s",onClick:function(){o(e.label)}})})))):null)}))))),Object(j.jsx)(b.EuiFlexItem,{className:"documentation__docsText",grow:2},Object(j.jsx)(b.EuiText,{size:"s"},Object(j.jsx)("section",{className:"documentation__docsTextIntro",ref:function(e){var t;e&&null!=a&&null!==(t=a.groups)&&void 0!==t&&t.length&&(c.current[a.groups[0].label]=e)}},null==a?void 0:a.initialSection),null==a?void 0:a.groups.slice(1).map((function(e,t){return Object(j.jsx)("section",{className:"documentation__docsTextGroup",key:e.label,ref:function(t){t&&(c.current[e.label]=t)}},Object(j.jsx)("h2",null,e.label),Object(j.jsx)("p",null,e.description),null==a?void 0:a.groups[t+1].items.map((function(e){return Object(j.jsx)("article",{className:"documentation__docsTextItem",key:e.label,ref:function(t){t&&(c.current[e.label]=t)}},e.description)})))}))))))}a(302);var sl=l.a.memo(il);function ll(e){var t=e.language,a=e.sections,n=e.buttonProps,l=Object(s.useState)(!1),r=tl()(l,2),o=r[0],c=r[1],d=Object(s.useCallback)((function(){c(!o)}),[o]);return Object(j.jsx)(b.EuiPopover,{panelClassName:"documentation__docs--overlay",panelPaddingSize:"none",isOpen:o,closePopover:function(){return c(!1)},button:Object(j.jsx)(b.EuiToolTip,{position:"top",content:u.i18n.translate("languageDocumentationPopover.tooltip",{defaultMessage:"{lang} reference",values:{lang:t}})},Object(j.jsx)(b.EuiButtonIcon,i()({iconType:"documentation",onClick:d},n)))},Object(j.jsx)(sl,{language:t,sections:a}))}var rl=l.a.memo(ll),ol=a(312),ul=a.n(ol),cl=a(41);function dl(e,t,a){if(Cs[e])return`${e}(${Cs[e].positionalArguments.map((({name:e,optional:t,type:a})=>`[${e}]${t?"?":""}: ${a}`)).join(", ")})`;if(t[e]){var n;const a=t[e],i=[];a.filterable&&i.push(u.i18n.translate("xpack.lens.formula.kqlExtraArguments",{defaultMessage:"[kql]?: string, [lucene]?: string"})),a.shiftable&&i.push(u.i18n.translate("xpack.lens.formula.shiftExtraArguments",{defaultMessage:"[shift]?: string"})),a.canReduceTimeRange&&i.push(u.i18n.translate("xpack.lens.formula.reducedTimeRangeExtraArguments",{defaultMessage:"[reducedTimeRange]?: string"}));const s=i.length?", ":"";return`${e}(${null===(n=a.documentation)||void 0===n?void 0:n.signature}${s}${i.join(", ")})`}return""}function pl(e){return e.map((({name:e,type:t,defaultValue:a=5})=>`${e}=${"string"===t?`"${a}"`:a}`)).join(", ")}const ml=[{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.none",{defaultMessage:"None"}),value:""},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.hour",{defaultMessage:"1 hour ago (1h)"}),value:"1h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3hours",{defaultMessage:"3 hours ago (3h)"}),value:"3h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6hours",{defaultMessage:"6 hours ago (6h)"}),value:"6h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.12hours",{defaultMessage:"12 hours ago (12h)"}),value:"12h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.day",{defaultMessage:"1 day ago (1d)"}),value:"1d"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.week",{defaultMessage:"1 week ago (1w)"}),value:"1w"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.month",{defaultMessage:"1 month ago (1M)"}),value:"1M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3months",{defaultMessage:"3 months ago (3M)"}),value:"3M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6months",{defaultMessage:"6 months ago (6M)"}),value:"6M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.year",{defaultMessage:"1 year ago (1y)"}),value:"1y"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.previous",{defaultMessage:"Previous time range"}),value:"previous"}],gl=ml.reduce(((e,{value:t},a)=>({...e,[t]:a})),{});function fl(e,t,a,n,i){const s=t.columnOrder.find((e=>"date_histogram"===t.columns[e].operationType));if(!s&&!a.timeFieldName)return{canShift:!1,hasDateHistogram:!1};if(s&&n&&n[i]&&n[i]){const t=n[i].columns.find((e=>e.id===s));if(t){var l;const a=(null===(l=e.getDateHistogramMeta(t))||void 0===l?void 0:l.interval)||"";return{interval:Kn.search.aggs.parseInterval(a),expression:a,canShift:!0,hasDateHistogram:!0}}}return{canShift:!0,hasDateHistogram:Boolean(s)}}function bl({interval:e,hasDateHistogram:t,canShift:a}){return{canShift:a,isValueTooSmall:t=>e&&t&&"object"==typeof t&&t.asMilliseconds()<e.asMilliseconds(),isValueNotMultiple:t=>e&&t&&"object"==typeof t&&!Number.isInteger(t.asMilliseconds()/e.asMilliseconds()),isInvalid:e=>Boolean("invalid"===e||t&&e&&"previous"===e)}}function hl(e,t){const a=e.columns[t];if(a.timeShift&&"previous"===Object(js.parseTimeShift)(a.timeShift))return Object.values(e.columns).some((e=>"date_histogram"===e.operationType))?[u.i18n.translate("xpack.lens.indexPattern.dateHistogramTimeShift",{defaultMessage:'In a single layer, you are unable to combine previous time range shift with date histograms. Either use an explicit time shift duration in "{column}" or replace the date histogram.',values:{column:a.label}})]:void 0}function xl(e,t,{activeData:a,dataViews:n}){if(!t)return;const i=[];return Object.entries(t.layers).forEach((([t,s])=>{const l=n.indexPatterns[s.indexPatternId];if(!l)return;const r=fl(e,s,l,a,t);if(!r.interval)return;const o=r.expression,u=r.interval.asMilliseconds();let d=[];const p={};Object.entries(s.columns).forEach((([e,t])=>{if(t.isBucketed)return;let a=0;if(t.timeShift){const e=Object(js.parseTimeShift)(t.timeShift);if("previous"===e||"invalid"===e)return;a=e.asMilliseconds()}d.push(a),p[a]||(p[a]=[]),p[a].push(e)})),d=Object(jt.uniq)(d),d.length<2||d.forEach((e=>{0!==e&&(e<u?p[e].forEach((e=>{i.push(Object(j.jsx)(c.FormattedMessage,{key:`small-${e}`,id:"xpack.lens.indexPattern.timeShiftSmallWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is smaller than the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(j.jsx)("strong",null,s.columns[e].label),interval:Object(j.jsx)("strong",null,o),columnTimeShift:Object(j.jsx)("strong",null,s.columns[e].timeShift)}}))})):Number.isInteger(e/u)||p[e].forEach((e=>{i.push(Object(j.jsx)(c.FormattedMessage,{key:`multiple-${e}`,id:"xpack.lens.indexPattern.timeShiftMultipleWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is not a multiple of the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(j.jsx)("strong",null,s.columns[e].label),interval:Object(j.jsx)("strong",null,o),columnTimeShift:Object(j.jsx)("strong",null,s.columns[e].timeShift)}}))})))}))})),i}const vl=[{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.30s",{defaultMessage:"30 seconds (30s)"}),value:"30s"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.1m",{defaultMessage:"1 minute (1m)"}),value:"1m"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.5m",{defaultMessage:"5 minutes (5m)"}),value:"5m"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.15m",{defaultMessage:"15 minutes (15m)"}),value:"15m"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.1h",{defaultMessage:"1 hour (1h)"}),value:"1h"}],yl=vl.reduce(((e,{value:t},a)=>({...e,[t]:a})),{});function jl(e,t,a){const n=e.columns[t];if(!n.reducedTimeRange)return;const i=Object.values(e.columns).some((e=>"date_histogram"===e.operationType)),s=Boolean(a.timeFieldName);return[i&&u.i18n.translate("xpack.lens.indexPattern.reducedTimeRangeWithDateHistogram",{defaultMessage:"Reduced time range can only be used without a date histogram. Either remove the date histogram dimension or remove the reduced time range from {column}.",values:{column:n.label}}),!s&&u.i18n.translate("xpack.lens.indexPattern.reducedTimeRangeWithoutTimefield",{defaultMessage:"Reduced time range can only be used with a specified default time field on the data view. Either use a different data view with default time field or remove the reduced time range from {column}.",values:{column:n.label}})].filter(Boolean)}let Ol;!function(e){e.FIELD="field",e.NAMED_ARGUMENT="named_argument",e.FUNCTIONS="functions",e.KQL="kql",e.SHIFTS="shifts",e.REDUCED_TIME_RANGES="reducedTimeRanges"}(Ol||(Ol={}));const kl="LENS_MATH_MARKER";function Il(e,t,a){if("number"!=typeof e&&(!e.location||(n=t)>=(i=e.location).min&&n<i.max)){var n,i;if("function"===e.type){const[a]=e.args.map((a=>Il(a,t,e))).filter(Ss);return a||(e.location?{ast:e}:void 0)}return{ast:e,parent:a}}}function Tl(e,t,a=0,n=1){return{range:{...t,startColumn:t.startColumn+a,endColumn:t.startColumn+n},text:e}}function wl(e,t){const a=e.split(/\n/);let n=t,i=1;for(const e of a){if(e.length>=n)return new cl.monaco.Position(i,n+1);n-=e.length+1,i++}throw new Error("Algorithm failure")}function Ml(e,t){return e.split(/\n/).slice(0,t.lineNumber).reduce(((e,a,n)=>e+(n===t.lineNumber-1?t.column-1:a.length+1)),0)}async function Cl({expression:e,zeroIndexedOffset:t,context:a,indexPattern:n,operationDefinitionMap:i,dataViews:s,unifiedSearch:l,dateHistogramInterval:r}){const o=e.substr(0,t)+kl+e.substr(t);try{const e=Il(Object(vs.parse)(o),t),u=null==e?void 0:e.ast,c=(null==e?void 0:e.parent)&&"number"!=typeof u&&u&&"type"in u&&"namedArgument"===u.type;if(null!=e&&e.parent&&("="===a.triggerCharacter||c))return await async function({ast:e,unifiedSearch:t,dataViews:a,indexPattern:n,dateHistogramInterval:i}){if("shift"===e.name)return{list:ml.filter((({value:e})=>{if(void 0===i)return!0;const t=Object(js.parseTimeShift)(e);return"previous"!==t&&("invalid"===t||Number.isInteger(t.asMilliseconds()/i))})).map((({value:e})=>e)),type:Ol.SHIFTS};if("reducedTimeRange"===e.name)return{list:vl.map((({value:e})=>e)),type:Ol.REDUCED_TIME_RANGES};if("kql"!==e.name&&"lucene"!==e.name)return{list:[],type:Ol.KQL};if(!t.autocomplete.hasQuerySuggestions("kql"===e.name?"kuery":"lucene"))return{list:[],type:Ol.KQL};const s=e.value.split(kl)[0],l=e.value.indexOf(kl)+1,r=await t.autocomplete.getQuerySuggestions({language:"kql"===e.name?"kuery":"lucene",query:s,selectionStart:l,selectionEnd:l,indexPatterns:[await a.get(n.id)],boolFilter:[]});return{list:null!=r?r:[],type:Ol.KQL}}({ast:u,unifiedSearch:l,dataViews:s,indexPattern:n,dateHistogramInterval:r});if(null!=e&&e.parent)return function(e,t,a,n,i){const{name:s}=e,l=i[s];if(!l&&!Cs[s])return{list:[],type:Ol.FIELD};const r=Cs[s];if(r)return r.positionalArguments[t]?{list:Object(jt.uniq)(Sl(n,i)).map((e=>({type:"math",label:e}))),type:Ol.FUNCTIONS}:{list:[],type:Ol.FIELD};if(t>0||!Ys(l.type)){const{namedArguments:t}=ks(e.args),a=[];return l.filterable&&(t.find((e=>"kql"===e.name||"lucene"===e.name))||(a.push("kql"),a.push("lucene"))),l.shiftable&&(t.find((e=>"shift"===e.name))||a.push("shift")),l.canReduceTimeRange&&(t.find((e=>"reducedTimeRange"===e.name))||a.push("reducedTimeRange")),"operationParams"in l&&a.push(...l.operationParams.filter((e=>!t.find((t=>t.name===e.name)))).map((e=>e.name))),{list:a,type:Ol.NAMED_ARGUMENT}}if("field"===l.input&&0===t){const t=Oc(n,i).filter((({operationMetaData:e})=>("number"===e.dataType||"date"===e.dataType)&&!e.isBucketed));if(t.length){const n=t.flatMap((e=>e.operations)).filter((e=>e.operationType===l.type)).map((e=>"field"in e?e.field:void 0)).filter(Ss),i=e.args[0],s="string"!=typeof i&&i.location;let r;if(s){const e=wl(a,s.min),t=wl(a,s.max-kl.length);r=cl.monaco.Range.fromPositions(e,t)}return{list:n,type:Ol.FIELD,range:r}}return{list:[],type:Ol.FIELD}}if("fullReference"===l.input){const e=Oc(n,i),t=[];return e.forEach((e=>{l.requiredReferences.some((t=>t.validateMetadata(e.operationMetaData)))&&t.push(...e.operations.filter((e=>l.requiredReferences.some((t=>t.input.includes(e.type))))).map((e=>e.operationType)))})),{list:Object(jt.uniq)(t).map((e=>({label:e,type:"operation"}))),type:Ol.FUNCTIONS}}return{list:[],type:Ol.FIELD}}(e.parent,e.parent.args.findIndex((e=>e===u)),o,n,i);if("object"==typeof u&&Boolean("variable"===u.type||"function"===u.type))return function(e,t,a){return{list:Object(jt.uniq)(Sl(t,a).filter((t=>Object(jt.startsWith)(t,e)))).map((e=>({label:e,type:"operation"}))),type:Ol.FUNCTIONS}}(("function"===u.type?u.name:u.value).split(kl)[0],n,i)}catch(e){}return{list:[],type:Ol.FIELD}}function Sl(e,t){const a=Oc(e,t),n=[];return a.forEach((e=>{"number"!==e.operationMetaData.dataType||e.operationMetaData.isBucketed||n.push(...e.operations.filter((e=>"managedReference"!==e.type)).map((e=>e.operationType)))})),[...Object(jt.uniq)(n),...Object.keys(Cs)]}const Fl={title:"Trigger Suggestion Dialog",id:"editor.action.triggerSuggest"};function El(e,t){if(Cs[e])return[{label:dl(e,t),documentation:{value:Cs[e].help.replace(/\n/g,"\n\n")},parameters:Cs[e].positionalArguments.map((e=>({label:e.name,documentation:e.optional?u.i18n.translate("xpack.lens.formula.optionalArgument",{defaultMessage:"Optional. Default value is {defaultValue}",values:{defaultValue:e.defaultValue}}):""})))}];if(t[e]){const a=t[e],n=Ys(e)?{label:"field"===a.input?"field":"fullReference"===a.input?"function":""}:null,i=dl(e,t),s=function(e,t){const{description:a,examples:n}=function(e,t){var a,n;const i=t[e],s=null!==(a=null===(n=i.documentation)||void 0===n?void 0:n.description)&&void 0!==a?a:"",l=[];if(!/Example/.test(s)){if(!Ys(e))return l.push(`${e}()`),{description:s,examples:l};if("field"===i.input){var r;const t=(null===(r=i.operationParams)||void 0===r?void 0:r.filter((({required:e})=>e)))||[];if(0===t.length&&l.push(`${e}(bytes)`),t.length){const a=pl(t);l.push(`${e}(bytes, ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=pl(i.operationParams);l.push(`${e}(bytes, ${t})`)}}if("fullReference"===i.input){var o;const t=(null===(o=i.operationParams)||void 0===o?void 0:o.filter((({required:e})=>e)))||[];if(0===t.length&&l.push(`${e}(sum(bytes))`),t.length){const a=pl(t);l.push(`${e}(sum(bytes), ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=pl(i.operationParams);l.push(`${e}(sum(bytes), ${t})`)}}}return{description:s,examples:l}}(e,t);return{value:`${a}${n.length?`\n\n**${u.i18n.translate("xpack.lens.formulaExampleMarkdown",{defaultMessage:"Examples"})}**\n\n  ${n.map((e=>`\`${e}\``)).join("\n\n")}`:""}`}}(e,t);return"operationParams"in a&&a.operationParams?[{label:i,parameters:[...n?[n]:[],...a.operationParams.map((e=>({label:`${e.name}=${e.type}`,documentation:e.required?u.i18n.translate("xpack.lens.formula.requiredArgument",{defaultMessage:"Required"}):""})))],documentation:s}]:[{label:i,parameters:n?[n]:[],documentation:s}]}return[]}function Pl(e,t){const a=e.substr(0,t)+kl+e.substr(t);try{return Il(Object(vs.parse)(a),t)}catch(e){return}}const Al="lens_math";cl.monaco.languages.register({id:Al});const _l={wordPattern:/[^()'"\s]+/g,brackets:[["(",")"]],autoClosingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}],surroundingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}]},Ll={defaultToken:"invalid",tokenPostfix:"",ignoreCase:!0,brackets:[{open:"(",close:")",token:"delimiter.parenthesis"}],escapes:/\\(?:[\\"'])/,tokenizer:{root:[[/\s+/,"whitespace"],[/-?(\d*\.)?\d+([eE][+\-]?\d+)?/,"number"],[/[a-zA-Z0-9][a-zA-Z0-9_\-\.]*/,"keyword"],[/[,=:]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_dq"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/'/,"string","@string_sq"],[/\+|\-|\*|\//,"keyword.operator"],[/[\(]/,"delimiter"],[/[\)]/,"delimiter"]],string_dq:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_sq:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]]}};cl.monaco.languages.onLanguage(Al,(()=>{cl.monaco.languages.setMonarchTokensProvider(Al,Ll),cl.monaco.languages.setLanguageConfiguration(Al,_l)})),a(307);const Dl={type:"math",displayName:"Math",hidden:!0,getDefaultLabel:(e,t)=>"Math",input:"managedReference",getDisabledStatus(e){},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{const a=e.columns[t];return[{type:"function",function:"mathColumn",arguments:{id:[t],name:[a.label],expression:[Rl(a.params.tinymathAst)],onError:["null"],castColumns:a.references}}]},buildColumn:()=>({label:"Math",dataType:"number",operationType:"math",isBucketed:!1,scale:"ratio",params:{tinymathAst:""},references:[]}),isTransferable:(e,t)=>!0,createCopy:e=>({...e})},Nl={add:"+",subtract:"-",multiply:"*",divide:"/",lt:"<",gt:">",eq:"==",lte:"<=",gte:">="};function Rl(e){return"number"==typeof e?e:"string"==typeof e?`"${e}"`:"variable"===e.type?e.value:"namedArgument"===e.type?"kql"===e.name||"lucene"===e.name?`${e.name}='${e.value}'`:`${e.name}=${e.value}`:Nl[e.name]?`(${e.args.map(Rl).join(` ${Nl[e.name]} `)})`:`${t=e.name,Bl.reduce(((e,t)=>e.replace(t,"")),t)}(${e.args.map(Rl).join(",")})`;var t}const Bl=["pick_"];var Vl=a(83);function zl(e,t){return`${e}X${t}`}function Gl(e,t,a,n){const i={...a,columns:{...a.columns,[e]:{...t}}},{columns:s,meta:l}=Object.entries(i.columns).reduce(((t,[a,s])=>{if(a.startsWith(e)){if(a===e&&function(e){return"params"in e&&"formula"in e.params}(s)){const e=function(e,t,a,{indexPattern:n,operations:i=gc}){const{columns:s,meta:l}={columns:{},meta:{locations:{}}},r=t.params.formula||"",{extracted:o,isValid:c}=function(e,t,a,n,i,s){const{root:l,error:r}=Ns(e,i);if(r||null==l)return{extracted:[],isValid:!1};if(Rs(l,t,n,i,t.columns[a]).length)return{extracted:[],isValid:!1};const o=function(e,t,a,n,i,s){const l=[],{filter:r,reducedTimeRange:o}=n.columns[e],u=function a(u){if("number"==typeof u||"function"!==u.type)return u;const c=t[u.name];if(!c){const e=u.args.map(a).filter(Ss);return{...u,args:e}}const{namedArguments:d,variables:p,functions:m}=ks(u.args);if("field"===c.input){const[t]=p.filter((e=>Object(jt.isObject)(e)));let a=t?i.getFieldByName(t.value):void 0;Xs(u)||a||(a=Vl.a);const m={...Ts(c,ws(c,d||[]),r,o),usedInMath:!0},g=c.buildColumn({layer:n,indexPattern:i,field:a},m),f=zl(e,l.length);return g.customLabel=!0,g.label=s,l.push({column:g,location:u.location}),f}if("fullReference"===c.input){const[t]=m,p=a(t),g="string"!=typeof p;if(g){const e=p?Es(p):[],t=Dl.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=p,l.push({column:t}),t.customLabel=!0,t.label=s}const f=Ts(c,ws(c,d||[]),r,o),b=c.buildColumn({layer:n,indexPattern:i,referenceIds:[g?zl(e,l.length-1):p]},f),h=zl(e,l.length);return b.customLabel=!0,b.label=s,l.push({column:b,location:u.location}),h}}(a);if(void 0===u)return[];if("string"!=typeof u){const e=Es(u),t=Dl.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=u,t.customLabel=!0,t.label=s,l.push({column:t})}return l}(a,i,l,t,n,u.i18n.translate("xpack.lens.indexPattern.formulaPartLabel",{defaultMessage:"Part of {label}",values:{label:s||e}}));return{extracted:o,isValid:!0}}(r,a,e,n,Ps(i),t.customLabel?t.label:void 0);return o.forEach((({column:t,location:a},n)=>{const i=zl(e,n);s[i]=t,a&&(l.locations[i]=a)})),s[e]={...t,label:t.customLabel?t.label:null!=r?r:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),references:c?[zl(e,o.length-1)]:[],params:{...t.params,formula:r,isFormulaBroken:!c}},{columns:s,meta:l}}(a,s,i,n);t.columns={...t.columns,...e.columns},t.meta={...t.meta,...e.meta}}}else t.columns[a]={...s};return t}),{columns:{},meta:{locations:{}}});return{layer:{...i,columns:s,columnOrder:kr({...i,columns:s})},meta:l}}function ql(e,t,a){const n=null==e?void 0:e[t];return!(!n||0===n.rows.length)&&n.rows.some((e=>null!=e[a]))}const Hl=l.a.memo(Wl),$l=new Set(["kql","lucene","shift","reducedTimeRange"]);function Wl({layer:e,paramEditorUpdater:t,currentColumn:a,columnId:n,indexPattern:r,operationDefinitionMap:o,unifiedSearch:c,dataViews:p,toggleFullscreen:m,isFullscreen:g,setIsCloseable:f,dateHistogramInterval:h,hasData:x}){var v;const[O,I]=Object(s.useState)(a.params.formula),[T,w]=Object(s.useState)([]),[M,C]=Object(s.useState)(g),[S,F]=Object(s.useState)(!1),[E,P]=Object(s.useState)(!0),A=l.a.useRef(),_=l.a.useRef(),L=l.a.useRef([]),D=l.a.useRef(),{euiTheme:N}=Object(b.useEuiTheme)(),R=Object(s.useMemo)((()=>Ps(o)),[o]),B=Object(s.useMemo)((()=>function({indexPattern:e,operationDefinitionMap:t}){const a=[];a.push({label:u.i18n.translate("xpack.lens.formulaDocumentationHeading",{defaultMessage:"How it works"}),items:[]}),a.push({label:u.i18n.translate("xpack.lens.formulaFrequentlyUsedHeading",{defaultMessage:"Common formulas"}),description:u.i18n.translate("xpack.lens.formulaCommonFormulaDocumentation",{defaultMessage:'The most common formulas are dividing two values to produce a percent. To display accurately, set "value format" to "percent".'}),items:[{label:u.i18n.translate("xpack.lens.formulaDocumentation.filterRatio",{defaultMessage:"Filter ratio"}),description:Object(j.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.filterRatioDescription.markdown",{defaultMessage:"### Filter ratio:\n\nUse `kql=''` to filter one set of documents and compare it to other documents within the same grouping.\nFor example, to see how the error rate changes over time:\n\n```\ncount(kql='response.status_code > 400') / count()\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeek",{defaultMessage:"Week over week"}),description:Object(j.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeekDescription.markdown",{defaultMessage:"### Week over week:\n\nUse `shift='1w'` to get the value of each grouping from\nthe previous week. Time shift should not be used with the *Top values* function.\n\n```\npercentile(system.network.in.bytes, percentile=99) /\npercentile(system.network.in.bytes, percentile=99, shift='1w')\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotal",{defaultMessage:"Percent of total"}),description:Object(j.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotalDescription.markdown",{defaultMessage:"### Percent of total\n\nFormulas can calculate `overall_sum` for all the groupings,\nwhich lets you convert each grouping into a percent of total:\n\n```\nsum(products.base_price) / overall_sum(sum(products.base_price))\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.recentChange",{defaultMessage:"Recent change"}),description:Object(j.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.recentChangeDescription.markdown",{defaultMessage:'### Recent change\n\nUse `reducedTimeRange=\'30m\'` to add an additional filter on the time range of a metric aligned with the end of the global time range. This can be used to calculate how much a value changed recently.\n\n```\nmax(system.network.in.bytes, reducedTimeRange="30m")\n - min(system.network.in.bytes, reducedTimeRange="30m")\n```\n        ',description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})}]}),a.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSection",{defaultMessage:"Elasticsearch"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSectionDescription",{defaultMessage:"These functions will be executed on the raw documents for each row of the resulting table, aggregating all documents matching the break down dimensions into a single value."}),items:[]});const{elasticsearch:n,calculation:i,math:s,comparison:r}=Object(jt.groupBy)(Sl(e),(e=>{var a;return e in t?null===(a=t[e].documentation)||void 0===a?void 0:a.section:e in Cs?Cs[e].section:void 0}));a[2].items.push(...n.sort().map((e=>{var a,n;return{label:e,description:Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("h3",null,e,"(",null===(a=t[e].documentation)||void 0===a?void 0:a.signature,")"),null!==(n=t[e].documentation)&&void 0!==n&&n.description?Object(j.jsx)(d.Markdown,{markdown:t[e].documentation.description}):null)}}))),a.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSection",{defaultMessage:"Column calculations"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSectionDescription",{defaultMessage:"These functions are executed for each row, but are provided with the whole column as context. This is also known as a window function."}),items:[]}),a[3].items.push(...i.sort().map((e=>{var a,n;return{label:e,description:Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("h3",null,e,"(",null===(a=t[e].documentation)||void 0===a?void 0:a.signature,")"),null!==(n=t[e].documentation)&&void 0!==n&&n.description?Object(j.jsx)(d.Markdown,{markdown:t[e].documentation.description}):null)}}))),a.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.mathSection",{defaultMessage:"Math"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.mathSectionDescription",{defaultMessage:"These functions will be executed for reach row of the resulting table using single values from the same row calculated using other functions."}),items:[]});const o=s.sort().map((e=>{const[t,a]=Cs[e].help.split("```");return{label:e,description:t.replace(/\n/g,"\n\n"),examples:a?`\`\`\`${a}\`\`\``:""}}));a[4].items.push(...o.map((({label:e,description:a,examples:n})=>({label:e,description:Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("h3",null,dl(e,t)),Object(j.jsx)(d.Markdown,{markdown:`${a}${n}`}))})))),a.push({label:u.i18n.translate("xpack.lens.formulaDocumentation.comparisonSection",{defaultMessage:"Comparison"}),description:u.i18n.translate("xpack.lens.formulaDocumentation.comparisonSectionDescription",{defaultMessage:"These functions are used to perform value comparison."}),items:[]});const c=r.sort().map((e=>{const[t,a]=Cs[e].help.split("```");return{label:e,description:t.replace(/\n/g,"\n\n"),examples:a?`\`\`\`${a}\`\`\``:""}}));return a[5].items.push(...c.map((({label:e,description:a,examples:n})=>({label:e,description:Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("h3",null,dl(e,t)),Object(j.jsx)(d.Markdown,{markdown:`${a}${n}`}))})))),{groups:a,initialSection:Object(j.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.markdown",{defaultMessage:"## How it works\n\nLens formulas let you do math using a combination of Elasticsearch aggregations and\nmath functions. There are three main types of functions:\n\n* Elasticsearch metrics, like `sum(bytes)`\n* Time series functions use Elasticsearch metrics as input, like `cumulative_sum()`\n* Math functions like `round()`\n\nAn example formula that uses all of these:\n\n```\nround(100 * moving_average(\naverage(cpu.load.pct),\nwindow=10,\nkql='datacenter.name: east*'\n))\n```\n\nElasticsearch functions take a field name, which can be in quotes. `sum(bytes)` is the same\nas `sum('bytes')`.\n\nSome functions take named arguments, like `moving_average(count(), window=5)`.\n\nElasticsearch metrics can be filtered using KQL or Lucene syntax. To add a filter, use the named\nparameter `kql='field: value'` or `lucene=''`. Always use single quotes when writing KQL or Lucene\nqueries. If your search has a single quote in it, use a backslash to escape, like: `kql='Women's''\n\nMath functions can take positional arguments, like pow(count(), 3) is the same as count() * count() * count()\n\nUse the symbols +, -, /, and * to perform basic math.\n      ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})}}({indexPattern:r,operationDefinitionMap:R})),[r,R]),V="interval"in h?null===(v=h.interval)||void 0===v?void 0:v.asMilliseconds():void 0,z=Object(s.useRef)(V);if(z.current=V,null==_||!_.current){const e=_.current=document.createElement("div");e.setAttribute("data-test-subj","lnsFormulaWidget"),e.classList.add("lnsFormulaOverflow","monaco-editor"),document.body.appendChild(e)}Object(s.useEffect)((()=>{const e=A,t=L,a=D;return()=>{var n,i,s,l,r;null===(n=e.current)||void 0===n||n.dispose(),null===(i=_.current)||void 0===i||null===(s=i.parentNode)||void 0===s||s.removeChild(_.current),null===(l=a.current)||void 0===l||l.dispose(),null===(r=t.current)||void 0===r||r.forEach((e=>e.dispose()))}}),[]),ul()((()=>{f(!0),O!==a.params.formula&&t((e=>Gl(n,{...a,params:{...a.params,formula:O||""}},e,{indexPattern:r,operations:o}).layer))})),Object(k.E)((()=>{if(!A.current)return;if(!O)return w([]),cl.monaco.editor.setModelMarkers(A.current,"LENS",[]),void(a.params.formula&&t(Gl(n,{...a,params:{...a.params,formula:O||""}},e,{indexPattern:r,operations:o}).layer));let i=[];const{root:s,error:l}=Ns(O,R);if(l)i=[l];else if(s){const t=Rs(s,e,r,R,a);t.length&&(i=t)}if(i.length){const s=a.params.isFormulaBroken,l=!a.params.isFormulaBroken&&!x;(s||l)&&a.params.formula!==O&&t(Gl(n,{...a,params:{...a.params,formula:O||""}},e,{indexPattern:r,operations:o}).layer);const u=i.flatMap((e=>{if(e.locations.length)return e.locations.map((t=>{const a=wl(O,t.min),n=wl(O,t.max);return{message:e.message,startColumn:a.column+1,startLineNumber:a.lineNumber,endColumn:n.column+1,endLineNumber:n.lineNumber,severity:"warning"===e.severity?cl.monaco.MarkerSeverity.Warning:cl.monaco.MarkerSeverity.Error}}));{const t=wl(O,0),a=wl(O,O.length-1);return[{message:e.message,startColumn:t.column+1,startLineNumber:t.lineNumber,endColumn:a.column+1,endLineNumber:a.lineNumber,severity:"warning"===e.severity?cl.monaco.MarkerSeverity.Warning:cl.monaco.MarkerSeverity.Error}]}}));cl.monaco.editor.setModelMarkers(A.current,"LENS",u),w(u.map((({severity:e,message:t})=>({severity:e,message:t}))))}else{cl.monaco.editor.setModelMarkers(A.current,"LENS",[]);const{layer:i,meta:{locations:s}}=Gl(n,{...a,params:{...a.params,formula:O||""}},e,{indexPattern:r,operations:o});t(i);const l=Lr(n,i.columns).flatMap((([e,t])=>{const a=[];if(s[e]){const n=R[t.operationType];if(n.getErrorMessage){const t=n.getErrorMessage(i,e,r,R);if(t){const n=wl(O,s[e].min),i=wl(O,s[e].max);a.push({message:t.join(", "),startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:cl.monaco.MarkerSeverity.Warning})}}if(n.shiftable&&t.timeShift){const n=wl(O,s[e].min),i=wl(O,s[e].max);a.push(...function(e,t){const{isValueTooSmall:a,isValueNotMultiple:n}=bl(e),i=[],s=t.timeShift&&Object(js.parseTimeShift)(t.timeShift),l=s&&a(s),r=s&&n(s);return l?i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})):r&&i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"})),i}(h,t).map((e=>({message:e,startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:cl.monaco.MarkerSeverity.Warning}))))}}return a})).filter(Ss);w(l.map((({severity:e,message:t})=>({severity:e,message:t})))),cl.monaco.editor.setModelMarkers(A.current,"LENS",l)}}),{skipFirstRender:!1},256,[O,a.filter]);const G=T.filter((e=>e.severity===cl.monaco.MarkerSeverity.Error)).length,q=T.filter((e=>e.severity===cl.monaco.MarkerSeverity.Warning)).length,H=Object(s.useCallback)((async(e,t,a)=>{const n=e.getValue();let i={list:[],type:Ol.FIELD};const s=Ml(n,t);return"("===a.triggerCharacter?("()"===n.slice(s-1,s+1)&&(t=t.delta(0,-1)),e.getWordAtPosition(t.delta(0,-3))&&(i=await Cl({expression:n,zeroIndexedOffset:s,context:a,indexPattern:r,operationDefinitionMap:R,unifiedSearch:c,dataViews:p,dateHistogramInterval:z.current}))):i=await Cl({expression:n,zeroIndexedOffset:s,context:a,indexPattern:r,operationDefinitionMap:R,unifiedSearch:c,dataViews:p,dateHistogramInterval:z.current}),{suggestions:i.list.map((e=>function(e,t,a,n,i){var s;let l,r,o,u=cl.monaco.languages.CompletionItemKind.Method,c="string"==typeof e?e:"label"in e?e.label:e.text,d="",p="";const m=c;switch(t){case Ol.SHIFTS:p=String(gl[c]).padStart(4,"0");break;case Ol.REDUCED_TIME_RANGES:p=String(yl[c]).padStart(4,"0");break;case Ol.FIELD:u=cl.monaco.languages.CompletionItemKind.Value,Os.test(c)&&(l=`'${c.replaceAll("'","\\'")}'`);break;case Ol.FUNCTIONS:if(l=`${c}($0)`,r=cl.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,"string"!=typeof e){if("text"in e)break;c=dl(e.label,a),Cs[e.label]?(d="TinyMath",u=cl.monaco.languages.CompletionItemKind.Method):(u=cl.monaco.languages.CompletionItemKind.Constant,d="Elasticsearch",p=`0${c}`,o=Fl)}break;case Ol.NAMED_ARGUMENT:u=cl.monaco.languages.CompletionItemKind.Keyword,"kql"!==c&&"lucene"!==c&&"shift"!==c&&"reducedTimeRange"!==c||(o=Fl,l=`${c}='$0'`,r=cl.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,p=`zzz${c}`),c=`${c}=`,d="";break;case Ol.KQL:":"===n?l=`${n} ${c}`:o=Fl,c.includes("'")&&(l=(l||c).replaceAll("'","\\'"))}return{detail:d,kind:u,label:c,insertText:null!==(s=l)&&void 0!==s?s:c,insertTextRules:r,command:o,additionalTextEdits:[],range:i,sortText:p,filterText:m}}(e,i.type,R,a.triggerCharacter,i.range)))}}),[r,R,c,p,z]),$=Object(s.useCallback)((async(e,t,a,n)=>{const i=e.getValue(),s=e.getFullModelRange(),l=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:s.endLineNumber,endColumn:s.endColumn});return function(e,t,a){const n=e.substr(0,t)+kl+e.substr(t);try{const e=Il(Object(vs.parse)(n),t);let i=[],s=0;if(null!=e&&e.parent){const t=e.parent.name;s=e.parent.args.findIndex((t=>t===e.ast)),i=El(t,a)}else"object"==typeof(null==e?void 0:e.ast)&&"function"===e.ast.type&&(i=El(e.ast.name,a));if(i.length)return{value:{signatures:i.map((({documentation:e,...t})=>({...t,documentation:{value:e.value.split("\n\n")[0]}}))),activeParameter:s,activeSignature:0},dispose:()=>{}}}catch(e){}return{value:{signatures:[],activeParameter:0,activeSignature:0},dispose:()=>{}}}(e.getValue(),i.length-l,R)}),[R]),W=Object(s.useCallback)((async(e,t,a)=>{const n=e.getValue(),i=e.getFullModelRange(),s=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:i.endLineNumber,endColumn:i.endColumn});return function(e,t,a){try{const n=Il(Object(vs.parse)(e),t);if(!n||"number"==typeof n.ast||!("name"in n.ast))return{contents:[]};const i=El(n.ast.name,a);if(i.length){const{label:e}=i[0];return{contents:[{value:e}]}}}catch(e){}return{contents:[]}}(e.getValue(),n.length-s,R)}),[R]),U=Object(s.useCallback)(((e,t)=>{if(!(e.isFlush||e.isRedoing||e.isUndoing)&&1===e.changes.length){const n=e.changes[0].text;if("="!==n&&"'"!==n)return;const i=e.changes[0].range;if(i){var a;const e=t.getValue(),s=Ml(e,new cl.monaco.Position(i.startLineNumber,i.startColumn));let l=Pl(e,s+1);if(!l&&"'"===n){const t=e;l=Pl(t.substring(0,s)+"\\'"+t.substring(s+1),s+2)}const r=/'LENS_MATH_MARKER/;if(l&&("number"==typeof l.ast||"namedArgument"!==l.ast.type||!$l.has(l.ast.name)||l.ast.value!==kl&&!r.test(l.ast.value)))return;let o=null;const u=2;if("="===n&&(l||"="===e.charAt(s-1)||(o=Tl("=",i,1)),l&&(o=Tl("''",i,1))),!l&&!o)return;"'"===n&&null!==(a=l)&&void 0!==a&&a.ast&&"number"!=typeof l.ast&&"name"in l.ast&&"shift"!==l.ast.name&&"reducedTimeRange"!==l.ast.name&&(o=Tl("\\'",i)),o&&setTimeout((()=>{var e;t.executeEdits("LENS",[o],[new cl.monaco.Selection(i.startLineNumber,i.startColumn+u,i.startLineNumber,i.startColumn+u)]),t.setPosition({column:i.startColumn+u,lineNumber:i.startLineNumber}),"="!==(null===(e=o)||void 0===e?void 0:e.text)&&t.trigger("lens","editor.action.triggerSuggest",{})}),0)}}}),[]),X={languageId:Al,value:null!=O?O:"",onChange:I,options:{automaticLayout:!0,fontSize:14,folding:!1,lineNumbers:"off",scrollBeyondLastLine:!1,minimap:{enabled:!1},wordWrap:E?"on":"off",wordBasedSuggestions:!1,autoIndent:"brackets",wrappingIndent:"none",dimension:{width:320,height:200},fixedOverflowWidgets:!0,matchBrackets:"always",lineDecorationsWidth:16}};return Object(s.useEffect)((()=>{const{dispose:e}=cl.monaco.languages.registerCompletionItemProvider(Al,{triggerCharacters:[".","(","="," ",":","'"],provideCompletionItems:H}),{dispose:t}=cl.monaco.languages.registerSignatureHelpProvider(Al,{signatureHelpTriggerCharacters:["(","="],provideSignatureHelp:$}),{dispose:a}=cl.monaco.languages.registerHoverProvider(Al,{provideHover:W});return()=>{e(),t(),a()}}),[H,$,W]),Object(j.jsx)("div",{className:y()({lnsIndexPatternDimensionEditor:!0,"lnsIndexPatternDimensionEditor-isFullscreen":g})},!g&&Object(j.jsx)(b.EuiFormLabel,{css:Object(j.css)("margin-top:",N.size.base,";margin-bottom:",N.size.xs,";","")},u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingFormula",{defaultMessage:"Formula"})),Object(j.jsx)("div",{className:"lnsIndexPatternDimensionEditor--shaded",css:Object(j.css)("border:",g?"none":N.border.thin,";border-radius:",g?0:N.border.radius.medium,";height:",g?"100%":"auto",";","")},Object(j.jsx)("div",{className:"lnsFormula"},Object(j.jsx)("div",{className:"lnsFormula__editor"},Object(j.jsx)("div",{className:"lnsFormula__editorHeader"},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup"},Object(j.jsx)(b.EuiToolTip,{content:E?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),position:"top"},Object(j.jsx)(b.EuiButtonIcon,{iconType:E?"wordWrap":"wordWrapDisabled",display:E?void 0:"fill",color:"text","aria-label":E?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),isSelected:!E,onClick:()=>{var e;null===(e=D.current)||void 0===e||e.updateOptions({wordWrap:E?"off":"on"}),P(!E)}}))),Object(j.jsx)(b.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup",grow:!1},Object(j.jsx)(b.EuiButtonEmpty,{onClick:()=>{m(),C(!g)},iconType:g?"fullScreenExit":"fullScreen",size:"xs",color:"text",flush:"right","data-test-subj":"lnsFormula-fullscreen"},g?u.i18n.translate("xpack.lens.formula.fullScreenExitLabel",{defaultMessage:"Collapse"}):u.i18n.translate("xpack.lens.formula.fullScreenEnterLabel",{defaultMessage:"Expand"}))))),Object(j.jsx)("div",{className:"lnsFormula__editorContent"},Object(j.jsx)(d.CodeEditor,i()({},X,{options:{...X.options,overflowWidgetsDomNode:_.current},editorDidMount:e=>{D.current=e;const t=e.getModel();t&&(A.current=t),L.current.push(e.onDidFocusEditorWidget((()=>{setTimeout((()=>{f(!1)}))}))),L.current.push(e.onDidBlurEditorWidget((()=>{setTimeout((()=>{f(!0)}))}))),L.current.push(e.onDidChangeModelContent((t=>{U(t,e)})))}})),O?null:Object(j.jsx)("div",{className:"lnsFormula__editorPlaceholder"},Object(j.jsx)(b.EuiText,{color:"subdued",size:"s"},u.i18n.translate("xpack.lens.formulaPlaceholderText",{defaultMessage:"Type a formula by combining functions with math, like:"})),Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)("pre",null,"count() + 1"))),Object(j.jsx)("div",{className:"lnsFormula__editorFooter"},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{className:"lnsFormula__editorFooterGroup"},g?Object(j.jsx)(b.EuiToolTip,{content:M?u.i18n.translate("xpack.lens.formula.editorHelpInlineHideToolTip",{defaultMessage:"Hide function reference"}):u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"}),delay:"long",position:"top"},Object(j.jsx)(b.EuiLink,{"aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineHideLabel",{defaultMessage:"Hide function reference"}),className:"lnsFormula__editorHelp lnsFormula__editorHelp--inline",color:"text",onClick:()=>C(!M)},Object(j.jsx)(b.EuiIcon,{type:"documentation"}),Object(j.jsx)(b.EuiIcon,{type:M?"arrowDown":"arrowUp"}))):Object(j.jsx)(rl,{language:"Formula",sections:B,buttonProps:{color:"text",className:"lnsFormula__editorHelp lnsFormula__editorHelp--overlay","data-test-subj":"unifiedTextLangEditor-documentation","aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"})}})),G||q?Object(j.jsx)(b.EuiFlexItem,{className:"lnsFormula__editorFooterGroup",grow:!1},Object(j.jsx)(b.EuiPopover,{ownFocus:!1,isOpen:S,closePopover:()=>F(!1),button:Object(j.jsx)(b.EuiButtonEmpty,{color:G?"danger":"warning",className:"lnsFormula__editorError",iconType:"alert",size:"xs",flush:"right",onClick:()=>{F(!S)}},G?u.i18n.translate("xpack.lens.formulaErrorCount",{defaultMessage:"{count} {count, plural, one {error} other {errors}}",values:{count:G}}):null,q?u.i18n.translate("xpack.lens.formulaWarningCount",{defaultMessage:"{count} {count, plural, one {warning} other {warnings}}",values:{count:q}}):null)},T.map((({message:e,severity:t},a)=>Object(j.jsx)("div",{key:a,className:"lnsFormula__warningText"},Object(j.jsx)(b.EuiText,{size:"s",color:t===cl.monaco.MarkerSeverity.Warning?"warning":"danger"},e)))))):null))),g&&M?Object(j.jsx)("div",{className:"lnsFormula__docs documentation__docs--inline"},Object(j.jsx)(sl,{language:"Formula",sections:B})):null)))}var Ul=a(63);function Xl(e,t){var a,n;if(!t)return;const{operationType:i}=e,s=i?gc[i]:void 0,l=Object(Ul.c)(e)&&s?null!==(a=null==s||null===(n=s.getCurrentFields)||void 0===n?void 0:n.call(s,e))&&void 0!==a?a:[e.sourceField]:[],r=l.map((e=>t.getFieldByName(e))),o=r.filter(Boolean),c=Boolean(r.length>o.length||!("field"===(null==s?void 0:s.input)&&o.every((e=>null!=s.getPossibleOperationForField(e))))),d=Boolean(o.length&&!(null!=s&&s.isTransferable(e,t,gc)));if(c){const a=r.map(((e,t)=>e?null:l[t])).filter(Boolean);if(a.length)return[u.i18n.translate("xpack.lens.indexPattern.fieldsNotFound",{defaultMessage:"{count, plural, one {Field} other {Fields}} {missingFields} {count, plural, one {was} other {were}} not found",values:{count:a.length,missingFields:a.join(", ")}})];if(d){var p,m;const a=null!==(p=null==s||null===(m=s.getNonTransferableFields)||void 0===m?void 0:m.call(s,e,t))&&void 0!==p?p:l;return[u.i18n.translate("xpack.lens.indexPattern.fieldsWrongType",{defaultMessage:"{count, plural, one {Field} other {Fields}} {invalidFields} {count, plural, one {is} other {are}} of the wrong type",values:{count:a.length,invalidFields:a.join(", ")}})]}}}function Yl(e){const t=e.filter(Boolean).flat();return t.length?t:void 0}function Kl(e,t){const a=t.getFieldByName(e);return a?a.displayName:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})}function Ql(e,t,a,n){const i=Number(e);return""!==e&&null!=e&&!Number.isNaN(i)&&Number.isFinite(i)&&(!t||Number.isInteger(i))&&(void 0===a||i<=a)&&(void 0===n||i>=n)}function Zl(e,t){return t.operationType===e}const Jl=e=>"operationType"in e;function er(e){return Boolean("params"in e&&e.params&&"format"in e.params)}function tr(e){return"number"===(null==e?void 0:e.dataType)&&er(e)&&e.params?{format:e.params.format}:void 0}function ar(e,t){let a=null==e?void 0:e.filter;var n;if(t)if("kql"in t)a={query:null!==(n=t.kql)&&void 0!==n?n:"",language:"kuery"};else if("lucene"in t){var i;a={query:null!==(i=t.lucene)&&void 0!==i?i:"",language:"lucene"}}return a}function nr({sourceField:e,operationType:t}){return!e||"count"===t&&e===at.c?"":Os.test(e)?`'${e.replaceAll("'","\\'")}'`:e}const ir=u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),sr={type:"formula",displayName:ir,getDefaultLabel:(e,t)=>{var a;return null!==(a=e.params.formula)&&void 0!==a?a:ir},input:"managedReference",hidden:!0,filterable:{helpMessage:u.i18n.translate("xpack.lens.indexPattern.formulaFilterableHelpText",{defaultMessage:"The provided filter will be applied to the entire formula."})},canReduceTimeRange:{helpMessage:u.i18n.translate("xpack.lens.indexPattern.formulaCanReduceTimeRangeHelpText",{defaultMessage:"Applies to the entire formula."})},getDisabledStatus(e){},getErrorMessage(e,t,a,n){const i=e.columns[t];if(!i.params.formula||!n)return;const s=Ps(n),{root:l,error:r}=Ns(i.params.formula,s);if(r||null==l)return null!=r&&r.message?[r.message]:[];const o=Rs(l,e,a,s,i);if(o.length)return Array.from(new Set(o.map((({message:e})=>e))));const c=Lr(t,e.columns).flatMap((([t,n])=>{const i=s[n.operationType];if(null!=i&&i.getErrorMessage){const n=i.getErrorMessage(e,t,a,s);return n?{message:n.join(", ")}:[]}return[]})).filter(Ss),d=e.columnOrder.some((t=>e.columns[t].isBucketed)),p=e.columnOrder.some((t=>{const a=e.columns[t];return!a.isBucketed&&!a.isStaticValue&&"math"!==a.operationType&&"formula"!==a.operationType}));return d&&!p&&c.push({message:u.i18n.translate("xpack.lens.indexPattern.noRealMetricError",{defaultMessage:"A layer with only static values will not show results, use at least one dynamic metric"})}),c.length?c.map((({message:e})=>e)):void 0},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,s=n.label!==ir,l=null!=i&&i.isFormulaBroken?ir:s?n.label:null!==(a=null==i?void 0:i.formula)&&void 0!==a?a:ir;return[{type:"function",function:n.references.length?"mathColumn":"mapColumn",arguments:{id:[t],name:[l||ir],...n.references.length?{castColumns:[n.references[0]]}:{},expression:[n.references.length?`"${n.references[0]}"`:""]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){let s="";e&&(s=function(e,t,a,n){if(Zl("static_value",e)&&e.params&&"value"in e.params)return String(e.params.value);if("references"in e){const n=t.columns[e.references[0]];if(n&&"sourceField"in n&&"number"===n.dataType){const t=nr(n);a+=`${e.operationType}(${n.operationType}(${t})`}}else{if(!e||!("sourceField"in e)||"number"!==e.dataType&&"date"!==e.dataType)return"";a+=`${e.operationType}(${nr(e)}`}const i=function(e,t){if(!t)return[];const a=t[e.operationType];return"operationParams"in a&&(n=e,Boolean("params"in n&&n.params))?(a.operationParams||[]).flatMap((({name:t,required:a})=>{const n=e.params[t];return Object(jt.isObject)(n)?Object.keys(n).map((e=>({name:`${t}-${e}`,value:n[e],required:a}))):{name:t,value:n,required:a}})):[];var n}(e,n);return i.length&&(a+=", "+i.map((({name:e,value:t})=>`${e}=${t}`)).join(", ")),e.filter&&(("count"!==e.operationType||"sourceField"in e&&e.sourceField!==at.c)&&(a+=", "),a+=("kuery"===e.filter.language?"kql=":"lucene=")+`'${e.filter.query.replace(/'/g,"\\'")}'`),e.timeShift&&(("count"!==e.operationType||"sourceField"in e&&e.sourceField!==at.c||e.filter)&&(a+=", "),a+=`shift='${e.timeShift}'`),e.reducedTimeRange&&(("count"!==e.operationType||e.filter||e.timeShift)&&(a+=", "),a+=`reducedTimeRange='${e.reducedTimeRange}'`),a&&(a+=")"),a}(e,t,s,i));let l={};var r;e&&er(e)&&(l={format:null===(r=e.params)||void 0===r?void 0:r.format}),null!=n&&n.format&&(l={format:n.format});const o="formula"===(null==e?void 0:e.operationType);return{label:s||ir,dataType:"number",operationType:"formula",isBucketed:!1,scale:"ratio",params:s?{formula:s,isFormulaBroken:!1,...l,...null!=n&&n.formula?{formula:null==n?void 0:n.formula}:{}}:{...l,...null!=n&&n.formula?{formula:null==n?void 0:n.formula}:{}},references:[],filter:o?ar(e,n):void 0,reducedTimeRange:o?e.reducedTimeRange:void 0,timeScale:null==e?void 0:e.timeScale}},isTransferable:()=>!0,createCopy(e,t,a,n){const i=e[t.layerId].columns[t.columnId],s=Gl(a.columnId,i,e[a.layerId],{indexPattern:a.dataView,operations:n});return{...e,[a.layerId]:s.layer}},timeScalingMode:"optional",paramEditor:({activeData:e,...t})=>{const a=fl(t.data.datatableUtilities,t.layer,t.indexPattern,e,t.layerId);return Object(j.jsx)(Hl,i()({},t,{dateHistogramInterval:a,hasData:ql(e,t.layerId,t.columnId)}))}};function lr({layers:e,source:t,target:a}){return function(e,t,a){const n=e[a.layerId],i=n.columns[a.columnId],s=e[t.layerId];let l={...s.columns};if("references"in i){const s=gc[i.operationType];if("createCopy"in s)return s.createCopy(e,a,t,gc);const r=i.references.reduce(((e,t)=>({...e,[Object(Ge.a)()]:{...n.columns[t]}})),{});l={...l,...r,[t.columnId]:{...i,references:Object.keys(r)}}}else l={...l,[t.columnId]:{...i}};return{...e,[t.layerId]:yr({...s,columns:l,columnOrder:kr({...s,columns:l})})}}(e,a,t)}function rr(e){return e.layer.columns[e.columnId]?dr(e):ur(e)}function or(e,t,a){const n={...e};return t.filterable&&(n.filter=a.filter),t.shiftable&&(n.timeShift=a.timeShift),"disabled"!==t.timeScalingMode&&(n.timeScale=a.timeScale),n}function ur({op:e,layer:t,columnId:a,field:n,indexPattern:i,visualizationGroups:s,targetGroup:l,incompleteParams:r,incompleteFieldName:o,incompleteFieldOperation:u,columnParams:c,initialParams:d,references:p,respectOrder:m}){var g,f;const b=gc[e];if(!b)throw new Error("No suitable operation found for given parameters");if(t.columns[a])throw new Error("Can't insert a column with an ID that is already in use");const h={indexPattern:i,previousColumn:{...r,...d,...t.columns[a]}};if("none"===b.input||"managedReference"===b.input){if(n)throw new Error(`Can't create operation ${e} with the provided field ${n.name}`);b.input;const r=b.getPossibleOperation();return Pr((Boolean(null==r?void 0:r.isBucketed)?fr:hr)(t,c?b.buildColumn({...h,layer:t},c):b.buildColumn({...h,layer:t}),a,s,l,m),i)}if("fullReference"===b.input){if(n)throw new Error("Reference-based operations can't take a field as input when creating");let r={...t},d=[];if(p){const e=(({layer:e,references:t,requiredReferences:a,indexPattern:n,visualizationGroups:i,targetGroup:s})=>{t.forEach((e=>{if(!a.filter((t=>Er({validation:t,operationType:e.op,indexPattern:n}))).length)throw new Error(`Can't create reference, ${e.op} has a validation function which doesn't allow any operations`)}));const l=[];return t.forEach((t=>{const a=gc[t.op];if("none"===a.input)return e=ur({layer:e,columnId:t.columnId,op:a.type,indexPattern:n,columnParams:{...t.columnParams},incompleteParams:t.incompleteParams,initialParams:t.initialParams,...t.references?{references:t.references}:{},visualizationGroups:i,targetGroup:s}),void l.push(t.columnId);const r="field"===a.input&&t.field&&a.getPossibleOperationForField(t.field)?t.field:void 0;return r?(e=ur({layer:e,columnId:t.columnId,op:a.type,indexPattern:n,field:r,incompleteParams:t.incompleteParams,initialParams:t.initialParams,columnParams:{...t.columnParams},visualizationGroups:i,targetGroup:s}),void l.push(t.columnId)):void 0})),{layer:e,referenceIds:l}})({layer:r,references:p,requiredReferences:b.requiredReferences,indexPattern:i,visualizationGroups:s,targetGroup:l});[r,d]=[e.layer,e.referenceIds]}else{const t=(({op:e,incompleteFieldOperation:t,incompleteFieldName:a,columnParams:n,layer:i,requiredReferences:s,indexPattern:l,visualizationGroups:r,targetGroup:o})=>{const u=s.map((s=>{const u=Object.values(gc).filter((({type:e})=>Er({validation:s,operationType:e,indexPattern:l})));if(!u.length)throw new Error(`Can't create reference, ${e} has a validation function which doesn't allow any operations`);const c=Object(Ge.a)();if(t&&a){var d;const e=l.fields.filter((e=>e.name===a));i=ur({layer:i,columnId:c,op:t,indexPattern:l,field:null!==(d=e[0])&&void 0!==d?d:Vl.a,visualizationGroups:r,columnParams:n,targetGroup:o})}if(1===u.length){const e=u[0];let t="field"===e.input?l.fields.filter(e.getPossibleOperationForField):[];a&&(t=t.filter((e=>e.name===a))),i="none"===e.input?ur({layer:i,columnId:c,op:e.type,indexPattern:l,visualizationGroups:r,targetGroup:o}):1===t.length?ur({layer:i,columnId:c,op:e.type,indexPattern:l,field:t[0],visualizationGroups:r,targetGroup:o}):{...i,incompleteColumns:{...i.incompleteColumns,[c]:{operationType:e.type}}}}return c}));return{layer:i,referenceIds:u}})({op:e,incompleteFieldName:o,incompleteFieldOperation:u,columnParams:c,layer:r,requiredReferences:b.requiredReferences,indexPattern:i,visualizationGroups:s,targetGroup:l});[r,d]=[t.layer,t.referenceIds]}const g=b.getPossibleOperation(i);if(!g)throw new Error(`Can't create operation ${e} because it's incompatible with the data view`);return Pr((Boolean(g.isBucketed)?fr:hr)(r,c?b.buildColumn({...h,layer:r,referenceIds:d},c):b.buildColumn({...h,layer:r,referenceIds:d}),a,s,l,m),i)}const x=null===(g=(null!==(f=t.incompleteColumns)&&void 0!==f?f:{})[a])||void 0===g?void 0:g.sourceField,v=x?i.getFieldByName(x):void 0;if(!n&&v){const e=b.getPossibleOperationForField(v);if(!e)throw new Error(`Tried to create an invalid operation ${b.type} using previously selected field ${v.name}`);return Pr(Boolean(e.isBucketed)?fr(t,b.buildColumn({...h,layer:t,field:v}),a,s,l,m):hr(t,b.buildColumn({...h,layer:t,field:v}),a),i)}var y;if(!n)return{...t,incompleteColumns:{...null!==(y=t.incompleteColumns)&&void 0!==y?y:{},[a]:{operationType:e}}};const j=b.getPossibleOperationForField(n);var O;if(!j)return{...t,incompleteColumns:{...null!==(O=t.incompleteColumns)&&void 0!==O?O:{},[a]:{operationType:e,sourceField:n.name}}};const k=b.buildColumn({...h,layer:t,field:n},c);return Pr((Boolean(j.isBucketed)?fr:hr)(t,k,a,s,l,m),i)}function cr({operationDefinition:e,layer:t,previousColumn:a,indexPattern:n,previousDefinition:i,columnId:s},{shouldResetLabel:l}){const r={columns:t.columns,previousColumn:a,indexPattern:n};let o=t;const u=e.buildColumn({...r,layer:o},"params"in a?a.params:void 0,gc);"fullReference"===i.input&&a.references.forEach((e=>{o=Or({layer:o,columnId:e,indexPattern:n})}));const c={...o,columns:{...o.columns,[s]:u}};let d;try{d=u.params.formula?Gl(s,u,c,{indexPattern:n}).layer:c}catch(e){d=c}const p=d.columns[s];return!l&&p.operationType!==a.operationType&&a.customLabel&&(p.customLabel=!0,p.label=a.label),Pr(jr({...o,columnOrder:kr(d),columns:d.columns},s),n)}function dr({layer:e,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:s,initialParams:l,shouldResetLabel:r,shouldCombineField:o}){const u=e.columns[t];if(!u)throw new Error("Can't replace column because there is no prior column");const c=n!==u.operationType,d=gc[n],p=gc[u.operationType];if(!d)throw new Error("No suitable operation found for given parameters");const m={columns:e.columns,indexPattern:a,previousColumn:u};if(c){let l={...e};if(l=Ar(l,t),"managedReference"===p.input&&d.input!==p.input){l=pr(p,u,l,a);const o=ur({layer:l,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:s,incompleteParams:u});return!r&&u.customLabel&&o.columns[t]&&u.label!==p.getDefaultLabel(u,a,l.columns)&&(o.columns[t].customLabel=!0,o.columns[t].label=u.label),o.incompleteColumns&&o.incompleteColumns[t]?{...e,incompleteColumns:o.incompleteColumns}:o}if("fullReference"===d.input)return function({layer:e,columnId:t,previousColumn:a,op:n,indexPattern:i,visualizationGroups:s}){const l=gc[n];if("fullReference"!==l.input)throw new Error("Requirements for transitioning are not met");let r=!1,o=!1;const u="references"in a?[...a.references]:[],c=l.requiredReferences.map((t=>{const n=Object(Ge.a)();if(u.length){const a=e.columns[u[0]];if(_r({validation:t,column:a}))return u.shift()}if(!r&&_r({validation:t,column:a})){r=!0;const t={...e,columns:{...e.columns,[n]:{...a,filter:l.filterable?void 0:a.filter,timeShift:l.shiftable?void 0:a.timeShift}}};return e=Pr(jr({...t,columnOrder:kr(t)},n),i),n}if(t.input.includes("none")){const a=mc.filter((e=>{if("none"===e.input)return Er({validation:t,operationType:e.type,indexPattern:i})}));if(1===a.length)return e=ur({layer:e,columnId:n,op:a[0].type,indexPattern:i,visualizationGroups:s}),n}if(!o&&"sourceField"in a&&t.input.includes("field")){const l=i.getFieldByName(a.sourceField),r=mc.filter((e=>"field"===e.input&&Er({validation:t,operationType:e.type,indexPattern:i}))).sort(hc(l)),u=r.filter((e=>{if(l)return Er({validation:t,operationType:e.type,field:l,indexPattern:i})}));if(u.length>0)return o=!0,e=ur({layer:e,columnId:n,op:u[0].type,indexPattern:i,field:i.getFieldByName(a.sourceField),visualizationGroups:s}),n;if(1===r.length)return o=!0,e={...e,incompleteColumns:{...e.incompleteColumns,[n]:{operationType:r[0].type}}},n}if(u.length){const a=e.columns[u[0]];if(a&&"sourceField"in a&&t.input.includes("field")){const l=i.getFieldByName(a.sourceField);if(l){const a=mc.filter((e=>"field"===e.input&&Er({validation:t,operationType:e.type,field:l,indexPattern:i}))).sort(hc(l));if(a.length>0)return e=ur({layer:e,columnId:n,op:a[0].type,indexPattern:i,field:l,visualizationGroups:s}),n}}}return n}));return u.length&&u.forEach((t=>{e=Or({layer:e,columnId:t,indexPattern:i})})),e={...e,columns:{...e.columns,[t]:l.buildColumn({indexPattern:i,layer:e,referenceIds:c,previousColumn:a})}},Pr(jr({...e,columnOrder:kr(e)},t),i)}({layer:l,columnId:t,previousColumn:u,op:n,indexPattern:a,visualizationGroups:s});if("fullReference"===p.input&&1===u.references.length){const s=u.references[0],r=e.columns[s];if(r){const e=gc[r.operationType];if(e.type===n){l=Or({layer:l,columnId:s,indexPattern:a});const n=or(gr({...r},u),e,u);return l={...l,columnOrder:kr(l),columns:{...l.columns,[t]:n}},Pr(jr(l,t),a)}if(!i&&"sourceField"in r&&"field"===e.input&&"field"===d.input){const e=a.getFieldByName(r.sourceField);e&&d.getPossibleOperationForField(e)&&(i=e)}}}if("managedReference"===d.input)return cr({operationDefinition:d,layer:l,previousColumn:u,indexPattern:a,previousDefinition:p,columnId:t},{shouldResetLabel:r});if("none"===d.input){let e=d.buildColumn({...m,layer:l});e=gr(e,u),l=pr(p,u,l,a);const n={...l,columns:{...l.columns,[t]:e}};return Pr(jr({...n,columnOrder:kr(n)},t),a)}if(!i){var g;let a={operationType:n};if("fullReference"===p.input){const t=u.references[0],n=e.columns[t];n&&(a=or(a,gc[n.operationType],u))}return{...l,incompleteColumns:{...null!==(g=l.incompleteColumns)&&void 0!==g?g:{},[t]:a}}}var f;if(!d.getPossibleOperationForField(i))return{...l,incompleteColumns:{...null!==(f=l.incompleteColumns)&&void 0!==f?f:{},[t]:{operationType:n}}};l=pr(p,u,l,a);let o=d.buildColumn({...m,layer:l,field:i});r||(o=gr(o,u));const c={...l,columns:{...l.columns,[t]:o}};return Pr(jr({...c,columnOrder:kr(c)},t),a)}if("field"===d.input&&i&&"sourceField"in u&&(u.sourceField!==i.name||null!=d&&d.getParamsForMultipleFields)){let a=d.onFieldChange(u,i,o?null==l?void 0:l.params:void 0);r||(a=gr(a,u));const n=Ar({...e,columns:{...e.columns,[t]:a}},t);return jr({...n,columnOrder:kr(n)},t)}if("managedReference"===d.input)return cr({operationDefinition:d,layer:e,previousColumn:u,indexPattern:a,previousDefinition:p,columnId:t},{shouldResetLabel:r});throw new Error("nothing changed")}function pr(e,t,a,n){let i=a;if("managedReference"===e.input){const[e]=Object.entries(a.columns).find((([e,a])=>a===t))||[];null!=e&&(i=Or({layer:a,columnId:e,indexPattern:n}))}return"fullReference"===e.input&&t.references.forEach((e=>{i=Or({layer:a,columnId:e,indexPattern:n})})),i}function mr({layer:e,columnId:t,op:a,field:n,indexPattern:i,filterOperations:s,visualizationGroups:l}){const r=e.columns[t];if(!r)return!0;if(r.operationType===a)return!0;try{var o,u,c;const r=dr({layer:e,columnId:t,op:a,field:n,indexPattern:i,visualizationGroups:l}),d=gc[a],p=r.columns[t];return Boolean(p)&&!(null!==(o=r.incompleteColumns)&&void 0!==o&&o[t])&&s(p)&&!(null!==(u=d.getErrorMessage)&&void 0!==u&&null!==(c=u.call(d,r,t,i))&&void 0!==c&&c.length)}catch(e){return!1}}function gr(e,t){const a={...e},n=e.operationType!==t.operationType,i=("sourceField"in e&&e.sourceField)!==("sourceField"in t&&t.sourceField);return!t.customLabel||n&&i||(a.customLabel=!0,a.label=t.label),a}function fr(e,t,a,n,i,s){const[l,r]=Object(jt.partition)(e.columnOrder,(t=>e.columns[t].isBucketed)),o=e.columnOrder.findIndex((t=>"date_histogram"===e.columns[t].operationType));let u=[];u=o>-1&&"terms"===t.operationType&&!s?[...l.slice(0,o),a,...l.slice(o,l.length),...r]:[...l,a,...r],u=br(n,u,i,a);const c={...Ar(e,a),columns:{...e.columns,[a]:t},columnOrder:u};return jr({...c,columnOrder:kr(c)},a)}function br(e,t,a,n){var i;if(a&&(null===(i=e.find((e=>e.groupId===a)))||void 0===i?void 0:i.hideGrouping)){const i=[...e];i.sort(((e,t)=>void 0===typeof e.nestingOrder?-1:void 0===typeof t.nestingOrder?1:e.nestingOrder-t.nestingOrder));const s={};return t.forEach((e=>{const l=i.findIndex((t=>e===n&&t.groupId===a||t.accessors.some((t=>t.columnId===e))));s[e]=-1!==l?l:t.length})),[...t].sort(((e,t)=>s[e]-s[t]))}return t}function hr(e,t,a){const n={...Ar(e,a),columns:{...e.columns,[a]:t}};return jr({...n,columnOrder:kr(n)},a)}function xr(e){return mc.sort(hc(e)).filter((t=>{if("field"!==t.input)return;const a=t.getPossibleOperationForField(e);return a&&!a.isBucketed&&"number"===a.dataType}))}function vr({layer:e,columnId:t,paramName:a,value:n}){const i=e.columns[t];return{...e,columns:{...e.columns,[t]:{...i,params:{..."params"in i?i.params:{},[a]:n}}}}}function yr(e){const t={...e.columns};return Object.keys(t).forEach((a=>{const n=t[a];if(null!=n&&n.operationType){const i=gc[n.operationType];t[a]=i.onOtherColumnChanged?i.onOtherColumnChanged({...e,columns:t},a):n}})),{...e,columns:t}}function jr(e,t){const a={...e.columns};return Object.keys(a).forEach((n=>{if(n!==t){const t=a[n],i=gc[t.operationType];a[n]=i.onOtherColumnChanged?i.onOtherColumnChanged({...e,columns:a},n):t}})),{...e,columns:a}}function Or({layer:e,columnId:t,indexPattern:a}){const n=e.columns[t];if(!n){const a={...e.incompleteColumns||{}};return delete a[t],{...e,columnOrder:e.columnOrder.filter((e=>e!==t)),incompleteColumns:a}}const i="references"in n?n.references:[],s={...e.columns};delete s[t];let l=jr({...e,columns:s},t);i.forEach((e=>{l=Or({layer:l,columnId:e,indexPattern:a})}));const r={...l.incompleteColumns||{}};return delete r[t],Pr({...l,columnOrder:kr(l),incompleteColumns:r},a)}function kr(e){const t=Object.entries(e.columns);t.sort((([t],[a])=>{const n=e.columnOrder.indexOf(t),i=e.columnOrder.indexOf(a);return n>-1&&i>-1?n-i:n>-1?-1:1}));const[a,n]=Object(jt.partition)(t,(([,e])=>e.isBucketed));return a.map((([e])=>e)).concat(n.map((([e])=>e)))}function Ir(e){const[t,a]=Object(jt.partition)(e.columnOrder,(t=>e.columns[t]&&!("references"in e.columns[t])));return[...Object(jt.partition)(t,(t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.isBucketed})),a]}function Tr(e,t,a){return gc[e.operationType].isTransferable(e,t,gc)&&(!("references"in e)||e.references.every((e=>Tr(a.columns[e],t,a))))}function wr(e,t){const a=Object(jt.pickBy)(e.columns,(a=>Tr(a,t,e))),n=Object(jt.mapValues)(a,(e=>{const a=gc[e.operationType];return a.transfer?a.transfer(e,t):e})),i=e.columnOrder.filter((e=>n[e]));return{...e,indexPatternId:t.id,columns:n,columnOrder:i}}function Mr(e,t){return Object.values(e.columns).flatMap((e=>"references"in e?e.references:[])).includes(t)}const Cr=xs()((e=>{const t={};for(const[a,n]of Object.entries(e.columns))if("references"in n)for(const e of n.references)t[e]=a;return t}));function Sr(e,t){const a=[];return function t(n){const i=e.columns[n];if(i&&"references"in i){const n=i.references.filter((t=>Boolean(e.columns[t])));a.push(...n),n.forEach(t)}}(t),a}function Fr(e){return e.columnOrder.some((t=>{const a=e.columns[t];if(a)return Zl("terms",a)&&a.params.size>5}))}function Er({operationType:e,validation:t,field:a,indexPattern:n}){const i=gc[e];let s=!0;if(a&&"field"===i.input){const n=i.getPossibleOperationForField(a);s=Boolean(n)&&t.validateMetadata(n,e,a.name)}else if("none"===i.input){const a=i.getPossibleOperation();s=Boolean(a)&&t.validateMetadata(a,e)}else if("fullReference"===i.input){const a=i.getPossibleOperation(n);s=Boolean(a)&&t.validateMetadata(a,e)}return t.input.includes(i.input)&&(!t.specificOperations||t.specificOperations.includes(e))&&s}function Pr(e,t){const a={...e.columns};return e.columnOrder.forEach((e=>{const n=a[e];n.customLabel||(a[e]={...n,label:gc[n.operationType].getDefaultLabel(n,t,a)})})),{...e,columns:a}}function Ar(e,t){var a;const n={...null!==(a=e.incompleteColumns)&&void 0!==a?a:{}};return delete n[t],{...e,incompleteColumns:n}}function _r({column:e,validation:t}){if(!e)return!1;const a=e.operationType,n=gc[a];if(!n)throw new Error("No suitable operation definition found for "+a);return t.input.includes(n.input)&&function({column:e,validation:t}){return!t.specificOperations||"managedReference"===gc[e.operationType].input||t.specificOperations.includes(e.operationType)}({column:e,validation:t})&&t.validateMetadata(e,a,"sourceField"in e?e.sourceField:void 0)}function Lr(e,t){const a={};Object.entries(t).forEach((([e,t])=>{a[e]="references"in t?[...t.references]:[]}));const n=a[e],i=[];for(;n.length>0;){const e=n.shift();i.push([e,t[e]]),n.push(...a[e])}return i.filter((([,e])=>e))}const Dr=({value:e,onChange:t,minValue:a=1,maxValue:n=1e4,label:i=u.i18n.translate("xpack.lens.indexPattern.terms.size",{defaultMessage:"Number of values"}),disabled:l})=>{const[r,o]=Object(s.useState)(String(e));Object(k.E)((()=>{if(""===r)return;const e=Number(r);t(Math.min(n,Math.max(e,a)))}),{skipFirstRender:!0},256,[r]);const c=""===r,d=!c&&Number(r)>n,p=!c&&Number(r)<a;return Object(j.jsx)(b.EuiFormRow,{label:i,display:"rowCompressed",fullWidth:!0,isInvalid:d||p,error:d?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMax",{defaultMessage:"Value is higher than the maximum {max}, the maximum value is used instead.",values:{max:n}})]:p?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMin",{defaultMessage:"Value is lower than the minimum {min}, the minimum value is used instead.",values:{min:a}})]:null},Object(j.jsx)(b.EuiFieldNumber,{fullWidth:!0,min:a,max:n,step:1,value:r,compressed:!0,isInvalid:d||p,disabled:l,onChange:({currentTarget:e})=>o(e.value),"aria-label":i,onBlur:()=>{if(""===r)return o(String(e));const t=Number(r);o(String(Math.min(n,Math.max(t,a))))}}))};function Nr({currentIndexPattern:e,incompleteOperation:t,selectedOperationType:a,selectedField:n,operationByField:i,onChoose:l,onDeleteColumn:r,fieldIsInvalid:o,markAllFieldsCompatible:c,"data-test-subj":d,...p}){var m,g;const{hasFieldData:f}=Object(Un.useExistingFieldsReader)(),b=Object(s.useMemo)((()=>{const n=Object.keys(i).sort(),s=null!=t?t:a;function l(e){return!s||i[e].has(s)}const[r,o]=Object(jt.partition)(n,(t=>{var a;return"document"===(null===(a=e.getFieldByName(t))||void 0===a?void 0:a.type)}));function d(t){return Object(k.z)(t,e,f)}function p(t){return t.filter((t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.displayName})).map((t=>{var a;const n=c||l(t)?1:0,r=d(t),o=e.getFieldByName(t);return{label:null===(a=e.getFieldByName(t))||void 0===a?void 0:a.displayName,value:{type:"field",field:t,dataType:o?Object(Ul.a)(o):void 0,operationType:s&&l(t)?s:i[t].values().next().value},exists:r,compatible:n,"data-test-subj":`lns-fieldOption${n?"":"Incompatible"}-${t}`}})).sort(((e,t)=>t.compatible-e.compatible))}const[m,g]=Object(jt.partition)(o,(t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.meta})),[b,h]=Object(jt.partition)(g,d),x=(e,t)=>e.length>0&&{label:t,options:p(e)},v=x(b,u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"})),y=x(h,u.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabel",{defaultMessage:"Empty fields"})),j=x(m,u.i18n.translate("xpack.lens.indexPattern.metaFieldsLabel",{defaultMessage:"Meta fields"}));return[...p(r),v,y,j].filter(Boolean)}),[t,a,e,i,f,c]);return Object(j.jsx)(Xn.a,{selectedOptions:a&&n?[{label:null!==(m=a&&n&&(null===(g=e.getFieldByName(n))||void 0===g?void 0:g.displayName))&&void 0!==m?m:n,value:{type:"field",field:n}}]:[],options:b,onChoose:e=>{e&&e.field!==n&&l(e)},onDelete:r,fieldIsInvalid:Boolean(t||o),"data-test-subj":null!=d?d:"indexPattern-dimension-field"})}a(313);const Rr=new Set(["string","boolean","number","ip"]),Br=Object(b.htmlIdGenerator)();function Vr(e){return null!=e.value}function zr({column:e,onChange:t,indexPattern:a,operationSupportMatrix:n,invalidFields:i}){const r=Object(s.useCallback)((e=>t(e.filter(Vr).map((({value:e})=>e)))),[t]),{wrappedValues:o,rawValuesLookup:c}=Object(s.useMemo)((()=>{var t;const a=e?[e.sourceField,...(null===(t=e.params)||void 0===t?void 0:t.secondaryFields)||[]]:[];return{wrappedValues:a.map((e=>({id:Br(),value:e}))),rawValuesLookup:new Set(a)}}),[e]),{inputValue:d,handleInputChange:p}=Object(k.F)({onChange:r,value:o}),m=Object(s.useCallback)(((e,t=0)=>{const n=[...d];a.getFieldByName(e.field)&&(n[t]={id:Br(),value:e.field},p(n))}),[d,a,p]),g=1===d.length||d.filter((({isNew:e})=>!e)).length<2,f=d.filter((({isNew:e})=>!e));return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(k.e,{onDragEnd:e=>{p(e)},droppableId:"TOP_TERMS_DROPPABLE_AREA",items:d,bgColor:"subdued"},d.map((({id:t,value:s,isNew:l},r,o)=>{var b;const h=Object.keys(n.operationByField).filter((e=>{if(e===s)return!0;const t=a.getFieldByName(e);return 0===r?!c.has(e)&&t&&Rr.has(t.type):!c.has(e)&&t&&!t.scripted&&Rr.has(t.type)})).reduce(((e,t)=>(e[t]=n.operationByField[t],e)),{}),x=Boolean(s&&((null===(b=a.getFieldByName(s))||void 0===b?void 0:b.scripted)&&f.length>1||(null==i?void 0:i.includes(s)))),v=(null!=s?s:"newField")+t;return Object(j.jsx)(k.f,{id:v,key:v,idx:r,onRemoveClick:()=>{p(o.filter(((e,t)=>t!==r)))},removeTitle:u.i18n.translate("xpack.lens.indexPattern.terms.deleteButtonLabel",{defaultMessage:"Delete"}),isNotRemovable:g&&!l,isNotDraggable:o.length<2,"data-test-subj":"indexPattern-terms",Container:k.h,isInsidePanel:!0},Object(j.jsx)(Nr,{fieldIsInvalid:x,currentIndexPattern:a,operationByField:h,selectedOperationType:e.operationType,selectedField:s,autoFocus:l,onChoose:e=>{m(e,r)},isInvalid:x,"data-test-subj":1!==d.length?`indexPattern-dimension-field-${r}`:void 0}))}))),Object(j.jsx)(k.m,{onClick:()=>{p([...d,{id:Br(),value:void 0,isNew:!0}])},"data-test-subj":"indexPattern-terms-add-field",label:u.i18n.translate("xpack.lens.indexPattern.terms.addaFilter",{defaultMessage:"Add field"}),isDisabled:"rare"===e.params.orderBy.type||d.length>3}))}function Gr(e,t){return e?u.i18n.translate("xpack.lens.indexPattern.terms.scriptedFieldErrorShort",{defaultMessage:"Scripted fields are not supported when using multiple fields"}):t.length?u.i18n.translate("xpack.lens.indexPattern.terms.invalidFieldsErrorShort",{defaultMessage:"Invalid {invalidFieldsCount, plural, one {field} other {fields}}: {invalidFields}. Check your data view or pick another field.",values:{invalidFieldsCount:t.length,invalidFields:t.map((e=>`"${e}"`)).join(", ")}}):void 0}function qr({layer:e,selectedColumn:t,columnId:a,indexPattern:n,operationSupportMatrix:i,updateLayer:s,onDeleteColumn:l,incompleteField:r,incompleteOperation:o,incompleteParams:c,currentFieldIsInvalid:d,helpMessage:p,groupId:m,dimensionGroups:g,operationDefinitionMap:f}){const h=t&&f[t.operationType],x=("fullReference"!==(null==h?void 0:h.input)&&"managedReference"!==(null==h?void 0:h.input)||o&&"field"===f[o].input)&&Hr(t,Boolean(o),null==h?void 0:h.input,d);return Object(j.jsx)(b.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:Boolean(o||d),error:x,labelAppend:!x&&p},Object(j.jsx)(Nr,{fieldIsInvalid:d,currentIndexPattern:n,operationByField:i.operationByField,selectedOperationType:t?t.operationType:o,selectedField:null!=r?r:null==t?void 0:t.sourceField,incompleteOperation:o,onDeleteColumn:l,onChoose:t=>s(rr({layer:e,columnId:a,indexPattern:n,op:t.operationType,field:n.getFieldByName(t.field),visualizationGroups:g,targetGroup:m,incompleteParams:c}))}))}function Hr(e,t,a,n){return e&&t?"field"===a?u.i18n.translate("xpack.lens.indexPattern.invalidOperationLabel",{defaultMessage:"This field does not work with the selected function."}):u.i18n.translate("xpack.lens.indexPattern.chooseFieldLabel",{defaultMessage:"To use this function, select a field."}):n?u.i18n.translate("xpack.lens.indexPattern.invalidFieldLabel",{defaultMessage:"Invalid field. Check your data view or pick another field."}):void 0}a(318),a(323);const $r=({value:e,onChange:t,placeholder:a,inputRef:n,onSubmit:i,dataTestSubj:l,compressed:r})=>{const{inputValue:o,handleInputChange:c}=Object(k.F)({value:e,onChange:t}),d=Object(s.useRef)(!1);return Object(j.jsx)(b.EuiFieldText,{"data-test-subj":l||"lens-labelInput",value:o,onChange:e=>c(e.target.value),fullWidth:!0,placeholder:a||"",inputRef:e=>{n&&e&&(n.current=e)},onKeyDown:()=>{d.current=!0},onKeyUp:({key:e})=>{d.current&&b.keys.ENTER===e&&i&&i(),d.current=!1},prepend:u.i18n.translate("xpack.lens.labelInput.label",{defaultMessage:"Label"}),compressed:r})};a(328);const Wr=({children:e,label:t,isInline:a,...n})=>a?Object(j.jsx)("div",{"data-test-subj":n["data-test-subj"]},l.a.cloneElement(e,{prepend:Object(j.jsx)(b.EuiFormLabel,{className:"lnsIndexPatternDimensionEditor__labelCustomRank"},t)})):Object(j.jsx)(b.EuiFormRow,i()({},n,{label:t}),e),Ur=({filter:e,setFilter:t,indexPattern:a,button:n,isOpen:i,triggerClose:s})=>{const r=l.a.useRef();return Object(j.jsx)(b.EuiPopover,{"data-test-subj":"indexPattern-filters-existingFilterContainer",anchorClassName:"eui-fullWidth",panelClassName:"lnsIndexPatternDimensionEditor__filtersEditor",isOpen:i,ownFocus:!0,closePopover:s,button:n},Object(j.jsx)(k.p,{isInvalid:!Object(k.D)(e.input,a),value:e.input,indexPattern:a.id?{type:"id",value:a.id}:{type:"title",value:a.title},disableAutoFocus:!0,onChange:a=>t({...e,input:a}),onSubmit:()=>{r.current&&r.current.focus()}}),Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)($r,{value:e.label||"",onChange:a=>t({...e,label:a}),placeholder:(o=e.input.query,""===o?Qr:"object"===o?JSON.stringify(o):String(o)),inputRef:r,onSubmit:s,dataTestSubj:"indexPattern-filters-label"}));var o},Xr=Object(b.htmlIdGenerator)(),Yr="filters",Kr=u.i18n.translate("xpack.lens.indexPattern.filters",{defaultMessage:"Filters"}),Qr=u.i18n.translate("xpack.lens.indexPattern.filters.label.placeholder",{defaultMessage:"All records"}),Zr={input:{query:"",language:"kuery"},label:""},Jr={type:Yr,displayName:Kr,priority:3,input:"none",isTransferable:()=>!0,getDefaultLabel:()=>Kr,buildColumn({previousColumn:e},t){var a;let n={filters:null!==(a=null==t?void 0:t.filters)&&void 0!==a?a:[Zr]};var i,s,l,r;return"terms"===(null==e?void 0:e.operationType)&&"sourceField"in e&&(n={filters:null!==(i=null==t?void 0:t.filters)&&void 0!==i?i:[{label:"",input:{query:`${e.sourceField} : *`,language:"kuery"}},...null!==(s=null===(l=e.params)||void 0===l||null===(r=l.secondaryFields)||void 0===r?void 0:r.map((e=>({label:"",input:{query:`${e} : *`,language:"kuery"}}))))&&void 0!==s?s:[]]}),{label:Kr,dataType:"string",operationType:Yr,scale:"ordinal",isBucketed:!0,params:n}},getPossibleOperation:()=>({dataType:"string",isBucketed:!0,scale:"ordinal"}),toEsAggsFn:(e,t,a)=>{var n;const i=null===(n=e.params.filters)||void 0===n?void 0:n.filter((e=>Object(k.D)(e.input,a)));return Object(tt.buildExpressionFunction)("aggFilters",{id:t,enabled:!0,schema:"segment",filters:((null==i?void 0:i.length)>0?i:[Zr]).map(js.queryFilterToAst)}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,indexPattern:n,paramEditorUpdater:i})=>{const s=a.params.filters;return Object(j.jsx)(b.EuiFormRow,{fullWidth:!0},Object(j.jsx)(eo,{filters:s,setFilters:a=>i(vr({layer:e,columnId:t,paramName:Yr,value:a})),indexPattern:n,defaultQuery:Zr}))},getMaxPossibleNumValues:e=>e.params.filters.length,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.filters.documentation.quick",{defaultMessage:"\n    Divides values into predefined subsets.\n      "})},eo=({filters:e,setFilters:t,indexPattern:a,defaultQuery:n})=>{const[i,r]=Object(s.useState)(""),[o,c]=Object(s.useState)((()=>e.map((e=>({...e,id:Xr()}))))),d=e=>{t(e.map((e=>Object(jt.omit)(e,"id")))),c(e)},p=e=>{let t=e;i===e&&(t=""),r(t)};return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(k.e,{onDragEnd:d,onDragStart:()=>{},droppableId:"FILTERS_DROPPABLE_AREA",items:o},null==o?void 0:o.map(((e,t,n)=>{const s=!Object(k.D)(e.input,a),l=e.id;return Object(j.jsx)(k.f,{id:l,key:l,idx:t,isInvalid:s,invalidMessage:u.i18n.translate("xpack.lens.indexPattern.filters.isInvalid",{defaultMessage:"This query is invalid"}),onRemoveClick:()=>(e=>d(o.filter((t=>t.id!==e))))(e.id),removeTitle:u.i18n.translate("xpack.lens.indexPattern.filters.removeFilter",{defaultMessage:"Remove a filter"}),isNotRemovable:1===n.length,isNotDraggable:1===n.length},Object(j.jsx)(Ur,{"data-test-subj":"indexPattern-filters-existingFilterContainer",isOpen:e.id===i,triggerClose:()=>p(""),indexPattern:a,filter:e,setFilter:e=>{((e,t,a)=>{d(o.map((n=>n.id===e?{...n,input:t,label:a}:n)))})(e.id,e.input,e.label)},button:Object(j.jsx)(b.EuiLink,{className:"lnsFiltersOperation__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>p(e.id),color:s?"danger":"text",title:u.i18n.translate("xpack.lens.indexPattern.filters.clickToEdit",{defaultMessage:"Click to edit"})},e.label||e.input.query||Qr)}))}))),Object(j.jsx)(k.m,{onClick:()=>{(()=>{const e=Xr();d([...o,{...n,id:e}]),r(e)})()},label:u.i18n.translate("xpack.lens.indexPattern.filters.addaFilter",{defaultMessage:"Add a filter"})}))},to=" › ";function ao(e,t,a){var n;const i=e.columns[t],s=[i.sourceField,...null!==(n=i.params.secondaryFields)&&void 0!==n?n:[]],l=s.filter((e=>{var t;return null===(t=a.getFieldByName(e))||void 0===t?void 0:t.scripted}));if(!(s.length<2)&&l.length)return u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleTermsAndScriptedFields",{defaultMessage:"Scripted fields are not supported when using multiple fields, found {fields}",values:{fields:l.join(", ")}})}function no(e,t){const a=t.split(to);return e.map(((e,t)=>`${e}: ${"*"!==a[t]?`"${a[t]}"`:a[t]}`)).join(" AND ")}function io(e,t){return 1===e.length?t:t.split(to).map(((t,a)=>null==t?u.i18n.translate("xpack.lens.indexPattern.filterBy.emptyFilterQuery",{defaultMessage:"(empty)"}):`${e[a]}: ${t}`)).join(to)}function so(e){return"object"==typeof e&&null!=e&&"keys"in e&&Array.isArray(e.keys)}function lo(e,t,a){const n=new Set;if(Object.entries(e.columns).forEach((([e,t])=>{"references"in t&&t.references.forEach((e=>{n.add(e)}))})),Object(jt.uniq)(Object.entries(e.columns).filter((([t,a])=>gc[a.operationType].shiftable&&(!Mr(e,t)||a.timeShift))).map((([e,t])=>t.timeShift||""))).length>1)return{message:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShifts",{defaultMessage:"In a single layer, you are unable to combine metrics with different time shifts and dynamic top values. Use the same time shift value for all metrics, or use filters instead of top values."}),fixAction:{label:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShiftsFixActionLabel",{defaultMessage:"Use filters"}),newState:async(n,i,s,l)=>{var r,o,c,d,p;const m=e.columns[t],g=[m.sourceField,...null!==(r=null===(o=m.params)||void 0===o?void 0:o.secondaryFields)&&void 0!==r?r:[]],f=(null===(c=s.activeData)||void 0===c||null===(d=c[l].columns.find((({id:e})=>e===t)))||void 0===d?void 0:d.meta.field)===g[0];let b=Object(jt.uniq)((null===(p=s.activeData)||void 0===p?void 0:p[l].rows.map((e=>e[t])).filter((e=>g.length>1?so(e)&&"__other__"!==e.keys[0]:"string"==typeof e&&"__other__"!==e)).map((e=>so(e)?e.keys.join(to):e)))||[]);if((!f||0===b.length)&&1===g.length){var h;const e=await n.dataViews.get(a.id);b=(null===(h=(await Object(Un.loadFieldStats)({services:{data:n},dataView:e,field:a.getFieldByName(g[0]),dslQuery:Object(ys.buildEsQuery)(a,s.query,s.filters,Object(Kn.getEsQueryConfig)(i.uiSettings)),fromDate:s.dateRange.fromDate,toDate:s.dateRange.toDate,size:m.params.size})).topValues)||void 0===h?void 0:h.buckets.map((({key:e})=>String(e))))||[]}return g.length>1&&0===b.length&&(b=[Array(g.length).fill("*").join(to)]),{...e,columns:{...e.columns,[t]:{label:u.i18n.translate("xpack.lens.indexPattern.pinnedTopValuesLabel",{defaultMessage:"Filters of {field}",values:{field:g.length>1?g.join(to):g[0]}}),customLabel:!0,isBucketed:e.columns[t].isBucketed,dataType:"string",operationType:"filters",params:{filters:b.length>0?b.map((e=>({input:{query:1===g.length?`${g[0]}: "${e}"`:no(g,e),language:"kuery"},label:io(g,e)}))):[{input:{query:"*",language:"kuery"},label:Qr}]}}}}}}}}function ro(e){return"percentile_rank"!==e.operationType||"percentile_rank"===e.operationType&&Number.isInteger(e.params.value)}function oo(e,t){const a=e.columns[t];return a&&!a.isBucketed&&function(e){return"last_value"!==e.operationType||["number","date"].includes(e.dataType)&&!e.params.showArrayValues}(a)&&ro(a)&&!("references"in a)&&!Mr(e,t)}function uo(e,t){if("string"==typeof e){const a=null==t?void 0:t.getFieldByName(e);return a&&a.scripted}return e.scripted}function co(e,t,a){const n=[];var i,s;t&&"sourceField"in t&&(t.sourceField&&n.push(t.sourceField),Zl("terms",t)&&n.push(...null!==(i=null===(s=t.params)||void 0===s?void 0:s.secondaryFields)&&void 0!==i?i:[])),a&&n.push("string"==typeof a?a:a.name||a.displayName);const l=n.map((t=>e.getFieldByName(t))),r=[],o=[],u=Boolean(t&&1===l.length);return n.forEach(((e,t)=>{const a=l[t];(!(a&&Rr.has(a.type)&&a.aggregatable)||a.aggregationRestrictions&&!a.aggregationRestrictions.terms||!u&&uo(a)?o:r).push(e)})),{allFields:l,validFields:r,invalidFields:o}}const po=(e,t)=>{const a=null==e?void 0:e.map((e=>({label:String(e)}))),n=null==t?void 0:t.map((e=>({label:String(e)})));return{...(null==a?void 0:a.length)&&{include:a},...(null==n?void 0:n.length)&&{exclude:n}}},mo=({include:e,exclude:t,tableRows:a,columnId:n,isNumberField:i,includeIsRegex:r,excludeIsRegex:o,updateParams:c})=>{const[d,p]=Object(s.useState)(po(e,t)),[m,g]=Object(s.useState)(void 0),[f,h]=Object(s.useState)({include:r,exclude:o}),[x,v]=Object(s.useState)({include:r?null==e?void 0:e[0]:"",exclude:o?null==t?void 0:t[0]:""});Object(s.useEffect)((()=>{i&&h({include:!1,exclude:!1})}),[i]),Object(s.useEffect)((()=>{var e;if(null!=d&&null!==(e=d.include)&&void 0!==e&&e.length)return;const t=Object(jt.uniq)(null==a?void 0:a.map((e=>e[n]))).filter((e=>"__other__"!==e)),i=null==t?void 0:t.map((e=>({label:String(e)})));g(i)}),[a]);const y=(e,t)=>{const a={...d,[t]:e};p(a);const n=e.map((e=>Number.isNaN(Number(e.label))?e.label:Number(e.label)));c(t,n,`${t}IsRegex`,!1)},O=(e,t=[],a)=>{var n;const i={label:e};let s=[];s=[...null!==(n=d[a])&&void 0!==n?n:[],i];const l={...d,[a]:s};p(l);const r=s.map((e=>Number.isNaN(Number(e.label))?e.label:Number(e.label)));c(a,r,`${a}IsRegex`,!1)},I=Object(s.useCallback)((e=>{v({...x,include:e}),c("include",[null!=e?e:""],"includeIsRegex",!0)}),[x,c]),T=Object(s.useCallback)((e=>{v({...x,exclude:e}),c("exclude",[null!=e?e:""],"excludeIsRegex",!0)}),[x,c]),{inputValue:w,handleInputChange:M}=Object(k.F)({onChange:I,value:x.include}),{inputValue:C,handleInputChange:S}=Object(k.F)({onChange:T,value:x.exclude});return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"m"}),Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.include",{defaultMessage:"Include values"}),display:"rowCompressed",fullWidth:!0,labelAppend:i?null:Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.addRegex",{defaultMessage:"Use regular expression"})),"data-test-subj":"lens-include-terms-regex-switch",compressed:!0,checked:f.include,onChange:e=>{const a=e.target.checked;h({...f,include:a}),v({...x,include:""}),p(po([],t)),c("include",[],"includeIsRegex",a)}})},f.include?Object(j.jsx)(b.EuiFieldText,{placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"}),"data-test-subj":"lens-include-terms-regex-input",value:w,onChange:e=>{M(e.target.value)},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"})}):Object(j.jsx)(b.EuiComboBox,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.include",{defaultMessage:"Include values"}),placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePlaceholder",{defaultMessage:"Select values or create a new one"}),options:m,selectedOptions:d.include,onChange:e=>y(e,"include"),onCreateOption:(e,t)=>O(e,t,"include"),isClearable:!0,"data-test-subj":"lens-include-terms-combobox",autoFocus:!0})),Object(j.jsx)(b.EuiSpacer,{size:"m"}),Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.exclude",{defaultMessage:"Exclude values"}),display:"rowCompressed",fullWidth:!0,labelAppend:i?null:Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.addRegex",{defaultMessage:"Use regular expression"})),compressed:!0,checked:f.exclude,onChange:t=>{const a=t.target.checked;h({...f,exclude:a}),v({...x,exclude:""}),p(po(e,[])),c("exclude",[],"excludeIsRegex",a)}})},f.exclude?Object(j.jsx)(b.EuiFieldText,{placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"}),value:C,onChange:e=>{S(e.target.value)},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"})}):Object(j.jsx)(b.EuiComboBox,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.exclude",{defaultMessage:"Exclude values"}),placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePlaceholder",{defaultMessage:"Select values or create a new one"}),options:m,selectedOptions:d.exclude,onChange:e=>y(e,"exclude"),onCreateOption:(e,t)=>O(e,t,"exclude"),isClearable:!0,"data-test-subj":"lens-exclude-terms-combobox",autoFocus:!0})))};function go(e){var t;return!(null!=e&&null!==(t=e.esTypes)&&void 0!==t&&t.some((e=>["double","float","half_float","scaled_float"].includes(e))))}const fo=u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"});function bo(e,t=0,a=!1,n=0){return a?u.i18n.translate("xpack.lens.indexPattern.rareTermsOf",{defaultMessage:"Rare values of {name}",values:{name:null!=e?e:fo}}):t?u.i18n.translate("xpack.lens.indexPattern.multipleTermsOf",{defaultMessage:"Top values of {name} + {count} {count, plural, one {other} other {others}}",values:{name:null!=e?e:fo,count:t}}):u.i18n.translate("xpack.lens.indexPattern.termsOf",{defaultMessage:"Top {numberOfTermsLabel}{termsCount, plural, one {value} other {values}} of {name}",values:{name:null!=e?e:fo,termsCount:n,numberOfTermsLabel:n>1?`${n} `:""}})}function ho(e){var t;return{id:null!==(t=e.secondaryFields)&&void 0!==t&&t.length?"multi_terms":"terms"}}const xo=Object(b.htmlIdGenerator)()(),vo={type:"terms",displayName:u.i18n.translate("xpack.lens.indexPattern.terms",{defaultMessage:"Top values"}),priority:3,input:"field",getCurrentFields:e=>{var t,a;return[e.sourceField,...null!==(t=null==e||null===(a=e.params)||void 0===a?void 0:a.secondaryFields)&&void 0!==t?t:[]]},getParamsForMultipleFields:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{const i=new Set(co(n,e).validFields),s=co(n,t,a).validFields;for(const e of s)i.add(e);i.delete(e.sourceField);const l=[...i];return{secondaryFields:l,parentFormat:ho({...e.params,secondaryFields:l})}},canAddNewField:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{var i,s,l;if("rare"===e.params.orderBy.type)return!1;const r=new Set(co(n,e).validFields),{validFields:o}=co(n,t,a),u=o.filter((e=>!r.has(e))).length;return!!u&&u+(null!==(i=null===(s=e.params)||void 0===s||null===(l=s.secondaryFields)||void 0===l?void 0:l.length)&&void 0!==i?i:0)<=3},getDefaultVisualSettings:e=>{var t,a;return{truncateText:Boolean(!(null!==(t=e.params)&&void 0!==t&&null!==(a=t.secondaryFields)&&void 0!==a&&a.length))}},getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(Rr.has(a)&&t&&(!e||e.terms))return{dataType:a,isBucketed:!0,scale:"ordinal"}},getErrorMessage:(e,t,a)=>{const n=[...Xl(e.columns[t],a)||[],lo(e,t,a)||"",ao(e,t,a)||""].filter(Boolean);return n.length?n:void 0},getNonTransferableFields:(e,t)=>co(t,e).invalidFields,isTransferable:(e,t)=>{const{allFields:a,invalidFields:n}=co(t,e);return Boolean(a.length&&0===n.length&&(!e.params.otherBucket||!t.hasRestrictions))},buildColumn({layer:e,field:t,indexPattern:a},n){var i,s,l,r,o,u,c,d,p,m;const g=Object.entries(e.columns).filter((([t])=>oo(e,t))).map((([e])=>e))[0],f=Object.values(e.columns).filter((e=>e&&e.isBucketed)).length;return{label:bo(t.displayName),dataType:t.type,operationType:"terms",scale:"ordinal",sourceField:t.name,isBucketed:!0,params:{size:null!==(i=null==n?void 0:n.size)&&void 0!==i?i:0===f?5:3,orderBy:null!==(s=null==n?void 0:n.orderBy)&&void 0!==s?s:g?{type:"column",columnId:g}:{type:"alphabetical",fallback:!0},orderAgg:"custom"===(null==n?void 0:n.orderBy.type)?null==n?void 0:n.orderAgg:void 0,orderDirection:null!==(l=null==n?void 0:n.orderDirection)&&void 0!==l?l:g?"desc":"asc",otherBucket:(null===(r=null==n?void 0:n.otherBucket)||void 0===r||r)&&!a.hasRestrictions,missingBucket:null!==(o=null==n?void 0:n.missingBucket)&&void 0!==o&&o,parentFormat:null!==(u=null==n?void 0:n.parentFormat)&&void 0!==u?u:{id:"terms"},include:null!==(c=null==n?void 0:n.include)&&void 0!==c?c:[],exclude:null!==(d=null==n?void 0:n.exclude)&&void 0!==d?d:[],includeIsRegex:null!==(p=null==n?void 0:n.includeIsRegex)&&void 0!==p&&p,excludeIsRegex:null!==(m=null==n?void 0:n.excludeIsRegex)&&void 0!==m&&m,secondaryFields:null==n?void 0:n.secondaryFields}}},toEsAggsFn:(e,t,a,n,i,s,l)=>{var r,o,c,d,p,m;if("rare"===(null===(r=e.params)||void 0===r?void 0:r.orderBy.type))return Object(tt.buildExpressionFunction)("aggRareTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,max_doc_count:e.params.orderBy.maxDocCount}).toAst();let g="_key";if("column"===(null===(o=e.params)||void 0===o?void 0:o.orderBy.type)){const t=n.columns[e.params.orderBy.columnId];g=String(s.indexOf(e.params.orderBy.columnId)),t&&ro(t)||(g="_key")}const f=e.params.accuracyMode?Math.max(1e3,1.5*e.params.size+10):void 0,b=e.params.orderAgg;let h;if(b){g="custom";const e=null==l?void 0:l[null==b?void 0:b.operationType];e&&"toEsAggsFn"in e&&(h=[{type:"expression",chain:[e.toEsAggsFn(b,`${t}-orderAgg`,a,n,i,s)]}])}return null!==(c=e.params)&&void 0!==c&&null!==(d=c.secondaryFields)&&void 0!==d&&d.length?Object(tt.buildExpressionFunction)("aggMultiTerms",{id:t,enabled:!0,schema:"segment",fields:[e.sourceField,...e.params.secondaryFields],orderBy:g,order:e.params.orderDirection,orderAgg:h,size:e.params.size,shardSize:f,otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"})}).toAst():Object(tt.buildExpressionFunction)("aggTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,orderBy:g,order:e.params.orderDirection,orderAgg:h,size:e.params.size,shardSize:f,...(null===(p=e.params.include)||void 0===p?void 0:p.length)&&{include:e.params.include},...(null===(m=e.params.exclude)||void 0===m?void 0:m.length)&&{exclude:e.params.exclude},includeIsRegex:Boolean(e.params.includeIsRegex),excludeIsRegex:Boolean(e.params.excludeIsRegex),otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"}),missingBucket:e.params.otherBucket&&e.params.missingBucket,missingBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.missingLabel",{defaultMessage:"(missing value)"})}).toAst()},getDefaultLabel:(e,t)=>{var a,n;return bo(null===(a=t.getFieldByName(e.sourceField))||void 0===a?void 0:a.displayName,null===(n=e.params.secondaryFields)||void 0===n?void 0:n.length,"rare"===e.params.orderBy.type,e.params.size)},onFieldChange:(e,t,a)=>{var n;const i={...e.params,secondaryFields:void 0,...a};return"format"in i&&"number"!==t.type&&delete i.format,i.parentFormat=ho(i),go(t)||"rare"!==i.orderBy.type||(i.orderBy={type:"alphabetical"}),{...e,dataType:t.type,label:e.customLabel?e.label:bo(t.displayName,null===(n=i.secondaryFields)||void 0===n?void 0:n.length,"rare"===i.orderBy.type,i.size),sourceField:t.name,params:i}},onOtherColumnChanged:(e,t)=>{const a=e.columns,n=a[t];if(("column"===n.params.orderBy.type||"alphabetical"===n.params.orderBy.type&&n.params.orderBy.fallback)&&(!("column"===n.params.orderBy.type?a[n.params.orderBy.columnId]:void 0)||"column"===n.params.orderBy.type&&!oo(e,n.params.orderBy.columnId))){const t=Object.entries(e.columns).filter((([t])=>oo(e,t))).map((([e])=>e))[0];return{...n,params:{...n.params,orderBy:t?{type:"column",columnId:t}:{type:"alphabetical",fallback:!0},orderDirection:t?"desc":"asc"}}}return n},renderFieldInput:function(e){var t,a,n,i;const{layer:l,selectedColumn:r,columnId:o,indexPattern:c,operationSupportMatrix:d,updateLayer:p,dimensionGroups:m,groupId:g,incompleteParams:f}=e,h=Object(s.useCallback)((e=>{const t=l.columns[o],[a,...n]=e,i=Object(jt.uniq)(e.map((e=>{var t;return null===(t=c.getFieldByName(e))||void 0===t?void 0:t.type}))),s=(1===i.length?i[0]:"string")||t.dataType,r={...t.params};"format"in r&&"number"!==s&&delete r.format;const u=c.getFieldByName(a);if(go(u)||"rare"!==r.orderBy.type||(r.orderBy={type:"alphabetical"}),1===e.length){const e=d.operationByField[a];if(!(null==e?void 0:e.has("terms"))){const t=null==e?void 0:e.values().next().value;return p(rr({layer:l,columnId:o,indexPattern:c,op:t,field:u,visualizationGroups:m,targetGroup:g,incompleteParams:f}))}}p({...l,columns:{...l.columns,[o]:{...t,dataType:s,sourceField:a,label:t.customLabel?t.label:bo(null==u?void 0:u.displayName,e.length-1,"rare"===r.orderBy.type,r.size),params:{...r,secondaryFields:n,parentFormat:ho({...r,secondaryFields:n})}}}})}),[o,m,g,f,c,l,d.operationByField,p]),x=l.columns[o],v=Hr(r,Boolean(e.incompleteOperation),"field",e.currentFieldIsInvalid);if(!x||!r||e.incompleteOperation||v&&(null===(t=r.params)||void 0===t||null===(a=t.secondaryFields)||void 0===a||!a.length))return Object(j.jsx)(qr,e);const y=Boolean(ao(l,o,c)),{invalidFields:O}=co(c,r);return Object(j.jsx)(b.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.terms.chooseFields",{defaultMessage:"{count, plural, zero {Field} other {Fields}}",values:{count:(null===(n=r.params)||void 0===n||null===(i=n.secondaryFields)||void 0===i?void 0:i.length)||0}}),fullWidth:!0,isInvalid:Boolean(y||O.length),error:Gr(y,O)},Object(j.jsx)(zr,{column:r,indexPattern:c,operationSupportMatrix:d,onChange:h,invalidFields:O}))},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.terms.documentation.quick",{defaultMessage:"\nThe top values of a specified field ranked by the chosen metric.\n      "}),handleDataSectionExtra:!0,paramEditor:function({layer:e,paramEditorUpdater:t,currentColumn:a,columnId:n,indexPattern:r,operationDefinitionMap:o,ReferenceEditor:c,paramEditorCustomProps:d,activeData:p,dataSectionExtra:m,...g}){var f,h,x,v;const[y,O]=Object(s.useState)(void 0),k=r.hasRestrictions;function I(e){return"column"!==e.type?e.type:`${e.type}$$$${e.columnId}`}const T=Object.entries(e.columns).filter((([t])=>oo(e,t))).map((([e,t])=>({value:I({type:"column",columnId:e}),text:t.label})));T.push({value:I({type:"alphabetical"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderAlphabetical",{defaultMessage:"Alphabetical"})}),null!==(f=a.params.secondaryFields)&&void 0!==f&&f.length||!go(r.getFieldByName(a.sourceField))||T.push({value:I({type:"rare",maxDocCount:1}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderRare",{defaultMessage:"Rarity"})}),T.push({value:I({type:"custom"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderCustomMetric",{defaultMessage:"Custom"})});const w=a.params.secondaryFields?a.params.secondaryFields.length:0,{euiTheme:M}=Object(b.useEuiTheme)();return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(Dr,{value:a.params.size,disabled:"rare"===a.params.orderBy.type,onChange:i=>{var s;t({...e,columns:{...e.columns,[n]:{...a,label:a.customLabel?a.label:bo(null===(s=r.getFieldByName(a.sourceField))||void 0===s?void 0:s.displayName,w,"rare"===a.params.orderBy.type,i),params:{...a.params,size:i}}}})}}),"rare"===a.params.orderBy.type&&Object(j.jsx)(Dr,{value:a.params.orderBy.maxDocCount,label:u.i18n.translate("xpack.lens.indexPattern.terms.maxDocCount",{defaultMessage:"Max doc count per term"}),maxValue:100,onChange:i=>{t(vr({layer:e,columnId:n,paramName:"orderBy",value:{...a.params.orderBy,maxDocCount:i}}))}}),Object(j.jsx)(b.EuiFormRow,{label:Object(j.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})," ",Object(j.jsx)(b.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.terms.orderByHelp",{defaultMessage:"Specifies the dimension the top values are ranked by."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),display:"rowCompressed",fullWidth:!0},Object(j.jsx)(b.EuiSelect,{compressed:!0,fullWidth:!0,"data-test-subj":"indexPattern-terms-orderBy",options:T,value:I(a.params.orderBy),onChange:a=>{const i="alphabetical"===(s=a.target.value)?{type:"alphabetical",fallback:!1}:"rare"===s?{type:"rare",maxDocCount:1}:"custom"===s?{type:"custom"}:{type:"column",columnId:s.split("$$$")[1]};var s;let l=Pr(vr({layer:e,columnId:n,paramName:"orderBy",value:i}),r);if("custom"===i.type){const t=o.count.buildColumn({layer:e,indexPattern:r,field:r.getFieldByName(at.c)});l=vr({layer:l,columnId:n,paramName:"orderAgg",value:t})}else l=vr({layer:l,columnId:n,paramName:"orderAgg",value:void 0});O(void 0),t(vr({layer:l,columnId:n,paramName:"orderDirection",value:"alphabetical"===i.type?"asc":"desc"}))},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})})),a.params.orderAgg&&c&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(c,i()({operationDefinitionMap:o,functionLabel:u.i18n.translate("xpack.lens.indexPattern.terms.orderAgg.rankFunction",{defaultMessage:"Rank function"}),fieldLabel:u.i18n.translate("xpack.lens.indexPattern.terms.orderAgg.rankField",{defaultMessage:"Rank field"}),isInline:!0,paramEditorCustomProps:{...d,isInline:!0,labels:yo(a.params.orderAgg.operationType)},layer:e,selectionStyle:"full",columnId:`${n}-orderAgg`,currentIndexPattern:r,paramEditorUpdater:a=>{if(!Jl(a))throw new Error("Setter should always be a column when ran here.");t(vr({layer:e,columnId:n,paramName:"orderAgg",value:a}))},column:a.params.orderAgg,incompleteColumn:y,onDeleteColumn:()=>{throw new Error("Should not be called")},onChooseField:i=>{const s=i.field&&r.getFieldByName(i.field);if(s){const l=o[i.operationType].buildColumn({previousColumn:a.params.orderAgg,layer:e,indexPattern:r,field:s});O(void 0),t(vr({layer:e,columnId:n,paramName:"orderAgg",value:l}))}else O({sourceField:i.field,operationType:i.operationType})},onChooseFunction:(i,s)=>{if(s){const l=o[i].buildColumn({previousColumn:a.params.orderAgg,layer:e,indexPattern:r,field:s});O(void 0),t(vr({layer:e,columnId:n,paramName:"orderAgg",value:l}))}else O({operationType:i})},validation:{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}},g)),Object(j.jsx)(b.EuiSpacer,{size:"m"})),Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),display:"rowCompressed",fullWidth:!0},Object(j.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),"data-test-subj":"indexPattern-terms-orderDirection-groups",name:"orderDirection",buttonSize:"compressed","aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),isDisabled:"rare"===a.params.orderBy.type,options:[{id:`${xo}asc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-asc",value:"asc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderAscending",{defaultMessage:"Ascending"})},{id:`${xo}desc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-desc",value:"desc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDescending",{defaultMessage:"Descending"})}],idSelected:`${xo}${a.params.orderDirection}`,onChange:a=>{const i=a.replace(xo,"");t(vr({layer:e,columnId:n,paramName:"orderDirection",value:i}))}})),m&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"m"}),m),!k&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"m"}),Object(j.jsx)(b.EuiAccordion,{id:"lnsTermsAdvanced",arrowProps:{color:"primary"},buttonContent:Object(j.jsx)(b.EuiTitle,{size:"xxs"},Object(j.jsx)("h5",null,Object(j.jsx)(b.EuiTextColor,{color:M.colors.primary},u.i18n.translate("xpack.lens.indexPattern.terms.advancedSettings",{defaultMessage:"Advanced"})))),"data-test-subj":"indexPattern-terms-advanced",className:"lnsIndexPatternDimensionEditor-advancedOptions"},Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.missingBucketDescription",{defaultMessage:"Include documents without the selected field"})),compressed:!0,disabled:!a.params.otherBucket||"string"!==(null===(h=r.getFieldByName(a.sourceField))||void 0===h?void 0:h.type)||"rare"===a.params.orderBy.type,"data-test-subj":"indexPattern-terms-missing-bucket",checked:Boolean(a.params.missingBucket),onChange:a=>t(vr({layer:e,columnId:n,paramName:"missingBucket",value:a.target.checked}))}),Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.otherBucketDescription",{defaultMessage:'Group remaining values as "Other"'})),compressed:!0,"data-test-subj":"indexPattern-terms-other-bucket",checked:Boolean(a.params.otherBucket),disabled:"rare"===a.params.orderBy.type,onChange:a=>t(vr({layer:e,columnId:n,paramName:"otherBucket",value:a.target.checked}))}),Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.accuracyModeDescription",{defaultMessage:"Enable accuracy mode"})," ",Object(j.jsx)(b.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.terms.accuracyModeHelp",{defaultMessage:"Improves results for high-cardinality data, but increases the load on the Elasticsearch cluster."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),compressed:!0,disabled:"rare"===a.params.orderBy.type,"data-test-subj":"indexPattern-accuracy-mode",checked:Boolean(a.params.accuracyMode&&"rare"!==a.params.orderBy.type),onChange:a=>t(vr({layer:e,columnId:n,paramName:"accuracyMode",value:a.target.checked}))}),("number"===a.dataType||"string"===a.dataType)&&!(null!==(x=a.params.secondaryFields)&&void 0!==x&&x.length)&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(mo,{include:a.params.include,exclude:a.params.exclude,includeIsRegex:Boolean(a.params.includeIsRegex),excludeIsRegex:Boolean(a.params.excludeIsRegex),tableRows:null==p||null===(v=p[g.layerId])||void 0===v?void 0:v.rows,columnId:n,isNumberField:Boolean("number"===a.dataType),updateParams:(i,s,l,r)=>t({...e,columns:{...e.columns,[n]:{...a,params:{...a.params,[i]:s,[l]:r}}}})})))))},getMaxPossibleNumValues:e=>e.params.size+(e.params.otherBucket?1:0)};function yo(e){switch(e){case"last_value":return[u.i18n.translate("xpack.lens.indexPattern.terms.lastValue.sortRankBy",{defaultMessage:"Sort rank by"})];case"percentile_rank":return[u.i18n.translate("xpack.lens.indexPattern.terms.percentile.",{defaultMessage:"Percentile ranks"})];default:return}}var jo,Oo,ko=a(1),Io=a.n(ko),To=a(145),wo=a.n(To),Mo=a(146),Co=a.n(Mo);!function(e){e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.MATCH_ONLY_TEXT="match_only_text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.AGGREGATE_METRIC_DOUBLE="aggregate_metric_double",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram"}(jo||(jo={})),function(e){e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing"}(Oo||(Oo={}));var So=wo()((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Co()(this,e),Io()(this,"name",void 0),Io()(this,"sortable",void 0),Io()(this,"filterable",void 0),Io()(this,"esTypes",void 0),this.name=t.name||Oo.UNKNOWN,this.sortable=t.sortable||!1,this.filterable=t.filterable||!1,this.esTypes=Object.freeze((t.esTypes||[]).slice())})),Fo=(new So({name:Oo.UNKNOWN}),new So({name:Oo.STRING,sortable:!0,filterable:!0,esTypes:[jo.STRING,jo.TEXT,jo.MATCH_ONLY_TEXT,jo.KEYWORD,jo.VERSION,jo._TYPE,jo._ID]}),new So({name:Oo.NUMBER,sortable:!0,filterable:!0,esTypes:[jo.FLOAT,jo.HALF_FLOAT,jo.SCALED_FLOAT,jo.DOUBLE,jo.INTEGER,jo.LONG,jo.UNSIGNED_LONG,jo.SHORT,jo.BYTE,jo.TOKEN_COUNT,jo.AGGREGATE_METRIC_DOUBLE]}),new So({name:Oo.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[jo.FLOAT_RANGE,jo.DOUBLE_RANGE,jo.INTEGER_RANGE,jo.LONG_RANGE]}),new So({name:Oo.DATE,sortable:!0,filterable:!0,esTypes:[jo.DATE,jo.DATE_NANOS]}),new So({name:Oo.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[jo.DATE_RANGE]}),new So({name:Oo.IP,sortable:!0,filterable:!0,esTypes:[jo.IP]}),new So({name:Oo.IP_RANGE,sortable:!0,filterable:!0,esTypes:[jo.IP_RANGE]}),new So({name:Oo.BOOLEAN,sortable:!0,filterable:!0,esTypes:[jo.BOOLEAN]}),new So({name:Oo.OBJECT,esTypes:[jo.OBJECT]}),new So({name:Oo.NESTED,esTypes:[jo.NESTED]}),new So({name:Oo.GEO_POINT,esTypes:[jo.GEO_POINT]}),new So({name:Oo.GEO_SHAPE,esTypes:[jo.GEO_SHAPE]}),new So({name:Oo.ATTACHMENT,esTypes:[jo.ATTACHMENT]}),new So({name:Oo.MURMUR3,esTypes:[jo.MURMUR3]}),new So({name:Oo._SOURCE,esTypes:[jo._SOURCE]}),new So({name:Oo.HISTOGRAM,filterable:!0,esTypes:[jo.HISTOGRAM]}),new So({name:Oo.CONFLICT}),a(49));const Eo={s:u.i18n.translate("xpack.lens.fieldFormats.suffix.s",{defaultMessage:"/s"}),m:u.i18n.translate("xpack.lens.fieldFormats.suffix.m",{defaultMessage:"/m"}),h:u.i18n.translate("xpack.lens.fieldFormats.suffix.h",{defaultMessage:"/h"}),d:u.i18n.translate("xpack.lens.fieldFormats.suffix.d",{defaultMessage:"/d"})},Po={s:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.s",{defaultMessage:"per second"}),m:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.m",{defaultMessage:"per minute"}),h:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.h",{defaultMessage:"per hour"}),d:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.d",{defaultMessage:"per day"})},Ao="suffix";function _o(e){var t;return t=class SuffixFormatter extends Fo.FieldFormat{constructor(...t){super(...t),Io()(this,"allowsNumericalAggregations",!0),Io()(this,"textConvert",(t=>{const a=this.param("unit"),n=a?Eo[a]:this.param("suffixString"),i=this.param("id"),s=this.param("params"),l=e()({id:i,params:s}).convert(t);return""===l?"":n?`${l}${n}`:l}))}getParamDefaults(){return{unit:void 0,nestedParams:{}}}},Io()(t,"id",Ao),Io()(t,"hidden",!0),Io()(t,"title",u.i18n.translate("xpack.lens.fieldFormats.suffix.title",{defaultMessage:"Suffix"})),Io()(t,"fieldType",Oo.NUMBER),t}function Lo(e,t,a){return(t||e?" ":"")+(e?Po[e]:"")+(t&&e?" ":"")+(t?`-${t}`:"")+(a?" ":"")+(a?u.i18n.translate("xpack.lens.reducedTimeRangeSuffix",{defaultMessage:"last {reducedTimeRange}",values:{reducedTimeRange:a}}):"")}function Do(e,t,a,n,i,s,l){let r=e;if(t||n||s){const a=Lo(t,n,s),i=e.lastIndexOf(a);-1!==i&&(r=e.substring(0,i))}return a||i||l?`${r}${Lo(a,i,l)}`:r}const No=(e,t,a)=>{const{functions:[n]}=e,i=[];var s;if(t.includes(n.name)&&(i.push(n.name),a.forEach((({name:e,transformer:t})=>{var a;const s=null===(a=n.getArgument(e))||void 0===a?void 0:a[0];i.push(t?t(s):s)})),i.push(null===(s=n.getArgument("timeShift"))||void 0===s?void 0:s[0])),"aggFilteredMetric"===n.name){var l;const e=null===(l=n.getArgument("customMetric"))||void 0===l?void 0:l[0].functions[0];if(e&&t.includes(e.name)){var r,o;i.push(e.name),i.push("filtered");const t=(null===(r=n.getArgument("customBucket"))||void 0===r?void 0:r[0]).functions[0];a.forEach((({name:t,transformer:a})=>{var n;const s=null===(n=e.getArgument(t))||void 0===n?void 0:n[0];i.push(a?a(s):s)})),i.push(t.getArgument("timeWindow")),i.push(n.getArgument("timeShift"));const s=null===(o=t.getArgument("filter"))||void 0===o?void 0:o[0];if(s){var u;const e=s.functions[0];i.push(null==e?void 0:e.name,null==e||null===(u=e.getArgument("q"))||void 0===u?void 0:u[0])}}}return i.length?i.map(String).join("-"):void 0},Ro=new Set(["string","boolean","number","number_range","ip","ip_range","date","date_range","murmur3"]),Bo="ratio",Vo="unique_count";function zo(e,t,a){return Do(u.i18n.translate("xpack.lens.indexPattern.cardinalityOf",{defaultMessage:"Unique count of {name}",values:{name:e}}),void 0,void 0,void 0,t,void 0,a)}const Go={type:Vo,displayName:u.i18n.translate("xpack.lens.indexPattern.cardinality",{defaultMessage:"Unique count"}),allowAsReference:!0,input:"field",getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(Ro.has(a)&&t&&(!e||e.cardinality))return{dataType:"number",isBucketed:!1,scale:Bo}},getErrorMessage:(e,t,a)=>Yl([Xl(e.columns[t],a),hl(e,t),jl(e,t,a)]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&Ro.has(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.cardinality))},filterable:!0,shiftable:!0,canReduceTimeRange:!0,getDefaultLabel:(e,t)=>zo(Kl(e.sourceField,t),e.timeShift,e.reducedTimeRange),buildColumn({field:e,previousColumn:t},a){var n;return{label:zo(e.displayName,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:Vo,scale:Bo,sourceField:e.name,isBucketed:!1,filter:ar(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==a?void 0:a.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{...tr(t),emptyAsNull:t&&Zl("unique_count",t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n})=>{var i;return[{dataTestSubj:"hide-zero-values",inlineElement:Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"})),labelProps:{style:{fontWeight:Q.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(vr({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})}]},toEsAggsFn:(e,t)=>{var a;return Object(tt.buildExpressionFunction)("aggCardinality",{id:t,enabled:!0,schema:"metric",field:e.sourceField,timeShift:e.filter?void 0:e.timeShift,emptyAsNull:null===(a=e.params)||void 0===a?void 0:a.emptyAsNull}).toAst()},getGroupByKey:e=>No(e,["aggCardinality"],[{name:"field"},{name:"emptyAsNull",transformer:e=>String(Boolean(e))}]),onFieldChange:(e,t)=>({...e,label:zo(t.displayName,e.timeShift,e.reducedTimeRange),sourceField:t.name}),documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.cardinality.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.cardinality.documentation.markdown",{defaultMessage:"\nCalculates the number of unique values of a specified field. Works for number, string, date and boolean values.\n\nExample: Calculate the number of different products:\n`unique_count(product.name)`\n\nExample: Calculate the number of different products from the \"clothes\" group:\n`unique_count(product.name, kql='product.group=clothes')`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.cardinality.documentation.quick",{defaultMessage:"\nThe number of unique values for a specified number, string, date, or boolean field.\n      "})};function qo(e,t,a,n){return Do(u.i18n.translate("xpack.lens.indexPattern.percentileOf",{defaultMessage:"{percentile, selectordinal, one {#st} two {#nd} few {#rd} other {#th}} percentile of {name}",values:{name:e,percentile:t}}),void 0,void 0,void 0,a,void 0,n)}const Ho=["number","histogram"],$o={type:"percentile",allowAsReference:!0,displayName:u.i18n.translate("xpack.lens.indexPattern.percentile",{defaultMessage:"Percentile"}),input:"field",operationParams:[{name:"percentile",type:"number",required:!1,defaultValue:95}],filterable:!0,shiftable:!0,canReduceTimeRange:!0,getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(Ho.includes(a)&&t&&(!e||e.percentiles))return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&Ho.includes(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||!a.aggregationRestrictions.percentiles))},getDefaultLabel:(e,t,a)=>qo(Kl(e.sourceField,t),e.params.percentile,e.timeShift,e.reducedTimeRange),buildColumn:({field:e,previousColumn:t,indexPattern:a},n)=>{var i;const s=t&&Zl("percentile",t)&&t.params.percentile,l=null!==(i=null==n?void 0:n.percentile)&&void 0!==i?i:s||95;return{label:qo(Kl(e.name,a),l,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:"percentile",sourceField:e.name,isBucketed:!1,scale:"ratio",filter:ar(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{percentile:l,...tr(t)}}},onFieldChange:(e,t)=>({...e,label:qo(t.displayName,e.params.percentile,e.timeShift,e.reducedTimeRange),sourceField:t.name}),toEsAggsFn:(e,t,a)=>Object(tt.buildExpressionFunction)("aggSinglePercentile",{id:t,enabled:!0,schema:"metric",field:e.sourceField,percentile:e.params.percentile,timeShift:e.filter?void 0:e.timeShift}).toAst(),optimizeEsAggs:(e,t,a)=>{let n=[...e];const i={...t},s={};n.forEach((e=>{const{functions:[t]}=e;if("aggSinglePercentile"===t.name){var a,n;const i=`${null===(a=t.getArgument("field"))||void 0===a?void 0:a[0]}-${null===(n=t.getArgument("timeShift"))||void 0===n?void 0:n[0]}`;i in s||(s[i]=[]),s[i].push(e)}}));const l=n.map((e=>e.functions[0])).filter((e=>"aggTerms"===e.name));return Object.values(s).forEach((e=>{var t,s,r,o;if(e.length<=1)return;n=n.filter((t=>!e.includes(t)));const{functions:[u]}=e[0],c=u.getArgument("id")[0],d={id:c,enabled:null===(t=u.getArgument("enabled"))||void 0===t?void 0:t[0],schema:null===(s=u.getArgument("schema"))||void 0===s?void 0:s[0],field:null===(r=u.getArgument("field"))||void 0===r?void 0:r[0],percents:[],timeShift:null===(o=u.getArgument("timeShift"))||void 0===o?void 0:o[0]},p={};for(const t of e){const n=t.functions[0].getArgument("percentile")[0];if(n in p){const s=p[n],l=a.get(s),r=a.get(t);if(!l||!r)throw new Error("Couldn't find esAggs ID for percentile expression builder... this should never happen.");i[l].push(...i[r]),delete i[r],e=e.filter((e=>e!==t))}else p[n]=t,d.percents.push(n);l.forEach((e=>{var a,i;(null===(a=e.getArgument("orderBy"))||void 0===a?void 0:a[0])===(null===(i=t.functions[0].getArgument("id"))||void 0===i?void 0:i[0])&&e.replaceArgument("orderBy",[`${c}.${n}`])}))}const m=Object(tt.buildExpressionFunction)("aggPercentiles",d).toAst();n.push(Object(tt.buildExpression)({type:"expression",chain:[m]})),e.forEach((e=>{const t=a.get(e);if(void 0===t)throw new Error("Could not find current column ID for percentile agg expression builder");const n=`col-?-${c}.${e.functions[0].getArgument("percentile")[0]}`;i[n]=i[t],delete i[t]}))})),{esAggsIdMap:i,aggs:n}},getErrorMessage:(e,t,a)=>Yl([Xl(e.columns[t],a),hl(e,t),jl(e,t,a)]),paramEditor:function({paramEditorUpdater:e,currentColumn:t,indexPattern:a,paramEditorCustomProps:n}){const{labels:i,isInline:l}=n||{},r=(null==i?void 0:i[0])||u.i18n.translate("xpack.lens.indexPattern.percentile.percentileValue",{defaultMessage:"Percentile"}),o=Object(s.useCallback)((n=>{var i;Ql(n,!0,99,1)&&Number(n)!==t.params.percentile&&e({...t,label:t.customLabel?t.label:qo((null===(i=a.getFieldByName(t.sourceField))||void 0===i?void 0:i.displayName)||t.sourceField,Number(n),t.timeShift,t.reducedTimeRange),params:{...t.params,percentile:Number(n)}})}),[e,t,a]),{inputValue:c,handleInputChange:d}=Object(k.F)({onChange:o,value:String(t.params.percentile)}),p=Ql(c,!0,99,1),m=Object(s.useCallback)((e=>d(String(e.currentTarget.value))),[d]);return Object(j.jsx)(Wr,{isInline:l,label:r,"data-test-subj":"lns-indexPattern-percentile-form",display:"rowCompressed",fullWidth:!0,isInvalid:!p,error:!p&&u.i18n.translate("xpack.lens.indexPattern.percentile.errorMessage",{defaultMessage:"Percentile has to be an integer between 1 and 99"})},l?Object(j.jsx)(b.EuiFieldNumber,{fullWidth:!0,"data-test-subj":"lns-indexPattern-percentile-input",compressed:!0,value:null!=c?c:"",min:1,max:99,step:1,onChange:m,"aria-label":r}):Object(j.jsx)(b.EuiRange,{fullWidth:!0,"data-test-subj":"lns-indexPattern-percentile-input",compressed:!0,value:null!=c?c:"",min:1,max:99,step:1,onChange:m,showInput:!0,"aria-label":r}))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.percentile.signature",{defaultMessage:"field: string, [percentile]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.percentile.documentation.markdown",{defaultMessage:"\nReturns the specified percentile of the values of a field. This is the value n percent of the values occuring in documents are smaller.\n\nExample: Get the number of bytes larger than 95 % of values:\n`percentile(bytes, percentile=95)`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.percentile.documentation.quick",{defaultMessage:"\n      The largest value that is smaller than n percent of the values that occur in all documents.\n      "})};function Wo(e,t,a,n){return Do(u.i18n.translate("xpack.lens.indexPattern.percentileRanksOf",{defaultMessage:"Percentile rank ({value}) of {name}",values:{name:e,value:t}}),void 0,void 0,void 0,a,void 0,n)}const Uo=["number","histogram"],Xo={type:"percentile_rank",allowAsReference:!0,displayName:u.i18n.translate("xpack.lens.indexPattern.percentileRank",{defaultMessage:"Percentile rank"}),input:"field",operationParams:[{name:"value",type:"number",required:!1,defaultValue:0}],filterable:!0,shiftable:!0,canReduceTimeRange:!0,getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(Uo.includes(a)&&t&&(!e||!e.percentile_ranks))return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&Uo.includes(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||!a.aggregationRestrictions.percentile_ranks))},getDefaultLabel:(e,t,a)=>Wo(Kl(e.sourceField,t),e.params.value,e.timeShift,e.reducedTimeRange),buildColumn:({field:e,previousColumn:t,indexPattern:a},n)=>{var i;const s=t&&Zl("percentile_rank",t)&&t.params.value,l=null!==(i=null==n?void 0:n.value)&&void 0!==i?i:s||0;return{label:Wo(Kl(e.name,a),l,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:"percentile_rank",sourceField:e.name,isBucketed:!1,scale:"ratio",filter:ar(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{value:l,...tr(t)}}},onFieldChange:(e,t)=>({...e,label:Wo(t.displayName,e.params.value,e.timeShift,e.reducedTimeRange),sourceField:t.name}),toEsAggsFn:(e,t,a)=>Object(tt.buildExpressionFunction)("aggSinglePercentileRank",{id:t,enabled:!0,schema:"metric",field:e.sourceField,value:e.params.value,timeShift:e.filter?void 0:e.timeShift}).toAst(),getErrorMessage:(e,t,a)=>Yl([Xl(e.columns[t],a),hl(e,t),jl(e,t,a)]),paramEditor:function({paramEditorUpdater:e,currentColumn:t,indexPattern:a,paramEditorCustomProps:n}){const{labels:i,isInline:l}=n||{},r=(null==i?void 0:i[0])||u.i18n.translate("xpack.lens.indexPattern.percentile.percentileRanksValue",{defaultMessage:"Percentile ranks value"}),o=Object(s.useCallback)((n=>{var i;Ql(n)&&Number(n)!==t.params.value&&e({...t,label:t.customLabel?t.label:Wo((null===(i=a.getFieldByName(t.sourceField))||void 0===i?void 0:i.displayName)||t.sourceField,Number(n),t.timeShift,t.reducedTimeRange),params:{...t.params,value:Number(n)}})}),[e,t,a]),{inputValue:c,handleInputChange:d}=Object(k.F)({onChange:o,value:String(t.params.value)},{allowFalsyValue:!0}),p=Ql(c),m=Object(s.useCallback)((e=>{d(e.currentTarget.value)}),[d]);return Object(j.jsx)(Wr,{isInline:l,label:r,"data-test-subj":"lns-indexPattern-percentile_ranks-form",display:"rowCompressed",fullWidth:!0,isInvalid:!p,error:!p&&u.i18n.translate("xpack.lens.indexPattern.percentileRanks.errorMessage",{defaultMessage:"Percentile ranks value must be a number"})},Object(j.jsx)(b.EuiFieldNumber,{fullWidth:!0,"data-test-subj":"lns-indexPattern-percentile_ranks-input",compressed:!0,value:null!=c?c:"",onChange:m,step:"any","aria-label":r}))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.percentileRanks.signature",{defaultMessage:"field: string, [value]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.percentileRanks.documentation.markdown",{defaultMessage:"\nReturns the percentage of values which are below a certain value. For example, if a value is greater than or equal to 95% of the observed values it is said to be at the 95th percentile rank\n\nExample: Get the percentage of values which are below of 100:\n`percentile_rank(bytes, value=100)`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.percentileRanks.documentation.quick",{defaultMessage:"\nThe percentage of values that are below a specific value. For example, when a value is greater than or equal to 95% of the calculated values, the value is the 95th percentile rank.\n      "})},Yo={min:"aggMin",max:"aggMax",average:"aggAvg",sum:"aggSum",median:"aggMedian",standard_deviation:"aggStdDeviation"},Ko=["number","histogram"];function Qo({type:e,displayName:t,description:a,ofName:n,priority:i,optionalTimeScaling:s,supportsDate:l,hideZeroOption:r,aggConfigParams:o,documentationDescription:c,quickFunctionDocumentation:d}){const p=(e,t)=>Do(n(e),void 0,s?null==t?void 0:t.timeScale:void 0,void 0,null==t?void 0:t.timeShift,void 0,null==t?void 0:t.reducedTimeRange);return{type:e,allowAsReference:!0,priority:i,displayName:t,description:a,input:"field",timeScalingMode:s?"optional":void 0,getPossibleOperationForField:({aggregationRestrictions:t,aggregatable:a,type:n})=>{if((Ko.includes(n)||l&&"date"===n)&&a&&(!t||t[e]))return{dataType:"date"===n?"date":"number",isBucketed:!1,scale:"ratio"}},isTransferable:(t,a)=>{const n=a.getFieldByName(t.sourceField);return Boolean(n&&Ko.includes(n.type)&&n.aggregatable&&(!n.aggregationRestrictions||n.aggregationRestrictions[e]))},getDefaultLabel:(e,t,a)=>p(Kl(e.sourceField,t),e),buildColumn:({field:t,previousColumn:a},n)=>{var i;return{label:p(t.displayName,a),dataType:l&&"date"===t.type?"date":"number",operationType:e,sourceField:t.name,isBucketed:!1,scale:"ratio",timeScale:s?null==a?void 0:a.timeScale:void 0,filter:ar(a,n),timeShift:(null==n?void 0:n.shift)||(null==a?void 0:a.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==a?void 0:a.reducedTimeRange),params:{...tr(a),emptyAsNull:r&&a&&Zl(e,a)?null===(i=a.params)||void 0===i?void 0:i.emptyAsNull:!(null!=n&&n.usedInMath)}}},onFieldChange:(e,t)=>({...e,label:p(t.displayName,e),dataType:t.type,sourceField:t.name}),getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n})=>{var i;return r?[{dataTestSubj:"hide-zero-values",inlineElement:Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"})),labelProps:{style:{fontWeight:Q.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(vr({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})}]:[]},toEsAggsFn:(t,a,n)=>{var i;return Object(tt.buildExpressionFunction)(Yo[e],{id:a,enabled:!0,schema:"metric",field:t.sourceField,timeShift:t.filter?void 0:t.timeShift,emptyAsNull:r?null===(i=t.params)||void 0===i?void 0:i.emptyAsNull:void 0,...o}).toAst()},getGroupByKey:t=>No(t,[Yo[e]],[{name:"field"},{name:"emptyAsNull",transformer:e=>String(Boolean(e))}]),getErrorMessage:(e,t,a)=>Yl([Xl(e.columns[t],a),hl(e,t),jl(e,t,a)]),filterable:!0,canReduceTimeRange:!0,documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.metric.signature",{defaultMessage:"field: string"}),description:c||u.i18n.translate("xpack.lens.indexPattern.metric.documentation.markdown",{defaultMessage:"\nReturns the {metric} of a field. This function only works for number fields.\n\nExample: Get the {metric} of price:\n`{metric}(price)`\n\nExample: Get the {metric} of price for orders from the UK:\n`{metric}(price, kql='location:UK')`\n      ",values:{metric:e}})},quickFunctionDocumentation:d,shiftable:!0}}const Zo=Qo({type:"min",displayName:u.i18n.translate("xpack.lens.indexPattern.min",{defaultMessage:"Minimum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.minOf",{defaultMessage:"Minimum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.min.description",{defaultMessage:"A single-value metrics aggregation that returns the minimum value among the numeric values extracted from the aggregated documents."}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.min.quickFunctionDescription",{defaultMessage:"The minimum value of a number field."}),supportsDate:!0}),Jo=Qo({type:"max",displayName:u.i18n.translate("xpack.lens.indexPattern.max",{defaultMessage:"Maximum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.maxOf",{defaultMessage:"Maximum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.max.description",{defaultMessage:"A single-value metrics aggregation that returns the maximum value among the numeric values extracted from the aggregated documents."}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.max.quickFunctionDescription",{defaultMessage:"The maximum value of a number field."}),supportsDate:!0}),eu=Qo({type:"average",priority:2,displayName:u.i18n.translate("xpack.lens.indexPattern.avg",{defaultMessage:"Average"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.avgOf",{defaultMessage:"Average of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.avg.description",{defaultMessage:"A single-value metric aggregation that computes the average of numeric values that are extracted from the aggregated documents"}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.avg.quickFunctionDescription",{defaultMessage:"The mean value of a set of number fields."})}),tu=Qo({type:"standard_deviation",displayName:u.i18n.translate("xpack.lens.indexPattern.standardDeviation",{defaultMessage:"Standard deviation"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.standardDeviationOf",{defaultMessage:"Standard deviation of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.standardDeviation.description",{defaultMessage:"A single-value metric aggregation that computes the standard deviation of numeric values that are extracted from the aggregated documents"}),aggConfigParams:{showBounds:!1},documentationDescription:u.i18n.translate("xpack.lens.indexPattern.standardDeviation.documentation.markdown",{defaultMessage:"\nReturns the amount of variation or dispersion of the field. The function works only for number fields.\n\n#### Examples\n\nTo get the standard deviation of price, use `standard_deviation(price)`.\n\nTo get the variance of price for orders from the UK, use `square(standard_deviation(price, kql='location:UK'))`.\n      "}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.standardDeviation.quickFunctionDescription",{defaultMessage:"The standard deviation of the values of a number field which is the amount of variation of the fields values."})}),au=Qo({type:"sum",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.sum",{defaultMessage:"Sum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.sumOf",{defaultMessage:"Sum of {name}",values:{name:e}}),optionalTimeScaling:!0,description:u.i18n.translate("xpack.lens.indexPattern.sum.description",{defaultMessage:"A single-value metrics aggregation that sums up numeric values that are extracted from the aggregated documents."}),hideZeroOption:!0,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.sum.quickFunctionDescription",{defaultMessage:"The total amount of the values of a number field."})}),nu=Qo({type:"median",priority:3,displayName:u.i18n.translate("xpack.lens.indexPattern.median",{defaultMessage:"Median"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.medianOf",{defaultMessage:"Median of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.median.description",{defaultMessage:"A single-value metrics aggregation that computes the median value that are extracted from the aggregated documents."}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.median.quickFunctionDescription",{defaultMessage:"The median value of a number field."})}),{isValidInterval:iu}=Kn.search.aggs,su="auto",lu=new Set(["w","M","q","y"]);function ru(e,t){if(Object.values(e.columns).some((e=>e.timeShift&&""!==e.timeShift)))return e.columnOrder.filter((t=>"date_histogram"===e.columns[t].operationType)).length<2?void 0:u.i18n.translate("xpack.lens.indexPattern.multipleDateHistogramsError",{defaultMessage:'"{dimensionLabel}" is not the only date histogram. When using time shifts, make sure to only use one date histogram.',values:{dimensionLabel:e.columns[t].label}})}const ou={type:"date_histogram",displayName:u.i18n.translate("xpack.lens.indexPattern.dateHistogram",{defaultMessage:"Date histogram"}),input:"field",priority:5,operationParams:[{name:"interval",type:"string",required:!1}],getErrorMessage:(e,t,a)=>[...Xl(e.columns[t],a)||[],ru(e,t)||""].filter(Boolean),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(("date"===a||"date_range"===a)&&t&&(!e||e.date_histogram))return{dataType:"date",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t)=>Kl(e.sourceField,t),buildColumn({field:e},t){var a,n;return{label:e.displayName,dataType:"date",operationType:"date_histogram",sourceField:e.name,isBucketed:!0,scale:"interval",params:{interval:null!==(a=null==t?void 0:t.interval)&&void 0!==a?a:su,includeEmptyRows:null===(n=null==t?void 0:t.includeEmptyRows)||void 0===n||n,dropPartials:Boolean(null==t?void 0:t.dropPartials)}}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"date"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.date_histogram))},onFieldChange:(e,t)=>({...e,label:t.displayName,sourceField:t.name}),toEsAggsFn:(e,t,a)=>{var n,i,s,l,r,o,u;const c=a.getFieldByName(e.sourceField);let d,p=null!==(n=null===(i=e.params)||void 0===i?void 0:i.interval)&&void 0!==n?n:su;const m=Boolean((null===(s=e.params)||void 0===s?void 0:s.dropPartials)&&(a.timeFieldName===(null==c?void 0:c.name)||!(null!==(l=e.params)&&void 0!==l&&l.ignoreTimeRange)));return c&&c.aggregationRestrictions&&c.aggregationRestrictions.date_histogram&&(p=cu(c.aggregationRestrictions),d=c.aggregationRestrictions.date_histogram.time_zone),Object(tt.buildExpressionFunction)("aggDateHistogram",{id:t,enabled:!0,schema:"segment",field:e.sourceField,time_zone:d,useNormalizedEsInterval:!(null!=c&&null!==(r=c.aggregationRestrictions)&&void 0!==r&&r.date_histogram),interval:p,drop_partials:m,min_doc_count:null!==(o=e.params)&&void 0!==o&&o.includeEmptyRows?0:1,extended_bounds:Object(js.extendedBoundsToAst)({}),extendToTimeRange:null===(u=e.params)||void 0===u?void 0:u.includeEmptyRows}).toAst()},paramEditor:function({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n,dateRange:i,data:r,indexPattern:o}){const d=a&&o.getFieldByName(a.sourceField),p=d.aggregationRestrictions&&d.aggregationRestrictions.date_histogram,[m,g]=Object(s.useState)(a.params.interval),f=m===su?su:uu(m),h=!a.params.ignoreTimeRange&&m===su||f!==su&&""!==m&&iu(`${""===f.value?"1":f.value}${f.unit}`,cu(d.aggregationRestrictions)),x=Object(s.useCallback)((e=>{const a=e.target.checked;n((e=>vr({layer:e,columnId:t,paramName:"dropPartials",value:a})))}),[t,n]),v=Object(s.useCallback)((e=>{const a=e!==su&&lu.has(e.unit),i=e===su?su:`${a?"1":e.value}${e.unit||"d"}`;n((e=>vr({layer:e,columnId:t,paramName:"interval",value:i})))}),[t,n]),y=(js.intervalOptions||[]).filter((e=>e.val!==su)).map((e=>({label:e.display,key:e.val})),[]);y.unshift({label:u.i18n.translate("xpack.lens.indexPattern.autoIntervalLabel",{defaultMessage:"Auto ({interval})",values:{interval:r.search.aggs.calculateAutoTimeExpression({from:i.fromDate,to:i.toDate})||"1h"}}),key:su});const O=y.find((e=>e.key===m)),I=O?[O]:[{label:m,key:m}];Object(s.useEffect)((()=>{h&&m!==a.params.interval&&v(uu(m))}),[m,h,a.params.interval,v]);const T=o.timeFieldName===(null==d?void 0:d.name)||!a.params.ignoreTimeRange;return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.includeEmptyRows",{defaultMessage:"Include empty rows"})),checked:Boolean(a.params.includeEmptyRows),"data-test-subj":"indexPattern-include-empty-rows",onChange:()=>{n(vr({layer:e,columnId:t,paramName:"includeEmptyRows",value:!a.params.includeEmptyRows}))},compressed:!0})),o.timeFieldName!==(null==d?void 0:d.name)&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.bindToGlobalTimePicker",{defaultMessage:"Bind to global time picker"})," ",Object(j.jsx)(b.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.globalTimePickerHelp",{defaultMessage:"Filter the selected field by the global time picker in the top right. This setting can't be turned off for the default time field of the current data view."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),disabled:o.timeFieldName===(null==d?void 0:d.name),checked:T,onChange:()=>{let s=vr({layer:e,columnId:t,paramName:"ignoreTimeRange",value:!a.params.ignoreTimeRange});if(!a.params.ignoreTimeRange&&a.params.interval===su){const e=r.search.aggs.calculateAutoTimeExpression({from:i.fromDate,to:i.toDate})||"1h";s=vr({layer:s,columnId:t,paramName:"interval",value:e}),g(e)}n(s)},compressed:!0}))),Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.minimumInterval",{defaultMessage:"Minimum interval"}),fullWidth:!0,display:"rowCompressed",helpText:Object(j.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectOptionHelpText",{defaultMessage:"Select an option or create a custom value."}),Object(j.jsx)("br",null),u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectOptionExamplesHelpText",{defaultMessage:"Examples: 30s, 20m, 24h, 2d, 1w, 1M"})),isInvalid:!h,error:!h&&u.i18n.translate("xpack.lens.indexPattern.dateHistogram.invalidInterval",{defaultMessage:"Please pick a valid interval. It's not possible to use multiple weeks, months or years as interval."})},p?Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.restrictedInterval",defaultMessage:"Interval fixed to {intervalValue} due to aggregation restrictions.",values:{intervalValue:cu(d.aggregationRestrictions)}}):Object(j.jsx)(b.EuiComboBox,{compressed:!0,fullWidth:!0,"data-test-subj":"lensDateHistogramInterval",isInvalid:!h,onChange:i=>{const s=i.length?i[0].key:"";g(s),s===su&&a.params.ignoreTimeRange&&n(vr({layer:e,columnId:t,paramName:"ignoreTimeRange",value:!1}))},onCreateOption:e=>g(e.trim()),options:y,selectedOptions:I,singleSelection:{asPlainText:!0},placeholder:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectIntervalPlaceholder",{defaultMessage:"Select an interval"})})),Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(j.jsx)(k.t,{tooltipContent:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBucketsHelp",{defaultMessage:"Drop partial intervals is disabled as these can be computed only for a time field bound to global time picker in the top right."}),condition:!T},Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBuckets",{defaultMessage:"Drop partial intervals"})),"data-test-subj":"lensDropPartialIntervals",checked:Boolean(a.params.dropPartials),onChange:x,compressed:!0,disabled:!T}))))},helpComponentTitle:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.titleHelp",{defaultMessage:"How Date histogram works"}),helpComponent(){const e=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.moreThanYear",{defaultMessage:"More than a year"}),t=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.upTo",{defaultMessage:"Up to"});return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBasicExplanation",{defaultMessage:"Date histogram splits data into time intervals."})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.autoLongerExplanation",defaultMessage:"To choose the interval, Lens divides the specified time range by the {targetBarSetting} Advanced Setting and calculates the best interval for your data. For example, when the time range is 4 days, the data is divided into hourly buckets. To configure the maximum number of bars, use the {maxBarSetting} Advanced Setting.",values:{maxBarSetting:Object(j.jsx)(b.EuiCode,null,Kn.UI_SETTINGS.HISTOGRAM_MAX_BARS),targetBarSetting:Object(j.jsx)(b.EuiCode,null,Kn.UI_SETTINGS.HISTOGRAM_BAR_TARGET)}})),Object(j.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoAdvancedExplanation",{defaultMessage:"The interval follows this logic:"})),Object(j.jsx)(b.EuiBasicTable,{items:Kn.search.aggs.boundsDescendingRaw.map((({bound:a,boundLabel:n,intervalLabel:i})=>({bound:"number"==typeof a?e:`${t} ${n}`,interval:i}))),columns:[{field:"bound",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBoundHeader",{defaultMessage:"Target interval measured"})},{field:"interval",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoIntervalHeader",{defaultMessage:"Interval used"})}]}))},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.documentation.quick",{defaultMessage:"\nThe date or date range values distributed into intervals.\n      "})};function uu(e){const t=e||"",a=t.match(/[\d]+/)||[],n=t.match(/[\D]+/)||[],i=parseInt(a[0]||"",10);return{value:isNaN(i)?"":i,unit:n[0]||"h"}}function cu(e){if(e&&e.date_histogram)return e.date_histogram.calendar_interval||e.date_histogram.fixed_interval}const du=e=>(t,a,n)=>Do(e(t),void 0,a,void 0,n,void 0,void 0);function pu(e,t){if(e===_.LayerTypes.REFERENCELINE)return[u.i18n.translate("xpack.lens.indexPattern.calculations.layerDataType",{defaultMessage:"{name} is disabled for this type of layer.",values:{name:t}})]}function mu(e,t){if(!e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>"date_histogram"===e.columns[t].operationType)))return[u.i18n.translate("xpack.lens.indexPattern.calculations.dateHistogramErrorMessage",{defaultMessage:"{name} requires a date histogram to work. Add a date histogram or select a different function.",values:{name:t}})]}const gu=xs()((e=>{const t=new Set;return Object.entries(e.columns).forEach((([a,n])=>{"references"in n&&"managedReference"===gc[n.operationType].input&&(t.add(a),Lr(a,e.columns).map((([e])=>{t.add(e)})))})),t}));function fu(e,t,a){var n,i;const s=null!==(n=mu(e,a))&&void 0!==n?n:[],l=null!==(i=function(e,t){const a=e.columns[t],n=[];return a.references.forEach(((i,s)=>{if(e.columns[i]){const l=e.columns[i],r=gc[a.operationType];if("fullReference"!==r.input)throw new Error("inconsistent state - column is not a reference operation");_r({validation:r.requiredReferences[s],column:l})||gu(e).has(t)||n.push(u.i18n.translate("xpack.lens.indexPattern.invalidReferenceConfiguration",{defaultMessage:'Dimension "{dimensionLabel}" is configured incorrectly',values:{dimensionLabel:a.label}}))}else n.push(u.i18n.translate("xpack.lens.indexPattern.missingReferenceError",{defaultMessage:'"{dimensionLabel}" is not fully configured',values:{dimensionLabel:a.label}}))})),n.length?n:void 0}(e,t))&&void 0!==i?i:[];if(s.length||l.length)return[...s,...l]}function bu(e){return e.fields.some((e=>"date"===e.type))}function hu(e,t,a,n={}){const i=e.columns[t],s=e.columnOrder.filter((t=>e.columns[t].isBucketed)),l=s.findIndex((t=>"date_histogram"===e.columns[t].operationType));return s.splice(l,1),[{type:"function",function:a,arguments:{by:s,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}const xu=du((e=>u.i18n.translate("xpack.lens.indexPattern.CounterRateOf",{defaultMessage:"Counter rate of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),vu={type:"counter_rate",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["max"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(bu(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=a[e.references[0]];return xu(i&&"sourceField"in i?null===(n=t.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,e.timeScale,e.timeShift)},toExpression:(e,t)=>hu(e,t,"lens_counter_rate"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var s;const l=a.columns[e[0]],r=i,o=(null==t?void 0:t.timeScale)||(null==r?void 0:r.timeScale)||"s";return{label:xu(l&&"sourceField"in l?null===(s=n.getFieldByName(l.sourceField))||void 0===s?void 0:s.displayName:void 0,o,null==t?void 0:t.timeShift),dataType:"number",operationType:"counter_rate",isBucketed:!1,scale:"ratio",references:e,timeScale:o,timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:ar(t,i),params:tr(t)}},isTransferable:(e,t)=>bu(t),getErrorMessage:(e,t)=>Yl([fu(e,t,u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"})),hl(e,t)]),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"});if(a){const e=pu(a,i);if(e)return e.join(", ")}return null===(n=mu(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"mandatory",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.counterRate.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.counterRate.documentation.markdown",{defaultMessage:"\nCalculates the rate of an ever increasing counter. This function will only yield helpful results on counter metric fields which contain a measurement of some kind monotonically growing over time.\nIf the value does get smaller, it will interpret this as a counter reset. To get most precise results, `counter_rate` should be calculated on the `max` of a field.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\nIt uses the current interval when used in Formula.\n\nExample: Visualize the rate of bytes received over time by a memcached server:\n`counter_rate(max(memcached.stats.read.bytes))`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.counterRate.documentation.quick",{defaultMessage:"\n      The rate of change over time for an ever growing time series metric.\n      "}),shiftable:!0},yu=du((e=>u.i18n.translate("xpack.lens.indexPattern.cumulativeSumOf",{defaultMessage:"Cumulative sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),ju={type:"cumulative_sum",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["count","sum"],validateMetadata:(e,t,a)=>!("number"!==e.dataType||e.isBucketed||"count"===t&&a!==at.c)}],getPossibleOperation:e=>{if(bu(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=a[e.references[0]];return yu(i&&"sourceField"in i?null===(n=t.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,void 0,e.timeShift)},toExpression:(e,t)=>hu(e,t,"cumulative_sum"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var s;const l=a.columns[e[0]];return{label:yu(l&&"sourceField"in l?null===(s=n.getFieldByName(l.sourceField))||void 0===s?void 0:s.displayName:void 0,void 0,null==t?void 0:t.timeShift),dataType:"number",operationType:"cumulative_sum",isBucketed:!1,scale:"ratio",timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:ar(t,i),references:e,params:tr(t)}},isTransferable:()=>!0,getErrorMessage:(e,t)=>Yl([fu(e,t,u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"})),hl(e,t)]),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"});if(a){const e=pu(a,i);if(e)return e.join(", ")}return null===(n=mu(t,i))||void 0===n?void 0:n.join(", ")},filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.cumulative_sum.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum.documentation.markdown",{defaultMessage:"\nCalculates the cumulative sum of a metric over time, adding all previous values of a series to each value. To use this function, you need to configure a date histogram dimension as well.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the received bytes accumulated over time:\n`cumulative_sum(sum(bytes))`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum.documentation.quick",{defaultMessage:"\n      The sum of all values as they grow over time.\n      "}),shiftable:!0},Ou="differences",ku=du((e=>u.i18n.translate("xpack.lens.indexPattern.derivativeOf",{defaultMessage:"Differences of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Iu={type:Ou,priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(bu(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return ku(null===(n=a[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>hu(e,t,"derivative"),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const s=a.columns[e[0]],l=null!==(i=null==n?void 0:n.timeScale)&&void 0!==i?i:null==t?void 0:t.timeScale;return{label:ku(null==s?void 0:s.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:Ou,isBucketed:!1,scale:"ratio",references:e,timeScale:l,filter:ar(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:tr(t)}},isTransferable:(e,t)=>bu(t),getErrorMessage:(e,t)=>Yl([fu(e,t,u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"})),hl(e,t)]),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"});if(a){const e=pu(a,i);if(e)return e.join(", ")}return null===(n=mu(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.differences.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.differences.documentation.markdown",{defaultMessage:"\nCalculates the difference to the last value of a metric over time. To use this function, you need to configure a date histogram dimension as well.\nDifferences requires the data to be sequential. If your data is empty when using differences, try increasing the date histogram interval.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the change in bytes received over time:\n`differences(sum(bytes))`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.differences.documentation.quick",{defaultMessage:"\n      The change between the values in subsequent intervals.\n      "}),shiftable:!0},Tu=du((e=>u.i18n.translate("xpack.lens.indexPattern.movingAverageOf",{defaultMessage:"Moving average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),wu={type:"moving_average",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"window",type:"number",required:!1,defaultValue:5}],getPossibleOperation:e=>{if(bu(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return Tu(null===(n=a[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>hu(e,t,"moving_average",{window:[e.columns[t].params.window]}),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const s=a.columns[e[0]],l=null!==(i=null==n?void 0:n.window)&&void 0!==i?i:5;return{label:Tu(null==s?void 0:s.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:"moving_average",isBucketed:!1,scale:"ratio",references:e,timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),filter:ar(t,n),timeScale:null==t?void 0:t.timeScale,params:{window:l,...tr(t)}}},paramEditor:function({layer:e,paramEditorUpdater:t,currentColumn:a,columnId:n}){const[i,l]=Object(s.useState)(String(a.params.window));return Object(k.E)((()=>{if(!Ql(i,!0,void 0,1))return;const a=parseInt(i,10);t(vr({layer:e,columnId:n,paramName:"window",value:a}))}),{skipFirstRender:!0},256,[i]),Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.movingAverage.window",{defaultMessage:"Window size"}),display:"rowCompressed",fullWidth:!0,isInvalid:!Ql(i)},Object(j.jsx)(b.EuiFieldNumber,{fullWidth:!0,compressed:!0,value:i,onChange:e=>l(e.target.value),min:1,step:1,isInvalid:!Ql(i)}))},isTransferable:(e,t)=>bu(t),getErrorMessage:(e,t)=>Yl([fu(e,t,u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"})),hl(e,t)]),helpComponent:()=>Object(j.jsx)(Mu,null),helpComponentTitle:u.i18n.translate("xpack.lens.indexPattern.movingAverage.titleHelp",{defaultMessage:"How moving average works"}),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"});if(a){const e=pu(a,i);if(e)return e.join(", ")}return null===(n=mu(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.moving_average.signature",{defaultMessage:"metric: number, [window]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.movingAverage.documentation.markdown",{defaultMessage:"\nCalculates the moving average of a metric over time, averaging the last n-th values to calculate the current value. To use this function, you need to configure a date histogram dimension as well.\nThe default window value is {defaultValue}.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nTakes a named parameter `window` which specifies how many last values to include in the average calculation for the current value.\n\nExample: Smooth a line of measurements:\n`moving_average(sum(bytes), window=5)`\n      ",values:{defaultValue:5}})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.movingAverage.documentation.quick",{defaultMessage:"\n      The average of a moving window of values over time.\n      "}),shiftable:!0},Mu=()=>Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.basicExplanation",defaultMessage:"Moving average slides a window across the data and displays the average value. Moving average is supported only by date histograms."})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.longerExplanation",defaultMessage:"To calculate the moving average, Lens uses the mean of the window and applies a skip policy for gaps.  For missing values, the bucket is skipped, and the calculation is performed on the next value."})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.tableExplanation",defaultMessage:"For example, given the data [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], you can calculate a simple moving average with a window size of 5:"})),Object(j.jsx)("ul",null,Object(j.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3"),Object(j.jsx)("li",null,"(2 + 3 + 4 + 5 + 6) / 5 = 4"),Object(j.jsx)("li",null,"..."),Object(j.jsx)("li",null,"(5 + 6 + 7 + 8 + 9) / 5 = 7")),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowLimitations",defaultMessage:"The window does not include the current value."})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowInitialPartial",defaultMessage:"The window is partial until it reaches the requested number of items.  For example, with a window size of 5:"})),Object(j.jsx)("ul",null,Object(j.jsx)("li",null,"(1 + 2) / 2 = 1.5"),Object(j.jsx)("li",null,"(1 + 2 + 3) / 3 = 2"),Object(j.jsx)("li",null,"(1 + 2 + 3 + 4) / 4 = 2.5"),Object(j.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3")),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.limitations",defaultMessage:"The first moving average value starts at the second item."})));function Cu({type:e,displayName:t,ofName:a,description:n,metric:i}){return{type:e,priority:1,displayName:t,input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,n)=>{var i;const s=n[e.references[0]];return a(s&&"sourceField"in s?null===(i=t.getFieldByName(s.sourceField))||void 0===i?void 0:i.displayName:void 0)},toExpression:(e,t)=>function(e,t,a,n={}){const i=e.columns[t],s=e.columnOrder.filter((t=>e.columns[t].isBucketed)),l=s.filter((t=>"date_histogram"!==e.columns[t].operationType&&"range"!==e.columns[t].operationType));return[{type:"function",function:a,arguments:{by:l.length===s.length?[]:l,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}(e,t,"overall_metric",{metric:[i]}),buildColumn:({referenceIds:e,previousColumn:t,layer:n,indexPattern:s},l)=>{var r;const o=n.columns[e[0]];return{label:a(o&&"sourceField"in o?null===(r=s.getFieldByName(o.sourceField))||void 0===r?void 0:r.displayName:void 0),dataType:"number",operationType:`overall_${i}`,isBucketed:!1,scale:"ratio",references:e,params:tr(t)}},isTransferable:()=>!0,filterable:!1,shiftable:!1,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.overall_metric",{defaultMessage:"metric: number"}),description:n}}}const Su=Cu({type:"overall_sum",displayName:u.i18n.translate("xpack.lens.indexPattern.overallSum",{defaultMessage:"Overall sum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallSumOf",{defaultMessage:"Overall sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"sum",description:u.i18n.translate("xpack.lens.indexPattern.overall_sum.documentation.markdown",{defaultMessage:"\nCalculates the sum of a metric of all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_sum` is calculating the sum over all dimensions no matter the used function.\n\nExample: Percentage of total\n`sum(bytes) / overall_sum(sum(bytes))`\n      "})}),Fu=Cu({type:"overall_min",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMin",{defaultMessage:"Overall min"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMinOf",{defaultMessage:"Overall min of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"min",description:u.i18n.translate("xpack.lens.indexPattern.overall_min.documentation.markdown",{defaultMessage:"\nCalculates the minimum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_min` is calculating the minimum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes)) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),Eu=Cu({type:"overall_max",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMaxOf",{defaultMessage:"Overall max of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"max",description:u.i18n.translate("xpack.lens.indexPattern.overall_max.documentation.markdown",{defaultMessage:"\nCalculates the maximum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_max` is calculating the maximum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes))) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),Pu=Cu({type:"overall_average",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallAverageOf",{defaultMessage:"Overall average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"average",description:u.i18n.translate("xpack.lens.indexPattern.overall_average.documentation.markdown",{defaultMessage:"\nCalculates the average of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_average` is calculating the average over all dimensions no matter the used function\n\nExample: Divergence from the mean:\n`sum(bytes) - overall_average(sum(bytes))`\n      "})}),Au={type:"normalize_by_unit",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.timeScale",{defaultMessage:"Normalize by unit"}),input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"unit",type:"string",required:!0}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,a)=>"normalize_by_unit",toExpression:(e,t)=>{const a=e.columns[t],n=e.columnOrder.filter((t=>e.columns[t].isBucketed)).find((t=>"date_histogram"===e.columns[t].operationType));return[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:n?[n]:[],inputColumnId:[a.references[0]],outputColumnId:[t],outputColumnName:[a.label],targetUnit:[a.params.unit],reducedTimeRange:a.reducedTimeRange?[a.reducedTimeRange]:[]}}]},buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>({label:"Normalize by unit",dataType:"number",operationType:"normalize_by_unit",isBucketed:!1,scale:"ratio",references:e,params:{...tr(t),unit:null==i?void 0:i.unit}}),isTransferable:()=>!0,getErrorMessage:(e,t)=>Yl([fu(e,t,u.i18n.translate("xpack.lens.indexPattern.timeScale",{defaultMessage:"Normalize by unit"})),hl(e,t),e.columns[t].params.unit?[]:[u.i18n.translate("xpack.lens.indexPattern.timeScale.missingUnit",{defaultMessage:"No unit specified for normalize by unit."})],-1===["s","m","h","d"].indexOf(e.columns[t].params.unit||"s")?[u.i18n.translate("xpack.lens.indexPattern.timeScale.wrongUnit",{defaultMessage:"Unknown unit specified, use s,m,h or d."})]:[]]),filterable:!1,shiftable:!1,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.time_scale",{defaultMessage:"metric: number, unit: s|m|h|d|w|M|y"}),description:u.i18n.translate("xpack.lens.indexPattern.time_scale.documentation.markdown",{defaultMessage:"\n\nThis advanced function is useful for normalizing counts and sums to a specific time interval. It allows for integration with metrics that are stored already normalized to a specific time interval.\n\nThis function can only be used if there's a date histogram function used in the current chart.\n\nExample: A ratio comparing an already normalized metric to another metric that needs to be normalized.\n`normalize_by_unit(counter_rate(max(system.diskio.write.bytes)), unit='s') / last_value(apache.status.bytes_per_second)`\n      "})}},_u=u.i18n.translate("xpack.lens.indexPattern.countOf",{defaultMessage:"Count of records"}),Lu=new Set(["string","boolean","number","number_range","ip","ip_range","date","date_range","murmur3"]);function Du(e,t,a,n){return null!=e&&e.customLabel&&"document"!==(null==e?void 0:e.type)?e.customLabel:Do("document"!==(null==e?void 0:e.type)?u.i18n.translate("xpack.lens.indexPattern.valueCountOf",{defaultMessage:"Count of {name}",values:{name:(null==e?void 0:e.displayName)||"-"}}):_u,void 0,a,void 0,t,void 0,n)}const Nu={type:"count",displayName:u.i18n.translate("xpack.lens.indexPattern.count",{defaultMessage:"Count"}),input:"field",getErrorMessage:(e,t,a)=>Yl([Xl(e.columns[t],a),hl(e,t),jl(e,t,a)]),allowAsReference:!0,onFieldChange:(e,t)=>({...e,label:Du(t,e.timeShift,e.timeShift,e.reducedTimeRange),sourceField:t.name}),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if("document"===a||t&&(!e||e.value_count)&&Lu.has(a))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t)=>Du(t.getFieldByName(e.sourceField),e.timeShift,e.timeScale,e.reducedTimeRange),buildColumn({field:e,previousColumn:t},a){var n;return{label:Du(e,null==t?void 0:t.timeShift,null==t?void 0:t.timeScale,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:"count",isBucketed:!1,scale:"ratio",sourceField:e.name,timeScale:null==t?void 0:t.timeScale,filter:ar(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==a?void 0:a.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{...tr(t),emptyAsNull:t&&Zl("count",t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n})=>{var i;return[{dataTestSubj:"hide-zero-values",inlineElement:Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"})),labelProps:{style:{fontWeight:Q.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(vr({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})}]},toEsAggsFn:(e,t,a)=>{const n=a.getFieldByName(e.sourceField);var i,s;return"document"===(null==n?void 0:n.type)?Object(tt.buildExpressionFunction)("aggCount",{id:t,enabled:!0,schema:"metric",timeShift:e.filter||e.reducedTimeRange?void 0:e.timeShift,emptyAsNull:null===(i=e.params)||void 0===i?void 0:i.emptyAsNull}).toAst():Object(tt.buildExpressionFunction)("aggValueCount",{id:t,enabled:!0,schema:"metric",field:e.sourceField,timeShift:e.filter||e.reducedTimeRange?void 0:e.timeShift,emptyAsNull:null===(s=e.params)||void 0===s?void 0:s.emptyAsNull}).toAst()},getGroupByKey:e=>No(e,["aggCount","aggValueCount"],[{name:"field"},{name:"emptyAsNull",transformer:e=>String(Boolean(e))}]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&("document"===a.type||Lu.has(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.cardinality)))},timeScalingMode:"optional",filterable:!0,canReduceTimeRange:!0,documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.count.signature",{defaultMessage:"[field: string]"}),description:u.i18n.translate("xpack.lens.indexPattern.count.documentation.markdown",{defaultMessage:"\nThe total number of documents. When you provide a field, the total number of field values is counted. When you use the Count function for fields that have multiple values in a single document, all values are counted.\n\n#### Examples\n\nTo calculate the total number of documents, use `count()`.\n\nTo calculate the number of products in all orders, use `count(products.id)`.\n\nTo calculate the number of documents that match a specific filter, use `count(kql='price > 500')`.\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.count.documentation.quick",{defaultMessage:"\nThe total number of documents. When you provide a field, the total number of field values is counted. When you use the Count function for fields that have multiple values in a single document, all values are counted.\n      "}),shiftable:!0},Ru=u.i18n.translate("xpack.lens.indexPattern.staticValueLabelDefault",{defaultMessage:"Static value"});function Bu(e){return function(e){return null==e||""===e}(e)?Ru:u.i18n.translate("xpack.lens.indexPattern.staticValueLabelWithValue",{defaultMessage:"Static value: {value}",values:{value:e}})}const Vu={type:"static_value",displayName:Ru,getDefaultLabel:e=>Bu(e.params.value),input:"managedReference",hidden:!0,getDisabledStatus(e){},getErrorMessage(e,t){const a=e.columns[t];return null==a.params.value||Ql(a.params.value)?void 0:[u.i18n.translate("xpack.lens.indexPattern.staticValueError",{defaultMessage:"The static value of {value} is not a valid number",values:{value:a.params.value}})]},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio",isStaticValue:!0}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,s=n.label!==Ru,l=Ql(i.value)?s?n.label:null!==(a=null==i?void 0:i.value)&&void 0!==a?a:Ru:Ru;return[{type:"function",function:Ql(i.value)?"mathColumn":"mapColumn",arguments:{id:[t],name:[l||Ru],expression:[String(Ql(i.value)?i.value:100)]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){var s,l;const r={value:e&&(l=e,Boolean("params"in l&&l.params&&"value"in l.params))&&Ql(e.params.value)?e.params.value:void 0,...tr(e),...n};return{label:Bu(r.value),dataType:"number",operationType:"static_value",isStaticValue:!0,isBucketed:!1,scale:"ratio",params:{...r,value:String(null!==(s=r.value)&&void 0!==s?s:100)},references:[]}},isTransferable:e=>!0,createCopy(e,t,a){const n=e[t.layerId].columns[t.columnId],i=e[a.layerId],s={...i.columns,[a.columnId]:{...n}};return{...e,[a.layerId]:{...i,columns:s,columnOrder:kr({...i,columns:s})}}},paramEditor:function({paramEditorUpdater:e,currentColumn:t,columnId:a,activeData:n,layerId:i,paramEditorCustomProps:l}){var r,o,u,c,d;const p=Object(s.useCallback)((n=>{t.params.value!==n&&e((e=>{const t=e.columns[a];return{...e,columns:{...e.columns,[a]:{...t,label:null!=t&&t.customLabel?t.label:Bu(n),params:{...t.params,value:n}}}}}))}),[a,e,null==t||null===(r=t.params)||void 0===r?void 0:r.value]),m=1===(null==n||null===(o=n[i])||void 0===o||null===(u=o.rows)||void 0===u?void 0:u.length)&&n[i].rows[0][a],g="static_value"!==(null==t?void 0:t.operationType)&&null!=m?m:String(100),{inputValue:f,handleInputChange:h}=Object(k.F)({value:(null==t||null===(c=t.params)||void 0===c?void 0:c.value)||g,onChange:p},{allowFalsyValue:!0}),x=Object(s.useCallback)((e=>{const t=e.currentTarget.value;h(Ql(t)?t:void 0)}),[h]);return Object(j.jsx)(b.EuiFormRow,{label:(null==l||null===(d=l.labels)||void 0===d?void 0:d[0])||Ru,fullWidth:!0},Object(j.jsx)(b.EuiFieldNumber,{fullWidth:!0,"data-test-subj":"lns-indexPattern-static_value-input",compressed:!0,value:null!=f?f:"",onChange:x,step:"any"}))}};function zu(e,t,a){return Do(u.i18n.translate("xpack.lens.indexPattern.lastValueOf",{defaultMessage:"Last value of {name}",values:{name:e}}),void 0,void 0,void 0,t,void 0,a)}const Gu=new Set(["string","boolean","number","ip","date","ip_range","number_range","date_range"]);function qu(e,t){if(!t)return;const a=t.getFieldByName(e);return a?"date"!==a.type?u.i18n.translate("xpack.lens.indexPattern.lastValue.invalidTypeSortField",{defaultMessage:"Field {invalidField} is not a date field and cannot be used for sorting",values:{invalidField:e}}):void 0:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldNotFound",{defaultMessage:"Field {invalidField} was not found",values:{invalidField:e}})}function Hu(e){return e.timeFieldName&&e.fields.find((t=>t.name===e.timeFieldName&&"date"===t.type))}function $u(e){const t=e.fields.filter((e=>"date"===e.type));return Hu(e)&&t.sort((({name:t},{name:a})=>t===e.timeFieldName?-1:a===e.timeFieldName?1:0)),t}function Wu(e){return{query:`${e}: *`,language:"kuery"}}function Uu(e){return"string"===e||"ip"===e||"ip_range"===e||"date_range"===e||"number_range"===e?"ordinal":"ratio"}const Xu={type:"last_value",displayName:u.i18n.translate("xpack.lens.indexPattern.lastValue",{defaultMessage:"Last value"}),getDefaultLabel:(e,t)=>zu(Kl(e.sourceField,t),e.timeShift,e.reducedTimeRange),input:"field",onFieldChange:(e,t)=>{const a={...e.params};return a.showArrayValues=uo(t)||e.params.showArrayValues,"format"in a&&"number"!==t.type&&delete a.format,{...e,dataType:t.type,label:zu(t.displayName,e.timeShift,e.reducedTimeRange),sourceField:t.name,params:a,scale:Uu(t.type),filter:e.filter&&Object(jt.isEqual)(e.filter,Wu(e.sourceField))?Wu(t.name):e.filter}},getPossibleOperationForField:({aggregationRestrictions:e,type:t})=>{if(Gu.has(t)&&!e)return{dataType:t,isBucketed:!1,scale:Uu(t)}},getDisabledStatus(e){if(!e||!$u(e).length)return u.i18n.translate("xpack.lens.indexPattern.lastValue.disabled",{defaultMessage:"This function requires the presence of a date field in your data view"})},getErrorMessage(e,t,a){const n=e.columns[t];let i=[];const s=Xl(n,a),l=qu(n.params.sortField,a);return s&&(i=[...s]),l&&(i=[l]),i.push(...hl(e,t)||[]),i.push(...jl(e,t,a)||[]),i.length?i:void 0},buildColumn({field:e,previousColumn:t,indexPattern:a},n){var i;const s=n,l=Hu(a)?a.timeFieldName:null===(i=a.fields.find((e=>"date"===e.type)))||void 0===i?void 0:i.name;if(!l)throw new Error(u.i18n.translate("xpack.lens.functions.lastValue.missingSortField",{defaultMessage:"This data view does not contain any date fields"}));const r=uo(e)||(null==s?void 0:s.showArrayValues);return{label:zu(e.displayName,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:e.type,operationType:"last_value",isBucketed:!1,scale:Uu(e.type),sourceField:e.name,filter:ar(t,n)||Wu(e.name),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{showArrayValues:r,sortField:(null==s?void 0:s.sortField)||l,...tr(t)}}},filterable:!0,canReduceTimeRange:!0,shiftable:!0,toEsAggsFn:(e,t,a)=>{const n={id:t,enabled:!0,schema:"metric",field:e.sourceField,size:1,sortOrder:"desc",sortField:e.params.sortField,timeShift:e.filter?void 0:e.timeShift};return(e.params.showArrayValues?Object(tt.buildExpressionFunction)("aggTopHit",{...n,aggregate:"concat"}):Object(tt.buildExpressionFunction)("aggTopMetrics",n)).toAst()},getGroupByKey:e=>No(e,["aggTopHit","aggTopMetrics"],[{name:"field"},{name:"sortField"}]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField),n=t.getFieldByName(e.params.sortField);return Boolean(a&&a.type===e.dataType&&!a.aggregationRestrictions&&"date"===(null==n?void 0:n.type)&&Gu.has(a.type))},allowAsReference:!0,paramEditor:({layer:e,paramEditorUpdater:t,currentColumn:a,indexPattern:n,isReferenced:i,paramEditorCustomProps:s})=>{var r,o;const{labels:c,isInline:d}=s||{},p=(null==c?void 0:c[0])||u.i18n.translate("xpack.lens.indexPattern.lastValue.sortField",{defaultMessage:"Sort by date field"}),m=$u(n),g=!!qu(a.params.sortField,n),f=Object.keys(e.columns).some((t=>"terms"===e.columns[t].operationType));return Object(j.jsx)(l.a.Fragment,null,!i&&Object(j.jsx)(b.EuiFormRow,{error:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesWithTopValuesWarning",{defaultMessage:"When you show array values, you are unable to use this field to rank top values."}),isInvalid:a.params.showArrayValues&&f,display:"rowCompressed",fullWidth:!0,"data-test-subj":"lns-indexPattern-lastValue-showArrayValues"},Object(j.jsx)(b.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesExplanation",{defaultMessage:"Displays all values associated with this field in each last document."}),position:"left"},Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValues",{defaultMessage:"Show array values"})),compressed:!0,checked:Boolean(a.params.showArrayValues),disabled:uo(a.sourceField,n),onChange:()=>{return e=!a.params.showArrayValues,t({...a,params:{...a.params,showArrayValues:e}});var e}}))),Object(j.jsx)(Wr,{isInline:d,label:p,display:"rowCompressed",fullWidth:!0,error:u.i18n.translate("xpack.lens.indexPattern.sortField.invalid",{defaultMessage:"Invalid field. Check your data view or pick another field."}),isInvalid:g},Object(j.jsx)(b.EuiComboBox,{placeholder:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldPlaceholder",{defaultMessage:"Sort field"}),fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"lns-indexPattern-lastValue-sortField",isInvalid:g,singleSelection:{asPlainText:!0},"aria-label":p,options:null==m?void 0:m.map((e=>({value:e.name,label:e.displayName}))),onChange:e=>{if(0!==e.length)return t({...a,params:{...a.params,sortField:e[0].value}})},selectedOptions:null!==(r=a.params)&&void 0!==r&&r.sortField?[{label:(null===(o=n.getFieldByName(a.params.sortField))||void 0===o?void 0:o.displayName)||a.params.sortField,value:a.params.sortField}]:[]})))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.lastValue.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.lastValue.documentation.markdown",{defaultMessage:"\nReturns the value of a field from the last document, ordered by the default time field of the data view.\n\nThis function is usefull the retrieve the latest state of an entity.\n\nExample: Get the current status of server A:\n`last_value(server.status, kql='server.name=\"A\"')`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.lastValue.documentation.quick",{defaultMessage:"\nThe value of a field from the last document, ordered by the default time field of the data view.\n      "})};a(333);const Yu="auto",Ku="range",Qu="histogram",Zu=Object(b.htmlIdGenerator)(),Ju=(e,t)=>e.label||t.convert({gte:Ql(e.from)?e.from:-1/0,lt:Ql(e.to)?e.to:1/0}),ec=({range:e,setRange:t,button:a,triggerClose:n,isOpen:i})=>{const[r,o]=Object(s.useState)(e),c=l.a.useRef(),d=l.a.useRef(),p=(a,n=!1)=>{n&&o(e),t(a)},{from:m,to:g,label:f}=r,h=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualAppend",{defaultMessage:"≤"}),x=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualTooltip",{defaultMessage:"Less than or equal to"}),v=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanPrepend",{defaultMessage:"<"}),y=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanTooltip",{defaultMessage:"Less than"});return Object(j.jsx)(b.EuiPopover,{display:"block",ownFocus:!0,isOpen:i,closePopover:()=>n(),button:a,"data-test-subj":"indexPattern-ranges-popover"},Object(j.jsx)(b.EuiFormRow,null,Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"s",responsive:!1,alignItems:"center"},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:Ql(m)?Number(m):"",onChange:({target:e})=>{const t={...r,from:""!==e.value?Number(e.value):-1/0};o(t),p(t)},append:Object(j.jsx)(b.EuiToolTip,{content:x},Object(j.jsx)(b.EuiText,{size:"s"},h)),onKeyDown:({key:e})=>{b.keys.ENTER===e&&d.current&&d.current.focus()},compressed:!0,placeholder:"−∞",isInvalid:!cc(r),step:1})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiIcon,{type:"sortRight",color:"subdued"})),Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:Ql(g)?Number(g):"",inputRef:e=>{d&&e&&(d.current=e)},onChange:({target:e})=>{const t={...r,to:""!==e.value?Number(e.value):1/0};o(t),p(t)},prepend:Object(j.jsx)(b.EuiToolTip,{content:y},Object(j.jsx)(b.EuiText,{size:"s"},v)),compressed:!0,placeholder:"+∞",isInvalid:!cc(r),onKeyDown:({key:e})=>{b.keys.ENTER===e&&c.current&&c.current.focus()},step:1})))),Object(j.jsx)(b.EuiFormRow,null,Object(j.jsx)($r,{inputRef:c,value:f||"",onChange:e=>{const t={...r,label:e};o(t),p(t)},placeholder:u.i18n.translate("xpack.lens.indexPattern.ranges.customRangeLabelPlaceholder",{defaultMessage:"Custom label"}),onSubmit:()=>{n()},compressed:!0,dataTestSubj:"indexPattern-ranges-label"})))},tc=({ranges:e,setRanges:t,onToggleEditor:a,formatter:n})=>{const[i,r]=Object(s.useState)(""),[o,c]=Object(s.useState)((()=>e.map((e=>({...e,id:Zu()})))));Object(k.E)((()=>{t(o.map((({id:e,...t})=>({...t}))))}),{skipFirstRender:!0},256,[o]);const d=Object(s.useCallback)((()=>{const e=Zu();c([...o,{id:e,from:o[o.length-1].to,to:Number.POSITIVE_INFINITY,label:""}]),r(e)}),[o]),p=e=>{let t=e;i===e&&(t=""),r(t)};return Object(j.jsx)(b.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.indexPattern.ranges.customRanges",{defaultMessage:"Ranges"}),labelAppend:Object(j.jsx)(b.EuiText,{size:"xs"},Object(j.jsx)(b.EuiLink,{color:"danger",onClick:a},Object(j.jsx)(b.EuiIcon,{size:"s",type:"cross",color:"danger"})," ",u.i18n.translate("xpack.lens.indexPattern.ranges.customRangesRemoval",{defaultMessage:"Remove custom ranges"})))},Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(k.e,{onDragEnd:c,droppableId:"RANGES_DROPPABLE_AREA",items:o},o.map(((e,t,a)=>Object(j.jsx)(k.f,{key:e.id,idx:t,id:e.id,isInvalid:!cc(e),invalidMessage:u.i18n.translate("xpack.lens.indexPattern.range.isInvalid",{defaultMessage:"This range is invalid"}),onRemoveClick:()=>{const e=a.filter(((e,a)=>a!==t));c(e)},removeTitle:u.i18n.translate("xpack.lens.indexPattern.ranges.deleteRange",{defaultMessage:"Delete range"}),isNotRemovable:1===a.length,isNotDraggable:a.length<2},Object(j.jsx)(ec,{range:e,isOpen:e.id===i,triggerClose:()=>p(""),setRange:e=>{const n=[...a];e.id===n[t].id?n[t]=e:n.push(e),c(n)},button:Object(j.jsx)(b.EuiLink,{color:"text",onClick:()=>p(e.id),className:"lnsRangesOperation__popoverButton","data-test-subj":"indexPattern-ranges-popover-trigger"},Object(j.jsx)(b.EuiText,{size:"s",textAlign:"left",color:cc(e)?"default":"danger"},Ju(e,n)))}))))),Object(j.jsx)(k.m,{onClick:d,label:u.i18n.translate("xpack.lens.indexPattern.ranges.addRange",{defaultMessage:"Add range"})})))};a(338);const ac=({children:e,onClick:t})=>Object(j.jsx)(b.EuiText,{size:"xs"},Object(j.jsx)(b.EuiLink,{onClick:t},Object(j.jsx)(b.EuiIcon,{className:"lnsHelpPopover__buttonIcon",size:"s",type:"help"}),e)),nc=({anchorPosition:e,button:t,children:a,closePopover:n,isOpen:i,title:s})=>Object(j.jsx)(b.EuiPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:n,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},s&&Object(j.jsx)(b.EuiPopoverTitle,{paddingSize:"m"},s),Object(j.jsx)(b.EuiText,{className:"lnsHelpPopover__content",size:"s"},a)),ic=({anchorPosition:e,button:t,children:a,closePopover:n,isOpen:i,title:s})=>Object(j.jsx)(b.EuiWrappingPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:n,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},s&&Object(j.jsx)(b.EuiPopoverTitle,{paddingSize:"m"},s),Object(j.jsx)(b.EuiText,{className:"lnsHelpPopover__content",size:"s"},a)),sc=()=>{const[e,t]=Object(s.useState)(!1);return Object(j.jsx)(nc,{anchorPosition:"upCenter",button:Object(j.jsx)(ac,{onClick:()=>{t(!e)}},u.i18n.translate("xpack.lens.indexPattern.ranges.granularityHelpText",{defaultMessage:"How it works"})),closePopover:()=>t(!1),isOpen:e,title:u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverTitle",{defaultMessage:"How granularity interval works"})},Object(j.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverBasicExplanation",{defaultMessage:"Interval granularity divides the field into evenly spaced intervals based on the minimum and maximum values for the field."})),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.ranges.granularityPopoverExplanation",defaultMessage:'The size of the interval is a "nice" value. When the granularity of the slider changes, the interval stays the same when the “nice” interval is the same. The minimum granularity is 1, and the maximum value is {setting}. To change the maximum granularity, go to Advanced settings.',values:{setting:Object(j.jsx)(b.EuiCode,null,Kn.UI_SETTINGS.HISTOGRAM_MAX_BARS)}})),Object(j.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverAdvancedExplanation",{defaultMessage:"Intervals are incremented by 10, 5 or 2. For example, an interval can be 100 or 0.2 ."})))},lc=({maxBars:e,step:t,maxHistogramBars:a,onToggleEditor:n,onMaxBarsChange:i,includeEmptyRows:r,onChangeIncludeEmptyRows:o})=>{const[c,d]=Object(s.useState)(String(e));Object(k.E)((()=>{i(Number(c))}),{skipFirstRender:!0},256,[c]);const p=u.i18n.translate("xpack.lens.indexPattern.ranges.granularity",{defaultMessage:"Intervals granularity"}),m=u.i18n.translate("xpack.lens.indexPattern.ranges.decreaseButtonLabel",{defaultMessage:"Decrease granularity"}),g=u.i18n.translate("xpack.lens.indexPattern.ranges.increaseButtonLabel",{defaultMessage:"Increase granularity"});return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.ranges.includeEmptyRows",{defaultMessage:"Include empty rows"})),checked:Boolean(r),onChange:()=>{o(!r)},compressed:!0})),Object(j.jsx)(b.EuiFormRow,{label:p,"data-test-subj":"indexPattern-ranges-section-label",labelType:"legend",fullWidth:!0,display:"rowCompressed",labelAppend:Object(j.jsx)(sc,null)},Object(j.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiToolTip,{content:m,delay:"long"},Object(j.jsx)(b.EuiButtonIcon,{iconType:"minusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-minus",onClick:()=>d(""+Math.max(Number(c)-t,1)),"aria-label":m}))),Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiRange,{compressed:!0,fullWidth:!0,"aria-label":p,"data-test-subj":"lns-indexPattern-range-maxBars-field",min:1,max:a,step:t,value:c,onChange:({currentTarget:e})=>d(e.value)})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiToolTip,{content:g,delay:"long"},Object(j.jsx)(b.EuiButtonIcon,{iconType:"plusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-plus",onClick:()=>d(""+Math.min(Number(c)+t,a)),"aria-label":g}))))),Object(j.jsx)(b.EuiButtonEmpty,{size:"xs",iconType:"controlsHorizontal",onClick:()=>n()},u.i18n.translate("xpack.lens.indexPattern.ranges.customIntervalsToggle",{defaultMessage:"Create custom ranges"})))},rc=({setParam:e,params:t,maxHistogramBars:a,maxBars:n,granularityStep:i,onChangeMode:l,rangeFormatter:r})=>{const[o,u]=Object(s.useState)(t.type===Ku);return o?Object(j.jsx)(tc,{ranges:t.ranges,setRanges:t=>{e("ranges",t)},onToggleEditor:()=>{l(Qu),u(!1)},formatter:r}):Object(j.jsx)(lc,{includeEmptyRows:t.includeEmptyRows,maxBars:n,step:i,maxHistogramBars:a,onMaxBarsChange:t=>{e("maxBars",t)},onChangeIncludeEmptyRows:t=>{e("includeEmptyRows",t)},onToggleEditor:()=>{l(Ku),u(!0)}})};var oc=a(107);const uc=e=>Ql(e.from)&&Ql(e.to),cc=e=>!uc(e)||(e=>e.from<=e.to)(e);function dc(e,t){if(t&&e.fieldFormatMap&&e.fieldFormatMap[t.name])return e.fieldFormatMap[t.name]}const pc=[Jr,vo,ou,Zo,Jo,eu,Go,au,tu,nu,$o,Xo,Xu,Nu,{type:"range",displayName:u.i18n.translate("xpack.lens.indexPattern.intervals",{defaultMessage:"Intervals"}),priority:4,input:"field",getErrorMessage:(e,t,a)=>Xl(e.columns[t],a),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if("number"===a&&t&&(!e||e.range))return{dataType:"number",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t)=>{var a,n;return null!==(a=null===(n=t.getFieldByName(e.sourceField))||void 0===n?void 0:n.displayName)&&void 0!==a?a:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})},buildColumn({field:e},t){var a,n,i,s,l;const r=null!==(a=null==t?void 0:t.type)&&void 0!==a?a:Qu;return{label:e.displayName,dataType:r===Qu?"number":"string",operationType:"range",sourceField:e.name,isBucketed:!0,scale:r===Qu?"interval":"ordinal",params:{includeEmptyRows:null===(n=null==t?void 0:t.includeEmptyRows)||void 0===n||n,type:null!==(i=null==t?void 0:t.type)&&void 0!==i?i:Qu,ranges:null!==(s=null==t?void 0:t.ranges)&&void 0!==s?s:[{from:0,to:1e3,label:""}],maxBars:null!==(l=null==t?void 0:t.maxBars)&&void 0!==l?l:Yu,format:null==t?void 0:t.format,parentFormat:null==t?void 0:t.parentFormat}}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"number"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.range))},onFieldChange:(e,t)=>({...e,label:t.name,sourceField:t.name}),toEsAggsFn:(e,t,a,n,i)=>{const{sourceField:s,params:l}=e;if(l.type===Ku)return Object(tt.buildExpressionFunction)("aggRange",{id:t,enabled:!0,schema:"segment",field:s,ranges:l.ranges.filter(cc).map((e=>{if(uc(e))return e;const t={label:e.label};return Ql(e.from)&&(t.from=Number(e.from)),Ql(e.to)&&(t.to=Number(e.to)),t})).map(js.numericalRangeToAst)}).toAst();const r=(i.get(Kn.UI_SETTINGS.HISTOGRAM_MAX_BARS)-1)/2;return Object(tt.buildExpressionFunction)("aggHistogram",{id:t,enabled:!0,schema:"segment",field:s,maxBars:l.maxBars===Yu?r:l.maxBars,interval:"auto",has_extended_bounds:!1,min_doc_count:Boolean(l.includeEmptyRows),autoExtendBounds:Boolean(l.includeEmptyRows),extended_bounds:Object(js.extendedBoundsToAst)({})}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n,indexPattern:i,uiSettings:s,fieldFormats:l})=>{var r,o;const u=i.getFieldByName(a.sourceField),c=a.params.format,d=c&&oc.a[c.id]&&oc.a[c.id].decimalsToPattern((null===(r=c.params)||void 0===r?void 0:r.decimals)||0),p=c&&oc.a[c.id].formatId,m=l.deserialize({...a.params.parentFormat||{id:"range"},params:{...null===(o=a.params.parentFormat)||void 0===o?void 0:o.params,...c?{id:p,params:{pattern:d}}:dc(i,u)}}),g=s.get(Kn.UI_SETTINGS.HISTOGRAM_MAX_BARS),f=(g-1)/6,b=(g-1)/2;return Object(j.jsx)(rc,{setParam:(a,i)=>{n(vr({layer:e,columnId:t,paramName:a,value:i}))},maxBars:a.params.maxBars===Yu?b:a.params.maxBars,granularityStep:f,params:a.params,onChangeMode:i=>{const s=i===Ku?"ordinal":"interval",l=i===Ku?"string":"number",r=i===Ku?{id:"range",params:{template:"arrow_right",replaceInfinity:!0}}:void 0;n({...e,columns:{...e.columns,[t]:{...a,scale:s,dataType:l,params:{type:i,ranges:[{from:0,to:1e3,label:""}],maxBars:b,format:a.params.format,parentFormat:r}}}})},maxHistogramBars:s.get(Kn.UI_SETTINGS.HISTOGRAM_MAX_BARS),rangeFormatter:m})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.ranges.documentation.quick",{defaultMessage:"\n    Buckets values along defined numeric ranges.\n      "})},ju,vu,Iu,wu,Dl,sr,Su,Fu,Eu,Pu,Vu,Au],mc=pc,gc=pc.reduce(((e,t)=>({...e,[t.type]:t})),{}),fc=Object(jt.memoize)((()=>{const e={};return mc.forEach((({type:t,displayName:a})=>{e[t]={type:t,displayName:a}})),e}));function bc(e,t){return(t.priority||Number.NEGATIVE_INFINITY)-(e.priority||Number.NEGATIVE_INFINITY)}const hc=e=>(t,a)=>{var n,i,s;return(null==e||null===(n=e.partiallyApplicableFunctions)||void 0===n?void 0:n[t.type])!==(null==e||null===(i=e.partiallyApplicableFunctions)||void 0===i?void 0:i[a.type])?null!=e&&null!==(s=e.partiallyApplicableFunctions)&&void 0!==s&&s[t.type]?1:-1:(a.priority||Number.NEGATIVE_INFINITY)-(t.priority||Number.NEGATIVE_INFINITY)};function xc(e){var t,a,n;return Object(Ul.c)(e)?null!==(t=null===(a=gc[e.operationType])||void 0===a||null===(n=a.getCurrentFields)||void 0===n?void 0:n.call(a,e))&&void 0!==t?t:[e.sourceField]:[]}function vc(e){var t;return null===(t=gc[e])||void 0===t?void 0:t.getParamsForMultipleFields}function yc(e,t,a,n){var i,s;return Boolean(null===(i=gc[t.operationType])||void 0===i||null===(s=i.canAddNewField)||void 0===s?void 0:s.call(i,{targetColumn:t,sourceColumn:a,field:n,indexPattern:e}))}function jc(e,t,a){return mc.filter((a=>{if("field"!==a.input)return!1;const n=a.getPossibleOperationForField(e);return t?n&&t(n):n})).sort(hc(e)).sort(((e,t)=>{if(!a)return 0;const n=a.has(e.type);return n===a.has(t.type)?0:n?1:-1})).map((({type:e})=>e))}const Oc=Object(jt.memoize)((function(e,t){const a={},n=(e,t)=>{if(!t)return;const n=JSON.stringify(t);a[n]?a[n].operations.push(e):a[n]={operationMetaData:t,operations:[e]}};return(t?Object.values(t):mc).sort(bc).forEach((t=>{if("field"===t.input)e.fields.forEach((e=>{n({type:"field",operationType:t.type,field:e.name},t.getPossibleOperationForField(e))}));else if("none"===t.input)n({type:"none",operationType:t.type},t.getPossibleOperation());else if("fullReference"===t.input){const a=t.getPossibleOperation(e);a&&n({type:"fullReference",operationType:t.type},a)}else if("managedReference"===t.input){const e=t.getPossibleOperation();e&&n({type:"managedReference",operationType:t.type},e)}})),Object.values(a)}));var kc=a(90);function Ic(){Oc.cache.clear&&Oc.cache.clear()}const Tc=(e,t)=>{Object(kc.c)(e,"indexPatternId",t)};function wc(e){return`indexpattern-datasource-layer-${e}`}function Mc(e,t){const a={};return Object.entries(e.layers).forEach((([e,n])=>{a[e]={...n,indexPatternId:t.find((({name:t})=>t===wc(e))).id}})),{layers:a}}function Cc({persistedState:e,references:t,defaultIndexPatternId:a,storage:n,initialContext:i,indexPatternRefs:s=[],indexPatterns:l={}}){const r=function({persistedState:e,references:t}){return e&&t?Mc(e,t):void 0}({persistedState:e,references:t}),{usedPatterns:o,allIndexPatternIds:u}=function({state:e,indexPatternRefs:t,storage:a,initialContext:n,defaultIndexPatternId:i}){var s;const l=((e,t)=>{var a;const n=Object(kc.b)(e,"indexPatternId");return n&&(null===(a=t.find((e=>e.id===n)))||void 0===a?void 0:a.id)})(a,t),r=l||i||(null===(s=t[0])||void 0===s?void 0:s.id),o=[];return n&&("isVisualizeAction"in n?o.push(...n.indexPatternIds):o.push(n.dataViewSpec.id)),{usedPatterns:(n?o:Object(jt.uniq)(e?Object.values(e.layers).map((e=>e.indexPatternId)):[r])).filter(Boolean),allIndexPatternIds:o}}({state:r,defaultIndexPatternId:a,storage:n,initialContext:i,indexPatternRefs:s}),c=new Set(s.map((({id:e})=>e))),d=Object(jt.difference)([...c],o),p=[...u,...o,...d].find((e=>null!=e&&c.has(e)&&l[e]));return p&&Tc(n,p),{layers:{},...r,currentIndexPatternId:p}}function Sc(e){const t=Object.values(e);return 1===t.length&&0===t[0].columnOrder.length}var Fc=a(343),Ec=a.n(Fc);const Pc=e=>e.split(".")[0].split("-")[2];function Ac(e,t,a,n){const{columnOrder:i}=e;if(0===i.length||!t)return null;const s={...e.columns};_c(i.map((e=>[e,s[e]]))).forEach((e=>{const t=s[e],a=gc[t.operationType];if("references"in t&&a.filterable&&t.filter){function n(e){"references"in e&&e.references.forEach((e=>{let a=s[e];const i=a.filter;gc[t.operationType].filterable&&!i&&(a={...a,filter:t.filter},s[e]=a),i||n(a)}))}n(t)}if("references"in t&&a.shiftable&&t.timeShift){function i(e){"references"in e&&e.references.forEach((e=>{let a=s[e];const n=a.timeShift;gc[t.operationType].shiftable&&!n&&(a={...a,timeShift:t.timeShift},s[e]=a),n||i(a)}))}i(t)}}));const l=i.map((e=>[e,s[e]])),[r,o]=Object(jt.partition)(l,(([,e])=>{var t,a;return"fullReference"===(null===(t=gc[e.operationType])||void 0===t?void 0:t.input)||"managedReference"===(null===(a=gc[e.operationType])||void 0===a?void 0:a.input)})),u=l.some((([,e])=>"date_histogram"===e.operationType));if(r.length||o.length){let i=[];const c=[];_c(r).forEach((a=>{const n=s[a],i=gc[n.operationType];"fullReference"!==i.input&&"managedReference"!==i.input||c.push(...i.toExpression(e,a,t))}));const d=o.map((([e])=>e));let p={};const m=new Map;o.forEach((([n,s],l)=>{const r=gc[s.operationType];if("fullReference"!==r.input&&"managedReference"!==r.input){const o=String(l),c=Boolean(r.filterable&&s.filter),g=r.canReduceTimeRange&&!u&&s.reducedTimeRange&&t.timeFieldName;let f=r.toEsAggsFn(s,c||g?`${o}-metric`:o,t,e,a,d,gc);(c||g)&&(f=Object(tt.buildExpressionFunction)("aggFilteredMetric",{id:String(l),enabled:!0,schema:"metric",customBucket:Object(tt.buildExpression)([Object(tt.buildExpressionFunction)("aggFilter",{id:`${l}-filter`,enabled:!0,schema:"bucket",filter:s.filter&&Object(js.queryToAst)(s.filter),timeWindow:g?s.reducedTimeRange:void 0,timeShift:s.timeShift})]),customMetric:Object(tt.buildExpression)({type:"expression",chain:[f]}),timeShift:s.timeShift}).toAst());const b=Object(tt.buildExpression)({type:"expression",chain:[f]});i.push(b);const h=window.ELASTIC_LENS_DELAY_SECONDS?`col-${l+(s.isBucketed?0:1)}-${o}`:`col-${l}-${o}`;p[h]=[{...s,id:n}],m.set(b,h)}})),window.ELASTIC_LENS_DELAY_SECONDS&&i.push(Object(tt.buildExpression)({type:"expression",chain:[Object(tt.buildExpressionFunction)("aggShardDelay",{id:"the-delay",enabled:!0,schema:"metric",delay:`${window.ELASTIC_LENS_DELAY_SECONDS}s`}).toAst()]}));const g=Object(jt.uniq)(o.map((([e,t])=>gc[t.operationType]))),f=function(e,t,a,n){let i=[...e];const s={...t},l=function(e,t){const a={};return e.forEach((e=>{const t=(e=>{for(const a of n){var t;const n=null===(t=a.getGroupByKey)||void 0===t?void 0:t.call(a,e);if(n)return`${a.type}-${n}`}})(e);t&&(t in a||(a[t]=[]),a[t].push(e))})),a}(i),r=i.map((e=>e.functions[0])).filter((e=>"aggTerms"===e.name));return Object.values(l).forEach((e=>{if(e.length<=1)return;const[t,...n]=e;i=i.filter((e=>!n.includes(e)));const l=a.get(t);if(void 0===l)throw new Error("Could not find current column ID for expression builder");n.forEach((e=>{const t=a.get(e);if(void 0===t)throw new Error("Could not find current column ID for expression builder");s[l].push(...s[t]),delete s[t],r.forEach((e=>{var a;(null===(a=e.getArgument("orderBy"))||void 0===a?void 0:a[0])===Pc(t)&&e.replaceArgument("orderBy",[Pc(l)])}))}))})),{aggs:i,esAggsIdMap:s}}(i,p,m,g);i=f.aggs,p=f.esAggsIdMap,g.forEach((e=>{var t;const a=null===(t=e.optimizeEsAggs)||void 0===t?void 0:t.bind(e);if(a){const{aggs:e,esAggsIdMap:t}=a(i,p,m);i=e,p=t}}));const b={};let h=0;const x=Object.keys(p);i.forEach((e=>{var t;const a=null===(t=e.functions[0].getArgument("id"))||void 0===t?void 0:t[0];x.filter((e=>Pc(e)===a)).forEach((e=>{const t=p[e][0],a=((e,t)=>{const[a,n]=e.split("."),i=a.split("-");return i[1]=String(t),i.join("-")+(n?`.${n}`:"")})(e,window.ELASTIC_LENS_DELAY_SECONDS?h+(t.isBucketed?0:1):h);b[a]=p[e],h++}))}));const v=l.filter((([,e])=>{var t,a;return Zl("range",e)&&(null===(t=e.params)||void 0===t?void 0:t.parentFormat)||er(e)&&(null===(a=e.params)||void 0===a?void 0:a.format)})).map((([e,t])=>{var a;const n="parentFormat"in t.params?t.params.parentFormat:void 0,i=t.params.format;return{type:"function",function:"lens_format_column",arguments:{format:i?[i.id]:[""],columnId:[e],decimals:"number"==typeof(null==i||null===(a=i.params)||void 0===a?void 0:a.decimals)?[i.params.decimals]:[],suffix:null!=i&&i.params&&"suffix"in i.params&&i.params.suffix?[i.params.suffix]:[],parentFormat:n?[JSON.stringify(n)]:[]}}})),y=l.find((([,e])=>"date_histogram"===e.operationType)),j=l.filter((([,e])=>e.timeScale&&gc[e.operationType].timeScalingMode&&"disabled"!==gc[e.operationType].timeScalingMode)).flatMap((([e,t])=>[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:null!=y&&y.length?[y[0]]:[],inputColumnId:[e],outputColumnId:[e],outputColumnName:[t.label],targetUnit:[t.timeScale],reducedTimeRange:t.reducedTimeRange?[t.reducedTimeRange]:[]}},{type:"function",function:"lens_format_column",arguments:{format:[""],columnId:[e],parentFormat:[JSON.stringify({id:"suffix",params:{unit:t.timeScale}})]}}]));if(0===o.length)return{type:"expression",chain:[{type:"function",function:"createTable",arguments:{ids:[],names:[],rowCount:[1]}},...c,...v,...j]};const O=Object.values(s).map((e=>Zl("date_histogram",e)&&!e.params.ignoreTimeRange?e.sourceField:null)).filter((e=>Boolean(e)));return{type:"expression",chain:[{type:"function",function:"kibana",arguments:{}},Object(tt.buildExpressionFunction)("esaggs",{index:Object(tt.buildExpression)([Object(tt.buildExpressionFunction)("indexPatternLoad",{id:t.id})]),aggs:i,metricsAtAllLevels:!1,partialRows:!1,timeFields:O,probability:e.sampling||1,samplerSeed:Ec()(n).int32()}).toAst(),{type:"function",function:"lens_map_to_columns",arguments:{idMap:[JSON.stringify(b)]}},...c,...v,...j]}}return null}function _c(e){const t={};e.forEach((([e,a])=>{t[e]="references"in a?a.references:[]})),e.forEach((([e])=>{t[e]=t[e].filter((e=>!!t[e]))}));const a=[];for(;a.length<e.length;)Object.keys(t).forEach((e=>{0===t[e].length&&(a.push(e),delete t[e],Object.keys(t).forEach((a=>{t[a]=t[a].filter((t=>t!==e))})))}));return a}function Lc({state:e,layerId:t,newLayer:a}){return{...e,layers:{...e.layers,[t]:{...e.layers[t],...a}}}}function Dc({state:e,newLayers:t}){return{...e,layers:{...e.layers,...t}}}function Nc(e,t,a){var n;const i=e.columns[t];if(!i||!a)return;const s=i.operationType&&gc[i.operationType],l="references"in i&&Boolean(function(e,t,a){var n;return null===(n=t.references)||void 0===n?void 0:n.map((t=>{var n,i;const s=null===(n=e.columns[t])||void 0===n?void 0:n.operationType,l=gc[s];return null==l||null===(i=l.getErrorMessage)||void 0===i?void 0:i.call(l,e,t,a,gc)}))}(e,i,a).filter(Boolean).length),r=s&&(null===(n=s.getErrorMessage)||void 0===n?void 0:n.call(s,e,t,a,gc)),o=!!i.filter&&!Object(k.D)(i.filter,a);return r&&r.length>0||l||o}function Rc(e,t,a,n,i){return e&&"shard_failure"===t.type?"unsupported_aggregation_on_downsampled_index"===t.reason.type?Object.values(e.layers).flatMap((e=>Object(jt.uniq)(Object.values(e.columns).filter((e=>["median","percentile","percentile_rank","last_value","unique_count","standard_deviation"].includes(e.operationType))).map((e=>e.label))).map((e=>u.i18n.translate("xpack.lens.indexPattern.tsdbRollupWarning",{defaultMessage:"{label} uses a function that is unsupported by rolled up data. Select a different function or change the time range.",values:{label:e}}))))):[Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiText,{size:"s"},Object(j.jsx)("strong",null,t.message),Object(j.jsx)("p",null,t.text)),Object(j.jsx)(b.EuiSpacer,{size:"s"}),t.text?Object(j.jsx)(Kn.ShardFailureOpenModalButton,{theme:i,title:t.message,size:"m",getRequestMeta:()=>({request:a,response:n}),color:"primary",isButtonEmpty:!0}):null)]:[]}function Bc(e,t,{activeData:a,dataViews:n},i,s){const r=[];return t&&a&&Object.entries(a).reduce(((e,[t,{columns:a}])=>[...e,...a.map((e=>({layerId:t,column:e})))]),[]).forEach((({layerId:a,column:o})=>{const d=t.layers[a],p=null==d?void 0:d.columns[o.id];if(d&&p&&e.hasPrecisionError(o)){const e=n.indexPatterns[d.indexPatternId],t=Zl("terms",p),f=t&&"column"===p.params.orderBy.type&&"asc"===p.params.orderDirection&&Zl("count",d.columns[p.params.orderBy.columnId]),h=t&&!go(e.getFieldByName(p.sourceField)),x=t&&(p.params.secondaryFields||[]).length>0;t&&(!f||h||x)?r.push(p.params.accuracyMode?(m=o.name,g=i.links.aggs.terms_doc_count_error,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.accuracyEnabled",defaultMessage:"{name} might be an approximation. For more precise results, try increasing the number of {topValues} or using {filters} instead. {learnMoreLink}",values:{name:Object(j.jsx)("strong",null,m),topValues:Object(j.jsx)("strong",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.topValues",defaultMessage:"top values"})),filters:Object(j.jsx)("strong",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.filters",defaultMessage:"filters"})),learnMoreLink:Object(j.jsx)(b.EuiLink,{href:g,color:"text",target:"_blank",external:!0},Object(j.jsx)(c.FormattedMessage,{defaultMessage:"Learn more.",id:"xpack.lens.indexPattern.precisionErrorWarning.link"}))}})):((t,n,i)=>Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.accuracyDisabled",defaultMessage:"{name} might be an approximation. You can enable accuracy mode for more precise results, but note that it increases the load on the Elasticsearch cluster. {learnMoreLink}",values:{name:Object(j.jsx)("strong",null,t),learnMoreLink:Object(j.jsx)(b.EuiLink,{href:n,color:"text",target:"_blank",external:!0},Object(j.jsx)(c.FormattedMessage,{defaultMessage:"Learn more.",id:"xpack.lens.indexPattern.precisionErrorWarning.link"}))}}),Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiLink,{"data-test-subj":"lnsPrecisionWarningEnableAccuracy",onClick:()=>{s((t=>Lc({state:t,layerId:a,newLayer:Pr(vr({layer:d,columnId:o.id,paramName:"accuracyMode",value:!0}),e)})))}},u.i18n.translate("xpack.lens.indexPattern.enableAccuracyMode",{defaultMessage:"Enable accuracy mode"}))))(o.name,i.links.aggs.terms_doc_count_error)):r.push(Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning",defaultMessage:"{name} for this visualization may be approximate due to how the data is indexed. Try sorting by rarity instead of ascending count of records. To learn more about this limit, {link}.",values:{name:Object(j.jsx)("strong",null,o.name),link:Object(j.jsx)(b.EuiLink,{href:i.links.aggs.rare_terms,color:"text",target:"_blank",external:!0},Object(j.jsx)(c.FormattedMessage,{defaultMessage:"visit the documentation",id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning.link"}))}}),Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiLink,{onClick:()=>{s((t=>Lc({state:t,layerId:a,newLayer:Pr(vr({layer:d,columnId:o.id,paramName:"orderBy",value:{type:"rare",maxDocCount:1}}),e)})))}},u.i18n.translate("xpack.lens.indexPattern.switchToRare",{defaultMessage:"Rank by rarity"}))))}var m,g})),r}function Vc(e){return null==e?void 0:e.map((({input:e})=>e)).filter((({query:e})=>(null==e?void 0:e.trim())&&"*"!==e))}function zc(e){return e.params.ranges.map((({from:t,to:a})=>{let n="";return null!=t&&isFinite(t)&&(n+=`${e.sourceField} >= ${t}`),null!=a&&isFinite(a)&&(n.length&&(n+=" AND "),n+=`${e.sourceField} <= ${a}`),{query:n,language:"kuery"}})).filter((({query:e})=>null==e?void 0:e.trim()))}function Gc(e,t){return[{language:"kuery",query:`${e.sourceField} >= "${t.from}" AND ${e.sourceField} <= "${t.to}"`}]}function qc(e,t,a){const n=[e.sourceField].concat(e.params.secondaryFields||[]).filter(Boolean),i=a.rows.map((({[t]:a})=>{if(null!=a)return"string"!=typeof a&&Array.isArray(a.keys)?a.keys.map(((e,t)=>`${n[t]}: "${""===e?Object(jt.escape)(e):e}"`)).join(" AND "):`${e.sourceField}: "${""===a?Object(jt.escape)(a):a}"`})).filter(Boolean);return[...new Set(i)].map((e=>({language:"kuery",query:e})))}function Hc(e,t,a){return[e[a],...t.map((({[a]:e})=>e))].filter((e=>null==e?void 0:e.length))}const $c=(e,t,a,n)=>{var i,s;return e[t]?{...e,[a]:Object(Gt.renewIDs)(e[t],Object.keys(null!==(i=null===(s=e[t])||void 0===s?void 0:s.columns)&&void 0!==i?i:{}),n)}:e};function Wc(e,t,a){const n=e.filter((e=>e!==a)),i=n.indexOf(t);return n.splice(i+1,0,a),n}function Uc(e,t){var a;return Object(Ul.c)(e)?(null===(a=t(e.sourceField))||void 0===a?void 0:a.displayName)||e.sourceField:""}function Xc({columnId:e,layer:t,setColumns:a,getFieldByName:n}){const i=t.columns[e],s=Object.entries(t.columns).filter((([t,a])=>t!==e&&a.isBucketed)).map((([e,t])=>({value:e,text:t.label,fieldName:Uc(t,n),operationType:t.operationType})));if(!i||!i.isBucketed||!s.length)return null;const r=t.columnOrder[t.columnOrder.indexOf(e)-1];if(1===s.length){const[n]=s,i=u.i18n.translate("xpack.lens.indexPattern.useAsTopLevelAgg",{defaultMessage:"Aggregate by this dimension first"});return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(j.jsx)(b.EuiSwitch,{label:Object(j.jsx)(b.EuiText,{size:"xs"},i),"data-test-subj":"indexPattern-nesting-switch",name:"nestingSwitch",checked:!r,onChange:()=>{a(r?Wc(t.columnOrder,e,n.value):Wc(t.columnOrder,n.value,e))},compressed:!0})))}return Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.groupByDropdown",{defaultMessage:"Group by"}),display:"columnCompressed",fullWidth:!0},Object(j.jsx)(b.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-nesting-select",options:[{value:"",text:u.i18n.translate("xpack.lens.xyChart.nestUnderRoot",{defaultMessage:"Entire data set"})},...s.map((({value:e,text:t})=>({value:e,text:t})))],value:r,onChange:n=>a(Wc(t.columnOrder,n.target.value,e))}))}a(108);const Yc={number:{title:u.i18n.translate("xpack.lens.indexPattern.numberFormatLabel",{defaultMessage:"Number"})},percent:{title:u.i18n.translate("xpack.lens.indexPattern.percentFormatLabel",{defaultMessage:"Percent"})},bytes:{title:u.i18n.translate("xpack.lens.indexPattern.bytesFormatLabel",{defaultMessage:"Bytes (1024)"})},bits:{title:u.i18n.translate("xpack.lens.indexPattern.bitsFormatLabel",{defaultMessage:"Bits (1000)"}),defaultDecimals:0}},Kc={value:"",label:u.i18n.translate("xpack.lens.indexPattern.defaultFormatLabel",{defaultMessage:"Default"})},Qc={asPlainText:!0},Zc=u.i18n.translate("xpack.lens.indexPattern.columnFormatLabel",{defaultMessage:"Value format"}),Jc=u.i18n.translate("xpack.lens.indexPattern.decimalPlacesLabel",{defaultMessage:"Decimals"}),ed=u.i18n.translate("xpack.lens.indexPattern.suffixLabel",{defaultMessage:"Suffix"});function td(e){var t,a,n,i,r,o;const{selectedColumn:u,onChange:c}=e,d=er(u)?null===(t=u.params)||void 0===t?void 0:t.format:void 0,[p,m]=Object(s.useState)(null!==(a=null==d||null===(n=d.params)||void 0===n?void 0:n.decimals)&&void 0!==a?a:2),g=Object(s.useCallback)((e=>{d&&c({id:d.id,params:{...d.params,suffix:e}})}),[d,c]),{handleInputChange:f,inputValue:h}=Object(k.F)({onChange:g,value:null!==(i=null==d||null===(r=d.params)||void 0===r?void 0:r.suffix)&&void 0!==i?i:""},{allowFalsyValue:!0}),x=null!=d&&d.id?Yc[d.id]:void 0,v=Object(s.useMemo)((()=>[Kc,...Object.entries(Yc).map((([e,t])=>{var a;return{value:e,label:null!==(a=t.title)&&void 0!==a?a:e}}))]),[]),y=Object(s.useCallback)((e=>{if(0===e.length)return;if(!e[0].value)return void c();const t=e[0].value,a=Yc[t].defaultDecimals;c({id:e[0].value,params:{decimals:null!=a?a:p}}),m(null!=a?a:p)}),[c,p]),O=Object(s.useMemo)((()=>{var e;return d?[{value:d.id,label:null!==(e=null==x?void 0:x.title)&&void 0!==e?e:d.id}]:[Kc]}),[d,null==x?void 0:x.title]);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{label:Zc,display:"columnCompressed",fullWidth:!0},Object(j.jsx)("div",null,Object(j.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-format","aria-label":Zc,singleSelection:Qc,options:v,selectedOptions:O,onChange:y}),!d||null!==(o=e.options)&&void 0!==o&&o.disableExtraOptions?null:Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiRange,{showInput:"inputWithPopover",value:p,min:0,max:15,onChange:e=>{const t=Number(e.currentTarget.value);m(t);const a=Math.min(15,Math.max(0,t));c({id:d.id,params:{...d.params,decimals:a}})},"data-test-subj":"indexPattern-dimension-formatDecimals",compressed:!0,fullWidth:!0,prepend:Jc,"aria-label":Jc}),Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(b.EuiFieldText,{value:h,onChange:e=>{f(e.currentTarget.value)},"data-test-subj":"indexPattern-dimension-formatSuffix",compressed:!0,fullWidth:!0,prepend:ed,"aria-label":ed})))))}const ad=fc(),nd=e=>{var t;const{currentIndexPattern:a,validation:n,selectionStyle:r,labelAppend:o,column:c,incompleteColumn:d,functionLabel:p,onChooseField:m,onDeleteColumn:g,onChooseFunction:f,fieldLabel:h,operationDefinitionMap:x,isInline:v}=e,y=c&&x[c.operationType],O=Object(s.useMemo)((()=>{const e=new Set,t=new Set,i={},s={};return Object.values(x).filter((({hidden:e,allowAsReference:t})=>!e&&t)).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).forEach((l=>{if("field"===l.input){const t=a.fields.filter((e=>Er({operationType:l.type,validation:n,field:e,indexPattern:a})));t.length&&(e.add(l.type),s[l.type]=new Set(t.map((({name:e})=>e))),t.forEach((e=>{var t;i[e.name]||(i[e.name]=new Set),null===(t=i[e.name])||void 0===t||t.add(l.type)})))}else Er({operationType:l.type,validation:n,indexPattern:a})&&(e.add(l.type),t.add(l.type))})),{operationTypes:e,operationWithoutField:t,operationByField:i,fieldByOperation:s}}),[a,n,x]);if("hidden"===r)return null;const k=null==d?void 0:d.operationType,I=null!==(t=null==d?void 0:d.sourceField)&&void 0!==t?t:null,T=((e,t,a)=>Array.from(e.operationTypes).map((n=>{var i;const s=t[n];return{label:ad[n].displayName,value:n,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${n}${!a||a&&Object(Ul.c)(a)&&"field"===s.input&&(null===(i=e.fieldByOperation[n])||void 0===i?void 0:i.has(a.sourceField))||a&&!Object(Ul.c)(a)&&"field"!==s.input?"":" incompatible"}`}})))(O,x,c),w=k?[null==T?void 0:T.find((({value:e})=>e===k))]:c?[null==T?void 0:T.find((({value:e})=>e===c.operationType))]:[],M=Boolean(w.length&&null==w[0]);if(M){const e=k||(null==c?void 0:c.operationType),t={label:e&&ad[e].displayName,value:e,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${e} incompatible`};null==T||T.push(t),w[0]=t}const C=!c&&!Boolean(k),S=Boolean(k)||"field"===r&&!c,F=!a.getFieldByName(null!=I?I:null==c?void 0:c.sourceField),E=null==y?void 0:y.paramEditor;return Object(j.jsx)("div",null,"field"!==r?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(Wr,{isInline:v,"data-test-subj":"indexPattern-subFunction-selection-row",label:p||u.i18n.translate("xpack.lens.indexPattern.chooseSubFunction",{defaultMessage:"Choose a sub-function"}),fullWidth:!0,isInvalid:C||M},Object(j.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-reference-function",placeholder:p||u.i18n.translate("xpack.lens.indexPattern.referenceFunctionPlaceholder",{defaultMessage:"Sub-function"}),options:T,isInvalid:C||M,selectedOptions:w,singleSelection:{asPlainText:!0},onChange:e=>{if(0===e.length)return g();const t=e[0].value;if((null==c?void 0:c.operationType)===t)return;const n=O.fieldByOperation[t],i=c&&"sourceField"in c&&null!=n&&n.has(c.sourceField)?a.getFieldByName(c.sourceField):1===(null==n?void 0:n.size)?a.getFieldByName(n.values().next().value):void 0;f(t,i)}})),Object(j.jsx)(b.EuiSpacer,{size:"s"})):null,c&&"field"!==(null==y?void 0:y.input)?null:Object(j.jsx)(Wr,{isInline:v,"data-test-subj":"indexPattern-reference-field-selection-row",label:h||u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:S||F,labelAppend:o},Object(j.jsx)(Nr,{fieldIsInvalid:S||F,currentIndexPattern:a,operationByField:O.operationByField,selectedOperationType:c?c.operationType:k,selectedField:null!=I?I:null==c?void 0:c.sourceField,incompleteOperation:k,markAllFieldsCompatible:"field"===r,onDeleteColumn:g,onChoose:m})),c&&!d&&E&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)(E,i()({},e,{isReferenced:!0,operationDefinitionMap:x,currentColumn:c,indexPattern:e.currentIndexPattern}))))};function id({selectedColumn:e,columnId:t,layer:a,updateLayer:n}){var i;const s=gc[e.operationType];return s.timeScalingMode&&"disabled"!==s.timeScalingMode?Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:Object(j.jsx)(b.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.timeScale.tooltip",{defaultMessage:"Normalize values to be always shown as rate per specified time unit, regardless of the underlying date interval."})},Object(j.jsx)("span",null,u.i18n.translate("xpack.lens.indexPattern.timeScale.label",{defaultMessage:"Normalize by unit"})," ",Object(j.jsx)(b.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiSelect,{fullWidth:!0,compressed:!0,options:[{value:"",text:u.i18n.translate("xpack.lens.timeScale.normalizeNone",{defaultMessage:"None"})},...Object.entries(Po).map((([e,t])=>({value:e,text:t})))],"data-test-subj":"indexPattern-time-scaling-unit",value:null!==(i=e.timeScale)&&void 0!==i?i:"",onChange:e=>{const i=e.target.value||void 0;n(function(e,t,a){const n=t.columns[e],i=n.customLabel?n.label:Do(n.label,n.timeScale,a,n.timeShift,n.timeShift,n.reducedTimeRange,n.reducedTimeRange);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:i,timeScale:a}}}}(t,a,i))}})))):null}function sd({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,helpMessage:l}){const r=e.filter,o=Object(s.useCallback)((e=>{const{isValid:s}=Object(k.H)(e,i);s&&!Object(jt.isEqual)(r,e)&&n(function(e,t,a){return{...t,columns:{...t.columns,[e]:{...t.columns[e],filter:a}}}}(t,a,e))}),[t,i,r,a,n]);return gc[e.operationType].filterable?Object(j.jsx)(k.i,{helpMessage:l,onChange:o,indexPattern:i,inputFilter:r}):null}function ld(e,t,a,n){const i=null==a?void 0:a.trim(),s=t.columns[e],l=s.customLabel||n?s.label:Do(s.label,s.timeScale,s.timeScale,s.timeShift,s.timeShift,s.reducedTimeRange,i);return{...t,columns:{...t.columns,[e]:{...t.columns[e],reducedTimeRange:i,label:l}}}}function rd(e){return"previous"===e||"invalid"===e}function od({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,helpMessage:r,skipLabelUpdate:o}){const[c,d]=Object(s.useState)(e.reducedTimeRange);Object(s.useEffect)((()=>{d(e.reducedTimeRange)}),[e.reducedTimeRange]);const p=gc[e.operationType],m=Object.values(a.columns).some((e=>"date_histogram"===e.operationType));if(!p.canReduceTimeRange||!e.reducedTimeRange&&(m||!i.timeFieldName))return null;const g=c&&Object(js.parseTimeShift)(c),f=Boolean(g&&rd(g)),h=Boolean(m||!i.timeFieldName),x=u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.label",{defaultMessage:"Reduced time range"});return Object(j.jsx)("div",null,Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",fullWidth:!0,"data-test-subj":"indexPattern-dimension-reducedTimeRange-row",label:r?Object(j.jsx)(l.a.Fragment,null,x," ",Object(j.jsx)(b.EuiIconTip,{color:"subdued",content:r,iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})):x,helpText:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.help",{defaultMessage:"Reduces the time range specified in the global time filter from the end of the global time filter."}),error:h?u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.notApplicableHelp",{defaultMessage:"Additional time range filter can not be used together with date histogram or without a default time field specified on the data view"}):f?u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.genericInvalidHelp",{defaultMessage:"Time range value is not valid."}):void 0,isInvalid:f||h},Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!0,"data-test-subj":"indexPattern-dimension-reducedTimeRange",placeholder:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRangePlaceholder",{defaultMessage:"Type custom values (e.g. 12m)"}),options:vl,selectedOptions:function(){if(!c)return[];const e=vl.filter((({value:e})=>e===c));return e.length>0?e:[{value:c,label:c}]}(),singleSelection:{asPlainText:!0},isInvalid:f,onCreateOption:e=>{rd(Object(js.parseTimeShift)(e))?d(e):n(ld(t,a,e,o))},onChange:e=>{if(0===e.length)return n(ld(t,a,"",o)),void d("");const i=e[0].value;rd(Object(js.parseTimeShift)(i))?d(i):n(ld(t,a,i,o))}})))))}function ud(e){const{euiTheme:t}=Object(b.useEuiTheme)();return Object(j.jsx)(b.EuiAccordion,{id:"advancedOptionsAccordion",arrowProps:{color:"primary"},"data-test-subj":"indexPattern-advanced-accordion",className:"lnsIndexPatternDimensionEditor-advancedOptions",buttonContent:Object(j.jsx)(b.EuiTitle,{size:"xxs"},Object(j.jsx)("h5",null,Object(j.jsx)(b.EuiTextColor,{color:t.colors.primary},u.i18n.translate("xpack.lens.indexPattern.advancedSettings",{defaultMessage:"Advanced"})))),css:Object(j.css)("padding:0 ",t.size.base," ",t.size.base,";","")},e.options.map((({dataTestSubj:e,inlineElement:t})=>Object(j.jsx)("div",{key:e,"data-test-subj":e},Object(j.jsx)(b.EuiSpacer,{size:"s"}),t))))}function cd(e,t,a){const n=null==a?void 0:a.trim(),i=t.columns[e],s=i.customLabel?i.label:Do(i.label,i.timeScale,i.timeScale,i.timeShift,n,i.reducedTimeRange,i.reducedTimeRange);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:s,timeShift:n}}}}function dd({datatableUtilities:e,selectedColumn:t,columnId:a,layer:n,updateLayer:i,indexPattern:l,activeData:r,layerId:o}){const[c,d]=Object(s.useState)(t.timeShift);if(Object(s.useEffect)((()=>{d(t.timeShift)}),[t.timeShift]),!gc[t.operationType].shiftable)return null;const p=fl(e,n,l,r,o),{isValueTooSmall:m,isValueNotMultiple:g,isInvalid:f,canShift:h}=bl(p);if(!h)return null;const x=c&&Object(js.parseTimeShift)(c),v=Boolean(x&&f(x)),y=x&&m(x),O=x&&g(x);return Object(j.jsx)("div",null,Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed",fullWidth:!0,"data-test-subj":"indexPattern-dimension-time-shift-row",label:u.i18n.translate("xpack.lens.indexPattern.timeShift.label",{defaultMessage:"Time shift"}),helpText:u.i18n.translate("xpack.lens.indexPattern.timeShift.help",{defaultMessage:"Enter the time shift number and unit"}),error:y&&u.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})||O&&u.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"})||v&&u.i18n.translate("xpack.lens.indexPattern.timeShift.genericInvalidHelp",{defaultMessage:"Time shift value is not valid."}),isInvalid:Boolean(v||y||O)},Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!0,"data-test-subj":"indexPattern-dimension-time-shift",placeholder:u.i18n.translate("xpack.lens.indexPattern.timeShiftPlaceholder",{defaultMessage:"Type custom values (e.g. 8w)"}),options:ml.filter((({value:e})=>{const t=Object(js.parseTimeShift)(e);return t&&!m(t)&&!g(t)&&!("previous"===t&&p.interval)})),selectedOptions:function(){const e=ml.filter((({value:e})=>e===c));return e.length>0?e:[{value:null!=c?c:"",label:null!=c?c:u.i18n.translate("xpack.lens.timeShift.none",{defaultMessage:"None"})}]}(),singleSelection:{asPlainText:!0},isInvalid:v,onCreateOption:e=>{const t=Object(js.parseTimeShift)(e);f(t)?d(e):i(cd(a,n,e))},onChange:e=>{if(0===e.length||e.length&&""===e[0].value)return i(cd(a,n,"")),void d("");const t=e[0].value,s=Object(js.parseTimeShift)(t);f(s)?d(t):i(cd(a,n,t))}})))))}const pd="formula",md="static_value",gd="quickFunctions",fd=new Set([pd,md]);function bd(e){return!fd.has(e)}const hd=({currentOperationType:e,temporaryStateType:t})=>"none"===t||null!=e&&bd(e)?null:e===md&&"quickFunctions"===t?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.staticValueWarning",{defaultMessage:"Static value currently applied"}),iconType:"alert",color:"warning"},Object(j.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.staticValueWarningText",{defaultMessage:"To overwrite your static value, select a quick function"})))):Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.formulaWarning",{defaultMessage:"Formula currently applied"}),iconType:"alert",color:"warning"},"quickFunctions"!==t?Object(j.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningStaticValueText",{defaultMessage:"To overwrite your formula, change the value in the input field"})):Object(j.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningText",{defaultMessage:"To overwrite your formula, select a quick function"})))),xd=({options:e,onMethodChange:t,selectedMethod:a})=>{const n=e.filter((({enabled:e})=>e)).map((({id:e,label:t})=>({id:e,label:t,"data-test-subj":`lens-dimensionTabs-${e}`})));return Object(j.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingMethod",{defaultMessage:"Method"}),fullWidth:!0},Object(j.jsx)(b.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.indexPattern.dimensionEditorModes",{defaultMessage:"Dimension editor configuration modes"}),buttonSize:"compressed",isFullWidth:!0,options:n,idSelected:a,onChange:a=>(a=>{t(a);const n=e.find((({id:e})=>e===a));null==n||n.onClick()})(a)}))},vd=fc();function yd(e){return e&&"boolean"!=typeof e?e.helpMessage:null}function jd(e){var t,a,n,r,c,d;const{selectedColumn:p,operationSupportMatrix:m,state:g,columnId:f,setState:h,layerId:x,currentIndexPattern:v,hideGrouping:y,dateRange:O,dimensionGroups:I,toggleFullscreen:T,isFullscreen:w,supportStaticValue:M,enableFormatSelector:C=!0,formatSelectorOptions:S,layerType:F,paramEditorCustomProps:E}=e,P={data:e.data,fieldFormats:e.fieldFormats,uiSettings:e.uiSettings,savedObjectsClient:e.savedObjectsClient,http:e.http,storage:e.storage,unifiedSearch:e.unifiedSearch,dataViews:e.dataViews},{fieldByOperation:A,operationWithoutField:_}=m,L=p&&gc[p.operationType],[D,N]=Object(s.useState)("none"),[R,B]=Object(s.useState)(!1),V=Boolean(D===gd),z=Boolean(D===md),{euiTheme:G}=Object(b.useEuiTheme)(),q=Object(s.useCallback)((e=>h((t=>Lc({state:t,layerId:x,newLayer:e})))),[x,h]),H=Object(s.useCallback)(((e,t={})=>{const a=g.layers[x];let n;n=Jl(e)?{...a,columns:{...a.columns,[f]:e}}:"function"==typeof e?e(g.layers[x]):e;const i=Boolean(n.columns[f]);h((t=>{let a;const n=t.layers[x];return a=Jl(e)?{...n,columns:{...n.columns,[f]:e}}:"function"==typeof e?e(t.layers[x]):e,Lc({state:t,layerId:x,newLayer:jr(a,f)})}),{isDimensionComplete:i,...t})}),[f,x,h,g.layers]),$=e=>{h((t=>({...t,isDimensionClosePrevented:!e})))},W=(null!==(t=g.layers[x].incompleteColumns)&&void 0!==t?t:{})[f],{operationType:U,sourceField:X=null,...Y}=W||{},K=Boolean(M?L&&bd(L.type):!L||bd(L.type)),Q=V||K,Z=z||"none"===D&&M&&(!p||(null==p?void 0:p.operationType)===md),J=(t=e.state.layers[e.layerId])=>{if((null==p?void 0:p.operationType)!==md){var a,n,i;const o=rr({layer:t,indexPattern:v,columnId:f,op:md,visualizationGroups:I});var s,l,r;return null!=(null===(a=e.activeData)||void 0===a||null===(n=a[x])||void 0===n||null===(i=n.rows[0])||void 0===i?void 0:i[f])?Pr(vr({layer:o,columnId:f,paramName:"value",value:null===(s=e.activeData)||void 0===s||null===(l=s[x])||void 0===l||null===(r=l.rows[0])||void 0===r?void 0:r[f]}),v):o}return t},ee=function(e,t,a){return e?gc.static_value.paramEditor:null!=t&&t.paramEditor?t.paramEditor:a?gc.static_value.paramEditor:null}(z,L,M&&!Q),te=Object(s.useMemo)((()=>Object.values(gc).filter((({hidden:e})=>!e)).filter((e=>!("selectionStyle"in e)||"hidden"!==e.selectionStyle)).filter((({type:e})=>{var t;return(null===(t=A[e])||void 0===t?void 0:t.size)||_.has(e)})).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).map((e=>e.type))),[A,_]),ae=Object(s.useRef)(null);Object(s.useEffect)((()=>()=>{ae.current&&(o.a.unmountComponentAtNode(ae.current),document.body.removeChild(ae.current))}),[]);const ne=p&&Object(Ul.c)(p)&&v.getFieldByName(p.sourceField),ie=ne||Object(Ul.b)(p,v,g.layers[x]),se=te.map((t=>{const a=gc[t];return{operationType:t,compatibleWithCurrentField:mr({layer:g.layers[x],columnId:f,op:t,indexPattern:v,field:ne||void 0,filterOperations:e.filterOperations,visualizationGroups:I}),disabledStatus:a.getDisabledStatus&&a.getDisabledStatus(e.indexPatterns[g.currentIndexPatternId],g.layers[x],F)}})),le=Object(s.useMemo)((()=>{return t=v,!(!(e=p)||!Object(Ul.c)(e)||null===(a=Xl(e,t))||void 0===a||!a.length);var e,t,a}),[p,v]),re="none"===D||null!=(null==p?void 0:p.operationType)&&bd(null==p?void 0:p.operationType),oe=se.map((({operationType:t,compatibleWithCurrentField:a,disabledStatus:n})=>{var i;const s=Boolean(U===t||!U&&p&&p.operationType===t),r=a&&(null==ie||null===(i=ie.partiallyApplicableFunctions)||void 0===i?void 0:i[t])&&Object(j.jsx)("span",{"data-test-subj":`${t}-partial-warning`}," ",Object(j.jsx)(b.EuiIconTip,{content:u.i18n.translate("xpack.lens.indexPattern.helpPartiallyApplicableFunctionLabel",{defaultMessage:"This function may only return partial results, as it is unable to support the full time range of rolled-up historical data."}),position:"left",size:"s",type:"partial",color:"warning"}));let c=Object(j.jsx)(l.a.Fragment,null,vd[t].displayName,r);return s&&n?c=Object(j.jsx)(b.EuiToolTip,{content:n,display:"block",position:"left"},Object(j.jsx)(b.EuiText,{color:"danger",size:"s"},Object(j.jsx)("strong",null,c))):n?c=Object(j.jsx)(b.EuiToolTip,{content:n,display:"block",position:"left"},Object(j.jsx)("span",null,vd[t].displayName)):a||(c=Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(j.jsx)(b.EuiFlexItem,{grow:!1,style:{marginRight:G.size.xs}},c),re&&Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiIconTip,{content:u.i18n.translate("xpack.lens.indexPattern.helpIncompatibleFieldDotLabel",{defaultMessage:"This function is not compatible with the current selected field"}),position:"left",size:"s",type:"dot",color:"warning"})))),{id:t,label:c,isActive:s,size:"s",isDisabled:!!n,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${t}${a?"":" incompatible"}`,"aria-pressed":s,extraAction:gc[t].helpComponent?{color:"primary",onClick:e=>{if(ae.current)o.a.unmountComponentAtNode(ae.current),document.body.removeChild(ae.current),ae.current=null;else{const a=document.createElement("div");ae.current=a,document.body.appendChild(a);const n=gc[t].helpComponent,i=Object(j.jsx)(ic,{button:e.target,isOpen:!0,title:gc[t].helpComponentTitle,closePopover:()=>{ae.current&&(o.a.unmountComponentAtNode(ae.current),document.body.removeChild(ae.current),ae.current=null)}},Object(j.jsx)(n,null));o.a.render(i,ae.current)}},iconType:"documentation",iconSize:"s","aria-label":u.i18n.translate("xpack.lens.indexPattern.helpLabel",{defaultMessage:"Function help"})}:void 0,onClick(){if(["none","fullReference","managedReference"].includes(gc[t].input)){if((null==p?void 0:p.operationType)===t)return void(W&&H(Ar(g.layers[x],f)));const a=rr({layer:e.state.layers[e.layerId],indexPattern:v,columnId:f,op:t,visualizationGroups:I,targetGroup:e.groupId});return V&&bd(a.columns[f].operationType)&&N("none"),void H(a)}if(!p||!a){const a=A[t]||new Set;let n;return n=1===a.size?rr({layer:e.state.layers[e.layerId],indexPattern:v,columnId:f,op:t,field:v.getFieldByName(a.values().next().value),visualizationGroups:I,targetGroup:e.groupId}):rr({layer:e.state.layers[e.layerId],indexPattern:v,columnId:f,op:t,field:a.has(at.c)?Vl.a:void 0,visualizationGroups:I,targetGroup:e.groupId}),V&&bd(n.columns[f].operationType)&&N("none"),void H(n)}if(p.operationType===t)return void(W&&H(Ar(g.layers[x],f)));V&&N("none");const n=dr({layer:e.state.layers[e.layerId],indexPattern:v,columnId:f,op:t,field:Object(Ul.c)(p)?v.getFieldByName(p.sourceField):void 0,visualizationGroups:I});H(n)}}})),ue=!le&&!W&&p&&bd(p.operationType)&&ee,ce=!W&&p&&"references"in p&&"fullReference"===(null==L?void 0:L.input),de=!p||"field"===(null==L?void 0:L.input)||U&&"field"===(null===(a=gc[U])||void 0===a?void 0:a.input)||V,pe=(null==L?void 0:L.renderFieldInput)||qr,me={layer:g.layers[x],layerId:x,activeData:e.activeData,paramEditorUpdater:e=>{V&&N("none"),H(e,{forceRender:V})},columnId:f,currentColumn:g.layers[x].columns[f],dateRange:O,indexPattern:v,operationDefinitionMap:gc,toggleFullscreen:T,isFullscreen:w,setIsCloseable:$,paramEditorCustomProps:E,ReferenceEditor:nd,dataSectionExtra:e.dataSectionExtra,...P},ge=Object(j.jsx)(b.EuiButtonIcon,{onClick:()=>B((e=>!e)),iconType:"documentation","aria-label":u.i18n.translate("xpack.lens.indexPattern.quickFunctions.tableTitle",{defaultMessage:"Description of functions"})}),fe=[{field:"function",name:u.i18n.translate("xpack.lens.indexPattern.functionTable.functionHeader",{defaultMessage:"Function"}),width:"150px"},{field:"description",name:u.i18n.translate("xpack.lens.indexPattern.functionTable.descriptionHeader",{defaultMessage:"Description"})}],be=oe.filter((e=>gc[e.id].quickFunctionDocumentation)).map((e=>{const t=gc[e.id];return{id:e.id,function:t.displayName,description:t.quickFunctionDocumentation}})),he=Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiFormRow,{label:Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(j.jsx)(b.EuiFlexItem,{grow:!1},u.i18n.translate("xpack.lens.indexPattern.functionsLabel",{defaultMessage:"Functions"})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiPopover,{anchorPosition:"rightUp",button:ge,isOpen:R,display:"inlineBlock",panelPaddingSize:"none",className:"dscFieldTypesHelp__popover",panelClassName:"dscFieldTypesHelp__panel",closePopover:()=>B(!1),initialFocus:"#dscFieldTypesHelpBasicTableId"},Object(j.jsx)(b.EuiPopoverTitle,{paddingSize:"s"},u.i18n.translate("xpack.lens.indexPattern.quickFunctions.popoverTitle",{defaultMessage:"Quick functions"})),Object(j.jsx)(b.EuiPanel,{className:"eui-yScroll",style:{maxHeight:"40vh"},color:"transparent",paddingSize:"s"},Object(j.jsx)(b.EuiBasicTable,{id:"dscFieldTypesHelpBasicTableId",style:{width:350},tableCaption:u.i18n.translate("xpack.lens.indexPattern.quickFunctions.tableTitle",{defaultMessage:"Description of functions"}),items:be,compressed:!0,rowHeader:"firstName",columns:fe,responsive:!1}))))),fullWidth:!0},Object(j.jsx)(b.EuiListGroup,{className:oe.length>3?"lnsIndexPatternDimensionEditor__columns":"",gutterSize:"none",color:"primary",listItems:oe.length%2==1?[...oe,{label:" "}]:oe,maxWidth:!1})),ce?Object(j.jsx)(l.a.Fragment,null,p.references.map(((t,a)=>{var n;const s=L.requiredReferences[a],l=g.layers[x];return Object(j.jsx)(nd,i()({operationDefinitionMap:gc,key:a,layer:l,layerId:x,activeData:e.activeData,columnId:t,column:l.columns[t],incompleteColumn:l.incompleteColumns?l.incompleteColumns[t]:void 0,onDeleteColumn:()=>{q(Or({layer:l,columnId:t,indexPattern:v}))},onChooseFunction:(e,a)=>{q(rr({layer:l,columnId:t,op:e,indexPattern:v,field:a,visualizationGroups:I}))},onChooseField:e=>{q(rr({layer:l,columnId:t,indexPattern:v,op:e.operationType,field:v.getFieldByName(e.field),visualizationGroups:I}))},paramEditorUpdater:e=>{let a;return a="function"==typeof e?e(l):Jl(e)?{...l,columns:{...l.columns,[t]:e}}:e,q(jr(a,t))},validation:s,currentIndexPattern:v,selectionStyle:L.selectionStyle,dateRange:O,labelAppend:null==L||null===(n=L.getHelpMessage)||void 0===n?void 0:n.call(L,{data:e.data,uiSettings:e.uiSettings,currentColumn:l.columns[f]}),isFullscreen:w,toggleFullscreen:T,setIsCloseable:$,paramEditorCustomProps:E},P))})),"field"!==L.selectionStyle?Object(j.jsx)(b.EuiSpacer,{size:"s"}):null):null,de?Object(j.jsx)(pe,{layer:g.layers[x],selectedColumn:p,columnId:f,indexPattern:v,operationSupportMatrix:m,updateLayer:e=>{V&&N("none"),H(e,{forceRender:V})},incompleteField:X,incompleteOperation:U,incompleteParams:Y,currentFieldIsInvalid:le,helpMessage:null==L||null===(n=L.getHelpMessage)||void 0===n?void 0:n.call(L,{data:e.data,uiSettings:e.uiSettings,currentColumn:g.layers[x].columns[f]}),dimensionGroups:I,groupId:e.groupId,operationDefinitionMap:gc}):null,!w&&!W&&!y&&"none"===D&&Object(j.jsx)(Xc,{layer:g.layers[e.layerId],columnId:e.columnId,setColumns:e=>q({columnOrder:e}),getFieldByName:v.getFieldByName}),ue&&Object(j.jsx)(ee,me),!(null!=L&&L.handleDataSectionExtra)&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"m"}),e.dataSectionExtra)),xe=ee?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(ee,i()({layer:g.layers[x],activeData:e.activeData,paramEditorUpdater:z?e=>{if(z&&N("none"),"function"==typeof e)return h((t=>{const a=e(J(t.layers[x]));return Lc({state:t,layerId:x,newLayer:a})}),{isDimensionComplete:!0,forceRender:!0});if(Jl(e))throw new Error("static value should only be updated by the whole layer")}:H,columnId:f,currentColumn:g.layers[x].columns[f],operationDefinitionMap:gc,layerId:x,paramEditorCustomProps:E,dateRange:O,isFullscreen:w,indexPattern:v,toggleFullscreen:T,setIsCloseable:$,ReferenceEditor:nd},P))):null,ve=Q?he:xe,ye=Object(s.useCallback)((e=>{q(vr({layer:g.layers[x],columnId:f,paramName:"format",value:e}))}),[f,x,g.layers,q]),je=!w&&m.operationWithoutField.has(pd),Oe=!w&&(je||M),ke=Object(s.useMemo)((()=>{let e="";return Z?e=md:Q?e=gd:"none"===D&&(null==p?void 0:p.operationType)===pd&&(e=pd),e}),[null==p?void 0:p.operationType,Q,Z,D]),[Ie,Te]=Object(s.useState)(ke),we=[{id:md,enabled:Boolean(M),state:Z,onClick:()=>{if((null==p?void 0:p.operationType)===pd)return N(md);N("none"),H(J())},label:u.i18n.translate("xpack.lens.indexPattern.staticValueLabel",{defaultMessage:"Static value"})},{id:gd,enabled:!0,state:Q,onClick:()=>{!p||bd(p.operationType)||N(gd)},label:u.i18n.translate("xpack.lens.indexPattern.quickFunctionsLabel",{defaultMessage:"Quick function"})},{id:pd,enabled:je,state:"none"===D&&(null==p?void 0:p.operationType)===pd,onClick:()=>{if(N("none"),(null==p?void 0:p.operationType)!==pd){const t=rr({layer:e.state.layers[e.layerId],indexPattern:v,columnId:f,op:pd,visualizationGroups:I});H(t)}},label:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"})}],Me=Object(s.useMemo)((()=>String(p&&gc[p.operationType].getDefaultLabel(p,e.indexPatterns[g.layers[x].indexPatternId],g.layers[x].columns))),[x,p,e.indexPatterns,g.layers]),Ce=Object(s.useCallback)((e=>{p&&H(p.operationType===pd?rr({op:p.operationType,layer:e,columnId:f,indexPattern:v,visualizationGroups:I}):e)}),[f,v,I,p,H]),Se=!w&&!le&&!W&&p&&"none"===D&&L&&(L.timeScalingMode||L.filterable||L.shiftable);return Object(j.jsx)("div",{id:f},Object(j.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded"},Object(j.jsx)(b.EuiText,{size:"s",css:Object(j.css)("margin-bottom:",G.size.base,";","")},Object(j.jsx)("h4",null,null!==(r=null==E?void 0:E.headingLabel)&&void 0!==r?r:u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingData",{defaultMessage:"Data"}))),Object(j.jsx)(l.a.Fragment,null,Oe?Object(j.jsx)(xd,{options:we,onMethodChange:e=>{Te(e)},selectedMethod:Ie}):null,Object(j.jsx)(hd,{currentOperationType:null==p?void 0:p.operationType,temporaryStateType:D}),ve)),Se&&Object(j.jsx)(ud,{options:[{dataTestSubj:"indexPattern-time-scaling-enable",inlineElement:L.timeScalingMode?Object(j.jsx)(id,{selectedColumn:p,columnId:f,layer:g.layers[x],updateLayer:Ce}):null},{dataTestSubj:"indexPattern-filter-by-enable",inlineElement:L.filterable?Object(j.jsx)(sd,{indexPattern:v,selectedColumn:p,columnId:f,layer:g.layers[x],updateLayer:Ce,helpMessage:yd(L.filterable)}):null},{dataTestSubj:"indexPattern-reducedTimeRange-enable",inlineElement:L.canReduceTimeRange?Object(j.jsx)(od,{selectedColumn:p,columnId:f,indexPattern:v,layer:g.layers[x],updateLayer:Ce,skipLabelUpdate:je,helpMessage:yd(L.canReduceTimeRange)}):null},{dataTestSubj:"indexPattern-time-shift-enable",inlineElement:Boolean(L.shiftable&&(v.timeFieldName||Object.values(g.layers[x].columns).some((e=>"date_histogram"===e.operationType))))?Object(j.jsx)(dd,{datatableUtilities:P.data.datatableUtilities,indexPattern:v,selectedColumn:p,columnId:f,layer:g.layers[x],updateLayer:Ce,activeData:e.activeData,layerId:x}):null},...(null===(c=(d=gc[p.operationType]).getAdvancedOptions)||void 0===c?void 0:c.call(d,me))||[]]}),!w&&!le&&Object(j.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded lnsIndexPatternDimensionEditor--collapseNext"},!W&&"none"===D&&p&&Object(j.jsx)(b.EuiText,{size:"s",css:Object(j.css)("margin-bottom:",G.size.base,";","")},Object(j.jsx)("h4",null,u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingAppearance",{defaultMessage:"Appearance"}))),Object(j.jsx)(l.a.Fragment,null,!W&&p&&"none"===D&&Object(j.jsx)(k.l,{value:p.label,defaultValue:Me,onChange:t=>{q({columns:{...g.layers[x].columns,[f]:{...p,label:t,customLabel:gc[p.operationType].getDefaultLabel(p,e.indexPatterns[g.layers[x].indexPatternId],g.layers[x].columns)!==t}}})}}),!C||w||!p||"number"!==p.dataType&&"range"!==p.operationType?null:Object(j.jsx)(td,{selectedColumn:p,onChange:ye,options:S}))))}const Od=xs()((function(e,t){const a=e.filter((e=>t(e.operationMetaData))),n={},i=new Set,s={};return a.forEach((({operations:e})=>{e.forEach((e=>{var t,a;"field"===e.type?(n[e.field]||(n[e.field]=new Set),null===(t=n[e.field])||void 0===t||t.add(e.operationType),s[e.operationType]||(s[e.operationType]=new Set),null===(a=s[e.operationType])||void 0===a||a.add(e.field)):i.add(e.operationType)}))})),{operationByField:n,operationWithoutField:i,fieldByOperation:s}})),kd=function(e){var t;const a=e.layerId,n=e.state.layers[a],i=e.indexPatterns[n.indexPatternId],{columnId:l,uniqueLabel:r,invalid:o,invalidMessage:u,hideTooltip:c}=e,d=Object(s.useMemo)((()=>o||Nc(n,l,i)),[n,l,i,o]),p=null!==(t=n.columns[e.columnId])&&void 0!==t?t:null;if(!p)return null;const m=(g=r)?g.replace(/\./g,".​"):"";var g;return Object(j.jsx)(wi,{id:l,label:d?p.label:m,isInvalid:Boolean(d),hideTooltip:c,invalidMessage:u})},Id=function(e){var t;const a=e.layerId,n=e.indexPatterns[null===(t=e.state.layers[a])||void 0===t?void 0:t.indexPatternId];if(!n)return null;const s=(e=>{const t=e.layerId,a=e.indexPatterns[e.state.layers[t].indexPatternId],n=Oc(a);return Od(n,e.filterOperations)})(e),l=e.state.layers[a].columns[e.columnId]||null;return Object(j.jsx)(jd,i()({},e,{layerType:e.layerType||_.LayerTypes.DATA,currentIndexPattern:n,selectedColumn:l,operationSupportMatrix:s}))},Td=Object(s.memo)(kd),wd=Object(s.memo)(Id);var Md=a(70);const Cd=fc();function Sd(e,t,a,n,i){if(!e)return;const s=jc(e,t,i);return s.length?a&&s.includes(a.operationType)?a.operationType:n&&s.includes(n)?n:s[0]:void 0}function Fd(e,t){if(e)return Object(Ul.c)(e)&&t.getFieldByName(e.sourceField)||void 0}function Ed(e){const{state:t,source:a,target:n,indexPatterns:i}=e;if(!a)return;const s={...n,column:t.layers[n.layerId].columns[n.columnId],dataView:i[t.layers[n.layerId].indexPatternId]};if(Object(Gt.isDraggedDataViewField)(a))return function({state:e,source:t,target:a,indexPatterns:n}){const i=e.layers[a.layerId].columns[a.columnId],s=e.layers[a.layerId].indexPatternId===t.indexPatternId,l=Sd(t.field,a.filterOperations,i);if(s&&l){const s=Cd[l].displayName;if(!i)return{dropTypes:["field_add"],nextLabel:s};if(Object(Ul.c)(i)&&i.sourceField!==t.field.name||!Object(Ul.c)(i)){const l=n[e.layers[a.layerId].indexPatternId];return Object(Ul.c)(i)&&l&&yc(l,i,void 0,t.field)?{dropTypes:["field_replace","field_combine"]}:{dropTypes:["field_replace"],nextLabel:s}}}}({...e,source:a,target:s});if(Object(Md.e)(a)){var l,r;const e={...a,column:null===(l=t.layers[a.layerId])||void 0===l?void 0:l.columns[a.columnId],dataView:i[null===(r=t.layers[a.layerId])||void 0===r?void 0:r.indexPatternId]};if(!e.column)return;var o;if(n.columnId!==a.columnId&&s.dataView===e.dataView)return Object(Gt.isOperationFromTheSameGroup)(a,n)?s.column?{dropTypes:["reorder"]}:{dropTypes:["duplicate_compatible"]}:null!==(o=s.filterOperations)&&void 0!==o&&o.call(s,null==e?void 0:e.column)?function(e,t){var a;if(!t.column)return{dropTypes:["move_compatible","duplicate_compatible"]};const n=["replace_compatible","replace_duplicate_compatible",...(null===(a=e.filterOperations)||void 0===a?void 0:a.call(e,t.column))?["swap_compatible"]:[]];return t.dataView&&Object(Ul.c)(t.column)?(yc(t.dataView,t.column,e.column)&&n.push("combine_compatible"),{dropTypes:n}):{dropTypes:n}}(e,s):function(e,t){const a=t?xc(t):[],n=new Set(xc(e));return a.length===n.size&&a.every((e=>n.has(e)))}(e.column,s.column)?void 0:function(e,t){if(!t.dataView||!e.column)return;const a=Sd(Fd(e.column,e.dataView),t.filterOperations,t.column);if(a){const n=Fd(t.column,t.dataView),i=Boolean(Sd(n,e.filterOperations,e.column)),s=[];return t.column?(s.push("replace_incompatible","replace_duplicate_incompatible"),i&&s.push("swap_incompatible"),yc(t.dataView,t.column,e.column)&&s.push("combine_incompatible")):s.push("move_incompatible","duplicate_incompatible"),{dropTypes:s,nextLabel:Cd[a].displayName}}}(e,s)}}function Pd(e){const{target:t,source:a,dropType:n,state:i,indexPatterns:s}=e;if(Object(Gt.isDraggedDataViewField)(a)&&Ad(n))return function(e,t){var a,n;const{setState:i,state:s,source:l,target:r,targetLayerDimensionGroups:o,indexPatterns:u}=e,c=null===(a=o.find((e=>e.groupId===r.groupId)))||void 0===a?void 0:a.prioritizedOperation,d=s.layers[r.layerId],p=u[d.indexPatternId],m=d.columns[r.columnId],g=new Set(Object.values(d.columns).filter((e=>"sourceField"in e&&e.sourceField===l.field.name)).map((e=>e.operationType))),f=t?m.operationType:Sd(l.field,r.filterOperations,m,c,g);if(!Object(Gt.isDraggedDataViewField)(l)||!f||t&&!yc(p,m,void 0,l.field))return!1;const b=t?Fd(m,p):l.field,h=t?{params:(null===(n=vc(m.operationType))||void 0===n?void 0:n({targetColumn:m,field:l.field,indexPattern:p}))||{}}:void 0,x=rr({layer:d,columnId:r.columnId,indexPattern:p,op:f,field:b,visualizationGroups:o,targetGroup:r.groupId,shouldCombineField:t,initialParams:h});return i(Lc({state:s,layerId:r.layerId,newLayer:x})),!0}({...e,target:{...t,dataView:s[i.layers[t.layerId].indexPatternId]},source:a,indexPatterns:s},"field_combine"===n);if(!Object(Md.e)(a))return!1;const l=s[i.layers[a.layerId].indexPatternId],r=s[i.layers[t.layerId].indexPatternId];if(l!==r)return!1;const o={...e,target:{...t,dataView:r},source:{...a,dataView:l},indexPatterns:s};return"reorder"===n?function({setState:e,state:t,source:a,target:n}){return e(Lc({state:t,layerId:n.layerId,newLayer:{columnOrder:function(e,t,a){const n=e.filter((e=>e!==a)),i=e.findIndex((e=>e===a)),s=e.findIndex((e=>e===t)),l=n.indexOf(t);return n.splice(i<s?l+1:l,0,a),n}(t.layers[n.layerId].columnOrder,n.columnId,a.columnId)}})),!0}(o):["duplicate_compatible","replace_duplicate_compatible","move_compatible","replace_compatible"].includes(n)?function({setState:e,state:t,source:a,target:n,targetLayerDimensionGroups:i}){let s=lr({layers:t.layers,target:n,source:a});const l=br(i,kr(s[n.layerId]),n.groupId,n.columnId);return s={...s,[n.layerId]:{...s[n.layerId],columnOrder:l,columns:s[n.layerId].columns}},e(Dc({state:t,newLayers:s})),!0}(o):["duplicate_incompatible","replace_duplicate_incompatible","move_incompatible","replace_incompatible"].includes(n)?function({setState:e,state:t,source:a,targetLayerDimensionGroups:n,target:i,indexPatterns:s}){const l=t.layers[i.layerId],r=l.columns[i.columnId]||null,o=t.layers[a.layerId],u=s[o.indexPatternId],c=Fd(o.columns[a.columnId],u),d=Sd(c,i.filterOperations,r);if(!d)return!1;if(i.layerId===a.layerId){const a=rr({layer:o,columnId:i.columnId,indexPattern:u,op:d,field:c,visualizationGroups:n,targetGroup:i.groupId,shouldResetLabel:!0});return e(Lc({state:t,layerId:i.layerId,newLayer:a})),!0}{const s=rr({layer:l,columnId:i.columnId,indexPattern:u,op:d,field:c,visualizationGroups:n,targetGroup:i.groupId,shouldResetLabel:!0});return e(Dc({state:t,newLayers:{[a.layerId]:o,[i.layerId]:s}})),!0}}(o):"swap_compatible"===n?function({setState:e,state:t,source:a,targetLayerDimensionGroups:n,target:i}){if(i.layerId===a.layerId){const s=t.layers[i.layerId],l={...s.columns,[i.columnId]:{...s.columns[a.columnId]},[a.columnId]:{...s.columns[i.columnId]}};let r=((e,t,a)=>{const n=e.findIndex((e=>e===t)),i=e.findIndex((e=>e===a)),s=[...e];return s[n]=a,s[i]=t,s})(s.columnOrder,a.columnId,i.columnId);return r=br(n,r,i.groupId,i.columnId),e(Lc({state:t,layerId:i.layerId,newLayer:{columnOrder:r,columns:l}})),!0}{const n=lr({layers:t.layers,target:i,source:a,shouldDeleteSource:!0})[i.layerId],s=lr({layers:t.layers,target:a,source:i,shouldDeleteSource:!0})[a.layerId];return e(Dc({state:t,newLayers:{[a.layerId]:s,[i.layerId]:n}})),!0}}(o):"swap_incompatible"===n?function({setState:e,state:t,source:a,targetLayerDimensionGroups:n,target:i,indexPatterns:s}){const l=t.layers[i.layerId],r=t.layers[a.layerId],o=s[l.indexPatternId],u=r.columns[a.columnId],c=l.columns[i.columnId],d=Fd(u,o),p=Fd(c,o),m=Sd(d,i.filterOperations,c),g=Sd(p,a.filterOperations,u);if(!m||!g)return!1;const f=rr({layer:l,columnId:i.columnId,targetGroup:i.groupId,indexPattern:o,op:m,field:d,visualizationGroups:n,shouldResetLabel:!0});if(a.layerId===i.layerId){const s=rr({layer:f,columnId:a.columnId,indexPattern:o,op:g,field:p,visualizationGroups:n,targetGroup:a.groupId,shouldResetLabel:!0});return e(Lc({state:t,layerId:i.layerId,newLayer:s})),!0}{const s=rr({layer:r,columnId:a.columnId,indexPattern:o,op:g,field:p,visualizationGroups:n,targetGroup:a.groupId,shouldResetLabel:!0});return e(Dc({state:t,newLayers:{[a.layerId]:s,[i.layerId]:f}})),!0}}(o):["combine_incompatible","combine_compatible"].includes(n)?function({state:e,setState:t,source:a,target:n,targetLayerDimensionGroups:i,indexPatterns:s}){var l,r;const o=e.layers[n.layerId],u=o.columns[n.columnId],c=Fd(u,n.dataView),d=s[o.indexPatternId],p=e.layers[a.layerId].columns[a.columnId];if(!Fd(p,d)||!c)return!1;const m={params:null!==(l=null===(r=vc(u.operationType))||void 0===r?void 0:r({targetColumn:u,sourceColumn:p,indexPattern:d}))&&void 0!==l?l:{}},g=dr({layer:o,columnId:n.columnId,indexPattern:d,op:u.operationType,field:c,visualizationGroups:i,targetGroup:n.groupId,initialParams:m,shouldCombineField:!0});return t(Dc({state:e,newLayers:{...e.layers,[n.layerId]:g}})),!0}(o):void 0}const Ad=e=>["field_add","field_replace","field_combine"].includes(e);a(356);var _d=a(4),Ld=a(72),Dd=a(86),Nd=(a(368),a(121)),Rd=a(37),Bd=a(3),Vd=a(81);function zd(e){if(1===e.length&&1===e[0].length)return e[0][0].query;const t=e.filter((e=>e.length)).map((e=>e.length>1?`( ${e.map((({query:e})=>`( ${e} )`)).join(" OR ")} )`:`( ${e[0].query} )`)).join(" AND ");return e.length>1?`( ${t} )`:t}function Gd(e,t,a,n,i,s){var l,r;const o=Boolean((null===(l=s.navLinks)||void 0===l?void 0:l.discover)&&(null===(r=s.discover)||void 0===r?void 0:r.show)),[c,...d]=Object.values(a||{});if(!c||!e||!t)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataNoData",{defaultMessage:"Visualization has no data available to show"}),isVisible:o};if(d.length)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataMultipleLayers",{defaultMessage:"Cannot show underlying data for visualizations with multiple layers"}),isVisible:o};let p;try{const[a]=e.getLayers(t);p=e.getPublicAPI({layerId:a,state:t,indexPatterns:n})}catch(e){return Object(Vd.c)(e),{meta:void 0,error:e.message,isVisible:o}}const m=p.getTableSpec(),g=m.filter((({columnId:e})=>{var t;return!(null!==(t=p.getOperationForColumnId(e))&&void 0!==t&&t.hasTimeShift)}));if(g.length<m.length)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataTimeShifts",{defaultMessage:"Cannot show underlying data when there's a time shift configured"}),isVisible:o};const f=p.getFilters(a,i);if("error"in f)return{meta:void 0,error:f.error,isVisible:o};const b=[...new Set(g.map((({fields:e})=>e)).flat())];return{meta:{id:p.getSourceId(),columns:b,filters:f},error:void 0,isVisible:o}}function qd(e,t,a,n,i){var s,l;const r={kuery:[],lucene:[]},o=(Array.isArray(e)?e:e&&Object(ys.isOfQueryType)(e)?[e]:[]).filter((e=>Boolean("string"==typeof e.query?e.query.trim():e.query)));[r.lucene,r.kuery]=Object(jt.partition)(o,(e=>"lucene"===e.language));const c=(null===(s=o[0])||void 0===s?void 0:s.language)||"kuery",d={language:c,query:zd([...r[c].map((e=>[e])),...a.filters.enabled[c]||[]])},p="lucene"===c?"kuery":"lucene",m=[...t],g=null==n?void 0:n.find((({id:e})=>e===a.id));if(Boolean((null===(l=a.filters.enabled[p])||void 0===l?void 0:l.length)||r[p].length)){const e=zd([...r[p].map((e=>[e])),...a.filters.enabled[p]||[]]);m.push(Object(ys.buildCustomFilter)(a.id,Object(ys.buildEsQuery)(g,{language:p,query:e},[],i),!1,!1,u.i18n.translate("xpack.lens.app.lensContext",{defaultMessage:"Lens context ({language})",values:{language:p}}),ys.FilterStateStore.APP_STATE))}for(const e of["lucene","kuery"]){const[t]=a.filters.disabled[e]||[];for(const n of t||[]){let t=n.query;"lucene"===e&&(t+=` (${e})`),m.push(Object(ys.buildCustomFilter)(a.id,Object(ys.buildEsQuery)(g,n,[],i),!0,!1,t,ys.FilterStateStore.APP_STATE))}}return{filters:m,query:d}}function Hd(e){return e?e.replace(/\./g,".​"):""}const $d=function(e,t=256){const a=Object(s.memo)(e);return e=>{const[n,i]=Object(s.useState)(e),r=Object(s.useMemo)((()=>Object(jt.debounce)(i,t)),[i]);return Object(s.useEffect)((()=>()=>r.cancel()),[r]),r(e),l.a.createElement(a,n)}}((function(e){var t,a;const{field:n,indexPattern:l,highlight:r,exists:o,hideDetails:c,itemIndex:p,groupIndex:m,dropOntoWorkspace:g,hasSuggestionForField:f,editField:h,removeField:x}=e,v=Object(s.useMemo)((()=>new Rd.DataViewField(n)),[n]),y=Object(d.useKibana)().services,O=null==y||null===(t=y.data)||void 0===t||null===(a=t.query)||void 0===a?void 0:a.filterManager,[k,I]=Object(s.useState)(!1),T=Object(s.useCallback)((()=>{I((e=>!e))}),[I]),w=Object(s.useCallback)((()=>{I(!1)}),[I]),M=Object(s.useMemo)((()=>O?(e,t,a)=>{w();const n=Object(Kn.generateFilters)(O,e,t,a,l);O.addFilters(n)}:void 0),[l,O,w]),C=Object(s.useMemo)((()=>h&&v.name!==at.c?e=>{w(),h(e)}:void 0),[h,w,v.name]),S=Object(s.useMemo)((()=>x?e=>{w(),x(e)}:void 0),[x,w]),F=Object(s.useMemo)((()=>({field:n,indexPatternId:l.id,id:n.name,humanData:{label:n.displayName,position:p+1}})),[n,l.id,p]),E=Object(s.useCallback)((()=>{w(),g(F)}),[g,w,F]),P=Object(s.useCallback)((()=>{I(!1)}),[I]),A=Object(s.useMemo)((()=>[0,m,p]),[m,p]),_=Object(j.jsx)(Dd.a,{type:Object(Ul.a)(n)}),L=Object(j.jsx)(b.EuiIconTip,{anchorClassName:"lnsFieldItem__infoIcon",content:c?u.i18n.translate("xpack.lens.indexPattern.fieldItemTooltip",{defaultMessage:"Drag and drop to visualize."}):o?u.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonLabel",{defaultMessage:"Click for a field preview, or drag and drop to visualize."}):u.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonEmptyLabel",{defaultMessage:"This field doesn’t have any data but you can still drag and drop to visualize."}),type:"iInCircle",color:"subdued",size:"s"});return Object(j.jsx)("li",null,Object(j.jsx)(Un.FieldPopover,{isOpen:k,closePopover:w,panelClassName:"lnsFieldItem__fieldPanel",initialFocus:".lnsFieldItem__fieldPanel",className:"lnsFieldItem__popoverAnchor","data-test-subj":"lnsFieldListPanelField",panelProps:{"data-test-subj":"lnsFieldListPanelFieldContent"},container:document.querySelector(".application")||void 0,button:Object(j.jsx)(Ld.c,{draggable:!0,order:A,value:F,dataTestSubj:`lnsFieldListPanelField-${n.name}`,onDragStart:P},Object(j.jsx)(Nd.a,{className:`lnsFieldItem lnsFieldItem--${n.type} lnsFieldItem--${o?"exists":"missing"}`,isActive:k,onClick:T,buttonProps:{"aria-label":u.i18n.translate("xpack.lens.indexPattern.fieldStatsButtonAriaLabel",{defaultMessage:"Preview {fieldName}: {fieldType}",values:{fieldName:n.displayName,fieldType:n.type}})},fieldIcon:_,fieldName:Object(j.jsx)(b.EuiHighlight,{search:Hd(r)},Hd(n.displayName)),fieldInfoIcon:L})),renderHeader:()=>{const e=f(F),t=e?u.i18n.translate("xpack.lens.indexPattern.moveToWorkspace",{defaultMessage:"Add {field} to workspace",values:{field:F.field.name}}):u.i18n.translate("xpack.lens.indexPattern.moveToWorkspaceDisabled",{defaultMessage:"This field can't be added to the workspace automatically. You can still use it directly in the configuration panel."});return Object(j.jsx)(Un.FieldPopoverHeader,{field:v,closePopover:w,buttonAddFieldToWorkspaceProps:{isDisabled:!e,"aria-label":t},onAddFieldToWorkspace:E,onAddFilter:M,onEditField:C,onDeleteField:S})},renderContent:c?void 0:()=>Object(j.jsx)(Wd,i()({},e,{dataViewField:v,onAddFilter:M}))}))}));function Wd(e){const{query:t,filters:a,indexPattern:n,dataViewField:i,dateRange:r,core:o,onAddFilter:c,uiActions:p}=e,m=Object(d.useKibana)().services,g=Object(s.useMemo)((()=>{const e={id:n.id,columns:[i.name],filters:{enabled:{lucene:[],kuery:[]},disabled:{lucene:[],kuery:[]}}},{filters:s,query:l}=qd(t,a,e,[n],Object(Kn.getEsQueryConfig)(m.uiSettings));if(m.discover&&m.application.capabilities.discover.show)return m.discover.locator.getRedirectUrl({dataViewSpec:null==n?void 0:n.spec,timeRange:m.data.query.timefilter.timefilter.getTime(),filters:s,query:l,columns:e.columns})}),[i.name,a,n,t,m]);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(Un.FieldStats,{services:m,query:t,filters:a,fromDate:r.fromDate,toDate:r.toDate,dataViewOrDataViewId:n.id,onAddFilter:c,field:i,"data-test-subj":"lnsFieldListPanel",overrideMissingContent:e=>{if("no-data"===e.reason){const e=o.uiSettings.get("lens:useFieldExistenceSampling");return Object(j.jsx)(b.EuiText,{size:"s","data-test-subj":"lnsFieldListPanel-missingFieldStats"},e?u.i18n.translate("xpack.lens.indexPattern.fieldStatsSamplingNoData",{defaultMessage:"Lens is unable to create visualizations with this field because it does not contain data in the first 500 documents that match your filters. To create a visualization, drag and drop a different field."}):u.i18n.translate("xpack.lens.indexPattern.fieldStatsNoData",{defaultMessage:"Lens is unable to create visualizations with this field because it does not contain data. To create a visualization, drag and drop a different field."}))}return"unsupported"===e.reason?Object(j.jsx)(b.EuiText,{"data-test-subj":"lnsFieldListPanel-missingFieldStats"},e.element):e.element}}),"geo_point"===i.type||"geo_shape"===i.type?Object(j.jsx)(Un.FieldPopoverVisualize,{field:i,dataView:{...n,toSpec:()=>n.spec},originatingApp:Bd.APP_ID,uiActions:p,buttonProps:{"data-test-subj":`lensVisualize-GeoField-${i.name}`}}):g?Object(j.jsx)(b.EuiPopoverFooter,null,Object(j.jsx)(b.EuiButton,{fullWidth:!0,size:"s",href:g,target:"_blank","data-test-subj":`lnsFieldListPanel-exploreInDiscover-${i.name}`},u.i18n.translate("xpack.lens.indexPattern.fieldExploreInDiscover",{defaultMessage:"Explore values in Discover"}))):null)}const Ud=new Set(["string","number","boolean","date","ip","number_range","date_range","ip_range","histogram","document","geo_point","geo_shape","murmur3"]),Xd={document:u.i18n.translate("xpack.lens.datatypes.record",{defaultMessage:"Record"}),string:u.i18n.translate("xpack.lens.datatypes.string",{defaultMessage:"Text string"}),number:u.i18n.translate("xpack.lens.datatypes.number",{defaultMessage:"Number"}),gauge:u.i18n.translate("xpack.lens.datatypes.gauge",{defaultMessage:"Gauge metric"}),counter:u.i18n.translate("xpack.lens.datatypes.counter",{defaultMessage:"Counter metric"}),boolean:u.i18n.translate("xpack.lens.datatypes.boolean",{defaultMessage:"Boolean"}),date:u.i18n.translate("xpack.lens.datatypes.date",{defaultMessage:"Date"}),ip:u.i18n.translate("xpack.lens.datatypes.ipAddress",{defaultMessage:"IP address"}),histogram:u.i18n.translate("xpack.lens.datatypes.histogram",{defaultMessage:"Histogram"}),geo_point:u.i18n.translate("xpack.lens.datatypes.geoPoint",{defaultMessage:"Geographic point"}),geo_shape:u.i18n.translate("xpack.lens.datatypes.geoShape",{defaultMessage:"Geographic shape"}),murmur3:u.i18n.translate("xpack.lens.datatypes.murmur3",{defaultMessage:"murmur3"})};function Yd(e){return Ud.has(e.type)}function Kd({state:e,dragDropContext:t,core:a,data:n,dataViews:i,fieldFormats:r,query:o,filters:d,dateRange:p,charts:m,indexPatternFieldEditor:g,showNoDataPopover:f,dropOntoWorkspace:h,hasSuggestionForField:x,uiActions:v,indexPatternService:y,frame:O,onIndexPatternRefresh:k,usedIndexPatterns:I,layerFields:T}){const{indexPatterns:w,indexPatternRefs:M}=O.dataViews,{currentIndexPatternId:C}=e,S=Object(s.useMemo)((()=>Object(jt.uniq)((null!=I?I:Object.values(e.layers).map((({indexPatternId:e})=>e))).concat(C)).filter((e=>!!w[e])).sort().map((e=>w[e]))),[I,w,e.layers,C]);return Object(j.jsx)(l.a.Fragment,null,0===Object.keys(w).length&&0===M.length?Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"m",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{grow:null},Object(j.jsx)(b.EuiCallOut,{"data-test-subj":"indexPattern-no-indexpatterns",title:u.i18n.translate("xpack.lens.indexPattern.noDataViewsLabel",{defaultMessage:"No data views"}),color:"warning",iconType:"alert"},Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.noDataViewDescription",defaultMessage:"Please create a data view or switch to another data source"}))))):Object(j.jsx)(Jd,{currentIndexPatternId:C,query:o,dateRange:p,filters:d,dragDropContext:t,core:a,data:n,dataViews:i,fieldFormats:r,charts:m,indexPatternFieldEditor:g,dropOntoWorkspace:h,hasSuggestionForField:x,uiActions:v,indexPatternService:y,onIndexPatternRefresh:k,frame:O,layerFields:T,showNoDataPopover:f,activeIndexPatterns:S}))}const Qd=Object(b.htmlIdGenerator)("datapanel")(),Zd=function({currentIndexPatternId:e,query:t,dateRange:a,filters:n,dragDropContext:i,core:l,data:r,dataViews:o,fieldFormats:c,indexPatternFieldEditor:d,charts:p,dropOntoWorkspace:m,hasSuggestionForField:g,uiActions:f,indexPatternService:h,frame:x,onIndexPatternRefresh:v,layerFields:y,showNoDataPopover:O,activeIndexPatterns:I}){const[T,w]=Object(s.useState)({nameFilter:"",typeFilter:[],isTypeFilterOpen:!1,isAvailableAccordionOpen:!0,isEmptyAccordionOpen:!1,isMetaAccordionOpen:!1}),{indexPatterns:M}=x.dataViews,C=M[e],{refetchFieldsExistenceInfo:S,isProcessing:F}=Object(Un.useExistingFieldsFetcher)({dataViews:I,query:t,filters:n,fromDate:a.fromDate,toDate:a.toDate,services:{data:r,dataViews:o,core:l},onNoData:t=>{t===e&&O()}}),E=Object(Un.useExistingFieldsReader)(),P=E.getFieldsExistenceStatus(e),A=f.getTrigger(_d.VISUALIZE_GEO_FIELD_TRIGGER),_=Object(s.useMemo)((()=>C?A?C.fields:C.fields.filter((({type:e})=>"geo_point"!==e&&"geo_shape"!==e)):[]),[C,A]),L=Object(jt.uniq)([...Object(jt.uniq)(_.map(Ul.a)).filter((e=>e in Xd)),...T.typeFilter]),D=d.userPermissions.editIndexPattern()||!C.isPersisted,N=Object(s.useCallback)((e=>Boolean(null==y?void 0:y.includes(e.name))),[y]),R=Object(s.useCallback)((e=>!(T.nameFilter.length&&!e.name.toLowerCase().includes(T.nameFilter.toLowerCase())&&!e.displayName.toLowerCase().includes(T.nameFilter.toLowerCase()))&&(!(T.typeFilter.length>0)||T.typeFilter.includes(Object(Ul.a)(e)))),[T]),B=Boolean(n.length),V=Object(s.useCallback)((e=>e===Un.FieldsGroupNames.AvailableFields?{helpText:l.uiSettings.get("lens:useFieldExistenceSampling")?u.i18n.translate("xpack.lens.indexPattern.allFieldsSamplingLabelHelp",{defaultMessage:"Available fields contain the data in the first 500 documents that match your filters. To view all fields, expand Empty fields. You are unable to create visualizations with full text, geographic, flattened, and object fields."}):u.i18n.translate("xpack.lens.indexPattern.allFieldsLabelHelp",{defaultMessage:"Drag and drop available fields to the workspace and create visualizations. To change the available fields, select a different data view, edit your queries, or use a different time range. Some field types cannot be visualized in Lens, including full text and geographic fields."}),isAffectedByGlobalFilter:B}:e===Un.FieldsGroupNames.SelectedFields?{isAffectedByGlobalFilter:B}:void 0),[l.uiSettings,B]),{fieldGroups:z}=Object(Un.useGroupedFields)({dataViewId:e,allFields:_,services:{dataViews:o},fieldsExistenceReader:E,onFilterField:R,onSupportedFieldFilter:Yd,onSelectedFieldFilter:N,onOverrideFieldGroupDetails:V}),G=Object(s.useRef)();Object(s.useEffect)((()=>()=>{G.current&&G.current()}),[]);const q=Object(s.useCallback)((async()=>{if(C){const e=await h.loadIndexPatterns({patterns:[C.id],cache:{},onIndexPatternRefresh:v});h.updateDataViewsState({indexPatterns:{...x.dataViews.indexPatterns,[C.id]:e[C.id]}})}r.search.session.start()}),[h,C,v,x.dataViews.indexPatterns,r.search.session]),H=Object(s.useMemo)((()=>D?async(e,t="edit")=>{const a=await o.get(null==C?void 0:C.id);G.current=d.openEditor({ctx:{dataView:a},fieldName:e,onSave:()=>{a.isPersisted()?(q(),S(a.id)):h.replaceDataViewId(a)}})}:void 0),[D,o,null==C?void 0:C.id,d,q,h,S]),$=Object(s.useMemo)((()=>D?async e=>{const t=await o.get(null==C?void 0:C.id);G.current=d.openDeleteModal({ctx:{dataView:t},fieldName:e,onDelete:()=>{t.isPersisted()?(q(),S(t.id)):h.replaceDataViewId(t)}})}:void 0),[null==C?void 0:C.id,o,D,d,h,q,S]),W=Object(s.useCallback)((({field:e,itemIndex:i,groupIndex:s,hideDetails:r})=>Object(j.jsx)($d,{field:e,exists:Object(k.z)(e.name,C,E.hasFieldData),hideDetails:r||"document"===e.type,itemIndex:i,groupIndex:s,dropOntoWorkspace:m,hasSuggestionForField:g,editField:H,removeField:$,uiActions:f,core:l,fieldFormats:c,indexPattern:C,highlight:T.nameFilter.toLowerCase(),dateRange:a,query:t,filters:n,chartsThemeService:p.theme})),[l,c,C,a,t,n,T.nameFilter,p.theme,E.hasFieldData,m,g,H,$,f]);return Object(j.jsx)(Ld.a,i,Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"none",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},F&&Object(j.jsx)(b.EuiProgress,{size:"xs",color:"accent",position:"absolute"}),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiFormControlLayout,{icon:"search",fullWidth:!0,clear:{title:u.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),"aria-label":u.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),onClick:()=>{w((e=>({...e,nameFilter:"",typeFilter:[]})))}},append:Object(j.jsx)(b.EuiPopover,{id:"dataPanelTypeFilter",panelClassName:"euiFilterGroup__popoverPanel",panelPaddingSize:"none",anchorPosition:"rightUp",display:"block",isOpen:T.isTypeFilterOpen,closePopover:()=>w((()=>({...T,isTypeFilterOpen:!1}))),button:Object(j.jsx)(b.EuiFilterButton,{"aria-label":u.i18n.translate("xpack.lens.indexPatterns.filterByTypeAriaLabel",{defaultMessage:"Filter by type"}),color:"primary",isSelected:T.isTypeFilterOpen,numFilters:T.typeFilter.length,hasActiveFilters:!!T.typeFilter.length,numActiveFilters:T.typeFilter.length,"data-test-subj":"lnsIndexPatternFiltersToggle",className:"lnsFilterButton",onClick:()=>{w((e=>({...e,isTypeFilterOpen:!T.isTypeFilterOpen})))}},Object(j.jsx)(b.EuiIcon,{type:"filter"}))},Object(j.jsx)(b.EuiContextMenuPanel,{"data-test-subj":"lnsIndexPatternTypeFilterOptions",items:L.map((e=>Object(j.jsx)(b.EuiContextMenuItem,{className:"lnsInnerIndexPatternDataPanel__filterType",key:e,icon:T.typeFilter.includes(e)?"check":"empty","data-test-subj":`typeFilter-${e}`,onClick:()=>{w((t=>({...t,typeFilter:T.typeFilter.includes(e)?T.typeFilter.filter((t=>t!==e)):[...T.typeFilter,e]})))}},Object(j.jsx)("span",{className:"lnsInnerIndexPatternDataPanel__filterTypeInner"},Object(j.jsx)(Dd.a,{type:e})," ",Xd[e]))))}))},Object(j.jsx)("input",{className:"euiFieldText euiFieldText--fullWidth lnsInnerIndexPatternDataPanel__textField","data-test-subj":"lnsIndexPatternFieldSearch",placeholder:u.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the data view for the provided text"}),value:T.nameFilter,onChange:e=>{w({...T,nameFilter:e.target.value})},"aria-label":u.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the data view for the provided text"}),"aria-describedby":Qd}))),Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(Un.FieldListGrouped,{fieldGroups:z,fieldsExistenceStatus:P,fieldsExistInIndex:!!_.length,renderFieldItem:W,screenReaderDescriptionForSearchInputId:Qd,"data-test-subj":"lnsIndexPattern"}))))},Jd=Object(s.memo)(Zd);function ep({state:e,updatedLayer:t,layerId:a,label:n,changeType:i}){const s=t?{...e,layers:{...e.layers,[a]:t}}:e,l=Object(jt.mapValues)(s.layers,(e=>({...e,columns:Object(jt.pick)(e.columns,e.columnOrder)}))),r=l[a].columnOrder,o=l[a].columns,u=Object.values(o).some((e=>e.isBucketed));return{state:{...s,layers:l},table:{columns:r.filter((e=>!Mr(l[a],e))).map((e=>({columnId:e,operation:kp(o[e])}))),isMultiRow:u,layerId:a,changeType:i,label:n},keptLayerIds:Object.keys(e.layers)}}function tp(e,t,a){return function(e,t,a){const n=[];return t.forEach((t=>{const i=a[t.indexPatternId];if(!i)return[];const s=function(e,t){const a=function(e,t){return e.reduce(((a,n)=>{if(!e.some((e=>ap(e)&&n.columnId===e.references[0]))){const s=lp(n,t);if(ap(n)){const a=e.find((e=>e.columnId===n.references[0]));s.references=[lp(a,t)]}if(function(e){return"terms"===e.operationType}(n)&&n.params.orderAgg&&s.columnParams&&!e.some((e=>{var t;return e.columnId===(null===(t=n.params.orderAgg)||void 0===t?void 0:t.columnId)}))){var i;const e=n.params.orderAgg,a=gc[e.operationType],l={indexPatternId:t.id,columns:{},columnOrder:[]};s.columnParams.orderAgg=a.buildColumn({previousColumn:{...n.params.orderAgg,label:(null===(i=n.params.orderAgg)||void 0===i?void 0:i.label)||""},indexPattern:t,layer:l,referenceIds:[],field:sp(n.params.orderAgg,t)},n.params)}a.push(s)}return a}),[])}(t.columns,e);let n={indexPatternId:e.id,columns:{},columnOrder:[]};a.forEach((a=>{if("formula"===a.op){var i;const s=gc.formula,l=t.columns.find((e=>e.columnId===a.columnId)),r=s.buildColumn({previousColumn:{...l,label:(null==l?void 0:l.label)||(null===(i=a.columnParams)||void 0===i?void 0:i.formula)||""},indexPattern:e,layer:n},a.columnParams);n=Gl(a.columnId,r,n,{indexPattern:e}).layer}else n=ur({...a,layer:n,respectOrder:!0})}));let i=n;return t.columns.forEach((({columnId:e,label:t})=>{t&&(i=function({layer:e,columnId:t,customLabel:a}){const n=e.columns[t];return{...e,columns:{...e.columns,[t]:{...n,label:void 0!==a?a:n.label,customLabel:Boolean(a)}}}}({layer:i,columnId:e,customLabel:Mr(i,e)?"":t}))})),i}(i,t),l=ep({state:e,updatedLayer:s,layerId:t.layerId,changeType:"initial"});n.push(l)})),n}(e,t,a)}function ap(e){return"references"in e&&e.references.length>0}function np(e){return{...e.params}}function ip(e){return{filter:e.filter,timeShift:e.timeShift,timeScale:e.timeScale,dataType:e.dataType,...e.reducedTimeRange&&{reducedTimeRange:e.reducedTimeRange}}}function sp(e,t){const a=function(e,t){return function(e){return"sourceField"in e}(e)?"document"===e.sourceField?Vl.a:t.getFieldByName(e.sourceField):void 0}(e,t);return a&&e.label?{...a,customLabel:e.label}:a}function lp(e,t){return{op:e.operationType,columnId:e.columnId,field:sp(e,t),indexPattern:t,visualizationGroups:[],incompleteParams:ip(e),initialParams:{params:np(e)},columnParams:np(e)}}function rp(e,t,a,n){const i=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t)),s=n[t],l=null==s?void 0:s.getFieldByName(a);if(0!==i.length||!l)return[];const r=Object(Ge.a)();return up(e,r,t,l,n).concat(up({...e,layers:{}},r,t,l,n))}function op(e){if("number"!==e.type)return jc(e).find((e=>"date_histogram"===e||"terms"===e))}function up(e,t,a,n,i){const s=i[a];let l;const r=op(n);var o,u;r?l=function(e,t,a){return ur({op:a,layer:ur({op:"count",layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(Ge.a)(),field:Vl.a,indexPattern:e,visualizationGroups:[]}),columnId:Object(Ge.a)(),field:t,indexPattern:e,visualizationGroups:[]})}(s,n,r):s.timeFieldName&&jc(n).length>0&&(l=function(e,t){const a=e.getFieldByName(e.timeFieldName),[n]=xr(t);if(n)return ur({op:"date_histogram",layer:ur({op:n.type,layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(Ge.a)(),field:t,indexPattern:e,visualizationGroups:[]}),columnId:Object(Ge.a)(),field:a,indexPattern:e,visualizationGroups:[]})}(s,n)),l&&(l.sampling=null!==(o=null===(u=e.layers[t])||void 0===u?void 0:u.sampling)&&void 0!==o?o:1);const c=l?[ep({state:e,updatedLayer:l,layerId:t,changeType:"initial"})]:[],d=dp(s,t,e,n);return d?c.concat(d):c}function cp(e,t,a=(()=>!0)){const n=Object.entries(e.layers||{}).filter((([e])=>a(e)));return n.length>1?n.map((([a,i],s)=>{const l=n.some((([e,t])=>e!==a&&t.indexPatternId===i.indexPatternId))?u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerPositionLabel",{defaultMessage:"Show only layer {layerNumber}",values:{layerNumber:s+1}}):u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerLabel",{defaultMessage:"Show only {indexPatternTitle}",values:{indexPatternTitle:t[i.indexPatternId].title}});return ep({state:{...e,layers:{[a]:i}},layerId:a,changeType:"layers",label:l})})).concat([ep({state:e,layerId:n[0][0],changeType:"unchanged"})]):Object(jt.flatten)(n.filter((([e,t])=>t.columnOrder.length&&t.indexPatternId)).map((([a,n])=>{const i=t[n.indexPatternId],[s,l,r]=Ir(n),o=n.columnOrder.find((e=>n.columns[e].isBucketed&&"date"===n.columns[e].dataType)),u=(null==i?void 0:i.timeFieldName)&&i.getFieldByName(i.timeFieldName),c=1===s.length&&s.some((e=>"number"===n.columns[e].dataType)),d=[];return d.push(ep({state:e,layerId:a,changeType:"unchanged"})),!r.length&&l.length&&0===s.length?(u&&s.length<1&&!Fr(n)&&d.push(mp(e,a,u,t)),i&&d.push(...function(e,t,a){const n=a.layers[t],i=[];return n.columnOrder.filter((e=>!Mr(n,e))).forEach((s=>{const l=n.columns[s];if(!Object(Ul.c)(l))return;const r=e.getFieldByName(l.sourceField);if(!r)return;const o=xr(r).filter((({type:e})=>e!==l.operationType));if(o.length){const l=dr({layer:n,indexPattern:e,field:r,columnId:s,op:o[0].type,visualizationGroups:[]});l&&i.push(ep({state:a,layerId:t,updatedLayer:l,changeType:"initial"}))}})),i}(i,a,e))):(d.push(...function(e,t){const a=e.layers[t],[n,i]=Object(jt.partition)(a.columnOrder,(e=>a.columns[e].isBucketed)),s=i.filter((e=>!Mr(a,e)));return Object(jt.flatten)(n.map(((e,t)=>{const l=n.slice(0,t+1),r={...a,columnOrder:[...l,...i],noBuckets:!1};return l.length>0&&s.length>1?[{...a,columnOrder:[...l,s[0],...Sr(a,s[0])],noBuckets:!1}]:n.length>1?r:[]}))).concat(n.length>0||s.length>1?s.map((e=>({...a,columnOrder:[e,...Sr(a,e)],noBuckets:!0}))):[]).map((({noBuckets:a,...n})=>ep({state:e,layerId:t,updatedLayer:n,changeType:"reduced",label:a?gp(n,1===i.length):void 0})))}(e,a)),!o&&u&&s.length<2&&!c&&!Fr(n)&&d.push(mp(e,a,u,t)),2===s.length&&d.push(function(e,t,a){var n,i;const s=e.layers[t],[l,r,...o]=s.columnOrder,u={...s,columnOrder:[r,l,...o]},c=a[e.currentIndexPatternId],d=s.columns[l],p=Object(Ul.c)(d)&&(null===(n=c.getFieldByName(d.sourceField))||void 0===n?void 0:n.displayName)||"",m=s.columns[r];return ep({state:e,layerId:t,updatedLayer:u,label:pp([Object(Ul.c)(m)&&(null===(i=c.getFieldByName(m.sourceField))||void 0===i?void 0:i.displayName)||"",p]),changeType:"reorder"})}(e,a,t))),d})))}function dp(e,t,a,n){const[i]=xr(n);if(i)return ep({layerId:t,state:a,changeType:"initial",updatedLayer:ur({layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(Ge.a)(),op:i.type,field:"count"===i.type?Vl.a:n,indexPattern:e,visualizationGroups:[]})})}function pp([e,t]){return u.i18n.translate("xpack.lens.indexpattern.suggestions.nestingChangeLabel",{defaultMessage:"{innerOperation} for each {outerOperation}",values:{innerOperation:t,outerOperation:e}})}function mp(e,t,a,n){const i=e.layers[t];return ep({state:e,layerId:t,updatedLayer:ur({layer:i,indexPattern:n[i.indexPatternId],field:a,op:"date_histogram",columnId:Object(Ge.a)(),visualizationGroups:[]}),label:u.i18n.translate("xpack.lens.indexpattern.suggestions.overTimeLabel",{defaultMessage:"Over time"}),changeType:"extended"})}function gp(e,t){const{operationType:a,label:n}=e.columns[e.columnOrder[0]];return u.i18n.translate("xpack.lens.indexpattern.suggestions.overallLabel",{defaultMessage:"{operation} overall",values:{operation:t?gc[a].displayName:n},description:"Title of a suggested chart containing only a single numerical metric calculated over all available data"})}var fp=a(93);function bp({state:e,layerId:t,onChangeIndexPattern:a,dataViews:n}){const i=e.layers[t],s=n.indexPatterns[i.indexPatternId],l=u.i18n.translate("xpack.lens.layerPanel.missingDataView",{defaultMessage:"Data view not found"}),r=n.indexPatternRefs.map((e=>{var t,a;const i=null===(t=null===(a=n.indexPatterns[e.id])||void 0===a?void 0:a.isPersisted)||void 0===t||t;return{...e,isAdhoc:!i}}));return Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(fp.a,{"data-test-subj":"indexPattern-switcher",trigger:{label:(null==s?void 0:s.name)||l,title:(null==s?void 0:s.title)||l,"data-test-subj":"lns_layerIndexPatternLabel",size:"s",fontWeight:"normal"},indexPatternId:i.indexPatternId,indexPatternRefs:r,isMissingCurrent:!s,onChangeIndexPattern:a}))}a(373);const hp={id:"lnsGeoFieldWorkspace",humanData:{label:u.i18n.translate("xpack.lens.geoFieldWorkspace.dropZoneLabel",{defaultMessage:"drop zone to open in maps"})}},xp=[1,0,0,0];function vp(e){return Object(j.jsx)("div",{className:"lnsWorkspacePanelWrapper__pageContentBody"},Object(j.jsx)(b.EuiText,{className:"lnsWorkspacePanel__emptyContent",textAlign:"center",size:"s"},Object(j.jsx)("div",null,Object(j.jsx)("h2",null,Object(j.jsx)("strong",null,Object(Gt.getVisualizeGeoFieldMessage)(e.fieldType))),Object(j.jsx)(x.g,{"aria-hidden":!0,className:"lnsWorkspacePanel__promptIllustration"}),Object(j.jsx)(Ld.c,{className:"lnsVisualizeGeoFieldWorkspacePanel__dragDrop",dataTestSubj:"lnsGeoFieldWorkspace",draggable:!1,dropTypes:["field_add"],order:xp,value:hp,onDrop:function(){e.uiActions.getTrigger(_d.VISUALIZE_GEO_FIELD_TRIGGER).exec({dataViewSpec:e.indexPattern.spec,fieldName:e.fieldName,originatingApp:Bd.APP_ID})}},Object(j.jsx)("p",null,Object(j.jsx)("strong",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.geoFieldWorkspace.dropMessage",defaultMessage:"Drop field here to open in Maps"})))))))}const yp=[1e-4,.001,.01,.1,1];var jp={name:"1989ovb",styles:"vertical-align:middle"};function Op({state:e,setState:t,layerId:a}){const n=yp.findIndex((t=>t===e.layers[a].sampling)),i=n>-1?n:yp.length-1;return Object(j.jsx)(b.EuiFormRow,{display:"rowCompressed","data-test-subj":"lns-indexPattern-random-sampling-row",fullWidth:!0,helpText:Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)(b.EuiSpacer,{size:"s"}),Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.xyChart.randomSampling.help",defaultMessage:"Lower sampling percentages increase speed, but decrease accuracy. As a best practice, use lower sampling only for large datasets. {link}",values:{link:Object(j.jsx)(b.EuiLink,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/master/search-aggregations-random-sampler-aggregation.html",target:"_blank",external:!0},Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.xyChart.randomSampling.learnMore",defaultMessage:"View documentation"}))}}))),label:Object(j.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.xyChart.randomSampling.label",{defaultMessage:"Random sampling"})," ",Object(j.jsx)(b.EuiBetaBadge,{css:jp,iconType:"beaker",label:u.i18n.translate("xpack.lens.randomSampling.experimentalLabel",{defaultMessage:"Technical preview"}),size:"s"}))},Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"none"},Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiText,{color:"subdued",size:"xs"},Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.xyChart.randomSampling.speedLabel",defaultMessage:"Speed"}))),Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiRange,{"data-test-subj":"lns-indexPattern-random-sampling",value:i,onChange:n=>{t({...e,layers:{...e.layers,[a]:{...e.layers[a],sampling:yp[Number(n.currentTarget.value)]}}})},showInput:!1,showRange:!1,showTicks:!0,step:1,min:0,max:yp.length-1,ticks:yp.map(((e,t)=>({label:100*e+"%",value:t})))})),Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiText,{color:"subdued",size:"xs"},Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.xyChart.randomSampling.accuracyLabel",defaultMessage:"Accuracy"})))))}function kp(e,t,a){var n;const{dataType:i,label:s,isBucketed:l,scale:r,operationType:o,timeShift:u,reducedTimeRange:c}=e,d="sourceField"in e?null==a||null===(n=a.getFieldByName(e.sourceField))||void 0===n?void 0:n.esTypes:void 0;return{dataType:Object(Ul.d)(i),isBucketed:l,scale:r,label:t||s,isStaticValue:"static_value"===o,sortingHint:"string"===e.dataType&&null!=d&&d.includes(Kn.ES_FIELD_TYPES.VERSION)?"version":void 0,hasTimeShift:Boolean(u),hasReducedTimeRange:Boolean(c),interval:Zl("date_histogram",e)?e.params.interval:void 0}}function Ip({core:e,storage:t,data:a,unifiedSearch:n,discover:s,dataViews:l,fieldFormats:o,charts:p,dataViewFieldEditor:m,uiActions:g}){const f=e.uiSettings,h="formBased",x={id:h,initialize:(a,n,i,s,l)=>Cc({persistedState:a,references:n,defaultIndexPatternId:e.uiSettings.get("defaultIndex"),storage:t,initialContext:i,indexPatternRefs:s,indexPatterns:l}),getPersistableState:e=>function({layers:e}){const t=[],a={layers:{}};return Object.entries(e).forEach((([e,{indexPatternId:n,...i}])=>{a.layers[e]=i,t.push({type:"index-pattern",id:n,name:wc(e)})})),{savedObjectReferences:t,state:a}}(e),insertLayer:(e,t,a)=>({...e,layers:{...e.layers,[t]:Tp(e.currentIndexPatternId,a)}}),createEmptyLayer:e=>({currentIndexPatternId:e,layers:{}}),cloneLayer:(e,t,a,n)=>({...e,layers:$c(e.layers,t,a,n)}),removeLayer(e,t){const a={...e.layers};delete a[t];const n=[t];return Object.keys(a).forEach((e=>{var i;const s=null===(i=a[e])||void 0===i?void 0:i.linkToLayers;s&&s.includes(t)&&(delete a[e],n.push(e))})),{removedLayerIds:n,newState:{...e,layers:a}}},clearLayer(e,t){const a={...e.layers},n=[];return Object.keys(a).forEach((e=>{var i;const s=null===(i=a[e])||void 0===i?void 0:i.linkToLayers;s&&s.includes(t)&&(delete a[e],n.push(e))})),{removedLayerIds:n,newState:{...e,layers:{...a,[t]:Tp(e.currentIndexPatternId,e.layers[t].linkToLayers)}}}},getLayers:e=>Object.keys(null==e?void 0:e.layers),removeColumn({prevState:e,layerId:t,columnId:a,indexPatterns:n}){var i;const s=n[null===(i=e.layers[t])||void 0===i?void 0:i.indexPatternId];return Lc({state:e,layerId:t,newLayer:Or({layer:e.layers[t],columnId:a,indexPattern:s})})},initializeDimension(e,t,a,{columnId:n,groupId:i,staticValue:s,autoTimeField:l,visualizationGroups:r}){var o;const u=a[null===(o=e.layers[t])||void 0===o?void 0:o.indexPatternId];let c=e;return null!=s&&(c=Lc({state:e,layerId:t,newLayer:ur({layer:e.layers[t],op:"static_value",columnId:n,field:void 0,indexPattern:u,visualizationGroups:r,initialParams:{params:{value:s}},targetGroup:i})})),l&&u.timeFieldName&&(c=Lc({state:e,layerId:t,newLayer:ur({layer:e.layers[t],op:"date_histogram",columnId:n,field:u.fields.find((e=>e.name===u.timeFieldName)),indexPattern:u,visualizationGroups:r,targetGroup:i})})),c},syncColumns({state:e,links:t,indexPatterns:a,getDimensionGroups:n}){let i=e.layers;t.forEach((e=>{var t,s;const l={...e.from,dataView:a[null===(t=i[e.from.layerId])||void 0===t?void 0:t.indexPatternId],filterOperations:()=>!0},r={...e.to,dataView:a[null===(s=i[e.to.layerId])||void 0===s?void 0:s.indexPatternId],filterOperations:()=>!0};i=lr({layers:i,target:r,source:l});const o=br(n(r.layerId),kr(i[r.layerId]),r.groupId,r.columnId);i={...i,[r.layerId]:{...i[r.layerId],columnOrder:o,columns:i[r.layerId].columns}}}));const s=Dc({state:e,newLayers:i});return t.filter((e=>Zl("terms",s.layers[e.from.layerId].columns[e.from.columnId]))).forEach((({from:e,to:a})=>{const n=s.layers[e.layerId].columns[e.columnId];if("column"===n.params.orderBy.type){const e=n.params.orderBy.columnId,i=t.find((({from:{columnId:t}})=>t===e));i&&(s.layers[a.layerId].columns[a.columnId].params.orderBy={type:"column",columnId:i.to.columnId})}})),s},getSelectedFields(e){var t;const a=[];return null===(t=Object.values(null==e?void 0:e.layers))||void 0===t||t.forEach((e=>{const{columns:t}=e;Object.values(t).forEach((e=>{"sourceField"in e&&a.push(e.sourceField)}))})),a},toExpression:(e,t,a,n)=>function(e,t,a,n,i){return e.layers[t]?Ac(e.layers[t],a[e.layers[t].indexPatternId],n,i):null}(e,t,a,f,n),renderLayerSettings(t,i){Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(d.KibanaContextProvider,{services:{...e,data:a,dataViews:l,fieldFormats:o,charts:p,unifiedSearch:n,discover:s}},Object(j.jsx)(Op,i)))),t)},renderDataPanel(t,u){var f;const{onChangeIndexPattern:b,...h}=u,v=null==x||null===(f=x.getSelectedFields)||void 0===f?void 0:f.call(x,u.state);Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(d.KibanaContextProvider,{services:{...e,data:a,dataViews:l,fieldFormats:o,charts:p,unifiedSearch:n,discover:s}},Object(j.jsx)(Kd,i()({data:a,dataViews:l,fieldFormats:o,charts:p,indexPatternFieldEditor:m},h,{core:e,uiActions:g,onIndexPatternRefresh:Ic,layerFields:v}))))),t)},uniqueLabels(e){const t=e.layers,a={},n={};return Object.values(t).forEach((e=>{e.columns&&Object.entries(e.columns).forEach((([e,t])=>{a[e]=(e=>{let t=e;for(;n[t]>=0;){const a=++n[t];t=u.i18n.translate("xpack.lens.indexPattern.uniqueLabel",{defaultMessage:"{label} [{num}]",values:{label:e,num:a}})}return n[t]=0,t})(t.label)}))})),a},isValidColumn:(e,t,a,n)=>{const i=e.layers[a];return!Nc(i,n,t[i.indexPatternId])},renderDimensionTrigger:(s,l)=>{const u=x.uniqueLabels(l.state);Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(d.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:f,data:a,fieldFormats:o,savedObjects:e.savedObjects,docLinks:e.docLinks,unifiedSearch:n}},Object(j.jsx)(Td,i()({uniqueLabel:u[l.columnId]},l))))),s)},renderDimensionEditor:(s,u)=>{const p=x.uniqueLabels(u.state);Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(d.KibanaContextProvider,{services:{appName:"lens",storage:t,uiSettings:f,data:a,fieldFormats:o,savedObjects:e.savedObjects,docLinks:e.docLinks,http:e.http,unifiedSearch:n}},Object(j.jsx)(wd,i()({uiSettings:f,storage:t,fieldFormats:o,savedObjectsClient:e.savedObjects.client,http:e.http,data:a,unifiedSearch:n,dataViews:l,uniqueLabel:p[u.columnId]},u))))),s)},renderLayerPanel:(t,a)=>{const{onChangeIndexPattern:n,...s}=a;Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(j.jsx)(bp,i()({onChangeIndexPattern:e=>{!function({state:e,layerId:t,uiActions:a,indexPatternId:n}){var i;const s=null===(i=e.layers[t])||void 0===i?void 0:i.indexPatternId;if(!s)return;const l=n,r=a.getTrigger(bs.UPDATE_FILTER_REFERENCES_TRIGGER),o=a.getAction(bs.UPDATE_FILTER_REFERENCES_ACTION);null==o||o.execute({trigger:r,fromDataView:s,toDataView:l,defaultDataView:l,usedDataViews:Object.values(Object.values(e.layers).map((e=>e.indexPatternId)))})}({indexPatternId:e,state:a.state,layerId:a.layerId,uiActions:g}),n(e,h,a.layerId)}},s))),t)},canCloseDimensionEditor:e=>!e.isDimensionClosePrevented,getDropProps:Ed,onDrop:Pd,getCustomWorkspaceRenderer:(e,t,a)=>{if(void 0===t.field||void 0===t.indexPatternId)return;const n=a[t.indexPatternId],i=t,s=i.field.esTypes&&i.field.esTypes.find((e=>["geo_point","geo_shape"].includes(e)));return s?()=>Object(j.jsx)(vp,{uiActions:g,fieldType:s,indexPattern:n,fieldName:i.field.name}):void 0},updateCurrentIndexPatternId:({state:e,indexPatternId:t,setState:a})=>{a({...e,currentIndexPatternId:t})},onRefreshIndexPattern:Ic,onIndexPatternChange:(e,a,n,i)=>i?function({indexPatternId:e,indexPatterns:t,layerIds:a,state:n,replaceIfPossible:i,storage:s}){Tc(s,e);const l={...n.layers};return a.forEach((a=>{l[a]=wr(n.layers[a],t[e])})),{...n,layers:l,currentIndexPatternId:i?e:n.currentIndexPatternId}}({indexPatternId:n,layerIds:[i,...Object.entries(e.layers).map((([e,t])=>{var a;return null!==(a=t.linkToLayers)&&void 0!==a&&a.includes(i)?e:""})).filter(Boolean)],state:e,replaceIfPossible:!0,storage:t,indexPatterns:a}):function({indexPatternId:e,state:t,storage:a,indexPatterns:n}){return Tc(a,e),{...t,layers:Sc(t.layers)?Object(jt.mapValues)(t.layers,(t=>wr(t,n[e]))):t.layers,currentIndexPatternId:e}}({indexPatternId:n,state:e,storage:t,indexPatterns:a}),onIndexPatternRename:(e,t,a)=>function({oldIndexPatternId:e,newIndexPatternId:t,state:a}){return{...a,layers:Object(jt.mapValues)(a.layers,(a=>a.indexPatternId===e?{...a,indexPatternId:t}:a)),currentIndexPatternId:a.currentIndexPatternId===e?t:e}}({state:e,oldIndexPatternId:t,newIndexPatternId:a}),getRenderEventCounters(e){var t;const a={time_shift:!1,filter:!1};return[...Object(jt.flatten)(Object.values(null!==(t=null==e?void 0:e.layers)&&void 0!==t?t:{}).map((e=>Object.values(e.columns).map((e=>(e.timeShift&&(a.time_shift=!0),e.filter&&(a.filter=!0),e.operationType)))))),...Object.entries(a).reduce(((e,[t,a])=>(a&&e.push(t),e)),[])].map((e=>`dimension_${e}`))},updateStateOnCloseDimension:({state:e,layerId:t})=>{const a=e.layers[t];if(Object.values(a.incompleteColumns||{}).length)return Lc({state:e,layerId:t,newLayer:{...a,incompleteColumns:void 0}})},getPublicAPI({state:e,layerId:t,indexPatterns:a}){const n=x.uniqueLabels(e),i=e.layers[t],s=i.columnOrder.filter((e=>!Mr(i,e)));return{datasourceId:h,getTableSpec:()=>{const e={};return Object.keys(i.columns).forEach((t=>{const a=function(e,t){const a=Cr(e);let n=t;for(;Mr(e,n);)n=a[n];return n}(i,t);e[a]=e[a]||[];const n=i.columns[t];var s;Zl("terms",n)&&e[a].push(...[n.sourceField].concat(null!==(s=n.params.secondaryFields)&&void 0!==s?s:[])),"sourceField"in n&&n.sourceField!==Bd.DOCUMENT_FIELD_NAME&&e[a].push(n.sourceField)})),s.map(((t,a)=>({columnId:t,fields:[...new Set(e[t]||[])]})))},isTextBasedLanguage:()=>!1,getOperationForColumnId:e=>i&&i.columns[e]&&!Mr(i,e)?kp(i.columns[e],n[e],a[i.indexPatternId]):null,getSourceId:()=>i.indexPatternId,getFilters:(e,n)=>function(e,t,a,n,i){const s=function(e,t){const a=Object.keys(e.columns).filter((t=>{const a=e.columns[t],n=gc[null==a?void 0:a.operationType];return!(null!=a&&a.isBucketed)&&!Zl("formula",a)&&(null==n?void 0:n.filterable)})),{filtered:n=[],unfiltered:i=[]}=Object(jt.groupBy)(a,(t=>{var a;return null!==(a=e.columns[t])&&void 0!==a&&a.filter?"filtered":"unfiltered"})),s=n.map((t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.filter})).filter((e=>{var t;return null==e||null===(t=e.query)||void 0===t?void 0:t.trim()}));return{enabled:i.length?[]:s,disabled:i.length?s:[]}}(e),[l,r]=["enabled","disabled"].map((e=>Object(jt.groupBy)(s[e],"language"))),o=t.map((t=>{const s=e.columns[t];if(Zl("filters",s)){const e=Object(jt.groupBy)(s.params.filters,(({input:e})=>e.language));return{kuery:Vc(e.kuery),lucene:Vc(e.lucene)}}return Zl("range",s)&&s.sourceField?{kuery:zc(s)}:Zl("date_histogram",s)&&i&&s.sourceField&&!s.params.ignoreTimeRange&&n.timeFieldName!==s.sourceField?n.timeFieldName?{error:u.i18n.translate("xpack.lens.indexPattern.nonDefaultTimeFieldError",{defaultMessage:'"Explore data in Discover" does not support date histograms on non-default time fields if time field is set on the data view'})}:{kuery:Gc(s,i)}:!Zl("terms",s)||s.params.otherBucket||s.params.missingBucket?void 0:!a||function(e,t){var a;const n=null==e||null===(a=e.columns.find((({id:e})=>Object(I.a)(e)===t)))||void 0===a?void 0:a.id;return!n||n!==t}(a,t)?{kuery:gc[s.operationType].getCurrentFields(s).map((e=>({query:`${e}: *`,language:"kuery"})))}:{kuery:qc(s,t,a)}})).filter(Boolean),c=o.filter((e=>e&&"error"in e));if(c.length)return{error:c.map((({error:e})=>e)).join(", ")};const d=o;return{enabled:{kuery:Hc(l,d,"kuery"),lucene:Hc(l,d,"lucene")},disabled:{kuery:[r.kuery||[]].filter((e=>e.length)),lucene:[r.lucene||[]].filter((e=>e.length))}}}(i,s,null==e?void 0:e[t],a[i.indexPatternId],n),getVisualDefaults:()=>function(e){return Object.keys(e.columns).reduce(((t,a)=>{const n=e.columns[a];if(null!=n&&n.operationType){var i;const e=gc[n.operationType],s=null===(i=e.getDefaultVisualSettings)||void 0===i?void 0:i.call(e,n);s&&(t[a]=s)}return t}),{})}(i),getMaxPossibleNumValues:e=>{if(i&&i.columns[e]){var t,a,n;const s=i.columns[e];return null!==(t=null===(a=(n=gc[s.operationType]).getMaxPossibleNumValues)||void 0===a?void 0:a.call(n,s))&&void 0!==t?t:null}return null},hasDefaultTimeField:()=>Boolean(a[i.indexPatternId].timeFieldName)}},getDatasourceSuggestionsForField:(e,t,a,n)=>Object(Gt.isDraggedDataViewField)(t)?function(e,t,a,n,i){let s=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t));if(i&&(s=s.filter(i)),0===s.length){const i=Object(Ge.a)();return up(e,i,t,a,n).concat(up({...e,layers:{}},i,t,a,n))}{const i=Object(jt.minBy)(s,(t=>e.layers[t].columnOrder.length));return 0===e.layers[i].columnOrder.length?up(e,i,t,a,n):function(e,t,a,n){const i=e.layers[t],s=n[i.indexPatternId],l=jc(a),r=op(a),o=Object.values(i.columns).some((e=>Object(Ul.c)(e)&&e.sourceField===a.name)),u=[];if(r&&!o)if("date_histogram"===r&&i.columnOrder.some((e=>"date_histogram"===i.columns[e].operationType))){const n=i.columnOrder.find((e=>"date_histogram"===i.columns[e].operationType));u.push(ep({state:e,updatedLayer:dr({layer:i,indexPattern:s,field:a,op:r,columnId:n,visualizationGroups:[]}),layerId:t,changeType:"initial"}))}else u.push(ep({state:e,updatedLayer:ur({layer:i,indexPattern:s,field:a,op:r,columnId:Object(Ge.a)(),visualizationGroups:[]}),layerId:t,changeType:"extended"}));if(!r&&l.length>0&&!o){const[n]=xr(a);if(n){const l=ur({layer:i,indexPattern:s,field:a,columnId:Object(Ge.a)(),op:n.type,visualizationGroups:[]});l&&u.push(ep({state:e,layerId:t,updatedLayer:l,changeType:"extended"}));const[,r,o]=Ir(i);if(1===r.length&&0===o.length){const l=dr({layer:i,indexPattern:s,field:a,columnId:r[0],op:n.type,visualizationGroups:[]});l&&u.push(ep({state:e,layerId:t,updatedLayer:l,changeType:"extended"}))}}}if(!o){const n=dp(s,t,e,a);n&&u.push(n)}return u}(e,i,a,n)}}(e,t.indexPatternId,t.field,n,a):[],getDatasourceSuggestionsFromCurrentState:cp,getDatasourceSuggestionsForVisualizeField:rp,getDatasourceSuggestionsForVisualizeCharts:tp,getErrorMessages(t,n){if(!t)return;const i=Object.entries(t.layers).filter((([e,t])=>!!n[t.indexPatternId])).map((([i,s])=>{var l;return(null!==(l=function(e,t,a,n,i,s){const l=Object.entries(e.columns),r=l.filter((([t,a])=>!Mr(e,t)&&"managedReference"===gc[a.operationType].input)).flatMap((([t])=>Lr(t,e.columns).map((([e])=>e)))),o=l.flatMap((([a,n])=>{if(r.includes(a))return;const i=gc[n.operationType];return i.getErrorMessage?i.getErrorMessage(e,a,t,gc):void 0})).map((e=>"object"!=typeof e?e:{...e,fixAction:e.fixAction?{...e.fixAction,newState:async t=>({...a,layers:{...a.layers,[n]:await e.fixAction.newState(s,i,t,n)}})}:void 0})).filter((e=>null!=e));return o.length?o:void 0}(s,n[s.indexPatternId],t,i,e,a))&&void 0!==l?l:[]).map((e=>({shortMessage:"",longMessage:"string"==typeof e?e:e.message,fixAction:"object"==typeof e?e.fixAction:void 0})))}));var s;if(i.length<=1)return null!==(s=i[0])&&void 0!==s&&s.length?i[0]:void 0;const l=i.flatMap(((e,t)=>e.map((e=>{const{shortMessage:a,longMessage:n}=e;return{shortMessage:a?u.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:a}}):"",longMessage:n?u.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:n}}):""}}))));return l.length?l:void 0},getWarningMessages:(t,n,i,s)=>[...xl(a.datatableUtilities,t,n)||[],...Bc(a.datatableUtilities,t,n,e.docLinks,s)],getSearchWarningMessages:(t,a,n,i)=>[...Rc(t,a,n,i,e.theme)],getDeprecationMessages:()=>{const t=[];return e.uiSettings.get("lens:useFieldExistenceSampling")&&t.push(Object(j.jsx)(b.EuiCallOut,{color:"warning",iconType:"alert",size:"s",title:Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.useFieldExistenceSamplingBody",defaultMessage:"Field existence sampling has been deprecated and will be removed in Kibana {version}. You may disable this feature in {link}.",values:{version:"8.6.0",link:Object(j.jsx)(b.EuiLink,{onClick:()=>{e.application.navigateToApp("management",{path:"/kibana/settings?query=lens:useFieldExistenceSampling"})}},Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.useFieldExistenceSampling.advancedSettings",defaultMessage:"Advanced Settings"}))}})})),t},checkIntegrity:(e,t)=>Object.values(e.layers||{}).map((({indexPatternId:e})=>e)).filter((e=>!t[e])),isTimeBased:(e,t)=>{if(!e)return!1;const{layers:a}=e;return Boolean(a)&&Object.values(a).some((e=>{var a;return Boolean(null===(a=t[e.indexPatternId])||void 0===a?void 0:a.timeFieldName)||e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>{const a=e.columns[t];return Zl("date_histogram",a)&&!a.params.ignoreTimeRange}))}))},isEqual:(e,t,a,n)=>Object(jt.isEqual)(Mc(e,t),Mc(a,n)),getUsedDataView:(e,t)=>t?e.layers[t].indexPatternId:e.currentIndexPatternId,getUsedDataViews:e=>Object.values(e.layers).map((({indexPatternId:e})=>e)),getDatasourceInfo:(e,t,a)=>{const n=t?Mc(e,t).layers:e.layers;return Object.entries(n).reduce(((e,[t,n])=>{const i=null==a?void 0:a.find((e=>e.id===n.indexPatternId)),s=Object.entries(n.columns).map((([e,t])=>({id:e,role:t.isBucketed?"split":"metric",operation:kp(t,void 0,i)})));return e.push({layerId:t,columns:s,dataView:i}),e}),[])}};return x}function Tp(e,t){return{indexPatternId:e,linkToLayers:t,columns:{},columnOrder:[],sampling:1}}var wp=a(378),Mp=a.n(wp),Cp=a(42),Sp=a(11);const Fp=Object(b.htmlIdGenerator)("datapanel-text-based-languages")();function Ep({setState:e,state:t,dragDropContext:a,core:n,data:i,query:l,filters:r,dateRange:o,expressions:c,dataViews:p,layerFields:m}){const g=Mp()(l),[f,h]=Object(s.useState)({nameFilter:""}),[x,v]=Object(s.useState)(!1);Object(s.useEffect)((()=>{!async function(){if(l&&Object(ys.isOfAggregateQueryType)(l)&&!Object(jt.isEqual)(l,g)){const a=await async function(e,t,a,n,i){var s,l,r,o;const u=await async function(e){const t=await e.getIdsWithTitle(),a=await Promise.all(t.map((t=>e.get(t.id).then((e=>e.timeFieldName)))));return t.map(((e,t)=>({...e,timeField:a[t]}))).sort(((e,t)=>e.title.localeCompare(t.title)))}(a),c=[],d=Object.keys(e.layers),p=e.initialContext,m=d.length>0?d[0]:Object(Ge.a)(),g=function(e){let t="";return"sql"in e&&(t=Object(ys.getIndexPatternFromSQLQuery)(e.sql)),t}(t),f=null!==(s=null===(l=u.find((e=>e.title===g)))||void 0===l?void 0:l.id)&&void 0!==s?s:"";let b,h=[],x=[];try{var v;const s=await function(e,t,a,n,i,s){const l=a.query.timefilter.timefilter.getTime();return Object(js.textBasedQueryStateToAstWithValidation)({filters:void 0,query:e,time:l,dataViewsService:t,inputQuery:void 0}).then((e=>{if(e){const t=n.run(e,null);let a,i;return t.pipe(Object(Cp.pluck)("result")).subscribe((e=>{const t=e;"error"===t.type?i=t.error.message:a=t})),Object(Sp.lastValueFrom)(t).then((()=>{if(i)throw new Error(i);return a}))}})).catch((e=>{throw new Error(e.message)}))}(t,a,n,i);b=(await a.get(f)).timeFieldName,h=null!==(v=null==s?void 0:s.columns)&&void 0!==v?v:[],x=((e,t)=>{const a=[...e.filter((e=>{if(null==t?void 0:t.some((t=>t.name===(null==e?void 0:e.fieldName))))return e})),...t.map((e=>({columnId:e.id,fieldName:e.id,meta:e.meta})))],n=[];return a.filter((e=>!n.includes(e.columnId)&&(n.push(e.columnId),!0)))})(e.layers[m].allColumns,h)}catch(e){c.push(e)}return{layers:{[m]:{index:f,query:t,columns:null!==(r=e.layers[m].columns)&&void 0!==r?r:[],allColumns:x,timeField:b,errors:c}},fieldList:null!==(o=h)&&void 0!==o?o:[],indexPatternRefs:u,initialContext:p}}(t,l,p,i,c);v(!0),e(a)}}()}),[i,p,c,g,l,e,t]);const{fieldList:y}=t,O=Object(s.useCallback)((e=>Boolean(null==m?void 0:m.includes(e.name))),[m]),I=Object(s.useCallback)((e=>!(f.nameFilter&&!e.name.toLowerCase().includes(f.nameFilter.toLowerCase()))),[f]),T=Object(s.useCallback)((e=>{if(e===Un.FieldsGroupNames.AvailableFields)return{helpText:u.i18n.translate("xpack.lens.indexPattern.allFieldsForTextBasedLabelHelp",{defaultMessage:"Drag and drop available fields to the workspace and create visualizations. To change the available fields, edit your query."})}}),[]),{fieldGroups:w}=Object(Un.useGroupedFields)({dataViewId:null,allFields:y,services:{dataViews:p},onFilterField:I,onSelectedFieldFilter:O,onOverrideFieldGroupDetails:T}),M=Object(s.useCallback)((({field:e,itemIndex:t,groupIndex:a,hideDetails:n})=>{var i;return Object(j.jsx)(Ld.c,{draggable:!0,order:[t],value:{field:null==e?void 0:e.name,id:e.id,humanData:{label:null==e?void 0:e.name}},dataTestSubj:`lnsFieldListPanelField-${e.name}`},Object(j.jsx)(Nd.a,{className:`lnsFieldItem lnsFieldItem--${null==e||null===(i=e.meta)||void 0===i?void 0:i.type}`,isActive:!1,onClick:()=>{},fieldIcon:Object(j.jsx)(k.k,{type:null==e?void 0:e.meta.type}),fieldName:null==e?void 0:e.name}))}),[]);return Object(j.jsx)(d.KibanaContextProvider,{services:{...n}},Object(j.jsx)(Ld.a,a,Object(j.jsx)(b.EuiFlexGroup,{gutterSize:"none",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(j.jsx)(b.EuiFlexItem,{grow:!1},Object(j.jsx)(b.EuiFormControlLayout,{icon:"search",fullWidth:!0,clear:{title:u.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),"aria-label":u.i18n.translate("xpack.lens.indexPatterns.clearFiltersLabel",{defaultMessage:"Clear name and type filters"}),onClick:()=>{h((e=>({...e,nameFilter:""})))}}},Object(j.jsx)("input",{className:"euiFieldText euiFieldText--fullWidth lnsInnerIndexPatternDataPanel__textField","data-test-subj":"lnsTextBasedLanguagesFieldSearch",placeholder:u.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the data view for the provided text"}),value:f.nameFilter,onChange:e=>{h({...f,nameFilter:e.target.value})},"aria-label":u.i18n.translate("xpack.lens.indexPatterns.filterByNameLabel",{defaultMessage:"Search field names",description:"Search the list of fields in the data view for the provided text"}),"aria-describedby":Fp}))),Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(Un.FieldListGrouped,{fieldGroups:w,fieldsExistenceStatus:x?Un.ExistenceFetchStatus.succeeded:Un.ExistenceFetchStatus.unknown,fieldsExistInIndex:Boolean(y.length),renderFieldItem:M,screenReaderDescriptionForSearchInputId:Fp,"data-test-subj":"lnsTextBasedLanguages"})))))}function Pp({selectedField:e,onChoose:t,existingFields:a,"data-test-subj":n}){var i;const l=Object(s.useMemo)((()=>{const e=a.map((e=>{var t;const a=null==e||null===(t=e.meta)||void 0===t?void 0:t.type;return{compatible:e.compatible?1:0,exists:!0,label:e.name,value:{type:"field",field:e.name,dataType:a}}})).sort(((e,t)=>t.compatible-e.compatible));return[{label:u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"}),options:e}]}),[a]);return Object(j.jsx)(Xn.a,{selectedOptions:e?[{label:e.fieldName,value:{type:"field",field:e.fieldName,dataType:null==e||null===(i=e.meta)||void 0===i?void 0:i.type}}]:[],options:l,onChoose:a=>{a&&a.field!==(null==e?void 0:e.fieldName)&&t(a)},fieldIsInvalid:!1,"data-test-subj":null!=n?n:"text-based-dimension-field"})}function Ap({state:e,layerId:t,dataViews:a}){const n=e.layers[t],i=a.indexPatternRefs.find((e=>e.id===n.index)),s=u.i18n.translate("xpack.lens.layerPanel.missingDataView",{defaultMessage:"Data view not found"});return Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(fp.a,{"data-test-subj":"textBasedLanguages-switcher",trigger:{label:(null==i?void 0:i.name)||(null==i?void 0:i.title)||s,title:(null==i?void 0:i.title)||s,size:"s",fontWeight:"normal",isDisabled:!0},indexPatternId:n.index,indexPatternRefs:a.indexPatternRefs,isMissingCurrent:!i,onChangeIndexPattern:()=>{}}))}function _p(e){return`textBasedLanguages-datasource-layer-${e}`}function Lp({core:e,storage:t,data:a,expressions:n,dataViews:s}){const l=e=>{var t;return null===(t=Object.entries(e.layers))||void 0===t?void 0:t.map((([t,a])=>{var n,i;return{state:{...e},table:{changeType:"unchanged",isMultiRow:!1,layerId:t,columns:null!==(n=null===(i=a.columns)||void 0===i?void 0:i.map((e=>{var t,a;return{columnId:e.columnId,operation:{dataType:null==e||null===(t=e.meta)||void 0===t?void 0:t.type,label:e.fieldName,isBucketed:Boolean("number"!==(null==e||null===(a=e.meta)||void 0===a?void 0:a.type))}}})))&&void 0!==n?n:[]},keptLayerIds:[t]}}))},o={id:"textBased",checkIntegrity:()=>[],getErrorMessages:e=>{const t=[];return Object.values(e.layers).forEach((e=>{e.errors&&e.errors.length>0&&t.push(...e.errors)})),t.map((e=>({shortMessage:e.message,longMessage:e.message})))},getUnifiedSearchErrors:e=>{const t=[];return Object.values(e.layers).forEach((e=>{e.errors&&e.errors.length>0&&t.push(...e.errors)})),t},initialize:(e,t,a,n,i)=>({...e||{layers:{}},fieldList:[],indexPatternRefs:(i?Object.values(i):[]).map((e=>({id:e.id,title:e.title,timeField:e.timeFieldName}))),initialContext:a}),syncColumns:({state:e})=>e,onRefreshIndexPattern(){},getUsedDataViews:e=>Object.values(e.layers).map((({index:e})=>e)),getPersistableState({layers:e}){const t=[];return Object.entries(e).forEach((([e,{index:a,...n}])=>{a&&t.push({type:"index-pattern",id:a,name:_p(e)})})),{state:{layers:e},savedObjectReferences:t}},isValidColumn(e,t,a,n){const i=e.layers[a],s=i.columns.find((e=>e.columnId===n)),l=t[i.index];return!(!s||!l)},insertLayer(e,t){var a,n,i;const s=null===(a=Object.values(null==e?void 0:e.layers))||void 0===a?void 0:a[0],l=null==s?void 0:s.query,r=null!==(n=null==s?void 0:s.allColumns)&&void 0!==n?n:[],o=null!==(i=null==s?void 0:s.index)&&void 0!==i?i:JSON.parse(localStorage.getItem("lens-settings")||"{}").indexPatternId||e.indexPatternRefs[0].id;return{...e,layers:{...e.layers,[t]:Dp(o,l,r)}}},createEmptyLayer:()=>({indexPatternRefs:[],layers:{},fieldList:[]}),cloneLayer:(e,t,a,n)=>({...e}),removeLayer(e,t){const a={...e.layers,[t]:{...e.layers[t],columns:[]}};return{removedLayerIds:[t],newState:{...e,layers:a,fieldList:e.fieldList}}},clearLayer:(e,t)=>({removedLayerIds:[],newState:{...e,layers:{...e.layers,[t]:{...e.layers[t],columns:[]}}}}),getLayers:e=>e&&e.layers?Object.keys(null==e?void 0:e.layers):[],isTimeBased:(e,t)=>{if(!e)return!1;const{layers:a}=e;return Boolean(a)&&Object.values(a).some((e=>{var a;return Boolean(null===(a=t[e.index])||void 0===a?void 0:a.timeFieldName)}))},getUsedDataView:(e,t)=>{if(!t){var a;const t=Object.values(e.layers);return null==t||null===(a=t[0])||void 0===a?void 0:a.index}return e.layers[t].index},removeColumn:({prevState:e,layerId:t,columnId:a})=>({...e,layers:{...e.layers,[t]:{...e.layers[t],columns:e.layers[t].columns.filter((e=>e.columnId!==a))}}}),toExpression:(e,t,a)=>function(e,t){return e.layers[t]?function(e,t){var a,n;if(!e.columns||0===(null===(a=e.columns)||void 0===a?void 0:a.length))return null;let i={};e.columns.forEach((e=>{i[e.fieldName]?i[e.fieldName].push({id:e.columnId,label:e.fieldName}):i={...i,[e.fieldName]:[{id:e.columnId,label:e.fieldName}]}}));const s=null===(n=t.find((t=>t.id===e.index)))||void 0===n?void 0:n.timeField,l=Object(js.textBasedQueryStateToExpressionAst)({query:e.query,timeFieldName:s});return l.chain.push({type:"function",function:"lens_map_to_columns",arguments:{idMap:[JSON.stringify(i)]}}),l}(e.layers[t],e.indexPatternRefs):null}(e,t),getSelectedFields(e){var t;const a=[];return null===(t=Object.values(null==e?void 0:e.layers))||void 0===t||t.forEach((e=>{const{columns:t}=e;Object.values(t).forEach((e=>{"fieldName"in e&&a.push(e.fieldName)}))})),a},renderDataPanel(t,l){var u;const p=null==o||null===(u=o.getSelectedFields)||void 0===u?void 0:u.call(o,l.state);Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(Ep,i()({data:a,dataViews:s,expressions:n,layerFields:p},l)))),t)},renderDimensionTrigger:(e,t)=>{var a,n;const i=o.uniqueLabels(t.state),s=t.state.layers[t.layerId],l=null==s||null===(a=s.allColumns)||void 0===a?void 0:a.find((e=>e.columnId===t.columnId));let c=i[t.columnId];c||(c=null==l?void 0:l.fieldName),Object(r.render)(Object(j.jsx)(b.EuiButtonEmpty,{color:c&&l?"primary":"danger",onClick:()=>{},"data-test-subj":"lns-dimensionTrigger-textBased"},null!==(n=c)&&void 0!==n?n:u.i18n.translate("xpack.lens.textBasedLanguages.missingField",{defaultMessage:"Missing field"})),e)},getRenderEventCounters:e=>[],renderDimensionEditor:(t,a)=>{var n,i;const s=a.state.fieldList,l=null===(n=a.state.layers[a.layerId])||void 0===n||null===(i=n.allColumns)||void 0===i?void 0:i.find((e=>e.columnId===a.columnId)),o=s.map((e=>{var t;return{...e,compatible:!a.isMetricDimension||a.filterOperations({dataType:e.meta.type,isBucketed:Boolean("number"!==(null==e||null===(t=e.meta)||void 0===t?void 0:t.type)),scale:"ordinal"})}}));Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(j.jsx)(b.EuiFormRow,{"data-test-subj":"text-based-languages-field-selection-row",label:u.i18n.translate("xpack.lens.textBasedLanguages.chooseField",{defaultMessage:"Field"}),fullWidth:!0,className:"lnsIndexPatternDimensionEditor--padded"},Object(j.jsx)(Pp,{existingFields:o,selectedField:l,onChoose:e=>{var t;const n=null===(t=s.find((t=>t.name===e.field)))||void 0===t?void 0:t.meta,i={columnId:a.columnId,fieldName:e.field,meta:n};return a.setState(l?{...a.state,layers:{...a.state.layers,[a.layerId]:{...a.state.layers[a.layerId],columns:a.state.layers[a.layerId].columns.map((t=>t.columnId!==a.columnId?t:{...t,fieldName:e.field,meta:n})),allColumns:a.state.layers[a.layerId].allColumns.map((t=>t.columnId!==a.columnId?t:{...t,fieldName:e.field,meta:n}))}}}:{...a.state,layers:{...a.state.layers,[a.layerId]:{...a.state.layers[a.layerId],columns:[...a.state.layers[a.layerId].columns,i],allColumns:[...a.state.layers[a.layerId].allColumns,i]}}})}})),a.dataSectionExtra&&Object(j.jsx)("div",{style:{paddingLeft:Q.euiThemeVars.euiSize,paddingRight:Q.euiThemeVars.euiSize}},a.dataSectionExtra)),t)},renderLayerPanel:(t,a)=>{Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(Ap,a))),t)},uniqueLabels(e){const t=e.layers,a={},n={};return Object.values(t).forEach((e=>{e.columns&&Object.values(e.columns).forEach((e=>{a[e.columnId]=(e=>{let t=e;for(;n[t]>=0;){const a=++n[t];t=u.i18n.translate("xpack.lens.indexPattern.uniqueLabel",{defaultMessage:"{label} [{num}]",values:{label:e,num:a}})}return n[t]=0,t})(e.fieldName)}))})),a},getDropProps:e=>{const{source:t,target:a,state:n}=e;if(t){if(a&&a.isMetricDimension){var i;const e=a.layerId,s=n.layers[e].allColumns.find((e=>e.columnId===t.id));if("number"!==(null==s||null===(i=s.meta)||void 0===i?void 0:i.type))return}return{dropTypes:["field_add"],nextLabel:t.field}}},onDrop:e=>{const{dropType:t,state:a,source:n,target:i}=e,{layers:s}=a;return"field_add"===t&&(Object.keys(s).forEach((t=>{var a;const l=s[t],r=l.allColumns.find((e=>e.columnId===n.id)),o={columnId:i.columnId,fieldName:null!==(a=null==r?void 0:r.fieldName)&&void 0!==a?a:"",meta:null==r?void 0:r.meta},u=l.columns.filter((e=>e.columnId!==i.columnId));u.push(o);const c=l.allColumns.filter((e=>e.columnId!==i.columnId));c.push(o),e.setState({...e.state,layers:{...e.state.layers,[t]:{...e.state.layers[t],columns:u,allColumns:c}}})})),!0)},getPublicAPI:({state:e,layerId:t})=>({datasourceId:"textBased",getTableSpec:()=>{var a;return(null===(a=e.layers[t])||void 0===a?void 0:a.columns.filter((t=>{var a;if(null==e||null===(a=e.fieldList)||void 0===a?void 0:a.some((e=>e.name===(null==t?void 0:t.fieldName))))return t}))).map((e=>({columnId:e.columnId,fields:[e.fieldName]})))||[]},getOperationForColumnId:a=>{var n;const i=e.layers[t],s=null==i||null===(n=i.allColumns)||void 0===n?void 0:n.find((e=>e.columnId===a)),l=o.uniqueLabels(e);var r,u,c;return s?{dataType:null==s||null===(r=s.meta)||void 0===r?void 0:r.type,label:null!==(u=l[a])&&void 0!==u?u:null==s?void 0:s.fieldName,isBucketed:Boolean("number"!==(null==s||null===(c=s.meta)||void 0===c?void 0:c.type)),hasTimeShift:!1,hasReducedTimeRange:!1}:null},getVisualDefaults:()=>({}),isTextBasedLanguage:()=>!0,getMaxPossibleNumValues:e=>null,getSourceId:()=>e.layers[t].index,getFilters:()=>({enabled:{kuery:[],lucene:[]},disabled:{kuery:[],lucene:[]}}),hasDefaultTimeField:()=>!1}),getDatasourceSuggestionsForField(e,t){var a;const n=e.fieldList.find((e=>e.id===t.id));return n?null===(a=Object.entries(e.layers))||void 0===a?void 0:a.map((([t,a])=>{var i,s,l,r,o;const u=Object(Ge.a)(),c={columnId:u,fieldName:null!==(i=null==n?void 0:n.name)&&void 0!==i?i:"",meta:null==n?void 0:n.meta};return{state:{...e,layers:{...e.layers,[t]:{...e.layers[t],columns:[...a.columns,c],allColumns:[...a.allColumns,c]}}},table:{changeType:"initial",isMultiRow:!1,layerId:t,columns:[...null===(s=a.columns)||void 0===s?void 0:s.map((e=>{var t,a;return{columnId:e.columnId,operation:{dataType:null==e||null===(t=e.meta)||void 0===t?void 0:t.type,label:e.fieldName,isBucketed:Boolean("number"!==(null==e||null===(a=e.meta)||void 0===a?void 0:a.type))}}})),{columnId:u,operation:{dataType:null==n||null===(l=n.meta)||void 0===l?void 0:l.type,label:null!==(r=null==n?void 0:n.name)&&void 0!==r?r:"",isBucketed:Boolean("number"!==(null==n||null===(o=n.meta)||void 0===o?void 0:o.type))}}]},keptLayerIds:[t]}})):[]},getDatasourceSuggestionsForVisualizeField:(e,t,a,n)=>{const i=e.initialContext;if(a)return[];if(i&&"dataViewSpec"in i&&i.dataViewSpec.title&&i.query){var s;const a=Object(Ge.a)(),l=n[t],r=i.contextualFields,o=null==r?void 0:r.map((e=>{var t,a;let n=null==l?void 0:l.getFieldByName(e);n||(n=null==l?void 0:l.fields.find((t=>t.name.includes(e))));const i=Object(Ge.a)(),s=null!==(t=null===(a=n)||void 0===a?void 0:a.type)&&void 0!==t?t:"number";return{columnId:i,fieldName:e,meta:{type:s}}})),u=i.dataViewSpec.title,c=i.query;return[{state:{...{...e,layers:{...e.layers,[a]:{index:u,query:c,columns:null!=o?o:[],allColumns:null!=o?o:[]}}}},table:{changeType:"initial",isMultiRow:!1,layerId:a,columns:null!==(s=null==o?void 0:o.map((e=>{var t,a;return{columnId:e.columnId,operation:{dataType:null==e||null===(t=e.meta)||void 0===t?void 0:t.type,label:e.fieldName,isBucketed:Boolean("number"!==(null==e||null===(a=e.meta)||void 0===a?void 0:a.type))}}})))&&void 0!==s?s:[]},keptLayerIds:[a]}]}return[]},getDatasourceSuggestionsFromCurrentState:l,getDatasourceSuggestionsForVisualizeCharts:l,isEqual:()=>!0,getDatasourceInfo:(e,t,a)=>Object.entries(e.layers).reduce(((e,[t,n])=>{const i=Object.entries(n.columns).map((([e,t])=>{var a,n,i;return{id:e,role:"number"!==(null===(a=t.meta)||void 0===a?void 0:a.type)?"split":"metric",operation:{dataType:null==t||null===(n=t.meta)||void 0===n?void 0:n.type,label:t.fieldName,isBucketed:Boolean("number"!==(null==t||null===(i=t.meta)||void 0===i?void 0:i.type)),hasTimeShift:!1,hasReducedTimeRange:!1}}}));return e.push({layerId:t,columns:i,dataView:null==a?void 0:a.find((e=>e.id===n.index))}),e}),[])};return o}function Dp(e,t,a){return{index:e,query:t,columns:[],allColumns:null!=a?a:[]}}var Np=a(95);const Rp=()=>{const e=new WeakMap;return{insertOrReplaceFormulaColumn:(t,{formula:a,label:n,format:i,filter:s,reducedTimeRange:l,timeScale:r},o,u)=>{const c=(t=>{const a=e.get(t);if(a)return a;const n=Object(Np.a)(t);return e.set(t,n),n})(u);return Gl(t,{label:null!=n?n:a,customLabel:Boolean(n),operationType:"formula",dataType:"number",references:[],isBucketed:!1,filter:s,reducedTimeRange:l,timeScale:r,params:{formula:a,format:i}},{...o,indexPatternId:c.id},{indexPattern:c}).layer}}};class text_based_TextBasedDatasource{constructor(){}setup(e,{editorFrame:t}){t.registerDatasource((async()=>{const{getTextBasedDatasource:t}=await Promise.resolve().then(a.bind(null,493)),[n,{data:i,dataViews:s,expressions:l}]=await e.getStartServices();return t({core:n,storage:new Pi.Storage(localStorage),data:i,dataViews:s,expressions:l})}))}}class form_based_FormBasedDatasource{setup(e,{fieldFormats:t,expressions:n,editorFrame:i,charts:s}){i.registerDatasource((async()=>{const{getFormBasedDatasource:n,getSuffixFormatter:i,suffixFormatterId:l}=await Promise.resolve().then(a.bind(null,493));if(!t.has(l)){const a=Object(Pi.createStartServicesGetter)(e.getStartServices),n=i((()=>a().plugins.fieldFormats.deserialize));t.register([n])}const[r,{dataViewFieldEditor:o,uiActions:u,data:c,fieldFormats:d,dataViews:p,unifiedSearch:m,discover:g}]=await e.getStartServices();return n({core:r,fieldFormats:d,storage:new Pi.Storage(localStorage),data:c,unifiedSearch:m,discover:g,dataViews:p,charts:s,dataViewFieldEditor:o,uiActions:u})}))}}var Bp=a(98);async function Vp(e){const t=await Promise.all(e.map((e=>"function"==typeof e?e():e))),a={};return t.forEach((e=>{a[e.id]=e})),a}class service_EditorFrameService{constructor(){Io()(this,"datasources",[]),Io()(this,"visualizations",[]),Io()(this,"loadDatasources",(()=>Vp(this.datasources))),Io()(this,"loadVisualizations",(()=>Vp(this.visualizations))),Io()(this,"documentToExpression",(async(e,t)=>{const[n,i]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{persistedStateToExpression:s}=await Promise.resolve().then(a.bind(null,493));return s(n,i,e,t)}))}setup(){return{registerDatasource:e=>{this.datasources.push(e)},registerVisualization:e=>{this.visualizations.push(e)}}}start(e,t){return{createInstance:async()=>{const[n,i]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{EditorFrame:s}=await Promise.resolve().then(a.bind(null,493));return{EditorFrameContainer:({showNoDataPopover:a,lensInspector:l,indexPatternService:r})=>Object(j.jsx)("div",{className:"lnsApp__frame"},Object(j.jsx)(s,{"data-test-subj":"lnsEditorFrame",core:e,plugins:t,lensInspector:l,showNoDataPopover:a,indexPatternService:r,datasourceMap:n,visualizationMap:i,ExpressionRenderer:t.expressions.ReactExpressionRenderer})),datasourceMap:n,visualizationMap:i}}}}}var zp=a(99),Gp=a(451),qp=a.n(Gp),Hp=a(6),$p=a(118);function Wp({errors:e,canEdit:t}){const a=e&&e.length>1,n=t&&(null==e?void 0:e.some((({type:e})=>"fixable"===e)));return Object(j.jsx)("div",{className:"lnsEmbeddedError"},Object(j.jsx)(b.EuiEmptyPrompt,{iconType:"alert",iconColor:"danger","data-test-subj":"embeddable-lens-failure",body:Object(j.jsx)(l.a.Fragment,null,e?Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("p",null,e[0].longMessage),a&&!n?Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.moreErrors",defaultMessage:"Edit in Lens editor to see more errors"})):null,n?Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.fixErrors",defaultMessage:"Edit in Lens editor to fix the error"})):null):Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.failure",defaultMessage:"Visualization couldn't be displayed"})))}))}function Up({ExpressionRenderer:e,expression:t,searchContext:a,variables:n,handleEvent:i,interactive:s,searchSessionId:l,onData$:r,onRender$:o,renderMode:u,syncColors:d,syncTooltips:p,syncCursor:m,hasCompatibleActions:g,style:f,className:h,errors:x,canEdit:v,onRuntimeError:O,executionContext:k,lensInspector:I,noPadding:T}){return Object(j.jsx)(c.I18nProvider,null,x||null===t||""===t?Object(j.jsx)(Wp,{errors:x,canEdit:v}):Object(j.jsx)("div",{className:y()("lnsExpressionRenderer",h),style:f},Object(j.jsx)(e,{className:"lnsExpressionRenderer__component",padding:T?void 0:"s",variables:n,expression:t,interactive:s,searchContext:a,searchSessionId:l,onData$:r,onRender$:o,inspectorAdapters:I.adapters,renderMode:u,syncColors:d,syncTooltips:p,syncCursor:m,executionContext:k,renderError:(e,t)=>{var a;const n=Object($p.d)(t);return O(null!==(a=n[0])&&void 0!==a?a:e),Object(j.jsx)("div",{"data-test-subj":"expression-renderer-error"},Object(j.jsx)(b.EuiFlexGroup,{direction:"column",alignItems:"center",justifyContent:"center"},Object(j.jsx)(b.EuiFlexItem,null,Object(j.jsx)(b.EuiIcon,{type:"alert",color:"danger"})),Object(j.jsx)(b.EuiFlexItem,null,n.map((e=>Object(j.jsx)(b.EuiText,{size:"s"},e))))))},onEvent:i,hasCompatibleActions:g})))}const Xp=e=>{const t=Object(tt.createDefaultInspectorAdapters)();let a;return{adapters:t,inspect:n=>(a=e.open(t,n),a.onClose.then((()=>{a&&(a=void 0)})),a),close:()=>{var e;return null===(e=a)||void 0===e?void 0:e.close()}}},Yp=async(e,t)=>{const{ast:a,errors:n}=await t(e);return{expression:a?Object(zp.b)(a):null,errors:n}};var Kp={name:"1n2yqb3",styles:"position:absolute;z-index:2;left:0;bottom:0"};class embeddable_Embeddable extends Hp.Embeddable{logError(e){Object(p.d)("runtime"===e?"embeddable_runtime_error":"embeddable_validation_error",this.getExecutionContext())}constructor(e,t,a){super(t,{editApp:"lens"},a),Io()(this,"type",at.d),Io()(this,"deferEmbeddableLoad",!0),Io()(this,"expressionRenderer",void 0),Io()(this,"savedVis",void 0),Io()(this,"expression",void 0),Io()(this,"domNode",void 0),Io()(this,"warningDomNode",void 0),Io()(this,"subscription",void 0),Io()(this,"isInitialized",!1),Io()(this,"errors",void 0),Io()(this,"inputReloadSubscriptions",void 0),Io()(this,"isDestroyed",void 0),Io()(this,"embeddableTitle",void 0),Io()(this,"lensInspector",void 0),Io()(this,"externalSearchContext",{}),Io()(this,"activeDataInfo",{}),Io()(this,"indexPatterns",[]),Io()(this,"viewUnderlyingDataArgs",void 0),Io()(this,"updateActiveData",((e,t)=>{var a;this.activeDataInfo.activeData=null==t||null===(a=t.tables)||void 0===a?void 0:a.tables,this.input.onLoad&&this.input.onLoad(!1,t);const{type:n,error:i}=e;this.updateOutput({...this.getOutput(),loading:!1,error:"error"===n?i:void 0}),this.handleWarnings(t)})),Io()(this,"onRender",(()=>{var e;let t=[],a=[];var n,i,s;this.savedVis&&(t=Object.values(this.deps.datasourceMap).reduce(((e,t)=>{var a,n;return[...e,...null!==(a=null===(n=t.getRenderEventCounters)||void 0===n?void 0:n.call(t,this.savedVis.state.datasourceStates[t.id]))&&void 0!==a?a:[]]}),[]),this.savedVis.visualizationType&&(a=null!==(n=null===(i=(s=this.deps.visualizationMap[this.savedVis.visualizationType]).getRenderEventCounters)||void 0===i?void 0:i.call(s,this.savedVis.state.visualization))&&void 0!==n?n:[]));const l=this.getExecutionContext(),r=[...t,...a,...Object(p.a)(l)];Object.values((null===(e=this.savedVis)||void 0===e?void 0:e.state.adHocDataViews)||{}).forEach((()=>{r.push("ad_hoc_data_view")})),Object(p.d)(r,l),this.renderComplete.dispatchComplete(),this.updateOutput({...this.getOutput(),rendered:!0})})),Io()(this,"hasCompatibleActions",(async e=>{if(Object(Md.d)(e)||Object(Md.c)(e)){const{getTriggerCompatibleActions:t}=this.deps;return!!t&&(await t(A.VIS_EVENT_TO_TRIGGER[e.name],{data:e.data,embeddable:this})).length>0}return!1})),Io()(this,"handleEvent",(async e=>{if(this.deps.getTrigger&&!this.input.disableTriggers&&(Object(Md.a)(e)&&(this.deps.getTrigger(A.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:{...e.data,timeFieldName:e.data.timeFieldName||Object(Gt.inferTimeField)(this.deps.data.datatableUtilities,e.data)},embeddable:this}),this.input.onBrushEnd&&this.input.onBrushEnd(e.data)),Object(Md.c)(e)&&(this.deps.getTrigger(A.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:{...e.data,timeFieldName:e.data.timeFieldName||Object(Gt.inferTimeField)(this.deps.data.datatableUtilities,e.data)},embeddable:this}),this.input.onFilter&&this.input.onFilter(e.data)),Object(Md.d)(e)&&(this.deps.getTrigger(A.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:e.data,embeddable:this},!0),this.input.onTableRowClick&&this.input.onTableRowClick(e.data)),Object(Md.b)(e)&&this.onEditAction)){if(!this.savedVis)return;const t=JSON.parse(JSON.stringify(this.savedVis));t.state.visualization=this.onEditAction(t.state.visualization,e),this.savedVis=t;const{expression:a,errors:n}=await Yp(this.savedVis,this.deps.documentToExpression);this.expression=a,this.errors=n,this.reload()}})),Io()(this,"inputIsRefType",(e=>this.deps.attributeService.inputIsRefType(e))),Io()(this,"getInputAsRefType",(async()=>this.deps.attributeService.getInputAsRefType(this.getExplicitInput(),{showSaveModal:!0,saveModalTitle:this.getTitle()}))),Io()(this,"getInputAsValueType",(async()=>this.deps.attributeService.getInputAsValueType(this.getExplicitInput()))),this.deps=e,this.lensInspector=Xp(e.inspector),this.expressionRenderer=e.expressionRenderer;let n=!1;this.initializeSavedVis(t).then((()=>{n?this.reload():this.onContainerStateChanged(t)})).catch((e=>this.onFatalError(e))),this.subscription=this.getUpdated$().subscribe((()=>{n=!0,this.onContainerStateChanged(this.input)}));const i=this.getInput$();this.embeddableTitle=this.getTitle(),this.inputReloadSubscriptions=[],this.inputReloadSubscriptions.push(i.pipe(Object(Cp.map)((e=>{var t;return null===(t=e.enhancements)||void 0===t?void 0:t.dynamicActions})),Object(Cp.distinctUntilChanged)(((e,t)=>qp()(e,t))),Object(Cp.skip)(1)).subscribe((e=>{this.reload()}))),this.inputReloadSubscriptions.push(i.pipe(Object(Cp.map)((e=>e.viewMode)),Object(Cp.distinctUntilChanged)(),Object(Cp.skip)(1)).subscribe((e=>{var t;null!==(t=this.getInput().enhancements)&&void 0!==t&&t.dynamicActions&&this.reload()}))),this.inputReloadSubscriptions.push(i.pipe(Object(Cp.distinctUntilChanged)(((e,t)=>qp()(["attributes"in e&&e.attributes,"savedObjectId"in e&&e.savedObjectId],["attributes"in t&&t.attributes,"savedObjectId"in t&&t.savedObjectId]))),Object(Cp.skip)(1)).subscribe((async e=>{await this.initializeSavedVis(e),this.reload()}))),this.inputReloadSubscriptions.push(this.getUpdated$().pipe(Object(Cp.map)((()=>this.getInput()))).pipe(Object(Cp.distinctUntilChanged)(((e,t)=>qp()([e.filters,e.query,e.timeRange,e.searchSessionId],[t.filters,t.query,t.timeRange,t.searchSessionId]))),Object(Cp.skip)(1)).subscribe((async e=>{this.onContainerStateChanged(e)})))}reportsEmbeddableLoad(){return!0}supportedTriggers(){var e;return this.savedVis&&this.savedVis.visualizationType&&(null===(e=this.deps.visualizationMap[this.savedVis.visualizationType])||void 0===e?void 0:e.triggers)||[]}getInspectorAdapters(){return this.lensInspector.adapters}maybeAddConflictError(e,t){const a=[...e||[]];return"conflict"===(null==t?void 0:t.outcome)&&this.deps.spaces&&a.push({shortMessage:u.i18n.translate("xpack.lens.embeddable.legacyURLConflict.shortMessage",{defaultMessage:"You've encountered a URL conflict"}),longMessage:Object(j.jsx)(this.deps.spaces.ui.components.getEmbeddableLegacyUrlConflict,{targetType:at.d,sourceId:t.sourceId})}),null!=a&&a.length?a:void 0}maybeAddTimeRangeError(e,t,a){return null==t.timeRange&&a.some((e=>e.isTimeBased()))?[...e||[],{shortMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.shortMessage",{defaultMessage:"Missing timeRange property"}),longMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.longMessage",{defaultMessage:"The timeRange property is required for the given configuration"})}]:e}async initializeSavedVis(e){const t=await this.deps.attributeService.unwrapAttributes(e).catch((e=>(this.onFatalError(e),!1)));if(!t||this.isDestroyed)return;const{metaInfo:a,attributes:n}=t;this.savedVis={...n,type:this.type,savedObjectId:null==e?void 0:e.savedObjectId};const{expression:i,errors:s}=await Yp(this.savedVis,this.deps.documentToExpression);this.expression=i,this.errors=this.maybeAddConflictError(s,null==a?void 0:a.sharingSavedObjectProps),await this.initializeOutput(),this.isInitialized=!0}onContainerStateChanged(e){this.handleContainerStateChanged(e)&&this.reload()}handleContainerStateChanged(e){let t=!1;const a=e.filters?e.filters.filter((e=>!e.meta.disabled)):void 0,n=void 0!==e.timeslice?{from:new Date(e.timeslice[0]).toISOString(),to:new Date(e.timeslice[1]).toISOString(),mode:"absolute"}:e.timeRange;return Object(jt.isEqual)(n,this.externalSearchContext.timeRange)&&Object(jt.isEqual)(e.query,this.externalSearchContext.query)&&Object(jt.isEqual)(a,this.externalSearchContext.filters)&&this.externalSearchContext.searchSessionId===e.searchSessionId&&this.embeddableTitle===this.getTitle()||(this.externalSearchContext={timeRange:n,query:e.query,filters:a,searchSessionId:e.searchSessionId},this.embeddableTitle=this.getTitle(),t=!0),t}handleWarnings(e){var t;const a=Object(Gt.getActiveDatasourceIdFromDoc)(this.savedVis);if(!a||null==e||!e.requests)return;const n=this.deps.datasourceMap[a],i=null===(t=this.savedVis)||void 0===t?void 0:t.state.datasourceStates[a],s=Object(Gt.getSearchWarningMessages)(e.requests,n,i,{searchService:this.deps.data.search});s.length&&this.warningDomNode&&Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:this.deps.theme.theme$},Object(j.jsx)(h.Warnings,{warnings:s,compressed:!0})),this.warningDomNode)}getExecutionContext(){if(this.savedVis){var e,t;const a=(null===(e=this.parent)||void 0===e?void 0:e.getInput().executionContext)||this.input.executionContext,n={type:"lens",name:null!==(t=this.savedVis.visualizationType)&&void 0!==t?t:"",id:this.id,description:this.savedVis.title||this.input.title||"",url:this.output.editUrl};return a?{...a,child:n}:n}}getError(){var e,t,a,n;const i="string"==typeof(null===(e=this.errors)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.longMessage)?this.errors[0].longMessage:null===(a=this.errors)||void 0===a||null===(n=a[0])||void 0===n?void 0:n.shortMessage;return null!=i?new Error(i):this.expression?void 0:new Error(u.i18n.translate("xpack.lens.embeddable.failure",{defaultMessage:"Visualization couldn't be displayed"}))}render(e){var t;if(this.domNode=e,!this.savedVis||!this.isInitialized||this.isDestroyed)return;super.render(e),this.input.onLoad&&this.input.onLoad(!0),this.domNode.setAttribute("data-shared-item","");const a=this.getError();this.updateOutput({...this.getOutput(),loading:!0,error:a}),a?this.renderComplete.dispatchError():this.renderComplete.dispatchInProgress();const n=this.getInput();Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:this.deps.theme.theme$},Object(j.jsx)(Up,{ExpressionRenderer:this.expressionRenderer,expression:this.expression||null,errors:this.errors,lensInspector:this.lensInspector,searchContext:this.getMergedSearchContext(),variables:{embeddableTitle:this.getTitle(),...n.palette?{theme:{palette:n.palette}}:{}},searchSessionId:this.externalSearchContext.searchSessionId,handleEvent:this.handleEvent,onData$:this.updateActiveData,onRender$:this.onRender,interactive:!n.disableTriggers,renderMode:n.renderMode,syncColors:n.syncColors,syncTooltips:n.syncTooltips,syncCursor:n.syncCursor,hasCompatibleActions:this.hasCompatibleActions,className:n.className,style:n.style,executionContext:this.getExecutionContext(),canEdit:this.getIsEditable()&&"edit"===n.viewMode,onRuntimeError:e=>{this.updateOutput({error:new Error(e)}),this.logError("runtime")},noPadding:null===(t=this.visDisplayOptions)||void 0===t?void 0:t.noPadding}),Object(j.jsx)("div",{css:Kp,ref:e=>{e&&(this.warningDomNode=e)}})),e)}getMergedSearchContext(){var e;if(!this.savedVis)throw new Error("savedVis is required for getMergedSearchContext");const t={timeRange:this.externalSearchContext.timeRange,query:[this.savedVis.state.query],filters:this.deps.injectFilterReferences(this.savedVis.state.filters,this.savedVis.references),disableShardWarnings:!0};return this.externalSearchContext.query&&(t.query=[this.externalSearchContext.query,...t.query]),null!==(e=this.externalSearchContext.filters)&&void 0!==e&&e.length&&(t.filters=[...this.externalSearchContext.filters,...t.filters]),t}get onEditAction(){var e;const t=null===(e=this.savedVis)||void 0===e?void 0:e.visualizationType;if(t)return this.deps.visualizationMap[t].onEditAction}reload(){this.savedVis&&this.isInitialized&&!this.isDestroyed&&(this.handleContainerStateChanged(this.input),this.domNode&&this.render(this.domNode))}async loadViewUnderlyingDataArgs(){var e,t;if(!this.savedVis||!this.activeDataInfo.activeData)return!1;const a=this.getMergedSearchContext();if(!a.timeRange)return!1;const n=Object(Gt.getActiveDatasourceIdFromDoc)(this.savedVis);if(!n)return!1;this.activeDataInfo.activeDatasource=this.deps.datasourceMap[n];const i=null===(e=this.savedVis)||void 0===e?void 0:e.state.datasourceStates[n],s=await Promise.all(Object.values((null===(t=this.savedVis)||void 0===t?void 0:t.state.adHocDataViews)||{}).map((e=>{var t,a;return Rd.DataViewPersistableStateService.inject(e,[...(null===(t=this.savedVis)||void 0===t?void 0:t.references)||[],...(null===(a=this.savedVis)||void 0===a?void 0:a.state.internalReferences)||[]])})).map((e=>this.deps.dataViews.create(e)))),l=[...this.indexPatterns,...s].reduce(((e,t)=>({[t.id]:Object(Np.a)(t),...e})),{});var r,o;this.activeDataInfo.activeDatasourceState||(this.activeDataInfo.activeDatasourceState=this.activeDataInfo.activeDatasource.initialize(i,[...(null===(r=this.savedVis)||void 0===r?void 0:r.references)||[],...(null===(o=this.savedVis)||void 0===o?void 0:o.state.internalReferences)||[]],void 0,void 0,l));const u=function({activeDatasource:e,activeDatasourceState:t,activeData:a,dataViews:n,capabilities:i,query:s,filters:l,timeRange:r,esQueryConfig:o,indexPatternsCache:u}){const{error:c,meta:d}=Gd(e,t,a,u,r,i);if(c||!d)return;const p=[],m=[];Array.isArray(s)&&s.forEach((e=>{Object(ys.isOfQueryType)(e)?p.push(e):m.push(e)}));const{filters:g,query:f}=qd(p.length>0?p:s,l,d,n,o);return{dataViewSpec:u[d.id].spec,timeRange:r,filters:g,query:m.length>0?m[0]:f,columns:d.columns}}({activeDatasource:this.activeDataInfo.activeDatasource,activeDatasourceState:this.activeDataInfo.activeDatasourceState,activeData:this.activeDataInfo.activeData,dataViews:this.indexPatterns,capabilities:this.deps.capabilities,query:a.query,filters:a.filters||[],timeRange:a.timeRange,esQueryConfig:Object(Kn.getEsQueryConfig)(this.deps.uiSettings),indexPatternsCache:l}),c=void 0!==u;return c&&(this.viewUnderlyingDataArgs=u),c}getViewUnderlyingDataArgs(){return this.viewUnderlyingDataArgs}canViewUnderlyingData(){return this.loadViewUnderlyingDataArgs()}async initializeOutput(){var e,t,a;if(!this.savedVis)return;const{indexPatterns:n}=await Object(Gt.getIndexPatternsObjects)((null===(e=this.savedVis)||void 0===e?void 0:e.references.map((({id:e})=>e)))||[],this.deps.dataViews);(await Promise.all(Object.values((null===(t=this.savedVis)||void 0===t?void 0:t.state.adHocDataViews)||{}).map((e=>this.deps.dataViews.create(e))))).forEach((e=>n.push(e))),this.indexPatterns=Object(jt.uniqBy)(n,"id");const i=this.getInput();this.errors=this.maybeAddTimeRangeError(this.errors,i,this.indexPatterns),this.errors&&this.logError("validation");const s=i.hidePanelTitles?"":null!==(a=i.title)&&void 0!==a?a:this.savedVis.title,l=i.savedObjectId;this.updateOutput({...this.getOutput(),defaultTitle:this.savedVis.title,editable:this.getIsEditable(),title:s,editPath:Object(at.l)(l),editUrl:this.deps.basePath.prepend(`/app/lens${Object(at.l)(l)}`),indexPatterns:this.indexPatterns}),this.setInitializationFinished()}getIsEditable(){return this.deps.capabilities.canSaveVisualizations||!this.inputIsRefType(this.getInput())&&this.deps.capabilities.canSaveDashboards}getDescription(){return this.savedVis&&this.savedVis.description}async getFilters(){var e,t,a,n;return Object(Kn.mapAndFlattenFilters)(this.deps.injectFilterReferences(null!==(e=null===(t=this.savedVis)||void 0===t?void 0:t.state.filters)&&void 0!==e?e:[],null!==(a=null===(n=this.savedVis)||void 0===n?void 0:n.references)&&void 0!==a?a:[]))}async getQuery(){var e;return null===(e=this.savedVis)||void 0===e?void 0:e.state.query}getSavedVis(){return this.savedVis}destroy(){this.isDestroyed=!0,super.destroy(),this.inputReloadSubscriptions.length>0&&this.inputReloadSubscriptions.forEach((e=>{e.unsubscribe()})),this.domNode&&Object(r.unmountComponentAtNode)(this.domNode),this.subscription&&this.subscription.unsubscribe()}getSelfStyledOptions(){var e;return{hideTitle:null===(e=this.visDisplayOptions)||void 0===e?void 0:e.noPanelTitle}}getChartInfo(){var e,t,a,n,i,s;const l=Object(Gt.getActiveDatasourceIdFromDoc)(this.savedVis);if(!l||null===(e=this.savedVis)||void 0===e||!e.visualizationType)return;const r=null===(t=this.savedVis)||void 0===t?void 0:t.state.datasourceStates[l],o=this.deps.datasourceMap[l].getDatasourceInfo(r,null===(a=this.savedVis)||void 0===a?void 0:a.references,this.indexPatterns),u=null===(n=(i=this.deps.visualizationMap[this.savedVis.visualizationType]).getVisualizationInfo)||void 0===n?void 0:n.call(i,null===(s=this.savedVis)||void 0===s?void 0:s.state.visualization),c=null==u?void 0:u.layers.map((e=>{const t=o.find((t=>t.layerId===e.layerId)),a=e.dimensions.map((e=>({...e,...null==t?void 0:t.columns.find((t=>t.id===e.id))})));return{...e,dataView:null==t?void 0:t.dataView,dimensions:a}}));return c?{layers:c,visualizationType:this.savedVis.visualizationType,filters:this.savedVis.state.filters,query:this.savedVis.state.query}:void 0}get visDisplayOptions(){var e;if(null===(e=this.savedVis)||void 0===e||!e.visualizationType||!this.deps.visualizationMap[this.savedVis.visualizationType].getDisplayOptions)return;let t=this.deps.visualizationMap[this.savedVis.visualizationType].getDisplayOptions();return void 0!==this.input.noPadding&&(t={...t,noPadding:this.input.noPadding}),t}}var Qp,Zp,Jp=a(51),em=a(96),tm=a(58),am=a.n(tm),nm=a(452),im=a.n(nm),sm=a(453),lm=a.n(sm),rm=(a(454),a(459),["className","size"]),om=function(e){var t=e.className,a=e.size,n=am()(e,rm),s={};return function(e){return void 0===e.iconType}(e)&&(s.iconType="logo".concat(e.name.replace(/\s+/g,""))),Object(j.jsx)(b.EuiAvatar,i()({className:y()("kbnSolutionAvatar",Io()({},"kbnSolutionAvatar--".concat(a),a),t),size:"xxl"===a?"xl":a,iconSize:a,color:"plain"},n,s))},um=(a(464),["className","isCollapsed"]),cm=u.i18n.translate("sharedUXPackages.solutionNav.collapsibleLabel",{defaultMessage:"Collapse side navigation"}),dm=u.i18n.translate("sharedUXPackages.solutionNav.openLabel",{defaultMessage:"Open side navigation"}),pm=function(e){var t=e.className,a=e.isCollapsed,n=am()(e,um),s=y()("kbnSolutionNavCollapseButton",{"kbnSolutionNavCollapseButton-isCollapsed":a},t);return Object(j.jsx)(b.EuiButtonIcon,i()({className:s,size:"s",color:"text",iconType:a?"menuRight":"menuLeft","aria-label":a?dm:cm,title:a?dm:cm},n))},mm=["children","headingProps","icon","isOpenOnDesktop","items","mobileBreakpoints","closeFlyoutButtonPosition","name","onCollapse","canBeCollapsed"],gm=function e(t,a){return t.map((function(t){return t.tabIndex=a?-1:void 0,t.items=t.items&&e(t.items,a),t}))},fm=Object(b.htmlIdGenerator)("SolutionNav"),bm=function(e){var t=e.children,a=e.headingProps,n=e.icon,r=e.isOpenOnDesktop,o=void 0!==r&&r,d=e.items,p=e.mobileBreakpoints,m=void 0===p?["xs","s"]:p,g=e.closeFlyoutButtonPosition,f=void 0===g?"outside":g,h=e.name,x=e.onCollapse,v=e.canBeCollapsed,O=void 0===v||v,k=am()(e,mm),I=Object(b.useIsWithinBreakpoints)(m),T=Object(b.useIsWithinBreakpoints)(["m"]),w=Object(b.useIsWithinMinBreakpoint)("l"),M=Object(s.useState)(!1),C=tl()(M,2),S=C[0],F=C[1],E=w&&!o&&O,P=!!t,A=y()("kbnSolutionNav",{"kbnSolutionNav--hidden":E}),_=(null==a?void 0:a.id)||fm("heading"),L=(null==a?void 0:a.element)||"h2",D=Object(j.jsx)(b.EuiTitle,{size:"xs",id:_},Object(j.jsx)(L,null,n&&Object(j.jsx)(om,{className:"kbnSolutionNav__avatar",iconType:n,name:h}),Object(j.jsx)("strong",null,Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.solutionNav.mobileTitleText",defaultMessage:"{solutionName} {menuText}",values:{solutionName:h||"Navigation",menuText:I?u.i18n.translate("sharedUXPackages.solutionNav.menuText",{defaultMessage:"menu"}):""}})))),N=Object(s.useMemo)((function(){return P?t:d?Object(j.jsx)(b.EuiSideNav,i()({"aria-labelledby":_,"aria-hidden":E,items:gm(d,E),mobileBreakpoints:[]},k)):null}),[t,_,P,E,d,k]);return Object(j.jsx)(l.a.Fragment,null,I&&Object(j.jsx)(b.EuiCollapsibleNavGroup,{className:A,paddingSize:"none",background:"none",title:D,titleElement:"span",isCollapsible:O,initialIsOpen:!1},Object(j.jsx)(b.EuiPanel,{color:"transparent",paddingSize:"s"},N)),T&&Object(j.jsx)(l.a.Fragment,null,(S||!O)&&Object(j.jsx)(b.EuiFlyout,{ownFocus:!1,outsideClickCloses:!0,onClose:function(){return F(!1)},side:"left",size:248,closeButtonPosition:f,className:"kbnSolutionNav__flyout",hideCloseButton:!O},Object(j.jsx)("div",{className:A},D,Object(j.jsx)(b.EuiSpacer,{size:"l"}),N)),O&&Object(j.jsx)(pm,{isCollapsed:!0,onClick:function(){F(!S)}})),w&&Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("div",{className:A},D,Object(j.jsx)(b.EuiSpacer,{size:"l"}),N),O&&Object(j.jsx)(pm,{isCollapsed:!o,onClick:x})))},hm=a(85),xm=["solutionNav","children"],vm="solutionNavIsCollapsed",ym=a(120),jm=a(469),Om=a.n(jm),km=["title","description","canAccessFleet","button"],Im=u.i18n.translate("sharedUXPackages.card.noData.noPermission.title",{defaultMessage:"Contact your administrator"}),Tm=u.i18n.translate("sharedUXPackages.card.noData.noPermission.description",{defaultMessage:"This integration is not yet enabled. Your administrator has the required permissions to turn it on."}),wm=u.i18n.translate("sharedUXPackages.card.noData.title",{defaultMessage:"Add Elastic Agent"}),Mm=u.i18n.translate("sharedUXPackages.card.noData.description",{defaultMessage:"Use Elastic Agent for a simple, unified way to collect data from your machines."}),Cm=function(){return Object(j.jsx)(b.EuiImage,{size:"fullWidth",style:{width:"max(100%, 360px)",height:240,objectFit:"cover",background:"aliceblue"},url:Om.a,alt:""})},Sm=function(e){var t=e.title,a=e.description,n=e.canAccessFleet,s=e.button,l=am()(e,km);return Object(j.jsx)(b.EuiCard,i()({css:{maxWidth:400,marginInline:"auto"},paddingSize:"l",title:n?Object(j.jsx)(b.EuiScreenReaderOnly,null,Object(j.jsx)("span",null,t||wm)):Object(j.jsx)(b.EuiTextColor,{color:"default"},Im),description:n?a||Mm:Object(j.jsx)(b.EuiTextColor,{color:"default"},Tm),footer:function(){if(n)return s&&"string"!=typeof s?s:Object(j.jsx)(b.EuiButton,{fill:!0},s||t||wm)}(),isDisabled:!n,image:Object(j.jsx)(Cm,null)},l))},Fm=["children"],Em=l.a.createContext(null),Pm=function(e){var t=e.children,a=am()(e,Fm),n={addBasePath:a.coreStart.http.basePath.prepend,canAccessFleet:a.coreStart.application.capabilities.navLinks.integrations};return Object(j.jsx)(Em.Provider,{value:n},Object(j.jsx)(ym.c,a,t))},Am=["href","category","description"],_m=function(e){var t=e.href,a=e.category,n=e.description,i=am()(e,Am),l=function(){var e=Object(s.useContext)(Em);if(!e)throw new Error("NoDataCard Context is missing.  Ensure your component or React root is wrapped with NoDataCardContext.");return e}(),r=l.canAccessFleet,o=l.addBasePath,u=Object(s.useMemo)((function(){if(t)return t;var e="/app/integrations/browse";return o(a?"".concat(e,"/").concat(a):e)}),[o,t,a]);return Object(j.jsx)(ym.b,null,Object(j.jsx)(Sm,nl()(nl()({},i),{},{href:u,canAccessFleet:r,description:n})))},Lm=function(e){var t=e.action,a=Object.keys(t);if(1!==a.length)return null;var n=a[0],s="elasticAgent"===n?"empty-page-agent-action":"empty-page-".concat(n,"-action");return Object(j.jsx)(_m,i()({key:s},t[n]))},Dm=function(e){var t=e.solution,a=e.logo,n=e.action,i=e.docsLink,s=e.pageTitle,l=e.className,r=s||u.i18n.translate("sharedUXPackages.noDataPage.welcomeTitle",{defaultMessage:"Welcome to Elastic {solution}!",values:{solution:t}}),o=Object(j.jsx)(b.EuiLink,{href:i,target:"_blank"},Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataPage.intro.link",defaultMessage:"learn more"})),d=Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataPage.intro",defaultMessage:"Add your data to get started, or {link} about {solution}.",values:{solution:t,link:o}});return Object(j.jsx)(b.EuiPageTemplate.Section,{alignment:"center",grow:!0,className:y()("kbnNoDataPageContents",l),"data-test-subj":"kbnNoDataPage"},Object(j.jsx)(b.EuiText,{textAlign:"center"},Object(j.jsx)(om,{name:t,iconType:a||"logo".concat(t),size:"xxl"}),Object(j.jsx)(b.EuiSpacer,{size:"l"}),Object(j.jsx)("h1",null,r),Object(j.jsx)(b.EuiTextColor,{color:"subdued"},Object(j.jsx)("p",null,d))),Object(j.jsx)(b.EuiSpacer,{size:"xxl"}),Object(j.jsx)(Lm,{action:n}))},Nm=["className","noDataConfig","pageSideBar","pageSideBarProps"],Rm=function(e){var t,a=e.className,n=e.noDataConfig,s=e.pageSideBar,l=e.pageSideBarProps,r=am()(e,Nm);if(!n)return null;s&&(t=Object(j.jsx)(b.EuiPageTemplate.Sidebar,l,s));var o=function(e,t){return y()("kbnPageTemplate","",t||"")}(0,a);return Object(j.jsx)(b.EuiPageTemplate,i()({className:o,restrictWidth:950,panelled:!1,offset:0,minHeight:0},r),t,Object(j.jsx)(Dm,n))},Bm=(function(e){var t,a=Object(b.useIsWithinBreakpoints)(["m"]),n=Object(b.useIsWithinMinBreakpoint)("l"),l=Object(s.useState)(!JSON.parse(String(localStorage.getItem(vm)))),r=tl()(l,2),o=r[0],u=r[1],c=e.solutionNav,d=e.children,p=am()(e,xm),m=Object(b.useEuiTheme)().euiTheme,g=c.canBeCollapsed,f=a||(void 0===g||g)&&n&&!o,h=function(e){return Object(hm.css)("flex:0 1 0;overflow:hidden;",b.euiCanAnimate,"{transition:min-width ",e.animation.fast," ",e.animation.resistance,";}","")}(m),x=y()({"kbnSolutionNav__sidebar--shrink":f},null===(t=e.pageSideBarProps)||void 0===t?void 0:t.className,h),v=Object(j.jsx)(bm,i()({isOpenOnDesktop:o,onCollapse:function(){u(!o),localStorage.setItem(vm,JSON.stringify(o))}},c)),O=nl()(nl()({paddingSize:"none"},e.pageSideBarProps),{},{minWidth:f?m.size.xxl:void 0,className:x});return Object(j.jsx)(Qp,nl()(nl()({},p),{},{pageSideBar:v,pageSideBarProps:O}),d)}.displayName="WithSolutionNavBar(".concat((Zp=Qp=Rm).displayName||Zp.name||"UnnamedComponent",")"),a(123));function Vm(e){var t=e.href;return Object(j.jsx)("dl",null,Object(j.jsx)(b.EuiTitle,{size:"xxs"},Object(j.jsx)("dt",{className:"eui-displayInline"},Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.learnMore",defaultMessage:"Want to learn more?"})))," ",Object(j.jsx)("dd",{className:"eui-displayInline"},Object(j.jsx)(b.EuiLink,{href:t,target:"_blank",external:!0},Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.readDocumentation",defaultMessage:"Read the docs"}))))}var zm=u.i18n.translate("sharedUXPackages.noDataViewsPrompt.addDataViewText",{defaultMessage:"Create data view"}),Gm=function(e){var t=e.onClickCreate,n=e.canCreateNewDataView,i=e.dataViewsDocLink,s=e.emptyPromptColor,r=void 0===s?"plain":s,o=n&&Object(j.jsx)(b.EuiButton,{onClick:t,iconType:"plusInCircle",fill:!0,"data-test-subj":"createDataViewButton"},zm),u=n?Object(j.jsx)("h2",null,Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.youHaveData",defaultMessage:"You have data in Elasticsearch."}),Object(j.jsx)("br",null),Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.nowCreate",defaultMessage:"Now, create a data view."})):Object(j.jsx)("h2",null,Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.noPermission.title",defaultMessage:"You need permission to create data views"})),d=n?Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.dataViewExplanation",defaultMessage:"Data views identify the Elasticsearch data you want to explore. You can point data views to one or more data streams, indices, and index aliases, such as your log data from yesterday, or all indices that contain your log data."})):Object(j.jsx)("p",null,Object(j.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.noPermission.dataViewExplanation",defaultMessage:"Data views identify the Elasticsearch data that you want to explore. To create data views, ask your administrator for the required permissions."})),p=i?Object(j.jsx)(Vm,{href:i}):void 0,m=Object(Bm.c)(l.a.lazy((function(){return a.e(6).then(a.bind(null,492)).then((function(e){return{default:e.DataViewIllustration}}))})),Object(j.jsx)(b.EuiPanel,{color:"subdued",style:{width:226,height:206}})),g=Object(j.jsx)(m,null);return Object(j.jsx)(b.EuiEmptyPrompt,{"data-test-subj":"noDataViewsPrompt",layout:"horizontal",css:Object(j.css)("max-width:",830,"px!important;flex-grow:0;",""),color:r,actions:o,icon:g,title:u,body:d,footer:p})},qm=["children"],Hm=l.a.createContext(null),$m=function(e){var t,a=e.children,n=am()(e,qm);return Object(j.jsx)(Hm.Provider,{value:{dataViewsDocLink:null===(t=n.coreStart.docLinks.links.indexPatterns)||void 0===t?void 0:t.introduction,canCreateNewDataView:n.dataViewEditor.userPermissions.editDataView(),openDataViewEditor:n.dataViewEditor.openEditor}},a)},Wm=function(e){var t=e.onDataViewCreated,a=e.allowAdHocDataView,n=void 0!==a&&a,i=function(){var e=Object(s.useContext)(Hm);if(!e)throw new Error("NoDataViewsPromptContext is missing.  Ensure your component or React root is wrapped with NoDataViewsPromptProvider.");return e}(),l=i.canCreateNewDataView,r=i.openDataViewEditor,o=i.dataViewsDocLink,u=Object(s.useRef)();Object(s.useEffect)((function(){return function(){null!=u&&u.current&&(null==u||u.current())}}),[]);var c=Object(s.useCallback)((function(e){u.current=e}),[]),d=Object(s.useCallback)((function(){if(l){var e=r({onSave:function(e){t(e)},allowAdHocDataView:n});c&&c(e)}}),[l,r,n,c,t]);return Object(j.jsx)(Gm,{onClickCreate:d,canCreateNewDataView:l,dataViewsDocLink:o})},Um=["children"],Xm=l.a.createContext(null),Ym=function(e){var t=e.children,a=am()(e,Um),n=a.dataViews,i={hasESData:n.hasData.hasESData,hasUserDataView:n.hasData.hasUserDataView};return Object(j.jsx)(Xm.Provider,{value:i},Object(j.jsx)($m,a,Object(j.jsx)(Pm,a,t)))},Km={name:"y1f223",styles:"margin:auto"},Qm=function(e){var t=e.onDataViewCreated,a=e.noDataConfig,n=e.allowAdHocDataView,i=function(){var e=Object(s.useContext)(Xm);if(!e)throw new Error("KibanaNoDataPageContext is missing.  Ensure your component or React root is wrapped with KibanaNoDataPageContext.");return e}(),l=i.hasESData,r=i.hasUserDataView,o=Object(s.useState)(!0),u=tl()(o,2),c=u[0],d=u[1],p=Object(s.useState)(!1),m=tl()(p,2),g=m[0],f=m[1],h=Object(s.useState)(!1),x=tl()(h,2),v=x[0],y=x[1];return Object(s.useEffect)((function(){var e=function(){var e=im()(lm.a.mark((function e(){return lm.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,l();case 3:return e.t1=e.sent,(0,e.t0)(e.t1),e.t2=y,e.next=8,r();case 8:e.t3=e.sent,(0,e.t2)(e.t3),d(!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e().catch((function(){d(!1)}))}),[l,r]),c?Object(j.jsx)(b.EuiLoadingElastic,{css:Km,size:"xxl"}):!v&&g?Object(j.jsx)(Wm,{onDataViewCreated:t,allowAdHocDataView:n}):g?null:Object(j.jsx)(Rm,{noDataConfig:a})},Zm=["children"],Jm=l.a.createContext(null),eg=function(e){var t=e.children,a=am()(e,Zm),n={kibanaGuideDocLink:a.coreStart.docLinks.links.kibana.guide};return Object(j.jsx)(Jm.Provider,{value:n},Object(j.jsx)(Ym,a,t))},tg=u.i18n.translate("sharedUXPackages.noDataConfig.analytics",{defaultMessage:"Analytics"}),ag=u.i18n.translate("sharedUXPackages.noDataConfig.analyticsPageTitle",{defaultMessage:"Welcome to Analytics!"}),ng=u.i18n.translate("sharedUXPackages.noDataConfig.addIntegrationsTitle",{defaultMessage:"Add integrations"}),ig=u.i18n.translate("sharedUXPackages.noDataConfig.addIntegrationsDescription",{defaultMessage:"Use Elastic Agent to collect data and build out Analytics solutions."}),sg=function(e){var t=e.kibanaGuideDocLink,a=e.onDataViewCreated,n=e.allowAdHocDataView,i={solution:tg,pageTitle:ag,logo:"logoKibana",action:{elasticAgent:{title:ng,description:ig,"data-test-subj":"kbnOverviewAddIntegrations"}},docsLink:t};return Object(j.jsx)(Qm,{noDataConfig:i,onDataViewCreated:a,allowAdHocDataView:n})},lg=function(e){var t=e.onDataViewCreated,a=e.allowAdHocDataView,n=function(){var e=Object(s.useContext)(Jm);if(!e)throw new Error("AnalyticsNoDataPage Context is missing.  Ensure your component or React root is wrapped with AnalyticsNoDataPageContext.");return e}().kibanaGuideDocLink;return Object(j.jsx)(sg,{onDataViewCreated:t,allowAdHocDataView:a,kibanaGuideDocLink:n})},rg=(a(470),a(52)),og=a(62),ug=a(122);const cg=document.createElement("div");let dg=!1;function pg({anchorElement:e,isOpen:t,onClose:a}){const n=Object(og.V)(og.r),i=Object(og.U)(),l=Object(s.useCallback)((()=>{a(),Object(kc.c)(new Pi.Storage(localStorage),ug.a,String(n)),i(n?Object(og.d)():Object(og.f)())}),[i,n,a]);return Object(j.jsx)(b.EuiWrappingPopover,{"data-test-subj":"lnsApp__settingsMenu",ownFocus:!0,button:e,closePopover:a,isOpen:!0},Object(j.jsx)(b.EuiPopoverTitle,null,Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.settings.title",defaultMessage:"Lens settings"})),Object(j.jsx)(b.EuiSwitch,{label:u.i18n.translate("xpack.lens.settings.autoApply",{defaultMessage:"Auto-apply visualization changes"}),checked:n,onChange:()=>l(),"data-test-subj":"lnsToggleAutoApply"}))}function mg(){o.a.unmountComponentAtNode(cg),document.body.removeChild(cg),dg=!1}var gg=a(71);const fg=({setHeaderActionMenu:e,initialInput:t,indicateNoData:a,lensInspector:n,setIsSaveModalVisible:r,getIsByValueMode:p,runSave:m,onAppLeave:g,redirectToOrigin:f,datasourceMap:b,visualizationMap:h,title:x,goBackToOriginatingApp:v,contextOriginatingApp:y,initialContextIsEmbedded:O,topNavMenuEntryGenerators:k,initialContext:I,theme$:T,indexPatternService:w,currentDoc:M,onTextBasedSavedAndExit:C})=>{var S,F;const{data:E,fieldFormats:P,navigation:A,uiSettings:_,application:L,attributeService:D,discover:N,dashboardFeatureFlag:R,dataViewFieldEditor:B,dataViewEditor:V,dataViews:z}=Object(d.useKibana)().services,{isSaveable:G,isLinkedToOriginatingApp:q,query:H,activeData:$,savedQuery:W,activeDatasourceId:U,datasourceStates:X,visualization:Y,filters:K,dataViews:Q}=Object(og.V)((e=>e.lens)),Z=Object(og.U)(),J=l.a.useCallback((e=>Z(Object(og.L)(e))),[Z]),[ee,te]=Object(s.useState)([]),[ae,ne]=Object(s.useState)(),[ie,se]=Object(s.useState)(!1),[le,re]=Object(s.useState)([]),oe=l.a.useCallback((async e=>{const t="string"==typeof e?e:e.id,a=await w.ensureIndexPattern({id:t,cache:Q.indexPatterns});Z(Object(gg.a)({dataViews:{indexPatterns:a},datasourceIds:Object.keys(X),visualizationIds:Y.activeId?[Y.activeId]:[],indexPatternId:t}))}),[Q.indexPatterns,X,Z,w,Y.activeId]),ue=Boolean(null==V?void 0:V.userPermissions.editDataView())||!(null!=ae&&ae.isPersisted()),ce=Object(s.useRef)(),de=Object(s.useRef)(),pe=Object.values(X).every((({isLoading:e})=>!1===e));Object(s.useEffect)((()=>{if(!(b&&U&&!X[U].isLoading?b[U]:void 0))return;const e=new Set(Object(Gt.getIndexPatternsIds)({activeDatasources:Object.keys(X).reduce(((e,t)=>({...e,[t]:b[t]})),{}),datasourceStates:X,visualizationState:Y.state,activeVisualization:Y.activeId?h[Y.activeId]:void 0}));Object.values(Q.indexPatterns).filter((e=>!e.isPersisted)).forEach((t=>{e.add(t.id)})),(ee.length+le.length!==e.size||[...e].some((e=>![...ee.map((e=>e.id)),...le].find((t=>t===e)))))&&Object(Gt.getIndexPatternsObjects)([...e],z).then((({indexPatterns:e,rejectedIds:t})=>{te(e),re(t)}))}),[X,U,le,b,h,Y,ee,z,Q]),Object(s.useEffect)((()=>{(async()=>{if(U&&X[U].state){const e=b[U].getUsedDataView(X[U].state),t=await E.dataViews.get(e);ne(null!=t?t:ee[0])}})()}),[U,b,X,ee,E.dataViews]),Object(s.useEffect)((()=>{"object"==typeof H&&null!==H&&Object(ys.isOfAggregateQueryType)(H)&&se(!0)}),[H]),Object(s.useEffect)((()=>()=>{var e,t;null===(e=ce.current)||void 0===e||e.call(ce),null===(t=de.current)||void 0===t||t.call(de)}),[]);const{AggregateQueryTopNavMenu:me}=A.ui,{from:ge,to:fe}=E.query.timefilter.timefilter.getTime(),be=Boolean(G&&L.capabilities.visualize.save),he=Boolean(G&&(null===(S=L.capabilities.dashboard)||void 0===S?void 0:S.showWriteControls)),xe=u.i18n.translate("xpack.lens.app.unsavedFilename",{defaultMessage:"unsaved"}),ve=Object(s.useMemo)((()=>{if(!Y.activeId)return;const e=Y.activeId,t=k.flatMap((t=>{const a=t({datasourceStates:X,visualizationId:e,visualizationState:Y.state,query:H,filters:K,initialContext:I,currentDoc:M});return a?[a]:[]}));return t.length>0?t:void 0}),[X,k,Y.activeId,Y.state,H,K,I,M]),ye=Object(s.useMemo)((()=>{if(U&&N)return Gd(b[U],X[U].state,$,Q.indexPatterns,E.query.timefilter.timefilter.getTime(),L.capabilities)}),[U,N,b,X,$,Q.indexPatterns,E.query.timefilter.timefilter,L.capabilities]),je=Object(em.useStore)(),Oe=Object(s.useMemo)((()=>{const e=function(e){const{actions:t,showCancel:a,allowByValue:n,enableExportToCSV:i,showOpenInDiscover:s,showSaveAndReturn:l,savingToLibraryPermitted:r,savingToDashboardPermitted:o,tooltips:c,contextOriginatingApp:d,isSaveable:p}=e,m=[],g=r||n&&o&&!e.isByValueMode&&!e.showSaveAndReturn,f=e.isByValueMode?u.i18n.translate("xpack.lens.app.addToLibrary",{defaultMessage:"Save to library"}):e.showSaveAndReturn?u.i18n.translate("xpack.lens.app.saveAs",{defaultMessage:"Save as"}):u.i18n.translate("xpack.lens.app.save",{defaultMessage:"Save"});if(d&&m.push({label:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:d}}),run:t.goBack,className:"lnsNavItem__goBack",testId:"lnsApp_goBackToAppButton",description:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:d}}),disableButton:!1}),s){const e=u.i18n.translate("xpack.lens.app.exploreDataInDiscover",{defaultMessage:"Explore data in Discover"});m.push({label:e,run:()=>{},testId:"lnsApp_openInDiscover",description:e,disableButton:Boolean(c.showUnderlyingDataWarning()),tooltip:c.showUnderlyingDataWarning,target:"_blank",href:t.getUnderlyingDataUrl()})}return m.push({label:u.i18n.translate("xpack.lens.app.inspect",{defaultMessage:"Inspect"}),run:t.inspect,testId:"lnsApp_inspectButton",description:u.i18n.translate("xpack.lens.app.inspectAriaLabel",{defaultMessage:"inspect"}),disableButton:!1}),m.push({label:u.i18n.translate("xpack.lens.app.downloadCSV",{defaultMessage:"Download as CSV"}),run:t.exportToCSV,testId:"lnsApp_downloadCSVButton",description:u.i18n.translate("xpack.lens.app.downloadButtonAriaLabel",{defaultMessage:"Download the data as CSV file"}),disableButton:!i,tooltip:c.showExportWarning}),m.push({label:u.i18n.translate("xpack.lens.app.settings",{defaultMessage:"Settings"}),run:t.openSettings,testId:"lnsApp_settingsButton",description:u.i18n.translate("xpack.lens.app.settingsAriaLabel",{defaultMessage:"Open the Lens settings menu"})}),a&&m.push({label:u.i18n.translate("xpack.lens.app.cancel",{defaultMessage:"Cancel"}),run:t.cancel,testId:"lnsApp_cancelButton",description:u.i18n.translate("xpack.lens.app.cancelButtonAriaLabel",{defaultMessage:"Return to the last app without saving changes"})}),m.push({label:f,iconType:l?void 0:"save",emphasize:!l,run:t.showSaveModal,testId:"lnsApp_saveButton",description:u.i18n.translate("xpack.lens.app.saveButtonAriaLabel",{defaultMessage:"Save the current lens visualization"}),disableButton:!g}),l&&m.push({label:u.i18n.translate("xpack.lens.app.saveAndReturn",{defaultMessage:"Save and return"}),emphasize:!0,iconType:"checkInCircleFilled",run:t.saveAndReturn,testId:"lnsApp_saveAndReturnButton",disableButton:!p,description:u.i18n.translate("xpack.lens.app.saveAndReturnButtonAriaLabel",{defaultMessage:"Save the current lens visualization and return to the last app"})}),m}({showSaveAndReturn:Boolean(q&&(R.allowByValueEmbeddables||Boolean(t)))||Boolean(O),enableExportToCSV:Boolean(G&&$&&Object.keys($).length),showOpenInDiscover:Boolean(null==ye?void 0:ye.isVisible),isByValueMode:p(),allowByValue:R.allowByValueEmbeddables,showCancel:Boolean(q),savingToLibraryPermitted:be,savingToDashboardPermitted:he,isSaveable:G,contextOriginatingApp:y,tooltips:{showExportWarning:()=>{if($&&Object.values($).some((e=>Object(js.tableHasFormulas)(e.columns,e.rows))))return u.i18n.translate("xpack.lens.app.downloadButtonFormulasWarning",{defaultMessage:"Your CSV contains characters that spreadsheet applications might interpret as formulas."})},showUnderlyingDataWarning:()=>null==ye?void 0:ye.error},actions:{inspect:()=>n.inspect({title:x}),exportToCSV:()=>{if(!$)return;const e=Object.values($),t=e.reduce(((t,a,n)=>{if(a){const i=e.length>1?`-${n+1}`:"";t[`${x||xe}${i}.csv`]={content:Kn.exporters.datatableToCSV(a,{csvSeparator:_.get("csv:separator",","),quoteValues:_.get("csv:quoteValues",!0),formatFactory:P.deserialize,escapeFormulaValues:!1}),type:Kn.exporters.CSV_MIME_TYPE}}return t}),{});t&&Object(rg.downloadMultipleAs)(t)},saveAndReturn:()=>{var e;G&&(g((e=>e.default())),m({newTitle:x||"",newCopyOnSave:!1,isTitleDuplicateConfirmed:!1,returnToOrigin:!0},{saveToLibrary:null!==(e=t&&D.inputIsRefType(t))&&void 0!==e&&e}))},showSaveModal:()=>{(he||be)&&r(!0)},goBack:()=>{y&&(null==v||v())},cancel:()=>{f&&f()},getUnderlyingDataUrl:()=>{var e;if(!ye)return;const{error:t,meta:a}=ye;if(t||!N||!a)return;const{filters:n,query:i}=qd(H,K,a,ee,Object(Kn.getEsQueryConfig)(_));return N.locator.getRedirectUrl({dataViewSpec:null===(e=Q.indexPatterns[a.id])||void 0===e?void 0:e.spec,timeRange:E.query.timefilter.timefilter.getTime(),filters:n,query:ie?H:i,columns:a.columns})},openSettings:e=>function(e){if(dg)return void mg();dg=!0,document.body.appendChild(cg);const t=Object(j.jsx)(em.Provider,{store:e.lensStore},Object(j.jsx)(d.KibanaThemeProvider,{theme$:e.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(pg,i()({},e,{isOpen:dg,onClose:mg})))));o.a.render(t,cg)}({lensStore:je,anchorElement:e,theme$:T})}});return[...ve||[],...e]}),[q,R.allowByValueEmbeddables,t,O,G,$,ye,p,be,he,y,ve,n,x,xe,_,P.deserialize,g,m,D,r,v,f,N,H,K,ee,Q.indexPatterns,E.query.timefilter.timefilter,ie,je,T]),ke=Object(s.useCallback)((e=>{const{dateRange:t,query:a}=e,n=E.query.timefilter.timefilter.getTime();t.from!==n.from||t.to!==n.to?E.query.timefilter.timefilter.setTime(t):J({searchSessionId:E.search.session.start(),resolvedDateRange:Object(Gt.getResolvedDateRange)(E.query.timefilter.timefilter)}),a&&(Object(jt.isEqual)(a,H)||(J({query:a}),Object(ys.isOfAggregateQueryType)(a)&&!ie&&(se(!0),Z(Object(og.O)({newDatasourceId:"textBased",visualizationId:null==Y?void 0:Y.activeId,currentIndexPatternId:null==ae?void 0:ae.id})))))}),[null==ae?void 0:ae.id,E.query.timefilter.timefilter,E.search.session,Z,J,ie,H,null==Y?void 0:Y.activeId]),Ie=Object(s.useCallback)((e=>{J({savedQuery:e})}),[J]),Te=Object(s.useCallback)((e=>{const t=e.attributes.filters||[],a=E.query.filterManager.getGlobalFilters();E.query.filterManager.setFilters([...a,...t]),J({query:e.attributes.query,savedQuery:{...e}})}),[E.query.filterManager,J]),we=Object(s.useCallback)((()=>{E.query.filterManager.setFilters(E.query.filterManager.getGlobalFilters()),J({filters:E.query.filterManager.getGlobalFilters(),query:E.query.queryString.getDefaultQuery(),savedQuery:void 0})}),[E.query.filterManager,E.query.queryString,J]),Me=Object(s.useCallback)((async()=>{null!=ae&&ae.id&&Object(Gt.refreshIndexPatternsList)({activeDatasources:Object.keys(X).reduce(((e,t)=>({...e,[t]:b[t]})),{}),indexPatternId:ae.id,indexPatternService:w,indexPatternsCache:Q.indexPatterns}),E.search.session.start()}),[ae,E.search.session,b,X,w,Q.indexPatterns]),Ce=Object(s.useMemo)((()=>ue?async(e,t="edit")=>{if(null!=ae&&ae.id){const t=await E.dataViews.get(null==ae?void 0:ae.id);ce.current=B.openEditor({ctx:{dataView:t},fieldName:e,onSave:()=>{t.isPersisted()?Me():w.replaceDataViewId(t)}})}}:void 0),[ue,null==ae?void 0:ae.id,E.dataViews,B,w,Me]),Se=Object(s.useMemo)((()=>ue&&Ce?()=>Ce(void 0,"add"):void 0),[Ce,ue]),Fe=Object(s.useCallback)((()=>{de.current=V.openEditor({onSave:async e=>{e.id&&(ie&&Z(Object(og.O)({newDatasourceId:"formBased",visualizationId:null==Y?void 0:Y.activeId,currentIndexPatternId:null==e?void 0:e.id})),oe(e),ne(e))},allowAdHocDataView:!0})}),[V,Z,oe,ie,null==Y?void 0:Y.activeId]),Ee=Object(s.useCallback)((async e=>{var t;const a=await z.create({title:e});"date"===(null===(t=a.fields.getByName("@timestamp"))||void 0===t?void 0:t.type)&&(a.timeFieldName="@timestamp"),ie&&Z(Object(og.O)({newDatasourceId:"formBased",visualizationId:null==Y?void 0:Y.activeId,currentIndexPatternId:null==a?void 0:a.id})),oe(a),ne(a)}),[z,Z,oe,ie,null==Y?void 0:Y.activeId]),Pe=[];_.get(at.e)&&Pe.push("SQL");const Ae={trigger:{label:(null==ae||null===(F=ae.getName)||void 0===F?void 0:F.call(ae))||"","data-test-subj":"lns-dataView-switch-link",title:(null==ae?void 0:ae.title)||""},currentDataViewId:null==ae?void 0:ae.id,onAddField:Se,onDataViewCreated:Fe,onCreateDefaultAdHocDataView:Ee,adHocDataViews:ee.filter((e=>!e.isPersisted())),onChangeDataView:async e=>{const t=await E.dataViews.get(e);ne(t),oe(e),ie&&(Z(Object(og.O)({newDatasourceId:"formBased",visualizationId:null==Y?void 0:Y.activeId,currentIndexPatternId:e})),se(!1))},onEditDataView:async e=>{if(ae)if(ae.isPersisted()){z.clearInstanceCache(ae.id);const e=await z.get(ae.id),t={...Q.indexPatterns};delete t[ae.id];const a=await w.ensureIndexPattern({id:e.id,cache:t});Z(Object(gg.a)({dataViews:{indexPatterns:a},indexPatternId:e.id})),J({searchSessionId:E.search.session.start(),resolvedDateRange:Object(Gt.getResolvedDateRange)(E.query.timefilter.timefilter)}),ne(e)}else w.replaceDataViewId(e)},textBasedLanguages:Pe},_e=[];if(U&&pe&&b[U]&&b[U].getUnifiedSearchErrors){var Le,De;const e=null===(Le=(De=b[U]).getUnifiedSearchErrors)||void 0===Le?void 0:Le.call(De,X[U].state);e&&_e.push(...e)}return Object(j.jsx)(me,{setMenuMountPoint:e,config:Oe,showSaveQuery:Boolean(L.capabilities.visualize.saveQuery),savedQuery:W,onQuerySubmit:ke,onSaved:Ie,onSavedQueryUpdated:Te,onClearSavedQuery:we,indexPatterns:ee,query:H,dateRangeFrom:ge,dateRangeTo:fe,indicateNoData:a,showSearchBar:!0,dataViewPickerComponentProps:Ae,showDatePicker:ee.some((e=>e.isTimeBased()))||Boolean(pe&&U&&b[U].isTimeBased(X[U].state,Q.indexPatterns)),textBasedLanguageModeErrors:_e,onTextBasedSavedAndExit:C,showFilterBar:!0,"data-test-subj":"lnsApp_topNav",screenTitle:"lens",appName:"lens",displayStyle:"detached"})};var bg=a(100);const hg=e=>JSON.parse(JSON.stringify(e)),xg=(e,t,a,n)=>{if(void 0===e||void 0===t)return e===t;const i=hg(e),s=hg(t);if((null==i?void 0:i.visualizationType)!==(null==s?void 0:s.visualizationType))return!1;if(!Object(jt.isEqual)(i.state.query,s.state.query))return!1;if(!Object(jt.isEqual)(i.state.visualization,s.state.visualization))return!1;const l=Object.keys(i.state.datasourceStates),r=Object.keys(s.state.datasourceStates);let o=Object(jt.intersection)(l,r).length===Object(jt.union)(l,r).length;if(o&&(o=l.map((e=>n[e].isEqual(i.state.datasourceStates[e],[...i.references,...i.state.internalReferences||[]],s.state.datasourceStates[e],[...s.references,...s.state.internalReferences||[]]))).every((e=>e))),!o)return!1;const[u,c]=[i,s].map((e=>Object(bg.removePinnedFilters)(function(e,t){var a;return t?{...t,state:{...t.state,filters:e((null===(a=t.state)||void 0===a?void 0:a.filters)||[],t.references)}}:void 0}(a,e))));return!!Object(jt.isEqual)(null==u?void 0:u.state.filters,null==c?void 0:c.state.filters)};function vg({history:e,onAppLeave:t,redirectTo:a,editorFrame:n,initialInput:i,incomingState:r,redirectToOrigin:o,setHeaderActionMenu:c,datasourceMap:p,visualizationMap:m,contextOriginatingApp:g,topNavMenuEntryGenerators:f,initialContext:h,theme$:x}){const v=Object(d.useKibana)().services,{data:y,dataViews:O,uiActions:k,uiSettings:I,chrome:T,inspector:w,application:M,savedObjectsTagging:C,getOriginatingAppName:S,spaces:F,http:E,notifications:P,executionContext:A,dashboardFeatureFlag:_}=v,L=Object(s.useRef)(),D=Object(og.U)(),N=Object(s.useCallback)((e=>D(Object(og.L)(e))),[D]),{persistedDoc:R,sharingSavedObjectProps:B,isLinkedToOriginatingApp:V,searchSessionId:z,isLoading:G,isSaveable:q}=Object(og.V)((e=>e.lens)),H=Object(s.useMemo)((()=>({datasourceMap:p,visualizationMap:m,extractFilterReferences:y.query.filterManager.extract.bind(y.query.filterManager)})),[p,m,y.query.filterManager]),$=Object(og.V)((e=>Object(og.C)(e,H))),[W,U]=Object(s.useState)(!1),[X,Y]=Object(s.useState)(!1),[K,Q]=Object(s.useState)(void 0),[Z,J]=Object(s.useState)(void 0),[ee,te]=Object(s.useState)(!1),[ae,ne]=Object(s.useState)(!1),ie=null==i?void 0:i.savedObjectId;Object(s.useEffect)((()=>{$&&Q($)}),[$]);const se=Object(s.useCallback)((()=>{U(!0)}),[U]);Object(d.useExecutionContext)(A,{type:"application",id:ie||"new",page:"editor"}),Object(s.useEffect)((()=>{W&&U(!1)}),[U,W,z]);const le=Object(s.useCallback)((()=>Boolean(_.allowByValueEmbeddables&&V&&!ie)),[_.allowByValueEmbeddables,V,ie]);Object(s.useEffect)((()=>{t((e=>M.capabilities.visualize.save&&!xg(R,K,y.query.filterManager.inject.bind(y.query.filterManager),p)&&(q||R)?e.confirm(u.i18n.translate("xpack.lens.app.unsavedWorkMessage",{defaultMessage:"Leave Lens with unsaved work?"}),u.i18n.translate("xpack.lens.app.unsavedWorkTitle",{defaultMessage:"Unsaved changes"}),void 0,u.i18n.translate("xpack.lens.app.unsavedWorkConfirmBtn",{defaultMessage:"Discard changes"}),"danger"):e.default()))}),[t,K,q,R,M.capabilities.visualize.save,y.query.filterManager,p]);const re=Object(s.useCallback)((()=>{if(F&&"conflict"===(null==B?void 0:B.outcome)&&null!=R&&R.savedObjectId){const t=R.savedObjectId,a=null==B?void 0:B.aliasTargetId,n=E.basePath.prepend(`${Object(at.l)(a)}${e.location.search}`);return F.ui.components.getLegacyUrlConflict({objectNoun:u.i18n.translate("xpack.lens.appName",{defaultMessage:"Lens visualization"}),currentObjectId:t,otherObjectId:a,otherObjectPath:n})}return null}),[R,B,F,E,e]);Object(s.useEffect)((()=>{const e=le(),t=h&&"originatingApp"in h&&h.originatingApp,a=[];(V||t)&&S()&&o&&a.push({onClick:()=>{o()},text:S()}),e||a.push({href:M.getUrlForApp("visualize"),onClick:e=>{M.navigateToApp("visualize",{path:"/"}),e.preventDefault()},text:u.i18n.translate("xpack.lens.breadcrumbsTitle",{defaultMessage:"Visualize Library"})});let n=u.i18n.translate("xpack.lens.breadcrumbsCreate",{defaultMessage:"Create"});R&&(n=e?u.i18n.translate("xpack.lens.breadcrumbsByValue",{defaultMessage:"Edit visualization"}):R.title),a.push({text:n}),T.setBreadcrumbs(a)}),[_.allowByValueEmbeddables,S,o,le,M,T,V,R,h]);const oe=Object(s.useCallback)((()=>{L&&L.current&&L.current()}),[]),ue=Object(s.useCallback)(((e,n)=>(D(Object(og.b)()),Object(bg.runSaveLensVisualization)({lastKnownDoc:K,getIsByValueMode:le,savedObjectsTagging:C,initialInput:i,redirectToOrigin:o,persistedDoc:R,onAppLeave:t,redirectTo:a,switchDatasource:oe,originatingApp:null==r?void 0:r.originatingApp,textBasedLanguageSave:ae,...v},e,n).then((e=>{e&&(N(e),Y(!1),ne(!1))}),(()=>{})))),[D,K,le,C,i,o,R,t,a,oe,null==r?void 0:r.originatingApp,ae,v,N]);Object(s.useEffect)((()=>{K&&!Z&&J(K)}),[K,Z]);const ce=Object(s.useCallback)((()=>{h&&"vizEditorOriginatingAppUrl"in h&&h.vizEditorOriginatingAppUrl&&(xg(Z,K,y.query.filterManager.inject,p)?(t((e=>e.default())),M.navigateToApp("visualize",{path:h.vizEditorOriginatingAppUrl})):te(!0))}),[M,y.query.filterManager.inject,p,h,Z,K,t]),de=Object(s.useCallback)((()=>{te(!1),h&&"vizEditorOriginatingAppUrl"in h&&h.vizEditorOriginatingAppUrl&&(t((e=>e.default())),M.navigateToApp("visualize",{path:h.vizEditorOriginatingAppUrl}))}),[M,h,t]),pe=Object(s.useMemo)((()=>Boolean(h&&"originatingApp"in h&&h.originatingApp)),[h]),me=Object(s.useMemo)((()=>function({core:e,dataViews:t,data:a,updateIndexPatterns:n,replaceIndexPattern:i,uiActions:s,contextDataViewSpec:l}){const r=t=>e.notifications.toasts.addError(t,{title:u.i18n.translate("xpack.lens.indexPattern.dataViewLoadError",{defaultMessage:"Error loading data view"})});return{updateDataViewsState:n,loadIndexPatterns:e=>Object(Np.d)({dataViews:t,...e}),replaceDataViewId:async e=>{const a=await t.create({...e.toSpec(),id:Object(Ge.a)()});l&&l.id!==e.id&&t.clearInstanceCache(e.id);const n=await Object(Np.d)({dataViews:t,patterns:[a.id],cache:{}});i(n[a.id],e.id,{applyImmediately:!0});const r=s.getTrigger(bs.UPDATE_FILTER_REFERENCES_TRIGGER),o=s.getAction(bs.UPDATE_FILTER_REFERENCES_ACTION);null==o||o.execute({trigger:r,fromDataView:e.id,toDataView:a.id,usedDataViews:[]})},ensureIndexPattern:e=>Object(Np.b)({onError:r,dataViews:t,...e}),loadIndexPatternRefs:async({isFullEditor:e})=>e?Object(Np.c)(t):[],getDefaultIndex:()=>e.uiSettings.get("defaultIndex")}}({dataViews:O,uiActions:k,core:{http:E,notifications:P,uiSettings:I},data:y,contextDataViewSpec:null==h?void 0:h.dataViewSpec,updateIndexPatterns:(e,t)=>{D(Object(og.R)(e)),null!=t&&t.applyImmediately&&D(Object(og.b)())},replaceIndexPattern:(e,t,a)=>{D(Object(gg.h)({newIndexPattern:e,oldId:t})),null!=a&&a.applyImmediately&&D(Object(og.b)())}})),[O,k,E,P,I,y,h,D]),ge=Object(s.useCallback)((async({onSave:e,onCancel:t})=>{Y(!0),ne(!0),L.current=()=>{e()}}),[]);return Object(j.jsx)(l.a.Fragment,null,Object(j.jsx)("div",{className:"lnsApp","data-test-subj":"lnsApp",role:"main"},Object(j.jsx)(fg,{initialInput:i,redirectToOrigin:o,getIsByValueMode:le,onAppLeave:t,runSave:ue,setIsSaveModalVisible:Y,setHeaderActionMenu:c,indicateNoData:W,datasourceMap:p,visualizationMap:m,title:null==R?void 0:R.title,lensInspector:w,currentDoc:$,goBackToOriginatingApp:ce,contextOriginatingApp:g,initialContextIsEmbedded:pe,topNavMenuEntryGenerators:f,initialContext:h,theme$:x,indexPatternService:me,onTextBasedSavedAndExit:ge}),re(),(!G||R)&&Object(j.jsx)(yg,{editorFrame:n,showNoDataPopover:se,lensInspector:w,indexPatternService:me})),X&&Object(j.jsx)(bg.SaveModalContainer,{lensServices:v,originatingApp:V?null==r?void 0:r.originatingApp:void 0,isSaveable:q,runSave:ue,onClose:()=>{Y(!1)},getAppNameFromId:()=>S(),lastKnownDoc:K,onAppLeave:t,persistedDoc:R,initialInput:i,redirectTo:a,redirectToOrigin:o,returnToOriginSwitchLabel:le()&&i?u.i18n.translate("xpack.lens.app.updatePanel",{defaultMessage:"Update panel on {originatingAppName}",values:{originatingAppName:S()}}):void 0}),ee&&Object(j.jsx)(b.EuiConfirmModal,{maxWidth:600,title:u.i18n.translate("xpack.lens.app.goBackModalTitle",{defaultMessage:"Discard changes?"}),onCancel:()=>te(!1),onConfirm:de,cancelButtonText:u.i18n.translate("xpack.lens.app.goBackModalCancelBtn",{defaultMessage:"Cancel"}),confirmButtonText:u.i18n.translate("xpack.lens.app.goBackModalTitle",{defaultMessage:"Discard changes?"}),buttonColor:"danger",defaultFocusedButton:"confirm"},u.i18n.translate("xpack.lens.app.goBackModalMessage",{defaultMessage:"The changes you have made here are not backwards compatible with your original {contextOriginatingApp} visualization. Are you sure you want to discard these unsaved changes and return to {contextOriginatingApp}?",values:{contextOriginatingApp:g}})))}const yg=l.a.memo((function({editorFrame:e,showNoDataPopover:t,lensInspector:a,indexPatternService:n}){const{EditorFrameContainer:i}=e;return Object(j.jsx)(i,{showNoDataPopover:t,lensInspector:a,indexPatternService:n})}));async function jg(e,t,a){const{data:n,inspector:i,navigation:s,embeddable:l,savedObjectsTagging:r,usageCollection:o,fieldFormats:u,spaces:c,discover:d,unifiedSearch:p}=t,m=new Pi.Storage(localStorage),g=null==l?void 0:l.getStateTransfer(),f=null==g?void 0:g.getIncomingEditorState(at.a);return{data:n,storage:m,inspector:Xp(i),navigation:s,fieldFormats:u,stateTransfer:g,usageCollection:o,savedObjectsTagging:r,attributeService:a,executionContext:e.executionContext,http:e.http,uiActions:t.uiActions,chrome:e.chrome,overlays:e.overlays,uiSettings:e.uiSettings,application:e.application,notifications:e.notifications,savedObjectsClient:e.savedObjects.client,presentationUtil:t.presentationUtil,dataViewEditor:t.dataViewEditor,dataViewFieldEditor:t.dataViewFieldEditor,dashboard:t.dashboard,charts:t.charts,getOriginatingAppName:()=>null!=f&&f.originatingApp?null==g?void 0:g.getAppNameFromId(f.originatingApp):void 0,dataViews:t.dataViews,dashboardFeatureFlag:t.dashboard.dashboardFeatureFlagConfig,spaces:c,discover:d,unifiedSearch:p,docLinks:e.docLinks}}async function Og(e,t,a){const{createEditorFrame:n,attributeService:o,getPresentationUtilContext:p,topNavMenuEntryGenerators:m}=a,[[g,f],h]=await Promise.all([e.getStartServices(),n()]),x=t.history.location.state,v=await jg(g,f,o),{stateTransfer:y,data:O}=v,k=null==y?void 0:y.getIncomingEditorState(at.a);var I,T;I=g.chrome,T=g.docLinks,I.setHelpExtension({appName:"Lens",links:[{linkType:"documentation",href:T.links.visualize.lensPanels},{linkType:"github",title:"[Lens]",labels:["Feature:Lens"]}]}),v.application.capabilities.visualize.save||g.chrome.setBadge({text:u.i18n.translate("xpack.lens.badge.readOnly.text",{defaultMessage:"Read only"}),tooltip:u.i18n.translate("xpack.lens.badge.readOnly.tooltip",{defaultMessage:"Unable to save visualizations to the library"}),iconType:"glasses"}),g.chrome.docTitle.change(u.i18n.translate("xpack.lens.pageTitle",{defaultMessage:"Lens"}));const w=e=>{var t;const a=M&&"originatingApp"in M?M.originatingApp:null,n=null!==(t=null==k?void 0:k.originatingApp)&&void 0!==t?t:a;if(!n)throw new Error("redirectToOrigin called without an originating app");let i=null==k?void 0:k.embeddableId;if(M&&"embeddableId"in M&&(i=M.embeddableId),y&&null!=e&&e.input){const{input:t,isCopied:a}=e;y.navigateToWithEmbeddablePackage(n,{path:null==k?void 0:k.originatingPath,state:{embeddableId:a?void 0:i,type:at.h,input:t,searchSessionId:O.search.session.getSessionId()}})}else g.application.navigateToApp(n,{path:null==k?void 0:k.originatingPath})},M=!x||x.type!==_d.ACTION_VISUALIZE_LENS_FIELD&&x.type!==A.ACTION_CONVERT_TO_LENS?void 0:x.payload;x&&x.type===_d.ACTION_VISUALIZE_LENS_FIELD&&(null==M||delete M.originatingApp),null!=k&&k.searchSessionId&&O.search.session.continue(k.searchSessionId);const{datasourceMap:C,visualizationMap:S}=h,F={lensServices:v,datasourceMap:C,visualizationMap:S,embeddableEditorIncomingState:k,initialContext:M},E=Object(og.j)(F,{lens:Object(gg.c)(F)}),P=l.a.memo((a=>{const[n,i]=Object(s.useState)("loading");Object(s.useEffect)((()=>{const e=Object(Pi.createKbnUrlStateStorage)({history:a.history,useHash:v.uiSettings.get("state:storeInSessionStorage"),...Object(Pi.withNotifyOnErrors)(v.notifications.toasts)}),{stop:t}=Object(Kn.syncGlobalQueryStateWithUrl)(O.query,e);return()=>{t()}}),[a.history]);const l=Object(s.useCallback)((e=>{var t,n;t=a.history,(n=e)?t.push({pathname:`/edit/${n}`,search:t.location.search}):t.push({pathname:"/",search:t.location.search})}),[a.history]),r=Object(s.useMemo)((()=>{return e=a.id,a.editByValue?null==k?void 0:k.valueInput:e?{savedObjectId:e}:void 0;var e}),[a.editByValue,a.id]),o=Object(s.useCallback)((()=>{M||O.query.filterManager.setAppFilters([]),E.dispatch(Object(gg.j)(Object(gg.c)(F))),E.dispatch(Object(og.i)({redirectCallback:l,initialInput:r,history:a.history}))}),[r,a.history,l]);if(Object(s.useEffect)((()=>{(async()=>{await O.dataViews.hasData.hasUserDataView().catch((()=>!1))?(i("data"),o()):i("no_data")})()}),[o,r,a.history,l]),"loading"===n)return Object(j.jsx)(b.EuiLoadingSpinner,null);if("no_data"===n){const e={coreStart:g,dataViews:O.dataViews,dataViewEditor:f.dataViewEditor};return Object(j.jsx)(eg,e,Object(j.jsx)(lg,{onDataViewCreated:()=>{i("data"),o()}}))}return Object(j.jsx)(em.Provider,{store:E},Object(j.jsx)(vg,{incomingState:k,editorFrame:h,initialInput:r,redirectTo:l,redirectToOrigin:w,onAppLeave:t.onAppLeave,setHeaderActionMenu:t.setHeaderActionMenu,history:a.history,datasourceMap:C,visualizationMap:S,initialContext:M,contextOriginatingApp:null==x?void 0:x.originatingApp,topNavMenuEntryGenerators:m,theme$:e.theme.theme$}))})),_=e=>Object(j.jsx)(P,{id:e.match.params.id,history:e.history,editByValue:e.editByValue}),L=t.history.listen((()=>{window.dispatchEvent(new HashChangeEvent("hashchange"))}));t.element.classList.add("lnsAppWrapper");const D=p();return Object(r.render)(Object(j.jsx)(d.KibanaThemeProvider,{theme$:g.theme.theme$},Object(j.jsx)(c.I18nProvider,null,Object(j.jsx)(d.KibanaContextProvider,{services:v},Object(j.jsx)(D,null,Object(j.jsx)(Jp.HashRouter,null,Object(j.jsx)(Jp.Switch,null,Object(j.jsx)(Jp.Route,{exact:!0,path:"/edit/:id",component:_}),Object(j.jsx)(Jp.Route,{exact:!0,path:`/${at.g}`,render:e=>Object(j.jsx)(_,i()({},e,{editByValue:!0}))}),Object(j.jsx)(Jp.Route,{exact:!0,path:"/",component:_}),Object(j.jsx)(Jp.Route,{path:"/",component:function(){return Object(j.jsx)(c.FormattedMessage,{id:"xpack.lens.app404",defaultMessage:"404 Not Found"})}}))))))),t.element),()=>{var e;O.search.session.clear(),Object(r.unmountComponentAtNode)(t.element),v.inspector.close(),L(),E.dispatch(Object(og.k)()),null===(e=y.clearEditorState)||void 0===e||e.call(y,at.a)}}var kg=a(163);function Ig(e,t){const a=new kg.a(e.savedObjects.client);return t.embeddable.getAttributeService(Bd.DOC_TYPE,{saveMethod:async(e,t)=>({id:(await a.save({...e,savedObjectId:t,type:Bd.DOC_TYPE})).savedObjectId}),unwrapMethod:async e=>{const{saved_object:t,outcome:n,alias_target_id:i,alias_purpose:s}=await a.load(e),{attributes:l,references:r,id:o}=t;return{attributes:{...{...l,references:r}},metaInfo:{sharingSavedObjectProps:{aliasTargetId:i,outcome:n,aliasPurpose:s,sourceId:o}}}},checkForDuplicateTitle:t=>{const a=e.savedObjects.client,n=e.overlays;return Object(kg.b)({title:t.newTitle,displayName:Bd.DOC_TYPE,isTitleDuplicateConfirmed:t.isTitleDuplicateConfirmed,lastSavedTitle:"",copyOnSave:!1},t.onTitleDuplicate,{savedObjectsClient:a,overlays:n})}})}function Tg(e){return e.type===at.d}async function wg({hasDiscoverAccess:e,embeddable:t}){if(!e)return!1;try{return Tg(t)&&await t.canViewUnderlyingData()}catch(e){return console.error(e),!1}}async function Mg({embeddable:e,filters:t,dataViews:n,timeFieldName:i}){if(!Tg(e))throw new Error("Can only be executed in the context of Lens visualization");const s=e.getViewUnderlyingDataArgs();if(!s)throw new Error("Underlying data is not ready");const l=await n.get(s.dataViewSpec.id);let r=[...t||[],...s.filters],o=s.timeRange;if(l.isTimeBased()&&l.timeFieldName===i){const{extractTimeRange:e}=await Promise.resolve().then(a.t.bind(null,30,7)),{restOfFilters:n,timeRange:s}=e(t||[],i);r=n,s&&(o=s)}return{...s,timeRange:o,filters:r}}async function Cg({embeddable:e,discover:t,filters:a,dataViews:n,timeFieldName:i}){var s;const l=await Mg({embeddable:e,filters:a,dataViews:n,timeFieldName:i});return null===(s=t.locator)||void 0===s?void 0:s.getRedirectUrl(l)}async function Sg({embeddable:e,discover:t,filters:a,dataViews:n,timeFieldName:i}){var s;const l=await Mg({embeddable:e,filters:a,dataViews:n,timeFieldName:i}),r=null===(s=t.locator)||void 0===s?void 0:s.getLocation(l);if(!r)throw new Error("Discover location not found");return r}async function Fg({embeddable:e,discover:t,filters:a,openInSameTab:n,dataViews:i,timeFieldName:s,hasDiscoverAccess:l}){const r=await Cg({embeddable:e,discover:t,filters:a,dataViews:i,timeFieldName:s,hasDiscoverAccess:l});window.open(r,n?"_self":"_blank")}}])]);