/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[11],{114:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a(1);const n=e=>{const t={avg:r.i18n.translate("xpack.infra.waffle.aggregationNames.avg",{defaultMessage:"Avg of {field}",values:{field:e.field}}),max:r.i18n.translate("xpack.infra.waffle.aggregationNames.max",{defaultMessage:"Max of {field}",values:{field:e.field}}),min:r.i18n.translate("xpack.infra.waffle.aggregationNames.min",{defaultMessage:"Min of {field}",values:{field:e.field}}),rate:r.i18n.translate("xpack.infra.waffle.aggregationNames.rate",{defaultMessage:"Rate of {field}",values:{field:e.field}})};return e.label?e.label:t[e.aggregation]}},126:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var r=a(14),n=a(22),i=a(18),s=a(2),l=a(21),o=a(86),c=a(77);function u(e,t,a,u,d,m,p,g,f=!0,b){b=b||{interval:"1m",to:m,from:m-12e5,lookbackSize:5};const{error:h,loading:y,response:E,makeRequest:v}=Object(o.a)("/api/metrics/snapshot","POST",JSON.stringify({metrics:t,groupBy:a,nodeType:u,timerange:b,filterQuery:e,sourceId:d,accountId:p,region:g,includeTimeseries:!0}),(e=>Object(i.pipe)(c.g.decode(e),Object(r.fold)(Object(l.c)(l.a),n.identity))));return Object(s.useEffect)((()=>{(async()=>{f&&await v()})()}),[v,f]),{error:h&&h.message||null,loading:y,nodes:E?E.nodes:[],interval:E?E.interval:"60s",reload:v}}},127:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var r=a(25),n=a(31),i=a(77),s=a(124),l=a(33);const o={count:{formatter:n.b.number,template:"{{value}}"},cpu:{formatter:n.b.percent,template:"{{value}}"},cpuCores:{formatter:n.b.number,template:"{{value}}"},memory:{formatter:n.b.percent,template:"{{value}}"},memoryTotal:{formatter:n.b.bytes,template:"{{value}}"},diskLatency:{formatter:n.b.number,template:"{{value}} ms"},rx:{formatter:n.b.bits,template:"{{value}}/s"},tx:{formatter:n.b.bits,template:"{{value}}/s"},logRate:{formatter:n.b.abbreviatedNumber,template:"{{value}}/s"},diskIOReadBytes:{formatter:n.b.bytes,template:"{{value}}/s"},diskIOWriteBytes:{formatter:n.b.bytes,template:"{{value}}/s"},s3BucketSize:{formatter:n.b.bytes,template:"{{value}}"},s3TotalRequests:{formatter:n.b.abbreviatedNumber,template:"{{value}}"},s3NumberOfObjects:{formatter:n.b.abbreviatedNumber,template:"{{value}}"},s3UploadBytes:{formatter:n.b.bytes,template:"{{value}}"},s3DownloadBytes:{formatter:n.b.bytes,template:"{{value}}"},sqsOldestMessage:{formatter:n.b.number,template:"{{value}} seconds"},rdsLatency:{formatter:n.b.number,template:"{{value}} ms"}},c=e=>t=>{if(i.d.is(e))return Object(s.a)(e)(t);const a=Object(r.get)(o,e.type,o.count);return null==t?"":Object(l.b)(a.formatter,a.template)(t)}},139:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var r=a(1),n=a(25);const i={CPUUsage:r.i18n.translate("xpack.infra.waffle.metricOptions.cpuUsageText",{defaultMessage:"CPU usage"}),MemoryUsage:r.i18n.translate("xpack.infra.waffle.metricOptions.memoryUsageText",{defaultMessage:"memory usage"}),InboundTraffic:r.i18n.translate("xpack.infra.waffle.metricOptions.inboundTrafficText",{defaultMessage:"inbound traffic"}),OutboundTraffic:r.i18n.translate("xpack.infra.waffle.metricOptions.outboundTrafficText",{defaultMessage:"outbound traffic"}),LogRate:r.i18n.translate("xpack.infra.waffle.metricOptions.hostLogRateText",{defaultMessage:"log rate"}),Load:r.i18n.translate("xpack.infra.waffle.metricOptions.loadText",{defaultMessage:"load"}),Count:r.i18n.translate("xpack.infra.waffle.metricOptions.countText",{defaultMessage:"count"}),DiskIOReadBytes:r.i18n.translate("xpack.infra.waffle.metricOptions.diskIOReadBytes",{defaultMessage:"disk reads"}),DiskIOWriteBytes:r.i18n.translate("xpack.infra.waffle.metricOptions.diskIOWriteBytes",{defaultMessage:"disk writes"}),s3BucketSize:r.i18n.translate("xpack.infra.waffle.metricOptions.s3BucketSize",{defaultMessage:"bucket size"}),s3TotalRequests:r.i18n.translate("xpack.infra.waffle.metricOptions.s3TotalRequests",{defaultMessage:"total requests"}),s3NumberOfObjects:r.i18n.translate("xpack.infra.waffle.metricOptions.s3NumberOfObjects",{defaultMessage:"number of objects"}),s3DownloadBytes:r.i18n.translate("xpack.infra.waffle.metricOptions.s3DownloadBytes",{defaultMessage:"downloads (bytes)"}),s3UploadBytes:r.i18n.translate("xpack.infra.waffle.metricOptions.s3UploadBytes",{defaultMessage:"uploads (bytes)"}),rdsConnections:r.i18n.translate("xpack.infra.waffle.metricOptions.rdsConnections",{defaultMessage:"connections"}),rdsQueriesExecuted:r.i18n.translate("xpack.infra.waffle.metricOptions.rdsQueriesExecuted",{defaultMessage:"queries executed"}),rdsActiveTransactions:r.i18n.translate("xpack.infra.waffle.metricOptions.rdsActiveTransactions",{defaultMessage:"active transactions"}),rdsLatency:r.i18n.translate("xpack.infra.waffle.metricOptions.rdsLatency",{defaultMessage:"latency"}),sqsMessagesVisible:r.i18n.translate("xpack.infra.waffle.metricOptions.sqsMessagesVisible",{defaultMessage:"messages available"}),sqsMessagesDelayed:r.i18n.translate("xpack.infra.waffle.metricOptions.sqsMessagesDelayed",{defaultMessage:"messages delayed"}),sqsMessagesSent:r.i18n.translate("xpack.infra.waffle.metricOptions.sqsMessagesSent",{defaultMessage:"messages added"}),sqsMessagesEmpty:r.i18n.translate("xpack.infra.waffle.metricOptions.sqsMessagesEmpty",{defaultMessage:"messages returned empty"}),sqsOldestMessage:r.i18n.translate("xpack.infra.waffle.metricOptions.sqsOldestMessage",{defaultMessage:"oldest message"})},s=Object(n.mapValues)(i,(e=>`${e[0].toUpperCase()}${e.slice(1)}`)),l=e=>{switch(e){case"cpu":return{text:s.CPUUsage,textLC:i.CPUUsage,value:"cpu"};case"memory":return{text:s.MemoryUsage,textLC:i.MemoryUsage,value:"memory"};case"rx":return{text:s.InboundTraffic,textLC:i.InboundTraffic,value:"rx"};case"tx":return{text:s.OutboundTraffic,textLC:i.OutboundTraffic,value:"tx"};case"logRate":return{text:s.LogRate,textLC:i.LogRate,value:"logRate"};case"load":return{text:s.Load,textLC:i.Load,value:"load"};case"count":return{text:s.Count,textLC:i.Count,value:"count"};case"diskIOReadBytes":return{text:s.DiskIOReadBytes,textLC:i.DiskIOReadBytes,value:"diskIOReadBytes"};case"diskIOWriteBytes":return{text:s.DiskIOWriteBytes,textLC:i.DiskIOWriteBytes,value:"diskIOWriteBytes"};case"s3BucketSize":return{text:s.s3BucketSize,textLC:i.s3BucketSize,value:"s3BucketSize"};case"s3TotalRequests":return{text:s.s3TotalRequests,textLC:i.s3TotalRequests,value:"s3TotalRequests"};case"s3NumberOfObjects":return{text:s.s3NumberOfObjects,textLC:i.s3NumberOfObjects,value:"s3NumberOfObjects"};case"s3DownloadBytes":return{text:s.s3DownloadBytes,textLC:i.s3DownloadBytes,value:"s3DownloadBytes"};case"s3UploadBytes":return{text:s.s3UploadBytes,textLC:i.s3UploadBytes,value:"s3UploadBytes"};case"rdsConnections":return{text:s.rdsConnections,textLC:i.rdsConnections,value:"rdsConnections"};case"rdsQueriesExecuted":return{text:s.rdsQueriesExecuted,textLC:i.rdsQueriesExecuted,value:"rdsQueriesExecuted"};case"rdsActiveTransactions":return{text:s.rdsActiveTransactions,textLC:i.rdsActiveTransactions,value:"rdsActiveTransactions"};case"rdsLatency":return{text:s.rdsLatency,textLC:i.rdsLatency,value:"rdsLatency"};case"sqsMessagesVisible":return{text:s.sqsMessagesVisible,textLC:i.sqsMessagesVisible,value:"sqsMessagesVisible"};case"sqsMessagesDelayed":return{text:s.sqsMessagesDelayed,textLC:i.sqsMessagesDelayed,value:"sqsMessagesDelayed"};case"sqsMessagesSent":return{text:s.sqsMessagesSent,textLC:i.sqsMessagesSent,value:"sqsMessagesSent"};case"sqsMessagesEmpty":return{text:s.sqsMessagesEmpty,textLC:i.sqsMessagesEmpty,value:"sqsMessagesEmpty"};case"sqsOldestMessage":return{text:s.sqsOldestMessage,textLC:i.sqsOldestMessage,value:"sqsOldestMessage"}}}},204:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var r=a(12),n=a(1),i=a(2),s=a.n(i);const l=({options:e,onChange:t,fields:a,errorOptions:l})=>{const o=Object(i.useCallback)((e=>{const a=e.map((e=>e.label));t(a)}),[t]),c=Array.isArray(e.groupBy)?e.groupBy.map((e=>({label:e,color:null!=l&&l.includes(e)?"danger":void 0}))):e.groupBy?[{label:e.groupBy,color:null!=l&&l.includes(e.groupBy)?"danger":void 0}]:[];return s.a.createElement(r.EuiComboBox,{"data-test-subj":"metricsExplorer-groupBy",placeholder:n.i18n.translate("xpack.infra.metricsExplorer.groupByLabel",{defaultMessage:"Everything"}),"aria-label":n.i18n.translate("xpack.infra.metricsExplorer.groupByAriaLabel",{defaultMessage:"Graph per"}),fullWidth:!0,singleSelection:!1,selectedOptions:c,options:a.filter((e=>e.aggregatable&&"string"===e.type)).map((e=>({label:e.name}))),onChange:o,isClearable:!0})}},205:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var r=a(10),n=a.n(r),i=a(2),s=a(25),l=a(9),o=a(94),c=a(113),u=a(21),d=a(71);function m(e,t,a,r,m,p,g=!0){var f;const b=null===(f=Object(l.useKibana)().services.http)||void 0===f?void 0:f.fetch,[h,y]=Object(i.useState)(null),[E,v]=Object(i.useState)(!0),[x,k]=Object(i.useState)(null),[O,M]=Object(i.useState)(null),[w,j]=Object(i.useState)(null),S=n.a.parse(r.from),C=n.a.parse(r.to,{roundUp:!0}),[,T]=Object(d.c)({cancelPreviousOn:"creation",createPromise:()=>(v(!0),S&&C?b?t?b?b("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify({forceInterval:e.forceInterval,dropLastBucket:null==e.dropLastBucket||e.dropLastBucket,metrics:"count"===e.aggregation?[{aggregation:"count"}]:e.metrics.map((e=>({aggregation:e.aggregation,field:e.field}))),groupBy:e.groupBy,afterKey:m,limit:e.limit,indexPattern:t.metricAlias,filterQuery:e.filterQuery&&Object(c.a)(e.filterQuery,a)||void 0,timerange:{...r,from:S.valueOf(),to:C.valueOf()}})}):Promise.reject(new Error("HTTP service is unavailable")):Promise.reject(new Error("Source is unavailable")):Promise.reject(new Error("HTTP service is unavailable")):Promise.reject(new Error("Unalble to parse timerange"))),onResolve:t=>{v(!1);const a=Object(u.b)(o.e)(t);if(a){if(x&&O&&x.pageInfo.afterKey!==a.pageInfo.afterKey&&(n=O,i=e,Object(s.isEqual)(n,i))&&Object(s.isEqual)(r,w)&&m){const{series:e}=x;k({...a,series:[...e,...a.series]})}else k(a);M(e),j(r),y(null)}var n,i},onReject:e=>{y(e),v(!1)}},[t,r,e,p,m]);return Object(i.useEffect)((()=>{g&&T()}),[T,g]),{error:h,loading:E,data:x,loadData:T}}},271:function(e,t,a){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},272:function(e,t,a){const r=a(271),n={};for(const e of Object.keys(r))n[r[e]]=e;const i={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};e.exports=i;for(const e of Object.keys(i)){if(!("channels"in i[e]))throw new Error("missing channels property: "+e);if(!("labels"in i[e]))throw new Error("missing channel labels property: "+e);if(i[e].labels.length!==i[e].channels)throw new Error("channel and label counts mismatch: "+e);const{channels:t,labels:a}=i[e];delete i[e].channels,delete i[e].labels,Object.defineProperty(i[e],"channels",{value:t}),Object.defineProperty(i[e],"labels",{value:a})}i.rgb.hsl=function(e){const t=e[0]/255,a=e[1]/255,r=e[2]/255,n=Math.min(t,a,r),i=Math.max(t,a,r),s=i-n;let l,o;i===n?l=0:t===i?l=(a-r)/s:a===i?l=2+(r-t)/s:r===i&&(l=4+(t-a)/s),l=Math.min(60*l,360),l<0&&(l+=360);const c=(n+i)/2;return o=i===n?0:c<=.5?s/(i+n):s/(2-i-n),[l,100*o,100*c]},i.rgb.hsv=function(e){let t,a,r,n,i;const s=e[0]/255,l=e[1]/255,o=e[2]/255,c=Math.max(s,l,o),u=c-Math.min(s,l,o),d=function(e){return(c-e)/6/u+.5};return 0===u?(n=0,i=0):(i=u/c,t=d(s),a=d(l),r=d(o),s===c?n=r-a:l===c?n=1/3+t-r:o===c&&(n=2/3+a-t),n<0?n+=1:n>1&&(n-=1)),[360*n,100*i,100*c]},i.rgb.hwb=function(e){const t=e[0],a=e[1];let r=e[2];const n=i.rgb.hsl(e)[0],s=1/255*Math.min(t,Math.min(a,r));return r=1-1/255*Math.max(t,Math.max(a,r)),[n,100*s,100*r]},i.rgb.cmyk=function(e){const t=e[0]/255,a=e[1]/255,r=e[2]/255,n=Math.min(1-t,1-a,1-r);return[100*((1-t-n)/(1-n)||0),100*((1-a-n)/(1-n)||0),100*((1-r-n)/(1-n)||0),100*n]},i.rgb.keyword=function(e){const t=n[e];if(t)return t;let a,i=1/0;for(const t of Object.keys(r)){const n=(l=r[t],((s=e)[0]-l[0])**2+(s[1]-l[1])**2+(s[2]-l[2])**2);n<i&&(i=n,a=t)}var s,l;return a},i.keyword.rgb=function(e){return r[e]},i.rgb.xyz=function(e){let t=e[0]/255,a=e[1]/255,r=e[2]/255;return t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,a=a>.04045?((a+.055)/1.055)**2.4:a/12.92,r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,[100*(.4124*t+.3576*a+.1805*r),100*(.2126*t+.7152*a+.0722*r),100*(.0193*t+.1192*a+.9505*r)]},i.rgb.lab=function(e){const t=i.rgb.xyz(e);let a=t[0],r=t[1],n=t[2];return a/=95.047,r/=100,n/=108.883,a=a>.008856?a**(1/3):7.787*a+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,[116*r-16,500*(a-r),200*(r-n)]},i.hsl.rgb=function(e){const t=e[0]/360,a=e[1]/100,r=e[2]/100;let n,i,s;if(0===a)return s=255*r,[s,s,s];n=r<.5?r*(1+a):r+a-r*a;const l=2*r-n,o=[0,0,0];for(let e=0;e<3;e++)i=t+1/3*-(e-1),i<0&&i++,i>1&&i--,s=6*i<1?l+6*(n-l)*i:2*i<1?n:3*i<2?l+(n-l)*(2/3-i)*6:l,o[e]=255*s;return o},i.hsl.hsv=function(e){const t=e[0];let a=e[1]/100,r=e[2]/100,n=a;const i=Math.max(r,.01);return r*=2,a*=r<=1?r:2-r,n*=i<=1?i:2-i,[t,100*(0===r?2*n/(i+n):2*a/(r+a)),(r+a)/2*100]},i.hsv.rgb=function(e){const t=e[0]/60,a=e[1]/100;let r=e[2]/100;const n=Math.floor(t)%6,i=t-Math.floor(t),s=255*r*(1-a),l=255*r*(1-a*i),o=255*r*(1-a*(1-i));switch(r*=255,n){case 0:return[r,o,s];case 1:return[l,r,s];case 2:return[s,r,o];case 3:return[s,l,r];case 4:return[o,s,r];case 5:return[r,s,l]}},i.hsv.hsl=function(e){const t=e[0],a=e[1]/100,r=e[2]/100,n=Math.max(r,.01);let i,s;s=(2-a)*r;const l=(2-a)*n;return i=a*n,i/=l<=1?l:2-l,i=i||0,s/=2,[t,100*i,100*s]},i.hwb.rgb=function(e){const t=e[0]/360;let a=e[1]/100,r=e[2]/100;const n=a+r;let i;n>1&&(a/=n,r/=n);const s=Math.floor(6*t),l=1-r;i=6*t-s,0!=(1&s)&&(i=1-i);const o=a+i*(l-a);let c,u,d;switch(s){default:case 6:case 0:c=l,u=o,d=a;break;case 1:c=o,u=l,d=a;break;case 2:c=a,u=l,d=o;break;case 3:c=a,u=o,d=l;break;case 4:c=o,u=a,d=l;break;case 5:c=l,u=a,d=o}return[255*c,255*u,255*d]},i.cmyk.rgb=function(e){const t=e[0]/100,a=e[1]/100,r=e[2]/100,n=e[3]/100;return[255*(1-Math.min(1,t*(1-n)+n)),255*(1-Math.min(1,a*(1-n)+n)),255*(1-Math.min(1,r*(1-n)+n))]},i.xyz.rgb=function(e){const t=e[0]/100,a=e[1]/100,r=e[2]/100;let n,i,s;return n=3.2406*t+-1.5372*a+-.4986*r,i=-.9689*t+1.8758*a+.0415*r,s=.0557*t+-.204*a+1.057*r,n=n>.0031308?1.055*n**(1/2.4)-.055:12.92*n,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,n=Math.min(Math.max(0,n),1),i=Math.min(Math.max(0,i),1),s=Math.min(Math.max(0,s),1),[255*n,255*i,255*s]},i.xyz.lab=function(e){let t=e[0],a=e[1],r=e[2];return t/=95.047,a/=100,r/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,a=a>.008856?a**(1/3):7.787*a+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,[116*a-16,500*(t-a),200*(a-r)]},i.lab.xyz=function(e){let t,a,r;a=(e[0]+16)/116,t=e[1]/500+a,r=a-e[2]/200;const n=a**3,i=t**3,s=r**3;return a=n>.008856?n:(a-16/116)/7.787,t=i>.008856?i:(t-16/116)/7.787,r=s>.008856?s:(r-16/116)/7.787,t*=95.047,a*=100,r*=108.883,[t,a,r]},i.lab.lch=function(e){const t=e[0],a=e[1],r=e[2];let n;return n=360*Math.atan2(r,a)/2/Math.PI,n<0&&(n+=360),[t,Math.sqrt(a*a+r*r),n]},i.lch.lab=function(e){const t=e[0],a=e[1],r=e[2]/360*2*Math.PI;return[t,a*Math.cos(r),a*Math.sin(r)]},i.rgb.ansi16=function(e,t=null){const[a,r,n]=e;let s=null===t?i.rgb.hsv(e)[2]:t;if(s=Math.round(s/50),0===s)return 30;let l=30+(Math.round(n/255)<<2|Math.round(r/255)<<1|Math.round(a/255));return 2===s&&(l+=60),l},i.hsv.ansi16=function(e){return i.rgb.ansi16(i.hsv.rgb(e),e[2])},i.rgb.ansi256=function(e){const t=e[0],a=e[1],r=e[2];return t===a&&a===r?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(a/255*5)+Math.round(r/255*5)},i.ansi16.rgb=function(e){let t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),t=t/10.5*255,[t,t,t];const a=.5*(1+~~(e>50));return[(1&t)*a*255,(t>>1&1)*a*255,(t>>2&1)*a*255]},i.ansi256.rgb=function(e){if(e>=232){const t=10*(e-232)+8;return[t,t,t]}let t;return e-=16,[Math.floor(e/36)/5*255,Math.floor((t=e%36)/6)/5*255,t%6/5*255]},i.rgb.hex=function(e){const t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},i.hex.rgb=function(e){const t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let a=t[0];3===t[0].length&&(a=a.split("").map((e=>e+e)).join(""));const r=parseInt(a,16);return[r>>16&255,r>>8&255,255&r]},i.rgb.hcg=function(e){const t=e[0]/255,a=e[1]/255,r=e[2]/255,n=Math.max(Math.max(t,a),r),i=Math.min(Math.min(t,a),r),s=n-i;let l,o;return l=s<1?i/(1-s):0,o=s<=0?0:n===t?(a-r)/s%6:n===a?2+(r-t)/s:4+(t-a)/s,o/=6,o%=1,[360*o,100*s,100*l]},i.hsl.hcg=function(e){const t=e[1]/100,a=e[2]/100,r=a<.5?2*t*a:2*t*(1-a);let n=0;return r<1&&(n=(a-.5*r)/(1-r)),[e[0],100*r,100*n]},i.hsv.hcg=function(e){const t=e[1]/100,a=e[2]/100,r=t*a;let n=0;return r<1&&(n=(a-r)/(1-r)),[e[0],100*r,100*n]},i.hcg.rgb=function(e){const t=e[0]/360,a=e[1]/100,r=e[2]/100;if(0===a)return[255*r,255*r,255*r];const n=[0,0,0],i=t%1*6,s=i%1,l=1-s;let o=0;switch(Math.floor(i)){case 0:n[0]=1,n[1]=s,n[2]=0;break;case 1:n[0]=l,n[1]=1,n[2]=0;break;case 2:n[0]=0,n[1]=1,n[2]=s;break;case 3:n[0]=0,n[1]=l,n[2]=1;break;case 4:n[0]=s,n[1]=0,n[2]=1;break;default:n[0]=1,n[1]=0,n[2]=l}return o=(1-a)*r,[255*(a*n[0]+o),255*(a*n[1]+o),255*(a*n[2]+o)]},i.hcg.hsv=function(e){const t=e[1]/100,a=t+e[2]/100*(1-t);let r=0;return a>0&&(r=t/a),[e[0],100*r,100*a]},i.hcg.hsl=function(e){const t=e[1]/100,a=e[2]/100*(1-t)+.5*t;let r=0;return a>0&&a<.5?r=t/(2*a):a>=.5&&a<1&&(r=t/(2*(1-a))),[e[0],100*r,100*a]},i.hcg.hwb=function(e){const t=e[1]/100,a=t+e[2]/100*(1-t);return[e[0],100*(a-t),100*(1-a)]},i.hwb.hcg=function(e){const t=e[1]/100,a=1-e[2]/100,r=a-t;let n=0;return r<1&&(n=(a-r)/(1-r)),[e[0],100*r,100*n]},i.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},i.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},i.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},i.gray.hsl=function(e){return[0,0,e[0]]},i.gray.hsv=i.gray.hsl,i.gray.hwb=function(e){return[0,100,e[0]]},i.gray.cmyk=function(e){return[0,0,0,e[0]]},i.gray.lab=function(e){return[e[0],0,0]},i.gray.hex=function(e){const t=255&Math.round(e[0]/100*255),a=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(a.length)+a},i.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},454:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(455),n=a(14);t.ThrowReporter={report:function(e){if(n.isLeft(e))throw new Error(r.PathReporter.report(e).join("\n"))}}},455:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(0),n=a(14);function i(e){return void 0!==e.message?e.message:"Invalid value "+("function"==typeof(t=e.value)?r.getFunctionName(t):"number"!=typeof t||isFinite(t)?JSON.stringify(t):isNaN(t)?"NaN":t>0?"Infinity":"-Infinity")+" supplied to "+e.context.map((function(e){return e.key+": "+e.type.name})).join("/");var t}function s(e){return e.map(i)}function l(){return["No errors!"]}t.failure=s,t.success=l,t.PathReporter={report:n.fold(s,l)}},456:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","groups":["hosts","metrics"],"description":"Metrics: Hosts - Identify unusual spikes in memory usage across hosts.","analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(\'system.memory.actual.used.pct\')","function":"max","field_name":"system.memory.actual.used.pct","custom_rules":[{"actions":["skip_result"],"conditions":[{"applies_to":"actual","operator":"lt","value":0.1}]}]}],"influencers":["host.name"]},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"64mb"},"custom_settings":{"managed":true,"created_by":"ml-module-metrics-ui-hosts","custom_urls":[{"url_name":"Host Metrics","url_value":"metrics/detail/host/$host.name$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},457:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"system.memory"}}]}}}')},458:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","description":"Metrics: Hosts - Identify unusual spikes in inbound traffic across hosts.","groups":["hosts","metrics"],"analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(bytes_in_derivative)","function":"max","field_name":"bytes_in_derivative"}],"influencers":["host.name"],"summary_count_field_name":"doc_count"},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"32mb"},"custom_settings":{"managed":true,"created_by":"ml-module-metrics-ui-hosts","custom_urls":[{"url_name":"Host Metrics","url_value":"metrics/detail/host/$host.name$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},459:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"system.network"}}]}},"chunking_config":{"mode":"manual","time_span":"900s"},"aggregations":{"host.name":{"terms":{"field":"host.name","size":100},"aggregations":{"buckets":{"date_histogram":{"field":"@timestamp","fixed_interval":"5m"},"aggregations":{"@timestamp":{"max":{"field":"@timestamp"}},"bytes_in_max":{"max":{"field":"system.network.in.bytes"}},"bytes_in_derivative":{"derivative":{"buckets_path":"bytes_in_max"}},"positive_only":{"bucket_script":{"buckets_path":{"in_derivative":"bytes_in_derivative.value"},"script":"params.in_derivative > 0.0 ? params.in_derivative : 0.0"}}}}}}}}')},460:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","description":"Metrics: Hosts - Identify unusual spikes in outbound traffic across hosts.","groups":["hosts","metrics"],"analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(bytes_out_derivative)","function":"max","field_name":"bytes_out_derivative"}],"influencers":["host.name"],"summary_count_field_name":"doc_count"},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"32mb"},"custom_settings":{"managed":true,"created_by":"ml-module-metrics-ui-hosts","custom_urls":[{"url_name":"Host Metrics","url_value":"metrics/detail/host/$host.name$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},461:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"system.network"}}]}},"chunking_config":{"mode":"manual","time_span":"900s"},"aggregations":{"host.name":{"terms":{"field":"host.name","size":100},"aggregations":{"buckets":{"date_histogram":{"field":"@timestamp","fixed_interval":"5m"},"aggregations":{"@timestamp":{"max":{"field":"@timestamp"}},"bytes_out_max":{"max":{"field":"system.network.out.bytes"}},"bytes_out_derivative":{"derivative":{"buckets_path":"bytes_out_max"}},"positive_only":{"bucket_script":{"buckets_path":{"out_derivative":"bytes_out_derivative.value"},"script":"params.out_derivative > 0.0 ? params.out_derivative : 0.0"}}}}}}}}')},462:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","groups":["k8s","metrics"],"description":"Metrics: Kubernetes - Identify unusual spikes in memory usage across Kubernetes pods.","analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(\'kubernetes.pod.memory.usage.node.pct\')","function":"max","field_name":"kubernetes.pod.memory.usage.node.pct","partition_field_name":"kubernetes.namespace","custom_rules":[{"actions":["skip_result"],"conditions":[{"applies_to":"actual","operator":"lt","value":0.1}]}]}],"influencers":["kubernetes.namespace","kubernetes.node.name","kubernetes.pod.uid"]},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"64mb"},"custom_settings":{"managed":true,"created_by":"ml-module-metrics-ui-k8s","custom_urls":[{"url_name":"Pod Metrics","url_value":"metrics/detail/pod/$kubernetes.pod.uid$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},463:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"kubernetes.pod.uid"}},{"exists":{"field":"kubernetes.pod.memory"}}]}}}')},464:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","description":"Metrics: Kubernetes - Identify unusual spikes in inbound traffic across Kubernetes pods.","groups":["k8s","metrics"],"analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(bytes_in_derivative)","function":"max","field_name":"bytes_in_derivative","partition_field_name":"kubernetes.namespace"}],"influencers":["kubernetes.namespace","kubernetes.pod.uid"],"summary_count_field_name":"doc_count"},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"32mb"},"custom_settings":{"managed":true,"created_by":"ml-module-metrics-ui-k8s","custom_urls":[{"url_name":"Pod Metrics","url_value":"metrics/detail/pod/$kubernetes.pod.uid$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},465:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"kubernetes.pod.network"}}]}},"chunking_config":{"mode":"manual","time_span":"900s"},"aggregations":{"kubernetes.namespace":{"terms":{"field":"kubernetes.namespace","size":25},"aggregations":{"kubernetes.pod.uid":{"terms":{"field":"kubernetes.pod.uid","size":100},"aggregations":{"buckets":{"date_histogram":{"field":"@timestamp","fixed_interval":"5m"},"aggregations":{"@timestamp":{"max":{"field":"@timestamp"}},"bytes_in_max":{"max":{"field":"kubernetes.pod.network.rx.bytes"}},"bytes_in_derivative":{"derivative":{"buckets_path":"bytes_in_max"}},"positive_only":{"bucket_script":{"buckets_path":{"in_derivative":"bytes_in_derivative.value"},"script":"params.in_derivative > 0.0 ? params.in_derivative : 0.0"}}}}}}}}}}')},466:function(e){e.exports=JSON.parse('{"job_type":"anomaly_detector","description":"Metrics: Kubernetes - Identify unusual spikes in outbound traffic across Kubernetes pods.","groups":["k8s","metrics"],"analysis_config":{"bucket_span":"15m","detectors":[{"detector_description":"max(bytes_out_derivative)","function":"max","field_name":"bytes_out_derivative","partition_field_name":"kubernetes.namespace"}],"influencers":["kubernetes.namespace","kubernetes.pod.uid"],"summary_count_field_name":"doc_count"},"data_description":{"time_field":"@timestamp"},"analysis_limits":{"model_memory_limit":"32mb"},"custom_settings":{"managed":true,"created_by":"ml-module-metrics-ui-k8s","custom_urls":[{"url_name":"Pod Metrics","url_value":"metrics/detail/pod/$kubernetes.pod.uid$?metricTime=(autoReload:!f,refreshInterval:5000,time:(from:%27$earliest$%27,interval:%3E%3D1m,to:%27$latest$%27))"}]}}')},467:function(e){e.exports=JSON.parse('{"job_id":"JOB_ID","indices":["INDEX_PATTERN_NAME"],"indices_options":{"allow_no_indices":true},"query":{"bool":{"must":[{"exists":{"field":"kubernetes.pod.network"}}]}},"chunking_config":{"mode":"manual","time_span":"900s"},"aggregations":{"kubernetes.namespace":{"terms":{"field":"kubernetes.namespace","size":25},"aggregations":{"kubernetes.pod.uid":{"terms":{"field":"kubernetes.pod.uid","size":100},"aggregations":{"buckets":{"date_histogram":{"field":"@timestamp","fixed_interval":"5m"},"aggregations":{"@timestamp":{"max":{"field":"@timestamp"}},"bytes_out_max":{"max":{"field":"kubernetes.pod.network.tx.bytes"}},"bytes_out_derivative":{"derivative":{"buckets_path":"bytes_out_max"}},"positive_only":{"bucket_script":{"buckets_path":{"pos_derivative":"bytes_out_derivative.value"},"script":"params.pos_derivative > 0.0 ? params.pos_derivative : 0.0"}}}}}}}}}}')},468:function(e,t,a){const r=a(469),n=a(472),i=["keyword","gray","hex"],s={};for(const e of Object.keys(n))s[[...n[e].labels].sort().join("")]=e;const l={};function o(e,t){if(!(this instanceof o))return new o(e,t);if(t&&t in i&&(t=null),t&&!(t in n))throw new Error("Unknown model: "+t);let a,c;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof o)this.model=e.model,this.color=[...e.color],this.valpha=e.valpha;else if("string"==typeof e){const t=r.get(e);if(null===t)throw new Error("Unable to parse color from string: "+e);this.model=t.model,c=n[this.model].channels,this.color=t.value.slice(0,c),this.valpha="number"==typeof t.value[c]?t.value[c]:1}else if(e.length>0){this.model=t||"rgb",c=n[this.model].channels;const a=Array.prototype.slice.call(e,0,c);this.color=m(a,c),this.valpha="number"==typeof e[c]?e[c]:1}else if("number"==typeof e)this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;const t=Object.keys(e);"alpha"in e&&(t.splice(t.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);const r=t.sort().join("");if(!(r in s))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=s[r];const{labels:i}=n[this.model],l=[];for(a=0;a<i.length;a++)l.push(e[i[a]]);this.color=m(l)}if(l[this.model])for(c=n[this.model].channels,a=0;a<c;a++){const e=l[this.model][a];e&&(this.color[a]=e(this.color[a]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}o.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(e){let t=this.model in r.to?this:this.rgb();t=t.round("number"==typeof e?e:1);const a=1===t.valpha?t.color:[...t.color,this.valpha];return r.to[t.model](a)},percentString(e){const t=this.rgb().round("number"==typeof e?e:1),a=1===t.valpha?t.color:[...t.color,this.valpha];return r.to.rgb.percent(a)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const e={},{channels:t}=n[this.model],{labels:a}=n[this.model];for(let r=0;r<t;r++)e[a[r]]=this.color[r];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray(){const e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject(){const e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round(e){return e=Math.max(e||0,0),new o([...this.color.map(c(e)),this.valpha],this.model)},alpha(e){return void 0!==e?new o([...this.color,Math.max(0,Math.min(1,e))],this.model):this.valpha},red:u("rgb",0,d(255)),green:u("rgb",1,d(255)),blue:u("rgb",2,d(255)),hue:u(["hsl","hsv","hsl","hwb","hcg"],0,(e=>(e%360+360)%360)),saturationl:u("hsl",1,d(100)),lightness:u("hsl",2,d(100)),saturationv:u("hsv",1,d(100)),value:u("hsv",2,d(100)),chroma:u("hcg",1,d(100)),gray:u("hcg",2,d(100)),white:u("hwb",1,d(100)),wblack:u("hwb",2,d(100)),cyan:u("cmyk",0,d(100)),magenta:u("cmyk",1,d(100)),yellow:u("cmyk",2,d(100)),black:u("cmyk",3,d(100)),x:u("xyz",0,d(95.047)),y:u("xyz",1,d(100)),z:u("xyz",2,d(108.833)),l:u("lab",0,d(100)),a:u("lab",1),b:u("lab",2),keyword(e){return void 0!==e?new o(e):n[this.model].keyword(this.color)},hex(e){return void 0!==e?new o(e):r.to.hex(this.rgb().round().color)},hexa(e){if(void 0!==e)return new o(e);const t=this.rgb().round().color;let a=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===a.length&&(a="0"+a),r.to.hex(t)+a},rgbNumber(){const e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity(){const e=this.rgb().color,t=[];for(const[a,r]of e.entries()){const e=r/255;t[a]=e<=.04045?e/12.92:((e+.055)/1.055)**2.4}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast(e){const t=this.luminosity(),a=e.luminosity();return t>a?(t+.05)/(a+.05):(a+.05)/(t+.05)},level(e){const t=this.contrast(e);return t>=7?"AAA":t>=4.5?"AA":""},isDark(){const e=this.rgb().color;return(2126*e[0]+7152*e[1]+722*e[2])/1e4<128},isLight(){return!this.isDark()},negate(){const e=this.rgb();for(let t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten(e){const t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken(e){const t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate(e){const t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate(e){const t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten(e){const t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken(e){const t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale(){const e=this.rgb().color,t=.3*e[0]+.59*e[1]+.11*e[2];return o.rgb(t,t,t)},fade(e){return this.alpha(this.valpha-this.valpha*e)},opaquer(e){return this.alpha(this.valpha+this.valpha*e)},rotate(e){const t=this.hsl();let a=t.color[0];return a=(a+e)%360,a=a<0?360+a:a,t.color[0]=a,t},mix(e,t){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);const a=e.rgb(),r=this.rgb(),n=void 0===t?.5:t,i=2*n-1,s=a.alpha()-r.alpha(),l=((i*s==-1?i:(i+s)/(1+i*s))+1)/2,c=1-l;return o.rgb(l*a.red()+c*r.red(),l*a.green()+c*r.green(),l*a.blue()+c*r.blue(),a.alpha()*n+r.alpha()*(1-n))}};for(const e of Object.keys(n)){if(i.includes(e))continue;const{channels:t}=n[e];o.prototype[e]=function(...t){return this.model===e?new o(this):t.length>0?new o(t,e):new o([...(a=n[this.model][e].raw(this.color),Array.isArray(a)?a:[a]),this.valpha],e);var a},o[e]=function(...a){let r=a[0];return"number"==typeof r&&(r=m(a,t)),new o(r,e)}}function c(e){return function(t){return function(e,t){return Number(e.toFixed(t))}(t,e)}}function u(e,t,a){e=Array.isArray(e)?e:[e];for(const r of e)(l[r]||(l[r]=[]))[t]=a;return e=e[0],function(r){let n;return void 0!==r?(a&&(r=a(r)),n=this[e](),n.color[t]=r,n):(n=this[e]().color[t],a&&(n=a(n)),n)}}function d(e){return function(t){return Math.max(0,Math.min(e,t))}}function m(e,t){for(let a=0;a<t;a++)"number"!=typeof e[a]&&(e[a]=0);return e}e.exports=o},469:function(e,t,a){var r=a(271),n=a(470),i=Object.hasOwnProperty,s={};for(var l in r)i.call(r,l)&&(s[r[l]]=l);var o=e.exports={to:{},get:{}};function c(e,t,a){return Math.min(Math.max(t,e),a)}function u(e){var t=Math.round(e).toString(16).toUpperCase();return t.length<2?"0"+t:t}o.get=function(e){var t,a;switch(e.substring(0,3).toLowerCase()){case"hsl":t=o.get.hsl(e),a="hsl";break;case"hwb":t=o.get.hwb(e),a="hwb";break;default:t=o.get.rgb(e),a="rgb"}return t?{model:a,value:t}:null},o.get.rgb=function(e){if(!e)return null;var t,a,n,s=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(n=t[2],t=t[1],a=0;a<3;a++){var l=2*a;s[a]=parseInt(t.slice(l,l+2),16)}n&&(s[3]=parseInt(n,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(n=(t=t[1])[3],a=0;a<3;a++)s[a]=parseInt(t[a]+t[a],16);n&&(s[3]=parseInt(n+n,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(a=0;a<3;a++)s[a]=parseInt(t[a+1],0);t[4]&&(t[5]?s[3]=.01*parseFloat(t[4]):s[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(t=e.match(/^(\w+)$/))?"transparent"===t[1]?[0,0,0,0]:i.call(r,t[1])?((s=r[t[1]])[3]=1,s):null:null;for(a=0;a<3;a++)s[a]=Math.round(2.55*parseFloat(t[a+1]));t[4]&&(t[5]?s[3]=.01*parseFloat(t[4]):s[3]=parseFloat(t[4]))}for(a=0;a<3;a++)s[a]=c(s[a],0,255);return s[3]=c(s[3],0,1),s},o.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,c(parseFloat(t[2]),0,100),c(parseFloat(t[3]),0,100),c(isNaN(a)?1:a,0,1)]}return null},o.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,c(parseFloat(t[2]),0,100),c(parseFloat(t[3]),0,100),c(isNaN(a)?1:a,0,1)]}return null},o.to.hex=function(){var e=n(arguments);return"#"+u(e[0])+u(e[1])+u(e[2])+(e[3]<1?u(Math.round(255*e[3])):"")},o.to.rgb=function(){var e=n(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},o.to.rgb.percent=function(){var e=n(arguments),t=Math.round(e[0]/255*100),a=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+a+"%, "+r+"%)":"rgba("+t+"%, "+a+"%, "+r+"%, "+e[3]+")"},o.to.hsl=function(){var e=n(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},o.to.hwb=function(){var e=n(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},o.to.keyword=function(e){return s[e.slice(0,3)]}},470:function(e,t,a){"use strict";var r=a(471),n=Array.prototype.concat,i=Array.prototype.slice,s=e.exports=function(e){for(var t=[],a=0,s=e.length;a<s;a++){var l=e[a];r(l)?t=n.call(t,i.call(l)):t.push(l)}return t};s.wrap=function(e){return function(){return e(s(arguments))}}},471:function(e,t){e.exports=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))}},472:function(e,t,a){const r=a(272),n=a(473),i={};Object.keys(r).forEach((e=>{i[e]={},Object.defineProperty(i[e],"channels",{value:r[e].channels}),Object.defineProperty(i[e],"labels",{value:r[e].labels});const t=n(e);Object.keys(t).forEach((a=>{const r=t[a];i[e][a]=function(e){const t=function(...t){const a=t[0];if(null==a)return a;a.length>1&&(t=a);const r=e(t);if("object"==typeof r)for(let e=r.length,t=0;t<e;t++)r[t]=Math.round(r[t]);return r};return"conversion"in e&&(t.conversion=e.conversion),t}(r),i[e][a].raw=function(e){const t=function(...t){const a=t[0];return null==a?a:(a.length>1&&(t=a),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(r)}))})),e.exports=i},473:function(e,t,a){const r=a(272);function n(e,t){return function(a){return t(e(a))}}function i(e,t){const a=[t[e].parent,e];let i=r[t[e].parent][e],s=t[e].parent;for(;t[s].parent;)a.unshift(t[s].parent),i=n(r[t[s].parent][s],i),s=t[s].parent;return i.conversion=a,i}e.exports=function(e){const t=function(e){const t=function(){const e={},t=Object.keys(r);for(let a=t.length,r=0;r<a;r++)e[t[r]]={distance:-1,parent:null};return e}(),a=[e];for(t[e].distance=0;a.length;){const e=a.pop(),n=Object.keys(r[e]);for(let r=n.length,i=0;i<r;i++){const r=n[i],s=t[r];-1===s.distance&&(s.distance=t[e].distance+1,s.parent=e,a.unshift(r))}}return t}(e),a={},n=Object.keys(t);for(let e=n.length,r=0;r<e;r++){const e=n[r];null!==t[e].parent&&(a[e]=i(e,t))}return a}},474:function(e,t,a){e.exports=a(26)(2740)},478:function(e,t,a){"use strict";a.r(t),a.d(t,"renderApp",(function(){return Ru}));var r=a(2),n=a.n(r),i=a(24),s=a.n(i),l=a(51),o=a(54),c=(a(215),a(216)),u=a(210),d=a(30),m=a.n(d),p=a(1),g=a(12),f=a(9),b=a(17),h=a(220),y=a(221),E=a(84),v=a(64),x=a(454),k=a(92);const O=()=>{const{options:e,chartOptions:t,setChartOptions:a,currentTimerange:i,setOptions:s,setTimeRange:l}=Object(E.h)(),o=Object(r.useMemo)((()=>({options:e,chartOptions:t,timerange:i})),[e,t,i]),c=e=>{var t;e&&e.options&&(t=e.options,s(t)),e&&e.timerange&&l(e.timerange),e&&e.chartOptions&&a(e.chartOptions)};return n.a.createElement(k.a,{urlState:o,urlStateKey:"metricsExplorer",mapToUrlState:M,onChange:c,onInitialize:c,populateWithInitialState:!0})},M=e=>{const t={};if(e)return e.options&&function(e){const t=E.e.decode(e);try{return x.ThrowReporter.report(t),!0}catch(e){return!1}}(e.options)&&(e.options.source="url",Object(v.set)(t,"options",e.options)),e.timerange&&function(e){const t=E.g.decode(e);try{return x.ThrowReporter.report(t),!0}catch(e){return!1}}(e.timerange)&&Object(v.set)(t,"timerange",e.timerange),e.chartOptions&&function(e){const t=E.f.decode(e);try{return x.ThrowReporter.report(t),!0}catch(e){return!1}}(e.chartOptions)&&Object(v.set)(t,"chartOptions",e.chartOptions),t};var w=a(73);const j=({children:e})=>{const{createSourceConfiguration:t,createDerivedIndexPattern:a,source:r,sourceExists:n,sourceId:i,metricIndicesExist:s,isLoading:l,loadSource:o,hasFailedLoadingSource:c,loadSourceFailureMessage:u,updateSourceConfiguration:d,version:m}=Object(w.b)();return e({create:t,configuration:r&&r.configuration,createDerivedIndexPattern:a,exists:n,hasFailed:c,isLoading:l,lastFailureMessage:u,load:o,metricIndicesExist:s,sourceId:i,update:d,version:m})};var S=a(223),C=a(4),T=a(79);const F=e=>{Object(S.a)(C.f,T.h,e)};var L=a(96),P=a(19),D=a(108),I=a(186),_=a(52),B=a(20),R=a(25),A=a(49),N=a.n(A);function V(e){return e?_.DARK_THEME:_.LIGHT_THEME}function z(e){return e?_.DARK_THEME:Object(_.mergeWithDefaultTheme)(U,_.LIGHT_THEME)}const U={crosshair:{band:{fill:"#D3DAE6"}},axes:{gridLine:{horizontal:{stroke:"#eaeaea"}}}};var $=a(107),q=a(10),H=a.n(q),G=a(23),J=a(7),W=a(115);const K=e=>{const{visible:t,setVisible:a}=e,{triggersActionsUI:i}=Object(r.useContext)(G.a),s=Object(r.useCallback)((()=>a(!1)),[a]),l=Object(r.useMemo)((()=>i&&i.getAddAlertFlyout({consumer:"infrastructure",onClose:s,canChangeTrigger:!1,ruleTypeId:J.e,metadata:{currentOptions:e.options,series:e.series}})),[i,s]);return n.a.createElement(n.a.Fragment,null,t&&l)},Q=({onClose:e})=>{const{metricThresholdPrefill:t}=Object(W.b)(),{groupBy:a,filterQuery:r,metrics:i}=t;return n.a.createElement(K,{options:{groupBy:a,filterQuery:r,metrics:i},visible:!0,setVisible:e})};var X=a(16),Z=a(134),Y=a.n(Z),ee=a(82),te=a(268),ae=a(31),re=a(269);const ne="metric*",ie=e=>{if("rate"===e.aggregation){const t=Y.a.v1(),a=Y.a.v1(),r=Y.a.v1();return[{id:t,type:"max",field:e.field||void 0},{id:r,type:"derivative",field:t,unit:"1s"},{id:a,type:"positive_only",field:r}]}if("p95"===e.aggregation||"p99"===e.aggregation){const t="p95"===e.aggregation?"95":"99";return[{id:Y.a.v1(),type:"percentile",field:e.field,percentiles:[{id:Y.a.v1(),value:t,mode:"line",percentile:"",shade:.2}]}]}return[{id:Y.a.v1(),type:e.aggregation,field:e.field||void 0}]},se=e=>t=>{const a=Object(te.a)(t);return{label:Object(re.a)(t),axis_position:"right",chart_type:"line",color:t.color&&Object(ee.b)(t.color)||Object(ee.b)(ee.a.color0),fill:e.type===E.b.area?.5:0,formatter:a===ae.b.bits?ae.b.bytes:a,value_template:"rate"===t.aggregation?"{{value}}/s":"{{value}}",id:Y.a.v1(),line_width:2,metrics:ie(t),point_size:0,separate_axis:0,split_mode:"everything",stacked:e.stack?"stacked":"none"}},le=(e,t)=>{const a=[];if(e.filterQuery&&a.push(e.filterQuery),e.groupBy){const r=t.id.replace('"','\\"'),n=Array.isArray(e.groupBy)?e.groupBy.map(((e,a)=>{if(!t.keys)return null;const r=t.keys[a];return r?`${e}: "${r.replace('"','\\"')}"`:null})).join(" and "):`${e.groupBy} : "${r}"`;a.push(n)}return{language:"kuery",query:a.join(" and ")}},oe=(e,t,a,r,n)=>{const i=(s=e&&e.metricAlias||ne).split(",").length>1?ne:s;var s;const l={filters:[],linked:!1,query:{language:"kuery",query:""},uiState:{},vis:{aggs:[],params:{axis_formatter:"number",axis_position:"left",axis_scale:"normal",id:Y.a.v1(),default_index_pattern:i,index_pattern:i,interval:"auto",series:t.metrics.map(se(n)),show_grid:1,show_legend:1,time_field:C.j,type:"timeseries",filter:le(t,a)},title:a.id,type:"metrics"}};n.yAxisMode===E.d.fromZero&&Object(v.set)(l,"vis.params.axis_min",0);const o={refreshInterval:{pause:!0,value:0},time:{from:r.from,to:r.to}};return{app:"visualize",hash:"/create",search:{type:"metrics",_g:Object(X.encode)(o),_a:Object(X.encode)(l)}}};var ce=a(137);const ue=(e,t=!1)=>{const a=H.a.parse(e,{roundUp:t});if(!a)throw new Error(`"${e}" is not a valid time string`);return a.valueOf()},de=(e,t,a,r)=>Object(ce.b)({nodeType:e,nodeId:t,from:ue(a),to:ue(r,!0)}),me=({onFilter:e,options:t,series:a,source:i,timeRange:s,uiCapabilities:l,chartOptions:o})=>{var c,u;const[d,m]=Object(r.useState)(!1),[f,h]=Object(r.useState)(!1),y=null!=t.groupBy&&null!=e,E=Object(r.useCallback)((()=>{y&&e&&(Array.isArray(t.groupBy)?e(t.groupBy.map(((e,t)=>{var r;return`${e}: "${null===(r=a.keys)||void 0===r?void 0:r[t]}"`})).join(" and ")):e(`${t.groupBy}: "${a.id}"`)),m(!1)}),[y,e,t,a.keys,a.id]),v=y?[{name:p.i18n.translate("xpack.infra.metricsExplorer.filterByLabel",{defaultMessage:"Add filter"}),icon:"metricsApp",onClick:E,"data-test-subj":"metricsExplorerAction-AddFilter"}]:[],x=i&&t.groupBy&&((e,t)=>{const a=Array.isArray(t)?t:[t];return a.includes(C.c)?"host":a.includes(C.h)?"pod":a.includes(C.a)?"container":void 0})(0,t.groupBy),k=Object(b.useLinkProps)({app:"metrics",...x?de(x,a.id,s.from,s.to):{}}),O=Object(b.useLinkProps)({...oe(i,t,a,s,o)}),M=x?[{name:p.i18n.translate("xpack.infra.metricsExplorer.viewNodeDetail",{defaultMessage:"View metrics for {name}",values:{name:x}}),icon:"metricsApp",...x?k:{},"data-test-subj":"metricsExplorerAction-ViewNodeMetrics"}]:[],w=[...v,...null!=l&&null!==(c=l.visualize)&&void 0!==c&&c.show?[{name:p.i18n.translate("xpack.infra.metricsExplorer.openInTSVB",{defaultMessage:"Open in Visualize"}),...O,icon:"visualizeApp",disabled:0===t.metrics.length,"data-test-subj":"metricsExplorerAction-OpenInTSVB"}]:[],...M,...null!=l&&null!==(u=l.infrastructure)&&void 0!==u&&u.save?[{name:p.i18n.translate("xpack.infra.metricsExplorer.alerts.createRuleButton",{defaultMessage:"Create threshold rule"}),icon:"bell",onClick(){h(!0)}}]:[]];if(0===w.length)return null;const j=[{id:0,title:"Actions",items:w}],S=p.i18n.translate("xpack.infra.metricsExplorer.actionsLabel.aria",{defaultMessage:"Actions for {grouping}",values:{grouping:a.id}}),T=p.i18n.translate("xpack.infra.metricsExplorer.actionsLabel.button",{defaultMessage:"Actions"}),F=n.a.createElement(g.EuiButtonEmpty,{contentProps:{"aria-label":S},onClick:()=>m(!0),size:"s",iconType:"arrowDown",iconSide:"right"},T);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiPopover,{closePopover:()=>m(!1),id:`${a.id}-popover`,button:F,isOpen:d,panelPaddingSize:"none"},n.a.createElement(g.EuiContextMenu,{initialPanelId:0,panels:j}),n.a.createElement(K,{series:a,options:t,setVisible:h,visible:f})))},pe=p.i18n.translate("xpack.infra.metricsExplorer.everything",{defaultMessage:"Everything"}),ge=({series:e})=>{if(null!=e.keys){const{keys:t}=e;return n.a.createElement(g.EuiFlexGroup,{gutterSize:"xs"},t.map(((e,a)=>n.a.createElement(r.Fragment,{key:e},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{size:"m",color:t.length-1>a?"subdued":"default"},n.a.createElement("strong",null,"*"===e?pe:e))),t.length-1>a&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{size:"m",color:"subdued"},n.a.createElement("span",null,"/")))))))}return n.a.createElement("span",null,e.id)},fe=()=>n.a.createElement(g.EuiEmptyPrompt,{iconType:"stats",title:n.a.createElement("h3",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metricsExplorer.emptyChart.title",defaultMessage:"Chart Data Missing"})),body:n.a.createElement("p",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metricsExplorer.emptyChart.body",defaultMessage:"Unable to render chart."}))});var be=a(123),he=a(124);const ye=()=>n.a.createElement(g.EuiEmptyPrompt,{"data-test-subj":"metricsExplorer-missingMetricMessage",iconType:"stats",title:n.a.createElement("h3",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metricsExplorer.noMetrics.title",defaultMessage:"Missing Metric"})),body:n.a.createElement("p",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metricsExplorer.noMetrics.body",defaultMessage:"Please choose a metric above."}))});var Ee=a(125);const ve=({source:e,options:t,chartOptions:a,series:i,title:s,onFilter:l,height:o=200,width:c="100%",timeRange:u,onTimeChange:d})=>{var m;const p=null===(m=Object(f.useKibana)().services.application)||void 0===m?void 0:m.capabilities,b=Object(f.useUiSetting)("theme:darkMode"),{metrics:h}=t,[y]=Object($.a)("dateFormat"),v=Object(r.useMemo)((()=>{const e=Object(R.first)(i.rows),t=Object(R.last)(i.rows);return e&&t?Object(_.niceTimeFormatter)([e.timestamp,t.timestamp]):e=>`${e}`}),[i.rows]),x={headerFormatter:Object(r.useCallback)((e=>N()(e.value).format(y||"Y-MM-DD HH:mm:ss.SSS")),[y])},k=Object(r.useCallback)(Object(he.a)(Object(R.first)(h)),[t]),O=Object(be.a)(i,h,a.stack),M=a.yAxisMode===E.d.fromZero?{...O,min:0}:O;return n.a.createElement("div",{style:{padding:24},"data-test-subj":"metricsExplorer-chart"},t.groupBy?n.a.createElement(g.EuiTitle,{size:"xs"},n.a.createElement(g.EuiFlexGroup,{alignItems:"center"},n.a.createElement(xe,null,n.a.createElement(g.EuiToolTip,{content:s,anchorClassName:"metricsExplorerTitleAnchor"},n.a.createElement(ge,{series:i}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(me,{timeRange:u,options:t,chartOptions:a,series:i,onFilter:l,source:e,uiCapabilities:p})))):n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(me,{options:t,chartOptions:a,series:i,source:e,timeRange:u,uiCapabilities:p}))),n.a.createElement("div",{className:"metricsExplorerChart",style:{height:o,width:c}},h.length&&i.rows.length>0?n.a.createElement(_.Chart,null,h.map(((e,t)=>n.a.createElement(Ee.a,{type:a.type,key:t,metric:e,id:t,series:i,stack:a.stack}))),n.a.createElement(_.Axis,{id:"timestamp",position:_.Position.Bottom,showOverlappingTicks:!0,tickFormat:v}),n.a.createElement(_.Axis,{id:"values",position:_.Position.Left,tickFormat:k,domain:M}),n.a.createElement(_.Settings,{tooltip:x,onBrushEnd:({x:e})=>{if(!e)return;const[t,a]=e;d(N()(t).toISOString(),N()(a).toISOString())},theme:V(b)})):t.metrics.length>0?n.a.createElement(fe,null):n.a.createElement(ye,null)))},xe=B.euiStyled.div`
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: left;
  flex: 1 1 auto;
  margin: 12px;
`,ke=({loading:e,data:t,onLoadMore:a,options:r,chartOptions:i,onRefetch:s,onFilter:l,source:o,timeRange:c,onTimeChange:u})=>{if(e)return n.a.createElement(D.a,{height:800,width:"100%",text:p.i18n.translate("xpack.infra.metricsExplorer.loadingCharts",{defaultMessage:"Loading charts"})});if(!t||0===t.series.length)return n.a.createElement(I.a,{titleText:p.i18n.translate("xpack.infra.metricsExplorer.noDataTitle",{defaultMessage:"There is no data to display."}),bodyText:p.i18n.translate("xpack.infra.metricsExplorer.noDataBodyText",{defaultMessage:"Try adjusting your time, filters or group by settings."}),refetchText:p.i18n.translate("xpack.infra.metricsExplorer.noDataRefetchText",{defaultMessage:"Check for new data"}),testString:"metrics-explorer-no-data",onRefetch:s});const d=p.i18n.translate("xpack.infra.metricsExplorer.andLabel",{defaultMessage:'" and "'});return n.a.createElement("div",{style:{width:"100%"}},n.a.createElement(g.EuiFlexGrid,{gutterSize:"s",columns:1===t.series.length?1:3},t.series.map((e=>n.a.createElement(g.EuiFlexItem,{key:e.id,style:{minWidth:0}},n.a.createElement(ve,{key:`chart-${e.id}`,onFilter:l,options:r,chartOptions:i,title:r.groupBy?e.id:null,height:t.series.length>1?200:400,series:e,source:o,timeRange:c,onTimeChange:u}))))),t.series.length>1?n.a.createElement("div",{style:{textAlign:"center",marginBottom:16}},n.a.createElement(g.EuiHorizontalRule,null),n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metricsExplorer.footerPaginationMessage",defaultMessage:'Displaying {length} of {total} charts grouped by "{groupBy}".',values:{length:t.series.length,total:t.pageInfo.total,groupBy:Array.isArray(r.groupBy)?r.groupBy.join(d):r.groupBy}}))),t.pageInfo.afterKey?n.a.createElement("div",{style:{margin:"16px 0"}},n.a.createElement(g.EuiButton,{isLoading:e,size:"s",onClick:()=>a(t.pageInfo.afterKey||null)},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metricsExplorer.loadMoreChartsButton",defaultMessage:"Load More Charts"}))):null):null)};var Oe=a(58),Me=a(157);const we=({options:e,onChange:t,fields:a,autoFocus:i=!1})=>{const s=Object.keys(ee.a),[l,o]=Object(r.useState)(i),c=Object(r.useCallback)((e=>{e&&l&&(e.focus(),o(!1))}),[l]),u=Object(r.useCallback)((a=>{t(a.map(((t,a)=>({aggregation:e.aggregation,field:t.value,color:s[a]}))))}),[t,e.aggregation,s]),d=a.map((e=>({label:e.name,value:e.name}))),m=e.metrics.filter((e=>"count"!==e.aggregation)).map((e=>({label:e.field||"",value:e.field||"",color:Object(ee.b)(e.color||ee.a.color0)}))),f=p.i18n.translate("xpack.infra.metricsExplorer.metricComboBoxPlaceholder",{defaultMessage:"choose a metric to plot"});return n.a.createElement(g.EuiComboBox,{"data-test-subj":"metricsExplorer-metrics","aria-label":f,isDisabled:"count"===e.aggregation,placeholder:f,fullWidth:!0,options:d,selectedOptions:m,onChange:u,isClearable:!0,inputRef:c})};var je=a(204),Se=a(94);const Ce=({options:e,onChange:t})=>{const a={avg:p.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.avg",{defaultMessage:"Average"}),sum:p.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.sum",{defaultMessage:"Sum"}),max:p.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.max",{defaultMessage:"Max"}),min:p.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.min",{defaultMessage:"Min"}),cardinality:p.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.cardinality",{defaultMessage:"Cardinality"}),rate:p.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.rate",{defaultMessage:"Rate"}),p95:p.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.p95",{defaultMessage:"95th Percentile"}),p99:p.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.p99",{defaultMessage:"99th Percentile"}),count:p.i18n.translate("xpack.infra.metricsExplorer.aggregationLables.count",{defaultMessage:"Document count"})},i=Object(r.useCallback)((e=>{const a=Se.c.is(e.target.value)&&e.target.value||"avg";t(a)}),[t]),s=p.i18n.translate("xpack.infra.metricsExplorer.aggregationSelectLabel",{defaultMessage:"Select an aggregation"});return n.a.createElement(g.EuiSelect,{"aria-label":s,placeholder:s,fullWidth:!0,value:e.aggregation,options:Se.a.map((e=>({text:a[e],value:e}))),onChange:i})},Te=({chartOptions:e,onChange:t})=>{const[a,i]=Object(r.useState)(!1),s=Object(r.useCallback)((()=>{i(!1)}),[]),l=Object(r.useCallback)((()=>{i(!0)}),[]),o=n.a.createElement(g.EuiButtonEmpty,{iconSide:"left",iconType:"eye",onClick:l,"data-test-subj":"metricsExplorer-customize"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metricsExplorer.customizeChartOptions",defaultMessage:"Customize"})),c=[{id:E.d.auto,label:p.i18n.translate("xpack.infra.metricsExplorer.chartOptions.autoLabel",{defaultMessage:"Automatic (min to max)"})},{id:E.d.fromZero,label:p.i18n.translate("xpack.infra.metricsExplorer.chartOptions.fromZeroLabel",{defaultMessage:"From zero (0 to max)"})}],u=[{"data-test-subj":"metricsExplorer-chartRadio-line",id:E.b.line,label:p.i18n.translate("xpack.infra.metricsExplorer.chartOptions.lineLabel",{defaultMessage:"Line"})},{"data-test-subj":"metricsExplorer-chartRadio-area",id:E.b.area,label:p.i18n.translate("xpack.infra.metricsExplorer.chartOptions.areaLabel",{defaultMessage:"Area"})},{"data-test-subj":"metricsExplorer-chartRadio-bar",id:E.b.bar,label:p.i18n.translate("xpack.infra.metricsExplorer.chartOptions.barLabel",{defaultMessage:"Bar"})}],d=Object(r.useCallback)((a=>{t({...e,yAxisMode:a})}),[e,t]),m=Object(r.useCallback)((a=>{t({...e,type:a})}),[e,t]),f=Object(r.useCallback)((a=>{t({...e,stack:a.target.checked})}),[e,t]);return n.a.createElement(g.EuiPopover,{id:"MetricExplorerChartOptionsPopover",button:o,isOpen:a,closePopover:s},n.a.createElement(g.EuiForm,null,n.a.createElement(g.EuiFormRow,{display:"rowCompressed",label:p.i18n.translate("xpack.infra.metricsExplorer.chartOptions.typeLabel",{defaultMessage:"Chart style"})},n.a.createElement(g.EuiRadioGroup,{compressed:!0,options:u,idSelected:e.type,onChange:m})),n.a.createElement(g.EuiFormRow,{display:"rowCompressed",label:p.i18n.translate("xpack.infra.metricsExplorer.chartOptions.stackLabel",{defaultMessage:"Stack series"})},n.a.createElement(g.EuiSwitch,{label:p.i18n.translate("xpack.infra.metricsExplorer.chartOptions.stackSwitchLabel",{defaultMessage:"Stack"}),checked:e.stack,onChange:f})),n.a.createElement(g.EuiFormRow,{display:"rowCompressed",label:p.i18n.translate("xpack.infra.metricsExplorer.chartOptions.yAxisDomainLabel",{defaultMessage:"Y Axis Domain"})},n.a.createElement(g.EuiRadioGroup,{compressed:!0,options:c,idSelected:e.yAxisMode,onChange:d}))))},Fe=e=>e?e.map((e=>({start:e.from,end:e.to,label:e.display}))):[],Le=({timeRange:e,derivedIndexPattern:t,options:a,onTimeChange:r,onRefresh:i,onGroupByChange:s,onFilterQuerySubmit:l,onMetricsChange:o,onAggregationChange:c,chartOptions:u,onChartOptionsChange:d})=>{const m="avg"===a.aggregation&&0===a.metrics.length,[p]=Object($.a)(Oe.UI_SETTINGS.TIMEPICKER_QUICK_RANGES),f=Fe(p);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:"count"===a.aggregation&&2},n.a.createElement(Ce,{fullWidth:!0,options:a,onChange:c})),"count"!==a.aggregation&&n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metricsExplorer.aggregationLabel",defaultMessage:"of"})),"count"!==a.aggregation&&n.a.createElement(g.EuiFlexItem,{grow:2},n.a.createElement(we,{autoFocus:m,fields:t.fields,options:a,onChange:o})),n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metricsExplorer.groupByToolbarLabel",defaultMessage:"graph per"})),n.a.createElement(g.EuiFlexItem,{grow:1},n.a.createElement(je.a,{onChange:s,fields:t.fields,options:a}))),n.a.createElement(g.EuiFlexGroup,{alignItems:"center"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(Me.a,{derivedIndexPattern:t,onSubmit:l,value:a.filterQuery})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Te,{onChange:d,chartOptions:u})),n.a.createElement(g.EuiFlexItem,{grow:!1,style:{marginRight:5}},n.a.createElement(g.EuiSuperDatePicker,{start:e.from,end:e.to,onTimeChange:({start:e,end:t})=>r(e,t),onRefresh:i,commonlyUsedRanges:f}))))};var Pe=a(205),De=a(70),Ie=a.n(De),_e=a(0),Be=a(18),Re=a(14),Ae=a(22),Ne=a(81);const Ve=({errors:e,name:t,onChange:a,value:r})=>({error:e,isInvalid:e.length>0,name:t,onChange:e=>a(e.currentTarget.value),value:r}),ze=(...e)=>t=>e.map((e=>e(t))).filter(Boolean),Ue=e=>""===e,$e=e=>Ue(e)&&n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.fieldEmptyErrorMessage",defaultMessage:"The field must not be empty."}),qe=e=>(e=>e.split(",").some(Ue))(e)&&n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.fieldContainEmptyEntryErrorMessage",defaultMessage:"The field must not include empty comma-separated values."}),He=e=>(e=>e.includes(" "))(e)&&n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.fieldContainSpacesErrorMessage",defaultMessage:"The field must not include spaces."}),Ge={name:"",description:"",metricAlias:"",anomalyThreshold:0},Je=e=>{const t=(({initialFormState:e=Ge})=>{const[t,a]=Object(r.useState)({}),n=Object(r.useCallback)((()=>a({})),[]),i=Object(r.useMemo)((()=>({...e,...t})),[e,t]),s=Object(r.useMemo)((()=>Ve({errors:ze($e)(i.name),name:"name",onChange:e=>a((t=>({...t,name:e}))),value:i.name})),[i.name]),l=Object(r.useMemo)((()=>Ve({errors:ze($e,qe,He)(i.metricAlias),name:"metricAlias",onChange:e=>a((t=>({...t,metricAlias:e}))),value:i.metricAlias})),[i.metricAlias]),o=Object(r.useMemo)((()=>(({errors:e,name:t,onChange:a,value:r})=>({error:e,isInvalid:e.length>0,name:t,onChange:(e,t)=>a(+e.currentTarget.value,t),value:r}))({errors:ze($e)(i.anomalyThreshold),name:"anomalyThreshold",onChange:e=>a((t=>({...t,anomalyThreshold:e}))),value:i.anomalyThreshold})),[i.anomalyThreshold]),c=Object(r.useMemo)((()=>({name:s,metricAlias:l,anomalyThreshold:o})),[s,l,o]),u=Object(r.useMemo)((()=>Object.values(c).reduce(((e,{error:t})=>[...e,...t]),[])),[c]),d=Object(r.useMemo)((()=>u.length<=0),[u]),m=Object(r.useMemo)((()=>Object.keys(t).length>0),[t]);return{errors:u,fieldProps:c,formState:i,formStateChanges:t,isFormDirty:m,isFormValid:d,resetForm:n}})({initialFormState:Object(r.useMemo)((()=>e?{name:e.name,description:e.description,metricAlias:e.metricAlias,anomalyThreshold:e.anomalyThreshold}:void 0),[e])}),a=Object(r.useMemo)((()=>[...t.errors]),[t.errors]),n=Object(r.useCallback)((()=>{t.resetForm()}),[t]),i=Object(r.useMemo)((()=>t.isFormDirty),[t.isFormDirty]),s=Object(r.useMemo)((()=>t.isFormValid),[t.isFormValid]);return{errors:a,formState:Object(r.useMemo)((()=>({name:t.formState.name,description:t.formState.description,metricAlias:t.formState.metricAlias,anomalyThreshold:t.formState.anomalyThreshold})),[t.formState]),formStateChanges:Object(r.useMemo)((()=>({name:t.formStateChanges.name,description:t.formStateChanges.description,metricAlias:t.formStateChanges.metricAlias,anomalyThreshold:t.formStateChanges.anomalyThreshold})),[t.formStateChanges]),isFormDirty:i,isFormValid:s,indicesConfigurationProps:t.fieldProps,resetForm:n}},We=_e.type({viewId:_e.string}),Ke={viewId:"0"},Qe=Ie()((e=>{const{source:t,isLoading:a,sourceExists:n,createSourceConfiguration:i,updateSourceConfiguration:s}=Object(w.b)(),{viewType:l,defaultViewState:o}=e,{data:c,loading:u,find:d,error:m,hasView:g}=(e=>{const t=Object(b.useUiTracker)({app:"infra_metrics"}),a=Object(f.useKibana)(),[n,i]=Object(r.useState)(null),[s,l]=Object(r.useState)(null),[o,c]=Object(r.useState)(!1);return{hasView:async t=>{var r;const n=null===(r=a.services.savedObjects)||void 0===r?void 0:r.client;if(!n)throw new Error("Saved objects client is unavailable");return(await n.find({type:e})).savedObjects.find((e=>e.attributes.name===t))},data:n,loading:o,error:s,find:Object(r.useCallback)(((r,n=[])=>{c(!0),(async()=>{try{var s;const o=null===(s=a.services.savedObjects)||void 0===s?void 0:s.client;if(!o)throw new Error("Saved objects client is unavailable");const u=await o.find({type:e,search:r,searchFields:n,page:1,perPage:1e3});l(null),c(!1),i(u),u.total>1e3?t({metric:`over_1000_saved_objects_for_${e}`}):t({metric:`under_1000_saved_objects_for_${e}`})}catch(e){c(!1),l(e)}})()}),[e,a.services.savedObjects,t])}})(l),[h,y]=Object(Ne.b)({defaultState:Ke,decodeUrlState:et,encodeUrlState:Ye,urlStateKey:"savedView"}),[E]=Object(r.useState)(e.shouldLoadDefault),[v,x]=Object(r.useState)(null),[k,O]=Object(r.useState)(null),{create:M,error:j,data:S,createdId:C}=(e=>{const t=Object(f.useKibana)(),[a,n]=Object(r.useState)(null),[i,s]=Object(r.useState)(null),[l,o]=Object(r.useState)(null),[c,u]=Object(r.useState)(!1);return{data:a,loading:c,error:l,create:Object(r.useCallback)(((a,r)=>{u(!0),(async()=>{try{var i;const l=null===(i=t.services.savedObjects)||void 0===i?void 0:i.client;if(!l)throw new Error("Saved objects client is unavailable");const c=await l.create(e,a,r);s(c.id),o(null),n(c),u(!1)}catch(e){u(!1),o(e)}})()}),[e,t.services.savedObjects]),createdId:i}})(l),{update:T,error:F,data:L,updatedId:P}=(e=>{const t=Object(f.useKibana)(),[a,n]=Object(r.useState)(null),[i,s]=Object(r.useState)(null),[l,o]=Object(r.useState)(null),[c,u]=Object(r.useState)(!1);return{data:a,loading:c,error:l,update:Object(r.useCallback)(((a,r,i)=>{u(!0),(async()=>{try{var l;const c=null===(l=t.services.savedObjects)||void 0===l?void 0:l.client;if(!c)throw new Error("Saved objects client is unavailable");const d=await c.update(e,a,r,i);s(d.id),o(null),n(d),u(!1)}catch(e){u(!1),o(e)}})()}),[e,t.services.savedObjects]),updatedId:i}})(l),{deleteObject:D,deletedId:I}=(e=>{const t=Object(f.useKibana)(),[a,n]=Object(r.useState)(null),[i,s]=Object(r.useState)(!1),[l,o]=Object(r.useState)(null);return{loading:i,error:a,deleteObject:Object(r.useCallback)((a=>{s(!0),(async()=>{try{var r;await(null===(r=t.services.savedObjects)||void 0===r?void 0:r.client.delete(e,a)),n(null),o(a),s(!1)}catch(e){s(!1),n(e)}})()}),[e,t.services.savedObjects]),deletedId:l}})(l),{getObject:_,data:B}=(e=>{const t=Object(f.useKibana)(),[a,n]=Object(r.useState)(null),[i,s]=Object(r.useState)(null),[l,o]=Object(r.useState)(!1);return{data:a,loading:l,error:i,getObject:Object(r.useCallback)((a=>{o(!0),(async()=>{try{var r;const i=null===(r=t.services.savedObjects)||void 0===r?void 0:r.client;if(!i)throw new Error("Saved objects client is unavailable");const l=await i.get(e,a);s(null),o(!1),n(l)}catch(e){o(!1),s(e)}})()}),[e,t.services.savedObjects])}})(l),[R,A]=Object(r.useState)(null);Object(r.useEffect)((()=>A(j)),[j]);const N=Object(r.useCallback)((e=>D(e)),[D]),V=Je(t&&t.configuration),z=Object(r.useMemo)((()=>"inventory-view"===l?"inventoryDefaultView":"metricsExplorerDefaultView"),[l]),U=Object(r.useCallback)((async e=>{n?await s({...V.formStateChanges,[z]:e}):await i({...V.formState,[z]:e})}),[V.formState,V.formStateChanges,n,z,i,s]),$=Object(r.useCallback)((e=>{A(null),(async()=>{await g(e.name)?A(p.i18n.translate("xpack.infra.savedView.errorOnCreate.duplicateViewName",{defaultMessage:"A view with that name already exists."})):M(e)})()}),[M,g]),q=Object(r.useCallback)(((e,t)=>{A(null),(async()=>{const a=await g(t.name);a&&a.id!==e?A(p.i18n.translate("xpack.infra.savedView.errorOnCreate.duplicateViewName",{defaultMessage:"A view with that name already exists."})):T(e,t)})()}),[T,g]),H=Object(r.useMemo)((()=>t&&t.configuration?"inventoryDefaultView"===z?t.configuration.inventoryDefaultView:"metricsExplorerDefaultView"===z?t.configuration.metricsExplorerDefaultView:"":""),[t,z]),G=Object(r.useCallback)((e=>({...e.attributes,id:e.id,isDefault:H===e.id})),[H]),J=Object(r.useMemo)((()=>c?c.savedObjects:[]),[c]),W=Object(r.useMemo)((()=>{const e=[{name:p.i18n.translate("xpack.infra.savedView.defaultViewNameHosts",{defaultMessage:"Default view"}),id:"0",isDefault:!H||"0"===H,...o}];return J.forEach((t=>t.type===l&&e.push(G(t)))),e}),[o,J,l,H,G]),K=Object(r.useMemo)((()=>S?G(S):null),[S,G]),Q=Object(r.useMemo)((()=>L?G(L):null),[L,G]),X=Object(r.useCallback)((()=>{O(!0),_(H)}),[O,_,H]);Object(r.useEffect)((()=>{B&&(x(G(B)),O(!1))}),[B,H,G]);const Z=Object(r.useCallback)((()=>{x({name:p.i18n.translate("xpack.infra.savedView.defaultViewNameHosts",{defaultMessage:"Default view"}),id:"0",isDefault:!H||"0"===H,...o})}),[x,H,o]),Y=Object(r.useCallback)((()=>{"0"!==H?X():(Z(),O(!1))}),[H,X,Z,O]);return Object(r.useEffect)((()=>{k||v||!E||Y()}),[Y,k,v,E]),Object(r.useEffect)((()=>{v&&h.viewId!==v.id&&c&&y({viewId:v.id})}),[h,y,v,H,c]),Object(r.useEffect)((()=>{if(!v&&!u&&c&&E){const e=W.find((e=>e.id===h.viewId));e?x(e):Y()}}),[u,v,c,W,x,Y,h.viewId,E]),{views:W,saveView:$,defaultViewId:H,loading:u,updateView:q,updatedView:Q,updatedId:P,deletedId:I,createdId:C,createdView:K,errorOnUpdate:F,errorOnFind:m,errorOnCreate:R,shouldLoadDefault:E,makeDefault:U,sourceIsLoading:a,deleteView:N,loadingDefaultView:k,setCurrentView:x,currentView:v,loadDefaultView:X,find:d}})),[Xe,Ze]=Qe,Ye=e=>We.encode(e),et=e=>Object(Be.pipe)(We.decode(e),Object(Re.fold)(Object(Ae.constant)(void 0),Ae.identity));var tt=a(13);const at=({hasData:e=!0,"data-test-subj":t,...a})=>{const{services:{observability:{navigation:{PageTemplate:r}},docLinks:i}}=Object(tt.b)(),s=e?void 0:{solution:p.i18n.translate("xpack.infra.metrics.noDataConfig.solutionName",{defaultMessage:"Observability"}),action:{beats:{title:L.c,description:L.b}},docsLink:i.links.observability.guide};return n.a.createElement(r,m()({"data-test-subj":e?t:"noDataPage",noDataConfig:s},a))},rt=({close:e,save:t,isInvalid:a})=>{const[i,s]=Object(r.useState)(""),[l,o]=Object(r.useState)(!1),c=Object(r.useCallback)((e=>o(e.target.checked)),[]),u=Object(r.useCallback)((e=>s(e.target.value)),[]),d=Object(r.useCallback)((()=>{t(i,l)}),[l,t,i]);return n.a.createElement(g.EuiModal,{onClose:e,"data-test-subj":"savedViews-createModal"},n.a.createElement(g.EuiModalHeader,null,n.a.createElement(g.EuiModalHeaderTitle,null,n.a.createElement(P.FormattedMessage,{defaultMessage:"Save View",id:"xpack.infra.waffle.savedView.createHeader"}))),n.a.createElement(g.EuiModalBody,null,n.a.createElement(g.EuiFieldText,{isInvalid:a,placeholder:p.i18n.translate("xpack.infra.waffle.savedViews.viewNamePlaceholder",{defaultMessage:"Name"}),"data-test-subj":"savedViewViweName",value:i,onChange:u,"aria-label":p.i18n.translate("xpack.infra.waffle.savedViews.viewNamePlaceholder",{defaultMessage:"Name"})}),n.a.createElement(g.EuiSpacer,{size:"xl"}),n.a.createElement(g.EuiSwitch,{id:"saved-view-save-time-checkbox",label:n.a.createElement(P.FormattedMessage,{defaultMessage:"Store time with view",id:"xpack.infra.waffle.savedViews.includeTimeFilterLabel"}),checked:l,onChange:c}),n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiText,{size:"xs",grow:!1,style:{maxWidth:400}},n.a.createElement(P.FormattedMessage,{defaultMessage:"This changes the time filter to the currently selected time each time the view is loaded",id:"xpack.infra.waffle.savedViews.includeTimeHelpText"}))),n.a.createElement(g.EuiModalFooter,null,n.a.createElement(g.EuiButtonEmpty,{onClick:e},n.a.createElement(P.FormattedMessage,{defaultMessage:"Cancel",id:"xpack.infra.waffle.savedViews.cancelButton"})),n.a.createElement(g.EuiButton,{color:"primary",disabled:!i,fill:!0,onClick:d,"data-test-subj":"createSavedViewButton"},n.a.createElement(P.FormattedMessage,{defaultMessage:"Save",id:"xpack.infra.waffle.savedViews.saveButton"}))))};function nt({close:e,save:t,isInvalid:a,currentView:i}){const[s,l]=Object(r.useState)(i.name),[o,c]=Object(r.useState)(!1),u=Object(r.useCallback)((e=>c(e.target.checked)),[]),d=Object(r.useCallback)((e=>l(e.target.value)),[]),m=Object(r.useCallback)((()=>{t(s,o)}),[o,t,s]);return n.a.createElement(g.EuiModal,{onClose:e},n.a.createElement(g.EuiModalHeader,null,n.a.createElement(g.EuiModalHeaderTitle,null,n.a.createElement(P.FormattedMessage,{defaultMessage:"Update View",id:"xpack.infra.waffle.savedView.updateHeader"}))),n.a.createElement(g.EuiModalBody,null,n.a.createElement(g.EuiFieldText,{isInvalid:a,placeholder:p.i18n.translate("xpack.infra.waffle.savedViews.viewNamePlaceholder",{defaultMessage:"Name"}),"data-test-subj":"savedViewViweName",value:s,onChange:d,"aria-label":p.i18n.translate("xpack.infra.waffle.savedViews.viewNamePlaceholder",{defaultMessage:"Name"})}),n.a.createElement(g.EuiSpacer,{size:"xl"}),n.a.createElement(g.EuiSwitch,{id:"saved-view-save-time-checkbox",label:n.a.createElement(P.FormattedMessage,{defaultMessage:"Store time with view",id:"xpack.infra.waffle.savedViews.includeTimeFilterLabel"}),checked:o,onChange:u}),n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiText,{size:"xs",grow:!1,style:{maxWidth:400}},n.a.createElement(P.FormattedMessage,{defaultMessage:"This changes the time filter to the currently selected time each time the view is loaded",id:"xpack.infra.waffle.savedViews.includeTimeHelpText"}))),n.a.createElement(g.EuiModalFooter,null,n.a.createElement(g.EuiButtonEmpty,{onClick:e},n.a.createElement(P.FormattedMessage,{defaultMessage:"Cancel",id:"xpack.infra.waffle.savedViews.cancelButton"})),n.a.createElement(g.EuiButton,{color:"primary",disabled:!s,fill:!0,onClick:m,"data-test-subj":"updateSavedViewButton"},n.a.createElement(P.FormattedMessage,{defaultMessage:"Save",id:"xpack.infra.waffle.savedViews.saveButton"}))))}const it=e=>{const[t,a]=Object(r.useState)(!1),i=Object(r.useCallback)((()=>a(!0)),[]),s=Object(r.useCallback)((()=>a(!1)),[]);return n.a.createElement(n.a.Fragment,null,t&&n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(g.EuiButtonEmpty,{onClick:s,"data-test-subj":"hideConfirm"},n.a.createElement(P.FormattedMessage,{defaultMessage:"cancel",id:"xpack.infra.waffle.savedViews.cancel"})),n.a.createElement(g.EuiButton,{disabled:e.isDisabled,fill:!0,iconType:"trash",color:"danger",onClick:e.confirmedAction,"data-test-subj":"showConfirm"},n.a.createElement(P.FormattedMessage,{defaultMessage:"Delete view?",id:"xpack.infra.openView.actionNames.deleteConfirmation"}))),!t&&n.a.createElement(g.EuiButtonEmpty,{iconType:"trash",color:"danger",onClick:i}))};function st({close:e,views:t,defaultViewId:a,setView:i,makeDefault:s,deleteView:l,loading:o,sourceIsLoading:c}){const[u,d]=Object(r.useState)(null),m=Object(r.useCallback)(((t,a)=>n.a.createElement(g.EuiButtonEmpty,{onClick:()=>{i(a),e()}},t)),[i,e]),f=Object(r.useCallback)((e=>"0"===e.id?n.a.createElement(n.a.Fragment,null):n.a.createElement(it,{isDisabled:e.isDefault,confirmedAction:()=>{l(e.id)}})),[l]),b=Object(r.useCallback)((e=>{const t=e.id===a;return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiButtonEmpty,{isLoading:u===e.id&&c,iconType:t?"starFilled":"starEmpty",onClick:()=>{d(e.id),s(e.id)}}))}),[s,a,c,u]),h=[{field:"name",name:p.i18n.translate("xpack.infra.openView.columnNames.name",{defaultMessage:"Name"}),sortable:!0,truncateText:!0,render:m},{name:p.i18n.translate("xpack.infra.openView.columnNames.actions",{defaultMessage:"Actions"}),actions:[{available:()=>!0,render:b},{available:e=>!0,render:f}]}];return n.a.createElement(g.EuiPortal,null,n.a.createElement(g.EuiFlyout,{onClose:e,"data-test-subj":"loadViewsFlyout"},n.a.createElement(g.EuiFlyoutHeader,null,n.a.createElement(g.EuiTitle,{size:"m"},n.a.createElement("h2",null,n.a.createElement(P.FormattedMessage,{defaultMessage:"Manage saved views",id:"xpack.infra.openView.flyoutHeader"})))),n.a.createElement(g.EuiFlyoutBody,null,n.a.createElement(g.EuiInMemoryTable,{items:t,columns:h,loading:o,search:!0,pagination:!0,sorting:!0})),n.a.createElement(g.EuiModalFooter,null,n.a.createElement(g.EuiButtonEmpty,{"data-test-subj":"cancelSavedViewModal",onClick:e},n.a.createElement(P.FormattedMessage,{defaultMessage:"Cancel",id:"xpack.infra.openView.cancelButton"})))))}function lt({close:e,views:t,setView:a,currentView:i}){const[s,l]=Object(r.useState)(null),o=Object(r.useCallback)((e=>{l(e)}),[]),c=Object(r.useCallback)((()=>{if(!s)return void e();const r=s.find((e=>e.checked));r?(a(t.find((e=>e.id===r.key))),e()):e()}),[s,t,a,e]),u=Object(r.useMemo)((()=>t.map((e=>({label:e.name,key:e.id,checked:(null==i?void 0:i.id)===e.id?"on":void 0})))),[t,i]);return n.a.createElement(g.EuiModal,{onClose:e,"data-test-subj":"savedViews-loadModal"},n.a.createElement(g.EuiModalHeader,null,n.a.createElement(g.EuiModalHeaderTitle,null,n.a.createElement(P.FormattedMessage,{defaultMessage:"Select a view to load",id:"xpack.infra.waffle.savedView.selectViewHeader"}))),n.a.createElement(g.EuiModalBody,null,n.a.createElement(g.EuiSelectable,{singleSelection:!0,searchable:!0,options:s||u,onChange:o,searchProps:{placeholder:p.i18n.translate("xpack.infra.savedView.searchPlaceholder",{defaultMessage:"Search for saved views"})},listProps:{bordered:!0}},((e,t)=>n.a.createElement(n.a.Fragment,null,t,n.a.createElement("div",{style:{marginTop:20},"data-test-subj":"savedViews-loadList"},e))))),n.a.createElement(g.EuiModalFooter,null,n.a.createElement(g.EuiButtonEmpty,{"data-test-subj":"cancelSavedViewModal",onClick:e},n.a.createElement(P.FormattedMessage,{defaultMessage:"Cancel",id:"xpack.infra.openView.cancelButton"})),n.a.createElement(g.EuiButton,{fill:!0,color:"primary","data-test-subj":"loadSavedViewModal",onClick:c},n.a.createElement(P.FormattedMessage,{defaultMessage:"Load view",id:"xpack.infra.openView.loadButton"}))))}function ot(e){const t=Object(f.useKibana)(),{views:a,saveView:i,loading:s,updateView:l,deletedId:o,deleteView:c,defaultViewId:u,makeDefault:d,sourceIsLoading:m,find:b,errorOnFind:h,errorOnCreate:y,createdView:E,updatedView:v,currentView:x,setCurrentView:k}=Ze(),[O,M]=Object(r.useState)(!1),[w,j]=Object(r.useState)(!1),[S,C]=Object(r.useState)(!1),[T,F]=Object(r.useState)(!1),[L,P]=Object(r.useState)(!1),[D,I]=Object(r.useState)(!1),_=Object(r.useCallback)((()=>{F(!1)}),[F]),B=Object(r.useCallback)((()=>{_(),b(),j(!0)}),[j,b,_]),R=Object(r.useCallback)((()=>{j(!1)}),[j]),A=Object(r.useCallback)((()=>{_(),C(!1),P(!0)}),[_]),N=Object(r.useCallback)((()=>{_(),C(!1),I(!0)}),[_]),V=Object(r.useCallback)((()=>M(!1)),[]),z=Object(r.useCallback)((()=>P(!1)),[]),U=Object(r.useCallback)((()=>I(!1)),[]),$=Object(r.useCallback)((()=>{_(),b(),M(!0)}),[b,_]),q=Object(r.useCallback)((()=>{F(!T)}),[F,T]),H=Object(r.useCallback)(((t,a=!1)=>{const r={...e.viewState,...a?{}:{time:void 0}};i({...r,name:t})}),[e.viewState,i]),G=Object(r.useCallback)(((t,a=!1)=>{const r={...e.viewState,...a?{}:{time:void 0}};l(x.id,{...r,name:t})}),[e.viewState,l,x]);return Object(r.useEffect)((()=>{y&&C(!0)}),[y]),Object(r.useEffect)((()=>{void 0!==v&&(k(v),U())}),[v,k,U]),Object(r.useEffect)((()=>{void 0!==E&&(k(E),z())}),[E,k,z]),Object(r.useEffect)((()=>{void 0!==o&&b()}),[o,b]),Object(r.useEffect)((()=>{y?t.notifications.toasts.warning(ct("create",y)):h&&t.notifications.toasts.warning(ct("find",h))}),[y,h,t]),n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiPopover,{"data-test-subj":"savedViews-popover",button:n.a.createElement(g.EuiButton,{onClick:q,"data-test-subj":"savedViews-openPopover",iconType:"arrowDown",iconSide:"right",color:"text"},x?x.name:p.i18n.translate("xpack.infra.savedView.unknownView",{defaultMessage:"No view selected"})),isOpen:T,closePopover:_,anchorPosition:"leftCenter"},n.a.createElement(g.EuiListGroup,{flush:!0},n.a.createElement(g.EuiListGroupItem,{"data-test-subj":"savedViews-manageViews",iconType:"indexSettings",onClick:$,label:p.i18n.translate("xpack.infra.savedView.manageViews",{defaultMessage:"Manage views"})}),n.a.createElement(g.EuiListGroupItem,{"data-test-subj":"savedViews-updateView",iconType:"refresh",onClick:N,isDisabled:!x||"0"===x.id,label:p.i18n.translate("xpack.infra.savedView.updateView",{defaultMessage:"Update view"})}),n.a.createElement(g.EuiListGroupItem,{"data-test-subj":"savedViews-loadView",iconType:"importAction",onClick:B,label:p.i18n.translate("xpack.infra.savedView.loadView",{defaultMessage:"Load view"})}),n.a.createElement(g.EuiListGroupItem,{"data-test-subj":"savedViews-saveNewView",iconType:"save",onClick:A,label:p.i18n.translate("xpack.infra.savedView.saveNewView",{defaultMessage:"Save new view"})}))),L&&n.a.createElement(rt,{isInvalid:S,close:z,save:H}),D&&n.a.createElement(nt,{currentView:x,isInvalid:S,close:U,save:G}),w&&n.a.createElement(lt,{currentView:x,views:a,close:R,setView:k}),O&&n.a.createElement(st,{sourceIsLoading:m,loading:s,views:a,defaultViewId:u,makeDefault:d,deleteView:c,close:V,setView:k}))}const ct=(e,t)=>"create"===e?{toastLifeTimeMs:3e3,title:t||p.i18n.translate("xpack.infra.savedView.errorOnCreate.title",{defaultMessage:"An error occured saving view."})}:"find"===e?{toastLifeTimeMs:3e3,title:t||p.i18n.translate("xpack.infra.savedView.findError.title",{defaultMessage:"An error occurred while loading views."})}:void 0,ut=({source:e,derivedIndexPattern:t})=>{const{loading:a,error:i,data:s,currentTimerange:l,options:o,chartOptions:c,setChartOptions:u,handleAggregationChange:d,handleMetricsChange:m,handleFilterQuerySubmit:f,handleGroupByChange:h,handleTimeChange:y,handleRefresh:v,handleLoadMore:x,onViewStateChange:k,loadData:O}=((e,t,a=!0)=>{const[n,i]=Object(r.useState)(0),[s,l]=Object(r.useState)(null),{defaultViewState:o,options:c,currentTimerange:u,chartOptions:d,setChartOptions:m,setTimeRange:p,setOptions:g}=Object(E.h)(),{loading:f,error:b,data:h,loadData:y}=Object(Pe.a)(c,e,t,u,s,n,a),v=Object(r.useCallback)((()=>{l(null),i(n+1)}),[n]),x=Object(r.useCallback)(((e,t)=>{l(null),p({...u,from:e,to:t})}),[u,p]),k=Object(r.useCallback)((e=>{l(null),g({...c,groupBy:e||void 0})}),[c,g]),O=Object(r.useCallback)((e=>{l(null),g({...c,filterQuery:e})}),[c,g]),M=Object(r.useCallback)((e=>{l(null),g({...c,metrics:e})}),[c,g]),w=Object(r.useCallback)((e=>{l(null);const t="count"===e?[{aggregation:e}]:c.metrics.filter((e=>"count"!==e.aggregation)).map((t=>({...t,aggregation:e})));g({...c,aggregation:e,metrics:t})}),[c,g]),j=Object(r.useCallback)((e=>{e.chartOptions&&m(e.chartOptions),e.currentTimerange&&"0"!==e.id&&p(e.currentTimerange),e.options&&g(e.options)}),[m,g,p]);return{loading:f,error:b,data:h,currentTimerange:u,options:c,chartOptions:d,setChartOptions:m,handleAggregationChange:w,handleMetricsChange:M,handleFilterQuerySubmit:O,handleGroupByChange:k,handleTimeChange:x,handleRefresh:v,handleLoadMore:l,defaultViewState:o,onViewStateChange:j,loadData:y,refreshSignal:n,afterKey:s}})(e,t,!1),{currentView:M,shouldLoadDefault:j}=Ze();Object(b.useTrackPageview)({app:"infra_metrics",path:"metrics_explorer"}),Object(b.useTrackPageview)({app:"infra_metrics",path:"metrics_explorer",delay:15e3});const{metricIndicesExist:S}=Object(w.b)();return Object(r.useEffect)((()=>{M&&k(M)}),[M,k]),Object(r.useEffect)((()=>{null==M&&j||O()}),[O,j]),F([{text:T.g}]),n.a.createElement(g.EuiErrorBoundary,null,n.a.createElement(at,{hasData:S,pageHeader:{pageTitle:T.g,rightSideItems:[n.a.createElement(ot,{viewState:{options:o,chartOptions:c,currentTimerange:l}})]}},n.a.createElement(Le,{derivedIndexPattern:t,timeRange:l,options:o,chartOptions:c,onRefresh:v,onTimeChange:y,onGroupByChange:h,onFilterQuerySubmit:f,onMetricsChange:m,onAggregationChange:d,onChartOptionsChange:u}),i?n.a.createElement(L.a,{titleText:"Whoops!",bodyText:p.i18n.translate("xpack.infra.metricsExplorer.errorMessage",{defaultMessage:'It looks like the request failed with "{message}"',values:{message:i.message}}),onRefetch:v,refetchText:"Try Again"}):n.a.createElement(ke,{timeRange:l,loading:a,data:s,source:e,options:o,chartOptions:c,onLoadMore:x,onFilter:f,onRefetch:v,onTimeChange:y})))};var dt=a(28);const mt=new RegExp(`^([\\d\\.]+)\\s*(${H.a.units.join("|")})$`),pt=(_e.keyof({seconds:null,minutes:null,hours:null,days:null,weeks:null,months:null,years:null}),["seconds","minutes","hours","days","weeks","months","years"]),gt={seconds:p.i18n.translate("xpack.infra.durationUnits.seconds.plural",{defaultMessage:"seconds"}),minutes:p.i18n.translate("xpack.infra.durationUnits.minutes.plural",{defaultMessage:"minutes"}),hours:p.i18n.translate("xpack.infra.durationUnits.hours.plural",{defaultMessage:"hours"}),days:p.i18n.translate("xpack.infra.durationUnits.days.plural",{defaultMessage:"days"}),weeks:p.i18n.translate("xpack.infra.durationUnits.weeks.plural",{defaultMessage:"weeks"}),months:p.i18n.translate("xpack.infra.durationUnits.months.plural",{defaultMessage:"months"}),years:p.i18n.translate("xpack.infra.durationUnits.years.plural",{defaultMessage:"years"})},ft={seconds:p.i18n.translate("xpack.infra.durationUnits.seconds.singular",{defaultMessage:"second"}),minutes:p.i18n.translate("xpack.infra.durationUnits.minutes.singular",{defaultMessage:"minute"}),hours:p.i18n.translate("xpack.infra.durationUnits.hours.singular",{defaultMessage:"hour"}),days:p.i18n.translate("xpack.infra.durationUnits.days.singular",{defaultMessage:"day"}),weeks:p.i18n.translate("xpack.infra.durationUnits.weeks.singular",{defaultMessage:"week"}),months:p.i18n.translate("xpack.infra.durationUnits.months.singular",{defaultMessage:"month"}),years:p.i18n.translate("xpack.infra.durationUnits.years.singular",{defaultMessage:"year"})};var bt=a(109);const ht={currentTime:Date.now(),isAutoReloading:!1},yt=_e.type({currentTime:_e.number,isAutoReloading:_e.boolean}),Et=yt.encode,vt=e=>Object(Be.pipe)(yt.decode(e),Object(Re.fold)(Object(Ae.constant)(void 0),Ae.identity)),xt=Ie()((()=>{const[e]=Object(bt.a)({from:"now",to:"now"}),t=H.a.parse(e().to),[a,n]=Object(Ne.b)({defaultState:{...ht,currentTime:t?t.toDate().getTime():Date.now()},decodeUrlState:vt,encodeUrlState:Et,urlStateKey:"waffleTime"}),[i,s]=Object(r.useState)(a);Object(r.useEffect)((()=>{n(i)}),[n,i]);const{currentTime:l,isAutoReloading:o}=a;return{currentTime:l,currentTimeRange:{from:l-3e5,interval:"1m",to:l},isAutoReloading:o,startAutoReload:Object(r.useCallback)((()=>{s((e=>({...e,isAutoReloading:!0})))}),[s]),stopAutoReload:Object(r.useCallback)((()=>{s((e=>({...e,isAutoReloading:!1})))}),[s]),jumpToTime:Object(r.useCallback)((e=>{s((t=>({...t,currentTime:e})))}),[s]),setWaffleTimeState:s}})),[kt,Ot]=xt,Mt=Object(B.withTheme)((({interval:e})=>{const{currentTime:t,isAutoReloading:a,startAutoReload:i,stopAutoReload:s,jumpToTime:l}=Ot(),o=N()(t),c=(e=>{const t=(e=>{if(e){const t=e.match(mt);if(t)return{value:Number(t[1]),unit:t[2]}}throw new Error(p.i18n.translate("xpack.infra.parseInterval.errorMessage",{defaultMessage:"{value} is not an interval string",values:{value:e}}))})(e);if("s"===(null==t?void 0:t.unit)){const e=N.a.duration(t.value,t.unit),n=pt.reduce(((t,a)=>e.as(a)>=1?a:t),"seconds"),i=e.as(n);return`${Math.floor(i)} ${a=i,r=n,1===Math.floor(a)?ft[r]:gt[r]}`}var a,r})(e),u=a?n.a.createElement(g.EuiButton,{color:"primary",iconSide:"left",iconType:"pause",onClick:s},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.waffleTime.stopRefreshingButtonLabel",defaultMessage:"Stop refreshing"})):n.a.createElement(g.EuiButton,{iconSide:"left",iconType:"play",onClick:i},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.waffleTime.autoRefreshButtonLabel",defaultMessage:"Auto-refresh"})),d=Object(r.useCallback)((e=>{e&&l(e.valueOf())}),[l]);return n.a.createElement(g.EuiFlexGroup,{gutterSize:"m"},n.a.createElement(g.EuiFlexItem,{grow:!1,"data-test-subj":"waffleDatePicker"},n.a.createElement(g.EuiToolTip,{content:`Last ${c} of data for the selected time`,delay:"long",display:"inlineBlock",position:"top","data-test-subj":"waffleDatePickerIntervalTooltip"},n.a.createElement(g.EuiDatePicker,{dateFormat:"L LTS",disabled:a,injectTimes:o?[o]:[],isLoading:a,onChange:d,popoverPlacement:"upRight",selected:o,shouldCloseOnSelect:!0,showTimeSelect:!0,timeFormat:"LT"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},u))}));var wt=a(276),jt=a(270),St=a(55),Ct=a(113);const Tt={kind:"kuery",expression:""},Ft=_e.type({kind:_e.literal("kuery"),expression:_e.string}),Lt=Ft.encode,Pt=e=>Object(Be.pipe)(Ft.decode(e),Object(Re.fold)(Object(Ae.constant)(void 0),Ae.identity)),Dt=Ie()((()=>{const{createDerivedIndexPattern:e}=Object(w.b)(),t=e(),[a,n]=Object(Ne.b)({defaultState:Tt,decodeUrlState:Pt,encodeUrlState:Lt,urlStateKey:"waffleFilter"}),[i,s]=Object(r.useState)(a);Object(r.useEffect)((()=>n(i)),[n,i]);const[l,o]=Object(r.useState)(a.expression),c=Object(r.useMemo)((()=>Object(Ct.a)(a.expression,t)),[t,a.expression]),u=Object(r.useCallback)((e=>{s((t=>({...t,kind:"kuery",expression:e})))}),[s]),d=Object(r.useCallback)((e=>{s(e),o(e.expression)}),[]),m=Object(r.useMemo)((()=>(e=>{try{Object(St.fromKueryExpression)(e)}catch(e){return!1}return!0})(l)),[l]),{inventoryPrefill:p}=Object(W.b)(),g=Object(r.useMemo)((()=>p),[p]);return Object(r.useEffect)((()=>g.setFilterQuery(i.expression)),[g,i]),{filterQuery:a,filterQueryDraft:l,filterQueryAsJson:c,applyFilterQuery:d,setFilterQueryDraftFromKueryExpression:o,applyFilterQueryFromKueryExpression:u,isFilterQueryDraftValid:m,setWaffleFiltersState:d}})),[It,_t]=Dt,Bt=()=>{const{createDerivedIndexPattern:e}=Object(w.b)(),{applyFilterQueryFromKueryExpression:t,filterQueryDraft:a,isFilterQueryDraftValid:r,setFilterQueryDraftFromKueryExpression:i}=_t();return n.a.createElement(jt.a,{indexPattern:e()},(({isLoadingSuggestions:e,loadSuggestions:s,suggestions:l})=>n.a.createElement(wt.a,{isLoadingSuggestions:e,isValid:r,loadSuggestions:s,onChange:i,onSubmit:t,placeholder:p.i18n.translate("xpack.infra.homePage.toolbar.kqlSearchFieldPlaceholder",{defaultMessage:"Search for infrastructure data… (e.g. host.name:host-1)"}),suggestions:l,value:a||"",autoFocus:!0})))},Rt=({interval:e})=>n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween",gutterSize:"m",style:{flexGrow:0}},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(Bt,null)),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Mt,{interval:e})));var At=a(133);const Nt=({detailedMessage:e,retry:t,shortMessage:a})=>n.a.createElement(At.a,{isEmptyState:!0},n.a.createElement(g.EuiCallOut,{color:"danger",iconType:"cross",title:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.errorPage.errorOccurredTitle",defaultMessage:"An error occurred"})},n.a.createElement(g.EuiFlexGroup,{alignItems:"center"},n.a.createElement(g.EuiFlexItem,null,a),t?n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{onClick:t,iconType:"refresh"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.errorPage.tryAgainButtonLabel",defaultMessage:"Try again"}))):null),e?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,null),n.a.createElement("div",null,e)):null)),Vt=({errorMessage:e,retry:t})=>n.a.createElement(Nt,{shortMessage:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceErrorPage.failedToLoadDataSourcesMessage",defaultMessage:"Failed to load data sources."}),detailedMessage:n.a.createElement("code",null,e),retry:t});var zt=a(99),Ut=a(132),$t=a.n(Ut),qt=a(121);function Ht(e){return e&&null!=e.nodes&&Array.isArray(e.nodes)}function Gt(e){return e&&null!=e.groups&&Array.isArray(e.groups)}function Jt(e){return e.map((e=>e.value)).join("/")}function Wt(e,t){const a=0===t.length?"__all__":Jt(t),r=Object(R.first)(t);if(2===t.length&&r){const t=r.value,n=e.find((e=>e.id===t));if(Gt(n)){const e=n.groups.find((e=>e.id===a));if(Ht(e))return e}}const n=Object(R.last)(t),i=e.find((e=>e.id===a));return Ht(i)?i:{id:a,name:"__all__"===a?p.i18n.translate("xpack.infra.nodesToWaffleMap.groupsWithNodes.allName",{defaultMessage:"All"}):n&&n.label||"Unknown Group",count:0,width:0,squareSize:0,nodes:[]}}function Kt(e){const t=Object(R.last)(e.path);if(!t)throw new Error("There must be at least one node path item");return{pathId:e.path.map((e=>e.value)).join("/"),path:e.path,id:t.value,ip:t.ip,name:t.label||t.value,metrics:e.metrics}}function Qt(e){return t=>t.id!==e.id}var Xt=a(6),Zt=a.n(Xt);class group_name_GroupName extends n.a.PureComponent{constructor(...e){super(...e),Zt()(this,"handleClick",(e=>{e.preventDefault();const{groupBy:t}=this.props.options;if(0===t.length)return;const a=this.props.isChild&&t.length>1?t[1]:t[0];this.props.onDrilldown(`${a.field}: "${this.props.group.name}"`)}))}render(){const{group:e,isChild:t}=this.props,a={fontSize:t?"0.85em":"1em"};return n.a.createElement(Yt,null,n.a.createElement(ea,{isChild:t},n.a.createElement(ta,null,n.a.createElement(g.EuiToolTip,{position:"top",content:e.name},n.a.createElement(g.EuiLink,{style:a,onClickCapture:this.handleClick,"data-test-subj":"groupNameLink"},e.name))),n.a.createElement(aa,null,e.count)))}}const Yt=B.euiStyled.div`
  position: relative;
  text-align: center;
  font-size: 16px;
  margin-bottom: 5px;
  top: 20px;
  display: flex;
  justify-content: center;
  padding: 0 10px;
`,ea=B.euiStyled.div`
  border: 1px solid ${e=>e.theme.eui.euiBorderColor};
  background-color: ${e=>e.isChild?e.theme.eui.euiColorLightestShade:e.theme.eui.euiColorEmptyShade};
  border-radius: 4px;
  box-shadow: 0px 2px 0px 0px ${e=>e.theme.eui.euiBorderColor};
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
`,ta=B.euiStyled.div`
  flex: 1 1 auto;
  padding: 6px 10px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,aa=B.euiStyled.div`
  flex: 0 0 auto;
  border-left: 1px solid ${e=>e.theme.eui.euiBorderColor};
  padding: 6px 10px;
  font-size: 0.85em;
  font-weight: normal;
`;var ra=a(106),na=a(114),ia=a(76),sa=a(78),la=a(126),oa=a(127),ca=a(139);const ua=Object.keys(sa.e).reduce(((e,t)=>{var a;const r=null===(a=Object(ca.a)(t))||void 0===a?void 0:a.text;return r?{...e,[t]:r}:e}),{});var da=a(80);const ma=Object(B.withTheme)((({theme:e,node:t,nodeType:a,currentTime:r})=>{const{sourceId:i}=Object(w.b)(),s=Object(ia.b)(a),{customMetrics:l}=Object(da.d)(),o=s.tooltipMetrics.map((e=>({type:e}))).concat(l),c=JSON.stringify({bool:{filter:{match_phrase:{[s.fields.id]:t.id}}}}),{nodes:u}=Object(la.a)(c,o,[],a,i,r,"",""),d=Object(R.first)(u),m=d&&d.metrics||[];return n.a.createElement("div",{style:{minWidth:200},"data-test-subj":`conditionalTooltipContent-${t.name}`},n.a.createElement("div",{style:{borderBottom:`1px solid ${null==e?void 0:e.eui.euiColorMediumShade}`,paddingBottom:null==e?void 0:e.eui.euiSizeXS,marginBottom:null==e?void 0:e.eui.euiSizeXS}},t.name),m.map((e=>{const t=sa.f.is(e.name)?e.name:"custom",a=ua[t]||t,r="custom"===a?l.find((t=>t.id===e.name)):null,i=r?Object(he.a)(r):Object(oa.a)({type:t});return n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",key:e.name},n.a.createElement(g.EuiFlexItem,{grow:1,className:"eui-textTruncate eui-displayBlock","data-test-subj":"conditionalTooltipContent-metric"},r?Object(na.a)(r):a),n.a.createElement(g.EuiFlexItem,{grow:!1,"data-test-subj":"conditionalTooltipContent-value"},e.value&&i(e.value)||"-"))})))})),pa={[ae.c.eq]:R.isEqual,[ae.c.lt]:R.lt,[ae.c.lte]:R.lte,[ae.c.gte]:R.gte,[ae.c.gt]:R.gt},ga=e=>Object(ra.toColorString)(Object(ra.parseToRgb)(e)),fa=(e,t,a)=>(a-e)/(t-e),ba=B.euiStyled.div`
  padding: ${e=>e.theme.eui.euiSizeM};
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
`,ha=({title:e,metrics:t})=>n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",responsive:!1},n.a.createElement(ya,{grow:1},n.a.createElement(g.EuiText,{size:"s"},n.a.createElement(Ea,null,e))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},t.map((e=>n.a.createElement(g.EuiFlexItem,{key:e.label},n.a.createElement(g.EuiFlexGroup,{key:e.label,gutterSize:"xs",alignItems:"center",responsive:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIcon,{color:Object(ee.b)(e.color),type:"dot"})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{size:"xs"},e.label))))))))),ya=Object(B.euiStyled)(g.EuiFlexItem).attrs({grow:1})`
  overflow: hidden;
`,Ea=Object(B.euiStyled)("h4")`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,va=["100%",160],xa=({title:e,style:t,chartRef:a,series:r,tickFormatterForTime:i,tickFormatter:s,onPointerUpdate:l,domain:o,stack:c=!1})=>{const u=Object(f.useUiSetting)("theme:darkMode"),d=r.map((e=>e.metric)),m={headerFormatter:e=>N()(e.value).format("Y-MM-DD HH:mm:ss.SSS")};return n.a.createElement(n.a.Fragment,null,n.a.createElement(ha,{title:e,metrics:d}),n.a.createElement(_.Chart,{ref:a,size:va},r.map(((e,a)=>n.a.createElement(Ee.a,{type:t,metric:e.metric,id:"0",key:e.series.id,series:e.series,stack:c}))),n.a.createElement(_.Axis,{id:"timestamp",position:_.Position.Bottom,showOverlappingTicks:!0,tickFormat:i}),n.a.createElement(_.Axis,{id:"values",position:_.Position.Left,tickFormat:s,domain:o,ticks:6,showGridLines:!0}),n.a.createElement(_.Settings,{onPointerUpdate:l,tooltip:m,theme:z(u)})))},ka=p.i18n.translate("xpack.infra.nodeDetails.metrics.system",{defaultMessage:"System"}),Oa=p.i18n.translate("xpack.infra.nodeDetails.metrics.user",{defaultMessage:"User"}),Ma=p.i18n.translate("xpack.infra.nodeDetails.metrics.inbound",{defaultMessage:"Inbound"}),wa=p.i18n.translate("xpack.infra.nodeDetails.metrics.outbound",{defaultMessage:"Outbound"}),ja=p.i18n.translate("xpack.infra.nodeDetails.metrics.used",{defaultMessage:"Used"}),Sa=(p.i18n.translate("xpack.infra.nodeDetails.metrics.cached",{defaultMessage:"Cached"}),p.i18n.translate("xpack.infra.nodeDetails.metrics.free",{defaultMessage:"Free"})),Ca=p.i18n.translate("xpack.infra.nodeDetails.metrics.charts.networkTitle",{defaultMessage:"Network"}),Ta=p.i18n.translate("xpack.infra.nodeDetails.metrics.charts.memoryTitle",{defaultMessage:"Memory"}),Fa=p.i18n.translate("xpack.infra.nodeDetails.metrics.fcharts.cpuTitle",{defaultMessage:"CPU"}),La=p.i18n.translate("xpack.infra.nodeDetails.metrics.charts.loadTitle",{defaultMessage:"Load"}),Pa=p.i18n.translate("xpack.infra.nodeDetails.metrics.logRate",{defaultMessage:"Log Rate"}),Da=p.i18n.translate("xpack.infra.nodeDetails.metrics.charts.logRateTitle",{defaultMessage:"Log Rate"}),Ia=e=>n.a.createElement(g.EuiSelect,{fullWidth:!0,options:[{text:p.i18n.translate("xpack.infra.nodeDetails.metrics.last15Minutes",{defaultMessage:"Last 15 minutes"}),value:9e5},{text:p.i18n.translate("xpack.infra.nodeDetails.metrics.lastHour",{defaultMessage:"Last hour"}),value:36e5},{text:p.i18n.translate("xpack.infra.nodeDetails.metrics.last3Hours",{defaultMessage:"Last 3 hours"}),value:108e5},{text:p.i18n.translate("xpack.infra.nodeDetails.metrics.last24Hours",{defaultMessage:"Last 24 hours"}),value:864e5},{text:p.i18n.translate("xpack.infra.nodeDetails.metrics.last7Days",{defaultMessage:"Last 7 days"}),value:6048e5}],value:e.value,onChange:e.onChange}),_a=Object(B.euiStyled)(g.EuiFlexItem)`
  overflow: hidden
`,Ba=()=>n.a.createElement("div",{style:{width:"100%",height:"200px",padding:"16px",display:"flex",alignItems:"center",justifyContent:"center"}},n.a.createElement(g.EuiLoadingChart,{size:"xl"})),Ra={id:"metrics",name:p.i18n.translate("xpack.infra.nodeDetails.tabs.metrics",{defaultMessage:"Metrics"}),content:e=>{const t=Object(r.useRef)(null),a=Object(r.useRef)(null),i=Object(r.useRef)(null),s=Object(r.useRef)(null),l=Object(r.useRef)(null),o=Object(r.useRef)({}),[c,u]=Object(r.useState)(36e5),d=Object(r.useMemo)((()=>[t,a,i,s,l,o]),[t,a,i,s,l,o]),{sourceId:m,createDerivedIndexPattern:p}=Object(w.b)(),{nodeType:f,accountId:b,region:h,customMetrics:y}=Object(da.d)(),{currentTime:v,node:x}=e,k=Object(r.useMemo)((()=>p()),[p]);let O=`${Object(ia.a)(f).id}: "${x.id}"`;O&&(O=Object(Ct.a)(O,k));const M=Object(r.useCallback)(((e,t,a="avg")=>({type:"custom",aggregation:a,field:e,id:t})),[]),j=Object(r.useCallback)((e=>{u(Number(e.currentTarget.value))}),[u]),S={interval:"1m",to:v,from:v-c,ignoreLookback:!0},C=[{type:"rx"},{type:"tx"},M("system.cpu.user.pct","user"),M("system.cpu.system.pct","system"),M("system.load.1","load1m"),M("system.load.5","load5m"),M("system.load.15","load15m"),M("system.memory.actual.used.bytes","usedMemory"),M("system.memory.actual.free","freeMemory"),M("system.cpu.cores","cores","max")],{nodes:T,reload:F}=Object(la.a)(O,[...C,...y],[],f,m,v,b,h,!1,S),{nodes:L,reload:P}=Object(la.a)(O,[{type:"logRate"}],[],f,m,v,b,h,!1,S),D=Object(r.useCallback)(((e,t)=>{const a=e?Object(be.a)(e,t,!1):null;return a?{max:1.1*a.max,min:a.min}:{max:0,min:0}}),[]),I=Object(r.useCallback)((e=>{var t,a;if(!e)return()=>"";const r=null===(t=Object(R.first)(e.rows))||void 0===t?void 0:t.timestamp,n=null===(a=Object(R.last)(e.rows))||void 0===a?void 0:a.timestamp;return null==r||null==n?e=>`${e}`:Object(_.niceTimeFormatter)([r,n])}),[]),B=Object(r.useMemo)((()=>Object(oa.a)({type:"rx"})),[]),A=Object(r.useMemo)((()=>Object(oa.a)({type:"cpu"})),[]),N=Object(r.useMemo)((()=>Object(oa.a)({type:"s3BucketSize"})),[]),V=Object(r.useMemo)((()=>Object(oa.a)({type:"load"})),[]),z=Object(r.useMemo)((()=>Object(oa.a)({type:"logRate"})),[]),U=Object(r.useCallback)(((...e)=>{const t=e[0],a=e.slice(1);return t.rows=t.rows.map(((e,t)=>{const r={...e};return a.forEach(((e,a)=>{r[`metric_${a+1}`]=e.rows[t].metric_0})),r})),t}),[]),$=Object(r.useCallback)(((e,t)=>{const a={color:ee.a.color0,aggregation:t,label:"System"};return e.map(((e,t)=>({...a,color:ee.a[`color${t}`],label:e})))}),[]),q=Object(r.useCallback)((e=>{d.forEach((t=>{t.current&&(t.current instanceof _.Chart?t.current.dispatchExternalPointerEvent(e):Object.values(t.current).forEach((t=>{t&&t.dispatchExternalPointerEvent(e)})))}))}),[d]),H=Object(r.useCallback)((e=>T&&T.length?T[0].metrics.find((t=>t.name===e)).timeseries:null),[T]),G=Object(r.useCallback)((()=>L?0===L.length?{rows:[],columns:[],id:"0"}:L[0].metrics.find((e=>"logRate"===e.name)).timeseries:null),[L]),J=Object(r.useMemo)((()=>H("system")),[H]),W=Object(r.useMemo)((()=>H("user")),[H]),K=Object(r.useMemo)((()=>H("rx")),[H]),Q=Object(r.useMemo)((()=>H("tx")),[H]),X=Object(r.useMemo)((()=>H("load1m")),[H]),Z=Object(r.useMemo)((()=>H("load5m")),[H]),Y=Object(r.useMemo)((()=>H("load15m")),[H]),te=Object(r.useMemo)((()=>H("usedMemory")),[H]),ae=Object(r.useMemo)((()=>H("freeMemory")),[H]),re=Object(r.useMemo)((()=>H("cores")),[H]),ne=Object(r.useMemo)((()=>G()),[G]);if(Object(r.useEffect)((()=>{F(),P()}),[c,F,P]),!(J&&W&&K&&Q&&X&&Z&&Y&&te&&ae&&ne))return n.a.createElement(Ba,null);const ie=$([ka,Oa],"avg"),se=$([Pa],"rate"),le=$([Ma,wa],"rate"),oe=$(["1m","5m","15m"],"avg"),ce=$([ja,Sa],"rate");J.rows=J.rows.slice().map(((e,t)=>{const a=e.metric_0,r=re.rows[t].metric_0;return a&&r&&(e.metric_0=a/r),e})),W.rows=W.rows.slice().map(((e,t)=>{const a=e.metric_0,r=re.rows[t].metric_0;return a&&r&&(e.metric_0=a/r),e}));const ue=U(J,W),de=U(ne),me=U(K,Q),pe=U(X,Z,Y),ge=U(te,ae),fe=I(K);return n.a.createElement(ba,null,n.a.createElement(Ia,{value:c,onChange:j}),n.a.createElement(g.EuiSpacer,{size:"l"}),n.a.createElement(g.EuiFlexGrid,{columns:2,gutterSize:"l",responsive:!1},n.a.createElement(_a,null,n.a.createElement(xa,{title:Fa,style:E.b.line,chartRef:t,series:[{metric:ie[0],series:J},{metric:ie[1],series:W}],tickFormatterForTime:fe,tickFormatter:A,onPointerUpdate:q,domain:D(ue,ie)})),n.a.createElement(_a,null,n.a.createElement(xa,{title:La,style:E.b.line,chartRef:s,series:[{metric:oe[0],series:X},{metric:oe[1],series:Z},{metric:oe[2],series:Y}],tickFormatterForTime:fe,tickFormatter:V,onPointerUpdate:q,domain:D(pe,oe)})),n.a.createElement(_a,null,n.a.createElement(xa,{title:Ta,style:E.b.line,chartRef:i,series:[{metric:ce[0],series:te},{metric:ce[1],series:ae}],tickFormatterForTime:fe,tickFormatter:N,onPointerUpdate:q,domain:D(ge,ce)})),n.a.createElement(_a,null,n.a.createElement(xa,{title:Ca,style:E.b.line,chartRef:a,series:[{metric:le[0],series:K},{metric:le[1],series:Q}],tickFormatterForTime:fe,tickFormatter:B,onPointerUpdate:q,domain:D(me,le),stack:!0})),n.a.createElement(_a,null,n.a.createElement(xa,{title:Da,style:E.b.line,chartRef:l,series:[{metric:se[0],series:ne}],tickFormatterForTime:fe,tickFormatter:z,onPointerUpdate:q,domain:D(de,se),stack:!0})),y.map((e=>{const t=H(e.id),a=$([e.field],e.aggregation);return t?n.a.createElement(_a,null,n.a.createElement(xa,{title:Object(na.a)(e),style:E.b.line,chartRef:t=>{o.current[e.id]=t},series:[{metric:a[0],series:t}],tickFormatterForTime:fe,tickFormatter:Object(he.a)(e),onPointerUpdate:q,domain:D(U(t),a),stack:!0})):null}))))}};var Aa=a(142),Na=a.n(Aa),Va=a(228),za=a(128);const Ua={id:"logs",name:p.i18n.translate("xpack.infra.nodeDetails.tabs.logs",{defaultMessage:"Logs"}),content:e=>{const[t,a]=Object(r.useState)(""),i=e.currentTime,s=i-36e5,{nodeType:l}=Object(da.d)(),{node:o}=e,c=Na()(t,$a),u=Object(r.useMemo)((()=>({language:"kuery",query:[`${Object(ia.a)(l).id}: "${o.id}"`,...""!==c?[c]:[]].join(" and ")})),[l,o.id,c]),d=Object(r.useCallback)((e=>{a(e.target.value)}),[]),f=Object(b.useLinkProps)(Object(za.b)({nodeType:l,nodeId:o.id,time:s}));return n.a.createElement(ba,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"m",alignItems:"center",responsive:!1},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFieldSearch,{fullWidth:!0,placeholder:p.i18n.translate("xpack.infra.nodeDetails.logs.textFieldPlaceholder",{defaultMessage:"Search for log entries..."}),value:t,isClearable:!0,onChange:d})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,m()({size:"xs",flush:"both",iconType:"popout"},f),n.a.createElement(P.FormattedMessage,{id:"xpack.infra.nodeDetails.logs.openLogsLink",defaultMessage:"Open in Logs"})))),n.a.createElement(Va.a,{logView:{type:"log-view-reference",logViewId:"default"},startTimestamp:s,endTimestamp:i,query:u}))}},$a=1e3;var qa=a(87),Ha=a(21),Ga=a(86);const Ja=Ie()((function(e){const{hostTerm:t,to:a}=e,{createDerivedIndexPattern:r}=Object(w.b)();return{hostTerm:t,indexPattern:r().title,to:a}})),[Wa,Ka]=Ja,Qa={running:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateRunning",{defaultMessage:"Running"}),sleeping:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateSleeping",{defaultMessage:"Sleeping"}),dead:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateDead",{defaultMessage:"Dead"}),stopped:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateStopped",{defaultMessage:"Stopped"}),idle:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateIdle",{defaultMessage:"Idle"}),zombie:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateZombie",{defaultMessage:"Zombie"}),unknown:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.stateUnknown",{defaultMessage:"Unknown"})},Xa=["running","sleeping","stopped","idle","dead","zombie","unknown"],Za=({processSummary:e,isLoading:t})=>{const a=Object(r.useMemo)((()=>({total:t?-1:e.total,...Object(R.mapValues)(Qa,(()=>t?-1:0)),...t?{}:e})),[e,t]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"m",responsive:!1,wrap:!0},Object.entries(a).map((([e,t])=>n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiDescriptionList,{compressed:!0},n.a.createElement(tr,null,Ya[e]),n.a.createElement(g.EuiDescriptionListDescription,null,-1===t?n.a.createElement(er,null):t)))))),n.a.createElement(g.EuiHorizontalRule,{margin:"m"}))},Ya={total:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.headingTotalProcesses",{defaultMessage:"Total processes"}),...Qa},er=Object(B.euiStyled)(g.EuiLoadingSpinner).attrs({size:"m"})`
  margin-top: 2px;
  margin-bottom: 3px;
`,tr=Object(B.euiStyled)(g.EuiDescriptionListTitle)`
  white-space: nowrap;
`;var ar=a(33);const rr=({command:e})=>{const{loading:t,error:a,response:i}=function(e){const[t,a]=Object(r.useState)(!1),{hostTerm:n,indexPattern:i,to:s}=Ka(),{error:l,loading:o,response:c,makeRequest:u}=Object(Ga.a)("/api/metrics/process_list/chart","POST",JSON.stringify({hostTerm:n,indexPattern:i,to:s,command:e}),(e=>Object(Be.pipe)(qa.h.decode(e),Object(Re.fold)(Object(Ha.c)(Ha.a),Ae.identity))));return Object(r.useEffect)((()=>a(!0)),[l]),Object(r.useEffect)((()=>a(!1)),[o]),Object(r.useEffect)((()=>{u()}),[u]),{error:t,loading:o,response:c,makeRequest:u}}(e),s=t||!i,l=a?n.a.createElement(g.EuiEmptyPrompt,{iconType:"alert",title:n.a.createElement(g.EuiText,null,or)}):s?n.a.createElement(g.EuiLoadingChart,null):n.a.createElement(nr,{timeseries:i.cpu,color:ee.a.color2,label:sr}),o=a?n.a.createElement(g.EuiEmptyPrompt,{iconType:"alert",title:n.a.createElement(g.EuiText,null,or)}):s?n.a.createElement(g.EuiLoadingChart,null):n.a.createElement(nr,{timeseries:i.memory,color:ee.a.color0,label:lr});return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiDescriptionListTitle,null,sr),n.a.createElement(g.EuiDescriptionListDescription,null,l)),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiDescriptionListTitle,null,lr),n.a.createElement(g.EuiDescriptionListDescription,null,o)))},nr=({timeseries:e,color:t,label:a})=>{const i={color:t,aggregation:"avg",label:a},s=Object(f.useUiSetting)("theme:darkMode"),l=Object(r.useMemo)((()=>{var t,a;if(!e)return()=>"";const r=null===(t=Object(R.first)(e.rows))||void 0===t?void 0:t.timestamp,n=null===(a=Object(R.last)(e.rows))||void 0===a?void 0:a.timestamp;return null==r||null==n?e=>`${e}`:Object(_.niceTimeFormatter)([r,n])}),[e]),o=Object(ar.b)("percent"),c={headerFormatter:e=>N()(e.value).format("Y-MM-DD HH:mm:ss.SSS")},u=Object(be.a)(e,[i],!1),d=u?{max:1.1*u.max,min:u.min}:{max:0,min:0};return n.a.createElement(ir,null,n.a.createElement(_.Chart,null,n.a.createElement(Ee.a,{type:E.b.area,metric:i,id:"0",series:e,stack:!1}),n.a.createElement(_.Axis,{id:"timestamp",position:_.Position.Bottom,showOverlappingTicks:!0,tickFormat:l}),n.a.createElement(_.Axis,{id:"values",position:_.Position.Left,tickFormat:o,domain:d,ticks:6,showGridLines:!0}),n.a.createElement(_.Settings,{tooltip:c,theme:V(s)})))},ir=B.euiStyled.div`
  width: 100%;
  height: 140px;
`,sr=p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelCPU",{defaultMessage:"CPU"}),lr=p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelMemory",{defaultMessage:"Memory"}),or=p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.failedToLoadChart",{defaultMessage:"Unable to load chart"}),cr=({cells:e,item:t})=>{const[a,i]=Object(r.useState)(!1);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiTableRow,null,n.a.createElement(g.EuiTableRowCell,{isExpander:!0,textOnly:!1},n.a.createElement(g.EuiButtonEmpty,{iconType:a?"arrowDown":"arrowRight","aria-expanded":a,onClick:()=>i(!a)})),e),n.a.createElement(g.EuiTableRow,{isExpandable:!0,isExpandedRow:a},a&&n.a.createElement(qt.a,{bounds:!0},(({measureRef:e,bounds:{height:a=0}})=>n.a.createElement(pr,{commandHeight:a},n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(ur,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"s"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement("div",{ref:e},n.a.createElement(g.EuiDescriptionListTitle,null,p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelCommand",{defaultMessage:"Command"})),n.a.createElement(g.EuiDescriptionListDescription,null,n.a.createElement(mr,null,t.command)))),t.apmTrace&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,null,p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.viewTraceInAPM",{defaultMessage:"View trace in APM"})))),n.a.createElement(g.EuiFlexGrid,{columns:2,gutterSize:"s",responsive:!1},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiDescriptionListTitle,null,p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelPID",{defaultMessage:"PID"})),n.a.createElement(g.EuiDescriptionListDescription,null,n.a.createElement(dr,null,t.pid))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiDescriptionListTitle,null,p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.expandedRowLabelUser",{defaultMessage:"User"})),n.a.createElement(g.EuiDescriptionListDescription,null,n.a.createElement(dr,null,t.user))),n.a.createElement(rr,{command:t.command}))))))))},ur=Object(B.euiStyled)(g.EuiDescriptionList).attrs({compressed:!0})`
  width: 100%;
`,dr=Object(B.euiStyled)(g.EuiCode).attrs({transparentBackground:!0})`
  padding: 0 !important;
  & code.euiCodeBlock__code {
    white-space: nowrap !important;
    vertical-align: middle;
  }
`,mr=Object(B.euiStyled)(g.EuiCode).attrs({transparentBackground:!0})`
  padding: 0 !important;
  margin-bottom: ${e=>e.theme.eui.euiSizeS};
`,pr=Object(B.euiStyled)(g.EuiTableRowCell).attrs({textOnly:!1,colSpan:6})`
  height: ${e=>e.commandHeight+240}px;
  padding: 0 ${e=>e.theme.eui.euiSizeM};
  background-color: ${e=>e.theme.eui.euiColorLightestShade};
`,gr=({state:e})=>{switch(e){case"running":return n.a.createElement(g.EuiBadge,{color:"success"},Qa.running);case"sleeping":return n.a.createElement(g.EuiBadge,{color:"default"},Qa.sleeping);case"dead":return n.a.createElement(g.EuiBadge,{color:"danger"},Qa.dead);case"stopped":return n.a.createElement(g.EuiBadge,{color:"warning"},Qa.stopped);case"idle":return n.a.createElement(g.EuiBadge,{color:"primary"},Qa.idle);case"zombie":return n.a.createElement(g.EuiBadge,{color:"danger"},Qa.zombie);default:return n.a.createElement(g.EuiBadge,{color:"hollow"},Qa.unknown)}},fr=({processList:e,currentTime:t,isLoading:a,sortBy:i,setSortBy:s,clearSearchBar:l})=>{const{updateSortableProperties:o}=function(e,t,a){const[n]=Object(r.useState)(new g.SortableProperties(e,"cpu"));return{updateSortableProperties:Object(r.useCallback)((e=>{n.sortOn(e),a(Object(R.omit)(n.getSortedProperty(),"getValue"))}),[n,a])}}([{name:"startTime",getValue:e=>Date.parse(e.startTime),isAscending:!0},{name:"cpu",getValue:e=>e.cpu,isAscending:!1},{name:"memory",getValue:e=>e.memory,isAscending:!1}],0,s),c=Object(r.useMemo)((()=>e.sort(((e,t)=>Xa.indexOf(e.state)-Xa.indexOf(t.state)))),[e]);return a?n.a.createElement(br,null):0===c.length?n.a.createElement(g.EuiEmptyPrompt,{iconType:"search",titleSize:"s",title:n.a.createElement("strong",null,p.i18n.translate("xpack.infra.metrics.nodeDetails.noProcesses",{defaultMessage:"No processes found"})),body:n.a.createElement(g.EuiText,{size:"s"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metrics.nodeDetails.noProcessesBody",defaultMessage:"Try modifying your filter. Only processes that are within the configured {metricbeatDocsLink} will display here.",values:{metricbeatDocsLink:n.a.createElement(g.EuiLink,{href:"https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-module-system.html",target:"_blank"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metrics.nodeDetails.noProcessesBody.metricbeatDocsLinkText",defaultMessage:"top N by CPU or Memory"}))}})),actions:n.a.createElement(g.EuiButton,{onClick:l},p.i18n.translate("xpack.infra.metrics.nodeDetails.noProcessesClearFilters",{defaultMessage:"Clear filters"}))}):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiTable,{responsive:!1},n.a.createElement(g.EuiTableHeader,null,n.a.createElement(g.EuiTableHeaderCell,{width:24}),xr.map((e=>{var t;return n.a.createElement(g.EuiTableHeaderCell,{key:`${String(e.field)}-header`,align:null!==(t=e.align)&&void 0!==t?t:g.LEFT_ALIGNMENT,width:e.width,onSort:e.sortable?()=>o(e.field):void 0,isSorted:i.name===e.field,isSortAscending:i.name===e.field&&i.isAscending},e.name)}))),n.a.createElement(yr,null,n.a.createElement(hr,{items:c,currentTime:t}))))},br=()=>n.a.createElement("div",{style:{width:"100%",height:"200px",padding:"16px",display:"flex",alignItems:"center",justifyContent:"center"}},n.a.createElement(g.EuiLoadingChart,{size:"xl"})),hr=({items:e,currentTime:t})=>n.a.createElement(n.a.Fragment,null,e.map(((e,a)=>{const r=xr.map((r=>{var i,s;return n.a.createElement(g.EuiTableRowCell,{key:`${String(r.field)}-${a}`,mobileOptions:{header:r.name},align:null!==(i=r.align)&&void 0!==i?i:g.LEFT_ALIGNMENT,textOnly:null===(s=r.textOnly)||void 0===s||s},r.render?r.render(e[r.field],t):e[r.field])}));return n.a.createElement(cr,{cells:r,item:e,key:`row-${a}`})}))),yr=Object(B.euiStyled)(g.EuiTableBody)`
  & .euiTableCellContent {
    padding-top: 0;
    padding-bottom: 0;

  }
`,Er=36e5,vr=({startTime:e,currentTime:t})=>{let a=t-e;const r=Math.floor(a/Er);a-=r*Er;const i=Math.floor(a/6e4);a-=6e4*i;const s=Math.floor(a/1e3);a-=1e3*s;const l=r?`${r}:`:"",o=i<10?`0${i}:`:`${i}:`,c=s<10?`0${s}`:s;return n.a.createElement(n.a.Fragment,null,`${l}${o}${c}`)},xr=[{field:"state",name:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelState",{defaultMessage:"State"}),sortable:!1,render:e=>n.a.createElement(gr,{state:e}),width:84,textOnly:!1},{field:"command",name:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelCommand",{defaultMessage:"Command"}),sortable:!1,width:"40%",render:e=>n.a.createElement(kr,null,e)},{field:"startTime",name:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelTime",{defaultMessage:"Time"}),align:g.RIGHT_ALIGNMENT,sortable:!0,render:(e,t)=>n.a.createElement(vr,{startTime:e,currentTime:t})},{field:"cpu",name:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelCPU",{defaultMessage:"CPU"}),sortable:!0,render:e=>ar.a.percent(e)},{field:"memory",name:p.i18n.translate("xpack.infra.metrics.nodeDetails.processes.columnLabelMemory",{defaultMessage:"Mem."}),sortable:!0,render:e=>ar.a.percent(e)}],kr=B.euiStyled.div`
  font-family: ${e=>e.theme.eui.euiCodeFontFamily};
  font-size: ${e=>e.theme.eui.euiFontSizeS};
  white-space: pre;
  overflow: hidden;
  text-overflow: ellipsis;
`,Or=e=>e.replace(/([+-=!\(\)\{\}\[\]^"~*?:\\/!]|&&|\|\|)/g,"\\$1"),Mr={id:"processes",name:p.i18n.translate("xpack.infra.metrics.nodeDetails.tabs.processes",{defaultMessage:"Processes"}),content:({currentTime:e,node:t,nodeType:a})=>{var i,s;const[l,o]=Object(r.useState)(g.Query.MATCH_ALL),[c,u]=Object(r.useState)(""),[d,m]=Object(r.useState)({name:"cpu",isAscending:!1}),f=Object(r.useMemo)((()=>{var e;return{[null!==(e=Object(ia.c)(a))&&void 0!==e?e:a]:t.name}}),[t,a]),{loading:b,error:h,response:y,makeRequest:E}=function(e,t,a,n){const{createDerivedIndexPattern:i}=Object(w.b)(),s=i().title,[l,o]=Object(r.useState)(!1),c="runtimeLength"===a.name?{...a,name:"startTime"}:a,{error:u,loading:d,response:m,makeRequest:p}=Object(Ga.a)("/api/metrics/process_list","POST",JSON.stringify({hostTerm:e,indexPattern:s,to:t,sortBy:c,searchFilter:n}),(e=>Object(Be.pipe)(qa.i.decode(e),Object(Re.fold)(Object(Ha.c)(Ha.a),Ae.identity))));return Object(r.useEffect)((()=>o(!0)),[u]),Object(r.useEffect)((()=>o(!1)),[d]),Object(r.useEffect)((()=>{p()}),[p]),{error:l,loading:d,response:m,makeRequest:p}}(f,e,d,(e=>{if(""===e.trim())return[{match_all:{}}];const t=e.split(" ").map((e=>e.trim())).filter(Boolean),a=t.filter((e=>e.startsWith("state=")));return[...t.filter((e=>!e.startsWith("state="))).map((e=>({query_string:{fields:["system.process.cmdline"],query:`*${Or(e)}*`,minimum_should_match:1}}))),...a.map((e=>({match:{"system.process.state":e.replace("state=","")}})))]})(c)),v=Object(r.useMemo)((()=>Object(R.debounce)((e=>u(e)),500)),[u]),x=Object(r.useCallback)((({query:e,queryText:t})=>{o(e),v(t)}),[o,v]),k=Object(r.useCallback)((()=>{o(g.Query.MATCH_ALL),u("")}),[o,u]);return n.a.createElement(ba,null,n.a.createElement(Wa,{hostTerm:f,to:e},n.a.createElement(Za,{isLoading:b,processSummary:null!==(i=h?null:null==y?void 0:y.summary)&&void 0!==i?i:{total:0}}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiText,null,n.a.createElement("h4",null,p.i18n.translate("xpack.infra.metrics.nodeDetails.processesHeader",{defaultMessage:"Top processes"})," ",n.a.createElement(g.EuiIconTip,{"aria-label":p.i18n.translate("xpack.infra.metrics.nodeDetails.processesHeader.tooltipLabel",{defaultMessage:"More info"}),size:"m",type:"iInCircle",content:p.i18n.translate("xpack.infra.metrics.nodeDetails.processesHeader.tooltipBody",{defaultMessage:"The table below aggregates the top CPU and top memory consuming processes. It does not display all processes."})}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiSearchBar,{query:l,onChange:x,box:{incremental:!0,placeholder:p.i18n.translate("xpack.infra.metrics.nodeDetails.searchForProcesses",{defaultMessage:"Search for processes…"})},filters:[{type:"field_value_selection",field:"state",name:"State",operator:"exact",multiSelect:!1,options:Object.entries(Qa).map((([e,t])=>({value:e,view:t})))}]}),n.a.createElement(g.EuiSpacer,{size:"m"}),h?n.a.createElement(g.EuiEmptyPrompt,{iconType:"alert",title:n.a.createElement("h4",null,p.i18n.translate("xpack.infra.metrics.nodeDetails.processListError",{defaultMessage:"Unable to load process data"})),actions:n.a.createElement(g.EuiButton,{color:"primary",fill:!0,onClick:E},p.i18n.translate("xpack.infra.metrics.nodeDetails.processListRetry",{defaultMessage:"Try again"}))}):n.a.createElement(fr,{currentTime:e,isLoading:b||!y,processList:null!==(s=null==y?void 0:y.processList)&&void 0!==s?s:[],sortBy:d,setSortBy:m,clearSearchBar:k})))}};var wr=a(183),jr=a(206);const Sr=(e,t)=>{const a=t.filter((e=>e&&"metrics"===e.source)).map((e=>e&&e.name));return e.filter((e=>{const t=(0,jr.a.tsvb[e])(C.j,"test",">=1m");return a.some((e=>e&&t.requires.includes(e)))}))};function Cr(e,t,a,n,i){const{error:s,loading:l,response:o,makeRequest:c}=Object(Ga.a)("/api/infra/metadata","POST",JSON.stringify({nodeId:e,nodeType:t,sourceId:n,timeRange:{from:i.from,to:i.to}}),(e=>Object(Be.pipe)(wr.a.decode(e),Object(Re.fold)(Object(Ha.c)(Ha.a),Ae.identity))));return Object(r.useEffect)((()=>{(async()=>{await c()})()}),[c]),{name:o&&o.name||"",filteredRequiredMetrics:o&&Sr(a,o.features)||[],error:s&&s.message||null,loading:l,metadata:o,cloudId:o&&o.info&&o.info.cloud&&o.info.cloud.instance&&o.info.cloud.instance.id||""}}const Tr=(e,t)=>{var a,r,n,i,s,l,o,c,u,d,m,p,g,f,b,h,y,E,v,x,k,O,M,w,j,S,C,T,F,L,P,D,I,_,B,R,A,N,V,z,U,$,q,H,G,J,W,K,Q,X,Z,Y,ee,te,ae,re,ne;switch(t){case"host":return Fr([{name:"host.architecture",value:null===(a=e.info)||void 0===a||null===(r=a.host)||void 0===r?void 0:r.architecture},{name:"host.hostname",value:null===(n=e.info)||void 0===n||null===(i=n.host)||void 0===i?void 0:i.name},{name:"host.id",value:null===(s=e.info)||void 0===s||null===(l=s.host)||void 0===l?void 0:l.id},{name:"host.ip",value:null===(o=e.info)||void 0===o||null===(c=o.host)||void 0===c?void 0:c.ip},{name:"host.mac",value:null===(u=e.info)||void 0===u||null===(d=u.host)||void 0===d?void 0:d.mac},{name:"host.name",value:null===(m=e.info)||void 0===m||null===(p=m.host)||void 0===p?void 0:p.name},{name:"host.os.build",value:null===(g=e.info)||void 0===g||null===(f=g.host)||void 0===f||null===(b=f.os)||void 0===b?void 0:b.build},{name:"host.os.family",value:null===(h=e.info)||void 0===h||null===(y=h.host)||void 0===y||null===(E=y.os)||void 0===E?void 0:E.family},{name:"host.os.name",value:null===(v=e.info)||void 0===v||null===(x=v.host)||void 0===x||null===(k=x.os)||void 0===k?void 0:k.name},{name:"host.os.kernel",value:null===(O=e.info)||void 0===O||null===(M=O.host)||void 0===M||null===(w=M.os)||void 0===w?void 0:w.kernel},{name:"host.os.platform",value:null===(j=e.info)||void 0===j||null===(S=j.host)||void 0===S||null===(C=S.os)||void 0===C?void 0:C.platform},{name:"host.os.version",value:null===(T=e.info)||void 0===T||null===(F=T.host)||void 0===F||null===(L=F.os)||void 0===L?void 0:L.version}]);case"cloud":return Fr([{name:"cloud.account.id",value:null===(P=e.info)||void 0===P||null===(D=P.cloud)||void 0===D||null===(I=D.account)||void 0===I?void 0:I.id},{name:"cloud.account.name",value:null===(_=e.info)||void 0===_||null===(B=_.cloud)||void 0===B||null===(R=B.account)||void 0===R?void 0:R.name},{name:"cloud.availability_zone",value:null===(A=e.info)||void 0===A||null===(N=A.cloud)||void 0===N?void 0:N.availability_zone},{name:"cloud.instance.id",value:null===(V=e.info)||void 0===V||null===(z=V.cloud)||void 0===z||null===(U=z.instance)||void 0===U?void 0:U.id},{name:"cloud.instance.name",value:null===($=e.info)||void 0===$||null===(q=$.cloud)||void 0===q||null===(H=q.instance)||void 0===H?void 0:H.name},{name:"cloud.machine.type",value:null===(G=e.info)||void 0===G||null===(J=G.cloud)||void 0===J||null===(W=J.machine)||void 0===W?void 0:W.type},{name:"cloud.provider",value:null===(K=e.info)||void 0===K||null===(Q=K.cloud)||void 0===Q?void 0:Q.provider},{name:"cloud.region",value:null===(X=e.info)||void 0===X||null===(Z=X.cloud)||void 0===Z?void 0:Z.region}]);case"agent":return Fr([{name:"agent.id",value:null===(Y=e.info)||void 0===Y||null===(ee=Y.agent)||void 0===ee?void 0:ee.id},{name:"agent.version",value:null===(te=e.info)||void 0===te||null===(ae=te.agent)||void 0===ae?void 0:ae.version},{name:"agent.policy",value:null===(re=e.info)||void 0===re||null===(ne=re.agent)||void 0===ne?void 0:ne.policy}])}},Fr=e=>e.filter((e=>!!e.value)),Lr=e=>{const{rows:t,title:a,onClick:i}=e,s=Object(r.useMemo)((()=>[{field:"name",name:"",width:"35%",sortable:!1,render:(e,t)=>n.a.createElement(g.EuiText,{size:"xs"},n.a.createElement("strong",null,t.name))},{field:"value",name:"",width:"65%",sortable:!1,render:(e,t)=>n.a.createElement("span",null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"xs",alignItems:"center",responsive:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:p.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.setFilterTooltip",{defaultMessage:"View event with filter"})},n.a.createElement(g.EuiButtonIcon,{color:"text",size:"s",iconType:"filter","aria-label":p.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.filterAriaLabel",{defaultMessage:"Filter"}),onClick:()=>i(t)}))),n.a.createElement(g.EuiFlexItem,null,!Array.isArray(t.value)&&t.value,Array.isArray(t.value)&&n.a.createElement(Pr,{values:t.value}))))}]),[i]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,null,n.a.createElement("h4",null,a)),n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(table_TableWithoutHeader,{tableLayout:"fixed",compressed:!0,responsive:!1,columns:s,items:t}))};class table_TableWithoutHeader extends g.EuiBasicTable{renderTableHead(){return n.a.createElement(n.a.Fragment,null)}}const Pr=e=>{const{values:t}=e,[a,i]=Object(r.useState)(!1),s=Object(r.useCallback)((()=>{i(!0)}),[]),l=Object(r.useCallback)((()=>{i(!1)}),[]);return n.a.createElement(n.a.Fragment,null,!a&&n.a.createElement(g.EuiFlexGroup,{gutterSize:"xs",responsive:!1,alignItems:"baseline",wrap:!0},n.a.createElement(g.EuiFlexItem,{grow:!1},Object(R.first)(t)," ... "),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiLink,{onClick:s},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.nodeDetails.tabs.metadata.seeMore",defaultMessage:"+{count} more",values:{count:t.length}})))),a&&n.a.createElement("div",null,t.map((e=>n.a.createElement("div",{key:e},e))),n.a.createElement(g.EuiLink,{onClick:l},p.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.seeLess",{defaultMessage:"Show less"}))))},Dr=B.euiStyled.div`
  &:not(:last-child) {
    margin-bottom: 16px
  }
`,Ir=()=>n.a.createElement("div",{style:{width:"100%",height:"200px",padding:"16px",display:"flex",alignItems:"center",justifyContent:"center"}},n.a.createElement(g.EuiLoadingChart,{size:"xl"})),_r={id:"properties",name:p.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.title",{defaultMessage:"Metadata"}),content:e=>{const t=e.node.id,a=e.nodeType,i=Object(ia.b)(a),{sourceId:s}=Object(w.b)(),{currentTimeRange:l}=Ot(),{applyFilterQuery:o}=_t(),{loading:c,metadata:u}=Cr(t,a,i.requiredMetrics,s,l),d=Object(r.useMemo)((()=>u?Tr(u,"host"):null),[u]),m=Object(r.useMemo)((()=>u?Tr(u,"cloud"):null),[u]),g=Object(r.useMemo)((()=>u?Tr(u,"agent"):null),[u]),f=Object(r.useCallback)((e=>{o({kind:"kuery",expression:`${e.name}: "${e.value}"`})}),[o]);return c?n.a.createElement(Ir,null):n.a.createElement(ba,null,d&&d.length>0&&n.a.createElement(Dr,null,n.a.createElement(Lr,{title:p.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.hostsHeader",{defaultMessage:"Hosts"}),onClick:f,rows:d})),m&&m.length>0&&n.a.createElement(Dr,null,n.a.createElement(Lr,{title:p.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.cloudHeader",{defaultMessage:"Cloud"}),onClick:f,rows:m})),g&&g.length>0&&n.a.createElement(Dr,null,n.a.createElement(Lr,{title:p.i18n.translate("xpack.infra.nodeDetails.tabs.metadata.agentHeader",{defaultMessage:"Agent"}),onClick:f,rows:g})))}};var Br=a(27),Rr=a(95);const Ar=_e.tuple([_e.union([_e.string,_e.number]),_e.union([_e.string,_e.number])]),Nr=_e.keyof({metrics_hosts:null,metrics_k8s:null}),Vr=_e.keyof({anomalyScore:null,dataset:null,startTime:null}),zr=_e.keyof({asc:null,desc:null}),Ur=_e.type({searchBefore:Ar}),$r=_e.type({searchAfter:Ar}),qr=_e.intersection([_e.type({pageSize:_e.number}),_e.partial({cursor:_e.union([Ur,$r])})]),Hr=_e.type({field:Vr,direction:zr}),Gr=_e.keyof({memory_usage:null,network_in:null,network_out:null}),Jr=_e.intersection([_e.type({id:_e.string,anomalyScore:_e.number,typical:_e.number,actual:_e.number,type:Nr,influencers:_e.array(_e.string),duration:_e.number,startTime:_e.number,jobId:_e.string}),_e.partial({partitionFieldName:_e.string,partitionFieldValue:_e.string})]),Wr=_e.intersection([_e.type({data:_e.intersection([_e.type({anomalies:_e.array(Jr),hasMoreEntries:_e.boolean}),_e.partial({paginationCursors:_e.type({previousPageCursor:Ar,nextPageCursor:Ar})})])}),_e.partial({timing:Rr.c})]),Kr=_e.type({data:_e.intersection([_e.type({sourceId:_e.string,anomalyThreshold:_e.number,timeRange:Rr.d}),_e.partial({query:_e.string,hostName:_e.string,metric:Gr,pagination:qr,sort:Hr})])}),Qr=_e.intersection([_e.type({id:_e.string,anomalyScore:_e.number,typical:_e.number,actual:_e.number,type:Nr,influencers:_e.array(_e.string),duration:_e.number,startTime:_e.number,jobId:_e.string}),_e.partial({partitionFieldName:_e.string,partitionFieldValue:_e.string})]),Xr=_e.intersection([_e.type({data:_e.intersection([_e.type({anomalies:_e.array(Qr),hasMoreEntries:_e.boolean}),_e.partial({paginationCursors:_e.type({previousPageCursor:Ar,nextPageCursor:Ar})})])}),_e.partial({timing:Rr.c})]),Zr=_e.type({data:_e.intersection([_e.type({sourceId:_e.string,anomalyThreshold:_e.number,timeRange:Rr.d}),_e.partial({query:_e.string,metric:Gr,pagination:qr,sort:Hr})])});var Yr=a(71);const en=(e,t)=>{const a={page:1,paginationCursor:void 0};switch(t.type){case"changePaginationOptions":case"changeSortOptions":case"changeTimeRange":case"changeFilteredDatasets":return{...e,...a,...t.payload};case"changeHasNextPage":case"changeLastReceivedCursors":return{...e,...t.payload};case"fetchNextPage":return e.lastReceivedCursors?{...e,page:e.page+1,paginationCursor:{searchAfter:e.lastReceivedCursors.nextPageCursor}}:e;case"fetchPreviousPage":return e.lastReceivedCursors?{...e,page:e.page-1,paginationCursor:{searchBefore:e.lastReceivedCursors.previousPageCursor}}:e;default:return e}},tn={page:1,lastReceivedCursors:void 0,paginationCursor:void 0,hasNextPage:!1},an=({endTime:e,startTime:t,sourceId:a,anomalyThreshold:n,defaultSortOptions:i,defaultPaginationOptions:s,onGetMetricsHostsAnomaliesDatasetsError:l,filteredDatasets:o})=>{const{services:c}=Object(tt.b)(),[u,d]=Object(r.useReducer)(en,tn,(a=>({...a,paginationOptions:s,sortOptions:i,filteredDatasets:o,timeRange:{start:t,end:e}}))),[m,p]=Object(r.useState)([]),[g,f]=Object(Yr.c)({cancelPreviousOn:"creation",createPromise:async(e,t)=>{const{timeRange:{start:r,end:i},sortOptions:s,paginationOptions:l,paginationCursor:o}=u;return await rn({sourceId:a,anomalyThreshold:n,startTime:r,endTime:i,metric:e,query:t,sort:s,pagination:{...l,cursor:o}},c.http.fetch)},onResolve:({data:{anomalies:e,paginationCursors:t,hasMoreEntries:a}})=>{const{paginationCursor:r}=u;t&&d({type:"changeLastReceivedCursors",payload:{lastReceivedCursors:t}}),!r||r&&"searchAfter"in r?d({type:"changeHasNextPage",payload:{hasNextPage:a}}):r&&"searchBefore"in r&&d({type:"changeHasNextPage",payload:{hasNextPage:!0}}),p(e)}},[a,n,d,u.timeRange.start,u.timeRange.end,u.sortOptions,u.paginationOptions,u.paginationCursor,u.filteredDatasets]),b=Object(r.useCallback)((e=>{d({type:"changeSortOptions",payload:{sortOptions:e}})}),[d]),h=Object(r.useCallback)((e=>{d({type:"changePaginationOptions",payload:{paginationOptions:e}})}),[d]);Object(r.useEffect)((()=>{d({type:"changeTimeRange",payload:{timeRange:{start:t,end:e}}})}),[t,e]),Object(r.useEffect)((()=>{d({type:"changeFilteredDatasets",payload:{filteredDatasets:o}})}),[o]);const y=Object(r.useCallback)((()=>{u.lastReceivedCursors&&d({type:"fetchNextPage"})}),[d,u]),E=Object(r.useCallback)((()=>{u.lastReceivedCursors&&d({type:"fetchPreviousPage"})}),[d,u]);return{metricsK8sAnomalies:m,getMetricsK8sAnomalies:f,isLoadingMetricsK8sAnomalies:Object(r.useMemo)((()=>"pending"===g.state),[g.state]),hasFailedLoadingMetricsK8sAnomalies:Object(r.useMemo)((()=>"rejected"===g.state),[g.state]),changeSortOptions:b,sortOptions:u.sortOptions,changePaginationOptions:h,paginationOptions:u.paginationOptions,fetchPreviousPage:u.page>1?E:void 0,fetchNextPage:u.hasNextPage?y:void 0,page:u.page}},rn=async(e,t)=>{const{sourceId:a,anomalyThreshold:r,startTime:n,endTime:i,metric:s,query:l,sort:o,pagination:c}=e,u=await t("/api/infra/infra_ml/results/metrics_k8s_anomalies",{method:"POST",body:JSON.stringify(Zr.encode({data:{sourceId:a,anomalyThreshold:r,timeRange:{startTime:n,endTime:i},metric:s,query:l,sort:o,pagination:c}}))});return Object(Ha.b)(Xr)(u)},nn=(e,t)=>{const a={page:1,paginationCursor:void 0};switch(t.type){case"changePaginationOptions":case"changeSortOptions":case"changeTimeRange":case"changeFilteredDatasets":return{...e,...a,...t.payload};case"changeHasNextPage":case"changeLastReceivedCursors":return{...e,...t.payload};case"fetchNextPage":return e.lastReceivedCursors?{...e,page:e.page+1,paginationCursor:{searchAfter:e.lastReceivedCursors.nextPageCursor}}:e;case"fetchPreviousPage":return e.lastReceivedCursors?{...e,page:e.page-1,paginationCursor:{searchBefore:e.lastReceivedCursors.previousPageCursor}}:e;default:return e}},sn={page:1,lastReceivedCursors:void 0,paginationCursor:void 0,hasNextPage:!1},ln=({endTime:e,startTime:t,sourceId:a,anomalyThreshold:n,defaultSortOptions:i,defaultPaginationOptions:s,onGetMetricsHostsAnomaliesDatasetsError:l,filteredDatasets:o})=>{const{services:c}=Object(tt.b)(),[u,d]=Object(r.useReducer)(nn,sn,(a=>({...a,paginationOptions:s,sortOptions:i,filteredDatasets:o,timeRange:{start:t,end:e}}))),[m,p]=Object(r.useState)([]),[g,f]=Object(Yr.c)({cancelPreviousOn:"creation",createPromise:async(e,t,r)=>{const{timeRange:{start:i,end:s},sortOptions:l,paginationOptions:o,paginationCursor:d}=u;return await on({sourceId:a,anomalyThreshold:n,startTime:i,endTime:s,metric:e,query:t,sort:l,pagination:{...o,cursor:d},hostName:r},c.http.fetch)},onResolve:({data:{anomalies:e,paginationCursors:t,hasMoreEntries:a}})=>{const{paginationCursor:r}=u;t&&d({type:"changeLastReceivedCursors",payload:{lastReceivedCursors:t}}),!r||r&&"searchAfter"in r?d({type:"changeHasNextPage",payload:{hasNextPage:a}}):r&&"searchBefore"in r&&d({type:"changeHasNextPage",payload:{hasNextPage:!0}}),p(e)}},[a,n,d,u.timeRange.start,u.timeRange.end,u.sortOptions,u.paginationOptions,u.paginationCursor,u.filteredDatasets]),b=Object(r.useCallback)((e=>{d({type:"changeSortOptions",payload:{sortOptions:e}})}),[d]),h=Object(r.useCallback)((e=>{d({type:"changePaginationOptions",payload:{paginationOptions:e}})}),[d]);Object(r.useEffect)((()=>{d({type:"changeTimeRange",payload:{timeRange:{start:t,end:e}}})}),[t,e]),Object(r.useEffect)((()=>{d({type:"changeFilteredDatasets",payload:{filteredDatasets:o}})}),[o]);const y=Object(r.useCallback)((()=>{u.lastReceivedCursors&&d({type:"fetchNextPage"})}),[d,u]),E=Object(r.useCallback)((()=>{u.lastReceivedCursors&&d({type:"fetchPreviousPage"})}),[d,u]);return{metricsHostsAnomalies:m,getMetricsHostsAnomalies:f,isLoadingMetricsHostsAnomalies:Object(r.useMemo)((()=>"pending"===g.state),[g.state]),hasFailedLoadingMetricsHostsAnomalies:Object(r.useMemo)((()=>"rejected"===g.state),[g.state]),changeSortOptions:b,sortOptions:u.sortOptions,changePaginationOptions:h,paginationOptions:u.paginationOptions,fetchPreviousPage:u.page>1?E:void 0,fetchNextPage:u.hasNextPage?y:void 0,page:u.page,timeRange:u.timeRange}},on=async(e,t)=>{const{sourceId:a,anomalyThreshold:r,startTime:n,endTime:i,metric:s,sort:l,pagination:o,query:c,hostName:u}=e,d=await t("/api/infra/infra_ml/results/metrics_hosts_anomalies",{method:"POST",body:JSON.stringify(Kr.encode({data:{sourceId:a,anomalyThreshold:r,timeRange:{startTime:n,endTime:i},query:c,metric:s,sort:l,pagination:o,hostName:u}}))});return Object(Ha.b)(Wr)(d)},cn=p.i18n.translate("xpack.infra.logs.analysis.anomaliesTablePreviousPageLabel",{defaultMessage:"Previous page"}),un=p.i18n.translate("xpack.infra.logs.analysis.anomaliesTableNextPageLabel",{defaultMessage:"Next page"}),dn=({fetchPreviousPage:e,fetchNextPage:t,page:a,isLoading:r})=>n.a.createElement(g.EuiFlexGroup,{justifyContent:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(g.EuiButtonIcon,{iconType:"arrowLeft",isDisabled:!e||r,onClick:e,"aria-label":cn}),n.a.createElement("span",null,n.a.createElement("strong",null,a)),n.a.createElement(g.EuiButtonIcon,{iconType:"arrowRight",isDisabled:!t||r,onClick:t,"aria-label":un}))));var mn=a(72);const pn=({anomaly:e})=>{const{actual:t,typical:a}=e,r=p.i18n.translate("xpack.infra.ml.anomalyFlyout.anomaliesTableMoreThanExpectedAnomalyMessage",{defaultMessage:"more"}),i=p.i18n.translate("xpack.infra.ml.anomalyFlyout.anomaliesTableFewerThanExpectedAnomalyMessage",{defaultMessage:"fewer"}),s=t>a,l=s?r:i,o=s?t/a:a/t,c=s?"sortUp":"sortDown",u=o!==1/0?`${Object(mn.h)(o)}x`:"";return n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",responsive:!1,alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1,component:"span"},n.a.createElement(g.EuiIcon,{type:c})),n.a.createElement(g.EuiFlexItem,{component:"span"},`${u} ${l}`))};var gn=a(191),fn=a(56),bn=a(212);const hn=_e.type({capabilities:_e.type({canGetJobs:_e.boolean,canCreateJob:_e.boolean,canDeleteJob:_e.boolean,canOpenJob:_e.boolean,canCloseJob:_e.boolean,canForecastJob:_e.boolean,canGetDatafeeds:_e.boolean,canStartStopDatafeed:_e.boolean,canUpdateJob:_e.boolean,canUpdateDatafeed:_e.boolean,canPreviewDatafeed:_e.boolean}),isPlatinumOrTrialLicense:_e.boolean,mlFeatureEnabledInSpace:_e.boolean,upgradeInProgress:_e.boolean}),yn=()=>{const{services:e}=Object(tt.b)(),[t,a]=Object(r.useState)(xn),[n,i]=Object(Yr.c)({cancelPreviousOn:"resolution",createPromise:async()=>{const t=await e.http.fetch("/api/ml/ml_capabilities");return Object(Be.pipe)(hn.decode(t),Object(Re.fold)(Object(Ha.c)(Ha.a),Ae.identity))},onResolve:e=>{a(e)}},[]);Object(r.useEffect)((()=>{i()}),[i]);const s=Object(r.useMemo)((()=>"pending"===n.state),[n.state]),l=t.capabilities.canCreateJob,o=t.capabilities.canGetJobs;return{hasInfraMLCapabilities:t.isPlatinumOrTrialLicense&&t.mlFeatureEnabledInSpace,hasInfraMLReadCapabilities:o,hasInfraMLSetupCapabilities:l,isLoading:s}},[En,vn]=Ie()(yn),xn={capabilities:{canGetJobs:!1,canCreateJob:!1,canDeleteJob:!1,canOpenJob:!1,canCloseJob:!1,canForecastJob:!1,canGetDatafeeds:!1,canStartStopDatafeed:!1,canUpdateJob:!1,canUpdateDatafeed:!1,canPreviewDatafeed:!1,canGetCalendars:!1,canCreateCalendar:!1,canDeleteCalendar:!1,canGetFilters:!1,canCreateFilter:!1,canDeleteFilter:!1,canFindFileStructure:!1,canGetDataFrameJobs:!1,canDeleteDataFrameJob:!1,canPreviewDataFrameJob:!1,canCreateDataFrameJob:!1,canStartStopDataFrameJob:!1},isPlatinumOrTrialLicense:!1,mlFeatureEnabledInSpace:!1,upgradeInProgress:!1};var kn=a(208),On=a(102);const Mn=({jobTypes:e})=>({jobStatus:e.reduce(((e,t)=>({...e,[t]:"unknown"})),{}),jobSummaries:[],lastSetupErrorMessages:[],setupStatus:{type:"initializing"}}),wn=e=>null!=e.error,jn=e=>Object(r.useReducer)((e=>(t,a)=>{switch(a.type){case"startedSetup":return{...t,jobStatus:e.reduce(((e,t)=>({...e,[t]:"initializing"})),{}),setupStatus:{type:"pending"}};case"finishedSetup":{const{datafeedSetupResults:r,jobSetupResults:n,jobSummaries:i,spaceId:s,sourceId:l}=a,o=e.reduce(((e,t)=>{return{...e,[t]:(i=Object(On.c)(s,l,t),e=>e.filter((e=>e.id===i&&e.success&&!e.error)).length>0)(n)&&(a=Object(On.b)(s,l,t),e=>e.filter((e=>e.id===a&&e.success&&e.started&&!e.error)).length>0)(r)?"started":"failed"};var a,i}),{}),c=Object.values(o).every((e=>"started"===e))?{type:"succeeded"}:{type:"failed",reasons:[...Object.values(r).filter(wn).map((e=>e.error.msg)),...Object.values(n).filter(wn).map((e=>e.error.msg))]};return{...t,jobStatus:o,jobSummaries:i,setupStatus:c}}case"failedSetup":return{...t,jobStatus:e.reduce(((e,t)=>({...e,[t]:"failed"})),{}),setupStatus:{type:"failed",reasons:["unknown"]}};case"fetchingJobStatuses":return{...t,setupStatus:"unknown"===t.setupStatus.type?{type:"initializing"}:t.setupStatus};case"fetchedJobStatuses":{const{payload:n,spaceId:i,sourceId:s}=a,{setupStatus:l}=t,o=e.reduce(((e,t)=>{return{...e,[t]:(a=Object(On.c)(i,s,t),e=>e.filter((e=>e.id===a)).map((e=>"failed"===e.jobState||""===e.datafeedState?"failed":"closed"===e.jobState&&"stopped"===e.datafeedState&&e.fullJob&&null!=e.fullJob.finished_time?"finished":"closed"===e.jobState||"closing"===e.jobState||"stopped"===e.datafeedState?"stopped":"opening"===e.jobState&&!1===e.awaitingNodeAssignment||"resetting"===e.jobState||"reverting"===e.jobState?"initializing":"opened"===e.jobState&&"started"===e.datafeedState||"opening"===e.jobState&&"starting"===e.datafeedState&&!0===e.awaitingNodeAssignment?"started":"unknown"))[0]||"missing")(n)};var a}),{}),c=(r=o,e=>Object.entries(r).reduce(((e,[,t])=>"missing"===t?{type:"required"}:"required"===e.type||"succeeded"===e.type?e:"skipped"===e.type||Object(On.e)(t)?{type:"skipped",newlyCreated:"skipped"===e.type&&e.newlyCreated}:e),e))(l);return{...t,jobSummaries:n,jobStatus:o,setupStatus:c}}case"failedFetchingJobStatuses":return{...t,setupStatus:{type:"unknown"},jobStatus:e.reduce(((e,t)=>({...e,[t]:"unknown"})),{})};case"viewedResults":return{...t,setupStatus:{type:"skipped",newlyCreated:!0}};default:return t}var r})(e),{jobTypes:e},Mn),Sn=({sourceConfiguration:e,moduleDescriptor:t})=>{const{services:a}=Object(tt.b)(),{spaceId:n,sourceId:i}=e,[s,l]=jn(t.jobTypes),[,o]=Object(Yr.c)({cancelPreviousOn:"resolution",createPromise:async()=>(l({type:"fetchingJobStatuses"}),await t.getJobSummary(n,i,a.http.fetch)),onResolve:e=>{l({type:"fetchedJobStatuses",payload:e,spaceId:n,sourceId:i})},onReject:()=>{l({type:"failedFetchingJobStatuses"})}},[n,i]),[,c]=Object(Yr.c)({cancelPreviousOn:"resolution",createPromise:async(e,r,s,o,c)=>(l({type:"startedSetup"}),{setupResult:await t.setUpModule({start:r,end:s,filter:o,moduleSourceConfiguration:{indices:e,sourceId:i,spaceId:n},partitionField:c},a.http.fetch),jobSummaries:await t.getJobSummary(n,i,a.http.fetch)}),onResolve:({setupResult:{datafeeds:e,jobs:t},jobSummaries:a})=>{l({type:"finishedSetup",datafeedSetupResults:e,jobSetupResults:t,jobSummaries:a,spaceId:n,sourceId:i})},onReject:()=>{l({type:"failedSetup"})}},[t.setUpModule,n,i]),[u,d]=Object(Yr.c)({cancelPreviousOn:"resolution",createPromise:async()=>await t.cleanUpModule(n,i,a.http.fetch)},[n,i]),m=Object(r.useMemo)((()=>"pending"===u.state),[u.state]),p=Object(r.useCallback)(((e,t,a,r,n)=>{l({type:"startedSetup"}),d().then((()=>{c(e,t,a,r,n)})).catch((()=>{l({type:"failedSetup"})}))}),[d,l,c]),g=Object(r.useCallback)((()=>{l({type:"viewedResults"})}),[l]),f=Object(r.useMemo)((()=>t.getJobIds(n,i)),[t,n,i]);return{cleanUpAndSetUpModule:p,cleanUpModule:d,fetchJobStatus:o,isCleaningUp:m,jobIds:f,jobStatus:s.jobStatus,jobSummaries:s.jobSummaries,lastSetupErrorMessages:s.lastSetupErrorMessages,moduleDescriptor:t,setUpModule:c,setupStatus:s.setupStatus,sourceConfiguration:e,viewResults:g}},Cn=({moduleDescriptor:e,sourceConfiguration:t})=>({getIsJobConfigurationOutdated:Object(r.useMemo)((()=>Tn(e,t)),[t,e])}),Tn=({bucketSpan:e},t)=>a=>{if(!a.fullJob||!a.fullJob.custom_settings)return!1;const r=a.fullJob.custom_settings.metrics_source_config;return!(r&&r.bucketSpan===e&&r.indexPattern&&Fn(new Set(r.indexPattern.split(",")),new Set(t.indices)))},Fn=(e,t)=>Array.from(e).every((e=>t.has(e))),Ln=({sourceConfiguration:{spaceId:e,sourceId:t},moduleDescriptor:a})=>{const{services:n}=Object(tt.b)(),[i,s]=Object(r.useState)(),l=Object(r.useMemo)((()=>i?i.jobs.reduce(((a,r)=>({...a,[Object(mn.k)(e,t,r.id)]:r})),{}):{}),[i,t,e]),[o,c]=Object(Yr.c)({cancelPreviousOn:"resolution",createPromise:async()=>await a.getModuleDefinition(n.http.fetch),onResolve:e=>{s(e)},onReject:()=>{s(void 0)}},[a.getModuleDefinition,e,t]),u=Object(r.useCallback)((e=>{var t,a,r;const n=l[e.id];if(null==n)return!1;const i=null==n?void 0:n.config.custom_settings.job_revision;return(null!==(t=null===(a=e.fullJob)||void 0===a||null===(r=a.custom_settings)||void 0===r?void 0:r.job_revision)&&void 0!==t?t:0)<(null!=i?i:0)}),[l]);return{fetchModuleDefinition:c,fetchModuleDefinitionRequestState:o.state,getIsJobDefinitionOutdated:u,jobDefinitionByJobId:l,moduleDefinition:i}};var Pn=a(456),Dn=a(457),In=a(458),_n=a(459),Bn=a(460),Rn=a(461);const An=async e=>{const t=await e("/api/ml/jobs/deleting_jobs_tasks");return Object(Ha.b)(zn)(t)},Nn=_e.type({jobIds:_e.array(_e.string)}),Vn=_e.record(_e.string,_e.type({deleted:_e.boolean})),zn=_e.type({jobIds:_e.array(_e.string)}),Un=_e.type({datafeedIds:_e.array(_e.string)}),$n=_e.record(_e.string,_e.type({stopped:_e.boolean})),qn=async(e,t,a,r)=>{try{await(async(e,t)=>{const{spaceId:a,sourceId:r,jobTypes:n}=e,i=await t("/api/ml/jobs/stop_datafeeds",{method:"POST",body:JSON.stringify(Un.encode({datafeedIds:n.map((e=>Object(On.b)(a,r,e)))}))});return Object(Ha.b)($n)(i)})({spaceId:e,sourceId:t,jobTypes:a},r)}catch(e){var n;if(404!==(null==e||null===(n=e.res)||void 0===n?void 0:n.status))throw e}return await Hn(e,t,a,r)},Hn=async(e,t,a,r)=>{const n=await(async(e,t)=>{const{spaceId:a,sourceId:r,jobTypes:n}=e,i=await t("/api/ml/jobs/delete_jobs",{method:"POST",body:JSON.stringify(Nn.encode({jobIds:n.map((e=>Object(On.c)(a,r,e)))}))});return Object(Ha.b)(Vn)(i)})({spaceId:e,sourceId:t,jobTypes:a},r);return await Gn(e,t,a,r),n},Gn=async(e,t,a,r)=>{const n=a.map((a=>Object(On.c)(e,t,a)));for(;;){const{jobIds:e}=await An(r);if(!e.some((e=>n.includes(e))))return!0;await Jn(1e3)}},Jn=e=>new Promise((t=>setTimeout(t,e))),Wn=async(e,t)=>{const{spaceId:a,sourceId:r,jobTypes:n}=e,i=await t("/api/ml/jobs/jobs_summary",{method:"POST",body:JSON.stringify(Kn.encode({jobIds:n.map((e=>Object(On.c)(a,r,e)))}))});return Object(Ha.b)(ti)(i)},Kn=_e.type({jobIds:_e.array(_e.string)}),Qn=_e.keyof({started:null,starting:null,stopped:null,stopping:null,"":null}),Xn=_e.keyof({closed:null,closing:null,deleting:null,failed:null,opened:null,opening:null,resetting:null,reverting:null}),Zn=_e.keyof({ok:null,warn:null}),Yn=_e.type({categorization_status:Zn,categorized_doc_count:_e.number,dead_category_count:_e.number,frequent_category_count:_e.number,rare_category_count:_e.number,total_category_count:_e.number}),ei=_e.intersection([_e.type({id:_e.string,jobState:Xn}),_e.partial({awaitingNodeAssignment:_e.boolean,datafeedIndices:_e.array(_e.string),datafeedState:Qn,fullJob:_e.partial({custom_settings:On.f,finished_time:_e.number,model_size_stats:Yn})})]),ti=_e.array(ei),ai=async(e,t)=>{const a=await t(`/api/ml/modules/get_module/${e}`,{method:"GET"});return Object(Ha.b)(ni)(a)},ri=_e.type({id:_e.string,config:_e.type({custom_settings:mn.q})}),ni=_e.type({id:_e.string,jobs:_e.array(ri)}),ii=async(e,t)=>{const{moduleId:a,start:r,end:n,spaceId:i,sourceId:s,indexPattern:l,jobOverrides:o=[],datafeedOverrides:c=[],query:u}=e,d=await t(`/api/ml/modules/setup/${a}`,{method:"POST",body:JSON.stringify(ui.encode({start:r,end:n,indexPatternName:l,prefix:Object(On.d)(i,s),startDatafeed:!0,jobOverrides:o,datafeedOverrides:c,query:u}))});return Object(Ha.b)(gi)(d)},si=_e.partial({start:_e.number,end:_e.number}),li=_e.type({job_id:_e.string,custom_settings:On.f}),oi=_e.object,ci=_e.intersection([_e.strict({indexPatternName:_e.string,prefix:_e.string,startDatafeed:_e.boolean,jobOverrides:_e.array(li),datafeedOverrides:_e.array(oi)}),_e.exact(_e.partial({query:_e.object}))]),ui=_e.intersection([si,ci]),di=_e.type({msg:_e.string}),mi=_e.intersection([_e.type({id:_e.string,started:_e.boolean,success:_e.boolean}),_e.partial({error:di})]),pi=_e.intersection([_e.type({id:_e.string,success:_e.boolean}),_e.partial({error:di})]),gi=_e.type({datafeeds:_e.array(mi),jobs:_e.array(pi)}),fi="metrics_ui_hosts",bi=p.i18n.translate("xpack.infra.ml.metricsModuleName",{defaultMessage:"Metrics anomanly detection"}),hi=p.i18n.translate("xpack.infra.ml.metricsHostModuleDescription",{defaultMessage:"Use Machine Learning to automatically detect anomalous log entry rates."}),yi=(e,t)=>On.g.reduce(((a,r)=>({...a,[r]:Object(On.c)(e,t,r)})),{}),Ei=e=>{switch(e){case"hosts_memory_usage":return{datafeed:Dn,job:Pn};case"hosts_network_in":return{datafeed:_n,job:In};case"hosts_network_out":return{datafeed:Rn,job:Bn}}},vi={moduleId:fi,moduleName:bi,moduleDescription:hi,jobTypes:On.g,bucketSpan:On.a,getJobIds:yi,getJobSummary:async(e,t,a)=>{const r=await Wn({spaceId:e,sourceId:t,jobTypes:On.g},a),n=Object.values(yi(e,t));return r.filter((e=>n.includes(e.id)))},getModuleDefinition:async e=>await ai(fi,e),setUpModule:async(e,t)=>{const{start:a,end:r,filter:n,moduleSourceConfiguration:{spaceId:i,sourceId:s,indices:l},partitionField:o}=e,c=l.join(","),u=["hosts_memory_usage","hosts_network_in","hosts_network_out"],d=u.map((e=>{const{job:t}=Ei(e),a={...t.analysis_config};return o&&(a.detectors[0].partition_field_name=o,-1===a.influencers.indexOf(o)&&a.influencers.push(o)),{job_id:e,data_description:{time_field:C.j},analysis_config:a,custom_settings:{metrics_source_config:{indexPattern:c,timestampField:C.j,bucketSpan:On.a}}}})),m=u.map((e=>{const{datafeed:t}=Ei(e),a={...t};if(n){const e=JSON.parse(n);a.query.bool={...a.query.bool,...e.bool}}if(!o||"hosts_memory_usage"===e)return{...a,job_id:e};const r={[o]:{terms:{field:o},aggregations:{...t.aggregations}}};return{...a,job_id:e,aggregations:r}}));return ii({moduleId:fi,start:a,end:r,spaceId:i,sourceId:s,indexPattern:c,jobOverrides:d,datafeedOverrides:m},t)},cleanUpModule:async(e,t,a)=>await qn(e,t,On.g,a)},[xi,ki]=Ie()((({indexPattern:e,sourceId:t,spaceId:a})=>{const n=Object(r.useMemo)((()=>({indices:e.split(","),sourceId:t,spaceId:a})),[e,t,a]),i=Sn({moduleDescriptor:vi,sourceConfiguration:n}),{getIsJobConfigurationOutdated:s}=Cn({sourceConfiguration:n,moduleDescriptor:vi}),{fetchModuleDefinition:l,getIsJobDefinitionOutdated:o}=Ln({sourceConfiguration:n,moduleDescriptor:vi}),c=Object(r.useMemo)((()=>i.jobSummaries.some(s)),[s,i.jobSummaries]),u=Object(r.useMemo)((()=>i.jobSummaries.some(o)),[o,i.jobSummaries]),d=Object(r.useMemo)((()=>Object.values(i.jobStatus).some((e=>"stopped"===e))),[i.jobStatus]);return{...i,fetchModuleDefinition:l,hasOutdatedJobConfigurations:c,hasOutdatedJobDefinitions:u,hasStoppedJobs:d}}));var Oi=a(462),Mi=a(463),wi=a(464),ji=a(465),Si=a(466),Ci=a(467);const Ti="kubernetes.namespace",Fi="metrics_ui_k8s",Li=p.i18n.translate("xpack.infra.ml.metricsModuleName",{defaultMessage:"Metrics anomanly detection"}),Pi=p.i18n.translate("xpack.infra.ml.metricsHostModuleDescription",{defaultMessage:"Use Machine Learning to automatically detect anomalous log entry rates."}),Di=(e,t)=>On.h.reduce(((a,r)=>({...a,[r]:Object(On.c)(e,t,r)})),{}),Ii=e=>{switch(e){case"k8s_memory_usage":return{datafeed:Mi,job:Oi};case"k8s_network_in":return{datafeed:ji,job:wi};case"k8s_network_out":return{datafeed:Ci,job:Si}}},_i={moduleId:Fi,moduleName:Li,moduleDescription:Pi,jobTypes:On.h,bucketSpan:On.a,getJobIds:Di,getJobSummary:async(e,t,a)=>{const r=await Wn({spaceId:e,sourceId:t,jobTypes:On.h},a),n=Object.values(Di(e,t));return r.filter((e=>n.includes(e.id)))},getModuleDefinition:async e=>await ai(Fi,e),setUpModule:async(e,t)=>{const{start:a,end:r,filter:n,moduleSourceConfiguration:{spaceId:i,sourceId:s,indices:l},partitionField:o}=e,c=l.join(","),u=["k8s_memory_usage","k8s_network_in","k8s_network_out"],d=u.map((e=>{const{job:t}=Ii(e),a={...t.analysis_config};return o&&(a.detectors[0].partition_field_name=o,-1===a.influencers.indexOf(o)&&a.influencers.push(o)),{job_id:e,data_description:{time_field:C.j},analysis_config:a,custom_settings:{metrics_source_config:{indexPattern:c,timestampField:C.j,bucketSpan:On.a}}}})),m=u.map((e=>{const{datafeed:t}=Ii(e),a={...t};if(n){const e=JSON.parse(n);a.query.bool={...a.query.bool,...e.bool}}if(!o||"k8s_memory_usage"===e)return{...a,job_id:e};const r=t.aggregations["kubernetes.namespace"].aggregations,i={[o]:{terms:{field:o,size:25},aggregations:{...r}}};return{...a,job_id:e,aggregations:i}}));return ii({moduleId:Fi,start:a,end:r,spaceId:i,sourceId:s,indexPattern:c,jobOverrides:d,datafeedOverrides:m},t)},cleanUpModule:async(e,t,a)=>await qn(e,t,On.h,a)},[Bi,Ri]=Ie()((({indexPattern:e,sourceId:t,spaceId:a})=>{const n=Object(r.useMemo)((()=>({indices:e.split(","),sourceId:t,spaceId:a})),[e,t,a]),i=Sn({moduleDescriptor:_i,sourceConfiguration:n}),{getIsJobConfigurationOutdated:s}=Cn({sourceConfiguration:n,moduleDescriptor:_i}),{fetchModuleDefinition:l,getIsJobDefinitionOutdated:o}=Ln({sourceConfiguration:n,moduleDescriptor:_i}),c=Object(r.useMemo)((()=>i.jobSummaries.some(s)),[s,i.jobSummaries]),u=Object(r.useMemo)((()=>i.jobSummaries.some(o)),[o,i.jobSummaries]),d=Object(r.useMemo)((()=>Object.values(i.jobStatus).some((e=>"stopped"===e))),[i.jobStatus]);return{...i,fetchModuleDefinition:l,hasOutdatedJobConfigurations:c,hasOutdatedJobDefinitions:u,hasStoppedJobs:d}}));var Ai=a(93);const Ni=e=>{const[t,a]=Object(r.useState)("jobs"),{goToSetup:i,closeFlyout:s}=e,{fetchJobStatus:l,setupStatus:o,jobSummaries:c}=ki(),{fetchJobStatus:u,setupStatus:d,jobSummaries:f}=Ri(),{hasInfraMLCapabilities:h,hasInfraMLReadCapabilities:y,hasInfraMLSetupCapabilities:E}=vn(),v=Object(r.useCallback)((()=>{i("hosts")}),[i]),x=Object(r.useCallback)((()=>{i("kubernetes")}),[i]),k=[...(f||[]).map((e=>e.id)),...(c||[]).map((e=>e.id))];Object(r.useEffect)((()=>{y&&(l(),u())}),[u,l,y]);const O=c.length>0||f.length>0,M=Object(b.useLinkProps)({app:"ml",pathname:"/jobs"});return h?y?"initializing"===o.type||"initializing"===d.type?n.a.createElement(Ai.b,{message:p.i18n.translate("xpack.infra.ml.anomalyFlyout.jobStatusLoadingMessage",{defaultMessage:"Checking status of metrics jobs..."})}):E?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlyoutHeader,null,n.a.createElement(g.EuiTitle,{size:"m"},n.a.createElement("h2",null,n.a.createElement(P.FormattedMessage,{defaultMessage:"Machine Learning anomaly detection",id:"xpack.infra.ml.anomalyFlyout.flyoutHeader"})))),n.a.createElement(g.EuiTabs,null,n.a.createElement(g.EuiTab,{isSelected:"jobs"===t,onClick:()=>a("jobs")},"Jobs"),n.a.createElement(g.EuiTab,{isSelected:"anomalies"===t,onClick:()=>a("anomalies"),"data-test-subj":"anomalyFlyoutAnomaliesTab"},"Anomalies")),n.a.createElement(g.EuiFlyoutBody,{banner:n.a.createElement(n.a.Fragment,null,"jobs"===t&&O&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Vi,{hasHostJobs:c.length>0,hasK8sJobs:f.length>0,jobIds:k})),n.a.createElement(fn.MLJobsAwaitingNodeWarning,{jobIds:k}))},"jobs"===t&&n.a.createElement(n.a.Fragment,null,O&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"s"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,m()({},M,{style:{marginRight:5}}),n.a.createElement(P.FormattedMessage,{defaultMessage:"Manage jobs in ML",id:"xpack.infra.ml.anomalyFlyout.manageJobs"})))),n.a.createElement(g.EuiSpacer,{size:"l"})),n.a.createElement(g.EuiText,null,n.a.createElement("h4",null,"Create ML Jobs"),n.a.createElement("p",null,n.a.createElement(P.FormattedMessage,{defaultMessage:"Anomaly detection is powered by machine learning. Machine learning jobs are available for the following resource types. Enable these jobs to begin detecting anomalies in your infrastructure metrics.",id:"xpack.infra.ml.anomalyFlyout.createJobs"}))),n.a.createElement(g.EuiSpacer,{size:"l"}),n.a.createElement(zi,{hasHostJobs:c.length>0,hasK8sJobs:f.length>0,hasSetupCapabilities:e.hasSetupCapabilities,createHosts:v,createK8s:x})),"anomalies"===t&&n.a.createElement(Ji,{closeFlyout:s}))):n.a.createElement(kn.c,null):n.a.createElement(kn.b,null):n.a.createElement(bn.b,null)},Vi=e=>{let t="";return e.hasHostJobs&&e.hasK8sJobs?t=`${p.i18n.translate("xpack.infra.ml.anomalyFlyout.create.hostTitle",{defaultMessage:"Hosts"})} and ${p.i18n.translate("xpack.infra.ml.anomalyFlyout.create.k8sSuccessTitle",{defaultMessage:"Kubernetes"})}`:e.hasHostJobs?t=p.i18n.translate("xpack.infra.ml.anomalyFlyout.create.hostSuccessTitle",{defaultMessage:"Hosts"}):e.hasK8sJobs&&(t=p.i18n.translate("xpack.infra.ml.anomalyFlyout.create.k8sSuccessTitle",{defaultMessage:"Kubernetes"})),n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiCallOut,{size:"m",color:"success",title:n.a.createElement(P.FormattedMessage,{defaultMessage:"Anomaly detection enabled for {target}",id:"xpack.infra.ml.anomalyFlyout.enabledCallout",values:{target:t}}),iconType:"check"}))},zi=e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"m"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiCard,{isDisabled:!e.hasSetupCapabilities,icon:n.a.createElement(g.EuiIcon,{type:"storage",size:"xl"}),title:n.a.createElement(P.FormattedMessage,{defaultMessage:"Hosts",id:"xpack.infra.ml.anomalyFlyout.create.hostTitle"}),description:n.a.createElement(P.FormattedMessage,{defaultMessage:"Detect anomalies for memory usage and network traffic on hosts.",id:"xpack.infra.ml.anomalyFlyout.create.hostDescription"}),footer:n.a.createElement(n.a.Fragment,null,e.hasHostJobs&&n.a.createElement(g.EuiButtonEmpty,{onClick:e.createHosts},n.a.createElement(P.FormattedMessage,{defaultMessage:"Recreate jobs",id:"xpack.infra.ml.anomalyFlyout.create.recreateButton"})),!e.hasHostJobs&&n.a.createElement(g.EuiButton,{onClick:e.createHosts},n.a.createElement(P.FormattedMessage,{defaultMessage:"Enable",id:"xpack.infra.ml.anomalyFlyout.create.createButton"})))})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiCard,{isDisabled:!e.hasSetupCapabilities,icon:n.a.createElement(g.EuiIcon,{type:"logoKubernetes",size:"xl"}),title:n.a.createElement(P.FormattedMessage,{defaultMessage:"Kubernetes Pods",id:"xpack.infra.ml.anomalyFlyout.create.k8sTitle"}),description:n.a.createElement(P.FormattedMessage,{defaultMessage:"Detect anomalies for memory usage and network traffic on Kubernetes Pods.",id:"xpack.infra.ml.anomalyFlyout.create.k8sDescription"}),footer:n.a.createElement(n.a.Fragment,null,e.hasK8sJobs&&n.a.createElement(g.EuiButtonEmpty,{onClick:e.createK8s},n.a.createElement(P.FormattedMessage,{defaultMessage:"Recreate jobs",id:"xpack.infra.ml.anomalyFlyout.create.recreateButton"})),!e.hasK8sJobs&&n.a.createElement(g.EuiButton,{onClick:e.createK8s},n.a.createElement(P.FormattedMessage,{defaultMessage:"Enable",id:"xpack.infra.ml.anomalyFlyout.create.createButton"})))})))),Ui=(e,t="absolute")=>{let a="";return a+=`(ml:(jobIds:!(${e.map((e=>`'${e}'`)).join(",")}))`,a+=`,refreshInterval:(display:Off,pause:!f,value:0),time:(from:'${N()().subtract(4,"weeks").toISOString()}'`,a+=`,to:'${N()().toISOString()}'`,"invalid"===t&&(a+=",mode:invalid"),a+="))&_a=(query:(query_string:(analyze_wildcard:!t,query:'*')))",a},$i={...da.b,filterQuery:Tt,time:ht.currentTime,autoReload:ht.isAutoReloading},qi=()=>{const{metric:e,groupBy:t,nodeType:a,view:n,customOptions:i,customMetrics:s,boundsOverride:l,autoBounds:o,accountId:c,region:u,legend:d,sort:m,timelineOpen:p,setWaffleOptionsState:g}=Object(da.d)(),{currentTime:f,isAutoReloading:b,setWaffleTimeState:h}=Ot(),{filterQuery:y,setWaffleFiltersState:E}=_t(),v={metric:e,sort:m,groupBy:t,nodeType:a,view:n,customOptions:i,customMetrics:s,boundsOverride:l,autoBounds:o,accountId:c,region:u,time:f,autoReload:b,filterQuery:y,legend:d,timelineOpen:p},x=Object(r.useCallback)((e=>{g({sort:e.sort,metric:e.metric,groupBy:e.groupBy,nodeType:e.nodeType,view:e.view,customOptions:e.customOptions,customMetrics:e.customMetrics,boundsOverride:e.boundsOverride,autoBounds:e.autoBounds,accountId:e.accountId,region:e.region,legend:e.legend,timelineOpen:e.timelineOpen}),e.time&&h({currentTime:e.time,isAutoReloading:e.autoReload}),E(e.filterQuery)}),[g,h,E]);return{viewState:v,defaultViewState:$i,onViewChange:x}},Hi=({jobId:e,type:t,startTime:a,closeFlyout:i,influencerField:s,influencers:l,disableShowInInventory:o})=>{const[c,u]=Object(r.useState)(!1),d=Object(r.useCallback)((()=>u(!1)),[u]),f=Object(r.useCallback)((()=>u(!c)),[c]),{onViewChange:h}=qi(),y=Object(r.useCallback)((()=>{const r=e.split("-"),n={metric:{type:{memory_usage:"memory",network_in:"rx",network_out:"tx"}[r[r.length-1].replace(/hosts_|k8s_/,"")]},sort:{by:"name",direction:"desc"},groupBy:[],nodeType:"metrics_k8s"===t?"pod":"host",view:"map",customOptions:[],customMetrics:[],boundsOverride:{max:1,min:0},autoBounds:!0,accountId:"",region:"",autoReload:!1,filterQuery:{expression:l.reduce(((e,t)=>(e&&(e=`${e} or `),`${e} ${s}: "${t}"`)),""),kind:"kuery"},legend:{palette:"cool",reverseColors:!1,steps:10},time:a};h(n),i()}),[e,h,a,t,l,s,i]),E=Object(b.useLinkProps)({app:"ml",pathname:`/explorer?_g=${Ui([e.toString()])}`}),v=[n.a.createElement(g.EuiContextMenuItem,m()({key:"openInAnomalyExplorer",icon:"popout"},E),n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.actions.openInAnomalyExplorer",defaultMessage:"Open in Anomaly Explorer"}))];return o||v.push(n.a.createElement(g.EuiContextMenuItem,{key:"showInInventory",icon:"search",onClick:y},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.actions.showInInventory",defaultMessage:"Show in Inventory"}))),n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiPopover,{anchorPosition:"downRight",panelPaddingSize:"none",button:n.a.createElement(g.EuiButtonIcon,{iconType:"boxesHorizontal",onClick:f,"aria-label":p.i18n.translate("xpack.infra.ml.anomalyFlyout.actions.openActionMenu",{defaultMessage:"Open"})}),isOpen:c,closePopover:d},n.a.createElement(g.EuiContextMenuPanel,{items:v})))},Gi=Object(B.withTheme)((({theme:e})=>n.a.createElement(g.EuiText,null,n.a.createElement(g.EuiSpacer,{size:"xl"}),n.a.createElement("p",null,n.a.createElement(g.EuiIcon,{type:"eyeClosed",size:"xl",color:e.eui.euiColorMediumShade})),n.a.createElement("h3",{"data-test-subj":"noAnomaliesFoundMsg"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.anomalyTable.noAnomaliesFound",defaultMessage:"No anomalies found"})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.anomalyTable.noAnomaliesSuggestion",defaultMessage:"Try modifying your search or selected time range."}))))),Ji=e=>{const{closeFlyout:t,hostName:a}=e,[i,s]=Object(r.useState)(""),[l,o]=Object(r.useState)("now-30d"),[c,u]=Object(r.useState)("now"),d=Object(b.useUiTracker)({app:"infra_metrics"}),[m,f]=Object(r.useState)({start:Object(Br.b)(l)||0,end:Object(Br.b)(c,"up")||0}),{sorting:h,setSorting:y}=function(e){const[t,a]=Object(r.useState)({field:"startTime",direction:"desc"});return{sorting:t,setSorting:a}}(),E=[{id:"hosts",label:p.i18n.translate("xpack.infra.ml.anomalyFlyout.hostBtn",{defaultMessage:"Hosts"}),"data-test-subj":"anomaliesHostComboBoxItem"},{id:"k8s",label:p.i18n.translate("xpack.infra.ml.anomalyFlyout.podsBtn",{defaultMessage:"Kubernetes Pods"}),"data-test-subj":"anomaliesK8sComboBoxItem"}],[v,x]=Object(r.useState)("hosts"),[k,O]=Object(r.useState)([E.find((e=>"hosts"===e.id))||E[0]]),{source:M}=Object(w.b)(),j=null==M?void 0:M.configuration.anomalyThreshold,S=Object(r.useCallback)((({isInvalid:e,start:t,end:a})=>{e||(o(t),u(a),f({start:Object(Br.b)(t),end:Object(Br.b)(a,"up")}))}),[]),C=Object(r.useMemo)((()=>({sourceId:"default",anomalyThreshold:j||0,startTime:m.start,endTime:m.end,defaultSortOptions:{direction:(null==h?void 0:h.direction)||"desc",field:(null==h?void 0:h.field)||"startTime"},defaultPaginationOptions:{pageSize:10}})),[m.start,m.end,null==h?void 0:h.field,null==h?void 0:h.direction,j]),{metricsHostsAnomalies:T,getMetricsHostsAnomalies:F,page:L,changeSortOptions:D,fetchNextPage:I,fetchPreviousPage:_,isLoadingMetricsHostsAnomalies:B}=ln(C),{metricsK8sAnomalies:R,getMetricsK8sAnomalies:A,page:N,changeSortOptions:V,fetchNextPage:z,fetchPreviousPage:U,isLoadingMetricsK8sAnomalies:$}=an(C),q=Object(r.useMemo)((()=>"hosts"===v?L:N),[v,L,N]),H=Object(r.useMemo)((()=>"hosts"===v?B:$),[v,B,$]),G=Object(r.useMemo)((()=>"hosts"===v?I:z),[v,I,z]),J=Object(r.useMemo)((()=>"hosts"===v?_:U),[v,_,U]),W=Object(r.useMemo)((()=>"hosts"===v?F:"k8s"===v?A:void 0),[v,A,F]),K=Object(r.useMemo)((()=>"hosts"===v?T:R),[v,T,R]),Q=Object(r.useCallback)((e=>{s(e.target.value)}),[]),X=Object(r.useCallback)((e=>{O(e),x(e[0].id)}),[]),Z=Object(r.useCallback)((e=>{"hosts"===v?D(e):V(e)}),[D,V,v]);Object(r.useEffect)((()=>{K&&K.forEach((e=>{e.influencers.length>100&&d({metric:"metrics_ml_anomaly_detection_more_than_100_influencers"})}))}),[K,d]);let Y=[{field:"startTime",name:p.i18n.translate("xpack.infra.ml.anomalyFlyout.columnTime",{defaultMessage:"Time"}),width:"15%",sortable:!0,textOnly:!0,truncateText:!0,render:e=>n.a.createElement(P.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})},{field:"jobId",name:p.i18n.translate("xpack.infra.ml.anomalyFlyout.columnJob",{defaultMessage:"Job"}),width:"25%",render:e=>e,"data-test-subj":"anomalyRow"},{field:"anomalyScore",name:p.i18n.translate("xpack.infra.ml.anomalyFlyout.columnSeverit",{defaultMessage:"Severity"}),width:"15%",sortable:!0,render:e=>n.a.createElement(gn.a,{anomalyScore:e})},{field:"typical",name:p.i18n.translate("xpack.infra.ml.anomalyFlyout.columnSummary",{defaultMessage:"Summary"}),width:"15%",textOnly:!0,render:(e,t)=>n.a.createElement(pn,{anomaly:t})},{field:"influencers",name:p.i18n.translate("xpack.infra.ml.anomalyFlyout.columnInfluencerName",{defaultMessage:"Node name"}),width:"20%",textOnly:!0,truncateText:!0,render:e=>e.join(",")},{name:p.i18n.translate("xpack.infra.ml.anomalyFlyout.columnActionsName",{defaultMessage:"Actions"}),width:"10%",actions:[{render:e=>n.a.createElement(Hi,{jobId:e.jobId,type:e.type,influencerField:"metrics_hosts"===e.type?"host.name":"kubernetes.pod.uid",disableShowInInventory:e.influencers.length>100,influencers:e.influencers,startTime:e.startTime,closeFlyout:t})}]}];return Y=a?Y.filter((e=>!("field"in e)||"influencers"!==e.field)):Y,Object(r.useEffect)((()=>{W&&W(void 0,i,a)}),[W,i,a]),n.a.createElement("div",null,n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(g.EuiFlexItem,{grow:1},n.a.createElement(g.EuiSuperDatePicker,{start:l,end:c,showUpdateButton:!1,onTimeChange:S}))),!a&&n.a.createElement(g.EuiFlexGroup,{alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:3},n.a.createElement(g.EuiFieldSearch,{fullWidth:!0,placeholder:p.i18n.translate("xpack.infra.ml.anomalyFlyout.searchPlaceholder",{defaultMessage:"Search"}),value:i,onChange:Q,isClearable:!0})),n.a.createElement(g.EuiFlexItem,{grow:1},n.a.createElement(g.EuiComboBox,{placeholder:p.i18n.translate("xpack.infra.ml.anomalyFlyout.jobTypeSelect",{defaultMessage:"Select group"}),singleSelection:{asPlainText:!0},options:E,selectedOptions:k,onChange:X,isClearable:!1,"data-test-subj":"anomaliesComboBoxType"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiBasicTable,{columns:Y,items:K,sorting:{sort:h},onChange:e=>{var t,a;y(e.sort),Z({field:(null==e||null===(t=e.sort)||void 0===t?void 0:t.field)||"startTime",direction:(null==e||null===(a=e.sort)||void 0===a?void 0:a.direction)||"desc"})},hasActions:!0,loading:H,noItemsMessage:H?n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.anomalyFlyout.anomalyTable.loading",defaultMessage:"Loading anomalies"}):n.a.createElement(Gi,null)}),n.a.createElement(g.EuiSpacer,{size:"l"}),n.a.createElement(dn,{fetchNextPage:G,fetchPreviousPage:J,page:q,isLoading:H}))},Wi={id:"anomalies",name:p.i18n.translate("xpack.infra.nodeDetails.tabs.anomalies",{defaultMessage:"Anomalies"}),content:e=>{const{node:t,onClose:a}=e;return n.a.createElement(ba,null,n.a.createElement(Ji,{closeFlyout:a,hostName:t.name}))}},Ki={id:"osquery",name:p.i18n.translate("xpack.infra.nodeDetails.tabs.osquery",{defaultMessage:"Osquery"}),content:e=>{const t=e.node.id,a=e.nodeType,i=Object(ia.b)(a),{sourceId:s}=Object(w.b)(),{currentTimeRange:l}=Ot(),{loading:o,metadata:c}=Cr(t,a,i.requiredMetrics,s,l),{services:{osquery:u}}=Object(tt.b)(),d=null==u?void 0:u.OsqueryAction;return Object(r.useMemo)((()=>{var e,t;return o||!d?n.a.createElement(ba,null,n.a.createElement(g.EuiLoadingContent,{lines:10})):n.a.createElement(ba,null,n.a.createElement(d,{agentId:null==c||null===(e=c.info)||void 0===e||null===(t=e.agent)||void 0===t?void 0:t.id,hideAgentsField:!0}))}),[d,o,c])}},Qi=(e,t,a)=>e.get(b.uptimeOverviewLocatorID).navigate({[t]:a.id,ip:a.ip}),Xi=({isOpen:e,node:t,nodeType:a,currentTime:i,options:s,onClose:l,openAlertFlyout:o})=>{const c=[Ra,Ua,Mr,_r,Wi,Ki],u=Object(ia.b)(a),d=i-1e3*u.metrics.defaultTimeRangeInSeconds,{application:p,share:h}=Object(f.useKibana)().services,y=null==p?void 0:p.capabilities,E=Object(r.useMemo)((()=>{var e;return Boolean(null==y||null===(e=y.infrastructure)||void 0===e?void 0:e.save)}),[y]),v=Object(r.useMemo)((()=>c.map((e=>{const r=e.content;return{...e,content:n.a.createElement(r,{onClose:l,node:t,nodeType:a,currentTime:i,options:s})}}))),[c,t,a,i,l,s]),[x,k]=Object(r.useState)(0),O=Object(b.useLinkProps)({...Object(za.a)({nodeType:a,nodeId:t.id,from:d,to:i})}),M="host"===a?"host.hostname":u.fields.id,w=Object(b.useLinkProps)({app:"apm",hash:"traces",search:{kuery:`${M}:"${t.id}"`}});return e?n.a.createElement(g.EuiPortal,null,n.a.createElement(g.EuiOutsideClickDetector,{onOutsideClick:l},n.a.createElement(Yi,null,n.a.createElement(Zi,null,n.a.createElement(g.EuiFlexGroup,{responsive:!1,gutterSize:"m"},n.a.createElement(es,{grow:!0},n.a.createElement(g.EuiTitle,{size:"xs"},n.a.createElement("h4",null,t.name))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexGroup,{gutterSize:"m",responsive:!1},E&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:o,size:"xs",iconSide:"left",flush:"both",iconType:"bell"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.infra.nodeDetails.createAlertLink",defaultMessage:"Create inventory rule"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,m()({size:"xs",iconSide:"left",iconType:"popout",flush:"both"},O),n.a.createElement(P.FormattedMessage,{id:"xpack.infra.infra.nodeDetails.openAsPage",defaultMessage:"Open as page"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonIcon,{size:"s",onClick:l,iconType:"cross"}))))),n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiTabs,{size:"s"},v.map(((e,t)=>n.a.createElement(g.EuiTab,{key:e.id,isSelected:t===x,onClick:()=>k(t)},e.name))),n.a.createElement(g.EuiTab,w,n.a.createElement(g.EuiIcon,{type:"popout"})," ",n.a.createElement(P.FormattedMessage,{id:"xpack.infra.infra.nodeDetails.apmTabLabel",defaultMessage:"APM"})),n.a.createElement(g.EuiTab,{onClick:()=>Qi(h.url.locators,a,t)},n.a.createElement(g.EuiIcon,{type:"popout"})," ",n.a.createElement(P.FormattedMessage,{id:"xpack.infra.infra.nodeDetails.updtimeTabLabel",defaultMessage:"Uptime"})))),v[x].content))):null},Zi=B.euiStyled.div`
  padding-top: ${e=>e.theme.eui.euiSizeM};
  padding-right: ${e=>e.theme.eui.euiSizeM};
  padding-left: ${e=>e.theme.eui.euiSizeM};
  background-color: ${e=>e.theme.eui.euiPageBackgroundColor};
  box-shadow: inset 0 -1px ${e=>e.theme.eui.euiBorderColor};
`,Yi=Object(B.euiStyled)(g.EuiPanel).attrs({paddingSize:"none"})`
  display: flex;
  flex-direction: column;
  position: absolute;
  right: 16px;
  top: ${266}px;
  width: 100%;
  max-width: 720px;
  z-index: 2;
  max-height: calc(100vh - ${282}px);
  overflow: hidden;

  @media (max-width: 752px) {
    border-radius: 0px !important;
    left: 0px;
    right: 0px;
    top: 97px;
    bottom: 0;
    max-height: calc(100vh - 97px);
    max-width: 100%;
  }
`,es=Object(B.euiStyled)(g.EuiFlexItem)`
  overflow: hidden;
  & h4 {
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
  }
`,ts=({options:e,nodeType:t,filter:a,visible:i,setVisible:s})=>{const{triggersActionsUI:l}=Object(r.useContext)(G.a),{inventoryPrefill:o}=Object(W.b)(),{customMetrics:c}=o,u=Object(r.useCallback)((()=>s(!1)),[s]),d=Object(r.useMemo)((()=>l&&l.getAddAlertFlyout({consumer:"infrastructure",onClose:u,canChangeTrigger:!1,ruleTypeId:J.d,metadata:{options:e,nodeType:t,filter:a,customMetrics:c}})),[l,i]);return n.a.createElement(n.a.Fragment,null,i&&d)},as=({onClose:e})=>{const{inventoryPrefill:t}=Object(W.b)(),{nodeType:a,metric:r,filterQuery:i}=t;return n.a.createElement(ts,{options:{metric:r},nodeType:a,filter:i,visible:!0,setVisible:e})},rs=Object(B.withTheme)((({options:e,currentTime:t,node:a,nodeType:i})=>{var s,l;const[o,c]=Object(r.useState)(!1),u=Object(ia.b)(i),d=t-1e3*u.metrics.defaultTimeRangeInSeconds,{application:h,share:y}=Object(f.useKibana)().services,E=null==h?void 0:h.capabilities,v="host"===i?"host.hostname":u.fields.id,x=u.crosslinkSupport.details,k=u.crosslinkSupport.logs&&a.id&&(null==E||null===(s=E.logs)||void 0===s?void 0:s.show),O=u.crosslinkSupport.apm&&(null==E?void 0:E.apm)&&(null==E?void 0:E.apm.show),M=u.crosslinkSupport.uptime&&(["pod","container"].includes(i)||a.ip),w=null==E||null===(l=E.infrastructure)||void 0===l?void 0:l.save,j=Object(r.useMemo)((()=>{if("host"!==i){const{id:e}=Object(ia.a)(i);return{label:n.a.createElement(g.EuiCode,null,e),value:a.id}}return a.ip?{label:n.a.createElement(g.EuiCode,null,"host.ip"),value:a.ip}:{label:"",value:""}}),[i,a.ip,a.id]),S=Object(b.useLinkProps)(Object(za.b)({nodeType:i,nodeId:a.id,time:t})),C=Object(b.useLinkProps)({...Object(za.a)({nodeType:i,nodeId:a.id,from:d,to:t})}),T=Object(b.useLinkProps)({app:"apm",hash:"traces",search:{kuery:`${v}:"${a.id}"`}}),F={label:p.i18n.translate("xpack.infra.nodeContextMenu.viewLogsName",{defaultMessage:"{inventoryName} logs",values:{inventoryName:u.singularDisplayName}}),...S,"data-test-subj":"viewLogsContextMenuItem",isDisabled:!k},L={label:p.i18n.translate("xpack.infra.nodeContextMenu.viewMetricsName",{defaultMessage:"{inventoryName} metrics",values:{inventoryName:u.singularDisplayName}}),...C,isDisabled:!x},D={label:p.i18n.translate("xpack.infra.nodeContextMenu.viewAPMTraces",{defaultMessage:"{inventoryName} APM traces",values:{inventoryName:u.singularDisplayName}}),...T,"data-test-subj":"viewApmTracesContextMenuItem",isDisabled:!O},I={label:p.i18n.translate("xpack.infra.nodeContextMenu.viewUptimeLink",{defaultMessage:"{inventoryName} in Uptime",values:{inventoryName:u.singularDisplayName}}),onClick:()=>Qi(y.url.locators,i,a),isDisabled:!M},_={label:p.i18n.translate("xpack.infra.nodeContextMenu.createRuleLink",{defaultMessage:"Create inventory rule"}),onClick:()=>{c(!0)},isDisabled:!w};return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{style:{maxWidth:300},"data-test-subj":"nodeContextMenu"},n.a.createElement(b.Section,null,n.a.createElement(b.SectionTitle,null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.nodeContextMenu.title",defaultMessage:"{inventoryName} details",values:{inventoryName:u.singularDisplayName}})),j.label&&n.a.createElement(b.SectionSubtitle,null,n.a.createElement("div",{style:{wordBreak:"break-all"}},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.nodeContextMenu.description",defaultMessage:"View details for {label} {value}",values:{label:j.label,value:j.value}}))),n.a.createElement(b.SectionLinks,null,n.a.createElement(b.SectionLink,m()({"data-test-subj":"viewLogsContextMenuItem"},F)),n.a.createElement(b.SectionLink,L),n.a.createElement(b.SectionLink,m()({"data-test-subj":"viewApmTracesContextMenuItem"},D)),n.a.createElement(b.SectionLink,m()({},I,{color:"primary"}))),n.a.createElement(b.ActionMenuDivider,null),n.a.createElement(b.SectionLinks,null,n.a.createElement(b.SectionLink,m()({iconType:"bell",color:"primary"},_))))),o&&n.a.createElement(ts,{filter:`${Object(ia.a)(i).id}: "${a.id}"`,options:e,nodeType:i,setVisible:c,visible:o}))})),ns={isPopoverOpen:!1,isOverlayOpen:!1,isAlertFlyoutVisible:!1,isToolTipOpen:!1};class node_Node extends n.a.PureComponent{constructor(...e){super(...e),Zt()(this,"state",ns),Zt()(this,"openAlertFlyout",(()=>{this.setState({isOverlayOpen:!1,isAlertFlyoutVisible:!0})})),Zt()(this,"setAlertFlyoutVisible",(e=>{this.setState({isAlertFlyoutVisible:e})})),Zt()(this,"togglePopover",(()=>{const{nodeType:e}=this.props;"host"===e?this.toggleNewOverlay():this.setState((e=>({isPopoverOpen:!e.isPopoverOpen})))})),Zt()(this,"toggleNewOverlay",(()=>{this.setState((e=>({isPopoverOpen:1!=!e.isOverlayOpen&&e.isPopoverOpen,isOverlayOpen:!e.isOverlayOpen})))})),Zt()(this,"closePopover",(()=>{this.state.isPopoverOpen&&this.setState({isPopoverOpen:!1})})),Zt()(this,"showToolTip",(()=>{this.setState({isToolTipOpen:!0})})),Zt()(this,"hideToolTip",(()=>{this.setState({isToolTipOpen:!1})}))}render(){const{nodeType:e,node:t,options:a,squareSize:r,bounds:i,formatter:s,currentTime:l}=this.props,{isPopoverOpen:o,isAlertFlyoutVisible:c,isToolTipOpen:u}=this.state,d=Object(R.first)(t.metrics),m=r>70,f=r>30,b=d&&d.value||0,h=((e,t,a,r="rgba(217, 217, 217, 1)")=>{try{return ae.f.is(e)?ga(((e,t,a="rgba(217, 217, 217, 1)")=>e.reduce(((e,a)=>(0,pa[a.operator])(t,a.value)?a.color:e),a))(e.rules,t,r)):ae.a.is(e)?ga(((e,t,a,r="rgba(0, 179, 164, 1)")=>{if(0===e.length)return r;if(1===e.length)return Object(R.last)(e).color;const{min:n,max:i}=a,s=Object(R.sortBy)(e,"value"),l=fa(n,i,Number(t)),o=s.reduce(((e,t)=>t.value<=l?t:e),Object(R.first)(s)),c=s.filter((e=>e!==o)).find((e=>e.value>=l));if(!c)return o.color;const u=fa(o.value,c.value,l);return Object(ra.mix)(u,c.color,o.color)})(e.rules,t,a,r)):ae.g.is(e)?ga(((e,t,a,r="rgba(217, 217, 217, 1)")=>{var n,i;const s=fa(a.min,a.max,Number(t)),l=e.length,o=Object(R.last)(e);return o&&Object(R.gte)(s,o.value)?o.color:e.reduce(((e,t)=>{const a=t.value-1/l,r=t.value;return Object(R.gte)(s,a)&&Object(R.lte)(s,r)?t.color:e}),null!==(n=null===(i=Object(R.first)(e))||void 0===i?void 0:i.color)&&void 0!==n?n:r)})(e.rules,t,a,r)):r}catch(e){return r}})(a.legend,b,i),y=s(b),E=p.i18n.translate("xpack.infra.node.ariaLabel",{defaultMessage:"{nodeName}, click to open menu",values:{nodeName:t.name}}),v=this.state.isOverlayOpen?{border:"solid 4px #000"}:void 0,x=n.a.createElement(is,{"data-test-subj":"nodeContainer",style:{width:r||0,height:r||0},onClick:this.togglePopover,onMouseOver:this.showToolTip,onMouseLeave:this.hideToolTip,className:"buttonContainer"},n.a.createElement(ls,{color:h,style:v},n.a.createElement(os,{color:h},m?n.a.createElement(cs,{"aria-label":E},n.a.createElement(ms,{"data-test-subj":"nodeName",color:h},t.name),n.a.createElement(ds,{"data-test-subj":"nodeValue",color:h},y)):f&&n.a.createElement(cs,{"aria-label":E},n.a.createElement(ms,{color:h},"..."))))),k=n.a.createElement(ss,{"data-test-subj":"nodeContainer",style:{width:r||0,height:r||0,...v},onClick:this.togglePopover,onMouseOver:this.showToolTip,onMouseLeave:this.hideToolTip,color:h}),O=m||f?x:k;return n.a.createElement(n.a.Fragment,null,o?n.a.createElement(g.EuiPopover,{button:O,isOpen:o,closePopover:this.closePopover,anchorPosition:"downCenter",style:{height:r}},n.a.createElement(rs,{node:t,nodeType:e,options:a,currentTime:l})):u?n.a.createElement(g.EuiToolTip,{delay:"regular",position:"right",content:n.a.createElement(ma,{currentTime:l,node:t,nodeType:e})},O):O,this.state.isOverlayOpen&&n.a.createElement(Xi,{openAlertFlyout:this.openAlertFlyout,node:t,nodeType:e,isOpen:this.state.isOverlayOpen,options:a,currentTime:l,onClose:this.toggleNewOverlay}),c&&n.a.createElement(ts,{filter:`${Object(ia.a)(e).id}: "${t.id}"`,options:a,nodeType:e,setVisible:this.setAlertFlyoutVisible,visible:c}))}}const is=B.euiStyled.div`
  position: relative;
  cursor: pointer;
`,ss=B.euiStyled.div`
  cursor: pointer;
  position: relative;
  background-color: ${e=>Object(ra.darken)(.1,e.color)};
  border-radius: 3px;
  margin: 2px;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
`,ls=B.euiStyled.div`
  position: absolute;
  top: 4px;
  left: 4px;
  bottom: 4px;
  right: 4px;
  background-color: ${e=>Object(ra.darken)(.1,e.color)};
  border-radius: 3px;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
`,os=B.euiStyled.div`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 2px;
  left: 0;
  border-radius: 3px;
  background-color: ${e=>e.color};
`,cs=B.euiStyled.button`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  line-height: 1.2em;
  align-items: center;
  align-content: center;
  padding: 1em;
  overflow: hidden;
  flex-wrap: wrap;
  width: 100%;
  border: none;
  &:focus {
    outline: none !important;
    border: ${e=>{var t;return null===(t=e.theme)||void 0===t?void 0:t.eui.euiFocusRingSize}} solid
      ${e=>{var t;return null===(t=e.theme)||void 0===t?void 0:t.eui.euiFocusRingColor}};
    box-shadow: none;
  }
`,us=B.euiStyled.div`
  text-align: center;
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 1 0 auto;
  color: ${e=>Object(ra.readableColor)(e.color)};
`,ds=Object(B.euiStyled)(us)`
  font-weight: bold;
  font-size: 0.9em;
  line-height: 1.2em;
`,ms=Object(B.euiStyled)(us)`
  font-size: 0.7em;
  margin-bottom: 0.7em;
`,ps=(e,t)=>{const{bounds:a,group:r,...n}=e,{bounds:i,group:s,...l}=t,{nodes:o,...c}=e.group,{nodes:u,...d}=t.group;return Object(R.isEqual)(n,l)&&Object(R.isEqual)(c,d)},gs=n.a.memo((({group:e,options:t,formatter:a,onDrilldown:r,isChild:i=!1,bounds:s,nodeType:l,currentTime:o})=>{const c=e.width>200?e.width:200;return n.a.createElement(fs,{style:{width:c}},n.a.createElement(group_name_GroupName,{group:e,onDrilldown:r,isChild:i,options:t}),n.a.createElement(bs,null,e.width?e.nodes.map((r=>n.a.createElement(node_Node,{key:`${r.pathId}:${r.name}`,options:t,squareSize:e.squareSize,node:r,formatter:a,bounds:s,nodeType:l,currentTime:o}))):n.a.createElement(g.EuiLoadingSpinner,{size:"xl"})))}),ps),fs=B.euiStyled.div`
  margin: 0 10px;
`,bs=B.euiStyled.div`
  display: flex;
  background-color: rgba(0, 0, 0, 0.05);
  flex-wrap: wrap;
  justify-content: center;
  padding: 20px 10px 10px;
  border-radius: 4px;
  border: 1px solid ${e=>e.theme.eui.euiBorderColor};
  box-shadow: 0 1px 7px rgba(0, 0, 0, 0.1);
`,hs=e=>n.a.createElement(ys,null,n.a.createElement(group_name_GroupName,{group:e.group,onDrilldown:e.onDrilldown,options:e.options}),n.a.createElement(Es,null,e.group.groups.map((t=>n.a.createElement(gs,{isChild:!0,key:t.id,onDrilldown:e.onDrilldown,options:e.options,group:t,formatter:e.formatter,bounds:e.bounds,nodeType:e.nodeType,currentTime:e.currentTime}))))),ys=B.euiStyled.div`
  margin: 0 10px;
  width: 100%;
`,Es=B.euiStyled.div`
  display: flex;
  background-color: rgba(0, 0, 0, 0.05);
  flex-wrap: wrap;
  justify-content: center;
  padding: 20px 10px 10px;
  border-radius: 4px;
  border: 1px solid ${e=>e.theme.eui.euiBorderColor};
  box-shadow: 0 1px 7px rgba(0, 0, 0, 0.1);
`;function vs(e,t=1,a=1){const r=t/a,n=r>1.2?1.2:r,i=Math.ceil(Math.sqrt(e));return Math.ceil(i*n)}function xs(e){return e?e.reduce(((e,t)=>Gt(t)?t.groups.reduce(((e,t)=>t.nodes.length+e),e):Ht(t)?t.nodes.length+e:e),0):0}const ks=e=>xs([e]);const Os={name:e=>Object(R.last)(e.path),value:e=>{const t=Object(R.first)(e.metrics);return t&&t.value||0}},Ms=({nodes:e,options:t,currentTime:a,onFilter:r,formatter:i,bounds:s,nodeType:l,dataBounds:o,bottomMargin:c,staticHeight:u})=>{const d=((e,t)=>{const a=Os[e.by],r=Object(R.sortBy)(t,a);return"desc"===e.direction?r.reverse():r})(t.sort,e),m=function(e){return e.reduce(((e,t)=>{const a=Kt(t);if(2===t.path.length){const r=Wt(e,t.path.slice(0,t.path.length-1));return r.nodes.push(a),e.filter(Qt(r)).concat([r])}if(3===t.path.length){const r=Wt(e,t.path.slice(0,t.path.length-1));r.nodes.push(a);const n=function(e,t){const a=0===t.length?"__all__":Jt(t),r=Object(R.last)(t),n=e.find((e=>e.id===a));return Gt(n)?n:{id:a,name:"__all__"===a?p.i18n.translate("xpack.infra.nodesToWaffleMap.groupsWithGroups.allName",{defaultMessage:"All"}):r&&r.label||"Unknown Group",count:0,width:0,squareSize:0,groups:[]}}(e,t.path.slice(0,t.path.length-2));return n.groups=n.groups.filter(Qt(r)).concat([r]),e.filter(Qt(n)).concat([n])}const r=Wt(e,[]);return r.nodes.push(a),e.filter(Qt(r)).concat([r])}),[])}(d);return n.a.createElement(qt.a,{bounds:!0},(({measureRef:e,bounds:{width:o=0,height:d=0}})=>{const p=function(e,t,a){if(0===e.length)return[];const r=Gt(Object(R.first)(e))?2:1,n=xs(e),i=Math.round(function(e,t,a,r=1){const n=.55/(r>1?.7*r:1),i=e*n,s=t*n,l=Math.ceil(Math.sqrt(a*i/s));let o,c;o=Math.floor(l*s/i)*l<a?s/Math.ceil(l*s/i):i/l;const u=Math.ceil(Math.sqrt(a*s/i));c=Math.floor(u*i/s)*u<a?i/Math.ceil(i*u/s):s/u;const d=Math.max(o,c);return Math.min(Math.max(d,24),1/0)}(t,a,n,r)),s=function(e){return e?e.reduce(((e,t)=>Gt(t)?t.groups.reduce(((e,t)=>Ht(t)?e>t.nodes.length?e:t.nodes.length:e),e):Ht(t)?e>t.nodes.length?e:t.nodes.length:e),0):0}(e);return Object(R.sortBy)(e,ks).reverse().map((e=>{if(Gt(e)){const r=vs(s,t,a),n=e.groups,l=Object(R.sortBy)(n,ks).reverse().filter(Ht).map((e=>({...e,count:e.nodes.length,columns:r,width:r*i,squareSize:i})));return{...e,groups:l,count:xs([e]),squareSize:i}}if(Ht(e)){const r=vs(Math.max(e.nodes.length,s),t,a);return{...e,count:e.nodes.length,squareSize:i,width:r*i}}return e}))}(m,o,d);return n.a.createElement(ws,{ref:t=>e(t),bottomMargin:c,"data-test-subj":"waffleMap",staticHeight:u},n.a.createElement(js,null,p.map((e=>Gt(e)?n.a.createElement(hs,{onDrilldown:r,key:e.id,options:t,group:e,formatter:i,bounds:s,nodeType:l,currentTime:a}):Ht(e)?n.a.createElement(gs,{key:e.id,options:t,group:e,onDrilldown:r,formatter:i,isChild:!1,bounds:s,nodeType:l,currentTime:a}):void 0))))}))},ws=B.euiStyled.div`
  flex: 1 0 0%;
  display: flex;
  justify-content: flex-start;
  flex-direction: column;
  overflow-x: hidden;
  overflow-y: auto;
  margin-bottom: ${e=>e.bottomMargin}px;
  max-width: calc(100vw - 90px);
  ${e=>e.staticHeight&&"min-height: 300px;"}
`,js=B.euiStyled.div`
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: center;
  align-content: flex-start;
  padding: 10px;
`,Ss=p.i18n.translate("xpack.infra.groupByDisplayNames.availabilityZone",{defaultMessage:"Availability zone"}),Cs=p.i18n.translate("xpack.infra.groupByDisplayNames.machineType",{defaultMessage:"Machine type"}),Ts=e=>({"kubernetes.namespace":p.i18n.translate("xpack.infra.groupByDisplayNames.kubernetesNamespace",{defaultMessage:"Namespace"}),"kubernetes.node.name":p.i18n.translate("xpack.infra.groupByDisplayNames.kubernetesNodeName",{defaultMessage:"Node"}),"host.name":p.i18n.translate("xpack.infra.groupByDisplayNames.hostName",{defaultMessage:"Host"}),"cloud.availability_zone":Ss,"cloud.machine.type":Cs,"cloud.project.id":p.i18n.translate("xpack.infra.groupByDisplayNames.projectID",{defaultMessage:"Project ID"}),"cloud.provider":p.i18n.translate("xpack.infra.groupByDisplayNames.provider",{defaultMessage:"Cloud provider"}),"service.type":p.i18n.translate("xpack.infra.groupByDisplayNames.serviceType",{defaultMessage:"Service type"}),"aws.cloud.availability_zone":Ss,"aws.cloud.machine.type":Cs,"aws.tags":p.i18n.translate("xpack.infra.groupByDisplayNames.tags",{defaultMessage:"Tags"}),"aws.ec2.instance.image.id":p.i18n.translate("xpack.infra.groupByDisplayNames.image",{defaultMessage:"Image"}),"aws.ec2.instance.state.name":p.i18n.translate("xpack.infra.groupByDisplayNames.state.name",{defaultMessage:"State"}),"cloud.region":p.i18n.translate("xpack.infra.groupByDisplayNames.cloud.region",{defaultMessage:"Region"}),"aws.rds.db_instance.class":p.i18n.translate("xpack.infra.groupByDisplayNames.rds.db_instance.class",{defaultMessage:"Instance Class"}),"aws.rds.db_instance.status":p.i18n.translate("xpack.infra.groupByDisplayNames.rds.db_instance.status",{defaultMessage:"Status"})}[e]||e);var Fs=a(203);const Ls=e=>{switch(e.length){case 3:return e.slice(0,2);case 2:return e.slice(0,1);default:return[]}},Ps=e=>{const{nodes:t,options:a,formatter:i,currentTime:s,nodeType:l}=e,[o,c]=Object(r.useState)([]),u=Object(r.useCallback)((e=>()=>{c([...o,e])}),[o]),d=Object(r.useCallback)((e=>()=>{o.includes(e)&&c(o.filter((t=>t!==e)))}),[o]);Object(r.useEffect)((()=>{const e=document.getElementsByClassName(Fs.a)[0];e instanceof HTMLElement&&(o.length>0?e.style.overflowY="hidden":e.style.overflowY="auto")}),[o]);const m=[{field:"name",name:p.i18n.translate("xpack.infra.tableView.columnName.name",{defaultMessage:"Name"}),sortable:!0,truncateText:!0,textOnly:!0,render:(e,t)=>{const r=t.node.id===e?`${e}`:`${e} (${t.node.id})`,i=[...t.node.path.map((e=>e.value)),t.node.name].join(":"),c=n.a.createElement(g.EuiToolTip,{content:r},n.a.createElement(g.EuiButtonEmpty,{onClick:u(i)},e));return n.a.createElement(g.EuiPopover,{button:c,isOpen:o.includes(i),closePopover:d(i),anchorPosition:"rightCenter"},n.a.createElement(rs,{node:t.node,nodeType:l,currentTime:s,options:a}))}},...a.groupBy.map(((t,a)=>({field:`group_${a}`,name:Ts(t&&t.field||""),sortable:!0,truncateText:!0,textOnly:!0,render:a=>n.a.createElement(g.EuiToolTip,{content:"Set Filter"},n.a.createElement(g.EuiButtonEmpty,{onClick:()=>e.onFilter(`${t.field}:"${a}"`)},a))}))),{field:"value",name:p.i18n.translate("xpack.infra.tableView.columnName.last1m",{defaultMessage:"Last 1m"}),sortable:!0,truncateText:!0,dataType:"number",render:e=>n.a.createElement("span",null,i(e))},{field:"avg",name:p.i18n.translate("xpack.infra.tableView.columnName.avg",{defaultMessage:"Avg"}),sortable:!0,truncateText:!0,dataType:"number",render:e=>n.a.createElement("span",null,i(e))},{field:"max",name:p.i18n.translate("xpack.infra.tableView.columnName.max",{defaultMessage:"Max"}),sortable:!0,truncateText:!0,dataType:"number",render:e=>n.a.createElement("span",null,i(e))}],f=t.map((e=>{const t=Object(R.last)(e.path),a=Object(R.first)(e.metrics);return{name:t&&t.label||"unknown",...Ls(e.path).reduce(((e,t,a)=>({...e,[`group_${a}`]:t.label})),{}),value:a&&a.value||0,avg:a&&a.avg||0,max:a&&a.max||0,node:Kt(e)}}));return n.a.createElement(g.EuiInMemoryTable,{pagination:!0,sorting:{sort:{field:"value",direction:"desc"}},items:f,columns:m})},Ds=e=>{const t=e.map((e=>{const t=Object(R.first)(e.metrics);return t&&t.value?t.value:0}));1===t.length&&t.unshift(0);const a=Object(R.max)(t)||0,r=Object(R.min)(t)||0;return{min:Object(R.isFinite)(r)?r:0,max:Object(R.isFinite)(a)?a:0}},Is=({legend:e,bounds:t,formatter:a})=>{const r=e.rules.reduce(((e,t)=>e<t.value?t.value:e),0),i={background:`linear-gradient(to right, ${e.rules.map((e=>{const t=e.value/r*100;return`${e.color} ${t}%`}))})`};return n.a.createElement(_s,{style:i},e.rules.map(((e,t)=>(a,r)=>{const i=0===a.value?e.min:e.max*a.value,s={left:100*a.value+"%"},l=t(i);return n.a.createElement(Bs,{style:s,key:`legend-rule-${r}`},n.a.createElement(Rs,null),n.a.createElement(As,null,l))})(t,a)))},_s=B.euiStyled.div`
  position: absolute;
  height: 10px;
  bottom: 0;
  left: 0;
  right: 40px;
`,Bs=B.euiStyled.div`
  position: absolute;
  bottom: 0;
  top: -18px;
`,Rs=B.euiStyled.div`
  position: absolute;
  background-color: ${e=>e.theme.eui.euiBorderColor};
  width: 1px;
  left: 0;
  top: 15px;
  bottom: 0;
  ${Bs}:first-child {
    top: 2px;
  }
  ${Bs}:last-child {
    top: 2px;
  }
`,As=B.euiStyled.div`
  position: absolute;
  font-size: 11px;
  text-align: center;
  top: 0;
  left: 0;
  white-space: nowrap;
  transform: translate(-50%, 0);
  ${Bs}:first-child & {
    padding-left: 5px;
    transform: translate(0, 0);
  }
  ${Bs}:last-child & {
    padding-right: 5px;
    transform: translate(-100%, 0);
  }
`,Ns={[ae.c.gte]:">=",[ae.c.gt]:">",[ae.c.lte]:"<=",[ae.c.lt]:"<",[ae.c.eq]:"="},Vs=({legend:e,formatter:t})=>n.a.createElement(zs,null,e.rules.map((e=>(t,a)=>{const r=null!=t.label?t.label:`${Ns[t.operator]} ${e(t.value)}`,i={backgroundColor:Object(ra.darken)(.4,t.color)},s={backgroundColor:t.color};return n.a.createElement(Us,{key:`legend-step-${a}`},n.a.createElement($s,{style:i},n.a.createElement(qs,{style:s})),n.a.createElement(Hs,null,r))})(t))),zs=B.euiStyled.div`
  display: flex;
  padding: 10px 40px 10px 10px;
`,Us=B.euiStyled.div`
  display: flex;
  margin-right: 20px
  align-items: center;
`,$s=B.euiStyled.div`
  position: relative;
  width: 24px;
  height: 24px;
  flex: 0 0 auto;
  margin-right: 5px;
  border-radius: 3px;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
`,qs=B.euiStyled.div`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 2px;
  border-radius: 3px;
`,Hs=B.euiStyled.div`
  font-size: 12px;
`,Gs=({legend:e,bounds:t,formatter:a})=>n.a.createElement(Ws,null,n.a.createElement(Js,{value:1,bounds:t,formatter:a}),n.a.createElement(Ks,null,e.rules.slice().reverse().map(((e,t)=>n.a.createElement(Qs,{key:`step-${t}-${e.value}`,style:{backgroundColor:e.color}})))),n.a.createElement(Js,{value:0,bounds:t,formatter:a})),Js=({value:e,bounds:t,formatter:a})=>{const r=a(0===e?t.min:t.max*e);return n.a.createElement("div",null,n.a.createElement(g.EuiText,{size:"xs"},r))},Ws=B.euiStyled.div`
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`,Ks=B.euiStyled.div`
  height: 200px;
  width: 10px;
  display: flex;
  flex-direction: column;
  align-items: stretch;
`,Qs=B.euiStyled.div`
  flex: 1 1 auto;
  &:first-child {
    border-radius: ${e=>e.theme.eui.euiBorderRadius} ${e=>e.theme.eui.euiBorderRadius} 0 0;
  }
  &:last-child {
    border-radius: 0 0 ${e=>e.theme.eui.euiBorderRadius} ${e=>e.theme.eui.euiBorderRadius};
  }
`,Xs=({legend:e,bounds:t,formatter:a})=>n.a.createElement(Zs,null,ae.a.is(e)&&n.a.createElement(Is,{formatter:a,legend:e,bounds:t}),ae.f.is(e)&&n.a.createElement(Vs,{formatter:a,legend:e}),ae.g.is(e)&&n.a.createElement(Gs,{formatter:a,bounds:t,legend:e})),Zs=B.euiStyled.div`
  margin: 0 10px;
  display: flex;
`,Ys=({autoBounds:e,boundsOverride:t,loading:a,nodes:i,nodeType:s,reload:l,view:o,currentTime:c,options:u,formatter:d,onDrilldown:m,bottomMargin:f,topMargin:b,showLoading:h})=>{const y=Object(g.useCurrentEuiBreakpoint)(),E=Object(r.useCallback)((e=>{m({kind:"kuery",expression:e})}),[m]),v=!a&&i&&0===i.length;if(a&&h)return n.a.createElement(D.a,{height:"100%",width:"100%",text:p.i18n.translate("xpack.infra.waffle.loadingDataText",{defaultMessage:"Loading data"})});if(v)return n.a.createElement(L.a,{titleText:p.i18n.translate("xpack.infra.waffle.noDataTitle",{defaultMessage:"There is no data to display."}),bodyText:p.i18n.translate("xpack.infra.waffle.noDataDescription",{defaultMessage:"Try adjusting your time or filter."}),refetchText:p.i18n.translate("xpack.infra.waffle.checkNewDataButtonLabel",{defaultMessage:"Check for new data"}),onRefetch:()=>{l()},testString:"noMetricsDataPrompt"});const x=Ds(i),k=e?x:t,O=["xs","s"].includes(y);return"table"===o?n.a.createElement(el,null,n.a.createElement(Ps,{nodeType:s,nodes:i,options:u,formatter:d,currentTime:c,onFilter:E})):n.a.createElement(tl,{top:b,positionStatic:O},n.a.createElement(Ms,{nodeType:s,nodes:i,options:u,formatter:d,currentTime:c,onFilter:E,bounds:k,dataBounds:x,bottomMargin:f,staticHeight:O}),n.a.createElement(Xs,{formatter:d,bounds:k,dataBounds:x,legend:u.legend}))},el=B.euiStyled.div`
  padding: ${e=>e.theme.eui.euiSizeL};
`,tl=B.euiStyled.div`
  position: ${e=>e.positionStatic?"static":"absolute"};
  display: flex;
  top: ${e=>e.top}px;
  right: 0;
  bottom: 0;
  left: 0;
`;var al=a(154);const rl=_e.type({value:_e.string,name:_e.string}),nl=_e.type({accounts:_e.array(rl),projects:_e.array(_e.string),regions:_e.array(_e.string)});_e.type({sourceId:_e.string,nodeType:sa.c,currentTime:_e.number});var il=a(176),sl=a(77);const ll={avg:p.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.avg",{defaultMessage:"Average"}),max:p.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.max",{defaultMessage:"Max"}),min:p.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.min",{defaultMessage:"Min"}),rate:p.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.rate",{defaultMessage:"Rate"})},ol=Object(B.withTheme)((({theme:e,onCancel:t,fields:a,onChange:i,metric:s})=>{const[l,o]=Object(r.useState)(s?s.label:void 0),[c,u]=Object(r.useState)(s?s.aggregation:"avg"),[d,m]=Object(r.useState)(s?s.field:void 0),f=Object(r.useCallback)((()=>{if(s&&c&&d)i({...s,label:l,aggregation:c,field:d});else if(c&&d){const e={type:"custom",id:Y.a.v1(),label:l,aggregation:c,field:d};i(e)}}),[s,c,d,i,l]),b=Object(r.useCallback)((e=>{o(e.target.value)}),[o]),h=Object(r.useCallback)((e=>{m(e[0].label)}),[m]),y=Object(r.useCallback)((e=>{const t=e.target.value,a=sl.c.is(t)?t:"avg";u(a)}),[u]),E=a.filter((e=>e.aggregatable&&"number"===e.type&&!(d&&d===e.name))).map((e=>({label:e.name}))),v=sl.b.map((e=>({text:ll[e],value:e}))),x=!d||!c,k=s?p.i18n.translate("xpack.infra.waffle.customMetricPanelLabel.edit",{defaultMessage:"Edit custom metric"}):p.i18n.translate("xpack.infra.waffle.customMetricPanelLabel.add",{defaultMessage:"Add custom metric"}),O=s?p.i18n.translate("xpack.infra.waffle.customMetricPanelLabel.editAriaLabel",{defaultMessage:"Back to custom metrics edit mode"}):p.i18n.translate("xpack.infra.waffle.customMetricPanelLabel.addAriaLabel",{defaultMessage:"Back to metric picker"});return n.a.createElement("div",{style:{width:685}},n.a.createElement(g.EuiForm,null,n.a.createElement(g.EuiPopoverTitle,null,n.a.createElement(g.EuiButtonEmpty,{iconType:"arrowLeft",onClick:t,color:"text",size:"xs",flush:"left",style:{fontWeight:700,textTransform:"uppercase"},"aria-label":O},k)),n.a.createElement("div",{style:{padding:null==e?void 0:e.eui.euiSizeM,borderBottom:`${null==e?void 0:e.eui.euiBorderWidthThin} solid ${null==e?void 0:e.eui.euiBorderColor}`}},n.a.createElement(g.EuiFormRow,{label:p.i18n.translate("xpack.infra.waffle.customMetrics.metricLabel",{defaultMessage:"Metric"}),display:"rowCompressed",fullWidth:!0},n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiSelect,{onChange:y,value:c,options:v,fullWidth:!0})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement("span",null,"of"))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiComboBox,{fullWidth:!0,placeholder:p.i18n.translate("xpack.infra.waffle.customMetrics.fieldPlaceholder",{defaultMessage:"Select a field"}),singleSelection:{asPlainText:!0},selectedOptions:d?[{label:d}]:[],options:E,onChange:h,isClearable:!1})))),n.a.createElement(g.EuiFormRow,{label:p.i18n.translate("xpack.infra.waffle.customMetrics.labelLabel",{defaultMessage:"Label (optional)"}),display:"rowCompressed",fullWidth:!0},n.a.createElement(g.EuiFieldText,{name:"label",placeholder:p.i18n.translate("xpack.infra.waffle.customMetrics.labelPlaceholder",{defaultMessage:'Choose a name to appear in the "Metric" dropdown'}),value:l,fullWidth:!0,onChange:b}))),n.a.createElement("div",{style:{padding:null==e?void 0:e.eui.euiSizeM,textAlign:"right"}},n.a.createElement(g.EuiButtonEmpty,{onClick:t,size:"s",style:{paddingRight:null==e?void 0:e.eui.euiSizeXL}},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.waffle.customMetrics.cancelLabel",defaultMessage:"Cancel"})),n.a.createElement(g.EuiButton,{type:"submit",size:"s",fill:!0,onClick:f,disabled:x},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.waffle.customMetrics.submitLabel",defaultMessage:"Save"})))))})),cl=({onClose:e,onChange:t,metric:a,options:i,customMetrics:s})=>{const l=sl.d.is(a)&&a.id?a.id:a.type,o=Object(r.useCallback)((a=>{if(sa.f.is(a))t({type:a});else{const e=s.find((e=>e.id===a));e&&t(e)}e()}),[s,t,e]),c=[{id:0,title:"",items:[...i.map((e=>{const t=e.value===l?"check":"empty";return{name:e.text,onClick:()=>o(e.value),icon:t}})),...s.map((e=>{const t=e.id===l?"check":"empty";return{name:Object(na.a)(e),onClick:()=>o(e.id),icon:t}}))]}];return n.a.createElement(g.EuiContextMenu,{initialPanelId:0,panels:c})},ul=Object(B.withTheme)((({onSave:e,onEditCancel:t,onEdit:a,onAdd:r,mode:i,customMetrics:s,theme:l})=>["editMetric","addMetric"].includes(i)?null:n.a.createElement("div",{style:{borderTop:`${null==l?void 0:l.eui.euiBorderWidthThin} solid ${null==l?void 0:l.eui.euiBorderColor}`,padding:12}},n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween"},"edit"===i?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{size:"s",flush:"left",onClick:t,"aria-label":p.i18n.translate("xpack.infra.waffle.customMetrics.modeSwitcher.cancelAriaLabel",{defaultMessage:"Cancel edit mode"})},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.waffle.customMetrics.modeSwitcher.cancel",defaultMessage:"Cancel"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{onClick:e,size:"s",fill:!0,"aria-label":p.i18n.translate("xpack.infra.waffle.customMetrics.modeSwitcher.saveButtonAriaLabel",{defaultMessage:"Save changes to custom metrics"})},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.waffle.customMetrics.modeSwitcher.saveButton",defaultMessage:"Save"})))):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{size:"s",flush:"left",onClick:a,disabled:0===s.length,"aria-label":p.i18n.translate("xpack.infra.waffle.customMetrics.modeSwitcher.editAriaLabel",{defaultMessage:"Edit custom metrics"})},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.waffle.customMetrics.modeSwitcher.edit",defaultMessage:"Edit"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:r,size:"s",flush:"right","aria-label":p.i18n.translate("xpack.infra.waffle.customMetrics.modeSwitcher.addMetricAriaLabel",{defaultMessage:"Add custom metric"})},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.waffle.customMetrics.modeSwitcher.addMetric",defaultMessage:"Add metric"})))))))),dl=Object(B.withTheme)((({theme:e,customMetrics:t,options:a,onEdit:r,onDelete:i})=>n.a.createElement("div",{style:{width:256}},a.map((t=>n.a.createElement("div",{key:t.value,style:{padding:"14px 14px 13px 36px"}},n.a.createElement("span",{style:{color:null==e?void 0:e.eui.euiButtonColorDisabled}},t.text)))),t.map((e=>n.a.createElement(g.EuiFlexGroup,{key:e.id,alignItems:"center",gutterSize:"none",style:{padding:"10px 0px 9px"}},n.a.createElement(g.EuiFlexItem,{grow:!1,style:{width:36}},n.a.createElement(g.EuiButtonIcon,{iconType:"pencil",onClick:()=>r(e),"aria-label":p.i18n.translate("xpack.infra.waffle.customMetrics.editMode.editButtonAriaLabel",{defaultMessage:"Edit custom metric for {name}",values:{name:Object(na.a)(e)}})})),n.a.createElement(g.EuiFlexItem,{grow:1,style:{overflow:"hidden"}},Object(na.a)(e)),n.a.createElement(g.EuiFlexItem,{grow:!1,style:{width:36,textAlign:"right"}},n.a.createElement(g.EuiButtonIcon,{iconType:"trash",color:"danger",onClick:()=>i(e),"aria-label":p.i18n.translate("xpack.infra.waffle.customMetrics.editMode.deleteAriaLabel",{defaultMessage:"Delete custom metric for {name}",values:{name:Object(na.a)(e)}})})))))))),ml=Object(B.withTheme)((e=>{const{onClick:t,label:a,theme:r,children:i}=e;return n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"none",style:{border:null==r?void 0:r.eui.euiFormInputGroupBorder,boxShadow:`0px 3px 2px ${null==r?void 0:r.eui.euiTableActionsBorderColor}, 0px 1px 1px ${null==r?void 0:r.eui.euiTableActionsBorderColor}`}},n.a.createElement(g.EuiFlexItem,{grow:!1,style:{padding:12,background:null==r?void 0:r.eui.euiFormInputGroupLabelBackground,fontSize:"0.75em",fontWeight:600,color:null==r?void 0:r.eui.euiTitleColor}},a),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{"data-test-subj":e["data-test-subj"],color:"text",iconType:"arrowDown",onClick:t,iconSide:"right",size:"xs"},i)))})),pl=({fields:e,onChange:t,onChangeCustomMetrics:a,metric:i,options:s,customMetrics:l})=>{var o;const[c,u]=Object(r.useState)(!1),[d,m]=Object(r.useState)("pick"),[f,b]=Object(r.useState)([]),[h,y]=Object(r.useState)(),E=Object(r.useCallback)((()=>{u(!1)}),[u]),v=Object(r.useCallback)((()=>{u(!c)}),[c]),x=Object(r.useCallback)((e=>{a([...l,e]),t(e),m("pick")}),[l,t,a,m]),k=Object(r.useCallback)((()=>{m("edit"),b(l)}),[l]),O=Object(r.useCallback)((()=>{m("addMetric")}),[m]),M=Object(r.useCallback)((()=>{m("pick"),b([])}),[m]),w=Object(r.useCallback)((e=>{sl.d.is(i)&&e.id===i.id&&t({type:s[0].value});const a=f.filter((t=>t.id!==e.id));b(a)}),[f,i,t,s]),j=Object(r.useCallback)((e=>{const t=l.map((t=>t.id===e.id&&e||t));a(t),M(),y(void 0),b([])}),[l,a,M]),S=Object(r.useCallback)((e=>{y(e),m("editMetric")}),[m,y]),C=Object(r.useCallback)((()=>{a(f),m("pick")}),[f,a]);if(!s.length||!i.type)throw Error(p.i18n.translate("xpack.infra.waffle.unableToSelectMetricErrorTitle",{defaultMessage:"Unable to select options or value for metric."}));const T=sl.d.is(i)&&i.id?i.id:i.type,F=sl.d.is(i)?Object(na.a)(i):null===(o=s.find((e=>e.value===T)))||void 0===o?void 0:o.text;if(!F)return null;const L=n.a.createElement(ml,{onClick:v,label:p.i18n.translate("xpack.infra.waffle.metriclabel",{defaultMessage:"Metric"})},F);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiPopover,{isOpen:c,id:"metricsPanel",button:L,anchorPosition:"downLeft",panelPaddingSize:"none",closePopover:E},"pick"===d?n.a.createElement(cl,{onChange:t,onClose:E,metric:i,customMetrics:l,options:s}):null,"addMetric"===d?n.a.createElement(ol,{fields:e,customMetrics:l,onChange:x,onCancel:M}):null,"editMetric"===d?n.a.createElement(ol,{metric:h,fields:e,customMetrics:l,onChange:j,onCancel:k}):null,"edit"===d?n.a.createElement(dl,{customMetrics:f,options:s,onEdit:S,onDelete:w}):null,n.a.createElement(ul,{onEditCancel:M,onEdit:k,onAdd:O,mode:d,onSave:C,customMetrics:l})))},gl={selectedOptions:[]};class custom_field_panel_CustomFieldPanel extends n.a.PureComponent{constructor(...e){super(...e),Zt()(this,"state",gl),Zt()(this,"handleSubmit",(()=>{this.props.onSubmit(this.state.selectedOptions[0].label)})),Zt()(this,"handleFieldSelection",(e=>{this.setState({selectedOptions:e})}))}render(){const{fields:e,currentOptions:t}=this.props,a=e.filter((e=>e.aggregatable&&"string"===e.type&&!(t&&t.some((t=>t.field===e.name))))).map((e=>({label:e.name}))),r=!this.state.selectedOptions.length;return n.a.createElement("div",{style:{padding:16}},n.a.createElement(g.EuiForm,null,n.a.createElement(g.EuiFormRow,{label:p.i18n.translate("xpack.infra.waffle.customGroupByFieldLabel",{defaultMessage:"Field"}),helpText:p.i18n.translate("xpack.infra.waffle.customGroupByHelpText",{defaultMessage:"This is the field used for the terms aggregation"}),display:"rowCompressed",fullWidth:!0},n.a.createElement(g.EuiComboBox,{"data-test-subj":"groupByCustomField",placeholder:p.i18n.translate("xpack.infra.waffle.customGroupByDropdownPlacehoder",{defaultMessage:"Select one"}),singleSelection:{asPlainText:!0},selectedOptions:this.state.selectedOptions,options:a,onChange:this.handleFieldSelection,fullWidth:!0,isClearable:!1})),n.a.createElement(g.EuiButton,{"data-test-subj":"groupByCustomFieldAddButton",disabled:r,type:"submit",size:"s",fill:!0,onClick:this.handleSubmit},"Add")))}}Zt()(custom_field_panel_CustomFieldPanel,"displayName","CustomFieldPanel");const fl={isPopoverOpen:!1};class waffle_group_by_controls_WaffleGroupByControls extends n.a.PureComponent{constructor(...e){super(...e),Zt()(this,"state",fl),Zt()(this,"handleRemove",(e=>()=>{const{groupBy:t}=this.props;this.props.onChange(t.filter((t=>t.field!==e)));const a=this.props.customOptions.filter((t=>t.field!==e));this.props.onChangeCustomOptions(a),setTimeout((()=>this.handleClose()))})),Zt()(this,"handleClose",(()=>{this.setState({isPopoverOpen:!1})})),Zt()(this,"handleToggle",(()=>{this.setState((e=>({isPopoverOpen:!e.isPopoverOpen})))})),Zt()(this,"handleCustomField",(e=>{const t=[...this.props.customOptions,{text:e,field:e}];this.props.onChangeCustomOptions(t),this.handleClick(e)()})),Zt()(this,"handleClick",(e=>()=>{const{groupBy:t}=this.props;t.some((t=>t.field===e))?this.handleRemove(e)():this.props.groupBy.length<2&&this.props.onChange([...t,{field:e}]),this.handleClose()}))}render(){const{nodeType:e,groupBy:t}=this.props,a=this.props.customOptions.map((e=>({...e,toolTipContent:e.text}))),r=this.props.options.concat(a);if(!r.length)throw Error(p.i18n.translate("xpack.infra.waffle.unableToSelectGroupErrorMessage",{defaultMessage:"Unable to select group by options for {nodeType}",values:{nodeType:e}}));const i=t.length>=2,s=p.i18n.translate("xpack.infra.waffle.maxGroupByTooltip",{defaultMessage:"Only two groupings can be selected at a time"}),l=[{id:"firstPanel",title:p.i18n.translate("xpack.infra.waffle.selectTwoGroupingsTitle",{defaultMessage:"Select up to two groupings"}),items:[{name:p.i18n.translate("xpack.infra.waffle.customGroupByOptionName",{defaultMessage:"Custom field"}),disabled:i,toolTipContent:i?s:null,icon:"empty",panel:"customPanel"},...r.map((e=>{const a=t.some((t=>t.field===e.field))?"check":"empty",r={name:e.text,onClick:this.handleClick(e.field),icon:a};return e.toolTipContent&&(r.toolTipContent=e.toolTipContent),i&&"empty"===a&&(r.toolTipContent=s,r.disabled=!0),r}))]},{id:"customPanel",title:p.i18n.translate("xpack.infra.waffle.customGroupByPanelTitle",{defaultMessage:"Group By Custom Field"}),width:685,content:n.a.createElement(custom_field_panel_CustomFieldPanel,{currentOptions:this.props.customOptions,onSubmit:this.handleCustomField,fields:this.props.fields})}],o=t.length>0?t.map((e=>r.find((t=>t.field===e.field)))).filter((e=>null!=e)).map((e=>n.a.createElement(g.EuiBadge,{color:"hollow",key:e&&e.field},e&&e.text))):n.a.createElement(P.FormattedMessage,{id:"xpack.infra.waffle.groupByAllTitle",defaultMessage:"All"}),c=n.a.createElement(ml,{label:p.i18n.translate("xpack.infra.waffle.groupByLabel",{defaultMessage:"Group by"}),onClick:this.handleToggle,"data-test-subj":"waffleGroupByDropdown"},o);return n.a.createElement(g.EuiPopover,{isOpen:this.state.isPopoverOpen,id:"groupByPanel",button:c,panelPaddingSize:"none",closePopover:this.handleClose},n.a.createElement(bl,{initialPanelId:"firstPanel",panels:l,"data-test-subj":"groupByContextMenu"}))}}Zt()(waffle_group_by_controls_WaffleGroupByControls,"displayName","WaffleGroupByControls");const bl=Object(B.euiStyled)(g.EuiContextMenu)`
  width: 320px;
  & .euiContextMenuItem__text {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,hl={name:p.i18n.translate("xpack.infra.waffle.sortNameLabel",{defaultMessage:"Name"}),value:p.i18n.translate("xpack.infra.waffle.sort.valueLabel",{defaultMessage:"Metric value"})},yl=({sort:e,onChange:t})=>{const[a,i]=Object(r.useState)(!1),s=Object(r.useCallback)((()=>{i(!0)}),[i]),l=Object(r.useCallback)((()=>{i(!1)}),[i]),o=hl[e.by],c=n.a.createElement(ml,{label:p.i18n.translate("xpack.infra.waffle.sortLabel",{defaultMessage:"Sort by"}),onClick:s,"data-test-subj":"waffleSortByDropdown"},o),u=Object(r.useCallback)((()=>{t({...e,by:"name"}),l()}),[l,t,e]),d=Object(r.useCallback)((()=>{t({...e,by:"value"}),l()}),[l,t,e]),m=Object(r.useCallback)((()=>{t({...e,direction:"asc"===e.direction?"desc":"asc"}),l()}),[l,e,t]),f=Object(r.useMemo)((()=>[{id:0,title:"",items:[{name:hl.name,icon:"name"===e.by?"check":"empty",onClick:u,"data-test-subj":"waffleSortByName"},{name:hl.value,icon:"value"===e.by?"check":"empty",onClick:d,"data-test-subj":"waffleSortByValue"}]}]),[e.by,u,d]);return n.a.createElement(g.EuiPopover,{isOpen:a,id:"sortPopover",button:c,anchorPosition:"downLeft",panelPaddingSize:"none",closePopover:l},n.a.createElement(g.EuiContextMenu,{initialPanelId:0,panels:f}),n.a.createElement(El,null,n.a.createElement(g.EuiSwitch,{compressed:!0,label:p.i18n.translate("xpack.infra.waffle.sortDirectionLabel",{defaultMessage:"Reverse direction"}),checked:"desc"===e.direction,onChange:m,"data-test-subj":"waffleSortByDirection"})))},El=Object(B.withTheme)((({children:e,theme:t})=>n.a.createElement("div",{style:{padding:null==t?void 0:t.eui.euiSizeM,borderTop:`1px solid ${null==t?void 0:t.eui.euiBorderColor}`}},e))),vl=e=>Object(ia.b)(e).displayName,xl=()=>{const{changeNodeType:e,changeGroupBy:t,changeMetric:a,changeAccount:i,changeRegion:s,changeCustomMetrics:l,nodeType:o}=Object(da.d)(),[c,u]=Object(r.useState)(!1),d=Object(r.useCallback)((()=>u(!1)),[]),m=Object(r.useCallback)((()=>u(!0)),[]),f=Object(r.useCallback)((r=>{d(),e(r),t([]),l([]),i(""),s("");const n=Object(ia.b)(r);a({type:n.metrics.defaultSnapshot})}),[d,e,t,l,i,s,a]),b=Object(r.useCallback)((()=>f("host")),[f]),h=Object(r.useCallback)((()=>f("pod")),[f]),y=Object(r.useCallback)((()=>f("container")),[f]),E=Object(r.useCallback)((()=>f("awsEC2")),[f]),v=Object(r.useCallback)((()=>f("awsS3")),[f]),x=Object(r.useCallback)((()=>f("awsRDS")),[f]),k=Object(r.useCallback)((()=>f("awsSQS")),[f]),O=Object(r.useMemo)((()=>[{id:"firstPanel",items:[{"data-test-subj":"goToHost",name:vl("host"),onClick:b},{"data-test-subj":"goToPods",name:vl("pod"),onClick:h},{"data-test-subj":"goToDocker",name:vl("container"),onClick:y},{name:"AWS",panel:"awsPanel"}]},{id:"awsPanel",title:"AWS",items:[{name:vl("awsEC2"),onClick:E},{name:vl("awsS3"),onClick:v},{name:vl("awsRDS"),onClick:x},{name:vl("awsSQS"),onClick:k}]}]),[E,x,v,k,y,b,h]),M=Object(r.useMemo)((()=>vl(o)),[o]),w=n.a.createElement(ml,{"data-test-subj":"openInventorySwitcher",onClick:m,label:p.i18n.translate("xpack.infra.waffle.showLabel",{defaultMessage:"Show"})},M);return n.a.createElement(g.EuiPopover,{id:"contextMenu",button:w,isOpen:c,closePopover:d,panelPaddingSize:"none",anchorPosition:"downLeft"},n.a.createElement(g.EuiContextMenu,{initialPanelId:"firstPanel",panels:O}))},kl=e=>{const{changeMetric:t,changeGroupBy:a,changeCustomOptions:r,changeAccount:i,changeRegion:s,changeSort:l,customOptions:o,groupBy:c,metric:u,nodeType:d,accountId:m,view:p,region:f,legend:b,sort:h,customMetrics:y,changeCustomMetrics:E}=Object(da.d)(),{createDerivedIndexPattern:v}=Object(w.b)();return n.a.createElement(g.EuiFlexGroup,{responsive:!1,wrap:!0,gutterSize:"m"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(xl,null)),e.children({createDerivedIndexPattern:v,changeMetric:t,changeGroupBy:a,changeAccount:i,changeRegion:s,changeCustomOptions:r,changeSort:l,customOptions:o,groupBy:c,sort:h,view:p,metric:u,nodeType:d,region:f,accountId:m,legend:b,customMetrics:y,changeCustomMetrics:E}))},Ol=e=>({text:Ts(e),field:e}),Ml=e=>{const t=Object(r.useMemo)((()=>e.metricTypes.map(ca.a).filter((e=>e))),[e.metricTypes]),a=Object(r.useMemo)((()=>e.groupByFields.map(Ol)),[e.groupByFields]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(pl,{fields:e.createDerivedIndexPattern().fields,options:t,metric:e.metric,onChange:e.changeMetric,onChangeCustomMetrics:e.changeCustomMetrics,customMetrics:e.customMetrics})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(waffle_group_by_controls_WaffleGroupByControls,{options:a,groupBy:e.groupBy,nodeType:e.nodeType,onChange:e.changeGroupBy,fields:e.createDerivedIndexPattern().fields,onChangeCustomOptions:e.changeCustomOptions,customOptions:e.customOptions})),"map"===e.view&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(yl,{sort:e.sort,onChange:e.changeSort})))},wl=e=>{const{accountId:t,options:a}=e,[i,s]=Object(r.useState)(!1),l=Object(r.useCallback)((()=>{s(!0)}),[s]),o=Object(r.useCallback)((()=>{s(!1)}),[s]),c=a.find((e=>e.value===t)),u=Object(r.useCallback)((a=>{t===a?e.changeAccount(""):e.changeAccount(a),o()}),[t,o,e]),d=Object(r.useMemo)((()=>[{id:0,title:"",items:a.map((e=>{const a=e.value===t?"check":"empty";return{name:e.name,onClick:()=>u(e.value),icon:a}}))}]),[a,t,u]),m=n.a.createElement(ml,{label:p.i18n.translate("xpack.infra.waffle.accountLabel",{defaultMessage:"Account"}),onClick:l},c?c.name:p.i18n.translate("xpack.infra.waffle.accountAllTitle",{defaultMessage:"All"}));return n.a.createElement(g.EuiPopover,{isOpen:i,id:"accontPopOver",button:m,anchorPosition:"downLeft",panelPaddingSize:"none",closePopover:o},n.a.createElement(g.EuiContextMenu,{initialPanelId:0,panels:d}))},jl=e=>{const{region:t,options:a}=e,[i,s]=Object(r.useState)(!1),l=Object(r.useCallback)((()=>{s(!0)}),[s]),o=Object(r.useCallback)((()=>{s(!1)}),[s]),c=a.find((e=>t===e)),u=Object(r.useCallback)((a=>{t===a?e.changeRegion(""):e.changeRegion(a),o()}),[t,o,e]),d=Object(r.useMemo)((()=>[{id:0,title:"",items:a.map((e=>({name:e,onClick:()=>u(e),icon:e===t?"check":"empty"})))}]),[u,a,t]),m=n.a.createElement(ml,{onClick:l,label:p.i18n.translate("xpack.infra.waffle.regionLabel",{defaultMessage:"Region"})},c||p.i18n.translate("xpack.infra.waffle.region",{defaultMessage:"All"}));return n.a.createElement(g.EuiPopover,{isOpen:i,id:"regionPanel",button:m,anchorPosition:"downLeft",panelPaddingSize:"none",closePopover:o},n.a.createElement(g.EuiContextMenu,{initialPanelId:0,panels:d}))},Sl=e=>n.a.createElement(n.a.Fragment,null,e.accounts.length>0&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(wl,{changeAccount:e.changeAccount,accountId:e.accountId,options:e.accounts})),e.regions.length>0&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(jl,{changeRegion:e.changeRegion,region:e.region,options:e.regions}))),Cl=["cloud.availability_zone","cloud.machine.type","aws.ec2.instance.image.id","aws.ec2.instance.state.name"],Tl=e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Sl,e),n.a.createElement(Ml,m()({},e,{metricTypes:il.b,groupByFields:Cl})));var Fl=a(178);const Ll=["cloud.availability_zone","aws.rds.db_instance.class","aws.rds.db_instance.status"],Pl=e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Sl,e),n.a.createElement(Ml,m()({},e,{metricTypes:Fl.b,groupByFields:Ll})));var Dl=a(177);const Il=["cloud.region"],_l=e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Sl,e),n.a.createElement(Ml,m()({},e,{metricTypes:Dl.b,groupByFields:Il})));var Bl=a(179);const Rl=["cloud.region"],Al=e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Sl,e),n.a.createElement(Ml,m()({},e,{metricTypes:Bl.b,groupByFields:Rl})));var Nl=a(180);const Vl=["host.name","cloud.availability_zone","cloud.machine.type","cloud.project.id","cloud.provider","service.type"],zl=e=>n.a.createElement(Ml,m()({},e,{metricTypes:Nl.b,groupByFields:Vl}));var Ul=a(174);const $l=["cloud.availability_zone","cloud.machine.type","cloud.project.id","cloud.provider","service.type"],ql=e=>n.a.createElement(Ml,m()({},e,{metricTypes:Ul.b,groupByFields:$l}));var Hl=a(175);const Gl=["kubernetes.namespace","kubernetes.node.name","service.type"],Jl=e=>n.a.createElement(Ml,m()({},e,{metricTypes:Hl.b,groupByFields:Gl})),Wl=({nodeType:e,currentTime:t})=>{const{sourceId:a}=Object(w.b)(),{accounts:i,regions:s}=function(e,t,a){const{error:n,loading:i,response:s,makeRequest:l}=Object(Ga.a)("/api/infra/inventory/meta","POST",JSON.stringify({sourceId:e,nodeType:t,currentTime:a}),(e=>Object(Be.pipe)(nl.decode(e),Object(Re.fold)(Object(Ha.c)(Ha.a),Ae.identity))));return Object(r.useEffect)((()=>{l()}),[l]),{error:n,loading:i,accounts:s?s.accounts:[],regions:s?s.regions:[],makeRequest:l}}(a,e,t);return n.a.createElement(kl,null,(e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Kl,m()({},e,{accounts:i,regions:s})),n.a.createElement(g.EuiFlexItem,{grow:!0}))))},Kl=e=>{switch(e.nodeType){case"awsEC2":return n.a.createElement(Tl,e);case"awsRDS":return n.a.createElement(Pl,e);case"awsS3":return n.a.createElement(_l,e);case"awsSQS":return n.a.createElement(Al,e);case"container":return n.a.createElement(zl,e);case"host":return n.a.createElement(ql,e);case"pod":return n.a.createElement(Jl,e)}},Ql=({view:e,onChange:t})=>{const a=[{id:"map",label:p.i18n.translate("xpack.infra.viewSwitcher.mapViewLabel",{defaultMessage:"Map view"}),iconType:"grid"},{id:"table",label:p.i18n.translate("xpack.infra.viewSwitcher.tableViewLabel",{defaultMessage:"Table view"}),iconType:"visTable"}];return n.a.createElement(g.EuiButtonGroup,{legend:p.i18n.translate("xpack.infra.viewSwitcher.lenged",{defaultMessage:"Switch between table and map view"}),options:a,color:"text",buttonSize:"s",idSelected:e,onChange:t,isIconOnly:!0})},Xl=(e="cool",t=10)=>{switch(e){case"temperature":return Object(g.euiPaletteForTemperature)(t);case"status":return Object(g.euiPaletteForStatus)(t);case"warm":return Object(g.euiPaletteWarm)(t);case"positive":return Object(g.euiPalettePositive)(t);case"negative":return Object(g.euiPaletteNegative)(t);default:return Object(g.euiPaletteCool)(t)}},Zl=(e="cool",t=10,a=!1)=>a?Xl(e,t).reverse():Xl(e,t),Yl=(e,t=10,a=!1)=>({type:"steppedGradient",rules:Zl(e,t,a).map(((e,a)=>({color:e,value:(a+1)/t})))}),eo=new RegExp("^([0-9\\.]*)\\s*("+["y","M","w","d","h","m","s","ms"].join("|")+")$"),to={ms:.001,s:1,m:60,h:3600,d:86400,w:604800,M:2592e3,y:30758400},ao=e=>{const t=e.match(eo);if(t)return parseFloat(t[1])*to[t[2]];throw new Error("Invalid interval string format.")};const ro=({interval:e,yAxisFormatter:t,isVisible:a})=>{var i,s;const{sourceId:l,source:o}=Object(w.b)(),{metric:c,nodeType:u,accountId:d,region:m}=Object(da.d)(),{currentTime:p,jumpToTime:b,stopAutoReload:h}=Ot(),{filterQueryAsJson:y}=_t(),{loading:v,error:x,startTime:k,endTime:O,timeseries:M,reload:j}=function(e,t,a,n,i,s,l,o,c){const u=Object(r.useMemo)((()=>(e=>e&&ao(e)<300?"5m":e)(o)),[o]),d=Object(r.useMemo)((()=>(e=>{if(e){const t=ao(e);return{timeLength:t<=900?86400:t<=2100?259200:t<=9e3?604800:2592e3,intervalInSeconds:t}}return{timeLength:0,intervalInSeconds:0}})(u)),[u]),{timeLength:m,intervalInSeconds:p}=d,g=i+1e3*p,f=i-1e3*m,b={interval:null!=u?u:"",to:g,from:f,ignoreLookback:!0,forceInterval:!0},{error:h,loading:y,response:E,makeRequest:v}=Object(Ga.a)("/api/metrics/snapshot","POST",JSON.stringify({metrics:t,groupBy:null,nodeType:a,timerange:b,filterQuery:e,sourceId:n,accountId:s,region:l,includeTimeseries:!0}),(e=>Object(Be.pipe)(sl.g.decode(e),Object(Re.fold)(Object(Ha.c)(Ha.a),Ae.identity)))),x=Object(r.useCallback)((()=>c?v():Promise.resolve()),[v,c]);Object(r.useEffect)((()=>{(async()=>{m&&await x()})()}),[x,m]);const k=E?Object(R.first)(E.nodes.map((e=>{var t;return null===(t=Object(R.first)(e.metrics))||void 0===t?void 0:t.timeseries}))):null;return{error:h&&h.message||null,loading:!o||y,timeseries:k,startTime:f,endTime:g,reload:v}}(y,[c],u,l,p,d,m,e,a),S={sourceId:"default",anomalyThreshold:(null==o?void 0:o.configuration.anomalyThreshold)||0,startTime:k,endTime:O,defaultSortOptions:{direction:"desc",field:"anomalyScore"},defaultPaginationOptions:{pageSize:100}},{metricsHostsAnomalies:C,getMetricsHostsAnomalies:T}=ln(S),{metricsK8sAnomalies:F,getMetricsK8sAnomalies:L}=an(S),D=Object(r.useMemo)((()=>"host"===u?T:"pod"===u?L:void 0),[u,L,T]),I=Object(r.useMemo)((()=>"host"===u?C:"pod"===u?F:void 0),[u,C,F]),B=null===(i=Object(ca.a)(c.type))||void 0===i?void 0:i.textLC,A=null===(s=Object(ca.a)(c.type))||void 0===s?void 0:s.text,V={color:ee.a.color0,aggregation:"avg",label:A},U=Object(r.useMemo)((()=>{var e,t;if(!M)return()=>"";const a=null===(e=Object(R.first)(M.rows))||void 0===e?void 0:e.timestamp,r=null===(t=Object(R.last)(M.rows))||void 0===t?void 0:t.timestamp;return null==a||null==r?e=>`${e}`:Object(_.niceTimeFormatter)([a,r])}),[M]),$=Object(f.useUiSetting)("theme:darkMode"),q={headerFormatter:e=>N()(e.value).format("Y-MM-DD HH:mm:ss.SSS")},H=M?Object(be.a)(M,[V],!1):null,G=H?{max:1.1*H.max,min:H.min}:{max:0,min:0},J=Object(r.useCallback)((([e])=>{const[t]=e;if(t&&!Array.isArray(t)){const{x:e}=t;b(e),h()}}),[b,h]),W=Object(r.useMemo)((()=>{const e=c.type;return"memory"===e?"memory_usage":"rx"===e?"network_in":"tx"===e?"network_out":void 0}),[c]);return Object(r.useEffect)((()=>{D&&W&&D(W)}),[D,W]),v?n.a.createElement(no,null,n.a.createElement(lo,null,n.a.createElement(g.EuiLoadingChart,{size:"xl"}))):v||!x&&M?n.a.createElement(no,{"data-test-subj":a?"timelineContainerOpen":"timelineContainerClosed"},n.a.createElement(io,null,n.a.createElement(g.EuiFlexItem,{grow:!0},n.a.createElement(g.EuiText,null,n.a.createElement("strong",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.inventoryTimeline.header",defaultMessage:"Average {metricLabel}",values:{metricLabel:B}})))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexGroup,{alignItems:"center",responsive:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIcon,{color:Object(ee.b)(V.color),type:"dot"})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{size:"xs"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.inventoryTimeline.header",defaultMessage:"Average {metricLabel}",values:{metricLabel:B}}))))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},n.a.createElement(g.EuiFlexItem,{grow:!1,style:{backgroundColor:"#D36086",height:5,width:10}}),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"xs"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.inventoryTimeline.legend.anomalyLabel",defaultMessage:"Anomaly detected"})))))))),n.a.createElement(so,null,n.a.createElement(_.Chart,null,I&&n.a.createElement(_.RectAnnotation,{id:"anomalies",dataValues:(K=I.map((e=>[e.startTime,e.influencers])),K.map((e=>{const[t,a]=e;return{coordinates:{x0:t,x1:N()(t).add(15,"minutes").valueOf(),y0:null==H?void 0:H.min,y1:null==H?void 0:H.max},details:a.join(",")}}))),style:{fill:"#D36086"}}),n.a.createElement(Ee.a,{type:E.b.area,metric:V,id:"0",series:M,stack:!1}),n.a.createElement(_.Axis,{id:"timestamp",position:_.Position.Bottom,showOverlappingTicks:!0,tickFormat:U}),n.a.createElement(_.Axis,{id:"values",position:_.Position.Left,tickFormat:t,domain:G,ticks:6,showGridLines:!0}),n.a.createElement(_.Settings,{tooltip:q,theme:z($),onElementClick:J})))):n.a.createElement(no,null,n.a.createElement(g.EuiEmptyPrompt,{iconType:"visArea",title:n.a.createElement("h4",null,x?co:oo),actions:n.a.createElement(g.EuiButton,{color:"primary",fill:!0,onClick:j},x?mo:uo)}));var K},no=B.euiStyled.div`
  background-color: ${e=>e.theme.eui.euiPageBackgroundColor};
  border-top: 1px solid ${e=>e.theme.eui.euiColorLightShade};
  height: 220px;
  width: 100%;
  padding: ${e=>e.theme.eui.euiSizeS} ${e=>e.theme.eui.euiSizeM};
  display: flex;
  flex-direction: column;
`,io=B.euiStyled.div`
  display: flex;
  width: 100%;
  padding: ${e=>e.theme.eui.euiSizeS} ${e=>e.theme.eui.euiSizeM};
  @media only screen and (max-width: 767px) {
      margin-top: 30px;
  }
`,so=B.euiStyled.div`
  padding-left: ${e=>e.theme.eui.euiSizeXS};
  width: 100%;
  height: 100%;
`,lo=B.euiStyled.div`
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
`,oo=p.i18n.translate("xpack.infra.inventoryTimeline.noHistoryDataTitle",{defaultMessage:"There is no historical data to display."}),co=p.i18n.translate("xpack.infra.inventoryTimeline.errorTitle",{defaultMessage:"Unable to show historical data."}),uo=p.i18n.translate("xpack.infra.inventoryTimeline.checkNewDataButtonLabel",{defaultMessage:"Check for new data"}),mo=p.i18n.translate("xpack.infra.inventoryTimeline.retryButtonLabel",{defaultMessage:"Try again"}),po=p.i18n.translate("xpack.infra.showHistory",{defaultMessage:"Show history"}),go=p.i18n.translate("xpack.infra.hideHistory",{defaultMessage:"Hide history"}),fo=({measureRef:e,width:t,interval:a,formatter:i,children:s})=>{const{timelineOpen:l,changeTimelineOpen:o}=Object(da.d)(),[c,u]=Object(r.useState)(Boolean(l));Object(r.useEffect)((()=>{c!==l&&u(Boolean(l))}),[c,l]);const d=Object(b.useUiTracker)({app:"infra_metrics"}),m=Object(r.useCallback)((()=>{c||d({metric:"open_timeline_drawer__inventory"}),u(!c),o(!c)}),[c,d,o]);return n.a.createElement(bo,{ref:c?e:null,isOpen:c,outerWidth:t},n.a.createElement(ho,{ref:c?null:e},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(yo,{"aria-expanded":c,iconType:c?"arrowDown":"arrowRight",onClick:m,"data-test-subj":"toggleTimelineButton"},c?go:po))),n.a.createElement(g.EuiFlexGroup,{style:{marginTop:0}},n.a.createElement(ro,{isVisible:c,interval:a,yAxisFormatter:i})))},bo=B.euiStyled.div`
  padding: ${e=>e.theme.eui.euiSizeM} 0;
  position: fixed;
  bottom: 0;
  right: 0;
  transition: transform ${300}ms;
  transform: translateY(${e=>e.isOpen?0:"224px"});
  width: ${e=>e.outerWidth+34}px;
`,ho=Object(B.euiStyled)(g.EuiFlexGroup).attrs({justifyContent:"spaceBetween",alignItems:"center"})`
 margin-bottom: 0;
 height: 48px;
`,yo=Object(B.euiStyled)(g.EuiButtonEmpty).attrs({size:"s"})`
  width: 140px;
`,Eo=e=>({min:100*e.min,max:100*(e.max||1)}),vo=({label:e,color:t})=>n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiColorPickerSwatch,{color:t})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"xs"},n.a.createElement("strong",null,e)))),xo=({steps:e,palette:t,reverse:a})=>{const r=Zl(t,e,a);return n.a.createElement(Oo,null,r.map((e=>n.a.createElement(ko,{key:e,style:{backgroundColor:e}}))))},ko=B.euiStyled.div`
  max-width: 15px;
  height: 12px;
  flex: 1 1 auto;
  &:first-child {
    border-radius: ${e=>e.theme.eui.euiBorderRadius} 0 0 ${e=>e.theme.eui.euiBorderRadius};
  }
  &:last-child {
    border-radius: 0 ${e=>e.theme.eui.euiBorderRadius} ${e=>e.theme.eui.euiBorderRadius} 0;
`,Oo=B.euiStyled.div`
  display: flex;
`,Mo=["temperature","status","cool","warm","positive","negative"].map((e=>({text:ae.e[e],value:e}))),wo=({autoBounds:e,boundsOverride:t,onChange:a,dataBounds:i,options:s})=>{const[l,o]=Object(r.useState)(!1),[c,u]=Object(r.useState)(e),[d,m]=Object(r.useState)(s),[f,b]=Object(r.useState)(Eo(t));Object(r.useEffect)((()=>{c&&b(Eo(i))}),[e,i,c,a,s]);const h=n.a.createElement(g.EuiButtonIcon,{iconType:"color",color:"text",display:"base",size:"s","aria-label":p.i18n.translate("xpack.infra.legendControls.buttonLabel",{defaultMessage:"configure legend"}),onClick:()=>o(!0),"data-test-subj":"openLegendControlsButton"}),y=Object(r.useCallback)((e=>{const a=e.target.checked;u(a),a||b(Eo(t))}),[t]),E=Object(r.useCallback)((e=>{m((t=>({...t,reverseColors:e.target.checked})))}),[m]),v=Object(r.useCallback)((e=>{const t=parseFloat(e.currentTarget.value),a=t<=f.min?f.min+1:t>100?100:t;b({...f,max:a})}),[f]),x=Object(r.useCallback)((e=>{const t=parseFloat(e.currentTarget.value),a=t>=f.max?f.max-1:t<0?0:t;b({...f,min:a})}),[f]),k=Object(r.useCallback)((()=>{a({auto:c,bounds:{min:f.min/100,max:f.max/100},legend:d}),o(!1)}),[a,c,f,d]),O=Object(r.useCallback)((()=>{b(Eo(t)),u(e),m(s),o(!1)}),[e,t,s]),M=Object(r.useCallback)((e=>{const t=parseInt(e.target.value,10);m((e=>({...e,steps:t})))}),[m]),w=Object(r.useCallback)((e=>{const t=e.target.value;m((e=>({...e,palette:t})))}),[m]),j=c===e&&100*t.min===f.min&&100*t.max===f.max&&s.steps===d.steps&&s.reverseColors===d.reverseColors&&s.palette===d.palette,S=f.min<f.max,C=Zl(d.palette,d.steps,d.reverseColors),T=S?[]:[p.i18n.translate("xpack.infra.legnedControls.boundRangeError",{defaultMessage:"Minimum must be smaller than the maximum"})];return n.a.createElement(g.EuiPopover,{isOpen:l,closePopover:O,id:"legendControls",button:h,anchorPosition:"leftCenter","data-test-subj":"legendControls"},n.a.createElement(g.EuiPopoverTitle,null,"Legend Options"),n.a.createElement(jo,null,n.a.createElement(g.EuiFormRow,{display:"columnCompressed",label:p.i18n.translate("xpack.infra.legendControls.colorPaletteLabel",{defaultMessage:"Color palette"})},n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSelect,{options:Mo,value:d.palette,id:"palette",onChange:w,compressed:!0,"data-test-subj":"legendControlsPalette"}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(xo,{palette:d.palette,steps:d.steps,reverse:d.reverseColors}))),n.a.createElement(g.EuiFormRow,{display:"columnCompressed",label:p.i18n.translate("xpack.infra.legendControls.stepsLabel",{defaultMessage:"Number of colors"})},n.a.createElement(g.EuiRange,{id:"steps",min:2,max:18,step:1,value:d.steps,onChange:M,showValue:!0,fullWidth:!0})),n.a.createElement(g.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:p.i18n.translate("xpack.infra.legendControls.reverseDirectionLabel",{defaultMessage:"Reverse direction"})},n.a.createElement(g.EuiSwitch,{showLabel:!1,name:"reverseColors",label:"reverseColors",checked:d.reverseColors,onChange:E,compressed:!0,style:{position:"relative",top:"8px"}})),n.a.createElement(g.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:p.i18n.translate("xpack.infra.legendControls.switchLabel",{defaultMessage:"Auto calculate range"})},n.a.createElement(g.EuiSwitch,{showLabel:!1,name:"bounds",label:"bounds",checked:c,onChange:y,compressed:!0,style:{position:"relative",top:"8px"}})),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(vo,{color:Object(R.first)(C),label:p.i18n.translate("xpack.infra.legendControls.minLabel",{defaultMessage:"Minimum"})}),isInvalid:!S,display:"columnCompressed",error:T},n.a.createElement("div",{style:{maxWidth:150}},n.a.createElement(g.EuiFieldNumber,{disabled:c,step:1,value:isNaN(f.min)?"":f.min,isInvalid:!S,name:"legendMin",onChange:x,append:"%",compressed:!0}))),n.a.createElement(g.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:n.a.createElement(vo,{color:Object(R.last)(C),label:p.i18n.translate("xpack.infra.legendControls.maxLabel",{defaultMessage:"Maximum"})}),isInvalid:!S,error:T},n.a.createElement("div",{style:{maxWidth:150}},n.a.createElement(g.EuiFieldNumber,{disabled:c,step:1,isInvalid:!S,value:isNaN(f.max)?"":f.max,name:"legendMax",onChange:v,append:"%",compressed:!0}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexEnd",responsive:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{type:"submit",size:"s",onClick:O},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.legendControls.cancelButton",defaultMessage:"Cancel"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{type:"submit",size:"s",fill:!0,disabled:j||!S,onClick:k,"data-test-subj":"applyLegendControlsButton"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.legendControls.applyButton",defaultMessage:"Apply"}))))))},jo=Object(B.euiStyled)(g.EuiForm)`
  min-width: 400px;
  @media (max-width: 480px) {
    min-width: 100%;
    max-width: 100%;
    width: 100vw;
  }
`,So=n.a.memo((({shouldLoadDefault:e,currentView:t,reload:a,interval:i,nodes:s,loading:l})=>{var o,c,u;const[d,m]=Object(r.useState)(!0),{metric:p,groupBy:f,sort:b,nodeType:h,changeView:y,view:E,autoBounds:v,boundsOverride:x,legend:k,changeBoundsOverride:O,changeAutoBounds:M,changeLegend:w}=Object(da.d)(),{currentTime:j,jumpToTime:S,isAutoReloading:C}=Ot(),{applyFilterQuery:T}=_t(),F=null!==(o=null==k?void 0:k.palette)&&void 0!==o?o:da.a.palette,L=null!==(c=null==k?void 0:k.steps)&&void 0!==c?c:da.a.steps,P=null!==(u=null==k?void 0:k.reverseColors)&&void 0!==u?u:da.a.reverseColors,D={formatter:ae.b.percent,formatTemplate:"{{value}}",legend:Yl(F,L,P),metric:p,sort:b,groupBy:f};$t()((()=>{l||S(Date.now())}),C?5e3:null);const I=Ds(s),_=v?I:x,B=Object(r.useCallback)(Object(oa.a)(D.metric),[D.metric]),{onViewChange:R}=qi();Object(r.useEffect)((()=>{t&&R(t)}),[t,R]),Object(r.useEffect)((()=>{null==t&&e||a()}),[a,e]),Object(r.useEffect)((()=>{m(!0)}),[D.metric,h]),Object(r.useEffect)((()=>{const e=s&&s.length;m(!e)}),[s]);const A=Object(r.useCallback)((e=>{O(e.bounds),M(e.auto),w(e.legend)}),[O,M,w]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(al.b,null,n.a.createElement(qt.a,{bounds:!0},(({measureRef:e,bounds:{width:t=0}})=>n.a.createElement(Co,{ref:e},n.a.createElement(qt.a,{bounds:!0},(({measureRef:e,bounds:{height:r=0}})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(To,{ref:e},n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center",gutterSize:"m"},n.a.createElement(Wl,{nodeType:h,currentTime:j}),n.a.createElement(g.EuiFlexGroup,{responsive:!1,style:{margin:0,justifyContent:"end"}},"map"===E&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(wo,{options:null!=k?k:da.a,dataBounds:I,bounds:_,autoBounds:v,boundsOverride:x,onChange:A})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Ql,{view:E,onChange:y}))))),n.a.createElement(qt.a,{bounds:!0},(({measureRef:e,bounds:{height:o=0}})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Ys,{nodes:s,options:D,nodeType:h,loading:l,showLoading:d,reload:a,onDrilldown:T,currentTime:j,view:E,autoBounds:v,boundsOverride:x,formatter:B,bottomMargin:o,topMargin:r}),"map"===E&&n.a.createElement(fo,{measureRef:e,interval:i,formatter:B,width:t}))))))))))))})),Co=B.euiStyled.div`
  position: relative;
  flex: 1 1 auto;
`,To=B.euiStyled.div`
  padding: ${e=>`12px ${e.theme.eui.euiSizeM}`};
`,Fo=e=>{const{shouldLoadDefault:t,currentView:a}=Ze();return n.a.createElement(So,m()({shouldLoadDefault:t,currentView:a},e))},Lo=()=>{const{viewState:e}=qi();return n.a.createElement(ot,{viewState:e})},Po=({render:e})=>{const{sourceId:t}=Object(w.b)(),{metric:a,groupBy:r,nodeType:n,accountId:i,region:s}=Object(da.d)(),{currentTime:l}=Ot(),{filterQueryAsJson:o}=_t(),{loading:c,nodes:u,reload:d,interval:m}=Object(la.a)(o,[a],r,n,t,l,i,s,!1);return e({loading:c,nodes:u,reload:d,interval:m})};var Do=a(202);const Io=()=>{const{hasFailedLoadingSource:e,isLoading:t,loadSourceFailureMessage:a,loadSource:r,source:i,metricIndicesExist:s}=Object(w.b)();Object(b.useTrackPageview)({app:"infra_metrics",path:"inventory"}),Object(b.useTrackPageview)({app:"infra_metrics",path:"inventory",delay:15e3});const{source:l}=Object(da.d)();return F([{text:T.d}]),n.a.createElement(g.EuiErrorBoundary,null,t&&!i?n.a.createElement(zt.a,null):s?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:dt.APP_WRAPPER_CLASS},n.a.createElement(Xe,{shouldLoadDefault:"default"===l,viewType:"inventory-view",defaultViewState:$i},n.a.createElement(at,{hasData:s,pageHeader:{pageTitle:T.d,rightSideItems:[n.a.createElement(Lo,null)]},pageSectionProps:{contentProps:{css:Do.a}}},n.a.createElement(Po,{render:({loading:e,nodes:t,reload:a,interval:r})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Rt,{interval:r}),n.a.createElement(Fo,{loading:e,nodes:t,reload:a,interval:r}))}))))):e?n.a.createElement(Vt,{errorMessage:a||"",retry:r}):n.a.createElement(at,{hasData:s,"data-test-subj":"noMetricsIndicesPrompt"}))};var _o=a(155);const Bo=_e.intersection([_e.type({timestamp:_e.number}),_e.partial({value:_e.union([_e.number,_e.null])})]),Ro=_e.type({id:_e.string,label:_e.string,data:_e.array(Bo)}),Ao=_e.intersection([_e.partial({id:_e.union([sa.a,_e.null])}),_e.type({series:_e.array(Ro)})]),No=_e.type({metrics:_e.array(Ao)});_e.intersection([_e.type({nodeType:sa.c,nodeId:_e.string,metrics:_e.array(sa.a),timerange:sl.a,sourceId:_e.string}),_e.partial({cloudId:_e.union([_e.string,_e.null])})]);const Vo=({loading:e,name:t,items:a})=>{const[i,s]=Object(r.useState)(!1),l=Object(r.useCallback)((()=>{s(!i)}),[i]),o=e?null:n.a.createElement(g.EuiSideNav,{items:a}),c=e?null:n.a.createElement(g.EuiSideNav,{items:a,mobileTitle:t,toggleOpenOnMobile:l,isOpenOnMobile:i});return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiHideFor,{sizes:["xs","s","m"]},n.a.createElement(g.EuiPageSideBar_Deprecated,{sticky:!0},o)),n.a.createElement(g.EuiShowFor,{sizes:["xs","s","m"]},n.a.createElement(g.EuiPageSideBar_Deprecated,null,c)))},zo=e=>{const[t]=Object($.a)(Oe.UI_SETTINGS.TIMEPICKER_QUICK_RANGES),{onChangeTimeRange:a,onRefresh:i,currentTimeRange:s,isLiveStreaming:l,refreshInterval:o,setAutoReload:c,setRefreshInterval:u}=e,d=Fe(t),m=Object(r.useCallback)((({start:e,end:t})=>{a({from:e,to:t,interval:">=1m"})}),[a]),p=Object(r.useCallback)((({isPaused:e,refreshInterval:t})=>{e?c(!1):(u(t),c(!0))}),[c,u]);return n.a.createElement(Uo,null,n.a.createElement(g.EuiSuperDatePicker,{start:s.from.toString(),end:s.to.toString(),isPaused:!l,refreshInterval:o||0,onTimeChange:m,onRefreshChange:p,onRefresh:i,commonlyUsedRanges:d}))},Uo=B.euiStyled.div`
  max-width: 750px;
`,$o=n.a.createContext({items:[],addNavItem:e=>{}});var qo=a(136);const Ho=e=>"bar"===e.type?n.a.createElement(Jo,e):n.a.createElement(Go,e),Go=({id:e,color:t,series:a,name:r,type:i,stack:s})=>{const l=Object(qo.a)(),o={area:{opacity:1,visible:"area"===i},line:{strokeWidth:"area"===i?1:2,visible:!0}};return n.a.createElement(_.AreaSeries,{id:e,name:r,xScaleType:_.ScaleType.Time,yScaleType:_.ScaleType.Linear,xAccessor:"timestamp",yAccessors:["value"],data:a.data,areaSeriesStyle:o,color:t||void 0,stackAccessors:s?["timestamp"]:void 0,timeZone:l})},Jo=({id:e,color:t,series:a,name:r,stack:i})=>{const s=Object(qo.a)(),l={rectBorder:{stroke:t||void 0,strokeWidth:1,visible:!0},rect:{opacity:1}};return n.a.createElement(_.BarSeries,{id:e,name:r,xScaleType:_.ScaleType.Time,yScaleType:_.ScaleType.Linear,xAccessor:"timestamp",yAccessors:["value"],data:a.data,barSeriesStyle:l,color:t||void 0,stackAccessors:i?["timestamp"]:void 0,timeZone:s})};var Wo=a(468),Ko=a.n(Wo);const Qo=e=>e.data.length<2,Xo=(e,t,a)=>e?Object(R.get)(e,[t,"name"],a):a,Zo=(e,t)=>{const a=e?Object(R.get)(e,[t,"color"]):null;return a?new Ko.a(a).hex().toString():null},Yo=(e,t,a)=>{if(!e||!t)return"line";const r=Object(R.get)(e,[a,"type"]);return sa.b.is(r)?r:sa.b.is(t)?t:"line"},ec=({title:e,body:t})=>n.a.createElement(g.EuiEmptyPrompt,{iconType:"stats",title:n.a.createElement("h3",null,e),body:n.a.createElement("p",null,t)}),tc=({id:e,onChangeRangeTime:t,metric:a,stopLiveStreaming:i,isLiveStreaming:s,formatter:l,formatterTemplate:o,stacked:c,seriesOverrides:u,type:d})=>{const m=Object(f.useUiSetting)("theme:darkMode"),[b]=Object($.a)("dateFormat"),h=Object(r.useCallback)(((e="number",t="{{value}}")=>a=>null!=a?Object(ar.b)(e,t)(a):"")(l,o),[l,o]),y=Object(r.useMemo)((()=>null!=a?Object(_.niceTimeFormatter)((e=>{if(e.series.some(Qo))return[0,0];const t=e.series.reduce(((e,t)=>{const a=Object(R.first)(t.data),r=Object(R.last)(t.data);return e.concat([a&&a.timestamp||0,r&&r.timestamp||0])}),[]);return[Object(R.min)(t),Object(R.max)(t)]})(a)):void 0),[a]),E=Object(r.useCallback)((({x:e})=>{if(!e)return;const[a,r]=e;t&&(s&&i&&i(),t({from:N()(a).toISOString(),to:N()(r).toISOString(),interval:">=1m"}))}),[t,s,i]),v={headerFormatter:Object(r.useCallback)((e=>N()(e.value).format(b||"Y-MM-DD HH:mm:ss.SSS")),[b])};return e?a?a.series.some(Qo)?n.a.createElement(ec,{title:p.i18n.translate("xpack.infra.chartSection.notEnoughDataPointsToRenderTitle",{defaultMessage:"Not Enough Data"}),body:p.i18n.translate("xpack.infra.chartSection.notEnoughDataPointsToRenderText",{defaultMessage:"Not enough data points to render chart, try increasing the time range."})}):n.a.createElement(g.EuiPageContentBody_Deprecated,null,n.a.createElement("div",{className:"infrastructureChart",style:{height:250,marginBottom:16}},n.a.createElement(_.Chart,null,n.a.createElement(_.Axis,{id:"timestamp",position:_.Position.Bottom,showOverlappingTicks:!0,tickFormat:y}),n.a.createElement(_.Axis,{id:"values",position:_.Position.Left,tickFormat:h}),a&&a.series.map((t=>n.a.createElement(Ho,{key:`series-${e}-${t.id}`,id:`series-${e}-${t.id}`,series:t,name:Xo(u,t.id,t.id),type:Yo(u,d,t.id),color:Zo(u,t.id),stack:c}))),n.a.createElement(_.Settings,{tooltip:v,onBrushEnd:E,theme:V(m),showLegend:!0,showLegendExtra:!0,legendPosition:"right"})))):n.a.createElement(ec,{title:p.i18n.translate("xpack.infra.chartSection.missingMetricDataText",{defaultMessage:"Missing Data"}),body:p.i18n.translate("xpack.infra.chartSection.missingMetricDataBody",{defaultMessage:"The data for this chart is missing."})}):null},ac=Object(B.euiStyled)(g.EuiPageContent_Deprecated)`
  position: relative;
`,rc=n.a.createContext(null),nc=[{field:"cloud.instance.id",label:p.i18n.translate("xpack.infra.nodeDetails.labels.instanceId",{defaultMessage:"Instance ID"})},{field:"cloud.provider",label:p.i18n.translate("xpack.infra.nodeDetails.labels.cloudProvider",{defaultMessage:"Cloud Provider"})},{field:"host.os.name",label:p.i18n.translate("xpack.infra.nodeDetails.labels.operatinSystem",{defaultMessage:"Operating System"})},{field:"host.os.kernel",label:p.i18n.translate("xpack.infra.nodeDetails.labels.kernelVersion",{defaultMessage:"Kernel Version"})},{field:"host.hostname",label:p.i18n.translate("xpack.infra.nodeDetails.labels.hostname",{defaultMessage:"Hostname"})},{field:"host.containerized",label:p.i18n.translate("xpack.infra.nodeDetails.labels.containerized",{defaultMessage:"Containerized"}),isBoolean:!0},{field:"cloud.project.id",label:p.i18n.translate("xpack.infra.nodeDetails.labels.projectId",{defaultMessage:"Project ID"})},{field:"cloud.availability_zone",label:p.i18n.translate("xpack.infra.nodeDetails.labels.availabilityZone",{defaultMessage:"Availability Zone"})},{field:"cloud.machine.type",label:p.i18n.translate("xpack.infra.nodeDetails.labels.machineType",{defaultMessage:"Machine Type"})},{field:"cloud.instance.name",label:p.i18n.translate("xpack.infra.nodeDetails.labels.instanceName",{defaultMessage:"Instance Name"})}],ic=e=>{const[t,a]=Object(r.useState)(!1),i=Object(r.useCallback)((()=>a(!t)),[t]),s=Object(r.useMemo)((()=>e.fields&&e.fields.length?e.fields.map((e=>{const t=nc.find((t=>t.field===e));if(t)return t})).filter((e=>e)):nc),[e.fields]),l=Object(r.useMemo)((()=>t?s:s.slice(0,4)),[s,t]),o=Object(r.useContext)(rc);return o?n.a.createElement(sc,null,s.length>4?n.a.createElement(lc,null,n.a.createElement(g.EuiButtonIcon,{iconType:t?"arrowUp":"arrowDown",onClick:i,"aria-label":p.i18n.translate("xpack.infra.nodeDetails.labels.showMoreDetails",{defaultMessage:"Show more details"})})):null,n.a.createElement(g.EuiFlexGrid,{columns:4,style:{flexGrow:1},gutterSize:"s"},l.map((e=>n.a.createElement(g.EuiFlexItem,{key:e.field,style:{minWidth:0}},n.a.createElement(g.EuiTitle,{size:"xs"},n.a.createElement("h5",null,(({field:e})=>{const t=nc.find((t=>t.field===e));return t?t.label:e})(e))),n.a.createElement(g.EuiText,null,((e,{field:t,isBoolean:a})=>a?Object(R.get)(e.info,t,!1)?p.i18n.translate("xpack.infra.nodeDetails.yes",{defaultMessage:"Yes"}):p.i18n.translate("xpack.infra.nodeDetails.no",{defaultMessage:"No"}):Object(R.get)(e.info,t,"--"))(o,e))))))):null},sc=B.euiStyled.div`
border-top: ${e=>e.theme.eui.euiBorderWidthThin} solid ${e=>e.theme.eui.euiBorderColor};
border-bottom: ${e=>e.theme.eui.euiBorderWidthThin} solid ${e=>e.theme.eui.euiBorderColor};
padding: ${e=>e.theme.eui.euiSizeM} 0;
margin-bottom: ${e=>e.theme.eui.euiSizeM};
display: flex;
`,lc=B.euiStyled.div`
flex-grow: 0;
margin-right: ${e=>e.theme.eui.euiSizeM};
min-width: 0px;
`,oc=({children:e,metrics:t,navLabel:a,sectionLabel:i,onChangeRangeTime:s,isLiveStreaming:l,stopLiveStreaming:o})=>{const{addNavItem:c}=Object(r.useContext)($o),u=r.Children.toArray(e).reduce(((e,a)=>{var n;return Object(r.isValidElement)(a)?null===(null!==(n=null==t?void 0:t.find((e=>e.id===a.props.id)))&&void 0!==n?n:null)?e:a.props.label?[...e,{id:a.props.id,name:a.props.label,onClick:()=>{const e=document.getElementById(a.props.id);e&&e.scrollIntoView()}}]:e:e}),[]),d=r.Children.map(e,(e=>Object(r.isValidElement)(e)?Object(r.cloneElement)(e,{metrics:t,onChangeRangeTime:s,isLiveStreaming:l,stopLiveStreaming:o}):null));return t&&u.length?(c({id:a,name:a,items:u}),n.a.createElement("div",null,n.a.createElement(g.EuiTitle,null,n.a.createElement("h1",null,i)),d)):null},cc=({id:e,label:t,children:a,metrics:i,onChangeRangeTime:s,isLiveStreaming:l,stopLiveStreaming:o})=>{const c=Object(r.useMemo)((()=>null==i?void 0:i.find((t=>t.id===e))),[e,i]);if(!a||!c)return null;const u=r.Children.map(a,(t=>Object(r.isValidElement)(t)?Object(r.cloneElement)(t,{metric:c,id:e,onChangeRangeTime:s,isLiveStreaming:l,stopLiveStreaming:o}):null));return n.a.createElement("div",{style:{margin:"10px 0 16px 0"},id:e},t?n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h4",null,t)):null,u)},uc=Object(B.withTheme)((({metrics:e,theme:t,onChangeRangeTime:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(ic,{fields:["cloud.instance.id","cloud.provider","cloud.availability_zone","cloud.machine.type","cloud.instance.name","cloud.project.id"]}),n.a.createElement(ac,null,n.a.createElement(oc,{navLabel:"AWS EC2",sectionLabel:p.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Aws EC2 Overview"}),metrics:e,onChangeRangeTime:a},n.a.createElement(cc,{id:"awsEC2CpuUtilization",label:p.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.cpuUsageSection.sectionLabel",{defaultMessage:"CPU Usage"})},n.a.createElement(tc,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{total:{color:t.eui.euiColorVis1}}})),n.a.createElement(cc,{id:"awsEC2NetworkTraffic",label:p.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.networkTrafficSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(tc,{formatter:"bits",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{rx:{color:t.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.networkRxRateSeriesLabel",{defaultMessage:"in"})},tx:{color:t.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.networkTxRateSeriesLabel",{defaultMessage:"out"})}}})),n.a.createElement(cc,{id:"awsEC2DiskIOBytes",label:p.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.diskIOBytesSection.sectionLabel",{defaultMessage:"Disk IO (Bytes)"})},n.a.createElement(tc,{formatter:"bytes",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{write:{color:t.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.diskIOBytesSection.writeLabel",{defaultMessage:"writes"})},read:{color:t.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.ec2MetricsLayout.diskIOBytesSection.readLabel",{defaultMessage:"reads"})}}}))))))),dc=Object(B.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(ac,null,n.a.createElement(oc,{navLabel:"AWS RDS",sectionLabel:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Aws RDS Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(cc,{id:"awsRDSCpuTotal",label:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.cpuTotal.sectionLabel",{defaultMessage:"Total CPU Usage"})},n.a.createElement(tc,{type:"area",formatter:"percent",seriesOverrides:{cpu:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.cpuTotal.chartLabel",{defaultMessage:"Total"})}}})),n.a.createElement(cc,{id:"awsRDSConnections",label:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.connections.sectionLabel",{defaultMessage:"Connections"})},n.a.createElement(tc,{type:"bar",formatter:"number",seriesOverrides:{connections:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.connections.chartLabel",{defaultMessage:"Connections"})}}})),n.a.createElement(cc,{id:"awsRDSQueriesExecuted",label:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.queriesExecuted.sectionLabel",{defaultMessage:"Queries Executed"})},n.a.createElement(tc,{type:"bar",formatter:"number",seriesOverrides:{queries:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.queriesExecuted.chartLabel",{defaultMessage:"Queries"})}}})),n.a.createElement(cc,{id:"awsRDSActiveTransactions",label:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.activeTransactions.sectionLabel",{defaultMessage:"Transactions"})},n.a.createElement(tc,{type:"bar",formatter:"number",seriesOverrides:{active:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.active.chartLabel",{defaultMessage:"Active"})},blocked:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.blocked.chartLabel",{defaultMessage:"Blocked"})}}})),n.a.createElement(cc,{id:"awsRDSLatency",label:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.sectionLabel",{defaultMessage:"Latency"})},n.a.createElement(tc,{type:"bar",stacked:!0,formatter:"highPrecision",formatterTemplate:"{{value}} ms",seriesOverrides:{read:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.read.chartLabel",{defaultMessage:"Read"})},write:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.write.chartLabel",{defaultMessage:"Write"})},insert:{color:a.eui.euiColorVis0,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.insert.chartLabel",{defaultMessage:"Insert"})},update:{color:a.eui.euiColorVis7,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.update.chartLabel",{defaultMessage:"Update"})},commit:{color:a.eui.euiColorVis3,name:p.i18n.translate("xpack.infra.metricDetailPage.rdsMetricsLayout.latency.commit.chartLabel",{defaultMessage:"Commit"})}}}))))))),mc=Object(B.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(ac,null,n.a.createElement(oc,{navLabel:"AWS S3",sectionLabel:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Aws S3 Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(cc,{id:"awsS3BucketSize",label:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.bucketSize.sectionLabel",{defaultMessage:"Bucket Size"})},n.a.createElement(tc,{type:"bar",formatter:"bytes",seriesOverrides:{bytes:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.bucketSize.chartLabel",{defaultMessage:"Total Bytes"})}}})),n.a.createElement(cc,{id:"awsS3NumberOfObjects",label:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.numberOfObjects.sectionLabel",{defaultMessage:"Number of Objects"})},n.a.createElement(tc,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{objects:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.numberOfObjects.chartLabel",{defaultMessage:"Objects"})}}})),n.a.createElement(cc,{id:"awsS3TotalRequests",label:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.totalRequests.sectionLabel",{defaultMessage:"Total Requests"})},n.a.createElement(tc,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{total:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.totalRequests.chartLabel",{defaultMessage:"Requests"})}}})),n.a.createElement(cc,{id:"awsS3DownloadBytes",label:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.downloadBytes.sectionLabel",{defaultMessage:"Downloaded Bytes"})},n.a.createElement(tc,{type:"bar",formatter:"bytes",seriesOverrides:{bytes:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.downloadBytes.chartLabel",{defaultMessage:"Bytes"})}}})),n.a.createElement(cc,{id:"awsS3UploadBytes",label:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.uploadBytes.sectionLabel",{defaultMessage:"Uploaded Bytes"})},n.a.createElement(tc,{type:"bar",formatter:"bytes",seriesOverrides:{bytes:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.s3MetricsLayout.uploadBytes.chartLabel",{defaultMessage:"Bytes"})}}}))))))),pc=Object(B.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(ac,null,n.a.createElement(oc,{navLabel:"AWS SQS",sectionLabel:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Aws SQS Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(cc,{id:"awsSQSMessagesVisible",label:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesVisible.sectionLabel",{defaultMessage:"Messages Available"})},n.a.createElement(tc,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{visible:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesVisible.chartLabel",{defaultMessage:"Available"})}}})),n.a.createElement(cc,{id:"awsSQSMessagesDelayed",label:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesDelayed.sectionLabel",{defaultMessage:"Messages Delayed"})},n.a.createElement(tc,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{delayed:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesDelayed.chartLabel",{defaultMessage:"Delayed"})}}})),n.a.createElement(cc,{id:"awsSQSMessagesSent",label:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesSent.sectionLabel",{defaultMessage:"Messages Added"})},n.a.createElement(tc,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{sent:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesSent.chartLabel",{defaultMessage:"Added"})}}})),n.a.createElement(cc,{id:"awsSQSMessagesEmpty",label:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesEmpty.sectionLabel",{defaultMessage:"Messages Empty"})},n.a.createElement(tc,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{sent:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.messagesEmpty.chartLabel",{defaultMessage:"Empty"})}}})),n.a.createElement(cc,{id:"awsSQSOldestMessage",label:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.oldestMessage.sectionLabel",{defaultMessage:"Oldest Message"})},n.a.createElement(tc,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{oldest:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.sqsMetricsLayout.oldestMessage.chartLabel",{defaultMessage:"Age"})}}}))))))),gc=({id:e,metric:t,seriesOverrides:a,formatter:r,formatterTemplate:i})=>t&&e?n.a.createElement(g.EuiPageContentBody_Deprecated,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(fc,null,t.series.map((t=>{const s=Object(R.last)(t.data);if(!s)return null;const l=((e="number",t="{{value}}",a={},r)=>n=>{if(null==n)return"";const i=Object(R.get)(a,[r,"formatter"],e),s=Object(R.get)(a,[r,"formatterTemplate"],t);return Object(ar.b)(i,s)(n)})(r,i,a,t.id),o=l(s.value||0),c=Xo(a,t.id,t.id),u=Object(R.max)(t.data.map((e=>e.value||0))),d=Object(R.get)(a,[t.id,"gaugeMax"],u);return n.a.createElement(g.EuiFlexItem,{key:`${e}-${t.id}`,style:{margin:"0.4rem"}},n.a.createElement(g.EuiPanel,{style:{minWidth:"160px"}},n.a.createElement(g.EuiText,{style:{textAlign:"right"},size:"s"},c),n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h1",{style:{textAlign:"right",whiteSpace:"nowrap"}},o)),n.a.createElement(g.EuiProgress,{value:s.value||0,max:d,size:"s",color:"primary"})))}))),n.a.createElement(g.EuiSpacer,{size:"m"})):null,fc=B.euiStyled.div`
  display: flex;
  flex-flow: row wrap;
  justify-content: space-evenly;
`,bc=Object(B.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(ic,null),n.a.createElement(ac,null,n.a.createElement(oc,{navLabel:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.layoutLabel",{defaultMessage:"Container"}),sectionLabel:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Container Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(cc,{id:"containerK8sOverview"},n.a.createElement(gc,{seriesOverrides:{cpu:{name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.cpuUsageSeriesLabel",{defaultMessage:"CPU Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},memory:{name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.memoryUsageSeriesLabel",{defaultMessage:"Memory Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1}}})),n.a.createElement(cc,{id:"containerOverview"},n.a.createElement(gc,{seriesOverrides:{cpu:{name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.cpuUsageSeriesLabel",{defaultMessage:"CPU Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},memory:{name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.memoryUsageSeriesLabel",{defaultMessage:"Memory Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},rx:{name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.inboundRXSeriesLabel",{defaultMessage:"Inbound (RX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"},tx:{name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.overviewSection.outboundTXSeriesLabel",{defaultMessage:"Outbound (TX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"}}})),n.a.createElement(cc,{id:"containerK8sCpuUsage",label:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.cpuUsageSection.sectionLabel",{defaultMessage:"CPU Usage"})},n.a.createElement(tc,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{cpu:{color:a.eui.euiColorVis1}}})),n.a.createElement(cc,{id:"containerK8sMemoryUsage",label:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.memoryUsageSection.sectionLabel",{defaultMessage:"Memory Usage"})},n.a.createElement(tc,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{memory:{color:a.eui.euiColorVis1}}})),n.a.createElement(cc,{id:"containerCpuUsage",label:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.cpuUsageSection.sectionLabel",{defaultMessage:"CPU Usage"})},n.a.createElement(tc,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{cpu:{color:a.eui.euiColorVis1}}})),n.a.createElement(cc,{id:"containerMemory",label:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.memoryUsageSection.sectionLabel",{defaultMessage:"Memory Usage"})},n.a.createElement(tc,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{memory:{color:a.eui.euiColorVis1}}})),n.a.createElement(cc,{id:"containerNetworkTraffic",label:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.networkTrafficSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(tc,{formatter:"bits",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{rx:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.networkTrafficSection.networkRxRateSeriesLabel",{defaultMessage:"in"})},tx:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.networkTrafficSection.networkTxRateSeriesLabel",{defaultMessage:"out"})}}})),n.a.createElement(cc,{id:"containerDiskIOOps",label:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoOpsSection.sectionLabel",{defaultMessage:"Disk IO (Ops)"})},n.a.createElement(tc,{type:"area",formatterTemplate:"{{value}}/s",formatter:"number",seriesOverrides:{read:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoOpsSection.readRateSeriesLabel",{defaultMessage:"reads"})},write:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoOpsSection.writeRateSeriesLabel",{defaultMessage:"writes"})}}})),n.a.createElement(cc,{id:"containerDiskIOBytes",label:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoBytesSection.sectionLabel",{defaultMessage:"Disk IO (Bytes)"})},n.a.createElement(tc,{type:"area",formatter:"bytes",formatterTemplate:"{{value}}/s",seriesOverrides:{read:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoBytesSection.readRateSeriesLabel",{defaultMessage:"reads"})},write:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.containerMetricsLayout.diskIoBytesSection.writeRateSeriesLabel",{defaultMessage:"writes"})}}}))))))),hc=Object(B.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(oc,{navLabel:"AWS",sectionLabel:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"AWS Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(cc,{id:"awsOverview"},n.a.createElement(gc,{seriesOverrides:{"cpu-util":{name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.cpuUtilizationSeriesLabel",{defaultMessage:"CPU Utilization"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},"status-check-failed":{name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.statusCheckFailedLabel",{defaultMessage:"Status check failed"}),color:a.eui.euiColorFullShade},"packets-in":{name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.networkPacketsInLabel",{defaultMessage:"Packets (in)"}),color:a.eui.euiColorFullShade,formatter:"number"},"packets-out":{name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.overviewSection.networkPacketsOutLabel",{defaultMessage:"Packets (out)"}),color:a.eui.euiColorFullShade,formatter:"number"}}})),n.a.createElement(cc,{id:"awsCpuUtilization",label:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.cpuUtilSection.sectionLabel",{defaultMessage:"CPU Utilization"})},n.a.createElement(tc,{type:"area",formatter:"number",seriesOverrides:{"cpu-util":{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.cpuUtilSection.percentSeriesLabel",{defaultMessage:"percent"})}}})),n.a.createElement(cc,{id:"awsNetworkBytes",label:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkBytesSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(tc,{type:"area",formatter:"bits",formatterTemplate:"{{value}}/s",seriesOverrides:{tx:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkBytesSection.txSeriesLabel",{defaultMessage:"out"})},rx:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkBytesSection.rxSeriesLabel",{defaultMessage:"in"})}}})),n.a.createElement(cc,{id:"awsNetworkPackets",label:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkPacketsSection.sectionLabel",{defaultMessage:"Network Packets (Average)"})},n.a.createElement(tc,{type:"area",formatter:"number",seriesOverrides:{"packets-out":{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkPacketsSection.packetsOutSeriesLabel",{defaultMessage:"out"})},"packets-in":{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.networkPacketsSection.packetsInSeriesLabel",{defaultMessage:"in"})}}})),n.a.createElement(cc,{id:"awsDiskioOps",label:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioOperationsSection.sectionLabel",{defaultMessage:"Disk I/O Operations"})},n.a.createElement(tc,{type:"area",formatter:"number",seriesOverrides:{writes:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioOperationsSection.writesSeriesLabel",{defaultMessage:"writes"})},reads:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioOperationsSection.readsSeriesLabel",{defaultMessage:"reads"})}}})),n.a.createElement(cc,{id:"awsDiskioBytes",label:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioBytesSection.sectionLabel",{defaultMessage:"Disk I/O Bytes"})},n.a.createElement(tc,{type:"area",formatter:"number",seriesOverrides:{writes:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioBytesSection.writesSeriesLabel",{defaultMessage:"writes"})},reads:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.awsMetricsLayout.diskioBytesSection.readsSeriesLabel",{defaultMessage:"reads"})}}})))))),yc=Object(B.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(oc,{navLabel:"Nginx",sectionLabel:"Nginx",metrics:e,onChangeRangeTime:t},n.a.createElement(cc,{id:"nginxHits",label:p.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.hitsSection.sectionLabel",{defaultMessage:"Hits"})},n.a.createElement(tc,{stacked:!0,type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{"200s":{color:a.eui.euiColorVis1},"300s":{color:a.eui.euiColorVis5},"400s":{color:a.eui.euiColorVis2},"500s":{color:a.eui.euiColorVis9}}})),n.a.createElement(cc,{id:"nginxRequestRate",label:p.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.requestRateSection.sectionLabel",{defaultMessage:"Request Rate"})},n.a.createElement(tc,{type:"area",formatter:"abbreviatedNumber",formatterTemplate:"{{value}}/s",seriesOverrides:{rate:{color:a.eui.euiColorVis1}}})),n.a.createElement(cc,{id:"nginxActiveConnections",label:p.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.activeConnectionsSection.sectionLabel",{defaultMessage:"Active Connections"})},n.a.createElement(tc,{type:"area",formatter:"abbreviatedNumber",seriesOverrides:{connections:{color:a.eui.euiColorVis1,type:"bar"}}})),n.a.createElement(cc,{id:"nginxRequestsPerConnection",label:p.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.requestsPerConnectionsSection.sectionLabel",{defaultMessage:"Requests per Connections"})},n.a.createElement(tc,{type:"bar",formatter:"abbreviatedNumber",seriesOverrides:{reqPerConns:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.nginxMetricsLayout.requestsPerConnectionsSection.reqsPerConnSeriesLabel",{defaultMessage:"reqs per conn"})}}})))))),Ec=Object(B.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(ic,{fields:["host.hostname","host.os.name","host.os.kernel","host.containerized","cloud.provider","cloud.availability_zone","cloud.machine.type","cloud.project.id","cloud.instance.id","cloud.instance.name"]}),n.a.createElement(ac,null,n.a.createElement(oc,{navLabel:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.layoutLabel",{defaultMessage:"Host"}),sectionLabel:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Host Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(cc,{id:"hostSystemOverview"},n.a.createElement(gc,{seriesOverrides:{cpu:{name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.cpuUsageSeriesLabel",{defaultMessage:"CPU Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},load:{name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.loadSeriesLabel",{defaultMessage:"Load (5m)"}),color:a.eui.euiColorFullShade},memory:{name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.memoryCapacitySeriesLabel",{defaultMessage:"Memory Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},rx:{name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.inboundRXSeriesLabel",{defaultMessage:"Inbound (RX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"},tx:{name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.overviewSection.outboundTXSeriesLabel",{defaultMessage:"Outbound (TX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"}}})),n.a.createElement(cc,{id:"hostCpuUsage",label:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.cpuUsageSection.sectionLabel",{defaultMessage:"CPU Usage"})},n.a.createElement(tc,{stacked:!0,type:"area",formatter:"percent",seriesOverrides:{user:{color:a.eui.euiColorVis0},system:{color:a.eui.euiColorVis2},steal:{color:a.eui.euiColorVis9},irq:{color:a.eui.euiColorVis4},softirq:{color:a.eui.euiColorVis6},iowait:{color:a.eui.euiColorVis7},nice:{color:a.eui.euiColorVis5}}})),n.a.createElement(cc,{id:"hostLoad",label:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.loadSection.sectionLabel",{defaultMessage:"Load"})},n.a.createElement(tc,{seriesOverrides:{load_1m:{color:a.eui.euiColorVis0,name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.loadSection.oneMinuteSeriesLabel",{defaultMessage:"1m"})},load_5m:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.loadSection.fiveMinuteSeriesLabel",{defaultMessage:"5m"})},load_15m:{color:a.eui.euiColorVis3,name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.loadSection.fifteenMinuteSeriesLabel",{defaultMessage:"15m"})}}})),n.a.createElement(cc,{id:"hostMemoryUsage",label:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.memoryUsageSection.sectionLabel",{defaultMessage:"Memory Usage"})},n.a.createElement(tc,{stacked:!0,formatter:"bytes",type:"area",seriesOverrides:{used:{color:a.eui.euiColorVis2},free:{color:a.eui.euiColorVis0},cache:{color:a.eui.euiColorVis1}}})),n.a.createElement(cc,{id:"hostNetworkTraffic",label:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(tc,{formatter:"bits",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{rx:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.networkRxRateSeriesLabel",{defaultMessage:"in"})},tx:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.hostMetricsLayout.networkTrafficSection.networkTxRateSeriesLabel",{defaultMessage:"out"})}}}))),n.a.createElement(oc,{navLabel:"Kubernetes",sectionLabel:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Kubernetes Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(cc,{id:"hostK8sOverview"},n.a.createElement(gc,{seriesOverrides:{cpucap:{name:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.cpuUsageSeriesLabel",{defaultMessage:"CPU Capacity"}),color:"success",formatter:"percent",gaugeMax:1},load:{name:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.loadSeriesLabel",{defaultMessage:"Load (5m)"}),color:"success"},memorycap:{name:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.memoryUsageSeriesLabel",{defaultMessage:"Memory Capacity"}),color:"success",formatter:"percent",gaugeMax:1},podcap:{name:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.podCapacitySeriesLabel",{defaultMessage:"Pod Capacity"}),color:"success",formatter:"percent",gaugeMax:1},diskcap:{name:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.overviewSection.diskCapacitySeriesLabel",{defaultMessage:"Disk Capacity"}),color:"success",formatter:"percent",gaugeMax:1}}})),n.a.createElement(cc,{id:"hostK8sCpuCap",label:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.nodeCpuCapacitySection.sectionLabel",{defaultMessage:"Node CPU Capacity"})},n.a.createElement(tc,{formatter:"abbreviatedNumber",seriesOverrides:{capacity:{color:a.eui.euiColorVis2},used:{color:a.eui.euiColorVis1,type:"area"}}})),n.a.createElement(cc,{id:"hostK8sMemoryCap",label:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.nodeMemoryCapacitySection.sectionLabel",{defaultMessage:"Node Memory Capacity"})},n.a.createElement(tc,{formatter:"bytes",seriesOverrides:{capacity:{color:a.eui.euiColorVis2},used:{color:a.eui.euiColorVis1,type:"area"}}})),n.a.createElement(cc,{id:"hostK8sDiskCap",label:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.nodeDiskCapacitySection.sectionLabel",{defaultMessage:"Node Disk Capacity"})},n.a.createElement(tc,{formatter:"bytes",seriesOverrides:{capacity:{color:a.eui.euiColorVis2},used:{color:a.eui.euiColorVis1,type:"area"}}})),n.a.createElement(cc,{id:"hostK8sPodCap",label:p.i18n.translate("xpack.infra.metricDetailPage.kubernetesMetricsLayout.nodePodCapacitySection.sectionLabel",{defaultMessage:"Node Pod Capacity"})},n.a.createElement(tc,{formatter:"number",seriesOverrides:{capacity:{color:a.eui.euiColorVis2},used:{color:a.eui.euiColorVis1,type:"area"}}}))),n.a.createElement(hc,{metrics:e,onChangeRangeTime:t}),n.a.createElement(yc,{metrics:e,onChangeRangeTime:t}))))),vc=Object(B.withTheme)((({metrics:e,onChangeRangeTime:t,theme:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(ic,null),n.a.createElement(ac,null,n.a.createElement(oc,{navLabel:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.layoutLabel",{defaultMessage:"Pod"}),sectionLabel:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.sectionLabel",{defaultMessage:"Pod Overview"}),metrics:e,onChangeRangeTime:t},n.a.createElement(cc,{id:"podOverview"},n.a.createElement(gc,{seriesOverrides:{cpu:{name:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.cpuUsageSeriesLabel",{defaultMessage:"CPU Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},memory:{name:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.memoryUsageSeriesLabel",{defaultMessage:"Memory Usage"}),color:a.eui.euiColorFullShade,formatter:"percent",gaugeMax:1},rx:{name:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.inboundRXSeriesLabel",{defaultMessage:"Inbound (RX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"},tx:{name:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.overviewSection.outboundTXSeriesLabel",{defaultMessage:"Outbound (TX)"}),color:a.eui.euiColorFullShade,formatter:"bits",formatterTemplate:"{{value}}/s"}}})),n.a.createElement(cc,{id:"podCpuUsage",label:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.cpuUsageSection.sectionLabel",{defaultMessage:"CPU Usage"})},n.a.createElement(tc,{formatter:"percent",type:"area",seriesOverrides:{cpu:{color:a.eui.euiColorVis1}}})),n.a.createElement(cc,{id:"podMemoryUsage",label:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.memoryUsageSection.sectionLabel",{defaultMessage:"Memory Usage"})},n.a.createElement(tc,{type:"area",formatter:"percent",seriesOverrides:{memory:{color:a.eui.euiColorVis1}}})),n.a.createElement(cc,{id:"podNetworkTraffic",label:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.networkTrafficSection.sectionLabel",{defaultMessage:"Network Traffic"})},n.a.createElement(tc,{formatter:"bits",formatterTemplate:"{{value}}/s",type:"area",seriesOverrides:{rx:{color:a.eui.euiColorVis1,name:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.networkTrafficSection.networkRxRateSeriesLabel",{defaultMessage:"in"})},tx:{color:a.eui.euiColorVis2,name:p.i18n.translate("xpack.infra.metricDetailPage.podMetricsLayout.networkTrafficSection.networkTxRateSeriesLabel",{defaultMessage:"out"})}}}))),n.a.createElement(yc,{metrics:e,onChangeRangeTime:t}))))),xc=({inventoryItemType:e,...t})=>{switch(e){case"awsEC2":return n.a.createElement(uc,t);case"awsRDS":return n.a.createElement(dc,t);case"awsS3":return n.a.createElement(mc,t);case"awsSQS":return n.a.createElement(pc,t);case"container":return n.a.createElement(bc,t);case"host":return n.a.createElement(Ec,t);case"pod":return n.a.createElement(vc,t)}},kc=({loading:e,refetch:t,type:a,metrics:r,onChangeRangeTime:i,isLiveStreaming:s,stopLiveStreaming:l})=>e?n.a.createElement(D.a,{height:"100vh",width:"auto",text:p.i18n.translate("xpack.infra.metrics.loadingNodeDataText",{defaultMessage:"Loading data"})}):!e&&r&&0===r.length?n.a.createElement(L.a,{titleText:p.i18n.translate("xpack.infra.metrics.emptyViewTitle",{defaultMessage:"There is no data to display."}),bodyText:p.i18n.translate("xpack.infra.metrics.emptyViewDescription",{defaultMessage:"Try adjusting your time or filter."}),refetchText:p.i18n.translate("xpack.infra.metrics.refetchButtonLabel",{defaultMessage:"Check for new data"}),onRefetch:t,testString:"metricsEmptyViewState"}):n.a.createElement(xc,{inventoryItemType:a,metrics:r,onChangeRangeTime:i,isLiveStreaming:s,stopLiveStreaming:l}),Oc=({"data-test-subj":e,app:t,children:a})=>{const r=Object(b.useLinkProps)({app:t,pathname:"/settings"});return n.a.createElement(g.EuiButton,m()({"data-test-subj":e,color:"primary"},r),a)},Mc=({nodeName:e})=>{const t=Object(b.useLinkProps)({app:"integrations",hash:"/browse"});return n.a.createElement(wc,{title:n.a.createElement("h2",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metrics.invalidNodeErrorTitle",defaultMessage:"Looks like {nodeName} isn't collecting any metrics data",values:{nodeName:e}})),body:n.a.createElement("p",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.metrics.invalidNodeErrorDescription",defaultMessage:"Double check your configuration"})),actions:n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiButton,m()({},t,{color:"primary",fill:!0}),n.a.createElement(P.FormattedMessage,{id:"xpack.infra.homePage.noMetricsIndicesInstructionsActionLabel",defaultMessage:"View setup instructions"}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(Oc,{app:"metrics","data-test-subj":"configureSourceButton"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.configureSourceActionLabel",defaultMessage:"Change source configuration"}))))})},wc=Object(B.euiStyled)(g.EuiEmptyPrompt)`
  align-self: center;
`;var jc=a(267);const Sc=({error:e,name:t})=>{var a;return(e=>{const{services:{chrome:t}}=Object(tt.b)();Object(r.useEffect)((()=>{const a=[{text:T.i},...e].reverse().map((e=>e.text));t.docTitle.change(a)}),[t,e])})([{text:T.b}]),n.a.createElement(n.a.Fragment,null,404===(null===(a=e.body)||void 0===a?void 0:a.statusCode)?n.a.createElement(Mc,{nodeName:t}):n.a.createElement(jc.b,{message:e.message}))},Cc=e=>{const t=H.a.parse(e.from.toString()),a=H.a.parse(e.to.toString(),{roundUp:!0});return{...e,from:t&&t.valueOf()||N()().subtract(1,"hour").valueOf(),to:a&&a.valueOf()||N()().valueOf()}},Tc=e=>{const{metricIndicesExist:t}=Object(w.b)(),[a,i]=Object(r.useState)(Cc(e.timeRange)),{metrics:s,loading:l,makeRequest:o,error:c}=function(e,t,a,r,n,i){const{error:s,loading:l,response:o,makeRequest:c}=Object(Ga.a)("/api/metrics/node_details","POST",JSON.stringify({metrics:e,nodeId:t,nodeType:a,timerange:n,cloudId:i,sourceId:r}),(e=>Object(Be.pipe)(No.decode(e),Object(Re.fold)(Object(Ha.c)(Ha.a),Ae.identity))));return{error:s,loading:l,metrics:o?o.metrics:[],makeRequest:c}}(e.requiredMetrics,e.nodeId,e.nodeType,e.sourceId,a,e.cloudId),u=Object(r.useCallback)((()=>{i(Cc(e.timeRange))}),[e.timeRange]);return Object(r.useEffect)((()=>{i(Cc(e.timeRange))}),[e.timeRange]),Object(r.useEffect)((()=>{o()}),[o,a]),c?n.a.createElement(Sc,{error:c,name:e.name}):n.a.createElement(at,{hasData:t,pageHeader:{pageTitle:e.name,rightSideItems:[n.a.createElement(zo,{currentTimeRange:e.timeRange,isLiveStreaming:e.isAutoReloading,refreshInterval:e.refreshInterval,setRefreshInterval:e.setRefreshInterval,onChangeTimeRange:e.setTimeRange,setAutoReload:e.setAutoReload,onRefresh:u})]}},n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Vo,{loading:e.metadataLoading,name:e.name,items:e.sideNav})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement($o.Provider,{value:{items:e.sideNav,addNavItem:e.addNavItem}},n.a.createElement(rc.Provider,{value:e.metadata},n.a.createElement(kc,{loading:!(s.length>0&&e.isAutoReloading)&&l,refetch:u,type:e.nodeType,metrics:s,onChangeRangeTime:e.setTimeRange,isLiveStreaming:e.isAutoReloading,stopLiveStreaming:()=>e.setAutoReload(!1)}))))))},Fc=(Lc=Object(B.withTheme)((({match:e})=>{const t=e.params.node,a=e.params.type,i=Object(ia.b)(a),{sourceId:s,metricIndicesExist:l}=Object(w.b)(),{timeRange:o,parsedTimeRange:c,setTimeRange:u,refreshInterval:d,setRefreshInterval:m,isAutoReloading:g,setAutoReload:f,triggerRefresh:h}=Object(_o.c)(),{name:y,filteredRequiredMetrics:E,loading:v,cloudId:x,metadata:k}=Cr(t,a,i.requiredMetrics,s,c),[O,M]=Object(r.useState)([]),j=n.a.useCallback((e=>{O.some((t=>t.id===e.id))||M([e,...O])}),[O]),S=Object(b.useLinkProps)({app:"metrics",pathname:"/inventory"});return F([{...S,text:T.d},{text:y}]),v&&!E.length?n.a.createElement(at,{hasData:l},n.a.createElement(D.a,{height:"100vh",width:"100%",text:p.i18n.translate("xpack.infra.metrics.loadingNodeDataText",{defaultMessage:"Loading data"})})):n.a.createElement(n.a.Fragment,null,k?n.a.createElement(Tc,{name:y,requiredMetrics:E,sourceId:s,timeRange:o,nodeType:a,nodeId:t,cloudId:x,metadataLoading:v,isAutoReloading:g,refreshInterval:d,sideNav:O,metadata:k,addNavItem:j,setRefreshInterval:m,setAutoReload:f,triggerRefresh:h,setTimeRange:u}):null)})),e=>n.a.createElement(g.EuiErrorBoundary,null,n.a.createElement(w.a,{sourceId:"default"},n.a.createElement(_o.a,null,n.a.createElement(Lc,e)))));var Lc;const Pc=({isLoading:e,readOnly:t,metricAliasFieldProps:a})=>n.a.createElement(g.EuiForm,null,n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.indicesSectionTitle",defaultMessage:"Indices"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.metricIndicesTitle",defaultMessage:"Metrics indices"})),description:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.metricIndicesDescription",defaultMessage:"Index pattern for matching indices that contain metrics data"})},n.a.createElement(g.EuiFormRow,{error:a.error,fullWidth:!0,helpText:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.metricIndicesRecommendedValue",defaultMessage:"The recommended value is {defaultValue}",values:{defaultValue:n.a.createElement(g.EuiCode,null,C.g)}}),isInvalid:a.isInvalid,label:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.metricIndicesLabel",defaultMessage:"Metrics indices"})},n.a.createElement(g.EuiFieldText,m()({"data-test-subj":"metricIndicesInput",fullWidth:!0,disabled:e,readOnly:t,isLoading:e},a))))),Dc=({isLoading:e,readOnly:t,anomalyThresholdFieldProps:a})=>n.a.createElement(g.EuiForm,null,n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.mlSectionTitle",defaultMessage:"Machine Learning"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.anomalyThresholdTitle",defaultMessage:"Anomaly Severity Threshold"})),description:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.anomalyThresholdDescription",defaultMessage:"Sets the minimum severity score required to show anomalies in the Metrics application."})},n.a.createElement(g.EuiFormRow,{error:a.error,fullWidth:!0,isInvalid:a.isInvalid,label:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.anomalyThresholdLabel",defaultMessage:"Minimum severity score"})},n.a.createElement(g.EuiRange,m()({min:0,max:100,"data-test-subj":"anomalyThresholdInput",showInput:!0,showTicks:!0,showRange:!0,tickInterval:20,"aria-label":"Minimum severity score",disabled:e,readOnly:t,isLoading:e},a))))),Ic=({isLoading:e,readOnly:t,nameFieldProps:a})=>n.a.createElement(g.EuiForm,null,n.a.createElement(g.EuiTitle,{size:"s","data-test-subj":"sourceConfigurationNameSectionTitle"},n.a.createElement("h3",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.nameSectionTitle",defaultMessage:"Name"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiDescribedFormGroup,{title:n.a.createElement("h4",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.nameLabel",defaultMessage:"Name"})),description:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.nameDescription",defaultMessage:"A descriptive name for the source configuration"})},n.a.createElement(g.EuiFormRow,{error:a.error,fullWidth:!0,isInvalid:a.isInvalid,label:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.nameLabel",defaultMessage:"Name"})},n.a.createElement(g.EuiFieldText,m()({"data-test-subj":"nameInput",fullWidth:!0,disabled:e,readOnly:t,isLoading:e},a))))),_c=({shouldAllowEdit:e})=>{F([{text:T.j}]);const{createSourceConfiguration:t,source:a,sourceExists:i,isLoading:s,isUninitialized:l,updateSourceConfiguration:o}=Object(w.b)(),{indicesConfigurationProps:c,errors:u,resetForm:d,isFormDirty:m,isFormValid:f,formState:h,formStateChanges:y}=Je(a&&a.configuration),E=Object(r.useCallback)((async()=>{i?await o(y):await t(h),d()}),[i,o,t,d,h,y]),v=e&&(!Boolean(a)||"internal"!==(null==a?void 0:a.origin)),{hasInfraMLCapabilities:x}=vn();return!s&&!l||a?n.a.createElement(at,{pageHeader:{pageTitle:T.j},"data-test-subj":"sourceConfigurationContent",restrictWidth:!0},n.a.createElement(b.Prompt,{prompt:m?p.i18n.translate("xpack.infra.sourceConfiguration.unsavedFormPrompt",{defaultMessage:"Are you sure you want to leave? Changes will be lost"}):void 0}),n.a.createElement(g.EuiPanel,{paddingSize:"l",hasShadow:!1,hasBorder:!0},n.a.createElement(Ic,{isLoading:s,nameFieldProps:c.name,readOnly:!v})),n.a.createElement(g.EuiSpacer,null),n.a.createElement(g.EuiPanel,{paddingSize:"l",hasShadow:!1,hasBorder:!0},n.a.createElement(Pc,{isLoading:s,metricAliasFieldProps:c.metricAlias,readOnly:!v})),n.a.createElement(g.EuiSpacer,null),x&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiPanel,{paddingSize:"l",hasShadow:!1,hasBorder:!0},n.a.createElement(Dc,{isLoading:s,readOnly:!v,anomalyThresholdFieldProps:c.anomalyThreshold})),n.a.createElement(g.EuiSpacer,null)),u.length>0?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiCallOut,{color:"danger"},n.a.createElement("ul",null,u.map(((e,t)=>n.a.createElement("li",{key:t},e))))),n.a.createElement(g.EuiSpacer,{size:"m"})):null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,null,v&&n.a.createElement(g.EuiFlexItem,null,s?n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{color:"primary",isLoading:!0,fill:!0},"Loading"))):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{"data-test-subj":"discardSettingsButton",color:"danger",iconType:"cross",isDisabled:s||!m,onClick:()=>{d()}},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.discardSettingsButtonLabel",defaultMessage:"Discard"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{"data-test-subj":"applySettingsButton",color:"primary",isDisabled:!m||!f,fill:!0,onClick:E},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.sourceConfiguration.applySettingsButtonLabel",defaultMessage:"Apply"})))))))):n.a.createElement(zt.a,null)},Bc=()=>{var e,t;const a=null===(e=Object(f.useKibana)().services.application)||void 0===e?void 0:e.capabilities;return n.a.createElement(g.EuiErrorBoundary,null,n.a.createElement(_c,{shouldAllowEdit:null==a||null===(t=a.infrastructure)||void 0===t?void 0:t.configureSource}))};var Rc=a(60),Ac=a.n(Rc);a(50);const Nc=Ie()((({metricAlias:e})=>{const[t,a]=Object(r.useState)(),{services:{dataViews:n,notifications:i}}=Object(f.useKibana)(),[s,l]=Object(Yr.c)({createPromise:e=>n.createAndSave(e),onResolve:e=>{a(e)},cancelPreviousOn:"creation"},[]),[o,c]=Object(Yr.c)({createPromise:t=>n.find(e,1),onResolve:e=>{a(e[0])},cancelPreviousOn:"creation"},[]),u=Object(r.useCallback)((async()=>{try{let t=(await c(e))[0];t||(t=await l({title:e,timeFieldName:"@timestamp"}))}catch(e){a(void 0)}}),[e,l,c]),d=Object(r.useMemo)((()=>"pending"===o.state||"pending"===s.state),[o.state,s.state]),m=Object(r.useMemo)((()=>"rejected"===o.state||"rejected"===s.state),[o.state,s.state]);return Object(r.useEffect)((()=>{u()}),[e,u]),Object(r.useEffect)((()=>{m&&i&&i.toasts.addDanger(p.i18n.translate("xpack.infra.hostsTable.errorOnCreateOrLoadDataview",{defaultMessage:"There was an error trying to load or create the Data View: {metricAlias}",values:{metricAlias:e}}))}),[m,i,e]),{metricsDataView:t,isDataViewLoading:d,hasFailedLoadingDataView:m}})),[Vc,zc]=Nc;var Uc,$c=a(146),qc=a.n($c),Hc=(new _e.Type("DefaultBooleanFalse",_e.boolean.is,(function(e,t){return null==e?_e.success(!1):_e.boolean.validate(e,t)}),_e.identity),new _e.Type("DefaultBooleanTrue",_e.boolean.is,(function(e,t){return null==e?_e.success(!0):_e.boolean.validate(e,t)}),_e.identity),new _e.Type("DefaultEmptyString",_e.string.is,(function(e,t){return null==e?_e.success(""):_e.string.validate(e,t)}),_e.identity),new _e.Type("DefaultStringArray",_e.array(_e.string).is,(function(e,t){return null==e?_e.success([]):_e.array(_e.string).validate(e,t)}),_e.identity),new _e.Type("DefaultStringBooleanFalse",_e.boolean.is,(function(e,t){return null==e?_e.success(!1):"string"==typeof e&&"true"===e.toLowerCase()?_e.success(!0):"string"==typeof e&&"false"===e.toLowerCase()?_e.success(!1):_e.boolean.validate(e,t)}),_e.identity)),Gc=new _e.Type("NonEmptyString",_e.string.is,(function(e,t){return"string"==typeof e&&""!==e.trim()?_e.success(e):_e.failure(e,t)}),_e.identity),Jc=(new _e.Type("DefaultUuid",_e.string.is,(function(e,t){return null==e?_e.success(Y.a.v4()):Gc.validate(e,t)}),_e.identity),new _e.Type("PositiveIntegerGreaterThanZero",_e.number.is,(function(e,t){return"number"==typeof e&&Number.isSafeInteger(e)&&e>=1?_e.success(e):_e.failure(e,t)}),_e.identity));_e.union([Jc,_e[void 0]]),new _e.Type("DefaultVersionNumber",Jc.is,(function(e,t){return null==e?_e.success(1):Jc.validate(e,t)}),_e.identity),new _e.Type("EmptyStringArray",_e.array(_e.string).is,(function(e,t){if(null==e)return _e.success([]);if("string"==typeof e&&""!==e.trim()){var a=e.trim().split(",").map((function(e){return e.trim()}));return a.some((function(e){return""===e}))?_e.failure(e,t):_e.success(a)}return _e.failure(e,t)}),String),new _e.Type("IsoDateString",_e.string.is,(function(e,t){if("string"!=typeof e)return _e.failure(e,t);try{return new Date(e).toISOString()===e?_e.success(e):_e.failure(e,t)}catch(a){return _e.failure(e,t)}}),_e.identity),_e.exact(_e.partial({overwrite:Hc,overwrite_exceptions:Hc,as_new_list:Hc})),new _e.Type("NonEmptyOrNullableStringArray",_e.array(_e.string).is,(function(e,t){var a=Array.isArray(e)&&e.some((function(e){return""===e})),r=Array.isArray(e)&&e.some((function(e){return"string"!=typeof e}));return Array.isArray(e)&&(a||r||0===e.length)?_e.failure(e,t):_e.array(_e.string).validate(e,t)}),_e.identity),new _e.Type("NonEmptyStringArray",_e.array(_e.string).is,(function(e,t){if("string"==typeof e&&""!==e.trim()){var a=e.trim().split(",").map((function(e){return e.trim()}));return a.some((function(e){return""===e}))?_e.failure(e,t):_e.success(a)}return _e.failure(e,t)}),String),new _e.Type("DefaultBooleanTrue",_e.boolean.is,(function(e,t){return null==e||"boolean"==typeof e&&!1===e?_e.success(!1):_e.failure(e,t)}),_e.identity),_e.keyof({included:null}),_e.keyof({equals:null}),function(e){e.EQUALS="equals"}(Uc||(Uc={})),new _e.Type("PositiveInteger",_e.number.is,(function(e,t){return"number"==typeof e&&Number.isSafeInteger(e)&&e>=0?_e.success(e):_e.failure(e,t)}),_e.identity),new _e.Type("StringToPositiveNumber",_e.number.is,(function(e,t){return Re.either.chain(_e.string.validate(e,t),(function(a){var r=+a;return 0===a.trim().length||isNaN(r)||r<=0?_e.failure(e,t):_e.success(r)}))}),String),a(189),a(474);var Wc=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;new _e.Type("UUID",_e.string.is,(function(e,t){return"string"==typeof e&&Wc.test(e)?_e.success(e):_e.failure(e,t)}),_e.identity);const Kc=new Date,Qc={from:"now-15m",to:"now"},Xc=Kc.getTime(),Zc=new Date(Xc-9e5).getTime(),Yc={query:{language:"kuery",query:""},filters:[],dateRange:{...Qc},dateRangeTimestamp:{from:Zc,to:Xc}},eu=(e,t)=>{switch(t.type){case"setFilter":return{...e,filters:[...t.payload]};case"setQuery":const{filters:a,query:r,...n}=t.payload,i=a||e.filters,s=r||e.query;return{...e,...n,filters:[...i],query:{...s}};default:throw new Error}},tu=_e.intersection([_e.partial({$state:_e.type({store:("FilterStateStore",au=St.FilterStateStore,ru=function(e){return Object.values(au).includes(e)},new _e.Type("FilterStateStore",ru,(function(e,t){return ru(e)?_e.success(e):_e.failure(e,t)}),_e.identity))})}),_e.type({meta:_e.partial({alias:_e.union([_e.null,_e.string]),disabled:_e.boolean,negate:_e.boolean,controlledBy:_e.string,group:_e.string,index:_e.string,isMultiIndex:_e.boolean,type:_e.string,key:_e.string,params:_e.any,value:_e.any})}),_e.partial({query:_e.record(_e.string,_e.any)})]);var au,ru;const nu=_e.array(tu),iu=_e.type({language:_e.string,query:_e.any}),su=_e.type({from:_e.string,to:_e.string}),lu=_e.type({from:_e.number,to:_e.number}),ou=_e.type({filters:nu,query:iu,dateRange:su,dateRangeTimestamp:lu}),cu=(_e.partial({query:iu,dateRange:su,filters:nu,dateRangeTimestamp:lu}),ou.encode),uu=e=>Object(Be.pipe)(ou.decode(e),Object(Re.fold)(Object(Ae.constant)(void 0),Ae.identity)),du=Ie()((()=>{const{state:e,dispatch:t,getRangeInTimestamp:a,getTime:n}=(()=>{const[e,t]=Object(Ne.b)({defaultState:Yc,decodeUrlState:uu,encodeUrlState:cu,urlStateKey:"_a"}),[a,n]=Object(r.useReducer)(eu,e),[i]=Object(bt.a)(Qc),s=Object(r.useCallback)((({from:e,to:t})=>{var a,r,n,i;return{from:null!==(a=null===(r=H.a.parse(e))||void 0===r?void 0:r.valueOf())&&void 0!==a?a:Zc,to:null!==(n=null===(i=H.a.parse(t))||void 0===i?void 0:i.valueOf())&&void 0!==n?n:Xc}}),[]);return Object(r.useEffect)((()=>{qc()(a,e)||t(a)}),[t,a,e]),{state:a,dispatch:n,getRangeInTimestamp:s,getTime:i}})(),{metricsDataView:i}=zc(),{services:s}=Object(f.useKibana)(),{data:{query:l}}=s;Object(bt.b)(Qc,{from:e.dateRange.from,to:e.dateRange.to});const{filterManager:o}=l,c=Object(r.useCallback)(((e,r,i)=>{if(e||r||i){const s=null!=r?r:n();i&&o.setFilters(i),t({type:"setQuery",payload:{query:e,filters:i?o.getFilters():void 0,dateRange:s,dateRangeTimestamp:a(s)}})}}),[o,a,n,t]),u=Object(r.useCallback)(Object(R.debounce)(c,100),[c]),d=Object(r.useCallback)((e=>{var a;const r=null!==(a=e.attributes.filters)&&void 0!==a?a:[],n=o.getGlobalFilters(),i=e.attributes.query;t({type:"setQuery",payload:{query:i,filters:[...r,...n]}})}),[o,t]),m=Object(r.useCallback)((()=>{t({type:"setFilter",payload:o.getGlobalFilters()})}),[o,t]),p=Object(r.useCallback)((()=>i?Object(St.buildEsQuery)(i,e.query,e.filters):null),[i,e.filters,e.query]);return{dateRangeTimestamp:e.dateRangeTimestamp,buildQuery:p,onSubmit:u,saveQuery:d,clearSavedQuery:m,unifiedSearchQuery:e.query,unifiedSearchDateRange:n(),unifiedSearchFilters:e.filters}})),[mu,pu]=du,gu=({dataView:e})=>{const{services:{unifiedSearch:t}}=Object(f.useKibana)(),{unifiedSearchDateRange:a,unifiedSearchQuery:r,unifiedSearchFilters:i,onSubmit:s,saveQuery:l,clearSavedQuery:o}=pu(),{SearchBar:c}=t.ui,u=e=>{l(e)},d=({payload:e,filters:t})=>{s(null==e?void 0:e.query,null==e?void 0:e.dateRange,t)};return n.a.createElement(c,{appName:"Infra Hosts",indexPatterns:[e],query:r,dateRangeFrom:a.from,dateRangeTo:a.to,filters:i,onQuerySubmit:e=>{d({payload:e})},onSaved:u,onSavedQueryUpdated:u,onClearSavedQuery:()=>{o()},showSaveQuery:!0,showQueryInput:!0,onFiltersUpdated:e=>{d({filters:e})}})},fu=(e,t)=>t||0===t?Object(oa.a)({type:e})(t):"N/A",bu=[{name:p.i18n.translate("xpack.infra.hostsTable.nameColumnHeader",{defaultMessage:"Name"}),field:"name",sortable:!0,truncateText:!0,textOnly:!0},{name:p.i18n.translate("xpack.infra.hostsTable.operatingSystemColumnHeader",{defaultMessage:"Operating System"}),field:"os",sortable:!0,render:e=>n.a.createElement(g.EuiText,{size:"s"},e)},{name:p.i18n.translate("xpack.infra.hostsTable.numberOfCpusColumnHeader",{defaultMessage:"# of CPUs"}),field:"cpuCores",sortable:!0,render:e=>{var t;return n.a.createElement(n.a.Fragment,null,fu("cpuCores",null!==(t=null==e?void 0:e.value)&&void 0!==t?t:null==e?void 0:e.max))}},{name:p.i18n.translate("xpack.infra.hostsTable.diskLatencyColumnHeader",{defaultMessage:"Disk Latency (avg.)"}),field:"diskLatency.avg",sortable:!0,render:e=>n.a.createElement(n.a.Fragment,null,fu("diskLatency",e))},{name:p.i18n.translate("xpack.infra.hostsTable.averageTxColumnHeader",{defaultMessage:"TX (avg.)"}),field:"tx.avg",sortable:!0,render:e=>n.a.createElement(n.a.Fragment,null,fu("tx",e))},{name:p.i18n.translate("xpack.infra.hostsTable.averageRxColumnHeader",{defaultMessage:"RX (avg.)"}),field:"rx.avg",sortable:!0,render:e=>n.a.createElement(n.a.Fragment,null,fu("rx",e))},{name:p.i18n.translate("xpack.infra.hostsTable.averageMemoryTotalColumnHeader",{defaultMessage:"Memory total (avg.)"}),field:"memoryTotal.avg",sortable:!0,render:e=>n.a.createElement(n.a.Fragment,null,fu("memoryTotal",e))},{name:p.i18n.translate("xpack.infra.hostsTable.servicesOnHostColumnHeader",{defaultMessage:"Services on Host"}),field:"servicesOnHost",sortable:!0,render:e=>n.a.createElement(n.a.Fragment,null,fu("cpuCores",e))},{name:p.i18n.translate("xpack.infra.hostsTable.averageMemoryUsageColumnHeader",{defaultMessage:"Memory usage (avg.)"}),field:"memory.avg",sortable:!0,render:e=>n.a.createElement(n.a.Fragment,null,fu("memory",e))}],hu=[{type:"rx"},{type:"tx"},{type:"memory"},{type:"cpuCores"},{type:"diskLatency"},{type:"memoryTotal"}],yu=()=>{const{sourceId:e}=Object(w.b)(),{buildQuery:t,dateRangeTimestamp:a}=pu(),i={from:a.from,to:a.to,interval:"1m",ignoreLookback:!0},s=t(),{loading:l,nodes:o,reload:c}=Object(la.a)(s&&JSON.stringify(s),hu,[],"host",e,a.to,"","",!0,i),u=(e=>{const t=Object(r.useMemo)((()=>e.map((({metrics:e,path:t,name:a})=>{var r,n;return{name:a,os:null!==(r=null===(n=t.at(-1))||void 0===n?void 0:n.os)&&void 0!==r?r:"-",...e.reduce(((e,t)=>(e[t.name]=t,e)),{})}}))),[e]);return t})(o),d=0===u.length;return n.a.createElement(n.a.Fragment,null,l?n.a.createElement(D.a,{height:"100%",width:"auto",text:p.i18n.translate("xpack.infra.waffle.loadingDataText",{defaultMessage:"Loading data"})}):d?n.a.createElement("div",null,n.a.createElement(L.a,{titleText:p.i18n.translate("xpack.infra.waffle.noDataTitle",{defaultMessage:"There is no data to display."}),bodyText:p.i18n.translate("xpack.infra.waffle.noDataDescription",{defaultMessage:"Try adjusting your time or filter."}),refetchText:p.i18n.translate("xpack.infra.waffle.checkNewDataButtonLabel",{defaultMessage:"Check for new data"}),onRefetch:()=>{c()},testString:"noMetricsDataPrompt"})):n.a.createElement(g.EuiInMemoryTable,{pagination:!0,sorting:!0,items:u,columns:bu}))},Eu=()=>{const{metricsDataView:e,isDataViewLoading:t,hasFailedLoadingDataView:a}=zc();return t?n.a.createElement(D.a,{height:"100%",width:"auto",text:p.i18n.translate("xpack.infra.waffle.loadingDataText",{defaultMessage:"Loading data"})}):a||!e?null:n.a.createElement(n.a.Fragment,null,n.a.createElement(gu,{dataView:e}),n.a.createElement(g.EuiSpacer,null),n.a.createElement(yu,null))},vu=()=>n.a.createElement(xu,{label:p.i18n.translate("xpack.infra.hostsPage.experimentalBadgeLabel",{defaultMessage:"Technical preview"}),tooltipContent:p.i18n.translate("xpack.infra.hostsPage.experimentalBadgeDescription",{defaultMessage:"This functionality is in technical preview and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but features in technical preview are not subject to the support SLA of official GA features."})});var xu=Ac()(g.EuiBetaBadge).withConfig({displayName:"_StyledEuiBetaBadge",componentId:"sc-19o4h1x-0"})(["display:flex;justify-content:center;"]);const ku=()=>{const{hasFailedLoadingSource:e,isLoading:t,loadSourceFailureMessage:a,loadSource:r,source:i,metricIndicesExist:s}=Object(w.b)();return Object(b.useTrackPageview)({app:"infra_metrics",path:"hosts"}),Object(b.useTrackPageview)({app:"infra_metrics",path:"hosts",delay:15e3}),F([{text:T.c}]),n.a.createElement(g.EuiErrorBoundary,null,t&&!i?n.a.createElement(zt.a,null):s&&i?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:dt.APP_WRAPPER_CLASS},n.a.createElement(at,{hasData:s,pageHeader:{alignItems:"center",pageTitle:n.a.createElement(Ou,null,n.a.createElement("h1",null,T.c),n.a.createElement(vu,null)),rightSideItems:[n.a.createElement(g.EuiLink,{href:"https://ela.st/feedback-host-observability",target:"_blank"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.hostsPage.giveFeedbackLink",defaultMessage:"Give feedback"}))]},pageSectionProps:{contentProps:{css:Do.a}}},n.a.createElement(Vc,{metricAlias:i.configuration.metricAlias},n.a.createElement(mu,null,n.a.createElement(Eu,null)))))):e?n.a.createElement(Vt,{errorMessage:a||"",retry:r}):n.a.createElement(at,{hasData:s,"data-test-subj":"noMetricsIndicesPrompt"}))};var Ou=Ac()("div").withConfig({displayName:"_StyledDiv",componentId:"sc-1fsrort-0"})(["display:flex;align-items:center;gap:0.75rem;"]);const Mu=()=>{var e;const[t,a]=Object(r.useState)(!1),[i,s]=Object(r.useState)(null),l=null===(e=Object(f.useKibana)().services.application)||void 0===e?void 0:e.capabilities,{services:{observability:o}}=Object(f.useKibana)(),c=Object(r.useMemo)((()=>{var e;return Boolean(null==l||null===(e=l.infrastructure)||void 0===e?void 0:e.save)}),[l]),u=Object(r.useCallback)((()=>s(null)),[s]),d=Object(r.useCallback)((()=>{a(!1)}),[a]),m=Object(r.useCallback)((()=>{a(!t)}),[a,t]),b=Object(r.useMemo)((()=>({id:1,title:p.i18n.translate("xpack.infra.alerting.infrastructureDropdownTitle",{defaultMessage:"Infrastructure rules"}),items:[{"data-test-subj":"inventory-alerts-create-rule",name:p.i18n.translate("xpack.infra.alerting.createInventoryRuleButton",{defaultMessage:"Create inventory rule"}),onClick:()=>{d(),s("inventory")}}]})),[s,d]),h=Object(r.useMemo)((()=>({id:2,title:p.i18n.translate("xpack.infra.alerting.metricsDropdownTitle",{defaultMessage:"Metrics rules"}),items:[{"data-test-subj":"metrics-threshold-alerts-create-rule",name:p.i18n.translate("xpack.infra.alerting.createThresholdRuleButton",{defaultMessage:"Create threshold rule"}),onClick:()=>{d(),s("threshold")}}]})),[s,d]),y=o.useRulesLink(),E=Object(r.useMemo)((()=>({name:p.i18n.translate("xpack.infra.alerting.manageRules",{defaultMessage:"Manage rules"}),icon:"tableOfContents",onClick:y.onClick})),[y]),v=Object(r.useMemo)((()=>c?[{"data-test-subj":"inventory-alerts-menu-option",name:p.i18n.translate("xpack.infra.alerting.infrastructureDropdownMenu",{defaultMessage:"Infrastructure"}),panel:1},{"data-test-subj":"metrics-threshold-alerts-menu-option",name:p.i18n.translate("xpack.infra.alerting.metricsDropdownMenu",{defaultMessage:"Metrics"}),panel:2},E]:[E]),[c,E]),x=Object(r.useMemo)((()=>[{id:0,title:p.i18n.translate("xpack.infra.alerting.alertDropdownTitle",{defaultMessage:"Alerts and rules"}),items:v}].concat(c?[b,h]:[])),[b,h,v,c]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiPopover,{panelPaddingSize:"none",anchorPosition:"downLeft",button:n.a.createElement(g.EuiHeaderLink,{color:"text",iconSide:"right",iconType:"arrowDown",onClick:m,"data-test-subj":"infrastructure-alerts-and-rules"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.alerting.alertsButton",defaultMessage:"Alerts and rules"})),isOpen:t,closePopover:d},n.a.createElement(g.EuiContextMenu,{initialPanelId:0,panels:x,"data-test-subj":"metrics-alert-menu"})),n.a.createElement(wu,{visibleFlyoutType:i,onClose:u}))},wu=({visibleFlyoutType:e,onClose:t})=>{switch(e){case"inventory":return n.a.createElement(as,{onClose:t});case"threshold":return n.a.createElement(Q,{onClose:t});default:return null}};var ju=a(129),Su=a(225);const Cu=e=>{const[t]=Object(r.useState)((()=>N()())),{goHome:a}=e,[i,s]=Object(r.useState)(t.clone().subtract(4,"weeks")),[l,o]=Object(r.useState)(null),c=ki(),u=Ri(),[d,m]=Object(r.useState)(""),[f,h]=Object(r.useState)(""),y=Object(b.useUiTracker)({app:"infra_metrics"}),{createDerivedIndexPattern:E}=Object(ju.a)({sourceId:"default"}),v=c.sourceConfiguration.indices,x=Object(r.useMemo)((()=>"kubernetes"===e.jobType?u.setupStatus:c.setupStatus),[e.jobType,u.setupStatus,c.setupStatus]),k=Object(r.useMemo)((()=>"kubernetes"===e.jobType?u.cleanUpAndSetUpModule:c.cleanUpAndSetUpModule),[e.jobType,u.cleanUpAndSetUpModule,c.cleanUpAndSetUpModule]),O=Object(r.useMemo)((()=>"kubernetes"===e.jobType?u.setUpModule:c.setUpModule),[e.jobType,u.setUpModule,c.setUpModule]),M=Object(r.useMemo)((()=>"kubernetes"===e.jobType?u.jobSummaries.length>0:c.jobSummaries.length>0),[e.jobType,u.jobSummaries,c.jobSummaries]),w=Object(r.useMemo)((()=>E()),[E]),j=Object(r.useCallback)((e=>{s(e)}),[]),S=Object(r.useCallback)((()=>{M?k(v,N()(i).toDate().getTime(),void 0,f,l?l[0]:void 0):O(v,N()(i).toDate().getTime(),void 0,f,l?l[0]:void 0)}),[k,f,O,M,v,l,i]),C=Object(r.useCallback)((e=>{m(e||""),h(Object(Ct.a)(e,w)||"")}),[w]),T=Object(r.useCallback)(Object(R.debounce)(C,500),[C]),F=Object(r.useCallback)((e=>{o(e.map((e=>e.label)))}),[]);return Object(r.useEffect)((()=>{"kubernetes"===e.jobType&&o([Ti])}),[e.jobType]),Object(r.useEffect)((()=>{"succeeded"===x.type&&("kubernetes"===e.jobType?(y({metric:"metrics_ml_anomaly_detection_k8s_enabled"}),!l||1===l.length&&l[0]===Ti||y({metric:"metrics_ml_anomaly_detection_k8s_partition_changed"})):(y({metric:"metrics_ml_anomaly_detection_hosts_enabled"}),l&&y({metric:"metrics_ml_anomaly_detection_hosts_partition_changed"}),y({metric:"metrics_ml_anomaly_detection_hosts_enabled"})),a())}),[x,e.jobType,l,y,a]),n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlyoutHeader,null,n.a.createElement(g.EuiTitle,{size:"m"},n.a.createElement("h2",null,n.a.createElement(P.FormattedMessage,{defaultMessage:"Enable machine learning for {nodeType}",id:"xpack.infra.ml.aomalyFlyout.jobSetup.flyoutHeader",values:{nodeType:e.jobType}})))),n.a.createElement(g.EuiFlyoutBody,null,"pending"===x.type?n.a.createElement(g.EuiFlexGroup,{alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiLoadingSpinner,{size:"xl"})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.loadingText",defaultMessage:"Creating ML job..."}))):"failed"===x.type?n.a.createElement(n.a.Fragment,null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.failureText",defaultMessage:"Something went wrong creating the necessary ML jobs."}),n.a.createElement(g.EuiSpacer,null),n.a.createElement(g.EuiButton,{fill:!0,onClick:S},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.tryAgainButton",defaultMessage:"Try again"}))):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,null,n.a.createElement("p",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.description",defaultMessage:"Settings can not be changed once the jobs are created. You can recreate jobs anytime, however, the previously detected anomalies are removed."}))),n.a.createElement(g.EuiSpacer,{size:"l"}),n.a.createElement(g.EuiForm,null,n.a.createElement(g.EuiDescribedFormGroup,{title:n.a.createElement("h3",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.when.title",defaultMessage:"When does your model begin?"})),description:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.when.description",defaultMessage:"By default, machine learning jobs analyze the last 4 weeks of data and continue to run indefinitely."})},n.a.createElement(g.EuiFormRow,{label:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.when.timePicker.label",defaultMessage:"Start date"})},n.a.createElement(Su.a,{showTimeSelect:!0,selected:i,onChange:j,maxDate:t}))),n.a.createElement(g.EuiDescribedFormGroup,{title:n.a.createElement("h3",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.partition.title",defaultMessage:"How do you want to partition your data?"})),description:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.partition.description",defaultMessage:"Partitions enable you to build independent models for groups of data that share similar behavior. For example, you can partition by machine type or cloud availability zone."})},n.a.createElement(g.EuiFormRow,{label:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.partition.label",defaultMessage:"Partition field"}),display:"rowCompressed"},n.a.createElement(g.EuiComboBox,{placeholder:p.i18n.translate("xpack.infra.metricsExplorer.groupByLabel",{defaultMessage:"Everything"}),"aria-label":p.i18n.translate("xpack.infra.metricsExplorer.groupByAriaLabel",{defaultMessage:"Graph per"}),fullWidth:!0,singleSelection:!0,selectedOptions:l?l.map((e=>({label:e}))):void 0,options:w.fields.filter((e=>e.aggregatable&&"string"===e.type)).map((e=>({label:e.name}))),onChange:F,isClearable:!0}))),n.a.createElement(g.EuiDescribedFormGroup,{title:n.a.createElement("h3",null,n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.filter.title",defaultMessage:"Filter"})),description:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.filter.description",defaultMessage:"By default, machine learning jobs analyze all of your metric data."})},n.a.createElement(g.EuiFormRow,{display:"rowCompressed",label:n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.filter.label",defaultMessage:"Filter (optional)"})},n.a.createElement(Me.a,{derivedIndexPattern:w,onSubmit:C,onChange:T,value:d})))))),n.a.createElement(g.EuiFlyoutFooter,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:e.closeFlyout},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.cancelButton",defaultMessage:"Cancel"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{fill:!0,fullWidth:!1,onClick:S},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.steps.setupProcess.enableButton",defaultMessage:"Enable jobs"}))))))};var Tu=a(194);const Fu=()=>{var e,t;const{hasInfraMLSetupCapabilities:a}=yn(),[i,s]=Object(r.useState)(!1),[l,o]=Object(r.useState)("home"),[c,u]=Object(r.useState)(null),{source:d}=Object(ju.a)({sourceId:"default"}),{space:m}=Object(Tu.a)(),p=Object(r.useCallback)((()=>{o("home"),s(!0)}),[]),f=Object(r.useCallback)((e=>{o("setup"),u({jobType:e})}),[o]),b=Object(r.useCallback)((()=>{s(!1)}),[]);return null==(null==d?void 0:d.configuration.metricAlias)||null==m?null:n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiHeaderLink,{color:"text",iconSide:"left",iconType:"inspect",onClick:p,"data-test-subj":"openAnomalyFlyoutButton"},n.a.createElement(P.FormattedMessage,{id:"xpack.infra.ml.anomalyDetectionButton",defaultMessage:"Anomaly detection"})),i&&n.a.createElement(xi,{indexPattern:null!==(e=null==d?void 0:d.configuration.metricAlias)&&void 0!==e?e:"",sourceId:"default",spaceId:m.id},n.a.createElement(Bi,{indexPattern:null!==(t=null==d?void 0:d.configuration.metricAlias)&&void 0!==t?t:"",sourceId:"default",spaceId:m.id},n.a.createElement(g.EuiFlyout,{onClose:b,"data-test-subj":"loadMLFlyout"},"home"===l&&n.a.createElement(Ni,{hasSetupCapabilities:a,goToSetup:f,closeFlyout:b}),"setup"===l&&n.a.createElement(Cu,{goHome:p,closeFlyout:b,jobType:c.jobType})))))};var Lu=a(36);const Pu=p.i18n.translate("xpack.infra.metricsHeaderAddDataButtonLabel",{defaultMessage:"Add data"}),Du=({match:e})=>{var t,a,i,s;const o=null===(t=Object(f.useKibana)().services.application)||void 0===t?void 0:t.capabilities,{setHeaderActionMenu:c,theme$:u}=Object(r.useContext)(Lu.a),d=p.i18n.translate("xpack.infra.metrics.settingsTabTitle",{defaultMessage:"Settings"}),v=Object(f.useKibana)();Object(y.a)(!(null!=o&&null!==(a=o.infrastructure)&&void 0!==a&&a.save));const x=Object(b.useLinkProps)({app:"metrics",pathname:"settings"});return n.a.createElement(g.EuiErrorBoundary,null,n.a.createElement(w.a,{sourceId:"default"},n.a.createElement(W.a,null,n.a.createElement(da.c,null,n.a.createElement(kt,null,n.a.createElement(It,null,n.a.createElement(En,null,n.a.createElement(h.a,{feedbackLink:"https://discuss.elastic.co/c/metrics",appName:p.i18n.translate("xpack.infra.header.infrastructureHelpAppName",{defaultMessage:"Metrics"})}),c&&u&&n.a.createElement(b.HeaderMenuPortal,{setHeaderActionMenu:c,theme$:u},n.a.createElement(g.EuiHeaderLinks,{gutterSize:"xs"},n.a.createElement(g.EuiHeaderLink,m()({color:"text"},x),d),n.a.createElement(l.Route,{path:"/inventory",component:Fu}),n.a.createElement(Mu,null),n.a.createElement(g.EuiHeaderLink,{href:null===(i=v.services)||void 0===i||null===(s=i.application)||void 0===s?void 0:s.getUrlForApp("/integrations/browse"),color:"primary",iconType:"indexOpen"},Pu))),n.a.createElement(l.Switch,null,n.a.createElement(l.Route,{path:"/inventory",component:Io}),n.a.createElement(l.Route,{path:"/explorer",render:e=>n.a.createElement(j,null,(({configuration:e,createDerivedIndexPattern:t})=>n.a.createElement(E.c,null,n.a.createElement(O,null),e?n.a.createElement(Iu,{configuration:e,createDerivedIndexPattern:t}):n.a.createElement(zt.a,null))))}),n.a.createElement(l.Route,{path:"/detail/:type/:node",component:Fc}),n.a.createElement(l.Route,{path:"/hosts",component:ku}),n.a.createElement(l.Route,{path:"/settings",component:Bc})))))))))},Iu=e=>{const{createDerivedIndexPattern:t,configuration:a}=e,{options:r}=Object(E.h)();return n.a.createElement(Xe,{shouldLoadDefault:"default"===r.source,viewType:"metrics-explorer-view",defaultViewState:E.a},n.a.createElement(ut,m()({derivedIndexPattern:t(),source:a},e)))};var _u=a(222),Bu=a(35);const Ru=(e,t,a,{element:r,history:i,setHeaderActionMenu:l,theme$:c})=>{const u=new o.Storage(window.localStorage);return Object(Fs.b)(r,"infraMetricsPage"),s.a.render(n.a.createElement(Au,{core:e,history:i,plugins:t,pluginStart:a,setHeaderActionMenu:l,storage:u,theme$:c}),r),()=>{e.chrome.docTitle.reset(),s.a.unmountComponentAtNode(r)}},Au=({core:e,history:t,pluginStart:a,plugins:r,setHeaderActionMenu:i,storage:s,theme$:o})=>{var d,m,p,g;const f=e.application.capabilities;return n.a.createElement(Bu.b,{core:e,pluginStart:a,plugins:r,theme$:o},n.a.createElement(Bu.a,{appName:"Metrics UI",setHeaderActionMenu:i,storage:s,theme$:o,triggersActionsUI:r.triggersActionsUi},n.a.createElement(l.Router,{history:t},n.a.createElement(l.Switch,null,n.a.createElement(l.Route,{path:"/link-to",component:u.a}),(null==f||null===(d=f.infrastructure)||void 0===d?void 0:d.show)&&n.a.createElement(_u.a,{from:"/",exact:!0,to:"/inventory"}),(null==f||null===(m=f.infrastructure)||void 0===m?void 0:m.show)&&n.a.createElement(_u.a,{from:"/snapshot",exact:!0,to:"/inventory"}),(null==f||null===(p=f.infrastructure)||void 0===p?void 0:p.show)&&n.a.createElement(_u.a,{from:"/metrics-explorer",exact:!0,to:"/explorer"}),(null==f||null===(g=f.infrastructure)||void 0===g?void 0:g.show)&&n.a.createElement(l.Route,{path:"/",component:Du}),n.a.createElement(l.Route,{component:c.a})))))}},80:function(e,t,a){"use strict";a.d(t,"a",(function(){return f})),a.d(t,"b",(function(){return b})),a.d(t,"c",(function(){return O})),a.d(t,"d",(function(){return M}));var r=a(2),n=a(0),i=a(18),s=a(14),l=a(22),o=a(70),c=a.n(o),u=a(115),d=a(31),m=a(77),p=a(81),g=a(78);const f={palette:"cool",steps:10,reverseColors:!1},b={metric:{type:"cpu"},groupBy:[],nodeType:"host",view:"map",customOptions:[],boundsOverride:{max:1,min:0},autoBounds:!0,accountId:"",region:"",customMetrics:[],legend:f,source:"default",sort:{by:"name",direction:"desc"},timelineOpen:!1},h=n.type({palette:d.d,steps:n.number,reverseColors:n.boolean}),y=n.type({by:n.keyof({name:null,value:null}),direction:n.keyof({asc:null,desc:null})}),E=n.intersection([n.type({metric:m.f,groupBy:m.e,nodeType:g.c,view:n.string,customOptions:n.array(n.type({text:n.string,field:n.string})),boundsOverride:n.type({min:n.number,max:n.number}),autoBounds:n.boolean,accountId:n.string,region:n.string,customMetrics:n.array(m.d),sort:y}),n.partial({source:n.string,legend:h,timelineOpen:n.boolean})]),v=e=>E.encode(e),x=e=>{const t=Object(i.pipe)(E.decode(e),Object(s.fold)(Object(l.constant)(void 0),l.identity));return t&&(t.source="url"),t},k=c()((()=>{const[e,t]=Object(p.b)({defaultState:b,decodeUrlState:x,encodeUrlState:v,urlStateKey:"waffleOptions"}),[a,n]=Object(r.useState)(e);Object(r.useEffect)((()=>t(a)),[t,a]);const i=Object(r.useCallback)((e=>n((t=>({...t,metric:e})))),[n]),s=Object(r.useCallback)((e=>n((t=>({...t,groupBy:e})))),[n]),l=Object(r.useCallback)((e=>n((t=>({...t,nodeType:e})))),[n]),o=Object(r.useCallback)((e=>n((t=>({...t,view:e})))),[n]),c=Object(r.useCallback)((e=>n((t=>({...t,customOptions:e})))),[n]),d=Object(r.useCallback)((e=>n((t=>({...t,autoBounds:e})))),[n]),m=Object(r.useCallback)((e=>n((t=>({...t,boundsOverride:e})))),[n]),g=Object(r.useCallback)((e=>n((t=>({...t,accountId:e})))),[n]),f=Object(r.useCallback)((e=>n((t=>({...t,region:e})))),[n]),h=Object(r.useCallback)((e=>{n((t=>({...t,customMetrics:e})))}),[n]),y=Object(r.useCallback)((e=>{n((t=>({...t,legend:e})))}),[n]),E=Object(r.useCallback)((e=>{n((t=>({...t,sort:e})))}),[n]),{inventoryPrefill:k}=Object(u.b)();Object(r.useEffect)((()=>{const{setNodeType:e,setMetric:t,setCustomMetrics:r}=k;e(a.nodeType),t(a.metric),r(a.customMetrics)}),[a,k]);const O=Object(r.useCallback)((e=>n((t=>({...t,timelineOpen:e})))),[n]);return{...b,...a,changeMetric:i,changeGroupBy:s,changeNodeType:l,changeView:o,changeCustomOptions:c,changeAutoBounds:d,changeBoundsOverride:m,changeAccount:g,changeRegion:f,changeCustomMetrics:h,changeLegend:y,changeSort:E,changeTimelineOpen:O,setWaffleOptionsState:n}})),[O,M]=k}}]);