/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[17],{101:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return O})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return M})),a.d(t,"e",(function(){return j})),a.d(t,"f",(function(){return P})),a.d(t,"g",(function(){return I})),a.d(t,"h",(function(){return L})),a.d(t,"i",(function(){return F})),a.d(t,"j",(function(){return S})),a.d(t,"k",(function(){return U})),a.d(t,"l",(function(){return w})),a.d(t,"m",(function(){return z}));var n=a(12),r=a(2),i=a.n(r);const s=({error:e})=>{var t;return i.a.createElement(n.EuiEmptyPrompt,{body:i.a.createElement(n.EuiCodeBlock,{className:"eui-textLeft",isCopyable:!0,language:"jsstacktrace"},null!==(t=e.stack)&&void 0!==t?t:`${e}`),color:"danger","data-test-subj":"metricsTableErrorContent",iconType:"alert",title:i.a.createElement("h2",null,e.message),titleSize:"s"})};var o=a(10),l=a(17),u=a(128);const c=({id:e,label:t,nodeType:a,timerange:r})=>{var s,c;const m=Object(l.useLinkProps)(Object(u.a)({nodeType:a,nodeId:e,from:null===(s=Object(o.parse)(r.from))||void 0===s?void 0:s.valueOf(),to:null===(c=Object(o.parse)(r.to))||void 0===c?void 0:c.valueOf()}));return i.a.createElement(n.EuiLink,{href:m.href},t)};var m=a(30),d=a.n(m),g=a(1),p=a(19),f=a(96),b=a(140),E=a.n(b),y=a(141),v=a.n(y);const M=()=>i.a.createElement(n.EuiEmptyPrompt,{"data-test-subj":"metricsTableLoadingContent",icon:i.a.createElement(n.EuiLoadingLogo,{logo:"logoMetrics",size:"xl"}),title:i.a.createElement("h2",null,i.a.createElement(p.FormattedMessage,{id:"xpack.infra.metricsTable.loadingContentTitle",defaultMessage:"Loading metrics"}))}),j=()=>{const e=Object(l.useLinkProps)({app:"integrations",pathname:"browse"});return i.a.createElement(n.EuiEmptyPrompt,{"data-test-subj":"metricsTableLoadingContent",iconType:"logoMetrics",title:i.a.createElement("h2",null,f.d),body:i.a.createElement("p",null,f.b),actions:i.a.createElement(n.EuiButton,d()({color:"primary",fill:!0},e),f.c)})},O=()=>i.a.createElement(n.EuiEmptyPrompt,{body:i.a.createElement(n.EuiDescriptionList,{compressed:!0},i.a.createElement(n.EuiDescriptionListTitle,null,i.a.createElement(p.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptTimeRangeHintTitle",defaultMessage:"Expand your time range"})),i.a.createElement(n.EuiDescriptionListDescription,null,i.a.createElement(p.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptTimeRangeHintDescription",defaultMessage:"Try searching over a longer period of time."})),i.a.createElement(n.EuiDescriptionListTitle,null,i.a.createElement(p.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptQueryHintTitle",defaultMessage:"Adjust your query"})),i.a.createElement(n.EuiDescriptionListDescription,null,i.a.createElement(p.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptQueryHintDescription",defaultMessage:"Try searching for a different combination of terms."}))),color:"subdued","data-test-subj":"metricsTableEmptyIndicesContent",icon:i.a.createElement(C,null),layout:"horizontal",title:i.a.createElement("h2",null,i.a.createElement(p.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptTitle",defaultMessage:"No results match your search criteria"})),titleSize:"m"}),C=()=>{const{colorMode:e}=Object(n.useEuiTheme)(),t=e===n.COLOR_MODES_STANDARD.dark?E.a:v.a;return i.a.createElement(n.EuiImage,{alt:x,size:"fullWidth",src:t})},x=g.i18n.translate("xpack.infra.metricsTable.noResultsIllustrationAlternativeText",{defaultMessage:"A magnifying glass with an exclamation mark"});function P({value:e,unit:t}){return null==e||isNaN(e)?i.a.createElement(n.EuiTextColor,{color:"subdued"},i.a.createElement(p.FormattedMessage,{id:"xpack.infra.metricsTable.numberCell.metricNotAvailableLabel",defaultMessage:"N/A",description:"N/A is short for not available"})):t?i.a.createElement("span",null,i.a.createElement(n.EuiI18nNumber,{value:h(e)}),t):i.a.createElement(n.EuiI18nNumber,{value:h(e)})}function h(e){return Math.round(10*e)/10}var T=a(20);const k=Object(T.euiStyled)(n.EuiPagination)`
  [data-test-subj="pagination-button-first"],
  [data-test-subj="pagination-button-last"] {
    display: none;
  }
`;function I({ariaLabel:e,pageCount:t,currentPageIndex:a,setCurrentPageIndex:n}){return i.a.createElement(k,{"aria-label":e,pageCount:t,activePage:a,onPageClick:n,compressed:!0})}function L(e){return e.reduce(((e,t)=>e+t),0)/e.length}function S(e){return(t,a)=>t[e[a]]}function w(e){return 100*e}function U(e,t){const a=Object.values(e.metricsMap);return{options:{aggregation:"avg",groupBy:e.groupByField,metrics:a,filterQuery:JSON.stringify(D(e.sourceFilter,t))}}}function D(e,t){return{bool:{filter:t?[e,t]:[e]}}}function F(e){const t=Object.keys(e),a=Object.values(e);return t.reduce(((e,t)=>({...e,[t]:N(t,a)})),{})}function N(e,t){const a=t.findIndex((t=>t.field===e));if(-1===a)throw new Error("Failed to find index for field "+e);return`metric_${a}`}var A=a(9),B=a(73),H=a(71);const _={series:[],pageInfo:{afterKey:null,total:-1}},z=e=>{const{metricsExplorerOptions:t,timerange:a,transform:n,sortState:i,currentPageIndex:s}=e,[l,u]=Object(r.useState)([]),c=function(){var e;const t=null===(e=Object(A.useKibana)().services.http)||void 0===e?void 0:e.fetch;if(!t)throw new Error("Could not find Kibana HTTP fetch");return t}(),{source:m,isLoadingSource:d,loadSourceRequest:g,metricIndicesExist:p}=Object(B.b)(),f=function(e){return Object(r.useMemo)((()=>{const t=Object(o.parse)(e.from),a=Object(o.parse)(e.to);if(!t||!a)throw new Error("Could not parse timerange");return{from:t.valueOf(),to:a.valueOf(),interval:"modules"}}),[e])}(a),[b,E]=Object(H.c)({createPromise:()=>{if(!m)return Promise.resolve(_);const e={metrics:t.metrics,groupBy:t.groupBy,limit:1e4,indexPattern:m.configuration.metricAlias,filterQuery:t.filterQuery,timerange:f};return c("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify(e)})},onResolve:e=>{u(e.series.map(n))},cancelPreviousOn:"creation"},[m,t,f]),y="pending"===b.state||"uninitialized"===b.state,v=d||y,M=Object(r.useMemo)((()=>[..."rejected"===g.state?[R(g.value)]:[],..."rejected"===b.state?[R(b.value)]:[]]),[b,g]);Object(r.useEffect)((()=>{E()}),[E]);const j=Object(r.useMemo)((()=>[...l].sort(function(e){return(t,a)=>{const n=t[e.field],r=a[e.field];return"asc"===e.direction?function(e,t){return null===e?-1:null===t?1:"string"==typeof e&&"string"==typeof t?e.localeCompare(t):"number"==typeof e&&"number"==typeof t?e-t:0}(n,r):function(e,t){return null===e?1:null===t?-1:"string"==typeof e&&"string"==typeof t?t.localeCompare(e):"number"==typeof e&&"number"==typeof t?t-e:0}(n,r)}}(i))),[l,i]),O=Object(r.useMemo)((()=>j.slice(0,100)),[j]),C=Object(r.useMemo)((()=>{const e=10*s,t=e+10;return O.slice(e,t)}),[O,s]),x=Object(r.useMemo)((()=>Math.ceil(O.length/10)),[O]);return{isLoading:v,data:Object(r.useMemo)((()=>M.length>0?{state:"error",errors:M}:null==p?{state:"unknown"}:p?C.length<=0?{state:"empty-indices"}:{state:"data",currentPageIndex:s,pageCount:x,rows:C}:{state:"no-indices"}),[s,M,p,C,x])}},R=e=>e instanceof Error?e:new Error(`${e}`)},140:function(e,t,a){e.exports=a.p+"2d015490d219c87a014c81f9555e556a.svg"},141:function(e,t,a){e.exports=a.p+"432a17d27c37a1b4467753dcc2332f12.svg"},485:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a.n(n),i=a(35),s=a(73),o=a(12),l=a(1),u=a(101);const c=e=>{const{data:t,isLoading:a,setCurrentPageIndex:i,setSortState:s,sortState:c,timerange:m}=e,d=Object(n.useMemo)((()=>function(e){return[{name:l.i18n.translate("xpack.infra.metricsTable.pod.nameColumnHeader",{defaultMessage:"Name"}),field:"name",truncateText:!0,textOnly:!0,render:(t,{id:a,name:n})=>r.a.createElement(u.a,{id:a,label:n,nodeType:"pod",timerange:e})},{name:l.i18n.translate("xpack.infra.metricsTable.pod.averageCpuUsagePercentColumnHeader",{defaultMessage:"CPU usage (avg.)"}),field:"averageCpuUsagePercent",align:"right",render:e=>r.a.createElement(u.f,{value:e,unit:"%"})},{name:l.i18n.translate("xpack.infra.metricsTable.pod.averageMemoryUsageMegabytesColumnHeader",{defaultMessage:"Memory usage (avg.)"}),field:"averageMemoryUsageMegabytes",align:"right",render:e=>r.a.createElement(u.f,{value:e,unit:" MB"})}]}(m)),[m]),g={enableAllColumns:!0,sort:c};return"error"===t.state?r.a.createElement(r.a.Fragment,null,t.errors.map((e=>r.a.createElement(u.c,{error:e})))):a&&"data"!==t.state?r.a.createElement(u.d,null):"no-indices"===t.state?r.a.createElement(u.e,null):"empty-indices"===t.state?r.a.createElement(u.b,null):"data"===t.state?r.a.createElement(r.a.Fragment,null,r.a.createElement(o.EuiBasicTable,{tableCaption:l.i18n.translate("xpack.infra.metricsTable.pod.tableCaption",{defaultMessage:"Infrastructure metrics for pods"}),items:t.rows,columns:d,sorting:g,onChange:({sort:e={direction:"desc",field:"averageCpuUsagePercent"}})=>{s(e),i(0)},loading:a,noItemsMessage:r.a.createElement(u.d,null),"data-test-subj":"podMetricsTable"}),r.a.createElement(o.EuiSpacer,{size:"s"}),r.a.createElement(o.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",responsive:!1,wrap:!0},r.a.createElement(o.EuiFlexItem,{grow:!1},r.a.createElement(u.g,{ariaLabel:l.i18n.translate("xpack.infra.metricsTable.pod.paginationAriaLabel",{defaultMessage:"Pod metrics pagination"}),pageCount:t.pageCount,currentPageIndex:t.currentPageIndex,setCurrentPageIndex:i,"data-test-subj":"podMetricsTablePagination"})))):null},m={sourceFilter:{term:{"event.dataset":"kubernetes.pod"}},groupByField:["kubernetes.pod.uid","kubernetes.pod.name"],metricsMap:{"kubernetes.pod.cpu.usage.limit.pct":{aggregation:"avg",field:"kubernetes.pod.cpu.usage.limit.pct"},"kubernetes.pod.memory.usage.bytes":{aggregation:"avg",field:"kubernetes.pod.memory.usage.bytes"}}},d=Object(u.i)(m.metricsMap),g=Object(u.j)(d);function p(e){var t;const[a,n]=null!==(t=e.keys)&&void 0!==t?t:[];return 0===e.rows.length?function(e,t){return{id:e,name:t,averageCpuUsagePercent:null,averageMemoryUsageMegabytes:null}}(a,n):{id:a,name:n,...f(e.rows)}}function f(e){const{averageCpuUsagePercentValues:t,averageMemoryUsageMegabytesValues:a}=function(e){const t=[],a=[];return e.forEach((e=>{const{averageCpuUsagePercent:n,averageMemoryUsageMegabytes:r}=function(e){return{averageCpuUsagePercent:g(e,"kubernetes.pod.cpu.usage.limit.pct"),averageMemoryUsageMegabytes:g(e,"kubernetes.pod.memory.usage.bytes")}}(e);null!==n&&t.push(n),null!==r&&a.push(r)})),{averageCpuUsagePercentValues:t,averageMemoryUsageMegabytesValues:a}}(e);let n=null;0!==t.length&&(n=Object(u.l)(Object(u.h)(t)));let r=null;if(0!==a.length){const e=Object(u.h)(a),t=1e6;r=Math.floor(e/t)}return{averageCpuUsagePercent:n,averageMemoryUsageMegabytes:r}}function b({timerange:e,filterClauseDsl:t}){const a=function({timerange:e,filterClauseDsl:t}){const[a,r]=Object(n.useState)(0),[i,s]=Object(n.useState)({field:"averageCpuUsagePercent",direction:"desc"}),{options:o}=Object(n.useMemo)((()=>Object(u.k)(m,t)),[t]),{data:l,isLoading:c}=Object(u.m)({metricsExplorerOptions:o,timerange:e,transform:p,sortState:i,currentPageIndex:a});return{currentPageIndex:a,data:l,isLoading:c,setCurrentPageIndex:r,setSortState:s,sortState:i,timerange:e}}({timerange:e,filterClauseDsl:t});return r.a.createElement(c,a)}t.default=function({timerange:e,filterClauseDsl:t,sourceId:a,...n}){return r.a.createElement(i.b,n,r.a.createElement(s.a,{sourceId:a},r.a.createElement(b,{timerange:e,filterClauseDsl:t})))}}}]);