/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[16],{101:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return C})),a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return v})),a.d(t,"e",(function(){return h})),a.d(t,"f",(function(){return P})),a.d(t,"g",(function(){return k})),a.d(t,"h",(function(){return L})),a.d(t,"i",(function(){return F})),a.d(t,"j",(function(){return S})),a.d(t,"k",(function(){return U})),a.d(t,"l",(function(){return w})),a.d(t,"m",(function(){return _}));var n=a(12),r=a(2),s=a.n(r);const i=({error:e})=>{var t;return s.a.createElement(n.EuiEmptyPrompt,{body:s.a.createElement(n.EuiCodeBlock,{className:"eui-textLeft",isCopyable:!0,language:"jsstacktrace"},null!==(t=e.stack)&&void 0!==t?t:`${e}`),color:"danger","data-test-subj":"metricsTableErrorContent",iconType:"alert",title:s.a.createElement("h2",null,e.message),titleSize:"s"})};var o=a(10),l=a(17),u=a(128);const c=({id:e,label:t,nodeType:a,timerange:r})=>{var i,c;const m=Object(l.useLinkProps)(Object(u.a)({nodeType:a,nodeId:e,from:null===(i=Object(o.parse)(r.from))||void 0===i?void 0:i.valueOf(),to:null===(c=Object(o.parse)(r.to))||void 0===c?void 0:c.valueOf()}));return s.a.createElement(n.EuiLink,{href:m.href},t)};var m=a(30),d=a.n(m),g=a(1),f=a(19),p=a(96),b=a(140),y=a.n(b),E=a(141),M=a.n(E);const v=()=>s.a.createElement(n.EuiEmptyPrompt,{"data-test-subj":"metricsTableLoadingContent",icon:s.a.createElement(n.EuiLoadingLogo,{logo:"logoMetrics",size:"xl"}),title:s.a.createElement("h2",null,s.a.createElement(f.FormattedMessage,{id:"xpack.infra.metricsTable.loadingContentTitle",defaultMessage:"Loading metrics"}))}),h=()=>{const e=Object(l.useLinkProps)({app:"integrations",pathname:"browse"});return s.a.createElement(n.EuiEmptyPrompt,{"data-test-subj":"metricsTableLoadingContent",iconType:"logoMetrics",title:s.a.createElement("h2",null,p.d),body:s.a.createElement("p",null,p.b),actions:s.a.createElement(n.EuiButton,d()({color:"primary",fill:!0},e),p.c)})},C=()=>s.a.createElement(n.EuiEmptyPrompt,{body:s.a.createElement(n.EuiDescriptionList,{compressed:!0},s.a.createElement(n.EuiDescriptionListTitle,null,s.a.createElement(f.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptTimeRangeHintTitle",defaultMessage:"Expand your time range"})),s.a.createElement(n.EuiDescriptionListDescription,null,s.a.createElement(f.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptTimeRangeHintDescription",defaultMessage:"Try searching over a longer period of time."})),s.a.createElement(n.EuiDescriptionListTitle,null,s.a.createElement(f.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptQueryHintTitle",defaultMessage:"Adjust your query"})),s.a.createElement(n.EuiDescriptionListDescription,null,s.a.createElement(f.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptQueryHintDescription",defaultMessage:"Try searching for a different combination of terms."}))),color:"subdued","data-test-subj":"metricsTableEmptyIndicesContent",icon:s.a.createElement(j,null),layout:"horizontal",title:s.a.createElement("h2",null,s.a.createElement(f.FormattedMessage,{id:"xpack.infra.metricsTable.emptyIndicesPromptTitle",defaultMessage:"No results match your search criteria"})),titleSize:"m"}),j=()=>{const{colorMode:e}=Object(n.useEuiTheme)(),t=e===n.COLOR_MODES_STANDARD.dark?y.a:M.a;return s.a.createElement(n.EuiImage,{alt:O,size:"fullWidth",src:t})},O=g.i18n.translate("xpack.infra.metricsTable.noResultsIllustrationAlternativeText",{defaultMessage:"A magnifying glass with an exclamation mark"});function P({value:e,unit:t}){return null==e||isNaN(e)?s.a.createElement(n.EuiTextColor,{color:"subdued"},s.a.createElement(f.FormattedMessage,{id:"xpack.infra.metricsTable.numberCell.metricNotAvailableLabel",defaultMessage:"N/A",description:"N/A is short for not available"})):t?s.a.createElement("span",null,s.a.createElement(n.EuiI18nNumber,{value:x(e)}),t):s.a.createElement(n.EuiI18nNumber,{value:x(e)})}function x(e){return Math.round(10*e)/10}var T=a(20);const I=Object(T.euiStyled)(n.EuiPagination)`
  [data-test-subj="pagination-button-first"],
  [data-test-subj="pagination-button-last"] {
    display: none;
  }
`;function k({ariaLabel:e,pageCount:t,currentPageIndex:a,setCurrentPageIndex:n}){return s.a.createElement(I,{"aria-label":e,pageCount:t,activePage:a,onPageClick:n,compressed:!0})}function L(e){return e.reduce(((e,t)=>e+t),0)/e.length}function S(e){return(t,a)=>t[e[a]]}function w(e){return 100*e}function U(e,t){const a=Object.values(e.metricsMap);return{options:{aggregation:"avg",groupBy:e.groupByField,metrics:a,filterQuery:JSON.stringify(D(e.sourceFilter,t))}}}function D(e,t){return{bool:{filter:t?[e,t]:[e]}}}function F(e){const t=Object.keys(e),a=Object.values(e);return t.reduce(((e,t)=>({...e,[t]:N(t,a)})),{})}function N(e,t){const a=t.findIndex((t=>t.field===e));if(-1===a)throw new Error("Failed to find index for field "+e);return`metric_${a}`}var A=a(9),H=a(73),B=a(71);const V={series:[],pageInfo:{afterKey:null,total:-1}},_=e=>{const{metricsExplorerOptions:t,timerange:a,transform:n,sortState:s,currentPageIndex:i}=e,[l,u]=Object(r.useState)([]),c=function(){var e;const t=null===(e=Object(A.useKibana)().services.http)||void 0===e?void 0:e.fetch;if(!t)throw new Error("Could not find Kibana HTTP fetch");return t}(),{source:m,isLoadingSource:d,loadSourceRequest:g,metricIndicesExist:f}=Object(H.b)(),p=function(e){return Object(r.useMemo)((()=>{const t=Object(o.parse)(e.from),a=Object(o.parse)(e.to);if(!t||!a)throw new Error("Could not parse timerange");return{from:t.valueOf(),to:a.valueOf(),interval:"modules"}}),[e])}(a),[b,y]=Object(B.c)({createPromise:()=>{if(!m)return Promise.resolve(V);const e={metrics:t.metrics,groupBy:t.groupBy,limit:1e4,indexPattern:m.configuration.metricAlias,filterQuery:t.filterQuery,timerange:p};return c("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify(e)})},onResolve:e=>{u(e.series.map(n))},cancelPreviousOn:"creation"},[m,t,p]),E="pending"===b.state||"uninitialized"===b.state,M=d||E,v=Object(r.useMemo)((()=>[..."rejected"===g.state?[z(g.value)]:[],..."rejected"===b.state?[z(b.value)]:[]]),[b,g]);Object(r.useEffect)((()=>{y()}),[y]);const h=Object(r.useMemo)((()=>[...l].sort(function(e){return(t,a)=>{const n=t[e.field],r=a[e.field];return"asc"===e.direction?function(e,t){return null===e?-1:null===t?1:"string"==typeof e&&"string"==typeof t?e.localeCompare(t):"number"==typeof e&&"number"==typeof t?e-t:0}(n,r):function(e,t){return null===e?1:null===t?-1:"string"==typeof e&&"string"==typeof t?t.localeCompare(e):"number"==typeof e&&"number"==typeof t?t-e:0}(n,r)}}(s))),[l,s]),C=Object(r.useMemo)((()=>h.slice(0,100)),[h]),j=Object(r.useMemo)((()=>{const e=10*i,t=e+10;return C.slice(e,t)}),[C,i]),O=Object(r.useMemo)((()=>Math.ceil(C.length/10)),[C]);return{isLoading:M,data:Object(r.useMemo)((()=>v.length>0?{state:"error",errors:v}:null==f?{state:"unknown"}:f?j.length<=0?{state:"empty-indices"}:{state:"data",currentPageIndex:i,pageCount:O,rows:j}:{state:"no-indices"}),[i,v,f,j,O])}},z=e=>e instanceof Error?e:new Error(`${e}`)},140:function(e,t,a){e.exports=a.p+"2d015490d219c87a014c81f9555e556a.svg"},141:function(e,t,a){e.exports=a.p+"432a17d27c37a1b4467753dcc2332f12.svg"},484:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a.n(n),s=a(35),i=a(73),o=a(12),l=a(1),u=a(101);const c=e=>{const{data:t,isLoading:a,setCurrentPageIndex:s,setSortState:i,sortState:c,timerange:m}=e,d=Object(n.useMemo)((()=>function(e){return[{name:l.i18n.translate("xpack.infra.metricsTable.host.nameColumnHeader",{defaultMessage:"Name"}),field:"name",truncateText:!0,textOnly:!0,render:t=>r.a.createElement(u.a,{id:t,label:t,nodeType:"host",timerange:e})},{name:l.i18n.translate("xpack.infra.metricsTable.host.CpuCountColumnHeader",{defaultMessage:"# of CPUs"}),field:"cpuCount",align:"right",render:e=>r.a.createElement(u.f,{value:e})},{name:l.i18n.translate("xpack.infra.metricsTable.host.averageCpuUsagePercentColumnHeader",{defaultMessage:"CPU usage (avg.)"}),field:"averageCpuUsagePercent",align:"right",render:e=>r.a.createElement(u.f,{value:e,unit:"%"})},{name:l.i18n.translate("xpack.infra.metricsTable.host.totalMemoryMegabytesColumnHeader",{defaultMessage:"Memory total"}),field:"totalMemoryMegabytes",align:"right",render:e=>r.a.createElement(u.f,{value:e,unit:" MB"})},{name:l.i18n.translate("xpack.infra.metricsTable.host.averageMemoryUsagePercentColumnHeader",{defaultMessage:"Memory usage (avg.)"}),field:"averageMemoryUsagePercent",align:"right",render:e=>r.a.createElement(u.f,{value:e,unit:"%"})}]}(m)),[m]),g={enableAllColumns:!0,sort:c},f=Object(n.useCallback)((({sort:e})=>{e&&(i(e),s(0))}),[i,s]);return"error"===t.state?r.a.createElement(r.a.Fragment,null,t.errors.map((e=>r.a.createElement(u.c,{error:e})))):a&&"data"!==t.state?r.a.createElement(u.d,null):"no-indices"===t.state?r.a.createElement(u.e,null):"empty-indices"===t.state?r.a.createElement(u.b,null):"data"===t.state?r.a.createElement(r.a.Fragment,null,r.a.createElement(o.EuiBasicTable,{tableCaption:l.i18n.translate("xpack.infra.metricsTable.host.tableCaption",{defaultMessage:"Infrastructure metrics for hosts"}),items:t.rows,columns:d,sorting:g,onChange:f,loading:a,noItemsMessage:r.a.createElement(u.d,null),"data-test-subj":"hostMetricsTable"}),r.a.createElement(o.EuiSpacer,{size:"s"}),r.a.createElement(o.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",responsive:!1,wrap:!0},r.a.createElement(o.EuiFlexItem,{grow:!1},r.a.createElement(u.g,{ariaLabel:l.i18n.translate("xpack.infra.metricsTable.host.paginationAriaLabel",{defaultMessage:"Host metrics pagination"}),pageCount:t.pageCount,currentPageIndex:t.currentPageIndex,setCurrentPageIndex:s,"data-test-subj":"hostMetricsTablePagination"})))):null},m={sourceFilter:{term:{"event.module":"system"}},groupByField:"host.name",metricsMap:{"system.cpu.cores":{aggregation:"max",field:"system.cpu.cores"},"system.cpu.total.norm.pct":{aggregation:"avg",field:"system.cpu.total.norm.pct"},"system.memory.total":{aggregation:"max",field:"system.memory.total"},"system.memory.used.pct":{aggregation:"avg",field:"system.memory.used.pct"}}},d=Object(u.i)(m.metricsMap),g=Object(u.j)(d);function f(e){return 0===e.rows.length?{name:e.id,cpuCount:null,averageCpuUsagePercent:null,totalMemoryMegabytes:null,averageMemoryUsagePercent:null}:{name:e.id,...p(e.rows)}}function p(e){const{cpuCountValues:t,averageCpuUsagePercentValues:a,totalMemoryMegabytesValues:n,averageMemoryUsagePercentValues:r}=function(e){const t=[],a=[],n=[],r=[];return e.forEach((e=>{const{cpuCount:s,averageCpuUsagePercent:i,totalMemoryMegabytes:o,averageMemoryUsagePercent:l}=function(e){return{cpuCount:g(e,"system.cpu.cores"),averageCpuUsagePercent:g(e,"system.cpu.total.norm.pct"),totalMemoryMegabytes:g(e,"system.memory.total"),averageMemoryUsagePercent:g(e,"system.memory.used.pct")}}(e);null!==s&&t.push(s),null!==i&&a.push(i),null!==o&&n.push(o),null!==l&&r.push(l)})),{cpuCountValues:t,averageCpuUsagePercentValues:a,totalMemoryMegabytesValues:n,averageMemoryUsagePercentValues:r}}(e);let s=null;0!==t.length&&(s=t.at(-1));let i=null;0!==a.length&&(i=Object(u.l)(Object(u.h)(a)));let o=null;if(0!==n.length){const e=n.at(-1),t=1e6;o=Math.floor(e/t)}let l=null;return 0!==r.length&&(l=Object(u.l)(Object(u.h)(r))),{cpuCount:s,averageCpuUsagePercent:i,totalMemoryMegabytes:o,averageMemoryUsagePercent:l}}function b({timerange:e,filterClauseDsl:t}){const a=function({timerange:e,filterClauseDsl:t}){const[a,r]=Object(n.useState)(0),[s,i]=Object(n.useState)({field:"averageCpuUsagePercent",direction:"desc"}),{options:o}=Object(n.useMemo)((()=>Object(u.k)(m,t)),[t]),{data:l,isLoading:c}=Object(u.m)({metricsExplorerOptions:o,timerange:e,transform:f,sortState:s,currentPageIndex:a});return{data:l,isLoading:c,setCurrentPageIndex:r,setSortState:i,sortState:s,timerange:e}}({timerange:e,filterClauseDsl:t});return r.a.createElement(c,a)}t.default=function({timerange:e,filterClauseDsl:t,sourceId:a,...n}){return r.a.createElement(s.b,n,r.a.createElement(i.a,{sourceId:a},r.a.createElement(b,{timerange:e,filterClauseDsl:t})))}}}]);