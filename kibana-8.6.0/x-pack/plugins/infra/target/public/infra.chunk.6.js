/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[6],{109:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return l}));var n=s(2),r=s(192),i=s.n(r),o=s(89),u=s.n(o),c=s(13);const a=({from:e,to:t})=>{const{services:s}=Object(c.b)();return[Object(n.useCallback)((()=>{const n=s.data.query.timefilter.timefilter;return n.isTimeTouched()?n.getTime():{from:e,to:t}}),[s.data.query.timefilter.timefilter,e,t]),s.data.query.timefilter.timefilter.setTime]},l=(e,t,s)=>{const{services:r}=Object(c.b)(),[o,l]=a(e);u()((()=>{e.from===t.from&&e.to===t.to||l({from:t.from,to:t.to})})),i()((()=>{l({from:t.from,to:t.to})}),[t.from,t.to,l]),Object(n.useEffect)((()=>{const e=r.data.query.timefilter.timefilter.getTimeUpdate$().subscribe((()=>{if(s){const e=o();s(e)}}));return()=>e.unsubscribe()}),[o,s,r.data.query.timefilter.timefilter])}},113:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(55);const r=(e,t,s=!0)=>{try{return e?JSON.stringify(Object(n.toElasticsearchQuery)(Object(n.fromKueryExpression)(e),t)):""}catch(e){if(s)return"";throw e}}},115:function(e,t,s){"use strict";s.d(t,"a",(function(){return u})),s.d(t,"b",(function(){return c}));var n=s(70),r=s.n(n),i=s(25),o=s(2);const[u,c]=r()((()=>({metricThresholdPrefill:(()=>{const[e,t]=Object(o.useState)({groupBy:void 0,filterQuery:void 0,metrics:[]}),{groupBy:s,filterQuery:n,metrics:r}=e;return{groupBy:s,filterQuery:n,metrics:r,setPrefillOptions(s){Object(i.isEqual)(s,e)||t(s)}}})(),inventoryPrefill:(()=>{const[e,t]=Object(o.useState)("host"),[s,n]=Object(o.useState)(),[r,i]=Object(o.useState)({type:"cpu"}),[u,c]=Object(o.useState)([]);return{nodeType:e,filterQuery:s,metric:r,customMetrics:u,setNodeType:t,setFilterQuery:n,setMetric:i,setCustomMetrics:c}})()})))},123:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var n=s(25),r=s(156);const i=e=>{const t=Object(n.min)(e);return Object(n.isNumber)(t)&&Number.isFinite(t)?t:void 0},o=e=>{const t=Object(n.max)(e);return Object(n.isNumber)(t)&&Number.isFinite(t)?t:void 0},u=(e,t,s=!1)=>{const u=e.rows.reduce(((e,u)=>{const c=t.map(((e,t)=>u[Object(r.a)(e,t)]||null)).filter((e=>Object(n.isNumber)(e))),a=i(c),l=s?1.1*Object(n.sum)(c):o(c);return e.concat([a||null,l||null])}),[]).filter((e=>Object(n.isNumber)(e)));return{min:i(u)||0,max:o(u)||0}}},124:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(33),r=s(31),i=s(268);const o=e=>{if(e&&e.field){const t=Object(i.a)(e);return t===r.b.bits&&"rate"===e.aggregation?Object(n.b)(r.b.bits,"{{value}}/s"):Object(n.b)(t)}return Object(n.b)(r.b.number)}},125:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var n=s(2),r=s.n(n),i=s(52),o=s(82),u=s(269),c=s(84),a=s(136),l=s(156);const d=e=>c.b.bar===e.type?r.a.createElement(p,e):r.a.createElement(g,e),g=({metric:e,id:t,series:s,type:n,stack:d,opacity:g})=>{const p=Object(a.a)(),h=e.color&&Object(o.b)(e.color)||Object(o.b)(o.a.color0),f=Array.isArray(t)?t.map((t=>Object(l.a)(e,t))).slice(t.length-1,t.length):[Object(l.a)(e,t)],m=Array.isArray(t)&&t.length>1?t.map((t=>Object(l.a)(e,t))).slice(0,1):void 0,b=`series-${s.id}-${f.join("-")}`,y={line:{strokeWidth:2,visible:!0},area:{opacity:g||.5,visible:n===c.b.area}};return r.a.createElement(i.AreaSeries,{id:b,key:b,name:Object(u.a)(e),xScaleType:i.ScaleType.Time,yScaleType:i.ScaleType.Linear,xAccessor:"timestamp",yAccessors:f,y0Accessors:m,data:s.rows,stackAccessors:d?["timestamp"]:void 0,areaSeriesStyle:y,color:h,timeZone:p})},p=({metric:e,id:t,series:s,stack:n})=>{const c=Object(a.a)(),d=e.color&&Object(o.b)(e.color)||Object(o.b)(o.a.color0),g=Array.isArray(t)?t.map((t=>Object(l.a)(e,t))).slice(t.length-1,t.length):[Object(l.a)(e,t)],p=`series-${s.id}-${g.join("-")}`,h={rectBorder:{stroke:d,strokeWidth:1,visible:!0},rect:{opacity:1}};return r.a.createElement(i.BarSeries,{id:p,key:p,name:Object(u.a)(e),xScaleType:i.ScaleType.Time,yScaleType:i.ScaleType.Linear,xAccessor:"timestamp",yAccessors:g,data:s.rows,stackAccessors:n?["timestamp"]:void 0,barSeriesStyle:h,color:d,timeZone:c})}},156:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n=(e,t)=>`metric_${t}`},157:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(1),r=s(55),i=s(2),o=s.n(i),u=s(270),c=s(276);const a=({derivedIndexPattern:e,onSubmit:t,onChange:s,value:a,placeholder:d,curryLoadSuggestions:g=l})=>{const[p,h]=Object(i.useState)(a||""),[f,m]=Object(i.useState)(!0);Object(i.useEffect)((()=>{a&&h(a)}),[a]);const b=e=>{m(function(e){try{Object(r.fromKueryExpression)(e)}catch(e){return!1}return!0}(e)),h(e),s&&s(e)},y={...e,fields:e.fields},S=n.i18n.translate("xpack.infra.homePage.toolbar.kqlSearchFieldPlaceholder",{defaultMessage:"Search for infrastructure dataâ€¦ (e.g. host.name:host-1)"});return o.a.createElement(u.a,{indexPattern:y},(({isLoadingSuggestions:e,loadSuggestions:s,suggestions:n})=>o.a.createElement(c.a,{"aria-label":d,isLoadingSuggestions:e,isValid:f,loadSuggestions:g(s),onChange:b,onSubmit:t,placeholder:d||S,suggestions:n,value:p})))},l=e=>(...t)=>e(...t)},192:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(2),r=s(193);t.default=function(e,t){var s=r.useFirstMountState();n.useEffect((function(){if(!s)return e()}),t)}},193:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useFirstMountState=void 0;var n=s(2);t.useFirstMountState=function(){var e=n.useRef(!0);return e.current?(e.current=!1,!0):e.current}},268:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(25),r=s(31);const i=e=>{if(e&&e.field){const t=Object(n.last)(e.field.split(/\./));if("pct"===t)return r.b.percent;if("bytes"===t&&"rate"===e.aggregation)return r.b.bits;if("bytes"===t)return r.b.bytes}return r.b.number}},269:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n=e=>e.label?e.label:`${e.aggregation}(${e.field||""})`},270:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var n=s(6),r=s.n(n),i=s(2),o=s.n(i),u=s(9);class WithKueryAutocompletionComponent extends o.a.Component{constructor(...e){super(...e),r()(this,"state",{currentRequest:null,suggestions:[]}),r()(this,"loadSuggestions",(async(e,t,s,n)=>{const{indexPattern:r}=this.props,i="kuery";if(!this.props.kibana.services.unifiedSearch.autocomplete.hasQuerySuggestions(i))return;this.setState({currentRequest:{expression:e,cursorPosition:t},suggestions:[]});const o=await this.props.kibana.services.unifiedSearch.autocomplete.getQuerySuggestions({language:i,query:e,selectionStart:t,selectionEnd:t,indexPatterns:[r],boolFilter:[]})||[],u=n?n(o):o;this.setState((n=>n.currentRequest&&n.currentRequest.expression!==e&&n.currentRequest.cursorPosition!==t?n:{...n,currentRequest:null,suggestions:s?u.slice(0,s):u}))}))}render(){const{currentRequest:e,suggestions:t}=this.state;return this.props.children({isLoadingSuggestions:null!==e,loadSuggestions:this.loadSuggestions,suggestions:t})}}const c=Object(u.withKibana)(WithKueryAutocompletionComponent)},276:function(e,t,s){"use strict";s.d(t,"a",(function(){return autocomplete_field_AutocompleteField}));var n=s(6),r=s.n(n),i=s(12),o=s(2),u=s.n(o),c=s(20);function a(...e){return(t,s)=>e.reduce(((e,t)=>t(e,s)||e),t)}s(25);var l=s(68),d=s(106);const g=e=>{const{isSelected:t,onClick:s,onMouseEnter:n,suggestion:r}=e;return u.a.createElement(p,{isSelected:t,onClick:s,onMouseEnter:n},u.a.createElement(f,{suggestionType:r.type},u.a.createElement(i.EuiIcon,{type:y(r.type)})),u.a.createElement(m,null,r.text),u.a.createElement(b,null,r.description))};g.defaultProps={isSelected:!1};const p=c.euiStyled.div`
  display: flex;
  flex-direction: row;
  font-size: ${e=>e.theme.eui.euiFontSizeS};
  height: ${e=>e.theme.eui.euiSizeXL};
  white-space: nowrap;
  background-color: ${e=>e.isSelected?e.theme.eui.euiColorLightestShade:"transparent"};
`,h=c.euiStyled.div`
  align-items: center;
  cursor: pointer;
  display: flex;
  flex-direction: row;
  height: ${e=>e.theme.eui.euiSizeXL};
  padding: ${e=>e.theme.eui.euiSizeXS};
`,f=Object(c.euiStyled)(h)`
  background-color: ${e=>Object(d.transparentize)(.9,S(e.theme,e.suggestionType))};
  color: ${e=>S(e.theme,e.suggestionType)};
  flex: 0 0 auto;
  justify-content: center;
  width: ${e=>e.theme.eui.euiSizeXL};
`,m=Object(c.euiStyled)(h)`
  flex: 2 0 0;
  font-family: ${e=>e.theme.eui.euiCodeFontFamily};
`,b=Object(c.euiStyled)(h)`
  flex: 3 0 0;

  p {
    display: inline;

    span {
      font-family: ${e=>e.theme.eui.euiCodeFontFamily};
    }
  }
`,y=e=>{switch(e){case l.QuerySuggestionTypes.Field:return"kqlField";case l.QuerySuggestionTypes.Value:return"kqlValue";case l.QuerySuggestionTypes.RecentSearch:return"search";case l.QuerySuggestionTypes.Conjunction:return"kqlSelector";case l.QuerySuggestionTypes.Operator:return"kqlOperand";default:return"empty"}},S=(e,t)=>{switch(t){case l.QuerySuggestionTypes.Field:return null==e?void 0:e.eui.euiColorVis7;case l.QuerySuggestionTypes.Value:return null==e?void 0:e.eui.euiColorVis0;case l.QuerySuggestionTypes.Operator:return null==e?void 0:e.eui.euiColorVis1;case l.QuerySuggestionTypes.Conjunction:return null==e?void 0:e.eui.euiColorVis2;case l.QuerySuggestionTypes.RecentSearch:default:return null==e?void 0:e.eui.euiColorMediumShade}};class autocomplete_field_AutocompleteField extends u.a.Component{constructor(...e){super(...e),r()(this,"state",{areSuggestionsVisible:!1,isFocused:!1,selectedIndex:null}),r()(this,"inputElement",null),r()(this,"handleChangeInputRef",(e=>{this.inputElement=e})),r()(this,"handleChange",(e=>{this.changeValue(e.currentTarget.value)})),r()(this,"handleKeyDown",(e=>{const{suggestions:t}=this.props;switch(e.key){case"ArrowUp":e.preventDefault(),t.length>0&&this.setState(a(E,O));break;case"ArrowDown":e.preventDefault(),t.length>0?this.setState(a(E,v)):this.updateSuggestions();break;case"Enter":e.preventDefault(),null!==this.state.selectedIndex?this.applySelectedSuggestion():this.submit();break;case"Escape":e.preventDefault(),this.setState(x)}})),r()(this,"handleKeyUp",(e=>{switch(e.key){case"ArrowLeft":case"ArrowRight":case"Home":case"End":this.updateSuggestions()}})),r()(this,"handleFocus",(()=>{this.setState(a(E,k))})),r()(this,"handleBlur",(()=>{this.setState(a(x,w))})),r()(this,"selectSuggestionAt",(e=>()=>{this.setState(j(e))})),r()(this,"applySelectedSuggestion",(()=>{null!==this.state.selectedIndex&&this.applySuggestionAt(this.state.selectedIndex)()})),r()(this,"applySuggestionAt",(e=>()=>{const{value:t,suggestions:s}=this.props,n=s[e];if(!n)return;const r=t.substr(0,n.start)+n.text+t.substr(n.end);this.setState(x),this.changeValue(r),this.focusInputElement()})),r()(this,"changeValue",(e=>{const{onChange:t}=this.props;t&&t(e)})),r()(this,"focusInputElement",(()=>{this.inputElement&&this.inputElement.focus()})),r()(this,"showSuggestions",(()=>{this.setState(E)})),r()(this,"submit",(()=>{const{isValid:e,onSubmit:t,value:s}=this.props;e&&t&&t(s),this.setState(x)})),r()(this,"updateSuggestions",(()=>{const e=this.inputElement&&this.inputElement.selectionStart||0;this.props.loadSuggestions(this.props.value,e,200)}))}render(){const{suggestions:e,isLoadingSuggestions:t,isValid:s,placeholder:n,value:r,disabled:o,"aria-label":c}=this.props,{areSuggestionsVisible:a,selectedIndex:l}=this.state;return u.a.createElement(i.EuiOutsideClickDetector,{onOutsideClick:this.handleBlur},u.a.createElement(T,null,u.a.createElement(i.EuiFieldSearch,{fullWidth:!0,disabled:o,inputRef:this.handleChangeInputRef,isLoading:t,isInvalid:!s,onChange:this.handleChange,onFocus:this.handleFocus,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onSearch:this.submit,placeholder:n,value:r,"aria-label":c,"data-test-subj":"infraSearchField"}),a&&!t&&e.length>0?u.a.createElement(A,{"data-test-subj":"infraSuggestionsPanel"},e.map(((e,t)=>u.a.createElement(g,{key:e.text,suggestion:e,isSelected:t===l,onMouseEnter:this.selectSuggestionAt(t),onClick:this.applySuggestionAt(t)})))):null))}componentDidMount(){this.inputElement&&this.props.autoFocus&&this.inputElement.focus()}componentDidUpdate(e){const t=e.value!==this.props.value,s=e.suggestions!==this.props.suggestions;t&&this.updateSuggestions(),t&&""===this.props.value&&this.submit(),s&&this.state.isFocused&&this.showSuggestions()}}const O=(e,t)=>({...e,selectedIndex:0===t.suggestions.length?null:null!==e.selectedIndex?(e.selectedIndex+t.suggestions.length-1)%t.suggestions.length:Math.max(t.suggestions.length-1,0)}),v=(e,t)=>({...e,selectedIndex:0===t.suggestions.length?null:null!==e.selectedIndex?(e.selectedIndex+1)%t.suggestions.length:0}),j=e=>(t,s)=>({...t,selectedIndex:0===s.suggestions.length?null:e>=0&&e<s.suggestions.length?e:0}),E=e=>({...e,areSuggestionsVisible:!0}),x=e=>({...e,areSuggestionsVisible:!1,selectedIndex:null}),k=e=>({...e,isFocused:!0}),w=e=>({...e,isFocused:!1}),T=c.euiStyled.div`
  position: relative;
`,A=Object(c.euiStyled)(i.EuiPanel).attrs((()=>({paddingSize:"none",hasShadow:!0})))`
  position: absolute;
  width: 100%;
  margin-top: 2px;
  overflow-x: hidden;
  overflow-y: scroll;
  z-index: ${e=>e.theme.eui.euiZLevel1};
  max-height: 322px;
`},82:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return u})),s(25);var n=s(12);let r;!function(e){e.color0="color0",e.color1="color1",e.color2="color2",e.color3="color3",e.color4="color4",e.color5="color5",e.color6="color6",e.color7="color7",e.color8="color8",e.color9="color9"}(r||(r={}));const i=Object(n.euiPaletteColorBlind)(),o={[r.color0]:i[1],[r.color1]:i[2],[r.color2]:i[0],[r.color3]:i[3],[r.color4]:i[4],[r.color5]:i[5],[r.color6]:i[6],[r.color7]:i[7],[r.color8]:i[8],[r.color9]:i[9]},u=(c=o,e=>c[e]);var c},84:function(e,t,s){"use strict";s.d(t,"b",(function(){return p})),s.d(t,"d",(function(){return h})),s.d(t,"f",(function(){return f})),s.d(t,"e",(function(){return y})),s.d(t,"g",(function(){return S})),s.d(t,"a",(function(){return E})),s.d(t,"c",(function(){return k})),s.d(t,"h",(function(){return w}));var n=s(0),r=s(25),i=s(70),o=s.n(i),u=s(2),c=s(115),a=s(82),l=s(94),d=s(109);const g=n.intersection([l.d,n.partial({rate:n.boolean,color:n.keyof(Object.fromEntries(Object(r.values)(a.a).map((e=>[e,null])))),label:n.string})]);let p,h;!function(e){e.line="line",e.area="area",e.bar="bar"}(p||(p={})),function(e){e.fromZero="fromZero",e.auto="auto"}(h||(h={}));const f=n.type({yAxisMode:n.keyof(Object.fromEntries(Object(r.values)(h).map((e=>[e,null])))),type:n.keyof(Object.fromEntries(Object(r.values)(p).map((e=>[e,null])))),stack:n.boolean}),m=n.type({aggregation:n.string,metrics:n.array(g)}),b=n.partial({limit:n.number,groupBy:n.union([n.string,n.array(n.string)]),filterQuery:n.string,source:n.string,forceInterval:n.boolean,dropLastBucket:n.boolean}),y=n.intersection([m,b]),S=n.type({from:n.string,to:n.string,interval:n.string}),O={from:"now-1h",to:"now",interval:">=10s"},v={type:p.line,yAxisMode:h.fromZero,stack:!1},j={aggregation:"avg",metrics:[{aggregation:"avg",field:"system.cpu.total.norm.pct",color:a.a.color0},{aggregation:"avg",field:"kubernetes.pod.cpu.usage.node.pct",color:a.a.color1},{aggregation:"avg",field:"docker.cpu.total.pct",color:a.a.color2}],source:"default"},E={options:j,chartOptions:v,currentTimerange:O};function x(e,t){const s=localStorage.getItem(e),[n,r]=Object(u.useState)(function(e,t){if(!e)return t;try{return JSON.parse(e)}catch(e){return t}}(s,t));return Object(u.useEffect)((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,r]}const[k,w]=o()((()=>{const e={from:"now-1h",to:"now"},[t]=Object(d.a)(e),{from:s,to:n}=t(),r={from:s,to:n,interval:O.interval},[i,o]=x("MetricsExplorerOptions",j),[a,l]=Object(u.useState)(r);Object(d.b)(e,{from:a.from,to:a.to});const[g,p]=x("MetricsExplorerChartOptions",v),[h,f]=Object(u.useState)(!1),{metricThresholdPrefill:m}=Object(c.b)(),b=Object(u.useMemo)((()=>m),[m]);return Object(u.useEffect)((()=>{if(b){const{setPrefillOptions:e}=b,{metrics:t,groupBy:s,filterQuery:n}=i;e({metrics:t,groupBy:s,filterQuery:n})}}),[i,b]),{defaultViewState:{options:j,chartOptions:v,currentTimerange:r},options:i,chartOptions:g,setChartOptions:p,currentTimerange:a,isAutoReloading:h,setOptions:o,setTimeRange:l,startAutoReload:()=>f(!0),stopAutoReload:()=>f(!1)}}))}}]);