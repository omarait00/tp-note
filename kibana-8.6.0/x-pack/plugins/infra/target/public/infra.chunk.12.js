/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[12],{104:function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return u}));var a=r(0),n=r(18),o=r(14),i=r(22),l=r(81);const c="sourceId",s=()=>Object(l.b)({defaultState:"default",decodeUrlState:p,encodeUrlState:m,urlStateKey:c}),u=e=>Object(l.a)(c,e),d=a.union([a.string,a[void 0]]),m=d.encode,p=e=>Object(n.pipe)(d.decode(e),Object(o.fold)(Object(i.constant)(void 0),i.identity))},117:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);t.default=function(e){a.useEffect(e,[])}},119:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);t.default=function(){var e=a.useRef(!1),t=a.useCallback((function(){return e.current}),[]);return a.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},130:function(e,t,r){"use strict";r.d(t,"c",(function(){return g})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return E})),r.d(t,"d",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return l}));var a=r(0),n=r(135);r(21);const o=a.type({time:a.number,tiebreaker:a.number}),i=a.type({before:a.union([o,a.literal("last")])}),l=a.type({after:a.union([o,a.literal("first")])}),c=(a.type({center:o}),a.type({constant:a.string})),s=a.type({field:a.string,value:n.a,highlights:a.array(a.string)}),u=a.union([c,s]),d=a.type({columnId:a.string,timestamp:a.number}),m=a.type({columnId:a.string,field:a.string,value:n.a,highlights:a.array(a.string)}),p=a.type({columnId:a.string,message:a.array(u)}),f=a.union([d,m,p]),g=a.union([a.type({}),a.type({"container.id":a.string}),a.type({"host.name":a.string,"log.file.path":a.string})]),b=a.type({field:a.string,value:n.a}),E=a.type({id:a.string,index:a.string,cursor:o,columns:a.array(f),context:g})},131:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(0);const n=a.type({startTime:a.number,endTime:a.number})},135:function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return l}));var a=r(0);const n=a.union([a.null,a.boolean,a.number,a.string]),o=a.recursion("JsonValue",(()=>a.union([n,i,l]))),i=a.recursion("JsonArray",(()=>a.array(o))),l=a.recursion("JsonObject",(()=>a.record(a.string,o)))},158:function(e,t,r){"use strict";r.d(t,"i",(function(){return p})),r.d(t,"d",(function(){return f})),r.d(t,"f",(function(){return g})),r.d(t,"j",(function(){return b})),r.d(t,"k",(function(){return E})),r.d(t,"h",(function(){return v})),r.d(t,"g",(function(){return h})),r.d(t,"a",(function(){return O})),r.d(t,"e",(function(){return j})),r.d(t,"c",(function(){return x})),r.d(t,"b",(function(){return C}));var a=r(2),n=r.n(a),o=r(52),i=r(49),l=r.n(i),c=r(1),s=r(12),u=r(19),d=r(25),m=r(11);const p={headerFormatter:e=>l()(e.value).format("Y-MM-DD HH:mm:ss")},f=20,g={s:c.i18n.translate("xpack.infra.alerts.timeLabels.seconds",{defaultMessage:"seconds"}),m:c.i18n.translate("xpack.infra.alerts.timeLabels.minutes",{defaultMessage:"minutes"}),h:c.i18n.translate("xpack.infra.alerts.timeLabels.hours",{defaultMessage:"hours"}),d:c.i18n.translate("xpack.infra.alerts.timeLabels.days",{defaultMessage:"days"})},b=(e,t)=>Object(a.useMemo)((()=>"number"==typeof e&&"number"==typeof t?Object(o.niceTimeFormatter)([e,t]):e=>`${e}`),[e,t]),E=m.a,v=(e,t=!1)=>{let r=null,a=null;const n=e.reduce(((e,t)=>(t.points.forEach((t=>{const r=e[t.timestamp]||[];e[t.timestamp]=[...r,t.value]})),e)),{});Object.values(n).forEach((e=>{const n=t?Object(d.sum)(e):Object(d.max)(e),o=Object(d.min)(e);n&&(!a||n>a)&&(a=n),o&&(!r||o<r)&&(r=o)}));const o=Object.keys(n).map(Number),i=Object(d.min)(o)||0,l=Object(d.max)(o)||0;return{yMin:r||0,yMax:a||0,xMin:i,xMax:l}},h=e=>e?o.DARK_THEME:o.LIGHT_THEME,y=({children:e})=>n.a.createElement("div",{style:{width:"100%",height:150,display:"flex",justifyContent:"center",alignItems:"center"}},e),O=({children:e})=>n.a.createElement("div",{style:{width:"100%",height:150}},e),j=()=>n.a.createElement(y,null,n.a.createElement(s.EuiText,{color:"subdued","data-test-subj":"noChartData"},n.a.createElement(u.FormattedMessage,{id:"xpack.infra.alerts.charts.noDataMessage",defaultMessage:"No chart data available"}))),x=()=>n.a.createElement(y,null,n.a.createElement(s.EuiText,{color:"subdued","data-test-subj":"loadingData"},n.a.createElement(u.FormattedMessage,{id:"xpack.infra.alerts.charts.loadingMessage",defaultMessage:"Loading"}))),C=()=>n.a.createElement(y,null,n.a.createElement(s.EuiText,{color:"subdued","data-test-subj":"chartErrorState"},n.a.createElement(u.FormattedMessage,{id:"xpack.infra.alerts.charts.errorMessage",defaultMessage:"Uh oh, something went wrong"})))},475:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(53),n=r(2),o=a.__importDefault(r(476));t.default=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var a=o.default(e,t),i=a[0],l=a[1],c=a[2];return n.useEffect(c,r),[i,l]}},476:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);t.default=function(e,t){void 0===t&&(t=0);var r=a.useRef(!1),n=a.useRef(),o=a.useRef(e),i=a.useCallback((function(){return r.current}),[]),l=a.useCallback((function(){r.current=!1,n.current&&clearTimeout(n.current),n.current=setTimeout((function(){r.current=!0,o.current()}),t)}),[t]),c=a.useCallback((function(){r.current=null,n.current&&clearTimeout(n.current)}),[]);return a.useEffect((function(){o.current=e}),[e]),a.useEffect((function(){return l(),c}),[t]),[i,c,l]}},480:function(e,t,r){"use strict";r.r(t),r.d(t,"ExpressionEditor",(function(){return se})),r.d(t,"SourceStatusWrapper",(function(){return ue})),r.d(t,"Editor",(function(){return de})),r.d(t,"ExpressionLike",(function(){return me}));var a=r(12),n=r(1),o=r(2),i=r.n(o),l=r(89),c=r.n(l),s=r(61),u=r(8),d=r(21),m=r(104),p=r(13),f=r(74);const g=({onChange:e,fields:t,selectedGroups:r=[],label:n,placeholder:l})=>{const c=Object(o.useCallback)((t=>{const r=t.map((e=>e.label));e(r)}),[e]),s=Object(o.useMemo)((()=>r.map((e=>({label:e})))),[r]),u=Object(o.useMemo)((()=>t.filter((e=>e.aggregatable)).map((e=>({label:e.name})))),[t]);return i.a.createElement("div",{style:{minWidth:"300px"}},i.a.createElement(a.EuiComboBox,{placeholder:l,"aria-label":n,fullWidth:!0,singleSelection:!1,selectedOptions:s,options:u,onChange:c,isClearable:!0}))},b=n.i18n.translate("xpack.infra.alerting.alertFlyout.groupByLabel",{defaultMessage:"Group By"}),E=n.i18n.translate("xpack.infra.alerting.alertFlyout.groupBy.placeholder",{defaultMessage:"Nothing (ungrouped)"}),v=({selectedGroups:e=[],fields:t,label:r,onChange:n})=>{const[l,c]=Object(o.useState)(!1),s=Object(o.useMemo)((()=>e.length>0?e.join(", "):E),[e]),u=null!=r?r:b;return i.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiPopover,{id:"groupByExpression",button:i.a.createElement(a.EuiExpression,{description:u,uppercase:!0,value:s,isActive:l,onClick:()=>c(!l)}),isOpen:l,closePopover:()=>c(!1),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},i.a.createElement("div",{style:{zIndex:11e3}},i.a.createElement(a.EuiPopoverTitle,null,u),i.a.createElement(g,{selectedGroups:e,onChange:n,fields:t,label:u,placeholder:E})))))};var h=r(37),y=r(30),O=r.n(y),j=r(19),x=r(25);const C=n.i18n.translate("xpack.infra.logs.alertFlyout.firstCriterionFieldPrefix",{defaultMessage:"with"}),w=n.i18n.translate("xpack.infra.logs.alertFlyout.successiveCriterionFieldPrefix",{defaultMessage:"and"}),T=n.i18n.translate("xpack.infra.logs.alertFlyout.criterionFieldTitle",{defaultMessage:"Field"}),S=n.i18n.translate("xpack.infra.logs.alertFlyout.criterionComparatorValueTitle",{defaultMessage:"Comparison : Value"}),M=e=>"number"===(null==e?void 0:e.type)?[{value:u.a.GT,text:u.b[u.a.GT]},{value:u.a.GT_OR_EQ,text:u.b[u.a.GT_OR_EQ]},{value:u.a.LT,text:u.b[u.a.LT]},{value:u.a.LT_OR_EQ,text:u.b[u.a.LT_OR_EQ]},{value:u.a.EQ,text:u.b[`${u.a.EQ}:number`]},{value:u.a.NOT_EQ,text:u.b[`${u.a.NOT_EQ}:number`]}]:null!=e&&e.aggregatable?[{value:u.a.EQ,text:u.b[u.a.EQ]},{value:u.a.NOT_EQ,text:u.b[u.a.NOT_EQ]}]:[{value:u.a.MATCH,text:u.b[u.a.MATCH]},{value:u.a.NOT_MATCH,text:u.b[u.a.NOT_MATCH]},{value:u.a.MATCH_PHRASE,text:u.b[u.a.MATCH_PHRASE]},{value:u.a.NOT_MATCH_PHRASE,text:u.b[u.a.NOT_MATCH_PHRASE]}],k=(e,t)=>e.find((e=>e.name===t)),F=({idx:e,fields:t,criterion:r,updateCriterion:l,removeCriterion:c,canDelete:s,errors:d})=>{var m,p,f;const[g,b]=Object(o.useState)(!1),[E,v]=Object(o.useState)(!1),h=Object(o.useMemo)((()=>t.map((e=>({label:e.name})))),[t]),y=Object(o.useMemo)((()=>r.field?k(t,r.field):void 0),[t,r]),O=Object(o.useMemo)((()=>M(y)),[y]),j=Object(o.useCallback)((([r])=>{if(!r)return void l(e,{field:""});const a=r.label,n=k(t,a);if((null==y?void 0:y.type)!==(null==n?void 0:n.type)||(null==y?void 0:y.aggregatable)!==(null==n?void 0:n.aggregatable)){const t=M(n);l(e,{field:a,comparator:t[0].value,value:void 0})}else l(e,{field:a});b(!1)}),[y,t,e,l]),F=r.field?[{label:r.field}]:[];return i.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},i.a.createElement(a.EuiFlexItem,{grow:!0},i.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiPopover,{id:"criterion-field",button:i.a.createElement(a.EuiExpression,{description:0===e?C:w,uppercase:!0,value:null!==(m=r.field)&&void 0!==m?m:"a chosen field",isActive:g,color:0===d.field.length?"success":"danger",onClick:e=>{e.stopPropagation(),b(!g)}}),isOpen:g,closePopover:()=>b(!1),onClick:e=>e.stopPropagation(),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},i.a.createElement("div",null,i.a.createElement(a.EuiPopoverTitle,null,T),i.a.createElement(a.EuiFormRow,{style:{minWidth:"300px"},isInvalid:d.field.length>0,error:d.field},i.a.createElement(a.EuiComboBox,{compressed:!0,fullWidth:!0,isClearable:!1,singleSelection:{asPlainText:!0},options:h,selectedOptions:F,onChange:j}))))),i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiPopover,{id:"criterion-comparator-value",button:i.a.createElement(a.EuiExpression,{description:r.comparator&&null!==(p=null!==(f=u.b[`${r.comparator}:${null==y?void 0:y.type}`])&&void 0!==f?f:u.b[r.comparator])&&void 0!==p?p:"",uppercase:!0,value:r.value,isActive:E,color:0===d.comparator.length&&0===d.value.length?"success":"danger",onClick:e=>{e.stopPropagation(),v(!E)}}),isOpen:E,closePopover:()=>v(!1),onClick:e=>e.stopPropagation(),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},i.a.createElement("div",null,i.a.createElement(a.EuiPopoverTitle,null,S),i.a.createElement(a.EuiFlexGroup,{gutterSize:"l"},i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiFormRow,{isInvalid:d.comparator.length>0,error:d.comparator},i.a.createElement(a.EuiSelect,{compressed:!0,hasNoInitialSelection:null==r.comparator,value:r.comparator,onChange:t=>l(e,{comparator:t.target.value}),options:O}))),i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiFormRow,{isInvalid:d.value.length>0,error:d.value},"number"===(null==y?void 0:y.type)?i.a.createElement(a.EuiFieldNumber,{compressed:!0,value:r.value,onChange:t=>{const r=parseFloat(t.target.value);l(e,{value:Object(x.isNumber)(r)&&Object(x.isFinite)(r)?r:void 0})}}):i.a.createElement(a.EuiFieldText,{compressed:!0,value:r.value,onChange:t=>l(e,{value:t.target.value})}))))))))),s&&i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiButtonIcon,{"aria-label":n.i18n.translate("xpack.infra.logs.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"danger",iconType:"trash",onClick:t=>{t.stopPropagation(),c(e)}})))};var P=r(475),L=r.n(P),_=r(52),R=r(9),A=r(158),I=r(82),z=r(213),G=r(71),B=r(87);var V=r(136);const Q=({ruleParams:e,chartCriterion:t,sourceId:r,showThreshold:a})=>{const n=Object(o.useMemo)((()=>{const{field:r,comparator:a,value:n}=t,o={criteria:r&&a&&n?[{field:r,comparator:a,value:n}]:[],count:{comparator:e.count.comparator,value:e.count.value},timeSize:e.timeSize,timeUnit:e.timeUnit,groupBy:e.groupBy};try{return Object(d.b)(z.b)(o)}catch(e){return null}}),[e.timeSize,e.timeUnit,e.groupBy,e.count.comparator,e.count.value,t]);return null===n||0===n.criteria.length?null:i.a.createElement(U,{buckets:n.groupBy&&0!==n.groupBy.length?A.d/4:A.d,sourceId:r,threshold:e.count,chartAlertParams:n,showThreshold:a})},U=({buckets:e,sourceId:t,threshold:r,chartAlertParams:n,showThreshold:l})=>{const{uiSettings:c}=Object(R.useKibana)().services,s=(null==c?void 0:c.get("theme:darkMode"))||!1,m=Object(V.a)(),{getChartPreviewData:p,isLoading:f,hasError:g,chartPreviewData:b}=(({sourceId:e,ruleParams:t,buckets:r})=>{const{http:a}=Object(R.useKibana)().services,[n,i]=Object(o.useState)([]),[l,c]=Object(o.useState)(!1),[s,u]=Object(G.c)({cancelPreviousOn:"creation",createPromise:async()=>(c(!1),await(async(e,t,r,a)=>{const n=await t(B.a,{method:"POST",body:JSON.stringify(B.l.encode({data:{sourceId:e,alertParams:r,buckets:a}}))});return Object(d.b)(B.m)(n)})(e,a.fetch,t,r)),onResolve:({data:{series:e}})=>{c(!1),i(e)},onReject:e=>{c(!0)}},[e,a,t,r]);return{chartPreviewData:n,hasError:l,isLoading:Object(o.useMemo)((()=>"pending"===s.state),[s.state]),getChartPreviewData:u}})({sourceId:t,ruleParams:n,buckets:e});L()((()=>{p()}),500,[p]);const{timeSize:E,timeUnit:v,groupBy:h}=n,y=!!(h&&h.length>0),O=!!(l&&r&&r.comparator)&&[u.a.GT,u.a.GT_OR_EQ].includes(r.comparator),x=!!(l&&r&&r.comparator)&&[u.a.LT,u.a.LT_OR_EQ].includes(r.comparator),C=Object(o.useMemo)((()=>{if(!y)return b;const e=b.sort(((e,t)=>{const r=Math.max(...e.points.map((e=>e.value)));return Math.max(...t.points.map((e=>e.value)))-r}));return(!O&&!x||O?e:e.reverse()).slice(0,5)}),[b,y,O,x]),w=Object(o.useMemo)((()=>C.reduce(((e,t)=>[...e,...t.points.reduce(((e,r)=>[...e,{...r,groupBy:t.id}]),[])]),[])),[C]),T=E*e,S=b.length>0,{yMin:M,yMax:k,xMin:F,xMax:P}=Object(A.h)(C,!1),z={max:l&&r?1.1*Math.max(k,r.value):1.1*k,min:l&&r?Math.min(M,r.value):M};l&&r&&z.min===r.value&&(z.min=.9*z.min);const Q=h&&h.length>0?h.join(", "):null,U=Object(A.j)(F,P),D=A.f[v];return f?i.a.createElement(A.c,null):g?i.a.createElement(A.b,null):S?i.a.createElement(i.a.Fragment,null,i.a.createElement(A.a,null,i.a.createElement(_.Chart,null,i.a.createElement(_.BarSeries,{id:"criterion-preview",xScaleType:_.ScaleType.Time,yScaleType:_.ScaleType.Linear,xAccessor:"timestamp",yAccessors:["value"],splitSeriesAccessors:["groupBy"],stackAccessors:void 0,data:w,barSeriesStyle:{rectBorder:{stroke:y?void 0:Object(I.b)(I.a.color0),strokeWidth:1,visible:!0},rect:{opacity:1}},color:y?void 0:Object(I.b)(I.a.color0),timeZone:m}),l&&r?i.a.createElement(_.LineAnnotation,{id:"threshold-line",domainType:_.AnnotationDomainType.YDomain,dataValues:[{dataValue:r.value}],style:{line:{strokeWidth:2,stroke:Object(I.b)(I.a.color1),opacity:1}}}):null,l&&r&&x?i.a.createElement(_.RectAnnotation,{id:"below-threshold",style:{fill:Object(I.b)(I.a.color1),opacity:.3},dataValues:[{coordinates:{x0:F,x1:P,y0:z.min,y1:r.value}}]}):null,l&&r&&O?i.a.createElement(_.RectAnnotation,{id:"above-threshold",style:{fill:Object(I.b)(I.a.color1),opacity:.3},dataValues:[{coordinates:{x0:F,x1:P,y0:r.value,y1:z.max}}]}):null,i.a.createElement(_.Axis,{id:"timestamp",position:_.Position.Bottom,showOverlappingTicks:!0,tickFormat:U}),i.a.createElement(_.Axis,{id:"values",position:_.Position.Left,tickFormat:A.k,domain:z}),i.a.createElement(_.Settings,{tooltip:A.i,theme:Object(A.g)(s)}))),i.a.createElement("div",{style:{textAlign:"center"}},null!=Q?i.a.createElement(a.EuiText,{size:"xs",color:"subdued"},i.a.createElement(j.FormattedMessage,{id:"xpack.infra.logs.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data, grouped by {groupByLabel} (showing {displayedGroups}/{totalGroups} groups)",values:{groupByLabel:Q,timeLabel:D,lookback:T,displayedGroups:C.length,totalGroups:b.length}})):i.a.createElement(a.EuiText,{size:"xs",color:"subdued"},i.a.createElement(j.FormattedMessage,{id:"xpack.infra.logs.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel} of data",values:{timeLabel:D,lookback:T}})))):i.a.createElement(A.e,null)},D=n.i18n.translate("xpack.infra.logs.alerting.threshold.ratioCriteriaQueryAText",{defaultMessage:"Query A"}),N=n.i18n.translate("xpack.infra.logs.alerting.threshold.ratioCriteriaQueryBText",{defaultMessage:"Query B"}),H=e=>{const{criteria:t,errors:r}=e;return t&&0!==t.length?Object(u.j)(t)?i.a.createElement($,O()({},e,{criteria:t,errors:r})):i.a.createElement(K,O()({},e,{criteria:t,errors:r})):null},W=e=>{const{updateCriterion:t,removeCriterion:r,addCriterion:n,criteria:o,fields:l,errors:c,ruleParams:s,sourceId:u,isRatio:d=!1}=e;return i.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},i.a.createElement(a.EuiFlexItem,{grow:!0},o.map(((e,n)=>i.a.createElement(a.EuiAccordion,{id:`criterion-${n}`,buttonContent:i.a.createElement(F,{idx:n,fields:l,criterion:e,updateCriterion:t,removeCriterion:r,canDelete:o.length>1,errors:c[n]}),key:n,arrowDisplay:"right"},i.a.createElement(Q,{ruleParams:s,chartCriterion:e,sourceId:u,showThreshold:!d})))),i.a.createElement(Y,{addCriterion:n})))},$=e=>{const{criteria:t,defaultCriterion:r,errors:n,updateCriteria:l}=e,c=Object(o.useCallback)((e=>{const r=[e,Object(u.f)(t)];l(r)}),[l,t]),s=Object(o.useCallback)((e=>{const r=[Object(u.g)(t),e];l(r)}),[l,t]),{updateCriterion:d,addCriterion:m,removeCriterion:p}=J(Object(u.g)(t),r,c),{updateCriterion:f,addCriterion:g,removeCriterion:b}=J(Object(u.f)(t),r,s);return i.a.createElement(i.a.Fragment,null,i.a.createElement(a.EuiSpacer,{size:"xxl"}),i.a.createElement(me,{text:D}),i.a.createElement(W,O()({},e,{criteria:Object(u.g)(t),updateCriterion:d,addCriterion:m,removeCriterion:p,errors:n[0],isRatio:!0})),i.a.createElement(a.EuiSpacer,{size:"l"}),i.a.createElement(me,{text:N}),i.a.createElement(W,O()({},e,{criteria:Object(u.f)(t),updateCriterion:f,addCriterion:g,removeCriterion:b,errors:n[1],isRatio:!0})))},K=e=>{const{criteria:t,defaultCriterion:r,updateCriteria:a,errors:n}=e,{updateCriterion:o,addCriterion:l,removeCriterion:c}=J(t,r,a);return i.a.createElement(W,O()({},e,{updateCriterion:o,addCriterion:l,removeCriterion:c,errors:n[0]}))},J=(e,t,r)=>({updateCriterion:Object(o.useCallback)(((t,a)=>{const n=e.map(((e,r)=>t===r?{...e,...a}:e));r(n)}),[e,r]),addCriterion:Object(o.useCallback)((()=>{const a=[...e,t];r(a)}),[e,t,r]),removeCriterion:Object(o.useCallback)((t=>{const a=e.filter(((e,r)=>r!==t));r(a)}),[e,r])}),Y=({addCriterion:e})=>i.a.createElement("div",null,i.a.createElement(a.EuiButtonEmpty,{color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:e},i.a.createElement(j.FormattedMessage,{id:"xpack.infra.logs.alertFlyout.addCondition",defaultMessage:"Add condition"}))),Z=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdPrefix",{defaultMessage:"is"}),q=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdPopoverTitle",{defaultMessage:"Threshold"}),X=({comparator:e,value:t,updateThreshold:r,errors:n})=>{const[l,c]=Object(o.useState)(!1);return i.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiPopover,{id:"threshold",button:i.a.createElement(a.EuiExpression,{description:Z,uppercase:!0,value:`${e?u.b[e]:""} ${"number"==typeof t?t:""}`,isActive:l,onClick:()=>c(!l)}),isOpen:l,closePopover:()=>c(!1),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},i.a.createElement(i.a.Fragment,null,i.a.createElement(a.EuiPopoverTitle,null,q),i.a.createElement(a.EuiFlexGroup,null,i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiFormRow,null,i.a.createElement(a.EuiSelect,{compressed:!0,value:e,onChange:e=>r({comparator:e.target.value}),options:[{value:u.a.LT,text:u.b[u.a.LT]},{value:u.a.LT_OR_EQ,text:u.b[u.a.LT_OR_EQ]},{value:u.a.GT,text:u.b[u.a.GT]},{value:u.a.GT_OR_EQ,text:u.b[u.a.GT_OR_EQ]}]}))),i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiFormRow,{isInvalid:n.value.length>0,error:n.value},i.a.createElement(a.EuiFieldNumber,{compressed:!0,value:t,onChange:e=>{const t=parseFloat(e.target.value);r({value:Object(x.isNumber)(t)&&Object(x.isFinite)(t)?t:void 0})}}))))))))},ee=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypePrefix",{defaultMessage:"when the"}),te=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypeCountSuffix",{defaultMessage:"of log entries"}),re=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypeRatioSuffix",{defaultMessage:"of Query A to Query B"}),ae=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypeCount",{defaultMessage:"count"}),ne=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypeRatio",{defaultMessage:"ratio"}),oe=({criteria:e,updateType:t})=>{const[r,n]=Object(o.useState)(!1),l=(e=>Object(u.j)(e)?"ratio":"count")(e);return i.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiPopover,{id:"thresholdType",button:i.a.createElement(i.a.Fragment,null,i.a.createElement(a.EuiExpression,{description:ee,uppercase:!0,value:"ratio"===l?ne:ae,isActive:r,onClick:()=>n(!r)}),i.a.createElement(me,{text:"ratio"===l?re.toUpperCase():te.toUpperCase()})),isOpen:r,closePopover:()=>n(!1),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},i.a.createElement(a.EuiFlexGroup,null,i.a.createElement(a.EuiFlexItem,{grow:!1},i.a.createElement(a.EuiSelect,{compressed:!0,value:l,onChange:e=>t("ratio"===l?"count":"ratio"),options:[{value:"ratio",text:ne},{value:"count",text:ae}]}))))))},ie={timeSize:5,timeUnit:"m"},le="log.level",ce=(e,t)=>e.some((e=>e.name===le))?{field:le,comparator:u.a.EQ,value:t}:{field:void 0,comparator:void 0,value:void 0},se=e=>{var t,r;const a=null!==(t=null===(r=e.metadata)||void 0===r?void 0:r.isInternal)&&void 0!==t&&t,[n]=Object(m.b)(),{services:{http:o,logViews:l}}=Object(p.b)();return i.a.createElement(i.a.Fragment,null,a?i.a.createElement(ue,e,i.a.createElement(de,e)):i.a.createElement(f.a,{logViewId:n,logViews:l.client,fetch:o.fetch},i.a.createElement(ue,e,i.a.createElement(de,e))))},ue=({children:e})=>{const{load:t,isLoading:r,hasFailedLoading:o,isUninitialized:l}=Object(f.c)();return i.a.createElement(i.a.Fragment,null,r||l?i.a.createElement("div",null,i.a.createElement(a.EuiSpacer,{size:"m"}),i.a.createElement(a.EuiLoadingSpinner,{size:"l"}),i.a.createElement(a.EuiSpacer,{size:"m"})):o?i.a.createElement(a.EuiCallOut,{title:n.i18n.translate("xpack.infra.logs.alertFlyout.sourceStatusError",{defaultMessage:"Sorry, there was a problem loading field information"}),color:"danger",iconType:"alert"},i.a.createElement(a.EuiButton,{onClick:t,iconType:"refresh"},n.i18n.translate("xpack.infra.logs.alertFlyout.sourceStatusErrorTryAgain",{defaultMessage:"Try again"}))):e)},de=e=>{var t,r;const{setRuleParams:l,ruleParams:m,errors:p}=e,[g,b]=Object(o.useState)(!1),{logViewId:E,resolvedLogView:y}=Object(f.c)(),{criteria:O,threshold:j,timeSizeUnit:x,timeWindowSize:C}=Object(o.useMemo)((()=>Object(d.b)(h.a)(p)),[p]),w=Object(o.useMemo)((()=>null!=y&&y.fields?y.fields.filter((e=>("string"===e.type||"number"===e.type)&&e.searchable)):[]),[y]),T=Object(o.useMemo)((()=>null!=y&&y.fields?y.fields.filter((e=>"string"===e.type&&e.aggregatable)):[]),[y]),S=Object(o.useCallback)((e=>{const t={...m.count,...e};l("count",t)}),[m.count,l]),M=Object(o.useCallback)((e=>{l("criteria",e)}),[l]),k=Object(o.useCallback)((e=>{l("timeSize",e)}),[l]),F=Object(o.useCallback)((e=>{u.l.is(e)&&l("timeUnit",e)}),[l]),P=Object(o.useCallback)((e=>{l("groupBy",e)}),[l]),L=Object(o.useMemo)((()=>{return e=w,{...ie,count:{value:75,comparator:u.a.GT},criteria:[ce(e,"error")]};var e}),[w]),_=Object(o.useCallback)((e=>{const t="count"===e?L:(r=w,{...ie,count:{value:2,comparator:u.a.GT},criteria:[[ce(r,"error")],[ce(r,"warning")]]});var r;l("count",t.count),l("criteria",t.criteria)}),[L,l,w]);c()((()=>{const e={...L,...m};for(const[t,r]of Object.entries(e))l(t,r);b(!0)}));const R=Object(o.useMemo)((()=>m.groupBy&&m.groupBy.length>0&&m.count&&!Object(u.i)(m.count.comparator,m.count.value)),[m]);if(!g)return null;const A=m.criteria?i.a.createElement(H,{fields:w,criteria:m.criteria,defaultCriterion:L.criteria[0],errors:O,ruleParams:m,sourceId:E,updateCriteria:M}):null;return i.a.createElement(i.a.Fragment,null,i.a.createElement(oe,{criteria:m.criteria||[],updateType:_}),m.criteria&&!Object(u.j)(m.criteria)&&A,i.a.createElement(X,{comparator:null===(t=m.count)||void 0===t?void 0:t.comparator,value:null===(r=m.count)||void 0===r?void 0:r.value,updateThreshold:S,errors:j}),i.a.createElement(s.ForLastExpression,{timeWindowSize:m.timeSize,timeWindowUnit:m.timeUnit,onChangeWindowSize:k,onChangeWindowUnit:F,errors:{timeWindowSize:C,timeSizeUnit:x}}),i.a.createElement(v,{selectedGroups:m.groupBy,onChange:P,fields:T}),m.criteria&&Object(u.j)(m.criteria)&&A,R&&i.a.createElement(i.a.Fragment,null,i.a.createElement(a.EuiSpacer,{size:"l"}),i.a.createElement(a.EuiCallOut,{color:"warning"},n.i18n.translate("xpack.infra.logs.alertFlyout.groupByOptimizationWarning",{defaultMessage:'When setting a "group by" we highly recommend using the "{comparator}" comparator for your threshold. This can lead to significant performance improvements.',values:{comparator:u.a.GT}}))),i.a.createElement(a.EuiSpacer,{size:"l"}))};t.default=se;const me=({text:e})=>i.a.createElement("div",{className:"euiExpression euiExpression-isUppercase euiExpression--success"},i.a.createElement("span",{className:"euiExpression__description"},e))},70:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);function n(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}var o={};function i(e){return function(){return a.useContext(e)}}t.default=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),l=1;l<t;l++)r[l-1]=arguments[l];var c=[],s=[],u=function(e){var t=a.createContext(o);c.push(t),s.push(i(t))};r.length?r.forEach((function(e){return u(e.name)})):u(e.name);var d=function(t){for(var o=t.children,i=n(t,["children"]),l=e(i),s=o,u=0;u<c.length;u+=1){var d=c[u],m=r[u]||function(e){return e};s=a.createElement(d.Provider,{value:m(l)},s)}return s};return[d].concat(s)}},71:function(e,t,r){"use strict";r.d(t,"c",(function(){return c})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return CanceledPromiseError}));var a=r(6),n=r.n(a),o=r(2),i=r(119),l=r.n(i);const c=({createPromise:e,onResolve:t=u,onReject:r=u,cancelPreviousOn:a="never",triggerOrThrow:n="whenMounted"},i)=>{const c=l()(),s=Object(o.useCallback)((()=>{switch(n){case"always":return!0;case"whenMounted":return c()}}),[c,n]),d=Object(o.useRef)([]),[m,p]=Object(o.useState)({state:"uninitialized"}),f=Object(o.useMemo)((()=>(...n)=>{let o;const i=new Promise(((e,t)=>{o=t})),l=d.current,c=()=>{l.forEach((e=>e.cancel()))},m=e(...n),f=Promise.race([m,i]);p({state:"pending",promise:f}),"creation"===a&&c();const g={cancel:()=>{o(new CanceledPromiseError)},cancelSilently:()=>{o(new SilentCanceledPromiseError)},promise:f.then((e=>(p((t=>"pending"===t.state&&t.promise===f?{state:"resolved",promise:g.promise,value:e}:t)),["settlement","resolution"].includes(a)&&c(),d.current=d.current.filter((e=>e.promise!==g.promise)),t&&s()&&t(e),e)),(e=>{if(e instanceof SilentCanceledPromiseError||p((t=>"pending"===t.state&&t.promise===f?{state:"rejected",promise:f,value:e}:t)),["settlement","rejection"].includes(a)&&c(),d.current=d.current.filter((e=>e.promise!==g.promise)),s())throw r&&r(e),e}))};return d.current=[...d.current,g],g.promise.catch(u),g.promise}),i);return Object(o.useEffect)((()=>()=>{d.current.forEach((e=>e.cancelSilently()))}),[]),[m,f]},s=e=>"rejected"===e.state;class CanceledPromiseError extends Error{constructor(e){super(e),n()(this,"isCanceled",!0),Object.setPrototypeOf(this,new.target.prototype)}}class SilentCanceledPromiseError extends CanceledPromiseError{}const u=()=>{}},74:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return c})),r.d(t,"c",(function(){return s}));var a=r(70),n=r.n(a),o=r(2),i=r(71);const l=({logViewId:e,logViews:t,fetch:r})=>{const[a,n]=Object(o.useState)(void 0),[l,c]=Object(o.useState)(void 0),[s,u]=Object(o.useState)(void 0),[d,m]=Object(i.c)({cancelPreviousOn:"resolution",createPromise:t.getLogView.bind(t),onResolve:n},[t]),[p,f]=Object(i.c)({cancelPreviousOn:"resolution",createPromise:t.resolveLogView.bind(t),onResolve:c},[t]),[g,b]=Object(i.c)({cancelPreviousOn:"resolution",createPromise:t.putLogView.bind(t),onResolve:n},[t]),[E,v]=Object(i.c)({cancelPreviousOn:"resolution",createPromise:t.getResolvedLogViewStatus.bind(t),onResolve:u},[t]),h="pending"===d.state,y="pending"===p.state,O="pending"===E.state,j="pending"===g.state,x=h||y||O||j,C="uninitialized"===d.state,w="rejected"===d.state,T="rejected"===p.state,S="rejected"===E.state,M=[d,p,E].filter(i.b).map((({value:e})=>e instanceof Error?e:new Error(`${e}`))),k=M.length>0,F=Object(o.useCallback)((async()=>{const t=await m(e),r=await f(t.id,t.attributes);return[t,r,await v(r)]}),[e,m,v,f]),P=Object(o.useCallback)((async t=>{const r=await b(e,t),a=await f(r.id,r.attributes);return[r,a,await v(a)]}),[e,v,f,b]);return Object(o.useEffect)((()=>{F()}),[F]),{logViewId:e,isUninitialized:C,derivedDataView:null==l?void 0:l.dataViewReference,hasFailedLoading:k,hasFailedLoadingLogView:w,hasFailedLoadingLogViewStatus:S,hasFailedResolvingLogView:T,latestLoadLogViewFailures:M,isLoading:x,isLoadingLogView:h,isLoadingLogViewStatus:O,isResolvingLogView:y,logView:a,resolvedLogView:l,logViewStatus:s,load:F,update:P}},[c,s]=n()(l)},81:function(e,t,r){"use strict";r.d(t,"b",(function(){return c})),r.d(t,"a",(function(){return m}));var a=r(34),n=r(2),o=r(16),i=r(51),l=r(54);const c=({defaultState:e,decodeUrlState:t,encodeUrlState:r,urlStateKey:a,writeDefaultState:o=!1})=>{const l=Object(i.useHistory)(),c=null!=l&&l.location?u(l.location):"",f=Object(n.useMemo)((()=>{if(c)return d(c,a)}),[c,a]),g=Object(n.useMemo)((()=>t(s(f))),[t,f]),b=Object(n.useMemo)((()=>void 0!==g?g:e),[e,g]),E=Object(n.useCallback)((e=>{if(!l||!l.location)return;const t=l.location,n=p(t,m(a,void 0!==e?r(e):void 0)(u(t)));n!==t&&l.replace(n)}),[r,l,a]),[v,h]=Object(n.useState)(o&&void 0===g);return Object(n.useEffect)((()=>{v&&(h(!1),E(e))}),[v,E,e]),[b,E]},s=e=>{try{return e?Object(o.decode)(e):void 0}catch(e){if(e instanceof Error&&e.message.startsWith("rison decoder error"))return{};throw e}},u=e=>e.search.substring(1),d=(e,t)=>{const r=Object(a.parse)(e,{sort:!1})[t];return Array.isArray(r)?r[0]:r},m=(e,t)=>r=>{const n=Object(a.parse)(r,{sort:!1}),i=void 0===t?n:{...n,[e]:(c=t,Object(o.encode)(c))};var c;return Object(a.stringify)(l.url.encodeQuery(i),{sort:!1,encode:!1})},p=(e,t)=>t===u(e)?e:{...e,search:`?${t}`}},82:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return l})),r(25);var a=r(12);let n;!function(e){e.color0="color0",e.color1="color1",e.color2="color2",e.color3="color3",e.color4="color4",e.color5="color5",e.color6="color6",e.color7="color7",e.color8="color8",e.color9="color9"}(n||(n={}));const o=Object(a.euiPaletteColorBlind)(),i={[n.color0]:o[1],[n.color1]:o[2],[n.color2]:o[0],[n.color3]:o[3],[n.color4]:o[4],[n.color5]:o[5],[n.color6]:o[6],[n.color7]:o[7],[n.color8]:o[8],[n.color9]:o[9]},l=(c=i,e=>c[e]);var c},89:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(53).__importDefault(r(117));t.default=function(e){a.default((function(){e()}))}}}]);