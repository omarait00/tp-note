/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(t){function e(e){for(var i,a,r=e[0],s=e[1],o=0,c=[];o<r.length;o++)a=r[o],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&c.push(n[a][0]),n[a]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i]);for(l&&l(e);c.length;)c.shift()()}var i={},n={0:0};function a(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.e=function(t){var e=[],i=n[t];if(0!==i)if(i)e.push(i[2]);else{var r=new Promise((function(e,a){i=n[t]=[e,a]}));e.push(i[2]=r);var s,o=document.createElement("script");o.charset="utf-8",o.timeout=120,a.nc&&o.setAttribute("nonce",a.nc),o.src=function(t){return a.p+"cloudExperiments.chunk."+t+".js"}(t);var l=new Error;s=function(e){o.onerror=o.onload=null,clearTimeout(c);var i=n[t];if(0!==i){if(i){var a=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+a+": "+r+")",l.name="ChunkLoadError",l.type=a,l.request=r,i[1](l)}n[t]=void 0}};var c=setTimeout((function(){s({type:"timeout",target:o})}),12e4);o.onerror=o.onload=s,document.head.appendChild(o)}return Promise.all(e)},a.m=t,a.c=i,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a.oe=function(t){throw console.error(t),t};var r=window.cloudExperiments_bundle_jsonpfunction=window.cloudExperiments_bundle_jsonpfunction||[],s=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var l=s;a(a.s=8)}([function(t,e,i){t.exports=i(2)(2)},function(t,e){t.exports=__kbnSharedDeps__.Rxjs},function(t,e){t.exports=__kbnSharedDeps_npm__},function(t,e){t.exports=__kbnSharedDeps__.Lodash},function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return u}));var n=i(6),a=i.n(n),r=i(7),s=i.n(r),o=i(0),l=i.n(o),c=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],h=new Array(64),u=function(){function e(){a()(this,e),l()(this,"_a",void 0),l()(this,"_b",void 0),l()(this,"_c",void 0),l()(this,"_d",void 0),l()(this,"_e",void 0),l()(this,"_f",void 0),l()(this,"_g",void 0),l()(this,"_h",void 0),l()(this,"_block",void 0),l()(this,"_finalSize",void 0),l()(this,"_blockSize",void 0),l()(this,"_len",void 0),l()(this,"_s",void 0),l()(this,"_w",void 0),this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this._w=h,this._block=t.alloc(64),this._finalSize=56,this._blockSize=64,this._len=0,this._s=0}return s()(e,[{key:"update",value:function(e,i){"string"==typeof e&&(i=i||"utf8",e=t.from(e,i));for(var n=this._len+=e.length,a=this._s||0,r=0,s=this._block;a<n;){for(var o=Math.min(e.length,r+this._blockSize-a%this._blockSize)-r,l=0;l<o;l++)s[a%this._blockSize+l]=e[l+r];r+=o,(a+=o)%this._blockSize==0&&this._update(s)}return this._s=a,this}},{key:"digest",value:function(t){var e=8*this._len;return this._block[this._len%this._blockSize]=128,this._block.fill(0,this._len%this._blockSize+1),e%(8*this._blockSize)>=8*this._finalSize&&(this._update(this._block),this._block.fill(0)),this._block.writeInt32BE(e,this._blockSize-4),this._update(this._block),this._hash().toString(t)}},{key:"_update",value:function(t){var e,i,n=this._w,a=0|this._a,r=0|this._b,s=0|this._c,o=0|this._d,l=0|this._e,h=0|this._f,u=0|this._g,b=0|this._h;for(e=0;e<16;++e)n[e]=t.readInt32BE(4*e);for(;e<64;++e)n[e]=0|(((i=n[e-2])>>>17|i<<15)^(i>>>19|i<<13)^i>>>10)+n[e-7]+v(n[e-15])+n[e-16];for(var k=0;k<64;++k){var g=b+p(l)+d(l,h,u)+c[k]+n[k]|0,y=f(a)+_(a,r,s)|0;b=u,u=h,h=l,l=o+g|0,o=s,s=r,r=a,a=g+y|0}this._a=a+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=l+this._e|0,this._f=h+this._f|0,this._g=u+this._g|0,this._h=b+this._h|0}},{key:"_hash",value:function(){var e=t.alloc(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e}}]),e}();function d(t,e,i){return i^t&(e^i)}function _(t,e,i){return t&e|i&(t|e)}function f(t){return(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10)}function p(t){return(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7)}function v(t){return(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3}}).call(this,i(10).Buffer)},function(t,e){t.exports=__kbnSharedDeps__.Moment},function(t,e,i){t.exports=i(2)(16)},function(t,e,i){t.exports=i(2)(17)},function(t,e,i){i(9),__kbnBundles__.define("plugin/cloudExperiments/public",i,11)},function(t,e,i){i.p=window.__kbnPublicPath__.cloudExperiments},function(t,e,i){t.exports=i(2)(2728)},function(t,e,i){"use strict";i.r(e),i.d(e,"plugin",(function(){return u}));var n=i(0),a=i.n(n),r=i(3),s=i(5),o=i(1),l=i(4);class launch_darkly_client_LaunchDarklyClient{constructor(t,e){a()(this,"launchDarklyClient",void 0),this.ldConfig=t,this.kibanaVersion=e}async updateUserMetadata(t){const{userId:e,name:n,firstName:a,lastName:r,email:s,avatar:o,ip:l,country:c,...h}=t,u={key:e,name:n,firstName:a,lastName:r,email:s,avatar:o,ip:l,country:c,custom:h};if(this.launchDarklyClient)await this.launchDarklyClient.identify(u);else{const{initialize:t,basicLogger:e}=await i.e(1).then(i.t.bind(null,12,7));this.launchDarklyClient=t(this.ldConfig.client_id,u,{application:{id:"kibana-browser",version:this.kibanaVersion},logger:e({level:this.ldConfig.client_log_level})})}}async getVariation(t,e){return this.launchDarklyClient?(await this.launchDarklyClient.waitForInitialization(),await this.launchDarklyClient.variation(t,e)):e}reportMetric(t,e,i){this.launchDarklyClient&&this.launchDarklyClient.track(t,e,i)}stop(){var t;null===(t=this.launchDarklyClient)||void 0===t||t.flush().catch((t=>console.warn(t)))}}class metadata_service_MetadataService{constructor(t){a()(this,"_userMetadata$",new o.BehaviorSubject(void 0)),a()(this,"stop$",new o.Subject),this.config=t}setup(t){this._userMetadata$.next(t);const e=t.trialEndDate;e&&this.scheduleUntil((()=>({inTrial:Date.now()<=new Date(e).getTime()})),(t=>!1===t.inTrial))}get userMetadata$(){return this._userMetadata$.pipe(Object(o.filter)(Boolean),Object(o.debounceTime)(100),Object(o.distinct)((t=>[t.inTrial,t.hasData].join("-"))),Object(o.shareReplay)(1))}start({hasDataFetcher:t}){this._userMetadata$.value&&this.scheduleUntil((async()=>t()),(t=>!0===t.hasData))}stop(){this.stop$.next(),this._userMetadata$.complete()}scheduleUntil(t,e){Object(o.timer)(0,this.config.metadata_refresh_interval.asMilliseconds()).pipe(Object(o.takeUntil)(this.stop$),Object(o.exhaustMap)((async()=>{this._userMetadata$.next({...this._userMetadata$.value,...await t()})})),Object(o.takeWhile)((()=>!e(this._userMetadata$.value)))).subscribe()}}let c,h;!function(t){t["security-solutions.add-integrations-url"]="security-solutions.add-integrations-url"}(c||(c={})),h||(h={});class plugin_CloudExperimentsPlugin{constructor(t){a()(this,"metadataService",void 0),a()(this,"launchDarklyClient",void 0),a()(this,"kibanaVersion",void 0),a()(this,"flagOverrides",void 0),a()(this,"isDev",void 0),a()(this,"getVariation",(async(t,e)=>{const i=c[t];return this.flagOverrides&&Object(r.has)(this.flagOverrides,i)?Object(r.get)(this.flagOverrides,i,e):this.launchDarklyClient?await this.launchDarklyClient.getVariation(i,e):e})),a()(this,"reportMetric",(({name:t,meta:e,value:i})=>{var n;const a=h[t];null===(n=this.launchDarklyClient)||void 0===n||n.reportMetric(a,e,i),this.isDev&&console.debug(`Reported experimentation metric ${a}`,{experimentationMetric:{name:t,meta:e,value:i}})})),this.isDev=t.env.mode.dev,this.kibanaVersion=t.env.packageInfo.version;const e=t.config.get();this.metadataService=new metadata_service_MetadataService({metadata_refresh_interval:Object(s.duration)(e.metadata_refresh_interval)}),e.flag_overrides&&(this.flagOverrides=e.flag_overrides);const i=e.launch_darkly;if(!(null!=i&&i.client_id||t.env.mode.dev))throw new Error("xpack.cloud_integrations.experiments.launch_darkly configuration should exist");null!=i&&i.client_id&&(this.launchDarklyClient=new launch_darkly_client_LaunchDarklyClient(i,this.kibanaVersion))}setup(t,e){var i,n;e.cloud.isCloudEnabled&&e.cloud.cloudId&&this.launchDarklyClient&&this.metadataService.setup({userId:(n=e.cloud.cloudId,(new l.a).update(n,"utf8").digest("hex")),kibanaVersion:this.kibanaVersion,trialEndDate:null===(i=e.cloud.trialEndDate)||void 0===i?void 0:i.toISOString(),isElasticStaff:e.cloud.isElasticStaffOwned})}start(t,{cloud:e,dataViews:i}){return e.isCloudEnabled&&(this.metadataService.start({hasDataFetcher:async()=>({hasData:await i.hasData.hasUserDataView()})}),this.metadataService.userMetadata$.pipe(Object(o.concatMap)((async t=>await this.launchDarklyClient.updateUserMetadata(t)))).subscribe()),{getVariation:this.getVariation,reportMetric:this.reportMetric}}stop(){var t;null===(t=this.launchDarklyClient)||void 0===t||t.stop(),this.metadataService.stop()}}function u(t){return new plugin_CloudExperimentsPlugin(t)}}]);