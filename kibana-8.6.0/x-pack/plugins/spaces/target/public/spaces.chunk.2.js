/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.spaces_bundle_jsonpfunction=window.spaces_bundle_jsonpfunction||[]).push([[2],{100:function(e,t,s){var o=s(34),a=s(101);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},101:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpaceResultDetails{margin-top:8px;padding-left:24px}.spcCopyToSpaceResultDetails__row{margin-bottom:4px}.spcCopyToSpaceResultDetails__savedObjectName{min-width:0}.spcCopyToSpaceResultDetails__selectControl{margin-left:24px}.spcCopyToSpaceResultDetails__selectControl__childWrapper{height:0;opacity:0;overflow:hidden;transform:translatez(0);transition:height .25s cubic-bezier(.694,.0482,.335,1),opacity .25s cubic-bezier(.694,.0482,.335,1);visibility:hidden}.spcCopyToSpaceResultDetails__selectControl.spcCopyToSpaceResultDetails__selectControl-isOpen .spcCopyToSpaceResultDetails__selectControl__childWrapper{height:auto;opacity:1;visibility:visible}",""]),e.exports=t},123:function(e,t,s){"use strict";s.r(t),s.d(t,"CopyToSpaceFlyoutInternal",(function(){return q}));var o=s(2),a=s(18),c=s(1),n=s.n(c),i=s(3),r=s(11),l=s(13);function p(e){const{success:t,errors:s=[],successResults:o=[]}=e;return{success:t,failedImports:s.map((({error:e,...t})=>({obj:t,error:e}))),successfulImports:o}}const u=e=>"conflict"===e.error.type||"ambiguous_conflict"===e.error.type,d=e=>"missing_references"===e.error.type,j=(e,t)=>e.type>t.type?1:e.type<t.type?-1:0;var b=s(0);const g=({error:{type:e}})=>["conflict","ambiguous_conflict","missing_references"].includes(e),m=e=>!g(e),f=e=>{const{copyInProgress:t,conflictResolutionInProgress:s,initialCopyFinished:a,copyResult:n,retries:l}=e;let p={successCount:0,pendingCount:0,skippedCount:0,errorCount:0};n&&(p=Object.entries(n).reduce(((e,t)=>{const[s,o]=t;let a=0,c=0,n=0,i=0;if(!0===o.success)a=o.successfulImports.length;else{const e=o.failedImports.filter(g).reduce(((e,{obj:{type:t,id:s}})=>e.add(`${t}:${s}`)),new Set);c=(l[s]||[]).length,n=e.size+o.successfulImports.length-c,i=o.failedImports.filter(m).length}return{loading:!1,successCount:e.successCount+a,pendingCount:e.pendingCount+c,skippedCount:e.skippedCount+n,errorCount:e.errorCount+i}}),p));const u=()=>{let c;if(a){const t=p.pendingCount>0?Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.finishPendingOverwritesCopyToSpacesButton",defaultMessage:"Copy {overwriteCount} objects",values:{overwriteCount:p.pendingCount}}):Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.finishCopyToSpacesButton",defaultMessage:"Finish"});c=Object(b.jsx)(o.EuiButton,{fill:!0,isLoading:s,"aria-live":"assertive","aria-label":s?i.i18n.translate("xpack.spaces.management.copyToSpace.inProgressButtonLabel",{defaultMessage:"Copy is in progress. Please wait."}):i.i18n.translate("xpack.spaces.management.copyToSpace.finishedButtonLabel",{defaultMessage:"Copy finished."}),onClick:()=>e.onCopyFinish(),"data-test-subj":"cts-finish-button"},t)}else c=Object(b.jsx)(o.EuiButton,{fill:!0,isLoading:t,onClick:()=>e.onCopyStart(),"data-test-subj":"cts-initiate-button",disabled:0===e.numberOfSelectedSpaces||t},e.numberOfSelectedSpaces>0?Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyToSpacesButton",defaultMessage:"Copy to {spaceCount} {spaceCount, plural, one {space} other {spaces}}",values:{spaceCount:e.numberOfSelectedSpaces}}):Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.disabledCopyToSpacesButton",defaultMessage:"Copy"}));return Object(b.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(o.EuiButtonEmpty,{onClick:()=>e.onClose(),"data-test-subj":"cts-cancel-button",disabled:t&&!a||s||p.successCount>0},Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.cancelButton",defaultMessage:"Cancel"}))),Object(b.jsx)(o.EuiFlexItem,{grow:!1},c))};return t?Object(b.jsx)(c.Fragment,null,Object(b.jsx)(o.EuiFlexGroup,null,Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiStat,{"data-test-subj":"cts-summary-success-count",title:p.successCount,titleSize:"s",titleColor:a?"success":"subdued",isLoading:!a,textAlign:"center",description:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpaceFlyoutFooter.successCount",defaultMessage:"Copied"})})),Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiStat,{"data-test-subj":"cts-summary-pending-count",title:p.pendingCount,titleSize:"s",titleColor:p.pendingCount>0?"primary":"subdued",isLoading:!a,textAlign:"center",description:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpaceFlyoutFooter.pendingCount",defaultMessage:"Pending"})})),Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiStat,{"data-test-subj":"cts-summary-skipped-count",title:p.skippedCount,titleSize:"s",titleColor:p.skippedCount>0?"primary":"subdued",isLoading:!a,textAlign:"center",description:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpaceFlyoutFooter.skippedCount",defaultMessage:"Skipped"})})),Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiStat,{"data-test-subj":"cts-summary-error-count",title:p.errorCount,titleSize:"s",titleColor:p.errorCount>0?"danger":"subdued",isLoading:!a,textAlign:"center",description:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpaceFlyoutFooter.errorCount",defaultMessage:"Errors"})}))),Object(b.jsx)(o.EuiHorizontalRule,null),u()):u()},x={id:"createNewCopiesDisabled",text:i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.createNewCopies.disabledTitle",{defaultMessage:"Check for existing objects"}),tooltip:i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.createNewCopies.disabledText",{defaultMessage:"Check if objects were previously copied or imported into the space."})},y={id:"createNewCopiesEnabled",text:i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.createNewCopies.enabledTitle",{defaultMessage:"Create new objects with random IDs"}),tooltip:i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.createNewCopies.enabledText",{defaultMessage:"Use this option to create one or more copies of the object in the same space."})},O={id:"overwriteEnabled",label:i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.overwrite.enabledLabel",{defaultMessage:"Automatically overwrite conflicts"})},h={id:"overwriteDisabled",label:i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.overwrite.disabledLabel",{defaultMessage:"Request action on conflict"})},C={id:"includeRelated",text:i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.includeRelated.title",{defaultMessage:"Include related objects"}),tooltip:i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.includeRelated.text",{defaultMessage:"Copy this object and its related objects. For dashboards, related visualizations, index patterns, and saved searches are also copied."})},v=i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.copyOptionsTitle",{defaultMessage:"Copy options"}),S=i.i18n.translate("xpack.spaces.management.copyToSpace.copyModeControl.relationshipOptionsTitle",{defaultMessage:"Relationship"}),w=({text:e,tooltip:t})=>Object(b.jsx)(o.EuiFlexGroup,null,Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiText,null,e)),Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(o.EuiIconTip,{content:t,position:"left",type:"iInCircle"}))),T=({initialValues:e,updateSelection:t})=>{const[s,a]=Object(c.useState)(e.createNewCopies),[i,r]=Object(c.useState)(e.overwrite),l=e=>{void 0!==e.createNewCopies?a(e.createNewCopies):void 0!==e.overwrite&&r(e.overwrite),t({createNewCopies:s,overwrite:i,...e})};return Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(o.EuiFormFieldset,{legend:{children:Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("span",null,v))}},Object(b.jsx)(o.EuiCheckableCard,{id:y.id,label:w(y),checked:s,onChange:()=>l({createNewCopies:!0})}),Object(b.jsx)(o.EuiSpacer,{size:"s"}),Object(b.jsx)(o.EuiCheckableCard,{id:x.id,label:w(x),checked:!s,onChange:()=>l({createNewCopies:!1})},Object(b.jsx)(o.EuiRadioGroup,{options:[O,h],idSelected:i?O.id:h.id,onChange:e=>l({overwrite:e===O.id}),disabled:s,"data-test-subj":"cts-copyModeControl-overwriteRadioGroup"}))),Object(b.jsx)(o.EuiSpacer,{size:"m"}),Object(b.jsx)(o.EuiFormFieldset,{legend:{children:Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("span",null,S))}},Object(b.jsx)(o.EuiCheckableCard,{id:C.id,label:w(C),checkableType:"checkbox",checked:!0,onChange:()=>{},disabled:!0})))};s(77);var M=s(15),E=s(5);const _=Object(c.lazy)((()=>Object(E.a)().then((e=>({default:e}))))),k=e=>{if(0===e.spaces.length)return Object(b.jsx)(o.EuiLoadingSpinner,null);const t=Object(b.jsx)(o.EuiIconTip,{content:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.selectSpacesControl.disabledTooltip",defaultMessage:"The object already exists in this space."}),position:"left",type:"iInCircle"}),s=e.spaces.map((s=>{const o=e.disabledSpaceIds.has(s.id);return{label:s.name,prepend:Object(b.jsx)(_,{space:s,size:"s"}),append:o?t:null,checked:e.selectedSpaceIds.includes(s.id)?"on":void 0,disabled:o,"data-space-id":s.id,"data-test-subj":`cts-space-selector-row-${s.id}`}}));return Object(b.jsx)(c.Suspense,{fallback:Object(b.jsx)(o.EuiLoadingSpinner,null)},Object(b.jsx)(o.EuiSelectable,{options:s,onChange:t=>function(t){if(e.disabled)return;const s=t.filter((e=>e.checked)).map((e=>e["data-space-id"]));e.onChange(s)}(t),listProps:{bordered:!0,rowHeight:40,className:"spcCopyToSpace__spacesList","data-test-subj":"cts-form-space-selector"},searchable:s.length>M.SPACE_SEARCH_COUNT_THRESHOLD},((e,t)=>Object(b.jsx)(n.a.Fragment,null,t,e))))},R=e=>{const{savedObjectTarget:t,spaces:s,onUpdate:a,copyOptions:c}=e,n=e=>e?new Set:t.namespaces.reduce(((e,t)=>e.add(t)),new Set);return Object(b.jsx)("div",{"data-test-subj":"copy-to-space-form"},Object(b.jsx)(T,{initialValues:c,updateSelection:e=>(({createNewCopies:e,overwrite:t})=>{const s=n(e),o=c.selectedSpaceIds.filter((e=>!s.has(e)));a({...c,createNewCopies:e,overwrite:t,selectedSpaceIds:o})})(e)}),Object(b.jsx)(o.EuiSpacer,{size:"m"}),Object(b.jsx)(o.EuiFormRow,{label:Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("span",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.selectSpacesLabel",defaultMessage:"Select spaces"}))),fullWidth:!0},Object(b.jsx)(k,{spaces:s,selectedSpaceIds:c.selectedSpaceIds,disabledSpaceIds:n(c.createNewCopies),onChange:e=>{return t=e,a({...c,selectedSpaceIds:t});var t}})))};s(82),s(87);var I=s(4),F=s.n(I);s(92);const z=[{id:"overwrite",text:i.i18n.translate("xpack.spaces.management.copyToSpace.overwriteAllConflictsText",{defaultMessage:"Overwrite all"})},{id:"skip",text:i.i18n.translate("xpack.spaces.management.copyToSpace.skipAllConflictsText",{defaultMessage:"Skip all"})}];class resolve_all_conflicts_ResolveAllConflicts extends c.Component{constructor(...e){super(...e),F()(this,"state",{isPopoverOpen:!1}),F()(this,"onSelect",(e=>{const{summarizedCopyResult:t,retries:s,onRetriesChange:o,onDestinationMapChange:a}=this.props,c="overwrite"===e;if(c){const e=s.filter((e=>!0===e.overwrite)),a=t.objects.reduce(((t,{type:s,id:o,conflict:a})=>{if(a&&!e.some((e=>e.type===s&&e.id===o))){const{error:e}=a,n="conflict"===e.type?e.destinationId:e.destinations[0].id;return[...t,{type:s,id:o,overwrite:c,...n&&{destinationId:n}}]}return t}),new Array);o([...s,...a])}else{const e=t.objects.reduce(((e,{type:t,id:s,conflict:o})=>o?e.add(`${t}:${s}`):e),new Set);o(s.filter((({type:t,id:s})=>!e.has(`${t}:${s}`)))),a(void 0)}this.setState({isPopoverOpen:!1})})),F()(this,"onButtonClick",(()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})})),F()(this,"closePopover",(()=>{this.setState({isPopoverOpen:!1})}))}render(){const e=Object(b.jsx)(o.EuiLink,{onClick:this.onButtonClick,className:"spcCopyToSpace__resolveAllConflictsLink"},Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.resolveAllConflictsLink",defaultMessage:"(resolve all)"})),t=z.map((e=>Object(b.jsx)(o.EuiContextMenuItem,{"data-test-subj":`cts-resolve-all-conflicts-${e.id}`,key:e.id,onClick:()=>{this.onSelect(e.id)}},e.text)));return Object(b.jsx)(o.EuiPopover,{id:"resolveAllConflictsVisibilityPopover",button:e,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(b.jsx)(o.EuiContextMenuPanel,{items:t}))}}const N=e=>{const{summarizedCopyResult:t}=e;return Object(b.jsx)(c.Fragment,null,(e=>{const{space:t,summarizedCopyResult:s,conflictResolutionInProgress:a,retries:n,onRetriesChange:i,onDestinationMapChange:l}=e,p=e=>`cts-summary-indicator-${e}-${t.id}`;if(s.processing||a)return Object(b.jsx)(o.EuiLoadingSpinner,{"data-test-subj":p("loading")});const{successful:u,hasUnresolvableErrors:d,hasMissingReferences:j,hasConflicts:g}=s;if(u)return Object(b.jsx)(o.EuiIconTip,{type:"checkInCircleFilled",color:"success",iconProps:{"data-test-subj":p("success")},content:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatusSummary.successMessage",defaultMessage:"Copy to the {space} space was successful.",values:{space:t.name}})});if(d)return Object(b.jsx)(o.EuiIconTip,{type:"alert",color:"danger",iconProps:{"data-test-subj":p("failed")},content:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatusSummary.failedMessage",defaultMessage:"Copy to the {space} space failed. Expand this section for details.",values:{space:t.name}})});const m=j?Object(b.jsx)("span",{className:"spcCopyToSpace__missingReferencesIcon"},Object(b.jsx)(o.EuiIconTip,{type:"link",color:"warning",iconProps:{"data-test-subj":p("missingReferences")},content:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatusSummary.missingReferencesMessage",defaultMessage:"Missing references detected in the {space} space. Expand this section for details.",values:{space:t.name}})})):null;return g?Object(b.jsx)(c.Fragment,null,Object(b.jsx)(resolve_all_conflicts_ResolveAllConflicts,{summarizedCopyResult:s,retries:n,onRetriesChange:i,onDestinationMapChange:l}),Object(b.jsx)(o.EuiIconTip,{type:"alert",color:"warning",iconProps:{"data-test-subj":p("conflicts")},content:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatusSummary.conflictsMessage",defaultMessage:"Conflicts detected in the {space} space. Expand this section to resolve.",values:{space:t.name}})}),m):m})(e),Object(b.jsx)(o.EuiBadge,{color:"#DDD",className:"spcCopyToSpace__summaryCountBadge"},t.objects.length))};s(97);var L=s(33),D=s.n(L);const P=e=>{const{summarizedCopyResult:t,conflictResolutionInProgress:s,pendingObjectRetry:a}=e;if(t.processing||s)return Object(b.jsx)(o.EuiLoadingSpinner,null);const n=t.objects.find((t=>t.type===e.object.type&&t.id===e.object.id)),{conflict:i,hasMissingReferences:l,hasUnresolvableErrors:p,overwrite:u}=n,d=i&&!(null!=a&&a.overwrite),j=!l&&!p&&!d;if(j&&!a){const e=u?Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.successAutomaticOverwriteMessage",defaultMessage:"Object was overwritten."}):Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.successMessage",defaultMessage:"Object was copied."});return Object(b.jsx)(o.EuiIconTip,{type:"checkInCircleFilled",color:"success",content:e})}if(j&&a){const e=u?Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.pendingAutomaticOverwriteMessage",defaultMessage:"Object will be overwritten."}):null!=a&&a.overwrite?Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.pendingOverwriteMessage",defaultMessage:"Object will be overwritten. Disable 'Overwrite' to skip."}):Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.pendingMessage",defaultMessage:"Object will be copied."});return Object(b.jsx)(o.EuiIconTip,{type:"check",color:"warning",content:e})}if(p)return Object(b.jsx)(o.EuiIconTip,{type:"alert",color:"danger","data-test-subj":`cts-object-result-error-${n.id}`,content:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.unresolvableErrorMessage",defaultMessage:"An error occurred copying this object."})});if(d)switch(i.error.type){case"conflict":return Object(b.jsx)(o.EuiIconTip,{type:"alert",color:"warning",content:Object(b.jsx)(c.Fragment,null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.conflictMessage",defaultMessage:"This conflicts with an existing object. Enable ‘Overwrite’ to replace it."}))});case"ambiguous_conflict":return Object(b.jsx)(o.EuiIconTip,{type:"alert",color:"warning",content:Object(b.jsx)(c.Fragment,null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.ambiguousConflictMessage",defaultMessage:"This conflicts with multiple existing objects. Enable ‘Overwrite’ to replace one."}))})}return l?Object(b.jsx)(o.EuiIconTip,{type:"link",color:"warning","data-test-subj":`cts-object-result-missing-references-${n.id}`,content:u?Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.missingReferencesAutomaticOverwriteMessage",defaultMessage:"Object will be overwritten, but one or more references are missing."}):i?Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.missingReferencesOverwriteMessage",defaultMessage:"Object will be overwritten, but one or more references are missing. Disable 'Overwrite' to skip."}):Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyStatus.missingReferencesMessage",defaultMessage:"Object will be copied, but one or more references are missing."})}):null};function $(e){switch(e){case"index-pattern":case"index-patterns":case"indexPatterns":return"index patterns";default:return e}}const A=e=>"ambiguous_conflict"===e.type,B=e=>{const{destinationMap:t,onDestinationMapChange:s,summarizedCopyResult:a}=e,{objects:n}=a;return Object(b.jsx)("div",{className:"spcCopyToSpaceResultDetails"},n.map(((a,n)=>{const{type:r,id:l,name:p,icon:u,conflict:d}=a,j=e.retries.find((e=>e.type===r&&e.id===l)),g=Boolean(null==j?void 0:j.overwrite),m={show:d&&!e.conflictResolutionInProgress,label:i.i18n.translate("xpack.spaces.management.copyToSpace.copyDetail.overwriteSwitch",{defaultMessage:"Overwrite?"}),onChange:({target:{checked:o}})=>{const a=e.retries.filter((e=>e.type!==r||e.id!==l)),{error:c}=d;if(o){const s=A(c)?t.get(`${r}:${l}`):c.destinationId,o={type:r,id:l,overwrite:!0,...s&&{destinationId:s}};e.onRetriesChange([...a,o])}else if(e.onRetriesChange(a),A(c)){const e=c.destinations[0].id;s(new Map(t.set(`${r}:${l}`,e)))}}},f={options:null!=d&&d.error&&A(d.error)?d.error.destinations.map((e=>{var t;const s=null!==(t=e.title)&&void 0!==t?t:`${r} [id=${e.id}]`,a=e.updatedAt?D()(e.updatedAt).fromNow():"never";return{value:e.id,inputDisplay:e.id,dropdownDisplay:Object(b.jsx)(c.Fragment,null,Object(b.jsx)("strong",null,s),Object(b.jsx)(o.EuiText,{size:"s",color:"subdued"},Object(b.jsx)("p",null,"ID: ",e.id,Object(b.jsx)("br",null),"Last updated: ",a)))}})):[],onChange:o=>{s(new Map(t.set(`${r}:${l}`,o)));const a=e.retries.filter((e=>e.type!==r||e.id!==l)),c={type:r,id:l,overwrite:!0,destinationId:o};e.onRetriesChange([...a,c])}},x=f.options.length>0&&g?" spcCopyToSpaceResultDetails__selectControl-isOpen":"";return Object(b.jsx)(c.Fragment,{key:n},Object(b.jsx)(o.EuiFlexGroup,{responsive:!1,key:n,alignItems:"center",gutterSize:"s",className:"spcCopyToSpaceResultDetails__row"},Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(o.EuiToolTip,{position:"top",content:$(r)},Object(b.jsx)(o.EuiIcon,{"aria-label":$(r),type:u,size:"s"}))),Object(b.jsx)(o.EuiFlexItem,{grow:5,className:"spcCopyToSpaceResultDetails__savedObjectName"},Object(b.jsx)(o.EuiText,{size:"s"},Object(b.jsx)("p",{className:"eui-textTruncate",title:p},p))),m.show&&Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(o.EuiSwitch,{label:m.label,compressed:!0,checked:g,onChange:m.onChange,"data-test-subj":`cts-overwrite-conflict-${r}:${l}`})),Object(b.jsx)(o.EuiFlexItem,{className:"spcCopyToSpaceResultDetails__statusIndicator",grow:!1},Object(b.jsx)("div",{className:"eui-textRight"},Object(b.jsx)(P,{summarizedCopyResult:e.summarizedCopyResult,object:a,pendingObjectRetry:j,conflictResolutionInProgress:e.conflictResolutionInProgress&&g})))),Object(b.jsx)("div",{className:"spcCopyToSpaceResultDetails__selectControl"+x},Object(b.jsx)("div",{className:"spcCopyToSpaceResultDetails__selectControl__childWrapper"},Object(b.jsx)(o.EuiSuperSelect,{options:f.options,valueOfSelected:t.get(`${r}:${l}`),onChange:f.onChange,prepend:i.i18n.translate("xpack.spaces.management.copyToSpace.copyDetail.selectControlLabel",{defaultMessage:"Object ID"}),hasDividers:!0,fullWidth:!0,compressed:!0}))))})))},G=Object(c.lazy)((()=>Object(E.a)().then((e=>({default:e}))))),U=e=>e.reduce(((e,{type:t,id:s,conflict:o})=>("ambiguous_conflict"===(null==o?void 0:o.error.type)&&e.set(`${t}:${s}`,o.error.destinations[0].id),e)),new Map),H=e=>{const{space:t}=e;return Object(b.jsx)(o.EuiAccordion,{id:`copyToSpace-${t.id}`,"data-test-subj":`cts-space-result-${t.id}`,className:"spcCopyToSpaceResult",buttonContent:Object(b.jsx)(o.EuiFlexGroup,{responsive:!1},Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(c.Suspense,{fallback:Object(b.jsx)(o.EuiLoadingSpinner,null)},Object(b.jsx)(G,{space:t,size:"s"}))),Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiText,null,t.name))),extraAction:Object(b.jsx)(o.EuiLoadingSpinner,null)},Object(b.jsx)(o.EuiSpacer,{size:"s"}),Object(b.jsx)(o.EuiLoadingSpinner,null))},W=e=>{const{space:t,summarizedCopyResult:s,retries:a,onRetriesChange:n,conflictResolutionInProgress:i}=e,{objects:r}=s,l=a.some((e=>e.overwrite)),[p,u]=Object(c.useState)(U(r)),d=e=>{u(e||U(r))};return Object(b.jsx)(o.EuiAccordion,{id:`copyToSpace-${t.id}`,"data-test-subj":`cts-space-result-${t.id}`,className:"spcCopyToSpaceResult",buttonContent:Object(b.jsx)(o.EuiFlexGroup,{responsive:!1},Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(c.Suspense,{fallback:Object(b.jsx)(o.EuiLoadingSpinner,null)},Object(b.jsx)(G,{space:t,size:"s"}))),Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiText,null,t.name))),extraAction:Object(b.jsx)(N,{space:t,retries:a,onRetriesChange:n,onDestinationMapChange:d,summarizedCopyResult:s,conflictResolutionInProgress:i&&l})},Object(b.jsx)(o.EuiSpacer,{size:"s"}),Object(b.jsx)(B,{summarizedCopyResult:s,space:t,retries:a,onRetriesChange:n,destinationMap:p,onDestinationMapChange:d,conflictResolutionInProgress:i&&l}))},V=e=>Object(b.jsx)("div",{"data-test-subj":"copy-to-space-processing"},(({createNewCopies:e,overwrite:t,includeRelated:s})=>{const a=e?Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.createNewCopiesLabel",defaultMessage:"Create new objects with random IDs"}):Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.dontCreateNewCopiesLabel",defaultMessage:"Check for existing objects"});return Object(b.jsx)(o.EuiListGroup,{className:"spcCopyToSpaceOptionsView",flush:!0},Object(b.jsx)(o.EuiListGroupItem,{iconType:"copy",label:a}),!e&&Object(b.jsx)(o.EuiListGroupItem,{iconType:t?"check":"cross",label:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.overwriteLabel",defaultMessage:"Automatically overwrite conflicts"})}),Object(b.jsx)(o.EuiListGroupItem,{iconType:s?"check":"cross",label:Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.includeRelatedLabel",defaultMessage:"Include related saved objects"})}))})(e.copyOptions),Object(b.jsx)(o.EuiHorizontalRule,{margin:"m"}),Object(b.jsx)(o.EuiText,{size:"s"},Object(b.jsx)("h5",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.copyResultsLabel",defaultMessage:"Results"}))),Object(b.jsx)(o.EuiSpacer,{size:"m"}),e.copyOptions.selectedSpaceIds.map((t=>{const s=e.spaces.find((e=>e.id===t)),a=e.copyResult[s.id],n=function(e,t){var s,o,a,c,n;const i=null!==(s=null==t?void 0:t.failedImports.filter(u))&&void 0!==s?s:[],r=null!==(o=null==t?void 0:t.failedImports.filter(d))&&void 0!==o?o:[],l=null!==(a=null==t?void 0:t.failedImports.filter((e=>{return!u(t=e)&&!d(t);var t})))&&void 0!==a?a:[],p=({type:e,id:s})=>{const o=i.find((({obj:t})=>t.type===e&&t.id===s)),a=r.find((({obj:t})=>t.type===e&&t.id===s));return{conflict:o,hasMissingReferences:void 0!==a,hasUnresolvableErrors:l.some((({obj:t})=>t.type===e&&t.id===s)),overwrite:!o&&(a?!0===a.obj.overwrite:!0===(null==t?void 0:t.successfulImports.some((t=>t.type===e&&t.id===s&&t.overwrite))))}},b=new Map;b.set(`${e.type}:${e.id}`,{type:e.type,id:e.id,name:e.title,icon:e.icon,...p(e)});const g=e=>{e.forEach((e=>{const{type:t,id:s,meta:o}=e;b.set(`${t}:${s}`,{type:t,id:s,name:o.title||`${t} [id=${s}]`,icon:o.icon||"apps",...p(e)})}))};if(g((null!==(c=null==t?void 0:t.failedImports)&&void 0!==c?c:[]).map((({obj:e})=>e)).sort(j)),g((null!==(n=null==t?void 0:t.successfulImports)&&void 0!==n?n:[]).sort(j)),void 0===t)return{processing:!0,objects:Array.from(b.values())};const m=Boolean(t&&0===t.failedImports.length);if(m)return{successful:m,hasConflicts:!1,objects:Array.from(b.values()),hasMissingReferences:!1,hasUnresolvableErrors:!1,processing:!1};const f=i.length>0,x=r.length>0,y=l.length>0;return{successful:m,hasConflicts:f,objects:Array.from(b.values()),hasMissingReferences:x,hasUnresolvableErrors:y,processing:!1}}(e.savedObjectTarget,a);return Object(b.jsx)(c.Fragment,{key:t},n.processing?Object(b.jsx)(H,{space:s}):Object(b.jsx)(W,{space:s,summarizedCopyResult:n,retries:e.retries[s.id]||[],onRetriesChange:t=>{return o=s.id,a=t,void e.onRetriesChange({...e.retries,[o]:a});var o,a},conflictResolutionInProgress:e.conflictResolutionInProgress}),Object(b.jsx)(o.EuiSpacer,{size:"s"}))}))),q=e=>{const{spacesManager:t,spacesDataPromise:s,services:n}=Object(l.b)(),{notifications:u}=n,d=u.toasts,{onClose:j=(()=>null),savedObjectTarget:g}=e,m=Object(c.useMemo)((()=>({type:g.type,id:g.id,namespaces:g.namespaces,icon:g.icon||"apps",title:g.title||`${g.type} [id=${g.id}]`})),[g]),[x,y]=Object(c.useState)({includeRelated:!0,createNewCopies:!0,overwrite:!0,selectedSpaceIds:[]}),[{isLoading:O,spaces:h},C]=Object(c.useState)({isLoading:!0,spaces:[]});Object(c.useEffect)((()=>{s.then((({spacesMap:e})=>{C({isLoading:!1,spaces:[...e.values()].filter((({isActiveSpace:e,isAuthorizedForPurpose:t})=>!e&&t("copySavedObjectsIntoSpace")))})})).catch((e=>{d.addError(e,{title:i.i18n.translate("xpack.spaces.management.copyToSpace.spacesLoadErrorTitle",{defaultMessage:"Error loading available spaces"})})}))}),[s,d]);const[v,S]=Object(c.useState)(!1),[w,T]=Object(c.useState)(!1),[M,E]=Object(c.useState)({}),[_,k]=Object(c.useState)({}),I=Object.values(M).length>0;return Object(b.jsx)(o.EuiFlyout,{onClose:j,maxWidth:600,"data-test-subj":"copy-to-space-flyout"},Object(b.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(b.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"m"},Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(o.EuiIcon,{size:"m",type:"copy"})),Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiTitle,{size:"m"},Object(b.jsx)("h2",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpaceFlyoutHeader",defaultMessage:"Copy to spaces"})))))),Object(b.jsx)(o.EuiFlyoutBody,null,Object(b.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"m"},Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(o.EuiIcon,{type:m.icon})),Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiText,null,Object(b.jsx)("p",null,m.title)))),Object(b.jsx)(o.EuiHorizontalRule,{margin:"m"}),O?Object(b.jsx)(o.EuiLoadingSpinner,null):0===h.length?Object(b.jsx)(o.EuiEmptyPrompt,{body:Object(b.jsx)("p",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.noSpacesBody",defaultMessage:"There are no eligible spaces to copy into."})),title:Object(b.jsx)("h3",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.spaces.management.copyToSpace.noSpacesTitle",defaultMessage:"No spaces available"}))}):v?Object(b.jsx)(V,{savedObjectTarget:m,copyInProgress:v,conflictResolutionInProgress:w,copyResult:M,spaces:h,copyOptions:x,retries:_,onRetriesChange:e=>{k(e)}}):Object(b.jsx)(R,{savedObjectTarget:m,spaces:h,copyOptions:x,onUpdate:y})),Object(b.jsx)(o.EuiFlyoutFooter,null,Object(b.jsx)(f,{copyInProgress:v,conflictResolutionInProgress:w,initialCopyFinished:I,copyResult:M,numberOfSelectedSpaces:x.selectedSpaceIds.length,retries:_,onClose:j,onCopyStart:async function(){S(!0),E({});try{const e=await t.copySavedObjects([{type:m.type,id:m.id}],x.selectedSpaceIds,x.includeRelated,x.createNewCopies,x.overwrite),s=Object(a.mapValues)(e,p);E(s);const o=e=>{const{failedImports:t,successfulImports:s}=e;if(!t.length)return[];const o=t.filter((({error:e})=>"missing_references"!==e.type)).reduce(((e,{obj:{type:t,id:s}})=>e.add(`${t}:${s}`)),new Set),a=t.filter((({obj:{type:e,id:t},error:s})=>"missing_references"===s.type&&!o.has(`${e}:${t}`)));return[...s.map((({type:e,id:t,overwrite:s,destinationId:o,createNewCopy:a})=>({type:e,id:t,overwrite:!0===s,destinationId:o,createNewCopy:a}))),...a.map((({obj:{type:e,id:t}})=>({type:e,id:t,overwrite:!1,ignoreMissingReferences:!0})))]},c=Object(a.mapValues)(s,o);k(c)}catch(e){S(!1),d.addError(e,{title:i.i18n.translate("xpack.spaces.management.copyToSpace.copyErrorTitle",{defaultMessage:"Error copying saved object"})})}},onCopyFinish:async function(){if(Object.values(_).some((e=>e.length))){T(!0);try{await t.resolveCopySavedObjectsErrors([{type:m.type,id:m.id}],_,x.includeRelated,x.createNewCopies),d.addSuccess(i.i18n.translate("xpack.spaces.management.copyToSpace.resolveCopySuccessTitle",{defaultMessage:"Copy successful"})),j()}catch(e){S(!1),d.addError(e,{title:i.i18n.translate("xpack.spaces.management.copyToSpace.resolveCopyErrorTitle",{defaultMessage:"Error resolving saved object conflicts"})})}}else j()}})))}},34:function(e,t,s){"use strict";var o,a=function(){var e={};return function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}e[t]=s}return e[t]}}(),c=[];function n(e){for(var t=-1,s=0;s<c.length;s++)if(c[s].identifier===e){t=s;break}return t}function i(e,t){for(var s={},o=[],a=0;a<e.length;a++){var i=e[a],r=t.base?i[0]+t.base:i[0],l=s[r]||0,p="".concat(r," ").concat(l);s[r]=l+1;var u=n(p),d={css:i[1],media:i[2],sourceMap:i[3]};-1!==u?(c[u].references++,c[u].updater(d)):c.push({identifier:p,updater:g(d,t),references:1}),o.push(p)}return o}function r(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var c=s.nc;c&&(o.nonce=c)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var n=a(e.insert||"head");if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(t)}return t}var l,p=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function u(e,t,s,o){var a=s?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=p(t,a);else{var c=document.createTextNode(a),n=e.childNodes;n[t]&&e.removeChild(n[t]),n.length?e.insertBefore(c,n[t]):e.appendChild(c)}}function d(e,t,s){var o=s.css,a=s.media,c=s.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),c&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(c))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var j=null,b=0;function g(e,t){var s,o,a;if(t.singleton){var c=b++;s=j||(j=r(t)),o=u.bind(null,s,c,!1),a=u.bind(null,s,c,!0)}else s=r(t),o=d.bind(null,s,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(s)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o));var s=i(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<s.length;o++){var a=n(s[o]);c[a].references--}for(var r=i(e,t),l=0;l<s.length;l++){var p=n(s[l]);0===c[p].references&&(c[p].updater(),c.splice(p,1))}s=r}}}},35:function(e,t,s){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s=function(e,t){var s,o,a,c=e[1]||"",n=e[3];if(!n)return c;if(t&&"function"==typeof btoa){var i=(s=n,o=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(a," */")),r=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[c].concat(r).concat([i]).join("\n")}return[c].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(s,"}"):s})).join("")},t.i=function(e,s,o){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(o)for(var c=0;c<this.length;c++){var n=this[c][0];null!=n&&(a[n]=!0)}for(var i=0;i<e.length;i++){var r=[].concat(e[i]);o&&a[r[0]]||(s&&(r[2]?r[2]="".concat(s," and ").concat(r[2]):r[2]=s),t.push(r))}},t}},77:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(78);case"v8light":return s(80)}},78:function(e,t,s){var o=s(34),a=s(79);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},79:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpace__spacesList{margin-top:4px}",""]),e.exports=t},80:function(e,t,s){var o=s(34),a=s(81);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},81:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpace__spacesList{margin-top:4px}",""]),e.exports=t},82:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(83);case"v8light":return s(85)}},83:function(e,t,s){var o=s(34),a=s(84);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},84:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpaceResult{border-bottom:1px solid #343741;padding-bottom:8px}",""]),e.exports=t},85:function(e,t,s){var o=s(34),a=s(86);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},86:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpaceResult{border-bottom:1px solid #d3dae6;padding-bottom:8px}",""]),e.exports=t},87:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(88);case"v8light":return s(90)}},88:function(e,t,s){var o=s(34),a=s(89);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},89:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpace__missingReferencesIcon,.spcCopyToSpace__summaryCountBadge{margin-left:4px}",""]),e.exports=t},90:function(e,t,s){var o=s(34),a=s(91);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},91:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpace__missingReferencesIcon,.spcCopyToSpace__summaryCountBadge{margin-left:4px}",""]),e.exports=t},92:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(93);case"v8light":return s(95)}},93:function(e,t,s){var o=s(34),a=s(94);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},94:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpace__resolveAllConflictsLink{font-size:14px;margin-right:8px}",""]),e.exports=t},95:function(e,t,s){var o=s(34),a=s(96);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},96:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpace__resolveAllConflictsLink{font-size:14px;margin-right:8px}",""]),e.exports=t},97:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(98);case"v8light":return s(100)}},98:function(e,t,s){var o=s(34),a=s(99);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);o(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},99:function(e,t,s){(t=s(35)(!1)).push([e.i,".spcCopyToSpaceResultDetails{margin-top:8px;padding-left:24px}.spcCopyToSpaceResultDetails__row{margin-bottom:4px}.spcCopyToSpaceResultDetails__savedObjectName{min-width:0}.spcCopyToSpaceResultDetails__selectControl{margin-left:24px}.spcCopyToSpaceResultDetails__selectControl__childWrapper{height:0;opacity:0;overflow:hidden;transform:translatez(0);transition:height .25s cubic-bezier(.694,.0482,.335,1),opacity .25s cubic-bezier(.694,.0482,.335,1);visibility:hidden}.spcCopyToSpaceResultDetails__selectControl.spcCopyToSpaceResultDetails__selectControl-isOpen .spcCopyToSpaceResultDetails__selectControl__childWrapper{height:auto;opacity:1;visibility:visible}",""]),e.exports=t}}]);