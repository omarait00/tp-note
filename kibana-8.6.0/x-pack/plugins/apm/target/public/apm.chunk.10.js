/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.apm_bundle_jsonpfunction=window.apm_bundle_jsonpfunction||[]).push([[10],{1089:function(e,t,a){"use strict";a.r(t),a.d(t,"TransactionDurationRuleType",(function(){return T}));var n=a(15),i=a(0),r=a(7),o=a(1),l=a.n(o),s=a(21),c=a(38),u=a(13),m=a(12),d=a(11),p=a(61),g=a(74),v=a(109),h=a(136),f=a(110),w=a(137),S=a(111),E=a(96);const y={[u.c.Avg]:i.i18n.translate("xpack.apm.transactionDurationAlert.aggregationType.avg",{defaultMessage:"Average"}),[u.c.P95]:i.i18n.translate("xpack.apm.transactionDurationAlert.aggregationType.95th",{defaultMessage:"95th percentile"}),[u.c.P99]:i.i18n.translate("xpack.apm.transactionDurationAlert.aggregationType.99th",{defaultMessage:"99th percentile"})};function T(e){var t;const{services:a}=Object(s.useKibana)(),{ruleParams:T,metadata:b,setRuleParams:O,setRuleProperty:x}=e;Object(o.useEffect)((()=>{Object(g.createCallApmApi)(a)}),[a]);const z=Object(r.defaults)({...Object(r.omit)(b,["start","end"]),...T},{aggregationType:u.c.Avg,threshold:1500,windowSize:5,windowUnit:c.TIME_UNITS.MINUTE,environment:m.a.value}),{data:k}=Object(p.c)((e=>{const{interval:t,start:a,end:n}=Object(w.a)({windowSize:z.windowSize,windowUnit:z.windowUnit});if(t&&a&&n)return e("GET /internal/apm/rule_types/transaction_duration/chart_preview",{params:{query:{aggregationType:z.aggregationType,environment:z.environment,serviceName:z.serviceName,transactionType:z.transactionType,interval:t,start:a,end:n}}})}),[z.aggregationType,z.environment,z.serviceName,z.transactionType,z.windowSize,z.windowUnit]),M=null!==(t=null==k?void 0:k.latencyChartPreview)&&void 0!==t?t:[],j=Object(v.a)(M),C=Object(d.m)(j),P=Object(v.b)(C),_=1e3*z.threshold,A=l.a.createElement(h.a,{series:M,threshold:_,yTickFormat:P,uiSettings:a.uiSettings}),U=[l.a.createElement(f.c,{allowAll:!1,currentValue:z.serviceName,onChange:e=>O("serviceName",e)}),l.a.createElement(f.d,{currentValue:z.transactionType,onChange:e=>O("transactionType",e)}),l.a.createElement(f.a,{currentValue:z.environment,onChange:e=>O("environment",e)}),l.a.createElement(E.a,{value:z.aggregationType,title:i.i18n.translate("xpack.apm.transactionDurationRuleType.when",{defaultMessage:"When"})},l.a.createElement(n.EuiSelect,{value:z.aggregationType,options:Object(r.map)(y,((e,t)=>({text:e,value:t}))),onChange:e=>O("aggregationType",e.target.value),compressed:!0})),l.a.createElement(f.b,{value:z.threshold,unit:i.i18n.translate("xpack.apm.transactionDurationRuleType.ms",{defaultMessage:"ms"}),onChange:e=>O("threshold",e||0)}),l.a.createElement(c.ForLastExpression,{onChangeWindowSize:e=>O("windowSize",e||""),onChangeWindowUnit:e=>O("windowUnit",e),timeWindowSize:z.windowSize,timeWindowUnit:z.windowUnit,errors:{timeWindowSize:[],timeWindowUnit:[]}})];return l.a.createElement(S.a,{minimumWindowSize:{value:5,unit:c.TIME_UNITS.MINUTE},chartPreview:A,defaultParams:z,fields:U,setRuleParams:O,setRuleProperty:x})}t.default=T},109:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return r}));var n=a(4);function i(e){return t=>e(t).formatted}function r(e){const t=null==e?void 0:e.flatMap((e=>e.data)).map((e=>e.y)).filter(n.a);return null!=t&&t.length?Math.max(...t,0):0}},110:function(e,t,a){"use strict";a.d(t,"c",(function(){return p})),a.d(t,"a",(function(){return g})),a.d(t,"d",(function(){return v})),a.d(t,"b",(function(){return h}));var n=a(8),i=a.n(n),r=a(15),o=a(0),l=a(1),s=a.n(l),c=a(20),u=a(12),m=a(100),d=a(96);function p({allowAll:e=!0,currentValue:t,onChange:a}){return s.a.createElement(d.a,{value:t||u.c,title:o.i18n.translate("xpack.apm.alerting.fields.service",{defaultMessage:"Service"})},s.a.createElement(m.a,{customOptions:e?[{label:u.c,value:""}]:void 0,customOptionText:o.i18n.translate("xpack.apm.serviceNamesSelectCustomOptionText",{defaultMessage:"Add \\{searchValue\\} as a new service name"}),defaultValue:t,fieldName:c.x,onChange:a,placeholder:o.i18n.translate("xpack.apm.serviceNamesSelectPlaceholder",{defaultMessage:"Select service name"}),start:i()().subtract(24,"h").toISOString(),end:i()().toISOString()}))}function g({currentValue:e,onChange:t}){return s.a.createElement(d.a,{value:Object(u.d)(e),title:o.i18n.translate("xpack.apm.alerting.fields.environment",{defaultMessage:"Environment"})},s.a.createElement(m.a,{customOptions:[u.a],customOptionText:o.i18n.translate("xpack.apm.environmentsSelectCustomOptionText",{defaultMessage:"Add \\{searchValue\\} as a new environment"}),defaultValue:Object(u.d)(e),fieldName:c.v,onChange:t,placeholder:o.i18n.translate("xpack.apm.environmentsSelectPlaceholder",{defaultMessage:"Select environment"}),start:i()().subtract(24,"h").toISOString(),end:i()().toISOString()}))}function v({currentValue:e,onChange:t}){const a=o.i18n.translate("xpack.apm.alerting.fields.type",{defaultMessage:"Type"});return s.a.createElement(d.a,{value:e||u.c,title:a},s.a.createElement(m.a,{customOptions:[{label:u.c,value:""}],customOptionText:o.i18n.translate("xpack.apm.transactionTypesSelectCustomOptionText",{defaultMessage:"Add \\{searchValue\\} as a new transaction type"}),defaultValue:e,fieldName:c.L,onChange:t,placeholder:o.i18n.translate("xpack.apm.transactionTypesSelectPlaceholder",{defaultMessage:"Select transaction type"}),start:i()().subtract(24,"h").toISOString(),end:i()().toISOString()}))}function h({value:e,unit:t,onChange:a,step:n}){return s.a.createElement(d.a,{value:`${e}${t}`,title:o.i18n.translate("xpack.apm.transactionErrorRateRuleType.isAbove",{defaultMessage:"is above"})},s.a.createElement(r.EuiFieldNumber,{min:0,value:null!=e?e:0,onChange:e=>a(parseInt(e.target.value,10)),append:t,compressed:!0,step:n}))}},111:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(15),i=a(1),r=a.n(i),o=a(0),l=a(8),s=a.n(l),c=a(38);function u(e){const{fields:t,setRuleParams:a,defaultParams:o,chartPreview:l,minimumWindowSize:c}=e,u={...o},d=function({windowSize:e,windowUnit:t,minimumWindowSize:a}){const[n,r]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{if(void 0===e||void 0===a)return;const n=s.a.duration(e,t).asMilliseconds(),i=s.a.duration(a.value,a.unit).asMilliseconds();r(n<i)}),[e,t,a]),n}({windowSize:u.windowSize,windowUnit:u.windowUnit,minimumWindowSize:c});return Object(i.useEffect)((()=>{Object.keys(u).forEach((e=>{a(e,u[e])}))}),[]),r.a.createElement(r.a.Fragment,null,d&&c&&r.a.createElement(m,{minimumWindowSize:c}),r.a.createElement(n.EuiSpacer,{size:"l"}),r.a.createElement(n.EuiFlexGrid,{gutterSize:"l",direction:"row",columns:2},t.map(((e,t)=>r.a.createElement(n.EuiFlexItem,{grow:!1,key:t},e)))),l,r.a.createElement(n.EuiSpacer,{size:"m"}))}function m({minimumWindowSize:e}){const t=o.i18n.translate("xpack.apm.alertTypes.minimumWindowSize.description",{defaultMessage:"The recommended minimum value is {sizeValue} {sizeUnit}. This is to ensure that the alert has enough data to evaluate. If you choose a value that is too low, the alert may not fire as expected.",values:{sizeValue:e.value,sizeUnit:Object(c.getTimeUnitLabel)(e.unit)}});return r.a.createElement(n.EuiCallOut,{title:`Please increase "For the last" to at least ${e.value} ${Object(c.getTimeUnitLabel)(e.unit)}`,color:"warning",iconType:"alert"},r.a.createElement("p",null,t))}},136:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(36),i=a(15),r=a(1),o=a.n(r),l=a(66),s=a(113);function c({yTickFormat:e,threshold:t,uiSettings:a,series:r}){const c=Object(l.a)(),u=r.flatMap((({data:e})=>e.map((({x:e})=>e)))),m=Math.min(...u),d=Math.max(...u),p=Object(n.niceTimeFormatter)([m,d]),g={fill:c.eui.euiColorVis2,line:{strokeWidth:2,stroke:c.eui.euiColorVis2,opacity:1},opacity:.3},v=[{coordinates:{x0:null,x1:null,y0:t,y1:null}}],h=Object(s.a)(a),f=30*Math.ceil(r.length/2);return o.a.createElement(o.a.Fragment,null,o.a.createElement(i.EuiSpacer,{size:"m"}),o.a.createElement(n.Chart,{size:{height:r.length>1?150+f:150},"data-test-subj":"ChartPreview"},o.a.createElement(n.Settings,{tooltip:"none",showLegend:r.length>1,legendPosition:"bottom",legendSize:f}),o.a.createElement(n.LineAnnotation,{dataValues:[{dataValue:t}],domainType:n.AnnotationDomainType.YDomain,id:"chart_preview_line_annotation",markerPosition:"left",style:g}),o.a.createElement(n.RectAnnotation,{dataValues:v,hideTooltips:!0,id:"chart_preview_rect_annotation",style:g}),o.a.createElement(n.Axis,{id:"chart_preview_x_axis",position:n.Position.Bottom,showOverlappingTicks:!0,tickFormat:p}),o.a.createElement(n.Axis,{id:"chart_preview_y_axis",position:n.Position.Left,tickFormat:e,ticks:5}),r.map((({name:e,data:t},a)=>o.a.createElement(n.BarSeries,{key:a,timeZone:h,data:t,id:`chart_preview_bar_series_${e||a}`,name:e,xAccessor:"x",xScaleType:n.ScaleType.Time,yAccessors:["y"],yScaleType:n.ScaleType.Linear})))))}},137:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(8),i=a.n(n);function r({windowSize:e,windowUnit:t}){const a=Date.now(),n=a-20*i.a.duration(e,t).asMilliseconds();return{interval:`${e}${t}`,start:new Date(n).toISOString(),end:new Date(a).toISOString()}}},96:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(1),i=a.n(n),r=a(15);function o(e){const{title:t,value:a,children:o}=e,[l,s]=Object(n.useState)(!1);return i.a.createElement(r.EuiPopover,{isOpen:l,anchorPosition:"downLeft",closePopover:()=>s(!1),button:i.a.createElement(r.EuiExpression,{description:t,value:a,isActive:l,onClick:()=>s((e=>!e))}),repositionOnScroll:!0},o)}}}]);