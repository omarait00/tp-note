/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.osquery_bundle_jsonpfunction=window.osquery_bundle_jsonpfunction||[]).push([[6],{125:function(e,t,a){"use strict";const l=a(126),r=a(127),n=a(128);function i(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function s(e,t){return t.encode?t.strict?l(e):encodeURIComponent(e):e}function u(e,t){return t.decode?r(e):e}function o(e){return Array.isArray(e)?e.sort():"object"==typeof e?o(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function c(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function d(e){const t=(e=c(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function m(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function p(e,t){i((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const a=function(e){let t;switch(e.arrayFormat){case"index":return(e,a,l)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===l[e]&&(l[e]={}),l[e][t[1]]=a):l[e]=a};case"bracket":return(e,a,l)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==l[e]?l[e]=[].concat(l[e],a):l[e]=[a]:l[e]=a};case"comma":case"separator":return(t,a,l)=>{const r="string"==typeof a&&a.split("").indexOf(e.arrayFormatSeparator)>-1?a.split(e.arrayFormatSeparator).map((t=>u(t,e))):null===a?a:u(a,e);l[t]=r};default:return(e,t,a)=>{void 0!==a[e]?a[e]=[].concat(a[e],t):a[e]=t}}}(t),l=Object.create(null);if("string"!=typeof e)return l;if(!(e=e.trim().replace(/^[?#&]/,"")))return l;for(const r of e.split("&")){let[e,i]=n(t.decode?r.replace(/\+/g," "):r,"=");i=void 0===i?null:["comma","separator"].includes(t.arrayFormat)?i:u(i,t),a(u(e,t),i,l)}for(const e of Object.keys(l)){const a=l[e];if("object"==typeof a&&null!==a)for(const e of Object.keys(a))a[e]=m(a[e],t);else l[e]=m(a,t)}return!1===t.sort?l:(!0===t.sort?Object.keys(l).sort():Object.keys(l).sort(t.sort)).reduce(((e,t)=>{const a=l[t];return Boolean(a)&&"object"==typeof a&&!Array.isArray(a)?e[t]=o(a):e[t]=a,e}),Object.create(null))}t.extract=d,t.parse=p,t.stringify=(e,t)=>{if(!e)return"";i((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const a=a=>t.skipNull&&null==e[a]||t.skipEmptyString&&""===e[a],l=function(e){switch(e.arrayFormat){case"index":return t=>(a,l)=>{const r=a.length;return void 0===l||e.skipNull&&null===l||e.skipEmptyString&&""===l?a:null===l?[...a,[s(t,e),"[",r,"]"].join("")]:[...a,[s(t,e),"[",s(r,e),"]=",s(l,e)].join("")]};case"bracket":return t=>(a,l)=>void 0===l||e.skipNull&&null===l||e.skipEmptyString&&""===l?a:null===l?[...a,[s(t,e),"[]"].join("")]:[...a,[s(t,e),"[]=",s(l,e)].join("")];case"comma":case"separator":return t=>(a,l)=>null==l||0===l.length?a:0===a.length?[[s(t,e),"=",s(l,e)].join("")]:[[a,s(l,e)].join(e.arrayFormatSeparator)];default:return t=>(a,l)=>void 0===l||e.skipNull&&null===l||e.skipEmptyString&&""===l?a:null===l?[...a,s(t,e)]:[...a,[s(t,e),"=",s(l,e)].join("")]}}(t),r={};for(const t of Object.keys(e))a(t)||(r[t]=e[t]);const n=Object.keys(r);return!1!==t.sort&&n.sort(t.sort),n.map((a=>{const r=e[a];return void 0===r?"":null===r?s(a,t):Array.isArray(r)?r.reduce(l(a),[]).join("&"):s(a,t)+"="+s(r,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[a,l]=n(e,"#");return Object.assign({url:a.split("?")[0]||"",query:p(d(e),t)},t&&t.parseFragmentIdentifier&&l?{fragmentIdentifier:u(l,t)}:{})},t.stringifyUrl=(e,a)=>{a=Object.assign({encode:!0,strict:!0},a);const l=c(e.url).split("?")[0]||"",r=t.extract(e.url),n=t.parse(r,{sort:!1}),i=Object.assign(n,e.query);let u=t.stringify(i,a);u&&(u=`?${u}`);let o=function(e){let t="";const a=e.indexOf("#");return-1!==a&&(t=e.slice(a)),t}(e.url);return e.fragmentIdentifier&&(o=`#${s(e.fragmentIdentifier,a)}`),`${l}${u}${o}`}},126:function(e,t,a){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},127:function(e,t,a){"use strict";var l="%[a-f0-9]{2}",r=new RegExp(l,"gi"),n=new RegExp("("+l+")+","gi");function i(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var a=e.slice(0,t),l=e.slice(t);return Array.prototype.concat.call([],i(a),i(l))}function s(e){try{return decodeURIComponent(e)}catch(l){for(var t=e.match(r),a=1;a<t.length;a++)t=(e=i(t,a).join("")).match(r);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},a=n.exec(e);a;){try{t[a[0]]=decodeURIComponent(a[0])}catch(e){var l=s(a[0]);l!==a[0]&&(t[a[0]]=l)}a=n.exec(e)}t["%C2"]="�";for(var r=Object.keys(t),i=0;i<r.length;i++){var u=r[i];e=e.replace(new RegExp(u,"g"),t[u])}return e}(e)}}},128:function(e,t,a){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const a=e.indexOf(t);return-1===a?[e]:[e.slice(0,a),e.slice(a+t.length)]}},160:function(e,t,a){"use strict";a.r(t),a.d(t,"renderApp",(function(){return Ha}));var l=a(2),r=a(51),n=a(0),i=a.n(n),s=a(52),u=a.n(s),o=a(21),c=a(18),d=a(41),m=a.n(d),p=a(10),E=a(53),b=a(23);const g=m.a.div.withConfig({displayName:"Container",componentId:"sc-gz9q42-0"})(["min-height:calc( 100vh - ","px );background:",";display:flex;flex-direction:column;"],(e=>2*parseFloat(e.theme.eui.euiHeaderHeightCompensation)),(e=>e.theme.eui.euiColorEmptyShade)),y=m.a.div.withConfig({displayName:"Wrapper",componentId:"sc-gz9q42-1"})(["display:flex;flex-direction:column;flex:1;"]),v=m.a.nav.withConfig({displayName:"Nav",componentId:"sc-gz9q42-2"})(["background:",";border-bottom:",";padding:",";.euiTabs{padding-left:3px;margin-left:-3px;}"],(e=>e.theme.eui.euiColorEmptyShade),(e=>e.theme.eui.euiBorderThin),(e=>`${e.theme.eui.euiSize} ${e.theme.eui.euiSizeL} ${e.theme.eui.euiSize} ${e.theme.eui.euiSizeL}`));var f=a(5),k=a.n(f);const h=m.a.div.withConfig({displayName:"Container",componentId:"sc-399yyp-0"})(["border-bottom:",";background-color:",";"],(e=>e.theme.eui.euiBorderThin),(e=>e.theme.eui.euiPageBackgroundColor)),x=m.a.div.withConfig({displayName:"Wrapper",componentId:"sc-399yyp-1"})(["max-width:","px;margin-left:auto;margin-right:auto;padding-top:",";padding-left:",";padding-right:",";"],(e=>e.maxWidth||1200),(e=>e.theme.eui.euiSizeXL),(e=>e.theme.eui.euiSizeM),(e=>e.theme.eui.euiSizeM)),O=m()(l.EuiTabs).withConfig({displayName:"Tabs",componentId:"sc-399yyp-2"})(["top:1px;&:before{height:0px;}"]),j=Object(n.memo)((({leftColumn:e,rightColumn:t,rightColumnGrow:a})=>i.a.createElement(l.EuiFlexGroup,{alignItems:"center"},e?i.a.createElement(l.EuiFlexItem,null,e):null,t?i.a.createElement(l.EuiFlexItem,{grow:a},t):null)));j.displayName="HeaderColumns";const q=({children:e,leftColumn:t,rightColumn:a,rightColumnGrow:r,tabs:n,maxWidth:s,tabsClassName:u,"data-test-subj":o})=>i.a.createElement(h,{"data-test-subj":o},i.a.createElement(x,{maxWidth:s},i.a.createElement(j,{leftColumn:t,rightColumn:a,rightColumnGrow:r}),e,i.a.createElement(l.EuiFlexGroup,null,n?i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"s"}),i.a.createElement(O,{className:u},n.map((e=>i.a.createElement(l.EuiTab,k()({},e,{key:e.id}),e.name))))):i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"l"}))))),M=i.a.memo(q),C=m()(l.EuiPage).withConfig({displayName:"Page",componentId:"sc-18dk5bh-0"})(["background:",";width:100%;align-self:center;margin-left:0;margin-right:0;flex:1;"],(e=>e.theme.eui.euiColorEmptyShade)),F=m.a.div.withConfig({displayName:"ContentWrapper",componentId:"sc-18dk5bh-1"})(["height:100%;"]),S=({restrictWidth:e,restrictHeaderWidth:t,children:a,headerChildren:r,"data-test-subj":s,...u})=>i.a.createElement(n.Fragment,null,i.a.createElement(M,k()({maxWidth:t,"data-test-subj":s?`${s}_header`:void 0},u),r),i.a.createElement(C,{restrictWidth:e||1200,"data-test-subj":s?`${s}_page`:void 0},i.a.createElement(l.EuiPageBody,null,i.a.createElement(F,null,i.a.createElement(l.EuiSpacer,{size:"l"}),a))));var I=a(9),T=a(12),w=a(59),_=a(6);const P={href:w.a.overview(),text:I.i18n.translate("xpack.osquery.breadcrumbs.appTitle",{defaultMessage:"Osquery"})},L={base:()=>[P],overview:()=>[P,{text:I.i18n.translate("xpack.osquery.breadcrumbs.overviewPageTitle",{defaultMessage:"Overview"})}],live_queries:()=>[P,{text:I.i18n.translate("xpack.osquery.breadcrumbs.liveQueriesPageTitle",{defaultMessage:"Live queries"})}],live_query_new:()=>[P,{href:w.a.live_queries(),text:I.i18n.translate("xpack.osquery.breadcrumbs.liveQueriesPageTitle",{defaultMessage:"Live queries"})},{text:I.i18n.translate("xpack.osquery.breadcrumbs.newLiveQueryPageTitle",{defaultMessage:"New"})}],live_query_details:({liveQueryId:e})=>[P,{href:w.a.live_queries(),text:I.i18n.translate("xpack.osquery.breadcrumbs.liveQueriesPageTitle",{defaultMessage:"Live queries"})},{text:e}],saved_queries:()=>[P,{text:I.i18n.translate("xpack.osquery.breadcrumbs.savedQueriesPageTitle",{defaultMessage:"Saved queries"})}],saved_query_new:()=>[P,{href:w.a.saved_queries(),text:I.i18n.translate("xpack.osquery.breadcrumbs.savedQueriesPageTitle",{defaultMessage:"Saved queries"})},{text:I.i18n.translate("xpack.osquery.breadcrumbs.newSavedQueryPageTitle",{defaultMessage:"New"})}],saved_query_edit:({savedQueryName:e})=>[P,{href:w.a.saved_queries(),text:I.i18n.translate("xpack.osquery.breadcrumbs.savedQueriesPageTitle",{defaultMessage:"Saved queries"})},{text:e}],packs:()=>[P,{text:I.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})}],pack_add:()=>[P,{href:w.a.packs(),text:I.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})},{text:I.i18n.translate("xpack.osquery.breadcrumbs.addpacksPageTitle",{defaultMessage:"Add"})}],pack_details:({packName:e})=>[P,{href:w.a.packs(),text:I.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})},{text:e}],pack_edit:({packName:e,packId:t})=>[P,{href:w.a.packs(),text:I.i18n.translate("xpack.osquery.breadcrumbs.packsPageTitle",{defaultMessage:"Packs"})},{href:w.a.pack_details({packId:t}),text:e},{text:I.i18n.translate("xpack.osquery.breadcrumbs.editpacksPageTitle",{defaultMessage:"Edit"})}]};function Q(e,t={}){var a;const{chrome:l,http:r,application:n}=Object(_.e)().services,i=(null===(a=L[e])||void 0===a?void 0:a.call(L,t).map((e=>{const t=e.href?r.basePath.prepend(`${T.a}${e.href}`):void 0;return{...e,href:t,onClick:t?e=>{e.metaKey||e.altKey||e.ctrlKey||e.shiftKey||(e.preventDefault(),n.navigateToUrl(t))}:void 0}})))||[],s=[...i].reverse().map((e=>e.text));l.docTitle.change(s),l.setBreadcrumbs(i)}var N=a(20),A=a(65),B=a(80),z=a(58),D=a(61);const R=[],G=({actionId:e})=>{const t=Object(_.f)(`live_queries/${e}`),a=I.i18n.translate("xpack.osquery.liveQueryActions.table.viewDetailsActionButton",{defaultMessage:"Details"});return i.a.createElement(l.EuiToolTip,{position:"top",content:a},i.a.createElement(l.EuiButtonIcon,k()({iconType:"visTable"},t,{"aria-label":a})))};G.displayName="ActionTableResultsButton";const $=()=>{var e,t;const a=Object(_.e)().services.application.capabilities.osquery,{push:r}=Object(o.useHistory)(),[s,u]=Object(n.useState)(0),[c,d]=Object(n.useState)(20),{data:m}=Object(D.a)({}),{data:p}=Object(B.a)({activePage:s,limit:c,direction:z.a.desc,sortField:"@timestamp",filterQuery:{exists:{field:"user_id"}}}),E=Object(n.useCallback)((({page:e={}})=>{const{index:t,size:a}=e;u(t),d(a)}),[]),b=Object(n.useCallback)(((e,t)=>{if(t._source.pack_name)return i.a.createElement(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center",justifyContent:"center"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiIcon,{type:"package"})),i.a.createElement(l.EuiFlexItem,null,t._source.pack_name));const a=t._source.queries[0].query,r=Object(A.a)(a),n=r.length>90?`${null==r?void 0:r.substring(0,90)}...`:r;return i.a.createElement(l.EuiCodeBlock,{language:"sql",fontSize:"s",paddingSize:"none",transparentBackground:!0},n)}),[]),g=Object(n.useCallback)(((e,t)=>{var a,l;return i.a.createElement(i.a.Fragment,null,null!==(a=null===(l=t.fields.agents)||void 0===l?void 0:l.length)&&void 0!==a?a:0)}),[]),y=Object(n.useCallback)((e=>Object(N.isArray)(e)?e[0]:"-"),[]),v=Object(n.useCallback)(((e,t)=>i.a.createElement(i.a.Fragment,null,Object(l.formatDate)(t.fields["@timestamp"][0]))),[]),f=Object(n.useCallback)((e=>i.a.createElement(G,{actionId:e.fields.action_id[0]})),[]),k=Object(n.useCallback)((e=>()=>{if(e._source.pack_id)return r("/live_queries/new",{form:Object(N.pickBy)({packId:e._source.pack_id,agentSelection:{agents:e._source.agent_ids,allAgentsSelected:e._source.agent_all,platformsSelected:e._source.agent_platforms,policiesSelected:e._source.agent_policy_ids}},(e=>!Object(N.isEmpty)(e)))});r("/live_queries/new",{form:Object(N.pickBy)({query:e._source.queries[0].query,ecs_mapping:e._source.queries[0].ecs_mapping,savedQueryId:e._source.queries[0].saved_query_id,agentSelection:{agents:e._source.agent_ids,allAgentsSelected:e._source.agent_all,platformsSelected:e._source.agent_platforms,policiesSelected:e._source.agent_policy_ids}},(e=>!Object(N.isEmpty)(e)))})}),[r]),h=Object(n.useCallback)(((e,t)=>{const a=I.i18n.translate("xpack.osquery.liveQueryActions.table.runActionAriaLabel",{defaultMessage:"Run query"});return i.a.createElement(l.EuiToolTip,{position:"top",content:a},i.a.createElement(l.EuiButtonIcon,{iconType:"play",onClick:k(e),isDisabled:!t,"aria-label":a}))}),[k]),x=Object(n.useMemo)((()=>{var e;return Object(N.map)(null!==(e=null==m?void 0:m.data)&&void 0!==e?e:[],"id")}),[m]),O=Object(n.useCallback)((e=>{var t;return null!==(t=e.fields.pack_id)&&void 0!==t&&t.length?x.includes(e.fields.pack_id[0])&&a.runSavedQueries&&a.readPacks:!(!a.runSavedQueries&&!a.writeLiveQueries)}),[a,x]),j=Object(n.useMemo)((()=>[{field:"query",name:I.i18n.translate("xpack.osquery.liveQueryActions.table.queryColumnTitle",{defaultMessage:"Query"}),truncateText:!0,width:"60%",render:b},{field:"agents",name:I.i18n.translate("xpack.osquery.liveQueryActions.table.agentsColumnTitle",{defaultMessage:"Agents"}),width:"100px",render:g},{field:"created_at",name:I.i18n.translate("xpack.osquery.liveQueryActions.table.createdAtColumnTitle",{defaultMessage:"Created at"}),width:"200px",render:v},{field:"fields.user_id",name:I.i18n.translate("xpack.osquery.liveQueryActions.table.createdByColumnTitle",{defaultMessage:"Run by"}),width:"200px",render:y},{name:I.i18n.translate("xpack.osquery.liveQueryActions.table.viewDetailsColumnTitle",{defaultMessage:"View details"}),actions:[{available:O,render:h},{render:f}]}]),[O,f,g,y,h,b,v]),q=Object(n.useMemo)((()=>{var e,t;return{pageIndex:s,pageSize:c,totalItemCount:null!==(e=null==p||null===(t=p.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0,pageSizeOptions:[20,50,100]}}),[p,s,c]);return i.a.createElement(l.EuiBasicTable,{items:null!==(e=null==p||null===(t=p.data)||void 0===t?void 0:t.items)&&void 0!==e?e:R,columns:j,pagination:q,onChange:E})},V=i.a.memo($),U=()=>{Q("live_queries");const e=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.liveQueriesHistory.pageTitle",defaultMessage:"Live queries history"})))))),[]);return i.a.createElement(S,{leftColumn:e,rightColumn:i.a.createElement(H,null),rightColumnGrow:!1},i.a.createElement(V,null))},W=i.a.memo(U),H=i.a.memo((()=>{const e=Object(_.e)().services.application.capabilities.osquery,t=Object(_.f)("live_queries/new");return i.a.createElement(l.EuiButton,k()({fill:!0},t,{iconType:"plusInCircle",isDisabled:!(e.writeLiveQueries||e.runSavedQueries&&(e.readSavedQueries||e.readPacks))}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.liveQueriesHistory.newLiveQueryButtonLabel",defaultMessage:"New live query"}))}));H.displayName="NewLiveQueryButton";var Y=a(125),K=a.n(Y),J=a(95);const X=()=>{var e;Q("live_query_new");const{replace:t}=Object(o.useHistory)(),a=Object(o.useLocation)(),r=Object(_.f)("live_queries"),[s,u]=Object(n.useState)({}),d=Object(n.useMemo)((()=>{const e=K.a.parse(a.search);return null!=e&&e.agentPolicyId?[null==e?void 0:e.agentPolicyId]:void 0}),[a.search]);Object(n.useEffect)((()=>{var e,l;null!==(e=a.state)&&void 0!==e&&e.form&&(u(null===(l=a.state)||void 0===l?void 0:l.form),t({state:null}))}),[null===(e=a.state)||void 0===e?void 0:e.form,t]);const m=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},r,{flush:"left",size:"xs"}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.newLiveQuery.viewLiveQueriesHistoryTitle",defaultMessage:"View live queries history"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.newLiveQuery.pageTitle",defaultMessage:"New live query"})))))),[r]);return i.a.createElement(S,{leftColumn:m},i.a.createElement(J.a,k()({agentPolicyIds:d},s)))},Z=i.a.memo(X);var ee=a(72),te=a(71);const ae=m()(l.EuiFlexItem).withConfig({displayName:"StyledTableWrapper",componentId:"sc-17cam0v-0"})(["padding-left:10px;"]),le=()=>{const{actionId:e}=Object(o.useParams)();Q("live_query_details",{liveQueryId:e});const t=Object(_.f)("live_queries"),[a,r]=Object(n.useState)(!1),{data:s}=Object(ee.a)({actionId:e,isLive:a}),u=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},t,{flush:"left",size:"xs"}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.liveQueryDetails.viewLiveQueriesHistoryTitle",defaultMessage:"View live queries history"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.liveQueryDetails.pageTitle",defaultMessage:"Live query details"})))))),[t]);return Object(n.useLayoutEffect)((()=>{r((()=>!("completed"===(null==s?void 0:s.status))))}),[null==s?void 0:s.status]),i.a.createElement(S,{leftColumn:u,rightColumnGrow:!1},i.a.createElement(ae,null,i.a.createElement(te.a,{actionId:e,data:null==s?void 0:s.queries,startDate:null==s?void 0:s["@timestamp"],expirationDate:null==s?void 0:s.expiration,agentIds:null==s?void 0:s.agents,showResultsHeader:!0})))},re=i.a.memo(le);var ne=a(76);const ie=()=>{const e=Object(_.e)().services.application.capabilities.osquery;Q("live_queries");const t=Object(o.useRouteMatch)();return e.readLiveQueries?i.a.createElement(o.Switch,null,i.a.createElement(o.Route,{path:`${t.url}/new`},e.runSavedQueries&&(e.readSavedQueries||e.readPacks)||e.writeLiveQueries?i.a.createElement(Z,null):i.a.createElement(ne.a,null)),i.a.createElement(o.Route,{path:`${t.url}/:actionId`},i.a.createElement(re,null)),i.a.createElement(o.Route,{path:`${t.url}`},i.a.createElement(W,null))):i.a.createElement(ne.a,null)},se=i.a.memo(ie);var ue=a(44),oe=a.n(ue),ce=a(57),de=a.n(ce),me=a(68);const pe=({disabled:e=!1,savedQuery:t})=>{const{push:a}=Object(o.useHistory)(),r=Object(n.useCallback)((()=>a("/live_queries/new",{form:{savedQueryId:t.id,query:t.attributes.query,ecs_mapping:t.attributes.ecs_mapping}})),[a,t]),s=Object(n.useMemo)((()=>I.i18n.translate("xpack.osquery.savedQueryList.queriesTable.runActionAriaLabel",{defaultMessage:"Run {savedQueryName}",values:{savedQueryName:t.attributes.id}})),[t]);return i.a.createElement(l.EuiToolTip,{position:"top",content:s},i.a.createElement(l.EuiButtonIcon,{color:"primary",iconType:"play",isDisabled:e,onClick:r,"aria-label":s}))},Ee=i.a.memo(pe,de.a),be=({disabled:e=!1,savedQueryId:t,savedQueryName:a})=>{const r=Object(_.f)(`saved_queries/${t}`),s=Object(n.useMemo)((()=>I.i18n.translate("xpack.osquery.savedQueryList.queriesTable.editActionAriaLabel",{defaultMessage:"Edit {savedQueryName}",values:{savedQueryName:a}})),[a]);return i.a.createElement(l.EuiToolTip,{position:"top",content:s},i.a.createElement(l.EuiButtonIcon,k()({color:"primary"},r,{iconType:"pencil",isDisabled:e,"aria-label":s})))},ge=i.a.memo(be),ye=()=>{const e=Object(_.e)().services.application.capabilities.osquery;Q("saved_queries");const t=Object(_.f)("saved_queries/new"),[a,r]=Object(n.useState)(0),[s,u]=Object(n.useState)(20),[o,d]=Object(n.useState)("attributes.updated_at"),[m,p]=Object(n.useState)(z.a.desc),{data:E}=Object(me.a)({isLive:!0}),b=Object(n.useCallback)((e=>i.a.createElement(ge,{savedQueryId:e.id,savedQueryName:e.attributes.id})),[]),g=Object(n.useCallback)((t=>e.runSavedQueries||e.writeLiveQueries?i.a.createElement(Ee,{savedQuery:t,disabled:!1}):i.a.createElement(i.a.Fragment,null)),[e.runSavedQueries,e.writeLiveQueries]),y=Object(n.useCallback)(((e,t)=>{if(!e)return"-";const a=t.attributes.updated_by!==t.attributes.created_by?` @ ${t.attributes.updated_by}`:"";return e?`${oe()(e).fromNow()}${a}`:"-"}),[]),v=Object(n.useCallback)((e=>{const t=e&&e.length>80?`${null==e?void 0:e.substring(0,80)}...`:e;return i.a.createElement(l.EuiToolTip,{content:i.a.createElement(l.EuiFlexItem,null,e)},i.a.createElement(l.EuiFlexItem,{grow:!1},t))}),[]),f=Object(n.useMemo)((()=>[{field:"attributes.id",name:I.i18n.translate("xpack.osquery.savedQueries.table.queryIdColumnTitle",{defaultMessage:"Query ID"}),sortable:e=>e.attributes.id.toLowerCase(),truncateText:!0,width:"15%"},{field:"attributes.description",name:I.i18n.translate("xpack.osquery.savedQueries.table.descriptionColumnTitle",{defaultMessage:"Description"}),render:v,width:"50%"},{field:"attributes.created_by",name:I.i18n.translate("xpack.osquery.savedQueries.table.createdByColumnTitle",{defaultMessage:"Created by"}),width:"15%",sortable:!0,truncateText:!0},{field:"attributes.updated_at",name:I.i18n.translate("xpack.osquery.savedQueries.table.updatedAtColumnTitle",{defaultMessage:"Last updated at"}),width:"10%",sortable:e=>e.attributes.updated_at?Date.parse(e.attributes.updated_at):0,truncateText:!0,render:y},{name:I.i18n.translate("xpack.osquery.savedQueries.table.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:g},{render:b}]}]),[v,b,g,y]),h=Object(n.useCallback)((({page:e={},sort:t={}})=>{r(e.index),u(e.size),d(t.field),p(t.direction)}),[]),x=Object(n.useMemo)((()=>{var e;return{pageIndex:a,pageSize:s,totalItemCount:null!==(e=null==E?void 0:E.total)&&void 0!==e?e:0,pageSizeOptions:[10,20,50,100]}}),[a,s,null==E?void 0:E.total]),O=Object(n.useMemo)((()=>({sort:{field:o,direction:m}})),[m,o]),j=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.savedQueryList.pageTitle",defaultMessage:"Saved queries"})))))),[]),q=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,k()({fill:!0},t,{iconType:"plusInCircle",isDisabled:!e.writeSavedQueries}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.savedQueryList.addSavedQueryButtonLabel",defaultMessage:"Add saved query"}))),[e.writeSavedQueries,t]);return i.a.createElement(S,{leftColumn:j,rightColumn:q,rightColumnGrow:!1},(null==E?void 0:E.data)&&i.a.createElement(l.EuiInMemoryTable,{items:null==E?void 0:E.data,itemId:"id",columns:f,pagination:x,sorting:O,onChange:h,rowHeader:"id"}))},ve=i.a.memo(ye);var fe=a(19),ke=a(98),he=a(73);const xe=({defaultValue:e,handleSubmit:t})=>{const a=Object(_.f)("saved_queries"),r=Object(he.b)({defaultValue:e}),{serializer:n,idSet:s,handleSubmit:u,formState:{isSubmitting:o,errors:d}}=r;return i.a.createElement(fe.FormProvider,r,i.a.createElement(ke.a,{hasPlayground:!0,isValid:Object(N.isEmpty)(d),idSet:s}),i.a.createElement(l.EuiBottomBar,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,k()({color:"ghost"},a),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.addSavedQuery.form.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:o,color:"primary",fill:!0,size:"m",iconType:"save",onClick:u((async e=>{const a=n(e);await t(a)}))},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.addSavedQuery.form.saveQueryButtonLabel",defaultMessage:"Save query"}))))))),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}))},Oe=i.a.memo(xe);var je=a(113);const qe=()=>{Q("saved_query_new");const e=Object(_.f)("saved_queries"),{mutateAsync:t}=Object(je.a)({withRedirect:!0}),a=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},e,{flush:"left",size:"xs"}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.addSavedQuery.viewSavedQueriesListTitle",defaultMessage:"View all saved queries"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.addSavedQuery.pageTitle",defaultMessage:"Add saved query"})))))),[e]),r=Object(n.useCallback)((async e=>{await t(e)}),[t]);return i.a.createElement(S,{leftColumn:a},i.a.createElement(Oe,{handleSubmit:r}))},Me=i.a.memo(qe);var Ce=a(42);const Fe=({defaultValue:e,handleSubmit:t,viewMode:a})=>{const r=Object(_.f)("saved_queries"),n=Object(he.b)({defaultValue:e}),{serializer:s,idSet:u,handleSubmit:o,formState:{isSubmitting:d}}=n;return i.a.createElement(fe.FormProvider,n,i.a.createElement(ke.a,{viewMode:a,hasPlayground:!0,idSet:u}),!a&&i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiBottomBar,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,k()({color:"ghost"},r),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.editSavedQuery.form.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:d,color:"primary",fill:!0,size:"m",iconType:"save",onClick:o((async e=>{const a=s(e);try{await t(a)}catch(e){}}))},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.editSavedQuery.form.updateQueryButtonLabel",defaultMessage:"Update query"}))))))),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"})))},Se=i.a.memo(Fe);var Ie=a(122);const Te=m()(l.EuiCallOut).withConfig({displayName:"StyledEuiCallOut",componentId:"sc-hxtu8g-0"})(["margin:10px;"]),we=()=>{var e,t,a;const r=Object(_.e)().services.application.capabilities.osquery,[s,u]=Object(n.useState)(!1),{savedQueryId:d}=Object(o.useParams)(),m=Object(_.f)("saved_queries"),{isLoading:p,data:E}=Object(Ie.c)({savedQueryId:d}),b=Object(Ie.d)({savedQueryId:d}),g=Object(Ie.b)({savedQueryId:d});Q("saved_query_edit",{savedQueryName:null!==(e=null==E||null===(t=E.attributes)||void 0===t?void 0:t.id)&&void 0!==e?e:""});const y=Object(n.useMemo)((()=>{var e;return!(null==E||null===(e=E.attributes)||void 0===e||!e.prebuilt)}),[E]),v=Object(n.useMemo)((()=>!r.writeSavedQueries||y),[r.writeSavedQueries,y]),f=Object(n.useCallback)((()=>{u(!1)}),[]),h=Object(n.useCallback)((()=>{u(!0)}),[]),x=Object(n.useCallback)((()=>{g.mutateAsync().then((()=>{f()}))}),[g,f]),O=Object(n.useMemo)((()=>{var e,t,a,r;return i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},m,{flush:"left",size:"xs"}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.editSavedQuery.viewSavedQueriesListTitle",defaultMessage:"View all saved queries"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,v?i.a.createElement(i.a.Fragment,null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.viewSavedQuery.pageTitle",defaultMessage:'"{savedQueryId}" details',values:{savedQueryId:null!==(e=null==E||null===(t=E.attributes)||void 0===t?void 0:t.id)&&void 0!==e?e:""}}),y&&i.a.createElement(Te,{size:"s"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.viewSavedQuery.prebuiltInfo",defaultMessage:"This is a prebuilt Elastic query, and it cannot be edited."}))):i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.editSavedQuery.pageTitle",defaultMessage:'Edit "{savedQueryId}"',values:{savedQueryId:null!==(a=null==E||null===(r=E.attributes)||void 0===r?void 0:r.id)&&void 0!==a?a:""}})))))}),[y,null==E||null===(a=E.attributes)||void 0===a?void 0:a.id,m,v]),j=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,{color:"danger",onClick:h,iconType:"trash"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.editSavedQuery.deleteSavedQueryButtonLabel",defaultMessage:"Delete query"}))),[h]),q=Object(n.useCallback)((async e=>{await b.mutateAsync(e)}),[b]);return p?null:i.a.createElement(S,{leftColumn:O,rightColumn:v?void 0:j,rightColumnGrow:!1},!p&&!Object(Ce.isEmpty)(E)&&i.a.createElement(Se,{defaultValue:null==E?void 0:E.attributes,handleSubmit:q,viewMode:v}),s?i.a.createElement(l.EuiConfirmModal,{title:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.title",defaultMessage:"Are you sure you want to delete this query?"}),onCancel:f,onConfirm:x,cancelButtonText:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.confirmButtonLabel",defaultMessage:"Confirm"}),buttonColor:"danger",defaultFocusedButton:"confirm"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.deleteSavedQuery.confirmationModal.body",defaultMessage:"You're about to delete this query. Are you sure you want to do this?"})):null)},_e=i.a.memo(we),Pe=()=>{const e=Object(_.e)().services.application.capabilities.osquery;Q("saved_queries");const t=Object(o.useRouteMatch)();return e.readSavedQueries?i.a.createElement(o.Switch,null,i.a.createElement(o.Route,{path:`${t.url}/new`},e.writeSavedQueries?i.a.createElement(Me,null):i.a.createElement(ne.a,null)),i.a.createElement(o.Route,{path:`${t.url}/:savedQueryId`},i.a.createElement(_e,null)),i.a.createElement(o.Route,{path:`${t.url}`},i.a.createElement(ve,null))):i.a.createElement(ne.a,null)},Le=i.a.memo(Pe);var Qe=a(88);const Ne=({onConfirm:e,onCancel:t,agentCount:a,agentPolicyCount:r})=>i.a.createElement(l.EuiConfirmModal,{title:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalTitle",defaultMessage:"Save and deploy changes"}),onCancel:t,onConfirm:e,cancelButtonText:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalCancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalConfirmButtonLabel",defaultMessage:"Save and deploy changes"}),buttonColor:"primary"},i.a.createElement(l.EuiCallOut,{iconType:"iInCircle",title:I.i18n.translate("xpack.osquery.agentPolicy.confirmModalCalloutTitle",{defaultMessage:"This action will update {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:a}})},i.a.createElement("div",{className:"eui-textBreakWord"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalCalloutDescription",defaultMessage:"Fleet has detected that the selected {agentPolicyCount, plural, one {agent policy} other {agent policies}}, is already in use by some of your agents. As a result of this action, Fleet will deploy updates to all agents that use this {agentPolicyCount, plural, one {agent policy} other {agent policies}}.",values:{agentPolicyCount:r}}))),i.a.createElement(l.EuiSpacer,{size:"l"}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.agentPolicy.confirmModalDescription",defaultMessage:"Are you sure you wish to continue?"})),Ae=i.a.memo(Ne);var Be=a(56),ze=a(7),De=a(60);const Re=({withRedirect:e,options:t})=>{const a=Object(p.useQueryClient)(),{application:{navigateToApp:l},http:r,notifications:{toasts:n}}=Object(_.e)().services,i=Object(Be.a)();return Object(p.useMutation)((({id:e,...t})=>r.put(`/api/osquery/packs/${e}`,{body:JSON.stringify(t)})),{onError:e=>{var t,a;i(e,{title:null==e||null===(t=e.body)||void 0===t?void 0:t.error,toastMessage:null==e||null===(a=e.body)||void 0===a?void 0:a.message})},onSuccess:t=>{var r,i,s;a.invalidateQueries([De.a]),e&&l(ze.PLUGIN_ID,{path:w.a.packs()}),n.addSuccess(I.i18n.translate("xpack.osquery.updatePack.successToastMessageText",{defaultMessage:'Successfully updated "{packName}" pack',values:{packName:null!==(r=null==t||null===(i=t.data)||void 0===i||null===(s=i.attributes)||void 0===s?void 0:s.name)&&void 0!==r?r:""}}))},...t})},Ge=m()(l.EuiLoadingSpinner).withConfig({displayName:"StyledEuiLoadingSpinner",componentId:"sc-12idgjh-0"})(["margin-right:",";"],(({theme:e})=>e.eui.euiSizeS)),$e=({item:e})=>{const t=Object(p.useQueryClient)(),{application:{capabilities:{osquery:a}},notifications:{toasts:r}}=Object(_.e)().services,s=Object(Be.a)(),[u,o]=Object(n.useState)(!1),c=Object(n.useCallback)((()=>o(!1)),[]),{data:d}=Object(Qe.a)(),m=Object(n.useMemo)((()=>e.policy_ids.reduce(((e,t)=>{var a;return e+((null==d||null===(a=d.agentPoliciesById[t])||void 0===a?void 0:a.agents)||0)}),0)),[null==d?void 0:d.agentPoliciesById,e.policy_ids]),{isLoading:E,mutateAsync:b}=Re({options:{onSuccess:e=>{var a,l,n;t.invalidateQueries([De.a]),s(),r.addSuccess(null!=e&&null!==(a=e.data)&&void 0!==a&&a.attributes.enabled?I.i18n.translate("xpack.osquery.pack.table.activatedSuccessToastMessageText",{defaultMessage:'Successfully activated "{packName}" pack',values:{packName:null==e||null===(l=e.data)||void 0===l?void 0:l.attributes.name}}):I.i18n.translate("xpack.osquery.pack.table.deactivatedSuccessToastMessageText",{defaultMessage:'Successfully deactivated "{packName}" pack',values:{packName:null==e||null===(n=e.data)||void 0===n?void 0:n.attributes.name}}))}}}),g=Object(n.useCallback)((()=>{b({id:e.id,enabled:!e.attributes.enabled}),c()}),[c,e,b]),y=Object(n.useCallback)((()=>{if(m)return o(!0);g()}),[m,g]);return i.a.createElement(i.a.Fragment,null,E&&i.a.createElement(Ge,null),i.a.createElement(l.EuiSwitch,{checked:!!e.attributes.enabled,disabled:!a.writePacks||E,showLabel:!1,label:"",onChange:y}),u&&m&&i.a.createElement(Ae,{onConfirm:g,onCancel:c,agentCount:m,agentPolicyCount:e.policy_ids.length}))},Ve=i.a.memo($e);var Ue=a(45),We=a(43),He=a(89);const Ye=m()(l.EuiLink).withConfig({displayName:"StyledEuiLink",componentId:"sc-n9jy5t-0"})(["white-space:nowrap;text-overflow:ellipsis;overflow:hidden;"]),Ke=({policyId:e})=>{var t;const{application:{getUrlForApp:a,navigateToApp:l}}=Object(_.e)().services,{data:r}=Object(He.a)({policyId:e}),s=Object(n.useMemo)((()=>a(Ue.PLUGIN_ID,{path:We.pagePathGetters.policy_details({policyId:e})[1]})),[a,e]),u=Object(n.useCallback)((t=>{if(!Object(_.d)(t)&&Object(_.c)(t))return t.preventDefault(),l(Ue.PLUGIN_ID,{path:We.pagePathGetters.policy_details({policyId:e})[1]})}),[l,e]);return i.a.createElement(Ye,{href:s,onClick:u},null!==(t=null==r?void 0:r.name)&&void 0!==t?t:e)},Je=i.a.memo(Ke),Xe=m.a.span.withConfig({displayName:"UpdatedBy",componentId:"sc-mndcml-0"})(["white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"]),Ze=[],et=({id:e,name:t})=>i.a.createElement(l.EuiLink,Object(_.f)(`packs/${e}`),t),tt=i.a.memo(et),at=(e,t)=>i.a.createElement(tt,{id:t.id,name:t.attributes.name}),lt=({agentPolicyIds:e=[]})=>{const[t,a]=Object(n.useState)(!1),r=Object(n.useCallback)((()=>a((e=>!e))),[]),s=Object(n.useCallback)((()=>a(!1)),[]),u=Object(n.useMemo)((()=>{var t;return i.a.createElement(l.EuiButtonEmpty,{size:"s",flush:"both",onClick:r},i.a.createElement(i.a.Fragment,null,null!==(t=null==e?void 0:e.length)&&void 0!==t?t:0))}),[null==e?void 0:e.length,r]);var o;return null!=e&&e.length?i.a.createElement(l.EuiPopover,{button:u,isOpen:t,closePopover:s},i.a.createElement(l.EuiText,{size:"s"},null==e?void 0:e.map((e=>i.a.createElement("div",{key:e},i.a.createElement(Je,{policyId:e})))))):i.a.createElement(i.a.Fragment,null,null!==(o=null==e?void 0:e.length)&&void 0!==o?o:0)},rt=()=>{var e;const t=Object(_.e)().services.application.capabilities.osquery,{push:a}=Object(o.useHistory)(),{data:r,isLoading:s}=Object(D.a)({}),u=Object(n.useCallback)((e=>i.a.createElement(lt,{agentPolicyIds:e})),[]),c=Object(n.useCallback)((e=>{var t;return i.a.createElement(i.a.Fragment,null,null!==(t=e&&Object.keys(e).length)&&void 0!==t?t:0)}),[]),d=Object(n.useCallback)(((e,t)=>i.a.createElement(Ve,{item:t})),[]),m=Object(n.useCallback)(((e,t)=>{if(!e)return"-";const a=t.attributes.updated_by!==t.attributes.created_by?` @ ${t.attributes.updated_by}`:"";return e?i.a.createElement(l.EuiToolTip,{content:`${oe()(e).fromNow()}${a}`},i.a.createElement(Xe,null,`${oe()(e).fromNow()}${a}`)):"-"}),[]),p=Object(n.useCallback)((e=>()=>a("/live_queries/new",{form:{packId:e.id}})),[a]),E=Object(n.useCallback)(((e,t)=>{const a=I.i18n.translate("xpack.osquery.packs.table.runActionAriaLabel",{defaultMessage:"Run {packName}",values:{packName:e.attributes.name}});return i.a.createElement(l.EuiToolTip,{position:"top",content:a},i.a.createElement(l.EuiButtonIcon,{iconType:"play",onClick:p(e),isDisabled:!t}))}),[p]),b=Object(n.useMemo)((()=>[{field:"attributes.name",name:I.i18n.translate("xpack.osquery.packs.table.nameColumnTitle",{defaultMessage:"Name"}),sortable:e=>e.attributes.name.toLowerCase(),render:at},{field:"policy_ids",name:I.i18n.translate("xpack.osquery.packs.table.policyColumnTitle",{defaultMessage:"Scheduled policies"}),truncateText:!0,render:u},{field:"attributes.queries",name:I.i18n.translate("xpack.osquery.packs.table.numberOfQueriesColumnTitle",{defaultMessage:"Number of queries"}),render:c,width:"150px"},{field:"attributes.created_by",name:I.i18n.translate("xpack.osquery.packs.table.createdByColumnTitle",{defaultMessage:"Created by"}),sortable:!0,truncateText:!0},{field:"attributes.updated_at",name:"Last updated",sortable:e=>e.updated_at?Date.parse(e.updated_at):0,truncateText:!0,render:m},{field:"attributes.enabled",name:I.i18n.translate("xpack.osquery.packs.table.activeColumnTitle",{defaultMessage:"Active"}),sortable:!0,align:"right",width:"80px",render:d},{name:I.i18n.translate("xpack.osquery.pack.queriesTable.actionsColumnTitle",{defaultMessage:"Actions"}),width:"80px",actions:[{render:E,enabled:()=>t.writeLiveQueries||t.runSavedQueries}]}]),[t.runSavedQueries,t.writeLiveQueries,d,u,E,c,m]),g=Object(n.useMemo)((()=>({sort:{field:"attributes.name",direction:"asc"}})),[]);return s?i.a.createElement(l.EuiLoadingContent,{lines:10}):i.a.createElement(l.EuiInMemoryTable,{items:null!==(e=null==r?void 0:r.data)&&void 0!==e?e:Ze,columns:b,pagination:!0,sorting:g})},nt=i.a.memo(rt),it=({fill:e=!0})=>{const t=Object(_.e)().services.application.capabilities.osquery,a=Object(_.f)("packs/add");return i.a.createElement(l.EuiButton,k()({fill:!!e},a,{iconType:"plusInCircle",isDisabled:!t.writePacks}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.packList.addPackButtonLabel",defaultMessage:"Add pack"}))},st=i.a.memo(it),ut="integrationAssetsStatus",ot=()=>{const{http:e}=Object(_.e)().services;return Object(p.useQuery)([ut],(()=>e.get("/internal/osquery/assets")),{keepPreviousData:!0,retry:!1})},ct=I.i18n.translate("xpack.osquery.packList.prePackagedPacks.emptyPromptTitle",{defaultMessage:"Load Elastic prebuilt packs"}),dt=I.i18n.translate("xpack.osquery.packList.prePackagedPacks.loadButtonLabel",{defaultMessage:"Load Elastic prebuilt packs"}),mt=I.i18n.translate("xpack.osquery.packList.prePackagedPacks.updateButtonLabel",{defaultMessage:"Update Elastic prebuilt packs"}),pt=I.i18n.translate("xpack.osquery.packList.integrationAssets.loadSuccessToastMessageText",{defaultMessage:"Successfully loaded prebuilt packs"}),Et=I.i18n.translate("xpack.osquery.packList.integrationAssets.updateSuccessToastMessageText",{defaultMessage:"Successfully updated prebuilt packs"}),bt=I.i18n.translate("xpack.osquery.packList.prePackagedPacks.emptyPromptTitle.emptyPromptMessage",{defaultMessage:"A pack is a set of queries that you can schedule. Load prebuilt packs or create your own."}),gt=({fill:e})=>{var t;const{data:a}=ot(),{isLoading:r,mutateAsync:s}=(({successToastText:e})=>{const t=Object(p.useQueryClient)(),{http:a,notifications:{toasts:l}}=Object(_.e)().services,r=Object(Be.a)();return Object(p.useMutation)((()=>a.post("/internal/osquery/assets/update")),{onSuccess:()=>{r(),t.invalidateQueries([De.a]),t.invalidateQueries([ut]),l.addSuccess(e)},onError:e=>{r(e)}})})({successToastText:null!=a&&null!==(t=a.upToDate)&&void 0!==t&&t.length?Et:pt}),u=Object(n.useCallback)((()=>s()),[s]);var o;return null!=a&&a.install.length||null!=a&&a.update.length?i.a.createElement(l.EuiButton,{fill:!!e,isLoading:r,onClick:u,iconType:"plusInCircle"},null!=a&&null!==(o=a.upToDate)&&void 0!==o&&o.length?mt:dt):null},yt=i.a.memo(gt);var vt=a(22);const ft=()=>{const e=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(yt,{fill:!0})),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(st,{fill:!1})))),[]);return i.a.createElement(l.EuiEmptyPrompt,{icon:i.a.createElement(vt.a,null),color:"transparent",title:i.a.createElement("h2",null,ct),body:i.a.createElement("p",null,bt),actions:e})},kt=i.a.memo(ft),ht=()=>{var e;const{data:t,isLoading:a}=ot(),{data:r,isLoading:s}=Object(D.a)({}),u=Object(n.useMemo)((()=>{var e;return!(null!=r&&r.total)&&(null==t||null===(e=t.install)||void 0===e?void 0:e.length)}),[null==t||null===(e=t.install)||void 0===e?void 0:e.length,null==r?void 0:r.total]),o=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.packList.pageTitle",defaultMessage:"Packs"})))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,{color:"subdued"},i.a.createElement("p",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.packList.pageSubtitle",defaultMessage:"Create packs to organize sets of queries and to schedule queries for agent policies."})))))),[]),d=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{direction:"row",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(yt,{fill:!!u})),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(st,{fill:!u})))),[u]),m=Object(n.useMemo)((()=>a||s?i.a.createElement(l.EuiLoadingContent,{lines:10}):u?i.a.createElement(kt,null):i.a.createElement(nt,null)),[a,s,u]);return i.a.createElement(S,{leftColumn:o,rightColumn:d,rightColumnGrow:!1},m)},xt=i.a.memo(ht);var Ot=a(70),jt=a(77);const qt=({index:e,control:t,hideLabel:a,options:r})=>{const{data:{agentPoliciesById:s}={}}=Object(Ot.a)(),u=Object(n.useCallback)((e=>e?void 0:I.i18n.translate("xpack.osquery.pack.form.shardsPolicyFieldMissingErrorMessage",{defaultMessage:"Policy is a required field"})),[]),{field:{onChange:o,value:c},fieldState:{error:d}}=Object(fe.useController)({control:t,name:`shardsArray.${e}.policy`,rules:{validate:u}}),m=Object(n.useMemo)((()=>!(null==d||!d.message)),[null==d?void 0:d.message]),[p,E]=Object(n.useState)([]),b=Object(n.useCallback)((e=>{E(e),o(e[0])}),[o]);Object(n.useEffect)((()=>{const e=null==s?void 0:s[c.key];c&&e&&E([{label:c.label||e.name,value:c.key}])}),[s,c]);const g=Object(n.useMemo)((()=>({asPlainText:!0})),[]);return i.a.createElement(l.EuiFormRow,{label:a?"":I.i18n.translate("xpack.osquery.pack.form.policyFieldLabel",{defaultMessage:"Policy"}),error:null==d?void 0:d.message,isInvalid:m,fullWidth:!0},i.a.createElement(l.EuiComboBox,{fullWidth:!0,singleSelection:g,isInvalid:m,options:r,selectedOptions:p,onChange:b,"data-test-subj":"shards-field-policy",rowHeight:32,isClearable:!0}))},Mt=i.a.memo(qt),Ct=({index:e,control:t,euiFieldProps:a,hideLabel:r})=>{const{field:{onChange:s,value:u},fieldState:{error:o}}=Object(fe.useController)({control:t,name:`shardsArray.${e}.percentage`,defaultValue:100}),c=Object(n.useCallback)((e=>{const t=e.target.valueAsNumber?e.target.valueAsNumber:0;s(t)}),[s]),d=Object(n.useMemo)((()=>!(null==o||!o.message)),[null==o?void 0:o.message]);return i.a.createElement(l.EuiFormRow,{label:r?"":I.i18n.translate("xpack.osquery.pack.form.percentageFieldLabel",{defaultMessage:"Shard"}),error:null==o?void 0:o.message,isInvalid:d,fullWidth:!0},i.a.createElement(l.EuiFlexGroup,{gutterSize:"s"},i.a.createElement(l.EuiFlexItem,{grow:10},i.a.createElement(l.EuiRange,k()({"data-test-subj":"shards-field-percentage",id:"shardsPercentage"+e,min:0,max:100,step:1,value:u,fullWidth:!0,showInput:!0,showLabels:!1,append:"%",onChange:c},a)))))},Ft=i.a.memo(Ct);var St=a(63);const It=m.a.div.withConfig({displayName:"StyledButtonWrapper",componentId:"sc-12l3y72-0"})(["margin-top:",";"],(e=>0===e.index&&"16px")),Tt=({onDelete:e,index:t,isLastItem:a,control:r,options:s})=>{const u=Object(n.useCallback)((()=>{e&&e(t)}),[t,e]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiFlexGroup,{"data-test-subj":`packShardsForm-${t}`,alignItems:"flexStart",gutterSize:"s"},i.a.createElement(_t,null,i.a.createElement(Mt,{index:t,control:r,hideLabel:0!==t,options:s})),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},i.a.createElement(l.EuiFlexItem,{grow:!0},i.a.createElement(Ft,{index:t,control:r,hideLabel:0!==t})),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(It,{index:t},i.a.createElement(l.EuiButtonIcon,{"aria-label":I.i18n.translate("xpack.osquery.pack.form.deleteShardsRowButtonAriaLabel",{defaultMessage:"Delete shards row"}),iconType:"trash",color:"text",disabled:a,onClick:u})))))),i.a.createElement(l.EuiSpacer,{size:"s"}))},wt=i.a.memo(Tt);var _t=m()(l.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-12l3y72-1"})(["",""],St.a);const Pt={policy:{label:"",key:""},percentage:100},Lt=({options:e})=>{const{watch:t,register:a,setValue:r,formState:{errors:s}}=Object(fe.useFormContext)(),{data:{agentPoliciesById:u}={}}=Object(Ot.a)(),o=t("shards"),c=Object(n.useMemo)((()=>{const e=Object(jt.c)(o,u);return Object(N.isEmpty)(e)?[Pt]:e[e.length-1].policy.key?[...e,Pt]:e}),[u,o]),{control:d,watch:m,getFieldState:p,formState:E,resetField:b,setValue:g}=Object(fe.useForm)({mode:"all",shouldUnregister:!0,defaultValues:{shardsArray:c}}),{fields:y,remove:v,append:f}=Object(fe.useFieldArray)({control:d,name:"shardsArray"}),k=m(),h=p("shardsArray",E);return Object(n.useEffect)((()=>{a("shards",{validate:()=>!Object(N.reject)(h.error,N.isEmpty).length})}),[h.error,s,a]),Object(n.useEffect)((()=>{const e=m(((e,t)=>{if(null!=e&&e.shardsArray){var a,l;const n=(null==e||null===(a=e.shardsArray)||void 0===a?void 0:a.length)-1;if(null!==(l=t.name)&&void 0!==l&&l.startsWith(`shardsArray.${n}.`)){var r;const t=Object(N.last)(e.shardsArray);null!=t&&null!==(r=t.policy)&&void 0!==r&&r.key&&f(Pt)}}}));return()=>e.unsubscribe()}),[k,f,m]),Object(n.useEffect)((()=>{const e=Object(jt.d)(k.shardsArray);h.isDirty&&!de()(e,o)&&r("shards",e,{shouldTouch:!0})}),[r,k,h.isDirty,o,b,g]),i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiSpacer,{size:"s"}),y.map(((t,a,r)=>i.a.createElement(l.EuiFlexItem,{key:t.id},i.a.createElement(wt,{index:a,onDelete:v,isLastItem:a===r.length-1,control:d,options:e}),i.a.createElement(l.EuiSpacer,{size:"xs"})))))},Qt=i.a.memo(Lt),Nt=m()(l.EuiFlexItem).withConfig({displayName:"AgentPolicyNameColumn",componentId:"sc-1xn7fsq-0"})(["max-width:",";overflow:hidden;"],(e=>e.grow/9*100+"%")),At=m()(l.EuiFlexItem).withConfig({displayName:"AgentPolicyDescriptionColumn",componentId:"sc-1xn7fsq-1"})(["max-width:",";overflow:hidden;"],(e=>e.grow/9*100+"%")),Bt=({euiFieldProps:e,options:t})=>{const{data:{agentPoliciesById:a}={}}=Object(Ot.a)(),{field:{onChange:r,value:s},fieldState:{error:u}}=Object(fe.useController)({name:"policy_ids",defaultValue:[],rules:{}}),o=Object(n.useMemo)((()=>a?Object(N.castArray)(s).map((e=>{var t,l;return{key:e,label:null!==(t=null===(l=a[e])||void 0===l?void 0:l.name)&&void 0!==t?t:e}})):[]),[a,s]),d=Object(n.useCallback)((e=>{r(e.map((e=>e.key||e.label)))}),[r]),m=Object(n.useCallback)((e=>{var t,r,n,s,u;return i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(Nt,{grow:2},i.a.createElement("span",{className:"eui-textTruncate"},null!==(t=e.key&&(null==a||null===(r=a[e.key])||void 0===r?void 0:r.name))&&void 0!==t?t:e.label)),i.a.createElement(At,{grow:5},i.a.createElement(l.EuiTextColor,{className:"eui-textTruncate",color:"subdued"},null!==(n=e.key&&(null==a?void 0:a[e.key].description))&&void 0!==n?n:"")),i.a.createElement(l.EuiFlexItem,{grow:2,className:"eui-textRight"},i.a.createElement(l.EuiTextColor,{color:"subdued"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.createScheduledQuery.agentPolicyAgentsCountText",defaultMessage:"{count, plural, one {# agent} other {# agents}} enrolled",values:{count:null!==(s=e.key&&(null==a||null===(u=a[e.key])||void 0===u?void 0:u.agents))&&void 0!==s?s:0}}))))}),[a]),p=Object(n.useMemo)((()=>{if(null==s||!s.length||!s[0].length||!a)return i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.pack.form.agentPoliciesFieldHelpText",defaultMessage:"Queries in this pack are scheduled for agents in the selected policies."});const e=Object(N.reduce)(s,((e,t)=>{var l;const r=a&&a[t];return e+(null!==(l=null==r?void 0:r.agents)&&void 0!==l?l:0)}),0);return i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.createScheduledQuery.agentPolicyAgentsCountText",defaultMessage:"{count, plural, one {# agent} other {# agents}} enrolled",values:{count:e}})}),[a,s]),E=Object(n.useMemo)((()=>!(null==u||!u.message)),[null==u?void 0:u.message]);return i.a.createElement(l.EuiFormRow,{label:I.i18n.translate("xpack.osquery.pack.form.agentPoliciesFieldLabel",{defaultMessage:"Scheduled agent policies (optional)"}),helpText:p,error:null==u?void 0:u.message,isInvalid:E,fullWidth:!0},i.a.createElement(l.EuiComboBox,k()({isInvalid:E,selectedOptions:o,fullWidth:!0,"data-test-subj":"policyIdsComboBox",isClearable:!0,options:t,renderOption:m,onChange:d},e)))},zt=i.a.memo(Bt,de.a);var Dt=a(69),Rt=a(105),Gt=a(103);const $t=({platform:e})=>{const[t,a]=Object(n.useState)(Rt.a);Object(n.useEffect)((()=>{a((t=>{if(e){let a;try{a=null==e?void 0:e.split(",").map((e=>e.trim()))}catch(e){return t}return a}return Rt.a}))}),[e]);const r=Object(n.useMemo)((()=>t.map((e=>i.a.createElement(l.EuiFlexItem,{key:e,grow:!1},i.a.createElement(Gt.a,{platform:e}))))),[t]);return i.a.createElement(l.EuiFlexGroup,{gutterSize:"s"},r)},Vt=i.a.memo($t),Ut=({data:e,isReadOnly:t,onDeleteClick:a,onEditClick:r,selectedItems:s,setSelectedItems:u})=>{const o=Object(n.useCallback)((e=>i.a.createElement(l.EuiButtonIcon,{color:"danger",onClick:()=>a&&a(e),iconType:"trash","aria-label":I.i18n.translate("xpack.osquery.pack.queriesTable.deleteActionAriaLabel",{defaultMessage:"Delete {queryName}",values:{queryName:e.id}})})),[a]),c=Object(n.useCallback)((e=>i.a.createElement(l.EuiButtonIcon,{color:"primary",onClick:()=>r&&r(e),iconType:"pencil","aria-label":I.i18n.translate("xpack.osquery.pack.queriesTable.editActionAriaLabel",{defaultMessage:"Edit {queryName}",values:{queryName:e.id}})})),[r]),d=Object(n.useCallback)((e=>i.a.createElement(l.EuiCodeBlock,{language:"sql",fontSize:"s",paddingSize:"none",transparentBackground:!0},e)),[]),m=Object(n.useCallback)((e=>i.a.createElement(Vt,{platform:e})),[]),p=Object(n.useCallback)((e=>e?`${e}`:I.i18n.translate("xpack.osquery.pack.queriesTable.osqueryVersionAllLabel",{defaultMessage:"ALL"})),[]),E=Object(n.useMemo)((()=>[{field:"id",name:I.i18n.translate("xpack.osquery.pack.queriesTable.idColumnTitle",{defaultMessage:"ID"}),width:"20%"},{field:"interval",name:I.i18n.translate("xpack.osquery.pack.queriesTable.intervalColumnTitle",{defaultMessage:"Interval (s)"}),width:"100px"},{field:"query",name:I.i18n.translate("xpack.osquery.pack.queriesTable.queryColumnTitle",{defaultMessage:"Query"}),render:d},{field:"platform",name:I.i18n.translate("xpack.osquery.pack.queriesTable.platformColumnTitle",{defaultMessage:"Platform"}),render:m},{field:"version",name:I.i18n.translate("xpack.osquery.pack.queriesTable.versionColumnTitle",{defaultMessage:"Min Osquery version"}),render:p},...t?[]:[{name:I.i18n.translate("xpack.osquery.pack.queriesTable.actionsColumnTitle",{defaultMessage:"Actions"}),width:"120px",actions:[{render:c},{render:o}]}]]),[t,o,c,m,d,p]),b=Object(n.useMemo)((()=>({sort:{field:"id",direction:"asc"}})),[]),g=Object(n.useCallback)((e=>{var t;return null!==(t=e.id)&&void 0!==t?t:""}),[]),y=Object(n.useMemo)((()=>({onSelectionChange:u,initialSelected:s})),[s,u]);return i.a.createElement(l.EuiBasicTable,k()({items:e,itemId:g,columns:E,sorting:b},t?{}:{selection:y,isSelectable:!0}))},Wt=i.a.memo(Ut);var Ht=a(120),Yt=a(108),Kt=a(102),Jt=a(107);const Xt=e=>Object(Dt.produce)(e,(e=>(Object(N.isArray)(e.platform)&&(e.platform.length?e.platform.join(","):delete e.platform),Object(N.isArray)(e.version)&&(e.version.length?e.version=e.version[0]:delete e.version),e.interval&&(e.interval=e.interval+""),Object(N.isEmpty)(e.ecs_mapping)&&delete e.ecs_mapping,e)));var Zt=a(115),ea=a(86);const ta=({uniqueQueryIds:e,defaultValue:t,onSave:a,onClose:r})=>{const s=Object(_.e)().services.application.capabilities.osquery,[u]=Object(n.useState)(!!t),{serializer:o,idSet:d,...m}=(({uniqueQueryIds:e,defaultValue:t})=>{const a=Object(n.useMemo)((()=>new Set(Object(N.xor)(e,null!=t&&t.id?[t.id]:[]))),[e,t]);return{serializer:Xt,idSet:a,...Object(fe.useForm)({defaultValues:t?(l=t,{id:l.id,query:l.query,interval:l.interval?parseInt(l.interval,10):3600,snapshot:l.snapshot,removed:l.removed,platform:l.platform,version:l.version?[l.version]:[],ecs_mapping:null!==(r=l.ecs_mapping)&&void 0!==r?r:{}}):{id:"",query:"",interval:3600,snapshot:!0,removed:!1}})};var l,r})({uniqueQueryIds:e,defaultValue:t}),{handleSubmit:p,formState:{isSubmitting:E},resetField:b}=m,g=Object(n.useCallback)((e=>{var t,a;e&&(b("id",{defaultValue:e.id}),b("query",{defaultValue:e.query}),b("platform",{defaultValue:e.platform?e.platform:T.c}),b("version",{defaultValue:e.version?[e.version]:[]}),b("interval",{defaultValue:e.interval?e.interval:3600}),b("snapshot",{defaultValue:null===(t=e.snapshot)||void 0===t||t}),b("removed",{defaultValue:e.removed}),b("ecs_mapping",{defaultValue:null!==(a=e.ecs_mapping)&&void 0!==a?a:{}}))}),[b]);return i.a.createElement(l.EuiFlyout,{size:"m",onClose:r,"aria-labelledby":"flyoutTitle",ownFocus:!0,outsideClickCloses:!1},i.a.createElement(l.EuiFlyoutHeader,{hasBorder:!0},i.a.createElement(l.EuiTitle,{size:"s"},i.a.createElement("h2",{id:"flyoutTitle"},u?i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.editFormTitle",defaultMessage:"Edit query"}):i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.addFormTitle",defaultMessage:"Attach next query"})))),i.a.createElement(l.EuiFlyoutBody,null,i.a.createElement(fe.FormProvider,m,!u&&s.readSavedQueries?i.a.createElement(i.a.Fragment,null,i.a.createElement(Zt.a,{onChange:g}),i.a.createElement(l.EuiSpacer,null)):null,i.a.createElement(Ht.c,{idSet:d}),i.a.createElement(l.EuiSpacer,null),i.a.createElement(Yt.a,null),i.a.createElement(l.EuiSpacer,null),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(Ht.a,{euiFieldProps:{append:"s"}}),i.a.createElement(l.EuiSpacer,null),i.a.createElement(Ht.e,{euiFieldProps:{noSuggestions:!1,singleSelection:{asPlainText:!0},placeholder:I.i18n.translate("xpack.osquery.queriesTable.osqueryVersionAllLabel",{defaultMessage:"ALL"}),options:Jt.a,onCreateOption:void 0}}),i.a.createElement(l.EuiSpacer,null),i.a.createElement(Ht.d,null)),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(Kt.a,null))),i.a.createElement(l.EuiSpacer,null),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(la,null,i.a.createElement(ea.a,null))))),i.a.createElement(l.EuiFlyoutFooter,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"spaceBetween"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,{iconType:"cross",onClick:r,flush:"left"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:E,onClick:p((async e=>{const t=o(e);await a(t),r()})),fill:!0},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.saveButtonLabel",defaultMessage:"Save"}))))))},aa=i.a.memo(ta);var la=m()(l.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1llr979-0"})(["",""],St.a);const ra=["application/json","text/plain"],na=i.a.memo((()=>i.a.createElement(l.EuiLink,{href:"https://github.com/osquery/osquery/tree/master/packs",target:"_blank"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.packUploader.examplePacksLinkLabel",defaultMessage:"Example packs"}))));na.displayName="ExamplePackLink";const ia=({onChange:e})=>{const t=Object(n.useRef)(""),a=Object(n.useRef)(null),[r,s]=Object(n.useState)(null);let u;const o=()=>{var l,r;const n=u.result;let i;try{i=JSON.parse(n.replaceAll("\\\n",""),((e,t)=>"query"===e?t.replaceAll(/\s(?=\s)/gm,""):"interval"===e?`${t}`:t)),s(null)}catch(e){var o;s(e),null===(o=a.current)||void 0===o||o.removeFiles(new Event("fake"))}null!==(l=i)&&void 0!==l&&l.queries&&(e(i,t.current),null===(r=a.current)||void 0===r||r.removeFiles(new Event("fake")))},c=e=>{u=new FileReader,u.onloadend=o,u.readAsText(e)},d=Object(n.useCallback)((e=>{var l;if(e.length){var r;if(e.length&&(null!==(l=!!e[0].type.length&&!ra.includes(e[0].type))&&void 0!==l?l:!e[0].name.endsWith(".conf")))return t.current="",s(I.i18n.translate("xpack.osquery.packUploader.unsupportedFileTypeText",{defaultMessage:"File type {fileType} is not supported, please upload {supportedFileTypes} config file",values:{fileType:e[0].type,supportedFileTypes:ra.join(" or ")}})),void(null===(r=a.current)||void 0===r||r.removeFiles(new Event("fake")));t.current=Object(N.kebabCase)(e[0].name.split(".")[0]),c(e[0])}else t.current=""}),[c]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiSpacer,{size:"xl"}),i.a.createElement(l.EuiFormRow,{fullWidth:!0,labelAppend:i.a.createElement(na,null),isInvalid:!!r,error:i.a.createElement(i.a.Fragment,null,`${r}`)},i.a.createElement(l.EuiFilePicker,{ref:a,id:"osquery_pack_picker",initialPromptText:I.i18n.translate("xpack.osquery.packUploader.initialPromptTextLabel",{defaultMessage:"Select or drag and drop osquery pack config file"}),onChange:d,display:"large",fullWidth:!0,isInvalid:!!r,accept:ra.join(",")})))},sa=i.a.memo(ia);var ua=a(104);const oa=({euiFieldProps:e})=>{const{field:{value:t}}=Object(fe.useController)({name:"queries",defaultValue:[],rules:{}}),{append:a,remove:r,update:s,replace:u}=Object(fe.useFieldArray)({name:"queries"}),{setValue:o}=Object(fe.useFormContext)(),{name:d}=Object(fe.useWatch)(),m=Object(n.useCallback)((e=>Object(N.isEmpty)(d)&&o("name",e)),[d,o]),p=!(null==e||!e.isDisabled),[E,b]=Object(n.useState)(!1),[g,y]=Object(n.useState)(-1),[v,f]=Object(n.useState)([]),k=Object(n.useCallback)((()=>b(!0)),[]),h=Object(n.useCallback)((()=>b(!1)),[]),x=Object(n.useCallback)((()=>y(-1)),[]),O=Object(n.useCallback)((e=>{const a=Object(N.findIndex)(t,["id",e.id]);a>-1&&r(a)}),[t,r]),j=Object(n.useCallback)((e=>{const a=Object(N.findIndex)(t,["id",e.id]);y(a)}),[t]),q=Object(n.useCallback)((e=>new Promise((t=>{g>=0&&s(g,Object(Dt.produce)({},(t=>{var a,l;return t.id=e.id,t.interval=e.interval,t.query=e.query,null!==(a=e.platform)&&void 0!==a&&a.length&&(t.platform=e.platform),null!==(l=e.version)&&void 0!==l&&l.length&&(t.version=e.version),e.ecs_mapping&&(t.ecs_mapping=e.ecs_mapping),t.snapshot=e.snapshot,t.removed=e.removed,t}))),x(),t()}))),[x,s,g]),M=Object(n.useCallback)((e=>new Promise((t=>{a(e),h(),t()}))),[h,a]),C=Object(n.useCallback)((()=>{const e=Object(N.map)(v,(e=>Object(N.indexOf)(t,e)));r(e),f([])}),[t,r,v]),F=Object(n.useCallback)(((e,t)=>{u(Object(N.map)(e.queries,((t,a)=>{var l,r,n,i,s,u;return Object(N.pickBy)({id:a,interval:null!==(l=null!==(r=t.interval)&&void 0!==r?r:e.interval)&&void 0!==l?l:"3600",query:t.query,version:null!==(n=t.version)&&void 0!==n?n:e.version,snapshot:null!==(i=t.snapshot)&&void 0!==i?i:e.snapshot,removed:null!==(s=t.removed)&&void 0!==s?s:e.removed,platform:Object(ua.b)(null!==(u=t.platform)&&void 0!==u?u:e.platform)},(e=>!Object(N.isEmpty)(e)||!1===e))}))),m(t)}),[m,u]),S=Object(n.useMemo)((()=>null!=t&&t.length?t:[]),[t]),I=Object(n.useMemo)((()=>Object(N.uniq)(Object(N.map)(t,"id"))),[t]);return i.a.createElement(i.a.Fragment,null,!p&&i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},v.length?i.a.createElement(l.EuiButton,{color:"danger",onClick:C,iconType:"trash"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.pack.table.deleteQueriesButtonLabel",defaultMessage:"Delete {queriesCount, plural, one {# query} other {# queries}}",values:{queriesCount:v.length}})):i.a.createElement(l.EuiButton,{fill:!0,onClick:k,iconType:"plusInCircle"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.pack.queriesForm.addQueryButtonLabel",defaultMessage:"Add query"})))),i.a.createElement(l.EuiSpacer,null)),null!=t&&t.length?i.a.createElement(Wt,{data:S,isReadOnly:p,onEditClick:j,onDeleteClick:O,selectedItems:v,setSelectedItems:f}):null,i.a.createElement(l.EuiSpacer,null),!p&&i.a.createElement(sa,{onChange:F}),E&&i.a.createElement(aa,{uniqueQueryIds:I,onSave:M,onClose:h}),null!=g&&g>=0&&i.a.createElement(aa,{uniqueQueryIds:I,defaultValue:t[g],onSave:q,onClose:x}))},ca=i.a.memo(oa,de.a),da=e=>Object(N.reduce)(e,((e,{id:t,...a})=>(e[t]=a,e)),{}),ma=({euiFieldProps:e})=>{const{field:{onChange:t,value:a,name:r},fieldState:{error:s}}=Object(fe.useController)({name:"name",defaultValue:"",rules:{pattern:{value:/^[a-zA-Z0-9-_]+$/,message:I.i18n.translate("xpack.osquery.pack.queryFlyoutForm.invalidIdError",{defaultMessage:"Characters must be alphanumeric, _, or -"})},required:I.i18n.translate("xpack.osquery.pack.form.nameFieldRequiredErrorMessage",{defaultMessage:"Name is a required field"})}}),u=Object(n.useMemo)((()=>!(null==s||!s.message)),[null==s?void 0:s.message]);return i.a.createElement(l.EuiFormRow,{label:I.i18n.translate("xpack.osquery.pack.form.nameFieldLabel",{defaultMessage:"Name"}),error:null==s?void 0:s.message,isInvalid:u,fullWidth:!0},i.a.createElement(l.EuiFieldText,k()({isInvalid:u,onChange:t,value:a,name:r,fullWidth:!0,"data-test-subj":"input"},e)))},pa=i.a.memo(ma),Ea=({euiFieldProps:e})=>{const{field:{onChange:t,value:a,name:r},fieldState:{error:s}}=Object(fe.useController)({name:"description",defaultValue:""}),u=Object(n.useMemo)((()=>!(null==s||!s.message)),[null==s?void 0:s.message]);return i.a.createElement(l.EuiFormRow,{label:I.i18n.translate("xpack.osquery.pack.form.descriptionFieldLabel",{defaultMessage:"Description (optional)"}),error:null==s?void 0:s.message,isInvalid:u,fullWidth:!0},i.a.createElement(l.EuiFieldText,k()({isInvalid:u,onChange:t,value:a,name:r,fullWidth:!0,"data-test-subj":"input"},e)))},ba=i.a.memo(Ea),ga=m()(l.EuiCard).withConfig({displayName:"StyledEuiCard",componentId:"sc-twkhxa-0"})(["padding:16px 92px 16px 16px !important;border:",";.euiTitle{font-size:1rem;}.euiText{margin-top:0;margin-left:25px;color:",";}> button[role='switch']{display:none;}"],(e=>{var t;if(null!==(t=e.selectable)&&void 0!==t&&t.isSelected)return`1px solid ${e.theme.eui.euiColorPrimary}`}),(e=>e.theme.eui.EuiTextSubduedColor)),ya=({packType:e,setPackType:t,resetFormFields:a})=>{const r=Object(n.useCallback)((e=>{t(e),a&&a()}),[a,t]),s=Object(n.useMemo)((()=>({onClick:()=>r("policy"),isSelected:"policy"===e})),[e,r]),u=Object(n.useMemo)((()=>({onClick:()=>r("global"),isSelected:"global"===e})),[e,r]);return i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiFormRow,{label:"Type",fullWidth:!0},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(ga,k()({layout:"horizontal",title:i.a.createElement(l.EuiRadio,{id:"osquery_pack_type_policy",label:I.i18n.translate("xpack.osquery.pack.form.policyLabel",{defaultMessage:"Policy"}),onChange:N.noop,checked:"policy"===e}),titleSize:"xs",hasBorder:!0,description:I.i18n.translate("xpack.osquery.pack.form.policyDescription",{defaultMessage:"Schedule pack for specific policy."}),"data-test-subj":"osqueryPackTypePolicy",selectable:s},"policy"===e&&{color:"primary"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(ga,k()({layout:"horizontal",title:i.a.createElement(l.EuiRadio,{id:"osquery_pack_type_global",label:I.i18n.translate("xpack.osquery.pack.form.globalLabel",{defaultMessage:"Global"}),onChange:N.noop,checked:"global"===e}),titleSize:"xs",description:I.i18n.translate("xpack.osquery.pack.form.globalDescription",{defaultMessage:"Use pack across all policies"}),selectable:u,"data-test-subj":"osqueryPackTypeGlobal"},"global"===e&&{color:"primary"}))))))},va=i.a.memo(ya),fa=m()(l.EuiAccordion).withConfig({displayName:"StyledEuiAccordion",componentId:"sc-uwn7ey-0"})([""," .euiAccordion__button{color:",";}"],(({isDisabled:e})=>e&&"display: none;"),(({theme:e})=>e.eui.euiColorPrimary)),ka=({defaultValue:e,editMode:t=!1,isReadOnly:a=!1})=>{const[r,s]=Object(n.useState)("closed"),u=Object(n.useCallback)((e=>{s(e?"open":"closed")}),[]),[o,d]=Object(n.useState)("policy"),[m,E]=Object(n.useState)(!1),b=Object(n.useCallback)((()=>E(!1)),[]),{data:{agentPoliciesById:g}={}}=Object(Ot.a)(),y=Object(_.f)(`packs/${t?null==e?void 0:e.id:""}`),{mutateAsync:v}=(({withRedirect:e})=>{const t=Object(p.useQueryClient)(),{application:{navigateToApp:a},http:l,notifications:{toasts:r}}=Object(_.e)().services,n=Object(Be.a)();return Object(p.useMutation)((e=>l.post("/api/osquery/packs",{body:JSON.stringify(e)})),{onError:e=>{n(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:l=>{var n,i;t.invalidateQueries([De.a]),e&&a(ze.PLUGIN_ID,{path:w.a.packs()}),r.addSuccess(I.i18n.translate("xpack.osquery.newPack.successToastMessageText",{defaultMessage:'Successfully created "{packName}" pack',values:{packName:null!==(n=null===(i=l.data.attributes)||void 0===i?void 0:i.name)&&void 0!==n?n:""}}))}})})({withRedirect:!0}),{mutateAsync:f}=Re({withRedirect:!0}),h=Object(fe.useForm)({defaultValues:e?(e=>{var t;const a=Object(N.filter)(e.policy_ids,(t=>{var a;return null==(null===(a=e.shards)||void 0===a?void 0:a[t])}));return{...e,policy_ids:null!=a?a:[],queries:(l=e.queries,Object(N.reduce)(l,((e,t,a)=>(e.push({id:a,...Object(N.pick)(t,["query","interval","snapshot","removed","platform","version","ecs_mapping"])}),e)),[])),shards:null!==(t=Object(N.omit)(e.shards,"*"))&&void 0!==t?t:{}};var l})(e):{name:"",description:"",policy_ids:[],enabled:!0,queries:[]}});Object(n.useEffect)((()=>{var t;Object(N.isEmpty)(null==e?void 0:e.shards)||(null!=e&&null!==(t=e.shards)&&void 0!==t&&t["*"]?d("global"):s("open"))}),[e,null==e?void 0:e.shards]);const{handleSubmit:x,watch:O,formState:{isSubmitting:j}}=h,{policy_ids:q,shards:M}=O(),C=Object(n.useCallback)((()=>"global"===o?{"*":100}:Object(N.reduce)(M,((e,t,a)=>Object(N.isEmpty)(a)?e:{...e,[a]:t}),{})),[o,M]),F=Object(n.useCallback)((async a=>{const l=({shards:e,policy_ids:t,queries:a,...l})=>{var r;const n=[...t,...Object(N.isEmpty)(M)?[]:Object(N.filter)(Object(N.map)(M,((e,t)=>{if(!Object(N.isEmpty)(t))return t})))];return{...l,policy_ids:null!=n?n:[],queries:da(a),shards:null!==(r=C())&&void 0!==r?r:{}}};try{t&&null!=e&&e.id?await f({id:null==e?void 0:e.id,...l(a)}):await v(l(a))}catch(e){}}),[v,null==e?void 0:e.id,t,C,M,f]),S=Object(n.useMemo)((()=>x(F)),[x,F]),T=Object(n.useMemo)((()=>Object(N.reduce)(q,((e,t)=>{var a;const l=g&&g[t];return e+(null!==(a=null==l?void 0:l.agents)&&void 0!==a?a:0)}),0)),[q,g]),P=Object(n.useCallback)((()=>{T?E(!0):S()}),[T,S]),L=Object(n.useCallback)((()=>{S(),E(!1)}),[S]),Q=Object(n.useMemo)((()=>({isDisabled:a})),[a]),A=Object(n.useCallback)((e=>{d(e)}),[d]),B=Object(n.useMemo)((()=>Object.entries(null!=g?g:{}).map((([e,t])=>({key:e,label:t.name})))),[g]),z=Object(n.useMemo)((()=>{const e=[...Object(N.map)(M,((e,t)=>t)),...Object(N.map)(q,(e=>e))];return B.filter((({key:t})=>!e.includes(t)))}),[M,q,B]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(fe.FormProvider,h,i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(pa,{euiFieldProps:Q}))),i.a.createElement(l.EuiSpacer,{size:"m"}),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(l.EuiFlexItem,null,i.a.createElement(ba,{euiFieldProps:Q}))),i.a.createElement(l.EuiSpacer,{size:"m"}),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(va,{packType:o,setPackType:A})),i.a.createElement(l.EuiSpacer,{size:"m"}),"policy"===o&&i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(xa,null,i.a.createElement(zt,{options:z}))),i.a.createElement(l.EuiSpacer,{size:"m"}),i.a.createElement(l.EuiFlexGroup,null,i.a.createElement(Oa,null,i.a.createElement(fa,{id:"shardsToggle",forceState:r,onToggle:u,buttonContent:"Partial deployment (shards)"},i.a.createElement(l.EuiSpacer,{size:"xs"}),i.a.createElement(Qt,{options:z})))),i.a.createElement(l.EuiSpacer,{size:"m"})),i.a.createElement(l.EuiSpacer,{size:"xl"}),i.a.createElement(l.EuiHorizontalRule,null),i.a.createElement(ca,{euiFieldProps:Q})),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiSpacer,{size:"xxl"}),i.a.createElement(l.EuiBottomBar,null,i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonEmpty,k()({color:"ghost"},y),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.pack.form.cancelButtonLabel",defaultMessage:"Cancel"}))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButton,{isLoading:j,color:"primary",fill:!0,size:"m",iconType:"save",onClick:P},t?i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.pack.form.updatePackButtonLabel",defaultMessage:"Update pack"}):i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.pack.form.savePackButtonLabel",defaultMessage:"Save pack"}))))))),m&&i.a.createElement(Ae,{onCancel:b,onConfirm:L,agentCount:T,agentPolicyCount:q.length}))},ha=i.a.memo(ka,de.a);var xa=m()(l.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-uwn7ey-1"})(["",""],St.a),Oa=m()(l.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem2",componentId:"sc-uwn7ey-2"})(["",""],St.a);const ja=()=>{Q("pack_add");const e=Object(_.f)("packs"),t=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},e,{flush:"left",size:"xs"}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.addPack.viewPacksListTitle",defaultMessage:"View all packs"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.addPack.pageTitle",defaultMessage:"Add pack"})))))),[e]);return i.a.createElement(S,{leftColumn:t},i.a.createElement(ha,null))},qa=i.a.memo(ja);var Ma=a(78);const Ca=()=>{var e,t;const{packId:a}=Object(o.useParams)(),r=Object(_.f)(`packs/${a}`),[s,u]=Object(n.useState)(!1),{isLoading:d,data:m}=Object(Ma.a)({packId:a}),E=(({packId:e,withRedirect:t})=>{const a=Object(p.useQueryClient)(),{application:{navigateToApp:l},http:r,notifications:{toasts:n}}=Object(_.e)().services,i=Object(Be.a)();return Object(p.useMutation)((()=>r.delete(`/api/osquery/packs/${e}`)),{onError:e=>{i(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:()=>{a.invalidateQueries([De.a]),t&&l(ze.PLUGIN_ID,{path:w.a.packs()}),n.addSuccess(I.i18n.translate("xpack.osquery.deletePack.successToastMessageText",{defaultMessage:"Successfully deleted pack"}))}})})({packId:a,withRedirect:!0}),b=Object(n.useMemo)((()=>!(null==m||!m.read_only)),[m]);Q("pack_edit",{packId:null!==(e=null==m?void 0:m.id)&&void 0!==e?e:"",packName:null!==(t=null==m?void 0:m.name)&&void 0!==t?t:""});const g=Object(n.useCallback)((()=>{u(!1)}),[]),y=Object(n.useCallback)((()=>{u(!0)}),[]),v=Object(n.useCallback)((()=>{E.mutateAsync().then((()=>{g()}))}),[E,g]),f=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},r,{flush:"left",size:"xs"}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.editPack.viewPackListTitle",defaultMessage:"View {queryName} details",values:{queryName:null==m?void 0:m.name}}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.editPack.pageTitle",defaultMessage:"Edit {queryName}",values:{queryName:null==m?void 0:m.name}})))))),[null==m?void 0:m.name,r]),h=Object(n.useMemo)((()=>i.a.createElement(l.EuiButton,{color:"danger",onClick:y,iconType:"trash"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.editPack.deletePackButtonLabel",defaultMessage:"Delete pack"}))),[y]),x=Object(n.useMemo)((()=>b?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.EuiSpacer,null),i.a.createElement(l.EuiCallOut,null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.editPack.prebuiltPackModeDescription",defaultMessage:"This is a prebuilt Elastic pack. You can modify the scheduled agent policies, but you cannot edit queries in the pack."}))):null),[b]);return d?null:i.a.createElement(S,{leftColumn:f,rightColumn:h,rightColumnGrow:!1,headerChildren:x},m?i.a.createElement(ha,{editMode:!0,defaultValue:m,isReadOnly:b}):i.a.createElement(l.EuiLoadingContent,{lines:10}),s?i.a.createElement(l.EuiConfirmModal,{title:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.title",defaultMessage:"Are you sure you want to delete this pack?"}),onCancel:g,onConfirm:v,confirmButtonDisabled:E.isLoading,cancelButtonText:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.confirmButtonLabel",defaultMessage:"Confirm"}),buttonColor:"danger",defaultFocusedButton:"confirm"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.deletePack.confirmationModal.body",defaultMessage:"You're about to delete this pack. Are you sure you want to do this?"})):null)},Fa=i.a.memo(Ca);var Sa=a(124);const Ia=m.a.div.withConfig({displayName:"Divider",componentId:"sc-e3f879-0"})(["width:0;height:100%;border-left:",";"],(({theme:e})=>e.eui.euiBorderThin)),Ta=()=>{var e,t;const a=Object(_.e)().services.application.capabilities.osquery,{packId:r}=Object(o.useParams)(),s=Object(_.f)("packs"),u=Object(_.f)(`packs/${r}/edit`),{data:d}=Object(Ma.a)({packId:r}),{data:m}=(({agentPolicyId:e,silent:t,skip:a})=>{const{http:l}=Object(_.e)().services,r=Object(Be.a)();return Object(p.useQuery)(["agentPolicyAgentIds",e],(()=>{const t=`${Ue.AGENTS_PREFIX}.policy_id:${e}`;return l.get("/internal/osquery/fleet_wrapper/agents",{query:{kuery:t,perPage:1e4}})}),{select:e=>Object(N.map)(null==e?void 0:e.agents,"id")||[],enabled:!a||!e,onSuccess:()=>r(),onError:e=>!t&&r(e,{title:I.i18n.translate("xpack.osquery.agents.fetchError",{defaultMessage:"Error while fetching agents"})}),refetchOnReconnect:!1,refetchOnWindowFocus:!1})})({agentPolicyId:null==d||null===(e=d.policy_ids)||void 0===e?void 0:e[0],skip:!d});Q("pack_details",{packName:null!==(t=null==d?void 0:d.name)&&void 0!==t?t:""});const E=Object(n.useMemo)((()=>{var e;return null!==(e=(null==d?void 0:d.queries)&&Object.entries(d.queries).map((([e,t])=>({...t,id:e}))))&&void 0!==e?e:[]}),[d]),b=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{alignItems:"flexStart",direction:"column",gutterSize:"m"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,k()({iconType:"arrowLeft"},s,{flush:"left",size:"xs"}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.packDetails.viewAllPackListTitle",defaultMessage:"View all packs"}))),i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiText,null,i.a.createElement("h1",null,i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.packDetails.pageTitle",defaultMessage:"{queryName} details",values:{queryName:null==d?void 0:d.name}})))),(null==d?void 0:d.description)&&i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"s"}),i.a.createElement(l.EuiText,{color:"subdued",size:"s"},d.description)))),[null==d?void 0:d.description,null==d?void 0:d.name,s]),g=Object(n.useMemo)((()=>i.a.createElement(l.EuiFlexGroup,{justifyContent:"flexEnd",direction:"row"},i.a.createElement(l.EuiFlexItem,{grow:!1,key:"agents_failed_count"},i.a.createElement(l.EuiDescriptionList,{compressed:!0,textStyle:"reverse",style:{textAlign:"right"}},i.a.createElement(l.EuiDescriptionListTitle,{className:"eui-textNoWrap"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.packDetailsPage.kpis.policiesLabelText",defaultMessage:"Policies"})),i.a.createElement(l.EuiDescriptionListDescription,{className:"eui-textNoWrap"},i.a.createElement(lt,{agentPolicyIds:null==d?void 0:d.policy_ids})))),i.a.createElement(l.EuiFlexItem,{grow:!1,key:"agents_failed_count_divider"},i.a.createElement(Ia,null)),i.a.createElement(l.EuiFlexItem,{grow:!1,key:"edit_button"},i.a.createElement(l.EuiButton,k()({fill:!0},u,{iconType:"pencil",isDisabled:!a.writePacks}),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.packDetailsPage.editQueryButtonLabel",defaultMessage:"Edit"}))))),[null==d?void 0:d.policy_ids,u,a]);return i.a.createElement(S,{leftColumn:b,rightColumn:g,rightColumnGrow:!1},d&&i.a.createElement(Sa.a,{agentIds:m,packName:d.name,data:E}))},wa=i.a.memo(Ta),_a=()=>{const e=Object(_.e)().services.application.capabilities.osquery;Q("packs");const t=Object(o.useRouteMatch)();return e.readPacks?i.a.createElement(o.Switch,null,i.a.createElement(o.Route,{path:`${t.url}/add`},e.writePacks?i.a.createElement(qa,null):i.a.createElement(ne.a,null)),i.a.createElement(o.Route,{path:`${t.url}/:packId/edit`},e.writePacks?i.a.createElement(Fa,null):i.a.createElement(ne.a,null)),i.a.createElement(o.Route,{path:`${t.url}/:packId`},i.a.createElement(wa,null)),i.a.createElement(o.Route,{path:`${t.url}`},i.a.createElement(xt,null))):i.a.createElement(ne.a,null)},Pa=i.a.memo(_a),La=()=>(Q("base"),i.a.createElement(o.Switch,null,i.a.createElement(o.Route,{path:"/packs"},i.a.createElement(Pa,null)),i.a.createElement(o.Route,{path:"/saved_queries"},i.a.createElement(Le,null)),i.a.createElement(o.Route,{path:"/live_queries"},i.a.createElement(se,null)),i.a.createElement(o.Redirect,{to:"/live_queries"}))),Qa=i.a.memo(La);a(47);var Na=a(4);const Aa=()=>{Q("base");const{application:{getUrlForApp:e,navigateToApp:t}}=Object(_.e)().services,a=Object(n.useMemo)((()=>e(Ue.INTEGRATIONS_PLUGIN_ID,{path:We.pagePathGetters.integration_details_overview({pkgkey:ze.OSQUERY_INTEGRATION_NAME})[1]})),[e]),r=Object(n.useCallback)((e=>{if(!Object(_.d)(e)&&Object(_.c)(e))return e.preventDefault(),t(Ue.INTEGRATIONS_PLUGIN_ID,{path:We.pagePathGetters.integration_details_overview({pkgkey:ze.OSQUERY_INTEGRATION_NAME})[1]})}),[t]),s=Object(n.useMemo)((()=>({iconType:vt.a,pageTitle:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.emptyState.pageTitle",defaultMessage:"Add Osquery Manager"}),description:i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.emptyState.pageDescription",defaultMessage:"Add this integration to run and schedule queries for Elastic Agent."}),rightSideItems:[i.a.createElement(l.EuiButton,{key:"button",fill:!0,href:a,onClick:r,iconType:"plusInCircleFilled"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.emptyState.addOsqueryManagerButton",defaultMessage:"Add Osquery Manager"}))]})),[r,a]);return i.a.createElement(Na.KibanaPageTemplate,{isEmptyState:!0,pageHeader:s})},Ba=i.a.memo(Aa),za=()=>{const{application:{getUrlForApp:e,navigateToApp:t}}=Object(_.e)().services,a=Object(n.useMemo)((()=>e(Ue.INTEGRATIONS_PLUGIN_ID,{path:We.pagePathGetters.integration_details_policies({pkgkey:ze.OSQUERY_INTEGRATION_NAME})[1]})),[e]),r=Object(n.useCallback)((e=>{if(!Object(_.d)(e)&&Object(_.c)(e))return e.preventDefault(),t(Ue.INTEGRATIONS_PLUGIN_ID,{path:We.pagePathGetters.integration_details_policies({pkgkey:ze.OSQUERY_INTEGRATION_NAME})[1]})}),[t]);return a?i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,{iconType:"gear",href:a,onClick:r},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.appNavigation.manageIntegrationButton",defaultMessage:"Manage integration"}))):null},Da=i.a.memo(za);var Ra;!function(e){e.LiveQueries="live_queries",e.Packs="packs",e.SavedQueries="saved_queries"}(Ra||(Ra={}));const Ga=()=>{const e=Object(o.useLocation)(),t=Object(n.useMemo)((()=>{var t;return null!==(t=e.pathname.split("/")[1])&&void 0!==t?t:"overview"}),[e.pathname]);return i.a.createElement(v,null,i.a.createElement(l.EuiFlexGroup,{gutterSize:"l",alignItems:"center"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiTabs,{bottomBorder:!1},i.a.createElement(l.EuiTab,k()({isSelected:t===Ra.LiveQueries},Object(_.f)(Ra.LiveQueries)),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.appNavigation.liveQueriesLinkText",defaultMessage:"Live queries"})),i.a.createElement(l.EuiTab,k()({isSelected:t===Ra.Packs},Object(_.f)(Ra.Packs)),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.appNavigation.packsLinkText",defaultMessage:"Packs"})),i.a.createElement(l.EuiTab,k()({isSelected:t===Ra.SavedQueries},Object(_.f)(Ra.SavedQueries)),i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.appNavigation.savedQueriesLinkText",defaultMessage:"Saved queries"})))),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"s",direction:"row"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiButtonEmpty,{iconType:"popout",href:"https://ela.st/osquery-feedback",target:"_blank"},i.a.createElement(c.FormattedMessage,{id:"xpack.osquery.appNavigation.sendFeedbackButton",defaultMessage:"Send feedback"}))),i.a.createElement(Da,null)))))},$a=()=>{const{data:e,isFetched:t}=(()=>{const{http:e}=Object(_.e)().services,t=Object(Be.a)();return Object(p.useQuery)(["integration"],(()=>e.get("/internal/osquery/status")),{onError:e=>t(e,{title:I.i18n.translate("xpack.osquery.osquery_integration.fetchError",{defaultMessage:"Error while fetching osquery integration"})}),refetchOnReconnect:!1,refetchOnWindowFocus:!1})})();return t?t&&"installed"!==(null==e?void 0:e.install_status)?i.a.createElement(Ba,null):i.a.createElement(g,{id:"osquery-app"},i.a.createElement(y,null,i.a.createElement(Ga,null),i.a.createElement(Qa,null))):i.a.createElement(l.EuiPage,{paddingSize:"none"},i.a.createElement(l.EuiPageBody,null,i.a.createElement(l.EuiPageContent_Deprecated,{verticalPosition:"center",horizontalPosition:"center",paddingSize:"none",color:"subdued",hasShadow:!1},i.a.createElement(l.EuiLoadingElastic,{size:"xxl"}))))},Va=i.a.memo($a);var Ua=a(13);const Wa=()=>{const[e]=Object(b.j)(ze.DEFAULT_DARK_MODE),t=Object(n.useMemo)((()=>({eui:e?r.euiDarkVars:r.euiLightVars,darkMode:e})),[e]);return i.a.createElement(d.ThemeProvider,{theme:t},i.a.createElement(Va,null))},Ha=(e,t,{element:a,history:r,theme$:n},s,d)=>(u.a.render(i.a.createElement(b.e,{theme$:n},i.a.createElement(_.b,{services:{appName:ze.PLUGIN_NAME,kibanaVersion:d,...e,...t,storage:s}},i.a.createElement(l.EuiErrorBoundary,null,i.a.createElement(o.Router,{history:r},i.a.createElement(c.I18nProvider,null,i.a.createElement(p.QueryClientProvider,{client:Ua.a},i.a.createElement(Wa,null),i.a.createElement(E.ReactQueryDevtools,{initialIsOpen:!1}))))))),a),()=>u.a.unmountComponentAtNode(a))},76:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var l=a(0),r=a.n(l),n=a(2),i=a(18),s=a(41);const u=a.n(s)()(n.EuiPanel).withConfig({displayName:"Panel",componentId:"sc-1msa277-0"})(["max-width:500px;margin-right:auto;margin-left:auto;"]),o=()=>r.a.createElement("div",null,r.a.createElement(n.EuiSpacer,null),r.a.createElement(u,null,r.a.createElement(n.EuiEmptyPrompt,{iconType:"securityApp",title:r.a.createElement("h2",null,r.a.createElement(i.FormattedMessage,{id:"xpack.osquery.permissionDeniedErrorTitle",defaultMessage:"Permission denied"})),body:r.a.createElement("p",null,r.a.createElement(i.FormattedMessage,{id:"xpack.osquery.permissionDeniedErrorMessage",defaultMessage:"You are not authorized to access this page."}))})),r.a.createElement(n.EuiSpacer,null)),c=r.a.memo(o)},77:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return n})),a.d(t,"d",(function(){return i})),a.d(t,"c",(function(){return s}));var l=a(20);const r=e=>Object(l.reduce)(e,((e,t)=>{var a,r;return Object(l.isEmpty)(null==t?void 0:t.key)||Object(l.isEmpty)(null===(a=t.result)||void 0===a?void 0:a.type)||Object(l.isEmpty)(null===(r=t.result)||void 0===r?void 0:r.value)||(e[t.key]={[t.result.type]:t.result.value}),e}),{}),n=e=>Object(l.reduce)(e,((e,t,a)=>(t&&e.push({key:a,result:{type:Object.keys(t)[0],value:Object.values(t)[0]}}),e)),[]),i=e=>Object(l.reduce)(e,((e,t)=>(Object(l.isEmpty)(null==t?void 0:t.policy)||(e[t.policy.key]=t.percentage),e)),{}),s=(e,t)=>Object(l.reduce)(e,((e,a,l)=>{var r,n;return null!=a&&e.push({policy:{key:l,label:null!==(r=null==t||null===(n=t[l])||void 0===n?void 0:n.name)&&void 0!==r?r:""},percentage:a}),e}),[])},78:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var l=a(10),r=a(6);const n=({packId:e,skip:t=!1})=>{const{http:a}=Object(r.e)().services;return Object(l.useQuery)(["pack",{packId:e}],(()=>a.get(`/api/osquery/packs/${e}`)),{select:e=>null==e?void 0:e.data,keepPreviousData:!0,enabled:!(t||!e)})}},80:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var l=a(10),r=a(9),n=a(66),i=a(6),s=a(56);const u=({activePage:e,direction:t,limit:a,sortField:u,filterQuery:o,skip:c=!1})=>{const{http:d}=Object(i.e)().services,m=Object(s.a)();return Object(l.useQuery)(["actions",{activePage:e,direction:t,limit:a,sortField:u}],(()=>d.get("/api/osquery/live_queries",{query:{filterQuery:Object(n.a)(o),page:e,pageSize:a,sort:u,sortOrder:t}})),{keepPreviousData:!0,enabled:!c,onSuccess:()=>m(),onError:e=>m(e,{title:r.i18n.translate("xpack.osquery.live_queries_all.fetchError",{defaultMessage:"Error while fetching live queries"})})})}}}]);