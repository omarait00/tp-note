/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.osquery_bundle_jsonpfunction=window.osquery_bundle_jsonpfunction||[]).push([[0,10],{100:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(9),i=a(10),l=a(56),r=a(6);const s=({agentId:e,silent:t,skip:a})=>{const{http:s}=Object(r.e)().services,o=Object(l.a)();return Object(i.useQuery)(["agentDetails",e],(()=>s.get(`/internal/osquery/fleet_wrapper/agents/${e}`)),{enabled:!a,retry:!1,select:e=>null==e?void 0:e.item,onSuccess:()=>o(),onError:e=>!t&&o(e,{title:n.i18n.translate("xpack.osquery.agentDetails.fetchError",{defaultMessage:"Error while fetching agent details"})})})}},101:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return o}));var n=a(0),i=a.n(n),l=a(71),r=a(72);const s=({actionId:e,agentIds:t,queryId:a})=>{const[s,c]=Object(n.useState)(!1),{data:u}=Object(r.a)({actionId:e,isLive:s,...a?{queryIds:[a]}:{}});return Object(n.useLayoutEffect)((()=>{c((()=>!("completed"===(null==u?void 0:u.status))))}),[null==u?void 0:u.status]),i.a.createElement(o.Provider,{value:!0},i.a.createElement(l.a,{actionId:e,queryId:a,data:null==u?void 0:u.queries,startDate:null==u?void 0:u["@timestamp"],expirationDate:null==u?void 0:u.expiration,agentIds:t}))},o=i.a.createContext(!1)},121:function(e,t,a){"use strict";a.d(t,"a",(function(){return R}));var n=a(2),i=a(0),l=a.n(i),r=a(41),s=a.n(r),o=a(42),c=a(9),u=a(18),d=a(43),m=a(82),p=a(10),g=a(46),b=a(66),y=a(6),v=a(58),f=a(56),E=a(13);const I=({actionId:e,activePage:t,agentIds:a,direction:n,limit:i,sortField:l,filterQuery:r,skip:s=!1,isLive:u=!1})=>{var d;const{data:m}=Object(y.e)().services,I=Object(f.a)();return Object(p.useQuery)(["actionResults",{actionId:e}],(async()=>{var s,c,u,d,p,y,f,I,h,O,x,k,j,T,w,S,q;const C=await Object(g.lastValueFrom)(m.search.search({actionId:e,factoryQueryType:v.b.actionResults,filterQuery:Object(b.a)(r),pagination:Object(b.b)(t,i),sort:{direction:n,field:l}},{strategy:"osquerySearchStrategy"})),_=null!==(s=null===(c=C.rawResponse)||void 0===c||null===(u=c.aggregations)||void 0===u||null===(d=u.aggs.responses_by_action_id)||void 0===d?void 0:d.doc_count)&&void 0!==s?s:0,D=null!==(p=null===(y=C.rawResponse)||void 0===y||null===(f=y.aggregations)||void 0===f||null===(I=f.aggs.responses_by_action_id)||void 0===I||null===(h=I.rows_count)||void 0===h?void 0:h.value)&&void 0!==p?p:0,A=null===(O=C.rawResponse)||void 0===O||null===(x=O.aggregations)||void 0===x||null===(k=x.aggs.responses_by_action_id)||void 0===k?void 0:k.responses.buckets,F=E.a.getQueryData(["actionResults",{actionId:e}]),R=null!=F&&F.edges.length?null==F?void 0:F.edges:null!==(j=null==a?void 0:a.map((e=>({fields:{agent_id:[e]}}))))&&void 0!==j?j:[];return{...C,edges:Object(o.reverse)(Object(o.uniqBy)("fields.agent_id[0]",Object(o.flatten)([C.edges,R]))),aggregations:{totalRowCount:D,totalResponded:_,successful:null!==(T=null==A||null===(w=A.find((e=>"success"===e.key)))||void 0===w?void 0:w.doc_count)&&void 0!==T?T:0,failed:null!==(S=null==A||null===(q=A.find((e=>"error"===e.key)))||void 0===q?void 0:q.doc_count)&&void 0!==S?S:0},inspect:Object(b.c)(C,{})}}),{initialData:{edges:[],aggregations:{totalResponded:0,successful:0,pending:null!==(d=null==a?void 0:a.length)&&void 0!==d?d:0,failed:0}},refetchInterval:!!u&&5e3,keepPreviousData:!0,enabled:!s&&!(null==a||!a.length),onSuccess:()=>I(),onError:e=>I(e,{title:c.i18n.translate("xpack.osquery.action_results.fetchError",{defaultMessage:"Error while fetching action results"})})})};c.i18n.translate("xpack.osquery.results.errorSearchDescription",{defaultMessage:"An error has occurred on all results search"}),c.i18n.translate("xpack.osquery.results.failSearchDescription",{defaultMessage:"Failed to fetch results"});var h=a(124),O=a(84),x=a(7),k=a(97);const j=Object(i.createContext)([]),T=s()(n.EuiDataGrid).withConfig({displayName:"StyledEuiDataGrid",componentId:"sc-1ezwdcq-0"})([":not(.euiDataGrid--fullScreen){max-height:500px;}"]),w=({actionId:e,agentIds:t,ecsMapping:a,startDate:r,endDate:s,liveQueryActionId:E})=>{var w;const[S,q]=Object(i.useState)(!0),{data:C}=Object(O.a)(),{data:{aggregations:_}}=I({actionId:e,activePage:0,agentIds:t,limit:0,direction:v.a.asc,sortField:"@timestamp",isLive:S,skip:!C}),D=Object(i.useMemo)((()=>!!s&&new Date(s)<new Date),[s]),{application:{getUrlForApp:A},appName:F,timelines:R}=Object(y.e)().services,M=Object(i.useCallback)((e=>A("fleet",{path:d.pagePathGetters.agent_details({agentId:e})[1]})),[A]),[z,P]=Object(i.useState)({pageIndex:0,pageSize:50}),B=Object(i.useCallback)((e=>P((t=>({...t,pageSize:e,pageIndex:0})))),[P]),N=Object(i.useCallback)((e=>P((t=>({...t,pageIndex:e})))),[P]),[L,Q]=Object(i.useState)([{id:"agent.name",direction:v.a.asc}]),[$,G]=Object(i.useState)([]),{data:U,isLoading:V}=(({actionId:e,activePage:t,limit:a,sort:n,filterQuery:i,skip:l=!1,isLive:r=!1})=>{const{data:s}=Object(y.e)().services,o=Object(f.a)();return Object(p.useQuery)(["allActionResults",{actionId:e,activePage:t,limit:a,sort:n}],(async()=>{var l,r;const o=await Object(g.lastValueFrom)(s.search.search({actionId:e,factoryQueryType:v.b.results,filterQuery:Object(b.a)(i),pagination:Object(b.b)(t,a),sort:n},{strategy:"osquerySearchStrategy"}));if((null==o||null===(l=o.edges)||void 0===l||!l.length)&&o.total)throw new Error("Empty edges while positive totalCount");return{...o,columns:Object.keys((null===(r=o.edges)||void 0===r?void 0:r.length)&&o.edges[0].fields||{}).sort(),inspect:Object(b.c)(o,{})}}),{keepPreviousData:!0,refetchInterval:!!r&&5e3,enabled:!l,onSuccess:()=>o(),onError:e=>o(e,{title:c.i18n.translate("xpack.osquery.results.fetchError",{defaultMessage:"Error while fetching results"})})})})({actionId:e,activePage:z.pageIndex,limit:z.pageSize,isLive:S,sort:L.map((e=>({field:e.id,direction:e.direction}))),skip:!C}),[H,J]=Object(i.useState)([]),W=Object(i.useMemo)((()=>({visibleColumns:H,setVisibleColumns:J})),[H,J]),K=Object(i.useMemo)((()=>Object(o.keys)(a||{})),[a]),Y=Object(i.useMemo)((()=>({rowIndex:e,columnId:t})=>{var a;const r=Object(i.useContext)(j),s=null===(a=r[e%z.pageSize])||void 0===a?void 0:a.fields[t];if("agent.name"===t){var c;const t=null===(c=r[e%z.pageSize])||void 0===c?void 0:c.fields["agent.id"];return l.a.createElement(n.EuiLink,{href:M(t)},s)}if(K.includes(t)){var u;const a=Object(o.get)(t,null===(u=r[e%z.pageSize])||void 0===u?void 0:u._source);if(Object(o.isArray)(a)||Object(o.isObject)(a))try{return JSON.stringify(a,null,2)}catch(e){}return null!=a?a:"-"}return Object(o.isEmpty)(s)?"-":s}),[K,M,z.pageSize]),Z=Object(i.useMemo)((()=>({columns:L,onSort:Q})),[L]),X=Object(i.useMemo)((()=>({...z,pageSizeOptions:[10,50,100],onChangeItemsPerPage:B,onChangePage:N})),[B,N,z]),ee=Object(i.useMemo)((()=>{if(a)return Object(o.reduce)(((e,[t,a])=>{var n;return null!=a&&a.field&&(e[null==a?void 0:a.field]=[...null!==(n=e[null==a?void 0:a.field])&&void 0!==n?n:[],t]),e}),{},Object.entries(a))}),[a]),te=Object(i.useCallback)((e=>{if(ee&&ee[e])return l.a.createElement(l.a.Fragment,null,e," ",l.a.createElement(n.EuiIconTip,{size:"s",content:l.a.createElement(l.a.Fragment,null,l.a.createElement(u.FormattedMessage,{id:"xpack.osquery.liveQueryResults.table.fieldMappedLabel",defaultMessage:"Field is mapped to"}),":",l.a.createElement("ul",null,ee[e].map((e=>l.a.createElement("li",{key:e},e))))),type:"indexMapping"}))}),[ee]);Object(i.useEffect)((()=>{if(null==U||!U.columns.length)return;const e=["agent.name",...K.sort(),...null==U?void 0:U.columns],t=e.reduce(((t,a)=>{const{data:n,seen:i}=t;if("agent.name"===a)return i.has(a)||(n.push({id:a,displayAsText:c.i18n.translate("xpack.osquery.liveQueryResults.table.agentColumnTitle",{defaultMessage:"agent"}),defaultSortDirection:v.a.asc}),i.add(a)),t;if(K.includes(a))return i.has(a)||(n.push({id:a,displayAsText:a,defaultSortDirection:v.a.asc}),i.add(a)),t;if(a.startsWith("osquery.")){const l=a.split(".")[1],r=e.includes(`${a}.number`);if(!i.has(l)){const e=r?a+".number":a;n.push({id:e,displayAsText:l,display:te(l),defaultSortDirection:v.a.asc,...r?{schema:"numeric"}:{}}),i.add(l)}return t}return t}),{data:[],seen:new Set}).data;G((e=>Object(o.isEqual)(Object(o.map)("id",e),Object(o.map)("id",t))?e:t)),J(Object(o.map)("id",t))}),[null==U?void 0:U.columns.length,K,te]);const ae=Object(i.useMemo)((()=>{const e=null==U?void 0:U.edges;return R&&e?[{id:"timeline",width:38,headerCellRender:()=>null,rowCellRender:t=>{var a;const{visibleRowIndex:n}=t,i=null===(a=e[n])||void 0===a?void 0:a._id;return l.a.createElement(m.a,{field:"_id",value:i,isIcon:!0})}}]:[]}),[null==U?void 0:U.edges,R]),ne=Object(i.useMemo)((()=>({showDisplaySelector:!1,showFullScreenSelector:F===x.PLUGIN_NAME,additionalControls:l.a.createElement(l.a.Fragment,null,l.a.createElement(h.c,{actionId:e,buttonType:h.b.button,endDate:s,startDate:r}),l.a.createElement(h.d,{actionId:e,buttonType:h.b.button,endDate:s,startDate:r}),l.a.createElement(m.a,{field:"action_id",value:e}),E&&l.a.createElement(k.a,{actionId:E,queryId:e,agentIds:t}))})),[e,t,F,s,E,r]);return Object(i.useEffect)((()=>q((()=>!(null==t||!t.length||D||_.totalResponded===(null==t?void 0:t.length)&&(null==U?void 0:U.total)===(null==_?void 0:_.totalRowCount)&&(null==U||!U.total||null!=U&&U.edges.length))))),[null==t?void 0:t.length,_.totalResponded,null==_?void 0:_.totalRowCount,null==U?void 0:U.edges.length,null==U?void 0:U.total,D]),C?V?l.a.createElement(n.EuiLoadingContent,{lines:5}):l.a.createElement(l.a.Fragment,null,S&&l.a.createElement(n.EuiProgress,{color:"primary",size:"xs"}),null!=U&&U.edges.length?l.a.createElement(j.Provider,{value:null==U?void 0:U.edges},l.a.createElement(T,{"data-test-subj":"osqueryResultsTable","aria-label":"Osquery results",columns:$,columnVisibility:W,rowCount:null!==(w=null==U?void 0:U.total)&&void 0!==w?w:0,renderCellValue:Y,leadingControlColumns:ae,sorting:Z,pagination:X,toolbarVisibility:ne})):l.a.createElement(n.EuiPanel,{hasShadow:!1},l.a.createElement(n.EuiCallOut,{title:(ie=_.totalResponded,c.i18n.translate("xpack.osquery.results.multipleAgentsResponded",{defaultMessage:"{agentsResponded, plural, one {# agent has} other {# agents have}} responded, no osquery data has been reported.",values:{agentsResponded:ie}}))}))):l.a.createElement(n.EuiCallOut,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.osquery.liveQuery.permissionDeniedPromptTitle",defaultMessage:"Permission denied"}),color:"danger",iconType:"alert"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.osquery.liveQuery.permissionDeniedPromptBody",defaultMessage:"To view query results, ask your administrator to update your user role to have index {read} privileges on the {logs} index.",values:{read:l.a.createElement(n.EuiCode,null,"read"),logs:l.a.createElement(n.EuiCode,null,"logs-",x.OSQUERY_INTEGRATION_NAME,".result*")}})));var ie},S=l.a.memo(w);var q=a(99);const C=e=>l.a.createElement(n.EuiCodeBlock,{language:"shell",fontSize:"s",paddingSize:"none",transparentBackground:!0},e),_=({actionId:e,expirationDate:t,agentIds:a})=>{const[r]=Object(i.useState)(0),[s]=Object(i.useState)(50),o=Object(i.useMemo)((()=>!!t&&new Date(t)<new Date),[t]),[u,d]=Object(i.useState)(!0),{data:m}=Object(O.a)(),{data:{aggregations:p,edges:g}}=I({actionId:e,activePage:r,agentIds:a,limit:s,direction:v.a.asc,sortField:"@timestamp",isLive:u,skip:!m});o&&g.forEach((e=>{var t;null!==(t=e.fields)&&void 0!==t&&t.completed_at||!e.fields||(e.fields["error.keyword"]=e.fields.error=[c.i18n.translate("xpack.osquery.liveQueryActionResults.table.expiredErrorText",{defaultMessage:"The action request timed out."})])}));const b=Object(i.useCallback)((e=>l.a.createElement(q.a,{agentId:e})),[]),y=Object(i.useCallback)((e=>null!=e?e:"-"),[]),f=Object(i.useCallback)(((e,t)=>t.fields.completed_at?t.fields["error.keyword"]?c.i18n.translate("xpack.osquery.liveQueryActionResults.table.errorStatusText",{defaultMessage:"error"}):c.i18n.translate("xpack.osquery.liveQueryActionResults.table.successStatusText",{defaultMessage:"success"}):o?c.i18n.translate("xpack.osquery.liveQueryActionResults.table.expiredStatusText",{defaultMessage:"expired"}):c.i18n.translate("xpack.osquery.liveQueryActionResults.table.pendingStatusText",{defaultMessage:"pending"})),[o]),E=Object(i.useMemo)((()=>[{field:"status",name:c.i18n.translate("xpack.osquery.liveQueryActionResults.table.statusColumnTitle",{defaultMessage:"Status"}),render:f},{field:"fields.agent_id[0]",name:c.i18n.translate("xpack.osquery.liveQueryActionResults.table.agentIdColumnTitle",{defaultMessage:"Agent Id"}),truncateText:!0,render:b},{field:"_source.action_response.osquery.count",name:c.i18n.translate("xpack.osquery.liveQueryActionResults.table.resultRowsNumberColumnTitle",{defaultMessage:"Number of result rows"}),render:y},{field:"fields.error[0]",name:c.i18n.translate("xpack.osquery.liveQueryActionResults.table.errorColumnTitle",{defaultMessage:"Error"}),render:C}]),[b,y,f]),h=Object(i.useMemo)((()=>({initialPageSize:20,pageSizeOptions:[10,20,50,100]})),[]);return Object(i.useEffect)((()=>{d((()=>!(null==a||!a.length||o||p.totalResponded===(null==a?void 0:a.length))))}),[null==a?void 0:a.length,p.totalResponded,o]),g.length?l.a.createElement(n.EuiInMemoryTable,{loading:u,items:g,columns:E,pagination:h}):null},D=l.a.memo(_),A=s()(n.EuiTabbedContent).withConfig({displayName:"StyledEuiTabbedContent",componentId:"sc-kedhgd-0"})(["div.euiTabs{padding-left:8px;}"]),F=({actionId:e,agentIds:t,ecsMapping:a,endDate:r,failedAgentsCount:s,startDate:o,liveQueryActionId:c})=>{const u=Object(i.useMemo)((()=>[{id:"results",name:"Results","data-test-subj":"osquery-results-tab",content:l.a.createElement(S,{actionId:e,agentIds:t,ecsMapping:a,startDate:o,endDate:r,liveQueryActionId:c})},{id:"status",name:"Status","data-test-subj":"osquery-status-tab",content:l.a.createElement(D,{actionId:e,agentIds:t,expirationDate:r}),append:s?l.a.createElement(n.EuiNotificationBadge,{className:"eui-alignCenter",size:"m"},s):null}]),[e,t,a,o,r,c,s]);return l.a.createElement(A,{tabs:u,initialSelectedTab:u[0],autoFocus:"selected",expand:!1})},R=l.a.memo(F)},124:function(e,t,a){"use strict";a.d(t,"b",(function(){return _})),a.d(t,"d",(function(){return F})),a.d(t,"c",(function(){return M})),a.d(t,"a",(function(){return J}));var n=a(0),i=a.n(n),l=a(2),r=a(9),s=a(18),o=a(44),c=a.n(o),u=a(48),d=a(47),m=a(65),p=a(6),g=a(54),b=a(129),y=a(99),v=a(10),f=a(46),E=a(49),I=a(67);const h=({actionId:e,interval:t,skip:a=!1})=>{const n=Object(p.e)().services.data,{data:i}=Object(I.a)({skip:a});return Object(v.useQuery)(["scheduledQueryErrors",{actionId:e,interval:t}],(async()=>{const a=await n.search.searchSource.create({fields:["*"],sort:[{"@timestamp":E.SortDirection.desc}],query:{bool:{filter:[{match_phrase:{message:"Error"}},{match_phrase:{"data_stream.dataset":"elastic_agent.osquerybeat"}},{match_phrase:{message:e}},{range:{"@timestamp":{gte:`now-${2*t}s`,lte:"now"}}}]}},size:1e3});return a.setField("index",i),Object(f.lastValueFrom)(a.fetch$())}),{keepPreviousData:!0,enabled:!(a||!e||!t||!i),select:e=>{var t;return null!==(t=e.rawResponse.hits)&&void 0!==t?t:[]},refetchOnReconnect:!1,refetchOnWindowFocus:!1})},O=r.i18n.translate("xpack.osquery.pack.queriesTable.viewLogsErrorsActionAriaLabel",{defaultMessage:"View in Logs"}),x=({actionId:e,agentId:t,timestamp:a})=>{const r=Object(p.e)().services.application.navigateToApp,s=Object(n.useCallback)((n=>{const i=!(!Object(p.d)(n)&&Object(p.c)(n));n.preventDefault();const l=Object(b.stringify)({logPosition:Object(g.encode)({end:a,streamLive:!1}),logFilter:Object(g.encode)({expression:`elastic_agent.id:${t} and (data_stream.dataset:elastic_agent or data_stream.dataset:elastic_agent.osquerybeat) and "${e}"`,kind:"kuery"})});r("logs",{path:`stream?${l}`,openInNewTab:i})}),[e,t,r,a]);return i.a.createElement(l.EuiToolTip,{content:O},i.a.createElement(l.EuiButtonIcon,{iconType:"search",onClick:s,"aria-label":O}))},k=i.a.memo(x),j=e=>i.a.createElement(l.EuiCodeBlock,{fontSize:"s",paddingSize:"none",transparentBackground:!0},e),T=({actionId:e,interval:t})=>{var a;const{data:s}=h({actionId:e,interval:t}),o=Object(n.useCallback)((e=>i.a.createElement(y.a,{agentId:e})),[]),c=Object(n.useCallback)((t=>i.a.createElement(k,{actionId:e,agentId:null==t?void 0:t.fields["elastic_agent.id"][0],timestamp:null==t?void 0:t.fields["event.ingested"][0]})),[e]),u=Object(n.useMemo)((()=>[{field:"fields.@timestamp",name:"@timestamp",width:"220px"},{field:'fields["elastic_agent.id"][0]',name:r.i18n.translate("xpack.osquery.scheduledQueryErrorsTable.agentIdColumnTitle",{defaultMessage:"Agent Id"}),truncateText:!0,render:o,width:"15%"},{field:"fields.message[0]",name:r.i18n.translate("xpack.osquery.scheduledQueryErrorsTable.errorColumnTitle",{defaultMessage:"Error"}),render:j},{width:"50px",actions:[{render:c}]}]),[o,c]);return i.a.createElement(l.EuiInMemoryTable,{items:null!==(a=null==s?void 0:s.hits)&&void 0!==a?a:[],columns:u,pagination:!0})},w=i.a.memo(T);var S=a(83);const q=r.i18n.translate("xpack.osquery.pack.queriesTable.viewDiscoverResultsActionAriaLabel",{defaultMessage:"View in Discover"}),C=r.i18n.translate("xpack.osquery.pack.queriesTable.viewLensResultsActionAriaLabel",{defaultMessage:"View in Lens"});let _;function D(e,t,a){const n={columnOrder:["8690befd-fd69-4246-af4a-dd485d2a3b38","ed999e9d-204c-465b-897f-fe1a125b39ed"],columns:{"8690befd-fd69-4246-af4a-dd485d2a3b38":{sourceField:"type",isBucketed:!0,dataType:"string",scale:"ordinal",operationType:"terms",label:"Top values of type",params:{otherBucket:!0,size:5,missingBucket:!1,orderBy:{columnId:"ed999e9d-204c-465b-897f-fe1a125b39ed",type:"column"},orderDirection:"desc"}},"ed999e9d-204c-465b-897f-fe1a125b39ed":{sourceField:u.DOCUMENT_FIELD_NAME,isBucketed:!1,dataType:"number",scale:"ratio",operationType:"count",label:"Count of records"}},incompleteColumns:{}},i={bool:{minimum_should_match:1,should:null==a?void 0:a.map((e=>({match_phrase:{"agent.id":e}})))}};return{visualizationType:"lnsPie",title:`Action ${t} results`,references:[{id:e.id,name:"indexpattern-datasource-current-indexpattern",type:"index-pattern"},{id:e.id,name:"indexpattern-datasource-layer-layer1",type:"index-pattern"},{name:"filter-index-pattern-0",id:e.id,type:"index-pattern"}],state:{datasourceStates:{formBased:{layers:{layer1:n}}},filters:[{$state:{store:d.FilterStateStore.APP_STATE},meta:{index:"filter-index-pattern-0",negate:!1,alias:null,disabled:!1,params:{query:t},type:"phrase",key:"action_id"},query:{match_phrase:{action_id:t}}},...i?[{$state:{store:d.FilterStateStore.APP_STATE},meta:{alias:"agent IDs",disabled:!1,index:"filter-index-pattern-0",key:"query",negate:!1,type:"custom",value:JSON.stringify(i)},query:i}]:[]],query:{language:"kuery",query:""},visualization:{shape:"pie",layers:[{layerType:"data",legendDisplay:"default",nestedLegend:!1,layerId:"layer1",metrics:["ed999e9d-204c-465b-897f-fe1a125b39ed"],numberDisplay:"percent",primaryGroups:["8690befd-fd69-4246-af4a-dd485d2a3b38"],categoryDisplay:"default"}]}}}}!function(e){e.icon="icon",e.button="button"}(_||(_={}));const A=({actionId:e,agentIds:t,buttonType:a,endDate:r,startDate:s,mode:o})=>{const c=Object(p.e)().services.lens,u=null==c?void 0:c.canUseEditor(),{data:d}=Object(I.a)({skip:!e,checkOnly:!0}),m=Object(n.useCallback)((a=>{a.preventDefault(),null!=d&&d.id&&(null==c||c.navigateToPrefilledEditor({id:"",timeRange:{from:null!=s?s:"now-1d",to:null!=r?r:"now",mode:(null!=o?o:s||r)?"absolute":"relative"},attributes:D(d,e,t)},{openInNewTab:!0,skipAppLeave:!0}))}),[e,t,r,c,d,o,s]);return u?a===_.button?i.a.createElement(l.EuiButtonEmpty,{size:"xs",iconType:"lensApp",onClick:m,isDisabled:!d},C):i.a.createElement(l.EuiToolTip,{content:C},i.a.createElement(l.EuiButtonIcon,{iconType:"lensApp",isDisabled:!d,onClick:m,"aria-label":C})):null},F=i.a.memo(A),R=({actionId:e,agentIds:t,buttonType:a,endDate:r,startDate:s})=>{const{discover:o,application:c}=Object(p.e)().services,u=null==o?void 0:o.locator,m=c.capabilities.discover,{data:g}=Object(I.a)({skip:!e,checkOnly:!0}),[b,y]=Object(n.useState)("");return Object(n.useEffect)((()=>{(async()=>{if(!u||!g)return;const a=null!=t&&t.length?{bool:{minimum_should_match:1,should:t.map((e=>({match_phrase:{"agent.id":e}})))}}:null,n=await u.getUrl({indexPatternId:g.id,filters:[{meta:{index:g.id,alias:null,negate:!1,disabled:!1,type:"phrase",key:"action_id",params:{query:e}},query:{match_phrase:{action_id:e}},$state:{store:d.FilterStateStore.APP_STATE}},...a?[{$state:{store:d.FilterStateStore.APP_STATE},meta:{alias:"agent IDs",disabled:!1,index:g.id,key:"query",negate:!1,type:"custom",value:JSON.stringify(a)},query:a}]:[]],refreshInterval:{pause:!0,value:0},timeRange:s&&r?{to:r,from:s,mode:"absolute"}:{to:"now",from:"now-1d",mode:"relative"}});y(n)})()}),[e,t,r,s,u,g]),m.show?a===_.button?i.a.createElement(l.EuiButtonEmpty,{size:"xs",iconType:"discoverApp",href:b,target:"_blank",isDisabled:!g},q):i.a.createElement(l.EuiToolTip,{content:q},i.a.createElement(l.EuiButtonIcon,{iconType:"discoverApp","aria-label":q,href:b,target:"_blank",isDisabled:!g})):null},M=i.a.memo(R),z=i.a.memo((({actionId:e,agentIds:t,interval:a})=>i.a.createElement(l.EuiFlexGroup,{direction:"column",gutterSize:"xl"},i.a.createElement(l.EuiFlexItem,null,i.a.createElement(l.EuiSpacer,{size:"m"}),i.a.createElement(l.EuiPanel,{paddingSize:"s",hasBorder:!0,hasShadow:!1},i.a.createElement(w,{actionId:e,agentIds:t,interval:a})),i.a.createElement(l.EuiSpacer,{size:"m"})))));z.displayName="ScheduledQueryExpandedContent";const P=({actionId:e,interval:t})=>{const{data:a,isLoading:n}=Object(S.a)({actionId:e,interval:t});return n?i.a.createElement(l.EuiLoadingSpinner,null):a?i.a.createElement(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},i.a.createElement(l.EuiFlexItem,{grow:4},null!=a&&a["@timestamp"]?i.a.createElement(l.EuiToolTip,{content:i.a.createElement(i.a.Fragment,null,i.a.createElement(s.FormattedDate,{value:a["@timestamp"],year:"numeric",month:"short",day:"2-digit"})," ",i.a.createElement(s.FormattedTime,{value:a["@timestamp"],timeZoneName:"short"}))},i.a.createElement(s.FormattedRelative,{value:a["@timestamp"]})):"-")):i.a.createElement(i.a.Fragment,null,"-")},B=({actionId:e,interval:t})=>{var a;const{data:n,isLoading:r}=Object(S.a)({actionId:e,interval:t});return r?i.a.createElement(l.EuiLoadingSpinner,null):n?i.a.createElement(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiNotificationBadge,{color:"subdued"},null!==(a=null==n?void 0:n.docCount)&&void 0!==a?a:0))):i.a.createElement(i.a.Fragment,null,"-")},N=({actionId:e,interval:t})=>{var a;const{data:n,isLoading:r}=Object(S.a)({actionId:e,interval:t});return r?i.a.createElement(l.EuiLoadingSpinner,{"data-test-subj":"docsLoading"}):n?i.a.createElement(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiNotificationBadge,{color:"subdued"},null!==(a=null==n?void 0:n.uniqueAgentsCount)&&void 0!==a?a:0))):i.a.createElement(i.a.Fragment,null,"-")},L=({actionId:e,interval:t,queryId:a,toggleErrors:r,expanded:s})=>{var o;const c=Object(n.useCallback)((()=>r({queryId:a,interval:t})),[r,a,t]),{data:u,isLoading:d}=h({actionId:e,interval:t});return d?i.a.createElement(l.EuiLoadingSpinner,null):null!=u&&u.total?i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center",justifyContent:"flexEnd"},i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiNotificationBadge,{color:null!=u&&u.total?"accent":"subdued"},null!==(o=null==u?void 0:u.total)&&void 0!==o?o:0)),i.a.createElement(l.EuiFlexItem,{grow:!1},i.a.createElement(l.EuiButtonIcon,{isDisabled:!(null!=u&&u.total),onClick:c,iconType:s?"arrowUp":"arrowDown"})))):i.a.createElement("span",{"data-test-subj":"packResultsErrorsEmpty"},"-")},Q=(e,t)=>`pack_${t}_${e}`,$=({item:e,packName:t,agentIds:a})=>{const{id:n,interval:l}=e,r=Q(n,t),{data:s}=Object(S.a)({actionId:r,interval:l}),o=null!=s&&s["@timestamp"]?c()(null==s?void 0:s["@timestamp"][0]).subtract(l,"seconds").toISOString():`now-${l}s`,u=null!=s&&s["@timestamp"]?c()(null==s?void 0:s["@timestamp"][0]).toISOString():"now";return i.a.createElement(M,{actionId:r,agentIds:a,buttonType:_.icon,startDate:o,endDate:u,mode:null!=s&&s["@timestamp"][0]?"absolute":"relative"})},G=i.a.memo($),U=({item:e,packName:t,agentIds:a})=>{const{id:n,interval:l}=e,r=Q(n,t),{data:s}=Object(S.a)({actionId:r,interval:l}),o=null!=s&&s["@timestamp"]?c()(null==s?void 0:s["@timestamp"][0]).subtract(l,"seconds").toISOString():`now-${l}s`,u=null!=s&&s["@timestamp"]?c()(null==s?void 0:s["@timestamp"][0]).toISOString():"now";return i.a.createElement(F,{actionId:r,agentIds:a,buttonType:_.icon,startDate:o,endDate:u,mode:null!=s&&s["@timestamp"][0]?"absolute":"relative"})},V=i.a.memo(U),H=({agentIds:e,data:t,packName:a})=>{const[s,o]=Object(n.useState)({}),c=Object(n.useCallback)(((e,t)=>{const a=Object(m.a)(e),n=a.length>55?`${a.substring(0,55)}...`:a;return i.a.createElement(l.EuiToolTip,{title:t.id,content:i.a.createElement(l.EuiFlexItem,null,e)},i.a.createElement(l.EuiCodeBlock,{language:"sql",fontSize:"s",paddingSize:"none",transparentBackground:!0},n))}),[]),u=Object(n.useCallback)((({queryId:t,interval:n})=>{const l={...s};l[t]?delete l[t]:l[t]=i.a.createElement(z,{actionId:Q(t,a),agentIds:e,interval:n}),o(l)}),[e,s,a]),d=Object(n.useCallback)((e=>i.a.createElement(P,{actionId:Q(e.id,a),interval:e.interval})),[a]),p=Object(n.useCallback)((e=>i.a.createElement(B,{actionId:Q(e.id,a),interval:e.interval})),[a]),g=Object(n.useCallback)((e=>i.a.createElement(N,{actionId:Q(e.id,a),interval:e.interval})),[a]),b=Object(n.useCallback)((e=>i.a.createElement(L,{queryId:e.id,interval:e.interval,actionId:Q(e.id,a),toggleErrors:u,expanded:!!s[e.id]})),[s,a,u]),y=Object(n.useCallback)((t=>i.a.createElement(G,{item:t,agentIds:e,packName:a})),[e,a]),v=Object(n.useCallback)((t=>i.a.createElement(V,{item:t,agentIds:e,packName:a})),[e,a]),f=Object(n.useCallback)((e=>{var t;return null!==(t=e.id)&&void 0!==t?t:""}),[]),E=Object(n.useMemo)((()=>[{field:"id",name:r.i18n.translate("xpack.osquery.pack.queriesTable.idColumnTitle",{defaultMessage:"ID"}),width:"15%",truncateText:!0},{field:"interval",name:r.i18n.translate("xpack.osquery.pack.queriesTable.intervalColumnTitle",{defaultMessage:"Interval (s)"}),width:"80px"},{field:"query",name:r.i18n.translate("xpack.osquery.pack.queriesTable.queryColumnTitle",{defaultMessage:"Query"}),render:c,width:"40%"},{name:r.i18n.translate("xpack.osquery.pack.queriesTable.lastResultsColumnTitle",{defaultMessage:"Last results"}),render:d,width:"12%"},{name:r.i18n.translate("xpack.osquery.pack.queriesTable.docsResultsColumnTitle",{defaultMessage:"Docs"}),render:p},{name:r.i18n.translate("xpack.osquery.pack.queriesTable.agentsResultsColumnTitle",{defaultMessage:"Agents"}),render:g},{name:r.i18n.translate("xpack.osquery.pack.queriesTable.errorsResultsColumnTitle",{defaultMessage:"Errors"}),render:b},{name:r.i18n.translate("xpack.osquery.pack.queriesTable.viewResultsColumnTitle",{defaultMessage:"View results"}),width:"90px",actions:[{render:y},{render:v}]}]),[c,d,p,g,b,y,v]),I=Object(n.useMemo)((()=>({sort:{field:"id",direction:"asc"}})),[]);return i.a.createElement(l.EuiBasicTable,{items:null!=t?t:[],itemId:f,columns:E,sorting:I,itemIdToExpandedRowMap:s,isExpandable:!0})},J=i.a.memo(H)},129:function(e,t,a){"use strict";t.decode=t.parse=a(130),t.encode=t.stringify=a(131)},130:function(e,t,a){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,a,l){t=t||"&",a=a||"=";var r={};if("string"!=typeof e||0===e.length)return r;var s=/\+/g;e=e.split(t);var o=1e3;l&&"number"==typeof l.maxKeys&&(o=l.maxKeys);var c=e.length;o>0&&c>o&&(c=o);for(var u=0;u<c;++u){var d,m,p,g,b=e[u].replace(s,"%20"),y=b.indexOf(a);y>=0?(d=b.substr(0,y),m=b.substr(y+1)):(d=b,m=""),p=decodeURIComponent(d),g=decodeURIComponent(m),n(r,p)?i(r[p])?r[p].push(g):r[p]=[r[p],g]:r[p]=g}return r};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},131:function(e,t,a){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,a,s){return t=t||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e?l(r(e),(function(r){var s=encodeURIComponent(n(r))+a;return i(e[r])?l(e[r],(function(e){return s+encodeURIComponent(n(e))})).join(t):s+encodeURIComponent(n(e[r]))})).join(t):s?encodeURIComponent(n(s))+a+encodeURIComponent(n(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function l(e,t){if(e.map)return e.map(t);for(var a=[],n=0;n<e.length;n++)a.push(t(e[n],n));return a}var r=Object.keys||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.push(a);return t}},56:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(0),i=a(6);const l=()=>{const[e,t]=Object(n.useState)(),{notifications:{toasts:a}}=Object(i.e)().services;return(n,i)=>{var l,r;e&&a.remove(e),n&&t(a.addError(n,{title:(null==n||null===(l=n.body)||void 0===l?void 0:l.error)||(null==n||null===(r=n.body)||void 0===r?void 0:r.message),...i}))}}},58:function(e,t,a){"use strict";let n,i;a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i})),function(e){e.asc="asc",e.desc="desc"}(n||(n={})),function(e){e.actions="actions",e.actionDetails="actionDetails",e.actionResults="actionResults",e.agents="agents",e.results="results"}(i||(i={}))},65:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n=e=>e.replaceAll("\r\n"," ").replaceAll("\n"," ").replaceAll(/  +/g," ")},66:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return r}));var n=a(42);const i=e=>Object(n.isString)(e)?e:JSON.stringify(e),l=(e,t)=>({activePage:e,cursorStart:e*t,querySize:t}),r=(e,t)=>{var a,n,i;return{dsl:null!==(a=null!==(n=null==e||null===(i=e.inspect)||void 0===i?void 0:i.dsl)&&void 0!==n?n:null==t?void 0:t.dsl)&&void 0!==a?a:[],response:null!=e?[JSON.stringify(e.rawResponse,null,2)]:null==t?void 0:t.response}}},67:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(10),i=a(6);const l=e=>{const t=Object(i.e)().services.data.dataViews;return Object(n.useQuery)(["logsDataView"],(async()=>{let a;try{const e=await t.find("logs-osquery_manager.result*",1);if(!e.length)throw new Error("No data view found");a=e[0]}catch(e){}if(!a&&t.getCanSaveSync())try{a=await t.createAndSave({title:"logs-osquery_manager.result*",timeFieldName:"@timestamp"})}catch(e){}if(!(a||null!=e&&e.checkOnly))try{a=await t.create({title:"logs-osquery_manager.result*",timeFieldName:"@timestamp"})}catch(e){}return a}),{enabled:!(null!=e&&e.skip),retry:1})}},71:function(e,t,a){"use strict";a.d(t,"b",(function(){return G})),a.d(t,"a",(function(){return J}));var n=a(20),i=a(0),l=a.n(i),r=a(2),s=a(9),o=a(41),c=a.n(o),u=a(18);const d={style:"z-index: 6000"},m=({action:e,onClose:t})=>l.a.createElement(r.EuiPortal,null,l.a.createElement(r.EuiFlyout,{size:"m",ownFocus:!0,onClose:t,"aria-labelledby":"flyoutTitle",maskProps:d},l.a.createElement(r.EuiFlyoutHeader,{hasBorder:!0},l.a.createElement(r.EuiTitle,{size:"s"},l.a.createElement("h2",{id:"flyoutTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.osquery.liveQueryActions.details.title",defaultMessage:"Query Details"})))),l.a.createElement(r.EuiFlyoutBody,null,l.a.createElement(r.EuiFlexItem,{grow:!1},l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.osquery.liveQueryActions.details.id",defaultMessage:"Id"})),l.a.createElement(r.EuiSpacer,{size:"xs"}),l.a.createElement(r.EuiCodeBlock,{fontSize:"m",paddingSize:"s",isCopyable:!0},e.id)),l.a.createElement(r.EuiSpacer,{size:"m"}),l.a.createElement(r.EuiFlexItem,{grow:!1},l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.osquery.liveQueryActions.details.query",defaultMessage:"Query"})),l.a.createElement(r.EuiSpacer,{size:"xs"}),l.a.createElement(r.EuiCodeBlock,{language:"sql",fontSize:"m",paddingSize:"s",isCopyable:!0},e.query)),l.a.createElement(r.EuiSpacer,{size:"m"})))),p=l.a.memo(m);var g=a(82),b=a(97);const y=c()(r.EuiFlexItem).withConfig({displayName:"StyledResultsHeading",componentId:"sc-37xp3e-0"})(["padding-right:20px;border-right:2px solid #d3dae6;"]),v=c()(r.EuiFlexItem).withConfig({displayName:"StyledIconsList",componentId:"sc-37xp3e-1"})(["align-content:center;justify-content:center;padding-left:10px;"]),f=l.a.memo((({actionId:e,agentIds:t,queryIds:a})=>{const n=Object(i.useMemo)((()=>({color:"text",size:"xs",iconSize:"l"})),[]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(r.EuiSpacer,{size:"l"}),l.a.createElement(r.EuiFlexGroup,{direction:"row",gutterSize:"m"},l.a.createElement(y,{grow:!1},l.a.createElement(r.EuiText,null,l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.osquery.liveQueryActionResults.results",defaultMessage:"Results"})))),l.a.createElement(v,{grow:!1},l.a.createElement("span",null,e&&l.a.createElement(r.EuiFlexGroup,null,l.a.createElement(r.EuiFlexItem,null,l.a.createElement(b.a,{actionId:e,agentIds:t,isIcon:!0,iconProps:n})),l.a.createElement(r.EuiFlexItem,null,l.a.createElement(g.a,{field:"action_id",value:a,isIcon:!0,iconProps:n})))))),l.a.createElement(r.EuiSpacer,{size:"l"}))}));f.displayName="PackResultsHeader";var E=a(58),I=a(65),h=a(121),O=a(44),x=a.n(O),k=a(83),j=a(48),T=a(47),w=a(6),S=a(67);const q=({actionId:e,agentIds:t,buttonType:a,endDate:n,startDate:s,mode:o})=>{const c=Object(w.e)().services.lens,u=null==c?void 0:c.canUseEditor(),{data:d}=Object(S.a)({skip:!e,checkOnly:!0}),m=Object(i.useCallback)((a=>{a.preventDefault(),d&&(null==c||c.navigateToPrefilledEditor({id:"",timeRange:{from:null!=s?s:"now-1d",to:null!=n?n:"now",mode:(null!=o?o:s||n)?"absolute":"relative"},attributes:C(d,e,t)},{openInNewTab:!0,skipAppLeave:!0}))}),[e,t,n,c,d,o,s]),p=Object(i.useMemo)((()=>!e||!d),[e,d]);return u?a===G.button?l.a.createElement(r.EuiButtonEmpty,{size:"xs",iconType:"lensApp",onClick:m,isDisabled:p},_):l.a.createElement(r.EuiToolTip,{content:_},l.a.createElement(r.EuiButtonIcon,{iconType:"lensApp",disabled:!1,onClick:m,"aria-label":_,isDisabled:p})):null};function C(e,t,a){const n={columnOrder:["8690befd-fd69-4246-af4a-dd485d2a3b38","ed999e9d-204c-465b-897f-fe1a125b39ed"],columns:{"8690befd-fd69-4246-af4a-dd485d2a3b38":{sourceField:"type",isBucketed:!0,dataType:"string",scale:"ordinal",operationType:"terms",label:"Top values of type",params:{otherBucket:!0,size:5,missingBucket:!1,orderBy:{columnId:"ed999e9d-204c-465b-897f-fe1a125b39ed",type:"column"},orderDirection:"desc"}},"ed999e9d-204c-465b-897f-fe1a125b39ed":{sourceField:j.DOCUMENT_FIELD_NAME,isBucketed:!1,dataType:"number",scale:"ratio",operationType:"count",label:"Count of records"}},incompleteColumns:{}},i=null!=a&&a.length?{bool:{minimum_should_match:1,should:null==a?void 0:a.map((e=>({match_phrase:{"agent.id":e}})))}}:void 0;return{visualizationType:"lnsPie",title:`Action ${t} results`,references:[{id:e.id,name:"indexpattern-datasource-current-indexpattern",type:"index-pattern"},{id:e.id,name:"indexpattern-datasource-layer-layer1",type:"index-pattern"},{name:"filter-index-pattern-0",id:e.id,type:"index-pattern"}],state:{datasourceStates:{formBased:{layers:{layer1:n}}},filters:[{$state:{store:T.FilterStateStore.APP_STATE},meta:{index:"filter-index-pattern-0",negate:!1,alias:null,disabled:!1,params:{query:t},type:"phrase",key:"action_id"},query:{match_phrase:{action_id:t}}},...i?[{$state:{store:T.FilterStateStore.APP_STATE},meta:{alias:"agent IDs",disabled:!1,index:"filter-index-pattern-0",key:"query",negate:!1,type:"custom",value:JSON.stringify(i)},query:i}]:[]],query:{language:"kuery",query:""},visualization:{shape:"pie",layers:[{layerType:"data",legendDisplay:"default",nestedLegend:!1,layerId:"layer1",metrics:["ed999e9d-204c-465b-897f-fe1a125b39ed"],numberDisplay:"percent",primaryGroups:["8690befd-fd69-4246-af4a-dd485d2a3b38"],categoryDisplay:"default"}]}}}}const _=s.i18n.translate("xpack.osquery.pack.queriesTable.viewLensResultsActionAriaLabel",{defaultMessage:"View in Lens"}),D=l.a.memo(q),A=({item:e})=>{const{action_id:t,agents:a,interval:n}=e,{data:i}=Object(k.a)({actionId:t,interval:n}),r=null!=i&&i["@timestamp"]?x()(null==i?void 0:i["@timestamp"][0]).subtract(n,"seconds").toISOString():`now-${n}s`,s=null!=i&&i["@timestamp"]?x()(null==i?void 0:i["@timestamp"][0]).toISOString():"now";return l.a.createElement(D,{actionId:t,agentIds:a,buttonType:G.icon,startDate:r,endDate:s,mode:null!=i&&i["@timestamp"][0]?"absolute":"relative"})},F=l.a.memo(A),R=({actionId:e,agentIds:t,buttonType:a,endDate:n,startDate:s})=>{const{discover:o,application:c}=Object(w.e)().services,u=null==o?void 0:o.locator,d=c.capabilities.discover,{data:m}=Object(S.a)({skip:!e,checkOnly:!0}),[p,g]=Object(i.useState)("");return Object(i.useEffect)((()=>{(async()=>{if(!u||!m)return;const a=null!=t&&t.length?{bool:{minimum_should_match:1,should:t.map((e=>({match_phrase:{"agent.id":e}})))}}:null,i=await u.getUrl({indexPatternId:m.id,filters:[{meta:{index:m.id,alias:null,negate:!1,disabled:!1,type:"phrase",key:"action_id",params:{query:e}},query:{match_phrase:{action_id:e}},$state:{store:T.FilterStateStore.APP_STATE}},...a?[{$state:{store:T.FilterStateStore.APP_STATE},meta:{alias:"agent IDs",disabled:!1,index:m.id,key:"query",negate:!1,type:"custom",value:JSON.stringify(a)},query:a}]:[]],refreshInterval:{pause:!0,value:0},timeRange:s&&n?{to:n,from:s,mode:"absolute"}:{to:"now",from:"now-1d",mode:"relative"}});g(i)})()}),[e,t,n,s,u,m]),d.show?a===G.button?l.a.createElement(r.EuiButtonEmpty,{size:"xs",iconType:"discoverApp",href:p,target:"_blank"},M):l.a.createElement(r.EuiToolTip,{content:M},l.a.createElement(r.EuiButtonIcon,{iconType:"discoverApp","aria-label":M,href:p,target:"_blank",isDisabled:!e||!p.length})):null},M=s.i18n.translate("xpack.osquery.pack.queriesTable.viewDiscoverResultsActionAriaLabel",{defaultMessage:"View in Discover"}),z=l.a.memo(R),P=({item:e})=>{const{action_id:t,agents:a,interval:n}=e,{data:i}=Object(k.a)({actionId:t,interval:n}),r=null!=i&&i["@timestamp"]?x()(null==i?void 0:i["@timestamp"][0]).subtract(n,"seconds").toISOString():`now-${n}s`,s=null!=i&&i["@timestamp"]?x()(null==i?void 0:i["@timestamp"][0]).toISOString():"now";return l.a.createElement(z,{actionId:t,agentIds:a,buttonType:G.icon,startDate:r,endDate:s,mode:null!=i&&i["@timestamp"][0]?"absolute":"relative"})},B=l.a.memo(P),N=c.a.div.withConfig({displayName:"TruncateTooltipText",componentId:"sc-qi6iwu-0"})(["width:100%;> span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}"]),L=c()(r.EuiFlexItem).withConfig({displayName:"StyledEuiFlexItem",componentId:"sc-qi6iwu-1"})(["cursor:pointer;"]),Q=[],$=c()(r.EuiBasicTable).withConfig({displayName:"StyledEuiBasicTable",componentId:"sc-qi6iwu-2"})([".euiTableRow.euiTableRow-isExpandedRow > td > div{padding:0;border:1px solid #d3dae6;}div.euiDataGrid__virtualized::-webkit-scrollbar{display:none;}.euiDataGrid > div{.euiDataGrid__scrollOverlay{box-shadow:none;}border-left:0px;border-right:0px;}"]);let G;!function(e){e.icon="icon",e.button="button"}(G||(G={}));const U=({count:e,isLive:t})=>l.a.createElement(r.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},l.a.createElement(r.EuiFlexItem,{grow:!1},e?l.a.createElement(r.EuiNotificationBadge,{color:"subdued"},e):"-"),t?l.a.createElement(r.EuiFlexItem,{grow:!1,"data-test-subj":"live-query-loading"},l.a.createElement(r.EuiLoadingSpinner,null)):null),V=({successful:e,pending:t,failed:a})=>l.a.createElement(r.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},l.a.createElement(r.EuiFlexItem,{grow:!1},l.a.createElement(r.EuiText,{color:"subdued"},l.a.createElement(r.EuiBadge,{color:"success"},e)," / ",l.a.createElement(r.EuiBadge,{color:"default"},t)," / ",l.a.createElement(r.EuiBadge,{color:a?"danger":"default"},a)))),H=({actionId:e,queryId:t,agentIds:a,data:o,startDate:c,expirationDate:u,showResultsHeader:d})=>{const[m,y]=Object(i.useState)(null),v=Object(i.useCallback)((e=>()=>{y(e)}),[]),O=Object(i.useCallback)((()=>y(null)),[]),[x,k]=Object(i.useState)({}),j=Object(i.useCallback)((e=>l.a.createElement(N,null,l.a.createElement(r.EuiToolTip,{content:e,display:"block"},l.a.createElement(l.a.Fragment,null,e)))),[]),T=Object(i.useCallback)(((e,t)=>{const a=Object(I.a)(e),n=a.length>55?`${a.substring(0,55)}...`:a;return l.a.createElement(L,{onClick:v(t)},l.a.createElement(r.EuiCodeBlock,{language:"sql",fontSize:"s",paddingSize:"none",transparentBackground:!0},n))}),[v]),w=Object(i.useCallback)((e=>{var t;return l.a.createElement(U,{count:null!==(t=null==e?void 0:e.docs)&&void 0!==t?t:0,isLive:"running"===(null==e?void 0:e.status)&&0!==(null==e?void 0:e.pending)})}),[]),S=Object(i.useCallback)((e=>{var t,a,n;if(e.action_id)return l.a.createElement(V,{successful:null!==(t=null==e?void 0:e.successful)&&void 0!==t?t:0,pending:null!==(a=null==e?void 0:e.pending)&&void 0!==a?a:0,failed:null!==(n=null==e?void 0:e.failed)&&void 0!==n?n:0})}),[]),q=Object(i.useCallback)((e=>l.a.createElement(B,{item:e})),[]),C=Object(i.useCallback)((e=>l.a.createElement(F,{item:e})),[]),_=Object(i.useCallback)((t=>()=>{k((n=>{const i={...n};var s;return i[t.id]?delete i[t.id]:i[t.id]=l.a.createElement(r.EuiFlexGroup,{gutterSize:"xl"},l.a.createElement(r.EuiFlexItem,null,l.a.createElement(h.a,{liveQueryActionId:e,actionId:t.action_id,startDate:c,ecsMapping:t.ecs_mapping,endDate:u,agentIds:a,failedAgentsCount:null!==(s=null==t?void 0:t.failed)&&void 0!==s?s:0}))),i}))}),[e,c,u,a]),D=Object(i.useCallback)((e=>null!=e&&e.action_id&&null!=o&&o.length&&o.length>1?l.a.createElement(r.EuiButtonIcon,{"data-test-subj":`toggleIcon-${e.id}`,onClick:_(e),iconType:x[e.id]?"arrowUp":"arrowDown"}):l.a.createElement(l.a.Fragment,null)),[o,_,x]),A=Object(i.useCallback)((e=>Object(n.get)(e,"id")),[]),R=Object(i.useCallback)((t=>[{render:q},{render:C},{render:e=>l.a.createElement(g.a,{field:"action_id",value:e.action_id,isIcon:!0})},{render:t=>e&&l.a.createElement(b.a,{actionId:e,agentIds:a,queryId:t.action_id,isIcon:!0,isDisabled:!t.action_id})},{render:e=>l.a.createElement(r.EuiButtonIcon,{iconType:"expand",onClick:v(e)})}].map((e=>e.render(t)))),[e,a,v,q,C]),M=Object(i.useMemo)((()=>[{field:"id",name:s.i18n.translate("xpack.osquery.pack.queriesTable.idColumnTitle",{defaultMessage:"ID"}),width:"15%",render:j},{field:"query",name:s.i18n.translate("xpack.osquery.pack.queriesTable.queryColumnTitle",{defaultMessage:"Query"}),render:T,width:"40%"},{name:s.i18n.translate("xpack.osquery.pack.queriesTable.docsResultsColumnTitle",{defaultMessage:"Docs"}),width:"80px",render:w},{name:s.i18n.translate("xpack.osquery.pack.queriesTable.agentsResultsColumnTitle",{defaultMessage:"Agents"}),width:"160px",render:S},{name:s.i18n.translate("xpack.osquery.pack.queriesTable.viewResultsColumnTitle",{defaultMessage:"View results"}),width:"90px",render:R},{id:"actions",width:"45px",isVisuallyHiddenLabel:!0,alignment:r.RIGHT_ALIGNMENT,actions:[{render:D}]}]),[j,T,w,S,R,D]),z=Object(i.useMemo)((()=>({sort:{field:"id",direction:E.a.asc}})),[]);Object(i.useEffect)((()=>{k({})}),[t,e]),Object(i.useEffect)((()=>{1===(null==o?void 0:o.length)&&null!=a&&a.length&&null!=o&&o[0].id&&!x[null==o?void 0:o[0].id]&&_(null==o?void 0:o[0])()}),[null==a?void 0:a.length,o,_,x]);const P=Object(i.useMemo)((()=>Object(n.map)(o,(e=>e.action_id))),[o]);return l.a.createElement(l.a.Fragment,null,d&&l.a.createElement(f,{queryIds:P,actionId:e,agentIds:a}),l.a.createElement($,{items:null!=o?o:Q,itemId:A,columns:M,sorting:z,itemIdToExpandedRowMap:x,isExpandable:!0}),m?l.a.createElement(p,{onClose:O,action:m}):null)},J=l.a.memo(H)},72:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(10),i=a(9),l=a(20),r=a(6),s=a(56);const o=({actionId:e,filterQuery:t,isLive:a=!1,skip:o=!1,queryIds:c})=>{const{http:u}=Object(r.e)().services,d=Object(s.a)();return Object(n.useQuery)(["liveQueries",{actionId:e,filterQuery:t,queryIds:c}],(()=>u.get(`/api/osquery/live_queries/${e}`)),{enabled:!o&&!!e,refetchInterval:!!a&&5e3,onSuccess:()=>d(),onError:e=>d(e,{title:i.i18n.translate("xpack.osquery.action_details.fetchError",{defaultMessage:"Error while fetching action details"})}),select:e=>{if(c){const t=Object(l.filter)(e.data.queries,(e=>c.includes(e.action_id)));return{...e.data,queries:t}}return e.data},refetchOnWindowFocus:!1,retryDelay:5e3})}},82:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(5),i=a.n(n),l=a(0),r=a.n(l),s=a(20),o=a(2),c=a(6);const u=r.a.memo((e=>r.a.createElement(o.EuiButtonEmpty,i()({},e,{size:"xs"}))));u.displayName="TimelineComponent";const d=e=>{const{timelines:t,appName:a}=Object(c.e)().services,{field:n,value:d,isIcon:m,iconProps:p}=e,g=Object(s.isArray)(d)?d:[d],b=Object(l.useCallback)((e=>r.a.createElement(o.EuiButtonIcon,i()({iconType:"timelines"},e,{size:"xs"},p))),[p]);if(!t||"Security"!==a||!g.length)return null;const{getAddToTimelineButton:y}=t.getHoverActions();return y({dataProvider:g.map((e=>({and:[],enabled:!0,excluded:!1,id:e,kqlQuery:"",name:e,queryMatch:{field:n,value:e,operator:":"}}))),field:g[0],ownFocus:!1,...m?{showTooltip:!0,Component:b}:{Component:u}})}},83:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(10),i=a(44),l=a.n(i),r=a(46),s=a(49),o=a(6),c=a(67);const u=({actionId:e,interval:t,startDate:a,endDate:i,skip:u=!1})=>{const d=Object(o.e)().services.data,{data:m}=Object(c.a)({skip:u});return Object(n.useQuery)(["scheduledQueryLastResults",{actionId:e}],(async()=>{var n,o,c,u;const p=await d.search.searchSource.create({size:1,sort:[{"@timestamp":s.SortDirection.desc}],query:{bool:{filter:[{match_phrase:{action_id:e}}]}}});p.setField("index",m);const g=await Object(r.lastValueFrom)(p.fetch$()),b=null===(n=g.rawResponse)||void 0===n||null===(o=n.hits)||void 0===o||null===(c=o.hits[0])||void 0===c||null===(u=c.fields)||void 0===u?void 0:u["@timestamp"][0];if(b){var y,v,f,E,I,h,O,x;const n=await d.search.searchSource.create({size:1,query:{bool:{filter:[{range:{"@timestamp":{gte:a?l()(a).format():l()(b).subtract(t,"seconds").format(),lte:l()(i||b).format()}}},{match_phrase:{action_id:e}}]}}});n.setField("index",m),n.setField("aggs",{unique_agents:{cardinality:{field:"agent.id"}}});const s=await Object(r.lastValueFrom)(n.fetch$());return{"@timestamp":null===(y=g.rawResponse)||void 0===y||null===(v=y.hits)||void 0===v||null===(f=v.hits[0])||void 0===f||null===(E=f.fields)||void 0===E?void 0:E["@timestamp"],uniqueAgentsCount:null==s||null===(I=s.rawResponse.aggregations)||void 0===I||null===(h=I.unique_agents)||void 0===h?void 0:h.value,docCount:null==s||null===(O=s.rawResponse)||void 0===O||null===(x=O.hits)||void 0===x?void 0:x.total}}return null}),{keepPreviousData:!0,enabled:!(u||!e||!m),refetchOnReconnect:!1,refetchOnWindowFocus:!1})}},84:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(10),i=a(6);const l=()=>{const{http:e}=Object(i.e)().services;return Object(n.useQuery)(["actionResultsPrivileges"],(()=>e.get("/internal/osquery/privileges_check")),{keepPreviousData:!0})}},97:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var n=a(0),i=a.n(n),l=a(101),r=a(6),s=a(5),o=a.n(s),c=a(55),u=a(2),d=a(9),m=a(25);const p=d.i18n.translate("xpack.osquery.pack.queriesTable.addToCaseResultsActionAriaLabel",{defaultMessage:"Add to Case"}),g=({actionId:e,agentIds:t=[],queryId:a="",isIcon:l=!1,isDisabled:s,iconProps:d})=>{const{cases:g}=Object(r.e)().services,b=Object(n.useContext)(m.a),y=Object(n.useMemo)((()=>{var e,t;return null!=b&&b._id?[{alertId:null!==(e=null==b?void 0:b._id)&&void 0!==e?e:"",index:null!==(t=null==b?void 0:b._index)&&void 0!==t?t:"",rule:g.helpers.getRuleIdFromEvent({ecs:b,data:[]}),type:c.CommentType.alert}]:[]}),[g.helpers,b]),v=g.helpers.canUseCases(),f=v.read&&v.update&&v.push,E=g.hooks.getUseCasesAddToExistingCaseModal({}),I=Object(n.useCallback)((()=>{const n=[...y,{type:c.CommentType.externalReference,externalReferenceId:e,externalReferenceStorage:{type:c.ExternalReferenceStorageType.elasticSearchDoc},externalReferenceAttachmentTypeId:"osquery",externalReferenceMetadata:{actionId:e,agentIds:t,queryId:a}}];f&&E.open({attachments:n})}),[e,t,y,f,a,E]);return l?i.a.createElement(u.EuiToolTip,{content:i.a.createElement(u.EuiFlexItem,null,p)},i.a.createElement(u.EuiButtonIcon,o()({iconType:"casesApp",onClick:I,isDisabled:s||!f,"aria-label":p},d))):i.a.createElement(u.EuiButtonEmpty,{size:"xs",iconType:"casesApp",onClick:I,isDisabled:s||!f,"aria-label":p},p)},b=[],y=i.a.memo((e=>{const{cases:t}=Object(r.e)().services;if(Object(n.useContext)(l.a)||!e.actionId)return i.a.createElement(i.a.Fragment,null);const a=t.helpers.canUseCases(),s=t.ui.getCasesContext();return i.a.createElement(s,{owner:b,permissions:a},i.a.createElement(g,e))}));y.displayName="AddToCaseWrapper"},99:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(2),i=a(0),l=a.n(i),r=a(45),s=a(43),o=a(100),c=a(6);const u=({agentId:e})=>{var t;const a=Object(c.e)().services.application.getUrlForApp,{data:i}=Object(o.a)({agentId:e,skip:!e});return l.a.createElement(n.EuiToolTip,{position:"top",content:l.a.createElement("p",null,e)},l.a.createElement(n.EuiLink,{className:"eui-textTruncate",href:a(r.PLUGIN_ID,{path:s.pagePathGetters.agent_details({agentId:e})[1]}),target:"_blank"},null!==(t=null==i?void 0:i.local_metadata.host.name)&&void 0!==t?t:e))},d=l.a.memo(u)}}]);