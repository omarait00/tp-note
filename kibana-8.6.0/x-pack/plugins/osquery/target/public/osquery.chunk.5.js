/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.osquery_bundle_jsonpfunction=window.osquery_bundle_jsonpfunction||[]).push([[5],{116:function(e,t){var a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(a){var r=new Uint8Array(16);e.exports=function(){return a(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},117:function(e,t){for(var a=[],r=0;r<256;++r)a[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,n=a;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},137:function(e,t,a){var r=a(138),n=a(139),i=n;i.v1=r,i.v4=n,e.exports=i},138:function(e,t,a){var r,n,i=a(116),u=a(117),l=0,o=0;e.exports=function(e,t,a){var s=t&&a||0,c=t||[],d=(e=e||{}).node||r,p=void 0!==e.clockseq?e.clockseq:n;if(null==d||null==p){var v=i();null==d&&(d=r=[1|v[0],v[1],v[2],v[3],v[4],v[5]]),null==p&&(p=n=16383&(v[6]<<8|v[7]))}var m=void 0!==e.msecs?e.msecs:(new Date).getTime(),y=void 0!==e.nsecs?e.nsecs:o+1,f=m-l+(y-o)/1e4;if(f<0&&void 0===e.clockseq&&(p=p+1&16383),(f<0||m>l)&&void 0===e.nsecs&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=m,o=y,n=p;var b=(1e4*(268435455&(m+=122192928e5))+y)%4294967296;c[s++]=b>>>24&255,c[s++]=b>>>16&255,c[s++]=b>>>8&255,c[s++]=255&b;var g=m/4294967296*1e4&268435455;c[s++]=g>>>8&255,c[s++]=255&g,c[s++]=g>>>24&15|16,c[s++]=g>>>16&255,c[s++]=p>>>8|128,c[s++]=255&p;for(var k=0;k<6;++k)c[s+k]=d[k];return t||u(c)}},139:function(e,t,a){var r=a(116),n=a(117);e.exports=function(e,t,a){var i=t&&a||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var u=(e=e||{}).random||(e.rng||r)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,t)for(var l=0;l<16;++l)t[i+l]=u[l];return t||n(u)}},157:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return f}));var r=a(0),n=a.n(r),i=a(2),u=a(137),l=a.n(u),o=a(19),s=a(20),c=a(78),d=a(81),p=a(6),v=a(114),m=a(96);const y=({defaultValues:e,onError:t,onChange:a})=>{const u=Object(r.useMemo)((()=>l.a.v4()),[]),y=Object(o.useForm)({mode:"all",defaultValues:e?{...Object(s.omit)(e,["ecsMapping","packId"]),ecs_mapping:e.ecsMapping,packId:e.packId?[e.packId]:[],queryType:e.packId?"pack":"query"}:{ecs_mapping:{},id:u,queryType:"query"}}),{watch:f,register:b,formState:g,control:k}=y,[q,E,h,x]=f(["packId","queryType","queries","id"]),{data:j}=Object(c.a)({packId:null==q?void 0:q[0],skip:!(null!=q&&q[0])}),{replace:O}=Object(o.useFieldArray)({name:"queries",control:k});Object(r.useEffect)((()=>{if(null!=j&&j.queries){const e=Object(s.map)(null==j?void 0:j.queries,((e,t)=>({...e,id:t})));O(e)}}),[j,O]),Object(r.useEffect)((()=>{t(g.errors)}),[t,g]),Object(r.useEffect)((()=>{b("savedQueryId"),b("id")}),[b]),Object(r.useEffect)((()=>{const e=f((e=>{var t;a("pack"===e.queryType?{id:e.id,packId:null!=e&&null!==(t=e.packId)&&void 0!==t&&t.length?null==e?void 0:e.packId[0]:void 0,queries:e.queries}:{id:e.id,savedQueryId:e.savedQueryId,query:e.query,ecsMapping:e.ecs_mapping})}));return()=>e.unsubscribe()}),[a,j,f]);const I=Object(p.e)().services.application.capabilities.osquery,w=Object(r.useMemo)((()=>!(!I.runSavedQueries&&!I.writeLiveQueries||!I.readPacks)),[I]),F=Object(r.useMemo)((()=>!!(I.writeLiveQueries||I.runSavedQueries&&I.readSavedQueries)),[I]),Q=Object(r.useMemo)((()=>({queries:h,action_id:x,agents:[]})),[x,h]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(o.FormProvider,y,n.a.createElement(d.a,{canRunPacks:w,canRunSingleQuery:F}),n.a.createElement(i.EuiSpacer,{size:"m"}),"query"===E&&n.a.createElement(v.LiveQueryQueryField,null),"pack"===E&&n.a.createElement(m.a,{liveQueryDetails:h&&!j?Q:void 0})))},f=n.a.memo(y)},60:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r="packList"},61:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var r=a(10),n=a(6),i=a(60);const u=({isLive:e=!1,pageIndex:t=0,pageSize:a=100,sortField:u="updated_at",sortOrder:l="desc"})=>{const{http:o}=Object(n.e)().services;return Object(r.useQuery)([i.a,{pageIndex:t,pageSize:a,sortField:u,sortOrder:l}],(()=>o.get("/api/osquery/packs",{query:{pageIndex:t,pageSize:a,sortField:u,sortOrder:l}})),{keepPreviousData:!0,refetchInterval:!!e&&1e4})}},78:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a(10),n=a(6);const i=({packId:e,skip:t=!1})=>{const{http:a}=Object(n.e)().services;return Object(r.useQuery)(["pack",{packId:e}],(()=>a.get(`/api/osquery/packs/${e}`)),{select:e=>null==e?void 0:e.data,keepPreviousData:!0,enabled:!(t||!e)})}},81:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var r=a(2),n=a(0),i=a.n(n),u=a(9),l=a(41),o=a.n(l),s=a(19);const c=o()(r.EuiCard).withConfig({displayName:"StyledEuiCard",componentId:"sc-sv3i26-0"})(["padding-bottom:60px;position:relative;button{position:absolute;bottom:0;}padding:16px 92px 16px 16px !important;.euiTitle{font-size:1rem;}.euiText{margin-top:0;color:",";}> button[role='switch']{left:auto;height:100% !important;width:80px;right:0;border-radius:0 5px 5px 0;> span{> svg{width:18px;height:18px;display:inline-block !important;}> :not(svg){display:none;}}}button[aria-checked='false'] > span > svg{display:none;}"],(e=>e.theme.eui.euiTextSubduedColor)),d=({canRunSingleQuery:e,canRunPacks:t})=>{const{field:{value:a,onChange:l}}=Object(s.useController)({name:"queryType",defaultValue:"query",rules:{deps:["packId","query"]}}),o=Object(n.useCallback)((e=>{l(e)}),[l]),d=Object(n.useMemo)((()=>({onClick:()=>o("query"),isSelected:"query"===a,iconType:"check"})),[a,o]),p=Object(n.useMemo)((()=>({onClick:()=>o("pack"),isSelected:"pack"===a,iconType:"check"})),[a,o]);return i.a.createElement(r.EuiFlexItem,null,i.a.createElement(r.EuiFormRow,{label:"Query type",fullWidth:!0},i.a.createElement(r.EuiFlexGroup,{gutterSize:"m"},i.a.createElement(r.EuiFlexItem,null,i.a.createElement(c,{layout:"horizontal",title:u.i18n.translate("xpack.osquery.liveQuery.queryForm.singleQueryTypeLabel",{defaultMessage:"Single query"}),titleSize:"xs",hasBorder:!0,description:u.i18n.translate("xpack.osquery.liveQuery.queryForm.singleQueryTypeDescription",{defaultMessage:"Run a saved query or new one."}),selectable:d,isDisabled:!e})),i.a.createElement(r.EuiFlexItem,null,i.a.createElement(c,{layout:"horizontal",title:u.i18n.translate("xpack.osquery.liveQuery.queryForm.packQueryTypeLabel",{defaultMessage:"Pack"}),titleSize:"xs",hasBorder:!0,description:u.i18n.translate("xpack.osquery.liveQuery.queryForm.packQueryTypeDescription",{defaultMessage:"Run a set of queries in a pack."}),selectable:p,isDisabled:!t})))))}},96:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var r=a(2),n=a(0),i=a.n(n),u=a(20),l=a(19),o=a(71),s=a(61),c=a(5),d=a.n(c),p=a(9),v=a(41);const m=a.n(v).a.div.withConfig({displayName:"TextTruncate",componentId:"sc-169w92d-0"})(["overflow:hidden;text-overflow:ellipsis;"]),y=({queryType:e,fieldProps:t={},idAria:a,...o})=>{var s;const{field:{value:c,onChange:v},fieldState:y}=Object(l.useController)({name:"packId",rules:{required:{message:p.i18n.translate("xpack.osquery.pack.queryFlyoutForm.osqueryPackMissingErrorMessage",{defaultMessage:"Pack is a required field"}),value:"pack"===e}},defaultValue:[]}),f=null===(s=y.error)||void 0===s?void 0:s.message,[b,g]=Object(n.useState)([]),k=Object(n.useCallback)((e=>{var t;if(!e.length)return g(e),void v([]);g(e),v([null===(t=e[0].value)||void 0===t?void 0:t.id])}),[v]),q=Object(n.useMemo)((()=>{var e,a;return null!==(e=null==t||null===(a=t.packsData)||void 0===a?void 0:a.map((e=>{var t;return{label:null!==(t=e.attributes.name)&&void 0!==t?t:"",value:{id:e.id,name:e.attributes.name,description:e.attributes.description}}})))&&void 0!==e?e:[]}),[null==t?void 0:t.packsData]),E=Object(n.useCallback)((({value:e})=>i.a.createElement(r.EuiFlexGroup,{gutterSize:"none",direction:"column",alignItems:"flexStart",justifyContent:"flexStart"},i.a.createElement(r.EuiFlexItem,null,i.a.createElement("strong",null,null==e?void 0:e.name)),i.a.createElement(r.EuiFlexItem,null,i.a.createElement(m,null,i.a.createElement(r.EuiTextColor,{color:"subdued"},null==e?void 0:e.description))))),[]);return Object(n.useEffect)((()=>{if(null!=c&&c.length){const e=Object(u.find)(q,["value.id",c[0]]);e&&g([e])}}),[c,q]),i.a.createElement(r.EuiFormRow,d()({label:p.i18n.translate("xpack.osquery.liveQuery.queryForm.packQueryTypeLabel",{defaultMessage:"Pack"}),error:f,isInvalid:!!f,fullWidth:!0,describedByIds:a?[a]:void 0},o),i.a.createElement(r.EuiComboBox,d()({placeholder:p.i18n.translate("xpack.osquery.packs.dropdown.searchFieldPlaceholder",{defaultMessage:"Search for a pack to run"}),selectedOptions:b,onChange:k,"data-test-subj":"select-live-pack",fullWidth:!0,singleSelection:{asPlainText:!0},renderOption:E,options:q,rowHeight:60},t)))},f=({liveQueryDetails:e,submitButtonContent:t,showResultsHeader:a})=>{var c,d,p,v,m;const{data:f}=Object(s.a)({}),{packId:b}=Object(l.useWatch)(),g=Object(n.useMemo)((()=>null!=b&&b.length?Object(u.find)(null==f?void 0:f.data,{id:b[0]}):null),[b,f]),k=Object(n.useMemo)((()=>null==e?void 0:e.action_id),[null==e?void 0:e.action_id]),q=Object(n.useMemo)((()=>null==e?void 0:e.agents),[null==e?void 0:e.agents]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(r.EuiFlexItem,null,i.a.createElement(y,{fieldProps:{packsData:null==f?void 0:f.data},queryType:"pack"})),t,i.a.createElement(r.EuiSpacer,null),null!=e&&null!==(c=e.queries)&&void 0!==c&&c.length||null!=g&&null!==(d=g.attributes)&&void 0!==d&&null!==(p=d.queries)&&void 0!==p&&p.length?i.a.createElement(i.a.Fragment,null,i.a.createElement(r.EuiFlexItem,null,i.a.createElement(o.a,{actionId:k,agentIds:q,data:null!==(v=null==e?void 0:e.queries)&&void 0!==v?v:null==g||null===(m=g.attributes)||void 0===m?void 0:m.queries,showResultsHeader:a}))):null)}}}]);