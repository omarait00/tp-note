/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.sessionView_bundle_jsonpfunction=window.sessionView_bundle_jsonpfunction||[]).push([[1],[,,,,,,,,,,,,,,,,,function(t,a,u){t.exports=u(15)(3)},function(t,a,u){t.exports=u(15)(2)},function(t,a){var u="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(u){var _=new Uint8Array(16);t.exports=function(){return u(_),_}}else{var f=new Array(16);t.exports=function(){for(var t,a=0;a<16;a++)0==(3&a)&&(t=4294967296*Math.random()),f[a]=t>>>((3&a)<<3)&255;return f}}},function(t,a){for(var u=[],_=0;_<256;++_)u[_]=(_+256).toString(16).substr(1);t.exports=function(t,a){var _=a||0,f=u;return[f[t[_++]],f[t[_++]],f[t[_++]],f[t[_++]],"-",f[t[_++]],f[t[_++]],"-",f[t[_++]],f[t[_++]],"-",f[t[_++]],f[t[_++]],"-",f[t[_++]],f[t[_++]],f[t[_++]],f[t[_++]],f[t[_++]],f[t[_++]]].join("")}},function(t,a,u){var _=u(22),f=u(23),p=f;p.v1=_,p.v4=f,t.exports=p},function(t,a,u){var _,f,p=u(19),v=u(20),g=0,m=0;t.exports=function(t,a,u){var S=a&&u||0,y=a||[],w=(t=t||{}).node||_,x=void 0!==t.clockseq?t.clockseq:f;if(null==w||null==x){var E=p();null==w&&(w=_=[1|E[0],E[1],E[2],E[3],E[4],E[5]]),null==x&&(x=f=16383&(E[6]<<8|E[7]))}var j=void 0!==t.msecs?t.msecs:(new Date).getTime(),k=void 0!==t.nsecs?t.nsecs:m+1,T=j-g+(k-m)/1e4;if(T<0&&void 0===t.clockseq&&(x=x+1&16383),(T<0||j>g)&&void 0===t.nsecs&&(k=0),k>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=j,m=k,f=x;var L=(1e4*(268435455&(j+=122192928e5))+k)%4294967296;y[S++]=L>>>24&255,y[S++]=L>>>16&255,y[S++]=L>>>8&255,y[S++]=255&L;var A=j/4294967296*1e4&268435455;y[S++]=A>>>8&255,y[S++]=255&A,y[S++]=A>>>24&15|16,y[S++]=A>>>16&255,y[S++]=x>>>8|128,y[S++]=255&x;for(var R=0;R<6;++R)y[S+R]=w[R];return a||v(y)}},function(t,a,u){var _=u(19),f=u(20);t.exports=function(t,a,u){var p=a&&u||0;"string"==typeof t&&(a="binary"===t?new Array(16):null,t=null);var v=(t=t||{}).random||(t.rng||_)();if(v[6]=15&v[6]|64,v[8]=63&v[8]|128,a)for(var g=0;g<16;++g)a[p+g]=v[g];return a||f(v)}},function(t,a,u){"use strict";var _=Number.isNaN||function(t){return"number"==typeof t&&t!=t};function f(t,a){if(t.length!==a.length)return!1;for(var u=0;u<t.length;u++)if(!((f=t[u])===(p=a[u])||_(f)&&_(p)))return!1;var f,p;return!0}t.exports=function(t,a){void 0===a&&(a=f);var u=null;function _(){for(var _=[],f=0;f<arguments.length;f++)_[f]=arguments[f];if(u&&u.lastThis===this&&a(_,u.lastArgs))return u.lastResult;var p=t.apply(this,_);return u={lastResult:p,lastArgs:_,lastThis:this},p}return _.clear=function(){u=null},_}},function(t,a,u){"use strict";const _=u(26);t.exports=t=>"string"==typeof t?t.replace(_(),""):t},function(t,a,u){"use strict";t.exports=({onlyFirst:t=!1}={})=>{const a=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(a,t?void 0:"g")}},function(t,a,u){self,t.exports=(()=>{"use strict";var t={4567:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.AccessibilityManager=void 0;const _=u(9042),f=u(6114),p=u(9924),v=u(3656),g=u(844),m=u(5596),S=u(9631);class l extends g.Disposable{constructor(t,a){super(),this._terminal=t,this._renderService=a,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityTreeRoot=document.createElement("div"),this._accessibilityTreeRoot.classList.add("xterm-accessibility"),this._accessibilityTreeRoot.tabIndex=0,this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let t=0;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);if(this._topBoundaryFocusListener=t=>this._onBoundaryFocus(t,0),this._bottomBoundaryFocusListener=t=>this._onBoundaryFocus(t,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityTreeRoot.appendChild(this._rowContainer),this._renderRowsDebouncer=new p.TimeBasedDebouncer(this._renderRows.bind(this)),this._refreshRows(),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityTreeRoot.appendChild(this._liveRegion),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityTreeRoot),this.register(this._renderRowsDebouncer),this.register(this._terminal.onResize((t=>this._onResize(t.rows)))),this.register(this._terminal.onRender((t=>this._refreshRows(t.start,t.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((t=>this._onChar(t)))),this.register(this._terminal.onLineFeed((()=>this._onChar("\n")))),this.register(this._terminal.onA11yTab((t=>this._onTab(t)))),this.register(this._terminal.onKey((t=>this._onKey(t.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this._screenDprMonitor=new m.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener((()=>this._refreshRowsDimensions())),this.register((0,v.addDisposableDomListener)(window,"resize",(()=>this._refreshRowsDimensions())))}dispose(){super.dispose(),(0,S.removeElementFromParent)(this._accessibilityTreeRoot),this._rowElements.length=0}_onBoundaryFocus(t,a){const u=t.target,_=this._rowElements[0===a?1:this._rowElements.length-2];if(u.getAttribute("aria-posinset")===(0===a?"1":`${this._terminal.buffer.lines.length}`))return;if(t.relatedTarget!==_)return;let f,p;if(0===a?(f=u,p=this._rowElements.pop(),this._rowContainer.removeChild(p)):(f=this._rowElements.shift(),p=u,this._rowContainer.removeChild(f)),f.removeEventListener("focus",this._topBoundaryFocusListener),p.removeEventListener("focus",this._bottomBoundaryFocusListener),0===a){const t=this._createAccessibilityTreeNode();this._rowElements.unshift(t),this._rowContainer.insertAdjacentElement("afterbegin",t)}else{const t=this._createAccessibilityTreeNode();this._rowElements.push(t),this._rowContainer.appendChild(t)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===a?-1:1),this._rowElements[0===a?1:this._rowElements.length-2].focus(),t.preventDefault(),t.stopImmediatePropagation()}_onResize(t){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const t=document.createElement("div");return t.setAttribute("role","listitem"),t.tabIndex=-1,this._refreshRowDimensions(t),t}_onTab(t){for(let a=0;a<t;a++)this._onChar(" ")}_onChar(t){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==t&&(this._charsToAnnounce+=t):this._charsToAnnounce+=t,"\n"===t&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=_.tooMuchOutput)),f.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout((()=>{this._accessibilityTreeRoot.appendChild(this._liveRegion)}),0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,f.isMac&&(0,S.removeElementFromParent)(this._liveRegion)}_onKey(t){this._clearLiveRegion(),this._charsToConsume.push(t)}_refreshRows(t,a){this._renderRowsDebouncer.refresh(t,a,this._terminal.rows)}_renderRows(t,a){const u=this._terminal.buffer,_=u.lines.length.toString();for(let f=t;f<=a;f++){const t=u.translateBufferLineToString(u.ydisp+f,!0),a=(u.ydisp+f+1).toString(),p=this._rowElements[f];p&&(0===t.length?p.innerText="Â ":p.textContent=t,p.setAttribute("aria-posinset",a),p.setAttribute("aria-setsize",_))}this._announceCharacters()}_refreshRowsDimensions(){if(this._renderService.dimensions.actualCellHeight){this._rowElements.length!==this._terminal.rows&&this._onResize(this._terminal.rows);for(let t=0;t<this._terminal.rows;t++)this._refreshRowDimensions(this._rowElements[t])}}_refreshRowDimensions(t){t.style.height=`${this._renderService.dimensions.actualCellHeight}px`}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}}a.AccessibilityManager=l},3614:(t,a)=>{function u(t){return t.replace(/\r?\n/g,"\r")}function _(t,a){return a?"[200~"+t+"[201~":t}function f(t,a,f){t=_(t=u(t),f.decPrivateModes.bracketedPasteMode),f.triggerDataEvent(t,!0),a.value=""}function p(t,a,u){const _=u.getBoundingClientRect(),f=t.clientX-_.left-10,p=t.clientY-_.top-10;a.style.width="20px",a.style.height="20px",a.style.left=`${f}px`,a.style.top=`${p}px`,a.style.zIndex="1000",a.focus()}Object.defineProperty(a,"__esModule",{value:!0}),a.rightClickHandler=a.moveTextAreaUnderMouseCursor=a.paste=a.handlePasteEvent=a.copyHandler=a.bracketTextForPaste=a.prepareTextForTerminal=void 0,a.prepareTextForTerminal=u,a.bracketTextForPaste=_,a.copyHandler=function(t,a){t.clipboardData&&t.clipboardData.setData("text/plain",a.selectionText),t.preventDefault()},a.handlePasteEvent=function(t,a,u){t.stopPropagation(),t.clipboardData&&f(t.clipboardData.getData("text/plain"),a,u)},a.paste=f,a.moveTextAreaUnderMouseCursor=p,a.rightClickHandler=function(t,a,u,_,f){p(t,a,u),f&&_.rightClickSelect(t),a.value=_.selectionText,a.select()}},7239:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ColorContrastCache=void 0;const _=u(1505);a.ColorContrastCache=class{constructor(){this._color=new _.TwoKeyMap,this._css=new _.TwoKeyMap}setCss(t,a,u){this._css.set(t,a,u)}getCss(t,a){return this._css.get(t,a)}setColor(t,a,u){this._color.set(t,a,u)}getColor(t,a){return this._color.get(t,a)}clear(){this._color.clear(),this._css.clear()}}},5680:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ColorManager=a.DEFAULT_ANSI_COLORS=void 0;const _=u(8055),f=u(7239),p=_.css.toColor("#ffffff"),v=_.css.toColor("#000000"),g=_.css.toColor("#ffffff"),m=_.css.toColor("#000000"),S={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};a.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const t=[_.css.toColor("#2e3436"),_.css.toColor("#cc0000"),_.css.toColor("#4e9a06"),_.css.toColor("#c4a000"),_.css.toColor("#3465a4"),_.css.toColor("#75507b"),_.css.toColor("#06989a"),_.css.toColor("#d3d7cf"),_.css.toColor("#555753"),_.css.toColor("#ef2929"),_.css.toColor("#8ae234"),_.css.toColor("#fce94f"),_.css.toColor("#729fcf"),_.css.toColor("#ad7fa8"),_.css.toColor("#34e2e2"),_.css.toColor("#eeeeec")],a=[0,95,135,175,215,255];for(let u=0;u<216;u++){const f=a[u/36%6|0],p=a[u/6%6|0],v=a[u%6];t.push({css:_.channels.toCss(f,p,v),rgba:_.channels.toRgba(f,p,v)})}for(let a=0;a<24;a++){const u=8+10*a;t.push({css:_.channels.toCss(u,u,u),rgba:_.channels.toRgba(u,u,u)})}return t})()),a.ColorManager=class{constructor(t,u){this.allowTransparency=u;const y=t.createElement("canvas");y.width=1,y.height=1;const w=y.getContext("2d");if(!w)throw new Error("Could not get rendering context");this._ctx=w,this._ctx.globalCompositeOperation="copy",this._litmusColor=this._ctx.createLinearGradient(0,0,1,1),this._contrastCache=new f.ColorContrastCache,this.colors={foreground:p,background:v,cursor:g,cursorAccent:m,selectionForeground:void 0,selectionBackgroundTransparent:S,selectionBackgroundOpaque:_.color.blend(v,S),selectionInactiveBackgroundTransparent:S,selectionInactiveBackgroundOpaque:_.color.blend(v,S),ansi:a.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache},this._updateRestoreColors()}onOptionsChange(t,a){switch(t){case"minimumContrastRatio":this._contrastCache.clear();break;case"allowTransparency":this.allowTransparency=a}}setTheme(t={}){this.colors.foreground=this._parseColor(t.foreground,p),this.colors.background=this._parseColor(t.background,v),this.colors.cursor=this._parseColor(t.cursor,g,!0),this.colors.cursorAccent=this._parseColor(t.cursorAccent,m,!0),this.colors.selectionBackgroundTransparent=this._parseColor(t.selectionBackground,S,!0),this.colors.selectionBackgroundOpaque=_.color.blend(this.colors.background,this.colors.selectionBackgroundTransparent),this.colors.selectionInactiveBackgroundTransparent=this._parseColor(t.selectionInactiveBackground,this.colors.selectionBackgroundTransparent,!0),this.colors.selectionInactiveBackgroundOpaque=_.color.blend(this.colors.background,this.colors.selectionInactiveBackgroundTransparent);const u={css:"",rgba:0};if(this.colors.selectionForeground=t.selectionForeground?this._parseColor(t.selectionForeground,u):void 0,this.colors.selectionForeground===u&&(this.colors.selectionForeground=void 0),_.color.isOpaque(this.colors.selectionBackgroundTransparent)){const t=.3;this.colors.selectionBackgroundTransparent=_.color.opacity(this.colors.selectionBackgroundTransparent,t)}if(_.color.isOpaque(this.colors.selectionInactiveBackgroundTransparent)){const t=.3;this.colors.selectionInactiveBackgroundTransparent=_.color.opacity(this.colors.selectionInactiveBackgroundTransparent,t)}if(this.colors.ansi=a.DEFAULT_ANSI_COLORS.slice(),this.colors.ansi[0]=this._parseColor(t.black,a.DEFAULT_ANSI_COLORS[0]),this.colors.ansi[1]=this._parseColor(t.red,a.DEFAULT_ANSI_COLORS[1]),this.colors.ansi[2]=this._parseColor(t.green,a.DEFAULT_ANSI_COLORS[2]),this.colors.ansi[3]=this._parseColor(t.yellow,a.DEFAULT_ANSI_COLORS[3]),this.colors.ansi[4]=this._parseColor(t.blue,a.DEFAULT_ANSI_COLORS[4]),this.colors.ansi[5]=this._parseColor(t.magenta,a.DEFAULT_ANSI_COLORS[5]),this.colors.ansi[6]=this._parseColor(t.cyan,a.DEFAULT_ANSI_COLORS[6]),this.colors.ansi[7]=this._parseColor(t.white,a.DEFAULT_ANSI_COLORS[7]),this.colors.ansi[8]=this._parseColor(t.brightBlack,a.DEFAULT_ANSI_COLORS[8]),this.colors.ansi[9]=this._parseColor(t.brightRed,a.DEFAULT_ANSI_COLORS[9]),this.colors.ansi[10]=this._parseColor(t.brightGreen,a.DEFAULT_ANSI_COLORS[10]),this.colors.ansi[11]=this._parseColor(t.brightYellow,a.DEFAULT_ANSI_COLORS[11]),this.colors.ansi[12]=this._parseColor(t.brightBlue,a.DEFAULT_ANSI_COLORS[12]),this.colors.ansi[13]=this._parseColor(t.brightMagenta,a.DEFAULT_ANSI_COLORS[13]),this.colors.ansi[14]=this._parseColor(t.brightCyan,a.DEFAULT_ANSI_COLORS[14]),this.colors.ansi[15]=this._parseColor(t.brightWhite,a.DEFAULT_ANSI_COLORS[15]),t.extendedAnsi){const u=Math.min(this.colors.ansi.length-16,t.extendedAnsi.length);for(let _=0;_<u;_++)this.colors.ansi[_+16]=this._parseColor(t.extendedAnsi[_],a.DEFAULT_ANSI_COLORS[_+16])}this._contrastCache.clear(),this._updateRestoreColors()}restoreColor(t){if(void 0!==t)switch(t){case 256:this.colors.foreground=this._restoreColors.foreground;break;case 257:this.colors.background=this._restoreColors.background;break;case 258:this.colors.cursor=this._restoreColors.cursor;break;default:this.colors.ansi[t]=this._restoreColors.ansi[t]}else for(let t=0;t<this._restoreColors.ansi.length;++t)this.colors.ansi[t]=this._restoreColors.ansi[t]}_updateRestoreColors(){this._restoreColors={foreground:this.colors.foreground,background:this.colors.background,cursor:this.colors.cursor,ansi:this.colors.ansi.slice()}}_parseColor(t,a,u=this.allowTransparency){if(void 0===t)return a;if(this._ctx.fillStyle=this._litmusColor,this._ctx.fillStyle=t,"string"!=typeof this._ctx.fillStyle)return console.warn(`Color: ${t} is invalid using fallback ${a.css}`),a;this._ctx.fillRect(0,0,1,1);const f=this._ctx.getImageData(0,0,1,1).data;if(255!==f[3]){if(!u)return console.warn(`Color: ${t} is using transparency, but allowTransparency is false. Using fallback ${a.css}.`),a;const[f,p,v,g]=this._ctx.fillStyle.substring(5,this._ctx.fillStyle.length-1).split(",").map((t=>Number(t))),m=Math.round(255*g);return{rgba:_.channels.toRgba(f,p,v,m),css:t}}return{css:this._ctx.fillStyle,rgba:_.channels.toRgba(f[0],f[1],f[2],f[3])}}}},9631:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.removeElementFromParent=void 0,a.removeElementFromParent=function(...t){var a;for(const u of t)null===(a=null==u?void 0:u.parentElement)||void 0===a||a.removeChild(u)}},3656:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.addDisposableDomListener=void 0,a.addDisposableDomListener=function(t,a,u,_){t.addEventListener(a,u,_);let f=!1;return{dispose:()=>{f||(f=!0,t.removeEventListener(a,u,_))}}}},6465:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.Linkifier2=void 0;const p=u(2585),v=u(8460),g=u(844),m=u(3656);let S=class extends g.Disposable{constructor(t){super(),this._bufferService=t,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._activeLine=-1,this._onShowLinkUnderline=this.register(new v.EventEmitter),this._onHideLinkUnderline=this.register(new v.EventEmitter),this.register((0,g.getDisposeArrayDisposable)(this._linkCacheDisposables))}get currentLink(){return this._currentLink}get onShowLinkUnderline(){return this._onShowLinkUnderline.event}get onHideLinkUnderline(){return this._onHideLinkUnderline.event}dispose(){super.dispose(),this._lastMouseEvent=void 0}registerLinkProvider(t){return this._linkProviders.push(t),{dispose:()=>{const a=this._linkProviders.indexOf(t);-1!==a&&this._linkProviders.splice(a,1)}}}attachToDom(t,a,u){this._element=t,this._mouseService=a,this._renderService=u,this.register((0,m.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,m.addDisposableDomListener)(this._element,"mousemove",this._onMouseMove.bind(this))),this.register((0,m.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,m.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_onMouseMove(t){if(this._lastMouseEvent=t,!this._element||!this._mouseService)return;const a=this._positionFromMouseEvent(t,this._element,this._mouseService);if(!a)return;this._isMouseOut=!1;const u=t.composedPath();for(let t=0;t<u.length;t++){const a=u[t];if(a.classList.contains("xterm"))break;if(a.classList.contains("xterm-hover"))return}this._lastBufferCell&&a.x===this._lastBufferCell.x&&a.y===this._lastBufferCell.y||(this._onHover(a),this._lastBufferCell=a)}_onHover(t){if(this._activeLine!==t.y)return this._clearCurrentLink(),void this._askForLink(t,!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,t)||(this._clearCurrentLink(),this._askForLink(t,!0))}_askForLink(t,a){var u,_;this._activeProviderReplies&&a||(null===(u=this._activeProviderReplies)||void 0===u||u.forEach((t=>{null==t||t.forEach((t=>{t.link.dispose&&t.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=t.y);let f=!1;for(const[u,p]of this._linkProviders.entries())a?(null===(_=this._activeProviderReplies)||void 0===_?void 0:_.get(u))&&(f=this._checkLinkProviderResult(u,t,f)):p.provideLinks(t.y,(a=>{var _,p;if(this._isMouseOut)return;const v=null==a?void 0:a.map((t=>({link:t})));null===(_=this._activeProviderReplies)||void 0===_||_.set(u,v),f=this._checkLinkProviderResult(u,t,f),(null===(p=this._activeProviderReplies)||void 0===p?void 0:p.size)===this._linkProviders.length&&this._removeIntersectingLinks(t.y,this._activeProviderReplies)}))}_removeIntersectingLinks(t,a){const u=new Set;for(let _=0;_<a.size;_++){const f=a.get(_);if(f)for(let a=0;a<f.length;a++){const _=f[a],p=_.link.range.start.y<t?0:_.link.range.start.x,v=_.link.range.end.y>t?this._bufferService.cols:_.link.range.end.x;for(let t=p;t<=v;t++){if(u.has(t)){f.splice(a--,1);break}u.add(t)}}}}_checkLinkProviderResult(t,a,u){var _;if(!this._activeProviderReplies)return u;const f=this._activeProviderReplies.get(t);let p=!1;for(let a=0;a<t;a++)this._activeProviderReplies.has(a)&&!this._activeProviderReplies.get(a)||(p=!0);if(!p&&f){const t=f.find((t=>this._linkAtPosition(t.link,a)));t&&(u=!0,this._handleNewLink(t))}if(this._activeProviderReplies.size===this._linkProviders.length&&!u)for(let t=0;t<this._activeProviderReplies.size;t++){const f=null===(_=this._activeProviderReplies.get(t))||void 0===_?void 0:_.find((t=>this._linkAtPosition(t.link,a)));if(f){u=!0,this._handleNewLink(f);break}}return u}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(t){if(!this._element||!this._mouseService||!this._currentLink)return;const a=this._positionFromMouseEvent(t,this._element,this._mouseService);a&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,a)&&this._currentLink.link.activate(t,this._currentLink.link.text)}_clearCurrentLink(t,a){this._element&&this._currentLink&&this._lastMouseEvent&&(!t||!a||this._currentLink.link.range.start.y>=t&&this._currentLink.link.range.end.y<=a)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,g.disposeArray)(this._linkCacheDisposables))}_handleNewLink(t){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;const a=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);a&&this._linkAtPosition(t.link,a)&&(this._currentLink=t,this._currentLink.state={decorations:{underline:void 0===t.link.decorations||t.link.decorations.underline,pointerCursor:void 0===t.link.decorations||t.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,t.link,this._lastMouseEvent),t.link.decorations={},Object.defineProperties(t.link.decorations,{pointerCursor:{get:()=>{var t,a;return null===(a=null===(t=this._currentLink)||void 0===t?void 0:t.state)||void 0===a?void 0:a.decorations.pointerCursor},set:t=>{var a,u;(null===(a=this._currentLink)||void 0===a?void 0:a.state)&&this._currentLink.state.decorations.pointerCursor!==t&&(this._currentLink.state.decorations.pointerCursor=t,this._currentLink.state.isHovered&&(null===(u=this._element)||void 0===u||u.classList.toggle("xterm-cursor-pointer",t)))}},underline:{get:()=>{var t,a;return null===(a=null===(t=this._currentLink)||void 0===t?void 0:t.state)||void 0===a?void 0:a.decorations.underline},set:a=>{var u,_,f;(null===(u=this._currentLink)||void 0===u?void 0:u.state)&&(null===(f=null===(_=this._currentLink)||void 0===_?void 0:_.state)||void 0===f?void 0:f.decorations.underline)!==a&&(this._currentLink.state.decorations.underline=a,this._currentLink.state.isHovered&&this._fireUnderlineEvent(t.link,a))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((t=>{const a=0===t.start?0:t.start+1+this._bufferService.buffer.ydisp;this._clearCurrentLink(a,t.end+1+this._bufferService.buffer.ydisp)}))))}_linkHover(t,a,u){var _;(null===(_=this._currentLink)||void 0===_?void 0:_.state)&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(a,!0),this._currentLink.state.decorations.pointerCursor&&t.classList.add("xterm-cursor-pointer")),a.hover&&a.hover(u,a.text)}_fireUnderlineEvent(t,a){const u=t.range,_=this._bufferService.buffer.ydisp,f=this._createLinkUnderlineEvent(u.start.x-1,u.start.y-_-1,u.end.x,u.end.y-_-1,void 0);(a?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(f)}_linkLeave(t,a,u){var _;(null===(_=this._currentLink)||void 0===_?void 0:_.state)&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(a,!1),this._currentLink.state.decorations.pointerCursor&&t.classList.remove("xterm-cursor-pointer")),a.leave&&a.leave(u,a.text)}_linkAtPosition(t,a){const u=t.range.start.y===t.range.end.y,_=t.range.start.y<a.y,f=t.range.end.y>a.y;return(u&&t.range.start.x<=a.x&&t.range.end.x>=a.x||_&&t.range.end.x>=a.x||f&&t.range.start.x<=a.x||_&&f)&&t.range.start.y<=a.y&&t.range.end.y>=a.y}_positionFromMouseEvent(t,a,u){const _=u.getCoords(t,a,this._bufferService.cols,this._bufferService.rows);if(_)return{x:_[0],y:_[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(t,a,u,_,f){return{x1:t,y1:a,x2:u,y2:_,cols:this._bufferService.cols,fg:f}}};S=_([f(0,p.IBufferService)],S),a.Linkifier2=S},9042:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.tooMuchOutput=a.promptLabel=void 0,a.promptLabel="Terminal input",a.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},2962:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.OscLinkProvider=void 0;const p=u(511),v=u(2585);let g=class{constructor(t,a,u){this._bufferService=t,this._optionsService=a,this._oscLinkService=u}provideLinks(t,a){var u;const _=this._bufferService.buffer.lines.get(t-1);if(!_)return void a(void 0);const f=[],v=this._optionsService.rawOptions.linkHandler,g=new p.CellData,S=_.getTrimmedLength();let y=-1,w=-1,x=!1;for(let a=0;a<S;a++)if(-1!==w||_.hasContent(a)){if(_.loadCell(a,g),g.hasExtendedAttrs()&&g.extended.urlId){if(-1===w){w=a,y=g.extended.urlId;continue}x=g.extended.urlId!==y}else-1!==w&&(x=!0);if(x||-1!==w&&a===S-1){const _=null===(u=this._oscLinkService.getLinkData(y))||void 0===u?void 0:u.uri;if(_){const u={start:{x:w+1,y:t},end:{x:a+(x||a!==S-1?0:1),y:t}};f.push({text:_,range:u,activate:(t,a)=>v?v.activate(t,a,u):m(0,a),hover:(t,a)=>{var _;return null===(_=null==v?void 0:v.hover)||void 0===_?void 0:_.call(v,t,a,u)},leave:(t,a)=>{var _;return null===(_=null==v?void 0:v.leave)||void 0===_?void 0:_.call(v,t,a,u)}})}x=!1,g.hasExtendedAttrs()&&g.extended.urlId?(w=a,y=g.extended.urlId):(w=-1,y=-1)}}a(f)}};function m(t,a){if(confirm(`Do you want to navigate to ${a}?`)){const u=window.open();if(u){try{u.opener=null}catch(t){}u.location.href=a}else console.warn("Opening link blocked as opener could not be cleared")}}g=_([f(0,v.IBufferService),f(1,v.IOptionsService),f(2,v.IOscLinkService)],g),a.OscLinkProvider=g},6193:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.RenderDebouncer=void 0,a.RenderDebouncer=class{constructor(t,a){this._parentWindow=t,this._renderCallback=a,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(t){return this._refreshCallbacks.push(t),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(t,a,u){this._rowCount=u,t=void 0!==t?t:0,a=void 0!==a?a:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,t):t,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,a):a,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();const t=Math.max(this._rowStart,0),a=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(t,a),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const t of this._refreshCallbacks)t(0);this._refreshCallbacks=[]}}},5596:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ScreenDprMonitor=void 0;const _=u(844);class r extends _.Disposable{constructor(t){super(),this._parentWindow=t,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio}setListener(t){this._listener&&this.clearListener(),this._listener=t,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}dispose(){super.dispose(),this.clearListener()}_updateDpr(){var t;this._outerListener&&(null===(t=this._resolutionMediaMatchList)||void 0===t||t.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}a.ScreenDprMonitor=r},3236:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Terminal=void 0;const _=u(2950),f=u(1680),p=u(3614),v=u(2584),g=u(5435),m=u(9312),S=u(6114),y=u(3656),w=u(9042),x=u(4567),E=u(1296),j=u(7399),k=u(8460),T=u(8437),L=u(5680),A=u(3230),R=u(4725),D=u(428),M=u(8934),B=u(6465),I=u(5114),P=u(8969),H=u(8055),F=u(4269),$=u(5941),z=u(3107),N=u(5744),W=u(9074),V=u(2585),U=u(2962),K="undefined"!=typeof window?window.document:null;class O extends P.CoreTerminal{constructor(t={}){super(t),this.browser=S,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._onCursorMove=new k.EventEmitter,this._onKey=new k.EventEmitter,this._onRender=new k.EventEmitter,this._onSelectionChange=new k.EventEmitter,this._onTitleChange=new k.EventEmitter,this._onBell=new k.EventEmitter,this._onFocus=new k.EventEmitter,this._onBlur=new k.EventEmitter,this._onA11yCharEmitter=new k.EventEmitter,this._onA11yTabEmitter=new k.EventEmitter,this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(B.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(U.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(W.DecorationService),this._instantiationService.setService(V.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((t,a)=>this.refresh(t,a)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((t=>this._reportWindowsOptions(t)))),this.register(this._inputHandler.onColor((t=>this._handleColorEvent(t)))),this.register((0,k.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,k.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,k.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,k.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((t=>this._afterResize(t.cols,t.rows))))}get onCursorMove(){return this._onCursorMove.event}get onKey(){return this._onKey.event}get onRender(){return this._onRender.event}get onSelectionChange(){return this._onSelectionChange.event}get onTitleChange(){return this._onTitleChange.event}get onBell(){return this._onBell.event}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}_handleColorEvent(t){var a,u;if(this._colorManager){for(const a of t){let t,u="";switch(a.index){case 256:t="foreground",u="10";break;case 257:t="background",u="11";break;case 258:t="cursor",u="12";break;default:t="ansi",u="4;"+a.index}switch(a.type){case 0:const _=H.color.toColorRGB("ansi"===t?this._colorManager.colors.ansi[a.index]:this._colorManager.colors[t]);this.coreService.triggerDataEvent(`${v.C0.ESC}]${u};${(0,$.toRgbString)(_)}${v.C1_ESCAPED.ST}`);break;case 1:"ansi"===t?this._colorManager.colors.ansi[a.index]=H.rgba.toColor(...a.color):this._colorManager.colors[t]=H.rgba.toColor(...a.color);break;case 2:this._colorManager.restoreColor(a.index)}}null===(a=this._renderService)||void 0===a||a.setColors(this._colorManager.colors),null===(u=this.viewport)||void 0===u||u.onThemeChange(this._colorManager.colors)}}dispose(){var t,a,u;this._isDisposed||(super.dispose(),null===(t=this._renderService)||void 0===t||t.dispose(),this._customKeyEventHandler=void 0,this.write=()=>{},null===(u=null===(a=this.element)||void 0===a?void 0:a.parentNode)||void 0===u||u.removeChild(this.element))}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_updateOptions(t){var a,u,_,f;switch(super._updateOptions(t),t){case"fontFamily":case"fontSize":null===(a=this._renderService)||void 0===a||a.clear(),null===(u=this._charSizeService)||void 0===u||u.measure();break;case"cursorBlink":case"cursorStyle":this.refresh(this.buffer.y,this.buffer.y);break;case"customGlyphs":case"drawBoldTextInBrightColors":case"letterSpacing":case"lineHeight":case"fontWeight":case"fontWeightBold":case"minimumContrastRatio":this._renderService&&(this._renderService.clear(),this._renderService.onResize(this.cols,this.rows),this.refresh(0,this.rows-1));break;case"scrollback":null===(_=this.viewport)||void 0===_||_.syncScrollArea();break;case"screenReaderMode":this.optionsService.rawOptions.screenReaderMode?!this._accessibilityManager&&this._renderService&&(this._accessibilityManager=new x.AccessibilityManager(this,this._renderService)):(null===(f=this._accessibilityManager)||void 0===f||f.dispose(),this._accessibilityManager=void 0);break;case"tabStopWidth":this.buffers.setupTabStops();break;case"theme":this._setTheme(this.optionsService.rawOptions.theme)}}_onTextAreaFocus(t){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(v.C0.ESC+"[I"),this.updateCursorStyle(t),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var t;return null===(t=this.textarea)||void 0===t?void 0:t.blur()}_onTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(v.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const t=this.buffer.ybase+this.buffer.y,a=this.buffer.lines.get(t);if(!a)return;const u=Math.min(this.buffer.x,this.cols-1),_=this._renderService.dimensions.actualCellHeight,f=a.getWidth(u),p=this._renderService.dimensions.actualCellWidth*f,v=this.buffer.y*this._renderService.dimensions.actualCellHeight,g=u*this._renderService.dimensions.actualCellWidth;this.textarea.style.left=g+"px",this.textarea.style.top=v+"px",this.textarea.style.width=p+"px",this.textarea.style.height=_+"px",this.textarea.style.lineHeight=_+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,y.addDisposableDomListener)(this.element,"copy",(t=>{this.hasSelection()&&(0,p.copyHandler)(t,this._selectionService)})));const t=t=>(0,p.handlePasteEvent)(t,this.textarea,this.coreService);this.register((0,y.addDisposableDomListener)(this.textarea,"paste",t)),this.register((0,y.addDisposableDomListener)(this.element,"paste",t)),S.isFirefox?this.register((0,y.addDisposableDomListener)(this.element,"mousedown",(t=>{2===t.button&&(0,p.rightClickHandler)(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,y.addDisposableDomListener)(this.element,"contextmenu",(t=>{(0,p.rightClickHandler)(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),S.isLinux&&this.register((0,y.addDisposableDomListener)(this.element,"auxclick",(t=>{1===t.button&&(0,p.moveTextAreaUnderMouseCursor)(t,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,y.addDisposableDomListener)(this.textarea,"keyup",(t=>this._keyUp(t)),!0)),this.register((0,y.addDisposableDomListener)(this.textarea,"keydown",(t=>this._keyDown(t)),!0)),this.register((0,y.addDisposableDomListener)(this.textarea,"keypress",(t=>this._keyPress(t)),!0)),this.register((0,y.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,y.addDisposableDomListener)(this.textarea,"compositionupdate",(t=>this._compositionHelper.compositionupdate(t)))),this.register((0,y.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,y.addDisposableDomListener)(this.textarea,"input",(t=>this._inputEvent(t)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(t){var a;if(!t)throw new Error("Terminal requires a parent element.");t.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=t.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),t.appendChild(this.element);const u=K.createDocumentFragment();this._viewportElement=K.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),u.appendChild(this._viewportElement),this._viewportScrollArea=K.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=K.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=K.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),u.appendChild(this.screenElement),this.textarea=K.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",w.promptLabel),this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this.register((0,y.addDisposableDomListener)(this.textarea,"focus",(t=>this._onTextAreaFocus(t)))),this.register((0,y.addDisposableDomListener)(this.textarea,"blur",(()=>this._onTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._coreBrowserService=this._instantiationService.createInstance(I.CoreBrowserService,this.textarea,null!==(a=this._document.defaultView)&&void 0!==a?a:window),this._instantiationService.setService(R.ICoreBrowserService,this._coreBrowserService),this._charSizeService=this._instantiationService.createInstance(D.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(R.ICharSizeService,this._charSizeService),this._theme=this.options.theme||this._theme,this._colorManager=new L.ColorManager(K,this.options.allowTransparency),this.register(this.optionsService.onOptionChange((t=>this._colorManager.onOptionsChange(t,this.optionsService.rawOptions[t])))),this._colorManager.setTheme(this._theme),this._characterJoinerService=this._instantiationService.createInstance(F.CharacterJoinerService),this._instantiationService.setService(R.ICharacterJoinerService,this._characterJoinerService);const p=this._createRenderer();this._renderService=this.register(this._instantiationService.createInstance(A.RenderService,p,this.rows,this.screenElement)),this._instantiationService.setService(R.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((t=>this._onRender.fire(t)))),this.onResize((t=>this._renderService.resize(t.cols,t.rows))),this._compositionView=K.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(_.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(u),this._mouseService=this._instantiationService.createInstance(M.MouseService),this._instantiationService.setService(R.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(f.Viewport,(t=>this.scrollLines(t,!0,1)),this._viewportElement,this._viewportScrollArea,this.element),this.viewport.onThemeChange(this._colorManager.colors),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.onCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.onResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.onBlur()))),this.register(this.onFocus((()=>this._renderService.onFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(m.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(R.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((t=>this.scrollLines(t.amount,t.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((t=>this._renderService.onSelectionChanged(t.start,t.end,t.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((t=>{this.textarea.value=t,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((t=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,y.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(z.BufferDecorationRenderer,this.screenElement)),this.register((0,y.addDisposableDomListener)(this.element,"mousedown",(t=>this._selectionService.onMouseDown(t)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new x.AccessibilityManager(this,this._renderService)),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(N.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onOptionChange((()=>{!this._overviewRulerRenderer&&this.options.overviewRulerWidth&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(N.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(E.DomRenderer,this._colorManager.colors,this.element,this.screenElement,this._viewportElement,this.linkifier2)}_setTheme(t){var a,u,_;this._theme=t,null===(a=this._colorManager)||void 0===a||a.setTheme(t),null===(u=this._renderService)||void 0===u||u.setColors(this._colorManager.colors),null===(_=this.viewport)||void 0===_||_.onThemeChange(this._colorManager.colors)}bindMouse(){const t=this,a=this.element;function u(a){const u=t._mouseService.getMouseReportCoords(a,t.screenElement);if(!u)return!1;let _,f;switch(a.overrideType||a.type){case"mousemove":f=32,void 0===a.buttons?(_=3,void 0!==a.button&&(_=a.button<3?a.button:3)):_=1&a.buttons?0:4&a.buttons?1:2&a.buttons?2:3;break;case"mouseup":f=0,_=a.button<3?a.button:3;break;case"mousedown":f=1,_=a.button<3?a.button:3;break;case"wheel":if(0===t.viewport.getLinesScrolled(a))return!1;f=a.deltaY<0?0:1,_=4;break;default:return!1}return!(void 0===f||void 0===_||_>4)&&t.coreMouseService.triggerMouseEvent({col:u.col,row:u.row,x:u.x,y:u.y,button:_,action:f,ctrl:a.ctrlKey,alt:a.altKey,shift:a.shiftKey})}const _={mouseup:null,wheel:null,mousedrag:null,mousemove:null},f={mouseup:t=>(u(t),t.buttons||(this._document.removeEventListener("mouseup",_.mouseup),_.mousedrag&&this._document.removeEventListener("mousemove",_.mousedrag)),this.cancel(t)),wheel:t=>(u(t),this.cancel(t,!0)),mousedrag:t=>{t.buttons&&u(t)},mousemove:t=>{t.buttons||u(t)}};this.register(this.coreMouseService.onProtocolChange((t=>{t?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(t)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&t?_.mousemove||(a.addEventListener("mousemove",f.mousemove),_.mousemove=f.mousemove):(a.removeEventListener("mousemove",_.mousemove),_.mousemove=null),16&t?_.wheel||(a.addEventListener("wheel",f.wheel,{passive:!1}),_.wheel=f.wheel):(a.removeEventListener("wheel",_.wheel),_.wheel=null),2&t?_.mouseup||(_.mouseup=f.mouseup):(this._document.removeEventListener("mouseup",_.mouseup),_.mouseup=null),4&t?_.mousedrag||(_.mousedrag=f.mousedrag):(this._document.removeEventListener("mousemove",_.mousedrag),_.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,y.addDisposableDomListener)(a,"mousedown",(t=>{if(t.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(t))return u(t),_.mouseup&&this._document.addEventListener("mouseup",_.mouseup),_.mousedrag&&this._document.addEventListener("mousemove",_.mousedrag),this.cancel(t)}))),this.register((0,y.addDisposableDomListener)(a,"wheel",(t=>{if(!_.wheel){if(!this.buffer.hasScrollback){const a=this.viewport.getLinesScrolled(t);if(0===a)return;const u=v.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(t.deltaY<0?"A":"B");let _="";for(let t=0;t<Math.abs(a);t++)_+=u;return this.coreService.triggerDataEvent(_,!0),this.cancel(t,!0)}return this.viewport.onWheel(t)?this.cancel(t):void 0}}),{passive:!1})),this.register((0,y.addDisposableDomListener)(a,"touchstart",(t=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.onTouchStart(t),this.cancel(t)}),{passive:!0})),this.register((0,y.addDisposableDomListener)(a,"touchmove",(t=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.onTouchMove(t)?void 0:this.cancel(t)}),{passive:!1}))}refresh(t,a){var u;null===(u=this._renderService)||void 0===u||u.refreshRows(t,a)}updateCursorStyle(t){var a;(null===(a=this._selectionService)||void 0===a?void 0:a.shouldColumnSelect(t))?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(t,a,u=0){super.scrollLines(t,a,u),this.refresh(0,this.rows-1)}paste(t){(0,p.paste)(t,this.textarea,this.coreService)}attachCustomKeyEventHandler(t){this._customKeyEventHandler=t}registerLinkProvider(t){return this.linkifier2.registerLinkProvider(t)}registerCharacterJoiner(t){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const a=this._characterJoinerService.register(t);return this.refresh(0,this.rows-1),a}deregisterCharacterJoiner(t){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(t)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}addMarker(t){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+t)}registerDecoration(t){return this._decorationService.registerDecoration(t)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(t,a,u){this._selectionService.setSelection(t,a,u)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var t;null===(t=this._selectionService)||void 0===t||t.clearSelection()}selectAll(){var t;null===(t=this._selectionService)||void 0===t||t.selectAll()}selectLines(t,a){var u;null===(u=this._selectionService)||void 0===u||u.selectLines(t,a)}_keyDown(t){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(t))return!1;const a=this.browser.isMac&&this.options.macOptionIsMeta&&t.altKey;if(!a&&!this._compositionHelper.keydown(t))return this.buffer.ybase!==this.buffer.ydisp&&this._bufferService.scrollToBottom(),!1;a||"Dead"!==t.key&&"AltGraph"!==t.key||(this._unprocessedDeadKey=!0);const u=(0,j.evaluateKeyboardEvent)(t,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(t),3===u.type||2===u.type){const a=this.rows-1;return this.scrollLines(2===u.type?-a:a),this.cancel(t,!0)}return 1===u.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,t)||(u.cancel&&this.cancel(t,!0),!u.key||!!(t.key&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&1===t.key.length&&t.key.charCodeAt(0)>=65&&t.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(u.key!==v.C0.ETX&&u.key!==v.C0.CR||(this.textarea.value=""),this._onKey.fire({key:u.key,domEvent:t}),this._showCursor(),this.coreService.triggerDataEvent(u.key,!0),this.optionsService.rawOptions.screenReaderMode?void(this._keyDownHandled=!0):this.cancel(t,!0))))}_isThirdLevelShift(t,a){const u=t.isMac&&!this.options.macOptionIsMeta&&a.altKey&&!a.ctrlKey&&!a.metaKey||t.isWindows&&a.altKey&&a.ctrlKey&&!a.metaKey||t.isWindows&&a.getModifierState("AltGraph");return"keypress"===a.type?u:u&&(!a.keyCode||a.keyCode>47)}_keyUp(t){this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(t)||(function(t){return 16===t.keyCode||17===t.keyCode||18===t.keyCode}(t)||this.focus(),this.updateCursorStyle(t),this._keyPressHandled=!1)}_keyPress(t){let a;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(t))return!1;if(this.cancel(t),t.charCode)a=t.charCode;else if(null===t.which||void 0===t.which)a=t.keyCode;else{if(0===t.which||0===t.charCode)return!1;a=t.which}return!(!a||(t.altKey||t.ctrlKey||t.metaKey)&&!this._isThirdLevelShift(this.browser,t)||(a=String.fromCharCode(a),this._onKey.fire({key:a,domEvent:t}),this._showCursor(),this.coreService.triggerDataEvent(a,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(t){if(t.data&&"insertText"===t.inputType&&(!t.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const a=t.data;return this.coreService.triggerDataEvent(a,!0),this.cancel(t),!0}return!1}resize(t,a){t!==this.cols||a!==this.rows?super.resize(t,a):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(t,a){var u,_;null===(u=this._charSizeService)||void 0===u||u.measure(),null===(_=this.viewport)||void 0===_||_.syncScrollArea(!0)}clear(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let t=1;t<this.rows;t++)this.buffer.lines.push(this.buffer.getBlankLine(T.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){var t,a;this.options.rows=this.rows,this.options.cols=this.cols;const u=this._customKeyEventHandler;this._setup(),super.reset(),null===(t=this._selectionService)||void 0===t||t.reset(),this._decorationService.reset(),this._customKeyEventHandler=u,this.refresh(0,this.rows-1),null===(a=this.viewport)||void 0===a||a.syncScrollArea()}clearTextureAtlas(){var t;null===(t=this._renderService)||void 0===t||t.clearTextureAtlas()}_reportFocus(){var t;(null===(t=this.element)||void 0===t?void 0:t.classList.contains("focus"))?this.coreService.triggerDataEvent(v.C0.ESC+"[I"):this.coreService.triggerDataEvent(v.C0.ESC+"[O")}_reportWindowsOptions(t){if(this._renderService)switch(t){case g.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const t=this._renderService.dimensions.canvasWidth.toFixed(0),a=this._renderService.dimensions.canvasHeight.toFixed(0);this.coreService.triggerDataEvent(`${v.C0.ESC}[4;${a};${t}t`);break;case g.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const u=this._renderService.dimensions.actualCellWidth.toFixed(0),_=this._renderService.dimensions.actualCellHeight.toFixed(0);this.coreService.triggerDataEvent(`${v.C0.ESC}[6;${_};${u}t`)}}cancel(t,a){if(this.options.cancelEvents||a)return t.preventDefault(),t.stopPropagation(),!1}}a.Terminal=O},9924:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.TimeBasedDebouncer=void 0,a.TimeBasedDebouncer=class{constructor(t,a=1e3){this._renderCallback=t,this._debounceThresholdMS=a,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(t,a,u){this._rowCount=u,t=void 0!==t?t:0,a=void 0!==a?a:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,t):t,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,a):a;const _=Date.now();if(_-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=_,this._innerRefresh();else if(!this._additionalRefreshRequested){const t=_-this._lastRefreshMs,a=this._debounceThresholdMS-t;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),a)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;const t=Math.max(this._rowStart,0),a=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(t,a)}}},1680:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.Viewport=void 0;const p=u(844),v=u(3656),g=u(4725),m=u(2585);let S=class extends p.Disposable{constructor(t,a,u,_,f,p,g,m,S){super(),this._scrollLines=t,this._viewportElement=a,this._scrollArea=u,this._element=_,this._bufferService=f,this._optionsService=p,this._charSizeService=g,this._renderService=m,this._coreBrowserService=S,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentScaledCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,v.addDisposableDomListener)(this._viewportElement,"scroll",this._onScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((t=>this._activeBuffer=t.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((t=>this._renderDimensions=t))),setTimeout((()=>this.syncScrollArea()),0)}onThemeChange(t){this._viewportElement.style.backgroundColor=t.background.css}_refresh(t){if(t)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.scaledCellHeight/this._coreBrowserService.dpr,this._currentScaledCellHeight=this._renderService.dimensions.scaledCellHeight,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const t=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.canvasHeight);this._lastRecordedBufferHeight!==t&&(this._lastRecordedBufferHeight=t,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const t=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==t&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=t),this._refreshAnimationFrame=null}syncScrollArea(t=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(t);this._lastRecordedViewportHeight===this._renderService.dimensions.canvasHeight&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.scaledCellHeight===this._currentScaledCellHeight||this._refresh(t)}_onScroll(t){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._scrollLines(0);const a=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines(a)}_smoothScroll(){if(this._isDisposed||-1===this._smoothScrollState.origin||-1===this._smoothScrollState.target)return;const t=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(t*(this._smoothScrollState.target-this._smoothScrollState.origin)),t<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(t,a){const u=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(a<0&&0!==this._viewportElement.scrollTop||a>0&&u<this._lastRecordedBufferHeight)||(t.cancelable&&t.preventDefault(),!1)}onWheel(t){const a=this._getPixelsScrolled(t);return 0!==a&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,-1===this._smoothScrollState.target?this._smoothScrollState.target=this._viewportElement.scrollTop+a:this._smoothScrollState.target+=a,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=a,this._bubbleScroll(t,a))}_getPixelsScrolled(t){if(0===t.deltaY||t.shiftKey)return 0;let a=this._applyScrollModifier(t.deltaY,t);return t.deltaMode===WheelEvent.DOM_DELTA_LINE?a*=this._currentRowHeight:t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(a*=this._currentRowHeight*this._bufferService.rows),a}getLinesScrolled(t){if(0===t.deltaY||t.shiftKey)return 0;let a=this._applyScrollModifier(t.deltaY,t);return t.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(a/=this._currentRowHeight+0,this._wheelPartialScroll+=a,a=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(a*=this._bufferService.rows),a}_applyScrollModifier(t,a){const u=this._optionsService.rawOptions.fastScrollModifier;return"alt"===u&&a.altKey||"ctrl"===u&&a.ctrlKey||"shift"===u&&a.shiftKey?t*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:t*this._optionsService.rawOptions.scrollSensitivity}onTouchStart(t){this._lastTouchY=t.touches[0].pageY}onTouchMove(t){const a=this._lastTouchY-t.touches[0].pageY;return this._lastTouchY=t.touches[0].pageY,0!==a&&(this._viewportElement.scrollTop+=a,this._bubbleScroll(t,a))}};S=_([f(4,m.IBufferService),f(5,m.IOptionsService),f(6,g.ICharSizeService),f(7,g.IRenderService),f(8,g.ICoreBrowserService)],S),a.Viewport=S},3107:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.BufferDecorationRenderer=void 0;const p=u(3656),v=u(4725),g=u(844),m=u(2585);let S=class extends g.Disposable{constructor(t,a,u,_){super(),this._screenElement=t,this._bufferService=a,this._decorationService=u,this._renderService=_,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register((0,p.addDisposableDomListener)(window,"resize",(()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((t=>this._removeDecoration(t))))}dispose(){this._container.remove(),this._decorationElements.clear(),super.dispose()}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this.refreshDecorations(),this._animationFrame=void 0})))}refreshDecorations(){for(const t of this._decorationService.decorations)this._renderDecoration(t);this._dimensionsChanged=!1}_renderDecoration(t){this._refreshStyle(t),this._dimensionsChanged&&this._refreshXPosition(t)}_createElement(t){var a;const u=document.createElement("div");u.classList.add("xterm-decoration"),u.style.width=`${Math.round((t.options.width||1)*this._renderService.dimensions.actualCellWidth)}px`,u.style.height=(t.options.height||1)*this._renderService.dimensions.actualCellHeight+"px",u.style.top=(t.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.actualCellHeight+"px",u.style.lineHeight=`${this._renderService.dimensions.actualCellHeight}px`;const _=null!==(a=t.options.x)&&void 0!==a?a:0;return _&&_>this._bufferService.cols&&(u.style.display="none"),this._refreshXPosition(t,u),u}_refreshStyle(t){const a=t.marker.line-this._bufferService.buffers.active.ydisp;if(a<0||a>=this._bufferService.rows)t.element&&(t.element.style.display="none",t.onRenderEmitter.fire(t.element));else{let u=this._decorationElements.get(t);u||(t.onDispose((()=>this._removeDecoration(t))),u=this._createElement(t),t.element=u,this._decorationElements.set(t,u),this._container.appendChild(u)),u.style.top=a*this._renderService.dimensions.actualCellHeight+"px",u.style.display=this._altBufferIsActive?"none":"block",t.onRenderEmitter.fire(u)}}_refreshXPosition(t,a=t.element){var u;if(!a)return;const _=null!==(u=t.options.x)&&void 0!==u?u:0;"right"===(t.options.anchor||"left")?a.style.right=_?_*this._renderService.dimensions.actualCellWidth+"px":"":a.style.left=_?_*this._renderService.dimensions.actualCellWidth+"px":""}_removeDecoration(t){var a;null===(a=this._decorationElements.get(t))||void 0===a||a.remove(),this._decorationElements.delete(t)}};S=_([f(1,m.IBufferService),f(2,m.IDecorationService),f(3,v.IRenderService)],S),a.BufferDecorationRenderer=S},5871:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ColorZoneStore=void 0,a.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(t){if(t.options.overviewRulerOptions){for(const a of this._zones)if(a.color===t.options.overviewRulerOptions.color&&a.position===t.options.overviewRulerOptions.position){if(this._lineIntersectsZone(a,t.marker.line))return;if(this._lineAdjacentToZone(a,t.marker.line,t.options.overviewRulerOptions.position))return void this._addLineToZone(a,t.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=t.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=t.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=t.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=t.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:t.options.overviewRulerOptions.color,position:t.options.overviewRulerOptions.position,startBufferLine:t.marker.line,endBufferLine:t.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(t){this._linePadding=t}_lineIntersectsZone(t,a){return a>=t.startBufferLine&&a<=t.endBufferLine}_lineAdjacentToZone(t,a,u){return a>=t.startBufferLine-this._linePadding[u||"full"]&&a<=t.endBufferLine+this._linePadding[u||"full"]}_addLineToZone(t,a){t.startBufferLine=Math.min(t.startBufferLine,a),t.endBufferLine=Math.max(t.endBufferLine,a)}}},5744:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.OverviewRulerRenderer=void 0;const p=u(5871),v=u(3656),g=u(4725),m=u(844),S=u(2585),y={full:0,left:0,center:0,right:0},w={full:0,left:0,center:0,right:0},x={full:0,left:0,center:0,right:0};let E=class extends m.Disposable{constructor(t,a,u,_,f,v,g){var m;super(),this._viewportElement=t,this._screenElement=a,this._bufferService=u,this._decorationService=_,this._renderService=f,this._optionsService=v,this._coreBrowseService=g,this._colorZoneStore=new p.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),null===(m=this._viewportElement.parentElement)||void 0===m||m.insertBefore(this._canvas,this._viewportElement);const S=this._canvas.getContext("2d");if(!S)throw new Error("Ctx cannot be null");this._ctx=S,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners()}get _width(){return this._optionsService.options.overviewRulerWidth||0}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onOptionChange((t=>{"overviewRulerWidth"===t&&this._queueRefresh(!0)}))),this.register((0,v.addDisposableDomListener)(this._coreBrowseService.window,"resize",(()=>{this._queueRefresh(!0)}))),this._queueRefresh(!0)}dispose(){var t;null===(t=this._canvas)||void 0===t||t.remove(),super.dispose()}_refreshDrawConstants(){const t=Math.floor(this._canvas.width/3),a=Math.ceil(this._canvas.width/3);w.full=this._canvas.width,w.left=t,w.center=a,w.right=t,this._refreshDrawHeightConstants(),x.full=0,x.left=0,x.center=w.left,x.right=w.left+w.center}_refreshDrawHeightConstants(){y.full=Math.round(2*this._coreBrowseService.dpr);const t=this._canvas.height/this._bufferService.buffer.lines.length,a=Math.round(Math.max(Math.min(t,12),6)*this._coreBrowseService.dpr);y.left=a,y.center=a,y.right=a}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const t of this._decorationService.decorations)this._colorZoneStore.addDecoration(t);this._ctx.lineWidth=1;const t=this._colorZoneStore.zones;for(const a of t)"full"!==a.position&&this._renderColorZone(a);for(const a of t)"full"===a.position&&this._renderColorZone(a);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(t){this._ctx.fillStyle=t.color,this._ctx.fillRect(x[t.position||"full"],Math.round((this._canvas.height-1)*(t.startBufferLine/this._bufferService.buffers.active.lines.length)-y[t.position||"full"]/2),w[t.position||"full"],Math.round((this._canvas.height-1)*((t.endBufferLine-t.startBufferLine)/this._bufferService.buffers.active.lines.length)+y[t.position||"full"]))}_queueRefresh(t,a){this._shouldUpdateDimensions=t||this._shouldUpdateDimensions,this._shouldUpdateAnchor=a||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};E=_([f(2,S.IBufferService),f(3,S.IDecorationService),f(4,g.IRenderService),f(5,S.IOptionsService),f(6,g.ICoreBrowserService)],E),a.OverviewRulerRenderer=E},2950:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.CompositionHelper=void 0;const p=u(4725),v=u(2585),g=u(2584);let m=class{constructor(t,a,u,_,f,p){this._textarea=t,this._compositionView=a,this._bufferService=u,this._optionsService=_,this._coreService=f,this._renderService=p,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(t){this._compositionView.textContent=t.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(t){if(this._isComposing||this._isSendingComposition){if(229===t.keyCode)return!1;if(16===t.keyCode||17===t.keyCode||18===t.keyCode)return!1;this._finalizeComposition(!1)}return 229!==t.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(t){if(this._compositionView.classList.remove("active"),this._isComposing=!1,t){const t={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let a;this._isSendingComposition=!1,t.start+=this._dataAlreadySent.length,a=this._isComposing?this._textarea.value.substring(t.start,t.end):this._textarea.value.substring(t.start),a.length>0&&this._coreService.triggerDataEvent(a,!0)}}),0)}else{this._isSendingComposition=!1;const t=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(t,!0)}}_handleAnyTextareaChanges(){const t=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const a=this._textarea.value,u=a.replace(t,"");this._dataAlreadySent=u,a.length>t.length?this._coreService.triggerDataEvent(u,!0):a.length<t.length?this._coreService.triggerDataEvent(`${g.C0.DEL}`,!0):a.length===t.length&&a!==t&&this._coreService.triggerDataEvent(a,!0)}}),0)}updateCompositionElements(t){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const t=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),a=this._renderService.dimensions.actualCellHeight,u=this._bufferService.buffer.y*this._renderService.dimensions.actualCellHeight,_=t*this._renderService.dimensions.actualCellWidth;this._compositionView.style.left=_+"px",this._compositionView.style.top=u+"px",this._compositionView.style.height=a+"px",this._compositionView.style.lineHeight=a+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const f=this._compositionView.getBoundingClientRect();this._textarea.style.left=_+"px",this._textarea.style.top=u+"px",this._textarea.style.width=Math.max(f.width,1)+"px",this._textarea.style.height=Math.max(f.height,1)+"px",this._textarea.style.lineHeight=f.height+"px"}t||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};m=_([f(2,v.IBufferService),f(3,v.IOptionsService),f(4,v.ICoreService),f(5,p.IRenderService)],m),a.CompositionHelper=m},9806:(t,a)=>{function u(t,a,u){const _=u.getBoundingClientRect(),f=t.getComputedStyle(u),p=parseInt(f.getPropertyValue("padding-left")),v=parseInt(f.getPropertyValue("padding-top"));return[a.clientX-_.left-p,a.clientY-_.top-v]}Object.defineProperty(a,"__esModule",{value:!0}),a.getCoords=a.getCoordsRelativeToElement=void 0,a.getCoordsRelativeToElement=u,a.getCoords=function(t,a,_,f,p,v,g,m,S){if(!v)return;const y=u(t,a,_);return y?(y[0]=Math.ceil((y[0]+(S?g/2:0))/g),y[1]=Math.ceil(y[1]/m),y[0]=Math.min(Math.max(y[0],1),f+(S?1:0)),y[1]=Math.min(Math.max(y[1],1),p),y):void 0}},9504:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.moveToCellSequence=void 0;const _=u(2584);function f(t,a,u,_){const f=t-p(u,t),g=a-p(u,a),y=Math.abs(f-g)-function(t,a,u){let _=0;const f=t-p(u,t),g=a-p(u,a);for(let p=0;p<Math.abs(f-g);p++){const g="A"===v(t,a)?-1:1,m=u.buffer.lines.get(f+g*p);(null==m?void 0:m.isWrapped)&&_++}return _}(t,a,u);return S(y,m(v(t,a),_))}function p(t,a){let u=0,_=t.buffer.lines.get(a),f=null==_?void 0:_.isWrapped;for(;f&&a>=0&&a<t.rows;)u++,_=t.buffer.lines.get(--a),f=null==_?void 0:_.isWrapped;return u}function v(t,a){return t>a?"A":"B"}function g(t,a,u,_,f,p){let v=t,g=a,m="";for(;v!==u||g!==_;)v+=f?1:-1,f&&v>p.cols-1?(m+=p.buffer.translateBufferLineToString(g,!1,t,v),v=0,t=0,g++):!f&&v<0&&(m+=p.buffer.translateBufferLineToString(g,!1,0,t+1),v=p.cols-1,t=v,g--);return m+p.buffer.translateBufferLineToString(g,!1,t,v)}function m(t,a){const u=a?"O":"[";return _.C0.ESC+u+t}function S(t,a){t=Math.floor(t);let u="";for(let _=0;_<t;_++)u+=a;return u}a.moveToCellSequence=function(t,a,u,_){const v=u.buffer.x,y=u.buffer.y;if(!u.buffer.hasScrollback)return function(t,a,u,_,v,y){return 0===f(a,_,v,y).length?"":S(g(t,a,t,a-p(v,a),!1,v).length,m("D",y))}(v,y,0,a,u,_)+f(y,a,u,_)+function(t,a,u,_,v,y){let w;w=f(a,_,v,y).length>0?_-p(v,_):a;const x=_,E=function(t,a,u,_,v,g){let m;return m=f(u,_,v,g).length>0?_-p(v,_):a,t<u&&m<=_||t>=u&&m<_?"C":"D"}(t,a,u,_,v,y);return S(g(t,w,u,x,"C"===E,v).length,m(E,y))}(v,y,t,a,u,_);let w;if(y===a)return w=v>t?"D":"C",S(Math.abs(v-t),m(w,_));w=y>a?"D":"C";const x=Math.abs(y-a);return S(function(t,a){return a.cols-t}(y>a?t:v,u)+(x-1)*u.cols+1+((y>a?v:t)-1),m(w,_))}},8036:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.TEXT_BASELINE=a.DIM_OPACITY=a.INVERTED_DEFAULT_COLOR=void 0;const _=u(6114);a.INVERTED_DEFAULT_COLOR=257,a.DIM_OPACITY=.5,a.TEXT_BASELINE=_.isFirefox||_.isLegacyEdge?"bottom":"ideographic"},1752:(t,a)=>{function u(t){return 57508<=t&&t<=57558}Object.defineProperty(a,"__esModule",{value:!0}),a.excludeFromContrastRatioDemands=a.isRestrictedPowerlineGlyph=a.isPowerlineGlyph=a.throwIfFalsy=void 0,a.throwIfFalsy=function(t){if(!t)throw new Error("value must not be falsy");return t},a.isPowerlineGlyph=u,a.isRestrictedPowerlineGlyph=function(t){return 57520<=t&&t<=57527},a.excludeFromContrastRatioDemands=function(t){return u(t)||function(t){return 9472<=t&&t<=9631}(t)}},1296:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.DomRenderer=void 0;const p=u(3787),v=u(8036),g=u(844),m=u(4725),S=u(2585),y=u(8460),w=u(8055),x=u(9631),E="xterm-dom-renderer-owner-",j="xterm-focus";let k=1,T=class extends g.Disposable{constructor(t,a,u,_,f,v,g,m,S,y){super(),this._colors=t,this._element=a,this._screenElement=u,this._viewportElement=_,this._linkifier2=f,this._charSizeService=g,this._optionsService=m,this._bufferService=S,this._coreBrowserService=y,this._terminalClass=k++,this._rowElements=[],this._rowContainer=document.createElement("div"),this._rowContainer.classList.add("xterm-rows"),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add("xterm-selection"),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions={scaledCharWidth:0,scaledCharHeight:0,scaledCellWidth:0,scaledCellHeight:0,scaledCharLeft:0,scaledCharTop:0,scaledCanvasWidth:0,scaledCanvasHeight:0,canvasWidth:0,canvasHeight:0,actualCellWidth:0,actualCellHeight:0},this._updateDimensions(),this._injectCss(),this._rowFactory=v.createInstance(p.DomRendererRowFactory,document,this._colors),this._element.classList.add(E+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((t=>this._onLinkHover(t)))),this.register(this._linkifier2.onHideLinkUnderline((t=>this._onLinkLeave(t))))}get onRequestRedraw(){return(new y.EventEmitter).event}dispose(){this._element.classList.remove(E+this._terminalClass),(0,x.removeElementFromParent)(this._rowContainer,this._selectionContainer,this._themeStyleElement,this._dimensionsStyleElement),super.dispose()}_updateDimensions(){const t=this._coreBrowserService.dpr;this.dimensions.scaledCharWidth=this._charSizeService.width*t,this.dimensions.scaledCharHeight=Math.ceil(this._charSizeService.height*t),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._optionsService.rawOptions.lineHeight),this.dimensions.scaledCharLeft=0,this.dimensions.scaledCharTop=0,this.dimensions.scaledCanvasWidth=this.dimensions.scaledCellWidth*this._bufferService.cols,this.dimensions.scaledCanvasHeight=this.dimensions.scaledCellHeight*this._bufferService.rows,this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/t),this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/t),this.dimensions.actualCellWidth=this.dimensions.canvasWidth/this._bufferService.cols,this.dimensions.actualCellHeight=this.dimensions.canvasHeight/this._bufferService.rows;for(const t of this._rowElements)t.style.width=`${this.dimensions.canvasWidth}px`,t.style.height=`${this.dimensions.actualCellHeight}px`,t.style.lineHeight=`${this.dimensions.actualCellHeight}px`,t.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const a=`${this._terminalSelector} .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: ${this.dimensions.actualCellWidth}px}`;this._dimensionsStyleElement.textContent=a,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.canvasWidth}px`,this._screenElement.style.height=`${this.dimensions.canvasHeight}px`}setColors(t){this._colors=t,this._injectCss()}_injectCss(){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .xterm-rows { color: ${this._colors.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px;}`;t+=`${this._terminalSelector} span:not(.${p.BOLD_CLASS}) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.${p.BOLD_CLASS} { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.${p.ITALIC_CLASS} { font-style: italic;}`,t+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  box-shadow: none; }}",t+="@keyframes blink_block_"+this._terminalClass+" { 0% {"+`  background-color: ${this._colors.cursor.css};`+`  color: ${this._colors.cursorAccent.css}; } 50% {`+`  background-color: ${this._colors.cursorAccent.css};`+`  color: ${this._colors.cursor.css}; }}`,t+=`${this._terminalSelector} .xterm-rows:not(.xterm-focus) .${p.CURSOR_CLASS}.${p.CURSOR_STYLE_BLOCK_CLASS} { outline: 1px solid ${this._colors.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .xterm-rows.xterm-focus .${p.CURSOR_CLASS}.${p.CURSOR_BLINK_CLASS}:not(.${p.CURSOR_STYLE_BLOCK_CLASS}) { animation: blink_box_shadow_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .xterm-rows.xterm-focus .${p.CURSOR_CLASS}.${p.CURSOR_BLINK_CLASS}.${p.CURSOR_STYLE_BLOCK_CLASS} { animation: blink_block_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .xterm-rows.xterm-focus .${p.CURSOR_CLASS}.${p.CURSOR_STYLE_BLOCK_CLASS} {`+` background-color: ${this._colors.cursor.css};`+` color: ${this._colors.cursorAccent.css};}`+`${this._terminalSelector} .xterm-rows .${p.CURSOR_CLASS}.${p.CURSOR_STYLE_BAR_CLASS} {`+` box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${this._colors.cursor.css} inset;}`+`${this._terminalSelector} .xterm-rows .${p.CURSOR_CLASS}.${p.CURSOR_STYLE_UNDERLINE_CLASS} {`+` box-shadow: 0 -1px 0 ${this._colors.cursor.css} inset;}`,t+=`${this._terminalSelector} .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .xterm-selection div { position: absolute; background-color: ${this._colors.selectionBackgroundOpaque.css};}${this._terminalSelector} .xterm-selection div { position: absolute; background-color: ${this._colors.selectionInactiveBackgroundOpaque.css};}`,this._colors.ansi.forEach(((a,u)=>{t+=`${this._terminalSelector} .xterm-fg-${u} { color: ${a.css}; }${this._terminalSelector} .xterm-bg-${u} { background-color: ${a.css}; }`})),t+=`${this._terminalSelector} .xterm-fg-${v.INVERTED_DEFAULT_COLOR} { color: ${w.color.opaque(this._colors.background).css}; }${this._terminalSelector} .xterm-bg-${v.INVERTED_DEFAULT_COLOR} { background-color: ${this._colors.foreground.css}; }`,this._themeStyleElement.textContent=t}onDevicePixelRatioChange(){this._updateDimensions()}_refreshRowElements(t,a){for(let t=this._rowElements.length;t<=a;t++){const t=document.createElement("div");this._rowContainer.appendChild(t),this._rowElements.push(t)}for(;this._rowElements.length>a;)this._rowContainer.removeChild(this._rowElements.pop())}onResize(t,a){this._refreshRowElements(t,a),this._updateDimensions()}onCharSizeChanged(){this._updateDimensions()}onBlur(){this._rowContainer.classList.remove(j)}onFocus(){this._rowContainer.classList.add(j)}onSelectionChanged(t,a,u){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(this._rowFactory.onSelectionChanged(t,a,u),this.renderRows(0,this._bufferService.rows-1),!t||!a)return;const _=t[1]-this._bufferService.buffer.ydisp,f=a[1]-this._bufferService.buffer.ydisp,p=Math.max(_,0),v=Math.min(f,this._bufferService.rows-1);if(p>=this._bufferService.rows||v<0)return;const g=document.createDocumentFragment();if(u){const u=t[0]>a[0];g.appendChild(this._createSelectionElement(p,u?a[0]:t[0],u?t[0]:a[0],v-p+1))}else{const u=_===p?t[0]:0,m=p===f?a[0]:this._bufferService.cols;g.appendChild(this._createSelectionElement(p,u,m));const S=v-p-1;if(g.appendChild(this._createSelectionElement(p+1,0,this._bufferService.cols,S)),p!==v){const t=f===v?a[0]:this._bufferService.cols;g.appendChild(this._createSelectionElement(v,0,t))}}this._selectionContainer.appendChild(g)}_createSelectionElement(t,a,u,_=1){const f=document.createElement("div");return f.style.height=_*this.dimensions.actualCellHeight+"px",f.style.top=t*this.dimensions.actualCellHeight+"px",f.style.left=a*this.dimensions.actualCellWidth+"px",f.style.width=this.dimensions.actualCellWidth*(u-a)+"px",f}onCursorMove(){}onOptionsChanged(){this._updateDimensions(),this._injectCss()}clear(){for(const t of this._rowElements)t.innerText=""}renderRows(t,a){const u=this._bufferService.buffer.ybase+this._bufferService.buffer.y,_=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),f=this._optionsService.rawOptions.cursorBlink;for(let p=t;p<=a;p++){const t=this._rowElements[p];t.innerText="";const a=p+this._bufferService.buffer.ydisp,v=this._bufferService.buffer.lines.get(a),g=this._optionsService.rawOptions.cursorStyle;t.appendChild(this._rowFactory.createRow(v,a,a===u,g,_,f,this.dimensions.actualCellWidth,this._bufferService.cols))}}get _terminalSelector(){return`.${E}${this._terminalClass}`}_onLinkHover(t){this._setCellUnderline(t.x1,t.x2,t.y1,t.y2,t.cols,!0)}_onLinkLeave(t){this._setCellUnderline(t.x1,t.x2,t.y1,t.y2,t.cols,!1)}_setCellUnderline(t,a,u,_,f,p){for(;t!==a||u!==_;){const a=this._rowElements[u];if(!a)return;const _=a.children[t];_&&(_.style.textDecoration=p?"underline":"none"),++t>=f&&(t=0,u++)}}};T=_([f(5,S.IInstantiationService),f(6,m.ICharSizeService),f(7,S.IOptionsService),f(8,S.IBufferService),f(9,m.ICoreBrowserService)],T),a.DomRenderer=T},3787:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.DomRendererRowFactory=a.CURSOR_STYLE_UNDERLINE_CLASS=a.CURSOR_STYLE_BAR_CLASS=a.CURSOR_STYLE_BLOCK_CLASS=a.CURSOR_BLINK_CLASS=a.CURSOR_CLASS=a.STRIKETHROUGH_CLASS=a.UNDERLINE_CLASS=a.ITALIC_CLASS=a.DIM_CLASS=a.BOLD_CLASS=void 0;const p=u(8036),v=u(643),g=u(511),m=u(2585),S=u(8055),y=u(4725),w=u(4269),x=u(1752),E=u(3734);a.BOLD_CLASS="xterm-bold",a.DIM_CLASS="xterm-dim",a.ITALIC_CLASS="xterm-italic",a.UNDERLINE_CLASS="xterm-underline",a.STRIKETHROUGH_CLASS="xterm-strikethrough",a.CURSOR_CLASS="xterm-cursor",a.CURSOR_BLINK_CLASS="xterm-cursor-blink",a.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",a.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",a.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";let j=class{constructor(t,a,u,_,f,p,v){this._document=t,this._colors=a,this._characterJoinerService=u,this._optionsService=_,this._coreBrowserService=f,this._coreService=p,this._decorationService=v,this._workCell=new g.CellData,this._columnSelectMode=!1}setColors(t){this._colors=t}onSelectionChanged(t,a,u){this._selectionStart=t,this._selectionEnd=a,this._columnSelectMode=u}createRow(t,u,_,f,g,m,y,x){const j=this._document.createDocumentFragment(),T=this._characterJoinerService.getJoinedCharacters(u);let L=0;for(let a=Math.min(t.length,x)-1;a>=0;a--)if(t.loadCell(a,this._workCell).getCode()!==v.NULL_CELL_CODE||_&&a===g){L=a+1;break}for(let x=0;x<L;x++){t.loadCell(x,this._workCell);let L=this._workCell.getWidth();if(0===L)continue;let A=!1,R=x,D=this._workCell;if(T.length>0&&x===T[0][0]){A=!0;const a=T.shift();D=new w.JoinedCellData(this._workCell,t.translateToString(!0,a[0],a[1]),a[1]-a[0]),R=a[1]-1,L=D.getWidth()}const M=this._document.createElement("span");if(L>1&&(M.style.width=y*L+"px"),A&&(M.style.display="inline",g>=x&&g<=R&&(g=x)),!this._coreService.isCursorHidden&&_&&x===g)switch(M.classList.add(a.CURSOR_CLASS),m&&M.classList.add(a.CURSOR_BLINK_CLASS),f){case"bar":M.classList.add(a.CURSOR_STYLE_BAR_CLASS);break;case"underline":M.classList.add(a.CURSOR_STYLE_UNDERLINE_CLASS);break;default:M.classList.add(a.CURSOR_STYLE_BLOCK_CLASS)}if(D.isBold()&&M.classList.add(a.BOLD_CLASS),D.isItalic()&&M.classList.add(a.ITALIC_CLASS),D.isDim()&&M.classList.add(a.DIM_CLASS),D.isInvisible()?M.textContent=v.WHITESPACE_CELL_CHAR:M.textContent=D.getChars()||v.WHITESPACE_CELL_CHAR,D.isUnderline()&&(M.classList.add(`${a.UNDERLINE_CLASS}-${D.extended.underlineStyle}`)," "===M.textContent&&(M.innerHTML="&nbsp;"),!D.isUnderlineColorDefault()))if(D.isUnderlineColorRGB())M.style.textDecorationColor=`rgb(${E.AttributeData.toColorRGB(D.getUnderlineColor()).join(",")})`;else{let t=D.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&D.isBold()&&t<8&&(t+=8),M.style.textDecorationColor=this._colors.ansi[t].css}D.isStrikethrough()&&M.classList.add(a.STRIKETHROUGH_CLASS);let B=D.getFgColor(),I=D.getFgColorMode(),P=D.getBgColor(),H=D.getBgColorMode();const F=!!D.isInverse();if(F){const t=B;B=P,P=t;const a=I;I=H,H=a}let $,z,N=!1;this._decorationService.forEachDecorationAtCell(x,u,void 0,(t=>{"top"!==t.options.layer&&N||(t.backgroundColorRGB&&(H=50331648,P=t.backgroundColorRGB.rgba>>8&16777215,$=t.backgroundColorRGB),t.foregroundColorRGB&&(I=50331648,B=t.foregroundColorRGB.rgba>>8&16777215,z=t.foregroundColorRGB),N="top"===t.options.layer)}));const W=this._isCellInSelection(x,u);let V;switch(N||this._colors.selectionForeground&&W&&(I=50331648,B=this._colors.selectionForeground.rgba>>8&16777215,z=this._colors.selectionForeground),W&&($=this._coreBrowserService.isFocused?this._colors.selectionBackgroundOpaque:this._colors.selectionInactiveBackgroundOpaque,N=!0),N&&M.classList.add("xterm-decoration-top"),H){case 16777216:case 33554432:V=this._colors.ansi[P],M.classList.add(`xterm-bg-${P}`);break;case 50331648:V=S.rgba.toColor(P>>16,P>>8&255,255&P),this._addStyle(M,`background-color:#${k((P>>>0).toString(16),"0",6)}`);break;default:F?(V=this._colors.foreground,M.classList.add(`xterm-bg-${p.INVERTED_DEFAULT_COLOR}`)):V=this._colors.background}switch($||D.isDim()&&($=S.color.multiplyOpacity(V,.5)),I){case 16777216:case 33554432:D.isBold()&&B<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(B+=8),this._applyMinimumContrast(M,V,this._colors.ansi[B],D,$,void 0)||M.classList.add(`xterm-fg-${B}`);break;case 50331648:const t=S.rgba.toColor(B>>16&255,B>>8&255,255&B);this._applyMinimumContrast(M,V,t,D,$,z)||this._addStyle(M,`color:#${k(B.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(M,V,this._colors.foreground,D,$,void 0)||F&&M.classList.add(`xterm-fg-${p.INVERTED_DEFAULT_COLOR}`)}j.appendChild(M),x=R}return j}_applyMinimumContrast(t,a,u,_,f,p){if(1===this._optionsService.rawOptions.minimumContrastRatio||(0,x.excludeFromContrastRatioDemands)(_.getCode()))return!1;let v;return f||p||(v=this._colors.contrastCache.getColor(a.rgba,u.rgba)),void 0===v&&(v=S.color.ensureContrastRatio(f||a,p||u,this._optionsService.rawOptions.minimumContrastRatio),this._colors.contrastCache.setColor((f||a).rgba,(p||u).rgba,null!=v?v:null)),!!v&&(this._addStyle(t,`color:${v.css}`),!0)}_addStyle(t,a){t.setAttribute("style",`${t.getAttribute("style")||""}${a};`)}_isCellInSelection(t,a){const u=this._selectionStart,_=this._selectionEnd;return!(!u||!_)&&(this._columnSelectMode?u[0]<=_[0]?t>=u[0]&&a>=u[1]&&t<_[0]&&a<=_[1]:t<u[0]&&a>=u[1]&&t>=_[0]&&a<=_[1]:a>u[1]&&a<_[1]||u[1]===_[1]&&a===u[1]&&t>=u[0]&&t<_[0]||u[1]<_[1]&&a===_[1]&&t<_[0]||u[1]<_[1]&&a===u[1]&&t>=u[0])}};function k(t,a,u){for(;t.length<u;)t=a+t;return t}j=_([f(2,y.ICharacterJoinerService),f(3,m.IOptionsService),f(4,y.ICoreBrowserService),f(5,m.ICoreService),f(6,m.IDecorationService)],j),a.DomRendererRowFactory=j},456:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.SelectionModel=void 0,a.SelectionModel=class{constructor(t){this._bufferService=t,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?t%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)-1]:[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[t,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[Math.max(t,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const t=this.selectionStart,a=this.selectionEnd;return!(!t||!a)&&(t[1]>a[1]||t[1]===a[1]&&t[0]>a[0])}onTrim(t){return this.selectionStart&&(this.selectionStart[1]-=t),this.selectionEnd&&(this.selectionEnd[1]-=t),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.CharSizeService=void 0;const p=u(2585),v=u(8460);let g=class{constructor(t,a,u){this._optionsService=u,this.width=0,this.height=0,this._onCharSizeChange=new v.EventEmitter,this._measureStrategy=new h(t,a,this._optionsService)}get hasValidSize(){return this.width>0&&this.height>0}get onCharSizeChange(){return this._onCharSizeChange.event}measure(){const t=this._measureStrategy.measure();t.width===this.width&&t.height===this.height||(this.width=t.width,this.height=t.height,this._onCharSizeChange.fire())}};g=_([f(2,p.IOptionsService)],g),a.CharSizeService=g;class h{constructor(t,a,u){this._document=t,this._parentElement=a,this._optionsService=u,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;const t=this._measureElement.getBoundingClientRect();return 0!==t.width&&0!==t.height&&(this._result.width=t.width,this._result.height=Math.ceil(t.height)),this._result}}},4269:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.CharacterJoinerService=a.JoinedCellData=void 0;const p=u(3734),v=u(643),g=u(511),m=u(2585);class c extends p.AttributeData{constructor(t,a,u){super(),this.content=0,this.combinedData="",this.fg=t.fg,this.bg=t.bg,this.combinedData=a,this._width=u}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(t){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}a.JoinedCellData=c;let S=class e{constructor(t){this._bufferService=t,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new g.CellData}register(t){const a={id:this._nextCharacterJoinerId++,handler:t};return this._characterJoiners.push(a),a.id}deregister(t){for(let a=0;a<this._characterJoiners.length;a++)if(this._characterJoiners[a].id===t)return this._characterJoiners.splice(a,1),!0;return!1}getJoinedCharacters(t){if(0===this._characterJoiners.length)return[];const a=this._bufferService.buffer.lines.get(t);if(!a||0===a.length)return[];const u=[],_=a.translateToString(!0);let f=0,p=0,g=0,m=a.getFg(0),S=a.getBg(0);for(let t=0;t<a.getTrimmedLength();t++)if(a.loadCell(t,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==m||this._workCell.bg!==S){if(t-f>1){const t=this._getJoinedRanges(_,g,p,a,f);for(let a=0;a<t.length;a++)u.push(t[a])}f=t,g=p,m=this._workCell.fg,S=this._workCell.bg}p+=this._workCell.getChars().length||v.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-f>1){const t=this._getJoinedRanges(_,g,p,a,f);for(let a=0;a<t.length;a++)u.push(t[a])}return u}_getJoinedRanges(t,a,u,_,f){const p=t.substring(a,u);let v=[];try{v=this._characterJoiners[0].handler(p)}catch(t){console.error(t)}for(let t=1;t<this._characterJoiners.length;t++)try{const a=this._characterJoiners[t].handler(p);for(let t=0;t<a.length;t++)e._mergeRanges(v,a[t])}catch(t){console.error(t)}return this._stringRangesToCellRanges(v,_,f),v}_stringRangesToCellRanges(t,a,u){let _=0,f=!1,p=0,g=t[_];if(g){for(let m=u;m<this._bufferService.cols;m++){const u=a.getWidth(m),S=a.getString(m).length||v.WHITESPACE_CELL_CHAR.length;if(0!==u){if(!f&&g[0]<=p&&(g[0]=m,f=!0),g[1]<=p){if(g[1]=m,g=t[++_],!g)break;g[0]<=p?(g[0]=m,f=!0):f=!1}p+=S}}g&&(g[1]=this._bufferService.cols)}}static _mergeRanges(t,a){let u=!1;for(let _=0;_<t.length;_++){const f=t[_];if(u){if(a[1]<=f[0])return t[_-1][1]=a[1],t;if(a[1]<=f[1])return t[_-1][1]=Math.max(a[1],f[1]),t.splice(_,1),t;t.splice(_,1),_--}else{if(a[1]<=f[0])return t.splice(_,0,a),t;if(a[1]<=f[1])return f[0]=Math.min(a[0],f[0]),t;a[0]<f[1]&&(f[0]=Math.min(a[0],f[0]),u=!0)}}return u?t[t.length-1][1]=a[1]:t.push(a),t}};S=_([f(0,m.IBufferService)],S),a.CharacterJoinerService=S},5114:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CoreBrowserService=void 0,a.CoreBrowserService=class{constructor(t,a){this._textarea=t,this.window=a}get dpr(){return this.window.devicePixelRatio}get isFocused(){return(this._textarea.getRootNode?this._textarea.getRootNode():this._textarea.ownerDocument).activeElement===this._textarea&&this._textarea.ownerDocument.hasFocus()}}},8934:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.MouseService=void 0;const p=u(4725),v=u(9806);let g=class{constructor(t,a){this._renderService=t,this._charSizeService=a}getCoords(t,a,u,_,f){return(0,v.getCoords)(window,t,a,u,_,this._charSizeService.hasValidSize,this._renderService.dimensions.actualCellWidth,this._renderService.dimensions.actualCellHeight,f)}getMouseReportCoords(t,a){const u=(0,v.getCoordsRelativeToElement)(window,t,a);if(!(!this._charSizeService.hasValidSize||u[0]<0||u[1]<0||u[0]>=this._renderService.dimensions.canvasWidth||u[1]>=this._renderService.dimensions.canvasHeight))return{col:Math.floor(u[0]/this._renderService.dimensions.actualCellWidth),row:Math.floor(u[1]/this._renderService.dimensions.actualCellHeight),x:Math.floor(u[0]),y:Math.floor(u[1])}}};g=_([f(0,p.IRenderService),f(1,p.ICharSizeService)],g),a.MouseService=g},3230:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.RenderService=void 0;const p=u(6193),v=u(8460),g=u(844),m=u(5596),S=u(3656),y=u(2585),w=u(4725);let x=class extends g.Disposable{constructor(t,a,u,_,f,g,y,w){if(super(),this._renderer=t,this._rowCount=a,this._charSizeService=f,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=new v.EventEmitter,this._onRenderedViewportChange=new v.EventEmitter,this._onRender=new v.EventEmitter,this._onRefreshRequest=new v.EventEmitter,this.register({dispose:()=>this._renderer.dispose()}),this._renderDebouncer=new p.RenderDebouncer(w.window,((t,a)=>this._renderRows(t,a))),this.register(this._renderDebouncer),this._screenDprMonitor=new m.ScreenDprMonitor(w.window),this._screenDprMonitor.setListener((()=>this.onDevicePixelRatioChange())),this.register(this._screenDprMonitor),this.register(y.onResize((()=>this._fullRefresh()))),this.register(y.buffers.onBufferActivate((()=>{var t;return null===(t=this._renderer)||void 0===t?void 0:t.clear()}))),this.register(_.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.onCharSizeChanged()))),this.register(g.onDecorationRegistered((()=>this._fullRefresh()))),this.register(g.onDecorationRemoved((()=>this._fullRefresh()))),this._renderer.onRequestRedraw((t=>this.refreshRows(t.start,t.end,!0))),this.register((0,S.addDisposableDomListener)(w.window,"resize",(()=>this.onDevicePixelRatioChange()))),"IntersectionObserver"in w.window){const t=new w.window.IntersectionObserver((t=>this._onIntersectionChange(t[t.length-1])),{threshold:0});t.observe(u),this.register({dispose:()=>t.disconnect()})}}get onDimensionsChange(){return this._onDimensionsChange.event}get onRenderedViewportChange(){return this._onRenderedViewportChange.event}get onRender(){return this._onRender.event}get onRefreshRequest(){return this._onRefreshRequest.event}get dimensions(){return this._renderer.dimensions}_onIntersectionChange(t){this._isPaused=void 0===t.isIntersecting?0===t.intersectionRatio:!t.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(t,a,u=!1){this._isPaused?this._needsFullRefresh=!0:(u||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(t,a,this._rowCount))}_renderRows(t,a){this._renderer.renderRows(t,a),this._needsSelectionRefresh&&(this._renderer.onSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:t,end:a}),this._onRender.fire({start:t,end:a}),this._isNextRenderRedrawOnly=!0}resize(t,a){this._rowCount=a,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.onOptionsChanged(),this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize()}_fireOnCanvasResize(){this._renderer.dimensions.canvasWidth===this._canvasWidth&&this._renderer.dimensions.canvasHeight===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions)}dispose(){super.dispose()}setRenderer(t){this._renderer.dispose(),this._renderer=t,this._renderer.onRequestRedraw((t=>this.refreshRows(t.start,t.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(t){return this._renderDebouncer.addRefreshCallback(t)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var t,a;null===(a=null===(t=this._renderer)||void 0===t?void 0:t.clearTextureAtlas)||void 0===a||a.call(t),this._fullRefresh()}setColors(t){this._renderer.setColors(t),this._fullRefresh()}onDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.onDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1)}onResize(t,a){this._renderer.onResize(t,a),this._fullRefresh()}onCharSizeChanged(){this._renderer.onCharSizeChanged()}onBlur(){this._renderer.onBlur()}onFocus(){this._renderer.onFocus()}onSelectionChanged(t,a,u){this._selectionState.start=t,this._selectionState.end=a,this._selectionState.columnSelectMode=u,this._renderer.onSelectionChanged(t,a,u)}onCursorMove(){this._renderer.onCursorMove()}clear(){this._renderer.clear()}};x=_([f(3,y.IOptionsService),f(4,w.ICharSizeService),f(5,y.IDecorationService),f(6,y.IBufferService),f(7,w.ICoreBrowserService)],x),a.RenderService=x},9312:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.SelectionService=void 0;const p=u(6114),v=u(456),g=u(511),m=u(8460),S=u(4725),y=u(2585),w=u(9806),x=u(9504),E=u(844),j=u(4841),k=String.fromCharCode(160),T=new RegExp(k,"g");let L=class extends E.Disposable{constructor(t,a,u,_,f,p,S,y,w){super(),this._element=t,this._screenElement=a,this._linkifier=u,this._bufferService=_,this._coreService=f,this._mouseService=p,this._optionsService=S,this._renderService=y,this._coreBrowserService=w,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new g.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new m.EventEmitter),this._onRedrawRequest=this.register(new m.EventEmitter),this._onSelectionChange=this.register(new m.EventEmitter),this._onRequestScrollLines=this.register(new m.EventEmitter),this._mouseMoveListener=t=>this._onMouseMove(t),this._mouseUpListener=t=>this._onMouseUp(t),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((t=>this._onTrim(t))),this.register(this._bufferService.buffers.onBufferActivate((t=>this._onBufferActivate(t)))),this.enable(),this._model=new v.SelectionModel(this._bufferService),this._activeSelectionMode=0}get onLinuxMouseSelection(){return this._onLinuxMouseSelection.event}get onRequestRedraw(){return this._onRedrawRequest.event}get onSelectionChange(){return this._onSelectionChange.event}get onRequestScrollLines(){return this._onRequestScrollLines.event}dispose(){this._removeMouseDownListeners()}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const t=this._model.finalSelectionStart,a=this._model.finalSelectionEnd;return!(!t||!a||t[0]===a[0]&&t[1]===a[1])}get selectionText(){const t=this._model.finalSelectionStart,a=this._model.finalSelectionEnd;if(!t||!a)return"";const u=this._bufferService.buffer,_=[];if(3===this._activeSelectionMode){if(t[0]===a[0])return"";const f=t[0]<a[0]?t[0]:a[0],p=t[0]<a[0]?a[0]:t[0];for(let v=t[1];v<=a[1];v++){const t=u.translateBufferLineToString(v,!0,f,p);_.push(t)}}else{const f=t[1]===a[1]?a[0]:void 0;_.push(u.translateBufferLineToString(t[1],!0,t[0],f));for(let f=t[1]+1;f<=a[1]-1;f++){const t=u.lines.get(f),a=u.translateBufferLineToString(f,!0);(null==t?void 0:t.isWrapped)?_[_.length-1]+=a:_.push(a)}if(t[1]!==a[1]){const t=u.lines.get(a[1]),f=u.translateBufferLineToString(a[1],!0,0,a[0]);t&&t.isWrapped?_[_.length-1]+=f:_.push(f)}}return _.map((t=>t.replace(T," "))).join(p.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(t){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),p.isLinux&&t&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(t){const a=this._getMouseBufferCoords(t),u=this._model.finalSelectionStart,_=this._model.finalSelectionEnd;return!!(u&&_&&a)&&this._areCoordsInSelection(a,u,_)}isCellInSelection(t,a){const u=this._model.finalSelectionStart,_=this._model.finalSelectionEnd;return!(!u||!_)&&this._areCoordsInSelection([t,a],u,_)}_areCoordsInSelection(t,a,u){return t[1]>a[1]&&t[1]<u[1]||a[1]===u[1]&&t[1]===a[1]&&t[0]>=a[0]&&t[0]<u[0]||a[1]<u[1]&&t[1]===u[1]&&t[0]<u[0]||a[1]<u[1]&&t[1]===a[1]&&t[0]>=a[0]}_selectWordAtCursor(t,a){var u,_;const f=null===(_=null===(u=this._linkifier.currentLink)||void 0===u?void 0:u.link)||void 0===_?void 0:_.range;if(f)return this._model.selectionStart=[f.start.x-1,f.start.y-1],this._model.selectionStartLength=(0,j.getRangeLength)(f,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const p=this._getMouseBufferCoords(t);return!!p&&(this._selectWordAt(p,a),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(t,a){this._model.clearSelection(),t=Math.max(t,0),a=Math.min(a,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,t],this._model.selectionEnd=[this._bufferService.cols,a],this.refresh(),this._onSelectionChange.fire()}_onTrim(t){this._model.onTrim(t)&&this.refresh()}_getMouseBufferCoords(t){const a=this._mouseService.getCoords(t,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(a)return a[0]--,a[1]--,a[1]+=this._bufferService.buffer.ydisp,a}_getMouseEventScrollAmount(t){let a=(0,w.getCoordsRelativeToElement)(this._coreBrowserService.window,t,this._screenElement)[1];const u=this._renderService.dimensions.canvasHeight;return a>=0&&a<=u?0:(a>u&&(a-=u),a=Math.min(Math.max(a,-50),50),a/=50,a/Math.abs(a)+Math.round(14*a))}shouldForceSelection(t){return p.isMac?t.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:t.shiftKey}onMouseDown(t){if(this._mouseDownTimeStamp=t.timeStamp,(2!==t.button||!this.hasSelection)&&0===t.button){if(!this._enabled){if(!this.shouldForceSelection(t))return;t.stopPropagation()}t.preventDefault(),this._dragScrollAmount=0,this._enabled&&t.shiftKey?this._onIncrementalClick(t):1===t.detail?this._onSingleClick(t):2===t.detail?this._onDoubleClick(t):3===t.detail&&this._onTripleClick(t),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_onIncrementalClick(t){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(t))}_onSingleClick(t){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(t)?3:0,this._model.selectionStart=this._getMouseBufferCoords(t),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const a=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);a&&a.length!==this._model.selectionStart[0]&&0===a.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_onDoubleClick(t){this._selectWordAtCursor(t,!0)&&(this._activeSelectionMode=1)}_onTripleClick(t){const a=this._getMouseBufferCoords(t);a&&(this._activeSelectionMode=2,this._selectLineAt(a[1]))}shouldColumnSelect(t){return t.altKey&&!(p.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_onMouseMove(t){if(t.stopImmediatePropagation(),!this._model.selectionStart)return;const a=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(t),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(t),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const u=this._bufferService.buffer;if(this._model.selectionEnd[1]<u.lines.length){const t=u.lines.get(this._model.selectionEnd[1]);t&&0===t.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]++}a&&a[0]===this._model.selectionEnd[0]&&a[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const t=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(t.ydisp+this._bufferService.rows,t.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=t.ydisp),this.refresh()}}_onMouseUp(t){const a=t.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&a<500&&t.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const a=this._mouseService.getCoords(t,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(a&&void 0!==a[0]&&void 0!==a[1]){const t=(0,x.moveToCellSequence)(a[0]-1,a[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(t,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const t=this._model.finalSelectionStart,a=this._model.finalSelectionEnd,u=!(!t||!a||t[0]===a[0]&&t[1]===a[1]);u?t&&a&&(this._oldSelectionStart&&this._oldSelectionEnd&&t[0]===this._oldSelectionStart[0]&&t[1]===this._oldSelectionStart[1]&&a[0]===this._oldSelectionEnd[0]&&a[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(t,a,u)):this._oldHasSelection&&this._fireOnSelectionChange(t,a,u)}_fireOnSelectionChange(t,a,u){this._oldSelectionStart=t,this._oldSelectionEnd=a,this._oldHasSelection=u,this._onSelectionChange.fire()}_onBufferActivate(t){this.clearSelection(),this._trimListener.dispose(),this._trimListener=t.activeBuffer.lines.onTrim((t=>this._onTrim(t)))}_convertViewportColToCharacterIndex(t,a){let u=a[0];for(let _=0;a[0]>=_;_++){const f=t.loadCell(_,this._workCell).getChars().length;0===this._workCell.getWidth()?u--:f>1&&a[0]!==_&&(u+=f-1)}return u}setSelection(t,a,u){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[t,a],this._model.selectionStartLength=u,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(t){this._isClickInSelection(t)||(this._selectWordAtCursor(t,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(t,a,u=!0,_=!0){if(t[0]>=this._bufferService.cols)return;const f=this._bufferService.buffer,p=f.lines.get(t[1]);if(!p)return;const v=f.translateBufferLineToString(t[1],!1);let g=this._convertViewportColToCharacterIndex(p,t),m=g;const S=t[0]-g;let y=0,w=0,x=0,E=0;if(" "===v.charAt(g)){for(;g>0&&" "===v.charAt(g-1);)g--;for(;m<v.length&&" "===v.charAt(m+1);)m++}else{let a=t[0],u=t[0];0===p.getWidth(a)&&(y++,a--),2===p.getWidth(u)&&(w++,u++);const _=p.getString(u).length;for(_>1&&(E+=_-1,m+=_-1);a>0&&g>0&&!this._isCharWordSeparator(p.loadCell(a-1,this._workCell));){p.loadCell(a-1,this._workCell);const t=this._workCell.getChars().length;0===this._workCell.getWidth()?(y++,a--):t>1&&(x+=t-1,g-=t-1),g--,a--}for(;u<p.length&&m+1<v.length&&!this._isCharWordSeparator(p.loadCell(u+1,this._workCell));){p.loadCell(u+1,this._workCell);const t=this._workCell.getChars().length;2===this._workCell.getWidth()?(w++,u++):t>1&&(E+=t-1,m+=t-1),m++,u++}}m++;let j=g+S-y+x,k=Math.min(this._bufferService.cols,m-g+y+w-x-E);if(a||""!==v.slice(g,m).trim()){if(u&&0===j&&32!==p.getCodePoint(0)){const a=f.lines.get(t[1]-1);if(a&&p.isWrapped&&32!==a.getCodePoint(this._bufferService.cols-1)){const a=this._getWordAt([this._bufferService.cols-1,t[1]-1],!1,!0,!1);if(a){const t=this._bufferService.cols-a.start;j-=t,k+=t}}}if(_&&j+k===this._bufferService.cols&&32!==p.getCodePoint(this._bufferService.cols-1)){const a=f.lines.get(t[1]+1);if((null==a?void 0:a.isWrapped)&&32!==a.getCodePoint(0)){const a=this._getWordAt([0,t[1]+1],!1,!1,!0);a&&(k+=a.length)}}return{start:j,length:k}}}_selectWordAt(t,a){const u=this._getWordAt(t,a);if(u){for(;u.start<0;)u.start+=this._bufferService.cols,t[1]--;this._model.selectionStart=[u.start,t[1]],this._model.selectionStartLength=u.length}}_selectToWordAt(t){const a=this._getWordAt(t,!0);if(a){let u=t[1];for(;a.start<0;)a.start+=this._bufferService.cols,u--;if(!this._model.areSelectionValuesReversed())for(;a.start+a.length>this._bufferService.cols;)a.length-=this._bufferService.cols,u++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?a.start:a.start+a.length,u]}}_isCharWordSeparator(t){return 0!==t.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(t.getChars())>=0}_selectLineAt(t){const a=this._bufferService.buffer.getWrappedRangeForLine(t),u={start:{x:0,y:a.first},end:{x:this._bufferService.cols-1,y:a.last}};this._model.selectionStart=[0,a.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,j.getRangeLength)(u,this._bufferService.cols)}};L=_([f(3,y.IBufferService),f(4,y.ICoreService),f(5,S.IMouseService),f(6,y.IOptionsService),f(7,S.IRenderService),f(8,S.ICoreBrowserService)],L),a.SelectionService=L},4725:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ICharacterJoinerService=a.ISelectionService=a.IRenderService=a.IMouseService=a.ICoreBrowserService=a.ICharSizeService=void 0;const _=u(8343);a.ICharSizeService=(0,_.createDecorator)("CharSizeService"),a.ICoreBrowserService=(0,_.createDecorator)("CoreBrowserService"),a.IMouseService=(0,_.createDecorator)("MouseService"),a.IRenderService=(0,_.createDecorator)("RenderService"),a.ISelectionService=(0,_.createDecorator)("SelectionService"),a.ICharacterJoinerService=(0,_.createDecorator)("CharacterJoinerService")},6349:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CircularList=void 0;const _=u(8460);a.CircularList=class{constructor(t){this._maxLength=t,this.onDeleteEmitter=new _.EventEmitter,this.onInsertEmitter=new _.EventEmitter,this.onTrimEmitter=new _.EventEmitter,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get onDelete(){return this.onDeleteEmitter.event}get onInsert(){return this.onInsertEmitter.event}get onTrim(){return this.onTrimEmitter.event}get maxLength(){return this._maxLength}set maxLength(t){if(this._maxLength===t)return;const a=new Array(t);for(let u=0;u<Math.min(t,this.length);u++)a[u]=this._array[this._getCyclicIndex(u)];this._array=a,this._maxLength=t,this._startIndex=0}get length(){return this._length}set length(t){if(t>this._length)for(let a=this._length;a<t;a++)this._array[a]=void 0;this._length=t}get(t){return this._array[this._getCyclicIndex(t)]}set(t,a){this._array[this._getCyclicIndex(t)]=a}push(t){this._array[this._getCyclicIndex(this._length)]=t,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(t,a,...u){if(a){for(let u=t;u<this._length-a;u++)this._array[this._getCyclicIndex(u)]=this._array[this._getCyclicIndex(u+a)];this._length-=a,this.onDeleteEmitter.fire({index:t,amount:a})}for(let a=this._length-1;a>=t;a--)this._array[this._getCyclicIndex(a+u.length)]=this._array[this._getCyclicIndex(a)];for(let a=0;a<u.length;a++)this._array[this._getCyclicIndex(t+a)]=u[a];if(u.length&&this.onInsertEmitter.fire({index:t,amount:u.length}),this._length+u.length>this._maxLength){const t=this._length+u.length-this._maxLength;this._startIndex+=t,this._length=this._maxLength,this.onTrimEmitter.fire(t)}else this._length+=u.length}trimStart(t){t>this._length&&(t=this._length),this._startIndex+=t,this._length-=t,this.onTrimEmitter.fire(t)}shiftElements(t,a,u){if(!(a<=0)){if(t<0||t>=this._length)throw new Error("start argument out of range");if(t+u<0)throw new Error("Cannot shift elements in list beyond index 0");if(u>0){for(let _=a-1;_>=0;_--)this.set(t+_+u,this.get(t+_));const _=t+a+u-this._length;if(_>0)for(this._length+=_;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let _=0;_<a;_++)this.set(t+_+u,this.get(t+_))}}_getCyclicIndex(t){return(this._startIndex+t)%this._maxLength}}},1439:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.clone=void 0,a.clone=function t(a,u=5){if("object"!=typeof a)return a;const _=Array.isArray(a)?[]:{};for(const f in a)_[f]=u<=1?a[f]:a[f]&&t(a[f],u-1);return _}},8055:(t,a)=>{var u,_,f;function p(t){const a=t.toString(16);return a.length<2?"0"+a:a}function v(t,a){return t<a?(a+.05)/(t+.05):(t+.05)/(a+.05)}Object.defineProperty(a,"__esModule",{value:!0}),a.contrastRatio=a.toPaddedHex=a.rgba=a.rgb=a.css=a.color=a.channels=void 0,function(t){t.toCss=function(t,a,u,_){return void 0!==_?`#${p(t)}${p(a)}${p(u)}${p(_)}`:`#${p(t)}${p(a)}${p(u)}`},t.toRgba=function(t,a,u,_=255){return(t<<24|a<<16|u<<8|_)>>>0}}(u=a.channels||(a.channels={})),function(t){function a(t,a){const _=Math.round(255*a),[p,v,g]=f.toChannels(t.rgba);return{css:u.toCss(p,v,g,_),rgba:u.toRgba(p,v,g,_)}}t.blend=function(t,a){const _=(255&a.rgba)/255;if(1===_)return{css:a.css,rgba:a.rgba};const f=a.rgba>>24&255,p=a.rgba>>16&255,v=a.rgba>>8&255,g=t.rgba>>24&255,m=t.rgba>>16&255,S=t.rgba>>8&255,y=g+Math.round((f-g)*_),w=m+Math.round((p-m)*_),x=S+Math.round((v-S)*_);return{css:u.toCss(y,w,x),rgba:u.toRgba(y,w,x)}},t.isOpaque=function(t){return 255==(255&t.rgba)},t.ensureContrastRatio=function(t,a,u){const _=f.ensureContrastRatio(t.rgba,a.rgba,u);if(_)return f.toColor(_>>24&255,_>>16&255,_>>8&255)},t.opaque=function(t){const a=(255|t.rgba)>>>0,[_,p,v]=f.toChannels(a);return{css:u.toCss(_,p,v),rgba:a}},t.opacity=a,t.multiplyOpacity=function(t,u){return a(t,(255&t.rgba)*u/255)},t.toColorRGB=function(t){return[t.rgba>>24&255,t.rgba>>16&255,t.rgba>>8&255]}}(a.color||(a.color={})),(a.css||(a.css={})).toColor=function(t){if(t.match(/#[0-9a-f]{3,8}/i))switch(t.length){case 4:{const a=parseInt(t.slice(1,2).repeat(2),16),u=parseInt(t.slice(2,3).repeat(2),16),_=parseInt(t.slice(3,4).repeat(2),16);return f.toColor(a,u,_)}case 5:{const a=parseInt(t.slice(1,2).repeat(2),16),u=parseInt(t.slice(2,3).repeat(2),16),_=parseInt(t.slice(3,4).repeat(2),16),p=parseInt(t.slice(4,5).repeat(2),16);return f.toColor(a,u,_,p)}case 7:return{css:t,rgba:(parseInt(t.slice(1),16)<<8|255)>>>0};case 9:return{css:t,rgba:parseInt(t.slice(1),16)>>>0}}const a=t.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(a){const t=parseInt(a[1]),u=parseInt(a[2]),_=parseInt(a[3]),p=Math.round(255*(void 0===a[5]?1:parseFloat(a[5])));return f.toColor(t,u,_,p)}throw new Error("css.toColor: Unsupported css format")},function(t){function a(t,a,u){const _=t/255,f=a/255,p=u/255;return.2126*(_<=.03928?_/12.92:Math.pow((_+.055)/1.055,2.4))+.7152*(f<=.03928?f/12.92:Math.pow((f+.055)/1.055,2.4))+.0722*(p<=.03928?p/12.92:Math.pow((p+.055)/1.055,2.4))}t.relativeLuminance=function(t){return a(t>>16&255,t>>8&255,255&t)},t.relativeLuminance2=a}(_=a.rgb||(a.rgb={})),function(t){function a(t,a,u){const f=t>>24&255,p=t>>16&255,g=t>>8&255;let m=a>>24&255,S=a>>16&255,y=a>>8&255,w=v(_.relativeLuminance2(m,S,y),_.relativeLuminance2(f,p,g));for(;w<u&&(m>0||S>0||y>0);)m-=Math.max(0,Math.ceil(.1*m)),S-=Math.max(0,Math.ceil(.1*S)),y-=Math.max(0,Math.ceil(.1*y)),w=v(_.relativeLuminance2(m,S,y),_.relativeLuminance2(f,p,g));return(m<<24|S<<16|y<<8|255)>>>0}function f(t,a,u){const f=t>>24&255,p=t>>16&255,g=t>>8&255;let m=a>>24&255,S=a>>16&255,y=a>>8&255,w=v(_.relativeLuminance2(m,S,y),_.relativeLuminance2(f,p,g));for(;w<u&&(m<255||S<255||y<255);)m=Math.min(255,m+Math.ceil(.1*(255-m))),S=Math.min(255,S+Math.ceil(.1*(255-S))),y=Math.min(255,y+Math.ceil(.1*(255-y))),w=v(_.relativeLuminance2(m,S,y),_.relativeLuminance2(f,p,g));return(m<<24|S<<16|y<<8|255)>>>0}t.ensureContrastRatio=function(t,u,p){const g=_.relativeLuminance(t>>8),m=_.relativeLuminance(u>>8);if(v(g,m)<p){if(m<g){const m=a(t,u,p),S=v(g,_.relativeLuminance(m>>8));if(S<p){const a=f(t,u,p);return S>v(g,_.relativeLuminance(a>>8))?m:a}return m}const S=f(t,u,p),y=v(g,_.relativeLuminance(S>>8));if(y<p){const f=a(t,u,p);return y>v(g,_.relativeLuminance(f>>8))?S:f}return S}},t.reduceLuminance=a,t.increaseLuminance=f,t.toChannels=function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},t.toColor=function(t,a,_,f){return{css:u.toCss(t,a,_,f),rgba:u.toRgba(t,a,_,f)}}}(f=a.rgba||(a.rgba={})),a.toPaddedHex=p,a.contrastRatio=v},8969:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CoreTerminal=void 0;const _=u(844),f=u(2585),p=u(4348),v=u(7866),g=u(744),m=u(7302),S=u(6975),y=u(8460),w=u(1753),x=u(3730),E=u(1480),j=u(7994),k=u(9282),T=u(5435),L=u(5981),A=u(2660);let R=!1;class C extends _.Disposable{constructor(t){super(),this._onBinary=new y.EventEmitter,this._onData=new y.EventEmitter,this._onLineFeed=new y.EventEmitter,this._onResize=new y.EventEmitter,this._onScroll=new y.EventEmitter,this._onWriteParsed=new y.EventEmitter,this._instantiationService=new p.InstantiationService,this.optionsService=new m.OptionsService(t),this._instantiationService.setService(f.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(g.BufferService)),this._instantiationService.setService(f.IBufferService,this._bufferService),this._logService=this._instantiationService.createInstance(v.LogService),this._instantiationService.setService(f.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(S.CoreService,(()=>this.scrollToBottom()))),this._instantiationService.setService(f.ICoreService,this.coreService),this.coreMouseService=this._instantiationService.createInstance(w.CoreMouseService),this._instantiationService.setService(f.ICoreMouseService,this.coreMouseService),this._dirtyRowService=this._instantiationService.createInstance(x.DirtyRowService),this._instantiationService.setService(f.IDirtyRowService,this._dirtyRowService),this.unicodeService=this._instantiationService.createInstance(E.UnicodeService),this._instantiationService.setService(f.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(j.CharsetService),this._instantiationService.setService(f.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(A.OscLinkService),this._instantiationService.setService(f.IOscLinkService,this._oscLinkService),this._inputHandler=new T.InputHandler(this._bufferService,this._charsetService,this.coreService,this._dirtyRowService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService),this.register((0,y.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,y.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,y.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,y.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.optionsService.onOptionChange((t=>this._updateOptions(t)))),this.register(this._bufferService.onScroll((t=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._dirtyRowService.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((t=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._dirtyRowService.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=new L.WriteBuffer(((t,a)=>this._inputHandler.parse(t,a))),this.register((0,y.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onBinary(){return this._onBinary.event}get onData(){return this._onData.event}get onLineFeed(){return this._onLineFeed.event}get onResize(){return this._onResize.event}get onWriteParsed(){return this._onWriteParsed.event}get onScroll(){return this._onScrollApi||(this._onScrollApi=new y.EventEmitter,this.register(this._onScroll.event((t=>{var a;null===(a=this._onScrollApi)||void 0===a||a.fire(t.position)})))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(t){for(const a in t)this.optionsService.options[a]=t[a]}dispose(){var t;this._isDisposed||(super.dispose(),null===(t=this._windowsMode)||void 0===t||t.dispose(),this._windowsMode=void 0)}write(t,a){this._writeBuffer.write(t,a)}writeSync(t,a){this._logService.logLevel<=f.LogLevelEnum.WARN&&!R&&(this._logService.warn("writeSync is unreliable and will be removed soon."),R=!0),this._writeBuffer.writeSync(t,a)}resize(t,a){isNaN(t)||isNaN(a)||(t=Math.max(t,g.MINIMUM_COLS),a=Math.max(a,g.MINIMUM_ROWS),this._bufferService.resize(t,a))}scroll(t,a=!1){this._bufferService.scroll(t,a)}scrollLines(t,a,u){this._bufferService.scrollLines(t,a,u)}scrollPages(t){this._bufferService.scrollPages(t)}scrollToTop(){this._bufferService.scrollToTop()}scrollToBottom(){this._bufferService.scrollToBottom()}scrollToLine(t){this._bufferService.scrollToLine(t)}registerEscHandler(t,a){return this._inputHandler.registerEscHandler(t,a)}registerDcsHandler(t,a){return this._inputHandler.registerDcsHandler(t,a)}registerCsiHandler(t,a){return this._inputHandler.registerCsiHandler(t,a)}registerOscHandler(t,a){return this._inputHandler.registerOscHandler(t,a)}_setup(){this.optionsService.rawOptions.windowsMode&&this._enableWindowsMode()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_updateOptions(t){var a;switch(t){case"scrollback":this.buffers.resize(this.cols,this.rows);break;case"windowsMode":this.optionsService.rawOptions.windowsMode?this._enableWindowsMode():(null===(a=this._windowsMode)||void 0===a||a.dispose(),this._windowsMode=void 0)}}_enableWindowsMode(){if(!this._windowsMode){const t=[];t.push(this.onLineFeed(k.updateWindowsModeWrappedState.bind(null,this._bufferService))),t.push(this.registerCsiHandler({final:"H"},(()=>((0,k.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsMode={dispose:()=>{for(const a of t)a.dispose()}}}}}a.CoreTerminal=C},8460:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.forwardEvent=a.EventEmitter=void 0,a.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=t=>(this._listeners.push(t),{dispose:()=>{if(!this._disposed)for(let a=0;a<this._listeners.length;a++)if(this._listeners[a]===t)return void this._listeners.splice(a,1)}})),this._event}fire(t,a){const u=[];for(let t=0;t<this._listeners.length;t++)u.push(this._listeners[t]);for(let _=0;_<u.length;_++)u[_].call(void 0,t,a)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},a.forwardEvent=function(t,a){return t((t=>a.fire(t)))}},5435:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.InputHandler=a.WindowsOptionsReportType=void 0;const _=u(2584),f=u(7116),p=u(2015),v=u(844),g=u(482),m=u(8437),S=u(8460),y=u(643),w=u(511),x=u(3734),E=u(2585),j=u(6242),k=u(6351),T=u(5941),L={"(":0,")":1,"*":2,"+":3,"-":1,".":2},A=131072;function R(t,a){if(t>24)return a.setWinLines||!1;switch(t){case 1:return!!a.restoreWin;case 2:return!!a.minimizeWin;case 3:return!!a.setWinPosition;case 4:return!!a.setWinSizePixels;case 5:return!!a.raiseWin;case 6:return!!a.lowerWin;case 7:return!!a.refreshWin;case 8:return!!a.setWinSizeChars;case 9:return!!a.maximizeWin;case 10:return!!a.fullscreenWin;case 11:return!!a.getWinState;case 13:return!!a.getWinPosition;case 14:return!!a.getWinSizePixels;case 15:return!!a.getScreenSizePixels;case 16:return!!a.getCellSizePixels;case 18:return!!a.getWinSizeChars;case 19:return!!a.getScreenSizeChars;case 20:return!!a.getIconTitle;case 21:return!!a.getWinTitle;case 22:return!!a.pushTitle;case 23:return!!a.popTitle;case 24:return!!a.setWinLines}return!1}var D;!function(t){t[t.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",t[t.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"}(D=a.WindowsOptionsReportType||(a.WindowsOptionsReportType={}));class b extends v.Disposable{constructor(t,a,u,v,y,x,E,T,L,A=new p.EscapeSequenceParser){super(),this._bufferService=t,this._charsetService=a,this._coreService=u,this._dirtyRowService=v,this._logService=y,this._optionsService=x,this._oscLinkService=E,this._coreMouseService=T,this._unicodeService=L,this._parser=A,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new g.StringToUtf32,this._utf8Decoder=new g.Utf8ToUtf32,this._workCell=new w.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=m.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=m.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=new S.EventEmitter,this._onRequestRefreshRows=new S.EventEmitter,this._onRequestReset=new S.EventEmitter,this._onRequestSendFocus=new S.EventEmitter,this._onRequestSyncScrollBar=new S.EventEmitter,this._onRequestWindowsOptionsReport=new S.EventEmitter,this._onA11yChar=new S.EventEmitter,this._onA11yTab=new S.EventEmitter,this._onCursorMove=new S.EventEmitter,this._onLineFeed=new S.EventEmitter,this._onScroll=new S.EventEmitter,this._onTitleChange=new S.EventEmitter,this._onColor=new S.EventEmitter,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((t=>this._activeBuffer=t.activeBuffer))),this._parser.setCsiHandlerFallback(((t,a)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(t),params:a.toArray()})})),this._parser.setEscHandlerFallback((t=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(t)})})),this._parser.setExecuteHandlerFallback((t=>{this._logService.debug("Unknown EXECUTE code: ",{code:t})})),this._parser.setOscHandlerFallback(((t,a,u)=>{this._logService.debug("Unknown OSC code: ",{identifier:t,action:a,data:u})})),this._parser.setDcsHandlerFallback(((t,a,u)=>{"HOOK"===a&&(u=u.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(t),action:a,payload:u})})),this._parser.setPrintHandler(((t,a,u)=>this.print(t,a,u))),this._parser.registerCsiHandler({final:"@"},(t=>this.insertChars(t))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(t=>this.scrollLeft(t))),this._parser.registerCsiHandler({final:"A"},(t=>this.cursorUp(t))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(t=>this.scrollRight(t))),this._parser.registerCsiHandler({final:"B"},(t=>this.cursorDown(t))),this._parser.registerCsiHandler({final:"C"},(t=>this.cursorForward(t))),this._parser.registerCsiHandler({final:"D"},(t=>this.cursorBackward(t))),this._parser.registerCsiHandler({final:"E"},(t=>this.cursorNextLine(t))),this._parser.registerCsiHandler({final:"F"},(t=>this.cursorPrecedingLine(t))),this._parser.registerCsiHandler({final:"G"},(t=>this.cursorCharAbsolute(t))),this._parser.registerCsiHandler({final:"H"},(t=>this.cursorPosition(t))),this._parser.registerCsiHandler({final:"I"},(t=>this.cursorForwardTab(t))),this._parser.registerCsiHandler({final:"J"},(t=>this.eraseInDisplay(t,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(t=>this.eraseInDisplay(t,!0))),this._parser.registerCsiHandler({final:"K"},(t=>this.eraseInLine(t,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(t=>this.eraseInLine(t,!0))),this._parser.registerCsiHandler({final:"L"},(t=>this.insertLines(t))),this._parser.registerCsiHandler({final:"M"},(t=>this.deleteLines(t))),this._parser.registerCsiHandler({final:"P"},(t=>this.deleteChars(t))),this._parser.registerCsiHandler({final:"S"},(t=>this.scrollUp(t))),this._parser.registerCsiHandler({final:"T"},(t=>this.scrollDown(t))),this._parser.registerCsiHandler({final:"X"},(t=>this.eraseChars(t))),this._parser.registerCsiHandler({final:"Z"},(t=>this.cursorBackwardTab(t))),this._parser.registerCsiHandler({final:"`"},(t=>this.charPosAbsolute(t))),this._parser.registerCsiHandler({final:"a"},(t=>this.hPositionRelative(t))),this._parser.registerCsiHandler({final:"b"},(t=>this.repeatPrecedingCharacter(t))),this._parser.registerCsiHandler({final:"c"},(t=>this.sendDeviceAttributesPrimary(t))),this._parser.registerCsiHandler({prefix:">",final:"c"},(t=>this.sendDeviceAttributesSecondary(t))),this._parser.registerCsiHandler({final:"d"},(t=>this.linePosAbsolute(t))),this._parser.registerCsiHandler({final:"e"},(t=>this.vPositionRelative(t))),this._parser.registerCsiHandler({final:"f"},(t=>this.hVPosition(t))),this._parser.registerCsiHandler({final:"g"},(t=>this.tabClear(t))),this._parser.registerCsiHandler({final:"h"},(t=>this.setMode(t))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(t=>this.setModePrivate(t))),this._parser.registerCsiHandler({final:"l"},(t=>this.resetMode(t))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(t=>this.resetModePrivate(t))),this._parser.registerCsiHandler({final:"m"},(t=>this.charAttributes(t))),this._parser.registerCsiHandler({final:"n"},(t=>this.deviceStatus(t))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(t=>this.deviceStatusPrivate(t))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(t=>this.softReset(t))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(t=>this.setCursorStyle(t))),this._parser.registerCsiHandler({final:"r"},(t=>this.setScrollRegion(t))),this._parser.registerCsiHandler({final:"s"},(t=>this.saveCursor(t))),this._parser.registerCsiHandler({final:"t"},(t=>this.windowOptions(t))),this._parser.registerCsiHandler({final:"u"},(t=>this.restoreCursor(t))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(t=>this.insertColumns(t))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(t=>this.deleteColumns(t))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(t=>this.selectProtected(t))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(t=>this.requestMode(t,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(t=>this.requestMode(t,!1))),this._parser.setExecuteHandler(_.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(_.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(_.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(_.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(_.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(_.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(_.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(_.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(_.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(_.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(_.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(_.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new j.OscHandler((t=>(this.setTitle(t),this.setIconName(t),!0)))),this._parser.registerOscHandler(1,new j.OscHandler((t=>this.setIconName(t)))),this._parser.registerOscHandler(2,new j.OscHandler((t=>this.setTitle(t)))),this._parser.registerOscHandler(4,new j.OscHandler((t=>this.setOrReportIndexedColor(t)))),this._parser.registerOscHandler(8,new j.OscHandler((t=>this.setHyperlink(t)))),this._parser.registerOscHandler(10,new j.OscHandler((t=>this.setOrReportFgColor(t)))),this._parser.registerOscHandler(11,new j.OscHandler((t=>this.setOrReportBgColor(t)))),this._parser.registerOscHandler(12,new j.OscHandler((t=>this.setOrReportCursorColor(t)))),this._parser.registerOscHandler(104,new j.OscHandler((t=>this.restoreIndexedColor(t)))),this._parser.registerOscHandler(110,new j.OscHandler((t=>this.restoreFgColor(t)))),this._parser.registerOscHandler(111,new j.OscHandler((t=>this.restoreBgColor(t)))),this._parser.registerOscHandler(112,new j.OscHandler((t=>this.restoreCursorColor(t)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const t in f.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:t},(()=>this.selectCharset("("+t))),this._parser.registerEscHandler({intermediates:")",final:t},(()=>this.selectCharset(")"+t))),this._parser.registerEscHandler({intermediates:"*",final:t},(()=>this.selectCharset("*"+t))),this._parser.registerEscHandler({intermediates:"+",final:t},(()=>this.selectCharset("+"+t))),this._parser.registerEscHandler({intermediates:"-",final:t},(()=>this.selectCharset("-"+t))),this._parser.registerEscHandler({intermediates:".",final:t},(()=>this.selectCharset("."+t))),this._parser.registerEscHandler({intermediates:"/",final:t},(()=>this.selectCharset("/"+t)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((t=>(this._logService.error("Parsing error: ",t),t))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new k.DcsHandler(((t,a)=>this.requestStatusString(t,a))))}getAttrData(){return this._curAttrData}get onRequestBell(){return this._onRequestBell.event}get onRequestRefreshRows(){return this._onRequestRefreshRows.event}get onRequestReset(){return this._onRequestReset.event}get onRequestSendFocus(){return this._onRequestSendFocus.event}get onRequestSyncScrollBar(){return this._onRequestSyncScrollBar.event}get onRequestWindowsOptionsReport(){return this._onRequestWindowsOptionsReport.event}get onA11yChar(){return this._onA11yChar.event}get onA11yTab(){return this._onA11yTab.event}get onCursorMove(){return this._onCursorMove.event}get onLineFeed(){return this._onLineFeed.event}get onScroll(){return this._onScroll.event}get onTitleChange(){return this._onTitleChange.event}get onColor(){return this._onColor.event}dispose(){super.dispose()}_preserveStack(t,a,u,_){this._parseStack.paused=!0,this._parseStack.cursorStartX=t,this._parseStack.cursorStartY=a,this._parseStack.decodedLength=u,this._parseStack.position=_}_logSlowResolvingAsync(t){this._logService.logLevel<=E.LogLevelEnum.WARN&&Promise.race([t,new Promise(((t,a)=>setTimeout((()=>a("#SLOW_TIMEOUT")),5e3)))]).catch((t=>{if("#SLOW_TIMEOUT"!==t)throw t;console.warn("async parser handler taking longer than 5000 ms")}))}parse(t,a){let u,_=this._activeBuffer.x,f=this._activeBuffer.y,p=0;const v=this._parseStack.paused;if(v){if(u=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,a))return this._logSlowResolvingAsync(u),u;_=this._parseStack.cursorStartX,f=this._parseStack.cursorStartY,this._parseStack.paused=!1,t.length>A&&(p=this._parseStack.position+A)}if(this._logService.logLevel<=E.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+("string"==typeof t?` "${t}"`:` "${Array.prototype.map.call(t,(t=>String.fromCharCode(t))).join("")}"`),"string"==typeof t?t.split("").map((t=>t.charCodeAt(0))):t),this._parseBuffer.length<t.length&&this._parseBuffer.length<A&&(this._parseBuffer=new Uint32Array(Math.min(t.length,A))),v||this._dirtyRowService.clearRange(),t.length>A)for(let a=p;a<t.length;a+=A){const p=a+A<t.length?a+A:t.length,v="string"==typeof t?this._stringDecoder.decode(t.substring(a,p),this._parseBuffer):this._utf8Decoder.decode(t.subarray(a,p),this._parseBuffer);if(u=this._parser.parse(this._parseBuffer,v))return this._preserveStack(_,f,v,a),this._logSlowResolvingAsync(u),u}else if(!v){const a="string"==typeof t?this._stringDecoder.decode(t,this._parseBuffer):this._utf8Decoder.decode(t,this._parseBuffer);if(u=this._parser.parse(this._parseBuffer,a))return this._preserveStack(_,f,a,0),this._logSlowResolvingAsync(u),u}this._activeBuffer.x===_&&this._activeBuffer.y===f||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowService.start,this._dirtyRowService.end)}print(t,a,u){let _,f;const p=this._charsetService.charset,v=this._optionsService.rawOptions.screenReaderMode,m=this._bufferService.cols,S=this._coreService.decPrivateModes.wraparound,w=this._coreService.modes.insertMode,x=this._curAttrData;let E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowService.markDirty(this._activeBuffer.y),this._activeBuffer.x&&u-a>0&&2===E.getWidth(this._activeBuffer.x-1)&&E.setCellFromCodePoint(this._activeBuffer.x-1,0,1,x.fg,x.bg,x.extended);for(let j=a;j<u;++j){if(_=t[j],f=this._unicodeService.wcwidth(_),_<127&&p){const t=p[String.fromCharCode(_)];t&&(_=t.charCodeAt(0))}if(v&&this._onA11yChar.fire((0,g.stringFromCodePoint)(_)),void 0!==this._currentLinkId&&this._oscLinkService.addLineToLink(this._currentLinkId,this._activeBuffer.ybase+this._activeBuffer.y),f||!this._activeBuffer.x){if(this._activeBuffer.x+f-1>=m)if(S){for(;this._activeBuffer.x<m;)E.setCellFromCodePoint(this._activeBuffer.x++,0,1,x.fg,x.bg,x.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=m-1,2===f)continue;if(w&&(E.insertCells(this._activeBuffer.x,f,this._activeBuffer.getNullCell(x),x),2===E.getWidth(m-1)&&E.setCellFromCodePoint(m-1,y.NULL_CELL_CODE,y.NULL_CELL_WIDTH,x.fg,x.bg,x.extended)),E.setCellFromCodePoint(this._activeBuffer.x++,_,f,x.fg,x.bg,x.extended),f>0)for(;--f;)E.setCellFromCodePoint(this._activeBuffer.x++,0,0,x.fg,x.bg,x.extended)}else E.getWidth(this._activeBuffer.x-1)?E.addCodepointToCell(this._activeBuffer.x-1,_):E.addCodepointToCell(this._activeBuffer.x-2,_)}u-a>0&&(E.loadCell(this._activeBuffer.x-1,this._workCell),2===this._workCell.getWidth()||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<m&&u-a>0&&0===E.getWidth(this._activeBuffer.x)&&!E.hasContent(this._activeBuffer.x)&&E.setCellFromCodePoint(this._activeBuffer.x,0,1,x.fg,x.bg,x.extended),this._dirtyRowService.markDirty(this._activeBuffer.y)}registerCsiHandler(t,a){return"t"!==t.final||t.prefix||t.intermediates?this._parser.registerCsiHandler(t,a):this._parser.registerCsiHandler(t,(t=>!R(t.params[0],this._optionsService.rawOptions.windowOptions)||a(t)))}registerDcsHandler(t,a){return this._parser.registerDcsHandler(t,new k.DcsHandler(a))}registerEscHandler(t,a){return this._parser.registerEscHandler(t,a)}registerOscHandler(t,a){return this._parser.registerOscHandler(t,new j.OscHandler(a))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowService.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowService.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var t;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(null===(t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))||void 0===t?void 0:t.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);t.hasWidth(this._activeBuffer.x)&&!t.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const t=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-t),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(t=this._bufferService.cols-1){this._activeBuffer.x=Math.min(t,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowService.markDirty(this._activeBuffer.y)}_setCursor(t,a){this._dirtyRowService.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=t,this._activeBuffer.y=this._activeBuffer.scrollTop+a):(this._activeBuffer.x=t,this._activeBuffer.y=a),this._restrictCursor(),this._dirtyRowService.markDirty(this._activeBuffer.y)}_moveCursor(t,a){this._restrictCursor(),this._setCursor(this._activeBuffer.x+t,this._activeBuffer.y+a)}cursorUp(t){const a=this._activeBuffer.y-this._activeBuffer.scrollTop;return a>=0?this._moveCursor(0,-Math.min(a,t.params[0]||1)):this._moveCursor(0,-(t.params[0]||1)),!0}cursorDown(t){const a=this._activeBuffer.scrollBottom-this._activeBuffer.y;return a>=0?this._moveCursor(0,Math.min(a,t.params[0]||1)):this._moveCursor(0,t.params[0]||1),!0}cursorForward(t){return this._moveCursor(t.params[0]||1,0),!0}cursorBackward(t){return this._moveCursor(-(t.params[0]||1),0),!0}cursorNextLine(t){return this.cursorDown(t),this._activeBuffer.x=0,!0}cursorPrecedingLine(t){return this.cursorUp(t),this._activeBuffer.x=0,!0}cursorCharAbsolute(t){return this._setCursor((t.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(t){return this._setCursor(t.length>=2?(t.params[1]||1)-1:0,(t.params[0]||1)-1),!0}charPosAbsolute(t){return this._setCursor((t.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(t){return this._moveCursor(t.params[0]||1,0),!0}linePosAbsolute(t){return this._setCursor(this._activeBuffer.x,(t.params[0]||1)-1),!0}vPositionRelative(t){return this._moveCursor(0,t.params[0]||1),!0}hVPosition(t){return this.cursorPosition(t),!0}tabClear(t){const a=t.params[0];return 0===a?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===a&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(t){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let a=t.params[0]||1;for(;a--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(t){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let a=t.params[0]||1;for(;a--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(t){const a=t.params[0];return 1===a&&(this._curAttrData.bg|=536870912),2!==a&&0!==a||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(t,a,u,_=!1,f=!1){const p=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);p.replaceCells(a,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),f),_&&(p.isWrapped=!1)}_resetBufferLine(t,a=!1){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),a),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+t),u.isWrapped=!1}eraseInDisplay(t,a=!1){let u;switch(this._restrictCursor(this._bufferService.cols),t.params[0]){case 0:for(u=this._activeBuffer.y,this._dirtyRowService.markDirty(u),this._eraseInBufferLine(u++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,a);u<this._bufferService.rows;u++)this._resetBufferLine(u,a);this._dirtyRowService.markDirty(u);break;case 1:for(u=this._activeBuffer.y,this._dirtyRowService.markDirty(u),this._eraseInBufferLine(u,0,this._activeBuffer.x+1,!0,a),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(u+1).isWrapped=!1);u--;)this._resetBufferLine(u,a);this._dirtyRowService.markDirty(0);break;case 2:for(u=this._bufferService.rows,this._dirtyRowService.markDirty(u-1);u--;)this._resetBufferLine(u,a);this._dirtyRowService.markDirty(0);break;case 3:const t=this._activeBuffer.lines.length-this._bufferService.rows;t>0&&(this._activeBuffer.lines.trimStart(t),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-t,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-t,0),this._onScroll.fire(0))}return!0}eraseInLine(t,a=!1){switch(this._restrictCursor(this._bufferService.cols),t.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,a);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,a);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,a)}return this._dirtyRowService.markDirty(this._activeBuffer.y),!0}insertLines(t){this._restrictCursor();let a=t.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const u=this._activeBuffer.ybase+this._activeBuffer.y,_=this._bufferService.rows-1-this._activeBuffer.scrollBottom,f=this._bufferService.rows-1+this._activeBuffer.ybase-_+1;for(;a--;)this._activeBuffer.lines.splice(f-1,1),this._activeBuffer.lines.splice(u,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowService.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(t){this._restrictCursor();let a=t.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const u=this._activeBuffer.ybase+this._activeBuffer.y;let _;for(_=this._bufferService.rows-1-this._activeBuffer.scrollBottom,_=this._bufferService.rows-1+this._activeBuffer.ybase-_;a--;)this._activeBuffer.lines.splice(u,1),this._activeBuffer.lines.splice(_,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowService.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(t){this._restrictCursor();const a=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return a&&(a.insertCells(this._activeBuffer.x,t.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowService.markDirty(this._activeBuffer.y)),!0}deleteChars(t){this._restrictCursor();const a=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return a&&(a.deleteCells(this._activeBuffer.x,t.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowService.markDirty(this._activeBuffer.y)),!0}scrollUp(t){let a=t.params[0]||1;for(;a--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(t){let a=t.params[0]||1;for(;a--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(m.DEFAULT_ATTR_DATA));return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const a=t.params[0]||1;for(let t=this._activeBuffer.scrollTop;t<=this._activeBuffer.scrollBottom;++t){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.deleteCells(0,a,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),u.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const a=t.params[0]||1;for(let t=this._activeBuffer.scrollTop;t<=this._activeBuffer.scrollBottom;++t){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.insertCells(0,a,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),u.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const a=t.params[0]||1;for(let t=this._activeBuffer.scrollTop;t<=this._activeBuffer.scrollBottom;++t){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.insertCells(this._activeBuffer.x,a,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),u.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const a=t.params[0]||1;for(let t=this._activeBuffer.scrollTop;t<=this._activeBuffer.scrollBottom;++t){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.deleteCells(this._activeBuffer.x,a,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),u.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(t){this._restrictCursor();const a=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return a&&(a.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(t.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowService.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(t){if(!this._parser.precedingCodepoint)return!0;const a=t.params[0]||1,u=new Uint32Array(a);for(let t=0;t<a;++t)u[t]=this._parser.precedingCodepoint;return this.print(u,0,u.length),!0}sendDeviceAttributesPrimary(t){return t.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(_.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(_.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(t){return t.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(_.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(_.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(t.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(_.C0.ESC+"[>83;40003;0c")),!0}_is(t){return 0===(this._optionsService.rawOptions.termName+"").indexOf(t)}setMode(t){for(let a=0;a<t.length;a++)switch(t.params[a]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(t){for(let a=0;a<t.length;a++)switch(t.params[a]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),this._charsetService.setgCharset(1,f.DEFAULT_CHARSET),this._charsetService.setgCharset(2,f.DEFAULT_CHARSET),this._charsetService.setgCharset(3,f.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(t){for(let a=0;a<t.length;a++)switch(t.params[a]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(t){for(let a=0;a<t.length;a++)switch(t.params[a]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===t.params[a]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(t,a){const u=this._coreService.decPrivateModes,{activeProtocol:f,activeEncoding:p}=this._coreMouseService,v=this._coreService,{buffers:g,cols:m}=this._bufferService,{active:S,alt:y}=g,w=this._optionsService.rawOptions,x=t=>t?1:2,E=t.params[0];return j=E,k=a?2===E?3:4===E?x(v.modes.insertMode):12===E?4:20===E?x(w.convertEol):0:1===E?x(u.applicationCursorKeys):3===E?w.windowOptions.setWinLines?80===m?2:132===m?1:0:0:6===E?x(u.origin):7===E?x(u.wraparound):8===E?3:9===E?x("X10"===f):12===E?x(w.cursorBlink):25===E?x(!v.isCursorHidden):45===E?x(u.reverseWraparound):66===E?x(u.applicationKeypad):1e3===E?x("VT200"===f):1002===E?x("DRAG"===f):1003===E?x("ANY"===f):1004===E?x(u.sendFocus):1005===E?4:1006===E?x("SGR"===p):1015===E?4:1016===E?x("SGR_PIXELS"===p):1048===E?1:47===E||1047===E||1049===E?x(S===y):2004===E?x(u.bracketedPasteMode):0,v.triggerDataEvent(`${_.C0.ESC}[${a?"":"?"}${j};${k}$y`),!0;var j,k}_updateAttrColor(t,a,u,_,f){return 2===a?(t|=50331648,t&=-16777216,t|=x.AttributeData.fromColorRGB([u,_,f])):5===a&&(t&=-50331904,t|=33554432|255&u),t}_extractColor(t,a,u){const _=[0,0,-1,0,0,0];let f=0,p=0;do{if(_[p+f]=t.params[a+p],t.hasSubParams(a+p)){const u=t.getSubParams(a+p);let v=0;do{5===_[1]&&(f=1),_[p+v+1+f]=u[v]}while(++v<u.length&&v+p+1+f<_.length);break}if(5===_[1]&&p+f>=2||2===_[1]&&p+f>=5)break;_[1]&&(f=1)}while(++p+a<t.length&&p+f<_.length);for(let t=2;t<_.length;++t)-1===_[t]&&(_[t]=0);switch(_[0]){case 38:u.fg=this._updateAttrColor(u.fg,_[1],_[3],_[4],_[5]);break;case 48:u.bg=this._updateAttrColor(u.bg,_[1],_[3],_[4],_[5]);break;case 58:u.extended=u.extended.clone(),u.extended.underlineColor=this._updateAttrColor(u.extended.underlineColor,_[1],_[3],_[4],_[5])}return p}_processUnderline(t,a){a.extended=a.extended.clone(),(!~t||t>5)&&(t=1),a.extended.underlineStyle=t,a.fg|=268435456,0===t&&(a.fg&=-268435457),a.updateExtended()}charAttributes(t){if(1===t.length&&0===t.params[0])return this._curAttrData.fg=m.DEFAULT_ATTR_DATA.fg,this._curAttrData.bg=m.DEFAULT_ATTR_DATA.bg,!0;const a=t.length;let u;const _=this._curAttrData;for(let f=0;f<a;f++)u=t.params[f],u>=30&&u<=37?(_.fg&=-50331904,_.fg|=16777216|u-30):u>=40&&u<=47?(_.bg&=-50331904,_.bg|=16777216|u-40):u>=90&&u<=97?(_.fg&=-50331904,_.fg|=16777224|u-90):u>=100&&u<=107?(_.bg&=-50331904,_.bg|=16777224|u-100):0===u?(_.fg=m.DEFAULT_ATTR_DATA.fg,_.bg=m.DEFAULT_ATTR_DATA.bg):1===u?_.fg|=134217728:3===u?_.bg|=67108864:4===u?(_.fg|=268435456,this._processUnderline(t.hasSubParams(f)?t.getSubParams(f)[0]:1,_)):5===u?_.fg|=536870912:7===u?_.fg|=67108864:8===u?_.fg|=1073741824:9===u?_.fg|=2147483648:2===u?_.bg|=134217728:21===u?this._processUnderline(2,_):22===u?(_.fg&=-134217729,_.bg&=-134217729):23===u?_.bg&=-67108865:24===u?(_.fg&=-268435457,this._processUnderline(0,_)):25===u?_.fg&=-536870913:27===u?_.fg&=-67108865:28===u?_.fg&=-1073741825:29===u?_.fg&=2147483647:39===u?(_.fg&=-67108864,_.fg|=16777215&m.DEFAULT_ATTR_DATA.fg):49===u?(_.bg&=-67108864,_.bg|=16777215&m.DEFAULT_ATTR_DATA.bg):38===u||48===u||58===u?f+=this._extractColor(t,f,_):59===u?(_.extended=_.extended.clone(),_.extended.underlineColor=-1,_.updateExtended()):100===u?(_.fg&=-67108864,_.fg|=16777215&m.DEFAULT_ATTR_DATA.fg,_.bg&=-67108864,_.bg|=16777215&m.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",u);return!0}deviceStatus(t){switch(t.params[0]){case 5:this._coreService.triggerDataEvent(`${_.C0.ESC}[0n`);break;case 6:const t=this._activeBuffer.y+1,a=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${_.C0.ESC}[${t};${a}R`)}return!0}deviceStatusPrivate(t){if(6===t.params[0]){const t=this._activeBuffer.y+1,a=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${_.C0.ESC}[?${t};${a}R`)}return!0}softReset(t){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=m.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(t){const a=t.params[0]||1;switch(a){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const u=a%2==1;return this._optionsService.options.cursorBlink=u,!0}setScrollRegion(t){const a=t.params[0]||1;let u;return(t.length<2||(u=t.params[1])>this._bufferService.rows||0===u)&&(u=this._bufferService.rows),u>a&&(this._activeBuffer.scrollTop=a-1,this._activeBuffer.scrollBottom=u-1,this._setCursor(0,0)),!0}windowOptions(t){if(!R(t.params[0],this._optionsService.rawOptions.windowOptions))return!0;const a=t.length>1?t.params[1]:0;switch(t.params[0]){case 14:2!==a&&this._onRequestWindowsOptionsReport.fire(D.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(D.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${_.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:0!==a&&2!==a||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),0!==a&&1!==a||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:0!==a&&2!==a||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),0!==a&&1!==a||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(t){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(t){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(t){return this._windowTitle=t,this._onTitleChange.fire(t),!0}setIconName(t){return this._iconName=t,!0}setOrReportIndexedColor(t){const a=[],u=t.split(";");for(;u.length>1;){const t=u.shift(),_=u.shift();if(/^\d+$/.exec(t)){const u=parseInt(t);if(0<=u&&u<256)if("?"===_)a.push({type:0,index:u});else{const t=(0,T.parseColor)(_);t&&a.push({type:1,index:u,color:t})}}}return a.length&&this._onColor.fire(a),!0}setHyperlink(t){const a=t.split(";");return!(a.length<2)&&(a[1]?this._createHyperlink(a[0],a[1]):!a[0]&&this._finishHyperlink())}_createHyperlink(t,a){void 0!==this._currentLinkId&&this._finishHyperlink();const u=t.split(":");let _;const f=u.findIndex((t=>t.startsWith("id=")));return-1!==f&&(_=u[f].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._currentLinkId=this._oscLinkService.registerLink({id:_,uri:a}),this._curAttrData.extended.urlId=this._currentLinkId,this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),this._currentLinkId=void 0,!0}_setOrReportSpecialColor(t,a){const u=t.split(";");for(let t=0;t<u.length&&!(a>=this._specialColors.length);++t,++a)if("?"===u[t])this._onColor.fire([{type:0,index:this._specialColors[a]}]);else{const _=(0,T.parseColor)(u[t]);_&&this._onColor.fire([{type:1,index:this._specialColors[a],color:_}])}return!0}setOrReportFgColor(t){return this._setOrReportSpecialColor(t,0)}setOrReportBgColor(t){return this._setOrReportSpecialColor(t,1)}setOrReportCursorColor(t){return this._setOrReportSpecialColor(t,2)}restoreIndexedColor(t){if(!t)return this._onColor.fire([{type:2}]),!0;const a=[],u=t.split(";");for(let t=0;t<u.length;++t)if(/^\d+$/.exec(u[t])){const _=parseInt(u[t]);0<=_&&_<256&&a.push({type:2,index:_})}return a.length&&this._onColor.fire(a),!0}restoreFgColor(t){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(t){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(t){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),!0}selectCharset(t){return 2!==t.length?(this.selectDefaultCharset(),!0):("/"===t[0]||this._charsetService.setgCharset(L[t[0]],f.CHARSETS[t[1]]||f.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const t=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,t,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=m.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=m.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(t){return this._charsetService.setgLevel(t),!0}screenAlignmentPattern(){const t=new w.CellData;t.content=1<<22|"E".charCodeAt(0),t.fg=this._curAttrData.fg,t.bg=this._curAttrData.bg,this._setCursor(0,0);for(let a=0;a<this._bufferService.rows;++a){const u=this._activeBuffer.ybase+this._activeBuffer.y+a,_=this._activeBuffer.lines.get(u);_&&(_.fill(t),_.isWrapped=!1)}return this._dirtyRowService.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(t,a){const u=this._bufferService.buffer,f=this._optionsService.rawOptions;return(t=>(this._coreService.triggerDataEvent(`${_.C0.ESC}${t}${_.C0.ESC}\\`),!0))('"q'===t?`P1$r${this._curAttrData.isProtected()?1:0}"q`:'"p'===t?'P1$r61;1"p':"r"===t?`P1$r${u.scrollTop+1};${u.scrollBottom+1}r`:"m"===t?"P1$r0m":" q"===t?`P1$r${{block:2,underline:4,bar:6}[f.cursorStyle]-(f.cursorBlink?1:0)} q`:"P0$r")}}a.InputHandler=b},844:(t,a)=>{function u(t){for(const a of t)a.dispose();t.length=0}Object.defineProperty(a,"__esModule",{value:!0}),a.getDisposeArrayDisposable=a.disposeArray=a.toDisposable=a.Disposable=void 0,a.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const t of this._disposables)t.dispose();this._disposables.length=0}register(t){return this._disposables.push(t),t}unregister(t){const a=this._disposables.indexOf(t);-1!==a&&this._disposables.splice(a,1)}},a.toDisposable=function(t){return{dispose:t}},a.disposeArray=u,a.getDisposeArrayDisposable=function(t){return{dispose:()=>u(t)}}},1505:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.FourKeyMap=a.TwoKeyMap=void 0;class i{constructor(){this._data={}}set(t,a,u){this._data[t]||(this._data[t]={}),this._data[t][a]=u}get(t,a){return this._data[t]?this._data[t][a]:void 0}clear(){this._data={}}}a.TwoKeyMap=i,a.FourKeyMap=class{constructor(){this._data=new i}set(t,a,u,_,f){this._data.get(t,a)||this._data.set(t,a,new i),this._data.get(t,a).set(u,_,f)}get(t,a,u,_){var f;return null===(f=this._data.get(t,a))||void 0===f?void 0:f.get(u,_)}clear(){this._data.clear()}}},6114:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.isLinux=a.isWindows=a.isIphone=a.isIpad=a.isMac=a.isSafari=a.isLegacyEdge=a.isFirefox=void 0;const u="undefined"==typeof navigator,_=u?"node":navigator.userAgent,f=u?"node":navigator.platform;a.isFirefox=_.includes("Firefox"),a.isLegacyEdge=_.includes("Edge"),a.isSafari=/^((?!chrome|android).)*safari/i.test(_),a.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(f),a.isIpad="iPad"===f,a.isIphone="iPhone"===f,a.isWindows=["Windows","Win16","Win32","WinCE"].includes(f),a.isLinux=f.indexOf("Linux")>=0},6106:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.SortedList=void 0;let u=0;a.SortedList=class{constructor(t){this._getKey=t,this._array=[]}clear(){this._array.length=0}insert(t){0!==this._array.length?(u=this._search(this._getKey(t),0,this._array.length-1),this._array.splice(u,0,t)):this._array.push(t)}delete(t){if(0===this._array.length)return!1;const a=this._getKey(t);if(void 0===a)return!1;if(u=this._search(a,0,this._array.length-1),-1===u)return!1;if(this._getKey(this._array[u])!==a)return!1;do{if(this._array[u]===t)return this._array.splice(u,1),!0}while(++u<this._array.length&&this._getKey(this._array[u])===a);return!1}*getKeyIterator(t){if(0!==this._array.length&&(u=this._search(t,0,this._array.length-1),!(u<0||u>=this._array.length)&&this._getKey(this._array[u])===t))do{yield this._array[u]}while(++u<this._array.length&&this._getKey(this._array[u])===t)}forEachByKey(t,a){if(0!==this._array.length&&(u=this._search(t,0,this._array.length-1),!(u<0||u>=this._array.length)&&this._getKey(this._array[u])===t))do{a(this._array[u])}while(++u<this._array.length&&this._getKey(this._array[u])===t)}values(){return this._array.values()}_search(t,a,u){if(u<a)return a;let _=Math.floor((a+u)/2);const f=this._getKey(this._array[_]);if(f>t)return this._search(t,a,_-1);if(f<t)return this._search(t,_+1,u);for(;_>0&&this._getKey(this._array[_-1])===t;)_--;return _}}},8273:(t,a)=>{function u(t,a,u=0,_=t.length){if(u>=t.length)return t;u=(t.length+u)%t.length,_=_>=t.length?t.length:(t.length+_)%t.length;for(let f=u;f<_;++f)t[f]=a;return t}Object.defineProperty(a,"__esModule",{value:!0}),a.concat=a.fillFallback=a.fill=void 0,a.fill=function(t,a,_,f){return t.fill?t.fill(a,_,f):u(t,a,_,f)},a.fillFallback=u,a.concat=function(t,a){const u=new t.constructor(t.length+a.length);return u.set(t),u.set(a,t.length),u}},9282:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.updateWindowsModeWrappedState=void 0;const _=u(643);a.updateWindowsModeWrappedState=function(t){const a=t.buffer.lines.get(t.buffer.ybase+t.buffer.y-1),u=null==a?void 0:a.get(t.cols-1),f=t.buffer.lines.get(t.buffer.ybase+t.buffer.y);f&&u&&(f.isWrapped=u[_.CHAR_DATA_CODE_INDEX]!==_.NULL_CELL_CODE&&u[_.CHAR_DATA_CODE_INDEX]!==_.WHITESPACE_CELL_CODE)}},3734:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ExtendedAttrs=a.AttributeData=void 0;class i{constructor(){this.fg=0,this.bg=0,this.extended=new s}static toColorRGB(t){return[t>>>16&255,t>>>8&255,255&t]}static fromColorRGB(t){return(255&t[0])<<16|(255&t[1])<<8|255&t[2]}clone(){const t=new i;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return 50331648==(50331648&this.fg)}isBgRGB(){return 50331648==(50331648&this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return 0==(50331648&this.fg)}isBgDefault(){return 0==(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?50331648==(50331648&this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?0==(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}a.AttributeData=i;class s{constructor(t=0,a=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=a}get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(t){this._ext&=-67108864,this._ext|=67108863&t}get urlId(){return this._urlId}set urlId(t){this._urlId=t}clone(){return new s(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}}a.ExtendedAttrs=s},9092:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.BufferStringIterator=a.Buffer=a.MAX_BUFFER_SIZE=void 0;const _=u(6349),f=u(8437),p=u(511),v=u(643),g=u(4634),m=u(4863),S=u(7116),y=u(3734);a.MAX_BUFFER_SIZE=4294967295,a.Buffer=class{constructor(t,a,u){this._hasScrollback=t,this._optionsService=a,this._bufferService=u,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.savedY=0,this.savedX=0,this.savedCurAttrData=f.DEFAULT_ATTR_DATA.clone(),this.savedCharset=S.DEFAULT_CHARSET,this.markers=[],this._nullCell=p.CellData.fromCharData([0,v.NULL_CELL_CHAR,v.NULL_CELL_WIDTH,v.NULL_CELL_CODE]),this._whitespaceCell=p.CellData.fromCharData([0,v.WHITESPACE_CELL_CHAR,v.WHITESPACE_CELL_WIDTH,v.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new _.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(t){return t?(this._nullCell.fg=t.fg,this._nullCell.bg=t.bg,this._nullCell.extended=t.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new y.ExtendedAttrs),this._nullCell}getWhitespaceCell(t){return t?(this._whitespaceCell.fg=t.fg,this._whitespaceCell.bg=t.bg,this._whitespaceCell.extended=t.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new y.ExtendedAttrs),this._whitespaceCell}getBlankLine(t,a){return new f.BufferLine(this._bufferService.cols,this.getNullCell(t),a)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const t=this.ybase+this.y-this.ydisp;return t>=0&&t<this._rows}_getCorrectBufferLength(t){if(!this._hasScrollback)return t;const u=t+this._optionsService.rawOptions.scrollback;return u>a.MAX_BUFFER_SIZE?a.MAX_BUFFER_SIZE:u}fillViewportRows(t){if(0===this.lines.length){void 0===t&&(t=f.DEFAULT_ATTR_DATA);let a=this._rows;for(;a--;)this.lines.push(this.getBlankLine(t))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new _.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(t,a){const u=this.getNullCell(f.DEFAULT_ATTR_DATA),_=this._getCorrectBufferLength(a);if(_>this.lines.maxLength&&(this.lines.maxLength=_),this.lines.length>0){if(this._cols<t)for(let a=0;a<this.lines.length;a++)this.lines.get(a).resize(t,u);let p=0;if(this._rows<a)for(let _=this._rows;_<a;_++)this.lines.length<a+this.ybase&&(this._optionsService.rawOptions.windowsMode?this.lines.push(new f.BufferLine(t,u)):this.ybase>0&&this.lines.length<=this.ybase+this.y+p+1?(this.ybase--,p++,this.ydisp>0&&this.ydisp--):this.lines.push(new f.BufferLine(t,u)));else for(let t=this._rows;t>a;t--)this.lines.length>a+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(_<this.lines.maxLength){const t=this.lines.length-_;t>0&&(this.lines.trimStart(t),this.ybase=Math.max(this.ybase-t,0),this.ydisp=Math.max(this.ydisp-t,0),this.savedY=Math.max(this.savedY-t,0)),this.lines.maxLength=_}this.x=Math.min(this.x,t-1),this.y=Math.min(this.y,a-1),p&&(this.y+=p),this.savedX=Math.min(this.savedX,t-1),this.scrollTop=0}if(this.scrollBottom=a-1,this._isReflowEnabled&&(this._reflow(t,a),this._cols>t))for(let a=0;a<this.lines.length;a++)this.lines.get(a).resize(t,u);this._cols=t,this._rows=a}get _isReflowEnabled(){return this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(t,a){this._cols!==t&&(t>this._cols?this._reflowLarger(t,a):this._reflowSmaller(t,a))}_reflowLarger(t,a){const u=(0,g.reflowLargerGetLinesToRemove)(this.lines,this._cols,t,this.ybase+this.y,this.getNullCell(f.DEFAULT_ATTR_DATA));if(u.length>0){const _=(0,g.reflowLargerCreateNewLayout)(this.lines,u);(0,g.reflowLargerApplyNewLayout)(this.lines,_.layout),this._reflowLargerAdjustViewport(t,a,_.countRemoved)}}_reflowLargerAdjustViewport(t,a,u){const _=this.getNullCell(f.DEFAULT_ATTR_DATA);let p=u;for(;p-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<a&&this.lines.push(new f.BufferLine(t,_))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-u,0)}_reflowSmaller(t,a){const u=this.getNullCell(f.DEFAULT_ATTR_DATA),_=[];let p=0;for(let v=this.lines.length-1;v>=0;v--){let m=this.lines.get(v);if(!m||!m.isWrapped&&m.getTrimmedLength()<=t)continue;const S=[m];for(;m.isWrapped&&v>0;)m=this.lines.get(--v),S.unshift(m);const y=this.ybase+this.y;if(y>=v&&y<v+S.length)continue;const w=S[S.length-1].getTrimmedLength(),x=(0,g.reflowSmallerGetNewLineLengths)(S,this._cols,t),E=x.length-S.length;let j;j=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+E):Math.max(0,this.lines.length-this.lines.maxLength+E);const k=[];for(let t=0;t<E;t++){const t=this.getBlankLine(f.DEFAULT_ATTR_DATA,!0);k.push(t)}k.length>0&&(_.push({start:v+S.length+p,newLines:k}),p+=k.length),S.push(...k);let T=x.length-1,L=x[T];0===L&&(T--,L=x[T]);let A=S.length-E-1,R=w;for(;A>=0;){const t=Math.min(R,L);if(void 0===S[T])break;if(S[T].copyCellsFrom(S[A],R-t,L-t,t,!0),L-=t,0===L&&(T--,L=x[T]),R-=t,0===R){A--;const t=Math.max(A,0);R=(0,g.getWrappedLineTrimmedLength)(S,t,this._cols)}}for(let a=0;a<S.length;a++)x[a]<t&&S[a].setCell(x[a],u);let D=E-j;for(;D-- >0;)0===this.ybase?this.y<a-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+p)-a&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+E,this.ybase+a-1)}if(_.length>0){const t=[],a=[];for(let t=0;t<this.lines.length;t++)a.push(this.lines.get(t));const u=this.lines.length;let f=u-1,v=0,g=_[v];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+p);let m=0;for(let S=Math.min(this.lines.maxLength-1,u+p-1);S>=0;S--)if(g&&g.start>f+m){for(let t=g.newLines.length-1;t>=0;t--)this.lines.set(S--,g.newLines[t]);S++,t.push({index:f+1,amount:g.newLines.length}),m+=g.newLines.length,g=_[++v]}else this.lines.set(S,a[f--]);let S=0;for(let a=t.length-1;a>=0;a--)t[a].index+=S,this.lines.onInsertEmitter.fire(t[a]),S+=t[a].amount;const y=Math.max(0,u+p-this.lines.maxLength);y>0&&this.lines.onTrimEmitter.fire(y)}}stringIndexToBufferIndex(t,a,u=!1){for(;a;){const _=this.lines.get(t);if(!_)return[-1,-1];const f=u?_.getTrimmedLength():_.length;for(let u=0;u<f;++u)if(_.get(u)[v.CHAR_DATA_WIDTH_INDEX]&&(a-=_.get(u)[v.CHAR_DATA_CHAR_INDEX].length||1),a<0)return[t,u];t++}return[t,0]}translateBufferLineToString(t,a,u=0,_){const f=this.lines.get(t);return f?f.translateToString(a,u,_):""}getWrappedRangeForLine(t){let a=t,u=t;for(;a>0&&this.lines.get(a).isWrapped;)a--;for(;u+1<this.lines.length&&this.lines.get(u+1).isWrapped;)u++;return{first:a,last:u}}setupTabStops(t){for(null!=t?this.tabs[t]||(t=this.prevStop(t)):(this.tabs={},t=0);t<this._cols;t+=this._optionsService.rawOptions.tabStopWidth)this.tabs[t]=!0}prevStop(t){for(null==t&&(t=this.x);!this.tabs[--t]&&t>0;);return t>=this._cols?this._cols-1:t<0?0:t}nextStop(t){for(null==t&&(t=this.x);!this.tabs[++t]&&t<this._cols;);return t>=this._cols?this._cols-1:t<0?0:t}clearMarkers(t){this._isClearing=!0;for(let a=0;a<this.markers.length;a++)this.markers[a].line===t&&(this.markers[a].dispose(),this.markers.splice(a--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].dispose(),this.markers.splice(t--,1);this._isClearing=!1}addMarker(t){const a=new m.Marker(t);return this.markers.push(a),a.register(this.lines.onTrim((t=>{a.line-=t,a.line<0&&a.dispose()}))),a.register(this.lines.onInsert((t=>{a.line>=t.index&&(a.line+=t.amount)}))),a.register(this.lines.onDelete((t=>{a.line>=t.index&&a.line<t.index+t.amount&&a.dispose(),a.line>t.index&&(a.line-=t.amount)}))),a.register(a.onDispose((()=>this._removeMarker(a)))),a}_removeMarker(t){this._isClearing||this.markers.splice(this.markers.indexOf(t),1)}iterator(t,a,u,_,f){return new d(this,t,a,u,_,f)}};class d{constructor(t,a,u=0,_=t.lines.length,f=0,p=0){this._buffer=t,this._trimRight=a,this._startIndex=u,this._endIndex=_,this._startOverscan=f,this._endOverscan=p,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}hasNext(){return this._current<this._endIndex}next(){const t=this._buffer.getWrappedRangeForLine(this._current);t.first<this._startIndex-this._startOverscan&&(t.first=this._startIndex-this._startOverscan),t.last>this._endIndex+this._endOverscan&&(t.last=this._endIndex+this._endOverscan),t.first=Math.max(t.first,0),t.last=Math.min(t.last,this._buffer.lines.length);let a="";for(let u=t.first;u<=t.last;++u)a+=this._buffer.translateBufferLineToString(u,this._trimRight);return this._current=t.last+1,{range:t,content:a}}}a.BufferStringIterator=d},8437:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.BufferLine=a.DEFAULT_ATTR_DATA=void 0;const _=u(482),f=u(643),p=u(511),v=u(3734);a.DEFAULT_ATTR_DATA=Object.freeze(new v.AttributeData);const g={startIndex:0};class h{constructor(t,a,u=!1){this.isWrapped=u,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*t);const _=a||p.CellData.fromCharData([0,f.NULL_CELL_CHAR,f.NULL_CELL_WIDTH,f.NULL_CELL_CODE]);for(let a=0;a<t;++a)this.setCell(a,_);this.length=t}get(t){const a=this._data[3*t+0],u=2097151&a;return[this._data[3*t+1],2097152&a?this._combined[t]:u?(0,_.stringFromCodePoint)(u):"",a>>22,2097152&a?this._combined[t].charCodeAt(this._combined[t].length-1):u]}set(t,a){this._data[3*t+1]=a[f.CHAR_DATA_ATTR_INDEX],a[f.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[t]=a[1],this._data[3*t+0]=2097152|t|a[f.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*t+0]=a[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|a[f.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(t){return this._data[3*t+0]>>22}hasWidth(t){return 12582912&this._data[3*t+0]}getFg(t){return this._data[3*t+1]}getBg(t){return this._data[3*t+2]}hasContent(t){return 4194303&this._data[3*t+0]}getCodePoint(t){const a=this._data[3*t+0];return 2097152&a?this._combined[t].charCodeAt(this._combined[t].length-1):2097151&a}isCombined(t){return 2097152&this._data[3*t+0]}getString(t){const a=this._data[3*t+0];return 2097152&a?this._combined[t]:2097151&a?(0,_.stringFromCodePoint)(2097151&a):""}isProtected(t){return 536870912&this._data[3*t+2]}loadCell(t,a){return g.startIndex=3*t,a.content=this._data[g.startIndex+0],a.fg=this._data[g.startIndex+1],a.bg=this._data[g.startIndex+2],2097152&a.content&&(a.combinedData=this._combined[t]),268435456&a.bg&&(a.extended=this._extendedAttrs[t]),a}setCell(t,a){2097152&a.content&&(this._combined[t]=a.combinedData),268435456&a.bg&&(this._extendedAttrs[t]=a.extended),this._data[3*t+0]=a.content,this._data[3*t+1]=a.fg,this._data[3*t+2]=a.bg}setCellFromCodePoint(t,a,u,_,f,p){268435456&f&&(this._extendedAttrs[t]=p),this._data[3*t+0]=a|u<<22,this._data[3*t+1]=_,this._data[3*t+2]=f}addCodepointToCell(t,a){let u=this._data[3*t+0];2097152&u?this._combined[t]+=(0,_.stringFromCodePoint)(a):(2097151&u?(this._combined[t]=(0,_.stringFromCodePoint)(2097151&u)+(0,_.stringFromCodePoint)(a),u&=-2097152,u|=2097152):u=a|1<<22,this._data[3*t+0]=u)}insertCells(t,a,u,_){if((t%=this.length)&&2===this.getWidth(t-1)&&this.setCellFromCodePoint(t-1,0,1,(null==_?void 0:_.fg)||0,(null==_?void 0:_.bg)||0,(null==_?void 0:_.extended)||new v.ExtendedAttrs),a<this.length-t){const _=new p.CellData;for(let u=this.length-t-a-1;u>=0;--u)this.setCell(t+a+u,this.loadCell(t+u,_));for(let _=0;_<a;++_)this.setCell(t+_,u)}else for(let a=t;a<this.length;++a)this.setCell(a,u);2===this.getWidth(this.length-1)&&this.setCellFromCodePoint(this.length-1,0,1,(null==_?void 0:_.fg)||0,(null==_?void 0:_.bg)||0,(null==_?void 0:_.extended)||new v.ExtendedAttrs)}deleteCells(t,a,u,_){if(t%=this.length,a<this.length-t){const _=new p.CellData;for(let u=0;u<this.length-t-a;++u)this.setCell(t+u,this.loadCell(t+a+u,_));for(let t=this.length-a;t<this.length;++t)this.setCell(t,u)}else for(let a=t;a<this.length;++a)this.setCell(a,u);t&&2===this.getWidth(t-1)&&this.setCellFromCodePoint(t-1,0,1,(null==_?void 0:_.fg)||0,(null==_?void 0:_.bg)||0,(null==_?void 0:_.extended)||new v.ExtendedAttrs),0!==this.getWidth(t)||this.hasContent(t)||this.setCellFromCodePoint(t,0,1,(null==_?void 0:_.fg)||0,(null==_?void 0:_.bg)||0,(null==_?void 0:_.extended)||new v.ExtendedAttrs)}replaceCells(t,a,u,_,f=!1){if(f)for(t&&2===this.getWidth(t-1)&&!this.isProtected(t-1)&&this.setCellFromCodePoint(t-1,0,1,(null==_?void 0:_.fg)||0,(null==_?void 0:_.bg)||0,(null==_?void 0:_.extended)||new v.ExtendedAttrs),a<this.length&&2===this.getWidth(a-1)&&!this.isProtected(a)&&this.setCellFromCodePoint(a,0,1,(null==_?void 0:_.fg)||0,(null==_?void 0:_.bg)||0,(null==_?void 0:_.extended)||new v.ExtendedAttrs);t<a&&t<this.length;)this.isProtected(t)||this.setCell(t,u),t++;else for(t&&2===this.getWidth(t-1)&&this.setCellFromCodePoint(t-1,0,1,(null==_?void 0:_.fg)||0,(null==_?void 0:_.bg)||0,(null==_?void 0:_.extended)||new v.ExtendedAttrs),a<this.length&&2===this.getWidth(a-1)&&this.setCellFromCodePoint(a,0,1,(null==_?void 0:_.fg)||0,(null==_?void 0:_.bg)||0,(null==_?void 0:_.extended)||new v.ExtendedAttrs);t<a&&t<this.length;)this.setCell(t++,u)}resize(t,a){if(t!==this.length){if(t>this.length){const u=new Uint32Array(3*t);this.length&&(3*t<this._data.length?u.set(this._data.subarray(0,3*t)):u.set(this._data)),this._data=u;for(let u=this.length;u<t;++u)this.setCell(u,a)}else if(t){const a=new Uint32Array(3*t);a.set(this._data.subarray(0,3*t)),this._data=a;const u=Object.keys(this._combined);for(let a=0;a<u.length;a++){const _=parseInt(u[a],10);_>=t&&delete this._combined[_]}}else this._data=new Uint32Array(0),this._combined={};this.length=t}}fill(t,a=!1){if(a)for(let a=0;a<this.length;++a)this.isProtected(a)||this.setCell(a,t);else{this._combined={},this._extendedAttrs={};for(let a=0;a<this.length;++a)this.setCell(a,t)}}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(const a in t._combined)this._combined[a]=t._combined[a];this._extendedAttrs={};for(const a in t._extendedAttrs)this._extendedAttrs[a]=t._extendedAttrs[a];this.isWrapped=t.isWrapped}clone(){const t=new h(0);t._data=new Uint32Array(this._data),t.length=this.length;for(const a in this._combined)t._combined[a]=this._combined[a];for(const a in this._extendedAttrs)t._extendedAttrs[a]=this._extendedAttrs[a];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(4194303&this._data[3*t+0])return t+(this._data[3*t+0]>>22);return 0}copyCellsFrom(t,a,u,_,f){const p=t._data;if(f)for(let f=_-1;f>=0;f--){for(let t=0;t<3;t++)this._data[3*(u+f)+t]=p[3*(a+f)+t];268435456&p[3*(a+f)+2]&&(this._extendedAttrs[u+f]=t._extendedAttrs[a+f])}else for(let f=0;f<_;f++){for(let t=0;t<3;t++)this._data[3*(u+f)+t]=p[3*(a+f)+t];268435456&p[3*(a+f)+2]&&(this._extendedAttrs[u+f]=t._extendedAttrs[a+f])}const v=Object.keys(t._combined);for(let _=0;_<v.length;_++){const f=parseInt(v[_],10);f>=a&&(this._combined[f-a+u]=t._combined[f])}}translateToString(t=!1,a=0,u=this.length){t&&(u=Math.min(u,this.getTrimmedLength()));let p="";for(;a<u;){const t=this._data[3*a+0],u=2097151&t;p+=2097152&t?this._combined[a]:u?(0,_.stringFromCodePoint)(u):f.WHITESPACE_CELL_CHAR,a+=t>>22||1}return p}}a.BufferLine=h},4841:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.getRangeLength=void 0,a.getRangeLength=function(t,a){if(t.start.y>t.end.y)throw new Error(`Buffer range end (${t.end.x}, ${t.end.y}) cannot be before start (${t.start.x}, ${t.start.y})`);return a*(t.end.y-t.start.y)+(t.end.x-t.start.x+1)}},4634:(t,a)=>{function u(t,a,u){if(a===t.length-1)return t[a].getTrimmedLength();const _=!t[a].hasContent(u-1)&&1===t[a].getWidth(u-1),f=2===t[a+1].getWidth(0);return _&&f?u-1:u}Object.defineProperty(a,"__esModule",{value:!0}),a.getWrappedLineTrimmedLength=a.reflowSmallerGetNewLineLengths=a.reflowLargerApplyNewLayout=a.reflowLargerCreateNewLayout=a.reflowLargerGetLinesToRemove=void 0,a.reflowLargerGetLinesToRemove=function(t,a,_,f,p){const v=[];for(let g=0;g<t.length-1;g++){let m=g,S=t.get(++m);if(!S.isWrapped)continue;const y=[t.get(g)];for(;m<t.length&&S.isWrapped;)y.push(S),S=t.get(++m);if(f>=g&&f<m){g+=y.length-1;continue}let w=0,x=u(y,w,a),E=1,j=0;for(;E<y.length;){const t=u(y,E,a),f=t-j,v=_-x,g=Math.min(f,v);y[w].copyCellsFrom(y[E],j,x,g,!1),x+=g,x===_&&(w++,x=0),j+=g,j===t&&(E++,j=0),0===x&&0!==w&&2===y[w-1].getWidth(_-1)&&(y[w].copyCellsFrom(y[w-1],_-1,x++,1,!1),y[w-1].setCell(_-1,p))}y[w].replaceCells(x,_,p);let k=0;for(let t=y.length-1;t>0&&(t>w||0===y[t].getTrimmedLength());t--)k++;k>0&&(v.push(g+y.length-k),v.push(k)),g+=y.length-1}return v},a.reflowLargerCreateNewLayout=function(t,a){const u=[];let _=0,f=a[_],p=0;for(let v=0;v<t.length;v++)if(f===v){const u=a[++_];t.onDeleteEmitter.fire({index:v-p,amount:u}),v+=u-1,p+=u,f=a[++_]}else u.push(v);return{layout:u,countRemoved:p}},a.reflowLargerApplyNewLayout=function(t,a){const u=[];for(let _=0;_<a.length;_++)u.push(t.get(a[_]));for(let a=0;a<u.length;a++)t.set(a,u[a]);t.length=a.length},a.reflowSmallerGetNewLineLengths=function(t,a,_){const f=[],p=t.map(((_,f)=>u(t,f,a))).reduce(((t,a)=>t+a));let v=0,g=0,m=0;for(;m<p;){if(p-m<_){f.push(p-m);break}v+=_;const S=u(t,g,a);v>S&&(v-=S,g++);const y=2===t[g].getWidth(v-1);y&&v--;const w=y?_-1:_;f.push(w),m+=w}return f},a.getWrappedLineTrimmedLength=u},5295:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.BufferSet=void 0;const _=u(9092),f=u(8460),p=u(844);class o extends p.Disposable{constructor(t,a){super(),this._optionsService=t,this._bufferService=a,this._onBufferActivate=this.register(new f.EventEmitter),this.reset()}get onBufferActivate(){return this._onBufferActivate.event}reset(){this._normal=new _.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new _.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(t){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(t),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(t,a){this._normal.resize(t,a),this._alt.resize(t,a)}setupTabStops(t){this._normal.setupTabStops(t),this._alt.setupTabStops(t)}}a.BufferSet=o},511:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CellData=void 0;const _=u(482),f=u(643),p=u(3734);class o extends p.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new p.ExtendedAttrs,this.combinedData=""}static fromCharData(t){const a=new o;return a.setFromCharData(t),a}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,_.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(t){this.fg=t[f.CHAR_DATA_ATTR_INDEX],this.bg=0;let a=!1;if(t[f.CHAR_DATA_CHAR_INDEX].length>2)a=!0;else if(2===t[f.CHAR_DATA_CHAR_INDEX].length){const u=t[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=u&&u<=56319){const _=t[f.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=_&&_<=57343?this.content=1024*(u-55296)+_-56320+65536|t[f.CHAR_DATA_WIDTH_INDEX]<<22:a=!0}else a=!0}else this.content=t[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[f.CHAR_DATA_WIDTH_INDEX]<<22;a&&(this.combinedData=t[f.CHAR_DATA_CHAR_INDEX],this.content=2097152|t[f.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}a.CellData=o},643:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.WHITESPACE_CELL_CODE=a.WHITESPACE_CELL_WIDTH=a.WHITESPACE_CELL_CHAR=a.NULL_CELL_CODE=a.NULL_CELL_WIDTH=a.NULL_CELL_CHAR=a.CHAR_DATA_CODE_INDEX=a.CHAR_DATA_WIDTH_INDEX=a.CHAR_DATA_CHAR_INDEX=a.CHAR_DATA_ATTR_INDEX=a.DEFAULT_EXT=a.DEFAULT_ATTR=a.DEFAULT_COLOR=void 0,a.DEFAULT_COLOR=256,a.DEFAULT_ATTR=256|a.DEFAULT_COLOR<<9,a.DEFAULT_EXT=0,a.CHAR_DATA_ATTR_INDEX=0,a.CHAR_DATA_CHAR_INDEX=1,a.CHAR_DATA_WIDTH_INDEX=2,a.CHAR_DATA_CODE_INDEX=3,a.NULL_CELL_CHAR="",a.NULL_CELL_WIDTH=1,a.NULL_CELL_CODE=0,a.WHITESPACE_CELL_CHAR=" ",a.WHITESPACE_CELL_WIDTH=1,a.WHITESPACE_CELL_CODE=32},4863:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Marker=void 0;const _=u(8460),f=u(844);class n extends f.Disposable{constructor(t){super(),this.line=t,this._id=n._nextId++,this.isDisposed=!1,this._onDispose=new _.EventEmitter}get id(){return this._id}get onDispose(){return this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),super.dispose())}}a.Marker=n,n._nextId=1},7116:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.DEFAULT_CHARSET=a.CHARSETS=void 0,a.CHARSETS={},a.DEFAULT_CHARSET=a.CHARSETS.B,a.CHARSETS[0]={"`":"â",a:"â",b:"â",c:"â",d:"â",e:"â",f:"Â°",g:"Â±",h:"â¤",i:"â",j:"â",k:"â",l:"â",m:"â",n:"â¼",o:"âº",p:"â»",q:"â",r:"â¼",s:"â½",t:"â",u:"â¤",v:"â´",w:"â¬",x:"â",y:"â¤",z:"â¥","{":"Ï","|":"â ","}":"Â£","~":"Â·"},a.CHARSETS.A={"#":"Â£"},a.CHARSETS.B=void 0,a.CHARSETS[4]={"#":"Â£","@":"Â¾","[":"ij","\\":"Â½","]":"|","{":"Â¨","|":"f","}":"Â¼","~":"Â´"},a.CHARSETS.C=a.CHARSETS[5]={"[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},a.CHARSETS.R={"#":"Â£","@":"Ã ","[":"Â°","\\":"Ã§","]":"Â§","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Â¨"},a.CHARSETS.Q={"@":"Ã ","[":"Ã¢","\\":"Ã§","]":"Ãª","^":"Ã®","`":"Ã´","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Ã»"},a.CHARSETS.K={"@":"Â§","[":"Ã","\\":"Ã","]":"Ã","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã"},a.CHARSETS.Y={"#":"Â£","@":"Â§","[":"Â°","\\":"Ã§","]":"Ã©","`":"Ã¹","{":"Ã ","|":"Ã²","}":"Ã¨","~":"Ã¬"},a.CHARSETS.E=a.CHARSETS[6]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã¤","{":"Ã¦","|":"Ã¸","}":"Ã¥","~":"Ã¼"},a.CHARSETS.Z={"#":"Â£","@":"Â§","[":"Â¡","\\":"Ã","]":"Â¿","{":"Â°","|":"Ã±","}":"Ã§"},a.CHARSETS.H=a.CHARSETS[7]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},a.CHARSETS["="]={"#":"Ã¹","@":"Ã ","[":"Ã©","\\":"Ã§","]":"Ãª","^":"Ã®",_:"Ã¨","`":"Ã´","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã»"}},2584:(t,a)=>{var u,_;Object.defineProperty(a,"__esModule",{value:!0}),a.C1_ESCAPED=a.C1=a.C0=void 0,function(t){t.NUL="\0",t.SOH="",t.STX="",t.ETX="",t.EOT="",t.ENQ="",t.ACK="",t.BEL="",t.BS="\b",t.HT="\t",t.LF="\n",t.VT="\v",t.FF="\f",t.CR="\r",t.SO="",t.SI="",t.DLE="",t.DC1="",t.DC2="",t.DC3="",t.DC4="",t.NAK="",t.SYN="",t.ETB="",t.CAN="",t.EM="",t.SUB="",t.ESC="",t.FS="",t.GS="",t.RS="",t.US="",t.SP=" ",t.DEL=""}(u=a.C0||(a.C0={})),(_=a.C1||(a.C1={})).PAD="Â",_.HOP="Â",_.BPH="Â",_.NBH="Â",_.IND="Â",_.NEL="Â",_.SSA="Â",_.ESA="Â",_.HTS="Â",_.HTJ="Â",_.VTS="Â",_.PLD="Â",_.PLU="Â",_.RI="Â",_.SS2="Â",_.SS3="Â",_.DCS="Â",_.PU1="Â",_.PU2="Â",_.STS="Â",_.CCH="Â",_.MW="Â",_.SPA="Â",_.EPA="Â",_.SOS="Â",_.SGCI="Â",_.SCI="Â",_.CSI="Â",_.ST="Â",_.OSC="Â",_.PM="Â",_.APC="Â",(a.C1_ESCAPED||(a.C1_ESCAPED={})).ST=`${u.ESC}\\`},7399:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.evaluateKeyboardEvent=void 0;const _=u(2584),f={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};a.evaluateKeyboardEvent=function(t,a,u,p){const v={type:0,cancel:!1,key:void 0},g=(t.shiftKey?1:0)|(t.altKey?2:0)|(t.ctrlKey?4:0)|(t.metaKey?8:0);switch(t.keyCode){case 0:"UIKeyInputUpArrow"===t.key?v.key=a?_.C0.ESC+"OA":_.C0.ESC+"[A":"UIKeyInputLeftArrow"===t.key?v.key=a?_.C0.ESC+"OD":_.C0.ESC+"[D":"UIKeyInputRightArrow"===t.key?v.key=a?_.C0.ESC+"OC":_.C0.ESC+"[C":"UIKeyInputDownArrow"===t.key&&(v.key=a?_.C0.ESC+"OB":_.C0.ESC+"[B");break;case 8:if(t.altKey){v.key=_.C0.ESC+_.C0.DEL;break}v.key=_.C0.DEL;break;case 9:if(t.shiftKey){v.key=_.C0.ESC+"[Z";break}v.key=_.C0.HT,v.cancel=!0;break;case 13:v.key=t.altKey?_.C0.ESC+_.C0.CR:_.C0.CR,v.cancel=!0;break;case 27:v.key=_.C0.ESC,t.altKey&&(v.key=_.C0.ESC+_.C0.ESC),v.cancel=!0;break;case 37:if(t.metaKey)break;g?(v.key=_.C0.ESC+"[1;"+(g+1)+"D",v.key===_.C0.ESC+"[1;3D"&&(v.key=_.C0.ESC+(u?"b":"[1;5D"))):v.key=a?_.C0.ESC+"OD":_.C0.ESC+"[D";break;case 39:if(t.metaKey)break;g?(v.key=_.C0.ESC+"[1;"+(g+1)+"C",v.key===_.C0.ESC+"[1;3C"&&(v.key=_.C0.ESC+(u?"f":"[1;5C"))):v.key=a?_.C0.ESC+"OC":_.C0.ESC+"[C";break;case 38:if(t.metaKey)break;g?(v.key=_.C0.ESC+"[1;"+(g+1)+"A",u||v.key!==_.C0.ESC+"[1;3A"||(v.key=_.C0.ESC+"[1;5A")):v.key=a?_.C0.ESC+"OA":_.C0.ESC+"[A";break;case 40:if(t.metaKey)break;g?(v.key=_.C0.ESC+"[1;"+(g+1)+"B",u||v.key!==_.C0.ESC+"[1;3B"||(v.key=_.C0.ESC+"[1;5B")):v.key=a?_.C0.ESC+"OB":_.C0.ESC+"[B";break;case 45:t.shiftKey||t.ctrlKey||(v.key=_.C0.ESC+"[2~");break;case 46:v.key=g?_.C0.ESC+"[3;"+(g+1)+"~":_.C0.ESC+"[3~";break;case 36:v.key=g?_.C0.ESC+"[1;"+(g+1)+"H":a?_.C0.ESC+"OH":_.C0.ESC+"[H";break;case 35:v.key=g?_.C0.ESC+"[1;"+(g+1)+"F":a?_.C0.ESC+"OF":_.C0.ESC+"[F";break;case 33:t.shiftKey?v.type=2:t.ctrlKey?v.key=_.C0.ESC+"[5;"+(g+1)+"~":v.key=_.C0.ESC+"[5~";break;case 34:t.shiftKey?v.type=3:t.ctrlKey?v.key=_.C0.ESC+"[6;"+(g+1)+"~":v.key=_.C0.ESC+"[6~";break;case 112:v.key=g?_.C0.ESC+"[1;"+(g+1)+"P":_.C0.ESC+"OP";break;case 113:v.key=g?_.C0.ESC+"[1;"+(g+1)+"Q":_.C0.ESC+"OQ";break;case 114:v.key=g?_.C0.ESC+"[1;"+(g+1)+"R":_.C0.ESC+"OR";break;case 115:v.key=g?_.C0.ESC+"[1;"+(g+1)+"S":_.C0.ESC+"OS";break;case 116:v.key=g?_.C0.ESC+"[15;"+(g+1)+"~":_.C0.ESC+"[15~";break;case 117:v.key=g?_.C0.ESC+"[17;"+(g+1)+"~":_.C0.ESC+"[17~";break;case 118:v.key=g?_.C0.ESC+"[18;"+(g+1)+"~":_.C0.ESC+"[18~";break;case 119:v.key=g?_.C0.ESC+"[19;"+(g+1)+"~":_.C0.ESC+"[19~";break;case 120:v.key=g?_.C0.ESC+"[20;"+(g+1)+"~":_.C0.ESC+"[20~";break;case 121:v.key=g?_.C0.ESC+"[21;"+(g+1)+"~":_.C0.ESC+"[21~";break;case 122:v.key=g?_.C0.ESC+"[23;"+(g+1)+"~":_.C0.ESC+"[23~";break;case 123:v.key=g?_.C0.ESC+"[24;"+(g+1)+"~":_.C0.ESC+"[24~";break;default:if(!t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)if(u&&!p||!t.altKey||t.metaKey)!u||t.altKey||t.ctrlKey||t.shiftKey||!t.metaKey?t.key&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&t.keyCode>=48&&1===t.key.length?v.key=t.key:t.key&&t.ctrlKey&&("_"===t.key&&(v.key=_.C0.US),"@"===t.key&&(v.key=_.C0.NUL)):65===t.keyCode&&(v.type=1);else{const a=f[t.keyCode],u=null==a?void 0:a[t.shiftKey?1:0];if(u)v.key=_.C0.ESC+u;else if(t.keyCode>=65&&t.keyCode<=90){const a=t.ctrlKey?t.keyCode-64:t.keyCode+32;let u=String.fromCharCode(a);t.shiftKey&&(u=u.toUpperCase()),v.key=_.C0.ESC+u}else if("Dead"===t.key&&t.code.startsWith("Key")){let a=t.code.slice(3,4);t.shiftKey||(a=a.toLowerCase()),v.key=_.C0.ESC+a,v.cancel=!0}}else t.keyCode>=65&&t.keyCode<=90?v.key=String.fromCharCode(t.keyCode-64):32===t.keyCode?v.key=_.C0.NUL:t.keyCode>=51&&t.keyCode<=55?v.key=String.fromCharCode(t.keyCode-51+27):56===t.keyCode?v.key=_.C0.DEL:219===t.keyCode?v.key=_.C0.ESC:220===t.keyCode?v.key=_.C0.FS:221===t.keyCode&&(v.key=_.C0.GS)}return v}},482:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Utf8ToUtf32=a.StringToUtf32=a.utf32ToString=a.stringFromCodePoint=void 0,a.stringFromCodePoint=function(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):String.fromCharCode(t)},a.utf32ToString=function(t,a=0,u=t.length){let _="";for(let f=a;f<u;++f){let a=t[f];a>65535?(a-=65536,_+=String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):_+=String.fromCharCode(a)}return _},a.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(t,a){const u=t.length;if(!u)return 0;let _=0,f=0;if(this._interim){const u=t.charCodeAt(f++);56320<=u&&u<=57343?a[_++]=1024*(this._interim-55296)+u-56320+65536:(a[_++]=this._interim,a[_++]=u),this._interim=0}for(let p=f;p<u;++p){const f=t.charCodeAt(p);if(55296<=f&&f<=56319){if(++p>=u)return this._interim=f,_;const v=t.charCodeAt(p);56320<=v&&v<=57343?a[_++]=1024*(f-55296)+v-56320+65536:(a[_++]=f,a[_++]=v)}else 65279!==f&&(a[_++]=f)}return _}},a.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(t,a){const u=t.length;if(!u)return 0;let _,f,p,v,g=0,m=0,S=0;if(this.interim[0]){let _=!1,f=this.interim[0];f&=192==(224&f)?31:224==(240&f)?15:7;let p,v=0;for(;(p=63&this.interim[++v])&&v<4;)f<<=6,f|=p;const m=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,y=m-v;for(;S<y;){if(S>=u)return 0;if(p=t[S++],128!=(192&p)){S--,_=!0;break}this.interim[v++]=p,f<<=6,f|=63&p}_||(2===m?f<128?S--:a[g++]=f:3===m?f<2048||f>=55296&&f<=57343||65279===f||(a[g++]=f):f<65536||f>1114111||(a[g++]=f)),this.interim.fill(0)}const y=u-4;let w=S;for(;w<u;){for(;!(!(w<y)||128&(_=t[w])||128&(f=t[w+1])||128&(p=t[w+2])||128&(v=t[w+3]));)a[g++]=_,a[g++]=f,a[g++]=p,a[g++]=v,w+=4;if(_=t[w++],_<128)a[g++]=_;else if(192==(224&_)){if(w>=u)return this.interim[0]=_,g;if(f=t[w++],128!=(192&f)){w--;continue}if(m=(31&_)<<6|63&f,m<128){w--;continue}a[g++]=m}else if(224==(240&_)){if(w>=u)return this.interim[0]=_,g;if(f=t[w++],128!=(192&f)){w--;continue}if(w>=u)return this.interim[0]=_,this.interim[1]=f,g;if(p=t[w++],128!=(192&p)){w--;continue}if(m=(15&_)<<12|(63&f)<<6|63&p,m<2048||m>=55296&&m<=57343||65279===m)continue;a[g++]=m}else if(240==(248&_)){if(w>=u)return this.interim[0]=_,g;if(f=t[w++],128!=(192&f)){w--;continue}if(w>=u)return this.interim[0]=_,this.interim[1]=f,g;if(p=t[w++],128!=(192&p)){w--;continue}if(w>=u)return this.interim[0]=_,this.interim[1]=f,this.interim[2]=p,g;if(v=t[w++],128!=(192&v)){w--;continue}if(m=(7&_)<<18|(63&f)<<12|(63&p)<<6|63&v,m<65536||m>1114111)continue;a[g++]=m}}return g}}},225:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.UnicodeV6=void 0;const _=u(8273),f=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],p=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let v;a.UnicodeV6=class{constructor(){if(this.version="6",!v){v=new Uint8Array(65536),(0,_.fill)(v,1),v[0]=0,(0,_.fill)(v,0,1,32),(0,_.fill)(v,0,127,160),(0,_.fill)(v,2,4352,4448),v[9001]=2,v[9002]=2,(0,_.fill)(v,2,11904,42192),v[12351]=1,(0,_.fill)(v,2,44032,55204),(0,_.fill)(v,2,63744,64256),(0,_.fill)(v,2,65040,65050),(0,_.fill)(v,2,65072,65136),(0,_.fill)(v,2,65280,65377),(0,_.fill)(v,2,65504,65511);for(let t=0;t<f.length;++t)(0,_.fill)(v,0,f[t][0],f[t][1]+1)}}wcwidth(t){return t<32?0:t<127?1:t<65536?v[t]:function(t,a){let u,_=0,f=a.length-1;if(t<a[0][0]||t>a[f][1])return!1;for(;f>=_;)if(u=_+f>>1,t>a[u][1])_=u+1;else{if(!(t<a[u][0]))return!0;f=u-1}return!1}(t,p)?0:t>=131072&&t<=196605||t>=196608&&t<=262141?2:1}}},5981:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.WriteBuffer=void 0;const _=u(8460),f="undefined"==typeof queueMicrotask?t=>{Promise.resolve().then(t)}:queueMicrotask;a.WriteBuffer=class{constructor(t){this._action=t,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._onWriteParsed=new _.EventEmitter}get onWriteParsed(){return this._onWriteParsed.event}writeSync(t,a){if(void 0!==a&&this._syncCalls>a)return void(this._syncCalls=0);if(this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let u;for(this._isSyncWriting=!0;u=this._writeBuffer.shift();){this._action(u);const t=this._callbacks.shift();t&&t()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(t,a){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");this._writeBuffer.length||(this._bufferOffset=0,setTimeout((()=>this._innerWrite()))),this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(a)}_innerWrite(t=0,a=!0){const u=t||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const t=this._writeBuffer[this._bufferOffset],_=this._action(t,a);if(_){const t=t=>Date.now()-u>=12?setTimeout((()=>this._innerWrite(0,t))):this._innerWrite(u,t);return void _.catch((t=>(f((()=>{throw t})),Promise.resolve(!1)))).then(t)}const p=this._callbacks[this._bufferOffset];if(p&&p(),this._bufferOffset++,this._pendingData-=t.length,Date.now()-u>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}},5941:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.toRgbString=a.parseColor=void 0;const u=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,_=/^[\da-f]+$/;function f(t,a){const u=t.toString(16),_=u.length<2?"0"+u:u;switch(a){case 4:return u[0];case 8:return _;case 12:return(_+_).slice(0,3);default:return _+_}}a.parseColor=function(t){if(!t)return;let a=t.toLowerCase();if(0===a.indexOf("rgb:")){a=a.slice(4);const t=u.exec(a);if(t){const a=t[1]?15:t[4]?255:t[7]?4095:65535;return[Math.round(parseInt(t[1]||t[4]||t[7]||t[10],16)/a*255),Math.round(parseInt(t[2]||t[5]||t[8]||t[11],16)/a*255),Math.round(parseInt(t[3]||t[6]||t[9]||t[12],16)/a*255)]}}else if(0===a.indexOf("#")&&(a=a.slice(1),_.exec(a)&&[3,6,9,12].includes(a.length))){const t=a.length/3,u=[0,0,0];for(let _=0;_<3;++_){const f=parseInt(a.slice(t*_,t*_+t),16);u[_]=1===t?f<<4:2===t?f:3===t?f>>4:f>>8}return u}},a.toRgbString=function(t,a=16){const[u,_,p]=t;return`rgb:${f(u,a)}/${f(_,a)}/${f(p,a)}`}},5770:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.PAYLOAD_LIMIT=void 0,a.PAYLOAD_LIMIT=1e7},6351:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.DcsHandler=a.DcsParser=void 0;const _=u(482),f=u(8742),p=u(5770),v=[];a.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=v,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=v}registerHandler(t,a){void 0===this._handlers[t]&&(this._handlers[t]=[]);const u=this._handlers[t];return u.push(a),{dispose:()=>{const t=u.indexOf(a);-1!==t&&u.splice(t,1)}}}clearHandler(t){this._handlers[t]&&delete this._handlers[t]}setHandlerFallback(t){this._handlerFb=t}reset(){if(this._active.length)for(let t=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;t>=0;--t)this._active[t].unhook(!1);this._stack.paused=!1,this._active=v,this._ident=0}hook(t,a){if(this.reset(),this._ident=t,this._active=this._handlers[t]||v,this._active.length)for(let t=this._active.length-1;t>=0;t--)this._active[t].hook(a);else this._handlerFb(this._ident,"HOOK",a)}put(t,a,u){if(this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].put(t,a,u);else this._handlerFb(this._ident,"PUT",(0,_.utf32ToString)(t,a,u))}unhook(t,a=!0){if(this._active.length){let u=!1,_=this._active.length-1,f=!1;if(this._stack.paused&&(_=this._stack.loopPosition-1,u=a,f=this._stack.fallThrough,this._stack.paused=!1),!f&&!1===u){for(;_>=0&&(u=this._active[_].unhook(t),!0!==u);_--)if(u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!1,u;_--}for(;_>=0;_--)if(u=this._active[_].unhook(!1),u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!0,u}else this._handlerFb(this._ident,"UNHOOK",t);this._active=v,this._ident=0}};const g=new f.Params;g.addParam(0),a.DcsHandler=class{constructor(t){this._handler=t,this._data="",this._params=g,this._hitLimit=!1}hook(t){this._params=t.length>1||t.params[0]?t.clone():g,this._data="",this._hitLimit=!1}put(t,a,u){this._hitLimit||(this._data+=(0,_.utf32ToString)(t,a,u),this._data.length>p.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(t){let a=!1;if(this._hitLimit)a=!1;else if(t&&(a=this._handler(this._data,this._params),a instanceof Promise))return a.then((t=>(this._params=g,this._data="",this._hitLimit=!1,t)));return this._params=g,this._data="",this._hitLimit=!1,a}}},2015:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.EscapeSequenceParser=a.VT500_TRANSITION_TABLE=a.TransitionTable=void 0;const _=u(844),f=u(8273),p=u(8742),v=u(6242),g=u(6351);class h{constructor(t){this.table=new Uint8Array(t)}setDefault(t,a){(0,f.fill)(this.table,t<<4|a)}add(t,a,u,_){this.table[a<<8|t]=u<<4|_}addMany(t,a,u,_){for(let f=0;f<t.length;f++)this.table[a<<8|t[f]]=u<<4|_}}a.TransitionTable=h;const m=160;a.VT500_TRANSITION_TABLE=function(){const t=new h(4095),a=Array.apply(null,Array(256)).map(((t,a)=>a)),u=(t,u)=>a.slice(t,u),_=u(32,127),f=u(0,24);f.push(25),f.push.apply(f,u(28,32));const p=u(0,14);let v;for(v in t.setDefault(1,0),t.addMany(_,0,2,0),p)t.addMany([24,26,153,154],v,3,0),t.addMany(u(128,144),v,3,0),t.addMany(u(144,152),v,3,0),t.add(156,v,0,0),t.add(27,v,11,1),t.add(157,v,4,8),t.addMany([152,158,159],v,0,7),t.add(155,v,11,3),t.add(144,v,11,9);return t.addMany(f,0,3,0),t.addMany(f,1,3,1),t.add(127,1,0,1),t.addMany(f,8,0,8),t.addMany(f,3,3,3),t.add(127,3,0,3),t.addMany(f,4,3,4),t.add(127,4,0,4),t.addMany(f,6,3,6),t.addMany(f,5,3,5),t.add(127,5,0,5),t.addMany(f,2,3,2),t.add(127,2,0,2),t.add(93,1,4,8),t.addMany(_,8,5,8),t.add(127,8,5,8),t.addMany([156,27,24,26,7],8,6,0),t.addMany(u(28,32),8,0,8),t.addMany([88,94,95],1,0,7),t.addMany(_,7,0,7),t.addMany(f,7,0,7),t.add(156,7,0,0),t.add(127,7,0,7),t.add(91,1,11,3),t.addMany(u(64,127),3,7,0),t.addMany(u(48,60),3,8,4),t.addMany([60,61,62,63],3,9,4),t.addMany(u(48,60),4,8,4),t.addMany(u(64,127),4,7,0),t.addMany([60,61,62,63],4,0,6),t.addMany(u(32,64),6,0,6),t.add(127,6,0,6),t.addMany(u(64,127),6,0,0),t.addMany(u(32,48),3,9,5),t.addMany(u(32,48),5,9,5),t.addMany(u(48,64),5,0,6),t.addMany(u(64,127),5,7,0),t.addMany(u(32,48),4,9,5),t.addMany(u(32,48),1,9,2),t.addMany(u(32,48),2,9,2),t.addMany(u(48,127),2,10,0),t.addMany(u(48,80),1,10,0),t.addMany(u(81,88),1,10,0),t.addMany([89,90,92],1,10,0),t.addMany(u(96,127),1,10,0),t.add(80,1,11,9),t.addMany(f,9,0,9),t.add(127,9,0,9),t.addMany(u(28,32),9,0,9),t.addMany(u(32,48),9,9,12),t.addMany(u(48,60),9,8,10),t.addMany([60,61,62,63],9,9,10),t.addMany(f,11,0,11),t.addMany(u(32,128),11,0,11),t.addMany(u(28,32),11,0,11),t.addMany(f,10,0,10),t.add(127,10,0,10),t.addMany(u(28,32),10,0,10),t.addMany(u(48,60),10,8,10),t.addMany([60,61,62,63],10,0,11),t.addMany(u(32,48),10,9,12),t.addMany(f,12,0,12),t.add(127,12,0,12),t.addMany(u(28,32),12,0,12),t.addMany(u(32,48),12,9,12),t.addMany(u(48,64),12,0,11),t.addMany(u(64,127),12,12,13),t.addMany(u(64,127),10,12,13),t.addMany(u(64,127),9,12,13),t.addMany(f,13,13,13),t.addMany(_,13,13,13),t.add(127,13,0,13),t.addMany([27,156,24,26],13,14,0),t.add(m,0,2,0),t.add(m,8,5,8),t.add(m,6,0,6),t.add(m,11,0,11),t.add(m,13,13,13),t}();class l extends _.Disposable{constructor(t=a.VT500_TRANSITION_TABLE){super(),this._transitions=t,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new p.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(t,a,u)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,a)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._oscParser=new v.OscParser,this._dcsParser=new g.DcsParser,this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(t,a=[64,126]){let u=0;if(t.prefix){if(t.prefix.length>1)throw new Error("only one byte as prefix supported");if(u=t.prefix.charCodeAt(0),u&&60>u||u>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(t.intermediates){if(t.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let a=0;a<t.intermediates.length;++a){const _=t.intermediates.charCodeAt(a);if(32>_||_>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");u<<=8,u|=_}}if(1!==t.final.length)throw new Error("final must be a single byte");const _=t.final.charCodeAt(0);if(a[0]>_||_>a[1])throw new Error(`final must be in range ${a[0]} .. ${a[1]}`);return u<<=8,u|=_,u}identToString(t){const a=[];for(;t;)a.push(String.fromCharCode(255&t)),t>>=8;return a.reverse().join("")}dispose(){this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null),this._oscParser.dispose(),this._dcsParser.dispose()}setPrintHandler(t){this._printHandler=t}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(t,a){const u=this._identifier(t,[48,126]);void 0===this._escHandlers[u]&&(this._escHandlers[u]=[]);const _=this._escHandlers[u];return _.push(a),{dispose:()=>{const t=_.indexOf(a);-1!==t&&_.splice(t,1)}}}clearEscHandler(t){this._escHandlers[this._identifier(t,[48,126])]&&delete this._escHandlers[this._identifier(t,[48,126])]}setEscHandlerFallback(t){this._escHandlerFb=t}setExecuteHandler(t,a){this._executeHandlers[t.charCodeAt(0)]=a}clearExecuteHandler(t){this._executeHandlers[t.charCodeAt(0)]&&delete this._executeHandlers[t.charCodeAt(0)]}setExecuteHandlerFallback(t){this._executeHandlerFb=t}registerCsiHandler(t,a){const u=this._identifier(t);void 0===this._csiHandlers[u]&&(this._csiHandlers[u]=[]);const _=this._csiHandlers[u];return _.push(a),{dispose:()=>{const t=_.indexOf(a);-1!==t&&_.splice(t,1)}}}clearCsiHandler(t){this._csiHandlers[this._identifier(t)]&&delete this._csiHandlers[this._identifier(t)]}setCsiHandlerFallback(t){this._csiHandlerFb=t}registerDcsHandler(t,a){return this._dcsParser.registerHandler(this._identifier(t),a)}clearDcsHandler(t){this._dcsParser.clearHandler(this._identifier(t))}setDcsHandlerFallback(t){this._dcsParser.setHandlerFallback(t)}registerOscHandler(t,a){return this._oscParser.registerHandler(t,a)}clearOscHandler(t){this._oscParser.clearHandler(t)}setOscHandlerFallback(t){this._oscParser.setHandlerFallback(t)}setErrorHandler(t){this._errorHandler=t}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(t,a,u,_,f){this._parseStack.state=t,this._parseStack.handlers=a,this._parseStack.handlerPos=u,this._parseStack.transition=_,this._parseStack.chunkPos=f}parse(t,a,u){let _,f=0,p=0,v=0;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,v=this._parseStack.chunkPos+1;else{if(void 0===u||1===this._parseStack.state)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const a=this._parseStack.handlers;let p=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===u&&p>-1)for(;p>=0&&(_=a[p](this._params),!0!==_);p--)if(_ instanceof Promise)return this._parseStack.handlerPos=p,_;this._parseStack.handlers=[];break;case 4:if(!1===u&&p>-1)for(;p>=0&&(_=a[p](),!0!==_);p--)if(_ instanceof Promise)return this._parseStack.handlerPos=p,_;this._parseStack.handlers=[];break;case 6:if(f=t[this._parseStack.chunkPos],_=this._dcsParser.unhook(24!==f&&26!==f,u),_)return _;27===f&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(f=t[this._parseStack.chunkPos],_=this._oscParser.end(24!==f&&26!==f,u),_)return _;27===f&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,v=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let u=v;u<a;++u){switch(f=t[u],p=this._transitions.table[this.currentState<<8|(f<160?f:m)],p>>4){case 2:for(let _=u+1;;++_){if(_>=a||(f=t[_])<32||f>126&&f<m){this._printHandler(t,u,_),u=_-1;break}if(++_>=a||(f=t[_])<32||f>126&&f<m){this._printHandler(t,u,_),u=_-1;break}if(++_>=a||(f=t[_])<32||f>126&&f<m){this._printHandler(t,u,_),u=_-1;break}if(++_>=a||(f=t[_])<32||f>126&&f<m){this._printHandler(t,u,_),u=_-1;break}}break;case 3:this._executeHandlers[f]?this._executeHandlers[f]():this._executeHandlerFb(f),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:u,code:f,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const v=this._csiHandlers[this._collect<<8|f];let g=v?v.length-1:-1;for(;g>=0&&(_=v[g](this._params),!0!==_);g--)if(_ instanceof Promise)return this._preserveStack(3,v,g,p,u),_;g<0&&this._csiHandlerFb(this._collect<<8|f,this._params),this.precedingCodepoint=0;break;case 8:do{switch(f){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(f-48)}}while(++u<a&&(f=t[u])>47&&f<60);u--;break;case 9:this._collect<<=8,this._collect|=f;break;case 10:const S=this._escHandlers[this._collect<<8|f];let y=S?S.length-1:-1;for(;y>=0&&(_=S[y](),!0!==_);y--)if(_ instanceof Promise)return this._preserveStack(4,S,y,p,u),_;y<0&&this._escHandlerFb(this._collect<<8|f),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|f,this._params);break;case 13:for(let _=u+1;;++_)if(_>=a||24===(f=t[_])||26===f||27===f||f>127&&f<m){this._dcsParser.put(t,u,_),u=_-1;break}break;case 14:if(_=this._dcsParser.unhook(24!==f&&26!==f),_)return this._preserveStack(6,[],0,p,u),_;27===f&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let _=u+1;;_++)if(_>=a||(f=t[_])<32||f>127&&f<m){this._oscParser.put(t,u,_),u=_-1;break}break;case 6:if(_=this._oscParser.end(24!==f&&26!==f),_)return this._preserveStack(5,[],0,p,u),_;27===f&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&p}}}a.EscapeSequenceParser=l},6242:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.OscHandler=a.OscParser=void 0;const _=u(5770),f=u(482),p=[];a.OscParser=class{constructor(){this._state=0,this._active=p,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(t,a){void 0===this._handlers[t]&&(this._handlers[t]=[]);const u=this._handlers[t];return u.push(a),{dispose:()=>{const t=u.indexOf(a);-1!==t&&u.splice(t,1)}}}clearHandler(t){this._handlers[t]&&delete this._handlers[t]}setHandlerFallback(t){this._handlerFb=t}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=p}reset(){if(2===this._state)for(let t=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;t>=0;--t)this._active[t].end(!1);this._stack.paused=!1,this._active=p,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||p,this._active.length)for(let t=this._active.length-1;t>=0;t--)this._active[t].start();else this._handlerFb(this._id,"START")}_put(t,a,u){if(this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].put(t,a,u);else this._handlerFb(this._id,"PUT",(0,f.utf32ToString)(t,a,u))}start(){this.reset(),this._state=1}put(t,a,u){if(3!==this._state){if(1===this._state)for(;a<u;){const u=t[a++];if(59===u){this._state=2,this._start();break}if(u<48||57<u)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+u-48}2===this._state&&u-a>0&&this._put(t,a,u)}}end(t,a=!0){if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){let u=!1,_=this._active.length-1,f=!1;if(this._stack.paused&&(_=this._stack.loopPosition-1,u=a,f=this._stack.fallThrough,this._stack.paused=!1),!f&&!1===u){for(;_>=0&&(u=this._active[_].end(t),!0!==u);_--)if(u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!1,u;_--}for(;_>=0;_--)if(u=this._active[_].end(!1),u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!0,u}else this._handlerFb(this._id,"END",t);this._active=p,this._id=-1,this._state=0}}},a.OscHandler=class{constructor(t){this._handler=t,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(t,a,u){this._hitLimit||(this._data+=(0,f.utf32ToString)(t,a,u),this._data.length>_.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(t){let a=!1;if(this._hitLimit)a=!1;else if(t&&(a=this._handler(this._data),a instanceof Promise))return a.then((t=>(this._data="",this._hitLimit=!1,t)));return this._data="",this._hitLimit=!1,a}}},8742:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Params=void 0;const u=2147483647;class s{constructor(t=32,a=32){if(this.maxLength=t,this.maxSubParamsLength=a,a>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(t),this.length=0,this._subParams=new Int32Array(a),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(t),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(t){const a=new s;if(!t.length)return a;for(let u=Array.isArray(t[0])?1:0;u<t.length;++u){const _=t[u];if(Array.isArray(_))for(let t=0;t<_.length;++t)a.addSubParam(_[t]);else a.addParam(_)}return a}clone(){const t=new s(this.maxLength,this.maxSubParamsLength);return t.params.set(this.params),t.length=this.length,t._subParams.set(this._subParams),t._subParamsLength=this._subParamsLength,t._subParamsIdx.set(this._subParamsIdx),t._rejectDigits=this._rejectDigits,t._rejectSubDigits=this._rejectSubDigits,t._digitIsSub=this._digitIsSub,t}toArray(){const t=[];for(let a=0;a<this.length;++a){t.push(this.params[a]);const u=this._subParamsIdx[a]>>8,_=255&this._subParamsIdx[a];_-u>0&&t.push(Array.prototype.slice.call(this._subParams,u,_))}return t}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(t){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=t>u?u:t}}addSubParam(t){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=t>u?u:t,this._subParamsIdx[this.length-1]++}}hasSubParams(t){return(255&this._subParamsIdx[t])-(this._subParamsIdx[t]>>8)>0}getSubParams(t){const a=this._subParamsIdx[t]>>8,u=255&this._subParamsIdx[t];return u-a>0?this._subParams.subarray(a,u):null}getSubParamsAll(){const t={};for(let a=0;a<this.length;++a){const u=this._subParamsIdx[a]>>8,_=255&this._subParamsIdx[a];_-u>0&&(t[a]=this._subParams.slice(u,_))}return t}addDigit(t){let a;if(this._rejectDigits||!(a=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const _=this._digitIsSub?this._subParams:this.params,f=_[a-1];_[a-1]=~f?Math.min(10*f+t,u):t}}a.Params=s},5741:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.AddonManager=void 0,a.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let t=this._addons.length-1;t>=0;t--)this._addons[t].instance.dispose()}loadAddon(t,a){const u={instance:a,dispose:a.dispose,isDisposed:!1};this._addons.push(u),a.dispose=()=>this._wrappedAddonDispose(u),a.activate(t)}_wrappedAddonDispose(t){if(t.isDisposed)return;let a=-1;for(let u=0;u<this._addons.length;u++)if(this._addons[u]===t){a=u;break}if(-1===a)throw new Error("Could not dispose an addon that has not been loaded");t.isDisposed=!0,t.dispose.apply(t.instance),this._addons.splice(a,1)}}},8771:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.BufferApiView=void 0;const _=u(3785),f=u(511);a.BufferApiView=class{constructor(t,a){this._buffer=t,this.type=a}init(t){return this._buffer=t,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(t){const a=this._buffer.lines.get(t);if(a)return new _.BufferLineApiView(a)}getNullCell(){return new f.CellData}}},3785:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.BufferLineApiView=void 0;const _=u(511);a.BufferLineApiView=class{constructor(t){this._line=t}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(t,a){if(!(t<0||t>=this._line.length))return a?(this._line.loadCell(t,a),a):this._line.loadCell(t,new _.CellData)}translateToString(t,a,u){return this._line.translateToString(t,a,u)}}},8285:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.BufferNamespaceApi=void 0;const _=u(8771),f=u(8460);a.BufferNamespaceApi=class{constructor(t){this._core=t,this._onBufferChange=new f.EventEmitter,this._normal=new _.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new _.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get onBufferChange(){return this._onBufferChange.event}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}},7975:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ParserApi=void 0,a.ParserApi=class{constructor(t){this._core=t}registerCsiHandler(t,a){return this._core.registerCsiHandler(t,(t=>a(t.toArray())))}addCsiHandler(t,a){return this.registerCsiHandler(t,a)}registerDcsHandler(t,a){return this._core.registerDcsHandler(t,((t,u)=>a(t,u.toArray())))}addDcsHandler(t,a){return this.registerDcsHandler(t,a)}registerEscHandler(t,a){return this._core.registerEscHandler(t,a)}addEscHandler(t,a){return this.registerEscHandler(t,a)}registerOscHandler(t,a){return this._core.registerOscHandler(t,a)}addOscHandler(t,a){return this.registerOscHandler(t,a)}}},7090:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.UnicodeApi=void 0,a.UnicodeApi=class{constructor(t){this._core=t}register(t){this._core.unicodeService.register(t)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(t){this._core.unicodeService.activeVersion=t}}},744:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.BufferService=a.MINIMUM_ROWS=a.MINIMUM_COLS=void 0;const p=u(2585),v=u(5295),g=u(8460),m=u(844);a.MINIMUM_COLS=2,a.MINIMUM_ROWS=1;let S=class extends m.Disposable{constructor(t){super(),this.isUserScrolling=!1,this._onResize=new g.EventEmitter,this._onScroll=new g.EventEmitter,this.cols=Math.max(t.rawOptions.cols||0,a.MINIMUM_COLS),this.rows=Math.max(t.rawOptions.rows||0,a.MINIMUM_ROWS),this.buffers=new v.BufferSet(t,this)}get onResize(){return this._onResize.event}get onScroll(){return this._onScroll.event}get buffer(){return this.buffers.active}dispose(){super.dispose(),this.buffers.dispose()}resize(t,a){this.cols=t,this.rows=a,this.buffers.resize(t,a),this.buffers.setupTabStops(this.cols),this._onResize.fire({cols:t,rows:a})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(t,a=!1){const u=this.buffer;let _;_=this._cachedBlankLine,_&&_.length===this.cols&&_.getFg(0)===t.fg&&_.getBg(0)===t.bg||(_=u.getBlankLine(t,a),this._cachedBlankLine=_),_.isWrapped=a;const f=u.ybase+u.scrollTop,p=u.ybase+u.scrollBottom;if(0===u.scrollTop){const t=u.lines.isFull;p===u.lines.length-1?t?u.lines.recycle().copyFrom(_):u.lines.push(_.clone()):u.lines.splice(p+1,0,_.clone()),t?this.isUserScrolling&&(u.ydisp=Math.max(u.ydisp-1,0)):(u.ybase++,this.isUserScrolling||u.ydisp++)}else{const t=p-f+1;u.lines.shiftElements(f+1,t-1,-1),u.lines.set(p,_.clone())}this.isUserScrolling||(u.ydisp=u.ybase),this._onScroll.fire(u.ydisp)}scrollLines(t,a,u){const _=this.buffer;if(t<0){if(0===_.ydisp)return;this.isUserScrolling=!0}else t+_.ydisp>=_.ybase&&(this.isUserScrolling=!1);const f=_.ydisp;_.ydisp=Math.max(Math.min(_.ydisp+t,_.ybase),0),f!==_.ydisp&&(a||this._onScroll.fire(_.ydisp))}scrollPages(t){this.scrollLines(t*(this.rows-1))}scrollToTop(){this.scrollLines(-this.buffer.ydisp)}scrollToBottom(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)}scrollToLine(t){const a=t-this.buffer.ydisp;0!==a&&this.scrollLines(a)}};S=_([f(0,p.IOptionsService)],S),a.BufferService=S},7994:(t,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CharsetService=void 0,a.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(t){this.glevel=t,this.charset=this._charsets[t]}setgCharset(t,a){this._charsets[t]=a,this.glevel===t&&(this.charset=a)}}},1753:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.CoreMouseService=void 0;const p=u(2585),v=u(8460),g={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:t=>4!==t.button&&1===t.action&&(t.ctrl=!1,t.alt=!1,t.shift=!1,!0)},VT200:{events:19,restrict:t=>32!==t.action},DRAG:{events:23,restrict:t=>32!==t.action||3!==t.button},ANY:{events:31,restrict:t=>!0}};function m(t,a){let u=(t.ctrl?16:0)|(t.shift?4:0)|(t.alt?8:0);return 4===t.button?(u|=64,u|=t.action):(u|=3&t.button,4&t.button&&(u|=64),8&t.button&&(u|=128),32===t.action?u|=32:0!==t.action||a||(u|=3)),u}const S=String.fromCharCode,y={DEFAULT:t=>{const a=[m(t,!1)+32,t.col+32,t.row+32];return a[0]>255||a[1]>255||a[2]>255?"":`[M${S(a[0])}${S(a[1])}${S(a[2])}`},SGR:t=>{const a=0===t.action&&4!==t.button?"m":"M";return`[<${m(t,!0)};${t.col};${t.row}${a}`},SGR_PIXELS:t=>{const a=0===t.action&&4!==t.button?"m":"M";return`[<${m(t,!0)};${t.x};${t.y}${a}`}};let w=class{constructor(t,a){this._bufferService=t,this._coreService=a,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._onProtocolChange=new v.EventEmitter,this._lastEvent=null;for(const t of Object.keys(g))this.addProtocol(t,g[t]);for(const t of Object.keys(y))this.addEncoding(t,y[t]);this.reset()}addProtocol(t,a){this._protocols[t]=a}addEncoding(t,a){this._encodings[t]=a}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(t){if(!this._protocols[t])throw new Error(`unknown protocol "${t}"`);this._activeProtocol=t,this._onProtocolChange.fire(this._protocols[t].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(t){if(!this._encodings[t])throw new Error(`unknown encoding "${t}"`);this._activeEncoding=t}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}get onProtocolChange(){return this._onProtocolChange.event}triggerMouseEvent(t){if(t.col<0||t.col>=this._bufferService.cols||t.row<0||t.row>=this._bufferService.rows)return!1;if(4===t.button&&32===t.action)return!1;if(3===t.button&&32!==t.action)return!1;if(4!==t.button&&(2===t.action||3===t.action))return!1;if(t.col++,t.row++,32===t.action&&this._lastEvent&&this._equalEvents(this._lastEvent,t,"SGR_PIXELS"===this._activeEncoding))return!1;if(!this._protocols[this._activeProtocol].restrict(t))return!1;const a=this._encodings[this._activeEncoding](t);return a&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(a):this._coreService.triggerDataEvent(a,!0)),this._lastEvent=t,!0}explainEvents(t){return{down:!!(1&t),up:!!(2&t),drag:!!(4&t),move:!!(8&t),wheel:!!(16&t)}}_equalEvents(t,a,u){if(u){if(t.x!==a.x)return!1;if(t.y!==a.y)return!1}else{if(t.col!==a.col)return!1;if(t.row!==a.row)return!1}return t.button===a.button&&t.action===a.action&&t.ctrl===a.ctrl&&t.alt===a.alt&&t.shift===a.shift}};w=_([f(0,p.IBufferService),f(1,p.ICoreService)],w),a.CoreMouseService=w},6975:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.CoreService=void 0;const p=u(2585),v=u(8460),g=u(1439),m=u(844),S=Object.freeze({insertMode:!1}),y=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let w=class extends m.Disposable{constructor(t,a,u,_){super(),this._bufferService=a,this._logService=u,this._optionsService=_,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new v.EventEmitter),this._onUserInput=this.register(new v.EventEmitter),this._onBinary=this.register(new v.EventEmitter),this._scrollToBottom=t,this.register({dispose:()=>this._scrollToBottom=void 0}),this.modes=(0,g.clone)(S),this.decPrivateModes=(0,g.clone)(y)}get onData(){return this._onData.event}get onUserInput(){return this._onUserInput.event}get onBinary(){return this._onBinary.event}reset(){this.modes=(0,g.clone)(S),this.decPrivateModes=(0,g.clone)(y)}triggerDataEvent(t,a=!1){if(this._optionsService.rawOptions.disableStdin)return;const u=this._bufferService.buffer;u.ybase!==u.ydisp&&this._scrollToBottom(),a&&this._onUserInput.fire(),this._logService.debug(`sending data "${t}"`,(()=>t.split("").map((t=>t.charCodeAt(0))))),this._onData.fire(t)}triggerBinaryEvent(t){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${t}"`,(()=>t.split("").map((t=>t.charCodeAt(0))))),this._onBinary.fire(t))}};w=_([f(1,p.IBufferService),f(2,p.ILogService),f(3,p.IOptionsService)],w),a.CoreService=w},9074:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.DecorationService=void 0;const _=u(8055),f=u(8460),p=u(844),v=u(6106),g={xmin:0,xmax:0};class h extends p.Disposable{constructor(){super(...arguments),this._decorations=new v.SortedList((t=>null==t?void 0:t.marker.line)),this._onDecorationRegistered=this.register(new f.EventEmitter),this._onDecorationRemoved=this.register(new f.EventEmitter)}get onDecorationRegistered(){return this._onDecorationRegistered.event}get onDecorationRemoved(){return this._onDecorationRemoved.event}get decorations(){return this._decorations.values()}registerDecoration(t){if(t.marker.isDisposed)return;const a=new c(t);if(a){const t=a.marker.onDispose((()=>a.dispose()));a.onDispose((()=>{a&&(this._decorations.delete(a)&&this._onDecorationRemoved.fire(a),t.dispose())})),this._decorations.insert(a),this._onDecorationRegistered.fire(a)}return a}reset(){for(const t of this._decorations.values())t.dispose();this._decorations.clear()}*getDecorationsAtCell(t,a,u){var _,f,p;let v=0,g=0;for(const m of this._decorations.getKeyIterator(a))v=null!==(_=m.options.x)&&void 0!==_?_:0,g=v+(null!==(f=m.options.width)&&void 0!==f?f:1),t>=v&&t<g&&(!u||(null!==(p=m.options.layer)&&void 0!==p?p:"bottom")===u)&&(yield m)}forEachDecorationAtCell(t,a,u,_){this._decorations.forEachByKey(a,(a=>{var f,p,v;g.xmin=null!==(f=a.options.x)&&void 0!==f?f:0,g.xmax=g.xmin+(null!==(p=a.options.width)&&void 0!==p?p:1),t>=g.xmin&&t<g.xmax&&(!u||(null!==(v=a.options.layer)&&void 0!==v?v:"bottom")===u)&&_(a)}))}dispose(){for(const t of this._decorations.values())this._onDecorationRemoved.fire(t);this.reset()}}a.DecorationService=h;class c extends p.Disposable{constructor(t){super(),this.options=t,this.isDisposed=!1,this.onRenderEmitter=this.register(new f.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new f.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=t.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=_.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=_.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._isDisposed||(this._isDisposed=!0,this._onDispose.fire(),super.dispose())}}},3730:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.DirtyRowService=void 0;const p=u(2585);let v=class{constructor(t){this._bufferService=t,this.clearRange()}get start(){return this._start}get end(){return this._end}clearRange(){this._start=this._bufferService.buffer.y,this._end=this._bufferService.buffer.y}markDirty(t){t<this._start?this._start=t:t>this._end&&(this._end=t)}markRangeDirty(t,a){if(t>a){const u=t;t=a,a=u}t<this._start&&(this._start=t),a>this._end&&(this._end=a)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};v=_([f(0,p.IBufferService)],v),a.DirtyRowService=v},4348:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.InstantiationService=a.ServiceCollection=void 0;const _=u(2585),f=u(8343);class n{constructor(...t){this._entries=new Map;for(const[a,u]of t)this.set(a,u)}set(t,a){const u=this._entries.get(t);return this._entries.set(t,a),u}forEach(t){this._entries.forEach(((a,u)=>t(u,a)))}has(t){return this._entries.has(t)}get(t){return this._entries.get(t)}}a.ServiceCollection=n,a.InstantiationService=class{constructor(){this._services=new n,this._services.set(_.IInstantiationService,this)}setService(t,a){this._services.set(t,a)}getService(t){return this._services.get(t)}createInstance(t,...a){const u=(0,f.getServiceDependencies)(t).sort(((t,a)=>t.index-a.index)),_=[];for(const a of u){const u=this._services.get(a.id);if(!u)throw new Error(`[createInstance] ${t.name} depends on UNKNOWN service ${a.id}.`);_.push(u)}const p=u.length>0?u[0].index:a.length;if(a.length!==p)throw new Error(`[createInstance] First service dependency of ${t.name} at position ${p+1} conflicts with ${a.length} static arguments`);return new t(...[...a,..._])}}},7866:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.LogService=void 0;const p=u(2585),v={debug:p.LogLevelEnum.DEBUG,info:p.LogLevelEnum.INFO,warn:p.LogLevelEnum.WARN,error:p.LogLevelEnum.ERROR,off:p.LogLevelEnum.OFF};let g=class{constructor(t){this._optionsService=t,this.logLevel=p.LogLevelEnum.OFF,this._updateLogLevel(),this._optionsService.onOptionChange((t=>{"logLevel"===t&&this._updateLogLevel()}))}_updateLogLevel(){this.logLevel=v[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(t){for(let a=0;a<t.length;a++)"function"==typeof t[a]&&(t[a]=t[a]())}_log(t,a,u){this._evalLazyOptionalParams(u),t.call(console,"xterm.js: "+a,...u)}debug(t,...a){this.logLevel<=p.LogLevelEnum.DEBUG&&this._log(console.log,t,a)}info(t,...a){this.logLevel<=p.LogLevelEnum.INFO&&this._log(console.info,t,a)}warn(t,...a){this.logLevel<=p.LogLevelEnum.WARN&&this._log(console.warn,t,a)}error(t,...a){this.logLevel<=p.LogLevelEnum.ERROR&&this._log(console.error,t,a)}};g=_([f(0,p.IOptionsService)],g),a.LogService=g},7302:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.OptionsService=a.DEFAULT_OPTIONS=void 0;const _=u(8460),f=u(6114);a.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",scrollback:1e3,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:f.isMac,windowOptions:{},windowsMode:!1,wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const p=["normal","bold","100","200","300","400","500","600","700","800","900"];a.OptionsService=class{constructor(t){this._onOptionChange=new _.EventEmitter;const u=Object.assign({},a.DEFAULT_OPTIONS);for(const a in t)if(a in u)try{const _=t[a];u[a]=this._sanitizeAndValidateOption(a,_)}catch(t){console.error(t)}this.rawOptions=u,this.options=Object.assign({},u),this._setupOptions()}get onOptionChange(){return this._onOptionChange.event}_setupOptions(){const t=t=>{if(!(t in a.DEFAULT_OPTIONS))throw new Error(`No option with key "${t}"`);return this.rawOptions[t]},u=(t,u)=>{if(!(t in a.DEFAULT_OPTIONS))throw new Error(`No option with key "${t}"`);u=this._sanitizeAndValidateOption(t,u),this.rawOptions[t]!==u&&(this.rawOptions[t]=u,this._onOptionChange.fire(t))};for(const a in this.rawOptions){const _={get:t.bind(this,a),set:u.bind(this,a)};Object.defineProperty(this.options,a,_)}}_sanitizeAndValidateOption(t,u){switch(t){case"cursorStyle":if(u||(u=a.DEFAULT_OPTIONS[t]),!function(t){return"block"===t||"underline"===t||"bar"===t}(u))throw new Error(`"${u}" is not a valid value for ${t}`);break;case"wordSeparator":u||(u=a.DEFAULT_OPTIONS[t]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof u&&1<=u&&u<=1e3)break;u=p.includes(u)?u:a.DEFAULT_OPTIONS[t];break;case"cursorWidth":u=Math.floor(u);case"lineHeight":case"tabStopWidth":if(u<1)throw new Error(`${t} cannot be less than 1, value: ${u}`);break;case"minimumContrastRatio":u=Math.max(1,Math.min(21,Math.round(10*u)/10));break;case"scrollback":if((u=Math.min(u,4294967295))<0)throw new Error(`${t} cannot be less than 0, value: ${u}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(u<=0)throw new Error(`${t} cannot be less than or equal to 0, value: ${u}`);case"rows":case"cols":if(!u&&0!==u)throw new Error(`${t} must be numeric, value: ${u}`)}return u}}},2660:function(t,a,u){var _=this&&this.__decorate||function(t,a,u,_){var f,p=arguments.length,v=p<3?a:null===_?_=Object.getOwnPropertyDescriptor(a,u):_;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(t,a,u,_);else for(var g=t.length-1;g>=0;g--)(f=t[g])&&(v=(p<3?f(v):p>3?f(a,u,v):f(a,u))||v);return p>3&&v&&Object.defineProperty(a,u,v),v},f=this&&this.__param||function(t,a){return function(u,_){a(u,_,t)}};Object.defineProperty(a,"__esModule",{value:!0}),a.OscLinkService=void 0;const p=u(2585);let v=class{constructor(t){this._bufferService=t,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(t){const a=this._bufferService.buffer;if(void 0===t.id){const u=a.addMarker(a.ybase+a.y),_={data:t,id:this._nextId++,lines:[u]};return u.onDispose((()=>this._removeMarkerFromLink(_,u))),this._dataByLinkId.set(_.id,_),_.id}const u=t,_=this._getEntryIdKey(u),f=this._entriesWithId.get(_);if(f)return this.addLineToLink(f.id,a.ybase+a.y),f.id;const p=a.addMarker(a.ybase+a.y),v={id:this._nextId++,key:this._getEntryIdKey(u),data:u,lines:[p]};return p.onDispose((()=>this._removeMarkerFromLink(v,p))),this._entriesWithId.set(v.key,v),this._dataByLinkId.set(v.id,v),v.id}addLineToLink(t,a){const u=this._dataByLinkId.get(t);if(u&&u.lines.every((t=>t.line!==a))){const t=this._bufferService.buffer.addMarker(a);u.lines.push(t),t.onDispose((()=>this._removeMarkerFromLink(u,t)))}}getLinkData(t){var a;return null===(a=this._dataByLinkId.get(t))||void 0===a?void 0:a.data}_getEntryIdKey(t){return`${t.id};;${t.uri}`}_removeMarkerFromLink(t,a){const u=t.lines.indexOf(a);-1!==u&&(t.lines.splice(u,1),0===t.lines.length&&(void 0!==t.data.id&&this._entriesWithId.delete(t.key),this._dataByLinkId.delete(t.id)))}};v=_([f(0,p.IBufferService)],v),a.OscLinkService=v},8343:(t,a)=>{function u(t,a,u){a.di$target===a?a.di$dependencies.push({id:t,index:u}):(a.di$dependencies=[{id:t,index:u}],a.di$target=a)}Object.defineProperty(a,"__esModule",{value:!0}),a.createDecorator=a.getServiceDependencies=a.serviceRegistry=void 0,a.serviceRegistry=new Map,a.getServiceDependencies=function(t){return t.di$dependencies||[]},a.createDecorator=function(t){if(a.serviceRegistry.has(t))return a.serviceRegistry.get(t);const _=function(t,a,f){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");u(_,t,f)};return _.toString=()=>t,a.serviceRegistry.set(t,_),_}},2585:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.IDecorationService=a.IUnicodeService=a.IOscLinkService=a.IOptionsService=a.ILogService=a.LogLevelEnum=a.IInstantiationService=a.IDirtyRowService=a.ICharsetService=a.ICoreService=a.ICoreMouseService=a.IBufferService=void 0;const _=u(8343);var f;a.IBufferService=(0,_.createDecorator)("BufferService"),a.ICoreMouseService=(0,_.createDecorator)("CoreMouseService"),a.ICoreService=(0,_.createDecorator)("CoreService"),a.ICharsetService=(0,_.createDecorator)("CharsetService"),a.IDirtyRowService=(0,_.createDecorator)("DirtyRowService"),a.IInstantiationService=(0,_.createDecorator)("InstantiationService"),(f=a.LogLevelEnum||(a.LogLevelEnum={}))[f.DEBUG=0]="DEBUG",f[f.INFO=1]="INFO",f[f.WARN=2]="WARN",f[f.ERROR=3]="ERROR",f[f.OFF=4]="OFF",a.ILogService=(0,_.createDecorator)("LogService"),a.IOptionsService=(0,_.createDecorator)("OptionsService"),a.IOscLinkService=(0,_.createDecorator)("OscLinkService"),a.IUnicodeService=(0,_.createDecorator)("UnicodeService"),a.IDecorationService=(0,_.createDecorator)("DecorationService")},1480:(t,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.UnicodeService=void 0;const _=u(8460),f=u(225);a.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new _.EventEmitter;const t=new f.UnicodeV6;this.register(t),this._active=t.version,this._activeProvider=t}get onChange(){return this._onChange.event}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let a=0;const u=t.length;for(let _=0;_<u;++_){let f=t.charCodeAt(_);if(55296<=f&&f<=56319){if(++_>=u)return a+this.wcwidth(f);const p=t.charCodeAt(_);56320<=p&&p<=57343?f=1024*(f-55296)+p-56320+65536:a+=this.wcwidth(p)}a+=this.wcwidth(f)}return a}}}},a={};function u(_){var f=a[_];if(void 0!==f)return f.exports;var p=a[_]={exports:{}};return t[_].call(p.exports,p,p.exports,u),p.exports}var _={};return(()=>{var t=_;Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const a=u(3236),f=u(9042),p=u(7975),v=u(7090),g=u(5741),m=u(8285),S=["cols","rows"];t.Terminal=class{constructor(t){this._core=new a.Terminal(t),this._addonManager=new g.AddonManager,this._publicOptions=Object.assign({},this._core.options);const u=t=>this._core.options[t],_=(t,a)=>{this._checkReadonlyOptions(t),this._core.options[t]=a};for(const t in this._core.options){const a={get:u.bind(this,t),set:_.bind(this,t)};Object.defineProperty(this._publicOptions,t,a)}}_checkReadonlyOptions(t){if(S.includes(t))throw new Error(`Option "${t}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._checkProposedApi(),this._parser||(this._parser=new p.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new v.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._checkProposedApi(),this._buffer||(this._buffer=new m.BufferNamespaceApi(this._core)),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const t=this._core.coreService.decPrivateModes;let a="none";switch(this._core.coreMouseService.activeProtocol){case"X10":a="x10";break;case"VT200":a="vt200";break;case"DRAG":a="drag";break;case"ANY":a="any"}return{applicationCursorKeysMode:t.applicationCursorKeys,applicationKeypadMode:t.applicationKeypad,bracketedPasteMode:t.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:a,originMode:t.origin,reverseWraparoundMode:t.reverseWraparound,sendFocusMode:t.sendFocus,wraparoundMode:t.wraparound}}get options(){return this._publicOptions}set options(t){for(const a in t)this._publicOptions[a]=t[a]}blur(){this._core.blur()}focus(){this._core.focus()}resize(t,a){this._verifyIntegers(t,a),this._core.resize(t,a)}open(t){this._core.open(t)}attachCustomKeyEventHandler(t){this._core.attachCustomKeyEventHandler(t)}registerLinkProvider(t){return this._checkProposedApi(),this._core.registerLinkProvider(t)}registerCharacterJoiner(t){return this._checkProposedApi(),this._core.registerCharacterJoiner(t)}deregisterCharacterJoiner(t){this._checkProposedApi(),this._core.deregisterCharacterJoiner(t)}registerMarker(t=0){return this._verifyIntegers(t),this._core.addMarker(t)}registerDecoration(t){var a,u,_;return this._checkProposedApi(),this._verifyPositiveIntegers(null!==(a=t.x)&&void 0!==a?a:0,null!==(u=t.width)&&void 0!==u?u:0,null!==(_=t.height)&&void 0!==_?_:0),this._core.registerDecoration(t)}hasSelection(){return this._core.hasSelection()}select(t,a,u){this._verifyIntegers(t,a,u),this._core.select(t,a,u)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(t,a){this._verifyIntegers(t,a),this._core.selectLines(t,a)}dispose(){this._addonManager.dispose(),this._core.dispose()}scrollLines(t){this._verifyIntegers(t),this._core.scrollLines(t)}scrollPages(t){this._verifyIntegers(t),this._core.scrollPages(t)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(t){this._verifyIntegers(t),this._core.scrollToLine(t)}clear(){this._core.clear()}write(t,a){this._core.write(t,a)}writeln(t,a){this._core.write(t),this._core.write("\r\n",a)}paste(t){this._core.paste(t)}refresh(t,a){this._verifyIntegers(t,a),this._core.refresh(t,a)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(t){return this._addonManager.loadAddon(this,t)}static get strings(){return f}_verifyIntegers(...t){for(const a of t)if(a===1/0||isNaN(a)||a%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...t){for(const a of t)if(a&&(a===1/0||isNaN(a)||a%1!=0||a<0))throw new Error("This API only accepts positive integers")}}})(),_})()},function(t,a,u){var _=u(29),f=u(30);"string"==typeof(f=f.__esModule?f.default:f)&&(f=[[t.i,f,""]]);_(f,{insert:"head",singleton:!1}),t.exports=f.locals||{}},function(t,a,u){"use strict";var _,f=function(){var t={};return function(a){if(void 0===t[a]){var u=document.querySelector(a);if(window.HTMLIFrameElement&&u instanceof window.HTMLIFrameElement)try{u=u.contentDocument.head}catch(t){u=null}t[a]=u}return t[a]}}(),p=[];function v(t){for(var a=-1,u=0;u<p.length;u++)if(p[u].identifier===t){a=u;break}return a}function g(t,a){for(var u={},_=[],f=0;f<t.length;f++){var g=t[f],m=a.base?g[0]+a.base:g[0],S=u[m]||0,y="".concat(m," ").concat(S);u[m]=S+1;var w=v(y),x={css:g[1],media:g[2],sourceMap:g[3]};-1!==w?(p[w].references++,p[w].updater(x)):p.push({identifier:y,updater:k(x,a),references:1}),_.push(y)}return _}function m(t){var a=document.createElement("style"),_=t.attributes||{};if(void 0===_.nonce){var p=u.nc;p&&(_.nonce=p)}if(Object.keys(_).forEach((function(t){a.setAttribute(t,_[t])})),"function"==typeof t.insert)t.insert(a);else{var v=f(t.insert||"head");if(!v)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");v.appendChild(a)}return a}var S,y=(S=[],function(t,a){return S[t]=a,S.filter(Boolean).join("\n")});function w(t,a,u,_){var f=u?"":_.media?"@media ".concat(_.media," {").concat(_.css,"}"):_.css;if(t.styleSheet)t.styleSheet.cssText=y(a,f);else{var p=document.createTextNode(f),v=t.childNodes;v[a]&&t.removeChild(v[a]),v.length?t.insertBefore(p,v[a]):t.appendChild(p)}}function x(t,a,u){var _=u.css,f=u.media,p=u.sourceMap;if(f?t.setAttribute("media",f):t.removeAttribute("media"),p&&"undefined"!=typeof btoa&&(_+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(p))))," */")),t.styleSheet)t.styleSheet.cssText=_;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(_))}}var E=null,j=0;function k(t,a){var u,_,f;if(a.singleton){var p=j++;u=E||(E=m(a)),_=w.bind(null,u,p,!1),f=w.bind(null,u,p,!0)}else u=m(a),_=x.bind(null,u,a),f=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(u)};return _(t),function(a){if(a){if(a.css===t.css&&a.media===t.media&&a.sourceMap===t.sourceMap)return;_(t=a)}else f()}}t.exports=function(t,a){(a=a||{}).singleton||"boolean"==typeof a.singleton||(a.singleton=(void 0===_&&(_=Boolean(window&&document&&document.all&&!window.atob)),_));var u=g(t=t||[],a);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var _=0;_<u.length;_++){var f=v(u[_]);p[f].references--}for(var m=g(t,a),S=0;S<u.length;S++){var y=v(u[S]);0===p[y].references&&(p[y].updater(),p.splice(y,1))}u=m}}}},function(t,a,u){(a=u(31)(!1)).push([t.i,'/**\n * Copyright (c) 2014 The xterm.js authors. All rights reserved.\n * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)\n * https://github.com/chjj/term.js\n * @license MIT\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n * Originally forked from (with the author\'s permission):\n *   Fabrice Bellard\'s javascript vt100 for jslinux:\n *   http://bellard.org/jslinux/\n *   Copyright (c) 2011 Fabrice Bellard\n *   The original design remains. The terminal itself\n *   has been extended to include xterm CSI codes, among\n *   other features.\n */\n\n/**\n *  Default styles for xterm.js\n */.xterm{cursor:text;position:relative;user-select:none;-ms-user-select:none;-webkit-user-select:none}.xterm.focus,.xterm:focus{outline:none}.xterm .xterm-helpers{position:absolute;top:0;\n    /**\n     * The z-index of the helpers must be higher than the canvases in order for\n     * IMEs to appear on top.\n     */z-index:5}.xterm .xterm-helper-textarea{border:0;height:0;left:-9999em;margin:0;opacity:0;overflow:hidden;padding:0;\n    /* Move textarea out of the screen to the far left, so that the cursor is not visible */position:absolute;resize:none;top:0;\n    /** Prevent wrapping so the IME appears against the textarea at the correct position */white-space:nowrap;width:0;z-index:-5}.xterm .composition-view{\n    /* TODO: Composition position got messed up somewhere */background:#000;color:#fff;display:none;position:absolute;white-space:nowrap;z-index:1}.xterm .composition-view.active{display:block}.xterm .xterm-viewport{\n    /* On OS X this is required in order for the scroll bar to appear fully opaque */background-color:#000;bottom:0;cursor:default;left:0;overflow-y:scroll;position:absolute;right:0;top:0}.xterm .xterm-screen{position:relative}.xterm .xterm-screen canvas{left:0;position:absolute;top:0}.xterm .xterm-scroll-area{visibility:hidden}.xterm-char-measure-element{display:inline-block;left:-9999em;line-height:normal;position:absolute;top:0;visibility:hidden}.xterm.enable-mouse-events{\n    /* When mouse events are enabled (eg. tmux), revert to the standard pointer cursor */cursor:default}.xterm .xterm-cursor-pointer,.xterm.xterm-cursor-pointer{cursor:pointer}.xterm.column-select.focus{\n    /* Column selection mode */cursor:crosshair}.xterm .xterm-accessibility,.xterm .xterm-message{bottom:0;color:#0000;left:0;position:absolute;right:0;top:0;z-index:10}.xterm .live-region{height:1px;left:-9999px;overflow:hidden;position:absolute;width:1px}.xterm-dim{opacity:.5}.xterm-underline-1{text-decoration:underline}.xterm-underline-2{-webkit-text-decoration:double underline;text-decoration:double underline}.xterm-underline-3{-webkit-text-decoration:wavy underline;text-decoration:wavy underline}.xterm-underline-4{-webkit-text-decoration:dotted underline;text-decoration:dotted underline}.xterm-underline-5{-webkit-text-decoration:dashed underline;text-decoration:dashed underline}.xterm-strikethrough{text-decoration:line-through}.xterm-screen .xterm-decoration-container .xterm-decoration{position:absolute;z-index:6}.xterm-decoration-overview-ruler{pointer-events:none;position:absolute;right:0;top:0;z-index:7}.xterm-decoration-top{position:relative;z-index:2}',""]),t.exports=a},function(t,a,u){"use strict";t.exports=function(t){var a=[];return a.toString=function(){return this.map((function(a){var u=function(t,a){var u,_,f,p=t[1]||"",v=t[3];if(!v)return p;if(a&&"function"==typeof btoa){var g=(u=v,_=btoa(unescape(encodeURIComponent(JSON.stringify(u)))),f="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(_),"/*# ".concat(f," */")),m=v.sources.map((function(t){return"/*# sourceURL=".concat(v.sourceRoot||"").concat(t," */")}));return[p].concat(m).concat([g]).join("\n")}return[p].join("\n")}(a,t);return a[2]?"@media ".concat(a[2]," {").concat(u,"}"):u})).join("")},a.i=function(t,u,_){"string"==typeof t&&(t=[[null,t,""]]);var f={};if(_)for(var p=0;p<this.length;p++){var v=this[p][0];null!=v&&(f[v]=!0)}for(var g=0;g<t.length;g++){var m=[].concat(t[g]);_&&f[m[0]]||(u&&(m[2]?m[2]="".concat(u," and ").concat(m[2]):m[2]=u),a.push(m))}},a}},function(t,a,u){"use strict";var _=u(1);function f(){return f=Object.assign||function(t){for(var a=1;a<arguments.length;a++){var u=arguments[a];for(var _ in u)Object.prototype.hasOwnProperty.call(u,_)&&(t[_]=u[_])}return t},f.apply(this,arguments)}t.exports=function(t){var a=void 0===t?{}:t,u=a.ref,p=a.onResize,v=_.useRef(null);u=u||v;var g=_.useState({width:void 0,height:void 0}),m=g[0],S=g[1],y=_.useRef({width:void 0,height:void 0});return _.useEffect((function(){if("object"==typeof u&&null!==u&&u.current instanceof Element){var t=u.current,a=new ResizeObserver((function(t){if(Array.isArray(t)&&t.length){var a=t[0],u=Math.round(a.contentRect.width),_=Math.round(a.contentRect.height);if(y.current.width!==u||y.current.height!==_){var f={width:u,height:_};p?p(f):(y.current.width=u,y.current.height=_,S(f))}}}));return a.observe(t),function(){return a.unobserve(t)}}}),[u,p]),_.useMemo((function(){return f({ref:u},m)}),[u,m?m.width:null,m?m.height:null])}},function(t,a,u){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var _=u(1),f=u(34),p=function(){};a.default=function(t,a,u){if(!f.isClient)return[a,p,p];if(!t)throw new Error("useLocalStorage key may not be falsy");var v=u?u.raw?function(t){return t}:u.deserializer:JSON.parse,g=_.useState((function(){try{var _=u?u.raw?String:u.serializer:JSON.stringify,f=localStorage.getItem(t);return null!==f?v(f):(a&&localStorage.setItem(t,_(a)),a)}catch(t){return a}})),m=g[0],S=g[1],y=_.useCallback((function(a){try{var _="function"==typeof a?a(m):a;if(void 0===_)return;var f;f=u?u.raw?"string"==typeof _?_:JSON.stringify(_):u.serializer?u.serializer(_):JSON.stringify(_):JSON.stringify(_),localStorage.setItem(t,f),S(v(f))}catch(t){}}),[t,S]),w=_.useCallback((function(){try{localStorage.removeItem(t),S(void 0)}catch(t){}}),[t,S]);return[m,y,w]}},function(t,a,u){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.isDeepEqual=a.off=a.on=a.isClient=void 0;var _=u(16).__importDefault(u(35));a.isClient="object"==typeof window,a.on=function(t){for(var a=[],u=1;u<arguments.length;u++)a[u-1]=arguments[u];return t.addEventListener.apply(t,a)},a.off=function(t){for(var a=[],u=1;u<arguments.length;u++)a[u-1]=arguments[u];return t.removeEventListener.apply(t,a)},a.isDeepEqual=_.default},function(t,a,u){"use strict";t.exports=function t(a,u){if(a===u)return!0;if(a&&u&&"object"==typeof a&&"object"==typeof u){if(a.constructor!==u.constructor)return!1;var _,f,p;if(Array.isArray(a)){if((_=a.length)!=u.length)return!1;for(f=_;0!=f--;)if(!t(a[f],u[f]))return!1;return!0}if(a.constructor===RegExp)return a.source===u.source&&a.flags===u.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===u.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===u.toString();if((_=(p=Object.keys(a)).length)!==Object.keys(u).length)return!1;for(f=_;0!=f--;)if(!Object.prototype.hasOwnProperty.call(u,p[f]))return!1;for(f=_;0!=f--;){var v=p[f];if(!("_owner"===v&&a.$$typeof||t(a[v],u[v])))return!1}return!0}return a!=a&&u!=u}},function(t,a,u){"use strict";u.r(a),u.d(a,"SessionView",(function(){return Vt})),u.d(a,"default",(function(){return Vt}));var _=u(1),f=u.n(_),p=u(3),v=u(10),g=u(33),m=u.n(g);let S={};const y=new WeakMap,w={metric:[{from:0,to:1e3,unit:"B",long:"bytes"},{from:1e3,to:1e6,unit:"kB",long:"kilobytes"},{from:1e6,to:1e9,unit:"MB",long:"megabytes"},{from:1e9,to:1e12,unit:"GB",long:"gigabytes"},{from:1e12,to:1e15,unit:"TB",long:"terabytes"},{from:1e15,to:1e18,unit:"PB",long:"petabytes"},{from:1e18,to:1e21,unit:"EB",long:"exabytes"},{from:1e21,to:1e24,unit:"ZB",long:"zettabytes"},{from:1e24,to:1e27,unit:"YB",long:"yottabytes"}],metric_octet:[{from:0,to:1e3,unit:"o",long:"octets"},{from:1e3,to:1e6,unit:"ko",long:"kilooctets"},{from:1e6,to:1e9,unit:"Mo",long:"megaoctets"},{from:1e9,to:1e12,unit:"Go",long:"gigaoctets"},{from:1e12,to:1e15,unit:"To",long:"teraoctets"},{from:1e15,to:1e18,unit:"Po",long:"petaoctets"},{from:1e18,to:1e21,unit:"Eo",long:"exaoctets"},{from:1e21,to:1e24,unit:"Zo",long:"zettaoctets"},{from:1e24,to:1e27,unit:"Yo",long:"yottaoctets"}],iec:[{from:0,to:Math.pow(1024,1),unit:"B",long:"bytes"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"KiB",long:"kibibytes"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"MiB",long:"mebibytes"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"GiB",long:"gibibytes"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"TiB",long:"tebibytes"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"PiB",long:"pebibytes"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"EiB",long:"exbibytes"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"ZiB",long:"zebibytes"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"YiB",long:"yobibytes"}],iec_octet:[{from:0,to:Math.pow(1024,1),unit:"o",long:"octets"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"Kio",long:"kibioctets"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"Mio",long:"mebioctets"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"Gio",long:"gibioctets"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"Tio",long:"tebioctets"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"Pio",long:"pebioctets"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"Eio",long:"exbioctets"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"Zio",long:"zebioctets"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"Yio",long:"yobioctets"}]};class ByteSize{constructor(t,a){a=Object.assign({units:"metric",precision:1,locale:void 0},S,a),y.set(this,a),Object.assign(w,a.customUnits);const u=t<0?"-":"";t=Math.abs(t);const _=w[a.units];if(!_)throw new Error(`Invalid units specified: ${a.units}`);{const f=_.find((a=>t>=a.from&&t<a.to));if(f){const _=new Intl.NumberFormat(a.locale,{style:"decimal",minimumFractionDigits:a.precision,maximumFractionDigits:a.precision}),p=0===f.from?u+t:u+_.format(t/f.from);this.value=p,this.unit=f.unit,this.long=f.long}else this.value=u+t,this.unit="",this.long=""}}toString(){const t=y.get(this);return t.toStringFn?t.toStringFn.bind(this)():`${this.value} ${this.unit}`}}function x(t,a){return new ByteSize(t,a)}x.defaultOptions=function(t){S=t};var E=x,j=u(13),k=u(9),T=u(11),L=u.n(T);const A="-",R=t=>void 0===t||""===t||"number"==typeof t&&isNaN(t)?A:t;var D=u(4),M=u(5);const B={open:"primary",acknowledged:"warning",closed:"default"},I=t=>B[t||"closed"];var P=u(14);const H=(...t)=>{const a=Object(p.useEuiTheme)(...t),u=Object(_.useMemo)((()=>{const t="DARK"===a.colorMode?P.euiDarkVars:P.euiLightVars,u={euiColorVis6_asText:Object(p.shade)(t.euiColorVis6,.335),buttonsBackgroundNormalDefaultPrimary:"#006DE4",terminalOutputBackground:"#1d1e23",terminalOutputMarkerAccent:P.euiLightVars.euiColorAccent,terminalOutputMarkerWarning:P.euiDarkVars.euiColorWarning,terminalOutputSliderBackground:P.euiLightVars.euiColorDarkestShade};return{...t,...u}}),[a.colorMode]);return{...a,euiVars:u}};var F=u(12);const $=()=>Object(F.useUiSetting)("dateFormat"),z=(t,a)=>{var u;const _=null==t?void 0:t.destination,f=null==t||null===(u=t.file)||void 0===u?void 0:u.path;return f&&a===M.c.file?R(f):null!=_&&_.address&&a===M.c.network?R(N(_)):void 0},N=t=>{const a=!(null==t||!t.address||null==t||!t.port),u=`${null==t?void 0:t.address}:${null==t?void 0:t.port}`;return`${a?u:null==t?void 0:t.address}`},W=k.i18n.translate("xpack.sessionView.processTooltip",{defaultMessage:"Process alert"}),V=k.i18n.translate("xpack.sessionView.networkTooltip",{defaultMessage:"Network alert"}),U=k.i18n.translate("xpack.sessionView.fileTooltip",{defaultMessage:"File alert"}),K=t=>{let a="";switch(t){case M.c.file:a=U;break;case M.c.network:a=V;break;default:a=W}return a};var q=u(0);const G=({alert:t,isInvestigated:a,isSelected:u,onClick:f,selectAlert:v,onShowAlertDetails:g})=>{var m,S,y;const w=(({isInvestigated:t,isSelected:a})=>{const{euiTheme:u,euiVars:f}=H();return Object(_.useMemo)((()=>{const{size:_,colors:v,font:g,border:m}=u,{bgColor:S,hoverBgColor:y}=(()=>{let u="none",_=`${Object(p.transparentize)(v.primary,.04)}`;return t&&a?(u=`${Object(p.transparentize)(v.danger,.08)}`,_=`${Object(p.transparentize)(v.danger,.12)}`):t?(u=`${Object(p.transparentize)(v.danger,.04)}`,_=`${Object(p.transparentize)(v.danger,.12)}`):a&&(u=`${Object(p.transparentize)(v.primary,.08)}`,_=`${Object(p.transparentize)(v.primary,.12)}`),{bgColor:u,hoverBgColor:_}})();return{alert:{fontFamily:g.family,padding:`0 ${_.m}`,cursor:"pointer","&:not(:last-child)":{marginBottom:_.s},background:S,"&:hover":{background:y},"&& button":{flexShrink:0,marginRight:_.xs,"&:hover, &:focus, &:focus-within":{backgroundColor:Object(p.transparentize)(f.buttonsBackgroundNormalDefaultPrimary,.2)}},"&& .euiFlexItem":{marginTop:_.xxs,marginBottom:_.xxs}},alertStatus:{textTransform:"capitalize"},alertName:{color:v.title,"& .alertCategoryDetailText":{fontSize:_.m}},actionBadge:{textTransform:"capitalize"},processPanel:{marginLeft:"8px",border:`${m.width.thin} solid ${v.lightShade}`,fontFamily:g.familyCode,padding:`${_.xs} ${_.s}`},processAlertDisplayContainer:{display:"flex",alignItems:"center"}}}),[u,t,a,f])})({isInvestigated:a,isSelected:u}),{event:x}=t,{uuid:E,rule:j,workflow_status:k}=(null===(m=t.kibana)||void 0===m?void 0:m.alert)||{},T=null==x||null===(S=x.category)||void 0===S?void 0:S[0],L=Object(_.useMemo)((()=>T&&T in D.d?D.d[T]:D.d.process),[T]);Object(_.useEffect)((()=>{a&&E&&v(E)}),[a,E,v]);const A=Object(_.useCallback)((()=>{E&&g(E)}),[g,E]),B=Object(_.useCallback)((()=>{var a;null!==(a=t.kibana)&&void 0!==a&&a.alert&&f(t.kibana.alert)}),[null===(y=t.kibana)||void 0===y?void 0:y.alert,f]);if(!t.kibana||!j)return null;const{name:P}=j,F=null!=T?T:M.c.process,$=z(t,T),N=K(F);return Object(q.jsx)("div",{key:E,css:w.alert,"data-id":E},Object(q.jsx)(p.EuiFlexGroup,{alignItems:"center",gutterSize:"s",wrap:!0,onClick:B,"data-test-subj":`sessionView:sessionViewAlertDetail-${E}`},Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiButtonIcon,{iconType:"expand","aria-label":"expand","data-test-subj":`sessionView:sessionViewAlertDetailExpand-${E}`,onClick:A})),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiToolTip,{position:"top",content:N},Object(q.jsx)(p.EuiIcon,{type:L,color:"danger"}))),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)("div",{css:w.processAlertDisplayContainer},Object(q.jsx)(p.EuiText,{"data-test-subj":`sessionView:sessionViewAlertDetailRuleName-${E}-text`,css:w.alertName,size:"s"},R(P)),$&&Object(q.jsx)(p.EuiPanel,{css:w.processPanel,color:"subdued",hasBorder:!0,hasShadow:!1,borderRadius:"m"},Object(q.jsx)(p.EuiText,{"data-test-subj":`sessionView:sessionViewAlertDetail-${E}-text`,css:w.alertName,size:"s"},Object(q.jsx)("span",{className:"alertCategoryDetailText"},$))))),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiBadge,{color:I(k),css:w.alertStatus},R(k))),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiBadge,{css:w.actionBadge},null==x?void 0:x.action))))},Y={all:k.i18n.translate("xpack.sessionView.alertDetailsAllSelectedCategory",{defaultMessage:"View: all alerts"}),process:k.i18n.translate("xpack.sessionView.alertDetailsProcessSelectedCategory",{defaultMessage:"View: process alerts"}),network:k.i18n.translate("xpack.sessionView.alertDetailsNetworkSelectedCategory",{defaultMessage:"View: network alerts"}),file:k.i18n.translate("xpack.sessionView.alertDetailsFileSelectedCategory",{defaultMessage:"View: file alerts"})},J={all:k.i18n.translate("xpack.sessionView.alertDetailsAllFilterItem",{defaultMessage:"View all alerts"}),process:k.i18n.translate("xpack.sessionView.alertDetailsProcessFilterItem",{defaultMessage:"View process alerts"}),network:k.i18n.translate("xpack.sessionView.alertDetailsNetworkFilterItem",{defaultMessage:"View network alerts"}),file:k.i18n.translate("xpack.sessionView.alertDetailsFileFilterItem",{defaultMessage:"View file alerts"})},X=({totalAlertsCount:t,alertTypeCounts:a,filteredAlertsCount:u,onAlertEventCategorySelected:f})=>{const{filterStatus:g,popover:m}=Object(_.useMemo)((()=>({filterStatus:{paddingLeft:"16px","& .text":{fontWeight:600}},popover:{paddingRight:"16px","&  .filterMenu":{width:"180px"}}})),[]),[S,y]=Object(_.useState)(M.c.all),[w,x]=Object(_.useState)(!1),E=()=>{x(!1)},j=Object(_.useCallback)((t=>{const[a,u]=t.target.textContent.split(" ");y(u),f(u),E()}),[f]),k=Object(_.useMemo)((()=>a.reduce(((t,{count:a})=>a>0?t+1:0),0)>1),[a]),T=Object(q.jsx)(p.EuiButtonEmpty,{"data-test-subj":"sessionView:sessionViewAlertDetailsEmptyFilterButton",size:"s",iconType:"arrowDown",iconSide:"right",onClick:()=>{x(!w)}},Y[S]),L=Object(_.useMemo)((()=>{const t=t=>t===S?"check":"empty",u=a.filter((({count:t})=>t>0)).map((({category:a})=>Object(q.jsx)(p.EuiContextMenuItem,{"data-test-subj":`sessionView:sessionViewAlertDetailsFilterItem-${a}`,key:a,icon:t(a),onClick:j},J[a])));return[Object(q.jsx)(p.EuiContextMenuItem,{"data-test-subj":"sessionView:sessionViewAlertDetailsFilterItem-default",key:D.g,icon:t(D.g),onClick:j},J[M.c.all]),...u]}),[S,a,j]);return Object(q.jsx)("div",{"data-test-subj":"sessionView:sessionViewAlertDetailsFilter"},Object(q.jsx)(p.EuiFlexGroup,{alignItems:"center"},Object(q.jsx)(p.EuiFlexItem,{css:g,style:{paddingLeft:"16px"}},Object(q.jsx)(p.EuiText,{size:"s","data-test-subj":"sessionView:sessionViewAlertDetailsFilterStatus"},t===u&&Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.alertTotalCountStatusLabel",defaultMessage:"Showing {count} alerts",values:{count:Object(q.jsx)("strong",null,t)}}),t!==u&&Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.alertFilteredCountStatusLabel",defaultMessage:" Showing {count} alerts",values:{count:Object(q.jsx)("strong",null,u," of ",t)}}))),k&&Object(q.jsx)(p.EuiFlexItem,{css:m,grow:!1,"data-test-subj":"sessionView:sessionViewAlertDetailsFilterSelectorContainer"},Object(q.jsx)(p.EuiPopover,{button:T,isOpen:w,closePopover:E,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(q.jsx)(p.EuiContextMenuPanel,{"data-test-subj":"sessionView:sessionViewAlertDetailsFilterSelectorContainerMenu",size:"s",className:"filterMenu",items:L})))),Object(q.jsx)(p.EuiHorizontalRule,{margin:"xs"}))};function Z({alerts:t,investigatedAlertId:a,isProcessSelected:u=!1,alertTypeCounts:f,onAlertSelected:v,onShowAlertDetails:g}){const[m,S]=Object(_.useState)(null),[y,w]=Object(_.useState)(D.g),x=(()=>{const{euiTheme:t}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>{const{size:a,colors:u,border:_}=t;return{container:{margin:`${a.xs} ${a.base} ${a.base} ${a.xs}`,color:u.text,padding:`${a.s} 0`,borderStyle:"solid",borderColor:u.lightShade,borderWidth:_.width.thin,borderRadius:_.radius.medium,maxHeight:378,overflowY:"auto",backgroundColor:u.emptyShade}}}),[t])})();Object(_.useEffect)((()=>{const u=a&&t.find((t=>{var u,_;return(null===(u=t.kibana)||void 0===u||null===(_=u.alert)||void 0===_?void 0:_.uuid)===a}));var _;u&&S(null===(_=u.kibana)||void 0===_?void 0:_.alert)}),[a,t]);const E=Object(_.useRef)(null),j=Object(_.useCallback)((t=>{if(null==E||!E.current)return;const a=E.current.querySelector(`[data-id="${t}"]`);if(a){const t=E.current.scrollTop,u=t+E.current.clientHeight,_=a.offsetTop,f=_+a.clientHeight;_>=t&&f<=u||a.scrollIntoView({block:"nearest"})}}),[]),k=Object(_.useCallback)((t=>{v(D.q),S(t)}),[v]),T=Object(_.useCallback)((t=>{M.c.hasOwnProperty(t)?w(t):w(M.c.all)}),[]),L=Object(_.useMemo)((()=>null==t?void 0:t.filter((t=>{var a,u;const _=null===(a=t.event)||void 0===a||null===(u=a.category)||void 0===u?void 0:u[0];return y===D.g||_===y}))),[y,t]);return 0===t.length?null:Object(q.jsx)("div",{ref:E,css:x.container,"data-test-subj":"sessionView:sessionViewAlertDetails"},Object(q.jsx)(X,{totalAlertsCount:t.length,alertTypeCounts:f,filteredAlertsCount:L.length,onAlertEventCategorySelected:T}),L.map(((t,_)=>{var f,p;const v=(null===(f=t.kibana)||void 0===f||null===(p=f.alert)||void 0===p?void 0:p.uuid)||null;return Object(q.jsx)(G,{key:`${v}-${_}`,alert:t,isInvestigated:a===v,isSelected:u&&(null==m?void 0:m.uuid)===v,onClick:k,selectAlert:j,onShowAlertDetails:g})})))}const Q=()=>{const{euiTheme:t,euiVars:a}=H();return Object(_.useMemo)((()=>{const{border:u,colors:_,size:f,font:v}=t,g={lineHeight:"18px",height:"20px",fontSize:f.m,fontFamily:v.family,fontWeight:v.weight.medium,borderRadius:u.radius.small,marginLeft:f.xs,marginRight:f.xs,minWidth:0,padding:`${f.s} ${f.xxs}`,color:a.euiColorVis6_asText,background:Object(p.transparentize)(a.euiColorVis6,.04),border:`${u.width.thin} solid ${Object(p.transparentize)(a.euiColorVis6,.48)}`,"&& > span":{padding:`0px ${f.xxs}`,svg:{transition:`transform ${t.animation.extraFast}`}},"&&:hover, &&:focus":{background:Object(p.transparentize)(a.euiColorVis6,.12),textDecoration:"none"},"&.isExpanded > span svg:not(.alertIcon)":{transform:"rotate(180deg)"},"&.isExpanded":{color:_.ghost,background:a.euiColorVis6,"&:hover, &:focus":{background:a.euiColorVis6}}};return{buttonArrow:{marginLeft:f.xs},button:g,alertButton:{...g,color:a.euiColorDanger,background:Object(p.transparentize)(a.euiColorDanger,.04),border:`${u.width.thin} solid ${Object(p.transparentize)(a.euiColorDanger,.48)}`,"&&:hover, &&:focus":{background:Object(p.transparentize)(a.euiColorDanger,.12),textDecoration:"none"},"&.isExpanded":{color:_.ghost,background:a.euiColorDanger,"&:hover, &:focus":{background:`${a.euiColorDanger}`}},"& .euiButton__text":{display:"flex",alignItems:"center"," .alertIcon":{marginLeft:"4px"}}},outputButton:{...g,color:a.euiColorVis1,background:Object(p.transparentize)(a.euiColorVis1,.04),border:`${u.width.thin} solid ${Object(p.transparentize)(a.euiColorVis1,.48)}`,"&&:hover, &&:focus":{background:Object(p.transparentize)(a.euiColorVis1,.12),textDecoration:"none"},"&.isExpanded":{color:_.ghost,background:a.euiColorVis1,"&:hover, &:focus":{background:`${a.euiColorVis1}`}}},userChangedButton:{...g,cursor:"default",color:a.euiColorGhost,background:a.euiColorVis3,border:`${u.width.thin} solid ${Object(p.transparentize)(a.euiColorVis3,.48)}`,"&&:hover, &&:focus":{color:a.euiColorGhost,background:a.euiColorVis3,textDecoration:"none",transform:"none",animation:"none"}},buttonSize:{padding:`0px ${t.size.xs}`}}}),[t,a])},ee=k.i18n.translate("xpack.sessionView.childProcesses",{defaultMessage:"Child processes"}),te=k.i18n.translate("xpack.sessionView.alerts",{defaultMessage:"Alerts"}),ie=k.i18n.translate("xpack.sessionView.alert",{defaultMessage:"Alert"}),se=k.i18n.translate("xpack.sessionView.output",{defaultMessage:"Output"}),re=({onToggle:t,isExpanded:a})=>{const{button:u,buttonArrow:_}=Q();return Object(q.jsx)(p.EuiButton,{className:a?"isExpanded":"",key:"child-processes-button",css:u,onClick:t,"data-test-subj":"sessionView:processTreeNodeChildProcessesButton","aria-label":ee},ee,Object(q.jsx)(p.EuiIcon,{css:_,size:"s",type:"arrowDown"}))},ne=({isExpanded:t,alertTypeCounts:a,onToggle:u,alertsCount:f})=>{const{alertButton:v,buttonArrow:g}=Q(),m=Object(_.useMemo)((()=>{var t;return null==a||null===(t=a.filter((t=>t.count>0)))||void 0===t?void 0:t.map((({category:t},a)=>D.d[t]))}),[a]);return Object(q.jsx)(p.EuiButton,{className:t?"isExpanded":"",key:"alert-button",css:v,onClick:u,"data-test-subj":"processTreeNodeAlertButton","aria-label":te},f>1?te:ie,f>1&&(f>99?" (99+)":` (${f})`),null==m?void 0:m.map((t=>Object(q.jsx)(p.EuiIcon,{className:"alertIcon",key:t,size:"s",type:t}))),Object(q.jsx)(p.EuiIcon,{css:g,size:"s",type:"arrowDown"}))},oe=({onClick:t})=>{const{outputButton:a,buttonArrow:u}=Q();return Object(q.jsx)(p.EuiButton,{key:"output-button",css:a,onClick:t,"data-test-subj":"processTreeNodeOutpuButton","aria-label":se},se,Object(q.jsx)(p.EuiIcon,{css:u,size:"s",type:"arrowRight"}))};var ae=u(17),le=u.n(ae);const ce={},he=({children:t,role:a="document",highlightIndices:u,highlightStyle:_,...p})=>Object(q.jsx)(f.a.Fragment,null,t.split("").map((function(t,a){const v=null==u?void 0:u.includes(a);return Object(q.jsx)("span",le()({"aria-hidden":"true",css:v?_:ce,key:a},v?{"data-test-subj":"sessionView:splitTextIsHighlighted"}:{},p)," "===t?Object(q.jsx)(f.a.Fragment,null,"Â "):t)}))),de={width:"6px",display:"inline-block"},ue=()=>Object(q.jsx)("span",{css:de},"Â "),_e={"&&":{display:"inline",fontSize:0,lineHeight:0,verticalAlign:"middle"}},fe=({children:t,match:a,text:u,highlightStyle:_})=>{let p=0;return Object(q.jsx)("span",{css:_e,"aria-label":u,role:"document"},a?f.a.Children.map(t,(t=>{const u=t.props.children.length,v=a.map((t=>t-p));return p+=u,f.a.cloneElement(t,{highlightIndices:v,highlightStyle:_})})):t)},pe=k.i18n.translate("xpack.sessionView.execUserChange",{defaultMessage:"Exec user change"});function ve({process:t,isSessionLeader:a=!1,depth:u=0,onProcessSelected:g,jumpToEntityId:m,investigatedAlertId:S,selectedProcess:y,showTimestamp:w,verboseMode:x,searchResults:E,scrollerRef:j,onChangeJumpToEventVisibility:L,onShowAlertDetails:A,onJumpToOutput:M,loadPreviousButton:B,loadNextButton:I}){var P,F;const[z,N]=Object(_.useState)(a||t.autoExpand),[W,V]=Object(_.useState)(!1),{searchMatched:U}=t,K=$();Object(_.useEffect)((()=>{N(t.autoExpand)}),[t.autoExpand]),Object(_.useEffect)((()=>{!z&&y&&y.isDescendantOf(t)&&N(!0)}),[y,t,z]);const G=t.getAlerts(),Y=!!G.length,J=t.hasOutput(),X=Object(_.useMemo)((()=>!(!Y||!G.find((t=>{var a,u;return S&&S===(null===(a=t.kibana)||void 0===a||null===(u=a.alert)||void 0===u?void 0:u.uuid)})))),[Y,G,S]),ee=(null==y?void 0:y.id)===t.id,te=(({depth:t,hasAlerts:a,hasInvestigatedAlert:u,isSelected:f,isSessionLeader:v})=>{const{euiTheme:g,euiVars:m}=H();return Object(_.useMemo)((()=>{const{colors:_,border:S,size:y,font:w}=g,x="21px",E="13px",j=`calc(${y.l} + ${y.xxs})`,k=y.s,T={color:_.text,fontFamily:w.familyCode},L={position:"relative",color:_.ghost,marginLeft:y.base,paddingLeft:y.s,borderLeft:S.editable},A={color:m.euiColorDarkShade},{bgColor:R,borderColor:D,hoverColor:M,searchResColor:B}=(()=>{let t="none",v=Object(p.transparentize)(_.primary,.04),g="transparent",m=Object(p.transparentize)(_.warning,.32);return a&&(g=_.danger),f&&(m=_.warning,t=Object(p.transparentize)(_.primary,.08),v=Object(p.transparentize)(_.primary,.12)),u&&(t=Object(p.transparentize)(_.danger,.04),v=Object(p.transparentize)(_.danger,.12),f&&(t=Object(p.transparentize)(_.danger,.08))),{bgColor:t,borderColor:g,hoverColor:v,searchResColor:m}})(),I={fontSize:0,lineHeight:0},P={...I,display:"block",cursor:"pointer",position:"relative",marginBottom:v?y.s:"0px","&:hover:before":{backgroundColor:M},"&:before":{position:"absolute",height:"100%",pointerEvents:"none",content:"''",marginLeft:`calc(-${t} * ${j} - ${k})`,borderLeft:`3px solid ${D}`,backgroundColor:R,width:`calc(100% + ${t} * ${j} + ${k})`},".euiToolTipAnchor":{verticalAlign:"middle"}},H={marginLeft:y.s,span:{fontSize:E,lineHeight:x,verticalAlign:"middle"}},F={...I,"span, b":{fontSize:E,lineHeight:x,display:"inline-block",verticalAlign:"middle"}};return{darkText:T,searchHighlight:`\n      color: ${_.fullShade};\n      border-radius: '0px';\n      background-color: ${B};\n    `,children:L,processNode:P,wrapper:{paddingLeft:y.s,position:"relative",verticalAlign:"middle",color:m.euiTextSubduedColor,wordBreak:"break-all",padding:`${y.xs} 0px`,button:{marginLeft:"6px",marginRight:y.xxs}},workingDir:{color:_.successText,fontFamily:w.familyCode,fontWeight:w.weight.regular},timeStamp:{float:"right",fontFamily:w.familyCode,fontSize:y.m,fontWeight:w.weight.regular,paddingRight:y.base,paddingLeft:y.xxl,position:"relative",lineHeight:x,marginTop:"1px"},alertDetails:{padding:y.s,border:S.editable,borderRadius:S.radius.medium},icon:A,textSection:H,sessionLeader:F}}),[t,g,a,u,f,m,v])})({depth:u,hasAlerts:Y,hasInvestigatedAlert:X,isSelected:ee,isSessionLeader:a}),ie=Q(),se=function({viewPortEl:t,visibleCallback:a,shouldAddListener:u=!1,offset:f=0,debounceTimeout:p=D.f}){const v=Object(_.useRef)(null),g=Object(_.useMemo)((()=>Object(T.debounce)((()=>{if(!v.current||!t)return;const{height:u,y:_}=v.current.getBoundingClientRect(),{y:p}=t.getBoundingClientRect(),g=p+t.clientHeight,m=_+u;a(m+f>=p&&_-f<=g,m+f<p)}),p)),[p,f,t,a]);return Object(_.useEffect)((()=>(u&&(null==t||t.addEventListener("scroll",g)),()=>{u&&(null==t||t.removeEventListener("scroll",g))})),[g,t,u]),v}({viewPortEl:j.current,visibleCallback:Object(_.useCallback)(((t,a)=>{L(t,a)}),[L]),shouldAddListener:X}),ae=Object(_.useMemo)((()=>Object(T.chain)(G).groupBy((t=>{var a,u;return null===(a=t.event)||void 0===a||null===(u=a.category)||void 0===u?void 0:u[0]})).map(((t,a)=>({category:a,count:t.length}))).value()),[G]);Object(_.useEffect)((()=>{var a;t.id===(null==y?void 0:y.id)&&null!==(a=se.current)&&void 0!==a&&a.scrollIntoView&&se.current.scrollIntoView({behavior:"smooth",block:"nearest"})}),[y,t,se]),Object(_.useEffect)((()=>{X&&V(!0)}),[X]);const le=Object(_.useCallback)((()=>{N(!z)}),[z]),ce=Object(_.useCallback)((()=>{V(!W)}),[W]),de=Object(_.useCallback)((a=>{a.stopPropagation();const u=window.getSelection();u&&"Range"===u.type||null==g||g(t)}),[g,t]),_e=t.getDetails(),ge=t.hasExec(),me=Object(_.useCallback)((()=>{var t;const a=null===(t=_e.process)||void 0===t?void 0:t.entity_id;a&&M(a)}),[M,null===(P=_e.process)||void 0===P?void 0:P.entity_id]),be=Object(_.useMemo)((()=>t.parent?ge?"console":"branch":"unlink"),[ge,t.parent]),Se=Object(_.useMemo)((()=>t.parent?ge?k.i18n.translate("xpack.sessionView.processNode.tooltipExec",{defaultMessage:"Process exec'd"}):k.i18n.translate("xpack.sessionView.processNode.tooltipFork",{defaultMessage:"Process forked (no exec)"}):k.i18n.translate("xpack.sessionView.processNode.tooltipOrphan",{defaultMessage:"Process missing parent (orphan)"})),[ge,t.parent]),Ce=t.getChildren(x);if(null==_e||!_e.process)return null;const ye=t.id,{args:we,name:xe,tty:Ee,parent:Oe,working_directory:je,start:ke,user:Te}=_e.process,Le=a||z&&(null==Ce?void 0:Ce.length)>0,Ae=u+1,Re=!a&&!(null==Te||!Te.name)&&Te.name!==(null==Oe||null===(F=Oe.user)||void 0===F?void 0:F.name),De=Ee?"desktop":"gear",Me=ge?"sessionView:processTreeNodeExecIcon":"sessionView:processTreeNodeForkIcon",Be=Object(p.formatDate)(ke,K);return Object(q.jsx)("div",null,Object(q.jsx)("div",{"data-id":ye,key:ye+U,css:te.processNode,"data-test-subj":"sessionView:processTreeNode",ref:se},Object(q.jsx)("div",{"data-test-subj":"sessionView:processTreeNodeRow",css:te.wrapper,onClick:de},a?Object(q.jsx)("span",{css:te.sessionLeader},Object(q.jsx)(p.EuiIcon,{type:De,css:te.icon}),Object(q.jsx)(ue,null),Object(q.jsx)("b",{css:te.darkText},R(xe||(null==we?void 0:we[0]))),Object(q.jsx)(ue,null),Object(q.jsx)("span",null,Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.startedBy",defaultMessage:"started by"})),Object(q.jsx)(ue,null),Object(q.jsx)(p.EuiIcon,{type:"user"}),Object(q.jsx)(ue,null),Object(q.jsx)("b",{css:te.darkText},R(null==Te?void 0:Te.name))):Object(q.jsx)(f.a.Fragment,null,w&&Object(q.jsx)("span",{"data-test-subj":"sessionView:processTreeNodeTimestamp",css:te.timeStamp},Be),Object(q.jsx)(p.EuiToolTip,{position:"top",content:Se},Object(q.jsx)(p.EuiIcon,{"data-test-subj":Me,type:be,css:te.icon})),Object(q.jsx)("span",{css:te.textSection},Object(q.jsx)(fe,{text:`${null!=je?je:""} ${null==we?void 0:we.join(" ")}`,match:t.searchMatched,highlightStyle:te.searchHighlight},Object(q.jsx)(he,{css:te.workingDir},R(je)+" "),Object(q.jsx)(he,{css:te.darkText},`${R(null==we?void 0:we[0])}`),Object(q.jsx)(he,null,we&&we.length>1?" "+(null==we?void 0:we.slice(1).join(" ")):"")))),Re&&Object(q.jsx)(p.EuiButton,{"data-test-subj":"sessionView:processTreeNodeRootEscalationFlag",css:ie.userChangedButton,"aria-label":pe},pe," :",Object(q.jsx)("span",null,Te.name)),!a&&Ce.length>0&&Object(q.jsx)(re,{isExpanded:z,onToggle:le}),Y&&Object(q.jsx)(ne,{onToggle:ce,alertTypeCounts:ae,isExpanded:W,alertsCount:G.length}),J&&Object(q.jsx)(oe,{onClick:me}))),W&&Object(q.jsx)(Z,{alerts:G,alertTypeCounts:ae,investigatedAlertId:S,isProcessSelected:ee,onAlertSelected:de,onShowAlertDetails:A}),Le&&Object(q.jsx)("div",{css:te.children},B,Ce.map((t=>Object(q.jsx)(ve,{key:t.id,process:t,depth:Ae,onProcessSelected:g,onJumpToOutput:M,jumpToEntityId:m,investigatedAlertId:S,selectedProcess:y,showTimestamp:w,verboseMode:x,searchResults:E,scrollerRef:j,onChangeJumpToEventVisibility:L,onShowAlertDetails:A}))),I))}const ge=({isDisplayedAbove:t=!1,onClick:a})=>{const u=(({isDisplayedAbove:t})=>{const{euiTheme:a,euiVars:u}=H();return Object(_.useMemo)((()=>{const{size:_,font:f}=a,p={color:P.euiLightVars.euiColorEmptyShade,backgroundColor:P.euiLightVars.euiColorPrimaryText},v={position:"absolute",height:_.xxxxl,width:"100%",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},g={position:"sticky",pointerEvents:"auto",cursor:"pointer",fontWeight:f.weight.regular};return t?(v.top=0,v.background=`linear-gradient(180deg, ${u.euiColorLightestShade} 0%, transparent 100%)`):(v.bottom=0,v.background=`linear-gradient(360deg, ${u.euiColorLightestShade} 0%, transparent 100%)`),{container:v,jumpBackBadge:g,buttonStyle:p}}),[t,a,u])})({isDisplayedAbove:t});return Object(q.jsx)("div",{css:u.container},Object(q.jsx)(p.EuiBadge,{style:u.buttonStyle,css:u.jumpBackBadge,iconType:t?"arrowUp":"arrowDown",iconSide:"right",onClick:a,onClickAriaLabel:"Back to investigated alert","data-test-subj":"sessionView:backToInvestigatedAlert"},Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.backToInvestigatedAlert",defaultMessage:"Back to investigated alert"})))};var me=u(18),be=u.n(me),Se=u(24),Ce=u.n(Se),ye=u(21),we=u.n(ye);const xe=(t,a)=>{var u,_,f,p;const v=(null===(u=t.getDetails())||void 0===u||null===(_=u.process)||void 0===_?void 0:_.start)||0,g=(null===(f=a.getDetails())||void 0===f||null===(p=f.process)||void 0===p?void 0:p.start)||0;return v<g?-1:v>g?1:0};function Ee(t,a){const u=(null==a?void 0:a.entity_id)||we.a.v4(),_=new hooks_ProcessImpl(u);if(t&&a){var f;const v={...t,process:{...t.process,...a},user:a.user,group:a.group,event:{...t.event,id:`fake-${u}`}};var p;(null===(f=t.process)||void 0===f?void 0:f.parent)===a&&(null===(p=v.process)||void 0===p||delete p.parent),_.addEvent(v)}return _}const Oe=(t,a)=>t.split("").reduce(((t,u,_)=>(a.find((t=>void 0!==t.index&&_>=t.index&&_<t.index+t[0].length))&&(t=[...t,_]),t)),[]),je=(t,a)=>{for(const u of Object.keys(t)){const _=t[u];if(_.isUserEntered()||a===_.id||_.hasAlerts()){let{parent:t}=_;const a=new Set;for(;t&&!a.has(t.id);)a.add(t.id),t.autoExpand=!0,t=t.parent}}return t};class hooks_ProcessImpl{constructor(t){be()(this,"id",void 0),be()(this,"events",void 0),be()(this,"alerts",void 0),be()(this,"children",void 0),be()(this,"parent",void 0),be()(this,"autoExpand",void 0),be()(this,"searchMatched",void 0),be()(this,"orphans",void 0),be()(this,"getChildrenMemo",Ce()(((t,a,u)=>0===t.length&&0===a.length?[]:(a.length&&(t=[...t,...a]),u||(t=t.filter((t=>!(0===t.events.length||!t.autoExpand&&!t.hasAlerts()&&t.isVerbose())))),Object(T.sortedUniqBy)(t.sort(xe),(t=>t.id)))))),be()(this,"findEventByAction",Ce()(((t,a)=>t.find((({event:t})=>(null==t?void 0:t.action)===a))))),be()(this,"findEventByKind",Ce()(((t,a)=>t.find((({event:t})=>(null==t?void 0:t.kind)===a))))),be()(this,"filterEventsByAction",Ce()(((t,a)=>t.filter((({event:t})=>(null==t?void 0:t.action)===a))))),be()(this,"filterEventsByKind",Ce()(((t,a)=>t.filter((({event:t})=>(null==t?void 0:t.kind)===a))))),be()(this,"getDetailsMemo",Ce()((t=>{var a;const u=[M.a.fork,M.a.exec,M.a.end],_=t.filter((t=>{var a;return u.includes(null===(a=t.event)||void 0===a?void 0:a.action)}));return 0===_.length&&t.length>0?t[t.length-1]:null!==(a=_[_.length-1])&&void 0!==a?a:{}}))),this.id=t,this.events=[],this.alerts=[],this.children=[],this.orphans=[],this.autoExpand=!1,this.searchMatched=null}addEvent(t){this.events.find((a=>{var u,_;return(null===(u=a.event)||void 0===u?void 0:u.id)===(null===(_=t.event)||void 0===_?void 0:_.id)}))||(this.events=this.events.concat(t))}addAlert(t){this.alerts.find((a=>{var u,_;return(null===(u=a.event)||void 0===u?void 0:u.id)===(null===(_=t.event)||void 0===_?void 0:_.id)}))||(this.alerts=this.alerts.concat(t))}addChild(t){this.children=this.children.concat(t)}clearSearch(){this.searchMatched=null}getChildren(t){return this.getChildrenMemo(this.children,this.orphans,t)}isVerbose(){var t;const{group_leader:a,session_leader:u,entry_leader:_}=null!==(t=this.getDetails().process)&&void 0!==t?t:{};return!(this.id===(null==_?void 0:_.entity_id)||a&&u&&a.pid!==u.pid)}hasOutput(){return!!this.findEventByAction(this.events,M.a.text_output)}hasAlerts(){return!!this.alerts.length}hasAlert(t){return!!t&&!!this.alerts.find((a=>{var u,_;return(null===(u=a.kibana)||void 0===u||null===(_=u.alert)||void 0===_?void 0:_.uuid)===t}))}getAlerts(){return this.alerts}updateAlertsStatus(t){this.alerts=((t,a)=>t.map((t=>{var u,_,f,p,v;return t.kibana?{...t,kibana:{...t.kibana,alert:{...t.kibana.alert,workflow_status:null!==(u=null===(_=a[null!==(f=null===(p=t.kibana.alert)||void 0===p?void 0:p.uuid)&&void 0!==f?f:""])||void 0===_?void 0:_.status)&&void 0!==u?u:null===(v=t.kibana.alert)||void 0===v?void 0:v.workflow_status}}}:t})))(this.alerts,t)}hasExec(){return!!this.findEventByAction(this.events,M.a.exec)}hasExited(){return!!this.findEventByAction(this.events,M.a.end)}getDetails(){return this.getDetailsMemo(this.events)}getOutput(){return""}getEndTime(){const t=this.findEventByAction(this.events,M.a.end);return(null==t?void 0:t["@timestamp"])||""}isUserEntered(){var t;const a=this.getDetails();if(!a)return!1;const{pid:u,tty:_,parent:f,session_leader:p,group_leader:v}=null!==(t=a.process)&&void 0!==t?t:{},g=f&&p&&f.pid===p.pid,m=v&&u===v.pid;return!!(_&&g&&m)}getMaxAlertLevel(){return null}isDescendantOf(t){let a=this.parent;for(;a;){if(a===t)return!0;a=a.parent}return!1}}const ke=({sessionEntityId:t,data:a,searchQuery:u,updatedAlertsStatus:f,verboseMode:p,jumpToEntityId:v})=>{var g,m;const S=null===(g=a[0])||void 0===g||null===(m=g.events)||void 0===m?void 0:m[0],y=Object(_.useMemo)((()=>{var t;const a=null==S||null===(t=S.process)||void 0===t?void 0:t.entry_leader;return Ee(S,a)}),[S]),w={[t]:y},[x,E]=Object(_.useState)(w),[j,k]=Object(_.useState)([]),[L,A]=Object(_.useState)([]),[R,D]=Object(_.useState)([]);return Object(_.useEffect)((()=>{let u=x,_=R;const f=[];a.forEach(((a,p)=>{if(!j.find((t=>{var u,_;return t.cursor===a.cursor&&(null===(u=t.events)||void 0===u?void 0:u.length)===(null===(_=a.events)||void 0===_?void 0:_.length)}))){const v=p<j.length,g=((t,a,u,_,f=!1)=>{if(!a||0===a.length)return[t,u];const p=((t,a)=>(a.forEach((a=>{var u,_,f;const{entity_id:p}=null!==(u=a.process)&&void 0!==u?u:{};if(!p)return;let v=t[p];v||(v=new hooks_ProcessImpl(p),t[p]=v),null!==(_=a.kibana)&&void 0!==_&&_.alert?v.addAlert(a):(null===(f=a.event)||void 0===f?void 0:f.kind)===M.b.event&&v.addEvent(a)})),t))(t,a),v=((t,a,u,_,f=!1)=>{f&&(a=a.slice().reverse()),a.forEach((a=>{var f,p;const{entity_id:v,parent:g}=null!==(f=a.process)&&void 0!==f?f:{},m=t[null!=v?v:""];let S=t[null!==(p=null==g?void 0:g.entity_id)&&void 0!==p?p:""];if(v&&g&&!m.parent&&v!==_){if(!S){var y;const _=null==a||null===(y=a.process)||void 0===y?void 0:y.parent;null!=_&&_.entity_id&&!t[_.entity_id]?(S=Ee(a,_),t[S.id]=S,u.includes(S)||u.push(S)):u.includes(m)||u.push(m)}S&&(m.parent=S,S.addChild(m))}}));const p=[];return null==u||u.forEach((a=>{var u,_;const f=null===(u=a.getDetails().process)||void 0===u||null===(_=u.parent)||void 0===_?void 0:_.entity_id;if(f){const u=t[f];if(u)return a.parent=u,void u.addChild(a)}p.push(a)})),p})(p,a,u,_,f);return[je(p),v]})(u,a.events,R,t,v);u=g[0],_=g[1],f.push(a)}})),f.length>0&&(E({...u}),k([...j,...f]),D(_),je(u,v))}),[a,x,R,j,t,v]),Object(_.useEffect)((()=>{A(((t,a,u)=>{const _=[];for(const v of Object.keys(t)){const g=t[v];if(a){var f,p;const t=g.getDetails(),v=null==t||null===(f=t.process)||void 0===f?void 0:f.entry_leader;if((null==v?void 0:v.entity_id)===g.id||!u&&g.isVerbose())continue;const m=g.getDetails(),{working_directory:S,args:y}=null!==(p=m.process)&&void 0!==p?p:{},w=`${null!=S?S:""} ${null==y?void 0:y.join(" ")}`,x=[...w.matchAll(new RegExp(Object(T.escapeRegExp)(a),"gi"))];g.searchMatched=x.length>0?Oe(w,x):null,g.searchMatched&&_.push(g)}else g.clearSearch()}return _.sort(xe)})(x,u,p))}),[u,x,p]),x[t].orphans=R,Object.keys(f).forEach((t=>{const a=x[f[t].processEntityId];a&&a.updateAlertsStatus(f)})),{sessionLeader:x[t],processMap:x,searchResults:L}},Te=({onClick:t,text:a,isFetching:u,eventsRemaining:f,forward:g})=>{const m=(()=>{const{euiTheme:t}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>{const{border:a}=t;return{wrapper:{display:"flex",alignItems:"center"},dottedLine:{flex:1,borderTop:`${a.width.thick} dotted ${a.color}`}}}),[t])})();return Object(q.jsx)("div",{css:m.wrapper},Object(q.jsx)(p.EuiButtonEmpty,{size:"xs",iconType:g?"arrowDown":"arrowUp",onClick:t,isLoading:u},a,f>0&&Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.processTreeLoadMoreButton",defaultMessage:" ({count} left)",values:{count:f}})),Object(q.jsx)("span",{css:m.dottedLine}))};const Le=k.i18n.translate("xpack.sessionView.processTree.loadMore",{defaultMessage:"Show {pageSize} next events",values:{pageSize:D.s}}),Ae=k.i18n.translate("xpack.sessionView.processTree.loadPrevious",{defaultMessage:"Show {pageSize} previous events",values:{pageSize:D.s}}),Re=({sessionEntityId:t,data:a,jumpToEntityId:u,investigatedAlertId:v,isFetching:g,hasNextPage:m,hasPreviousPage:S,fetchNextPage:y,fetchPreviousPage:w,searchQuery:x,selectedProcess:E,onProcessSelected:j,setSearchResults:k,updatedAlertsStatus:T,onShowAlertDetails:A,onJumpToOutput:R,showTimestamp:M=!0,verboseMode:B=!1})=>{const[I,P]=Object(_.useState)(!0),[F,$]=Object(_.useState)(!1),z=(()=>{const{euiTheme:t,euiVars:a}=H();return Object(_.useMemo)((()=>{const{colors:u,font:_,size:f}=t,v=u.primary;return{sessionViewProcessTree:{position:"relative",fontFamily:_.familyCode,overflow:"auto",height:"100%",backgroundColor:a.euiColorLightestShade,paddingTop:f.base,paddingLeft:f.s},selectionArea:{position:"absolute",display:"none",marginLeft:"-50%",width:"150%",height:"100%",backgroundColor:v,pointerEvents:"none",opacity:.1,transform:`translateY(-${f.xs})`},defaultSelected:Object(p.transparentize)(u.primary,.008),alertSelected:Object(p.transparentize)(u.danger,.008)}}),[t,a])})(),{sessionLeader:N,processMap:W,searchResults:V}=ke({sessionEntityId:t,data:a,searchQuery:x,updatedAlertsStatus:T,verboseMode:B,jumpToEntityId:u}),U=Object(_.useMemo)((()=>{var t;return((null==a||null===(t=a[0])||void 0===t?void 0:t.total)||0)-a.reduce(((t,a)=>{var u;return t+((null==a||null===(u=a.events)||void 0===u?void 0:u.length)||0)}),0)}),[a]),K=Object(_.useRef)(null),G=Object(_.useCallback)(((t,a)=>{t!==I&&P(t),t||a===F||$(a)}),[I,F]),Y=Object(_.useCallback)((()=>{j(null),P(!0)}),[j]);return Object(_.useEffect)((()=>{k&&k(V)}),[V,k]),function({div:t,handler:a}){Object(_.useEffect)((()=>{if(t){const u=L.a.debounce((()=>{const u=function(t){return t?t.scrollTop:document.documentElement.scrollTop||document.body.scrollTop}(t),_=u+t.offsetHeight>t.scrollHeight-20;a(u,_)}),D.f);return t.onscroll=u,()=>{u.cancel(),t.onscroll=null}}}),[t,a])}({div:K.current,handler:(t,a)=>{!g&&a&&y()}}),Object(_.useEffect)((()=>{if(u){const t=W[u],a=!(null==t||!t.getDetails());!E&&a&&j(t)}else E||j(N)}),[u,W,j,E,N]),Object(q.jsx)(f.a.Fragment,null,Object(q.jsx)("div",{ref:K,css:z.sessionViewProcessTree,"data-test-subj":"sessionView:sessionViewProcessTree"},N&&Object(q.jsx)(ve,{isSessionLeader:!0,process:N,onProcessSelected:j,onJumpToOutput:R,jumpToEntityId:u,investigatedAlertId:v,selectedProcess:E,scrollerRef:K,onChangeJumpToEventVisibility:G,onShowAlertDetails:A,showTimestamp:M,verboseMode:B,searchResults:V,loadPreviousButton:S?Object(q.jsx)(Te,{text:Ae,onClick:w,isFetching:g,eventsRemaining:U,forward:!1}):null,loadNextButton:m?Object(q.jsx)(Te,{text:Le,onClick:y,isFetching:g,eventsRemaining:U,forward:!0}):null})),!I&&Object(q.jsx)(ge,{onClick:Y,isDisplayedAbove:F}))},De=({listItems:t})=>{const a=(()=>{const{euiTheme:t}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>({descriptionList:{padding:`${t.size.base} ${t.size.s} `,alignItems:"flex-start"},tabListTitle:{width:"40%",display:"flex",marginTop:"0px"},tabListDescription:{width:"60%",display:"flex",marginTop:"0px"}})),[t])})();return Object(q.jsx)(p.EuiDescriptionList,{type:"column",listItems:t,css:a.descriptionList,titleProps:{style:a.tabListTitle},descriptionProps:{style:a.tabListDescription},"data-test-subj":"sessionView:detail-panel-description-list"})},Me=({id:t,listItems:a,title:u,tooltipContent:f,extraActionTitle:v,onExtraActionClick:g,children:m,initialIsOpen:S=!1})=>{const y=(()=>{const{euiTheme:t}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>{const a={padding:t.size.base};return{accordion:{borderTop:t.border.thin,"&:last-child":{borderBottom:t.border.thin},dl:{paddingTop:"0px"},"&:only-child":{border:t.border.thin,borderRadius:t.border.radius.medium}},accordionButton:{padding:t.size.base,fontWeight:t.font.weight.bold},tabSection:a}}),[t])})();return Object(q.jsx)(p.EuiAccordion,{id:t,arrowDisplay:"right",initialIsOpen:S,buttonContent:Object(q.jsx)(p.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,css:y.accordionButton},Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)("span",null,u)),f&&Object(q.jsx)(p.EuiFlexItem,{grow:!1,"data-test-subj":"sessionView:detail-panel-accordion-tooltip"},Object(q.jsx)(p.EuiIconTip,{content:f}))),css:y.accordion,"data-test-subj":"sessionView:detail-panel-accordion"},Object(q.jsx)(De,{listItems:a}),m)},Be=({children:t,copy:a,display:u="grid"})=>{const[f,v]=Object(_.useState)(!1),g=(({display:t})=>{const{euiTheme:a}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>{const u={display:t,alignContent:"center",padding:`${a.size.xs} ${a.size.s} `,width:"100%",fontWeight:"inherit",height:"max-content",minHeight:a.size.l,letterSpacing:"0px",textAlign:"left","& .euiToolTipAnchor":{width:`calc(100% - ${a.size.xl})`,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}};return{item:u,copiableItem:{...u,position:"relative",borderRadius:a.border.radius.medium,"&:hover":{background:Object(p.transparentize)(a.colors.primary,.1)},height:"fit-content"}}}),[t,a])})({display:u}),m={size:"s",css:a?g.copiableItem:g.item};return a&&(m.onMouseEnter=()=>v(!0),m.onMouseLeave=()=>v(!1)),Object(q.jsx)(p.EuiText,le()({},m,{"data-test-subj":"sessionView:detail-panel-list-item"}),t,f&&a)},Ie=({children:t,textToCopy:a,tooltipContent:u,display:v="inlineBlock"})=>{const g=(()=>{const{euiTheme:t}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>({copyButton:{position:"absolute",right:t.size.s,top:0,bottom:0,margin:"auto"}})),[t])})(),m={copy:Object(q.jsx)(p.EuiCopy,{textToCopy:a,display:v},(t=>Object(q.jsx)(p.EuiButtonIcon,{css:g.copyButton,onClick:t,display:"base",iconType:"copyClipboard",size:"xs","aria-label":k.i18n.translate("xpack.sessionView.detailPanelCopy.copyButton",{defaultMessage:"Copy"})})))};return"block"===v&&(m.display=v),Object(q.jsx)(Be,m,Object(q.jsx)(p.EuiToolTip,{position:"top",content:u},Object(q.jsx)(f.a.Fragment,null,t)))},Pe=[M.a.fork,M.a.exec],He={id:A,name:A,start:A,end:A,exitCode:A,userName:A,groupName:A,workingDirectory:A,interactive:A,args:A,pid:A,entryMetaType:A,entryMetaSourceIp:A,executable:[[A]]},Fe=t=>{try{return t.map((t=>{const[a,u]=t;if(!a||!u||2!==t.length)throw new Error;return`${a} ${u}`})).join(", ")}catch(t){return""}},$e=t=>t&&t.length&&t.map?`[${t.map((t=>`'${t}'`)).join(", ")}]`:A,ze=t=>t?"True":"False",Ne=t=>{var a,u,_,f,p,v,g,m,S,y,w,x,E,j,k,T,L,A,R;return{...t,id:null!==(a=null==t?void 0:t.entity_id)&&void 0!==a?a:He.id,name:null!==(u=null==t?void 0:t.name)&&void 0!==u?u:He.name,start:null!==(_=null==t?void 0:t.start)&&void 0!==_?_:He.start,end:null!==(f=null==t?void 0:t.end)&&void 0!==f?f:He.end,exitCode:null!==(p=null==t||null===(v=t.exit_code)||void 0===v?void 0:v.toString())&&void 0!==p?p:He.exitCode,interactive:ze(null==t?void 0:t.tty),userName:null!==(g=null==t||null===(m=t.user)||void 0===m?void 0:m.name)&&void 0!==g?g:He.userName,groupName:null!==(S=null==t||null===(y=t.group)||void 0===y?void 0:y.name)&&void 0!==S?S:He.groupName,workingDirectory:null!==(w=null==t?void 0:t.working_directory)&&void 0!==w?w:He.workingDirectory,args:null!==(x=$e(null==t?void 0:t.args))&&void 0!==x?x:He.args,pid:null!==(E=null==t||null===(j=t.pid)||void 0===j?void 0:j.toString())&&void 0!==E?E:He.pid,executable:null!=t&&t.executable?[[null==t?void 0:t.executable]]:He.executable,entryMetaType:null!==(k=null==t||null===(T=t.entry_meta)||void 0===T?void 0:T.type)&&void 0!==k?k:He.entryMetaType,entryMetaSourceIp:null!==(L=null==t||null===(A=t.entry_meta)||void 0===A||null===(R=A.source)||void 0===R?void 0:R.ip)&&void 0!==L?L:He.entryMetaSourceIp}},We=()=>{const{euiTheme:t}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>({descriptionSemibold:{fontWeight:t.font.weight.medium},executableAction:{fontWeight:t.font.weight.semiBold,paddingLeft:t.size.xs},ellipsis:{overflow:"hidden",textOverflow:"ellipsis"}})),[t])},Ve=[{id:"processEntryLeader",title:"Entry Leader",tooltipContent:k.i18n.translate("xpack.sessionView.detailPanel.entryLeaderTooltip",{defaultMessage:"Session leader process associated with initial terminal or remote access via SSH, SSM and other remote access protocols. Entry sessions are also used to represent a service directly started by the init process. In many cases this is the same as the session_leader."})},{id:"processSessionLeader",title:"Session Leader",tooltipContent:k.i18n.translate("xpack.sessionView.detailPanel.sessionLeaderTooltip",{defaultMessage:"Often the same as entry_leader. When it differs, this represents a session started within another session. Some tools like tmux and screen will start a new session to obtain a new tty and/or separate their lifecycle from the entry session."})},{id:"processGroupLeader",title:"Group Leader",tooltipContent:k.i18n.translate("xpack.sessionView.detailPanel.processGroupLeaderTooltip",{defaultMessage:"The process group leader to the current process."})},{id:"processParent",title:"Parent",tooltipContent:k.i18n.translate("xpack.sessionView.detailPanel.processParentTooltip",{defaultMessage:"The direct parent to the current process."})}],Ue=["process.entry_leader","process.session_leader","process.group_leader","process.parent"],Ke=({selectedProcess:t})=>{const a=We(),u=Object(_.useMemo)((()=>(t=>{var a,u,_,f,p,v,g,m,S,y,w,x,E,j;const k={id:He.id,start:He.start,end:He.end,exitCode:He.exitCode,interactive:He.interactive,userName:He.userName,groupName:He.groupName,args:He.args,pid:He.pid,executable:He.executable,workingDirectory:He.workingDirectory,entryLeader:He,sessionLeader:He,groupLeader:He,parent:He};if(!t)return k;const T=t.getDetails();if(k.id=`${R(t.id)}`,k.start=`${R(null===(a=T.process)||void 0===a?void 0:a.start)}`,k.end=`${R(t.getEndTime())}`,k.exitCode=`${R(null===(u=T.process)||void 0===u?void 0:u.exit_code)}`,k.interactive=ze(null===(_=T.process)||void 0===_?void 0:_.tty),k.userName=`${R(null===(f=T.process)||void 0===f||null===(p=f.user)||void 0===p?void 0:p.name)}`,k.groupName=`${R(null===(v=T.process)||void 0===v||null===(g=v.group)||void 0===g?void 0:g.name)}`,k.pid=`${R(null===(m=T.process)||void 0===m?void 0:m.pid)}`,k.workingDirectory=`${R(null===(S=T.process)||void 0===S?void 0:S.working_directory)}`,null!==(y=T.process)&&void 0!==y&&y.args&&(k.args=$e(T.process.args)),k.executable=[],t.events.forEach((t=>{var a,u;null!==(a=t.process)&&void 0!==a&&a.executable&&null!==(u=t.event)&&void 0!==u&&u.action&&Pe.includes(t.event.action)&&k.executable.push([t.process.executable,`(${t.event.action})`])})),!k.executable.length){var L;const a=null===(L=t.getDetails().process)||void 0===L?void 0:L.executable;a?k.executable.push([a]):k.executable=He.executable}return k.entryLeader=Ne(null==T||null===(w=T.process)||void 0===w?void 0:w.entry_leader),k.sessionLeader=Ne(null==T||null===(x=T.process)||void 0===x?void 0:x.session_leader),k.groupLeader=Ne(null==T||null===(E=T.process)||void 0===E?void 0:E.group_leader),k.parent=Ne(null==T||null===(j=T.process)||void 0===j?void 0:j.parent),k})(t)),[t]),v=Object(_.useCallback)((t=>t.map(((t,u)=>{const[_,f]=t;return Object(q.jsx)("div",{key:`executable-${u}`,css:a.ellipsis},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},_),f&&Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.executableAction},f))}))),[a.descriptionSemibold,a.ellipsis,a.executableAction]),g=[u.entryLeader,u.sessionLeader,u.groupLeader,u.parent].map(((t,u)=>{const{id:_,start:f,end:g,exitCode:m,entryMetaType:S,interactive:y,workingDirectory:w,args:x,executable:E,pid:j,userName:k,groupName:T,entryMetaSourceIp:L}=t,A=Fe(E),D=[{title:Object(q.jsx)(Be,null,"entity_id"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.entity_id: "${_}"`,tooltipContent:_},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},_))},{title:Object(q.jsx)(Be,null,"args"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.args: "${x}"`,tooltipContent:x},x)},{title:Object(q.jsx)(Be,null,"executable"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.executable: "${A}"`,tooltipContent:A},v(E))},{title:Object(q.jsx)(Be,null,"interactive"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.interactive: "${y}"`,tooltipContent:y},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},y))},{title:Object(q.jsx)(Be,null,"working_directory"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.working_directory: "${w}"`,tooltipContent:w},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},w))},{title:Object(q.jsx)(Be,null,"pid"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.pid: "${j}"`,tooltipContent:j},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},j))},{title:Object(q.jsx)(Be,null,"start"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.start: "${f}"`,tooltipContent:f},f)},{title:Object(q.jsx)(Be,null,"end"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.end: "${g}"`,tooltipContent:g},g)},{title:Object(q.jsx)(Be,null,"exit_code"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.exit_code: "${m}"`,tooltipContent:m},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},m))},{title:Object(q.jsx)(Be,null,"user.name"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.user.name: "${k}"`,tooltipContent:k},k)},{title:Object(q.jsx)(Be,null,"group.name"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.group.name: "${T}"`,tooltipContent:T},T)}];return 0===u&&D.push({title:Object(q.jsx)(Be,null,"entry_meta.type"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.entry_meta.type: "${S}"`,tooltipContent:S},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},S))},{title:Object(q.jsx)(Be,null,"entry_meta.source.ip"),description:Object(q.jsx)(Ie,{textToCopy:`${Ue[u]}.entry_meta.source.ip: "${L}"`,tooltipContent:L},R(L))}),{...Ve[u],name:t.name,listItems:D}})),{id:m,start:S,end:y,executable:w,exitCode:x,pid:E,workingDirectory:j,interactive:k,userName:T,groupName:L,args:A}=u,D=Fe(w);return Object(q.jsx)(f.a.Fragment,null,Object(q.jsx)(De,{listItems:[{title:Object(q.jsx)(Be,null,"entity_id"),description:Object(q.jsx)(Ie,{textToCopy:`process.entity_id: "${m}"`,tooltipContent:m},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},m))},{title:Object(q.jsx)(Be,null,"args"),description:Object(q.jsx)(Ie,{textToCopy:`process.args: "${A}"`,tooltipContent:A},A)},{title:Object(q.jsx)(Be,null,"executable"),description:Object(q.jsx)(Ie,{textToCopy:`process.executable: "${D}"`,tooltipContent:D,display:"block"},v(w))},{title:Object(q.jsx)(Be,null,"interactive"),description:Object(q.jsx)(Ie,{textToCopy:`process.interactive: "${k}"`,tooltipContent:k},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},k))},{title:Object(q.jsx)(Be,null,"working_directory"),description:Object(q.jsx)(Ie,{textToCopy:`process.working_directory: "${j}"`,tooltipContent:j},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},j))},{title:Object(q.jsx)(Be,null,"pid"),description:Object(q.jsx)(Ie,{textToCopy:`process.pid: "${E}"`,tooltipContent:E},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},E))},{title:Object(q.jsx)(Be,null,"start"),description:Object(q.jsx)(Ie,{textToCopy:`process.start: "${S}"`,tooltipContent:S},S)},{title:Object(q.jsx)(Be,null,"end"),description:Object(q.jsx)(Ie,{textToCopy:`process.end: "${y}"`,tooltipContent:y},y)},{title:Object(q.jsx)(Be,null,"exit_code"),description:Object(q.jsx)(Ie,{textToCopy:`process.exit_code: "${x}"`,tooltipContent:x},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:a.descriptionSemibold},x))},{title:Object(q.jsx)(Be,null,"user.name"),description:Object(q.jsx)(Ie,{textToCopy:`process.user.name: "${T}"`,tooltipContent:T},T)},{title:Object(q.jsx)(Be,null,"group.name"),description:Object(q.jsx)(Ie,{textToCopy:`process.group.name: "${L}"`,tooltipContent:L},L)}]}),g.map((t=>Object(q.jsx)(Me,{key:t.id,id:t.id,title:t.title,tooltipContent:t.tooltipContent,listItems:t.listItems,extraActionTitle:t.name}))))},qe=({processHost:t,processContainer:a,processOrchestrator:u,processCloud:v})=>{const g=We(),m=(()=>{const{euiTheme:t}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>({metadataHostOS:{margin:`${t.size.m} ${t.size.base} ${t.size.base} ${t.size.base}`,paddingBottom:t.size.base}})),[t])})(),S=Object(_.useMemo)((()=>(t=>{var a,u,_,f,p,v,g,m,S,y,w,x;const E={architecture:A,hostname:A,id:A,ip:A,mac:A,name:A,os:{family:A,full:A,kernel:A,name:A,platform:A,version:A}};return t?(E.hostname=R(t.hostname).toString(),E.id=R(t.id).toString(),E.ip=null!==(a=null===(u=t.ip)||void 0===u||null===(_=u.map)||void 0===_?void 0:_.call(u,(t=>R(t))).join(", "))&&void 0!==a?a:A,E.mac=null!==(f=null===(p=t.mac)||void 0===p||null===(v=p.map)||void 0===v?void 0:v.call(p,(t=>R(t))).join(", "))&&void 0!==f?f:A,E.name=R(t.name).toString(),E.architecture=R(t.architecture).toString(),E.os.family=R(null===(g=t.os)||void 0===g?void 0:g.family).toString(),E.os.full=R(null===(m=t.os)||void 0===m?void 0:m.full).toString(),E.os.kernel=R(null===(S=t.os)||void 0===S?void 0:S.kernel).toString(),E.os.name=R(null===(y=t.os)||void 0===y?void 0:y.name).toString(),E.os.platform=R(null===(w=t.os)||void 0===w?void 0:w.platform).toString(),E.os.version=R(null===(x=t.os)||void 0===x?void 0:x.version).toString(),E):E})(t)),[t]),y=Object(_.useMemo)((()=>(t=>{var a,u,_,f;const p={id:A,name:A,image:{name:A,tag:A,hash:{all:A}}};return t?(p.id=R(t.id).toString(),p.name=R(t.name).toString(),p.image.name=R(null==t||null===(a=t.image)||void 0===a?void 0:a.name).toString(),p.image.tag=R(null==t||null===(u=t.image)||void 0===u?void 0:u.tag).toString(),p.image.hash.all=R(null==t||null===(_=t.image)||void 0===_||null===(f=_.hash)||void 0===f?void 0:f.all).toString(),p):p})(a)),[a]),w=Object(_.useMemo)((()=>(t=>{var a,u,_,f,p,v,g;const m={resource:{name:A,type:A,ip:A,parent:{type:A}},namespace:A,cluster:{name:A,id:A}};return t?(m.resource.name=R(null==t||null===(a=t.resource)||void 0===a?void 0:a.name).toString(),m.resource.type=R(null==t||null===(u=t.resource)||void 0===u?void 0:u.type).toString(),m.resource.ip=R(null==t||null===(_=t.resource)||void 0===_?void 0:_.ip).toString(),m.namespace=R(null==t?void 0:t.namespace).toString(),m.cluster.name=R(null==t||null===(f=t.cluster)||void 0===f?void 0:f.name).toString(),m.cluster.id=R(null==t||null===(p=t.cluster)||void 0===p?void 0:p.id).toString(),m.resource.parent.type=R(null==t||null===(v=t.resource)||void 0===v||null===(g=v.parent)||void 0===g?void 0:g.type).toString(),m):m})(u)),[u]),x=Object(_.useMemo)((()=>(t=>{var a,u,_;const f={instance:{name:A},account:{id:A},project:{id:A},provider:A,region:A};return t?(f.instance.name=R(null==t||null===(a=t.instance)||void 0===a?void 0:a.name).toString(),f.account.id=R(null==t||null===(u=t.account)||void 0===u?void 0:u.id).toString(),f.project.id=R(null==t||null===(_=t.project)||void 0===_?void 0:_.id).toString(),f.provider=R(null==t?void 0:t.provider).toString(),f.region=R(null==t?void 0:t.region).toString(),f):f})(v)),[v]);return Object(q.jsx)(f.a.Fragment,null,Object(q.jsx)(Me,{id:"metadataHost",title:k.i18n.translate("xpack.sessionView.metadataDetailsTab.metadata",{defaultMessage:"Metadata"}),initialIsOpen:!0,listItems:[{title:Object(q.jsx)(Be,null,"hostname"),description:Object(q.jsx)(Ie,{textToCopy:`host.hostname: "${S.hostname}"`,tooltipContent:S.hostname},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.hostname))},{title:Object(q.jsx)(Be,null,"id"),description:Object(q.jsx)(Ie,{textToCopy:`host.id: "${S.id}"`,tooltipContent:S.id},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.id))},{title:Object(q.jsx)(Be,null,"ip"),description:Object(q.jsx)(Ie,{textToCopy:`host.ip: "${S.ip}"`,tooltipContent:S.ip},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.ip))},{title:Object(q.jsx)(Be,null,"mac"),description:Object(q.jsx)(Ie,{textToCopy:`host.mac: "${S.mac}"`,tooltipContent:S.mac},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.mac))},{title:Object(q.jsx)(Be,null,"name"),description:Object(q.jsx)(Ie,{textToCopy:`host.name: "${S.name}"`,tooltipContent:S.name},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.name))}]},Object(q.jsx)(p.EuiPanel,{hasShadow:!1,color:"plain",hasBorder:!1,borderRadius:"m",paddingSize:"none",css:m.metadataHostOS},Object(q.jsx)(Me,{id:"hostOS",title:k.i18n.translate("xpack.sessionView.metadataDetailsTab.host",{defaultMessage:"Host OS"}),listItems:[{title:Object(q.jsx)(Be,null,"architecture"),description:Object(q.jsx)(Ie,{textToCopy:`host.architecture: "${S.architecture}"`,tooltipContent:S.architecture},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.architecture))},{title:Object(q.jsx)(Be,null,"os.family"),description:Object(q.jsx)(Ie,{textToCopy:`host.os.family: "${S.os.family}"`,tooltipContent:S.os.family},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.os.family))},{title:Object(q.jsx)(Be,null,"os.full"),description:Object(q.jsx)(Ie,{textToCopy:`host.os.full: "${S.os.full}"`,tooltipContent:S.os.full},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.os.full))},{title:Object(q.jsx)(Be,null,"os.kernel"),description:Object(q.jsx)(Ie,{textToCopy:`host.os.kernel: "${S.os.kernel}"`,tooltipContent:S.os.kernel},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.os.kernel))},{title:Object(q.jsx)(Be,null,"os.name"),description:Object(q.jsx)(Ie,{textToCopy:`host.os.name: "${S.os.name}"`,tooltipContent:S.os.name},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.os.name))},{title:Object(q.jsx)(Be,null,"os.platform"),description:Object(q.jsx)(Ie,{textToCopy:`host.os.platform: "${S.os.platform}"`,tooltipContent:S.os.platform},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.os.platform))},{title:Object(q.jsx)(Be,null,"os.version"),description:Object(q.jsx)(Ie,{textToCopy:`host.os.version: "${S.os.version}"`,tooltipContent:S.os.version},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},S.os.version))}]}))),v&&Object(q.jsx)(f.a.Fragment,null,Object(q.jsx)(Me,{id:"metadataCloud",title:k.i18n.translate("xpack.sessionView.metadataDetailsTab.cloud",{defaultMessage:"Cloud"}),listItems:[{title:Object(q.jsx)(Be,null,"instance.name"),description:Object(q.jsx)(Ie,{textToCopy:`cloud.provider: "${x.instance.name}"`,tooltipContent:x.instance.name},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},x.instance.name))},{title:Object(q.jsx)(Be,null,"provider"),description:Object(q.jsx)(Ie,{textToCopy:`cloud.provider: "${x.provider}"`,tooltipContent:x.provider},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},x.provider))},{title:Object(q.jsx)(Be,null,"region"),description:Object(q.jsx)(Ie,{textToCopy:`cloud.region: "${x.region}"`,tooltipContent:x.region},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},x.region))},{title:Object(q.jsx)(Be,null,"account.id"),description:Object(q.jsx)(Ie,{textToCopy:`cloud.account.id: "${x.account.id}"`,tooltipContent:x.account.id},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},x.account.id))},{title:Object(q.jsx)(Be,null,"project.id"),description:Object(q.jsx)(Ie,{textToCopy:`cloud.project.id: "${x.project.id}"`,tooltipContent:x.project.id},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},x.project.id))}]})),a&&Object(q.jsx)(f.a.Fragment,null,Object(q.jsx)(Me,{id:"metadataContainer",title:k.i18n.translate("xpack.sessionView.metadataDetailsTab.container",{defaultMessage:"Container"}),listItems:[{title:Object(q.jsx)(Be,null,"id"),description:Object(q.jsx)(Ie,{textToCopy:`container.id: "${y.id}"`,tooltipContent:y.id},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},y.id))},{title:Object(q.jsx)(Be,null,"name"),description:Object(q.jsx)(Ie,{textToCopy:`container.name: "${y.name}"`,tooltipContent:y.name},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},y.name))},{title:Object(q.jsx)(Be,null,"image.name"),description:Object(q.jsx)(Ie,{textToCopy:`container.image.name: "${y.image.name}"`,tooltipContent:y.image.name},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},y.image.name))},{title:Object(q.jsx)(Be,null,"image.tag"),description:Object(q.jsx)(Ie,{textToCopy:`container.image.tag: "${y.image.tag}"`,tooltipContent:y.image.tag},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},y.image.tag))},{title:Object(q.jsx)(Be,null,"image.hash.all"),description:Object(q.jsx)(Ie,{textToCopy:`container.image.hash.all: "${y.image.hash.all}"`,tooltipContent:y.image.hash.all},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},y.image.hash.all))}]})),u&&Object(q.jsx)(f.a.Fragment,null,Object(q.jsx)(Me,{id:"metadataOrchestrator",title:k.i18n.translate("xpack.sessionView.metadataDetailsTab.orchestrator",{defaultMessage:"Orchestrator"}),listItems:[{title:Object(q.jsx)(Be,null,"resource.ip"),description:Object(q.jsx)(Ie,{textToCopy:`orchestrator.resource.ip: "${w.resource.ip}"`,tooltipContent:w.resource.ip},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},w.resource.ip))},{title:Object(q.jsx)(Be,null,"resource.name"),description:Object(q.jsx)(Ie,{textToCopy:`orchestrator.resource.name: "${w.resource.name}"`,tooltipContent:w.resource.name},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},w.resource.name))},{title:Object(q.jsx)(Be,null,"resource.type"),description:Object(q.jsx)(Ie,{textToCopy:`orchestrator.resource.type: "${w.resource.type}"`,tooltipContent:w.resource.type},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},w.resource.type))},{title:Object(q.jsx)(Be,null,"resource.parent.type"),description:Object(q.jsx)(Ie,{textToCopy:`orchestrator.resource.parent.type: "${w.resource.parent.type}"`,tooltipContent:w.resource.parent.type},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},w.resource.parent.type))},{title:Object(q.jsx)(Be,null,"namespace"),description:Object(q.jsx)(Ie,{textToCopy:`orchestrator.namespace: "${w.namespace}"`,tooltipContent:w.namespace},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},w.namespace))},{title:Object(q.jsx)(Be,null,"cluster.id"),description:Object(q.jsx)(Ie,{textToCopy:`orchestrator.cluster.id: "${w.cluster.id}"`,tooltipContent:w.cluster.id},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},w.cluster.id))},{title:Object(q.jsx)(Be,null,"cluster.name"),description:Object(q.jsx)(Ie,{textToCopy:`orchestrator.cluster.name: "${w.cluster.name}"`,tooltipContent:w.cluster.name},Object(q.jsx)(p.EuiTextColor,{color:"subdued",css:g.descriptionSemibold},w.cluster.name))}]})))},Ge=(t=!1,a=!1)=>{const{euiTheme:u}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>{const{colors:_,font:f,size:v,border:g}=u,m=Object(p.transparentize)(_.danger,.2),S=Object(p.transparentize)(_.danger,.08),y=g.width.thin,w=v.m;let x=_.text,E=_.lightShade;a&&(x=_.primaryText,E=m);const j=Object(q.css)("border:",y," solid ",E,";padding:",w,";border-radius:",g.radius.medium,";margin:0 ",w," ",w," ",w,";background-color:",_.emptyShade,";& .euiAccordion__buttonContent{width:100%;}& .euiAccordion__button{min-width:0;width:calc(100% - ",v.l,");}& .euiAccordion__childWrapper{overflow:visible;}","");return{alertItem:j,alertGroupItem:Object(q.css)(j," & .euiAccordion__childWrapper{overflow:hidden;}",""),alertTitleContainer:{display:t?"none":"initial",color:x,fontWeight:f.weight.semiBold},alertTitle:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},alertIcon:{marginRight:v.s},alertAccordionButton:{width:`calc(100% - ${v.l})`,minWidth:0},alertCountArrowPad:{marginRight:v.xs},processPanel:{border:`${y} solid ${_.lightShade}`,fontFamily:f.familyCode,marginTop:t?v.s:v.m,padding:`${v.xs} ${v.s}`},investigatedLabel:{position:"relative",zIndex:1,bottom:`-${w}`,left:`-${w}`,width:`calc(100% + ${w} * 2)`,borderTop:`${y} solid ${m}`,borderBottomLeftRadius:g.radius.medium,borderBottomRightRadius:g.radius.medium,backgroundColor:S,textAlign:"center"},minimalContextMenu:{float:"right"},firstAlertPad:{"&:first-child":{paddingTop:v.base}},minimalHR:{marginBottom:0}}}),[u,a,t])},Ye=({event:t,onShowAlertDetails:a,onJumpToEvent:u})=>{var f,g,m;const[S,y]=Object(_.useState)(!1),w=Object(_.useCallback)((()=>{y(!1)}),[]),x=Object(_.useCallback)((()=>{y(!S)}),[S]),E=Object(_.useCallback)((()=>{u(t),y(!1)}),[t,u]),j=Object(_.useCallback)((()=>{var u,_;null!==(u=t.kibana)&&void 0!==u&&null!==(_=u.alert)&&void 0!==_&&_.uuid&&(a(t.kibana.alert.uuid),y(!1))}),[t,a]);if(!t.kibana)return null;const T=null!==(f=null===(g=t.kibana)||void 0===g||null===(m=g.alert)||void 0===m?void 0:m.uuid)&&void 0!==f?f:"",L=[Object(q.jsx)(p.EuiContextMenuItem,{key:"details","data-test-subj":"sessionView:detailPanelAlertActionShowDetails",onClick:j},Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertListItem.showDetailsAction",defaultMessage:"View alert details"})),Object(q.jsx)(p.EuiContextMenuItem,{key:"jumpTo","data-test-subj":"sessionView:detailPanelAlertActionJumpToProcess",onClick:E},Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertListItem.jumpToAlert",defaultMessage:"Jump to alerted process"}))];return Object(q.jsx)(p.EuiPopover,{id:T,button:Object(q.jsx)(p.EuiButtonIcon,{display:"empty",size:"s",iconType:"boxesHorizontal","aria-label":k.i18n.translate("xpack.sessionView.detailPanelAlertListItem.moreButton",{defaultMessage:"More"}),"data-test-subj":"sessionView:detailPanelAlertActionsBtn",onClick:x}),isOpen:S,closePopover:w,panelPaddingSize:"none",anchorPosition:"leftCenter"},Object(q.jsx)(p.EuiContextMenuPanel,{size:"s",items:L}))},Je="sessionView:detailPanelAlertListItem",Xe="sessionView:detailPanelAlertListItemArgs",Ze=({event:t,onJumpToEvent:a,onShowAlertDetails:u,isInvestigated:_,minimal:f})=>{var g,m,S,y;const w=Ge(f,_),x=$();if(!t.kibana)return null;const E=Object(p.formatDate)(t["@timestamp"],x),j=null===(g=t.kibana)||void 0===g||null===(m=g.alert)||void 0===m?void 0:m.rule,k=(null==j?void 0:j.uuid)||"",T=(null==j?void 0:j.name)||"",{args:L,name:A}=null!==(S=t.process)&&void 0!==S?S:{},{event:B}=t,I=_?void 0:"open",P=null==B||null===(y=B.category)||void 0===y?void 0:y[0],H=null!=P?P:M.c.process,F=P!==M.c.process?`${R(A)} ${z(t,P)}`:R(null==L?void 0:L.join(" ")),N=K(H);return f?Object(q.jsx)("div",{"data-test-subj":Je,css:w.firstAlertPad},Object(q.jsx)(p.EuiSpacer,{size:"xs"}),Object(q.jsx)(p.EuiFlexGroup,{alignItems:"center"},Object(q.jsx)(p.EuiFlexItem,null,Object(q.jsx)(p.EuiText,{color:"subdued",size:"s"},R(E))),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(Ye,{css:w.minimalContextMenu,event:t,onJumpToEvent:a,onShowAlertDetails:u}))),Object(q.jsx)(p.EuiPanel,{css:w.processPanel,color:"subdued",hasBorder:!0,hasShadow:!1,borderRadius:"m"},Object(q.jsx)(p.EuiText,{"data-test-subj":Xe,size:"xs"},F)),Object(q.jsx)(p.EuiHorizontalRule,{css:w.minimalHR,margin:"m",size:"full"})):Object(q.jsx)(p.EuiAccordion,{id:k,"data-test-subj":Je,arrowDisplay:_?"right":"none",buttonContent:Object(q.jsx)(p.EuiText,{css:w.alertTitleContainer,size:"s"},Object(q.jsx)("p",{css:w.alertTitle},Object(q.jsx)(p.EuiToolTip,{position:"top",content:N},Object(q.jsx)(p.EuiIcon,{color:"danger",type:D.d[H],css:w.alertIcon})),R(T))),initialIsOpen:!0,forceState:I,css:w.alertItem,extraAction:Object(q.jsx)(Ye,{event:t,onJumpToEvent:a,onShowAlertDetails:u})},Object(q.jsx)(p.EuiSpacer,{size:"xs"}),Object(q.jsx)(p.EuiText,{"data-test-subj":"sessionView:detailPanelAlertListItemTimestamp",color:"subdued",size:"s"},R(E)),Object(q.jsx)(p.EuiPanel,{css:w.processPanel,color:"subdued",hasBorder:!0,hasShadow:!1,borderRadius:"m"},Object(q.jsx)(p.EuiText,{"data-test-subj":Xe,size:"xs"},F)),_&&Object(q.jsx)("div",{css:w.investigatedLabel},Object(q.jsx)(p.EuiText,{size:"xs",color:"danger"},Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertListItem.investigatedLabel",defaultMessage:"Investigated alert"}))))},Qe=({alerts:t,onJumpToEvent:a,onShowAlertDetails:u})=>{var _,f,v,g;const m=Ge(),S=t.length.toLocaleString();if(!t[0].kibana)return null;const{rule:y}=null!==(_=null===(f=t[0])||void 0===f||null===(v=f.kibana)||void 0===v?void 0:v.alert)&&void 0!==_?_:{};return Object(q.jsx)(p.EuiAccordion,{id:null!==(g=null==y?void 0:y.uuid)&&void 0!==g?g:"","data-test-subj":"sessionView:detailPanelAlertGroupItem",arrowDisplay:"right",initialIsOpen:!1,buttonContent:Object(q.jsx)(p.EuiText,{"data-test-subj":"sessionView:detailPanelAlertGroupTitle",css:m.alertTitleContainer,size:"s"},Object(q.jsx)("p",{css:m.alertTitle},Object(q.jsx)(p.EuiIcon,{color:"danger",type:"alert",css:m.alertIcon}),R(null==y?void 0:y.name))),css:m.alertGroupItem,extraAction:Object(q.jsx)(p.EuiNotificationBadge,{"data-test-subj":"sessionView:detailPanelAlertGroupCount",className:"eui-alignCenter",size:"m",css:m.alertCountArrowPad},S)},t.map((t=>{var _,f;const p="minimal_"+(null===(_=t.kibana)||void 0===_||null===(f=_.alert)||void 0===f?void 0:f.uuid);return Object(q.jsx)(Ze,{key:p,minimal:!0,event:t,onJumpToEvent:a,onShowAlertDetails:u})})))},et="listView",tt=({alerts:t,isFetchingAlerts:a,hasNextPageAlerts:u,fetchNextPageAlerts:f,onJumpToEvent:g,onShowAlertDetails:m,investigatedAlertId:S})=>{const y=(()=>{const{euiTheme:t}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>{const{colors:a,size:u}=t;return{container:{position:"relative"},stickyItem:{position:"sticky",top:0,zIndex:1,backgroundColor:a.emptyShade},viewMode:{margin:u.base},loadMoreBtn:{margin:u.m,width:`calc(100% - ${u.m} * 2)`}}}),[t])})(),[w,x]=Object(_.useState)(et),E=[{id:et,label:k.i18n.translate("xpack.sessionView.alertDetailsTab.listView",{defaultMessage:"List view"})},{id:"groupView",label:k.i18n.translate("xpack.sessionView.alertDetailsTab.groupView",{defaultMessage:"Group view"})}],j=Object(_.useMemo)((()=>S&&t.find((t=>{var a,u;return(null===(a=t.kibana)||void 0===a||null===(u=a.alert)||void 0===u?void 0:u.uuid)===S}))),[S,t]),L=Object(_.useMemo)((()=>Object(T.groupBy)(t,(t=>{var a,u,_;return null===(a=t.kibana)||void 0===a||null===(u=a.alert)||void 0===u||null===(_=u.rule)||void 0===_?void 0:_.uuid}))),[t]);return 0===t.length?Object(q.jsx)(p.EuiEmptyPrompt,{"data-test-subj":"sessionView:detailPanelAlertsEmptyState",title:Object(q.jsx)("h2",null,Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertsEmptyTitle",defaultMessage:"No alerts"})),body:Object(q.jsx)("p",null,Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertsEmptyMsg",defaultMessage:"No alerts were created for this session."}))}):Object(q.jsx)("div",{css:y.container},Object(q.jsx)(p.EuiButtonGroup,{"data-test-subj":"sessionView:detailPanelAlertsViewMode",css:y.viewMode,legend:k.i18n.translate("xpack.sessionView.alertDetailsTab.toggleViewMode",{defaultMessage:"Toggle view mode"}),options:E,idSelected:w,onChange:x,buttonSize:"compressed",isFullWidth:!0}),j&&Object(q.jsx)("div",{css:y.stickyItem,"data-test-subj":"sessionView:detailPanelInvestigatedAlert"},Object(q.jsx)(Ze,{event:j,onJumpToEvent:g,onShowAlertDetails:m,isInvestigated:!0}),Object(q.jsx)(p.EuiHorizontalRule,{margin:"m",size:"full"})),w===et?t.map((t=>{var a,u;const _=null===(a=t.kibana)||void 0===a||null===(u=a.alert)||void 0===u?void 0:u.uuid;if(_&&t!==j)return Object(q.jsx)(Ze,{key:_,event:t,onJumpToEvent:g,onShowAlertDetails:m})})):Object.keys(L).map((t=>{var a,u,_;const f=L[t],p=null===(a=f[0].kibana)||void 0===a||null===(u=a.alert)||void 0===u||null===(_=u.rule)||void 0===_?void 0:_.uuid;if(p)return Object(q.jsx)(Qe,{key:p,alerts:f,onJumpToEvent:g,onShowAlertDetails:m})})),u&&Object(q.jsx)(p.EuiButton,{color:"primary",isLoading:a,onClick:f,css:y.loadMoreBtn,"data-test-subj":"alerts-details-load-more"},Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.alertsLoadMoreButton",defaultMessage:"Load more alerts"})))},it=({alerts:t,alertsCount:a,isFetchingAlerts:u,hasNextPageAlerts:f,fetchNextPageAlerts:v,selectedProcess:g,investigatedAlertId:m,onJumpToEvent:S,onShowAlertDetails:y})=>{const[w,x]=Object(_.useState)("process"),E=Object(_.useMemo)((()=>a>=D.c?D.c+"+":a+""),[a]),j=Object(_.useMemo)((()=>{var a,_,w,x;const j=!(null==t||!t.length);return[{id:"process",name:k.i18n.translate("xpack.sessionView.detailsPanel.process",{defaultMessage:"Process"}),content:Object(q.jsx)(Ke,{selectedProcess:g})},{id:"metadata",name:k.i18n.translate("xpack.sessionView.detailsPanel.metadata",{defaultMessage:"Metadata"}),content:Object(q.jsx)(qe,{processHost:null==g||null===(a=g.getDetails())||void 0===a?void 0:a.host,processContainer:null==g||null===(_=g.getDetails())||void 0===_?void 0:_.container,processOrchestrator:null==g||null===(w=g.getDetails())||void 0===w?void 0:w.orchestrator,processCloud:null==g||null===(x=g.getDetails())||void 0===x?void 0:x.cloud})},{id:"alerts",name:k.i18n.translate("xpack.sessionView.detailsPanel.alerts",{defaultMessage:"Alerts"}),append:j&&Object(q.jsx)(p.EuiNotificationBadge,{className:"eui-alignCenter",size:"m"},E),content:t&&Object(q.jsx)(tt,{alerts:t,isFetchingAlerts:u,hasNextPageAlerts:f,fetchNextPageAlerts:v,onJumpToEvent:S,onShowAlertDetails:y,investigatedAlertId:m})}]}),[t,E,v,f,u,g,S,y,m]),T=Object(_.useCallback)((t=>{x(t)}),[]),L=Object(_.useMemo)((()=>((t,a)=>{const u=t.find((t=>t.id===a));return u?u.content:null})(j,w)),[j,w]),A=(()=>{const{euiTheme:t}=Object(p.useEuiTheme)();return Object(_.useMemo)((()=>{const{border:a}=t;return{detailsPanel:{borderLeft:a.thin,height:"100%"}}}),[t])})();return Object(q.jsx)("div",{css:A.detailsPanel},Object(q.jsx)(p.EuiTabs,{size:"l",expand:!0},j.map(((t,a)=>Object(q.jsx)(p.EuiTab,{key:a,onClick:()=>T(t.id),isSelected:t.id===w,disabled:t.disabled,prepend:t.prepend,append:t.append},t.name)))),L)},st={placeholder:k.i18n.translate("xpack.sessionView.searchBar.searchBarKeyPlaceholder",{defaultMessage:"Find..."})},rt=k.i18n.translate("xpack.sessionView.searchBar.searchBarNoResults",{defaultMessage:"No results"}),nt=({searchQuery:t,setSearchQuery:a,totalMatches:u,onPrevious:f,onNext:v})=>{const g=!!t&&0!==u,m=!!t&&0===u,S=(({hasSearchResults:t})=>{const{euiTheme:a,euiVars:u}=H();return Object(_.useMemo)((()=>{const _={position:"absolute",top:a.size.s,right:a.size.xxl,'button[data-test-subj="pagination-button-last"]':{display:"none"},'button[data-test-subj="pagination-button-first"]':{display:"none"}},f={position:"absolute",color:a.colors.subduedText,top:a.size.m,right:a.size.xxl};return{pagination:_,searchBar:{position:"relative",backgroundColor:u.euiFormBackgroundColor,input:{paddingRight:t?"200px":a.size.xxl}},noResults:f}}),[a,u,t])})({hasSearchResults:g}),[y,w]=Object(_.useState)(0),x=Object(_.useCallback)((t=>{w(t),t>y?v(t):f(t)}),[v,f,y]);return Object(q.jsx)("div",{"data-test-subj":"sessionView:searchBar",css:S.searchBar},Object(q.jsx)(p.EuiSearchBar,{query:t,onChange:({query:t})=>{w(0),a(t?t.text:"")},box:st}),m&&Object(q.jsx)("span",{css:S.noResults},rt),g&&Object(q.jsx)(p.EuiPagination,{"data-test-subj":"sessionView:searchPagination",css:S.pagination,pageCount:u,activePage:y,onPageClick:x,compressed:!0}))},ot="Timestamp",at="Verbose mode",lt=k.i18n.translate("xpack.sessionView.sessionViewToggle.sessionViewVerboseTipTitle",{defaultMessage:"Some results may be hidden"}),ct=k.i18n.translate("xpack.sessionView.sessionViewToggle.sessionViewVerboseTipContent",{defaultMessage:"For a complete set of results, turn on Verbose mode."}),ht=({onChange:t,displayOptions:a,showVerboseSearchTooltip:u})=>{const[f,g]=Object(_.useState)(!1),m=Object(_.useMemo)((()=>({selectable:{width:240}})),[]),S=Object(_.useRef)(null);Object(_.useEffect)((()=>{S.current&&setTimeout((()=>{S.current&&(S.current.onFocus(),setTimeout((()=>{S.current&&S.current.onBlur()}),5e3))}),3e3)}),[u]);const y=Object(_.useMemo)((()=>[{label:k.i18n.translate("xpack.sessionView.sessionViewToggle.sessionViewToggleOptionsTimestamp",{defaultMessage:"Timestamp"}),key:ot,checked:null!=a&&a.timestamp?"on":void 0},{label:k.i18n.translate("xpack.sessionView.sessionViewToggle.sessionViewToggleOptionsVerbosemode",{defaultMessage:"Verbose mode"}),key:at,checked:null!=a&&a.verboseMode?"on":void 0,append:Object(q.jsx)(p.EuiIconTip,{content:Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.sessionViewToggle.sessionViewToggleOptionsVerboseModeTooltips",defaultMessage:"Verbose mode displays all processes created in a session, including shell startup, shell completion, and forks caused by built-in commands"})})}]),[a]),w=Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiButtonIcon,{iconType:"eye",display:a.verboseMode||a.timestamp?"fill":"empty",onClick:()=>{g(!f)},size:"m","aria-label":"Session view display option","data-test-subj":"sessionView:sessionViewOptionButton"})),x=Object(q.jsx)(p.EuiPopover,{button:w,isOpen:f,closePopover:()=>{g(!1)}},Object(q.jsx)(p.EuiSelectable,{options:y,onChange:u=>{const _=u.reduce(((t,a)=>(a.key===ot?t.timestamp="on"===a.checked:a.key===at&&(t.verboseMode="on"===a.checked),t)),{...a});t(_)}},(t=>Object(q.jsx)("div",{css:m.selectable},Object(q.jsx)(p.EuiPopoverTitle,null,Object(q.jsx)(v.FormattedMessage,{defaultMessage:"Display options",id:"xpack.sessionView.sessionViewToggle.sessionViewToggleTitle"})),t))));return!f&&u?Object(q.jsx)(p.EuiToolTip,{ref:S,position:"bottom",title:lt,content:ct},x):x};var dt=u(32),ut=u.n(dt),_t=u(25),ft=u.n(_t);const pt=/^(\r\n|\r|\n|\n\r)/,vt=({lines:t,seekToLine:a,xTermSearchFn:u,setIsPlaying:f,searchQuery:p,setSearchQuery:v})=>{const[g,m]=Object(_.useState)(null),S=Object(_.useCallback)((_=>{if(_){f(!1);const u=t.indexOf(_.line);a(u)}const v=setTimeout((()=>u(p,(null==_?void 0:_.index)||0)),100);return()=>{clearTimeout(v)}}),[f,t,a,u,p]),y=Object(_.useMemo)((()=>{const a=[];if(p&&t.reduce(((t,a)=>{if(a.value){const u=a.value.match(/^\x1b\[\d+;(\d+)(H|d)/),_=new RegExp(p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),f=ft()(a.value).replace(pt,"").matchAll(_);if(f)for(const _ of f){let f=0;u&&(f=parseInt(u[1],10)-3),t.push({line:a,match:_[0],index:f+(_.index||0)})}}return t}),a),a.length>0){const t=a[0];m(t),S(t)}else m(null),u("",0);return a}),[p,t,S,u]),w=Object(_.useCallback)((t=>{f(!1),v(t),m(null)}),[f,v]),x=Object(_.useCallback)((t=>{const a=y[t];a&&g!==a&&(m(a),S(a))}),[S,g,y]);return Object(q.jsx)(nt,{searchQuery:p,setSearchQuery:w,totalMatches:y.length,onNext:x,onPrevious:x})},gt=k.i18n.translate("xpack.sessionView.zoomIn",{defaultMessage:"Zoom in"}),mt=k.i18n.translate("xpack.sessionView.zoomFit",{defaultMessage:"Fit screen"}),bt=k.i18n.translate("xpack.sessionView.zoomOut",{defaultMessage:"Zoom out"}),St={display:"empty",size:"s",color:"ghost"},Ct=({tty:t,containerHeight:a,fontSize:u,isFullscreen:f,onFontSizeChanged:v})=>{const g=(()=>{const{euiTheme:t}=H();return Object(_.useMemo)((()=>{const{size:a,colors:u,border:_}=t;return{ratio:{fontSize:a.m,color:u.ghost},separator:{background:u.lightShade,height:a.xl,width:_.width.thin}}}),[t])})(),[m,S]=Object(_.useState)(!1),y=Object(_.useCallback)((()=>{S(!1),v(Math.max(2,u-1))}),[u,v]),w=Object(_.useCallback)((()=>{S(!1),v(Math.min(20,u+1))}),[u,v]);Object(_.useEffect)((()=>{if(m&&null!=t&&t.rows&&a){const _=1.3*D.i,f=t.rows*_,p=Math.floor(D.i*(a/f));p!==u&&v(p)}}),[f,a,m,u,v,null==t?void 0:t.rows]);const x=Object(_.useCallback)((()=>{const t=!m;S(t),t||v(D.i)}),[m,S,v]);return Object(q.jsx)(p.EuiFlexGroup,{"data-test-subj":"sessionView:TTYTextSizer",alignItems:"center",gutterSize:"s",direction:"row"},Object(q.jsx)(p.EuiFlexItem,null,Object(q.jsx)("div",{css:g.separator})),Object(q.jsx)(p.EuiFlexItem,null,Object(q.jsx)(p.EuiToolTip,{content:mt},Object(q.jsx)(p.EuiButtonIcon,{"data-test-subj":"sessionView:TTYZoomFit","aria-label":mt,display:m?"fill":"empty",iconType:m?"expand":"minimize",onClick:x,size:"s",color:"ghost"}))),Object(q.jsx)(p.EuiFlexItem,null,Object(q.jsx)("div",{css:g.separator})),Object(q.jsx)(p.EuiFlexItem,null,Object(q.jsx)(p.EuiToolTip,{content:bt},Object(q.jsx)(p.EuiButtonIcon,le()({"data-test-subj":"sessionView:TTYZoomOut","aria-label":bt,iconType:"minusInCircle",onClick:y},St)))),Object(q.jsx)(p.EuiFlexItem,{component:"span",css:g.ratio},`${Math.round(u/D.i*100)}%`),Object(q.jsx)(p.EuiFlexItem,null,Object(q.jsx)(p.EuiToolTip,{content:gt},Object(q.jsx)(p.EuiButtonIcon,le()({"data-test-subj":"sessionView:TTYZoomIn","aria-label":gt,iconType:"plusInCircle",onClick:w},St)))))};var yt={name:"1r5gb7q",styles:"display:inline-block"},wt=u(27),xt=(u(28),u(2));class xterm_search_SearchAddon{constructor(){be()(this,"_terminal",void 0),be()(this,"_linesCache",void 0),be()(this,"_linesCacheTimeoutId",0),be()(this,"_cursorMoveListener",void 0),be()(this,"_resizeListener",void 0)}activate(t){this._terminal=t}dispose(){}findNext(t,a){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!t||0===t.length)return this._terminal.clearSelection(),!1;let u,_=0,f=0;if(this._terminal.hasSelection()){const t=!!a&&a.incremental;u=this._terminal.getSelectionPosition(),f=t?u.start.y:u.end.y,_=t?u.start.x:u.end.x}null!=a&&a.lastLineOnly&&(f=this._terminal.buffer.active.cursorY,_=(null==a?void 0:a.startCol)||0),this._initLinesCache();const p={startRow:f,startCol:_};let v=this._findInLine(t,p,a);if(!v)for(let u=f+1;u<this._terminal.buffer.active.baseY+this._terminal.rows&&(p.startRow=u,p.startCol=0,v=this._findInLine(t,p,a),!v);u++);if(!v&&0!==f)for(let u=0;u<f&&(p.startRow=u,p.startCol=0,v=this._findInLine(t,p,a),!v);u++);return!v&&u&&(p.startRow=u.start.y,p.startCol=0,v=this._findInLine(t,p,a)),this._selectResult(v)}findPrevious(t,a){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!t||0===t.length)return this._terminal.clearSelection(),!1;const u=!0;let _,f=this._terminal.buffer.active.baseY+this._terminal.rows,p=this._terminal.cols;const v=!!a&&a.incremental;let g;this._terminal.hasSelection()?(g=this._terminal.getSelectionPosition(),f=g.start.y,p=g.start.x):null!=a&&a.lastLineOnly&&(f=this._terminal.buffer.active.cursorY-1,p=this._terminal.cols),this._initLinesCache();const m={startRow:f,startCol:p};if(v?(_=this._findInLine(t,m,a,!1),_&&_.row===f&&_.col===p||(g&&(m.startRow=g.end.y,m.startCol=g.end.x),_=this._findInLine(t,m,a,!0))):_=this._findInLine(t,m,a,u),!_){m.startCol=Math.max(m.startCol,this._terminal.cols);for(let p=f-1;p>=0&&(m.startRow=p,_=this._findInLine(t,m,a,u),!_);p--);}if(!_&&f!==this._terminal.buffer.active.baseY+this._terminal.rows)for(let p=this._terminal.buffer.active.baseY+this._terminal.rows;p>=f&&(m.startRow=p,_=this._findInLine(t,m,a,u),!_);p--);return!(_||!g)||this._selectResult(_)}_initLinesCache(){const t=this._terminal;this._linesCache||(this._linesCache=new Array(t.buffer.active.length),this._cursorMoveListener=t.onCursorMove((()=>this._destroyLinesCache())),this._resizeListener=t.onResize((()=>this._destroyLinesCache()))),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout((()=>this._destroyLinesCache()),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._cursorMoveListener&&(this._cursorMoveListener.dispose(),this._cursorMoveListener=void 0),this._resizeListener&&(this._resizeListener.dispose(),this._resizeListener=void 0),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_findInLine(t,a,u={},_=!1){var f;const p=this._terminal,v=a.startRow,g=a.startCol,m=p.buffer.active.getLine(v);if(null!=m&&m.isWrapped)return _?void(a.startCol+=p.cols):(a.startRow--,a.startCol+=p.cols,this._findInLine(t,a,u));let S=null===(f=this._linesCache)||void 0===f?void 0:f[v];S||(S=this._translateBufferLineToStringWithWrap(v,!0),this._linesCache&&(this._linesCache[v]=S));const[y,w]=S,x=this._bufferColsToStringOffset(v,g),E=u.caseSensitive?t:t.toLowerCase(),j=u.caseSensitive?y:y.toLowerCase();let k=-1;if(u.regex){const a=RegExp(E,"g");let u;if(_)for(;u=a.exec(j.slice(0,x));)k=a.lastIndex-u[0].length,t=u[0],a.lastIndex-=t.length-1;else u=a.exec(j.slice(x)),u&&u[0].length>0&&(k=x+(a.lastIndex-u[0].length),t=u[0])}else _?x-E.length>=0&&(k=j.lastIndexOf(E,x-E.length)):k=j.indexOf(E,x);if(k>=0){let a=0;for(;a<w.length-1&&k>=w[a+1];)a++;let u=a;for(;u<w.length-1&&k+t.length>=w[u+1];)u++;const _=k-w[a],f=k+t.length-w[u],g=this._stringLengthToBufferSize(v+a,_);return{term:t,col:g,row:v+a,size:this._stringLengthToBufferSize(v+u,f)-g+p.cols*(u-a)}}}_stringLengthToBufferSize(t,a){const u=this._terminal.buffer.active.getLine(t);if(!u)return 0;for(let t=0;t<a;t++){const _=u.getCell(t);if(!_)break;const f=_.getChars();f.length>1&&(a-=f.length-1);const p=u.getCell(t+1);p&&0===p.getWidth()&&a++}return a}_bufferColsToStringOffset(t,a){const u=this._terminal;let _=t,f=0,p=u.buffer.active.getLine(_);for(;a>0&&p;){for(let t=0;t<a&&t<u.cols;t++){const a=p.getCell(t);if(!a)break;a.getWidth()&&(f+=a.getChars().length)}if(_++,p=u.buffer.active.getLine(_),p&&!p.isWrapped)break;a-=u.cols}return f}_translateBufferLineToStringWithWrap(t,a){const u=this._terminal,_=[],f=[0];let p=u.buffer.active.getLine(t);for(;p;){const g=u.buffer.active.getLine(t+1),m=!!g&&g.isWrapped;let S=p.translateToString(!m&&a);if(m&&g){var v;const t=p.getCell(p.length-1);t&&0===t.getCode()&&1===t.getWidth()&&2===(null===(v=g.getCell(0))||void 0===v?void 0:v.getWidth())&&(S=S.slice(0,-1))}if(_.push(S),!m)break;f.push(f[f.length-1]+S.length),t++,p=g}return[_.join(""),f]}_selectResult(t){const a=this._terminal;if(!t)return a.clearSelection(),!1;if(a.select(t.col,t.row,t.size),t.row>=a.buffer.active.viewportY+a.rows||t.row<a.buffer.active.viewportY){let u=t.row-a.buffer.active.viewportY;u-=Math.floor(a.rows/2),a.scrollLines(u)}return!0}}const Et=k.i18n.translate("xpack.sessionView.processDataLimitExceededStart",{defaultMessage:"Data limit reached for"}),Ot=k.i18n.translate("xpack.sessionView.processDataLimitExceededEnd",{defaultMessage:'See "max_kilobytes_per_process" in advanced policy configuration.'}),jt=k.i18n.translate("xpack.sessionView.viewPoliciesLink",{defaultMessage:"VIEW POLICIES"}),kt=k.i18n.translate("xpack.sessionView.ttyStart",{defaultMessage:"Start"}),Tt=k.i18n.translate("xpack.sessionView.ttyPrevious",{defaultMessage:"Prev"}),Lt=k.i18n.translate("xpack.sessionView.ttyPlay",{defaultMessage:"Play"}),At=k.i18n.translate("xpack.sessionView.ttyPause",{defaultMessage:"Pause"}),Rt=k.i18n.translate("xpack.sessionView.ttyNext",{defaultMessage:"Next"}),Dt=k.i18n.translate("xpack.sessionView.ttyEnd",{defaultMessage:"End"}),Mt=k.i18n.translate("xpack.sessionView.ttyViewInSession",{defaultMessage:"View in session"}),Bt=({title:t,titleId:a,...u})=>Object(q.jsx)("svg",le()({xmlns:"http://www.w3.org/2000/svg",width:9,height:30,viewBox:"0 0 9 30","aria-labelledby":a},u),t?Object(q.jsx)("title",{id:a},t):null,Object(q.jsx)("path",{d:"M1.122-.001A.5.5 0 0 0 .75.834L4 4.444V29.5a.5.5 0 1 0 1 0V4.443L8.248.833A.5.5 0 0 0 7.877 0H1.122Z"}));let It;!function(t){t.ProcessChanged="process_changed",t.ProcessDataLimitReached="data_limited"}(It||(It={}));const Pt=({processStartMarkers:t,linesLength:a,currentLine:u,onChange:v,onSeekLine:g})=>{const m=(t=>{const{euiTheme:a,euiVars:u}=H();return Object(_.useMemo)((()=>{const{border:_}=a,f=(t,a)=>t===It.ProcessDataLimitReached?u.terminalOutputMarkerWarning:a?u.terminalOutputMarkerAccent:u.euiColorVis1,p={cursor:"pointer",marginTop:-20,width:9,height:30,marginLeft:-4.5},v={...p,border:"none",boxShadow:"none",backgroundColor:"transparent",borderRadius:0,opacity:0,appearance:"none"};return{marker:(t,a)=>({fontSize:0,overflow:"hidden",padding:0,width:3,height:12,backgroundColor:f(t,a),border:`${_.width.thick} solid ${u.terminalOutputBackground}`,borderRadius:_.radius.small,boxSizing:"content-box",marginLeft:"-3.5px",transition:"left .5s ease-in-out"}),markerWrapper:{position:"absolute",top:0,lineHeight:0},markersOverlay:{top:5,zIndex:2,position:"absolute",width:"100%"},range:{height:25,"&:focus:not(:focus-visible)::-webkit-slider-thumb":{boxShadow:"none",backgroundColor:"transparent"},"input[type='range']::-webkit-slider-thumb":v,"input[type='range']::-moz-range-thumb":v,".euiRangeHighlight__progress":{backgroundColor:u.euiColorVis0_behindText,width:t+"%!important",borderBottomRightRadius:0,borderTopRightRadius:0},".euiRangeSlider:focus ~ .euiRangeHighlight .euiRangeHighlight__progress":{backgroundColor:u.euiColorVis0_behindText},".euiRangeSlider:focus:not(:focus-visible) ~ .euiRangeHighlight .euiRangeHighlight__progress":{backgroundColor:u.euiColorVis0_behindText},".euiRangeTrack::after":{background:u.terminalOutputSliderBackground}},playHead:a=>({...p,position:"absolute",left:t+"%",top:16,fill:a===It.ProcessDataLimitReached?u.terminalOutputMarkerWarning:u.terminalOutputMarkerAccent})}}),[a,u.euiColorVis0_behindText,u.euiColorVis1,u.terminalOutputBackground,u.terminalOutputMarkerAccent,u.terminalOutputMarkerWarning,u.terminalOutputSliderBackground,t])})(Object(_.useMemo)((()=>u/(a-1)*100),[u,a])),S=Object(_.useMemo)((()=>t.length<1?[]:t.map((({event:t,line:a,maxBytesExceeded:u})=>{var _;return{type:u?It.ProcessDataLimitReached:It.ProcessChanged,line:a,name:null===(_=t.process)||void 0===_?void 0:_.name}}))),[t]),y=S.length,w=Object(_.useMemo)((()=>{if(!y)return;const t=u>=S[y-1].line?y-1:S.findIndex((t=>t.line>u))-1;return S[Math.max(0,t)].type}),[u,S,y]);return y?Object(q.jsx)(f.a.Fragment,null,Object(q.jsx)(p.EuiRange,{value:u,min:0,max:Math.max(0,a-1),onChange:v,fullWidth:!0,showRange:!0,css:m.range}),Object(q.jsx)(Bt,{css:m.playHead(w)}),Object(q.jsx)("div",{css:m.markersOverlay},S.map((({line:t,type:_,name:f},v)=>{const w=u>=t&&(v===y-1||u<S[v+1].line),x={left:t/(a-1)*100+"%",zIndex:w?3:2};return Object(q.jsx)("div",{key:v,style:x,css:m.markerWrapper},Object(q.jsx)(p.EuiToolTip,{title:f},Object(q.jsx)("button",{type:"button",value:t,tabIndex:-1,title:_,css:m.marker(_,w),onClick:()=>g(t),"aria-label":f},f)))})))):null},Ht=({currentProcessEvent:t,processStartMarkers:a,isPlaying:u,currentLine:f,linesLength:v,onSeekLine:g,onTogglePlayback:m,onClose:S,onJumpToEvent:y,textSizer:w})=>{const x=(()=>{const{euiTheme:t,euiVars:a}=H();return Object(_.useMemo)((()=>{const{size:u,border:_}=t;return{controlsPanel:{paddingTop:u.s,paddingBottom:u.s,borderBottomLeftRadius:_.radius.medium,borderBottomRightRadius:_.radius.medium,backgroundColor:a.terminalOutputBackground},controlButton:{width:u.l}}}),[t,a.terminalOutputBackground])})(),E={display:"empty",size:"s",color:"ghost",css:x.controlButton},j=Object(_.useCallback)((t=>{const a=parseInt((null==t?void 0:t.target).value||"0",10);g(a)}),[g]),k=Object(_.useCallback)((()=>{g(0)}),[g]),L=Object(_.useCallback)((()=>{g(v-1)}),[v,g]),A=Object(_.useCallback)((()=>{const t=f>a[a.length-1].line?a.length:Object(T.findIndex)(a,(t=>t.line>=f)),u=a[t-1];g((null==u?void 0:u.line)||0)}),[a,g,f]),R=Object(_.useCallback)((()=>{const t=Object(T.findIndex)(a,(t=>t.line>f)),u=a[t];g((null==u?void 0:u.line)||v-1)}),[a,g,v,f]),D=Object(_.useCallback)((()=>{t&&(y(t),S())}),[t,S,y]);return Object(q.jsx)(p.EuiPanel,{css:x.controlsPanel,"data-test-subj":"sessionView:TTYPlayerControls",hasShadow:!1,borderRadius:"none"},Object(q.jsx)(p.EuiFlexGroup,{alignItems:"center",gutterSize:"s",direction:"row"},Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiToolTip,{content:kt},Object(q.jsx)(p.EuiButtonIcon,le()({"data-test-subj":"sessionView:TTYPlayerControlsStart",iconType:"arrowStart","aria-label":kt,onClick:k},E)))),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiToolTip,{content:Tt},Object(q.jsx)(p.EuiButtonIcon,le()({"data-test-subj":"sessionView:TTYPlayerControlsPrevious",iconType:"arrowLeft","aria-label":Tt,onClick:A},E)))),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiToolTip,{content:u?At:Lt},Object(q.jsx)(p.EuiButtonIcon,le()({"data-test-subj":"sessionView:TTYPlayerControlsPlay",iconType:u?"pause":"playFilled","aria-label":u?At:Lt,onClick:m},E)))),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiToolTip,{content:Rt},Object(q.jsx)(p.EuiButtonIcon,le()({"data-test-subj":"sessionView:TTYPlayerControlsNext",iconType:"arrowRight","aria-label":Rt,onClick:R},E)))),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiToolTip,{content:Dt},Object(q.jsx)(p.EuiButtonIcon,le()({"data-test-subj":"sessionView:TTYPlayerControlsEnd",iconType:"arrowEnd","aria-label":Dt,onClick:L},E)))),Object(q.jsx)(p.EuiFlexItem,{style:{position:"relative"}},Object(q.jsx)(Pt,{processStartMarkers:a,linesLength:v,currentLine:f,onChange:j,onSeekLine:g})),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiButtonEmpty,{iconSide:"right",size:"s",onClick:D,iconType:"arrowRight","aria-label":Mt,color:"ghost"},Mt)),Object(q.jsx)(p.EuiFlexItem,{grow:!1},w)))},Ft=k.i18n.translate("xpack.sessionView.beta",{defaultMessage:"Beta"}),$t=k.i18n.translate("xpack.sessionView.refreshSession",{defaultMessage:"Refresh session"}),zt=k.i18n.translate("xpack.sessionView.toggleTTYPlayer",{defaultMessage:"Toggle TTY player"}),Nt=k.i18n.translate("xpack.sessionView.detailPanel",{defaultMessage:"Detail panel"}),Wt=({show:t,sessionEntityId:a,onClose:u,isFullscreen:f,onJumpToEvent:v,autoSeekToEntityId:g,canAccessEndpointManagement:m})=>{var S,y,w;const x=Object(_.useRef)(null),{ref:E,height:j=1}=ut()({}),{data:k,fetchNextPage:L,hasNextPage:A,isFetching:R,refetch:M}=(t=>{const{http:a}=Object(F.useKibana)().services,u=Object(_.useMemo)((()=>[D.w,t]),[t]);return Object(xt.useInfiniteQuery)(u,(async({pageParam:u={}})=>{var _,f;const{cursor:p}=u,v=await a.get(D.o,{query:{sessionEntityId:t,cursor:p}});return{events:null!==(_=null===(f=v.events)||void 0===f?void 0:f.map((t=>t._source)))&&void 0!==_?_:[],cursor:p,total:v.total}}),{getNextPageParam:t=>{if(t.events.length>=D.n)return{cursor:t.events[t.events.length-1]["@timestamp"]}},refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1})})(a),{lines:B,processStartMarkers:I}=(t=>{const[a,u]=Object(_.useState)(0),[f,p]=Object(_.useState)([]),[v,g]=Object(_.useState)([]);return Object(_.useMemo)((()=>{if(!t)return{lines:f,processStartMarkers:v};const _=t.reduce(((t,a)=>t.concat(a.events||[])),[]).slice(a),m=[];let S=[];_.forEach(((t,a)=>{var u;const{process:_}=t;if(void 0!==(null==_||null===(u=_.io)||void 0===u?void 0:u.text)&&void 0!==_.entity_id){var p,v,g,y,w;if(((null===(p=S[S.length-1])||void 0===p||null===(v=p.event)||void 0===v||null===(g=v.process)||void 0===g?void 0:g.entity_id)||(null===(y=f[f.length-1])||void 0===y||null===(w=y.event.process)||void 0===w?void 0:w.entity_id))!==_.entity_id){const a={line:f.length+S.length,event:t};m.push(a)}if(_.io.max_bytes_per_process_exceeded){const t=m.find((t=>{var a;return(null===(a=t.event.process)||void 0===a?void 0:a.entity_id)===_.entity_id}));t&&(t.maxBytesExceeded=!0)}const a=_.io.text.split(D.A),u=[a[0]];for(let t=1;t<a.length-1;t+=2)u.push(a[t]+a[t+1]);const x=u.map((a=>({event:t,value:a})));S=S.concat(x)}}));const y=f.concat(S),w=v.concat(m);S.length>0&&p(y),m.length>0&&g(w);const x=a+_.length;return x>a&&u(x),{lines:y,processStartMarkers:w}}),[a,t,f,v])})(null==k?void 0:k.pages),[P,$]=Object(_.useState)(D.i),[z,N]=Object(_.useState)(!1),[W,V]=Object(_.useState)(""),[U,K]=Object(_.useState)(""),{getUrlForApp:G}=Object(F.useKibana)().services.application,Y=Object(_.useMemo)((()=>m?G(D.y,{path:D.r}):""),[m,G]),{search:J,currentLine:X,seekToLine:Z}=(({ref:t,isPlaying:a,setIsPlaying:u,lines:f,fontSize:p,hasNextPage:v,fetchNextPage:g,isFetching:m,policiesUrl:S})=>{var y,w,x,E;const{euiTheme:j}=H(),{font:k,colors:T}=j,[L,A]=Object(_.useState)(0),[R]=Object(_.useState)(D.j),M=null==f||null===(y=f[L])||void 0===y||null===(w=y.event.process)||void 0===w?void 0:w.tty,B=null==f||null===(x=f[L])||void 0===x||null===(E=x.event.process)||void 0===E?void 0:E.name,[I,P]=Object(_.useMemo)((()=>{const t=new wt.Terminal({theme:{selectionBackground:T.warning,selectionForeground:T.ink,yellow:T.warning},fontFamily:k.familyCode,fontSize:D.i,scrollback:0,convertEol:!0,rows:D.k,cols:D.h,allowProposedApi:!0,allowTransparency:!0}),a=new xterm_search_SearchAddon;return t.loadAddon(a),[t,a]}),[k,T]);Object(_.useEffect)((()=>{t.current&&!I.element&&I.open(t.current);const a=t=>{var a,u;null!=t&&null!==(a=t.target)&&void 0!==a&&null!==(u=a.offsetParent)&&void 0!==u&&u.classList.contains("xterm-screen")&&t.stopImmediatePropagation()};return window.addEventListener("wheel",a,!0),()=>{window.removeEventListener("wheel",a,!0),I.dispose()}}),[I,t]);const F=Object(_.useCallback)(((t,a)=>{if(0===f.length)return;let u;if(a){u=f.slice(Math.max(0,t-D.z),t+1);try{I.reset(),I.clear()}catch(t){}}else u=f.slice(t,t+1);u.forEach(((u,_)=>{var p,v;void 0!==(null==u?void 0:u.value)&&I.write(u.value);const g=f[t+_+1],m=null===(p=u.event.process)||void 0===p||null===(v=p.io)||void 0===v?void 0:v.max_bytes_per_process_exceeded;if(!a&&(!g||g.event!==u.event)&&m){const t=((t,a,u)=>{if(null!=t&&t.columns){const _="-".repeat(t.columns),f=`  â   ${Et} [1m${u}.[22m ${Ot}`;return`\n[33m${_}\n${f}${a?`[${Math.min(f.length+2,t.columns-jt.length-4)}G[1m]8;;${a}\\[ ${jt} ]]8;;\\[22m`:""}\n${_}[0m\n\n`}})(M,S,B);t&&I.write(t)}}))}),[f,S,B,I,M]);Object(_.useEffect)((()=>{const t=I.options.fontSize!==p,a=M&&(I.rows!==(null==M?void 0:M.rows)||I.cols!==(null==M?void 0:M.columns));t&&(I.options.fontSize=p),null!=M&&M.rows&&null!=M&&M.columns&&a&&I.resize(M.columns,M.rows),(t||a)&&F(L,!0),!m&&v&&g&&L>=f.length-100&&g()}),[L,p,I,F,M,v,g,f.length,m]),Object(_.useEffect)((()=>{if(a){const t=setTimeout((()=>{if(v||L!==f.length-1){const t=Math.min(f.length-1,L+1);F(t,!1),A(t)}else u(!1)}),R);return()=>{clearTimeout(t)}}}),[f,L,a,R,F,v,g,u]);const $=Object(_.useCallback)((t=>{A(t),F(t,!0)}),[F]),z=Object(_.useCallback)(((t,a)=>{P.findNext(t,{caseSensitive:!1,lastLineOnly:!0,startCol:a})}),[P]);return{terminal:I,currentLine:L,seekToLine:$,search:z}})({ref:x,isPlaying:z,setIsPlaying:N,lines:B,fontSize:P,hasNextPage:A,fetchNextPage:L,isFetching:R,policiesUrl:Y}),Q=null===(S=B[Math.min(B.length-1,X)])||void 0===S?void 0:S.event,ee=null==Q||null===(y=Q.process)||void 0===y?void 0:y.tty;Object(_.useEffect)((()=>{t&&M({refetchPage:(t,a,u)=>u.length-1===a})}),[M,t]),Object(_.useEffect)((()=>{var t;if(g&&U!==g&&(null==Q||null===(t=Q.process)||void 0===t?void 0:t.entity_id)!==g){const t=I.find((t=>{var a;return(null===(a=t.event.process)||void 0===a?void 0:a.entity_id)===g}));t?(Z(t.line),K(g)):Z(B.length-1)}}),[g,U,null==Q||null===(w=Q.process)||void 0===w?void 0:w.entity_id,B.length,I,Z]);const te=(null==ee?void 0:ee.rows)&&(null==ee?void 0:ee.rows)>1&&(null==ee?void 0:ee.rows)<1e3;ee&&!te&&(ee.rows=D.k,ee.columns=D.h);const ie=((t,a)=>{const{euiTheme:u,euiVars:f}=H();return Object(_.useMemo)((()=>{const{size:_,font:v,colors:g,border:m}=u,S={position:"absolute",top:0,opacity:a?1:0,transition:"opacity .2s",pointerEvents:a?"auto":"none",width:"100%",height:"100%",overflow:"hidden",zIndex:10,".euiRangeLevel--warning":{backgroundColor:Object(p.transparentize)(g.warning,.8)},".euiRangeLevel--danger":{backgroundColor:Object(p.transparentize)(g.danger,.8)},".euiRangeTick,.euiRangeLevel":{transition:"left 500ms"}},y={visibility:a?"visible":"hidden",backgroundColor:`${f.euiFormBackgroundDisabledColor}`,padding:`${_.m} ${_.base}`},w=Object(p.transparentize)(g.ghost,.6),x={minHeight:"100%",".xterm":yt,".xterm-screen":Object(q.css)("overflow-y:visible;border:",m.width.thin," dotted ",w,";border-top:0;border-left:0;box-sizing:content-box;","")};return null!=t&&t.rows&&(x[".xterm-screen:after"]=Object(q.css)("position:absolute;right:",_.s,";top:",_.s,";content:'",null==t?void 0:t.columns,"x",null==t?void 0:t.rows,"';color:",w,";font-family:",v.familyCode,";font-size:",_.m,";")),{container:S,header:y,terminal:x,scrollPane:{position:"relative",transform:`translateY(${a?0:"100%"})`,transition:"transform .2s ease-in-out",width:"100%",height:"calc(100% - 112px)",overflow:"auto",backgroundColor:g.ink},betaBadge:{backgroundColor:`${g.emptyShade}`}}}),[u,a,f.euiFormBackgroundDisabledColor,null==t?void 0:t.rows,null==t?void 0:t.columns])})(ee,t),se=Object(_.useCallback)((()=>{W&&V("")}),[W]),re=Object(_.useMemo)((()=>Object(T.throttle)((t=>{se(),Z(t)}),100)),[se,Z]),ne=Object(_.useCallback)((()=>{X>=B.length-1&&Z(0),N(!z)}),[X,z,B.length,Z]);return Object(_.useEffect)((()=>{z&&se()}),[se,z]),Object(q.jsx)("div",{css:ie.container},Object(q.jsx)(p.EuiPanel,{hasShadow:!1,borderRadius:"none",hasBorder:!1,css:ie.header},Object(q.jsx)(p.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiBetaBadge,{label:Ft,size:"s",css:ie.betaBadge})),Object(q.jsx)(p.EuiFlexItem,{"data-test-subj":"sessionView:TTYSearch"},Object(q.jsx)(vt,{lines:B,seekToLine:Z,xTermSearchFn:J,setIsPlaying:N,searchQuery:W,setSearchQuery:V})),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiButtonIcon,{isSelected:!0,display:"fill",isLoading:R,iconType:"apmTrace",onClick:u,size:"m","aria-label":zt,"data-test-subj":"sessionView:TTYPlayerClose"})),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiButtonIcon,{iconType:"refresh",display:"empty",size:"m",disabled:!0,"aria-label":"disabled"})),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiButtonIcon,{iconType:"eye",disabled:!0,size:"m","aria-label":"disabled"})),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiButton,{iconType:"list",disabled:!0},Nt)))),Object(q.jsx)("div",{ref:E,className:"eui-scrollBar",css:ie.scrollPane},Object(q.jsx)("div",{ref:x,"data-test-subj":"sessionView:TTYPlayer",css:ie.terminal})),Object(q.jsx)(Ht,{currentProcessEvent:Q,processStartMarkers:I,isPlaying:z,currentLine:X,linesLength:B.length,onSeekLine:re,onTogglePlayback:ne,onClose:u,onJumpToEvent:v,textSizer:Object(q.jsx)(Ct,{tty:ee,containerHeight:j,fontSize:P,onFontSizeChanged:$,isFullscreen:f})}))},Vt=({sessionEntityId:t,height:a,isFullScreen:u=!1,jumpToEntityId:g,jumpToCursor:S,investigatedAlertId:y,loadAlertDetails:w,canAccessEndpointManagement:x})=>{var k,T;g===t&&(g=void 0,S=void 0);const[L,A]=Object(_.useState)(!1),[R,B]=Object(_.useState)(!1),[I,P]=Object(_.useState)(null),[$,z]=Object(_.useState)(""),[N,W]=Object(_.useState)(null),[V,U]=m()(D.p,{timestamp:!0,verboseMode:!1}),[K,G]=Object(_.useState)([]),[Y,J]=Object(_.useState)({}),[X,Z]=Object(_.useState)(S),[Q,ee]=Object(_.useState)(g),[te,ie]=Object(_.useState)(""),se=(({height:t=500,isFullScreen:a})=>{const{euiTheme:u,euiVars:f}=H();return Object(_.useMemo)((()=>{const{border:_,size:p}=u,v={height:a?"calc(100vh - 118px)":t+"px"};return{processTree:{...v,position:"relative"},detailPanel:{...v,borderRightWidth:"0px"},nonGrowGroup:{display:"flex",flexGrow:0,alignItems:"stretch"},resizeHandle:{zIndex:2},sessionViewerComponent:{position:"relative",border:_.thin,borderRadius:_.radius.medium,"> .sessionViewerToolbar":{backgroundColor:`${f.euiFormBackgroundDisabledColor}`,padding:`${p.m} ${p.base}`}}}}),[u,a,t,f])})({height:a,isFullScreen:u}),re=Object(_.useRef)((()=>{})),ne=Object(_.useMemo)((()=>!(null!=V&&V.verboseMode||!$||0!==(null==N?void 0:N.length))),[null==V?void 0:V.verboseMode,N,$]),oe=Object(_.useCallback)((()=>{A(!L)}),[L]),ae=Object(_.useCallback)((t=>{P(t)}),[]),le=Object(_.useCallback)((a=>{if(a.process){const{entity_id:_}=a.process;if(_!==t){var u;const t=null===(u=a.kibana)||void 0===u?void 0:u.alert,f=t?null==t?void 0:t.original_time:a["@timestamp"];f&&(ee(_),Z(f))}P(null)}}),[t]),ce=Object(_.useCallback)((t=>{ie(t),A(!0)}),[]),{data:he,error:de,fetchNextPage:ue,hasNextPage:_e,isFetching:fe,fetchPreviousPage:pe,hasPreviousPage:ve,refetch:ge}=((t,a)=>{const{http:u}=Object(F.useKibana)().services,[f,p]=Object(_.useState)(""),v=Object(_.useMemo)((()=>[D.x,t,a]),[t,a]),g=Object(xt.useInfiniteQuery)(v,(async({pageParam:_={}})=>{var f,p;let{cursor:v}=_;const{forward:g}=_;!v&&a&&(v=a);const m=await u.get(D.t,{query:{sessionEntityId:t,cursor:v,forward:g}});return{events:null!==(f=null===(p=m.events)||void 0===p?void 0:p.map((t=>t._source)))&&void 0!==f?f:[],cursor:v,total:m.total}}),{getNextPageParam:(t,u)=>{if(1===u.length&&a||t.events.length>=D.s){var _;const a=t.events.filter((t=>{var a;const u=null===(a=t.event)||void 0===a?void 0:a.action;return u&&[M.a.fork,M.a.exec,M.a.end].includes(u)})),u=null==a||null===(_=a[a.length-1])||void 0===_?void 0:_["@timestamp"];if(u)return{cursor:u,forward:!0}}},getPreviousPageParam:(t,u)=>{const _=t.events.filter((t=>{var a;const u=null===(a=t.event)||void 0===a?void 0:a.action;return u&&[M.a.fork,M.a.exec,M.a.end].includes(u)})),f=u.length>1&&_.length<D.s;var p;if(a&&!f)return{cursor:(null===(p=_[0])||void 0===p?void 0:p["@timestamp"])||a,forward:!1}},refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1});return Object(_.useEffect)((()=>{var t;a&&1===(null===(t=g.data)||void 0===t?void 0:t.pages.length)&&a!==f&&(g.fetchPreviousPage({cancelRefetch:!0}),p(a))}),[a,g,f]),g})(t,X),{data:me,fetchNextPage:be,isFetching:Se,hasNextPage:Ce,error:ye,refetch:we}=((t,a)=>{const{http:u}=Object(F.useKibana)().services,_=[D.u,t,a];return Object(xt.useInfiniteQuery)(_,(async({pageParam:_={}})=>{var f,p;const{cursor:v}=_,g=await u.get(D.b,{query:{sessionEntityId:t,investigatedAlertId:a,cursor:v}});return{events:null!==(f=null===(p=g.events)||void 0===p?void 0:p.map((t=>t._source)))&&void 0!==f?f:[],cursor:v,total:g.total}}),{getNextPageParam:t=>{if(t.events.length>=D.a)return{cursor:t.events[t.events.length-1]["@timestamp"]}},refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1})})(t,y),{data:xe,refetch:Ee}=(t=>{const{http:a}=Object(F.useKibana)().services,u=[D.v,t];return Object(xt.useQuery)(u,(async()=>a.get(D.m,{query:{sessionEntityId:t}})),{refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,cacheTime:0})})(t),Oe=!(null==xe||!xe.total),je=Object(_.useMemo)((()=>{const{unit:t,value:a}=E((null==xe?void 0:xe.total)||0);return{unit:t,value:a}}),[null==xe?void 0:xe.total]),ke=Object(_.useCallback)((()=>{ge({refetchPage:(t,a,u)=>u.length-1===a}),we({refetchPage:(t,a,u)=>u.length-1===a}),Ee()}),[ge,we,Ee]),Te=Object(_.useMemo)((()=>{let t=[];return me&&me.pages.forEach((a=>{t=t.concat(a.events)})),t}),[me]),Le=Object(_.useMemo)((()=>{var t;return(null==me||null===(t=me.pages)||void 0===t?void 0:t[0].total)||0}),[me]),Ae=de||ye,De=he&&(null===(k=he.pages)||void 0===k?void 0:k.length)>(S?1:0),Me=fe&&!De,Be=De&&he.pages[0].events.length>0,{data:Ie}=((t,a)=>{const{http:u}=Object(F.useKibana)().services,_=[D.u,a];return Object(xt.useQuery)(_,(async()=>{var _,f,p,v,g,m,S,y,w;if(!a)return t;const x=null!==(_=null===(f=(await u.get(D.e,{query:{alertUuid:a}})).events)||void 0===f?void 0:f.map((t=>t._source)))&&void 0!==_?_:[];return{...t,[a]:{status:null!==(p=null===(v=x[0])||void 0===v||null===(g=v.kibana)||void 0===g||null===(m=g.alert)||void 0===m?void 0:m.workflow_status)&&void 0!==p?p:"",processEntityId:null!==(S=null===(y=x[0])||void 0===y||null===(w=y.process)||void 0===w?void 0:w.entity_id)&&void 0!==S?S:""}}}),{refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,cacheTime:0})})(Y,null!==(T=K[0])&&void 0!==T?T:"");Object(_.useEffect)((()=>{Ie&&(J({...Ie}),K.shift())}),[Ie,K]);const Pe=Object(_.useCallback)((t=>{if(N){const a=N[t];a&&ae(a)}}),[ae,N]),He=Object(_.useCallback)((t=>{G([t])}),[]),Fe=Object(_.useCallback)((()=>{re.current(),B(!R)}),[R]),$e=Object(_.useCallback)((t=>{w&&w(t,(()=>He(t)))}),[w,He]),ze=Object(_.useCallback)((t=>{U(t)}),[U]);return Me?Object(q.jsx)(j.SectionLoading,null,Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.loadingProcessTree",defaultMessage:"Loading sessionâ¦"})):Be?Object(q.jsx)("div",{css:se.sessionViewerComponent},Object(q.jsx)(p.EuiPanel,{hasShadow:!1,borderRadius:"none",className:"sessionViewerToolbar"},Object(q.jsx)(p.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(q.jsx)(p.EuiFlexItem,{"data-test-subj":"sessionView:sessionViewProcessEventsSearch"},Object(q.jsx)(nt,{searchQuery:$,totalMatches:(null==N?void 0:N.length)||0,setSearchQuery:z,onPrevious:Pe,onNext:Pe})),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiToolTip,{title:Object(q.jsx)(f.a.Fragment,null,je.value," ",je.unit,Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.ttyToggleTip",defaultMessage:" of TTY output"}))},Object(q.jsx)(p.EuiButtonIcon,{disabled:!Oe,isSelected:L,display:L?"fill":"empty",iconType:"apmTrace",onClick:oe,size:"m","aria-label":zt,"data-test-subj":"sessionView:TTYPlayerToggle"}))),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiButtonIcon,{iconType:"refresh",display:"empty",onClick:ke,size:"m","aria-label":$t,"data-test-subj":"sessionView:sessionViewRefreshButton",isLoading:fe})),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(ht,{displayOptions:V,onChange:ze,showVerboseSearchTooltip:ne})),Object(q.jsx)(p.EuiFlexItem,{grow:!1},Object(q.jsx)(p.EuiButton,{onClick:Fe,iconType:"list","data-test-subj":"sessionView:sessionViewDetailPanelToggle",fill:!R},Nt)))),Object(q.jsx)(p.EuiHorizontalRule,{margin:"none"}),Object(q.jsx)(p.EuiResizableContainer,null,((a,u,{togglePanel:_})=>(re.current=()=>{null==_||_("session-detail-panel",{direction:"left"})},Object(q.jsx)(f.a.Fragment,null,Object(q.jsx)(a,{initialSize:100,minSize:"60%",paddingSize:"none"},Ae&&Object(q.jsx)(p.EuiEmptyPrompt,{iconType:"alert",color:"danger",title:Object(q.jsx)("h2",null,Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.errorHeading",defaultMessage:"Error loading Session View"})),body:Object(q.jsx)("p",null,Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.errorMessage",defaultMessage:"There was an error loading the Session View."}))}),Be&&Object(q.jsx)("div",{css:se.processTree},Object(q.jsx)(Re,{key:t+X,sessionEntityId:t,data:he.pages,searchQuery:$,selectedProcess:I,onProcessSelected:ae,onJumpToOutput:ce,jumpToEntityId:Q,investigatedAlertId:y,isFetching:fe,hasPreviousPage:ve,hasNextPage:_e,fetchNextPage:ue,fetchPreviousPage:pe,setSearchResults:W,updatedAlertsStatus:Y,onShowAlertDetails:$e,showTimestamp:null==V?void 0:V.timestamp,verboseMode:null==V?void 0:V.verboseMode}))),Object(q.jsx)(u,{css:se.resizeHandle}),Object(q.jsx)(a,{id:"session-detail-panel",initialSize:30,minSize:"320px",paddingSize:"none",css:se.detailPanel},Object(q.jsx)(it,{alerts:Te,alertsCount:Le,isFetchingAlerts:Se,hasNextPageAlerts:Ce,fetchNextPageAlerts:be,investigatedAlertId:y,selectedProcess:I,onJumpToEvent:le,onShowAlertDetails:$e})))))),Object(q.jsx)(Wt,{show:L,sessionEntityId:t,onClose:oe,isFullscreen:u,onJumpToEvent:le,autoSeekToEntityId:te,canAccessEndpointManagement:x})):Object(q.jsx)(p.EuiEmptyPrompt,{"data-test-subj":"sessionView:sessionViewProcessEventsEmpty",title:Object(q.jsx)("h2",null,Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.emptyDataTitle",defaultMessage:"No data to render"})),body:Object(q.jsx)("p",null,Object(q.jsx)(v.FormattedMessage,{id:"xpack.sessionView.emptyDataMessage",defaultMessage:"No process events found for this query."}))})}}]]);