/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.dataVisualizer_bundle_jsonpfunction=window.dataVisualizer_bundle_jsonpfunction||[]).push([[1],{136:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(137);case"v8light":return a(139)}},137:function(e,t,a){var i=a(49),n=a(138);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},138:function(e,t,a){(t=a(50)(!1)).push([e.i,".dvSearchPanel__controls{flex-direction:row;padding:8px}.dvSearchPanel__container{align-items:baseline}@media only screen and (max-width:574px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%,500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width:575px) and (max-width:767px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%,500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width:768px) and (max-width:991px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%,500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width:992px) and (max-width:1199px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%,500px)}.dvSearchPanel__controls{padding:0}}",""]),e.exports=t},139:function(e,t,a){var i=a(49),n=a(140);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},140:function(e,t,a){(t=a(50)(!1)).push([e.i,".dvSearchPanel__controls{flex-direction:row;padding:8px}.dvSearchPanel__container{align-items:baseline}@media only screen and (max-width:574px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%,500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width:575px) and (max-width:767px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%,500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width:768px) and (max-width:991px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%,500px)}.dvSearchPanel__controls{padding:0}}@media only screen and (min-width:992px) and (max-width:1199px){.dvSearchPanel__container{flex-direction:column}.dvSearchBar{min-width:max(100%,500px)}.dvSearchPanel__controls{padding:0}}",""]),e.exports=t},141:function(e,t,a){(function(e){var i;!function(e,n,r){function s(e){var t,a=this,i=(t=4022871197,function(e){e=String(e);for(var a=0;a<e.length;a++){var i=.02519603282416938*(t+=e.charCodeAt(a));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)});a.next=function(){var e=2091639*a.s0+2.3283064365386963e-10*a.c;return a.s0=a.s1,a.s1=a.s2,a.s2=e-(a.c=0|e)},a.c=1,a.s0=i(" "),a.s1=i(" "),a.s2=i(" "),a.s0-=i(e),a.s0<0&&(a.s0+=1),a.s1-=i(e),a.s1<0&&(a.s1+=1),a.s2-=i(e),a.s2<0&&(a.s2+=1),i=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function l(e,t){var a=new s(e),i=t&&t.state,n=a.next;return n.int32=function(){return 4294967296*a.next()|0},n.double=function(){return n()+11102230246251565e-32*(2097152*n()|0)},n.quick=n,i&&("object"==typeof i&&o(i,a),n.state=function(){return o(a,{})}),n}n&&n.exports?n.exports=l:a(52)&&a(59)?void 0===(i=function(){return l}.call(t,a,t,n))||(n.exports=i):this.alea=l}(0,e,a(52))}).call(this,a(58)(e))},142:function(e,t,a){(function(e){var i;!function(e,n,r){function s(e){var t=this,a="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:a+=e;for(var i=0;i<a.length+64;i++)t.x^=0|a.charCodeAt(i),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function l(e,t){var a=new s(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&("object"==typeof i&&o(i,a),n.state=function(){return o(a,{})}),n}n&&n.exports?n.exports=l:a(52)&&a(59)?void 0===(i=function(){return l}.call(t,a,t,n))||(n.exports=i):this.xor128=l}(0,e,a(52))}).call(this,a(58)(e))},143:function(e,t,a){(function(e){var i;!function(e,n,r){function s(e){var t=this,a="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:a+=e;for(var i=0;i<a.length+64;i++)t.x^=0|a.charCodeAt(i),i==a.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function l(e,t){var a=new s(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&("object"==typeof i&&o(i,a),n.state=function(){return o(a,{})}),n}n&&n.exports?n.exports=l:a(52)&&a(59)?void 0===(i=function(){return l}.call(t,a,t,n))||(n.exports=i):this.xorwow=l}(0,e,a(52))}).call(this,a(58)(e))},144:function(e,t,a){(function(e){var i;!function(e,n,r){function s(e){var t=this;t.next=function(){var e,a,i=t.x,n=t.i;return e=i[n],a=(e^=e>>>7)^e<<24,a^=(e=i[n+1&7])^e>>>10,a^=(e=i[n+3&7])^e>>>3,a^=(e=i[n+4&7])^e<<7,e=i[n+7&7],a^=(e^=e<<13)^e<<9,i[n]=a,t.i=n+1&7,a},function(e,t){var a,i=[];if(t===(0|t))i[0]=t;else for(t=""+t,a=0;a<t.length;++a)i[7&a]=i[7&a]<<15^t.charCodeAt(a)+i[a+1&7]<<13;for(;i.length<8;)i.push(0);for(a=0;a<8&&0===i[a];++a);for(8==a?i[7]=-1:i[a],e.x=i,e.i=0,a=256;a>0;--a)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function l(e,t){null==e&&(e=+new Date);var a=new s(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&(i.x&&o(i,a),n.state=function(){return o(a,{})}),n}n&&n.exports?n.exports=l:a(52)&&a(59)?void 0===(i=function(){return l}.call(t,a,t,n))||(n.exports=i):this.xorshift7=l}(0,e,a(52))}).call(this,a(58)(e))},145:function(e,t,a){(function(e){var i;!function(e,n,r){function s(e){var t=this;t.next=function(){var e,a,i=t.w,n=t.X,r=t.i;return t.w=i=i+1640531527|0,a=n[r+34&127],e=n[r=r+1&127],a^=a<<13,e^=e<<17,a^=a>>>15,e^=e>>>12,a=n[r]=a^e,t.i=r,a+(i^i>>>16)|0},function(e,t){var a,i,n,r,s,o=[],l=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,l=Math.max(l,t.length)),n=0,r=-32;r<l;++r)t&&(i^=t.charCodeAt((r+32)%t.length)),0===r&&(s=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,r>=0&&(s=s+1640531527|0,n=0==(a=o[127&r]^=i+s)?n+1:0);for(n>=128&&(o[127&(t&&t.length||0)]=-1),n=127,r=512;r>0;--r)i=o[n+34&127],a=o[n=n+1&127],i^=i<<13,a^=a<<17,i^=i>>>15,a^=a>>>12,o[n]=i^a;e.w=s,e.X=o,e.i=n}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function l(e,t){null==e&&(e=+new Date);var a=new s(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&(i.X&&o(i,a),n.state=function(){return o(a,{})}),n}n&&n.exports?n.exports=l:a(52)&&a(59)?void 0===(i=function(){return l}.call(t,a,t,n))||(n.exports=i):this.xor4096=l}(0,e,a(52))}).call(this,a(58)(e))},146:function(e,t,a){(function(e){var i;!function(e,n,r){function s(e){var t=this,a="";t.next=function(){var e=t.b,a=t.c,i=t.d,n=t.a;return e=e<<25^e>>>7^a,a=a-i|0,i=i<<24^i>>>8^n,n=n-e|0,t.b=e=e<<20^e>>>12^a,t.c=a=a-i|0,t.d=i<<16^a>>>16^n,t.a=n-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):a+=e;for(var i=0;i<a.length+20;i++)t.b^=0|a.charCodeAt(i),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function l(e,t){var a=new s(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&("object"==typeof i&&o(i,a),n.state=function(){return o(a,{})}),n}n&&n.exports?n.exports=l:a(52)&&a(59)?void 0===(i=function(){return l}.call(t,a,t,n))||(n.exports=i):this.tychei=l}(0,e,a(52))}).call(this,a(58)(e))},147:function(e,t,a){var i;!function(n,r,s){var o,l=256,c=s.pow(l,6),u=s.pow(2,52),d=2*u,p=255;function m(e,t,a){var i=[],p=h(g((t=1==t?{entropy:!0}:t||{}).entropy?[e,x(r)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(l):(e=new Uint8Array(l),(n.crypto||n.msCrypto).getRandomValues(e)),x(e)}catch(e){var t=n.navigator,a=t&&t.plugins;return[+new Date,n,a,n.screen,x(r)]}}():e,3),i),m=new b(i),v=function(){for(var e=m.g(6),t=c,a=0;e<u;)e=(e+a)*l,t*=l,a=m.g(1);for(;e>=d;)e/=2,t/=2,a>>>=1;return(e+a)/t};return v.int32=function(){return 0|m.g(4)},v.quick=function(){return m.g(4)/4294967296},v.double=v,h(x(m.S),r),(t.pass||a||function(e,t,a,i){return i&&(i.S&&f(i,m),e.state=function(){return f(m,{})}),a?(s.random=e,t):e})(v,p,"global"in t?t.global:this==s,t.state)}function b(e){var t,a=e.length,i=this,n=0,r=i.i=i.j=0,s=i.S=[];for(a||(e=[a++]);n<l;)s[n]=n++;for(n=0;n<l;n++)s[n]=s[r=p&r+e[n%a]+(t=s[n])],s[r]=t;(i.g=function(e){for(var t,a=0,n=i.i,r=i.j,s=i.S;e--;)t=s[n=p&n+1],a=a*l+s[p&(s[n]=s[r=p&r+t])+(s[r]=t)];return i.i=n,i.j=r,a})(l)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){var a,i=[],n=typeof e;if(t&&"object"==n)for(a in e)try{i.push(g(e[a],t-1))}catch(e){}return i.length?i:"string"==n?e:e+"\0"}function h(e,t){for(var a,i=e+"",n=0;n<i.length;)t[p&n]=p&(a^=19*t[p&n])+i.charCodeAt(n++);return x(t)}function x(e){return String.fromCharCode.apply(0,e)}if(h(s.random(),r),e.exports){e.exports=m;try{o=a(148)}catch(e){}}else void 0===(i=function(){return m}.call(t,a,t,e))||(e.exports=i)}("undefined"!=typeof self?self:this,[],Math)},148:function(e,t){},149:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(150);case"v8light":return a(152)}},150:function(e,t,a){var i=a(49),n=a(151);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},151:function(e,t,a){(t=a(50)(!1)).push([e.i,".dataViewTitleHeader{align-items:center;display:flex;flex-direction:row;min-width:300px;padding:8px 0}@media only screen and (max-width:574px){.dataVisualizerPageHeader{align-items:flex-start;flex-direction:column}}@media only screen and (min-width:575px) and (max-width:767px){.dataVisualizerPageHeader{align-items:flex-start;flex-direction:column}}@media only screen and (min-width:768px) and (max-width:991px){.dataVisualizerPageHeader{align-items:flex-start;flex-direction:column}}@media only screen and (min-width:992px) and (max-width:1199px){.dataVisualizerPageHeader{align-items:flex-start;flex-direction:column}}",""]),e.exports=t},152:function(e,t,a){var i=a(49),n=a(153);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},153:function(e,t,a){(t=a(50)(!1)).push([e.i,".dataViewTitleHeader{align-items:center;display:flex;flex-direction:row;min-width:300px;padding:8px 0}@media only screen and (max-width:574px){.dataVisualizerPageHeader{align-items:flex-start;flex-direction:column}}@media only screen and (min-width:575px) and (max-width:767px){.dataVisualizerPageHeader{align-items:flex-start;flex-direction:column}}@media only screen and (min-width:768px) and (max-width:991px){.dataVisualizerPageHeader{align-items:flex-start;flex-direction:column}}@media only screen and (min-width:992px) and (max-width:1199px){.dataVisualizerPageHeader{align-items:flex-start;flex-direction:column}}",""]),e.exports=t},52:function(e,t,a){e.exports=a(13)(1689)},58:function(e,t,a){e.exports=a(13)(422)},59:function(e,t){(function(t){e.exports=t}).call(this,{})},63:function(e,t,a){"use strict";a.d(t,"c",(function(){return le})),a.d(t,"b",(function(){return ce})),a.d(t,"a",(function(){return ue}));var i=a(1),n=a.n(i),r=a(20),s=a(0),o=a(36),l=a(30),c=a(48);function u(e,t){var a;const{services:{storage:n}}=Object(c.a)(),[r,s]=Object(i.useState)(null!==(a=n.get(e))&&void 0!==a?a:t);return[r,Object(i.useCallback)((t=>{try{n.set(e,t),s(t)}catch(e){throw new Error("Unable to update storage with provided value")}}),[e,n])]}var d=a(21),p=a(25),m=a.n(p),b=(a(32),a(51)),f=a(9),g=a(22);const h=e=>{const t={term:{_tier:{value:"data_frozen"}}};if(!e)return{bool:{must_not:[t]}};const a=Object(g.cloneDeep)(e);return delete a.match_all,Object(b.isPopulatedObject)(a.bool)?Array.isArray(a.bool.must_not)?a.bool.must_not.push(t):(Object(b.isPopulatedObject)(a.bool.must_not)&&(a.bool.must_not=[a.bool.must_not,t]),void 0===a.bool.must_not&&(a.bool.must_not=[t])):a.bool={must_not:[t]},a};var x=a(5);const v="exclude-frozen",j=({timefilter:e,dataView:t,query:a,disabled:n,callback:o})=>{const{services:{notifications:{toasts:l}}}=Object(c.a)(),p=Object(i.useCallback)((async(t,a,i)=>{try{const n=await async function(e,t,a,i,n){const r=t.getRuntimeMappings(),o=await async function({index:e,timeFieldName:t,query:a,runtimeMappings:i}){const n=JSON.stringify({index:e,timeFieldName:t,query:a,runtimeMappings:i}),r=await Object(f.a)();return await r.getHttp().fetch({path:"/internal/file_upload/time_field_range",method:"POST",body:n})}({index:t.title,timeFieldName:t.timeFieldName,query:i?h(a):a,...Object(b.isPopulatedObject)(r)?{runtimeMappings:r}:{}});return o.start.epoch&&o.end.epoch?e.setTime({from:m()(o.start.epoch).toISOString(),to:m()(o.end.epoch).toISOString()}):null==n||n.addWarning({title:s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.noResults",{defaultMessage:"No results match your search criteria"})}),o}(e,t,a,i,l);"function"==typeof o&&o(n)}catch(e){l.addDanger(s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.errorSettingTimeRangeNotification",{defaultMessage:"An error occurred setting the time range."}))}}),[o,e,l]),[g,j]=Object(i.useState)(!1),[y,O]=u("dataVisualizer.frozenDataTierPreference",v),S=Object(i.useCallback)((e=>{O(e),p(t,a,e===v),E()}),[t,a,O,p]),E=()=>{j(!1)},w=Object(i.useMemo)((()=>[{id:v,label:s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.useFullDataExcludingFrozenMenuLabel",{defaultMessage:"Exclude frozen data tier"})},{id:"include-frozen",label:s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.useFullDataIncludingFrozenMenuLabel",{defaultMessage:"Include frozen data tier"})}]),[]),F=Object(i.useMemo)((()=>Object(x.jsx)(r.EuiPanel,null,Object(x.jsx)(r.EuiRadioGroup,{options:w,idSelected:y,onChange:S,compressed:!0}))),[w,y,S]),_=Object(i.useMemo)((()=>y===v?Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.fullTimeRangeSelector.useFullDataExcludingFrozenButtonTooltip",defaultMessage:"Use full range of data excluding frozen data tier."}):Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.fullTimeRangeSelector.useFullDataIncludingFrozenButtonTooltip",defaultMessage:"Use full range of data including frozen data tier, which might have slower search results."})),[y]);return Object(x.jsx)(r.EuiFlexGroup,{responsive:!1,gutterSize:"xs",alignItems:"center"},Object(x.jsx)(r.EuiToolTip,{content:_},Object(x.jsx)(r.EuiButton,{isDisabled:n,onClick:()=>p(t,a,!0),"data-test-subj":"dataVisualizerButtonUseFullData"},Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.index.fullTimeRangeSelector.useFullDataButtonLabel",defaultMessage:"Use full data"}))),Object(x.jsx)(r.EuiFlexItem,{grow:!1},Object(x.jsx)(r.EuiPopover,{id:"mlFullTimeRangeSelectorOption",button:Object(x.jsx)(r.EuiButtonIcon,{display:"base",size:"m",iconType:"boxesVertical","aria-label":s.i18n.translate("xpack.dataVisualizer.index.fullTimeRangeSelector.moreOptionsButtonAriaLabel",{defaultMessage:"More options"}),onClick:()=>{j(!g)}}),isOpen:g,closePopover:E,panelPaddingSize:"none",anchorPosition:"downRight"},F)))};var y=a(10),O=a(73),S=a(91),E=a(65),w=a(84),F=a(95);const _=({metricsStats:e,fieldsCountStats:t,showEmptyFields:a,toggleShowEmptyFields:i})=>Object(x.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"xs","data-test-subj":"dataVisualizerFieldCountPanel",responsive:!1,className:"dvFieldCount__panel"},Object(x.jsx)(F.b,{fieldsCountStats:t}),Object(x.jsx)(F.a,{metricsStats:e}),Object(x.jsx)(r.EuiFlexItem,{className:"dvFieldCount__item"},Object(x.jsx)(r.EuiSwitch,{"data-test-subj":"dataVisualizerShowEmptyFieldsSwitch",label:Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.showEmptyFields",defaultMessage:"Show empty fields"}),checked:a,onChange:i})));var M=a(57),N=a(72);const T=({totalCount:e,approximate:t,loading:a})=>Object(x.jsx)(r.EuiFlexItem,{grow:!1,style:{flexDirection:"row"}},Object(x.jsx)(r.EuiText,{size:"s","data-test-subj":"dataVisualizerTotalDocCountHeader",textAlign:"center"},Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.totalDocCountLabel",defaultMessage:"Total documents: {prepend}{strongTotalCount}",values:{prepend:!a&&t?"~":"",strongTotalCount:a?Object(x.jsx)(r.EuiLoadingSpinner,{size:"s"}):Object(x.jsx)("strong",{"data-test-subj":"dataVisualizerTotalDocCount"},Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.totalDocCountNumber",defaultMessage:"{totalCount, plural, one {#} other {#}}",values:{totalCount:t?e.toPrecision(3):e}}))}})),t?Object(x.jsx)(r.EuiIconTip,{content:s.i18n.translate("xpack.dataVisualizer.searchPanel.randomSamplerMessage",{defaultMessage:"Approximate values are shown in the total document count and chart, which use random sampler aggregations."}),position:"right",type:"iInCircle"}):null);var z=a(27),A=a(42);function I(){return Object(x.jsx)(r.EuiFlexItem,{style:{alignItems:"center"}},Object(x.jsx)(r.EuiLoadingSpinner,{size:"l","data-test-subj":"loadingSpinner"}))}const V=({width:e,chartPoints:t,timeRangeEarliest:a,timeRangeLatest:n,interval:r,loading:o})=>{const{services:{data:l,uiSettings:u,fieldFormats:d,charts:p}}=Object(c.a)(),b=p.theme.useChartsTheme(),f=p.theme.useChartsBaseTheme(),g=d.deserialize({id:"date"}),h=u.get("visualization:useLegacyTimeAxis",!1),v=s.i18n.translate("xpack.dataVisualizer.dataGrid.field.documentCountChart.seriesLabel",{defaultMessage:"document count"}),j={min:a,max:n},y=Object(i.useMemo)((()=>t.length<1?[{time:a,value:0}]:1===t.length?[...t,{time:r?Number(t[0].time)+r:a,value:0}]:t),[t,a,n,r]),O=Object(i.useCallback)((e=>{l.query.timefilter.timefilter.setTime({from:m()(e.from).toISOString(),to:m()(e.to).toISOString(),mode:"absolute"})}),[l]),S=function(e){return e.isDefault("dateFormat:tz")?m.a.tz.guess()||m()().format("Z"):e.get("dateFormat:tz","Browser")}(u);return Object(x.jsx)("div",{style:{width:null!=e?e:"100%",height:120,display:"flex",alignItems:"center"},"data-test-subj":"dataVisualizerDocumentCountChart"},o?Object(x.jsx)(I,null):Object(x.jsx)(z.Chart,{size:{width:"100%"}},Object(x.jsx)(z.Settings,{xDomain:j,onBrushEnd:({x:e})=>{if(!e)return;const[t,a]=e;O({from:t,to:a})},onElementClick:([e])=>{const t=e[0].x;O({from:t,to:t+r})},theme:b,baseTheme:f}),Object(x.jsx)(z.Axis,{id:"bottom",position:z.Position.Bottom,showOverlappingTicks:!0,tickFormat:e=>g.convert(e),timeAxisLayerCount:h?0:2,style:h?{}:A.MULTILAYER_TIME_AXIS_STYLE}),Object(x.jsx)(z.Axis,{id:"left",position:z.Position.Left}),Object(x.jsx)(z.BarSeries,{id:"document_count",name:v,xScaleType:z.ScaleType.Time,yScaleType:z.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:y,timeZone:S})))},R=({documentCountStats:e,totalCount:t,samplingProbability:a,setSamplingProbability:o,loading:l,randomSamplerPreference:c,setRandomSamplerPreference:u})=>{const[p,m]=Object(i.useState)(!1),b=Object(i.useCallback)((()=>{m(!p)}),[p]),f=Object(i.useCallback)((()=>{m(!1)}),[m]),h=Object(i.useCallback)(Object(g.debounce)((e=>{if(o){const t=Object(g.sortedIndex)(N.b,e),a=N.b[t-1],i=N.b[t],n=Math.abs(a-e)<Math.abs(i-e)?a:i;o(n/100)}}),100),[o]),v=Object(i.useMemo)((()=>{switch(c){case N.a.OFF:return s.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.offCalloutMessage",{defaultMessage:"Random sampling can be turned on for the total document count and chart to increase speed although some accuracy will be lost."});case N.a.ON_AUTOMATIC:return s.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.onAutomaticCalloutMessage",{defaultMessage:"The total document count and chart use random sampler aggregations. The probability is automatically set to balance accuracy and speed."});case N.a.ON_MANUAL:default:return s.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.onManualCalloutMessage",{defaultMessage:"The total document count and chart use random sampler aggregations. A lower percentage probability increases performance, but some accuracy is lost."})}}),[c]);if(void 0===e)return void 0!==t?Object(x.jsx)(T,{totalCount:t}):null;const{timeRangeEarliest:j,timeRangeLatest:y}=e;if(void 0===j||void 0===y)return Object(x.jsx)(T,{totalCount:t});let O=[];if(void 0!==e.buckets){const t=null==e?void 0:e.buckets;O=Object.entries(t).map((([e,t])=>({time:+e,value:t})))}const S=!0===e.randomlySampled,E=c!==N.a.OFF&&Object(M.a)(a)?Object(x.jsx)("div",{"data-test-subj":"dvRandomSamplerAutomaticProbabilityMsg"},Object(x.jsx)(r.EuiSpacer,{size:"m"}),Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.randomSamplerSettingsPopUp.probabilityLabel",defaultMessage:"Probability used: {samplingProbability}%",values:{samplingProbability:100*a}})):null;return Object(x.jsx)(n.a.Fragment,null,Object(x.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},Object(x.jsx)(T,{totalCount:t,approximate:S,loading:l}),Object(x.jsx)(r.EuiFlexItem,{grow:!1,style:{marginLeft:"auto"}},Object(x.jsx)(r.EuiPopover,{"data-test-subj":"dvRandomSamplerOptionsPopover",id:"dataVisualizerSamplingOptions",button:Object(x.jsx)(r.EuiToolTip,{content:s.i18n.translate("xpack.dataVisualizer.samplingOptionsButton",{defaultMessage:"Sampling options"})},Object(x.jsx)(r.EuiButtonIcon,{size:"xs",iconType:"gear",onClick:b,"data-test-subj":"dvRandomSamplerOptionsButton","aria-label":s.i18n.translate("xpack.dataVisualizer.samplingOptionsButton",{defaultMessage:"Sampling options"})})),isOpen:p,closePopover:f,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(x.jsx)(r.EuiPanel,{style:{maxWidth:400}},Object(x.jsx)(r.EuiFlexItem,{grow:!0},Object(x.jsx)(r.EuiCallOut,{size:"s",color:"primary",title:v})),Object(x.jsx)(r.EuiSpacer,{size:"m"}),Object(x.jsx)(r.EuiFormRow,{"data-test-subj":"dvRandomSamplerOptionsFormRow",label:s.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.randomSamplerRowLabel",{defaultMessage:"Random sampling"})},Object(x.jsx)(r.EuiSelect,{"data-test-subj":"dvRandomSamplerOptionsSelect",options:N.c,value:c,onChange:e=>u(e.target.value)})),c===N.a.ON_MANUAL?Object(x.jsx)(r.EuiFlexItem,{grow:!0},Object(x.jsx)(r.EuiSpacer,{size:"m"}),Object(x.jsx)(r.EuiFormRow,{label:s.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.randomSamplerPercentageRowLabel",{defaultMessage:"Sampling percentage"})},Object(x.jsx)(r.EuiRange,{fullWidth:!0,showValue:!0,showTicks:!0,showRange:!1,min:N.d,max:50,value:100*(null!=a?a:1),ticks:N.b.map((e=>({value:e,label:.001===e||e>=5?`${e}%`:""}))),onChange:e=>h(Number(e.currentTarget.value)),step:N.d,"data-test-subj":"dvRandomSamplerProbabilityRange"}))):E)),Object(x.jsx)(r.EuiFlexItem,null))),Object(x.jsx)(V,{chartPoints:O,timeRangeEarliest:j,timeRangeLatest:y,interval:e.interval,loading:l}))};var P=a(4),k=a(62),C=a(68);const D=({overallStats:e,setVisibleFieldNames:t,visibleFieldNames:a,showEmptyFields:n})=>{const r=Object(i.useMemo)((()=>{const t=[];return e&&Object.keys(e).forEach((a=>{const i=e[a];Array.isArray(i)&&i.length>0&&i.forEach((e=>{!0!==e.existsInDocs&&!0!==n||void 0===e.fieldName?t.push({value:e.fieldName,disabled:!0}):t.push({value:e.fieldName})}))})),t}),[e,n]),o=Object(i.useMemo)((()=>s.i18n.translate("xpack.dataVisualizer.index.fieldNameSelect",{defaultMessage:"Field name"})),[]);return Object(x.jsx)(C.a,{title:o,options:r,onChange:t,checkedOptions:a,dataTestSubj:"dataVisualizerFieldNameSelect"})};var L=a(82),B=a(76);const q=({indexedFieldTypes:e,setVisibleFieldTypes:t,visibleFieldTypes:a})=>{const o=Object(i.useMemo)((()=>e.map((e=>{var t;const a=null!==(t=k.b[e])&&void 0!==t?t:"";return{value:e,name:Object(x.jsx)(r.EuiFlexGroup,null,Object(x.jsx)(r.EuiFlexItem,{grow:!0}," ",a),e&&Object(x.jsx)(r.EuiFlexItem,{grow:!1},Object(x.jsx)(B.a,{type:e,tooltipEnabled:!1})))}}))),[e]),l=Object(i.useMemo)((()=>s.i18n.translate("xpack.dataVisualizer.index.fieldTypeSelect",{defaultMessage:"Field type"})),[]);return Object(x.jsx)(n.a.Fragment,null,Object(x.jsx)(C.a,{title:l,options:o,onChange:t,checkedOptions:a,dataTestSubj:"dataVisualizerFieldTypeSelect",postfix:Object(x.jsx)(L.a,{fieldTypes:e})}))};a(136);var U=a(75),G={name:"np6nlf",styles:"margin-left:0px!important;padding-left:0px!important;padding-right:0px!important"};const Q=({dataView:e,searchString:t,searchQueryLanguage:a,samplerShardSize:n,setSamplerShardSize:o,overallStats:l,indexedFieldTypes:u,setVisibleFieldTypes:d,visibleFieldTypes:p,setVisibleFieldNames:m,visibleFieldNames:b,setSearchParams:f,showEmptyFields:g})=>{const{services:{uiSettings:h,notifications:{toasts:v},data:{query:j},unifiedSearch:{ui:{SearchBar:y}}}}=Object(c.a)(),[O,S]=Object(i.useState)({query:t||"",language:a});Object(i.useEffect)((()=>{S({query:t||"",language:a})}),[a,t,j.filterManager]);const E=({query:t,filters:a})=>{const i=Object(M.a)(t)?t:O,n=Object(M.a)(a)?a:j.filterManager.getFilters();try{var r;n&&j.filterManager.setFilters(n);const t=Object(U.a)(i,null!==(r=j.filterManager.getFilters())&&void 0!==r?r:[],e,h);f({searchQuery:t,searchString:i.query,queryLanguage:i.language,filters:n})}catch(e){console.log("Invalid syntax",JSON.stringify(e,null,2)),v.addError(e,{title:s.i18n.translate("xpack.dataVisualizer.searchPanel.invalidSyntax",{defaultMessage:"Invalid syntax"})})}};return Object(x.jsx)(r.EuiFlexGroup,{gutterSize:"s","data-test-subj":"dataVisualizerSearchPanel",className:"dvSearchPanel__container",responsive:!1},Object(x.jsx)(r.EuiFlexItem,{grow:9,className:"dvSearchBar"},Object(x.jsx)(y,{dataTestSubj:"dataVisualizerQueryInput",appName:"dataVisualizer",showFilterBar:!0,showDatePicker:!1,showQueryInput:!0,query:O,onQuerySubmit:e=>E({query:e.query}),onFiltersUpdated:e=>E({filters:e}),indexPatterns:[e],placeholder:s.i18n.translate("xpack.dataVisualizer.searchPanel.queryBarPlaceholderText",{defaultMessage:'Searchâ€¦ (e.g. status:200 AND extension:"PHP")'}),displayStyle:"inPage",isClearable:!0,customSubmitButton:Object(x.jsx)("div",null)})),Object(x.jsx)(r.EuiFlexItem,{grow:2,className:"dvSearchPanel__controls",css:G},Object(x.jsx)(D,{overallStats:l,setVisibleFieldNames:m,visibleFieldNames:b,showEmptyFields:g}),Object(x.jsx)(q,{indexedFieldTypes:u,setVisibleFieldTypes:d,visibleFieldTypes:p})))};var $=a(71),H=a.n($);const J=({icon:e,iconAreaLabel:t,title:a,description:i,onClick:n,href:s,isDisabled:o,"data-test-subj":l})=>{const c={...s?{href:s}:{},...n?{onClick:n}:{}};return Object(x.jsx)(r.EuiPanel,{style:{cursor:o?"not-allowed":void 0},hasShadow:!1,hasBorder:!0},Object(x.jsx)(r.EuiLink,H()({style:{display:"block",pointerEvents:o?"none":void 0,background:"transparent",outline:"none"},"data-test-subj":l,color:"subdued"},c),Object(x.jsx)(r.EuiFlexGroup,{gutterSize:"l",responsive:!0},Object(x.jsx)(r.EuiFlexItem,{grow:!1,style:{paddingTop:"8px"}},"string"==typeof e?Object(x.jsx)(r.EuiIcon,{size:"xl",type:e,"aria-label":t}):e),Object(x.jsx)(r.EuiFlexItem,null,Object(x.jsx)(r.EuiTitle,{size:"xs"},Object(x.jsx)("h3",null,a)),Object(x.jsx)(r.EuiText,{color:"subdued",size:"s"},Object(x.jsx)("p",null,i))))))},X=({dataView:e,searchString:t,searchQueryLanguage:a,getAdditionalLinks:o})=>{const[l]=Object(y.f)("_g"),[u,p]=Object(i.useState)(""),[m,b]=Object(i.useState)(),{services:{data:f,application:{capabilities:h},discover:v}}=Object(c.a)();return Object(i.useEffect)((()=>{let i=!1;const n=e.id,r=e.title;return Array.isArray(o)&&void 0!==n&&Promise.all(o.map((async e=>{const t=await e({dataViewId:n,dataViewTitle:r});if(Array.isArray(t))return await Promise.all(t.map((async e=>({...e,canDisplay:await e.canDisplay(),href:await e.getUrl()}))))}))).then((e=>{b(Object(g.flatten)(e).filter(M.a).filter((e=>!0===e.canDisplay)))})),(async()=>{var e,r,s;if(null===(e=null===(r=h.discover)||void 0===r?void 0:r.show)||void 0===e||!e)return;if(!v.locator)return void console.error("Discover locator not available");const o=await v.locator.getUrl({indexPatternId:n,filters:null!==(s=f.query.filterManager.getFilters())&&void 0!==s?s:[],query:t&&void 0!==a?{query:t,language:a}:void 0,timeRange:null!=l&&l.time?l.time:void 0,refreshInterval:null!=l&&l.refreshInterval?l.refreshInterval:void 0});i||p(o)})(),()=>{i=!0}}),[e,t,a,l,h,v,f.query,o]),Object(x.jsx)("div",{"data-test-subj":"dataVisualizerActionsPanel"},u&&Object(x.jsx)(n.a.Fragment,null,Object(x.jsx)(r.EuiTitle,{size:"s"},Object(x.jsx)("h2",null,Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.exploreTitle",defaultMessage:"Explore your data"}))),Object(x.jsx)(r.EuiSpacer,{size:"m"}),Object(x.jsx)(J,{href:u,icon:"discoverApp",description:s.i18n.translate("xpack.dataVisualizer.index.actionsPanel.viewIndexInDiscoverDescription",{defaultMessage:"Explore the documents in your index."}),title:Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.discoverAppTitle",defaultMessage:"Discover"}),"data-test-subj":"dataVisualizerViewInDiscoverCard"}),Object(x.jsx)(r.EuiSpacer,{size:"m"})),Array.isArray(m)&&m.map((e=>Object(x.jsx)(n.a.Fragment,null,Object(x.jsx)(J,{href:e.href,icon:e.icon,description:e.description,title:e.title,"data-test-subj":e["data-test-subj"]}),Object(x.jsx)(r.EuiSpacer,{size:"m"})))))};var Y=a(23),K=a(26),W=a(85),Z=a(66);const ee=5e3;function te(e){Z.a.next({lastRefresh:Date.now(),timeRange:e})}const ae=({isAutoRefreshOnly:e,showRefresh:t})=>{var a,n,o;const{services:u,notifications:{toasts:p}}=Object(c.a)(),m=u.uiSettings,b=u.theme.theme$,{timefilter:f,history:h}=u.data.query.timefilter,[v,j]=Object(y.f)("_g"),O=(S=h,function(){var e,t;return null!==(e=null===(t=S.get())||void 0===t?void 0:t.map((({from:e,to:t})=>({start:e,end:t}))))&&void 0!==e?e:[]});var S;const E=Object(W.a)(),w=Object(W.b)();Object(i.useEffect)((function(){void 0!==(null==v?void 0:v.time)&&f.setTime({from:v.time.from,to:v.time.to})}),[null==v||null===(a=v.time)||void 0===a?void 0:a.from,null==v||null===(n=v.time)||void 0===n?void 0:n.to,null==v||null===(o=v.time)||void 0===o?void 0:o.ts]),Object(i.useEffect)((function(){var e,t;void 0!==(null==v?void 0:v.refreshInterval)&&f.setRefreshInterval({pause:!(null==v||null===(e=v.refreshInterval)||void 0===e||!e.pause),value:null==v||null===(t=v.refreshInterval)||void 0===t?void 0:t.value})}),[null==v?void 0:v.refreshInterval]);const F=Object(i.useCallback)(Object(g.debounce)((e=>{j("refreshInterval",e,!0)}),200),[j]),[_,M]=Object(i.useState)(O()),[N,T]=Object(i.useState)(f.isAutoRefreshSelectorEnabled()),[z,A]=Object(i.useState)(f.isTimeRangeSelectorEnabled()),I=Object(i.useMemo)((()=>{var e;return null!==(e=null==v?void 0:v.refreshInterval)&&void 0!==e?e:E}),[JSON.stringify(null==v?void 0:v.refreshInterval),E]);Object(i.useEffect)((function(){I.value<ee&&!I.pause&&p.warning({title:s.i18n.translate("xpack.dataVisualizer.index.datePicker.shortRefreshIntervalURLWarningMessage",{defaultMessage:"The refresh interval in the URL is shorter than the minimum supported by Machine Learning."}),body:Object(K.wrapWithTheme)(Object(x.jsx)(r.EuiButton,{onClick:F.bind(null,{pause:I.pause,value:ee})},Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.index.pageRefreshResetButton",defaultMessage:"Set to {defaultInterval}",values:{defaultInterval:"5s"}})),b),toastLifeTimeMs:3e4})}),[JSON.stringify(I),JSON.stringify(null==v?void 0:v.refreshInterval),F]);const V=m.get("dateFormat"),R=m.get(l.UI_SETTINGS.TIMEPICKER_QUICK_RANGES),P=Object(i.useMemo)((()=>R.map((({from:e,to:t,display:a})=>({start:e,end:t,label:a})))),[R]);Object(i.useEffect)((()=>{const e=new Y.Subscription,t=f.getEnabledUpdated$();return void 0!==t&&e.add(t.subscribe((e=>{T(f.isAutoRefreshSelectorEnabled()),A(f.isTimeRangeSelectorEnabled())}))),function(){e.unsubscribe()}}),[]);const k=Object(i.useCallback)((({start:e,end:t})=>{M(O()),j("time",{from:e,to:t,..."now"===e||"now"===t?{ts:Date.now()}:{}})}),[j]);return N||z?Object(x.jsx)(r.EuiFlexGroup,{gutterSize:"s",alignItems:"center",className:"mlNavigationMenu__datePickerWrapper"},Object(x.jsx)(r.EuiFlexItem,{grow:!1},Object(x.jsx)(r.EuiSuperDatePicker,{start:w.from,end:w.to,isPaused:I.pause,isAutoRefreshOnly:!z||e,refreshInterval:I.value||ee,onTimeChange:k,onRefresh:te,onRefreshChange:function({isPaused:e,refreshInterval:t}){F({pause:e,value:t})},recentlyUsedRanges:_,dateFormat:V,commonlyUsedRanges:P})),!0!==t&&z?null:Object(x.jsx)(r.EuiFlexItem,{grow:!1},Object(x.jsx)(r.EuiButton,{fill:!0,color:"primary",iconType:"refresh",onClick:()=>te(),"data-test-subj":"dataVisualizerRefreshPageButton"},Object(x.jsx)(d.FormattedMessage,{id:"xpack.dataVisualizer.index.pageRefreshButton",defaultMessage:"Refresh"})))):null};var ie=a(86);const ne=n.a.memo((({docLink:e})=>{const{chrome:t}=Object(c.a)().services;return Object(i.useEffect)((()=>{t.setHelpExtension({appName:ie.a,links:[{href:e,linkType:"documentation"}]})}),[t,e]),null}));function re(e){const{services:{dataViewFieldEditor:t,application:a}}=Object(c.a)(),{useNewFieldsApi:n,currentDataView:o}=e,l=!!(null==t?void 0:t.userPermissions.editIndexPattern())&&n,[u,d]=Object(i.useState)(!1),p=Object(i.useRef)();return Object(i.useEffect)((()=>()=>{p.current&&p.current()}),[]),void 0!==t&&o&&l?Object(x.jsx)(r.EuiPopover,{panelPaddingSize:"s",isOpen:u,closePopover:()=>{d(!1)},ownFocus:!0,"data-test-subj":"dataVisualizerDataViewManagementPopover",button:Object(x.jsx)(r.EuiButtonIcon,{color:"text",iconType:"boxesHorizontal","data-test-subj":"dataVisualizerDataViewManagementButton","aria-label":s.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.actionsPopoverLabel",{defaultMessage:"Data view settings"}),onClick:()=>{d(!u)}})},Object(x.jsx)(r.EuiContextMenuPanel,{"data-test-subj":"dataVisualizerDataViewManagementMenu",size:"s",items:[Object(x.jsx)(r.EuiContextMenuItem,{key:"add",icon:"indexOpen","data-test-subj":"dataVisualizerAddDataViewFieldAction",onClick:()=>{d(!1),p.current=t.openEditor({ctx:{dataView:o},onSave:()=>{const e={lastRefresh:Date.now()};Z.a.next(e)}})}},s.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.addFieldButton",{defaultMessage:"Add field to data view"})),Object(x.jsx)(r.EuiContextMenuItem,{key:"manage",icon:"indexSettings","data-test-subj":"dataVisualizerManageDataViewAction",onClick:()=>{var t;d(!1),a.navigateToApp("management",{path:`/kibana/dataViews/dataView/${null===(t=e.currentDataView)||void 0===t?void 0:t.id}`})}},s.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.manageFieldButton",{defaultMessage:"Manage data view fields"}))]})):null}ne.displayName="HelpMenu";var se=a(89);a(149);const oe={match_all:{}};function le(){return{overallStats:{totalCount:0,aggregatableExistsFields:[],aggregatableNotExistsFields:[],nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]},metricConfigs:[],totalMetricFieldCount:0,populatedMetricFieldCount:0,metricsLoaded:!1,nonMetricConfigs:[],nonMetricsLoaded:!1,documentCountStats:void 0}}const ce=e=>({pageIndex:0,pageSize:25,sortField:"fieldName",sortDirection:"asc",visibleFieldTypes:[],visibleFieldNames:[],samplerShardSize:5e3,searchString:"",searchQuery:oe,searchQueryLanguage:w.a.KUERY,filters:[],showDistributions:!0,showAllFields:!1,showEmptyFields:!1,probability:null,rndSamplerPref:N.a.ON_AUTOMATIC,...e}),ue=e=>{var t,a,d,p,m;const[b,f]=u("dataVisualizer.randomSamplerPreference",N.a.ON_AUTOMATIC),g=Object(i.useMemo)((()=>ce({rndSamplerPref:b})),[]),{services:h}=Object(c.a)(),{docLinks:v,notifications:w,uiSettings:F,data:M}=h,{toasts:T}=w,[z,A]=Object(y.e)(E.a,g),[I,V]=Object(y.f)("_g"),[C,D]=Object(i.useState)(e.currentSavedSearch),{currentDataView:L,currentSessionId:B,getAdditionalLinks:q}=e;Object(i.useEffect)((()=>{void 0!==(null==e?void 0:e.currentSavedSearch)&&D(null==e?void 0:e.currentSavedSearch)}),[null==e?void 0:e.currentSavedSearch]),Object(i.useEffect)((()=>{L.isTimeBased()||T.addWarning({title:s.i18n.translate("xpack.dataVisualizer.index.dataViewNotBasedOnTimeSeriesNotificationTitle",{defaultMessage:"The data view {dataViewTitle} is not based on a time series",values:{dataViewTitle:L.title}}),text:s.i18n.translate("xpack.dataVisualizer.index.dataViewNotBasedOnTimeSeriesNotificationDescription",{defaultMessage:"Anomaly detection only runs over time-based indices"})})}),[L,T]);const G=L.fields,$=Object(i.useMemo)((()=>{const e=[];return G.forEach((t=>{if(!P.g.includes(t.name)&&!0!==t.scripted){const a=Object(k.c)(t);void 0===a||e.includes(a)||e.push(a)}})),e.sort()}),[G]),H=Object(i.useCallback)((e=>{null!==C&&D(null),A({...z,searchQuery:e.searchQuery,searchString:e.searchString,searchQueryLanguage:e.queryLanguage,filters:e.filters})}),[C,z,A]),J=null!==(t=z.samplerShardSize)&&void 0!==t?t:g.samplerShardSize,Y=null!==(a=z.visibleFieldTypes)&&void 0!==a?a:g.visibleFieldTypes,K=null!==(d=z.visibleFieldNames)&&void 0!==d?d:g.visibleFieldNames,W=null!==(p=z.showEmptyFields)&&void 0!==p?p:g.showEmptyFields,Z=Object(i.useMemo)((()=>({dataView:L,savedSearch:C,sessionId:B,visibleFieldNames:K,allowEditDataView:!0})),[L.id,null==C?void 0:C.id,K,B]),{configs:ee,searchQueryLanguage:te,searchString:ie,overallStats:oe,searchQuery:le,documentCountStats:ue,metricsStats:de,timefilter:pe,setLastRefresh:me,progress:be,extendedColumns:fe,overallStatsProgress:ge}=Object(se.a)(Z,z,b,V);Object(i.useEffect)((()=>{var e,t;switch(b){case N.a.OFF:return void he(1);case N.a.ON_MANUAL:return void he(null!==(e=null!==(t=null==z?void 0:z.probability)&&void 0!==t?t:null==ue?void 0:ue.probability)&&void 0!==e?e:null);case N.a.ON_AUTOMATIC:default:return void he(null)}}),[z.probability,null==ue?void 0:ue.probability,b]);const he=e=>{A({...z,probability:e})};Object(i.useEffect)((function(){return()=>{M.query.filterManager.getFilters().filter((e=>{var t;return(null===(t=e.$state)||void 0===t?void 0:t.store)===o.FilterStateStore.APP_STATE})).forEach((e=>M.query.filterManager.removeFilter(e)))}}),[M.query.filterManager]),Object(i.useEffect)((()=>{me(Date.now())}),[L.id,me]),Object(i.useEffect)((()=>{void 0!==(null==I?void 0:I.time)&&pe.setTime({from:I.time.from,to:I.time.to})}),[JSON.stringify(null==I?void 0:I.time),pe]),Object(i.useEffect)((()=>{void 0!==(null==I?void 0:I.refreshInterval)&&pe.setRefreshInterval(I.refreshInterval)}),[JSON.stringify(null==I?void 0:I.refreshInterval),pe]);const xe=Object(i.useCallback)(((e,t,a)=>{var i;const n=Object(l.generateFilters)(M.query.filterManager,e,t,a,L);n&&M.query.filterManager.addFilters(n);const r={query:ie||"",language:te},s=Object(U.a)({query:ie||"",language:te},null!==(i=M.query.filterManager.getFilters())&&void 0!==i?i:[],L,F);H({searchQuery:s,searchString:r.query,queryLanguage:r.language,filters:M.query.filterManager.getFilters()})}),[L,M.query.filterManager,te,ie,H,F]),ve=Object(i.useMemo)((()=>{let e=0,t=0;return Object.keys(oe).forEach((e=>{const a=oe[e];Array.isArray(a)&&a.length>0&&(t+=a.length)})),e=!0===W?t:oe.aggregatableExistsFields.length+oe.nonAggregatableExistsFields.length,{visibleFieldsCount:e,totalFieldsCount:t}}),[oe,W]),je=Object(i.useCallback)((function(e,t){return e.reduce(((e,a)=>{const i=t.find((e=>e.fieldName===a));return void 0!==i&&(e[a]=Object(x.jsx)(S.a,{item:i,dataView:L,combinedQuery:{searchQueryLanguage:te,searchString:ie},onAddFilter:xe,totalDocuments:oe.totalCount})),e}),{})}),[L,te,ie,xe,oe.totalCount]),ye=Object(i.useRef)();Object(i.useEffect)((()=>{const e=ye;return()=>{e.current&&e.current()}}),[]),Object(i.useEffect)((()=>{null==M||M.query.queryString.setQuery({query:ie,language:te})}),[M,te,ie]);const Oe=Object(i.useMemo)((()=>void 0!==L.timeFieldName&&""!==L.timeFieldName),[L.timeFieldName]),Se=v.links.ml.guide;return Object(x.jsx)(i.Fragment,null,Object(x.jsx)(r.EuiPageBody,{"data-test-subj":"dataVisualizerIndexPage",paddingSize:"none",panelled:!1},Object(x.jsx)(r.EuiFlexGroup,{gutterSize:"m"},Object(x.jsx)(r.EuiFlexItem,null,Object(x.jsx)(r.EuiPageContentHeader_Deprecated,{className:"dataVisualizerPageHeader"},Object(x.jsx)(r.EuiPageContentHeaderSection_Deprecated,null,Object(x.jsx)("div",{className:"dataViewTitleHeader"},Object(x.jsx)(r.EuiTitle,{size:"s"},Object(x.jsx)("h2",null,L.getName())),Object(x.jsx)(re,{currentDataView:L,useNewFieldsApi:!0}))),Object(x.jsx)(r.EuiFlexGroup,{alignItems:"center",justifyContent:"flexEnd",gutterSize:"s","data-test-subj":"dataVisualizerTimeRangeSelectorSection"},Oe?Object(x.jsx)(r.EuiFlexItem,{grow:!1},Object(x.jsx)(j,{dataView:L,query:void 0,disabled:!1,timefilter:pe})):null,Object(x.jsx)(r.EuiFlexItem,{grow:!1},Object(x.jsx)(ae,{isAutoRefreshOnly:!Oe,showRefresh:!Oe})))))),Object(x.jsx)(r.EuiSpacer,{size:"m"}),Object(x.jsx)(r.EuiPageContentBody_Deprecated,null,Object(x.jsx)(r.EuiFlexGroup,{gutterSize:"m"},Object(x.jsx)(r.EuiFlexItem,null,Object(x.jsx)(r.EuiPanel,{hasShadow:!1,hasBorder:!0},Object(x.jsx)(Q,{dataView:L,searchString:ie,searchQuery:le,searchQueryLanguage:te,setSearchParams:H,samplerShardSize:J,setSamplerShardSize:e=>{A({...z,samplerShardSize:e})},overallStats:oe,indexedFieldTypes:$,setVisibleFieldTypes:e=>{A({...z,visibleFieldTypes:e})},visibleFieldTypes:Y,visibleFieldNames:K,setVisibleFieldNames:e=>{A({...z,visibleFieldNames:e})},showEmptyFields:W,onAddFilter:xe}),void 0!==(null==oe?void 0:oe.totalCount)&&Object(x.jsx)(n.a.Fragment,null,Object(x.jsx)(r.EuiSpacer,{size:"m"}),Object(x.jsx)(r.EuiFlexItem,{grow:!0},Object(x.jsx)(R,{documentCountStats:ue,totalCount:oe.totalCount,setSamplingProbability:he,samplingProbability:null===z.probability?null==ue?void 0:ue.probability:z.probability,loading:ge.loaded<100,randomSamplerPreference:b,setRandomSamplerPreference:f}))),Object(x.jsx)(r.EuiSpacer,{size:"m"}),Object(x.jsx)(_,{showEmptyFields:W,toggleShowEmptyFields:()=>{A({...z,showEmptyFields:!z.showEmptyFields})},fieldsCountStats:ve,metricsStats:de}),Object(x.jsx)(r.EuiSpacer,{size:"m"}),Object(x.jsx)(r.EuiProgress,{value:be,max:100,size:"xs"}),Object(x.jsx)(O.a,{items:ee,pageState:z,updatePageState:A,getItemIdToExpandedRowMap:je,extendedColumns:fe,loading:be<100,overallStatsRunning:ge.isRunning,showPreviewByDefault:null===(m=z.showDistributions)||void 0===m||m,onChange:A,totalCount:oe.totalCount}))),Object(x.jsx)(r.EuiFlexItem,{grow:!1,style:{width:"280px"}},Object(x.jsx)(X,{dataView:L,searchQueryLanguage:te,searchString:ie,getAdditionalLinks:q}))))),Object(x.jsx)(ne,{docLink:Se}))}},65:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n}));const i="DATA_VISUALIZER_INDEX_VIEWER",n=10},66:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));const i=new(a(23).Subject)},72:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"d",(function(){return r})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return o}));var i=a(0);const n=[.5,.25,.1,.05,.025,.01,.005,.0025,.001,5e-4,25e-5,1e-4,5e-5,1e-5].reverse().map((e=>100*e)),r=.001,s={ON_AUTOMATIC:"on_automatic",ON_MANUAL:"on_manual",OFF:"off"},o=[{"data-test-subj":"dvRandomSamplerOptionOnAutomatic",value:s.ON_AUTOMATIC,text:i.i18n.translate("xpack.dataVisualizer.randomSamplerPreference.onAutomaticLabel",{defaultMessage:"On - automatic"})},{"data-test-subj":"dvRandomSamplerOptionOnManual",value:s.ON_MANUAL,text:i.i18n.translate("xpack.dataVisualizer.randomSamplerPreference.onManualLabel",{defaultMessage:"On - manual"})},{"data-test-subj":"dvRandomSamplerOptionOff",value:s.OFF,text:i.i18n.translate("xpack.dataVisualizer.randomSamplerPreference.offLabel",{defaultMessage:"Off"})}]},75:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return d}));var i=a(22),n=a(36),r=a(8),s=a(84),o=a(51);const l={bool:{must:[{match_all:{}}]}};function c(){return Object(i.cloneDeep)(l)}function u(e,t,a,i){let o=c();if(e&&e.language===s.a.KUERY){const i=Object(n.fromKueryExpression)(e.query);if(""!==e.query&&(o=Object(n.toElasticsearchQuery)(i,a)),void 0!==o.bool){const e=Object(n.buildQueryFromFilters)(t,a);Array.isArray(o.bool.filter)||(o.bool.filter=void 0===o.bool.filter?[]:[o.bool.filter]),Array.isArray(o.bool.must_not)||(o.bool.must_not=void 0===o.bool.must_not?[]:[o.bool.must_not]),o.bool.filter=[...o.bool.filter,...e.filter],o.bool.must_not=[...o.bool.must_not,...e.must_not]}}else o=Object(n.buildEsQuery)(a,e?[e]:[],t||[],i?Object(r.getEsQueryConfig)(i):void 0);return o}function d({dataView:e,uiSettings:t,savedSearch:a,query:n,filters:s,filterManager:l}){if(!e||!a)return;const d=n,p=s;if(a&&"searchSource"in a&&(null==a?void 0:a.searchSource)instanceof r.SearchSource&&void 0!==a.searchSource.getParent()&&d){var m,b,f;const e=null!==(m=Object(i.cloneDeep)(null===(b=a.searchSource.getSearchRequestBody())||void 0===b?void 0:b.query))&&void 0!==m?m:c(),t=null===(f=a.searchSource.getField("index"))||void 0===f?void 0:f.timeFieldName;return Array.isArray(e.bool.filter)&&void 0!==t&&(e.bool.filter=e.bool.filter.filter((e=>{var a;return!(e.hasOwnProperty("range")&&null!==(a=e.range)&&void 0!==a&&a.hasOwnProperty(t))}))),{searchQuery:e,searchString:d.query,queryLanguage:d.language}}const g=function(e){var t;const a=(i=e,Object(o.isPopulatedObject)(i,["id","type","attributes"])?null==e||null===(t=e.attributes)||void 0===t?void 0:t.kibanaSavedObjectMeta:null==e?void 0:e.kibanaSavedObjectMeta);var i;const n="string"==typeof(null==a?void 0:a.searchSourceJSON)?JSON.parse(a.searchSourceJSON):void 0;return n&&Array.isArray(n.filter)&&n.filter.forEach((e=>{e.meta.indexRefName=void 0})),n}(a);if(!g&&d)return l&&p&&l.addFilters(p,!1),{searchQuery:u(d,Array.isArray(p)?p:[],e,t),searchString:d.query,queryLanguage:d.language};if(g){const a=null==l?void 0:l.getGlobalFilters(),i=null!=d?d:null==g?void 0:g.query,n=null!=p?p:null==g?void 0:g.filter;return l&&l.setFilters(n),a&&(null==l||l.addFilters(a)),{searchQuery:u(i,l?null==l?void 0:l.getFilters():n,e,t),searchString:i.query,queryLanguage:i.language}}}},84:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));const i={KUERY:"kuery",LUCENE:"lucene"}},85:function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return u}));var i=a(1),n=a(69),r=a.n(n),s=a(24),o=a(48);const l=({timeRangeSelector:e,autoRefreshSelector:t}={})=>{const{services:a}=Object(o.a)(),{timefilter:n}=a.data.query.timefilter;return Object(i.useEffect)((()=>{!0===e?n.enableTimeRangeSelector():!1===e&&n.disableTimeRangeSelector(),!0===t?n.enableAutoRefreshSelector():!1===t&&n.disableAutoRefreshSelector()}),[e,t,n]),n},c=()=>{const e=l();return r()(e.getRefreshIntervalUpdate$().pipe(Object(s.map)(e.getRefreshInterval)),e.getRefreshInterval())},u=(e=!1)=>{const t=l(),a=e?t.getAbsoluteTime.bind(t):t.getTime.bind(t);return r()(t.getTimeUpdate$().pipe(Object(s.map)(a)),a())}},86:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));const i=a(0).i18n.translate("xpack.dataVisualizer.chrome.help.appName",{defaultMessage:"Data Visualizer"})},87:function(e,t,a){var i=a(141),n=a(142),r=a(143),s=a(144),o=a(145),l=a(146),c=a(147);c.alea=i,c.xor128=n,c.xorwow=r,c.xorshift7=s,c.xor4096=o,c.tychei=l,e.exports=c},89:function(e,t,a){"use strict";a.d(t,"a",(function(){return ue}));var i=a(1),n=a(23),r=a(0),s=a(8),o=a(87),l=a.n(o),c=a(48),u=a(75),d=a(85),p=a(66),m=a(43),b=a(22),f=a(25),g=a.n(f),h=a(32),x=a.n(h);const v=new RegExp("^([0-9]*)\\s*("+x.a.units.join("|")+")$"),j=["ms","s","m","h"],y=["ms","s","m","h","d"],{duration:O}=g.a,S=x.a.unitsDesc,E=S.indexOf("w"),w=function(){const e=[[O(500,"ms"),O(100,"ms")],[O(5,"second"),O(1,"second")],[O(10,"second"),O(5,"second")],[O(15,"second"),O(10,"second")],[O(30,"second"),O(15,"second")],[O(1,"minute"),O(30,"second")],[O(5,"minute"),O(1,"minute")],[O(10,"minute"),O(5,"minute")],[O(15,"minute"),O(10,"minute")],[O(30,"minute"),O(10,"minute")],[O(1,"hour"),O(30,"minute")],[O(2,"hour"),O(1,"hour")],[O(4,"hour"),O(2,"hour")],[O(6,"hour"),O(4,"hour")],[O(8,"hour"),O(6,"hour")],[O(12,"hour"),O(8,"hour")],[O(24,"hour"),O(12,"hour")],[O(2,"d"),O(1,"d")],[O(4,"d"),O(2,"d")],[O(1,"week"),O(4,"d")],[O(1,"month"),O(1,"week")],[O(1,"year"),O(1,"month")],[1/0,O(1,"year")]].slice(0).reverse();function t(e,t,a){return function(i,n){const r=function(i,n){const r=n/i;let s;for(let i=0;i<e.length;i++){const n=e[i],o=t(n[0],n[1],r);if(null==o){if(!a)continue;if(s)return s;break}if(!a)return o;s=o}const o=Math.max(Math.floor(r),1);return g.a.duration(o,"ms")}(i,n);if(r)return g.a.duration(r._data)}}return{near:t(e,(function(e,t,a){if(e>a){if(e===1/0)return t;const i=e.asMilliseconds(),n=t.asMilliseconds();return Math.abs(i-a)<=Math.abs(n)?e:t}}),!0),lessThan:t(e,(function(e,t,a){if(t<a)return e!==1/0?e:t})),atLeast:t(e,(function(e,t,a){if(t<=a)return t}))}}();function F(e,t){this._timeBucketsConfig=e,this._fieldFormats=t,this.barTarget=this._timeBucketsConfig[s.UI_SETTINGS.HISTOGRAM_BAR_TARGET],this.maxBars=this._timeBucketsConfig[s.UI_SETTINGS.HISTOGRAM_MAX_BARS]}function _(e,t){const a=function(e){for(let t=0;t<S.length;t++){const a=S[t],i=e.as(a);if(i>=1&&Math.floor(i)===i){if(t<=E)continue;return{value:i,unit:a,expression:i+a}}}const t=e.as("ms");return{value:t,unit:"ms",expression:t+"ms"}}(e);e.esValue=a.value,e.esUnit=a.unit,e.expression=a.expression,e.overflow=t>e&&g.a.duration(e-t);const i=g.a.normalizeUnits(a.unit);return 1===a.value?e.description=i:e.description=`${a.value} ${i}s`,e}function M(e){return e&&"isValid"in e&&e.isValid()}F.prototype.setBarTarget=function(e){this.barTarget=e},F.prototype.setMaxBars=function(e){this.maxBars=e},F.prototype.setBounds=function(e){if(!e)return this.clearBounds();let t;t=Object(b.isPlainObject)(e)?[e.min,e.max]:Array.isArray(e)?e:[];const a=Object(b.sortBy)(t.map(Object(b.ary)(g.a,1)),Number);if(2!==a.length||!a.every(M))throw this.clearBounds(),new Error("invalid bounds set: "+e);if(this._lb=a.shift(),this._ub=a.pop(),this.getDuration().asSeconds()<0)throw new TypeError("Intervals must be positive")},F.prototype.clearBounds=function(){this._lb=this._ub=null},F.prototype.hasBounds=function(){return M(this._ub)&&M(this._lb)},F.prototype.getBounds=function(){if(this.hasBounds())return{min:this._lb,max:this._ub}},F.prototype.getDuration=function(){if(this.hasBounds())return g.a.duration(this._ub-this._lb,"ms")},F.prototype.setInterval=function(e){this.originalInterval=e;let t=e;if(t&&"auto"!==t){if(Object(b.isString)(t)&&(e=t,t=function(e,t=!1){const a=String(e).trim().match(v);if(!Array.isArray(a)||a.length<3)return null;try{const e=parseInt(a[1],10),i=a[2];return isNaN(e)||e<1&&-1===j.indexOf(i)||!0===t&&-1===y.indexOf(i)?null:Object(f.duration)(e,i)}catch(e){return null}}(t),0==+t&&(t=null)),!g.a.isDuration(t))throw new TypeError('"'+e+'" is not a valid interval.');this._i=t}else this._i="auto"},F.prototype.getInterval=function(){const e=this,t=e.getDuration();return _(function(a){if(!e.hasBounds())return a;const i=e.maxBars;let n;return t/a>i?(n=w.lessThan(i,t),+n==+a?a:(_(a,t),Object(b.assign)(n,{preScaled:a,scale:a/n,scaled:!0}))):a}(function(){const a=e._i;return g.a.isDuration(a)?a:w.near(e.barTarget,t)}()),t)},F.prototype.getIntervalToNearestMultiple=function(e){const t=this.getInterval(),a=t.asSeconds(),i=a%e;if(0===i)return t;let n=i>e/2?a+e-i:a-i;n=0===n?e:n;const r=g.a.duration(n,"seconds");_(r,this.getDuration());const s=t.preScaled;return void 0!==s&&s<r&&(r.preScaled=s,r.scale=s/r,r.scaled=!0),r},F.prototype.getScaledDateFormat=function(){const e=this.getInterval(),t=this._timeBucketsConfig["dateFormat:scaled"];for(let a=t.length-1;a>=0;a--){const i=t[a];if(!i[0]||e>=g.a.duration(i[0]))return i[1]}return this._timeBucketsConfig.dateFormat},F.prototype.getScaledDateFormatter=function(){return new(this._fieldFormats.getType(m.FIELD_FORMAT_IDS.DATE))({pattern:this.getScaledDateFormat()},this._timeBucketsConfig)};var N=a(4),T=a(62),z=a(44),A=a(45);const I=r.i18n.translate("xpack.dataVisualizer.index.lensChart.topValuesLabel",{defaultMessage:"Top values"}),V=r.i18n.translate("xpack.dataVisualizer.index.lensChart.countLabel",{defaultMessage:"Count"});function R(e,t,a,i){var n,s,o,l,c,u,d;const{lens:m,maps:b,data:f}=t,g=[],h=null!==(n=null==f?void 0:f.query.filterManager.getFilters())&&void 0!==n?n:[],x=()=>{const e={lastRefresh:Date.now()};p.a.next(e)};if(!0===(null===(s=t.application)||void 0===s||null===(o=s.capabilities)||void 0===o||null===(l=o.visualize)||void 0===l?void 0:l.show)&&void 0!==m){const t=null==m?void 0:m.canUseEditor();g.push({name:r.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensTitle",{defaultMessage:"Explore in Lens"}),description:r.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensDescription",{defaultMessage:"Explore in Lens"}),type:"icon",icon:"lensApp",available:e=>void 0!==function(e){let t;switch(e){case N.h.KEYWORD:case N.h.VERSION:t="string";break;case N.h.DATE:t="date";break;case N.h.NUMBER:t="number";break;case N.h.IP:t="ip";break;case N.h.BOOLEAN:t="string";break;default:t=void 0}return t}(e.type)&&t,onClick:t=>{const i=function(e,t,a,i){if(void 0===e||void 0===i.type||void 0===i.fieldName)return;const n=function(e,t,a){if(void 0!==t.fieldName)return e===N.h.DATE?function(e){return{columns:{col2:{dataType:"number",isBucketed:!1,label:V,operationType:"count",scale:"ratio",sourceField:A.DOCUMENT_FIELD_NAME},col1:{dataType:"date",isBucketed:!0,label:e.fieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:e.fieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t):e===N.h.NUMBER?function(e,t){return void 0===t.timeFieldName?{columns:{col1:{label:e.fieldName,dataType:"number",isBucketed:!0,operationType:"range",params:{type:"histogram",maxBars:"auto",ranges:[]},sourceField:e.fieldName},col2:{label:V,dataType:"number",isBucketed:!1,sourceField:A.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}:{columns:{col2:{dataType:"number",isBucketed:!1,label:r.i18n.translate("xpack.dataVisualizer.index.lensChart.averageOfLabel",{defaultMessage:"Average of {fieldName}",values:{fieldName:e.fieldName}}),operationType:"average",sourceField:e.fieldName},col1:{dataType:"date",isBucketed:!0,label:t.timeFieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:t.timeFieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t,a):e===N.h.IP||e===N.h.KEYWORD||e===N.h.VERSION?function(e){return{columns:{col1:{label:I,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"column",columnId:"col2"},size:10,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:V,dataType:"number",isBucketed:!1,sourceField:A.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}}(t):e===N.h.BOOLEAN?function(e){return{columns:{col1:{label:I,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"alphabetical"},size:2,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:V,dataType:"number",isBucketed:!1,sourceField:A.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}}(t):void 0}(i.type,i,e);return n?{visualizationType:"lnsXY",title:r.i18n.translate("xpack.dataVisualizer.index.lensChart.chartTitle",{defaultMessage:"Lens for {fieldName}",values:{fieldName:i.fieldName}}),references:[{id:e.id,name:"indexpattern-datasource-current-indexpattern",type:"index-pattern"},{id:e.id,name:"indexpattern-datasource-layer-layer1",type:"index-pattern"}],state:{datasourceStates:{formBased:{layers:{layer1:{columnOrder:["col1","col2"],columns:n.columns}}}},filters:a,query:{language:t.searchQueryLanguage,query:t.searchString},visualization:{axisTitlesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},fittingFunction:"None",gridlinesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},layers:[n.layer],legend:{isVisible:!0,position:"right"},preferredSeriesType:"line",tickLabelsVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},valueLabels:"hide"}}}:void 0}(e,a,h,t);i&&m.navigateToPrefilledEditor({id:`dataVisualizer-${t.fieldName}`,attributes:i})},"data-test-subj":"dataVisualizerActionViewInLensButton"})}var v;return null!=t&&t.uiActions&&b&&!0===(null===(c=t.application)||void 0===c||null===(u=c.capabilities)||void 0===u||null===(d=u.maps)||void 0===d?void 0:d.show)&&g.push({name:r.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsTitle",{defaultMessage:"Explore in Maps"}),description:r.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsDescription",{defaultMessage:"Explore in Maps"}),type:"icon",icon:"gisApp",available:e=>e.type===N.h.GEO_POINT||e.type===N.h.GEO_SHAPE,onClick:async a=>{if(null!=t&&t.uiActions&&e){const i={indexPatternId:e.id,fieldName:a.fieldName,contextualFields:[],originatingApp:N.a},n=await(null==t?void 0:t.uiActions.getTriggerCompatibleActions(z.VISUALIZE_GEO_FIELD_TRIGGER,i));n.length>0&&void 0!==n[0]&&(null==t||t.uiActions.getTrigger(z.VISUALIZE_GEO_FIELD_TRIGGER).exec(i))}},"data-test-subj":"dataVisualizerActionViewInMapsButton"}),void 0!==i&&null!==(v=t.dataViewFieldEditor)&&void 0!==v&&v.userPermissions.editIndexPattern()&&(g.push({name:r.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldTitle",{defaultMessage:"Edit data view field"}),description:r.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldDescription",{defaultMessage:"Edit data view field"}),type:"icon",icon:"indexEdit",onClick:a=>{var n;i.current=null===(n=t.dataViewFieldEditor)||void 0===n?void 0:n.openEditor({ctx:{dataView:e},fieldName:a.fieldName,onSave:x})},"data-test-subj":"dataVisualizerActionEditIndexPatternFieldButton"}),g.push({name:r.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteDataViewFieldTitle",{defaultMessage:"Delete data view field"}),description:r.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteIndexPatternFieldDescription",{defaultMessage:"Delete data view field"}),type:"icon",icon:"trash",available:e=>!0===e.deletable,onClick:a=>{var n;i.current=null===(n=t.dataViewFieldEditor)||void 0===n?void 0:n.openDeleteModal({ctx:{dataView:e},fieldName:a.fieldName,onDelete:x})},"data-test-subj":"dataVisualizerActionDeleteIndexPatternFieldButton"})),g}var P=a(63),k=a(24),C=a(20);function D(e,t,a,i){const n=[];return e&&t&&a&&n.push({range:{[e]:{gte:t,lte:a,format:"epoch_millis"}}}),i&&"object"==typeof i&&n.push(i),n}function L(e,t){return e.match(/^[a-zA-Z0-9-_.]+$/)?e:`field_${t}`}const B=1e5;var q=a(51);const U=e=>Object(q.isPopulatedObject)(e,["rawResponse"]);function G(e){return"random_sampling"===e.mode}function Q(e){return"normal_sampling"===e.mode}function $(e,t){if(!t)return e;const{seed:a}=t;return Q(t)?{sample:{sampler:{shard_size:t.shardSize},aggs:e}}:G(t)?{sample:{random_sampler:{probability:t.probability,...a?{seed:a}:{}},aggs:e}}:{sample:{aggs:e,random_sampler:{probability:1,...a?{seed:a}:{}}}}}function H(e){return!0===(null==e?void 0:e.isBoom)}const J=e=>{if(function(e){var t;return e&&void 0!==(null===(t=e.error)||void 0===t?void 0:t.reason)}(e))return{message:e.error.reason,statusCode:e.status,fullError:e};if(function(e){return"string"==typeof e}(e))return{message:e};var t,a;if(function(e){var t;return e&&!0===H(null===(t=e.body)||void 0===t?void 0:t.message)}(e))return null===(t=e.body.message)||void 0===t||null===(a=t.output)||void 0===a?void 0:a.payload;if(H(e))return{message:e.output.payload.message,statusCode:e.output.payload.statusCode};if(void 0===(null==e?void 0:e.body)&&(null==e||!e.message))return{message:""};if("string"==typeof e.body)return{message:e.body};if(function(e){return"object"==typeof e.body&&"message"in e.body}(e)){var i,n;if("object"==typeof e.body.attributes&&"string"==typeof(null===(i=e.body.attributes.body)||void 0===i||null===(n=i.error)||void 0===n?void 0:n.reason)){var r,s,o;const t={message:e.body.attributes.body.error.reason,statusCode:e.body.statusCode,fullError:e.body.attributes.body};var l,c,u;return"object"!=typeof e.body.attributes.body.error.caused_by||"string"!=typeof(null===(r=e.body.attributes.body.error.caused_by)||void 0===r?void 0:r.reason)&&"string"!=typeof(null===(s=e.body.attributes.body.error.caused_by)||void 0===s||null===(o=s.caused_by)||void 0===o?void 0:o.reason)||(t.causedBy=(null===(l=e.body.attributes.body.error.caused_by)||void 0===l||null===(c=l.caused_by)||void 0===c?void 0:c.reason)||(null===(u=e.body.attributes.body.error.caused_by)||void 0===u?void 0:u.reason)),Array.isArray(e.body.attributes.body.error.root_cause)&&"object"==typeof e.body.attributes.body.error.root_cause[0]&&Object(q.isPopulatedObject)(e.body.attributes.body.error.root_cause[0],["script"])&&(t.causedBy=e.body.attributes.body.error.root_cause[0].script,t.message+=`: '${e.body.attributes.body.error.root_cause[0].script}'`),t}return{message:e.body.message,statusCode:e.body.statusCode}}return function(e){return e&&void 0!==e.message&&"string"==typeof e.message}(e)?{message:e.message}:{message:""}},X=(e,t)=>{const a=Object(q.isPopulatedObject)(e,["buckets"])?e.buckets:[],i=Object(q.isPopulatedObject)(e,["sum_other_doc_count"])?e.sum_other_doc_count:0,n=((null==a?void 0:a.reduce(((e,t)=>t.doc_count+e),0))||0)+i,r=a.map((e=>({...e,doc_count:t?Math.floor(e.doc_count*(t/n)):e.doc_count,percent:e.doc_count/n})));return{topValuesSampleSize:n,topValues:r}};var Y=a(57);function K(e){return Object(q.isPopulatedObject)(e,["coordinates"])&&Array.isArray(e.coordinates)}function W(e){return Object(q.isPopulatedObject)(e,["lon","lat"])}const Z=(e,t,a,i)=>{switch(a[0].type){case N.h.NUMBER:return((e,t,a,i)=>{const{samplerShardSize:r}=t,s=((e,t)=>{const{index:a,query:i,runtimeFieldMap:n}=e;let r=0;const s=Array.from(Array(20),(()=>r+=5)),o={};return t.forEach(((e,t)=>{const{safeFieldName:a}=e;o[`${a}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}},o[`${a}_percentiles`]={percentiles:{field:e.fieldName,percents:s,keyed:!1}};const i={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};o[`${a}_top`]=i})),{index:a,size:0,body:{query:i,aggs:$(o,e.samplingOption),...Object(q.isPopulatedObject)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},i).pipe(Object(k.catchError)((e=>Object(n.of)({fields:a,error:J(e)}))),Object(k.map)((e=>{if(!U(e))return e;const i=e.rawResponse.aggregations,n=["sample"],s=[];return a.forEach(((e,a)=>{const o=e.safeFieldName,l=Object(b.get)(i,[...n,`${o}_field_stats`,"doc_count"],0),c=Object(b.get)(i,[...n,`${o}_field_stats`,"actual_stats"],{}),u=[...n,`${o}_top`];r<1&&e.cardinality>=B&&u.push("top");const d=Object(b.get)(i,[...u],{}),{topValuesSampleSize:p,topValues:m}=X(d),f={fieldName:e.fieldName,min:Object(b.get)(c,"min",0),max:Object(b.get)(c,"max",0),avg:Object(b.get)(c,"avg",0),isTopValuesSampled:Q(t.samplingOption)||Object(Y.a)(t.samplingProbability)&&t.samplingProbability<1,topValues:m,topValuesSampleSize:p,topValuesSamplerShardSize:Object(b.get)(i,["sample","doc_count"])};if(l>0){const e=Object(b.get)(i,[...n,`${o}_percentiles`,"values"],[]),t=Object(b.find)(e,{key:50});f.median=void 0!==t?t.value:0,f.distribution=((e,t,a)=>{const i={percentiles:[],minPercentile:0,maxPercentile:100};if(0===e.length)return i;let n=[],r=a;if(r>=0){i.minPercentile=0,i.maxPercentile=90,n=e.slice(0,e.length-2);const t=r+1.5*(Object(b.last)(n).value-r);for(let a=n.length;a<e.length&&e[a].value<t;a++)n.push(e[a]),i.maxPercentile+=5}else{const t=r;r=e[0].value,i.minPercentile=5,i.maxPercentile=95,n=e.slice(1,e.length-1);const a=Object(b.last)(n).value,s=.25*(a-r);r-t<s&&(n.splice(0,0,e[0]),i.minPercentile=0,r=t),e[e.length-1].value-a<s&&(n.push(e[e.length-1]),i.maxPercentile=100)}const s=n.length;let o=r,l=0;for(let e=0;e<s;e++){const t=n[e];t.value.toPrecision(15)!==o.toPrecision(15)?(l>0&&i.percentiles.push({percent:5*l,minValue:o,maxValue:o}),i.percentiles.push({percent:5,minValue:o,maxValue:t.value}),o=t.value,l=0):(l++,e===s-1&&i.percentiles.push({percent:5*l,minValue:o,maxValue:o}))}return i})(e,0,f.min)}s.push(f)})),s})))})(e,t,a,i);case N.h.KEYWORD:case N.h.IP:case N.h.VERSION:return((e,t,a,i)=>{const{samplerShardSize:r}=t,s=((e,t)=>{const{index:a,query:i,runtimeFieldMap:n}=e,r={};return t.forEach(((e,t)=>{const a=e.safeFieldName,i={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};r[`${a}_top`]=i})),{index:a,size:0,body:{query:i,aggs:$(r,e.samplingOption),...Object(q.isPopulatedObject)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},i).pipe(Object(k.catchError)((e=>Object(n.of)({fields:a,error:J(e)}))),Object(k.map)((e=>{if(!U(e))return e;const t=e.rawResponse.aggregations,i=["sample"],n=[];return a.forEach(((e,a)=>{const s=e.safeFieldName,o=[...i,`${s}_top`];r<1&&e.cardinality>=B&&o.push("top");const l=Object(b.get)(t,[...o],{}),{topValuesSampleSize:c,topValues:u}=X(l,Object(b.get)(t,["sample","doc_count"])),d={fieldName:e.fieldName,isTopValuesSampled:!0,topValues:u,topValuesSampleSize:c,topValuesSamplerShardSize:Object(b.get)(t,["sample","doc_count"])};n.push(d)})),n})))})(e,t,a,i);case N.h.DATE:return((e,t,a,i)=>{const r=((e,t)=>{const{index:a,query:i,runtimeFieldMap:n}=e,r={};return t.forEach(((e,t)=>{const a=e.safeFieldName;r[`${a}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}}})),{index:a,size:0,body:{query:i,aggs:$(r,e.samplingOption),...Object(q.isPopulatedObject)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:r},i).pipe(Object(k.catchError)((e=>Object(n.of)({fields:a,error:J(e)}))),Object(k.map)((e=>{if(!U(e))return e;const t=e.rawResponse.aggregations,i=["sample"];return a.map(((e,a)=>{const n=e.safeFieldName,r=Object(b.get)(t,[...i,`${n}_field_stats`,"actual_stats"],{});return{fieldName:e.fieldName,earliest:Object(b.get)(r,"min",0),latest:Object(b.get)(r,"max",0)}}))})))})(e,t,a,i);case N.h.BOOLEAN:return((e,t,a,i)=>{const r=((e,t)=>{const{index:a,query:i,runtimeFieldMap:n}=e,r={};return t.forEach(((e,t)=>{const a=e.safeFieldName;r[`${a}_value_count`]={filter:{exists:{field:e.fieldName}}},r[`${a}_values`]={terms:{field:e.fieldName,size:2}}})),{index:a,size:0,body:{query:i,aggs:$(r,e.samplingOption),...Object(q.isPopulatedObject)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:r},i).pipe(Object(k.catchError)((e=>Object(n.of)({fields:a,error:J(e)}))),Object(k.map)((e=>{if(!U(e))return e;const t=e.rawResponse.aggregations,i=["sample"],n=Object(b.get)(t,[...i,"doc_count"],0);return a.map(((e,a)=>{const r=e.fieldName,s=Object(b.get)(t,[...i,`${r}_value_count`,"doc_count"],0),o=Object(b.get)(t,[...i,`${r}_values`],{}),{topValuesSampleSize:l,topValues:c}=X(o),u=s>n?Object(b.get)(t,[...i,"probability"],1):1,d={fieldName:e.fieldName,count:s*u,trueCount:0,falseCount:0,topValues:c,topValuesSampleSize:l};return Object(b.get)(t,[...i,`${r}_values`,"buckets"],[]).forEach((e=>{d[`${e.key_as_string}Count`]=e.doc_count})),d}))})))})(e,t,a,i);case N.h.TEXT:default:return((e,t,a,i)=>{const{maxExamples:r}=t;return Object(n.combineLatest)(a.map((s=>{const o=((e,t)=>{const{index:a,timeFieldName:i,earliestMs:n,latestMs:r,query:s,runtimeFieldMap:o,maxExamples:l}=e,c=Math.max(100,null!=l?l:10),u=D(i,n,r,s);return Array.isArray(u)&&u.push({exists:{field:t.fieldName}}),{index:a,size:c,body:{fields:[t.fieldName],_source:!1,query:{bool:{filter:u}},...Object(q.isPopulatedObject)(o)?{runtime_mappings:o}:{}}}})(t,s);return e.search({params:o},i).pipe(Object(k.catchError)((e=>Object(n.of)({fieldName:s.fieldName,fields:a,error:J(e)}))),Object(k.map)((e=>{if(!U(e))return e;const t=e.rawResponse,a={fieldName:s.fieldName,examples:[]};if(t.hits.total>0){const e=t.hits.hits.map((e=>{const t=Object(b.get)(e.fields,s.fieldName);return Array.isArray(t)&&t.length>0?t[0]:t}));a.examples=function(e,t=10){const a=[];if(!Object(Y.a)(e))return a;for(let i=0;i<e.length;i++){const n=e[i];if("string"==typeof n&&-1===a.indexOf(n)?a.push(n):(K(n)&&-1===a.findIndex((e=>K(e)&&e.type===n.type&&n.coordinates.every(((t,a)=>t===e.coordinates[a]))))&&a.push(n),W(n)&&-1===a.findIndex((e=>W(e)&&n.lon===e.lon&&n.lat===e.lat))&&a.push(n)),a.length===t)return a}return a}(e,r)}return a})))})))})(e,t,a,i)}};var ee=a(65),te=a(83);const ae=(e,t,a,i,n,r,s,o,l)=>{const c=e,u=D(n,r,s,t),d=(e=>{return void 0!==(null==(t=e)?void 0:t.aggregations)?t.aggregations:void 0!==(null==t?void 0:t.aggs)?t.aggs:void 0;var t})(o),p=void 0!==d?{...d}:{},m={...Object(q.isPopulatedObject)(l)?l:{},...Object(q.isPopulatedObject)(o)&&Object(q.isPopulatedObject)(o.runtime_mappings)?o.runtime_mappings:{}};return a.forEach(((e,t)=>{var a;const i=L(e,t);let n;p[`${i}_count`]={filter:{exists:{field:e}}},n=null!=o&&null!==(a=o.script_fields)&&void 0!==a&&a.hasOwnProperty(e)?p[`${i}_cardinality`]={cardinality:{script:null==o?void 0:o.script_fields[e].script}}:{cardinality:{field:e}},p[`${i}_cardinality`]=n})),{index:c,track_total_hits:!1,size:0,body:{query:{bool:{filter:u}},...Object(q.isPopulatedObject)(p)?{aggs:$(p,i)}:{},...Object(q.isPopulatedObject)(m)?{runtime_mappings:m}:{}}}},ie=(e,t,a,i,n,r,s)=>{const o=e,l=D(i,n,r,t),c={query:{bool:{filter:l}},...Object(q.isPopulatedObject)(s)?{runtime_mappings:s}:{}};return Array.isArray(l)&&l.push({exists:{field:a}}),{index:o,size:0,body:c,track_total_hits:1}};var ne=a(72);const re=(e,t,a=!1)=>{if(!e)return;let i=0;if(void 0===t.intervalMs||void 0===t.earliest||void 0===t.latest)return{totalCount:i};const n={},r=Object(b.get)(e,a?["aggregations","sampler","eventRate","buckets"]:["aggregations","eventRate","buckets"],[]);return Object(b.each)(r,(e=>{const t=e.key;n[t]=e.doc_count,i+=e.doc_count})),{interval:t.intervalMs,buckets:n,timeRangeEarliest:t.earliest,timeRangeLatest:t.latest,totalCount:i}};function se(e,t,a){var i,n;500===a.statusCode?e.addError(a,{title:r.i18n.translate("xpack.dataVisualizer.index.dataLoader.internalServerErrorMessage",{defaultMessage:"Error loading data in index {index}. {message}. The request may have timed out. Try using a smaller sample size or narrowing the time range.",values:{index:t,message:null!==(i=a.error)&&void 0!==i?i:a.message}})}):e.addError(a,{title:r.i18n.translate("xpack.dataVisualizer.index.errorLoadingDataMessage",{defaultMessage:"Error loading data in index {index}. {message}.",values:{index:t,message:null!==(n=a.error)&&void 0!==n?n:a.message}})})}const oe=Object(P.c)();function le(e){return!N.g.includes(e)}const ce={mode:"random_sampling",seed:"",probability:0},ue=(e,t,a,o)=>{var m;const{services:f}=Object(c.a)(),{uiSettings:g,data:h,security:x}=f,{samplerShardSize:v,visibleFieldTypes:j,showEmptyFields:y}=t,[O,S]=Object(i.useState)(0),E=e.sessionId,w=Object(i.useMemo)((()=>{let e=Math.abs(l()().int32());return void 0!==x&&x.authc.getCurrentUser().then((t=>{const a=t.username;a&&(e=Math.abs(l()(a).int32()))})),e}),[x]),{currentSavedSearch:_,currentDataView:M,currentQuery:z,currentFilters:A,visibleFieldNames:I,fieldsToFetch:V,samplingOption:B}=Object(i.useMemo)((()=>{var t,a;return{currentSavedSearch:null==e?void 0:e.savedSearch,currentDataView:e.dataView,currentQuery:null==e?void 0:e.query,visibleFieldNames:null!==(t=null==e?void 0:e.visibleFieldNames)&&void 0!==t?t:[],currentFilters:null==e?void 0:e.filters,fieldsToFetch:null==e?void 0:e.fieldsToFetch,samplingOption:null!==(a=null==e?void 0:e.samplingOption)&&void 0!==a?a:ce}}),[e]),{searchQueryLanguage:U,searchString:Q,searchQuery:$}=Object(i.useMemo)((()=>{const e=h.query.filterManager,a=Object(u.b)({dataView:M,uiSettings:g,savedSearch:_,query:z,filters:A,filterManager:h.query.filterManager});if(void 0===a||""!==t.searchString){if(t.filters){const a=null==e?void 0:e.getGlobalFilters();e&&e.setFilters(t.filters),a&&(null==e||e.addFilters(a))}return{searchQuery:t.searchQuery,searchString:t.searchString,searchQueryLanguage:t.searchQueryLanguage}}return{searchQuery:a.searchQuery,searchString:a.searchString,searchQueryLanguage:a.queryLanguage}}),[null==_?void 0:_.id,M.id,t.searchString,t.searchQueryLanguage,JSON.stringify({searchQuery:t.searchQuery,currentQuery:z,currentFilters:A}),O]),H=Object(i.useMemo)((()=>new F({[s.UI_SETTINGS.HISTOGRAM_MAX_BARS]:g.get(s.UI_SETTINGS.HISTOGRAM_MAX_BARS),[s.UI_SETTINGS.HISTOGRAM_BAR_TARGET]:g.get(s.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:g.get("dateFormat"),"dateFormat:scaled":g.get("dateFormat:scaled")})),[g]),X=Object(d.c)({timeRangeSelector:void 0!==(null==M?void 0:M.timeFieldName),autoRefreshSelector:!0}),[K,W]=Object(i.useState)(oe.metricConfigs),[ue,de]=Object(i.useState)(oe.metricsLoaded),[pe,me]=Object(i.useState)(),[be,fe]=Object(i.useState)(oe.nonMetricConfigs),[ge,he]=Object(i.useState)(oe.nonMetricsLoaded),xe=Object(i.useMemo)((()=>{const e=H,t=X;if(!e||!t||!M)return;const a=t.getActiveBounds();let i,n;var r,o;void 0!==a&&void 0!==M.timeFieldName&&(i=null===(r=a.min)||void 0===r?void 0:r.valueOf(),n=null===(o=a.max)||void 0===o?void 0:o.valueOf());const l=t.getActiveBounds();e.setInterval("auto"),l&&(e.setBounds(l),e.setBarTarget(75));const c=e.getInterval(),u=[],d=[],p=M.fields;return null==p||p.forEach((e=>{if(V&&!V.includes(e.name))return;const t=void 0!==e.displayName?e.displayName:e.name;var a;N.g.includes(t)||(!0!==e.aggregatable||N.f.has(e.type)||null!==(a=e.esTypes)&&void 0!==a&&a.some((e=>e===s.ES_FIELD_TYPES.AGGREGATE_METRIC_DOUBLE))?d.push(e.name):u.push(e.name))})),{earliest:i,latest:n,aggInterval:c,intervalMs:null==c?void 0:c.asMilliseconds(),searchQuery:$,samplerShardSize:v,sessionId:E,index:M.title,timeFieldName:M.timeFieldName,runtimeFieldMap:M.getRuntimeMappings(),aggregatableFields:u,nonAggregatableFields:d,fieldsToFetch:V,browserSessionSeed:w,samplingOption:{...B,seed:w.toString()}}}),[H,X,M.id,JSON.stringify($),JSON.stringify(B),v,E,O,V,w]),{overallStats:ve,progress:je}=function(e,t,a){const{services:{data:r,notifications:{toasts:s}}}=Object(c.a)(),[o,u]=Object(i.useState)(Object(P.c)().overallStats),[d,p]=Object(i.useReducer)(((e,t)=>({...e,...t})),{isRunning:!1,loaded:0,total:100}),m=Object(i.useRef)(new AbortController),f=Object(i.useRef)(),g=Object(i.useCallback)((async()=>{try{var i;if(null===(i=f.current)||void 0===i||i.unsubscribe(),m.current.abort(),m.current=new AbortController,!e||0===t)return;p({isRunning:!1,loaded:0,total:100,isRunning:!0,error:void 0});const{aggregatableFields:c,nonAggregatableFields:d,index:g,searchQuery:h,timeFieldName:x,earliest:v,latest:j,runtimeFieldMap:y,samplingOption:O}=e,S={abortSignal:m.current.signal,sessionId:null==e?void 0:e.sessionId},E=await(async(e,t,a,i,n,r)=>{var s,o;const c=null!=i?i:Math.abs(l()().int32()).toString(),{index:u,timeFieldName:d,earliest:p,latest:m,runtimeFieldMap:f,searchQuery:g,intervalMs:h}=t,x={randomlySampled:!1,took:0,totalCount:0,probability:1},v={bool:{filter:D(d,p,m,g)}},j={eventRate:{date_histogram:{field:d,fixed_interval:`${h}ms`,min_doc_count:1}}},y=null!=n?n:1e-6,O=e=>({sampler:{aggs:j,random_sampler:{probability:e,seed:c}}}),S=void 0!==d&&""!==d&&void 0!==h&&h>0,E=(e,t=!1)=>({index:u,body:{query:v,...S?{aggs:e}:{},...Object(q.isPopulatedObject)(f)?{runtime_mappings:f}:{}},track_total_hits:t,size:0}),w=await e.search({params:E(O(y),!S)},a).toPromise();if(void 0===w)throw Error(`An error occurred with the following query ${JSON.stringify(E(O(y)))}`);if(!S){var F;const e="number"==typeof w.rawResponse.hits.total?w.rawResponse.hits.total:null===(F=w.rawResponse.hits.total)||void 0===F?void 0:F.value;return{...x,randomlySampled:!1,took:w.rawResponse.took,totalCount:null!=e?e:0}}var _;if(Object(Y.a)(n))return{...x,randomlySampled:1!==n,took:null===(_=w.rawResponse)||void 0===_?void 0:_.took,probability:n,...re(w.rawResponse,t,!0)};const M=null===(s=w.rawResponse.aggregations)||void 0===s||null===(o=s.sampler)||void 0===o?void 0:o.doc_count,N=1e5;if(void 0!==w&&M<N){const i=y*N/(M-2*Math.sqrt(M));if(i===1/0||M<=4){var T,z;const i=await e.search({params:E(O(1))},a).toPromise();return{...x,randomlySampled:!1,took:w.rawResponse.took+(null!==(T=null==i||null===(z=i.rawResponse)||void 0===z?void 0:z.took)&&void 0!==T?T:0),...re(null==i?void 0:i.rawResponse,t,!0),probability:1}}{const n=ne.b[Object(b.sortedIndex)(ne.b,i)],r=await e.search({params:E(O(n))},a).toPromise();if(r)return{...x,randomlySampled:!0,took:w.rawResponse.took+r.rawResponse.took,...re(r.rawResponse,t,!0),probability:n}}}return x})(r.search,e,S,O.seed,a),w=d.map((e=>r.search.search({params:ie(g,h,e,x,v,j,y)},S).pipe(Object(k.map)((t=>({...t,rawResponse:{...t.rawResponse,fieldName:e}})))))),F=Object(b.chunk)(c,30);var o;G(O)&&(O.probability=null!==(o=E.probability)&&void 0!==o?o:1);const _=function(e,t=ee.b){return Object(n.from)(e).pipe(Object(k.mergeMap)(((e,t)=>e.pipe(Object(k.last)(),Object(k.map)((e=>({index:t,value:e}))))),t),Object(k.toArray)(),Object(k.map)((e=>e.sort(((e,t)=>e.index-t.index)).map((e=>e.value)))))}([...F.map((e=>r.search.search({params:ae(g,h,e,O,x,v,j,void 0,y)},S).pipe(Object(k.map)((t=>({...t,aggregatableFields:e})))))),...w],ee.b);f.current=_.subscribe({next:e=>{var t;const a=[],i=[];e.forEach(((e,t)=>{var n;n=e,Object(q.isPopulatedObject)(n,["aggregatableFields"])&&a.push(e),function(e){return Object(q.isPopulatedObject)(e,["rawResponse"])}(e)&&i.push(e)}));const n=null!==(t=null==E?void 0:E.totalCount)&&void 0!==t?t:0,r=((e,t,a)=>{const i={aggregatableExistsFields:[],aggregatableNotExistsFields:[]};return e&&0!==t.length?(e.forEach((({rawResponse:e,aggregatableFields:t})=>{const a=e.aggregations,n=["sample"],r=a.sample.doc_count;t.forEach(((e,t)=>{const s=L(e,t),o=Object(b.get)(a,[...n,`${s}_count`,"doc_count"],0),l=o>r?Object(b.get)(a,[...n,"probability"],1):1;if(o>0){const t=Object(b.get)(a,[...n,`${s}_cardinality`,"value"],0);i.aggregatableExistsFields.push({fieldName:e,existsInDocs:!0,stats:{sampleCount:r,count:o*l,cardinality:t}})}else i.aggregatableNotExistsFields.push({fieldName:e,existsInDocs:!1,stats:{}})}))})),i):i})(a,c),s=((e,t)=>{const a={nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]};return e&&0!==t.length?(t.forEach((t=>{const i=e.find((e=>e.rawResponse.fieldName===t)),n=void 0!==i&&i.rawResponse.hits.total>0,r={fieldName:t,existsInDocs:n};!0===n?a.nonAggregatableExistsFields.push(r):a.nonAggregatableNotExistsFields.push(r)})),a):a})(i,d);u({documentCountStats:E,...s,...r,totalCount:n})},error:t=>{se(s,e.index,J(t)),p({isRunning:!1,error:t})},complete:()=>{p({loaded:100,isRunning:!1})}})}catch(t){"AbortError"!==t.name&&se(s,e.index,J(t))}}),[r.search,e,s,t,a]),h=Object(i.useCallback)((()=>{var e;null===(e=f.current)||void 0===e||e.unsubscribe(),f.current=void 0,m.current.abort()}),[]);return Object(i.useEffect)((()=>{g()}),[g]),Object(i.useEffect)((()=>h),[h]),Object(i.useMemo)((()=>({progress:d,overallStats:o})),[o,d])}(xe,O,t.probability),ye=Object(i.useMemo)((()=>{if(!(je.loaded<100))return{metricConfigs:K.map((e=>{var t,a;return{fieldName:e.fieldName,type:e.type,cardinality:null!==(t=null===(a=e.stats)||void 0===a?void 0:a.cardinality)&&void 0!==t?t:0,existsInDocs:e.existsInDocs}})).filter((e=>void 0!==e)),nonMetricConfigs:be.map((e=>{var t,a;return{fieldName:e.fieldName,type:e.type,cardinality:null!==(t=null===(a=e.stats)||void 0===a?void 0:a.cardinality)&&void 0!==t?t:0,existsInDocs:e.existsInDocs}})).filter((e=>void 0!==e))}}),[K,be,je.loaded]),Oe=Object(i.useMemo)((()=>{var e,a;return null!==(e=null===t.probability?null==ve||null===(a=ve.documentCountStats)||void 0===a?void 0:a.probability:t.probability)&&void 0!==e?e:1}),[t.probability,null==ve||null===(m=ve.documentCountStats)||void 0===m?void 0:m.probability]),Se=function(e,t,a,s){const{services:{data:o,notifications:{toasts:l}}}=Object(c.a)(),[u,d]=Object(i.useState)(),[p,m]=Object(i.useReducer)(((e,t)=>({...e,...t})),{isRunning:!1,loaded:0,total:100}),f=Object(i.useRef)(new AbortController),g=Object(i.useRef)(),h=Object(i.useRef)(),x=Object(i.useCallback)((()=>{var i,c,u;if(null===(i=g.current)||void 0===i||i.unsubscribe(),null===(c=h.current)||void 0===c||c.unsubscribe(),f.current.abort(),f.current=new AbortController,m({isRunning:!1,loaded:0,total:100,error:void 0}),d(void 0),!e||!t||0===t.metricConfigs.length&&0===t.nonMetricConfigs.length)return void m({loaded:100,isRunning:!1});const{sortField:p,sortDirection:x}=a,v=C.Comparators.property(p,C.Comparators.default(x)),j=[...t.metricConfigs,...t.nonMetricConfigs].sort(v),y=Object(te.a)(j,a.visibleFieldNames,a.visibleFieldTypes),{pageIndex:O,pageSize:S}=a,E=null===(u=y.filteredFields)||void 0===u?void 0:u.slice(O*S,(O+1)*S).filter((e=>!0===e.existsInDocs));if(!E||0===E.length)return void m({loaded:100,isRunning:!1});const w=D(e.timeFieldName,e.earliest,e.latest,e.searchQuery),F={index:e.index,samplerShardSize:e.samplerShardSize,timeFieldName:e.timeFieldName,earliestMs:e.earliest,latestMs:e.latest,runtimeFieldMap:e.runtimeFieldMap,intervalMs:e.intervalMs,query:{bool:{filter:w}},maxExamples:10,samplingProbability:s,browserSessionSeed:e.browserSessionSeed,samplingOption:e.samplingOption},_={abortSignal:f.current.signal,sessionId:null==e?void 0:e.sessionId},M=((e,t=10)=>{const a=[],i={};return e.forEach((e=>{const a=e.type;void 0===i[a]&&(i[a]=[[]]);let n=Object(b.last)(i[a]);n.length===t&&(n=[],i[a].push(n)),n.push(e)})),Object.values(i).forEach((e=>{a.push(...e)})),a})(E.map(((e,t)=>({fieldName:e.fieldName,type:e.type,cardinality:e.cardinality,safeFieldName:L(e.fieldName,t)}))),10),N=new n.Subject,T=new n.Subject,z=M.map((e=>Z(o.search,F,e,_))).filter((e=>void 0!==e)),A=e=>{l.addError(e,{title:r.i18n.translate("xpack.dataVisualizer.index.errorFetchingFieldStatisticsMessage",{defaultMessage:"Error fetching field statistics"})}),m({isRunning:!1,error:e})},I=()=>{m({isRunning:!1})},V=new Map;g.current=Object(n.from)(z).pipe(Object(k.mergeMap)((e=>e),ee.b)).subscribe({next:e=>{if(m({isRunning:!1,loaded:0,total:100,error:void 0}),e){const a=[];var t;Array.isArray(e)?e.forEach((e=>{void 0!==e.fieldName&&V.set(e.fieldName,e)})):a.push(...null!==(t=e.fields)&&void 0!==t?t:[]),d(V),m({loaded:V.size/E.length*100,isRunning:!0}),a.length>0&&(N.next(V),T.next(a))}},error:A,complete:I}),h.current=Object(n.combineLatest)([N,T.pipe(Object(k.switchMap)((e=>Object(n.combineLatest)(e.map((e=>Z(o.search,F,[e],_))).filter((e=>void 0!==e))))))]).subscribe({next:e=>{const t=Object(b.cloneDeep)(e[0]),a=e[1];Array.isArray(a)&&(a.forEach((e=>{Array.isArray(e)&&1===e.length&&t.set(e[0].fields[0],e[0])})),d(t),m({loaded:t.size/E.length*100,isRunning:!0}))},error:A,complete:I})}),[o.search,l,t,a.pageSize,a.pageIndex,a.sortDirection,a.sortField,s]),v=Object(i.useCallback)((()=>{var e,t;null===(e=g.current)||void 0===e||e.unsubscribe(),g.current=void 0,null===(t=h.current)||void 0===t||t.unsubscribe(),h.current=void 0,f.current.abort(),m({isRunning:!1})}),[]);return Object(i.useEffect)((()=>(x(),v)),[x,v]),{progress:p,fieldStats:u,startFetch:x,cancelFetch:v}}(xe,ye,t,Oe),Ee=Object(i.useMemo)((()=>.2*je.loaded+.8*Se.progress.loaded),[je.loaded,Se.progress.loaded]);Object(i.useEffect)((()=>{const e=Object(n.merge)(X.getTimeUpdate$(),X.getAutoRefreshFetch$(),p.a).subscribe((()=>{o&&o({time:X.getTime(),refreshInterval:X.getRefreshInterval()}),S(Date.now())}));return()=>{e.unsubscribe()}}));const we=Object(i.useMemo)((()=>M.fields),[M]),Fe=Object(i.useCallback)((()=>{const e=[],t=ve.aggregatableExistsFields||[],a=we.filter((e=>e.type===s.KBN_FIELD_TYPES.NUMBER&&void 0!==e.displayName&&!0===le(e.displayName))),i=a.filter((e=>t.find((t=>t.fieldName===e.spec.name))));if(!1===ue)return void de(!0);let n=ve.aggregatableExistsFields;a.length!==i.length&&!0===ue&&(n=n.concat(ve.aggregatableNotExistsFields));const r=!0===ue&&!0===y?a:i;r.forEach((t=>{var a;const i=n.find((e=>e.fieldName===t.spec.name));if(!i)return;const r={...i,fieldFormat:M.getFormatterForField(t),type:N.h.NUMBER,loading:null===(a=null==i?void 0:i.existsInDocs)||void 0===a||a,aggregatable:!0,deletable:void 0!==t.runtimeField};t.displayName!==r.fieldName&&(r.displayName=t.displayName),e.push(r)})),me({totalMetricFieldsCount:a.length,visibleMetricsCount:r.length}),W(e)}),[M,we,ue,ve,y]),_e=Object(i.useCallback)((()=>{const e=we.filter((e=>e.type!==s.KBN_FIELD_TYPES.NUMBER&&void 0!==e.displayName&&!0===le(e.displayName))),t=[];let a=[];const i=ve.aggregatableExistsFields||[],n=ve.nonAggregatableExistsFields||[];if(e.forEach((e=>{const r=i.find((t=>t.fieldName===e.spec.name));if(void 0!==r)t.push(e),a.push(r);else{const i=n.find((t=>t.fieldName===e.spec.name));void 0!==i&&(t.push(e),a.push(i))}})),!1===ge)return void he(!0);e.length!==a.length&&!0===y&&(a=a.concat(ve.aggregatableNotExistsFields,ve.nonAggregatableNotExistsFields));const r=[];(y?e:t).forEach((e=>{var t;const i=a.find((t=>t.fieldName===e.spec.name)),n={...i||{},fieldFormat:M.getFormatterForField(e),aggregatable:e.aggregatable,loading:null===(t=null==i?void 0:i.existsInDocs)||void 0===t||t,deletable:void 0!==e.runtimeField},s=Object(T.c)(e);void 0!==s?n.type=s:(n.type=e.type,n.isUnsupportedType=!0),e.displayName!==n.fieldName&&(n.displayName=e.displayName),r.push(n)})),fe(r)}),[M,we,ge,ve,y]);Object(i.useEffect)((()=>{Fe(),_e()}),[ve,y]);const Me=Object(i.useMemo)((()=>{const e=Se.fieldStats;let t=[...be,...K];return j&&j.length>0&&(t=t.filter((e=>j.findIndex((t=>t===e.type))>-1))),I&&I.length>0&&(t=t.filter((e=>I.findIndex((t=>t===e.fieldName))>-1))),e&&(t=t.map((t=>{var a;const i=null!==(a=e.get(t.fieldName))&&void 0!==a?a:{};return i?{...t,loading:!1,stats:{...t.stats,...i}}:t}))),t}),[be,K,j,I,Se.progress.loaded,t.pageIndex,t.pageSize]),Ne=Object(i.useRef)();Object(i.useEffect)((()=>{const e=Ne;return()=>{e.current&&e.current()}}),[]);const Te=Object(i.useMemo)((()=>{const t=R(e.dataView,f,{searchQueryLanguage:U,searchString:Q},e.allowEditDataView?Ne:void 0);if(Array.isArray(t)&&!(t.length<1))return[{name:r.i18n.translate("xpack.dataVisualizer.index.dataGrid.actionsColumnLabel",{defaultMessage:"Actions"}),actions:t,width:"70px"}]}),[e.dataView,f,U,Q,e.allowEditDataView]);return{progress:Ee,overallStatsProgress:je,configs:Me,searchQueryLanguage:U,searchString:Q,searchQuery:$,extendedColumns:Te,documentCountStats:ve.documentCountStats,metricsStats:pe,overallStats:ve,timefilter:X,setLastRefresh:S}}},91:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var i=a(1),n=a(55),r=a(56),s=a(67),o=a(48),l=a(4),c=a(78),u=a(54),d=a(5);const p=({config:e,dataView:t,combinedQuery:a})=>{const{stats:p}=e,[m,b]=Object(i.useState)([]),{services:{maps:f,data:g}}=Object(o.a)();return Object(i.useEffect)((()=>{!async function(){if(void 0!==(null==t?void 0:t.id)&&void 0!==e&&void 0!==e.fieldName&&(e.type===l.h.GEO_POINT||e.type===l.h.GEO_SHAPE)){var i;const n={indexPatternId:t.id,geoFieldName:e.fieldName,geoFieldType:e.type,filters:null!==(i=g.query.filterManager.getFilters())&&void 0!==i?i:[],query:{query:a.searchString,language:a.searchQueryLanguage}},r=f?await f.createLayerDescriptors.createESSearchSourceLayerDescriptor(n):null;r&&b([...m,r])}}()}),[t,a,e,f,g.query]),void 0===(null==p?void 0:p.examples)?null:Object(d.jsx)(n.a,{dataTestSubj:"dataVisualizerIndexBasedMapContent"},Object(d.jsx)(r.a,{config:e}),Object(d.jsx)(s.a,{examples:null==p?void 0:p.examples}),Object(d.jsx)(u.a,{className:"dvPanel__wrapper dvMap__wrapper",grow:!0},Object(d.jsx)(c.a,{layerList:m})))};var m=a(90),b=a(20),f=a(21);const g=()=>Object(d.jsx)(i.Fragment,null,Object(d.jsx)(b.EuiText,{textAlign:"center"},Object(d.jsx)(b.EuiIcon,{type:"alert"})),Object(d.jsx)(b.EuiText,{textAlign:"center",size:"xs"},Object(d.jsx)(f.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.fieldNotInDocsLabel",defaultMessage:"This field does not appear in any documents for the selected time range"}))),h=()=>Object(d.jsx)(i.Fragment,null,Object(d.jsx)(b.EuiSpacer,{size:"xxl"}),Object(d.jsx)(b.EuiFlexGroup,{justifyContent:"spaceAround"},Object(d.jsx)(b.EuiFlexItem,{grow:!1},Object(d.jsx)(b.EuiLoadingSpinner,{size:"l"}))),Object(d.jsx)(b.EuiFlexGroup,{justifyContent:"spaceAround"},Object(d.jsx)(b.EuiFlexItem,{grow:!1},Object(d.jsx)(b.EuiText,{color:"subdued"},Object(d.jsx)(f.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.loadingLabel",defaultMessage:"Loading"})))));var x=a(81);const v=({item:e,dataView:t,combinedQuery:a,onAddFilter:i,totalDocuments:n})=>{const r={...e,stats:{...e.stats,totalDocuments:n}},{loading:s,type:o,existsInDocs:c,fieldName:u}=r;return Object(d.jsx)("div",{className:"dvExpandedRow","data-test-subj":`dataVisualizerFieldExpandedRow-${u}`},!0===s?Object(d.jsx)(h,null):function(){var e,n;if(!1===c)return Object(d.jsx)(g,null);if(null!==(e=r.stats)&&void 0!==e&&e.error)return Object(d.jsx)(x.a,{fieldName:u,error:null===(n=r.stats)||void 0===n?void 0:n.error});switch(o){case l.h.NUMBER:return Object(d.jsx)(m.e,{config:r,onAddFilter:i});case l.h.BOOLEAN:return Object(d.jsx)(m.a,{config:r,onAddFilter:i});case l.h.DATE:return Object(d.jsx)(m.b,{config:r});case l.h.GEO_POINT:case l.h.GEO_SHAPE:return Object(d.jsx)(p,{config:r,dataView:t,combinedQuery:a});case l.h.IP:return Object(d.jsx)(m.c,{config:r,onAddFilter:i});case l.h.KEYWORD:case l.h.VERSION:return Object(d.jsx)(m.d,{config:r,onAddFilter:i});case l.h.TEXT:return Object(d.jsx)(m.g,{config:r});default:return Object(d.jsx)(m.f,{config:r})}}())}}}]);