/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[30],{110:function(e,t,n){"use strict";n.r(t),n.d(t,"RuleEventLogList",(function(){return v})),n.d(t,"default",(function(){return v}));var a=n(1),s=n.n(a),r=n(4),i=n(3),u=n(22),o=n(61),c=n(88),l=n(100),j=n(107),x=n(21),g=n(89),b=n.n(g),m=n(129),d=n(0);const O=[120,60,30,15].map((e=>({value:e,text:i.i18n.translate("xpack.triggersActionsUI.sections.executionDurationChart.numberOfExecutionsOption",{defaultMessage:"{value} runs",values:{value:e}})}))),f=({executionDuration:e,numberOfExecutions:t,onChangeDuration:n,isLoading:u})=>{const o=function(e,t){const n=Object.entries(e);return n.length===t?n:n.length<t?Object(x.assign)(Object(x.fill)(new Array(t),[null,null]),n):n.slice(-t)}(e.valuesWithTimestamp,t),g=Object(a.useCallback)((({target:e})=>n(Number(e.value))),[n]);return Object(d.jsx)(r.EuiPanel,{"data-test-subj":"executionDurationChartPanel",hasBorder:!0},Object(d.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},Object(d.jsx)(r.EuiFlexItem,{grow:!1},Object(d.jsx)(r.EuiTitle,{size:"xxs"},Object(d.jsx)("h4",null,Object(d.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.executionDurationChart.recentDurationsTitle",defaultMessage:"Recent run durations"})))),Object(d.jsx)(r.EuiFlexGroup,{justifyContent:"flexEnd"},Object(d.jsx)(r.EuiFlexItem,{grow:!1},Object(d.jsx)(r.EuiSelect,{id:"select-number-execution-durations","data-test-subj":"executionDurationChartPanelSelect",options:O,value:t,"aria-label":i.i18n.translate("xpack.triggersActionsUI.sections.executionDurationChart.selectNumberOfExecutionDurationsLabel",{defaultMessage:"Select number of runs"}),onChange:g})))),u&&Object(d.jsx)(r.EuiFlexGroup,{justifyContent:"center"},Object(d.jsx)(r.EuiFlexItem,{grow:!1,style:{height:"80px",justifyContent:"center"}},Object(d.jsx)(r.EuiLoadingChart,{size:"xl"}))),!u&&(e.valuesWithTimestamp&&Object.entries(e.valuesWithTimestamp).length>0?Object(d.jsx)(s.a.Fragment,null,Object(d.jsx)(j.Chart,{"data-test-subj":"executionDurationChart",size:{height:80}},Object(d.jsx)(j.Settings,{theme:{lineSeriesStyle:{point:{visible:!1},line:{stroke:l.euiLightVars.euiColorAccent}}}}),Object(d.jsx)(j.BarSeries,{id:"executionDuration",name:i.i18n.translate("xpack.triggersActionsUI.sections.executionDurationChart.durationLabel",{defaultMessage:"Duration"}),xScaleType:"linear",yScaleType:"linear",xAccessor:0,yAccessors:[1],data:o.map((([e,t],n)=>[e?b()(e).format("D MMM YYYY @ HH:mm:ss"):n,t])),minBarHeight:2}),Object(d.jsx)(j.LineSeries,{id:"rule_duration_avg",name:i.i18n.translate("xpack.triggersActionsUI.sections.executionDurationChart.avgDurationLabel",{defaultMessage:"Avg Duration"}),xScaleType:"linear",yScaleType:"linear",xAccessor:0,yAccessors:[1],data:o.map((([t,n],a)=>[t?b()(t).format("D MMM YYYY @ HH:mm:ss"):a,n?e.average:null])),curve:j.CurveType.CURVE_NATURAL}),Object(d.jsx)(j.Axis,{id:"left-axis",position:"left",tickFormat:e=>Object(m.a)(e)}))):Object(d.jsx)(s.a.Fragment,null,Object(d.jsx)(r.EuiEmptyPrompt,{"data-test-subj":"executionDurationChartEmpty",body:Object(d.jsx)(s.a.Fragment,null,Object(d.jsx)("p",null,Object(d.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.executionDurationChart.executionDurationNoData",defaultMessage:"There is no available run duration information for this rule."})))}))))};var p=n(121);const h=60,E=Object(p.a)((e=>{const{ruleId:t,ruleType:n,ruleSummary:s,refreshToken:c,fetchRuleSummary:l=!1,numberOfExecutions:j=h,onChangeDuration:x,loadRuleSummary:g,isLoadingRuleSummary:b=!1}=e,{notifications:{toasts:O}}=Object(u.b)().services,p=Object(a.useRef)(!1),[E,D]=Object(a.useState)(null),[y,S]=Object(a.useState)(h),[v,C]=Object(a.useState)(!1),A=Object(a.useMemo)((()=>l?E:s),[l,s,E]),L=Object(a.useMemo)((()=>l?y:j),[l,j,y]),T=Object(a.useMemo)((()=>l?v:b),[l,b,v]),I=Object(a.useCallback)((e=>{S(e)}),[S]),M=Object(a.useMemo)((()=>l?I:x||I),[l,x,I]),k=async()=>{if(l){C(!0);try{const e=await g(t,L);D(e)}catch(e){O.addDanger({title:i.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.ruleExecutionSummaryAndChart.loadSummaryError",{defaultMessage:"Unable to load rule summary: {message}",values:{message:e.message}})})}C(!1)}};Object(a.useEffect)((()=>{k()}),[t,L]),Object(a.useEffect)((()=>{p.current&&k(),p.current=!0}),[c]);const F=Object(a.useMemo)((()=>!!A&&Object(m.b)(n,A.executionDuration.average)),[n,A]);return A?Object(d.jsx)(r.EuiFlexGroup,null,Object(d.jsx)(r.EuiFlexItem,{grow:1},Object(d.jsx)(r.EuiPanel,{"data-test-subj":"avgExecutionDurationPanel",color:F?"warning":"subdued",hasBorder:!1},Object(d.jsx)(r.EuiStat,{"data-test-subj":"avgExecutionDurationStat",titleSize:"xs",title:Object(d.jsx)(r.EuiFlexGroup,{gutterSize:"xs"},F&&Object(d.jsx)(r.EuiFlexItem,{grow:!1},Object(d.jsx)(r.EuiIconTip,{"data-test-subj":"ruleDurationWarning",anchorClassName:"ruleDurationWarningIcon",type:"alert",color:"warning",content:i.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.alertsList.ruleTypeExcessDurationMessage",{defaultMessage:"Duration exceeds the rule's expected run time."}),position:"top"})),Object(d.jsx)(r.EuiFlexItem,{grow:!1,"data-test-subj":"ruleEventLogListAvgDuration"},Object(m.a)(A.executionDuration.average))),description:i.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.alertsList.avgDurationDescription",{defaultMessage:"Average duration"})}))),Object(d.jsx)(r.EuiFlexItem,{grow:2},Object(d.jsx)(f,{executionDuration:A.executionDuration,numberOfExecutions:L,onChangeDuration:M,isLoading:T}))):Object(d.jsx)(o.a,null)}));var D=n(164);const y="xpack.triggersActionsUI.ruleEventLogList.initialColumns",S={minHeight:400},v=e=>{const{ruleId:t,ruleType:n,localStorageKey:a=y,refreshToken:s,requestRefresh:i,fetchRuleSummary:u=!0,loadExecutionLogAggregations:o}=e,{ruleSummary:c,numberOfExecutions:l,onChangeDuration:j,isLoadingRuleSummary:x=!1}=e;return Object(d.jsx)("div",{style:S,"data-test-subj":"ruleEventLogListContainer"},Object(d.jsx)(r.EuiSpacer,null),Object(d.jsx)(E,{ruleId:t,ruleType:n,ruleSummary:c,numberOfExecutions:l,isLoadingRuleSummary:x,refreshToken:s,onChangeDuration:j,requestRefresh:i,fetchRuleSummary:u}),Object(d.jsx)(r.EuiSpacer,null),Object(d.jsx)(D.a,{localStorageKey:a,ruleId:t,refreshToken:s,overrideLoadExecutionLogAggregations:o}))}},129:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return o}));var a=n(89),s=n.n(a),r=n(21),i=n(17);function u(e){if(!e)return"00:00:00.000";const t=s.a.duration(e);return`${[t.hours(),t.minutes(),t.seconds()].map((e=>Object(r.padStart)(`${e}`,2,"0"))).join(":")}.${Object(r.padStart)(`${t.milliseconds()}`,3,"0")}`}function o(e,t){if(!e||!e.ruleTaskTimeout)return!1;const n=e.ruleTaskTimeout;return t>Object(i.parseDuration)(n)}}}]);