/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[12],{78:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleEdit",(function(){return h})),s.d(t,"default",(function(){return h}));var a=s(1),i=s.n(a),c=s(88),n=s(4),l=s(21),u=s(3),r=s(15),o=s(179),j=s(167),d=s(148),b=s(60),g=s(165),O=s(142),p=s(22),x=s(168),E=s(169),y=s(149),f=s(131),m=s(0);const h=({initialRule:e,onClose:t,reloadRules:s,onSave:h,ruleTypeRegistry:v,actionTypeRegistry:T,metadata:S,...F})=>{const C=null!=h?h:s,[{rule:w},I]=Object(a.useReducer)(d.a,{rule:Object(l.cloneDeep)(e)}),[A,k]=Object(a.useState)(!1),[R,U]=Object(a.useState)(!1),[B,M]=Object(a.useState)(!1),[D,L]=Object(a.useState)(!1),[N,z]=Object(a.useState)([]),[P,_]=Object(a.useState)(!1),[G,H]=Object(a.useState)(F.ruleType),[W,V]=Object(a.useState)({isUsingSecurity:!1}),[q,J]=Object(a.useState)(S),K=Object(a.useCallback)((e=>J(e)),[]),{http:Q,notifications:{toasts:X}}=Object(p.b)().services,Y=v.get(w.ruleTypeId);Object(a.useEffect)((()=>{(async()=>{V(await Object(f.a)({http:Q}))})()}),[Q]),Object(a.useEffect)((()=>{(async()=>{_(!0);const e=await Object(j.a)(w,T);z([...e]),_(!1)})()}),[w,T]),Object(a.useEffect)((()=>{F.ruleType||G||(async()=>{const e=await Object(b.v)({http:Q});for(const t of e)Y.id===t.id&&H(t)})()}),[F.ruleType,Y.id,G,Q]);const{ruleBaseErrors:Z,ruleErrors:$,ruleParamsErrors:ee}=Object(j.b)(w,Y,W),te=()=>{Object(E.a)(w,e,!0)?L(!0):t(r.m.CANCELED,q)};return Object(m.jsx)(n.EuiPortal,null,Object(m.jsx)(n.EuiFlyout,{onClose:te,"aria-labelledby":"flyoutRuleEditTitle",size:"m",maxWidth:620,ownFocus:!1},Object(m.jsx)(n.EuiFlyoutHeader,{hasBorder:!0},Object(m.jsx)(n.EuiTitle,{size:"s","data-test-subj":"editRuleFlyoutTitle"},Object(m.jsx)("h3",{id:"flyoutTitle"},Object(m.jsx)(c.FormattedMessage,{defaultMessage:"Edit rule",id:"xpack.triggersActionsUI.sections.ruleEdit.flyoutTitle"})))),Object(m.jsx)(O.a,null,Object(m.jsx)(g.a,{inFlyout:!0,waitForCheck:!0},Object(m.jsx)(n.EuiFlyoutBody,null,R&&Object(m.jsx)(i.a.Fragment,null,Object(m.jsx)(n.EuiCallOut,{size:"s",color:"danger",iconType:"rule","data-test-subj":"hasActionsDisabled",title:u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.disabledActionsWarningTitle",{defaultMessage:"This rule has actions that are disabled"})}),Object(m.jsx)(n.EuiSpacer,null)),Object(m.jsx)(o.a,{rule:w,config:W,dispatch:I,errors:$,actionTypeRegistry:T,ruleTypeRegistry:v,canChangeTrigger:!1,setHasActionsDisabled:U,setHasActionsWithBrokenConnector:M,operation:u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.operationName",{defaultMessage:"edit"}),metadata:q,onChangeMetaData:K})),Object(m.jsx)(n.EuiFlyoutFooter,null,Object(m.jsx)(n.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiButtonEmpty,{"data-test-subj":"cancelSaveEditedRuleButton",onClick:()=>te()},u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.cancelButtonLabel",{defaultMessage:"Cancel"}))),P?Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiSpacer,{size:"s"}),Object(m.jsx)(n.EuiLoadingSpinner,{size:"l"})):Object(m.jsx)(i.a.Fragment,null),Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiFlexGroup,{alignItems:"center"},W.isUsingSecurity&&Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiIconTip,{type:"alert",position:"top","data-test-subj":"changeInPrivilegesTip",content:u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.changeInPrivilegesLabel",{defaultMessage:"Saving this rule will change its privileges and might change its behavior."})})),Object(m.jsx)(n.EuiFlexItem,{grow:!1},Object(m.jsx)(n.EuiButton,{fill:!0,color:"success","data-test-subj":"saveEditedRuleButton",type:"submit",iconType:"check",isLoading:A,onClick:async()=>await async function(){k(!0);try{if(P||!Object(j.c)(w,$,N)||B)a=Object(y.a)(w,ee,Z,N),I({command:{type:"setRule"},payload:{key:"rule",value:a}});else{const e=await Object(b.G)({http:Q,rule:w,id:w.id});X.addSuccess(u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveSuccessNotificationText",{defaultMessage:"Updated '{ruleName}'",values:{ruleName:e.name}})),t(r.m.SAVED,q),C&&C(q)}}catch(t){var e,s;X.addDanger(null!==(e=null===(s=t.body)||void 0===s?void 0:s.message)&&void 0!==e?e:u.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveErrorNotificationText",{defaultMessage:"Cannot update rule."}))}var a;k(!1)}()},Object(m.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleEdit.saveButtonLabel",defaultMessage:"Save"}))))))))),D&&Object(m.jsx)(x.a,{onConfirm:()=>{L(!1),t(r.m.CANCELED,q)},onCancel:()=>{L(!1)}})))}}}]);