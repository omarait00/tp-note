/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[33],{111:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleDefinition",(function(){return O})),s.d(t,"default",(function(){return O}));var n=s(8),i=s.n(n),r=s(1),o=s(4),l=s(48),a=s(3),u=s(17),c=s(75),j=s(22),d=s(120),b=s(130);var g=s(0);function x({ruleActions:e,actionTypeRegistry:t}){const{isLoadingActionConnectors:s,actionConnectors:n}=function({ruleActions:e}){const{http:t,notifications:{toasts:s}}=Object(j.b)().services,[n,i]=Object(r.useState)({isLoadingActionConnectors:!0,actionConnectors:[],errorActionConnectors:void 0}),o=Object(r.useCallback)((async()=>{try{if(!e||e.length<=0)return void i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:[]})));const s=await Object(c.loadAllActions)({http:t});i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:s})))}catch(e){const t=(n=e instanceof Error?e.message:"string"==typeof e?e:"",a.i18n.translate("xpack.triggersActionsUI.ruleDetails.connectorsLoadError",{defaultMessage:"Unable to load rule actions connectors. Reason: {message}",values:{message:n}}));i((e=>({...e,isLoadingActionConnectors:!1,errorActionConnectors:t}))),s.addDanger({title:t})}var n}),[t,e,s]);return Object(r.useEffect)((()=>{o()}),[o]),{...n,reloadRuleActionConnectors:o}}({ruleActions:e}),i=n&&n.length>0,l=e&&e.length>0;if(!i||!l)return Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiText,{size:"s"},a.i18n.translate("xpack.triggersActionsUI.ruleDetails.noActions",{defaultMessage:"No actions"})));const u=e=>{const s=t.list().find((t=>t.id===e));return"string"==typeof(null==s?void 0:s.iconClass)?null==s?void 0:s.iconClass:Object(c.suspendedComponentWithProps)(null==s?void 0:s.iconClass)};return s?Object(g.jsx)(o.EuiLoadingSpinner,{size:"s"}):Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"none"},e.map((({actionTypeId:e,id:t},s)=>{var i;const r=(e=>{const t=n.find((t=>t.id===e));return null==t?void 0:t.name})(t);return Object(g.jsx)(o.EuiFlexItem,{key:s},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",component:"span"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIcon,{size:"m",type:null!==(i=u(e))&&void 0!==i?i:"apps"})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiText,{"data-test-subj":`actionConnectorName-${s}-${r||e}`,size:"s"},r))),Object(g.jsx)(o.EuiSpacer,{size:"s"}))})))}var p=s(35);const O=({rule:e,actionTypeRegistry:t,ruleTypeRegistry:s,onEditRule:n,hideEditButton:i=!1,filteredRuleTypes:O})=>{var y;const{application:{capabilities:E}}=Object(j.b)().services,[I,h]=Object(r.useState)(!1),[A,F]=Object(r.useState)(),{ruleTypes:v,ruleTypeIndex:T,ruleTypesIsLoading:S}=Object(c.useLoadRuleTypes)({filteredRuleTypes:O}),C=Object(r.useMemo)((()=>{if(v.length&&e)return v.find((t=>t.id===e.ruleTypeId))}),[e,v]);Object(r.useEffect)((()=>{F(C)}),[C]);const M=()=>{const t=null!=e&&e.params.criteria?(null==e?void 0:e.params.criteria).length:0;return a.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditions",{defaultMessage:"{numberOfConditions, plural, one {# condition} other {# conditions}}",values:{numberOfConditions:t}})},k=Object(d.c)(E),D=e&&Object(d.a)(e,A)&&(k||!k&&0===e.actions.length),U=Object(r.useMemo)((()=>!i&&D&&!!s.has(e.ruleTypeId)&&!s.get(e.ruleTypeId).requiresAppContext),[i,D,s,e]),R=Object(r.useMemo)((()=>s.has(e.ruleTypeId)?s.get(e.ruleTypeId).description:e.consumer===l.V.SIEM?a.i18n.translate("xpack.triggersActionsUI.ruleDetails.securityDetectionRule",{defaultMessage:"Security detection rule"}):""),[e,s]);return Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"ruleSummaryRuleDefinition",grow:3},Object(g.jsx)(o.EuiPanel,{color:"subdued",hasBorder:!1,paddingSize:"m"},Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},a.i18n.translate("xpack.triggersActionsUI.ruleDetails.definition",{defaultMessage:"Definition"}))),S?Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiLoadingSpinner,{"data-test-subj":"ruleDetailsEditButtonLoadingSpinner"})):U&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{"data-test-subj":"ruleDetailsEditButton",iconType:"pencil",onClick:()=>h(!0)}))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,{alignItems:"baseline"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(f,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.ruleType",{defaultMessage:"Rule type"})),S?Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiLoadingSpinner,{"data-test-subj":"ruleSummaryRuleTypeLoadingSpinner"})):Object(g.jsx)(m,{"data-test-subj":"ruleSummaryRuleType",itemValue:(null===(y=T.get(e.ruleTypeId))||void 0===y?void 0:y.name)||e.ruleTypeId})),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,{alignItems:"flexStart",responsive:!1},Object(g.jsx)(f,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.description",{defaultMessage:"Description"})),Object(g.jsx)(m,{"data-test-subj":"ruleSummaryRuleDescription",itemValue:R})),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(f,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.runsEvery",{defaultMessage:"Runs every"})),Object(g.jsx)(m,{"data-test-subj":"ruleSummaryRuleInterval",itemValue:Object(u.formatDuration)(e.schedule.interval)})),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center"},Object(g.jsx)(f,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditionsTitle",{defaultMessage:"Conditions"})),Object(g.jsx)(o.EuiFlexItem,{grow:3},Object(g.jsx)(o.EuiFlexGroup,{"data-test-subj":"ruleSummaryRuleConditions",alignItems:"center",gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},U?Object(g.jsx)(o.EuiButtonEmpty,{onClick:()=>h(!0),flush:"left"},Object(g.jsx)(o.EuiText,{size:"s"},M())):Object(g.jsx)(o.EuiText,{size:"s"},M()))))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(f,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.notifyWhen",{defaultMessage:"Notify"})),Object(g.jsx)(m,{itemValue:String((null===(w=b.NOTIFY_WHEN_OPTIONS.find((t=>t.value===(null==e?void 0:e.notifyWhen))))||void 0===w?void 0:w.inputDisplay)||(null==e?void 0:e.notifyWhen))}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,{alignItems:"baseline"},Object(g.jsx)(f,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.actions",{defaultMessage:"Actions"})),Object(g.jsx)(o.EuiFlexItem,{grow:3},Object(g.jsx)(x,{ruleActions:e.actions,actionTypeRegistry:t})))))),I&&Object(g.jsx)(p.b,{onSave:()=>(h(!1),n()),initialRule:e,onClose:()=>h(!1),ruleTypeRegistry:s,actionTypeRegistry:t}));var w};function m({itemValue:e,extraSpace:t=!0,...s}){return Object(g.jsx)(o.EuiFlexItem,i()({grow:t?3:1},s),Object(g.jsx)(o.EuiText,{size:"s"},e))}function f({children:e}){return Object(g.jsx)(o.EuiTitle,{size:"xxs"},Object(g.jsx)(o.EuiFlexItem,{style:{whiteSpace:"nowrap"},grow:1},e))}},130:function(e,t,s){"use strict";s.r(t),s.d(t,"NOTIFY_WHEN_OPTIONS",(function(){return d})),s.d(t,"RuleNotifyWhen",(function(){return b}));var n=s(1),i=s.n(n),r=s(3),o=s(88),l=s(4),a=s(124),u=s(63),c=s(50),j=s(0);const d=[{value:"onActionGroupChange",inputDisplay:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.display",{defaultMessage:"On status changes"}),"data-test-subj":"onActionGroupChange",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"On status changes",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"Actions run if the alert status changes.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.description"}))))},{value:"onActiveAlert",inputDisplay:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.display",{defaultMessage:"On check intervals"}),"data-test-subj":"onActiveAlert",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"On check intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.description"}))))},{value:"onThrottleInterval",inputDisplay:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.display",{defaultMessage:"On custom action intervals"}),"data-test-subj":"onThrottleInterval",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"On custom action intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.description"}))))}],b=({rule:e,throttle:t,throttleUnit:s,onNotifyWhenChange:b,onThrottleChange:g})=>{const[x,p]=Object(n.useState)(t||1),[O,m]=Object(n.useState)(!1),[f,y]=Object(n.useState)("onActionGroupChange");Object(n.useEffect)((()=>{e.notifyWhen?y(e.notifyWhen):y(e.throttle?"onThrottleInterval":"onActiveAlert")}),[e]),Object(n.useEffect)((()=>{m("onThrottleInterval"===f)}),[f]);const E=Object(n.useCallback)((e=>{g("onThrottleInterval"===e?x:null,s),b(e),y(e)}),[]),I=Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(o.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.renotifyFieldLabel",defaultMessage:"Notify"})," ",Object(j.jsx)(l.EuiIconTip,{position:"right",type:"questionInCircle",content:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.renotifyWithTooltip",{defaultMessage:"Define how often alerts generate actions."})}));return Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiFormRow,{fullWidth:!0,label:I},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiSuperSelect,{"data-test-subj":"notifyWhenSelect",options:d,valueOfSelected:f,onChange:E}),O&&Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiSpacer,null),Object(j.jsx)(l.EuiFormRow,{fullWidth:!0},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiFieldNumber,{fullWidth:!0,min:1,value:x,name:"throttle","data-test-subj":"throttleInput",prepend:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.label",{defaultMessage:"Every"}),onChange:e=>{Object(u.pipe)(Object(a.some)(e.target.value.trim()),Object(a.filter)((e=>""!==e)),Object(a.map)((e=>parseInt(e,10))),Object(a.filter)((e=>!isNaN(e))),Object(a.map)((e=>{p(e),g(e,s)})))}})),Object(j.jsx)(l.EuiFlexItem,{grow:!1},Object(j.jsx)(l.EuiSelect,{"data-test-subj":"throttleUnitInput",value:s,options:Object(c.b)(null!=t?t:1),onChange:e=>{g(t,e.target.value)}})))))))))}}}]);