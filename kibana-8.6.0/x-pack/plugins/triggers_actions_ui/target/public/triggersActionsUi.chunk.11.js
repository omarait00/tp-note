/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[11],{79:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return I}));var s=a(1),n=a.n(s),c=a(88),i=a(4),l=a(3),u=a(21),o=a(15),r=a(179),d=a(167),j=a(148),b=a(60),g=a(165),f=a(0);const m=({onConfirm:e,onCancel:t})=>Object(f.jsx)(i.EuiConfirmModal,{title:l.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveTitle",{defaultMessage:"Save rule with no actions?"}),onCancel:t,onConfirm:e,confirmButtonText:l.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveConfirmButtonText",{defaultMessage:"Save rule"}),cancelButtonText:l.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveCancelButtonText",{defaultMessage:"Cancel"}),defaultFocusedButton:"confirm","data-test-subj":"confirmRuleSaveModal"},Object(f.jsx)("p",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveWithoutActionsMessage",defaultMessage:"You can add an action at anytime."})));var O=a(168),p=a(120),y=a(142);const v=({isSaving:e,onSave:t,onCancel:a,isFormLoading:s})=>{const{loadingHealthCheck:u}=Object(y.b)();return Object(f.jsx)(i.EuiFlyoutFooter,null,Object(f.jsx)(i.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(f.jsx)(i.EuiFlexItem,{grow:!1},Object(f.jsx)(i.EuiButtonEmpty,{"data-test-subj":"cancelSaveRuleButton",onClick:a},l.i18n.translate("xpack.triggersActionsUI.sections.ruleAddFooter.cancelButtonLabel",{defaultMessage:"Cancel"}))),s?Object(f.jsx)(i.EuiFlexItem,{grow:!1},Object(f.jsx)(i.EuiSpacer,{size:"s"}),Object(f.jsx)(i.EuiLoadingSpinner,{size:"l"})):Object(f.jsx)(n.a.Fragment,null),Object(f.jsx)(i.EuiFlexItem,{grow:!1},Object(f.jsx)(i.EuiButton,{fill:!0,color:"success","data-test-subj":"saveRuleButton",type:"submit",iconType:"check",isDisabled:u,isLoading:e,onClick:t},Object(f.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleAddFooter.saveButtonLabel",defaultMessage:"Save"})))))};var x=a(22),S=a(169),E=a(149),h=a(2),C=a(131),T=a(166);const I=({consumer:e,ruleTypeRegistry:t,actionTypeRegistry:a,onClose:n,canChangeTrigger:I,ruleTypeId:A,initialValues:F,reloadRules:R,onSave:w,metadata:M,filteredRuleTypes:k,...B})=>{var U;const L=null!=w?w:R,[N,D]=Object(s.useState)(M),z=Object(s.useCallback)((e=>D(e)),[]),_=Object(s.useMemo)((()=>({params:{},consumer:e,ruleTypeId:A,schedule:{interval:h.d},actions:[],tags:[],notifyWhen:"onActionGroupChange",...F||{}})),[A,e,F]),[{rule:P},W]=Object(s.useReducer)(j.a,{rule:_}),[G,H]=Object(s.useState)({isUsingSecurity:!1}),[V,Y]=Object(s.useState)({}),[q,J]=Object(s.useState)(!1),[K,Q]=Object(s.useState)(!1),[X,Z]=Object(s.useState)(!1),[$,ee]=Object(s.useState)(B.ruleTypeIndex),[te,ae]=Object(s.useState)(!1),se=(e,t)=>{W({command:{type:"setProperty"},payload:{key:e,value:t}})},{http:ne,notifications:{toasts:ce},application:{capabilities:ie}}=Object(x.b)().services,le=Object(p.f)(ie);Object(s.useEffect)((()=>{(async()=>{H(await Object(C.a)({http:ne}))})()}),[ne]),Object(s.useEffect)((()=>{A&&se("ruleTypeId",A)}),[A]),Object(s.useEffect)((()=>{B.ruleTypeIndex||(async()=>{const e=await Object(b.v)({http:ne}),t=new Map;for(const a of e)t.set(a.id,a);ee(t)})()}),[B.ruleTypeIndex,ne]),Object(s.useEffect)((()=>{Object(u.isEmpty)(P.params)&&!Object(u.isEmpty)(V)?Y({}):Object(u.isEmpty)(V)&&Y(P.params)}),[P.params,V]);const[ue,oe]=Object(s.useState)([]),[re,de]=Object(s.useState)(!1);Object(s.useEffect)((()=>{(async()=>{de(!0);const e=await Object(d.a)(P,a);de(!1),oe([...e])})()}),[P,a]),Object(s.useEffect)((()=>{var e;!G.minimumScheduleInterval||null!=F&&null!==(e=F.schedule)&&void 0!==e&&e.interval||se("schedule",{interval:Object(T.a)(G.minimumScheduleInterval.value)})}),[G.minimumScheduleInterval,F]),Object(s.useEffect)((()=>{if(P.ruleTypeId&&$){const e=$.get(P.ruleTypeId);null!=e&&e.defaultScheduleInterval&&!te&&se("schedule",{interval:e.defaultScheduleInterval})}}),[P.ruleTypeId,$,P.schedule.interval,te]),Object(s.useEffect)((()=>{P.schedule.interval===h.d||te||ae(!0)}),[P.schedule.interval,te]);const je=()=>{Object(S.a)(P,_,!1)||Object(S.b)(P.params,V)?Z(!0):n(o.m.CANCELED,N)},be=async()=>{const e=await async function(){try{const e=await Object(b.g)({http:ne,rule:P});return ce.addSuccess(l.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveSuccessNotificationText",{defaultMessage:'Created rule "{ruleName}"',values:{ruleName:e.name}})),e}catch(a){var e,t;ce.addDanger(null!==(e=null===(t=a.body)||void 0===t?void 0:t.message)&&void 0!==e?e:l.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveErrorNotificationText",{defaultMessage:"Cannot create rule."}))}}();J(!1),e&&(n(o.m.SAVED,N),L&&L(N))},ge=P.ruleTypeId?t.get(P.ruleTypeId):null,{ruleBaseErrors:fe,ruleErrors:me,ruleParamsErrors:Oe}=Object(d.b)(P,ge,G),pe=le&&0===(null===(U=P.actions)||void 0===U?void 0:U.length);return Object(f.jsx)(i.EuiPortal,null,Object(f.jsx)(i.EuiFlyout,{onClose:je,"aria-labelledby":"flyoutRuleAddTitle",size:"m",maxWidth:620,ownFocus:!0},Object(f.jsx)(i.EuiFlyoutHeader,{hasBorder:!0},Object(f.jsx)(i.EuiTitle,{size:"s","data-test-subj":"addRuleFlyoutTitle"},Object(f.jsx)("h3",{id:"flyoutTitle"},Object(f.jsx)(c.FormattedMessage,{defaultMessage:"Create rule",id:"xpack.triggersActionsUI.sections.ruleAdd.flyoutTitle"})))),Object(f.jsx)(y.a,null,Object(f.jsx)(g.a,{inFlyout:!0,waitForCheck:!0},Object(f.jsx)(i.EuiFlyoutBody,null,Object(f.jsx)(r.a,{rule:P,config:G,dispatch:W,errors:me,canChangeTrigger:I,operation:l.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.operationName",{defaultMessage:"create"}),actionTypeRegistry:a,ruleTypeRegistry:t,metadata:N,filteredRuleTypes:k,onChangeMetaData:z})),Object(f.jsx)(v,{isSaving:q,isFormLoading:re,onSave:async()=>{if(J(!0),re||!Object(d.c)(P,me,ue))return e=Object(E.a)(P,Oe,fe,ue),W({command:{type:"setRule"},payload:{key:"rule",value:e}}),void J(!1);var e;pe?Q(!0):await be()},onCancel:je}))),K&&Object(f.jsx)(m,{onConfirm:async()=>{Q(!1),await be()},onCancel:()=>{J(!1),Q(!1)}}),X&&Object(f.jsx)(O.a,{onConfirm:()=>{Z(!1),n(o.m.CANCELED,N)},onCancel:()=>{Z(!1)}})))}}}]);