/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[31],{118:function(e,t,s){"use strict";s.r(t),s.d(t,"AlertsTableState",(function(){return D})),s.d(t,"default",(function(){return D}));var l=s(1),n=s.n(l),o=s(21),i=s(4),a=s(55),r=s(18),u=s(156),c=s(273),d=s(132),b=s(88),g=s(240),j=s.n(g),m=s(0);const p={tall:490,short:250},f={maxWidth:500},C=({height:e="tall"})=>Object(m.jsx)(i.EuiPanel,{color:"subdued","data-test-subj":"alertsStateTableEmptyState"},Object(m.jsx)(i.EuiFlexGroup,{style:{height:p[e]},alignItems:"center",justifyContent:"center"},Object(m.jsx)(i.EuiFlexItem,{grow:!1},Object(m.jsx)(i.EuiPanel,{hasBorder:!0,style:f},Object(m.jsx)(i.EuiFlexGroup,null,Object(m.jsx)(i.EuiFlexItem,null,Object(m.jsx)(i.EuiText,{size:"s"},Object(m.jsx)(i.EuiTitle,null,Object(m.jsx)("h3",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.triggersActionsUI.empty.title",defaultMessage:"No results match your search criteria"}))),Object(m.jsx)("p",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.triggersActionsUI.empty.description",defaultMessage:"Try searching over a longer period of time or modifying your search"})))),Object(m.jsx)(i.EuiFlexItem,{grow:!1},Object(m.jsx)(i.EuiImage,{size:"200",alt:"",url:j.a})))))));var O=s(172),v=s(15);const x=e=>new Set(Array.from(Array(e).keys())),S=(e,{action:t,rowIndex:s,rowCount:l})=>{const{rowSelection:n,rowCount:o}=e,i={...e};if(t===v.g.add&&void 0!==s){const e=new Set(n);e.add(s),i.rowSelection=e}else if(t===v.g.delete&&void 0!==s){const e=new Set(n);e.delete(s),i.rowSelection=e}else t===v.g.selectCurrentPage?i.rowSelection=x(o):t===v.g.selectAll?(i.rowSelection=x(o),i.isAllSelected=!0):t===v.g.clear?(i.rowSelection=new Set,i.isAllSelected=!1):t===v.g.rowCountUpdate&&void 0!==l&&(i.rowCount=l);return i.areAllVisibleRowsSelected=i.rowSelection.size===i.rowCount,i};var h=s(177),w=s(22),y=s(170);const A=(e,t,s)=>{return{...F(s,e)||{id:e},schema:(l=I(e,t).type,"date"===l?"datetime":"number"===l?"numeric":"object"===l?"json":l)};var l},I=(e,t)=>{const s={type:"string"};if(!t||0===Object.keys(t).length)return s;const l=(e=>{const t=e.split(".");return 1===t.length?"base":t[0]})(e);if(!t[l])return s;const n=t[l].fields;if(!n)return s;return n[e]||s},E=(e,t,s)=>e.map((e=>(e=>Boolean(e.schema))(e)?e:A(e.id,t,s))),T=e=>e.map((e=>e.id)),F=(e,t)=>e.find((({id:e})=>e===t)),k={pageSize:10,pageIndex:0},z={id:"",casesFeatureId:"",columns:[],sort:[],externalFlyout:{header:()=>null,body:()=>null,footer:()=>null},internalFlyout:{header:()=>null,body:()=>null,footer:()=>null},getRenderCellValue:()=>()=>null},P=({tableProps:e,initialBulkActionsState:t})=>Object(m.jsx)(d.a.Provider,{value:t},Object(m.jsx)(c.AlertsTable,e)),R=n.a.memo(P),B=[{field:"*",include_unmapped:!0}],D=({alertsTableConfigurationRegistry:e,configurationId:t,id:s,featureIds:c,flyoutSize:d,query:b,pageSize:g,showExpandToDetails:j})=>{var p,f,v,x,I,F,P;const{cases:D}=Object(r.useKibana)().services,U=null!==(p=null==e?void 0:e.has(t))&&void 0!==p&&p,V=U?e.get(t):z,_=Object(l.useRef)(new a.Storage(window.localStorage)),M=_.current.get(s),L=M&&M.columns&&!Object(o.isEmpty)(null==M?void 0:M.columns)?null!==(f=null==M?void 0:M.columns)&&void 0!==f?f:[]:null!==(v=null==V?void 0:V.columns)&&void 0!==v?v:[],q=Object(l.useRef)({columns:L,sort:M&&M.sort&&!Object(o.isEmpty)(null==M?void 0:M.sort)?null!==(x=null==M?void 0:M.sort)&&void 0!==x?x:[]:null!==(I=null==V?void 0:V.sort)&&void 0!==I?I:[],visibleColumns:M&&M.visibleColumns&&!Object(o.isEmpty)(null==M?void 0:M.visibleColumns)?null!==(F=null==M?void 0:M.visibleColumns)&&void 0!==F?F:[]:L.map((e=>e.id))}),[K,G]=Object(l.useState)(q.current.sort),[N,Q]=Object(l.useState)({...k,pageSize:null!=g?g:k.pageSize}),{columns:W,onColumnsChange:$,browserFields:H,isBrowserFieldDataLoading:J,onToggleColumn:X,onResetColumns:Y,visibleColumns:Z,onChangeVisibleColumns:ee}=(({featureIds:e,storageAlertsTable:t,storage:s,id:n,defaultColumns:o})=>{const[i,a]=(({featureIds:e})=>{const{http:t,notifications:{toasts:s}}=Object(w.b)().services,[n,o]=Object(l.useState)(void 0),[i,a]=Object(l.useState)((()=>({}))),r=Object(l.useCallback)((async()=>{if(!t)return Promise.resolve({});try{return await t.get(`${h.a}/browser_fields`,{query:{featureIds:e}})}catch(e){return s.addDanger(y.b),{}}}),[e,t,s]);return Object(l.useEffect)((()=>{void 0!==n||e.includes("siem")||(o(!0),(async()=>{const e=await r();a(e),o(!1)})())}),[r,n,e]),[n,i]})({featureIds:e}),[r,u]=Object(l.useState)(t.current.columns),[c,d]=Object(l.useState)(!1);Object(l.useEffect)((()=>{if(!1!==i||c)return;const e=E(r,a,o);d(!0),u(e)}),[a,r,o,i,c]);const b=Object(l.useCallback)((e=>{u(e),(({id:e,storageAlertsTable:t,columns:s,storage:l})=>{t.current={...t.current,columns:s},l.current.set(e,t.current)})({id:n,storage:s,storageAlertsTable:t,columns:e})}),[n,s,t]),g=Object(l.useCallback)((e=>{const t=((e,t)=>t.map((t=>e.find((e=>e.id===t)))).filter(Boolean))(r,e);b(t)}),[b,r]),j=Object(l.useCallback)((e=>{const t=(({column:e,columns:t,defaultColumns:s})=>{const l=t.findIndex((t=>t.id===e.id));return l>=0?(({columns:e,index:t})=>[...e.slice(0,t),...e.slice(t+1)])({columns:t,index:l}):(({column:e,columns:t,defaultColumns:s})=>{const l=s.findIndex((t=>t.id===e.id));return l>=0?[...t.slice(0,l),e,...t.slice(l)]:[t[0],e,...t.slice(1)]})({defaultColumns:s,column:e,columns:t})})({column:A(e,a,o),columns:r,defaultColumns:o});b(t)}),[a,r,o,b]),m=Object(l.useCallback)((()=>{const e=E(o,a,o);b(e)}),[a,o,b]);return{columns:r,visibleColumns:T(r),isBrowserFieldDataLoading:i,browserFields:a,onColumnsChange:b,onToggleColumn:j,onResetColumns:m,onChangeVisibleColumns:g}})({featureIds:c,storageAlertsTable:q,storage:_,id:s,defaultColumns:null!==(P=V&&V.columns)&&void 0!==P?P:[]}),[te,{alerts:se,isInitializing:le,getInspectQuery:ne,refetch:oe,totalAlerts:ie,updatedAt:ae}]=Object(u.a)({fields:B,featureIds:c,query:b,pagination:N,sort:K,skip:!1}),re=Object(l.useCallback)((e=>{Q(e)}),[]),ue=Object(l.useReducer)(S,{rowSelection:new Set,isAllSelected:!1,areAllVisibleRowsSelected:!1,rowCount:se.length}),ce=Object(l.useCallback)((e=>{const t=e.map((e=>({[e.id]:{order:e.direction}})));q.current={...q.current,sort:t},_.current.set(s,q.current),G(t)}),[s]),de=Object(l.useCallback)((()=>({activePage:N.pageIndex,alerts:se,alertsCount:ie,isInitializing:le,isLoading:te,getInspectQuery:ne,onPageChange:re,onSortChange:ce,refresh:oe,sort:K,updatedAt:ae})),[se,ie,ne,le,te,re,ce,N.pageIndex,oe,K,ae]),be=Object(l.useMemo)((()=>({alertsTableConfiguration:V,columns:W,bulkActions:[],deletedEventIds:[],disabledCellActions:[],flyoutSize:d,pageSize:N.pageSize,pageSizeOptions:[10,20,50,100],id:s,leadingControlColumns:[],showExpandToDetails:j,trailingControlColumns:[],useFetchAlertsData:de,visibleColumns:Z,"data-test-subj":"internalAlertsState",updatedAt:ae,browserFields:H,onToggleColumn:X,onResetColumns:Y,onColumnsChange:$,onChangeVisibleColumns:ee})),[V,W,d,N.pageSize,s,j,de,Z,ae,H,X,Y,$,ee]),ge=null==D?void 0:D.ui.getCasesContext(),je=function(e){var t;const[s,n]=Object(l.useState)({all:!1,read:!1,create:!1,update:!1,delete:!1,push:!1}),o=null===(t=Object(r.useKibana)().services.application)||void 0===t?void 0:t.capabilities,i=Object(r.useKibana)().services.cases.helpers.getUICapabilities(o[e]);return Object(l.useEffect)((()=>{n({all:i.all,create:i.create,read:i.read,update:i.update,delete:i.delete,push:i.push})}),[i.all,i.create,i.read,i.update,i.delete,i.push]),s}(V.casesFeatureId);return U?Object(m.jsx)(n.a.Fragment,null,!te&&0===ie&&Object(m.jsx)(C,null),(te||J)&&Object(m.jsx)(i.EuiProgress,{size:"xs",color:"accent","data-test-subj":"internalAlertsPageLoading"}),0!==ie&&ge&&D&&Object(m.jsx)(ge,{owner:[t],permissions:je,features:{alerts:{sync:!1}}},Object(m.jsx)(R,{tableProps:be,initialBulkActionsState:ue})),0!==ie&&(!ge||!D)&&Object(m.jsx)(R,{tableProps:be,initialBulkActionsState:ue})):Object(m.jsx)(i.EuiEmptyPrompt,{"data-test-subj":"alertsTableNoConfiguration",iconType:"watchesApp",title:Object(m.jsx)("h2",null,O.b),body:Object(m.jsx)("p",null,O.a)})}},240:function(e,t,s){e.exports=s.p+"94cccf20036d014924e63d4d595e88e1.svg"}}]);