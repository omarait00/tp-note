/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[27],{119:function(e,t,r){"use strict";r.r(t),r.d(t,"RuleAlertsSummary",(function(){return x})),r.d(t,"default",(function(){return x}));var s=r(4),a=r(17),l=r(88),u=r(1),i=r.n(u),o=r(152),c=r(22);var n=r(68),d=r(100),j=r(0);const g=({active:e,recovered:t,timeRange:r})=>Object(j.jsx)(s.EuiPanel,{"data-test-subj":"ruleAlertsSummary",hasShadow:!1,hasBorder:!0},Object(j.jsx)(s.EuiFlexGroup,{direction:"column"},Object(j.jsx)(s.EuiFlexItem,{grow:!1},Object(j.jsx)(s.EuiFlexGroup,{direction:"column"},Object(j.jsx)(s.EuiFlexItem,{grow:!1},Object(j.jsx)(s.EuiTitle,{size:"xxs"},Object(j.jsx)("h5",null,Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.alertsSummary.title",defaultMessage:"Alerts"}))),!!r&&Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(s.EuiSpacer,{size:"s"}),Object(j.jsx)(s.EuiText,{size:"s",color:"subdued"},r))),Object(j.jsx)(s.EuiFlexItem,null,Object(j.jsx)(s.EuiFlexGroup,{gutterSize:"s",alignItems:"flexStart",responsive:!1},Object(j.jsx)(s.EuiFlexItem,null,Object(j.jsx)(s.EuiText,null,Object(j.jsx)("h3",{"data-test-subj":"totalAlertsCount"},e+t)),Object(j.jsx)(s.EuiText,{size:"xs",color:"subdued"},Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.alertsSummary.allAlertsLabel",defaultMessage:"All"}))),Object(j.jsx)(s.EuiFlexItem,null,Object(j.jsx)(s.EuiFlexItem,null,Object(j.jsx)(s.EuiText,{color:d.euiLightVars.euiColorSuccessText},Object(j.jsx)("h3",{"data-test-subj":"recoveredAlertsCount"},t))),Object(j.jsx)(s.EuiText,{size:"xs",color:"subdued"},Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.rule.ruleSummary.recoveredLabel",defaultMessage:"Recovered"}))),Object(j.jsx)(s.EuiFlexItem,null,Object(j.jsx)(s.EuiText,{color:d.euiLightVars.euiColorDangerText},Object(j.jsx)("h3",{"data-test-subj":"activeAlertsCount"},e)),Object(j.jsx)(s.EuiText,{size:"xs",color:"subdued"},Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.alertsSummary.activeLabel",defaultMessage:"Currently active"}))))))))),b=()=>Object(j.jsx)(s.EuiEmptyPrompt,{"data-test-subj":"alertsRuleSummaryErrorPrompt",iconType:"alert",color:"danger",title:Object(j.jsx)("h5",null,Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.alertsSummary.errorLoadingTitle",defaultMessage:"Unable to load the alerts summary"})),body:Object(j.jsx)("p",null,Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.alertsSummary.errorLoadingBody",defaultMessage:"There was an error loading the alerts summary. Contact your administrator for help."}))}),x=({rule:e,filteredRuleTypes:t})=>{const[r,i]=Object(u.useState)(""),{ruleTypes:d}=Object(n.a)({filteredRuleTypes:t}),{ruleAlertsAggs:{active:x,recovered:m},isLoadingRuleAlertsAggs:O,errorRuleAlertsAggs:A}=function({features:e,ruleId:t}){const{http:r}=Object(c.b)().services,[s,a]=Object(u.useState)({isLoadingRuleAlertsAggs:!0,ruleAlertsAggs:{active:0,recovered:0}}),l=Object(u.useRef)(!1),i=Object(u.useRef)(new AbortController),n=Object(u.useCallback)((async()=>{l.current=!1,i.current.abort(),i.current=new AbortController;try{if(!e)return;const{index:s}=await async function({http:e,features:t}){return{index:(await e.get(`${o.a}/index`,{query:{features:t}})).index_name[0]}}({http:r,features:e}),{active:u,recovered:c,error:n}=await async function({http:e,index:t,ruleId:r,signal:s}){try{var a,l,u,i,c,n;const d=await e.post(`${o.a}/find`,{signal:s,body:JSON.stringify({index:t,size:0,query:{bool:{must:[{term:{"kibana.alert.rule.uuid":r}},{range:{"@timestamp":{gte:"now-30d",lt:"now"}}},{bool:{should:[{term:{"kibana.alert.status":"active"}},{term:{"kibana.alert.status":"recovered"}}]}}]}},aggs:{total:{filters:{filters:{totalActiveAlerts:{term:{"kibana.alert.status":"active"}},totalRecoveredAlerts:{term:{"kibana.alert.status":"recovered"}}}}}}})});return{active:null!==(a=null==d||null===(l=d.aggregations)||void 0===l||null===(u=l.total.buckets.totalActiveAlerts)||void 0===u?void 0:u.doc_count)&&void 0!==a?a:0,recovered:null!==(i=null==d||null===(c=d.aggregations)||void 0===c||null===(n=c.total.buckets.totalRecoveredAlerts)||void 0===n?void 0:n.doc_count)&&void 0!==i?i:0}}catch(e){return{error:e,active:0,recovered:0}}}({http:r,index:s,ruleId:t,signal:i.current.signal});if(n)throw n;l.current||a((e=>({...e,ruleAlertsAggs:{active:u,recovered:c},isLoadingRuleAlertsAggs:!1})))}catch(e){l.current||"AbortError"!==e.name&&a((t=>({...t,isLoadingRuleAlertsAggs:!1,errorRuleAlertsAggs:e})))}}),[r,e,t]);return Object(u.useEffect)((()=>{n()}),[n]),s}({ruleId:e.id,features:r});return Object(u.useEffect)((()=>{const t=d.find((t=>t.id===e.ruleTypeId));e.consumer===a.ALERTS_FEATURE_ID&&t&&t.producer?i(t.producer):i(e.consumer)}),[e,d]),O?Object(j.jsx)(s.EuiLoadingSpinner,null):A?Object(j.jsx)(b,null):Object(j.jsx)(g,{active:x,recovered:m,timeRange:Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.alertsSummary.last30days",defaultMessage:"Last 30 days"})})}},152:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));const s="/internal/rac/alerts"}}]);