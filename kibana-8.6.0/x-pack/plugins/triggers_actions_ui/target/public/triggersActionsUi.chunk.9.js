/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[9],{132:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var s=n(1);const a=Object(s.createContext)([{rowSelection:new Set,isAllSelected:!1,areAllVisibleRowsSelected:!1,rowCount:0},()=>{}])},150:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));const s=[{"@timestamp":{order:"asc"}}]},156:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var s=n(67),a=n.n(s),o=n(21),r=n(1),l=n(105),i=n(113),u=n(22),c=n(150),d=n(170);const g={loading:!1,request:{featureIds:[],fields:[],query:{bool:{}},pagination:{pageIndex:0,pageSize:50},sort:c.a},response:{alerts:[],totalAlerts:-1,isInitializing:!0,updatedAt:0}};function b(e,t){switch(t.type){case"loading":return{...e,loading:t.loading};case"response":return{...e,loading:!1,response:{isInitializing:!1,alerts:t.alerts,totalAlerts:t.totalAlerts,updatedAt:Date.now()}};case"resetPagination":return{...e,request:{...e.request,pagination:{...e.request.pagination,pageIndex:0}}};case"request":return{...e,request:t.request};default:throw new Error}}const p=({featureIds:e,fields:t,query:n,pagination:s,skip:c,sort:p})=>{const f=Object(r.useRef)(o.noop),j=Object(r.useRef)(new AbortController),C=Object(r.useRef)(new l.Subscription),[{loading:x,request:h,response:A},m]=Object(r.useReducer)(b,g),O=Object(r.useRef)(null),w=Object(r.useRef)({request:[],response:[]}),{data:S}=Object(u.b)().services,I=Object(r.useCallback)((()=>w.current),[]),v=Object(r.useCallback)((()=>{var e,t,n;0!==(null!==(e=null===(t=O.current)||void 0===t||null===(n=t.pagination)||void 0===n?void 0:n.pageIndex)&&void 0!==e?e:0)?m({type:"resetPagination"}):f.current()}),[]),k=Object(r.useCallback)((t=>{if(null==t||c)return;const s=async()=>{O.current=t,j.current=new AbortController,m({type:"loading",loading:!0}),S&&S.search&&(C.current=S.search.search({...t,featureIds:e,fields:void 0,query:n},{strategy:"privateRuleRegistryAlertsSearchStrategy",abortSignal:j.current.signal}).subscribe({next:e=>{if(Object(i.isCompleteResponse)(e)){const{rawResponse:s}=e;w.current={request:[],response:[]};let a=0;if(s.hits.total&&"number"==typeof s.hits.total)a=s.hits.total;else if(s.hits.total&&"object"==typeof s.hits.total){var t,n;a=null!==(t=null===(n=s.hits.total)||void 0===n?void 0:n.value)&&void 0!==t?t:0}m({type:"response",alerts:s.hits.hits.reduce(((e,t)=>(t.fields&&e.push({...t.fields,_id:t._id,_index:t._index}),e)),[]),totalAlerts:a}),C.current.unsubscribe()}else Object(i.isErrorResponse)(e)&&(m({type:"loading",loading:!1}),S.search.showError(new Error(d.a)),C.current.unsubscribe())},error:e=>{m({type:"loading",loading:!1}),S.search.showError(e),C.current.unsubscribe()}}))};C.current.unsubscribe(),j.current.abort(),s(),f.current=s}),[c,S,e,n]);return Object(r.useEffect)((()=>{if(0===e.length)return;const o={featureIds:e,fields:t,pagination:s,query:n,sort:p};o.fields.length>0&&!a()(o,O.current)&&m({type:"request",request:o})}),[e,t,s,n,p]),Object(r.useEffect)((()=>{h.featureIds.length>0&&!a()(h,O.current)&&k(h)}),[h,k]),[x,Object(r.useMemo)((()=>({...A,getInspectQuery:I,refetch:v})),[A,I,v])]}},170:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));var s=n(3);const a=s.i18n.translate("xpack.triggersActionsUI.components.alertTable.useFetchAlerts.errorMessageText",{defaultMessage:"An error has occurred on alerts search"}),o=s.i18n.translate("xpack.triggersActionsUI.components.alertTable.useFetchBrowserFieldsCapabilities.errorMessageText",{defaultMessage:"An error has occurred loading browser fields"})},171:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return l}));var s=n(3);const a=(e,t)=>s.i18n.translate("xpack.triggersActionsUI.toolbar.bulkActions.selectedAlertsTitle",{values:{selectedAlertsFormatted:e,selectedAlerts:t},defaultMessage:"Selected {selectedAlertsFormatted} {selectedAlerts, plural, =1 {alert} other {alerts}}"}),o=(e,t)=>s.i18n.translate("xpack.triggersActionsUI.toolbar.bulkActions.selectAllAlertsTitle",{values:{totalAlertsFormatted:e,totalAlerts:t},defaultMessage:"Select all {totalAlertsFormatted} {totalAlerts, plural, =1 {alert} other {alerts}}"}),r=s.i18n.translate("xpack.triggersActionsUI.toolbar.bulkActions.clearSelectionTitle",{defaultMessage:"Clear selection"}),l=s.i18n.translate("xpack.triggersActionsUI.bulkActions.columnHeader.AriaLabel",{defaultMessage:"Select all rows"})},172:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return l}));var s=n(3);const a=s.i18n.translate("xpack.triggersActionsUI.alertsTable.configuration.errorTitle",{defaultMessage:"Unable to load alerts table"}),o=s.i18n.translate("xpack.triggersActionsUI.alertsTable.configuration.errorBody",{defaultMessage:"There was an error loading the alerts table. This table is missing the necessary configuration. Please contact your administrator for help"}),r=s.i18n.translate("xpack.triggersActionsUI.sections.alertsTable.column.actions",{defaultMessage:"Actions"}),l=s.i18n.translate("xpack.triggersActionsUI.sections.alertsTable.leadingControl.viewDetails",{defaultMessage:"View details"})},195:function(e,t,n){switch(window.__kbnThemeTag__){case"v8dark":return n(196);case"v8light":return n(198)}},196:function(e,t,n){var s=n(58),a=n(197);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},197:function(e,t,n){(t=n(59)(!1)).push([e.i,".alertsTableActiveRow{background-color:#343741}",""]),e.exports=t},198:function(e,t,n){var s=n(58),a=n(199);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},199:function(e,t,n){(t=n(59)(!1)).push([e.i,".alertsTableActiveRow{background-color:#e9edf3}",""]),e.exports=t},273:function(e,t,n){"use strict";n.r(t),n.d(t,"ACTIVE_ROW_CLASS",(function(){return T})),n.d(t,"AlertsTable",(function(){return F})),n.d(t,"default",(function(){return F}));var s=n(48),a=n(1),o=n.n(a),r=n(4),l=n(15),i=n(132),u=n(150);n(156);var c=n(171),d=n(0);const g=()=>{const[{isAllSelected:e,areAllVisibleRowsSelected:t},n]=Object(a.useContext)(i.a);return Object(d.jsx)(r.EuiCheckbox,{id:"selection-toggle","aria-label":c.b,checked:e||t,onChange:e=>{e.target.checked?n({action:l.g.selectCurrentPage}):n({action:l.g.clear})},"data-test-subj":"bulk-actions-header"})},b=o.a.memo(g),p=({rowIndex:e})=>{const[{rowSelection:t},n]=Object(a.useContext)(i.a),s=t.has(e);return Object(d.jsx)(r.EuiCheckbox,{id:e.toString(),checked:s,onChange:t=>{t.target.checked?n({action:l.g.add,rowIndex:e}):n({action:l.g.delete,rowIndex:e})},"data-test-subj":"bulk-actions-row-cell"})},f=o.a.memo(p),j=()=>({id:"bulkActions",width:30,headerCellRender:()=>Object(d.jsx)(b,null),rowCellRender:e=>{const{visibleRowIndex:t}=e;return Object(d.jsx)(f,{rowIndex:t})}});var C=n(172),x=(n(195),n(3));const h=({count:e})=>{const{euiTheme:t}=Object(r.useEuiTheme)(),n=Object(a.useMemo)((()=>{return`${e.toLocaleString()} ${t=e,x.i18n.translate("xpack.triggersActionsUI.alertsTable.alertsCountUnit",{values:{totalCount:t},defaultMessage:"{totalCount, plural, =1 {alert} other {alerts}}"})}`;var t}),[e]);return Object(d.jsx)("span",{"data-test-subj":"toolbar-alerts-count",css:Object(d.css)("font-size:",t.size.m,";font-weight:",t.font.weight.semiBold,";border-right:",t.border.thin,";margin-right:",t.size.s,";padding-right:",t.size.m,";","")},n)};var A=n(88);const m=x.i18n.translate("xpack.triggersActionsUI.alertsTable.lastUpdated.updating",{defaultMessage:"Updating..."}),O=x.i18n.translate("xpack.triggersActionsUI.alertsTable.lastUpdated.updated",{defaultMessage:"Updated"}),w=o.a.memo((({date:e,prefix:t,updatedAt:n})=>Object(d.jsx)(o.a.Fragment,null,t,Object(d.jsx)(A.FormattedRelative,{"data-test-subj":"last-updated-at-date",key:`formatedRelative-${e}`,value:new Date(n)}))));w.displayName="Updated";const S=` ${O} `,I=o.a.memo((({compact:e=!1,updatedAt:t,showUpdating:n=!1})=>{const[s,o]=Object(a.useState)(Date.now());Object(a.useEffect)((()=>{const e=setInterval((()=>{o(Date.now())}),1e4);return()=>{clearInterval(e)}}),[]);const l=Object(a.useMemo)((()=>n?Object(d.jsx)("span",null," ",m):e?null:Object(d.jsx)(w,{date:s,prefix:S,updatedAt:t})),[e,s,n,t]);return Object(d.jsx)(r.EuiToolTip,{content:Object(d.jsx)(w,{date:s,prefix:S,updatedAt:t})},Object(d.jsx)(r.EuiText,{color:"subdued",size:"xs","data-test-subj":"toolbar-updated-at"},l))}));I.displayName="LastUpdatedAt";var v=n(272);const k=Object(a.lazy)((()=>n.e(46).then(n.bind(null,287)))),T="alertsTableActiveRow",y=75,z=Object(a.lazy)((()=>n.e(42).then(n.bind(null,290)))),R={border:"none",header:"underline",fontSize:"s"},F=e=>{const[t,n]=Object(a.useState)({}),c=e.useFetchAlertsData(),{activePage:g,alerts:b,alertsCount:p,isLoading:f,onPageChange:x,onSortChange:A,sort:m}=c,{sortingColumns:O,onSort:w}=function(e,t=u.a){const[n,s]=Object(a.useState)((e=>{const t=[];return e.forEach((e=>{Object.entries(e).forEach((([e,n])=>{t.push({id:e,direction:n.order})}))})),t})(t));return{sortingColumns:n,onSort:Object(a.useCallback)((t=>{e(t),s(t)}),[s,e])}}(A,m),{useActionsColumn:S=(()=>({renderCustomActionsRow:void 0,width:void 0}))}=e.alertsTableConfiguration,{renderCustomActionsRow:F,width:E=y}=S(),{isBulkActionsColumnActive:U,getBulkActionsLeadingControlColumn:M,bulkActionsState:P,bulkActions:_}=function({alerts:e,useBulkActionsConfig:t=(()=>[])}){const[n,s]=Object(a.useContext)(i.a),o=t(),r=0!==o.length;return Object(a.useEffect)((()=>{s({action:l.g.rowCountUpdate,rowCount:e.length})}),[e,s]),{isBulkActionsColumnActive:r,getBulkActionsLeadingControlColumn:j,bulkActionsState:n,bulkActions:o}}({alerts:b,useBulkActionsConfig:e.alertsTableConfiguration.useBulkActions}),{pagination:q,onChangePageSize:B,onChangePageIndex:L,onPaginateFlyout:V,flyoutAlertIndex:D,setFlyoutAlertIndex:$}=function({onPageChange:e,pageIndex:t,pageSize:n}){const[,s]=Object(a.useContext)(i.a),[o,r]=Object(a.useState)({pageIndex:t,pageSize:n}),[u,c]=Object(a.useState)(-1),d=Object(a.useCallback)((t=>{r((e=>({...e,pageSize:t,pageIndex:0}))),s({action:l.g.clear}),e({pageIndex:0,pageSize:t})}),[s,e]),g=Object(a.useCallback)((t=>{r((e=>({...e,pageIndex:t}))),s({action:l.g.clear}),e({pageIndex:t,pageSize:o.pageSize})}),[s,e,o.pageSize]),b=Object(a.useCallback)((e=>{c((t=>{if(e<0)return g(0),0;const n=o.pageSize*o.pageIndex+t;if(e===n)return t;const s=Math.floor(e/o.pageSize),a=e>=o.pageSize*s?e-o.pageSize*s:e;return g(s),a}))}),[g,o.pageIndex,o.pageSize]);return{pagination:o,onChangePageSize:d,onChangePageIndex:g,onPaginateFlyout:b,flyoutAlertIndex:u,setFlyoutAlertIndex:c}}({onPageChange:x,pageIndex:g,pageSize:e.pageSize}),{visibleColumns:H,onToggleColumn:G,onResetColumns:N,updatedAt:Q,browserFields:W,onChangeVisibleColumns:J}=e,K=Object(a.useCallback)((e=>{const t=b.findIndex((t=>t[s.R].includes(e.fields[s.R])));$(t)}),[b,$]),X=Object(a.useCallback)((()=>{const{rowSelection:e}=P;return(({bulkActions:e,alertsCount:t,rowSelection:n,alerts:s,isLoading:r,updatedAt:l,columnIds:i,onToggleColumn:u,onResetColumns:c,browserFields:g})=>{const b=n.size,p=(({alertsCount:e,updatedAt:t,columnIds:n,onToggleColumn:s,onResetColumns:a,browserFields:r})=>{const l=Object.keys(r).length>0;return{additionalControls:{right:Object(d.jsx)(I,{updatedAt:t}),left:{append:Object(d.jsx)(o.a.Fragment,null,Object(d.jsx)(h,{count:e}),l?Object(d.jsx)(v.FieldBrowser,{columnIds:n,browserFields:r,onResetColumns:a,onToggleColumn:s}):void 0)}},showColumnSelector:{allowHide:!1},showSortSelector:!0}})({alertsCount:t,updatedAt:l,columnIds:i,onToggleColumn:u,onResetColumns:c,browserFields:g});return 0===b||void 0===b||0===e.length?p:{showColumnSelector:!1,showSortSelector:!1,additionalControls:{right:Object(d.jsx)(I,{updatedAt:l}),left:{append:Object(d.jsx)(o.a.Fragment,null,Object(d.jsx)(h,{count:t}),Object(d.jsx)(a.Suspense,{fallback:null},Object(d.jsx)(k,{totalItems:t,items:e,alerts:s})))}}}})({bulkActions:_,alertsCount:p,rowSelection:e,alerts:c.alerts,updatedAt:Q,isLoading:f,columnIds:H,onToggleColumn:G,onResetColumns:N,browserFields:W})}),[P,_,p,c.alerts,Q,W,f,H,G,N])(),Y=Object(a.useMemo)((()=>{const t=e.showExpandToDetails||Boolean(F);let n=[...e.leadingControlColumns];return t&&(n=[{id:"expandColumn",width:E,headerCellRender:()=>Object(d.jsx)("span",{"data-test-subj":"expandColumnHeaderLabel"},C.c),rowCellRender:t=>{const{visibleRowIndex:n}=t;return Object(d.jsx)(r.EuiFlexGroup,{gutterSize:"none",responsive:!1},e.showExpandToDetails&&Object(d.jsx)(r.EuiFlexItem,{grow:!1},Object(d.jsx)(r.EuiToolTip,{content:C.d},Object(d.jsx)(r.EuiButtonIcon,{size:"s",iconType:"expand",color:"primary",onClick:()=>{$(n)},"data-test-subj":`expandColumnCellOpenFlyoutButton-${n}`,"aria-label":C.d}))),F&&b[n]&&F(b[n],K,e.id))}},...n]),U&&(n=[M(),...n]),n}),[E,b,M,K,U,e.id,e.leadingControlColumns,e.showExpandToDetails,F,$]);Object(a.useEffect)((()=>{const e=D+q.pageIndex*q.pageSize;n({[e]:T})}),[D,q.pageIndex,q.pageSize]);const Z=Object(a.useCallback)((()=>$(-1)),[$]),ee=({data:e,columnId:t})=>{var n,s;const a=null!==(n=null===(s=e.find((e=>e.field===t)))||void 0===s?void 0:s.value)&&void 0!==n?n:[];return Array.isArray(a)?Object(d.jsx)(o.a.Fragment,null,a.length?a.join():"--"):Object(d.jsx)(o.a.Fragment,null,a)},te=Object(a.useCallback)((()=>{var t,n;return null!==(t=e.alertsTableConfiguration)&&void 0!==t&&t.getRenderCellValue?null===(n=e.alertsTableConfiguration)||void 0===n?void 0:n.getRenderCellValue({setFlyoutAlert:K}):ee}),[K,e.alertsTableConfiguration])(),ne=Object(a.useCallback)((e=>{const t=b[e.rowIndex-q.pageSize*q.pageIndex];if(t){const n=[];return Object.entries(null!=t?t:{}).forEach((([e,t])=>{n.push({field:e,value:t})})),te({...e,data:n})}return f?Object(d.jsx)(r.EuiLoadingContent,{lines:1}):null}),[b,f,q.pageIndex,q.pageSize,te]);return Object(d.jsx)("section",{style:{width:"100%"},"data-test-subj":e["data-test-subj"]},Object(d.jsx)(a.Suspense,{fallback:null},D>-1&&Object(d.jsx)(z,{alert:b[D],alertsCount:p,onClose:Z,alertsTableConfiguration:e.alertsTableConfiguration,flyoutIndex:D+q.pageIndex*q.pageSize,onPaginate:V,isLoading:f,id:e.id})),p>0&&Object(d.jsx)(r.EuiDataGrid,{"aria-label":"Alerts table","data-test-subj":"alertsTable",columns:e.columns,columnVisibility:{visibleColumns:H,setVisibleColumns:J},trailingControlColumns:e.trailingControlColumns,leadingControlColumns:Y,rowCount:p,renderCellValue:ne,gridStyle:{...R,rowClasses:t},sorting:{columns:O,onSort:w},toolbarVisibility:X,pagination:{...q,pageSizeOptions:e.pageSizeOptions,onChangeItemsPerPage:B,onChangePage:L}}))}}}]);