/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.observability_bundle_jsonpfunction=window.observability_bundle_jsonpfunction||[]).push([[6,11,17],{101:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(0),o=a(42),s=a(10);function r(){const[e,t]=Object(n.useState)({all:!1,read:!1,create:!1,update:!1,delete:!1,push:!1}),a=Object(o.a)().services.application.capabilities,r=Object(o.a)().services.cases.helpers.getUICapabilities(a[s.casesFeatureId]);return Object(n.useEffect)((()=>{t({all:r.all,create:r.create,read:r.read,update:r.update,delete:r.delete,push:r.push})}),[r.all,r.create,r.read,r.update,r.delete,r.push]),e}},103:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(0);const o=Object(n.createContext)({})},111:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return v}));var n,o=a(0),s=a.n(o),r=a(76),i=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},n(e,t)},function(e,t){function a(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),l="html",c="svg",u=function(e,t){var a,n,o,s={};if(e===l)o=document.createElement("div");else{if(e!==c)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');o=document.createElementNS("http://www.w3.org/2000/svg","g")}if(t&&"object"==typeof t)for(var r=0,i=Object.entries(t.attributes);r<i.length;r++){var u=i[r],d=u[0],p=u[1];o.setAttribute(d,p)}var b={element:o,elementType:e,setPortalProps:function(e){s=e},getInitialPortalProps:function(){return s},mount:function(t,o){if(o!==n){if(b.unmount(),t!==a&&!function(e,t){if(t===l)return e instanceof HTMLElement;if(t===c)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(t,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+t.tagName+">.");t.replaceChild(b.element,o),a=t,n=o}},unmount:function(e){e&&e!==n||a&&n&&(a.replaceChild(n,b.element),a=void 0,n=void 0)}};return b},d=function(e){function t(t){var a=e.call(this,t)||this;return a.addPropsChannel=function(){Object.assign(a.props.node,{setPortalProps:function(e){a.setState({nodeProps:e})}})},a.state={nodeProps:a.props.node.getInitialPortalProps()},a}return i(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,a=t.children,n=t.node;return r.createPortal(o.Children.map(a,(function(t){return o.isValidElement(t)?o.cloneElement(t,e.state.nodeProps):t})),n.element)},t}(o.PureComponent),p=function(e){function t(t){var a=e.call(this,t)||this;return a.placeholderNode=o.createRef(),a.passPropsThroughPortal(),a}return i(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,a=t.parentNode;e.mount(a,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode=e);var t=this.placeholderNode.current,a=t.parentNode;e.mount(a,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){this.props.node.unmount(this.placeholderNode.current)},t.prototype.render=function(){return o.createElement("div",{ref:this.placeholderNode})},t}(o.PureComponent),b=u.bind(null,l),h=(u.bind(null,c),a(6));function v({children:e,setHeaderActionMenu:t,theme$:a}){const n=Object(o.useMemo)((()=>b()),[]);return Object(o.useEffect)((()=>(t((e=>Object(h.toMountPoint)(s.a.createElement(p,{node:n}),{theme$:a})(e))),()=>{n.unmount(),t(void 0)})),[n,t,a]),s.a.createElement(d,{node:n},e)}},112:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return v}));var n=a(13),o=a(0),s=a.n(o),r=a(18),i=a(78),l=a(6),c=a(28),u=a(19),d=a(93);const p=["apm","uptime","logs","infrastructure","alerts"],b=Object(o.createContext)({}),h=["apm","synthetics","infra_logs","infra_metrics","ux","alert"];function v({children:e}){const{http:t}=Object(l.useKibana)().services,[a,v]=Object(o.useState)(""),{absoluteStart:m,absoluteEnd:f}=Object(d.a)(),[y,C]=Object(o.useState)({}),j=Object(r.useRouteMatch)("/exploratory-view");Object(o.useEffect)((()=>{j||Object(i.asyncForEach)(h,(async e=>{var t,a,n,o,s;try{const r=({hasData:t,indices:a,serviceName:n})=>{C((o=>({...o,[e]:{hasData:t,...n?{serviceName:n}:{},...a?{indices:a}:{},status:u.a.SUCCESS}})))};switch(e){case"ux":const i={absoluteTime:{start:m,end:f}},l=await(null===(t=Object(c.a)(e))||void 0===t?void 0:t.hasData(i));r({hasData:null==l?void 0:l.hasData,indices:null==l?void 0:l.indices,serviceName:null==l?void 0:l.serviceName});break;case"synthetics":const u=await(null===(a=Object(c.a)(e))||void 0===a?void 0:a.hasData());r({hasData:null==u?void 0:u.hasData,indices:null==u?void 0:u.indices});break;case"apm":const d=await(null===(n=Object(c.a)(e))||void 0===n?void 0:n.hasData());r({hasData:null==d?void 0:d.hasData,indices:null==d?void 0:d.indices});break;case"infra_logs":const p=await(null===(o=Object(c.a)(e))||void 0===o?void 0:o.hasData());r({hasData:null==p?void 0:p.hasData,indices:null==p?void 0:p.indices});break;case"infra_metrics":const b=await(null===(s=Object(c.a)(e))||void 0===s?void 0:s.hasData());r({hasData:null==b?void 0:b.hasData,indices:null==b?void 0:b.indices})}}catch(t){C((t=>({...t,[e]:{hasData:void 0,status:u.a.FAILURE}})))}}))}),[j]),Object(o.useEffect)((()=>{!async function(){try{const e=await async function({http:e}){try{const{data:t=[]}=await e.get("/api/alerts/_find",{query:{page:1,per_page:20}})||{};return t.filter((({consumer:e})=>p.includes(e)))}catch(e){throw console.error("Error while fetching alerts",e),e}}({http:t});C((t=>({...t,alert:{hasData:e.length>0,status:u.a.SUCCESS}})))}catch(e){C((e=>({...e,alert:{hasData:void 0,status:u.a.FAILURE}})))}}()}),[a,t]);const T=h.every((e=>{var t;const a=null===(t=y[e])||void 0===t?void 0:t.status;return void 0!==a&&a!==u.a.LOADING})),E=Object.keys(y).some((e=>{var t;return!0===(null===(t=y[e])||void 0===t?void 0:t.hasData)}));return s.a.createElement(b.Provider,{value:{hasDataMap:y,hasAnyData:Object(n.isEmpty)(y)?void 0:E,isAllRequestsComplete:T,forceUpdate:a,onRefreshTimeRange:()=>{v(Object(n.uniqueId)())}},children:e})}},210:function(e,t,a){"use strict";a.r(t),a.d(t,"getO11yAlertsTableConfiguration",(function(){return A}));var n=a(89),o=a(10),s=a(0),r=a.n(s),i=a(6),l=a(1);const c=l.i18n.translate("xpack.observability.alerts.actions.addToCase",{defaultMessage:"Add to existing case"}),u=l.i18n.translate("xpack.observability.alerts.actions.addToNewCase",{defaultMessage:"Add to new case"}),d=l.i18n.translate("xpack.observability.alerts.actions.addToCaseDisabled",{defaultMessage:"Add to case is not supported for this selection"});var p=a(101);const b=({onClose:e,onSuccess:t}={})=>{const{cases:a}=Object(i.useKibana)().services,n=Object(p.a)(),o=a.hooks.getUseCasesAddToNewCaseFlyout({onClose:e,onSuccess:t}),r=a.hooks.getUseCasesAddToExistingCaseModal({onClose:e,onRowClick:t});return Object(s.useMemo)((()=>n.create&&n.read?[{label:u,key:"attach-new-case","data-test-subj":"attach-new-case",disableOnQuery:!0,disabledLabel:d,onClick:e=>{const t=e?a.helpers.groupAlertsByRule(e):[];o.open({attachments:t})}},{label:c,key:"attach-existing-case",disableOnQuery:!0,disabledLabel:d,"data-test-subj":"attach-existing-case",onClick:e=>{const t=e?a.helpers.groupAlertsByRule(e):[];r.open({attachments:t})}}]:[]),[a.helpers,o,n.create,n.read,r])};var h=a(154),v=a(126),m=a(98);const f=e=>e.id===n.h?{...e,displayAsText:m.d.alertsTable.reasonColumnDescription}:e.id===n.b?{...e,displayAsText:m.d.alertsTable.durationColumnDescription}:e.id===n.L?{...e,displayAsText:m.d.alertsTable.statusColumnDescription}:e.id===n.fb?{...e,displayAsText:m.d.alertsTable.lastUpdatedColumnDescription}:e,y=[{columnHeaderType:"not-filtered",displayAsText:m.d.alertsTable.statusColumnDescription,id:n.L,initialWidth:110},{columnHeaderType:"not-filtered",displayAsText:m.d.alertsTable.lastUpdatedColumnDescription,id:n.fb,initialWidth:230},{columnHeaderType:"not-filtered",displayAsText:m.d.alertsTable.durationColumnDescription,id:n.b,initialWidth:116},{columnHeaderType:"not-filtered",displayAsText:m.d.alertsTable.reasonColumnDescription,id:n.h,linkField:"*"}];var C=a(5),j=a(82),T=a(116),E=a(42),O=a(104),g=a(114);function w({data:e,eventId:t,ecsData:a,id:n,observabilityRuleTypeRegistry:o,config:i,setFlyoutAlert:l}){var d,b,h;const v=e.reduce(((e,t)=>({...e,[t.field]:t.value})),{}),[f,y]=Object(s.useState)(null),{cases:w,http:D}=Object(E.a)().services,P=Object(s.useMemo)((()=>Object(O.a)(o)),[o])(v),x=Object(s.useCallback)((()=>{y(null)}),[]),A=Object(s.useCallback)((e=>{y((t=>t?null:e))}),[]),k=Object(p.a)(),I=null!==(d=P.fields["kibana.alert.rule.uuid"])&&void 0!==d?d:null,_=n!==g.d&&I?D.basePath.prepend(m.c.observability.ruleDetails(I)):null,N=null!==(b=P.fields["kibana.alert.uuid"])&&void 0!==b?b:null,M="alert-details-o11y"!==n&&N?D.basePath.prepend(m.c.observability.alertDetails(N)):null,R=Object(s.useMemo)((()=>{var t,n;return null!=a&&a._id?[{alertId:null!==(t=null==a?void 0:a._id)&&void 0!==t?t:"",index:null!==(n=null==a?void 0:a._index)&&void 0!==n?n:"",type:j.CommentType.alert,rule:w.helpers.getRuleIdFromEvent({ecs:a,data:null!=e?e:[]})}]:[]}),[a,w.helpers,e]),F=w.hooks.getUseCasesAddToNewCaseFlyout(),S=w.hooks.getUseCasesAddToExistingCaseModal(),U=Object(s.useCallback)((()=>{F.open({attachments:R}),x()}),[F,R,x]),L=Object(s.useCallback)((()=>{S.open({attachments:R}),x()}),[R,x,S]),z=Object(s.useMemo)((()=>[...k.create&&k.read?[r.a.createElement(C.EuiContextMenuItem,{"data-test-subj":"add-to-existing-case-action",onClick:L,size:"s"},c),r.a.createElement(C.EuiContextMenuItem,{"data-test-subj":"add-to-new-case-action",onClick:U,size:"s"},u)]:[],..._?[r.a.createElement(C.EuiContextMenuItem,{key:"viewRuleDetails","data-test-subj":"viewRuleDetails",href:_},m.d.alertsTable.viewRuleDetailsButtonText)]:[],Object(T.a)(P,i)&&M?r.a.createElement(C.EuiContextMenuItem,{key:"viewAlertDetailsPage","data-test-subj":"viewAlertDetailsPage",href:M},m.d.alertsTable.viewAlertDetailsButtonText):r.a.createElement(C.EuiContextMenuItem,{key:"viewAlertDetailsFlyout","data-test-subj":"viewAlertDetailsFlyout",onClick:()=>{x(),l(P)}},m.d.alertsTable.viewAlertDetailsButtonText)]),[k.create,k.read,L,U,_,P,i,M,x,l]),B=z.length<=0?m.d.alertsTable.notEnoughPermissions:m.d.alertsTable.moreActionsTextLabel;return r.a.createElement(r.a.Fragment,null,r.a.createElement(C.EuiFlexItem,null,r.a.createElement(C.EuiToolTip,{content:m.d.alertsTable.viewInAppTextLabel},r.a.createElement(C.EuiButtonIcon,{size:"s",href:D.basePath.prepend(null!==(h=P.link)&&void 0!==h?h:""),iconType:"eye",color:"text","aria-label":m.d.alertsTable.viewInAppTextLabel}))),r.a.createElement(C.EuiFlexItem,null,r.a.createElement(C.EuiPopover,{button:r.a.createElement(C.EuiToolTip,{content:B},r.a.createElement(C.EuiButtonIcon,{display:"empty",size:"s",color:"text",iconType:"boxesHorizontal","aria-label":B,onClick:()=>A(t),"data-test-subj":"alertsTableRowActionMore"})),isOpen:f===t,closePopover:x,panelPaddingSize:"none",anchorPosition:"downLeft"},r.a.createElement(C.EuiContextMenuPanel,{size:"s",items:z}))))}const D=e=>Object.entries(e).reduce(((e,[t,a])=>[...e,{field:t,value:a}]),[]),P=()=>[],x=(e,t)=>()=>({renderCustomActionsRow:(a,n,o)=>r.a.createElement(w,{data:D(a),eventId:a._id,ecsData:{_id:a._id,_index:a._index},id:o,observabilityRuleTypeRegistry:e,setEventsDeleted:P,setFlyoutAlert:n,config:t}),width:120}),A=(e,t)=>({id:o.observabilityFeatureId,casesFeatureId:o.casesFeatureId,columns:y.map(f),getRenderCellValue:({setFlyoutAlert:t})=>Object(v.a)({observabilityRuleTypeRegistry:e,setFlyoutAlert:t}),sort:[{[n.fb]:{order:"desc"}}],useActionsColumn:x(e,t),useBulkActions:b,useInternalFlyout:()=>{const{header:t,body:a,footer:n}=Object(h.b)(e);return{header:t,body:a,footer:n}}})},90:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(0),o=a(103);function s(){return Object(n.useContext)(o.a)}},93:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(0),o=a(48);function s(){return Object(n.useContext)(o.a)}},94:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(0),o=a(112);function s(){return Object(n.useContext)(o.a)}}}]);