/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[17],{253:function(e,t,o){"use strict";o.d(t,"a",(function(){return c}));var a=o(90),n=o.n(a),s=o(25),r=o(17),i=o(46);function c(e,t,o,a){const c=n()(t.pipe(Object(s.map)((e=>e.executionContext)))),l=Object(r.useMemo)((()=>{const e={type:"visualization",name:o,id:a};return{...c,child:e}}),[c,a]);Object(i.useExecutionContext)(e,l)}},254:function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var a=o(51),n=o(47);function s(e,t,o){const s=null!=e?e:[],r=null!=t?t:Object(n.getDefaultQuery)(),i=["kuery"===r.language?Object(a.toElasticsearchQuery)(Object(a.fromKueryExpression)(r.query)):Object(a.luceneStringToDsl)(r.query)],c=[];for(const e of s){if(e.meta.disabled||void 0!==o&&e.meta.controlledBy===o)continue;const{meta:{negate:t,type:a,key:n}}=e;let s=e.query;void 0===s&&"exists"===a&&(s={exists:{field:n}}),s&&(t?c.push(s):i.push(s))}return{bool:{must:i,must_not:c}}}},255:function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var a=o(23),n=o(25),s=o(8),r=o(28);function i(e,t,o){return e.pipe(Object(n.pluck)("jobIds"),Object(n.distinctUntilChanged)(s.isEqual),Object(n.switchMap)((e=>t.getJobs$(e))),Object(n.map)((e=>e.map((e=>{var t;const o=Object(r.a)(e.analysis_config.bucket_span);return{id:e.job_id,selected:!0,bucketSpanSeconds:o.asSeconds(),modelPlotEnabled:!0===(null===(t=e.model_plot_config)||void 0===t?void 0:t.enabled)}})))),Object(n.catchError)((e=>{var t;return o(null!==(t=e.body)&&void 0!==t?t:e),Object(a.of)(void 0)})))}},647:function(e,t,o){"use strict";o.r(t),o.d(t,"EmbeddableAnomalyChartsContainer",(function(){return _}));var a=o(17),n=o.n(a),s=o(44),r=o(45),i=o(8),c=o(32),l=o(90),u=o.n(l),d=o(253),b=o(23),j=o(25),m=o(113),O=o(100),h=o(254),g=o(255),p=o(82),f=o.n(p),v=o(2),x=o(338),y=o(147),E=o(13);const S=v.i18n.translate("xpack.ml.explorer.charts.dashboardTooManyBucketsDescription",{defaultMessage:"This selection contains too many buckets to be displayed. You should shorten the time range of the view."}),M=({id:e,chartsData:t,showCharts:o,severity:a,setSeverity:i,mlLocator:c,timeBuckets:l,timefilter:u,onSelectEntity:d,showSelectedInterval:b,chartsService:j,timeRange:m})=>Object(E.jsx)(n.a.Fragment,null,Object(E.jsx)(s.EuiFlexGroup,{id:e,direction:"row",gutterSize:"l",responsive:!0},Object(E.jsx)(s.EuiFlexItem,{grow:!1},Object(E.jsx)(y.b,{severity:a,onChange:i}))),Object(E.jsx)(s.EuiSpacer,{size:"m"}),Array.isArray(t.seriesToPlot)&&0===t.seriesToPlot.length&&void 0===t.errorMessages&&Object(E.jsx)(s.EuiText,{textAlign:"center","data-test-subj":"mlNoMatchingAnomaliesMessage"},Object(E.jsx)("h4",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.explorer.noMatchingAnomaliesFoundTitle",defaultMessage:"No matching anomalies found"}))),o&&Object(E.jsx)(x.a,f()({},t,{severity:a.val,mlLocator:c,timeBuckets:l,timefilter:u,timeRange:m,onSelectEntity:d,tooManyBucketsCalloutMsg:S,showSelectedInterval:b,chartsService:j})));var T=o(0),w=o(18),A=o(124),C=o(250),R=o(109);const _=({id:e,embeddableContext:t,embeddableInput:o,services:n,refresh:l,onInputChange:p,onOutputChange:f,onRenderComplete:v,onError:x,onLoading:S})=>{var _;Object(d.a)(n[0].executionContext,o,R.a,e);const[k,I]=Object(a.useState)(0),[L,F]=Object(a.useState)(Object(y.c)(null!==(_=t.getInput().severityThreshold)&&void 0!==_?_:w.ANOMALY_THRESHOLD.WARNING)),[B,D]=Object(a.useState)(),[{uiSettings:N},{data:G,share:q,uiActions:z,charts:H}]=n,{timefilter:P}=G.query.timefilter,U=Object(a.useMemo)((()=>q.url.locators.get(T.a)),[q]),W=Object(a.useMemo)((()=>new A.a({"histogram:maxBars":N.get(c.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":N.get(c.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:N.get("dateFormat"),"dateFormat:scaled":N.get("dateFormat:scaled")})),[]),$=u()(o);Object(a.useEffect)((()=>{p({severityThreshold:L.val}),f({severity:L.val,entityFields:B})}),[L,B]);const{chartsData:Y,isLoading:Q,error:V}=function(e,t,o,n,s,r,i){const[,,{anomalyDetectorService:c,anomalyExplorerService:l}]=n,[u,d]=Object(a.useState)(),[p,f]=Object(a.useState)(),[v,x]=Object(a.useState)(!1),y=Object(a.useMemo)((()=>new b.Subject),[]),E=Object(a.useMemo)((()=>new b.Subject),[]);return Object(a.useEffect)((()=>{const t=Object(b.combineLatest)([Object(g.a)(e,c,f),e,y.pipe(Object(j.skipWhile)((e=>!e))),E,o.pipe(Object(j.startWith)(null))]).pipe(Object(j.tap)(x.bind(null,!0)),Object(j.debounceTime)(500),Object(j.tap)((()=>{i.onLoading()})),Object(j.switchMap)((([e,t,o,a])=>{var n,s;if(!e)return Object(b.of)(void 0);const{maxSeriesToPlot:r,timeRange:i,filters:c,query:u}=t,d=O.g;let j;l.setTimeRange(i);try{(c||u)&&(j=Object(h.a)(c,u))}catch(e){return f(e),Object(b.of)(void 0)}const g=l.getTimeBounds(),p={lanes:[O.g],times:[null===(n=g.min)||void 0===n?void 0:n.unix(),null===(s=g.max)||void 0===s?void 0:s.unix()],type:O.h.OVERALL},v=Object(m.h)(p,d),x=Object(m.i)(p,e),y=Object(m.j)(p,g);return l.getAnomalyData$(x,o,y.earliestMs,y.latestMs,j,v,null!=a?a:0,r)})),Object(j.catchError)((e=>(f(e.body),Object(b.of)(void 0))))).subscribe((e=>{void 0!==e&&(f(null),d(e),x(!1),i.onRenderComplete())}));return()=>{t.unsubscribe()}}),[]),Object(a.useEffect)((()=>{y.next(s)}),[s]),Object(a.useEffect)((()=>{E.next(r)}),[r]),Object(a.useEffect)((()=>{p&&i.onError(p)}),[p]),{chartsData:u,isLoading:v,error:p}}(o,0,l,n,k,L.val,{onRenderComplete:v,onError:x,onLoading:S}),X=Object(a.useRef)(),J=Object(a.useCallback)(Object(i.throttle)((e=>{Q||(X.current=e.height),Math.abs(k-e.width)>20&&I(e.width)}),500),[!Q,k]),K=Object(a.useMemo)((()=>Q?X.current:void 0),[Q]);if(V)return Object(E.jsx)(s.EuiCallOut,{title:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.errorMessage",defaultMessage:"Unable to load the ML anomaly explorer data"}),color:"danger",iconType:"alert",style:{width:"100%"}},Object(E.jsx)("p",null,V.message));const Z=(e,o,a)=>{const n=[{fieldName:e,fieldValue:o,operation:a}];D(n),z.getTrigger(C.a).exec({embeddable:t,data:n})};return Object(E.jsx)(s.EuiResizeObserver,{onResize:J},(o=>Object(E.jsx)("div",{id:`mlAnomalyExplorerEmbeddableWrapper-${e}`,style:{width:"100%",overflowY:"auto",overflowX:"hidden",padding:"8px",height:K},"data-test-subj":`mlExplorerEmbeddable_${t.id}`,ref:o},Q&&Object(E.jsx)(s.EuiText,{textAlign:"center",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"}},Object(E.jsx)(s.EuiLoadingChart,{size:"xl",mono:!0,"data-test-subj":"mlAnomalyExplorerEmbeddableLoadingIndicator"})),void 0!==Y&&!1===Q&&Object(E.jsx)(M,{id:e,showCharts:!0,chartsData:Y,severity:L,setSeverity:F,mlLocator:U,timeBuckets:W,timefilter:P,onSelectEntity:Z,showSelectedInterval:!1,chartsService:H,timeRange:null==$?void 0:$.timeRange}))))};t.default=_}}]);