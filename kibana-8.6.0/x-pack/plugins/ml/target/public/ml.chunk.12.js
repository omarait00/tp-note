/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[12],{146:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return i}));var l=a(2),s=a(29),n=a(99);function o(e,t,a,o){const r=Object(n.d)();if(e.contains("job_id_empty"))t.jobId.valid=!1;else if(e.contains("job_id_invalid")){t.jobId.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAllowedCharactersDescription",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.jobId.message=e}else if(e.contains("job_id_invalid_max_length"))t.jobId.valid=!1,t.jobId.message=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:s.b}});else if(e.contains("job_id_already_exists")){t.jobId.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."});t.jobId.message=e}if(e.contains("job_group_id_invalid")){t.groupIds.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupAllowedCharactersDescription",{defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.groupIds.message=e}else if(e.contains("job_group_id_invalid_max_length"))t.groupIds.valid=!1,t.groupIds.message=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupMaxLengthDescription",{defaultMessage:"Job group name must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:s.b}});else if(e.contains("job_group_id_already_exists")){t.groupIds.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.groupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing job or group."});t.groupIds.message=e}if(e.contains("model_memory_limit_units_invalid")){t.modelMemoryLimit.valid=!1;const e=`${s.a.slice(0,s.a.length-1).join(", ")} or ${[...s.a].pop()}`,a=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitUnitsInvalidErrorMessage",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:e}});t.modelMemoryLimit.message=a}if(e.contains("model_memory_limit_invalid")){t.modelMemoryLimit.valid=!1;const e=(r.max_model_memory_limit||"").toUpperCase(),a=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitRangeInvalidErrorMessage",{defaultMessage:"Model memory limit cannot be higher than the maximum value of {maxModelMemoryLimit}",values:{maxModelMemoryLimit:e}});t.modelMemoryLimit.message=a}if(e.contains("detectors_duplicates")){t.duplicateDetectors.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.duplicatedDetectorsErrorMessage",{defaultMessage:"Duplicate detectors were found."});t.duplicateDetectors.message=e}if(e.contains("categorizer_detector_missing_per_partition_field")){t.categorizerMissingPerPartition.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerMissingPerPartitionFieldMessage",{defaultMessage:'Partition field must be set for detectors that reference "mlcategory" when per-partition categorization is enabled.'});t.categorizerMissingPerPartition.message=e}if(e.contains("categorizer_varying_per_partition_fields")){t.categorizerVaryingPerPartitionField.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerVaryingPerPartitionFieldNamesMessage",{defaultMessage:'Detectors with keyword "mlcategory" cannot have different partition_field_name when per-partition categorization is enabled.'});t.categorizerVaryingPerPartitionField.message=e}if(e.contains("bucket_span_empty")){t.bucketSpan.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.bucketSpanMustBeSetErrorMessage",{defaultMessage:"Bucket span must be set"});t.bucketSpan.message=e}else e.contains("bucket_span_invalid")&&(t.bucketSpan.valid=!1,t.bucketSpan.message=i(a.analysis_config.bucket_span));if(e.contains("query_empty")){t.query.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryCannotBeEmpty",{defaultMessage:"Datafeed query cannot be empty."});t.query.message=e}else if(e.contains("query_invalid")){t.query.valid=!1;const e=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryIsInvalidEsQuery",{defaultMessage:"Datafeed query must be a valid elasticsearch query."});t.query.message=e}e.contains("query_delay_invalid")&&(t.queryDelay.valid=!1,t.queryDelay.message=i(o.query_delay)),e.contains("frequency_invalid")&&(t.frequency.valid=!1,t.frequency.message=i(o.frequency)),e.contains("missing_summary_count_field_name")&&(t.summaryCountField.valid=!1,t.summaryCountField.message=l.i18n.translate("xpack.ml.newJob.wizard.validateJob.summaryCountFieldMissing",{defaultMessage:"Required field as the datafeed uses aggregations."}))}function i(e){return l.i18n.translate("xpack.ml.newJob.wizard.validateJob.frequencyInvalidTimeIntervalFormatErrorMessage",{defaultMessage:"{value} is not a valid time interval format e.g. {thirtySeconds}, {tenMinutes}, {oneHour}, {sevenDays}. It also needs to be higher than zero.",values:{value:e,thirtySeconds:"30s",tenMinutes:"10m",oneHour:"1h",sevenDays:"7d"}})}},204:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a(17);t.default=function(e){l.useEffect(e,[])}},208:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a(54).__importDefault(a(204));t.default=function(e){l.default((function(){e()}))}},257:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var l=a(17),s=a(2),n=a(45),o=a(44),i=a(11),r=a(13);const c=({jobsAndGroupIds:e,onChange:t,adJobsApiService:a,errors:c,multiSelect:u=!1,label:d,allowSelectAll:b=!1,options:m})=>{const[j,g]=Object(l.useState)([]),p=Object(l.useMemo)((()=>new Set),[]),v=Object(l.useMemo)((()=>new Set),[]),x=Object(l.useMemo)((()=>(null!=e?e:[]).map((e=>({label:e})))),[e]),f=Object(l.useCallback)((async()=>{try{const{jobIds:e,groupIds:t}=await a.getAllJobAndGroupIds();e.forEach((e=>{p.add(e)})),t.forEach((e=>{v.add(e)})),g([...b?[{label:s.i18n.translate("xpack.ml.jobSelector.selectAllGroupLabel",{defaultMessage:"Select all"}),options:[{label:s.i18n.translate("xpack.ml.jobSelector.selectAllOptionLabel",{defaultMessage:"*"}),value:i.b}]}]:[],{label:s.i18n.translate("xpack.ml.jobSelector.jobOptionsLabel",{defaultMessage:"Jobs"}),options:e.map((e=>({label:e})))},...u?[{label:s.i18n.translate("xpack.ml.jobSelector.groupOptionsLabel",{defaultMessage:"Groups"}),options:t.map((e=>({label:e})))}]:[]])}catch(e){}}),[a]),O=Object(l.useCallback)((e=>{if(e.some((e=>e.value===i.b)))return void t({jobIds:[i.b]});const a=[],l=[];e.forEach((({label:e})=>{p.has(e)?a.push(e):v.has(e)?l.push(e):null!=m&&m.some((t=>{var a;return null===(a=t.options)||void 0===a?void 0:a.some((t=>t.label===e))}))&&a.push(e)})),t({...a.length>0?{jobIds:a}:{},...l.length>0?{groupIds:l}:{}})}),[p,v,m]);return Object(l.useEffect)((()=>{m||f()}),[]),Object(r.jsx)(o.EuiFormRow,{fullWidth:!0,label:null!=d?d:Object(r.jsx)(n.FormattedMessage,{id:"xpack.ml.jobSelector.formControlLabel",defaultMessage:"Select job"}),isInvalid:!(null==c||!c.length),error:c},Object(r.jsx)(o.EuiComboBox,{singleSelection:!u,selectedOptions:x,options:null!=m?m:j,onChange:O,fullWidth:!0,"data-test-subj":"mlAnomalyAlertJobSelection",isInvalid:!(null==c||!c.length)}))}},258:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var l=a(82),s=a.n(l),n=a(44),o=a(17),i=a(146),r=a(18),c=a(20),u=a(13);const d=({value:e,onChange:t,label:a,...l})=>{const d=Object(o.useMemo)((()=>Object(r.composeValidators)(Object(c.f)())),[]),b=Object(o.useMemo)((()=>d(e)),[e]),m=!!e&&!!b;return Object(u.jsx)(n.EuiFormRow,{label:a,isInvalid:m,error:Object(i.a)(null!=e?e:void 0)},Object(u.jsx)(n.EuiFieldText,s()({},l,{placeholder:"15d, 6m",value:null!=e?e:"",onChange:e=>{t(e.target.value)},isInvalid:m})))}},259:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a(17);var l=a(44),s=a(2),n=a(13);const o=({message:e})=>Object(n.jsx)(l.EuiFlexGroup,{gutterSize:"none",justifyContent:"flexEnd"},Object(n.jsx)(l.EuiFlexItem,{grow:!1},Object(n.jsx)(l.EuiBetaBadge,{label:s.i18n.translate("xpack.ml.anomalyDetectionAlert.betaBadgeLabel",{defaultMessage:"Beta"}),tooltipContent:e})))},266:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var l=a(17),s=a.n(l),n=a(2),o=a(44),i=a(18),r=a(13);const c=s.a.memo((({value:e,onChange:t})=>{const a=[{min:i.ANOMALY_THRESHOLD.LOW,max:i.ANOMALY_THRESHOLD.MINOR,color:"#8BC8FB"},{min:i.ANOMALY_THRESHOLD.MINOR,max:i.ANOMALY_THRESHOLD.MAJOR,color:"#FDEC25"},{min:i.ANOMALY_THRESHOLD.MAJOR,max:i.ANOMALY_THRESHOLD.CRITICAL,color:"#FBA740"},{min:i.ANOMALY_THRESHOLD.CRITICAL,max:100,color:"#FE5050"}],l=n.i18n.translate("xpack.ml.severitySelector.formControlLabel",{defaultMessage:"Severity"}),s=null!=e?e:i.ANOMALY_THRESHOLD.LOW,c=e=>{t(Number(e.target.value))},u=new Array(5).fill(null).map(((e,t)=>{const a=25*t;return{value:a,label:a}}));return Object(r.jsx)(o.EuiFormRow,{fullWidth:!0},Object(r.jsx)(o.EuiFlexGroup,{gutterSize:"s"},Object(r.jsx)(o.EuiFlexItem,{grow:!1},Object(r.jsx)(o.EuiFieldNumber,{id:"severityControl",style:{width:"70px"},compressed:!0,prepend:l,value:s,onChange:c,min:i.ANOMALY_THRESHOLD.LOW,max:100})),Object(r.jsx)(o.EuiFlexItem,{grow:!0},Object(r.jsx)(o.EuiRange,{className:"mlSeverityControl",fullWidth:!0,min:i.ANOMALY_THRESHOLD.LOW,max:100,value:s,onChange:c,"aria-label":n.i18n.translate("xpack.ml.severitySelector.formControlAriaLabel",{defaultMessage:"Select severity threshold"}),showTicks:!0,ticks:u,showRange:!1,levels:a,"data-test-subj":"mlAnomalyAlertScoreSelection"}))))}))},645:function(e,t,a){"use strict";a.r(t);var l=a(17),s=a.n(l),n=a(44),o=a(208),i=a.n(o),r=a(2),c=a(257),u=a(80),d=a(218),b=a(121),m=a(266),j=a(45),g=a(1),p=a(13);const v=s.a.memo((({value:e=[],onChange:t,availableOption:a})=>{const s=Object(l.useMemo)((()=>[{value:g.a.BUCKET,title:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.bucketResultType.title",defaultMessage:"Bucket"}),description:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.bucketResultType.description",defaultMessage:"How unusual was the job within the bucket of time?"})},{value:g.a.RECORD,title:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.recordResultType.title",defaultMessage:"Record"}),description:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.recordResultType.description",defaultMessage:"What individual anomalies are present in a time range?"})},{value:g.a.INFLUENCER,title:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.influencerResultType.title",defaultMessage:"Influencer"}),description:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.influencerResultType.description",defaultMessage:"What are the most unusual entities in a time range?"})}].filter((e=>a.includes(e.value)))),[a]);return Object(p.jsx)(n.EuiFormRow,{fullWidth:!0,label:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.resultTypeSelector.formControlLabel",defaultMessage:"Result type"})},Object(p.jsx)(n.EuiFlexGroup,{gutterSize:"s"},s.map((({value:a,title:l,description:s})=>Object(p.jsx)(n.EuiFlexItem,{key:a},Object(p.jsx)(n.EuiCard,{title:l,titleSize:"xs",paddingSize:"s",description:Object(p.jsx)("small",null,s),selectable:{onClick:()=>{e!==a&&t(a)},isSelected:a===e},"data-test-subj":`mlAnomalyAlertResult_${a}${a===e?"_selected":""}`}))))))}));var x=a(4);var f=a(18),O=a(20),h=a(146),y=a(11);const k=s.a.memo((({jobIds:e,timestampIso8601:t,score:a,topInfluencers:l,topRecords:s})=>{const o=[{title:r.i18n.translate("xpack.ml.previewAlert.jobsLabel",{defaultMessage:"Job IDs:"}),description:e.join(", ")},{title:r.i18n.translate("xpack.ml.previewAlert.timeLabel",{defaultMessage:"Time: "}),description:t},{title:r.i18n.translate("xpack.ml.previewAlert.scoreLabel",{defaultMessage:"Anomaly score:"}),description:a},...l&&l.length>0?[{title:r.i18n.translate("xpack.ml.previewAlert.topInfluencersLabel",{defaultMessage:"Top influencers:"}),description:Object(p.jsx)("ul",null,l.map((e=>Object(p.jsx)("li",{key:e.unique_key},Object(p.jsx)(n.EuiCode,{transparentBackground:!0},e.influencer_field_name)," ="," ",e.influencer_field_value," [",e.score,"]"))))}]:[],...s&&s.length>0?[{title:r.i18n.translate("xpack.ml.previewAlert.topRecordsLabel",{defaultMessage:"Top records:"}),description:Object(p.jsx)("ul",null,s.map((e=>{var t,a;return Object(p.jsx)("li",{key:e.unique_key},Object(p.jsx)(n.EuiCode,{transparentBackground:!0},e.function,"(",e.field_name,")")," ",e.by_field_value," ",e.over_field_value," ",e.partition_field_value," [",e.score,"]; (",Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.previewAlert.typicalLabel",defaultMessage:"Typical:"})," ",null!==(t=e.typical)&&void 0!==t?t:"-",","," ",Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.previewAlert.actualLabel",defaultMessage:"Actual:"})," ",null!==(a=e.actual)&&void 0!==a?a:"-",")")})))}]:[]];return Object(p.jsx)(n.EuiDescriptionList,{type:"row",compressed:!0,listItems:o})})),M=({alertingApiService:e,alertParams:t})=>{var a,o,i,r;const c=y.a,[u,d]=Object(l.useState)(),[b,m]=Object(l.useState)(),[g,v]=Object(l.useState)(!0),[x,M]=Object(l.useState)(),[I,w]=Object(l.useState)(),A=Object(l.useMemo)((()=>Object(f.composeValidators)(Object(O.e)(),Object(O.f)())),[]),_=Object(l.useMemo)((()=>A(u)),[u]);Object(l.useEffect)((function(){w(void 0)}),[t]);const E=Object(l.useCallback)((async()=>{try{const a=await e.preview({alertParams:t,timeRange:u,sampleSize:c});w(a),m(u),M(void 0)}catch(e){var a;w(void 0),M(null!==(a=e.body)&&void 0!==a?a:e)}}),[t,u]),S=Object(l.useMemo)((()=>{if(I)return I.results}),[I]),C=((null===(a=t.jobSelection)||void 0===a||null===(o=a.jobIds)||void 0===o?void 0:o.length)>0||(null===(i=t.jobSelection)||void 0===i||null===(r=i.groupIds)||void 0===r?void 0:r.length)>0)&&!!t.resultType&&void 0!==t.severity&&null===_,F=void 0!==u&&!!_;return Object(p.jsx)(s.a.Fragment,null,Object(p.jsx)(n.EuiFlexGroup,{gutterSize:"s",alignItems:"flexEnd"},Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFormRow,{label:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.previewAlert.intervalLabel",defaultMessage:"Check the rule condition with an interval"}),isInvalid:F,error:Object(h.a)(u)},Object(p.jsx)(n.EuiFieldText,{placeholder:"15d, 6m",value:null!=u?u:"",onChange:e=>{d(e.target.value)},isInvalid:F,"data-test-subj":"mlAnomalyAlertPreviewInterval"}))),Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiButton,{onClick:E,disabled:!C,"data-test-subj":"mlAnomalyAlertPreviewButton"},Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.previewAlert.testButtonLabel",defaultMessage:"Test"})))),void 0!==x&&Object(p.jsx)(s.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(n.EuiCallOut,{title:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.previewAlert.previewErrorTitle",defaultMessage:"Unable to load the preview"}),color:"danger",iconType:"alert"},Object(p.jsx)("p",null,x.message))),I&&S&&Object(p.jsx)(s.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(n.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiText,{size:"xs","data-test-subj":"mlAnomalyAlertPreviewMessage"},Object(p.jsx)("strong",null,Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.previewAlert.previewMessage",defaultMessage:"Found {alertsCount, plural, one {# anomaly} other {# anomalies}} in the last {interval}.",values:{alertsCount:I.count,interval:b}})))),S.length>0&&Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiButtonEmpty,{color:"primary",size:"xs",onClick:v.bind(null,!g)},g?Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.previewAlert.hideResultsButtonLabel",defaultMessage:"Hide results"}):Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.previewAlert.showResultsButtonLabel",defaultMessage:"Show results"})))),g&&S.length>0?Object(p.jsx)(n.EuiPanel,{color:"subdued",borderRadius:"none",hasShadow:!1,"data-test-subj":"mlAnomalyAlertPreviewCallout"},Object(p.jsx)("ul",null,S.map(((e,t)=>Object(p.jsx)("li",{key:e.key},Object(p.jsx)(k,e),t!==S.length-1?Object(p.jsx)(n.EuiHorizontalRule,{margin:"xs"}):null)))),I.count>c?Object(p.jsx)(s.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(n.EuiText,{size:"xs"},Object(p.jsx)("b",null,Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.previewAlert.otherValuesLabel",defaultMessage:"and {count, plural, one {# other} other {# others}}",values:{count:I.count-c}})))):null):null))},I=s.a.memo((({value:e,onChange:t})=>Object(p.jsx)(n.EuiFormRow,null,Object(p.jsx)(n.EuiSwitch,{label:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.interimResultsControl.label",defaultMessage:"Include interim results"}),checked:null!=e&&e,onChange:t.bind(null,!e)}))));var w=a(28),A=a(19);const _=s.a.memo((({jobConfigs:e=[],alertInterval:t,alertParams:a,alertNotifyWhen:l,maxNumberOfBuckets:o})=>{var i,r;if(0===e.length)return null;const c=Object(w.a)(t).asSeconds(),u=!!a.lookbackInterval&&(null===(i=Object(w.a)(a.lookbackInterval))||void 0===i?void 0:i.asSeconds()),d=u&&u<c,b=e.filter((e=>e.datafeed_config.state!==A.a.STARTED)).map((e=>e.job_id)),m=d||b.length>0,g="onActiveAlert"===l&&u&&c<u,v=Object(w.a)(e[0].analysis_config.bucket_span),x=v?Math.ceil(v.asMinutes())*Math.min(null!==(r=a.topNBuckets)&&void 0!==r?r:y.e,null!=o?o:y.e):void 0;return Object(p.jsx)(s.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),m?Object(p.jsx)(s.a.Fragment,null,Object(p.jsx)(n.EuiCallOut,{title:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.alertConditionValidation.title",defaultMessage:"Alert condition contains the following issues:"}),color:"warning",size:"s"},Object(p.jsx)("ul",null,d?Object(p.jsx)("li",null,Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.alertConditionValidation.alertIntervalTooHighMessage",defaultMessage:"The check interval is greater than the lookback interval. Reduce it to {lookbackInterval} to avoid potentially missing notifications.",values:{lookbackInterval:a.lookbackInterval}})):null,b.length>0?Object(p.jsx)("li",null,Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.alertConditionValidation.stoppedDatafeedJobsMessage",defaultMessage:"The datafeed is not started for the following {count, plural, one {job} other {jobs}}: {jobIds}.",values:{count:b.length,jobIds:b.join(", ")}})):null)),Object(p.jsx)(n.EuiSpacer,{size:"m"})):null,g?Object(p.jsx)(s.a.Fragment,null,Object(p.jsx)(n.EuiCallOut,{title:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.alertConditionValidation.notifyWhenWarning",defaultMessage:"Expect to receive duplicate notifications about the same anomaly for up to {notificationDuration, plural, one {# minute} other {# minutes}}. Increase the check interval or switch to notify only on status change to avoid duplicate notifications.",values:{notificationDuration:x}}),color:"warning",size:"s"}),Object(p.jsx)(n.EuiSpacer,{size:"m"})):null)}));var E=a(258);const S=s.a.memo((({value:e,onChange:t})=>{var a;return Object(p.jsx)(n.EuiAccordion,{id:"mlAnomalyAlertAdvancedSettings",buttonContent:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.advancedSettingsLabel",defaultMessage:"Advanced settings"}),"data-test-subj":"mlAnomalyAlertAdvancedSettingsTrigger"},Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(n.EuiDescribedFormGroup,{gutterSize:"s",titleSize:"xxs",title:Object(p.jsx)("h4",null,Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.lookbackIntervalLabel",defaultMessage:"Lookback interval"})),description:Object(p.jsx)(n.EuiText,{size:"xs"},Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.lookbackIntervalDescription",defaultMessage:"Time interval to query the anomalies data during each rule condition check. By default, is derived from the bucket span of the job and the query delay of the datafeed."}))},Object(p.jsx)(E.a,{value:e.lookbackInterval,label:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.lookbackIntervalLabel",defaultMessage:"Lookback interval"}),onChange:e=>{t({lookbackInterval:e})},"data-test-subj":"mlAnomalyAlertLookbackInterval"})),Object(p.jsx)(n.EuiDescribedFormGroup,{gutterSize:"s",titleSize:"xxs",title:Object(p.jsx)("h4",null,Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.topNBucketsLabel",defaultMessage:"Number of latest buckets"})),description:Object(p.jsx)(n.EuiText,{size:"xs"},Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.topNBucketsDescription",defaultMessage:"The number of latest buckets to check to obtain the highest anomaly."}))},Object(p.jsx)(n.EuiFormRow,{label:Object(p.jsx)(j.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.topNBucketsLabel",defaultMessage:"Number of latest buckets"})},Object(p.jsx)(n.EuiFieldNumber,{value:null!==(a=e.topNBuckets)&&void 0!==a?a:y.e,min:1,onChange:e=>{t({topNBuckets:Number(e.target.value)})},"data-test-subj":"mlAnomalyAlertTopNBuckets"}))),Object(p.jsx)(n.EuiHorizontalRule,{margin:"m"}))}));var C=a(252),F=a(116),L=a(259);t.default=({ruleParams:e,setRuleParams:t,setRuleProperty:a,errors:s,ruleInterval:o,alertNotifyWhen:j})=>{const{services:{http:O},notifications:{toasts:h}}=Object(u.b)(),y=Object(l.useMemo)((()=>new b.a(O)),[O]),k=Object(l.useMemo)((()=>Object(d.jobsApiProvider)(y)),[y]),A=Object(l.useMemo)((()=>{return e=y,{preview(t){const a=JSON.stringify(t);return e.http({path:`${x.b}/alerting/preview`,method:"POST",body:a})}};var e}),[y]),[E,z]=Object(l.useState)([]),T=Object(l.useCallback)((e=>a=>{t(e,a)}),[]),R=Object(l.useMemo)((()=>{var t;return Object.values(null!==(t=e.jobSelection)&&void 0!==t?t:{}).flat()}),[e.jobSelection]),D=Object(l.useCallback)((async()=>{try{const e=await k.jobs(R);z(e)}catch(e){h.danger({title:r.i18n.translate("xpack.ml.anomalyDetectionAlert.errorFetchingJobs",{defaultMessage:"Unable to fetch jobs configuration"}),body:e.message,toastLifeTimeMs:5e3})}}),[R]),J=Object(l.useMemo)((()=>0===E.length||(null!=E?E:[]).some((e=>{var t,a;return Boolean(null===(t=e.analysis_config)||void 0===t||null===(a=t.influencers)||void 0===a?void 0:a.length)}))?Object.values(g.a):[g.a.BUCKET,g.a.RECORD]),[E]);Object(l.useEffect)((function(){0!==R.length&&D()}),[R]),i()((function(){const{jobSelection:t,...l}=e;0===Object.keys(l).length&&a("params",{severity:f.ANOMALY_THRESHOLD.CRITICAL,resultType:g.a.BUCKET,includeInterim:!1,jobSelection:t,lookbackInterval:void 0,topNBuckets:void 0})}));const N=Object(l.useMemo)((()=>{let{lookbackInterval:t,topNBuckets:a}=e;return!Object(F.a)(t)&&E.length>0&&(t=Object(C.a)(E)),!Object(F.a)(a)&&E.length>0&&(a=Object(C.c)(E[0])),{lookbackInterval:t,topNBuckets:a}}),[e.lookbackInterval,e.topNBuckets,E]),B=Object(l.useMemo)((()=>({...e,...N})),[e,N]),P=Object(l.useMemo)((()=>{if(0===E.length)return;const e=Object(w.a)(E[0].analysis_config.bucket_span),t=N.lookbackInterval?Object(w.a)(N.lookbackInterval):null;return t&&e?Math.ceil(t.asSeconds()/e.asSeconds()):void 0}),[E,N]);return Object(p.jsx)(n.EuiForm,{"data-test-subj":"mlAnomalyAlertForm"},Object(p.jsx)(L.a,{message:r.i18n.translate("xpack.ml.anomalyDetectionAlert.betaBadgeTooltipContent",{defaultMessage:"Anomaly detection alerts are a beta feature. We'd love to hear your feedback."})}),Object(p.jsx)(c.a,{jobsAndGroupIds:R,adJobsApiService:k,onChange:Object(l.useCallback)(T("jobSelection"),[]),errors:Array.isArray(s.jobSelection)?s.jobSelection:[]}),Object(p.jsx)(_,{jobConfigs:E,alertInterval:o,alertNotifyWhen:j,alertParams:B,maxNumberOfBuckets:P}),Object(p.jsx)(v,{value:e.resultType,availableOption:J,onChange:Object(l.useCallback)(T("resultType"),[])}),Object(p.jsx)(m.a,{value:e.severity,onChange:Object(l.useCallback)(T("severity"),[])}),Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(I,{value:e.includeInterim,onChange:Object(l.useCallback)(T("includeInterim"),[])}),Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(S,{value:N,onChange:Object(l.useCallback)((e=>{Object.keys(e).forEach((a=>{t(a,e[a])}))}),[])}),Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(M,{alertingApiService:A,alertParams:e}),Object(p.jsx)(n.EuiSpacer,{size:"m"}))}},99:function(e,t,a){"use strict";a.d(t,"g",(function(){return i})),a.d(t,"c",(function(){return r})),a.d(t,"d",(function(){return c})),a.d(t,"e",(function(){return u})),a.d(t,"f",(function(){return d})),a.d(t,"b",(function(){return b})),a.d(t,"a",(function(){return m}));var l=a(81);let s={anomaly_detectors:{},datafeeds:{}},n={};const o={cloudId:null,isCloud:!1,isCloudTrial:!1,deploymentId:null};async function i(){try{var e;const t=await l.ml.mlInfo();return s=t.defaults,n=t.limits,o.cloudId=null!==(e=t.cloudId)&&void 0!==e?e:null,o.isCloud=void 0!==t.cloudId,o.isCloudTrial=!0===t.isCloudTrial,o.deploymentId=t.cloudId?m(t.cloudId):null,{defaults:s,limits:n,cloudId:o}}catch(e){return{defaults:s,limits:n,cloudId:o}}}function r(){return s}function c(){return n}function u(){return o.isCloud}function d(){return o.isCloudTrial}function b(){return o.deploymentId}function m(e){const t=e.replace(/^(.+)?:/,"");try{const e=atob(t).match(/^.+\$(.+)(?=\$)/);return null!==e&&2===e.length?e[1]:null}catch(e){return null}}}}]);