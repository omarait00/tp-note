/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[1],{124:function(e,t,r){"use strict";r.d(t,"c",(function(){return b})),r.d(t,"a",(function(){return x})),r.d(t,"b",(function(){return g}));var a=r(8),i=r(24),n=r.n(i),l=r(31),o=r.n(l);const{duration:s}=n.a;var c=r(28),u=r(27),d=r(47),p=r(48);const m=o.a.unitsDesc,f=m.indexOf("w"),h=function(){const e=[[s(500,"ms"),s(100,"ms")],[s(5,"second"),s(1,"second")],[s(10,"second"),s(5,"second")],[s(15,"second"),s(10,"second")],[s(30,"second"),s(15,"second")],[s(1,"minute"),s(30,"second")],[s(5,"minute"),s(1,"minute")],[s(10,"minute"),s(5,"minute")],[s(15,"minute"),s(10,"minute")],[s(30,"minute"),s(10,"minute")],[s(1,"hour"),s(30,"minute")],[s(2,"hour"),s(1,"hour")],[s(4,"hour"),s(2,"hour")],[s(6,"hour"),s(4,"hour")],[s(8,"hour"),s(6,"hour")],[s(12,"hour"),s(8,"hour")],[s(24,"hour"),s(12,"hour")],[s(2,"d"),s(1,"d")],[s(4,"d"),s(2,"d")],[s(1,"week"),s(4,"d")],[s(1,"month"),s(1,"week")],[s(1,"year"),s(1,"month")],[1/0,s(1,"year")]].slice(0).reverse();function t(e,t,r){return function(a,i){const l=function(a,i){const l=i/a;let o;for(let a=0;a<e.length;a++){const i=e[a],n=t(i[0],i[1],l);if(null==n){if(!r)continue;if(o)return o;break}if(!r)return n;o=n}const s=Math.max(Math.floor(l),1);return n.a.duration(s,"ms")}(a,i);if(l)return n.a.duration(l._data)}}return{near:t(e,(function(e,t,r){if(e>r){if(e===1/0)return t;const a=e.asMilliseconds(),i=t.asMilliseconds();return Math.abs(a-r)<=Math.abs(i)?e:t}}),!0),lessThan:t(e,(function(e,t,r){if(t<r)return e!==1/0?e:t})),atLeast:t(e,(function(e,t,r){if(t<=r)return t}))}}();function b(){const e=Object(u.o)();return new x({[d.UI_SETTINGS.HISTOGRAM_MAX_BARS]:e.get(d.UI_SETTINGS.HISTOGRAM_MAX_BARS),[d.UI_SETTINGS.HISTOGRAM_BAR_TARGET]:e.get(d.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:e.get("dateFormat"),"dateFormat:scaled":e.get("dateFormat:scaled")})}function x(e){this._timeBucketsConfig=e,this.barTarget=this._timeBucketsConfig[d.UI_SETTINGS.HISTOGRAM_BAR_TARGET],this.maxBars=this._timeBucketsConfig[d.UI_SETTINGS.HISTOGRAM_MAX_BARS]}function v(e,t){const r=function(e){for(let t=0;t<m.length;t++){const r=m[t],a=e.as(r);if(a>=1&&Math.floor(a)===a){if(t<=f)continue;return{value:a,unit:r,expression:a+r}}}const t=e.as("ms");return{value:t,unit:"ms",expression:t+"ms"}}(e);e.esValue=r.value,e.esUnit=r.unit,e.expression=r.expression,e.overflow=t>e&&n.a.duration(e-t);const a=n.a.normalizeUnits(r.unit);return 1===r.value?e.description=a:e.description=`${r.value} ${a}s`,e}function y(e){return e&&"isValid"in e&&e.isValid()}function g(e,t,r=!1){const a=t.asMilliseconds(),i=Math.floor(e.min.valueOf()/a)*a;let l=Math.ceil(e.max.valueOf()/a)*a;return!1===r&&(l-=1),{min:n()(i),max:n()(l)}}x.prototype.setBarTarget=function(e){this.barTarget=e},x.prototype.setMaxBars=function(e){this.maxBars=e},x.prototype.setBounds=function(e){if(!e)return this.clearBounds();let t;t=Object(a.isPlainObject)(e)?[e.min,e.max]:Array.isArray(e)?e:[];const r=Object(a.sortBy)(t.map(Object(a.ary)(n.a,1)),Number);if(2!==r.length||!r.every(y))throw this.clearBounds(),new Error("invalid bounds set: "+e);if(this._lb=r.shift(),this._ub=r.pop(),this.getDuration().asSeconds()<0)throw new TypeError("Intervals must be positive")},x.prototype.clearBounds=function(){this._lb=this._ub=null},x.prototype.hasBounds=function(){return y(this._ub)&&y(this._lb)},x.prototype.getBounds=function(){if(this.hasBounds())return{min:this._lb,max:this._ub}},x.prototype.getDuration=function(){if(this.hasBounds())return n.a.duration(this._ub-this._lb,"ms")},x.prototype.setInterval=function(e){this.originalInterval=e;let t=e;if(t&&"auto"!==t){if(Object(a.isString)(t)&&(e=t,t=Object(c.a)(t),0==+t&&(t=null)),!n.a.isDuration(t))throw new TypeError('"'+e+'" is not a valid interval.');this._i=t}else this._i="auto"},x.prototype.getInterval=function(){const e=this,t=e.getDuration();return v(function(r){if(!e.hasBounds())return r;const i=e.maxBars;let n;return t/r>i?(n=h.lessThan(i,t),+n==+r?r:(v(r,t),Object(a.assign)(n,{preScaled:r,scale:r/n,scaled:!0}))):r}(function(){const r=e._i;return n.a.isDuration(r)?r:h.near(e.barTarget,t)}()),t)},x.prototype.getIntervalToNearestMultiple=function(e){const t=this.getInterval(),r=t.asSeconds(),a=r%e;if(0===a)return t;let i=a>e/2?r+e-a:r-a;i=0===i?e:i;const l=n.a.duration(i,"seconds");v(l,this.getDuration());const o=t.preScaled;return void 0!==o&&o<l&&(l.preScaled=o,l.scale=o/l,l.scaled=!0),l},x.prototype.getScaledDateFormat=function(){const e=this.getInterval(),t=this._timeBucketsConfig["dateFormat:scaled"];for(let r=t.length-1;r>=0;r--){const a=t[r];if(!a[0]||e>=n.a.duration(a[0]))return a[1]}return this._timeBucketsConfig.dateFormat},x.prototype.getScaledDateFormatter=function(){return new(Object(u.f)().getType(p.FIELD_FORMAT_IDS.DATE))({pattern:this.getScaledDateFormat()},this._timeBucketsConfig)}},139:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return l}));var a=r(24),i=r.n(a);function n(e,t,r,a){return Array.isArray(e)?1===e.length?l(e[0],t,r,a):`[${e.map((e=>l(e,t,void 0,a)))}]`:l(e,t,r,a)}function l(e,t,r,a){if(null==e)return"";if("time_of_week"===t){const t=void 0!==a&&void 0!==a.timestamp?new Date(a.timestamp):new Date,r=i()(t).unix()%i.a.duration(1,"week").asSeconds(),n=i.a.duration(r,"seconds"),l=i.a.utc(t).subtract(n).startOf("day").add(e,"s");return i()(l.valueOf()).format("ddd HH:mm")}if("time_of_day"===t){const t=void 0!==a&&void 0!==a.timestamp?new Date(a.timestamp):new Date,r=i.a.utc(t).startOf("day").add(e,"s");return i()(r.valueOf()).format("HH:mm")}if(void 0!==r)return r.convert(e,"text");{const t=Math.abs(e);if(t>=1e4||t===Math.floor(t))return void 0!==r?r.convert(e,"text"):Number(e.toFixed(0));if(t>=10)return Number(e.toFixed(1));{let t;return t=e>0?Math.pow(10,3-Math.floor(Math.log(e)/Math.LN10)-1):Math.pow(10,3-Math.floor(Math.log(-1*e)/Math.LN10)-1),Math.round(e*t)/t}}}},144:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(5),i=r.n(a),n=r(88),l=r(104),o=r(93);const s=new class FieldFormatService{constructor(){i()(this,"indexPatternIdsByJob",{}),i()(this,"formatsByJob",{})}async populateFormats(e){(await Promise.all(e.map((async e=>{const t=o.a.getJob(e);return{jobId:e,dataViewId:await Object(l.d)(t.datafeed_config.indices.join(","))}})))).forEach((({jobId:e,dataViewId:t})=>{null!==t&&(this.indexPatternIdsByJob[e]=t)}));const t=e.map((e=>Promise.all([this.getFormatsForJob(e)])));try{return(await Promise.all(t)).forEach(((t,r)=>{this.formatsByJob[e[r]]=t[0]})),this.formatsByJob}catch(e){return console.log("Error populating field formats:",e),{formats:{},error:e}}}getFieldFormat(e,t){if(this.formatsByJob.hasOwnProperty(e))return this.formatsByJob[e][t]}getFieldFormatFromIndexPattern(e,t,r){let a;if("cardinality"!==r){const r=e.fields.getByName(t);void 0!==r&&(a=e.getFormatterForField(r))}return a}getFormatsForJob(e){return new Promise(((t,r)=>{const a=o.a.getJob(e).analysis_config.detectors||[],i=[],s=this.indexPatternIdsByJob[e];void 0!==s?Object(l.c)(s).then((e=>{const r=e.fields;a.forEach((t=>{const a=Object(n.r)(t.function);if(void 0!==t.field_name&&"cardinality"!==a){const a=r.getByName(t.field_name);void 0!==a&&(i[t.detector_index]=e.getFormatterForField(a))}})),t(i)})).catch((e=>{r(e)})):t(i)}))}}},147:function(e,t,r){"use strict";r.d(t,"c",(function(){return x})),r.d(t,"d",(function(){return y})),r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return O}));var a=r(17),i=r(2),n=r(45),l=r(44),o=r(7),s=r(96),c=r(18),u=r(13);const d=i.i18n.translate("xpack.ml.controls.selectSeverity.warningLabel",{defaultMessage:"warning"}),p=i.i18n.translate("xpack.ml.controls.selectSeverity.minorLabel",{defaultMessage:"minor"}),m=i.i18n.translate("xpack.ml.controls.selectSeverity.majorLabel",{defaultMessage:"major"}),f=i.i18n.translate("xpack.ml.controls.selectSeverity.criticalLabel",{defaultMessage:"critical"}),h={[d]:c.ANOMALY_THRESHOLD.LOW,[p]:c.ANOMALY_THRESHOLD.MINOR,[m]:c.ANOMALY_THRESHOLD.MAJOR,[f]:c.ANOMALY_THRESHOLD.CRITICAL},b=[{val:c.ANOMALY_THRESHOLD.LOW,display:d,color:Object(o.j)(c.ANOMALY_THRESHOLD.LOW)},{val:c.ANOMALY_THRESHOLD.MINOR,display:p,color:Object(o.j)(c.ANOMALY_THRESHOLD.MINOR)},{val:c.ANOMALY_THRESHOLD.MAJOR,display:m,color:Object(o.j)(c.ANOMALY_THRESHOLD.MAJOR)},{val:c.ANOMALY_THRESHOLD.CRITICAL,display:f,color:Object(o.j)(c.ANOMALY_THRESHOLD.CRITICAL)}];function x(e){let t=b.find((t=>t.val===e));return void 0===t&&(t=b[0]),t}const v=b[0],y=()=>Object(s.b)("mlSelectSeverity",v),g=({classNames:e}={classNames:""})=>{const[t,r]=y();return Object(u.jsx)(O,{severity:t,onChange:r})},O=({classNames:e="",severity:t,onChange:r,compressed:o})=>{const s=Object(a.useMemo)((()=>b.map((({color:e,display:t,val:r})=>({value:t,inputDisplay:Object(u.jsx)(a.Fragment,null,Object(u.jsx)(l.EuiHealth,{color:e,style:{lineHeight:"inherit"}},t)),dropdownDisplay:Object(u.jsx)(a.Fragment,null,Object(u.jsx)(l.EuiHealth,{color:e,style:{lineHeight:"inherit"}},t),Object(u.jsx)(l.EuiSpacer,{size:"xs"}),Object(u.jsx)(l.EuiText,{size:"xs",color:"subdued"},Object(u.jsx)("p",null,Object(u.jsx)(n.FormattedMessage,{id:"xpack.ml.controls.selectSeverity.scoreDetailsDescription",defaultMessage:"score {value} and above",values:{value:r}}))))})))),[]);return Object(u.jsx)(l.EuiSuperSelect,{prepend:i.i18n.translate("xpack.ml.explorer.severityThresholdLabel",{defaultMessage:"Severity"}),id:"severityThreshold","data-test-subj":"mlAnomalySeverityThresholdControls",className:e,hasDividers:!0,options:s,valueOfSelected:t.display,onChange:e=>{r(x(h[e]))},compressed:!0})}},173:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));const a=e=>t=>{t.currentTarget.blur(),e()}},179:function(e,t,r){"use strict";r.d(t,"b",(function(){return d})),r.d(t,"d",(function(){return p})),r.d(t,"a",(function(){return m})),r.d(t,"c",(function(){return f})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return b})),r.d(t,"g",(function(){return x})),r.d(t,"h",(function(){return v})),r.d(t,"i",(function(){return y})),r.d(t,"n",(function(){return g})),r.d(t,"o",(function(){return O})),r.d(t,"l",(function(){return j})),r.d(t,"j",(function(){return T})),r.d(t,"k",(function(){return _})),r.d(t,"m",(function(){return E}));var a=r(120),i=r.n(a),n=r(106),l=r(15),o=r(24),s=r.n(o),c=r(100),u=r(0);const d=7,p=5,m=10,f=100;function h(e=[],t){let r=1/0,a=-1/0;e.forEach((e=>{let t=e.value;const i=Array.isArray(e.actual)?e.actual[0]:e.actual,n=Array.isArray(e.typical)?e.typical[0]:e.typical;null===t&&void 0!==e.anomalyScore&&void 0!==e.actual&&(t=i),void 0!==e.anomalyScore&&void 0!==i?(r=Math.min(r,t,i,n),a=Math.max(a,t,i,n)):(r=Math.min(r,t),a=Math.max(a,t))}));const i={max:a,min:r};if(i.max===i.min){const e=.05*i.max;i.max+=e,i.min-=e}return"count"===t&&i.min<0&&(i.min=0),i}function b(e,t,r,a=1.5){const i=e.reduce(((t,r,a)=>{const i=e[a-1],n=e[a+1];return(void 0===i||i&&null===i.value)&&null!==r.value&&(void 0===n||n&&null===n.value)&&t.push(r),t}),[]),n=(t.select(".values-dots").empty()?t.append("g").classed("values-dots",!0):t.select(".values-dots")).selectAll("circle").data(i);n.enter().append("circle").attr("r",a),n.attr("cx",r.x()).attr("cy",r.y()),n.exit().remove()}function x(e,t){if(void 0===e||void 0===e.selectAll)throw new Error("Missing selection parameter");e.selectAll(".tick text").text((function(){const e=i.a.select(this.parentNode),r=e.node().getBBox().width,a=i.a.transform(e.attr("transform")).translate[0];if(a-r/2>=0&&a+r/2<=t)return this.textContent;e.remove()}))}function v(e){let t=c.b.SINGLE_METRIC;if("lat_long"===e.functionDescription||void 0!==e.mapData)return c.b.GEO_MAP;if("rare"===e.functionDescription&&!1===e.entityFields.some((e=>"over"===e.fieldType))?t=c.b.EVENT_DISTRIBUTION:"rare"!==e.functionDescription&&e.entityFields.some((e=>"over"===e.fieldType))&&null!==e.metricFunction&&(t=c.b.POPULATION_DISTRIBUTION),(t===c.b.EVENT_DISTRIBUTION||t===c.b.POPULATION_DISTRIBUTION)&&void 0!==e.datafeedConfig&&void 0!==e.datafeedConfig.script_fields){const r=Object.keys(e.datafeedConfig.script_fields),a=e.entityFields.map((e=>e.fieldName));e.metricFieldName&&a.push(e.metricFieldName),!0==(void 0!==a.find((e=>r.includes(e))))&&(t=c.b.SINGLE_METRIC)}return t}async function y(e,t,r){const a=s()(t.plotEarliest).toISOString(),i=s()(t.plotLatest).toISOString();let n;return t.entityFields.length>0&&(n={},t.entityFields.forEach((e=>{n[e.fieldName]=e.fieldValue}))),await e.getUrl({page:u.b.SINGLE_METRIC_VIEWER,pageState:{jobIds:[t.jobId],refreshInterval:{display:"Off",pause:!0,value:0},timeRange:r,zoom:{from:a,to:i},detectorIndex:t.detectorIndex,entities:n,query:{query_string:{analyze_wildcard:!0,query:"*"}}}},{absolute:!0})}function g(e){return void 0!==e.multiBucketImpact&&e.multiBucketImpact>=l.a.MEDIUM}function O(e){return void 0!==e.multiBucketImpact&&e.multiBucketImpact>=l.a.LOW}function j(e,t){return e/(1.75*Object(n.a)(s()().format(t),!1))}const k="next",I="previous";function T(e,t,r,a){if(t<=0)throw Error("tickInterval must be larger than 0.");const i=[e];function n(e,l){let o,s;switch(l){case I:o=e-t,s=o>=r;break;case k:o=e+t,s=o<=a}s&&(i.push(o),n(o,l))}return n(e,I),n(e,k),i.sort(),i}function _({detectorLabel:e,entityFields:t}){return e.length+t.map((e=>`${e.fieldName} ${e.fieldValue}`)).join(" ").length>60}function E(e,t,r,a){function n(e){return function(t){switch(e){case I:return t-r;case k:return t+r}}}function l(t,r){const o=function(t){const r=n(t),a=function(t){const n=e.selectAll(".tick").filter((e=>e===t));if(0===n.length||0===n[0].length)return!1;const l=i.a.selectAll(n[0]),o=l.select("text").node();if(null===o)return a(r(t));const s=o.getBBox().width,c=function(e){const t=/translate\(\s*([^\s,)]+)([ ,]([^\s,)]+))?\)/.exec(e);return Array.isArray(t)&&t.length>=2?Number(t[1]):NaN}(l.attr("transform"));return{tick:l,ts:t,xMinOffset:c-(s/2+15),xMaxOffset:c+(s/2+15)}};return a}(r),s=o(t);if(!1===s)return;const c=o(n(r)(t));!1!==c&&(c.xMinOffset<0||c.xMaxOffset>a||c.xMaxOffset>s.xMinOffset&&r===I||c.xMinOffset<s.xMaxOffset&&r===k?(c.tick.select("text").remove(),c.tick.select("line").classed("ml-tick-emphasis",!1),l(s.ts,r)):l(c.ts,r))}e.selectAll("g.tick").select("line").classed("ml-tick-emphasis",!0),l(t,I),l(t,k)}},191:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(2),i=r(27);function n(e,t,r,n){let l="",o=`ml-job-${t}`;switch(e){case"explorer":l=a.i18n.translate("xpack.ml.anomalyExplorerPageLabel",{defaultMessage:"Anomaly Explorer"});break;case"timeseriesexplorer":l=a.i18n.translate("xpack.ml.singleMetricViewerPageLabel",{defaultMessage:"Single Metric Viewer"});break;case"jobs/new_job/datavisualizer":l=a.i18n.translate("xpack.ml.dataVisualizerPageLabel",{defaultMessage:"Data Visualizer"}),o=`ml-datavisualizer-${t}`;break;default:return void console.error("addItemToRecentlyAccessed - No page specified")}(null!=n?n:Object(i.i)()).add(r,`ML - ${t} - ${l}`,o)}},242:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r(17),i=r.n(a),n=r(44),l=r(13);const o=({height:e,label:t})=>(e=e?+e:100,Object(l.jsx)("div",{className:"ml-loading-indicator",style:{height:`${e}px`},"data-test-subj":"mlLoadingIndicator"},Object(l.jsx)(n.EuiLoadingChart,{size:"xl",mono:!0}),t&&Object(l.jsx)(i.a.Fragment,null,Object(l.jsx)(n.EuiSpacer,{size:"s"}),Object(l.jsx)("div",null,t))))},243:function(e,t,r){"use strict";r(244);var a=r(245);r.d(t,"a",(function(){return a.b}))},338:function(e,t,r){"use strict";r.d(t,"a",(function(){return ae})),r(608);var a=r(17),i=r.n(a),n=r(44),l=r(13),o=r(179),s=r(2),c=r(120),u=r.n(c),d=r(72),p=r.n(d),m=r(24),f=r.n(m),h=r(95),b=r(139),x=r(7),v=r(242),y=r(144),g=r(100);const O="rgba(0, 0, 0, 0)";class explorer_chart_distribution_ExplorerChartDistribution extends i.a.Component{componentDidMount(){this.renderChart()}componentDidUpdate(){this.renderChart()}renderChart(){const{tooManyBuckets:e,tooltipService:t,timeBuckets:r,showSelectedInterval:a,onPointerUpdate:i,chartTheme:n,cursor:l}=this.props,c=this.rootNode,d=this.props.seriesConfig,m=this.props.severity;if(void 0===d||!1===Array.isArray(d.chartData))return;const v=y.a.getFieldFormat(d.jobId,d.detectorIndex);let j=0;const k=170,I=Object(o.h)(d),T={top:10,right:0,bottom:30,left:0};I===g.b.POPULATION_DISTRIBUTION&&(T.left=60);let _,E=null,S=null,M=null;const w=I===g.b.EVENT_DISTRIBUTION?"entity":"value";let A=d.chartData.find((e=>void 0!==e.anomalyScore));A=A&&A.entity;var L;L=function({chartData:e,functionDescription:t}){const r=p()(".ml-explorer-chart"),a=u.a.select(c).select(".content-wrapper");a.select("svg").remove();const i=r.width(),n=k+T.top+T.bottom,l=a.append("svg").classed("ml-explorer-chart-svg",!0).attr("width",i).attr("height",n),s=u.a.nest().key((e=>e.entity)).entries(e).sort(((e,t)=>t.values.length-e.values.length)).filter(((e,t)=>I!==g.b.EVENT_DISTRIBUTION||t<30||e.key===A)).map((e=>e.key));if(e=e.filter((e=>s.includes(e.entity))),I===g.b.POPULATION_DISTRIBUTION){const r=e.filter((e=>e.entity===A)),{min:a,max:i}=Object(o.e)(r,t);e=e.filter((e=>e.value<=i)),S=u.a.scale.linear().range([k,0]).domain([a<0?a:0,i]).nice()}else{if(I!==g.b.EVENT_DISTRIBUTION)throw`chartType '${I}' not supported`;{const e=5;S=u.a.scale.ordinal().rangePoints([e,k-e]).domain(s)}}const m=u.a.svg.axis().scale(S).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);let f=0;const h=l.append("g").attr("class","temp-axis-label tick"),b=I===g.b.POPULATION_DISTRIBUTION?S.ticks():s;return h.selectAll("text.temp.axis").data(b).enter().append("text").text((e=>void 0!==v?v.convert(e,"text"):I===g.b.POPULATION_DISTRIBUTION?S.tickFormat()(e):e)).each((function(){f=Math.max(this.getBBox().width+m.tickPadding(),f)})).remove(),u.a.select(".temp-axis-label").remove(),(I===g.b.POPULATION_DISTRIBUTION||I===g.b.EVENT_DISTRIBUTION&&s.length<=10)&&(T.left=Math.max(f,40)),j=i-T.left-T.right,E=u.a.time.scale().range([0,j]).domain([d.plotEarliest,d.plotLatest]),M=u.a.svg.line().x((e=>E(e.date))).y((e=>S(e[w]))).defined((e=>null!==e.value)),_=l.append("g").attr("class","line-chart").attr("transform","translate("+T.left+","+T.top+")"),e}(d),_.append("rect").attr("x",0).attr("y",0).attr("height",k).attr("width",j).style("stroke","#cccccc").style("fill","none").style("stroke-width",1),function(){const t={min:f()(d.plotEarliest),max:f()(d.plotLatest)};r.setBounds(t),r.setInterval("auto");const a=r.getScaledDateFormat(),i=Math.max(d.selectedEarliest,d.plotEarliest),n=d.selectedLatest-d.selectedEarliest+1,l=u.a.svg.axis().scale(E).orient("bottom").innerTickSize(-170).outerTickSize(0).tickPadding(10).tickFormat((e=>f()(e).format(a))),s=!0===e||n>=d.plotLatest-d.plotEarliest;if(!1===s){const e=Object(o.j)(i,n,d.plotEarliest,d.plotLatest);l.tickValues(e)}else l.ticks(Object(o.l)(j,a));const c=u.a.svg.axis().scale(S).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);void 0!==v&&c.tickFormat((e=>v.convert(e,"text")));const p=_.append("g"),m=p.append("g").attr("class","x axis").attr("transform","translate(0,170)").call(l);p.append("g").attr("class","y axis").call(c),I===g.b.EVENT_DISTRIBUTION&&p.select(".y").selectAll("text").each((function(e){u.a.select(this).classed("ml-explorer-chart-axis-emphasis",e===A)})),!1===s&&Object(o.m)(m,i,n,j)}(),function(){if(!1===a)return;const e=Math.max(d.selectedEarliest,d.plotEarliest),t=Math.min(d.selectedLatest,d.plotLatest),r=E(t)-E(e);_.append("rect").attr("class","selected-interval").attr("x",E(new Date(e))+2).attr("y",2).attr("rx",3).attr("ry",3).attr("width",r-4).attr("height",166)}(),function(e){var t,r,a;e.append("rect").attr("x",0).attr("y",0).attr("height",k).attr("width",j).on("mouseout",(function(){i({chartId:"ml-anomaly-chart-metric",scale:"time",smHorizontalValue:null,smVerticalValue:null,type:"Out",unit:void 0})})).on("mousemove",(function(){const e=u.a.mouse(this);i({chartId:"ml-anomaly-chart-metric",scale:"time",smHorizontalValue:null,smVerticalValue:null,type:"Over",unit:void 0,x:1e3*f()(E.invert(e[0])).unix()})})).style("fill",O);const o=l&&"Over"===l.type&&l.x>=d.plotEarliest&&l.x<=d.plotLatest?[l.x]:[],s=e.append("g").attr("class","ml-anomaly-chart-cursor").selectAll(".ml-anomaly-chart-cursor-line").data(o);s.enter().append("path").attr("class","ml-anomaly-chart-cursor-line").attr("d",(e=>{const t=E(e);return`M${t},170 ${t},0`})).style("stroke",`${null!==(t=n.crosshair.line.stroke)&&void 0!==t?t:"black"}`).style("stroke-width",`${null!==(r=n.crosshair.line.strokeWidth)&&void 0!==r?r:"1"}px`).style("stroke-dasharray",null!==(a=n.crosshair.line.dash)&&void 0!==a?a:"4,4"),s.exit().remove()}(_),function(e,t,r,a=1.5){const i=(t.select(".values-dots").empty()?t.append("g").classed("values-dots",!0):t.select(".values-dots")).selectAll("circle").data(e);i.enter().append("circle").classed("values-dots-circle",!0).classed("values-dots-circle-blur",(e=>e.entity!==A)).attr("r",(e=>e.entity===A?1.5*a:a)),i.attr("cx",r.x()).attr("cy",r.y()),i.exit().remove()}(L,_,M),function(e){const r=_.append("g").attr("class","chart-markers").selectAll(".metric-value").data(e.filter((e=>null!==e.value)));r.exit().remove(),r.enter().append("circle").attr("r",7).on("mouseover",(function(e){!function(e,r){const a=[{label:Object(h.c)(e.date)}],i=d.detectorLabel;if(void 0!==e.entity&&a.push({label:s.i18n.translate("xpack.ml.explorer.distributionChart.entityLabel",{defaultMessage:"entity"}),value:e.entity,seriesIdentifier:{key:i},valueAccessor:"entity"}),void 0!==e.anomalyScore){const t=parseInt(e.anomalyScore),r=Object(x.g)(t);a.push({label:s.i18n.translate("xpack.ml.explorer.distributionChart.anomalyScoreLabel",{defaultMessage:"anomaly score"}),value:r,color:Object(x.j)(t),seriesIdentifier:{key:i},valueAccessor:"anomaly_score"}),I!==g.b.EVENT_DISTRIBUTION&&(a.push({label:s.i18n.translate("xpack.ml.explorer.distributionChart.valueLabel",{defaultMessage:"value"}),value:Object(b.b)(e.value,d.functionDescription,v),seriesIdentifier:{key:i},valueAccessor:"value"}),void 0!==e.numberOfCauses&&1!==e.numberOfCauses||a.push({label:s.i18n.translate("xpack.ml.explorer.distributionChart.typicalLabel",{defaultMessage:"typical"}),value:Object(b.b)(e.typical,d.functionDescription,v),seriesIdentifier:{key:i},valueAccessor:"typical"}),void 0!==e.byFieldName&&void 0!==e.numberOfCauses&&a.push({label:s.i18n.translate("xpack.ml.explorer.distributionChart.unusualByFieldValuesLabel",{defaultMessage:"{ numberOfCauses, plural, one {# unusual {byFieldName} value} other {#{plusSign} unusual {byFieldName} values}}",values:{numberOfCauses:e.numberOfCauses,byFieldName:e.byFieldName,plusSign:e.numberOfCauses<10?"":"+"}}),seriesIdentifier:{key:i},valueAccessor:"numberOfCauses"}))}else I!==g.b.EVENT_DISTRIBUTION&&a.push({label:s.i18n.translate("xpack.ml.explorer.distributionChart.valueWithoutAnomalyScoreLabel",{defaultMessage:"value"}),value:Object(b.b)(e.value,d.functionDescription,v),seriesIdentifier:{key:i},valueAccessor:"value"});void 0!==e.scheduledEvents&&e.scheduledEvents.forEach(((t,r)=>{a.push({label:s.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.scheduledEventsLabel",{defaultMessage:"scheduled event{counter}",values:{counter:e.scheduledEvents.length>1?` #${r+1}`:""}}),value:t,seriesIdentifier:{key:i},valueAccessor:`scheduled_events_${r+1}`})})),t.show(a,r,{x:21,y:14})}(e,this)})).on("mouseout",(()=>t.hide())),r.attr("cx",(e=>E(e.date))).attr("cy",(e=>S(e[w]))).attr("class",(e=>{let t="metric-value";return void 0!==e.anomalyScore&&Number(e.anomalyScore)>=m&&(t+=" anomaly-marker ",t+=Object(x.l)(e.anomalyScore).id),t}));const a=_.select(".chart-markers").selectAll(".scheduled-event-marker").data(e.filter((e=>void 0!==e.scheduledEvents)));a.exit().remove(),a.enter().append("rect").attr("width",14).attr("height",5).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1),a.attr("x",(e=>E(e.date)-7)).attr("y",(e=>S(e[w])-2.5))}(L)}shouldComponentUpdate(){return!0}setRef(e){this.rootNode=e}render(){const{seriesConfig:e}=this.props;if(void 0===e)return null;const t=e.loading;return Object(l.jsx)("div",{className:"ml-explorer-chart",ref:this.setRef.bind(this)},t&&Object(l.jsx)(v.a,{height:215}),!t&&Object(l.jsx)("div",{className:"content-wrapper"}))}}const j="ml-explorer-chart-content-wrapper";class explorer_chart_single_metric_ExplorerChartSingleMetric extends i.a.Component{componentDidMount(){this.renderChart()}componentDidUpdate(){this.renderChart()}renderChart(){const{tooManyBuckets:e,tooltipService:t,timeBuckets:r,showSelectedInterval:a,onPointerUpdate:i,chartTheme:n,cursor:l}=this.props,c=this.rootNode,d=this.props.seriesConfig,m=this.props.severity;if(void 0===d||!1===Array.isArray(d.chartData))return;const v=y.a.getFieldFormat(d.jobId,d.detectorIndex);let g=0;const k=170,I={top:10,right:0,bottom:30,left:60};let T,_=null,E=null,S=null;var M;function w(e,r){const a=[{label:Object(h.c)(e.date)}],i=d.detectorLabel;if(void 0!==e.anomalyScore){const t=parseInt(e.anomalyScore);a.push({label:s.i18n.translate("xpack.ml.explorer.singleMetricChart.anomalyScoreLabel",{defaultMessage:"anomaly score"}),value:Object(x.g)(t),color:Object(x.j)(t),seriesIdentifier:{key:i},valueAccessor:"anomaly_score"}),!0===Object(o.o)(e)&&a.push({label:s.i18n.translate("xpack.ml.explorer.singleMetricChart.multiBucketImpactLabel",{defaultMessage:"multi-bucket impact"}),value:Object(x.h)(e.multiBucketImpact),seriesIdentifier:{key:i},valueAccessor:"multi_bucket_impact"}),void 0!==e.actual&&"rare"!==d.functionDescription?(a.push({label:s.i18n.translate("xpack.ml.explorer.singleMetricChart.actualLabel",{defaultMessage:"actual"}),value:Object(b.b)(e.actual,d.functionDescription,v),seriesIdentifier:{key:i},valueAccessor:"actual"}),a.push({label:s.i18n.translate("xpack.ml.explorer.singleMetricChart.typicalLabel",{defaultMessage:"typical"}),value:Object(b.b)(e.typical,d.functionDescription,v),seriesIdentifier:{key:i},valueAccessor:"typical"})):(a.push({label:s.i18n.translate("xpack.ml.explorer.singleMetricChart.valueLabel",{defaultMessage:"value"}),value:Object(b.b)(e.value,d.functionDescription,v),seriesIdentifier:{key:i},valueAccessor:"value"}),void 0!==e.byFieldName&&void 0!==e.numberOfCauses&&a.push({label:s.i18n.translate("xpack.ml.explorer.distributionChart.unusualByFieldValuesLabel",{defaultMessage:"{ numberOfCauses, plural, one {# unusual {byFieldName} value} other {#{plusSign} unusual {byFieldName} values}}",values:{numberOfCauses:e.numberOfCauses,byFieldName:e.byFieldName,plusSign:e.numberOfCauses<10?"":"+"}}),seriesIdentifier:{key:i},valueAccessor:"numberOfCauses"}))}else a.push({label:s.i18n.translate("xpack.ml.explorer.singleMetricChart.valueWithoutAnomalyScoreLabel",{defaultMessage:"value"}),value:Object(b.b)(e.value,d.functionDescription,v),seriesIdentifier:{key:i},valueAccessor:"value"});void 0!==e.scheduledEvents&&a.push({label:s.i18n.translate("xpack.ml.explorer.singleMetricChart.scheduledEventsLabel",{defaultMessage:"Scheduled events"}),value:e.scheduledEvents,seriesIdentifier:{key:i},valueAccessor:"scheduledEvents"}),t.show(a,r,{x:3*o.b,y:2*o.b})}!function(e){const t=p()(".ml-explorer-chart"),r=u.a.select(c).select(`.${j}`);r.select("svg").remove();const a=t.width(),i=k+I.top+I.bottom,n=r.append("svg").classed("ml-explorer-chart-svg",!0).attr("width",a).attr("height",i);E=u.a.scale.linear().range([k,0]).domain([e.min,e.max]).nice();const l=u.a.svg.axis().scale(E).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);let o=0;n.append("g").attr("class","temp-axis-label tick").selectAll("text.temp.axis").data(E.ticks()).enter().append("text").text((e=>void 0!==v?v.convert(e,"text"):E.tickFormat()(e))).each((function(){o=Math.max(this.getBBox().width+l.tickPadding(),o)})).remove(),u.a.select(".temp-axis-label").remove(),I.left=Math.max(o,40),g=a-I.left-I.right,_=u.a.time.scale().range([0,g]).domain([d.plotEarliest,d.plotLatest]),S=u.a.svg.line().x((e=>_(e.date))).y((e=>E(e.value))).defined((e=>null!==e.value)),T=n.append("g").attr("class","line-chart").attr("transform","translate("+I.left+","+I.top+")")}(d.chartLimits),M=d.chartData,T.append("rect").attr("x",0).attr("y",0).attr("height",k).attr("width",g).style("stroke","#cccccc").style("fill","none").style("stroke-width",1),function(){const t={min:f()(d.plotEarliest),max:f()(d.plotLatest)};r.setBounds(t),r.setInterval("auto");const a=r.getScaledDateFormat(),i=Math.max(d.selectedEarliest,d.plotEarliest),n=d.selectedLatest-d.selectedEarliest+1,l=u.a.svg.axis().scale(_).orient("bottom").innerTickSize(-170).outerTickSize(0).tickPadding(10).tickFormat((e=>f()(e).format(a))),s=!0===e||n>=d.plotLatest-d.plotEarliest;if(!1===s){const e=Object(o.j)(i,n,d.plotEarliest,d.plotLatest);l.tickValues(e)}else l.ticks(Object(o.l)(g,a));const c=u.a.svg.axis().scale(E).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);void 0!==v&&c.tickFormat((e=>v.convert(e,"text")));const p=T.append("g"),m=p.append("g").attr("class","x axis").attr("transform","translate(0,170)").call(l);p.append("g").attr("class","y axis").call(c),!1===s&&Object(o.m)(m,i,n,g)}(),function(){if(!1===a)return;const e=Math.max(d.selectedEarliest,d.plotEarliest),t=Math.min(d.selectedLatest,d.plotLatest),r=_(t)-_(e);T.append("rect").attr("class","selected-interval").attr("x",_(new Date(e))+2).attr("y",2).attr("rx",3).attr("ry",3).attr("width",r-4).attr("height",166)}(),function(e){var t,r,a;e.append("rect").attr("x",0).attr("y",0).attr("height",k).attr("width",g).on("mouseout",(function(){i({chartId:"ml-anomaly-chart-metric",scale:"time",smHorizontalValue:null,smVerticalValue:null,type:"Out",unit:void 0})})).on("mousemove",(function(){const e=u.a.mouse(this);i&&i({chartId:"ml-anomaly-chart-metric",scale:"time",smHorizontalValue:null,smVerticalValue:null,type:"Over",unit:void 0,x:1e3*f()(_.invert(e[0])).unix()})})).style("fill",O);const o=l&&"Over"===l.type&&l.x>=d.plotEarliest&&l.x<=d.plotLatest?[l.x]:[],s=e.append("g").attr("class","ml-anomaly-chart-cursor").selectAll(".ml-anomaly-chart-cursor-line").data(o);s.enter().append("path").attr("class","ml-anomaly-chart-cursor-line").attr("d",(e=>{const t=_(e);return`M${t},170 ${t},0`})).style("stroke",`${null!==(t=n.crosshair.line.stroke)&&void 0!==t?t:"black"}`).style("stroke-width",`${null!==(r=n.crosshair.line.strokeWidth)&&void 0!==r?r:"1"}px`).style("stroke-dasharray",null!==(a=n.crosshair.line.dash)&&void 0!==a?a:"4,4"),s.exit().remove()}(T),function(e){T.append("path").attr("class","values-line").attr("d",S(e))}(M),Object(o.f)(M,T,S),function(e){const r=T.append("g").attr("class","chart-markers").selectAll(".metric-value").data(e.filter((e=>(null!==e.value||"number"==typeof e.anomalyScore)&&!Object(o.n)(e))));r.exit().remove(),r.enter().append("circle").attr("r",o.b).on("mouseover",(function(e){w(e,this)})).on("mouseout",(()=>t.hide()));const a=e=>void 0!==e.anomalyScore&&Number(e.anomalyScore)>=m;r.attr("cx",(e=>_(e.date))).attr("cy",(e=>E(e.value))).attr("class",(e=>{let t="metric-value";return a(e)&&(t+=` anomaly-marker ${Object(x.l)(e.anomalyScore).id}`),t}));const i=T.select(".chart-markers").selectAll(".multi-bucket").data(e.filter((e=>a(e)&&!0===Object(o.n)(e))));i.exit().remove(),i.enter().append("path").attr("d",u.a.svg.symbol().size(o.c).type("cross")).attr("transform",(e=>`translate(${_(e.date)}, ${E(e.value)})`)).attr("class",(e=>`anomaly-marker multi-bucket ${Object(x.l)(e.anomalyScore).id}`)).on("mouseover",(function(e){w(e,this)})).on("mouseout",(()=>t.hide()));const n=T.select(".chart-markers").selectAll(".scheduled-event-marker").data(e.filter((e=>void 0!==e.scheduledEvents)));n.exit().remove(),n.enter().append("rect").attr("width",2*o.b).attr("height",o.d).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1),n.attr("x",(e=>_(e.date)-o.b)).attr("y",(e=>E(e.value)-o.d/2))}(M)}shouldComponentUpdate(){return!0}setRef(e){this.rootNode=e}render(){const{seriesConfig:e}=this.props;if(void 0===e)return null;const t=e.loading;return Object(l.jsx)("div",{className:"ml-explorer-chart",ref:this.setRef.bind(this)},t&&Object(l.jsx)(v.a,{height:215}),!t&&Object(l.jsx)("div",{className:j}))}}function k({entity:e}){return Object(l.jsx)("span",{className:"ml-explorer-chart-label-badge"},Object(l.jsx)(n.EuiBadge,{color:"hollow",className:"ml-reset-font-weight"},e.fieldName," ",Object(l.jsx)("strong",null,e.fieldValue)))}r(613),r(618);const I={[g.b.EVENT_DISTRIBUTION]:s.i18n.translate("xpack.ml.explorer.charts.infoTooltip.chartEventDistributionDescription",{defaultMessage:"The gray dots depict the approximate distribution of occurrences over time for a sample of {byFieldValuesParam} with more frequent event types at the top and rarer ones at the bottom.",values:{byFieldValuesParam:"by_field_values"}}),[g.b.POPULATION_DISTRIBUTION]:s.i18n.translate("xpack.ml.explorer.charts.infoTooltip.chartPopulationDistributionDescription",{defaultMessage:"The gray dots depict the approximate distribution of values over time for a sample of {overFieldValuesParam}.",values:{overFieldValuesParam:"over_field_values"}})};function T({toolTipData:e}){return Object(l.jsx)("dl",{className:"mlDescriptionList"},e.map((({title:e,description:t})=>Object(l.jsx)(i.a.Fragment,{key:`${e} ${t}`},Object(l.jsx)("dt",{className:"mlDescriptionList__title"},e),Object(l.jsx)("dd",{className:"mlDescriptionList__description"},t)))))}const _=({jobId:e,aggregationInterval:t,chartFunction:r,chartType:a,entityFields:o=[]})=>{const c=I[a],u=[{title:s.i18n.translate("xpack.ml.explorer.charts.infoTooltip.jobIdTitle",{defaultMessage:"job ID"}),description:e},{title:s.i18n.translate("xpack.ml.explorer.charts.infoTooltip.aggregationIntervalTitle",{defaultMessage:"aggregation interval"}),description:t},{title:s.i18n.translate("xpack.ml.explorer.charts.infoTooltip.chartFunctionTitle",{defaultMessage:"chart function"}),description:r}];return o.forEach((e=>{u.push({title:e.fieldName,description:e.fieldValue})})),Object(l.jsx)("div",{className:"ml-explorer-chart-info-tooltip"},Object(l.jsx)(T,{toolTipData:u}),c&&Object(l.jsx)(i.a.Fragment,null,Object(l.jsx)(n.EuiSpacer,{size:"s"}),Object(l.jsx)("div",{className:"ml-explorer-chart-description"},c)))};var E=r(45),S=r(173);r(623);const M=({onFilter:e,influencerFieldName:t,influencerFieldValue:r})=>Object(l.jsx)(i.a.Fragment,null,Object(l.jsx)(n.EuiToolTip,{content:Object(l.jsx)(E.FormattedMessage,{id:"xpack.ml.entityFilter.addFilterTooltip",defaultMessage:"Add filter"})},Object(l.jsx)(n.EuiButtonIcon,{size:"s",className:"filter-button",onClick:Object(S.a)((()=>{e({influencerFieldName:t,influencerFieldValue:r,action:x.a.ADD})})),iconType:"plusInCircle","aria-label":s.i18n.translate("xpack.ml.entityFilter.addFilterAriaLabel",{defaultMessage:"Add filter for {influencerFieldName} {influencerFieldValue}",values:{influencerFieldName:t,influencerFieldValue:r}})})),Object(l.jsx)(n.EuiToolTip,{content:Object(l.jsx)(E.FormattedMessage,{id:"xpack.ml.entityFilter.removeFilterTooltip",defaultMessage:"Remove filter"})},Object(l.jsx)(n.EuiButtonIcon,{size:"s",className:"filter-button",onClick:Object(S.a)((()=>{e({influencerFieldName:t,influencerFieldValue:r,action:x.a.REMOVE})})),iconType:"minusInCircle","aria-label":s.i18n.translate("xpack.ml.entityFilter.removeFilterAriaLabel",{defaultMessage:"Remove filter for {influencerFieldName} {influencerFieldValue}",values:{influencerFieldName:t,influencerFieldValue:r}})})));function w({detectorLabel:e,entityFields:t,infoTooltip:r,wrapLabel:o=!1,onSelectEntity:s}){const c=!0===o||0===t.length||0===e.length?Object(l.jsx)(i.a.Fragment,null," "):Object(l.jsx)(i.a.Fragment,null," – "),u=Object(a.useCallback)((({influencerFieldName:e,influencerFieldValue:t,action:r})=>s(e,t,r)),[s]),d=t.map((e=>{const t=`${r.chartFunction}-${e.fieldName}-${e.fieldType}-${e.fieldValue}`;return Object(l.jsx)(a.Fragment,{key:`badge-wrapper-${t}`},Object(l.jsx)(k,{entity:e}),void 0!==s&&Object(l.jsx)(M,{onFilter:u,influencerFieldName:e.fieldName,influencerFieldValue:e.fieldValue}))})),p=Object(l.jsx)("span",{className:"ml-explorer-chart-info-icon"},Object(l.jsx)(n.EuiIconTip,{className:"ml-explorer-chart-eui-icon-tip",content:Object(l.jsx)(_,r),position:"top",size:"s"}));return Object(l.jsx)(i.a.Fragment,null,Object(l.jsx)("span",{className:"ml-explorer-chart-label"},Object(l.jsx)("span",{className:"ml-explorer-chart-label-detector"},e,c),o&&p,!o&&Object(l.jsx)(i.a.Fragment,null,d," ",p)),o&&Object(l.jsx)("span",{className:"ml-explorer-chart-label-badges"},d))}var A=r(110),L=r(243),N=r(46),F=r(80),C=r(103),D=r(163),B=r(52),R=r(67);const V=({errorMessagesByType:e})=>{if(!e||0===Object.keys(e).length)return null;const t=Object.keys(e).map((t=>Object(l.jsx)(n.EuiCallOut,{color:"warning",size:"s",key:t},Object(l.jsx)(E.FormattedMessage,{id:"xpack.ml.explorerCharts.errorCallOutMessage",defaultMessage:"You can't view anomaly charts for {jobs} because {reason}.",values:{jobs:[...e[t]].join(", "),reason:t}}))));return Object(l.jsx)(i.a.Fragment,null,t,Object(l.jsx)(n.EuiSpacer,{size:"m"}))};var P=r(191),U=r(18);function z(e,t){const r=[];for(let i=0;i<e.length;i++){var a;const n=e[i],l=n.geo_results||(null==n?void 0:n.causes)&&(null==n||null===(a=n.causes[0])||void 0===a?void 0:a.geo_results),o=l&&l[t];if(void 0!==o){const e=o.split(",").map((e=>Number(e))).reverse();r.push({type:"Feature",geometry:{type:"Point",coordinates:e},properties:{record_score:Math.floor(n.record_score),[t]:e.map((e=>e.toFixed(2)))}})}}return r}const H=e=>({id:"anomalies_typical_layer",label:"Typical",sourceDescriptor:{id:"b7486535-171b-4d3b-bb2e-33c1a0a2854e",type:"GEOJSON_FILE",__featureCollection:{features:z(e,"typical_point"),type:"FeatureCollection"}},visible:!0,style:{type:"VECTOR",properties:{fillColor:{type:"STATIC",options:{color:"#98A2B2"}},lineColor:{type:"STATIC",options:{color:"#fff"}},lineWidth:{type:"STATIC",options:{size:2}},iconSize:{type:"STATIC",options:{size:6}}}},type:B.LAYER_TYPE.GEOJSON_VECTOR});var $=r(349);function G({seriesConfig:e}){const[t,r]=Object(a.useState)([]);return Object(a.useEffect)((()=>{var t;e.mapData&&e.mapData.length>0&&r([(t=e.mapData,{id:"anomalies_actual_layer",label:"Actual",sourceDescriptor:{id:"b7486535-171b-4d3b-bb2e-33c1a0a2854d",type:"GEOJSON_FILE",__fields:[{name:"record_score",type:"number"}],__featureCollection:{features:z(t,"actual_point"),type:"FeatureCollection"}},visible:!0,style:{type:"VECTOR",properties:{fillColor:{type:B.STYLE_TYPE.DYNAMIC,options:{customColorRamp:U.SEVERITY_COLOR_RAMP,field:{name:"record_score",origin:B.FIELD_ORIGIN.SOURCE},useCustomColorRamp:!0}},lineColor:{type:"STATIC",options:{color:"#fff"}},lineWidth:{type:"STATIC",options:{size:2}},iconSize:{type:"STATIC",options:{size:6}}}},type:B.LAYER_TYPE.GEOJSON_VECTOR}),H(e.mapData)])}),[e]),Object(l.jsx)("div",{"data-test-subj":"xpack.ml.explorer.embeddedMap",style:{width:"100%",height:300}},Object(l.jsx)($.a,{layerList:t}))}var Y=r(71),J=r(49),W=r(90),q=r.n(W),X=r(106);const K=s.i18n.translate("xpack.ml.explorer.charts.tooManyBucketsDescription",{defaultMessage:"This selection contains too many buckets to be displayed. You should shorten the time range of the view or narrow the selection in the timeline."}),Q=s.i18n.translate("xpack.ml.explorer.charts.openInSingleMetricViewerButtonLabel",{defaultMessage:"Open in Single Metric Viewer"}),Z=s.i18n.translate("xpack.ml.explorer.charts.mapsPluginMissingMessage",{defaultMessage:"maps or embeddable start plugin not found"}),ee=s.i18n.translate("xpack.ml.explorer.charts.openInMapsPluginMessage",{defaultMessage:"Open in Maps"});function te(e){const{jobId:t,detectorLabel:r,entityFields:a}=e;return`${t}_${r}_${a.map((e=>`${e.fieldName}/${e.fieldValue}`)).join(",")}`}function re({series:e,severity:t,tooManyBuckets:r,wrapLabel:s,mlLocator:c,timeBuckets:u,timefilter:d,timeRange:p,onSelectEntity:m,recentlyAccessed:f,tooManyBucketsCalloutMsg:h,showSelectedInterval:b,chartsService:x}){var v;const[y,O]=Object(a.useState)(""),[j,k]=Object(a.useState)(""),{services:{share:I,application:{navigateToApp:T}}}=Object(F.b)(),_=Object(a.useCallback)((async()=>{const{queryString:t,query:r}=function(e){var t;const r=null===(t=e.entityFields)||void 0===t?void 0:t.map((({fieldName:e,fieldValue:t})=>Object(X.d)(e,t))).join(" or ");return{query:{language:A.c.KUERY,query:r},queryString:r}}(e),a=Object(D.c)(e.jobId),i=I.url.locators.get(R.MAPS_APP_LOCATOR);return await i.getLocation({initialLayers:a,timeRange:null!=p?p:null==d?void 0:d.getTime(),...void 0!==t?{query:r}:{}})}),[null==e?void 0:e.jobId,p]);Object(a.useEffect)((()=>{let t=!1;return(async()=>{let r=p;const a=null==d?void 0:d.getActiveBounds();if(!p&&a&&(r={from:a.min.toISOString(),to:a.max.toISOString()}),!t&&e.functionDescription!==C.b.LAT_LONG)try{const t=await Object(o.i)(c,e,r);O(t)}catch(e){O("")}})(),()=>{t=!0}}),[c,e,p]),Object(a.useEffect)((function(){let t=!1;if(e&&Object(o.h)(e)===g.b.GEO_MAP){const e=async()=>{try{const e=await _();t||k(null==e?void 0:e.path)}catch(e){console.error(e),k("")}};e().catch(console.error)}return()=>{t=!0}}),[e]);const S=Object(a.useRef)(null),{euiTheme:M}=Object(n.useEuiTheme)(),N=x.theme.useChartsTheme(),V=Object(Y.useActiveCursor)(x.activeCursor,S,{isDateHistogram:!0}),U=null===(v=q()(x.activeCursor.activeCursor$))||void 0===v?void 0:v.cursor,z=Object(a.useCallback)((()=>{f&&Object(P.a)("timeseriesexplorer",e.jobId,y,f)}),[y,f]),{detectorLabel:H,entityFields:$}=e,W=Object(o.h)(e);let Z=Object(l.jsx)(i.a.Fragment,null,H);if(W===g.b.EVENT_DISTRIBUTION){const t=e.entityFields.find((e=>"by"===e.fieldType));void 0!==t&&(Z=Object(l.jsx)(i.a.Fragment,null,Object(l.jsx)(E.FormattedMessage,{id:"xpack.ml.explorer.charts.detectorLabel",defaultMessage:'{detectorLabel}{br}y-axis event distribution split by "{fieldName}"',values:{detectorLabel:H,br:Object(l.jsx)("br",null),fieldName:t.fieldName}})),s=!0)}return Object(l.jsx)(i.a.Fragment,null,Object(l.jsx)("div",{style:{width:0,height:0}},Object(l.jsx)(J.Chart,{ref:S},Object(l.jsx)(J.Settings,{noResults:Object(l.jsx)("div",null)}))),Object(l.jsx)(n.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(l.jsx)(n.EuiFlexItem,{grow:!1},Object(l.jsx)(w,{detectorLabel:Z,entityFields:$,infoTooltip:{...e.infoTooltip,chartType:W},wrapLabel:s,onSelectEntity:m})),Object(l.jsx)(n.EuiFlexItem,{grow:!1},Object(l.jsx)("div",{css:Object(l.css)("padding:",M.size.xs,";","")},r&&Object(l.jsx)(n.EuiIconTip,{content:null!=h?h:K,position:"top",size:"s",type:"alert",color:"warning"}),y&&Object(l.jsx)(n.EuiToolTip,{position:"top",content:Q},Object(l.jsx)(n.EuiButtonEmpty,{iconSide:"right",iconType:"visLine",size:"xs",href:y,onClick:z},Object(l.jsx)(E.FormattedMessage,{id:"xpack.ml.explorer.charts.viewLabel",defaultMessage:"View"}))),W===g.b.GEO_MAP&&j?Object(l.jsx)(n.EuiToolTip,{position:"top",content:ee},Object(l.jsx)(n.EuiButtonEmpty,{iconSide:"right",iconType:"logoMaps",size:"xs",onClick:async()=>{await T(B.APP_ID,{path:j})}},Object(l.jsx)(E.FormattedMessage,{id:"xpack.ml.explorer.charts.viewInMapsLabel",defaultMessage:"View"}))):null))),W===g.b.GEO_MAP?Object(l.jsx)(L.a,null,(t=>Object(l.jsx)(G,{seriesConfig:e,tooltipService:t}))):W===g.b.EVENT_DISTRIBUTION||W===g.b.POPULATION_DISTRIBUTION?Object(l.jsx)(L.a,null,(a=>Object(l.jsx)(explorer_chart_distribution_ExplorerChartDistribution,{timeBuckets:u,tooManyBuckets:r,seriesConfig:e,severity:t,tooltipService:a,showSelectedInterval:b,onPointerUpdate:V,chartTheme:N,cursor:U}))):W===g.b.SINGLE_METRIC?Object(l.jsx)(L.a,null,(a=>Object(l.jsx)(explorer_chart_single_metric_ExplorerChartSingleMetric,{timeBuckets:u,tooManyBuckets:r,seriesConfig:e,severity:t,tooltipService:a,showSelectedInterval:b,onPointerUpdate:V,chartTheme:N,cursor:U}))):void 0)}const ae=Object(N.withKibana)((({chartsPerRow:e,seriesToPlot:t,severity:r,tooManyBuckets:a,kibana:s,errorMessages:c,mlLocator:u,timeBuckets:d,timefilter:p,timeRange:m,onSelectEntity:f,tooManyBucketsCalloutMsg:h,showSelectedInterval:b,chartsService:x})=>{const{services:{chrome:{recentlyAccessed:v},embeddable:y,maps:g}}=s;let O;y&&g||(O=[],t.forEach((e=>{"lat_long"===e.functionDescription?void 0===c[Z]?c[Z]=new Set([e.jobId]):c[Z].add(e.jobId):O.push(e)})));const j=void 0!==O?O:t,k=1===e?"calc(100% - 20px)":"auto",I=1===e?0:e,T=j.some((e=>Object(o.k)(e)));return Object(l.jsx)(i.a.Fragment,null,Object(l.jsx)(V,{errorMessagesByType:c}),Object(l.jsx)(n.EuiFlexGrid,{columns:I,gutterSize:"m","data-test-subj":"mlExplorerChartsContainer"},j.length>0&&j.map((e=>Object(l.jsx)(n.EuiFlexItem,{key:te(e),className:"ml-explorer-chart-container",style:{minWidth:k}},Object(l.jsx)(re,{series:e,severity:r,tooManyBuckets:a,wrapLabel:T,mlLocator:u,timeBuckets:d,timefilter:p,timeRange:m,onSelectEntity:f,recentlyAccessed:v,tooManyBucketsCalloutMsg:h,showSelectedInterval:b,chartsService:x}))))))}))},349:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(17),i=r(44),n=r(52),l=r(53),o=r(80),s=r(13);function c({layerList:e,mapEmbeddableInput:t,renderTooltipContent:r}){const[c,u]=Object(a.useState)(),d=Object(a.useRef)(null),p=Object(a.useRef)(),{services:{embeddable:m,maps:f}}=Object(o.b)(),h=m?m.getEmbeddableFactory(n.MAP_SAVED_OBJECT_TYPE):void 0;return Object(a.useEffect)((()=>{!async function(){c&&!Object(l.isErrorEmbeddable)(c)&&Array.isArray(e)&&Array.isArray(p.current)&&c.setLayerList([...p.current,...e])}()}),[c,e]),Object(a.useEffect)((()=>{!async function(){if(!h)return void console.error("Map embeddable not found.");const e={id:Object(i.htmlIdGenerator)()(),attributes:{title:""},filters:[],hidePanelTitles:!0,viewMode:l.ViewMode.VIEW,isLayerTOCOpen:!1,hideFilterActions:!0,mapSettings:{disableInteractive:!1,hideToolbarOverlay:!1,hideLayerControl:!1,hideViewControl:!1,initialLocation:n.INITIAL_LOCATION.AUTO_FIT_TO_BOUNDS,autoFitToDataBounds:!0}},t=await h.create(e);if(t&&!Object(l.isErrorEmbeddable)(t)){const e=f?await f.createLayerDescriptors.createBasemapLayerDescriptor():null;e&&(p.current=[e],await t.setLayerList(p.current))}u(t)}()}),[]),Object(a.useEffect)((()=>{c&&!Object(l.isErrorEmbeddable)(c)&&void 0!==t&&c.updateInput(t)}),[c,t]),Object(a.useEffect)((()=>{c&&!Object(l.isErrorEmbeddable)(c)&&void 0!==r&&c.setRenderTooltipContent(r)}),[c,r]),Object(a.useEffect)((()=>{d.current&&c&&c.render(d.current)}),[c,d]),m?f?Object(s.jsx)("div",{"data-test-subj":"mlEmbeddedMapContent",className:"mlEmbeddedMapContent",ref:d}):(console.error("Maps start plugin not found"),null):(console.error("Embeddable start plugin not found"),null)}},608:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(609);case"v8light":return r(611)}},609:function(e,t,r){var a=r(86),i=r(610);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},610:function(e,t,r){(t=r(87)(!1)).push([e.i,".ml-explorer-chart-eui-icon-tip{max-width:none}.ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}.ml-reset-font-weight{font-weight:400}.ml-explorer-chart-container{overflow:hidden}.ml-explorer-chart-container .ml-explorer-chart-svg{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:12px}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect{fill:#1d1e24;opacity:1}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval{fill:#c8c8c81a;stroke:#98a2b3;stroke-width:2px;stroke-opacity:.8}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker{stroke-width:1px;stroke:#98a2b3;fill:#343741;pointer-events:none}.ml-explorer-chart-container .axis line,.ml-explorer-chart-container .axis path{fill:none;stroke:#343741;shape-rendering:crispEdges}.ml-explorer-chart-container .axis .tick line.ml-tick-emphasis{stroke:#0003}.ml-explorer-chart-container .axis text{fill:#98a2b3}.ml-explorer-chart-container .axis .tick line{stroke:#343741;stroke-width:1px}.ml-explorer-chart-container .values-line{fill:none;stroke:#36a2ef;stroke-width:2}.ml-explorer-chart-container .values-dots circle,.ml-explorer-chart-container .values-dots-circle{fill:#36a2ef;stroke-width:0}.ml-explorer-chart-container .values-dots circle.values-dots-circle-blur{fill:#535966}.ml-explorer-chart-container .metric-value{fill:#0000;stroke:#36a2ef;stroke-width:0;opacity:1}.ml-explorer-chart-container .anomaly-marker{stroke-width:1px;stroke:#535966}.ml-explorer-chart-container .anomaly-marker:hover{stroke-width:6px;stroke:#36a2ef}.ml-explorer-chart-container .anomaly-marker.critical{fill:#fe5050}.ml-explorer-chart-container .anomaly-marker.major{fill:#fba740}.ml-explorer-chart-container .anomaly-marker.minor{fill:#fdec25}.ml-explorer-chart-container .anomaly-marker.warning{fill:#8bc8fb}.ml-explorer-chart-container .anomaly-marker.low{fill:#d2e9f7}.ml-explorer-chart-container .anomaly-marker:hover,.ml-explorer-chart-container .metric-value:hover{stroke-width:6px;stroke-opacity:.65}.ml-explorer-chart{overflow:hidden}.ml-explorer-chart-content-wrapper{height:215px}.ml-explorer-chart-axis-emphasis{font-weight:700}",""]),e.exports=t},611:function(e,t,r){var a=r(86),i=r(612);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},612:function(e,t,r){(t=r(87)(!1)).push([e.i,".ml-explorer-chart-eui-icon-tip{max-width:none}.ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}.ml-reset-font-weight{font-weight:400}.ml-explorer-chart-container{overflow:hidden}.ml-explorer-chart-container .ml-explorer-chart-svg{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:12px}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect{fill:#fff;opacity:1}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval{fill:#c8c8c81a;stroke:#69707d;stroke-width:2px;stroke-opacity:.8}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker{stroke-width:1px;stroke:#69707d;fill:#d3dae6;pointer-events:none}.ml-explorer-chart-container .axis line,.ml-explorer-chart-container .axis path{fill:none;stroke:#d3dae6;shape-rendering:crispEdges}.ml-explorer-chart-container .axis .tick line.ml-tick-emphasis{stroke:#0003}.ml-explorer-chart-container .axis text{fill:#69707d}.ml-explorer-chart-container .axis .tick line{stroke:#d3dae6;stroke-width:1px}.ml-explorer-chart-container .values-line{fill:none;stroke:#07c;stroke-width:2}.ml-explorer-chart-container .values-dots circle,.ml-explorer-chart-container .values-dots-circle{fill:#07c;stroke-width:0}.ml-explorer-chart-container .values-dots circle.values-dots-circle-blur{fill:#98a2b3}.ml-explorer-chart-container .metric-value{fill:#0000;stroke:#07c;stroke-width:0;opacity:1}.ml-explorer-chart-container .anomaly-marker{stroke-width:1px;stroke:#98a2b3}.ml-explorer-chart-container .anomaly-marker:hover{stroke-width:6px;stroke:#07c}.ml-explorer-chart-container .anomaly-marker.critical{fill:#fe5050}.ml-explorer-chart-container .anomaly-marker.major{fill:#fba740}.ml-explorer-chart-container .anomaly-marker.minor{fill:#fdec25}.ml-explorer-chart-container .anomaly-marker.warning{fill:#8bc8fb}.ml-explorer-chart-container .anomaly-marker.low{fill:#d2e9f7}.ml-explorer-chart-container .anomaly-marker:hover,.ml-explorer-chart-container .metric-value:hover{stroke-width:6px;stroke-opacity:.65}.ml-explorer-chart{overflow:hidden}.ml-explorer-chart-content-wrapper{height:215px}.ml-explorer-chart-axis-emphasis{font-weight:700}",""]),e.exports=t},613:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(614);case"v8light":return r(616)}},614:function(e,t,r){var a=r(86),i=r(615);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},615:function(e,t,r){(t=r(87)(!1)).push([e.i,".ml-explorer-chart-eui-icon-tip{max-width:none}.ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}",""]),e.exports=t},616:function(e,t,r){var a=r(86),i=r(617);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},617:function(e,t,r){(t=r(87)(!1)).push([e.i,".ml-explorer-chart-eui-icon-tip{max-width:none}.ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}",""]),e.exports=t},618:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(619);case"v8light":return r(621)}},619:function(e,t,r){var a=r(86),i=r(620);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},620:function(e,t,r){(t=r(87)(!1)).push([e.i,".ml-explorer-chart-info-tooltip{max-width:384px}.ml-explorer-chart-description{font-size:12px;font-style:italic}.ml-explorer-chart-info-tooltip .mlDescriptionList>*{margin-top:4px}.ml-explorer-chart-info-tooltip .mlDescriptionList{display:grid;grid-template-columns:max-content auto}.ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__title{color:#fff;font-size:12px;font-weight:400;grid-column-start:1;white-space:nowrap}.ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__description{color:#fff;font-size:12px;font-weight:700;grid-column-start:2;max-width:256px;padding-left:8px}",""]),e.exports=t},621:function(e,t,r){var a=r(86),i=r(622);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},622:function(e,t,r){(t=r(87)(!1)).push([e.i,".ml-explorer-chart-info-tooltip{max-width:384px}.ml-explorer-chart-description{font-size:12px;font-style:italic}.ml-explorer-chart-info-tooltip .mlDescriptionList>*{margin-top:4px}.ml-explorer-chart-info-tooltip .mlDescriptionList{display:grid;grid-template-columns:max-content auto}.ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__title{color:#fff;font-size:12px;font-weight:400;grid-column-start:1;white-space:nowrap}.ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__description{color:#fff;font-size:12px;font-weight:700;grid-column-start:2;max-width:256px;padding-left:8px}",""]),e.exports=t},623:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(624);case"v8light":return r(626)}},624:function(e,t,r){var a=r(86),i=r(625);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},625:function(e,t,r){(t=r(87)(!1)).push([e.i,".filter-button{height:16px;opacity:.5;transform:translateY(-1px);width:16px}.filter-button .euiIcon{height:12px;width:12px}.filter-button:hover{opacity:1}",""]),e.exports=t},626:function(e,t,r){var a=r(86),i=r(627);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},627:function(e,t,r){(t=r(87)(!1)).push([e.i,".filter-button{height:16px;opacity:.5;transform:translateY(-1px);width:16px}.filter-button .euiIcon{height:12px;width:12px}.filter-button:hover{opacity:1}",""]),e.exports=t}}]);