/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[4,25,26],Array(84).concat([function(e,t,a){"use strict";a.d(t,"d",(function(){return d})),a.d(t,"c",(function(){return u})),a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return m})),a.d(t,"e",(function(){return b})),a.d(t,"f",(function(){return f}));var i=a(2),n=a(105),s=a(34),o=a(81),r=a(274);function l(){return new Promise(((e,t)=>{o.ml.checkMlCapabilities().then((t=>{!0===t.upgradeInProgress&&Object(r.b)(!0),e(t)})).catch((()=>{t()}))}))}let c=Object(s.d)();function d({checkMlCapabilities:e}){return new Promise(((t,a)=>{e().then((({capabilities:e,isPlatinumOrTrialLicense:i,mlFeatureEnabledInSpace:n})=>(c=e,!0===Object.values(c).every((e=>!0===e))&&!0===i?t({mlFeatureEnabledInSpace:n}):a({capabilities:e,isPlatinumOrTrialLicense:i,mlFeatureEnabledInSpace:n})))).catch((e=>a()))}))}function u(e){return new Promise(((t,a)=>{l().then((async({capabilities:i,isPlatinumOrTrialLicense:n})=>(c=i,c.canGetJobs||!1===n?t(c):(await e(),a())))).catch((async t=>(await e(),a())))}))}function p(e){return new Promise(((t,a)=>{l().then((async({capabilities:i,isPlatinumOrTrialLicense:n})=>(c=i,c.canCreateJob||!1===n?t(c):(await e(),a())))).catch((async t=>(await e(),a())))}))}function m(e){return new Promise(((t,a)=>{l().then((async({capabilities:i})=>(c=i,c.canFindFileStructure?t(c):(await e(),a())))).catch((async t=>(await e(),a())))}))}function b(e){const t=Object(n.c)();return!0===c[e]&&!0!==t}function f(e){let t="";return Object(n.c)()?t=i.i18n.translate("xpack.ml.privilege.licenseHasExpiredTooltip",{defaultMessage:"Your license has expired."}):"canCreateJob"===e?t=i.i18n.translate("xpack.ml.privilege.noPermission.createMLJobsTooltip",{defaultMessage:"You do not have permission to create Machine Learning jobs."}):"canStartStopDatafeed"===e?t=i.i18n.translate("xpack.ml.privilege.noPermission.startOrStopDatafeedsTooltip",{defaultMessage:"You do not have permission to start or stop datafeeds."}):"canUpdateJob"===e?t=i.i18n.translate("xpack.ml.privilege.noPermission.editJobsTooltip",{defaultMessage:"You do not have permission to edit jobs."}):"canDeleteJob"===e?t=i.i18n.translate("xpack.ml.privilege.noPermission.deleteJobsTooltip",{defaultMessage:"You do not have permission to delete jobs."}):"canCreateCalendar"===e?t=i.i18n.translate("xpack.ml.privilege.noPermission.createCalendarsTooltip",{defaultMessage:"You do not have permission to create calendars."}):"canDeleteCalendar"===e?t=i.i18n.translate("xpack.ml.privilege.noPermission.deleteCalendarsTooltip",{defaultMessage:"You do not have permission to delete calendars."}):"canForecastJob"===e&&(t=i.i18n.translate("xpack.ml.privilege.noPermission.runForecastsTooltip",{defaultMessage:"You do not have permission to run forecasts."})),i.i18n.translate("xpack.ml.privilege.pleaseContactAdministratorTooltip",{defaultMessage:"{message} Please contact your administrator.",values:{message:t}})}},,,,,function(e,t,a){"use strict";a.d(t,"b",(function(){return d})),a.d(t,"a",(function(){return u})),a(17);var i=a(50),n=a(44),s=a(264),o=a(102),r=a(96),l=a(273),c=a(13);const d=({context:e,children:t})=>null===e?Object(c.jsx)(n.EuiLoadingContent,{lines:10}):Object(c.jsx)(o.a.Provider,{value:e},t),u=({pageDeps:e})=>Object(c.jsx)(i.Router,{history:e.history},Object(c.jsx)(r.a,null,Object(c.jsx)(s.a,null,Object(c.jsx)(l.a,{pageDeps:e}))))},,,,,function(e,t,a){"use strict";var i=a(225);a.d(t,"a",(function(){return i.a}))},,,,function(e,t,a){var i;try{i={cloneDeep:a(477),constant:a(282),defaults:a(478),each:a(283),filter:a(287),find:a(479),flatten:a(483),forEach:a(284),forIn:a(484),has:a(298),isUndefined:a(301),last:a(485),map:a(302),mapValues:a(486),max:a(487),merge:a(489),min:a(500),minBy:a(501),now:a(502),pick:a(504),range:a(509),reduce:a(304),sortBy:a(510),uniqueId:a(516),values:a(309),zipObject:a(518)}}catch(e){}i||(i=window._),e.exports=i},function(e,t,a){"use strict";a.d(t,"g",(function(){return r})),a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return c})),a.d(t,"e",(function(){return d})),a.d(t,"f",(function(){return u})),a.d(t,"b",(function(){return p})),a.d(t,"a",(function(){return m}));var i=a(81);let n={anomaly_detectors:{},datafeeds:{}},s={};const o={cloudId:null,isCloud:!1,isCloudTrial:!1,deploymentId:null};async function r(){try{var e;const t=await i.ml.mlInfo();return n=t.defaults,s=t.limits,o.cloudId=null!==(e=t.cloudId)&&void 0!==e?e:null,o.isCloud=void 0!==t.cloudId,o.isCloudTrial=!0===t.isCloudTrial,o.deploymentId=t.cloudId?m(t.cloudId):null,{defaults:n,limits:s,cloudId:o}}catch(e){return{defaults:n,limits:s,cloudId:o}}}function l(){return n}function c(){return s}function d(){return o.isCloud}function u(){return o.isCloudTrial}function p(){return o.deploymentId}function m(e){const t=e.replace(/^(.+)?:/,"");try{const e=atob(t).match(/^.+\$(.+)(?=\$)/);return null!==e&&2===e.length?e[1]:null}catch(e){return null}}},,,,,,function(e,t,a){"use strict";var i=a(157);a.d(t,"a",(function(){return i.a})),a.d(t,"b",(function(){return i.b})),a.d(t,"c",(function(){return i.c})),a.d(t,"d",(function(){return i.d})),a.d(t,"e",(function(){return i.f}))},,function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var i=a(17),n=a.n(i),s=a(2),o=a(80);const r=n.a.memo((({docLink:e})=>{const{chrome:t}=Object(o.b)().services;return Object(i.useEffect)((()=>{t.setHelpExtension({appName:s.i18n.translate("xpack.ml.chrome.help.appName",{defaultMessage:"Machine Learning"}),links:[{href:e,linkType:"documentation"}]})}),[]),null}));r.displayName="HelpMenu"},function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"c",(function(){return l})),a.d(t,"e",(function(){return c})),a.d(t,"b",(function(){return d})),a.d(t,"d",(function(){return u})),a.d(t,"f",(function(){return p}));var i=a(81);let n=0,s=0,o=!1;async function r(e){try{const{count:e,lazyNodeCount:t}=await l();if(!(e>0||t>0))throw Error("Cannot load count of ML nodes");Promise.resolve()}catch(t){console.error(t),await e(),Promise.reject()}}async function l(){try{const e=await i.ml.mlNodeCount();return n=e.count,s=e.lazyNodeCount,o=!0,e}catch(e){return n=0,403===e.statusCode&&(o=!1),{count:0,lazyNodeCount:0}}}function c(){return 0!==n||0!==s}function d(){return 0!==n}function u(){return 0!==s}function p(){return o}},,,,,,,,,function(e,t,a){"use strict";var i=a(98),n=a(128).Graph;function s(e,t,a,n){var s;do{s=i.uniqueId(n)}while(e.hasNode(s));return a.dummy=t,e.setNode(s,a),s}function o(e){return i.max(i.map(e.nodes(),(function(t){var a=e.node(t).rank;if(!i.isUndefined(a))return a})))}e.exports={addDummyNode:s,simplify:function(e){var t=(new n).setGraph(e.graph());return i.forEach(e.nodes(),(function(a){t.setNode(a,e.node(a))})),i.forEach(e.edges(),(function(a){var i=t.edge(a.v,a.w)||{weight:0,minlen:1},n=e.edge(a);t.setEdge(a.v,a.w,{weight:i.weight+n.weight,minlen:Math.max(i.minlen,n.minlen)})})),t},asNonCompoundGraph:function(e){var t=new n({multigraph:e.isMultigraph()}).setGraph(e.graph());return i.forEach(e.nodes(),(function(a){e.children(a).length||t.setNode(a,e.node(a))})),i.forEach(e.edges(),(function(a){t.setEdge(a,e.edge(a))})),t},successorWeights:function(e){var t=i.map(e.nodes(),(function(t){var a={};return i.forEach(e.outEdges(t),(function(t){a[t.w]=(a[t.w]||0)+e.edge(t).weight})),a}));return i.zipObject(e.nodes(),t)},predecessorWeights:function(e){var t=i.map(e.nodes(),(function(t){var a={};return i.forEach(e.inEdges(t),(function(t){a[t.v]=(a[t.v]||0)+e.edge(t).weight})),a}));return i.zipObject(e.nodes(),t)},intersectRect:function(e,t){var a,i,n=e.x,s=e.y,o=t.x-n,r=t.y-s,l=e.width/2,c=e.height/2;if(!o&&!r)throw new Error("Not possible to find intersection inside of the rectangle");return Math.abs(r)*l>Math.abs(o)*c?(r<0&&(c=-c),a=c*o/r,i=c):(o<0&&(l=-l),a=l,i=l*r/o),{x:n+a,y:s+i}},buildLayerMatrix:function(e){var t=i.map(i.range(o(e)+1),(function(){return[]}));return i.forEach(e.nodes(),(function(a){var n=e.node(a),s=n.rank;i.isUndefined(s)||(t[s][n.order]=a)})),t},normalizeRanks:function(e){var t=i.min(i.map(e.nodes(),(function(t){return e.node(t).rank})));i.forEach(e.nodes(),(function(a){var n=e.node(a);i.has(n,"rank")&&(n.rank-=t)}))},removeEmptyRanks:function(e){var t=i.min(i.map(e.nodes(),(function(t){return e.node(t).rank}))),a=[];i.forEach(e.nodes(),(function(i){var n=e.node(i).rank-t;a[n]||(a[n]=[]),a[n].push(i)}));var n=0,s=e.graph().nodeRankFactor;i.forEach(a,(function(t,a){i.isUndefined(t)&&a%s!=0?--n:n&&i.forEach(t,(function(t){e.node(t).rank+=n}))}))},addBorderNode:function(e,t,a,i){var n={width:0,height:0};return arguments.length>=4&&(n.rank=a,n.order=i),s(e,"border",n,t)},maxRank:o,partition:function(e,t){var a={lhs:[],rhs:[]};return i.forEach(e,(function(e){t(e)?a.lhs.push(e):a.rhs.push(e)})),a},time:function(e,t){var a=i.now();try{return t()}finally{console.log(e+" time: "+(i.now()-a)+"ms")}},notime:function(e,t){return t()}}},,,,,function(e,t,a){(function(e){var i=a(174).format_value,n=t.schema={},s=t.properties={CALSCALE:{type:"TEXT"},METHOD:{type:"TEXT"},PRODID:{type:"TEXT"},VERSION:{type:"TEXT"},ATTACH:{type:"URI"},CATEGORIES:{type:"TEXT",list:!0},CLASS:{type:"TEXT"},COMMENT:{type:"TEXT"},DESCRIPTION:{type:"TEXT"},GEO:{type:"FLOAT",list:!0},LOCATION:{type:"TEXT"},"PERCENT-COMPLETE":{type:"INTEGER"},PRIORITY:{type:"INTEGER"},RESOURCES:{type:"TEXT"},STATUS:{type:"TEXT"},SUMMARY:{type:"TEXT"},COMPLETED:{type:"DATE-TIME"},DTEND:{type:"DATE-TIME"},DUE:{type:"DATE-TIME"},DTSTART:{type:"DATE-TIME"},DURATION:{type:"DURATION"},FREEBUSY:{type:"PERIOD"},TRANSP:{type:"TEXT"},TZID:{type:"TEXT"},TZNAME:{type:"TEXT"},TZOFFSETFROM:{type:"UTC-OFFSET"},TZOFFSETTO:{type:"UTC-OFFSET"},TZURL:{type:"URI"},ATTENDEE:{type:"CAL-ADDRESS"},CONTACT:{type:"TEXT"},ORGANIZER:{type:"CAL-ADDRESS"},"RECURRENCE-ID":{type:"DATE-TIME"},"RELATED-TO":{type:"TEXT"},URL:{type:"URI"},UID:{type:"TEXT"},EXDATE:{type:"DATE-TIME",list:!0},RDATE:{type:"DATE-TIME",list:!0},RRULE:{type:"RECUR"},ACTION:{type:"TEXT"},REPEAT:{type:"INTEGER"},TRIGGER:{type:"DURATION"},CREATED:{type:"DATE-TIME"},DTSTAMP:{type:"DATE-TIME"},"LAST-MODIFIED":{type:"DATE-TIME"},SEQUENCE:{type:"INTEGER"},"REQUEST-STATUS":{type:"TEXT"}},o=t.CalendarObject=function(e,t){this.calendar=e,this.element=t,this.components={},this.properties={}};o.create=function(e,t){var a=(n[e]||{}).factory;return void 0!==a?new a(t):new o(t,e)},o.prototype.clone=function(){var e=o.create(this.element,this.calendar);for(var t in this.properties)e.addProperties(this.properties[t]);for(var a=this.getComponents(),i=0;i<a.length;++i)e.addComponent(a[i]);return e},o.prototype.addProperties=function(e){e.forEach(this.addProperty.bind(this))},o.prototype.addProperty=function(e,t,a){if(e instanceof r)e=e.clone();else{if(void 0===t)return;e=new r(e,t,a)}return this.properties[e.name]=this.properties[e.name]||[],this.properties[e.name].push(e),e},o.prototype.setProperty=function(e,t,a){this.removeProperty(e instanceof r?e.name:e),this.addProperty(e,t,a)},o.prototype.addComponent=function(e){if(!(e instanceof o)){var t=(n[e]||{}).factory;e=void 0!==t?new t(this.calendar):new o(this.calendar,e)}return e.calendar&&e.calendar!==this.calendar&&(e=e.clone()),this.components[e.element]=this.components[e.element]||[],this.components[e.element].push(e),e.calendar=this.calendar,e},o.prototype.addComponents=function(e){e.forEach(this.addComponent.bind(this))},o.prototype.getComponents=function(e){if(void 0===e){var t=[];for(var a in this.components)t=t.concat(this.components[a]);return t}return this.components[e]||[]},o.prototype.getProperty=function(e,t){return(this.properties[e]||[])[t||0]},o.prototype.getProperties=function(e){return this.properties[e]||[]},o.prototype.getPropertyValue=function(e,t){return(this.getProperty(e,t)||{}).value},o.prototype.removeProperty=function(e){delete this.properties[e]},o.prototype.validate=function(){var e=this,t=n[e.element];for(var a in t&&t.required_properties&&t.required_properties.forEach((function(t){if(!e.getPropertyValue(t))throw new Error(t+" is a required property of "+e.element)})),e.components)e.components[a].forEach((function(e){e.validate()}))},o.prototype.toString=function(){var e;if("VCALENDAR"==this.element)e=this.format();else{var t=new(a(196).iCalendar);t.addComponent(this),e=t.format()}return e.push(""),e.join("\r\n")},o.prototype.format=function(){var e=["BEGIN:"+this.element];for(var t in this.properties)this.properties[t].forEach((function(t){e.push.apply(e,t.format())}));for(var a in this.components)for(a=this.components[a],t=0;t<a.length;++t)e.push.apply(e,a[t].format());return e.push("END:"+this.element),e};var r=t.CalendarProperty=function(e,t,a){var i=s[e];this.type=i&&i.type?i.type:"TEXT",this.name=e,this.value=t,this.parameters=a||{}};r.prototype.clone=function(){var e=new r(this.name,this.value);for(var t in e.type=this.type,this.parameters)e.parameters[t]=this.parameters[t];return e},r.prototype.getParameter=function(e){return this.parameters[e]},r.prototype.setParameter=function(e,t){this.parameters[e]=t},r.prototype.format=function(){var t=[];for(var a in this.parameters)t.push(a+"="+this.parameters[a]);t.length&&(t=";"+t.join(";"));for(var n,s=new e(this.name+t+":"+i(this.type,this.value,this.parameters)),o=0,r=[];;){for(o+(n=75)>=s.length&&(n=s.length-o);128==(192&s[o+n]);)n--;if(r.push(s.toString("utf8",o,o+n)),o+n>=s.length)break;s[o+=n-1]=32}return r}}).call(this,a(194).Buffer)},function(e,t,a){var i;try{i={clone:a(422),constant:a(282),each:a(283),filter:a(287),has:a(298),isArray:a(129),isEmpty:a(436),isFunction:a(236),isUndefined:a(301),keys:a(176),map:a(302),reduce:a(304),size:a(440),transform:a(446),union:a(449),values:a(309)}}catch(e){}i||(i=window._),e.exports=i},,,,,function(e,t,a){var i;try{i=a(420)}catch(e){}i||(i=window.graphlib),e.exports=i},function(e,t,a){e.exports=a(39)(258)},,,,function(e,t,a){"use strict";var i=a(108);a.d(t,"a",(function(){return i.c})),a.d(t,"c",(function(){return i.e})),a.d(t,"b",(function(){return i.d})),a.d(t,"d",(function(){return i.f}))},,function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return d})),a.d(t,"c",(function(){return u})),a.d(t,"e",(function(){return p})),a.d(t,"f",(function(){return m})),a.d(t,"d",(function(){return b}));var i=a(84),n=a(133),s=a(21),o=a(83),r=a(114),l=a(97);let c;!function(e){e.regression="100mb",e.outlier_detection="50mb",e.classification="100mb"}(c||(c={}));const d=0,u="--",p=()=>({advancedEditorMessages:[],advancedEditorRawString:"",disableSwitchToForm:!1,form:{alpha:void 0,computeFeatureInfluence:"true",createIndexPattern:!0,classAssignmentObjective:void 0,dependentVariable:"",description:"",destinationIndex:"",destinationIndexNameExists:!1,destinationIndexNameEmpty:!0,destinationIndexNameValid:!1,destinationIndexPatternTitleExists:!1,earlyStoppingEnabled:void 0,downsampleFactor:void 0,eta:void 0,etaGrowthRatePerTree:void 0,featureBagFraction:void 0,featureInfluenceThreshold:void 0,featureProcessors:void 0,gamma:void 0,includes:[],jobId:"",jobIdExists:!1,jobIdEmpty:!0,jobIdInvalidMaxLength:!1,jobIdValid:!1,jobType:void 0,jobConfigQuery:o.l,jobConfigQueryString:void 0,jobConfigQueryLanguage:void 0,lambda:void 0,lossFunction:void 0,lossFunctionParameter:void 0,loadingFieldOptions:!1,maxNumThreads:1,maxOptimizationRoundsPerHyperparameter:void 0,maxTrees:void 0,method:void 0,modelMemoryLimit:void 0,modelMemoryLimitUnitValid:!0,modelMemoryLimitValidationResult:null,nNeighbors:void 0,numTopFeatureImportanceValues:d,numTopFeatureImportanceValuesValid:!0,numTopClasses:-1,outlierFraction:void 0,predictionFieldName:void 0,previousJobType:null,requiredFieldsError:void 0,randomizeSeed:void 0,resultsField:void 0,runtimeMappings:void 0,runtimeMappingsUpdated:!1,previousRuntimeMapping:void 0,softTreeDepthLimit:void 0,softTreeDepthTolerance:void 0,sourceIndex:"",sourceIndexNameEmpty:!0,sourceIndexNameValid:!1,sourceIndexContainsNumericalFields:!0,sourceIndexFieldsCheckFailed:!1,standardizationEnabled:"true",trainingPercent:80,useEstimatedMml:!0},jobConfig:{},disabled:!Object(n.c)()||!Object(i.e)("canCreateDataFrameAnalytics")||!Object(i.e)("canStartStopDataFrameAnalytics"),indexPatternsMap:{},isAdvancedEditorEnabled:!1,isAdvancedEditorValidJson:!0,hasSwitchedToEditor:!1,isJobCreated:!1,isJobStarted:!1,isValid:!1,jobIds:[],requestMessages:[],estimatedModelMemoryLimit:""}),m=e=>{const t={description:e.description,source:{index:e.sourceIndex.includes(",")?e.sourceIndex.split(",").map((e=>e.trim())):e.sourceIndex,query:e.jobConfigQuery,...Object(s.b)(e.runtimeMappings)?{runtime_mappings:e.runtimeMappings}:{}},dest:{index:e.destinationIndex},analyzed_fields:{includes:e.includes},analysis:{outlier_detection:{}},model_memory_limit:e.modelMemoryLimit};void 0!==e.maxNumThreads&&(t.max_num_threads=e.maxNumThreads);const a="string"==typeof(null==e?void 0:e.resultsField)&&""===(null==e?void 0:e.resultsField.trim());if(t.dest&&!a&&(t.dest.results_field=e.resultsField),e.jobType===l.a.REGRESSION||e.jobType===l.a.CLASSIFICATION){let a={dependent_variable:e.dependentVariable,num_top_feature_importance_values:e.numTopFeatureImportanceValues,training_percent:e.trainingPercent};a=Object.assign(a,e.alpha&&{alpha:e.alpha},e.eta&&{eta:e.eta},e.etaGrowthRatePerTree&&{eta_growth_rate_per_tree:e.etaGrowthRatePerTree},e.downsampleFactor&&{downsample_factor:e.downsampleFactor},e.featureBagFraction&&{feature_bag_fraction:e.featureBagFraction},e.featureProcessors&&{feature_processors:e.featureProcessors},e.gamma&&{gamma:e.gamma},e.lambda&&{lambda:e.lambda},e.lossFunction&&{loss_function:e.lossFunction},e.lossFunctionParameter&&{loss_function_parameter:e.lossFunctionParameter},e.maxOptimizationRoundsPerHyperparameter&&{max_optimization_rounds_per_hyperparameter:e.maxOptimizationRoundsPerHyperparameter},e.maxTrees&&{max_trees:e.maxTrees},e.randomizeSeed&&{randomize_seed:e.randomizeSeed},void 0!==e.earlyStoppingEnabled&&{early_stopping_enabled:e.earlyStoppingEnabled},e.predictionFieldName&&{prediction_field_name:e.predictionFieldName},e.randomizeSeed&&{randomize_seed:e.randomizeSeed},e.softTreeDepthLimit&&{soft_tree_depth_limit:e.softTreeDepthLimit},e.softTreeDepthTolerance&&{soft_tree_depth_tolerance:e.softTreeDepthTolerance}),t.analysis={[e.jobType]:a}}if(void 0!==(null==t?void 0:t.analysis)&&Object(r.f)(null==t?void 0:t.analysis)&&(void 0!==e.numTopClasses&&(t.analysis.classification.num_top_classes=e.numTopClasses),void 0!==e.classAssignmentObjective&&(t.analysis.classification.class_assignment_objective=e.classAssignmentObjective)),e.jobType===l.a.OUTLIER_DETECTION){const a=Object.assign({},void 0!==e.computeFeatureInfluence&&{compute_feature_influence:e.computeFeatureInfluence},e.method&&{method:e.method},e.nNeighbors&&{n_neighbors:e.nNeighbors},e.outlierFraction&&{outlier_fraction:e.outlierFraction},e.featureInfluenceThreshold&&{feature_influence_threshold:e.featureInfluenceThreshold},void 0!==e.standardizationEnabled&&{standardization_enabled:e.standardizationEnabled});t.analysis.outlier_detection=a}return t};function b(e,t=!0){var a,i,n;const s=Object(o.m)(e.analysis),r={jobType:s,description:null!==(a=e.description)&&void 0!==a?a:"",resultsField:e.dest.results_field,sourceIndex:Array.isArray(e.source.index)?e.source.index.join(","):e.source.index,runtimeMappings:e.source.runtime_mappings,modelMemoryLimit:e.model_memory_limit,maxNumThreads:e.max_num_threads,includes:Array.isArray(null===(i=e.analyzed_fields)||void 0===i?void 0:i.includes)?null===(n=e.analyzed_fields)||void 0===n?void 0:n.includes:[],jobConfigQuery:e.source.query||o.l};var l;!1===t&&(r.destinationIndex=null!==(l=null==e?void 0:e.dest.index)&&void 0!==l?l:"");const c=e.analysis[s];for(const e in c)c.hasOwnProperty(e)&&(r[e.replace(/_([a-z])/g,(function(e){return e[1].toUpperCase()}))]=c[e]);return r}},,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var i=a(90),n=a.n(i),s=a(23),o=a(25),r=a(17),l=a(154),c=a(170),d=a(80);const u=()=>{const e=Object(d.g)(),t=()=>{const{from:t,to:a}=e.getTime();return{start:t,end:a}},a=Object(r.useMemo)((()=>Object(s.merge)(c.a,e.getTimeUpdate$().pipe(Object(o.map)((()=>({lastRefresh:Date.now(),timeRange:t()})))),l.b.pipe(Object(o.map)((e=>({lastRefresh:e})))))),[]);return n()(a)}},function(e,t,a){var i=a(427),n=a(430),s=a(178),o=a(129),r=a(433);e.exports=function(e){return"function"==typeof e?e:null==e?s:"object"==typeof e?o(e)?n(e[0],e[1]):i(e):r(e)}},function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return r})),a(17);var i=a(339),n=a(60),s=a(13);const{expandLiteralStrings:o}=n.XJson,r={TEXT:"text",JSON:"json",XJSON:new i.a},l=({value:e,height:t="500px",width:a="100%",mode:i=r.JSON,readOnly:l=!1,syntaxChecking:c=!0,theme:d="textmate",onChange:u=(()=>{}),"data-test-subj":p})=>{if(i===r.XJSON)try{e=o(e)}catch(e){console.error(e)}return Object(s.jsx)(n.EuiCodeEditor,{value:e,width:a,height:t,mode:i,readOnly:l,wrapEnabled:!0,showPrintMargin:!1,theme:d,editorProps:{$blockScrolling:!0},setOptions:{useWorker:c,tabSize:2,useSoftTabs:!0},onChange:u,"data-test-subj":p})}},,,function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return r}));var i=a(2),n=a(29),s=a(99);function o(e,t,a,o){const l=Object(s.d)();if(e.contains("job_id_empty"))t.jobId.valid=!1;else if(e.contains("job_id_invalid")){t.jobId.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAllowedCharactersDescription",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.jobId.message=e}else if(e.contains("job_id_invalid_max_length"))t.jobId.valid=!1,t.jobId.message=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:n.b}});else if(e.contains("job_id_already_exists")){t.jobId.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."});t.jobId.message=e}if(e.contains("job_group_id_invalid")){t.groupIds.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupAllowedCharactersDescription",{defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.groupIds.message=e}else if(e.contains("job_group_id_invalid_max_length"))t.groupIds.valid=!1,t.groupIds.message=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupMaxLengthDescription",{defaultMessage:"Job group name must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:n.b}});else if(e.contains("job_group_id_already_exists")){t.groupIds.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.groupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing job or group."});t.groupIds.message=e}if(e.contains("model_memory_limit_units_invalid")){t.modelMemoryLimit.valid=!1;const e=`${n.a.slice(0,n.a.length-1).join(", ")} or ${[...n.a].pop()}`,a=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitUnitsInvalidErrorMessage",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:e}});t.modelMemoryLimit.message=a}if(e.contains("model_memory_limit_invalid")){t.modelMemoryLimit.valid=!1;const e=(l.max_model_memory_limit||"").toUpperCase(),a=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitRangeInvalidErrorMessage",{defaultMessage:"Model memory limit cannot be higher than the maximum value of {maxModelMemoryLimit}",values:{maxModelMemoryLimit:e}});t.modelMemoryLimit.message=a}if(e.contains("detectors_duplicates")){t.duplicateDetectors.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.duplicatedDetectorsErrorMessage",{defaultMessage:"Duplicate detectors were found."});t.duplicateDetectors.message=e}if(e.contains("categorizer_detector_missing_per_partition_field")){t.categorizerMissingPerPartition.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerMissingPerPartitionFieldMessage",{defaultMessage:'Partition field must be set for detectors that reference "mlcategory" when per-partition categorization is enabled.'});t.categorizerMissingPerPartition.message=e}if(e.contains("categorizer_varying_per_partition_fields")){t.categorizerVaryingPerPartitionField.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerVaryingPerPartitionFieldNamesMessage",{defaultMessage:'Detectors with keyword "mlcategory" cannot have different partition_field_name when per-partition categorization is enabled.'});t.categorizerVaryingPerPartitionField.message=e}if(e.contains("bucket_span_empty")){t.bucketSpan.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.bucketSpanMustBeSetErrorMessage",{defaultMessage:"Bucket span must be set"});t.bucketSpan.message=e}else e.contains("bucket_span_invalid")&&(t.bucketSpan.valid=!1,t.bucketSpan.message=r(a.analysis_config.bucket_span));if(e.contains("query_empty")){t.query.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryCannotBeEmpty",{defaultMessage:"Datafeed query cannot be empty."});t.query.message=e}else if(e.contains("query_invalid")){t.query.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryIsInvalidEsQuery",{defaultMessage:"Datafeed query must be a valid elasticsearch query."});t.query.message=e}e.contains("query_delay_invalid")&&(t.queryDelay.valid=!1,t.queryDelay.message=r(o.query_delay)),e.contains("frequency_invalid")&&(t.frequency.valid=!1,t.frequency.message=r(o.frequency)),e.contains("missing_summary_count_field_name")&&(t.summaryCountField.valid=!1,t.summaryCountField.message=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.summaryCountFieldMissing",{defaultMessage:"Required field as the datafeed uses aggregations."}))}function r(e){return i.i18n.translate("xpack.ml.newJob.wizard.validateJob.frequencyInvalidTimeIntervalFormatErrorMessage",{defaultMessage:"{value} is not a valid time interval format e.g. {thirtySeconds}, {tenMinutes}, {oneHour}, {sevenDays}. It also needs to be higher than zero.",values:{value:e,thirtySeconds:"30s",tenMinutes:"10m",oneHour:"1h",sevenDays:"7d"}})}},,,,,,function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"b",(function(){return n})),a.d(t,"e",(function(){return s})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return r})),a.d(t,"f",(function(){return l})),a.d(t,"g",(function(){return c})),a.d(t,"h",(function(){return d}));const i="ml.singleMetricViewer.partitionFields",n="ml.jobSelectorFlyout.applyTimeRange",s="ml.gettingStarted.isDismissed",o="ml.frozenDataTierPreference",r="ml.anomalyExplorerPanels",l="ml.notificationsLastCheckedAt",c=[i,n,s,o,r,l];function d(e){return"string"==typeof e&&c.includes(e)}},,function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return l})),a.d(t,"a",(function(){return AnnotationUpdatesService}));var i=a(5),n=a.n(i),s=a(23),o=a(25);new s.BehaviorSubject(null);const r=new s.BehaviorSubject(Date.now()),l=()=>r.next(Date.now());class AnnotationUpdatesService{constructor(){n()(this,"_annotation$",new s.BehaviorSubject(null))}update$(){return this._annotation$.asObservable()}isAnnotationInitialized$(){return this._annotation$.asObservable().pipe(Object(o.distinctUntilChanged)(((e,t)=>null!==e&&null!==t)))}setValue(e){this._annotation$.next(e)}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var i=a(44),n=a(45),s=a(17),o=a.n(s),r=a(13);const l=({jobsCount:e,action:t,message:a})=>Object(r.jsx)(o.a.Fragment,null,Object(r.jsx)(i.EuiSpacer,{size:"s"}),Object(r.jsx)(i.EuiCallOut,{color:"warning"},null!=a?a:Object(r.jsx)(n.FormattedMessage,{id:"xpack.ml.managedJobsWarningCallout",defaultMessage:"{jobsCount, plural, one {This job} other {At least one of these jobs}} is preconfigured by Elastic; {action} {jobsCount, plural, one {it} other {them}} might impact other parts of the product.",values:{jobsCount:e,action:t}})))},function(e,t,a){e.exports=a(39)(8)},function(e,t,a){"use strict";a.d(t,"f",(function(){return b})),a.d(t,"b",(function(){return f})),a.d(t,"a",(function(){return h})),a.d(t,"c",(function(){return g})),a.d(t,"d",(function(){return j})),a.d(t,"e",(function(){return x}));var i=a(0),n=a(16),s=(a(17),a(2)),o=a(44),r=a(46),l=a(27),c=a(13);let d;function u(){if(void 0===d){const e=s.i18n.translate("xpack.ml.checkLicense.licenseHasExpiredMessage",{defaultMessage:"Your Machine Learning license has expired."}),t=Object(l.h)(),a=Object(l.l)();d=t.banners.add(Object(r.toMountPoint)(Object(r.wrapWithTheme)(Object(c.jsx)(o.EuiCallOut,{iconType:"iInCircle",color:"warning",title:e}),a.theme$)))}}var p=a(4);class ml_client_license_MlClientLicense extends n.a{constructor(e){super(),this.application=e}redirectToKibana(){return this.application.navigateToApp("home"),Promise.reject()}redirectToBasic(){return this.application.navigateToApp(p.e,{path:i.b.DATA_VISUALIZER}),Promise.reject()}fullLicenseResolver(){return!1===this.isMlEnabled()||!1===this.isMinimumLicense()?this.redirectToKibana():!1===this.isFullLicense()?this.redirectToBasic():(this.hasLicenseExpired()&&u(),Promise.resolve())}basicLicenseResolver(){return!1===this.isMlEnabled()||!1===this.isMinimumLicense()?this.redirectToKibana():(this.hasLicenseExpired()&&u(),Promise.resolve())}}let m=null;function b(e,t,a){return m=new ml_client_license_MlClientLicense(t),m.setup(e.license$,a),m}async function f(){return null===m?(console.error("ML Licensing not initialized"),Promise.reject()):m.fullLicenseResolver()}async function h(){return null===m?(console.error("ML Licensing not initialized"),Promise.reject()):m.basicLicenseResolver()}function g(){return null!==m&&m.hasLicenseExpired()}function j(){return null!==m&&m.isFullLicense()}function x(){return null!==m&&m.isTrialLicense()}},function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return p}));var i=a(17),n=a.n(i),s=a(8),o=a(116),r=a(80),l=a(152),c=a(13);const d=n.a.createContext({value:null,setValue(){throw new Error("MlStorageContext set method is not implemented")},removeValue(){throw new Error("MlStorageContext remove method is not implemented")}}),u=({children:e})=>{const{services:{storage:t}}=Object(r.b)(),a=Object(i.useMemo)((()=>l.g.reduce(((e,a)=>(e[a]=t.get(a),e)),{})),[t]),[n,u]=Object(i.useState)(a),p=Object(i.useCallback)(((e,a)=>{t.set(e,a),u((t=>({...t,[e]:a})))}),[t]),m=Object(i.useCallback)((e=>{t.remove(e),u((t=>Object(s.omit)(t,e)))}),[t]);Object(i.useEffect)((function(){const e=e=>{Object(l.h)(e.key)&&(Object(o.a)(e.newValue)?u((t=>({...t,[e.key]:"string"==typeof e.newValue?JSON.parse(e.newValue):e.newValue}))):u((t=>Object(s.omit)(t,e.key))))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}),[]);const b=Object(i.useMemo)((()=>({value:n,setValue:p,removeValue:m})),[n,p,m]);return Object(c.jsx)(d.Provider,{value:b},e)};function p(e,t){const{value:a,setValue:n,removeValue:s}=Object(i.useContext)(d);return[Object(i.useMemo)((()=>{var i;return null!==(i=null==a?void 0:a[e])&&void 0!==i?i:t}),[a,e,t]),Object(i.useCallback)((t=>{Object(o.a)(t)?n(e,t):s(e)}),[n,s,e])]}},function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var i=a(17),n=a.n(i),s=a(44),o=a(45),r=a(80),l=a(344),c=a(84),d=a(13);const u=({mlSavedObjectType:e,onCloseFlyout:t,forceRefresh:a})=>{const{savedObjects:{syncCheck:u}}=Object(r.a)(),p=Object(i.useRef)(!1),[m,b]=Object(i.useState)(!1),[f,h]=Object(i.useState)(!1),g=Object(i.useMemo)((()=>Object(c.e)("canCreateJob")),[]),j=Object(i.useCallback)((async()=>{try{if(!1===p.current)return;const{result:t}=await u(e);!0===p.current&&b(f||t)}catch(e){console.log("Saved object synchronization check could not be performed.")}}),[f,b]);Object(i.useEffect)((function(){return p.current=!0,void 0!==a&&!0!==a||j(),()=>{p.current=!1}}),[a,p,j]);const x=Object(i.useCallback)((()=>{h(!1),void 0===a&&j(),"function"==typeof t&&t()}),[j,t,h]);return Object(i.useEffect)((function(){!1===m&&!0===p.current&&h(!1)}),[m,h]),!1===m?null:Object(d.jsx)(n.a.Fragment,null,Object(d.jsx)(s.EuiCallOut,{title:Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.title",defaultMessage:"ML job and trained model synchronization required"}),color:"warning",iconType:"alert","data-test-subj":"mlJobSyncRequiredWarning"},Object(d.jsx)(n.a.Fragment,null,Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.description",defaultMessage:"Some jobs or trained models are missing or have incomplete saved objects. "}),g?Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.link",defaultMessage:" {link}",values:{link:Object(d.jsx)(s.EuiLink,{onClick:h.bind(null,!0)},Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.linkToManagement.link",defaultMessage:"Synchronize your jobs and trained models."}))}}):Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.noPermission",defaultMessage:"An Administrator can synchronize the jobs and trained models in Stack Management."}),f&&Object(d.jsx)(l.a,{onClose:x}))),Object(d.jsx)(s.EuiSpacer,{size:"m"}))}},,function(e,t,a){"use strict";a.d(t,"d",(function(){return g})),a.d(t,"c",(function(){return j})),a.d(t,"b",(function(){return x})),a.d(t,"e",(function(){return v})),a.d(t,"a",(function(){return y}));var i=a(44),n=a(17),s=a.n(n),o=a(8),r=a(2),l=a(45),c=a(46),d=a(92),u=a(83),p=a(97),m=a(80),b=a(348),f=a(26),h=a(13);function g(e,t=(e=>({allow_lazy_start:{optional:!0,defaultValue:!1},description:{optional:!0,formKey:"description"},analysis:{...Object(u.v)(e.analysis)?{classification:{dependent_variable:{optional:!1,formKey:"dependentVariable"},training_percent:{optional:!0,formKey:"trainingPercent"},eta:{optional:!0,formKey:"eta"},feature_bag_fraction:{optional:!0,formKey:"featureBagFraction"},max_trees:{optional:!0,formKey:"maxTrees"},gamma:{optional:!0,formKey:"gamma"},lambda:{optional:!0,formKey:"lambda"},num_top_classes:{optional:!0,defaultValue:2,formKey:"numTopClasses"},prediction_field_name:{optional:!0,defaultValue:`${e.analysis.classification.dependent_variable}_prediction`,formKey:"predictionFieldName"},randomize_seed:{optional:!0,ignore:!0,formKey:"randomizeSeed"},num_top_feature_importance_values:{optional:!0,defaultValue:b.a,formKey:"numTopFeatureImportanceValues"},class_assignment_objective:{optional:!0,defaultValue:"maximize_minimum_recall"},early_stopping_enabled:{optional:!0,ignore:!0},alpha:{optional:!0,formKey:"alpha"},downsample_factor:{optional:!0,formKey:"downsampleFactor"},eta_growth_rate_per_tree:{optional:!0,formKey:"etaGrowthRatePerTree"},feature_processors:{optional:!0},max_optimization_rounds_per_hyperparameter:{optional:!0,formKey:"maxOptimizationRoundsPerHyperparameter"},soft_tree_depth_limit:{optional:!0,formKey:"softTreeDepthLimit"},soft_tree_depth_tolerance:{optional:!0,formKey:"softTreeDepthTolerance"}}}:{},...Object(d.s)(e.analysis)?{outlier_detection:{standardization_enabled:{defaultValue:!0,optional:!0,formKey:"standardizationEnabled"},compute_feature_influence:{defaultValue:!0,optional:!0,formKey:"computeFeatureInfluence"},outlier_fraction:{defaultValue:.05,optional:!0,formKey:"outlierFraction"},feature_influence_threshold:{optional:!0,formKey:"featureInfluenceThreshold"},method:{optional:!0,formKey:"method"},n_neighbors:{optional:!0,formKey:"nNeighbors"}}}:{},...Object(u.y)(e.analysis)?{regression:{dependent_variable:{optional:!1,formKey:"dependentVariable"},training_percent:{optional:!0,formKey:"trainingPercent"},eta:{optional:!0,formKey:"eta"},feature_bag_fraction:{optional:!0,formKey:"featureBagFraction"},max_trees:{optional:!0,formKey:"maxTrees"},gamma:{optional:!0,formKey:"gamma"},lambda:{optional:!0,formKey:"lambda"},prediction_field_name:{optional:!0,defaultValue:`${e.analysis.regression.dependent_variable}_prediction`,formKey:"predictionFieldName"},num_top_feature_importance_values:{optional:!0,defaultValue:b.a,formKey:"numTopFeatureImportanceValues"},randomize_seed:{optional:!0,ignore:!0,formKey:"randomizeSeed"},loss_function:{optional:!0,defaultValue:"mse"},loss_function_parameter:{optional:!0},feature_processors:{optional:!0},early_stopping_enabled:{optional:!0,ignore:!0},alpha:{optional:!0,formKey:"alpha"},downsample_factor:{optional:!0,formKey:"downsampleFactor"},eta_growth_rate_per_tree:{optional:!0,formKey:"etaGrowthRatePerTree"},max_optimization_rounds_per_hyperparameter:{optional:!0,formKey:"maxOptimizationRoundsPerHyperparameter"},soft_tree_depth_limit:{optional:!0,formKey:"softTreeDepthLimit"},soft_tree_depth_tolerance:{optional:!0,formKey:"softTreeDepthTolerance"}}}:{}},analyzed_fields:{excludes:{optional:!0,defaultValue:[]},includes:{optional:!0,formKey:"includes",defaultValue:[]}},source:{index:{formKey:"sourceIndex",optional:!1},query:{optional:!0,defaultValue:{match_all:{}}},runtime_mappings:{optional:!0,formKey:"runtimeMappings",defaultValue:void 0},_source:{optional:!0}},dest:{index:{optional:!1,formKey:"destinationIndex"},results_field:{optional:!0,formKey:"resultsField",defaultValue:p.d}},model_memory_limit:{optional:!0,formKey:"modelMemoryLimit"},max_num_threads:{optional:!0,formKey:"maxNumThreads"}}))(e)){for(const a in e)if(e.hasOwnProperty(a)){const i=e[a],n=t[a];if(!n)return console.info(`Property "${a}" is unknown.`),!0;if(n.hasOwnProperty("optional")){if(void 0===n.formKey&&!0!==n.ignore&&!Object(o.isEqual)(n.defaultValue,i))return console.info(`Property "${a}" is not supported by the form or has a different value to the default.`),!0}else if(g(i,n))return!0}return!1}function j({id:e,...t}){return Object(o.cloneDeep)({...t,dest:{...t.dest,index:""}})}const x=r.i18n.translate("xpack.ml.dataframe.analyticsList.cloneActionNameText",{defaultMessage:"Clone"}),v=()=>{const{services:{notifications:{toasts:e},data:{dataViews:t},http:{basePath:a},application:{capabilities:n},theme:o}}=Object(m.b)(),d=o.theme$,u=Object(m.e)(),p=!0===n.savedObjectsManagement.edit||!0===n.indexPatterns.save;return async n=>{const o=Array.isArray(n.config.source.index)?n.config.source.index.join(","):n.config.source.index;let m;try{const n=(await t.find(o)).find((({title:e})=>e===o));void 0!==n?m=n.id:e.addDanger({title:Object(c.toMountPoint)(Object(c.wrapWithTheme)(Object(h.jsx)(s.a.Fragment,null,Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.dataframe.analyticsList.noSourceDataViewForClone",defaultMessage:"Unable to clone the analytics job. No data view exists for index {sourceIndex}.",values:{sourceIndex:o}}),p?Object(h.jsx)(i.EuiText,{size:"xs",color:"text"},Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.dataframe.analytics.cloneAction.dataViewPromptLink",defaultMessage:"{linkToDataViewManagement}",values:{linkToDataViewManagement:Object(h.jsx)(i.EuiLink,{href:`${a.get()}/app/management/kibana/dataViews/create`,target:"_blank"},Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.dataframe.analytics.cloneAction.dataViewPromptLinkText",defaultMessage:"Create a data view for {sourceIndex}",values:{sourceIndex:o}}))}})):null),d))})}catch(t){const a=Object(f.b)(t);e.addDanger(r.i18n.translate("xpack.ml.dataframe.analyticsList.fetchSourceDataViewForCloneErrorMessage",{defaultMessage:"An error occurred checking if data view {dataView} exists: {error}",values:{dataView:o,error:a}}))}m&&await u(`/data_frame_analytics/new_job?index=${encodeURIComponent(m)}&jobId=${n.config.id}`)}},y=({isDisabled:e})=>e?Object(h.jsx)(i.EuiToolTip,{position:"top",content:r.i18n.translate("xpack.ml.dataframe.analyticsList.cloneActionPermissionTooltip",{defaultMessage:"You do not have permission to clone analytics jobs."})},Object(h.jsx)(s.a.Fragment,null,x)):Object(h.jsx)(s.a.Fragment,null,x)},function(e,t,a){e.exports=a(39)(1141)},,,function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a(17);var i=a(44),n=a(13);const s=()=>Object(n.jsx)(i.EuiText,{textAlign:"center"},Object(n.jsx)(i.EuiSpacer,{size:"l"}),Object(n.jsx)(i.EuiLoadingSpinner,{size:"l"}),Object(n.jsx)(i.EuiSpacer,{size:"l"}))},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(54),n=a(17),s=i.__importDefault(a(251));t.default=function(e,t,a){void 0===t&&(t=0),void 0===a&&(a=[]);var i=s.default(e,t),o=i[0],r=i[1],l=i[2];return n.useEffect(l,a),[o,r]}},function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return d}));var i=a(17),n=a.n(i),s=a(44),o=a(45),r=a(133),l=a(13);const c=({jobCount:e})=>!1===Object(r.b)()||0===e?null:Object(l.jsx)(n.a.Fragment,null,Object(l.jsx)(s.EuiCallOut,{title:Object(l.jsx)(o.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},Object(l.jsx)("div",null,Object(l.jsx)(o.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"There {jobCount, plural, one {is} other {are}} {jobCount, plural, one {# job} other {# jobs}} waiting for machine learning nodes to start.",values:{jobCount:e}}))),Object(l.jsx)(s.EuiSpacer,{size:"m"})),d=()=>!1===Object(r.b)()?null:Object(l.jsx)(n.a.Fragment,null,Object(l.jsx)(s.EuiCallOut,{title:Object(l.jsx)(o.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},Object(l.jsx)("div",null,Object(l.jsx)(o.FormattedMessage,{id:"xpack.ml.newJobAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"There are currently no nodes that can run the job, therefore it will remain in OPENING state until an appropriate node becomes available."}))),Object(l.jsx)(s.EuiSpacer,{size:"m"}));a(36)},function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a(17);var i=a(13);const n=({stat:e})=>Object(i.jsx)("span",{className:"stat"},Object(i.jsx)("span",null,e.label),":"," ",Object(i.jsx)("strong",{"data-test-subj":e["data-test-subj"]},e.value)),s=({stats:e,dataTestSub:t})=>{const a=Object.keys(e).map((t=>e[t]));return Object(i.jsx)("div",{className:"mlStatsBar","data-test-subj":t},a.filter((e=>e.show)).map((e=>Object(i.jsx)(n,{key:e.label,stat:e}))))}},,function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));const i=new(a(23).Subject)},,,,function(e,t,a){(function(e){var i=a(195).RRule;function n(e,t){t=t||2;var a=e<0;return a&&(e*=-1),e=e.toString(),(a?"-":"")+"000000000000000000".substr(0,t-e.length)+e}var s={BINARY:{format:function(e){return e.toString("base64")},parse:function(t){return new e(t,"base64")}},BOOLEAN:{format:function(e){return e?"TRUE":"FALSE"},parse:function(e){return"TRUE"==e.toUpperCase()}},"CAL-ADDRESS":{format:function(e){var t=e.toString();return 0!=t.lastIndexOf("mailto:")&&(t="mailto:"+t),t}},DATE:{format:function(e){return e instanceof Date||(e=new Date(e)),e.getFullYear()+n(e.getMonth()+1)+n(e.getDate())},parse:function(e){var t=new Date(parseInt(e.substr(0,4),10),parseInt(e.substr(4,2),10)-1,parseInt(e.substr(6,2),10),0,0,0);return t.date_only=!0,t}},"DATE-TIME":{format:function(e,t){return e instanceof Date||(e=new Date(e)),e.date_only||"DATE"===t.VALUE?o("DATE",e):e.getUTCFullYear()+n(e.getUTCMonth()+1)+n(e.getUTCDate())+"T"+o("TIME",e)},parse:function(e,t,a){if("DATE"===t.VALUE||e.length<=8)return s.DATE.parse(e);var i=t.TZID,n=[parseInt(e.substr(0,4),10),parseInt(e.substr(4,2),10),parseInt(e.substr(6,2),10),parseInt(e.substr(9,2),10),parseInt(e.substr(11,2),10),parseInt(e.substr(13,2),10)],o=e.length>15&&"Z"===e[15];if(void 0!==i){var r=a.timezone(i);if(!r)throw new Error("Unable to load TZ data for "+i);return r.fromLocalTime(n)}return n[1]-=1,o?new Date(Date.UTC.apply(null,n)):new Date(n[0],n[1],n[2],n[3],n[4],n[5])}},DURATION:{format:function(e){var t=e<0;t&&(e*=-1);var a=Math.floor(e/604800);e-=60*a*60*24*7;var i=Math.floor(e/86400);e-=60*i*60*24;var n=Math.floor(e/3600);e-=60*n*60;var s=Math.floor(e/60),o=e-=60*s,r=["P"];return t&&r.unshift("-"),a&&r.push(a+"W"),i&&r.push(i+"D"),(n||s||o)&&r.push("T"),n&&r.push(n+"H"),s&&r.push(s+"M"),o&&r.push(o+"S"),r.join("")},parse:function(e){for(var t=/(-)?P(\d+W)?(\d+D)?(?:T(\d+H)?(\d+M)?(\d+S)?)?/.exec(e).slice(1),a=[-1,604800,86400,3600,60,1],i=0,n=1;n<t.length;++n)void 0!==t[n]&&(i+=parseInt(t[n],10)*a[n]);return void 0!==t[0]&&(i*=a[0]),i}},FLOAT:{format:function(e){return e.toString()}},INTEGER:{format:function(e){return e.toString()}},PERIOD:{format:function(e){return o("DATE-TIME",e[0])+"/"+o(e[1]instanceof Date?"DATE-TIME":"DURATION",e[1])}},RECUR:{format:function(e){return(e instanceof i?e:new i(e)).toString()},parse:function(e){return i.parse(e)}},TEXT:{format:function(e){return(e||"").toString().replace(/([\\,;])/g,"\\$1").replace(/\n/g,"\\n")},parse:function(e){return e.replace(/\\([\\,;])/g,"$1").replace(/\\[nN]/g,"\n")}},TIME:{format:function(e){return e instanceof Date||(e=new Date(e)),n(e.getUTCHours())+n(e.getUTCMinutes())+n(e.getUTCSeconds())+"Z"},parse:function(e){return e.length>6&&"Z"===e[6]?new Date(Date.UTC(0,0,0,parseInt(e.substr(0,2),10),parseInt(e.substr(2,2),10),parseInt(e.substr(4,2),10))):new Date(0,0,0,parseInt(e.substr(0,2),10),parseInt(e.substr(2,2),10),parseInt(e.substr(4,2),10))}},URI:{format:function(e){return e.toString()}},"UTC-OFFSET":{format:function(e){var t=e<0;return t&&(e*=-1),(t?"-":"+")+n(e,4)}}},o=t.format_value=function(e,t,a){if(void 0===t)return"";var i=s[e||"TEXT"];if(void 0===i)throw Error("Invalid iCalendar datatype: "+e);return Array.isArray(t)&&"PERIOD"!==e||"PERIOD"===e&&t[0]&&Array.isArray(t[0])?t.map((function(e){return i.format(e,a||{})})).join(","):i.format(t,a||{})},r=t.parse_value=function(e,t,a,i,n){if(n)return t.split(",").map((function(t){return r(e,t,a,i)}));var o=s[e||"TEXT"];if(void 0===o)throw Error("Invalid iCalendar datatype: "+e);var l=(a=a||{}).VALUE&&s[a.VALUE];return l&&(o=l),o.parse?o.parse(t,a,i):t}}).call(this,a(194).Buffer)},function(e,t,a){e.exports=a(39)(2733)},function(e,t,a){e.exports=a(39)(1136)},function(e,t,a){e.exports=a(39)(336)},function(e,t,a){e.exports=a(39)(1542)},,,function(e,t,a){"use strict";a.d(t,"d",(function(){return i.a})),a.d(t,"b",(function(){return c})),a.d(t,"c",(function(){return d})),a.d(t,"a",(function(){return u})),a.d(t,"e",(function(){return p})),a.d(t,"f",(function(){return b}));var i=a(169),n=a(2),s=a(26),o=a(81),r=a(92),l=a(115);const c=async(e,t,a)=>{try{Object(l.f)(t.state)&&await o.ml.dataFrameAnalytics.stopDataFrameAnalytics(e.id,!0),await o.ml.dataFrameAnalytics.deleteDataFrameAnalytics(e.id),a.displaySuccessToast(n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsSuccessMessage",{defaultMessage:"Request to delete data frame analytics job {analyticsId} acknowledged.",values:{analyticsId:e.id}}))}catch(t){a.displayErrorToast(t,n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsErrorMessage",{defaultMessage:"An error occurred deleting the data frame analytics job {analyticsId}",values:{analyticsId:e.id}}))}r.v.next(r.e.REFRESH)},d=async(e,t,a,i,c)=>{const d=Array.isArray(e.dest.index)?e.dest.index[0]:e.dest.index;try{var u,p,m,b,f,h;Object(l.f)(t.state)&&await o.ml.dataFrameAnalytics.stopDataFrameAnalytics(e.id,!0);const r=await o.ml.dataFrameAnalytics.deleteDataFrameAnalyticsAndDestIndex(e.id,a,i);if(null!==(u=r.analyticsJobDeleted)&&void 0!==u&&u.success&&c.displaySuccessToast(n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsSuccessMessage",{defaultMessage:"Request to delete data frame analytics job {analyticsId} acknowledged.",values:{analyticsId:e.id}})),null!==(p=r.analyticsJobDeleted)&&void 0!==p&&p.error&&c.displayErrorToast(r.analyticsJobDeleted.error,n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsErrorMessage",{defaultMessage:"An error occurred deleting the data frame analytics job {analyticsId}",values:{analyticsId:e.id}})),null!==(m=r.destIndexDeleted)&&void 0!==m&&m.success&&c.displaySuccessToast(n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsWithIndexSuccessMessage",{defaultMessage:"Request to delete destination index {destinationIndex} acknowledged.",values:{destinationIndex:d}})),null!==(b=r.destIndexDeleted)&&void 0!==b&&b.error&&c.displayErrorToast(r.destIndexDeleted.error,n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsWithIndexErrorMessage",{defaultMessage:"An error occurred deleting destination index {destinationIndex}",values:{destinationIndex:d}})),null!==(f=r.destIndexPatternDeleted)&&void 0!==f&&f.success&&c.displaySuccessToast(n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsWithDataViewSuccessMessage",{defaultMessage:"Request to delete data view {destinationIndex} acknowledged.",values:{destinationIndex:d}})),null!==(h=r.destIndexPatternDeleted)&&void 0!==h&&h.error){const e=Object(s.b)(r.destIndexPatternDeleted.error);c.displayDangerToast(n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsWithDataViewErrorMessage",{defaultMessage:"An error occurred deleting data view {destinationIndex}: {error}",values:{destinationIndex:d,error:e}}))}}catch(t){c.displayErrorToast(t,n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsErrorMessage",{defaultMessage:"An error occurred deleting the data frame analytics job {analyticsId}",values:{analyticsId:e.id}}))}r.v.next(r.e.REFRESH)},u=async(e,t)=>{try{const t=await o.ml.hasPrivileges({index:[{names:[e],privileges:["delete_index"]}]});return!!t&&(!0===t.securityDisabled||!0===t.has_all_requested)}catch(a){const i=Object(s.b)(a);t.displayDangerToast(n.i18n.translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsPrivilegeErrorMessage",{defaultMessage:"User does not have permission to delete index {indexName}: {error}",values:{indexName:e,error:i}}))}},p=async(e,t)=>{try{await o.ml.dataFrameAnalytics.startDataFrameAnalytics(e.config.id),t.displaySuccessToast(n.i18n.translate("xpack.ml.dataframe.analyticsList.startAnalyticsSuccessMessage",{defaultMessage:"Request to start data frame analytics {analyticsId} acknowledged.",values:{analyticsId:e.config.id}}))}catch(e){t.displayErrorToast(e,n.i18n.translate("xpack.ml.dataframe.analyticsList.startAnalyticsErrorTitle",{defaultMessage:"Error starting job"}))}r.v.next(r.e.REFRESH)};var m=a(27);const b=async e=>{const t=Object(m.n)();try{await o.ml.dataFrameAnalytics.stopDataFrameAnalytics(e.config.id,Object(l.f)(e.stats.state)),t.addSuccess(n.i18n.translate("xpack.ml.dataframe.analyticsList.stopAnalyticsSuccessMessage",{defaultMessage:"Request to stop data frame analytics {analyticsId} acknowledged.",values:{analyticsId:e.config.id}}))}catch(a){t.addDanger(n.i18n.translate("xpack.ml.dataframe.analyticsList.stopAnalyticsErrorMessage",{defaultMessage:"An error occurred stopping the data frame analytics {analyticsId}: {error}",values:{analyticsId:e.config.id,error:JSON.stringify(a)}}))}r.v.next(r.e.REFRESH)}},function(e,t,a){"use strict";a.d(t,"b",(function(){return g})),a.d(t,"a",(function(){return j}));var i=a(17),n=a.n(i),s=a(44),o=a(2),r=a(45),l=(a(578),a(96)),c=a(156),d=a(212),u=a(13);function p({limit:e,maps:t,onLinkClick:a,selectedIds:i,showAllBarBadges:n}){const r=[],l=[];for(let e=0;e<i.length;e++){const a=i[e];void 0!==t.groupsMap[a]&&(l.push(a),r.push(Object(u.jsx)(s.EuiFlexItem,{grow:!1,key:a},Object(u.jsx)(d.a,{id:a,isGroup:!0,numJobs:t.groupsMap[a].length}))))}for(let e=0;e<i.length;e++){const a=i[e];if(void 0===t.groupsMap[a]){if(!1!==(t.jobsMap[a]||[]).some((e=>l.includes(e))))continue;r.push(Object(u.jsx)(s.EuiFlexItem,{grow:!1,key:a},Object(u.jsx)(d.a,{id:a})))}}if(n||r.length<=e)return r.length>e&&r.push(Object(u.jsx)(s.EuiLink,{key:"more-badges-bar-link",onClick:a},Object(u.jsx)(s.EuiText,{grow:!1,size:"xs"},o.i18n.translate("xpack.ml.jobSelector.hideBarBadges",{defaultMessage:"Hide"})))),r;{const t=r.length-e;return r.splice(e),r.push(Object(u.jsx)(s.EuiLink,{key:"more-badges-bar-link",onClick:a},Object(u.jsx)(s.EuiText,{grow:!1,size:"xs"},o.i18n.translate("xpack.ml.jobSelector.showBarBadges",{defaultMessage:"And {overFlow} more",values:{overFlow:t}})))),r}}p.propTypes={limit:c.PropTypes.number,maps:c.PropTypes.shape({jobsMap:c.PropTypes.object,groupsMap:c.PropTypes.object}),onLinkClick:c.PropTypes.func,selectedIds:c.PropTypes.array,showAllBarBadges:c.PropTypes.bool};var m=a(340),b=a(158),f=a(152);function h(e,t,a){if(a)return e;const i=[],n=[];return t.forEach((e=>{i.push(e.groupId),n.push(...e.jobIds)})),e.forEach((e=>{!1===n.includes(e)&&i.push(e)})),i}function g(e){const t={};return e.length&&e.forEach((e=>{t[e.groupId]=e.jobIds})),t}function j({dateFormatTz:e,singleSelection:t,timeseriesOnly:a}){var c,d,j,x;const[v,y]=Object(l.c)("_g"),[O,E]=Object(b.b)(f.b,!0),w=null!==(c=null==v||null===(d=v.ml)||void 0===d?void 0:d.jobIds)&&void 0!==c?c:[],M=null!==(j=null==v||null===(x=v.ml)||void 0===x?void 0:x.groups)&&void 0!==j?j:[],[S,_]=Object(i.useState)({groupsMap:g(M),jobsMap:{}}),[T,C]=Object(i.useState)(h(w,M,t)),[k,F]=Object(i.useState)(!1),[I,D]=Object(i.useState)(!1);function A(){D(!1)}Object(i.useEffect)((()=>{C(h(w,M,t))}),[JSON.stringify([w,M])]);const L=Object(i.useCallback)((({newSelection:e,jobIds:t,groups:a,time:i})=>{C(e),y({ml:{jobIds:t,groups:a},...void 0!==i?{time:i}:{}}),A()}),[y,C]);return Object(u.jsx)("div",null,Object(u.jsx)(n.a.Fragment,null,Object(u.jsx)(s.EuiFlexGroup,{responsive:!1,gutterSize:"xs",alignItems:"center"},Object(u.jsx)(s.EuiFlexItem,{grow:!1},T.length>0?Object(u.jsx)(s.EuiFlexGroup,{wrap:!0,responsive:!1,gutterSize:"xs",alignItems:"center","data-test-subj":"mlJobSelectionBadges"},Object(u.jsx)(p,{limit:m.a,maps:S,onLinkClick:()=>F(!k),selectedIds:T,showAllBarBadges:k})):Object(u.jsx)("span",null,Object(u.jsx)(r.FormattedMessage,{id:"xpack.ml.jobSelector.noJobsSelectedLabel",defaultMessage:"No jobs selected"}))),Object(u.jsx)(s.EuiFlexItem,{grow:!1},Object(u.jsx)(s.EuiButtonEmpty,{size:"xs",iconType:"pencil",onClick:function(){D(!0)},"data-test-subj":"mlButtonEditJobSelection"},o.i18n.translate("xpack.ml.jobSelector.jobSelectionButton",{defaultMessage:"Edit job selection"})))),Object(u.jsx)(s.EuiHorizontalRule,{margin:"s"})),function(){if(I)return Object(u.jsx)(s.EuiFlyout,{onClose:A,"data-test-subj":"mlFlyoutJobSelector","aria-labelledby":"jobSelectorFlyout"},Object(u.jsx)(m.b,{dateFormatTz:e,timeseriesOnly:a,singleSelection:t,selectedIds:T,onSelectionConfirmed:L,onJobsFetched:_,onFlyoutClose:A,maps:S,applyTimeRangeConfig:O,onTimeRangeConfigChange:E}))}())}},function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var i=a(17),n=a(44),s=a(45),o=a(133),r=a(99),l=a(157),c=a(13);const d=()=>{if(!0===Object(o.c)()||!1===Object(o.d)())return null;const e=Object(l.e)()?"2GB":"1GB",t=Object(r.b)();return Object(c.jsx)(i.Fragment,null,Object(c.jsx)(n.EuiCallOut,{title:Object(c.jsx)(s.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.noMLNodesAvailableTitle",defaultMessage:"No ML nodes available"}),color:"warning",iconType:"alert"},Object(c.jsx)("div",null,Object(c.jsx)(s.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.noMLNodesAvailableDescription",defaultMessage:"There are no ML nodes available."})),Object(c.jsx)("div",null,Object(c.jsx)(s.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.unavailableCreateOrRunJobsDescription",defaultMessage:"You will not be able to create or run jobs."})),Object(r.e)()&&null!==t&&Object(c.jsx)("div",null,Object(c.jsx)(s.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.linkToCloudDescription",defaultMessage:"Please edit your {link}. You may enable a free {maxRamForMLNodes} machine learning node or expand your existing ML configuration.",values:{link:Object(c.jsx)(n.EuiLink,{href:`https://cloud.elastic.co/deployments?q=${t}`},Object(c.jsx)(s.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.linkToCloud.hereLinkText",defaultMessage:"Elastic Cloud deployment"})),maxRamForMLNodes:e}}))),Object(c.jsx)(n.EuiSpacer,{size:"m"}))}},,,function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var i=a(17),n=a.n(i),s=a(44),o=a(45),r=a(274),l=a(13);const c=()=>!0===Object(r.a)()?Object(l.jsx)(n.a.Fragment,null,Object(l.jsx)(s.EuiCallOut,{title:Object(l.jsx)(o.FormattedMessage,{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningTitle",defaultMessage:"Index migration in progress"}),color:"warning",iconType:"alert"},Object(l.jsx)("p",null,Object(l.jsx)(o.FormattedMessage,{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningDescription",defaultMessage:"Indices related to Machine Learning are currently being upgraded."}),Object(l.jsx)("br",null),Object(l.jsx)(o.FormattedMessage,{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningDescriptionExtra",defaultMessage:"Some actions will not be available during this time."}))),Object(l.jsx)(s.EuiSpacer,{size:"m"})):null},,,,function(e,t,a){e.exports=a(39)(1688)},,function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var i=a(17),n=a(32),s=a(80),o=a(124);const r=()=>{const e=Object(s.h)();return Object(i.useMemo)((()=>new o.a({"histogram:maxBars":e.get(n.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":e.get(n.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:e.get("dateFormat"),"dateFormat:scaled":e.get("dateFormat:scaled")})),[e])}},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));const i="_all"},function(e,t,a){e.exports=a(39)(2728)},function(e,t,a){var i=a(174),n=["FREQ","INTERVAL","COUNT","UNTIL","BYDAY","BYMONTH","BYMONTHDAY"],s=["SU","MO","TU","WE","TH","FR","SA"];function o(e){return Array.isArray(e)?(e=e.slice(0))[1]--:e=[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()],new Date(Date.UTC.apply(null,e))}function r(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())}function l(e){return e<0?Math.ceil(e):Math.floor(e)}function c(e){return e.getUTCFullYear()}function d(e){return e.getUTCMonth()+1}function u(e){return e.getUTCDate()}function p(e){return e.getUTCHours()}function m(e){return e.getUTCMinutes()}function b(e){return e.getUTCSeconds()}function f(e){return e.getUTCMilliseconds()}function h(e,t){return e.setUTCMonth(t-1),e}function g(e,t){return e.setUTCDate(t),e}function j(e,t){return e.setUTCHours(t),e}function x(e,t){return e.setUTCMinutes(t),e}function v(e,t){return e.setUTCSeconds(t),e}function y(e,t){return e.setUTCMilliseconds(t),e}function O(e,t){return function(e,t){return e.setUTCFullYear(t),e}(e,c(e)+t)}function E(e,t){return h(e,d(e)+t)}function w(e,t){return g(e,u(e)+t)}function M(e){return e.getUTCDay()}function S(e,t){return(t-e)/864e5}var _=t.RRule=function(e,t,a){for(var i in t instanceof Date&&(t={DTSTART:t,DTEND:a}),t=t||{},this.start=t.DTSTART?o(t.DTSTART):null,this.end=t.DTEND?o(t.DTEND):null,this.exceptions=t.EXDATE||[],"string"==typeof e&&(e=_.parse(e)),this.rule={},e||{}){if(-1==n.indexOf(i))throw new Error(i+" is not currently supported!");this.rule[i]=T[i]?T[i].parse(e[i]):e[i]}};_.parse=function(e){for(var t=e.split(/=|;/),a={},i=0;i<t.length;i+=2)a[t[i]]=t[i+1];return a},_.prototype.setFrequency=function(e){this.rule.FREQ=e},_.prototype.valueOf=function(){return this.rule},_.prototype.toString=function(){var e=["FREQ="+this.rule.FREQ];for(var t in this.rule)"FREQ"!=t&&e.push(t+"="+((T[t]||{}).format?T[t].format(this.rule[t]):this.rule[t]));return e.join(";")},_.prototype.next=function(e){if((!(e=e&&o(e))||e<this.start)&&(e=new Date(this.start.valueOf()-1)),this.until&&e>this.until)return null;var t=C[this.rule.FREQ];if(!t)throw new Error(this.rule.FREQ+" recurrence is not supported");e:for(;;){for(var a=t.next(this.rule,this.start,e),i=r(a),n=0;n<this.exceptions.length;n++){var s=this.exceptions[n];if(s.valueOf()==i.valueOf()||s.date_only&&c(o(s))==c(i)&&d(o(s))==d(i)&&u(o(s))==u(i)){e=a;continue e}}break}return this.until&&a>this.until||this.rule.COUNT&&null!==this.count_end&&(void 0===this.count_end&&(this.count_end=null,this.count_end=this.nextOccurences(this.rule.COUNT).pop()),a>o(this.count_end))||this.rule.UNTIL&&a>o(this.rule.UNTIL)?null:r(a)},_.prototype.nextOccurences=function(e,t){1===arguments.length&&(t=e,e=void 0);var a=[];if(t instanceof Date)for(;(e=this.next(e))&&e<=t;)a.push(e);else for(;t--&&null!==e;)(e=this.next(e))&&a.push(e);return a};var T={INTERVAL:{parse:function(e){return parseInt(e,10)}},UNTIL:{parse:function(e){return e instanceof Date?e:i.parse_value("DATE-TIME",e)},format:function(e){return i.format_value("DATE-TIME",e)}},FREQ:{parse:function(e){return e}},BYMONTH:{parse:function(e){return"number"==typeof e?[e]:e.split(",").map((function(e){return parseInt(e,10)}))},format:function(e){return e.join(",")}},BYDAY:{parse:function(e){var t=e.split(",").map((function(e){var t=e.match(/([+-]?\d)?(SU|MO|TU|WE|TH|FR|SA)/);return[parseInt(t[1],10)||0,s.indexOf(t[2])]}));return t.sort((function(e,t){return e[0]==t[0]?e[1]-t[1]:e[0]-t[0]})),t},format:function(e){return e.map((function(e){return(e[0]||"")+s[e[1]]})).join(",")}},EXDATE:{parse:function(e){return e.split(",").map((function(e){return 8==e.length?i.parse_value("DATE",e):i.parse_value("DATE-TIME",e)}))},format:function(e){return e.map((function(e){return i.format_value(e.date_only?"DATE":"DATE-TIME",e)})).join(",")}}};T.BYMONTHDAY=T.BYMONTH,T.COUNT=T.INTERVAL;var C={DAILY:{next:function(e,t,a){var i=new Date(a);j(i,p(t)),x(i,m(t)),v(i,b(t)),y(i,f(t));var n=e.INTERVAL||1,s=l(S(i,t))%n;s&&w(i,n-s);for(var o=0;o<2&&!((i=D(e.BYDAY,i,a)).valueOf()>a.valueOf());++o)w(i,n);return i}},WEEKLY:{next:function(e,t,a){var i=new Date(a);j(i,p(t)),x(i,m(t)),v(i,b(t)),y(i,f(t));var n,s,o=e.INTERVAL||1,r=l(S(t,i)/7)%o;for(r&&w(i,7*(o-r));i=D(e.BYDAY,i,a),e.BYDAY&&e.BYDAY.length||(startDayOfWeek=M(t),nextDayOfWeek=M(i),nextDayOfWeek>startDayOfWeek?w(i,startDayOfWeek-nextDayOfWeek):startDayOfWeek>nextDayOfWeek&&w(i,startDayOfWeek-nextDayOfWeek-7)),!(i.valueOf()>a.valueOf())||(n=e.BYMONTH,s=i,n&&n.length&&-1===n.indexOf(d(s)));)w(i,7*o);return i}},MONTHLY:{next:function(e,t,a){var i=new Date(a);j(i,p(t)),x(i,m(t)),v(i,b(t)),y(i,f(t));var n=e.INTERVAL||1,s=d(i)-d(t)+12*(c(i)-c(t));s%n&&E(i,n-s%n);for(var o=0;o<2&&(o&&g(i,1),i=D(e.BYDAY,i,a),i=I(e.BYMONTHDAY,i,a),e.BYDAY&&e.BYDAY.length||e.BYMONTHDAY&&e.BYMONTHDAY.length||g(i,u(t)),!(i.valueOf()>a.valueOf()));++o)E(i,n);return i}},YEARLY:{next:function(e,t,a){var i=new Date(a);j(i,p(t)),x(i,m(t)),v(i,b(t)),y(i,f(t));var n=e.INTERVAL||1,s=(c(a)-c(t))%n;s&&O(i,n-s);for(var o=0;o<2&&(i=F(e.BYMONTH,i),i=I(e.BYMONTHDAY,i,a),i=D(e.BYDAY,i,a),e.BYMONTH&&e.BYMONTH.length||h(i,d(t)),e.BYDAY&&e.BYDAY.length||e.BYMONTHDAY&&e.BYMONTHDAY.length||g(i,u(t)),!(i.valueOf()>a.valueOf()));++o)g(h(O(i,n),1),1);return i}}};function k(e){return e.sort((function(e,t){return null===e&&null===t?0:null===e?1:null===t?-1:e.valueOf()-t.valueOf()}))}function F(e,t){return e&&e.length&&k(e.map((function(e){var a=e-d(t);a<0&&(a+=12);var i=E(new Date(t),a);return g(i,1),i}))).shift()||t}function I(e,t,a){return e&&e.length&&k(e.map((function(e){var i=g(new Date(t),e);return i.valueOf()<=a.valueOf()?null:i}))).shift()||t}function D(e,t,a){return e&&e.length&&k(e.map((function(e){(o=e[1]-M(t))<0&&(o+=7);var i=w(new Date(t),o);if(e[0]>0){var n=0|(u(i)-1)/7+1;if(n>e[0])return null;w(i,7*(e[0]-n))}else if(e[0]<0){for(var s=new Date(i),o=[];d(s)===d(i);)o.push(u(s)),w(s,7);g(i,o.reverse()[-e[0]-1])}return i.valueOf()<=a.valueOf()?null:i}))).shift()||t}},function(e,t,a){a(227);var i=a(175),n=a(122).CalendarObject,s=(a(122).CalendarProperty,a(122).schema),o=t.iCalendar=function(e){n.call(this,this,"VCALENDAR"),this.calendar=this,e||(this.addProperty("VERSION","2.0"),this.addProperty("PRODID",a(276).PRODID))};i.inherits(o,n),o.prototype.events=function(){return this.components.VEVENT||[]},o.prototype.timezone=function(e){for(var t=0;t<this.components.VTIMEZONE.length;++t){var a=this.components.VTIMEZONE[t];if(a.getPropertyValue("TZID")==e)return a}},s.VCALENDAR={factory:o,valid_properties:[],required_properties:["PRODID","VERSION"],valid_children:["VEVENT"],required_children:[]},s.VTODO={required_properties:["DTSTAMP","UID"]},s.VJOURNAL={required_properties:["DTSTAMP","UID"]},s.VFREEBUSY={required_properties:["DTSTAMP","UID"]},s.VALARM={required_properties:["ACTION","TRIGGER"]}},function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var i=a(2),n=a(83),s=a(115);const o=i.i18n.translate("xpack.ml.dataframe.analyticsList.viewActionUnknownJobTypeToolTipContent",{defaultMessage:"There is no results page available for this type of data frame analytics job."}),r=i.i18n.translate("xpack.ml.dataframe.analyticsList.viewActionJobNotStartedToolTipContent",{defaultMessage:"The data frame analytics job did not start. There is no results page available."}),l=i.i18n.translate("xpack.ml.dataframe.analyticsList.viewActionJobNotFinishedToolTipContent",{defaultMessage:"The data frame analytics job is not finished. There is no results page available."}),c=i.i18n.translate("xpack.ml.dataframe.analyticsList.viewActionJobFailedToolTipContent",{defaultMessage:"The data frame analytics job failed. There is no results page available."});function d(e){const t={disabled:!1},a=Object(s.d)(e.stats),i=Object(s.f)(e.stats.state),d=1===a.currentPhase&&0===a.progress,u=Object(s.i)(e.stats.state)&&a.currentPhase===a.totalPhases&&100===a.progress,p=!Object(n.y)(e.config.analysis)&&!Object(n.x)(e.config.analysis)&&!Object(n.v)(e.config.analysis);return(!u||i||p)&&(t.disabled=!0,p?t.tooltipContent=o:i?t.tooltipContent=c:d?t.tooltipContent=r:u||(t.tooltipContent=l)),t}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var i=a(17);const n=[10,25,50];function s(e,t,a){const{pageIndex:s,pageSize:o,sortField:r,sortDirection:l}=t;return{onTableChange:Object(i.useCallback)((({page:e,sort:i})=>{var n,s,o;let r=null==i?void 0:i.field;"string"!=typeof r&&(r=t.sortField);const l={pageIndex:null!==(n=null==e?void 0:e.index)&&void 0!==n?n:t.pageIndex,pageSize:null!==(s=null==e?void 0:e.size)&&void 0!==s?s:t.pageSize,sortField:r,sortDirection:null!==(o=null==i?void 0:i.direction)&&void 0!==o?o:t.sortDirection};a(l)}),[t,a]),pagination:Object(i.useMemo)((()=>({pageIndex:s,pageSize:o,totalItemCount:e,pageSizeOptions:n})),[e,s,o]),sorting:Object(i.useMemo)((()=>({sort:{field:r,direction:l}})),[r,l])}}},function(e,t,a){var i=a(229),n=a(424)(i);e.exports=n},function(e,t,a){e.exports=a(39)(1546)},function(e,t,a){var i=a(178),n=a(450),s=a(451);e.exports=function(e,t){return s(n(e,t,i),e+"")}},function(e,t,a){e.exports=a(39)(1156)},function(e,t,a){"use strict";var i=a(98);e.exports={longestPath:function(e){var t={};i.forEach(e.sources(),(function a(n){var s=e.node(n);if(i.has(t,n))return s.rank;t[n]=!0;var o=i.min(i.map(e.outEdges(n),(function(t){return a(t.w)-e.edge(t).minlen})));return o!==Number.POSITIVE_INFINITY&&null!=o||(o=0),s.rank=o}))},slack:function(e,t){return e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(17);t.default=function(e){i.useEffect(e,[])}},,function(e,t,a){"use strict";a.r(t),a.d(t,"AnomalyTimelineService",(function(){return AnomalyTimelineService}));var i=a(5),n=a.n(i),s=a(47),o=a(6),r=a(124),l=a(100);class AnomalyTimelineService{constructor(e,t,a){n()(this,"timeBuckets",void 0),n()(this,"_customTimeRange",void 0),this.timeFilter=e,this.mlResultsService=a,this.timeBuckets=new r.a({"histogram:maxBars":t.get(s.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":t.get(s.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:t.get("dateFormat"),"dateFormat:scaled":t.get("dateFormat:scaled")}),this.timeFilter.enableTimeRangeSelector()}static isSwimlaneData(e){return Object(o.isPopulatedObject)(e,["interval","points","laneLabels"])}static isOverallSwimlaneData(e){return this.isSwimlaneData(e)&&Object(o.isPopulatedObject)(e,["earliest","latest"])&&1===e.laneLabels.length&&e.laneLabels[0]===l.g}setTimeRange(e){this._customTimeRange=e}getSwimlaneBucketInterval(e,t){const a=this.getTimeBounds();if(void 0===a)throw new Error("timeRangeSelectorEnabled has to be enabled");this.timeBuckets.setInterval("auto"),this.timeBuckets.setBounds(a);const i=this.timeBuckets.getInterval().asSeconds(),n=(a.max.valueOf()-a.min.valueOf())/1e3/i;Math.floor(t/n*100)/100<8&&this.timeBuckets.setInterval(2*i+"s");const s=e.reduce(((e,t)=>Math.max(e,t.bucketSpanSeconds)),0);return s>i&&(this.timeBuckets.setInterval(s+"s"),this.timeBuckets.setBounds(a)),this.timeBuckets.getInterval()}async loadOverallData(e,t,a,i){const n=null!=a?a:this.getSwimlaneBucketInterval(e,t);if(!e||!e.length)throw new Error("Explorer jobs collection is required");const s=this.getTimeBounds(),o=Object(r.b)(s,n,!1),l=e.map((e=>e.id)),c=Object(r.b)(s,n,!0),d=await this.mlResultsService.getOverallBucketScores(l,1,c.min.valueOf(),c.max.valueOf(),n.asSeconds()+"s",i);return this.processOverallResults(d.results,o,n.asSeconds())}async loadViewBySwimlane(e,t,a,i,n,s,o,c,d,u,p){const m=this.getTimeBounds();if(void 0===m)throw new Error("timeRangeSelectorEnabled has to be enabled");const b=null!=u?u:this.getSwimlaneBucketInterval(a,c),f=Object(r.b)(m,b,!1),h=a.map((e=>e.id)),g=b.asMilliseconds();let j;if(i===l.j){const t=void 0!==e&&e.length>0?e:h;j=await this.mlResultsService.getScoresByBucket(t,f.min.valueOf(),f.max.valueOf(),g,s,o,p)}else j=await this.mlResultsService.getInfluencerValueMaxScoreByTime(h,i,e,f.min.valueOf(),f.max.valueOf(),g,n,s,o,d,p);if(void 0!==j)return this.processViewByResults(j.results,j.cardinality,e,t,i,b.asSeconds())}async loadViewByTopFieldValuesForSelectedTime(e,t,a,i,n,s,o,r,c,d){const u=a.map((e=>e.id));if(i!==l.j){const a=await this.mlResultsService.getTopInfluencers(u,e,t,n,s,o,c,d);if(void 0===a.influencers[i])return[];const r=[],l=a.influencers[i];return Array.isArray(l)&&l.forEach((e=>{e.maxAnomalyScore>0&&r.push(e.influencerFieldValue)})),r}{const a=await this.mlResultsService.getScoresByBucket(u,e,t,r.asMilliseconds(),s,o,n);return Object.keys(a.results)}}getTimeBounds(){return void 0!==this._customTimeRange?this.timeFilter.calculateBounds(this._customTimeRange):this.timeFilter.getBounds()}processOverallResults(e,t,a){const i=l.g,n={laneLabels:[i],points:[],interval:a,earliest:t.min.valueOf()/1e3,latest:t.max.valueOf()/1e3};return Object.entries(e).forEach((([e,t])=>{const a=+e/1e3;n.points.push({laneLabel:i,time:a,value:t}),n.earliest=Math.min(a,n.earliest),n.latest=Math.max(a+n.interval,n.latest)})),n}processViewByResults(e,t,a,i,n,s){const o={fieldName:n,points:[],laneLabels:[],interval:s,earliest:i.earliest,latest:i.latest,cardinality:t},r={};Object.entries(e).forEach((([e,t])=>{o.laneLabels.push(e),r[e]=0,Object.entries(t).forEach((([t,a])=>{const i=+t/1e3;o.points.push({laneLabel:e,time:i,value:a}),r[e]=Math.max(r[e],a)}))}));const l=a.length;return o.laneLabels=0===l?o.laneLabels.sort(((e,t)=>r[t]-r[e])):o.laneLabels.sort(((e,t)=>{let i=a.indexOf(e),n=a.indexOf(t);return i=i>-1?i:l,n=n>-1?n:l,i-n})),o}}},,,function(e,t,a){"use strict";a.d(t,"b",(function(){return yx})),a.d(t,"a",(function(){return Ox}));var i={};a.r(i),a.d(i,"overviewRouteFactory",(function(){return z})),a.d(i,"appRootRouteFactory",(function(){return V})),a.d(i,"jobListRouteFactory",(function(){return pn})),a.d(i,"indexOrSearchRouteFactory",(function(){return On})),a.d(i,"dataVizIndexOrSearchRouteFactory",(function(){return En})),a.d(i,"explainLogRateSpikesIndexOrSearchRouteFactory",(function(){return wn})),a.d(i,"logCategorizationIndexOrSearchRouteFactory",(function(){return Mn})),a.d(i,"changePointDetectionIndexOrSearchRouteFactory",(function(){return Sn})),a.d(i,"jobTypeRouteFactory",(function(){return Rn})),a.d(i,"newJobRouteFactory",(function(){return Pn})),a.d(i,"singleMetricRouteFactory",(function(){return bc})),a.d(i,"multiMetricRouteFactory",(function(){return fc})),a.d(i,"multiMetricRouteFactoryRedirect",(function(){return hc})),a.d(i,"populationRouteFactory",(function(){return gc})),a.d(i,"advancedRouteFactory",(function(){return jc})),a.d(i,"advancedRouteFactoryRedirect",(function(){return xc})),a.d(i,"categorizationRouteFactory",(function(){return vc})),a.d(i,"rareRouteFactory",(function(){return yc})),a.d(i,"recognizeRouteFactory",(function(){return Ac})),a.d(i,"checkViewOrCreateRouteFactory",(function(){return Lc})),a.d(i,"fromLensRouteFactory",(function(){return zc})),a.d(i,"selectorRouteFactory",(function(){return Jc})),a.d(i,"indexBasedRouteFactory",(function(){return qc})),a.d(i,"fileBasedRouteFactory",(function(){return Hc})),a.d(i,"settingsRouteFactory",(function(){return Zc})),a.d(i,"calendarListRouteFactory",(function(){return bd})),a.d(i,"newCalendarRouteFactory",(function(){return gd})),a.d(i,"editCalendarRouteFactory",(function(){return jd})),a.d(i,"filterListRouteFactory",(function(){return Dd})),a.d(i,"newFilterListRouteFactory",(function(){return Rd})),a.d(i,"editFilterListRouteFactory",(function(){return Nd})),a.d(i,"analyticsJobsListRouteFactory",(function(){return Iu})),a.d(i,"analyticsJobExplorationRouteFactory",(function(){return Tm})),a.d(i,"analyticsJobsCreationRouteFactory",(function(){return Wb})),a.d(i,"analyticsMapRouteFactory",(function(){return Xb})),a.d(i,"analyticsSourceSelectionRouteFactory",(function(){return tf})),a.d(i,"explainLogRateSpikesRouteFactory",(function(){return rf})),a.d(i,"logCategorizationRouteFactory",(function(){return df})),a.d(i,"changePointDetectionRouteFactory",(function(){return mf})),a.d(i,"timeSeriesExplorerRouteFactory",(function(){return Ug})),a.d(i,"explorerRouteFactory",(function(){return ex})),a.d(i,"accessDeniedRouteFactory",(function(){return sx})),a.d(i,"modelsListRouteFactory",(function(){return rx})),a.d(i,"nodesListRouteFactory",(function(){return dx})),a.d(i,"notificationsRouteFactory",(function(){return mx}));var n=a(17),s=a.n(n),o=a(44),r=a(2),l=a(50),c=a(46),d=a(224),u=a(225),p=a(62),m=a(45),b=a(48),f=a(126),h=a(264),g=a(13),j={name:"4zleql",styles:"display:block"};const x=()=>{var e,t;const{notificationsCounts:a,latestRequestedAt:i}=Object(h.b)(),n=Object(f.a)(b.FIELD_FORMAT_IDS.DATE),s=(null!==(e=null==a?void 0:a.error)&&void 0!==e?e:0)+(null!==(t=null==a?void 0:a.warning)&&void 0!==t?t:0),l=a&&Object.values(a).some((e=>e>0));return Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.navMenu.notificationsTabLinkText",defaultMessage:"Notifications"})),s?Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiToolTip,{position:"right",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.notificationsIndicator.errorsAndWarningLabel",defaultMessage:"There {count, plural, one {is # notification} other {are # notifications}} with error or warning level since {lastCheckedAt}",values:{count:s,lastCheckedAt:n(i)}})},Object(g.jsx)(o.EuiNotificationBadge,{"aria-label":r.i18n.translate("xpack.ml.notificationsIndicator.unreadErrors",{defaultMessage:"Unread errors or warnings indicator."}),"data-test-subj":"mlNotificationErrorsIndicator"},s))):null,!s&&l?Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiToolTip,{position:"right",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.notificationsIndicator.unreadLabel",defaultMessage:"You have unread notifications since {lastCheckedAt}",values:{lastCheckedAt:n(i)}})},Object(g.jsx)(o.EuiHealth,{css:j,color:"primary","aria-label":r.i18n.translate("xpack.ml.notificationsIndicator.unreadIcon",{defaultMessage:"Unread notifications indicator."}),"data-test-subj":"mlNotificationsIndicator"}))):null)};var v=a(96),y=a(80),O=a(105),E=a(0),w=a(84);function M(e){const t=Object(y.d)(),a=Object(y.e)(),i=!Object(O.d)(),s=Object(w.e)("canViewMlNodes"),[o]=Object(v.c)("_g"),l=Object(n.useMemo)((()=>void 0!==(null==o?void 0:o.refreshInterval)?{globalState:{refreshInterval:o.refreshInterval}}:void 0),[null==o?void 0:o.refreshInterval]),c=Object(n.useCallback)((async e=>{const i=await t.getUrl({page:e,pageState:l});await a(i,!1)}),[l]),d=Object(n.useMemo)((()=>{const e=i,t=[{id:"main_section",name:"",items:[{id:"overview",pathId:E.b.OVERVIEW,name:r.i18n.translate("xpack.ml.navMenu.overviewTabLinkText",{defaultMessage:"Overview"}),disabled:e,testSubj:"mlMainTab overview"},{id:"notifications",pathId:E.b.NOTIFICATIONS,name:e?r.i18n.translate("xpack.ml.navMenu.notificationsTabLinkText",{defaultMessage:"Notifications"}):Object(g.jsx)(x,null),disabled:e,testSubj:"mlMainTab notifications"}]},{id:"anomaly_detection_section",name:r.i18n.translate("xpack.ml.navMenu.anomalyDetectionTabLinkText",{defaultMessage:"Anomaly Detection"}),disabled:e,items:[{id:"anomaly_detection",name:r.i18n.translate("xpack.ml.navMenu.anomalyDetection.jobsManagementText",{defaultMessage:"Jobs"}),disabled:e,pathId:E.b.ANOMALY_DETECTION_JOBS_MANAGE,testSubj:"mlMainTab anomalyDetection"},{id:"anomaly_explorer",name:r.i18n.translate("xpack.ml.navMenu.anomalyDetection.anomalyExplorerText",{defaultMessage:"Anomaly Explorer"}),disabled:e,pathId:E.b.ANOMALY_EXPLORER,testSubj:"mlMainTab anomalyExplorer"},{id:"single_metric_viewer",name:r.i18n.translate("xpack.ml.navMenu.anomalyDetection.singleMetricViewerText",{defaultMessage:"Single Metric Viewer"}),pathId:E.b.SINGLE_METRIC_VIEWER,disabled:e,testSubj:"mlMainTab singleMetricViewer"},{id:"settings",pathId:E.b.SETTINGS,name:r.i18n.translate("xpack.ml.navMenu.settingsTabLinkText",{defaultMessage:"Settings"}),disabled:e,testSubj:"mlMainTab settings",highlightNestedRoutes:!0}]},{id:"data_frame_analytics_section",name:r.i18n.translate("xpack.ml.navMenu.dataFrameAnalyticsTabLinkText",{defaultMessage:"Data Frame Analytics"}),disabled:e,items:[{id:"data_frame_analytics_jobs",pathId:E.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE,name:r.i18n.translate("xpack.ml.navMenu.dataFrameAnalytics.jobsManagementText",{defaultMessage:"Jobs"}),disabled:e,testSubj:"mlMainTab dataFrameAnalytics"},{id:"data_frame_analytics_results_explorer",pathId:E.b.DATA_FRAME_ANALYTICS_EXPLORATION,name:r.i18n.translate("xpack.ml.navMenu.dataFrameAnalytics.resultsExplorerText",{defaultMessage:"Results Explorer"}),disabled:e,testSubj:"mlMainTab dataFrameAnalyticsResultsExplorer"},{id:"data_frame_analytics_job_map",pathId:E.b.DATA_FRAME_ANALYTICS_MAP,name:r.i18n.translate("xpack.ml.navMenu.dataFrameAnalytics.analyticsMapText",{defaultMessage:"Analytics Map"}),disabled:e,testSubj:"mlMainTab dataFrameAnalyticsMap"}]},{id:"model_management",name:r.i18n.translate("xpack.ml.navMenu.modelManagementText",{defaultMessage:"Model Management"}),disabled:e,items:[{id:"trained_models",pathId:E.b.TRAINED_MODELS_MANAGE,name:r.i18n.translate("xpack.ml.navMenu.trainedModelsText",{defaultMessage:"Trained Models"}),disabled:e,testSubj:"mlMainTab trainedModels"},{id:"nodes_overview",pathId:E.b.TRAINED_MODELS_NODES,name:r.i18n.translate("xpack.ml.navMenu.nodesOverviewText",{defaultMessage:"Nodes"}),disabled:e||!s,testSubj:"mlMainTab nodesOverview"}]},{id:"datavisualizer",name:r.i18n.translate("xpack.ml.navMenu.dataVisualizerTabLinkText",{defaultMessage:"Data Visualizer"}),disabled:!1,pathId:E.b.DATA_VISUALIZER,testSubj:"mlMainTab dataVisualizer",items:[{id:"filedatavisualizer",pathId:E.b.DATA_VISUALIZER_FILE,name:r.i18n.translate("xpack.ml.navMenu.fileDataVisualizerLinkText",{defaultMessage:"File"}),disabled:!1,testSubj:"mlMainTab fileDataVisualizer"},{id:"data_view_datavisualizer",pathId:E.b.DATA_VISUALIZER_INDEX_SELECT,name:r.i18n.translate("xpack.ml.navMenu.dataViewDataVisualizerLinkText",{defaultMessage:"Data View"}),disabled:!1,testSubj:"mlMainTab indexDataVisualizer"}]}];return p.AIOPS_ENABLED&&t.push({id:"aiops_section",name:r.i18n.translate("xpack.ml.navMenu.aiopsTabLinkText",{defaultMessage:"AIOps Labs"}),disabled:e,items:[{id:"explainlogratespikes",pathId:E.b.AIOPS_EXPLAIN_LOG_RATE_SPIKES_INDEX_SELECT,name:r.i18n.translate("xpack.ml.navMenu.explainLogRateSpikesLinkText",{defaultMessage:"Explain Log Rate Spikes"}),disabled:e,testSubj:"mlMainTab explainLogRateSpikes",relatedRouteIds:["explain_log_rate_spikes"]},{id:"logCategorization",pathId:E.b.AIOPS_LOG_CATEGORIZATION_INDEX_SELECT,name:r.i18n.translate("xpack.ml.navMenu.logCategorizationLinkText",{defaultMessage:"Log Pattern Analysis"}),disabled:e,testSubj:"mlMainTab logCategorization",relatedRouteIds:["log_categorization"]},...p.CHANGE_POINT_DETECTION_ENABLED?[{id:"changePointDetection",pathId:E.b.AIOPS_CHANGE_POINT_DETECTION_INDEX_SELECT,name:r.i18n.translate("xpack.ml.navMenu.changePointDetectionLinkText",{defaultMessage:"Change Point Detection"}),disabled:e,testSubj:"mlMainTab changePointDetection",relatedRouteIds:["change_point_detection"]}]:[]]}),t}),[i,s]),u=Object(n.useCallback)((t=>{const{id:a,disabled:i,items:n,onClick:s,pathId:o,name:r,testSubj:l,highlightNestedRoutes:d,relatedRouteIds:p}=t,m=null!=s?s:o?c.bind(null,o):void 0,b=`/${o}`===(null==e?void 0:e.path)||!!d&&(null==e?void 0:e.path.includes(`${o}/`))||Array.isArray(p)&&p.includes(null==e?void 0:e.id);return{id:a,name:r,isSelected:b,disabled:i,...m?{onClick:m}:{},"data-test-subj":l+(b?" selected":""),items:n?n.map(u):void 0,forceOpen:!0}}),[e,c]);return Object(n.useMemo)((()=>d.map(u)),[d,u])}var S=a(82),_=a.n(S),T=a(89),C=a(104),k=a(189),F=a(119);const I=(e,t,a,i,s)=>{const o=Object(y.f)(),l=Object.keys(s),c=Object.values(s),d=l.reduce(((e,t)=>(e[t]={},e)),{}),[u,p]=Object(n.useState)(null),[m,b]=Object(n.useState)(d),f=Object(F.a)(E.b.ANOMALY_DETECTION_JOBS_MANAGE);return Object(n.useEffect)((()=>{(async()=>{try{(await Promise.all(c.map((e=>e())))).forEach(((e,t)=>d[l[t]]=e)),b(d)}catch(e){return}try{if(""===e)throw new Error(r.i18n.translate("xpack.ml.useResolver.errorIndexPatternIdEmptyString",{defaultMessage:"dataViewId must not be empty string."}));let n={savedSearch:null,dataView:null};void 0!==t?n=await Object(C.b)(t):void 0!==e&&(n.dataView=await Object(C.c)(e));const{savedSearch:s,dataView:o}=n,{combinedQuery:l}=Object(k.b)(a,null!==o?o:void 0,s);p({combinedQuery:l,currentDataView:o,currentSavedSearch:s,dataViewsContract:i,kibanaConfig:a})}catch(e){o.toasts.addError(new Error(e),{title:r.i18n.translate("xpack.ml.useResolver.errorTitle",{defaultMessage:"An error has occurred"})}),await f()}})()}),[]),{context:u,results:m}};var D=a(133),A=a(99);const L={ML_BREADCRUMB:Object.freeze({text:r.i18n.translate("xpack.ml.machineLearningBreadcrumbLabel",{defaultMessage:"Machine Learning"}),href:"/"}),SETTINGS_BREADCRUMB:Object.freeze({text:r.i18n.translate("xpack.ml.settingsBreadcrumbLabel",{defaultMessage:"Settings"}),href:"/settings"}),ANOMALY_DETECTION_BREADCRUMB:Object.freeze({text:r.i18n.translate("xpack.ml.anomalyDetectionBreadcrumbLabel",{defaultMessage:"Anomaly Detection"}),href:"/jobs"}),DATA_FRAME_ANALYTICS_BREADCRUMB:Object.freeze({text:r.i18n.translate("xpack.ml.dataFrameAnalyticsLabel",{defaultMessage:"Data Frame Analytics"}),href:"/data_frame_analytics"}),TRAINED_MODELS:Object.freeze({text:r.i18n.translate("xpack.ml.modelManagementLabel",{defaultMessage:"Model Management"}),href:"/trained_models"}),DATA_VISUALIZER_BREADCRUMB:Object.freeze({text:r.i18n.translate("xpack.ml.datavisualizerBreadcrumbLabel",{defaultMessage:"Data Visualizer"}),href:"/datavisualizer"}),AIOPS_BREADCRUMB_EXPLAIN_LOG_RATE_SPIKES:Object.freeze({text:r.i18n.translate("xpack.ml.aiopsBreadcrumbLabel",{defaultMessage:"AIOps Labs"}),href:"/aiops/explain_log_rate_spikes_index_select"}),AIOPS_BREADCRUMB_LOG_PATTERN_ANALYSIS:Object.freeze({text:r.i18n.translate("xpack.ml.aiopsBreadcrumbLabel",{defaultMessage:"AIOps Labs"}),href:"/aiops/log_categorization_index_select"}),AIOPS_BREADCRUMB_CHANGE_POINT_DETECTION:Object.freeze({text:r.i18n.translate("xpack.ml.aiopsBreadcrumbLabel",{defaultMessage:"AIOps Labs"}),href:"/aiops/change_point_detection_index_select"}),EXPLAIN_LOG_RATE_SPIKES:Object.freeze({text:r.i18n.translate("xpack.ml.aiops.explainLogRateSpikesBreadcrumbLabel",{defaultMessage:"Explain Log Rate Spikes"}),href:"/aiops/explain_log_rate_spikes_index_select"}),LOG_PATTERN_ANALYSIS:Object.freeze({text:r.i18n.translate("xpack.ml.aiops.logPatternAnalysisBreadcrumbLabel",{defaultMessage:"Log Pattern Analysis"}),href:"/aiops/log_categorization_index_select"}),CHANGE_POINT_DETECTION:Object.freeze({text:r.i18n.translate("xpack.ml.aiops.changePointDetectionBreadcrumbLabel",{defaultMessage:"Change Point Detection"}),href:"/aiops/change_point_detection_index_select"}),CREATE_JOB_BREADCRUMB:Object.freeze({text:r.i18n.translate("xpack.ml.createJobsBreadcrumbLabel",{defaultMessage:"Create job"}),href:"/jobs/new_job"}),CALENDAR_MANAGEMENT_BREADCRUMB:Object.freeze({text:r.i18n.translate("xpack.ml.settings.breadcrumbs.calendarManagementLabel",{defaultMessage:"Calendar management"}),href:"/settings/calendars_list"}),FILTER_LISTS_BREADCRUMB:Object.freeze({text:r.i18n.translate("xpack.ml.settings.breadcrumbs.filterListsLabel",{defaultMessage:"Filter lists"}),href:"/settings/filter_lists"})},R=(e,t)=>a=>{a.preventDefault(),t(e)},N=(e,t,a)=>({text:L[e].text,...t?{href:`${a}/app/ml${L[e].href}`,onClick:R(L[e].href,t)}:{}}),P=s.a.lazy((()=>a.e(27).then(a.bind(null,643)))),z=(e,t)=>({id:"overview",path:"/overview",title:r.i18n.translate("xpack.ml.overview.overviewLabel",{defaultMessage:"Overview"}),enableDatePicker:!0,render:(e,t)=>Object(g.jsx)(B,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.overview.overviewLabel",{defaultMessage:"Overview"})}],"data-test-subj":"mlPageOverview"}),B=({deps:e})=>{const{redirectToMlAccessDeniedPage:t}=e,{context:a}=I(void 0,void 0,e.config,e.dataViewsContract,{checkFullLicense:O.b,checkGetJobsCapabilities:()=>Object(w.c)(t),getMlNodeCount:D.a,loadMlServerInfo:A.g});return Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1}),Object(g.jsx)(T.b,{context:a},Object(g.jsx)(n.Suspense,{fallback:null},Object(g.jsx)(P,null)))},V=(e,t)=>({id:"",path:"/",render:()=>Object(g.jsx)(J,null),breadcrumbs:[]}),J=()=>Object(g.jsx)(l.Redirect,{to:"/overview"});var U=a(90),G=a.n(U),q=a(170),$=a(108);const W=({dataViewsContract:e,redirectToMlAccessDeniedPage:t})=>({checkFullLicense:O.b,getMlNodeCount:$.c,loadMlServerInfo:A.g,cacheDataViewsContract:()=>Object(C.a)(e),checkGetJobsCapabilities:()=>Object(w.c)(t),loadSavedSearches:C.h});var H=a(5),Y=a.n(H),X=a(81),Q=a(8),K=a(93),Z=a(85),ee=a(27),te=a(106),ae=a(19);const ie="reset",ne={"cluster:admin/xpack/ml/job/delete":"delete","cluster:admin/xpack/ml/job/reset":ie,"cluster:admin/xpack/ml/job/model_snapshots/revert":"revert"};Object.keys(ne);var se=a(28);const oe=new class calendar_service_CalendarService{async assignNewJobId(e,t){const{calendar_id:a}=e;try{await X.ml.updateCalendar({...e,calendarId:a,job_ids:[...e.job_ids,t]})}catch(e){throw new Error(r.i18n.translate("xpack.ml.calendarService.assignNewJobIdErrorMessage",{defaultMessage:"Unable to assign {jobId} to {calendarId}",values:{calendarId:a,jobId:t}}))}}async fetchCalendarsByIds(e){try{const t=await X.ml.calendars({calendarIds:e});return Array.isArray(t)?t:[t]}catch(t){throw new Error(r.i18n.translate("xpack.ml.calendarService.fetchCalendarsByIdsErrorMessage",{defaultMessage:"Unable to fetch calendars: {calendarIds}",values:{calendarIds:e.join(", ")}}))}}};var re=a(6),le=a(4);function ce(e){return new Promise(((t,a)=>{X.ml.jobs.jobs([e]).then((a=>{if(!a.length)throw new Error(`Could not find job ${e}`);t(a[0])})).catch((e=>{a(e)}))}))}function de(e){return new Promise(((t,a)=>{X.ml.jobs.jobForCloning(e).then((a=>{if(!a)throw new Error(`Could not find job ${e}`);t(a)})).catch((e=>{a(e)}))}))}function ue(e){return e.some((e=>e.datafeedState===ae.a.STOPPED&&e.jobState!==ae.c.CLOSING))}function pe(e){return e.some((e=>e.datafeedState===ae.a.STARTED||e.datafeedState===ae.a.STARTING))}function me(e){return e.some((e=>e.datafeedState===ae.a.STOPPED&&e.jobState!==ae.c.CLOSED&&e.jobState!==ae.c.CLOSING))}function be(e){return e.some((e=>{var t;return e.jobState===ae.c.CLOSED||(null===(t=e.blocked)||void 0===t?void 0:t.reason)===ie}))}function fe(e,t=(()=>{})){const a=e.filter((e=>e.hasDatafeed)).map((e=>e.datafeedId));K.a.stopDatafeeds(a).then((e=>{he(e,ae.a.STOPPED),t()})).catch((e=>{Object(ee.n)().addDanger(r.i18n.translate("xpack.ml.jobsList.stopJobErrorMessage",{defaultMessage:"Jobs failed to stop"}),e),t()}))}function he(e,t){const a=[],i=[];for(const n in e)!0===e[n][t]||!1===e[n][t]&&409===e[n].error.statusCode&&t===ae.a.STARTED?a.push(n):i.push({id:n,result:e[n]});let n="",s="";t===ae.a.STARTED?(n=r.i18n.translate("xpack.ml.jobsList.startActionStatusText",{defaultMessage:"start"}),s=r.i18n.translate("xpack.ml.jobsList.startedActionStatusText",{defaultMessage:"started"})):t===ae.a.STOPPED?(n=r.i18n.translate("xpack.ml.jobsList.stopActionStatusText",{defaultMessage:"stop"}),s=r.i18n.translate("xpack.ml.jobsList.stoppedActionStatusText",{defaultMessage:"stopped"})):t===ae.a.DELETED?(n=r.i18n.translate("xpack.ml.jobsList.deleteActionStatusText",{defaultMessage:"delete"}),s=r.i18n.translate("xpack.ml.jobsList.deletedActionStatusText",{defaultMessage:"deleted"})):t===ae.c.CLOSED?(n=r.i18n.translate("xpack.ml.jobsList.closeActionStatusText",{defaultMessage:"close"}),s=r.i18n.translate("xpack.ml.jobsList.closedActionStatusText",{defaultMessage:"closed"})):t===ie&&(n=r.i18n.translate("xpack.ml.jobsList.resetActionStatusText",{defaultMessage:"reset"}),s=r.i18n.translate("xpack.ml.jobsList.resetActionStatusText",{defaultMessage:"reset"}));const o=Object(ee.n)();o.addSuccess(r.i18n.translate("xpack.ml.jobsList.actionExecuteSuccessfullyNotificationMessage",{defaultMessage:"{successesJobsCount, plural, one{{successJob}} other{# jobs}} {actionTextPT} successfully",values:{successesJobsCount:a.length,successJob:a[0],actionTextPT:s}})),i.length>0&&i.forEach((e=>{Object(Z.b)(o).displayErrorToast(e.result.error,r.i18n.translate("xpack.ml.jobsList.actionFailedNotificationMessage",{defaultMessage:"{failureId} failed to {actionText}",values:{failureId:e.id,actionText:n}}))}))}function ge(e,t=(()=>{})){const a=e.map((e=>e.id));K.a.closeJobs(a).then((e=>{he(e,ae.c.CLOSED),t()})).catch((e=>{Object(Z.a)().displayErrorToast(e,r.i18n.translate("xpack.ml.jobsList.closeJobErrorMessage",{defaultMessage:"Jobs failed to close"})),t()}))}function je(e,t){if(0===t.length)return e;const a=e.reduce(((e,t)=>(e[t.id]={job:t,count:0},e)),{});t.forEach((t=>{const i="must"===t.match;let n=[];"term"===t.type?n=!0===i?e.filter((e=>Object(te.g)(e.id,t.value)===i||Object(te.g)(e.description,t.value)===i||Object(te.g)(e.memory_status,t.value)===i)):e.filter((e=>Object(te.g)(e.id,t.value)===i&&Object(te.g)(e.description,t.value)===i&&Object(te.g)(e.memory_status,t.value)===i)):Array.isArray(t.value)?"id"===t.field?n=e.filter((e=>t.value.indexOf(xe(e,t.field))>=0)):"groups"===t.field?n=e.filter((e=>xe(e,t.field).some((e=>t.value.indexOf(e)>=0)))):"job_tags"===t.field&&(n=ve(e,t.value)):n="job_tags"===t.field?n=ve(e,[t.value]):e.filter((e=>xe(e,t.field)===t.value)),n.forEach((e=>a[e.id].count++))}));const i=[];return Object(Q.each)(a,(e=>{e.count>=t.length&&i.push(e.job)})),i}function xe(e,t){return e[{job_state:"jobState",datafeed_state:"datafeedState",groups:"groups",id:"id",job_tags:"jobTags"}[t]]}function ve(e,t){return e.filter((e=>{const a=xe(e,"job_tags");return Object.entries(a).map((e=>e.join(":"))).find((e=>t.some((t=>t===e))))}))}var ye=a(24),Oe=a.n(ye);const Ee=e=>Object(re.isPopulatedObject)(e,["customSettings"])&&!0===e.customSettings.managed||Object(re.isPopulatedObject)(e,["custom_settings"])&&!0===e.custom_settings.managed;function we(e,t,a,i,n,s,o,l,c){const d=Object(w.e)("canCreateJob")&&Object($.e)(),u=Object(w.e)("canUpdateJob"),p=Object(w.e)("canDeleteJob"),m=Object(w.e)("canGetDatafeeds"),b=Object(w.e)("canUpdateDatafeed"),f=Object(w.e)("canStartStopDatafeed")&&Object($.e)(),h=Object(w.e)("canCloseJob")&&Object($.e)(),g=Object(w.e)("canResetJob")&&Object($.e)(),j=Object(w.e)("canCreateMlAlerts");return[{name:r.i18n.translate("xpack.ml.jobsList.managementActions.startDatafeedLabel",{defaultMessage:"Start datafeed"}),description:r.i18n.translate("xpack.ml.jobsList.managementActions.startDatafeedDescription",{defaultMessage:"Start datafeed"}),icon:"play",enabled:e=>!1===Me(e)&&f,available:e=>ue([e]),onClick:e=>{n([e]),Se()},"data-test-subj":"mlActionButtonStartDatafeed"},{name:r.i18n.translate("xpack.ml.jobsList.managementActions.stopDatafeedLabel",{defaultMessage:"Stop datafeed"}),description:r.i18n.translate("xpack.ml.jobsList.managementActions.stopDatafeedDescription",{defaultMessage:"Stop datafeed"}),icon:"stop",enabled:e=>!1===Me(e)&&f,available:e=>pe([e]),onClick:e=>{Ee(e)?o([e]):fe([e],l),Se(!0)},"data-test-subj":"mlActionButtonStopDatafeed"},{name:r.i18n.translate("xpack.ml.jobsList.managementActions.createAlertLabel",{defaultMessage:"Create alert rule"}),description:r.i18n.translate("xpack.ml.jobsList.managementActions.createAlertLabel",{defaultMessage:"Create alert rule"}),icon:"bell",enabled:e=>!1===Me(e),available:()=>j,onClick:e=>{c([e.id]),Se(!0)},"data-test-subj":"mlActionButtonCreateAlert"},{name:r.i18n.translate("xpack.ml.jobsList.managementActions.closeJobLabel",{defaultMessage:"Close job"}),description:r.i18n.translate("xpack.ml.jobsList.managementActions.closeJobDescription",{defaultMessage:"Close job"}),icon:"cross",enabled:e=>!1===Me(e)&&h,available:e=>me([e]),onClick:e=>{Ee(e)?s([e]):ge([e],l),Se(!0)},"data-test-subj":"mlActionButtonCloseJob"},{name:r.i18n.translate("xpack.ml.jobsList.managementActions.resetJobLabel",{defaultMessage:"Reset job"}),description:r.i18n.translate("xpack.ml.jobsList.managementActions.resetJobDescription",{defaultMessage:"Reset job"}),icon:"refresh",enabled:e=>function(e){return void 0===e.blocked||e.blocked.reason===ie}(e)&&g,available:e=>be([e]),onClick:e=>{i([e]),Se(!0)},"data-test-subj":"mlActionButtonResetJob"},{name:r.i18n.translate("xpack.ml.jobsList.managementActions.cloneJobLabel",{defaultMessage:"Clone job"}),description:r.i18n.translate("xpack.ml.jobsList.managementActions.cloneJobDescription",{defaultMessage:"Clone job"}),icon:"copy",enabled:e=>!1===Me(e)&&d,onClick:e=>{!async function(e){try{var t;const[{job:i,datafeed:n},s]=await Promise.all([de(e),ce(e)]),o=await Object(C.e)(),l=n.indices.join(",");if(!1===o.includes(l)){const t=r.i18n.translate("xpack.ml.jobsList.managementActions.noSourceDataViewForClone",{defaultMessage:"Unable to clone the anomaly detection job {jobId}. No data view exists for index {dataViewTitle}.",values:{jobId:e,dataViewTitle:l}});return void Object(Z.a)().displayDangerToast(t,{"data-test-subj":"mlCloneJobNoDataViewExistsWarningToast"})}var a;if(void 0!==i&&void 0!==(null==s||null===(t=s.custom_settings)||void 0===t?void 0:t.created_by)){if(K.a.tempJobCloningObjects.createdBy=null==s||null===(a=s.custom_settings)||void 0===a?void 0:a.created_by,K.a.tempJobCloningObjects.job=i,void 0!==s.data_counts.earliest_record_timestamp&&void 0!==s.data_counts.latest_record_timestamp&&void 0!==s.data_counts.latest_bucket_timestamp){let e=s.data_counts.earliest_record_timestamp,t=s.data_counts.latest_record_timestamp;if(void 0!==s.datafeed_config.aggregations){const a=Object(se.a)(s.analysis_config.bucket_span).asMilliseconds();e=Math.floor(s.data_counts.earliest_record_timestamp/a)*a,t=s.data_counts.latest_bucket_timestamp+2*a-1}K.a.tempJobCloningObjects.start=e,K.a.tempJobCloningObjects.end=t}}else K.a.tempJobCloningObjects.job=i,K.a.tempJobCloningObjects.createdBy=void 0;void 0!==n&&(K.a.tempJobCloningObjects.datafeed=n),s.calendars&&(K.a.tempJobCloningObjects.calendars=await oe.fetchCalendarsByIds(s.calendars)),Object(ee.b)().navigateToApp(le.e,{path:E.b.ANOMALY_DETECTION_CREATE_JOB})}catch(t){Object(Z.a)().displayErrorToast(t,r.i18n.translate("xpack.ml.jobsList.cloneJobErrorMessage",{defaultMessage:"Could not clone {jobId}. Job could not be found",values:{jobId:e}}))}}(e.id),Se(!0)},"data-test-subj":"mlActionButtonCloneJob"},{name:r.i18n.translate("xpack.ml.jobsList.managementActions.viewDatafeedCountsLabel",{defaultMessage:"View datafeed counts"}),description:r.i18n.translate("xpack.ml.jobsList.managementActions.viewDatafeedCountsDescription",{defaultMessage:"View datafeed counts"}),icon:"visAreaStacked",enabled:()=>m,available:()=>m,onClick:e=>{t(e),Se()},"data-test-subj":"mlActionButtonViewDatafeedChart"},{name:r.i18n.translate("xpack.ml.jobsList.managementActions.editJobLabel",{defaultMessage:"Edit job"}),description:r.i18n.translate("xpack.ml.jobsList.managementActions.editJobDescription",{defaultMessage:"Edit job"}),icon:"pencil",enabled:e=>!1===Me(e)&&u&&b,onClick:t=>{e(t),Se()},"data-test-subj":"mlActionButtonEditJob"},{name:r.i18n.translate("xpack.ml.jobsList.managementActions.deleteJobLabel",{defaultMessage:"Delete job"}),description:r.i18n.translate("xpack.ml.jobsList.managementActions.deleteJobDescription",{defaultMessage:"Delete job"}),icon:"trash",color:"danger",enabled:()=>p,onClick:e=>{a([e]),Se()},"data-test-subj":"mlActionButtonDeleteJob"}]}function Me(e){return void 0!==e.blocked}function Se(e=!1){e?document.querySelector(".euiTable").click():window.setTimeout((()=>{const e=document.querySelector(".euiModalBody");e?e.click():document.querySelector(".euiTable").click()}),500)}const _e="ml:anomalyDetection:results:timeDefaults",Te=()=>{const{services:{http:{basePath:e}}}=Object(y.b)(),t=Object(y.h)().get("ml:anomalyDetection:results:enableTimeDefaults"),a=Object(y.h)().get(_e);return{createLinkWithUserDefaults:Object(n.useCallback)(((i,n)=>{const s=K.a.createResultsUrlForJobs(n,i,!0===t&&void 0!==a?a:void 0);return`${e.get()}/app/ml/${s}`}),[e])}};function Ce({jobs:e}){const t=r.i18n.translate("xpack.ml.jobsList.resultActions.openJobsInSingleMetricViewerText",{defaultMessage:"Open {jobsCount, plural, one {{jobId}} other {# jobs}} in Single Metric Viewer",values:{jobsCount:e.length,jobId:e[0].id}}),a=r.i18n.translate("xpack.ml.jobsList.resultActions.openJobsInAnomalyExplorerText",{defaultMessage:"Open {jobsCount, plural, one {{jobId}} other {# jobs}} in Anomaly Explorer",values:{jobsCount:e.length,jobId:e[0].id}}),i=e.length<2,s=1===e.length&&e[0].isSingleMetricViewerJob,l=1===e.length&&e[0].isNotSingleMetricViewerJobMessage,c=void 0!==l?r.i18n.translate("xpack.ml.jobsList.resultActions.singleMetricDisabledMessageText",{defaultMessage:"Disabled because {reason}.",values:{reason:l}}):void 0,d=1===e.length&&void 0!==e[0].blocked,{createLinkWithUserDefaults:u}=Te(),p=Object(n.useMemo)((()=>u("timeseriesexplorer",e)),[e]),m=Object(n.useMemo)((()=>u("explorer",e)),[e]);return Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",justifyContent:"flexEnd",alignItems:"center",wrap:!1,direction:"row",responsive:!1},i&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiToolTip,{position:"bottom",content:null!=c?c:t},Object(g.jsx)(o.EuiButtonIcon,{href:p,iconType:"visLine","aria-label":t,isDisabled:!1===s||!0===d,"data-test-subj":"mlOpenJobsInSingleMetricViewerButton"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiToolTip,{position:"bottom",content:a},Object(g.jsx)(o.EuiButtonIcon,{href:m,iconType:"visTable","aria-label":a,isDisabled:!0===d,"data-test-subj":"mlOpenJobsInAnomalyExplorerButton"}))))}var ke=a(213);function Fe({job:e}){return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",{className:"job-description"},e.description,"  ",e.groups.map((e=>Object(g.jsx)(ke.a,{key:e,name:e})))))}const[Ie,De,Ae]=["info","warning","error"],Le=({message:e,showTooltip:t=!1})=>{if(void 0===e)return Object(g.jsx)("span",null);let a="primary",i="alert";return e.level===Ie?i="iInCircle":e.level===De?a="warning":e.level===Ae&&(a="danger"),t?Object(g.jsx)(o.EuiToolTip,{position:"bottom",content:e.text},Object(g.jsx)(o.EuiIcon,{type:i,color:a})):Object(g.jsx)(o.EuiIcon,{type:i,color:a})};var Re=a(148),Ne=a(275);const Pe=[10,25,50];class jobs_list_JobsList extends n.Component{constructor(e){super(e),Y()(this,"onTableChange",(({page:e={},sort:t={}})=>{const{index:a,size:i}=e,{field:n,direction:s}=t;this.props.onJobsViewStateUpdate({pageIndex:a,pageSize:i,sortField:n,sortDirection:s})})),Y()(this,"toggleRow",(e=>{this.props.toggleRow(e.id)})),this.state={jobsSummaryList:e.jobsSummaryList,itemIdToExpandedRowMap:{}}}static getDerivedStateFromProps(e){return{itemIdToExpandedRowMap:e.itemIdToExpandedRowMap,jobsSummaryList:e.jobsSummaryList}}getJobIdLink(e){return!1===this.props.isMlEnabledInSpace?e:Object(g.jsx)(Ne.a,{key:e,id:e})}getPageOfJobs(e,t,a,i){let n=this.state.jobsSummaryList;n=Object(Q.sortBy)(this.state.jobsSummaryList,(e=>e[a])),n="asc"===i?n:n.reverse();const s=n.length;let o=e*t;return o>=s&&0!==s&&(o=Math.floor((s-1)/t)*t,setTimeout((()=>{this.props.onJobsViewStateUpdate({pageIndex:o/t})}),0)),{pageOfItems:n.slice(o,o+t),totalItemCount:s}}render(){const{loading:e}=this.props,t={selectable:e=>void 0===e.blocked,selectableMessage:(e,t)=>!1===e?r.i18n.translate("xpack.ml.jobsList.cannotSelectRowForJobMessage",{defaultMessage:"Cannot select job ID {jobId}",values:{jobId:t.id}}):r.i18n.translate("xpack.ml.jobsList.selectRowForJobMessage",{defaultMessage:"Select the row for job ID {jobId}",values:{jobId:t.id}}),onSelectionChange:this.props.selectJobChange},a=[{name:Object(g.jsx)(o.EuiScreenReaderOnly,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.showDetailsColumn.screenReaderDescription",defaultMessage:"This column contains clickable controls for showing more details on each job"}))),"data-test-subj":"mlJobListColumnExpand",render:e=>Object(g.jsx)(o.EuiButtonIcon,{onClick:()=>this.toggleRow(e),isDisabled:void 0!==e.blocked,iconType:this.state.itemIdToExpandedRowMap[e.id]?"arrowDown":"arrowRight","aria-label":this.state.itemIdToExpandedRowMap[e.id]?r.i18n.translate("xpack.ml.jobsList.collapseJobDetailsAriaLabel",{defaultMessage:"Hide details for {itemId}",values:{itemId:e.id}}):r.i18n.translate("xpack.ml.jobsList.expandJobDetailsAriaLabel",{defaultMessage:"Show details for {itemId}",values:{itemId:e.id}}),"data-row-id":e.id,"data-test-subj":"mlJobListRowDetailsToggle"}),width:"3%"},{field:"id","data-test-subj":"mlJobListColumnId",name:r.i18n.translate("xpack.ml.jobsList.idLabel",{defaultMessage:"ID"}),sortable:!0,truncateText:!1,width:"15%",scope:"row",render:(e,t)=>Ee(t)?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("span",null,e,"  ",Object(g.jsx)(o.EuiToolTip,{content:r.i18n.translate("xpack.ml.jobsList.managedBadgeTooltip",{defaultMessage:"This job is preconfigured and managed by Elastic; other parts of the product might have might have dependencies on its behavior."})},Object(g.jsx)(o.EuiBadge,{color:"hollow","data-test-subj":"mlJobListRowManagedLabel",size:"xs"},r.i18n.translate("xpack.ml.jobsList.managedBadgeLabel",{defaultMessage:"Managed"}))))):e},{field:"auditMessage","data-test-subj":"mlJobListColumnIcons",name:Object(g.jsx)(o.EuiScreenReaderOnly,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.auditMessageColumn.screenReaderDescription",defaultMessage:"This column displays icons when there are errors or warnings for the job in the past 24 hours"}))),render:e=>Object(g.jsx)(Le,{message:e,showTooltip:!0})},{field:"alertingRules","data-test-subj":"mlJobListColumnAlertingRuleIndicator",name:Object(g.jsx)(o.EuiScreenReaderOnly,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.alertingRules.screenReaderDescription",defaultMessage:"This column displays icons when there are alert rules associated with a job"}))),width:"30px",render:e=>Array.isArray(e)?Object(g.jsx)(o.EuiToolTip,{position:"bottom",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.alertingRules.tooltipContent",defaultMessage:"Job has {rulesCount} associated alert {rulesCount, plural, one { rule} other { rules}}",values:{rulesCount:e.length}})},Object(g.jsx)(o.EuiIcon,{type:"bell"})):Object(g.jsx)("span",null)},{name:r.i18n.translate("xpack.ml.jobsList.descriptionLabel",{defaultMessage:"Description"}),sortable:!0,field:"description","data-test-subj":"mlJobListColumnDescription",render:(e,t)=>Object(g.jsx)(Fe,{job:t}),textOnly:!0,width:"20%"},{field:"processed_record_count","data-test-subj":"mlJobListColumnRecordCount",name:r.i18n.translate("xpack.ml.jobsList.processedRecordsLabel",{defaultMessage:"Processed records"}),sortable:!0,truncateText:!1,dataType:"number",render:e=>Object(te.h)(e),width:"10%"},{field:"memory_status","data-test-subj":"mlJobListColumnMemoryStatus",name:r.i18n.translate("xpack.ml.jobsList.memoryStatusLabel",{defaultMessage:"Memory status"}),sortable:!0,truncateText:!1,width:"5%"},{field:"jobState","data-test-subj":"mlJobListColumnJobState",name:r.i18n.translate("xpack.ml.jobsList.jobStateLabel",{defaultMessage:"Job state"}),sortable:!0,truncateText:!1,width:"8%"},{field:"datafeedState","data-test-subj":"mlJobListColumnDatafeedState",name:r.i18n.translate("xpack.ml.jobsList.datafeedStateLabel",{defaultMessage:"Datafeed state"}),sortable:!0,truncateText:!1,width:"8%"},{name:r.i18n.translate("xpack.ml.jobsList.latestTimestampLabel",{defaultMessage:"Latest timestamp"}),truncateText:!1,field:"latestTimestampSortValue","data-test-subj":"mlJobListColumnLatestTimestamp",sortable:!0,render:(e,t)=>Object(g.jsx)("span",{className:"euiTableCellContent__text"},void 0===t.latestTimestampMs?"":Oe()(t.latestTimestampMs).format(Re.a)),textOnly:!0,width:"15%"},{name:Object(g.jsx)(o.EuiScreenReaderOnly,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.jobActionsColumn.screenReaderDescription",defaultMessage:"This column contains extra actions in a menu that can be performed on each job"}))),render:e=>Object(g.jsx)(Ce,{jobs:[e]}),width:"64px"},{name:r.i18n.translate("xpack.ml.jobsList.actionsLabel",{defaultMessage:"Actions"}),actions:we(this.props.showEditJobFlyout,this.props.showDatafeedChartFlyout,this.props.showDeleteJobModal,this.props.showResetJobModal,this.props.showStartDatafeedModal,this.props.showCloseJobsConfirmModal,this.props.showStopDatafeedsConfirmModal,this.props.refreshJobs,this.props.showCreateAlertFlyout),width:"5%"}],{pageIndex:i,pageSize:n,sortField:l,sortDirection:c}=this.props.jobsViewState,{pageOfItems:d,totalItemCount:u}=this.getPageOfJobs(i,n,l,c),p={pageIndex:i,pageSize:n,totalItemCount:u,pageSizeOptions:Pe},b={sort:{field:l,direction:c}},f=this.props.selectedJobsCount?"jobs-selected":"";return Object(g.jsx)(o.EuiBasicTable,{"data-test-subj":e?"mlJobListTable loading":"mlJobListTable loaded",loading:!0===e,noItemsMessage:e?r.i18n.translate("xpack.ml.jobsList.loadingJobsLabel",{defaultMessage:"Loading jobs…"}):r.i18n.translate("xpack.ml.jobsList.noJobsFoundLabel",{defaultMessage:"No jobs found"}),itemId:"id",className:`jobs-list-table ${f}`,items:d,columns:a,pagination:p,onChange:this.onTableChange,selection:t,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,isExpandable:!0,sorting:b,hasActions:!0,rowProps:e=>({"data-test-subj":`mlJobListRow row-${e.id}`})})}}jobs_list_JobsList.defaultProps={isMlEnabledInSpace:!0,loading:!1};var ze=a(61),Be=a.n(ze);function Ve(e,t=2){if(void 0===e)return"";if(e%1==0)return e;if(Math.abs(e)<Math.pow(10,-t))return Number.parseFloat(String(e)).toExponential(2);const a=Math.pow(10,t);return Math.round(e*a)/a}var Je=a(95);function Ue(e){if(!e)return["",""];const[t,a]=e;switch(t){case"finished_time":case"create_time":case"log_time":case"timestamp":case"earliest_record_timestamp":case"latest_record_timestamp":case"last_data_time":case"latest_empty_bucket_timestamp":case"latest_sparse_bucket_timestamp":case"latest_bucket_timestamp":return[t,Object(Je.e)(a)];case"established_model_memory":case"input_bytes":case"model_bytes":case"model_bytes_exceeded":case"model_bytes_memory_limit":case"peak_model_bytes":return[t,(i=a,Be()(i).format("0.0 b"))];case"processed_record_count":case"processed_field_count":case"input_field_count":case"invalid_date_count":case"missing_field_count":case"out_of_order_timestamp_count":case"empty_bucket_count":case"sparse_bucket_count":case"bucket_count":case"input_record_count":case"total_by_field_count":case"total_over_field_count":case"total_partition_field_count":case"bucket_allocation_failures_count":case"search_count":return[t,Object(te.h)(a)];case"average_search_time_per_bucket_ms":case"exponential_average_search_time_per_hour_ms":case"total_bucket_processing_time_ms":case"minimum_bucket_processing_time_ms":case"maximum_bucket_processing_time_ms":case"average_bucket_processing_time_ms":case"exponential_average_bucket_processing_time_ms":case"exponential_average_bucket_processing_time_per_hour_ms":return[t,"number"==typeof a?Ve(a,3).toLocaleString():a];case"managed":return[t,a.toString()];default:return[t,a]}var i}function Ge(e,t,a){return Object.keys(e).filter((i=>a||"object"!=typeof e[i]||t&&Array.isArray(e[i]))).map((t=>{let a=e[t];return Array.isArray(a)?a=a.join(", "):"object"==typeof e[t]&&(a=JSON.stringify(a)),[t,a]}))}var qe=a(11);const $e=({initialAlert:e,jobIds:t,onCloseFlyout:a,onSave:i})=>{const{services:{triggersActionsUi:o}}=Object(y.b)(),r=Object(n.useMemo)((()=>{if(!o)return;const n={onClose:()=>{a()},onSave:async()=>{i&&i()}};var s;return e?o.getEditAlertFlyout({...n,initialRule:{...e,ruleTypeId:null!==(s=e.ruleTypeId)&&void 0!==s?s:e.alertTypeId}}):o.getAddAlertFlyout({...n,consumer:le.e,canChangeTrigger:!1,ruleTypeId:qe.d.ANOMALY_DETECTION,metadata:{},initialValues:{params:{jobSelection:{jobIds:t}}}})}),[o,null==e?void 0:e.id,t]);return Object(g.jsx)(s.a.Fragment,null,r)},We=({setShowFunction:e,unsetShowFunction:t,onSave:a})=>{const[i,s]=Object(n.useState)(!1),[o,r]=Object(n.useState)(),l=Object(n.useCallback)((e=>{r(e),s(!0)}),[]);return Object(n.useEffect)((()=>(e(l),()=>{t()})),[]),i&&o?Object(g.jsx)($e,{jobIds:o,onCloseFlyout:()=>s(!1),onSave:()=>{s(!1),a()}}):null},He=({initialAlert:e,onSave:t})=>{const[a,i]=Object(n.useState)(!1);return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiButtonEmpty,{size:"xs",onClick:i.bind(null,!a)},e.name),a?Object(g.jsx)($e,{initialAlert:e,onCloseFlyout:i.bind(null,!1),onSave:()=>{i(!1),t()}}):null)};var Ye=a(143);function Xe({job:e}){const t=JSON.stringify(e,null,2);return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(Ye.a,{value:t,readOnly:!0,mode:Ye.b.XJSON}))}var Qe=a(88);class datafeed_preview_tab_DatafeedPreviewPane extends n.Component{constructor(e){super(e),this.state={previewJson:"",loading:!0,canPreviewDatafeed:!0}}renderContent(){const{previewJson:e,loading:t,canPreviewDatafeed:a}=this.state;return!1===a?Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.noPermissionToViewDatafeedPreviewTitle",defaultMessage:"You do not have permission to view the datafeed preview"}),color:"warning",iconType:"alert"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.pleaseContactYourAdministratorLabel",defaultMessage:"Please contact your administrator"}))):!0===t?Object(g.jsx)(o.EuiLoadingSpinner,{size:"xl"}):Object(g.jsx)(Ye.a,{value:e,readOnly:!0})}componentDidMount(){const e=Object(w.e)("canPreviewDatafeed")&&void 0!==this.props.job.datafeed_config;this.setState({canPreviewDatafeed:e}),function(e,t){return new Promise(((a,i)=>{t&&X.ml.jobs.datafeedPreview(e.datafeed_config.datafeed_id).then((e=>{Array.isArray(e)?a(JSON.stringify(e.slice(0,Qe.a),null,2)):(a(""),console.log("Datafeed preview could not be loaded",e))})).catch((e=>{i(e)}))}))}(this.props.job,e).then((e=>{this.setState({previewJson:e,loading:!1})})).catch((e=>{console.log("Datafeed preview could not be loaded",e),this.setState({loading:!1})}))}render(){return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),this.renderContent())}}var Ke=a(226),Ze=a.n(Ke),et=a(63),tt=a(191),at=a(23);const it={rowMouseenter$:new at.Subject,rowMouseleave$:new at.Subject};var nt=a(110),st=a(154);let ot;!function(e){e.ANNOTATION="annotation",e.COMMENT="comment"}(ot||(ot={}));const rt=1e3,lt="user",ct=Object(n.createContext)(new st.a);var dt=a(49),ut=a(125),pt=a(7),mt=a(136);const bt=Object(dt.timeFormatter)(Object(dt.niceTimeFormatByDay)(3));function ft(e){return(Math.round(100*e)/100).toString()}const ht=({chartData:e})=>{const t=function(e){const t=!1;if(void 0===e)return{fit:t,min:NaN,max:NaN};if(0===e.length)return{min:0,max:0,fit:t};let a=Number.MIN_VALUE,i=Number.MAX_VALUE;e.forEach((e=>{a=Math.max(e.value,a),i=Math.min(e.value,i)}));const n=.1*(a-i);return a+=n,i-=n,{min:i,max:a,fit:t}}(e);return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(dt.Axis,{id:"bottom",position:dt.Position.Bottom,showOverlappingTicks:!0,tickFormat:bt}),Object(g.jsx)(dt.Axis,{id:"left",position:dt.Position.Left,tickFormat:ft,domain:t}))};var gt=a(58),jt=a(47),xt=a(103),vt=a(134);const yt=e=>{const t={term:{_tier:{value:"data_frozen"}}};if(!e)return{bool:{must_not:[t]}};const a=Object(Q.cloneDeep)(e);return delete a.match_all,Object(re.isPopulatedObject)(a.bool)?Array.isArray(a.bool.must_not)?a.bool.must_not.push(t):(Object(re.isPopulatedObject)(a.bool.must_not)&&(a.bool.must_not=[a.bool.must_not,t]),void 0===a.bool.must_not&&(a.bool.must_not=[t])):a.bool={must_not:[t]},a};var Ot=a(145);const Et=250;class job_runner_JobRunner{constructor(e){Y()(this,"_jobId",void 0),Y()(this,"_datafeedId",void 0),Y()(this,"_start",0),Y()(this,"_end",0),Y()(this,"_datafeedState",ae.a.STOPPED),Y()(this,"_refreshInterval",Et),Y()(this,"_progress$",void 0),Y()(this,"_percentageComplete",0),Y()(this,"_stopRefreshPoll",void 0),Y()(this,"_subscribers",void 0),Y()(this,"_datafeedStartTime",0),Y()(this,"_performRefreshRateAdjustment",!1),Y()(this,"_jobAssignedToNode",!1),Y()(this,"_jobAssignedToNode$",void 0),this._jobId=e.jobId,this._datafeedId=e.datafeedId,this._start=e.start,this._end=e.end,this._percentageComplete=0,this._stopRefreshPoll=e.stopAllRefreshPolls,this._progress$=new at.BehaviorSubject(this._percentageComplete),this._jobAssignedToNode$=new at.BehaviorSubject(this._jobAssignedToNode),this._subscribers=e.subscribers}get datafeedState(){return this._datafeedState}set refreshInterval(e){this._refreshInterval=e}resetInterval(){this._refreshInterval=Et}async openJob(){try{const{node:e}=await K.a.openJob(this._jobId);this._jobAssignedToNode=void 0!==e&&e.length>0,this._jobAssignedToNode$.next(this._jobAssignedToNode)}catch(e){throw e}}async _startDatafeed(e,t,a){try{this._datafeedStartTime=Date.now();const i=!0===a?this._subscribers.map((e=>this._progress$.subscribe(e))):[];await this.openJob();const{started:n}=await K.a.startDatafeed(this._datafeedId,this._jobId,e,t);this._datafeedState=ae.a.STARTED,this._percentageComplete=0;const s=async()=>{const{isRunning:e,progress:t,isJobClosed:a}=await this.getProgress(),n=100!==t||!0!==e&&!1!==a?t:t-1;this._adjustRefreshInterval(n),this._percentageComplete=n,this._progress$.next(this._percentageComplete),!0!==e&&!1!==a||!1!==this._stopRefreshPoll.stop?(this._progress$.next(100),i.forEach((e=>e.unsubscribe()))):setTimeout((async()=>{!1===this._stopRefreshPoll.stop&&await s()}),this._refreshInterval)},o=async()=>{this._jobAssignedToNode=await this._isJobAssigned(),this._jobAssignedToNode$.next(this._jobAssignedToNode),!0===this._jobAssignedToNode?await s():setTimeout((async()=>{!1===this._stopRefreshPoll.stop&&await o()}),2e3)};return!0===a&&(!0===this._jobAssignedToNode?await s():await o()),n}catch(e){throw e}}_adjustRefreshInterval(e){if(!1===this._performRefreshRateAdjustment){if(!(Date.now()-this._datafeedStartTime>2e3))return;this._performRefreshRateAdjustment=!0}const t=e-this._percentageComplete;0!==t&&(this._refreshInterval=Math.floor(this._refreshInterval*(2/t)),this._refreshInterval<Et&&(this._refreshInterval=Et))}async _isJobAssigned(){const{jobs:e}=await X.ml.getJobStats({jobId:this._jobId});return e.length>0&&void 0!==e[0].node}async startDatafeed(){return await this._startDatafeed(this._start,this._end,!0)}async startDatafeedInRealTime(e){const t=e?this._end:this._start;return await this._startDatafeed(t,void 0,!1)}async getProgress(){return await X.ml.jobs.getLookBackProgress(this._jobId,this._start,this._end)}subscribeToProgress(e){this._progress$.subscribe(e)}async isRunning(){const{isRunning:e}=await this.getProgress();return e}isJobAssignedToNode(){return this._jobAssignedToNode}subscribeToJobAssignment(e){return this._jobAssignedToNode$.subscribe(e)}}var wt=a(91),Mt=a(101);function St(e,t){if(!Object(re.isPopulatedObject)(t,["runtime_mappings"])||!Object(re.isPopulatedObject)(t.runtime_mappings))return{runtime_mappings:{},discarded_mappings:{}};const a=function(e,t){var a;const i=new Set;e.analysis_config.detectors.forEach((e=>{void 0!==e.field_name&&i.add(e.field_name),void 0!==e.by_field_name&&i.add(e.by_field_name),void 0!==e.over_field_name&&i.add(e.over_field_name),void 0!==e.partition_field_name&&i.add(e.partition_field_name)})),void 0!==e.analysis_config.categorization_field_name&&i.add(e.analysis_config.categorization_field_name),void 0!==e.analysis_config.summary_count_field_name&&i.add(e.analysis_config.summary_count_field_name),void 0!==e.analysis_config.influencers&&e.analysis_config.influencers.forEach((e=>i.add(e)));const n=null!==(a=t.aggregations)&&void 0!==a?a:t.aggs;void 0!==n&&_t(n).forEach((e=>i.add(e)));const s=t.query;return void 0!==s&&Tt(s).forEach((e=>i.add(e))),[...i]}(e,t),{runtimeMappings:i,discardedMappings:n}=(s=t.runtime_mappings,{runtimeMappings:(o=a).reduce(((e,t)=>(void 0!==s[t]&&(e[t]=s[t]),e)),{}),discardedMappings:Object.keys(s).reduce(((e,t)=>(!1===o.includes(t)&&void 0!==s[t]&&(e[t]=s[t]),e)),{})});var s,o;return{runtime_mappings:i,discarded_mappings:n}}function _t(e){const t=[];return Object.entries(e).forEach((([e,a])=>{Object(re.isPopulatedObject)(a)?t.push(..._t(a)):"string"==typeof a&&"field"===e&&t.push(a)})),t}function Tt(e){const t=[];return Object.entries(e).forEach((([e,a])=>{Object(re.isPopulatedObject)(a)?(t.push(e),t.push(...Tt(a))):"string"==typeof a?t.push(a):t.push(e)})),t}var Ct=a(220),kt=a(272);class job_creator_JobCreator{constructor(e,t,a){Y()(this,"_type",wt.f.SINGLE_METRIC),Y()(this,"_indexPattern",void 0),Y()(this,"_savedSearch",void 0),Y()(this,"_indexPatternTitle",""),Y()(this,"_indexPatternDisplayName",""),Y()(this,"_job_config",void 0),Y()(this,"_calendars",void 0),Y()(this,"_datafeed_config",void 0),Y()(this,"_detectors",void 0),Y()(this,"_influencers",void 0),Y()(this,"_bucketSpanMs",0),Y()(this,"_useDedicatedIndex",!1),Y()(this,"_start",0),Y()(this,"_end",0),Y()(this,"_subscribers",[]),Y()(this,"_aggs",[]),Y()(this,"_fields",[]),Y()(this,"_scriptFields",[]),Y()(this,"_runtimeFields",[]),Y()(this,"_runtimeMappings",null),Y()(this,"_filterRuntimeMappingsOnSave",!0),Y()(this,"_aggregationFields",[]),Y()(this,"_sparseData",!1),Y()(this,"_stopAllRefreshPolls",{stop:!1}),Y()(this,"_wizardInitialized$",new at.BehaviorSubject(!1)),Y()(this,"wizardInitialized$",this._wizardInitialized$.asObservable()),this._indexPattern=e,this._savedSearch=t;const i=this._indexPattern.title,n=this._indexPattern.getName();this._indexPatternDisplayName=n===i?n:`${n} (${i})`,this._indexPatternTitle=i,this._job_config=Object(Ot.c)(),this._calendars=[],this._datafeed_config=Object(Ot.b)(this._indexPatternTitle),this._detectors=this._job_config.analysis_config.detectors,this._influencers=this._job_config.analysis_config.influencers,"string"==typeof e.timeFieldName&&(this._job_config.data_description.time_field=e.timeFieldName),this._extractRuntimeMappings(),this._datafeed_config.query=a}get type(){return this._type}get indexPatternTitle(){return this._indexPatternTitle}get indexPatternDisplayName(){return this._indexPatternDisplayName}_addDetector(e,t,a){this._detectors.push(e),this._aggs.push(t),this._fields.push(a),this._updateSparseDataDetectors()}_editDetector(e,t,a,i){void 0!==this._detectors[i]&&(this._detectors[i]=e,this._aggs[i]=t,this._fields[i]=a,this._updateSparseDataDetectors())}_removeDetector(e){this._detectors.splice(e,1),this._aggs.splice(e,1),this._fields.splice(e,1)}removeAllDetectors(){this._detectors.length=0,this._aggs.length=0,this._fields.length=0}get detectors(){return this._detectors}get aggregationsInDetectors(){return this._aggs}getAggregation(e){const t=this._aggs[e];return void 0!==t?t:null}get aggregations(){return this._aggs}getField(e){const t=this._fields[e];return void 0!==t?t:null}get fields(){return this._fields}set bucketSpan(e){this._job_config.analysis_config.bucket_span=e,this._setBucketSpanMs(e)}get bucketSpan(){return this._job_config.analysis_config.bucket_span}_setBucketSpanMs(e){const t=Object(se.a)(e,!0);this._bucketSpanMs=null===t?0:t.asMilliseconds()}get bucketSpanMs(){return this._bucketSpanMs}addInfluencer(e){!1===this._influencers.includes(e)&&this._influencers.push(e)}removeInfluencer(e){const t=this._influencers.indexOf(e);-1!==t&&this._influencers.splice(t,1)}removeAllInfluencers(){this._influencers.length=0}get influencers(){return this._influencers}set jobId(e){this._job_config.job_id=e,this._datafeed_config.job_id=e,this._datafeed_config.datafeed_id=`datafeed-${e}`,this._useDedicatedIndex&&(this._job_config.results_index_name=e)}get jobId(){return this._job_config.job_id}get datafeedId(){return this._datafeed_config.datafeed_id}set description(e){this._job_config.description=e}get description(){var e;return null!==(e=this._job_config.description)&&void 0!==e?e:""}get groups(){var e;return null!==(e=this._job_config.groups)&&void 0!==e?e:[]}set groups(e){this._job_config.groups=e}get calendars(){return this._calendars}set calendars(e){this._calendars=e}_initModelPlotConfig(){void 0===this._job_config.model_plot_config&&(this._job_config.model_plot_config={enabled:!1}),void 0!==this._job_config.model_plot_config&&void 0===this._job_config.model_plot_config.enabled&&(this._job_config.model_plot_config.enabled=!1),void 0!==this._job_config.model_plot_config&&void 0===this._job_config.model_plot_config.annotations_enabled&&(this._job_config.model_plot_config.annotations_enabled=!1)}set modelPlot(e){this._initModelPlotConfig(),this._job_config.model_plot_config.enabled=e}get modelPlot(){return void 0!==this._job_config.model_plot_config&&!0===this._job_config.model_plot_config.enabled}set modelChangeAnnotations(e){this._initModelPlotConfig(),this._job_config.model_plot_config.annotations_enabled=e}get modelChangeAnnotations(){var e;return!0===(null===(e=this._job_config.model_plot_config)||void 0===e?void 0:e.annotations_enabled)}set useDedicatedIndex(e){this._useDedicatedIndex=e,e?this._job_config.results_index_name=this._job_config.job_id:delete this._job_config.results_index_name}get useDedicatedIndex(){return this._useDedicatedIndex}set modelMemoryLimit(e){null!==e?this._job_config.analysis_limits={model_memory_limit:e}:delete this._job_config.analysis_limits}get modelMemoryLimit(){return this._job_config.analysis_limits&&void 0!==this._job_config.analysis_limits.model_memory_limit?this._job_config.analysis_limits.model_memory_limit:null}set summaryCountFieldName(e){null!==e?this._job_config.analysis_config.summary_count_field_name=e:delete this._job_config.analysis_config.summary_count_field_name}get summaryCountFieldName(){return this._job_config.analysis_config.summary_count_field_name||null}set categorizationFieldName(e){null!==e?this._job_config.analysis_config.categorization_field_name=e:delete this._job_config.analysis_config.categorization_field_name}get categorizationFieldName(){return this._job_config.analysis_config.categorization_field_name||null}addCategorizationFilter(e){void 0===this._job_config.analysis_config.categorization_filters&&(this._job_config.analysis_config.categorization_filters=[]);const t=this._job_config.analysis_config.categorization_filters;!1===t.includes(e)&&t.push(e)}removeCategorizationFilter(e){const t=this._job_config.analysis_config.categorization_filters;if(void 0!==t){const a=t.indexOf(e);-1!==a&&t.splice(a,1),0===t.length&&this.removeCategorizationFilters()}}removeCategorizationFilters(){delete this._job_config.analysis_config.categorization_filters}get categorizationFilters(){return this._job_config.analysis_config.categorization_filters||null}get timeFieldName(){return this._job_config.data_description.time_field}set timeFieldName(e){this._job_config.data_description.time_field=e}get sparseData(){return this._sparseData}set sparseData(e){this._sparseData=e,this._updateSparseDataDetectors()}_updateSparseDataDetectors(){this._detectors.forEach(((e,t)=>{if(void 0!==this._aggs[t])switch(this._aggs[t].id){case xt.b.COUNT:e.function=this._sparseData?xt.b.NON_ZERO_COUNT:xt.b.COUNT;break;case xt.b.HIGH_COUNT:e.function=this._sparseData?xt.b.HIGH_NON_ZERO_COUNT:xt.b.HIGH_COUNT;break;case xt.b.LOW_COUNT:e.function=this._sparseData?xt.b.LOW_NON_ZERO_COUNT:xt.b.LOW_COUNT;break;case xt.b.SUM:e.function=this._sparseData?xt.b.NON_NULL_SUM:xt.b.SUM;break;case xt.b.HIGH_SUM:e.function=this._sparseData?xt.b.HIGH_NON_NULL_SUM:xt.b.HIGH_SUM;break;case xt.b.LOW_SUM:e.function=this._sparseData?xt.b.LOW_NON_NULL_SUM:xt.b.LOW_SUM}}))}async _updateCalendars(){if(0!==this._calendars.length)for(const e of this._calendars)await oe.assignNewJobId(e,this.jobId)}setTimeRange(e,t){this._start=e,this._end=t}get start(){return this._start}get end(){return this._end}get query(){return this._datafeed_config.query}set query(e){this._datafeed_config.query=e}get queryDelay(){return this._datafeed_config.query_delay||null}set queryDelay(e){null!==e?this._datafeed_config.query_delay=e:delete this._datafeed_config.query_delay}get frequency(){return this._datafeed_config.frequency||null}set frequency(e){null!==e?this._datafeed_config.frequency=e:delete this._datafeed_config.frequency}get scrollSize(){return this._datafeed_config.scroll_size||null}set scrollSize(e){null!==e?this._datafeed_config.scroll_size=e:delete this._datafeed_config.scroll_size}get indices(){return this._datafeed_config.indices}set indices(e){this._datafeed_config.indices=e}get scriptFields(){return this._scriptFields}get runtimeMappings(){return this._runtimeMappings}get runtimeFields(){return this._runtimeFields}get aggregationFields(){return this._aggregationFields}get additionalFields(){return[...this._scriptFields,...this._runtimeFields,...this._aggregationFields]}get subscribers(){return this._subscribers}async createAndStartJob(){try{return await this.createJob(),await this.createDatafeed(),await this.startDatafeed()}catch(e){throw e}}async createJob(){try{const{success:e,resp:t}=await K.a.saveNewJob(this._job_config);if(await this._updateCalendars(),!0===e)return t;throw t}catch(e){throw e}}async createDatafeed(){try{const e=this._getDatafeedWithFilteredRuntimeMappings();return await K.a.saveNewDatafeed(e,this._job_config.job_id)}catch(e){throw e}}async startDatafeed(){const e=new job_runner_JobRunner(this);return await e.startDatafeed(),e}_getDatafeedWithFilteredRuntimeMappings(){if(!1===this._filterRuntimeMappingsOnSave)return this._datafeed_config;const{runtime_mappings:e}=St(this._job_config,this._datafeed_config);return{...this._datafeed_config,runtime_mappings:Object.keys(e).length>0?e:void 0}}subscribeToProgress(e){this._subscribers.push(e)}get jobConfig(){return this._job_config}get datafeedConfig(){return this._datafeed_config}get stopAllRefreshPolls(){return this._stopAllRefreshPolls}forceStopRefreshPolls(){this._stopAllRefreshPolls.stop=!0}_setCustomSetting(e,t){null===t?void 0!==this._job_config.custom_settings&&void 0!==this._job_config.custom_settings[e]&&(delete this._job_config.custom_settings[e],0===Object.keys(this._job_config.custom_settings).length&&delete this._job_config.custom_settings):void 0===this._job_config.custom_settings?this._job_config.custom_settings={[e]:t}:this._job_config.custom_settings[e]=t}_getCustomSetting(e){return void 0!==this._job_config.custom_settings&&void 0!==this._job_config.custom_settings[e]?this._job_config.custom_settings[e]:null}set createdBy(e){this._setCustomSetting("created_by",e)}get createdBy(){return this._getCustomSetting("created_by")}set customUrls(e){this._setCustomSetting("custom_urls",e)}get customUrls(){return this._getCustomSetting("custom_urls")}get formattedJobJson(){return JSON.stringify(this._job_config,null,2)}get formattedDatafeedJson(){return JSON.stringify(this._datafeed_config,null,2)}set filterRuntimeMappingsOnSave(e){this._filterRuntimeMappingsOnSave=e}get filterRuntimeMappingsOnSave(){return this._filterRuntimeMappingsOnSave}_initPerPartitionCategorization(){var e,t;void 0===this._job_config.analysis_config.per_partition_categorization&&(this._job_config.analysis_config.per_partition_categorization={}),void 0===(null===(e=this._job_config.analysis_config.per_partition_categorization)||void 0===e?void 0:e.enabled)&&(this._job_config.analysis_config.per_partition_categorization.enabled=!1),void 0===(null===(t=this._job_config.analysis_config.per_partition_categorization)||void 0===t?void 0:t.stop_on_warn)&&(this._job_config.analysis_config.per_partition_categorization.stop_on_warn=!1)}get perPartitionCategorization(){var e;return!0===(null===(e=this._job_config.analysis_config.per_partition_categorization)||void 0===e?void 0:e.enabled)}set perPartitionCategorization(e){this._initPerPartitionCategorization(),this._job_config.analysis_config.per_partition_categorization.enabled=e}get perPartitionStopOnWarn(){var e;return!0===(null===(e=this._job_config.analysis_config.per_partition_categorization)||void 0===e?void 0:e.stop_on_warn)}set perPartitionStopOnWarn(e){this._initPerPartitionCategorization(),this._job_config.analysis_config.per_partition_categorization.stop_on_warn=e}_extractRuntimeMappings(){const e=this._indexPattern.toSpec().runtimeFieldMap;void 0!==e&&(void 0===this._datafeed_config.runtime_mappings&&(this._datafeed_config.runtime_mappings={}),Object.entries(e).forEach((([e,t])=>{this._datafeed_config.runtime_mappings[e]=t}))),this._populateRuntimeFields()}_populateRuntimeFields(){var e;if(this._runtimeFields=[],this._runtimeMappings=null!==(e=this._datafeed_config.runtime_mappings)&&void 0!==e?e:null,null!==this._runtimeMappings){const e=Object.entries(this._runtimeMappings).map((([e,t])=>({id:e,name:e,type:Array.isArray(t)?t[0].type:t.type,aggregatable:!0,aggs:[],runtimeField:t}))),t=Object(Q.cloneDeep)([...xt.d,...xt.e]);this._runtimeFields=Object(vt.a)(e,t,{}).fields}}_populateScriptFields(){this._scriptFields=[],void 0!==this._datafeed_config.script_fields&&(this._scriptFields=Object.keys(this._datafeed_config.script_fields).map((e=>({id:e,name:e,type:jt.ES_FIELD_TYPES.KEYWORD,aggregatable:!0}))))}async autoSetTimeRange(e=!0){const{start:t,end:a}=await X.ml.getTimeFieldRange({index:this._indexPatternTitle,timeFieldName:this.timeFieldName,query:e?yt(this.query):this.query,runtimeMappings:this.datafeedConfig.runtime_mappings,indicesOptions:this.datafeedConfig.indices_options});this.setTimeRange(t,a)}_overrideConfigs(e,t){this._job_config=e,this._datafeed_config=t,this._detectors=this._job_config.analysis_config.detectors,this._influencers=this._job_config.analysis_config.influencers,void 0===this._job_config.groups&&(this._job_config.groups=[]),void 0!==this._job_config.analysis_config.influencers&&this._job_config.analysis_config.influencers.forEach((e=>this.addInfluencer(e))),void 0!==this._job_config.results_index_name&&this._job_config.results_index_name!==wt.g&&(this.useDedicatedIndex=!0),this._populateScriptFields(),this._populateRuntimeFields(),this._aggregationFields=[];const a=Object(Ct.b)(this._datafeed_config);if(void 0!==a){const e=Object(kt.a)(a);if(void 0!==e&&void 0!==a[e]){const t=a[e];Object(Mt.c)(t,this._aggregationFields)}}}}var Ft=a(138);class single_metric_job_creator_SingleMetricJobCreator extends job_creator_JobCreator{constructor(e,t,a){super(e,t,a),Y()(this,"_type",wt.f.SINGLE_METRIC),this.createdBy=wt.a.SINGLE_METRIC,this._wizardInitialized$.next(!0)}setDetector(e,t){const a=Object(Ot.a)(e,t);0===this._detectors.length?this._addDetector(a,e,t):this._editDetector(a,e,t,0),this._createDatafeedAggregations()}set bucketSpan(e){this._job_config.analysis_config.bucket_span=e,this._setBucketSpanMs(e),this._createDatafeedAggregations()}get bucketSpan(){return this._job_config.analysis_config.bucket_span}_createDatafeedAggregations(){if(this._detectors.length&&"string"==typeof this._job_config.analysis_config.bucket_span&&this._aggs.length>0){var e;if(delete this._job_config.analysis_config.summary_count_field_name,delete this._datafeed_config.aggregations,(null===(e=this._fields[0])||void 0===e?void 0:e.name)===Ft.a)return;const t=this._aggs[0].dslName,a=this._job_config.data_description.time_field,i=Object(se.a)(this._job_config.analysis_config.bucket_span,!0);if(null===i)return;const n=1e3*i.asSeconds();let s=null;switch(t){case xt.a.COUNT:this._job_config.analysis_config.summary_count_field_name=Ft.a,this._datafeed_config.aggregations={buckets:{date_histogram:{field:a,fixed_interval:`${n}ms`},aggregations:{[a]:{max:{field:a}}}}};break;case xt.a.AVG:case xt.a.SUM:case xt.a.MIN:case xt.a.MAX:if(s=this._fields[0],null!==s){const e=s.name;this._job_config.analysis_config.summary_count_field_name=Ft.a,this._datafeed_config.aggregations={buckets:{date_histogram:{field:a,fixed_interval:.1*n+"ms"},aggregations:{[e]:{[t]:{field:e}},[a]:{max:{field:a}}}}}}break;case xt.a.CARDINALITY:if(s=this._fields[0],null!==s){const e=s.name;this._job_config.analysis_config.summary_count_field_name=`dc_${e}`,this._datafeed_config.aggregations={buckets:{date_histogram:{field:a,fixed_interval:`${n}ms`},aggregations:{[a]:{max:{field:a}},[this._job_config.analysis_config.summary_count_field_name]:{[t]:{field:e}}}}};const i=this._detectors[0];i.function=xt.b.NON_ZERO_COUNT,i.detector_description=`${t} (${e})`,delete i.field_name}}}}get aggFieldPair(){return 0===this._aggs.length?null:{agg:this._aggs[0],field:this._fields[0]}}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=wt.a.SINGLE_METRIC,this._sparseData=Object(Mt.k)(e,t);const a=Object(Mt.j)(e,t,this.additionalFields,!1);this.removeAllDetectors();const i=a[0];a.length&&null!==i.agg&&null!==i.field&&this.setDetector(i.agg,i.field)}}class multi_metric_job_creator_MultiMetricJobCreator extends job_creator_JobCreator{constructor(e,t,a){super(e,t,a),Y()(this,"_splitField",null),Y()(this,"_type",wt.f.MULTI_METRIC),this.createdBy=wt.a.MULTI_METRIC,this._wizardInitialized$.next(!0)}setSplitField(e){if(this._splitField=e,null===this._splitField)this.removeSplitField();else for(let e=0;e<this._detectors.length;e++)this._detectors[e].partition_field_name=this._splitField.id}removeSplitField(){this._detectors.forEach((e=>{delete e.partition_field_name}))}get splitField(){return this._splitField}addDetector(e,t){const a=this._createDetector(e,t);this._addDetector(a,e,t)}editDetector(e,t,a){const i=this._createDetector(e,t);this._editDetector(i,e,t,a)}_createDetector(e,t){const a=Object(Ot.a)(e,t);return null!==this._splitField&&(a.partition_field_name=this._splitField.id),a}removeDetector(e){this._removeDetector(e)}get aggFieldPairs(){return this.detectors.map(((e,t)=>({field:this._fields[t],agg:this._aggs[t]})))}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=wt.a.MULTI_METRIC,this._sparseData=Object(Mt.k)(e,t);const a=Object(Mt.j)(e,t,this.additionalFields,!1);void 0!==t.aggregations&&(delete t.aggregations,delete e.analysis_config.summary_count_field_name),this.removeAllDetectors(),a.forEach(((e,t)=>{const i=a[t];null!==i.agg&&null!==i.field&&this.addDetector(i.agg,i.field)})),a.length&&null!==a[0].partitionField&&this.setSplitField(a[0].partitionField)}}class population_job_creator_PopulationJobCreator extends job_creator_JobCreator{constructor(e,t,a){super(e,t,a),Y()(this,"_populatonField",null),Y()(this,"_byFields",[]),Y()(this,"_type",wt.f.POPULATION),this.createdBy=wt.a.POPULATION,this._wizardInitialized$.next(!0)}setByField(e,t){null===e?this.removeByField(t):void 0!==this._detectors[t]&&(this._byFields[t]=e,this._detectors[t].by_field_name=e.id)}removeByField(e){void 0!==this._detectors[e]&&(this._byFields[e]=null,delete this._detectors[e].by_field_name)}getByField(e){return void 0===this._byFields[e]?null:this._byFields[e]}setPopulationField(e){if(this._populatonField=e,null===this._populatonField)this.removePopulationField();else for(let e=0;e<this._detectors.length;e++)this._detectors[e].over_field_name=this._populatonField.id}removePopulationField(){this._detectors.forEach((e=>{delete e.over_field_name}))}get populationField(){return this._populatonField}addDetector(e,t){const a=this._createDetector(e,t);this._addDetector(a,e,t),this._byFields.push(null)}editDetector(e,t,a){const i=this._createDetector(e,t),n=this._byFields[a];null!=n&&(i.by_field_name=n.id),this._editDetector(i,e,t,a)}_createDetector(e,t){const a=Object(Ot.a)(e,t);return null!==this._populatonField&&(a.over_field_name=this._populatonField.id),a}removeDetector(e){this._removeDetector(e),this._byFields.splice(e,1)}get aggFieldPairs(){return this.detectors.map(((e,t)=>({field:this._fields[t],agg:this._aggs[t],by:{field:this._byFields[t],value:null}})))}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=wt.a.POPULATION;const a=Object(Mt.j)(e,t,this.additionalFields,!1);this.removeAllDetectors(),a.length&&null!==a[0].overField&&this.setPopulationField(a[0].overField),a.forEach(((e,t)=>{const i=a[t];null!==i.agg&&null!==i.field&&(this.addDetector(i.agg,i.field),null!==i.byField&&this.setByField(i.byField,t))}))}}var It=a(151);class advanced_job_creator_AdvancedJobCreator extends job_creator_JobCreator{constructor(e,t,a){super(e,t,a),Y()(this,"_type",wt.f.ADVANCED),Y()(this,"_richDetectors",[]),Y()(this,"_queryString",void 0),this._queryString=JSON.stringify(this._datafeed_config.query),this._wizardInitialized$.next(!0)}addDetector(e,t,a,i,n,s,o,r){const{detector:l,richDetector:c}=this._createDetector(e,t,a,i,n,s,o,null,r);this._addDetector(l,e,t),this._richDetectors.push(c)}editDetector(e,t,a,i,n,s,o,r,l){const c=void 0!==this._detectors[r]&&this._detectors[r].custom_rules||null,{detector:d,richDetector:u}=this._createDetector(e,t,a,i,n,s,o,c,l);this._editDetector(d,e,t,r),void 0!==this._richDetectors[r]&&(this._richDetectors[r]=u)}_createDetector(e,t,a,i,n,s,o,r,l){const c=Object(Ot.a)(e,t);return null!==a&&(c.by_field_name=a.id),null!==i&&(c.over_field_name=i.id),null!==n&&(c.partition_field_name=n.id),null!==s&&(c.exclude_frequent=s),null!==o&&(c.detector_description=o),null!==r&&(c.custom_rules=r),null!==l&&(c.use_null=l),{detector:c,richDetector:{agg:e,field:t,byField:a,overField:i,partitionField:n,excludeFrequent:s,description:o,customRules:r,useNull:l}}}removeDetector(e){this._removeDetector(e),this._richDetectors.splice(e,1)}get richDetectors(){return this._richDetectors}get queryString(){return this._queryString}set queryString(e){this._queryString=e}get isValidQueryString(){return Object(It.c)(this._queryString)}cloneFromExistingJob(e,t){this._overrideConfigs(e,t);const a=Object(Mt.j)(e,t,this.additionalFields,!0),i=this._detectors.map((e=>e.custom_rules));this.removeAllDetectors(),this._richDetectors.length=0,a.forEach(((e,t)=>{const i=a[t];null!==i.agg&&null!==i.field&&this.addDetector(i.agg,i.field,i.byField,i.overField,i.partitionField,i.excludeFrequent,i.description,i.useNull)})),i.forEach(((e,t)=>{void 0!==e&&(this._detectors[t].custom_rules=e)}))}}var Dt=a(127);let At,Lt;!function(e){e[e.NO_EXAMPLES=0]="NO_EXAMPLES",e[e.FAILED_TO_TOKENIZE=1]="FAILED_TO_TOKENIZE",e[e.TOO_MANY_TOKENS=2]="TOO_MANY_TOKENS",e[e.TOKEN_COUNT=3]="TOKEN_COUNT",e[e.MEDIAN_LINE_LENGTH=4]="MEDIAN_LINE_LENGTH",e[e.NULL_VALUES=5]="NULL_VALUES",e[e.INSUFFICIENT_PRIVILEGES=6]="INSUFFICIENT_PRIVILEGES"}(At||(At={})),function(e){e.VALID="valid",e.PARTIALLY_VALID="partially_valid",e.INVALID="invalid"}(Lt||(Lt={}));const Rt={[At.NO_EXAMPLES]:r.i18n.translate("xpack.ml.models.jobService.categorization.messages.validNoDataFound",{defaultMessage:"Examples  were successfully loaded."}),[At.FAILED_TO_TOKENIZE]:r.i18n.translate("xpack.ml.models.jobService.categorization.messages.validFailureToGetTokens",{defaultMessage:"The examples loaded were tokenized successfully."}),[At.TOKEN_COUNT]:r.i18n.translate("xpack.ml.models.jobService.categorization.messages.validTokenLength",{defaultMessage:"More than {tokenCount} tokens per example were found in over {percentage}% of the examples loaded.",values:{percentage:Math.floor(75),tokenCount:3}}),[At.MEDIAN_LINE_LENGTH]:r.i18n.translate("xpack.ml.models.jobService.categorization.messages.validMedianLineLength",{defaultMessage:"The median line length of the examples loaded was less than {medianCharCount} characters.",values:{medianCharCount:400}}),[At.NULL_VALUES]:r.i18n.translate("xpack.ml.models.jobService.categorization.messages.validNullValues",{defaultMessage:"Less than {percentage}% of the examples loaded were null.",values:{percentage:Math.floor(25)}}),[At.TOO_MANY_TOKENS]:r.i18n.translate("xpack.ml.models.jobService.categorization.messages.validTooManyTokens",{defaultMessage:"Less than 10000 tokens were found in total in the examples loaded."}),[At.INSUFFICIENT_PRIVILEGES]:r.i18n.translate("xpack.ml.models.jobService.categorization.messages.validUserPrivileges",{defaultMessage:"The user has sufficient privileges to perform the checks."})},Nt={time:0,actual:0,modelUpper:0,modelLower:0};class results_loader_ResultsLoader{constructor(e,t,a){Y()(this,"_results$",void 0),Y()(this,"_resultsSearchRunning",!1),Y()(this,"_jobCreator",void 0),Y()(this,"_chartInterval",void 0),Y()(this,"_lastModelTimeStamp",0),Y()(this,"_lastResultsTimeout",null),Y()(this,"_chartLoader",void 0),Y()(this,"_results",{progress:0,model:[],anomalies:[]}),Y()(this,"_detectorSplitFieldFilters",null),Y()(this,"_splitFieldFiltersLoaded",!1),Y()(this,"progressSubscriber",(async e=>{!1===this._resultsSearchRunning&&(e-this._results.progress>5||100===e)&&(!1===this._splitFieldFiltersLoaded&&(this._splitFieldFiltersLoaded=!0,await this._populateDetectorSplitFieldFilters()),this._updateData(e,!1),100===e&&(clearTimeout(this._lastResultsTimeout),this._lastResultsTimeout=setTimeout((()=>{this._updateData(e,!0)}),500)))})),this._jobCreator=e,this._chartInterval=t,this._results$=new at.BehaviorSubject(this._results),this._chartLoader=a,e.subscribeToProgress(this.progressSubscriber)}async _updateData(e,t){this._resultsSearchRunning=!0,!0===t&&this._clearResults(),this._results.progress=e;const a=this._jobCreator.type===wt.f.SINGLE_METRIC?()=>this._loadJobAnomalyData(0):()=>this._loadDetectorsAnomalyData(),[i,n]=await Promise.all([this._loadModelData(0),a()]);this._results.model=i,this._results.anomalies=n,this._resultsSearchRunning=!1,this._results$.next(this._results)}get results$(){return this._results$}subscribeToResults(e){return this._results$.subscribe(e)}get progress(){return this._results.progress}_clearResults(){this._results.model={},this._results.anomalies={},this._results.progress=0,this._lastModelTimeStamp=0}async _loadModelData(e){if(!1===this._jobCreator.modelPlot)return[];const t=this._jobCreator.getAggregation(e);if(null===t)return{[e]:[Nt]};const a=await Object(at.lastValueFrom)(mt.mlResultsService.getModelPlotOutput(this._jobCreator.jobId,e,[],this._lastModelTimeStamp,this._jobCreator.end,this._chartInterval.getInterval().asMilliseconds(),t.mlModelPlotAgg));return this._createModel(a,e)}_createModel({results:e},t){void 0===this._results.model[t]&&(this._results.model[t]=[]);const a=this._jobCreator.aggregations[t].dslName,i=a===xt.a.COUNT||a===xt.a.CARDINALITY?this._calculateModelScale():1,n=Object.entries(e).map((([e,{actual:t,modelLower:a,modelUpper:n}])=>({time:+e,actual:t,modelUpper:(null===n?0:n)*i,modelLower:(null===a?0:a)*i})));if(n.length>10){this._lastModelTimeStamp=n[n.length-5].time;for(let e=0;e<5;e++)this._results.model[t].pop()}return{[t]:this._results.model[t].concat(n)}}async _loadJobAnomalyData(e){const t=(await mt.mlResultsService.getScoresByBucket([this._jobCreator.jobId],this._jobCreator.start,this._jobCreator.end,this._chartInterval.getInterval().asMilliseconds(),1)).results[this._jobCreator.jobId];if(void 0===t)return[];const a={};return a[0]=Object.entries(t).map((([e,t])=>({time:+e,value:t,severity:Object(pt.k)(t)}))),a}async _loadDetectorsAnomalyData(){const e=await(t=this._jobCreator.jobId,a=this._jobCreator.start,i=this._jobCreator.end,n=this._chartInterval.getInterval().asMilliseconds(),s=this._detectorSplitFieldFilters,new Promise(((e,o)=>{const r={success:!0,results:{},totalResults:0};let l="job_id: "+t;s&&void 0!==s.value&&(l+=` AND ${Object(te.c)(s.name)}:`,l+=`"${String(s.value).replace(/\\/g,"\\\\")}"`),X.ml.results.anomalySearch({body:{size:0,query:{bool:{filter:[{query_string:{query:"result_type:record"}},{bool:{must:[{range:{timestamp:{gte:a,lte:i,format:"epoch_millis"}}},{query_string:{query:l}}]}}]}},aggs:{detector_index:{terms:{field:"detector_index",order:{recordScore:"desc"}},aggs:{recordScore:{max:{field:"record_score"}},byTime:{date_histogram:{field:"timestamp",fixed_interval:`${n}ms`,min_doc_count:1,extended_bounds:{min:a,max:i}},aggs:{recordScore:{max:{field:"record_score"}}}}}}}}},[t]).then((t=>{Object(Q.get)(t,["aggregations","detector_index","buckets"],[]).forEach((e=>{const t=[],a=+e.key,i=Object(Q.get)(e,["byTime","buckets"],[]);for(let e=0;e<i.length;e++){const a=i[e],n=a.key;t.push({time:n,value:Object(Q.get)(a,["recordScore","value"])})}r.results[a]=t})),e(r)})).catch((e=>{o(e)}))})));var t,a,i,n,s;const o={};return Object.entries(e.results).forEach((([e,t])=>{o[+e]=t.map((e=>({...e,severity:Object(pt.k)(e.value)})))})),o}async _populateDetectorSplitFieldFilters(){if(zt(this._jobCreator)&&null!==this._jobCreator.splitField){const e=await this._chartLoader.loadFieldExampleValues(this._jobCreator.splitField,this._jobCreator.runtimeMappings,this._jobCreator.datafeedConfig.indices_options);e.length>0&&(this._detectorSplitFieldFilters={name:this._jobCreator.splitField.name,value:e[0]})}else this._detectorSplitFieldFilters=null}_calculateModelScale(){const e=Object(se.a)(this._jobCreator.bucketSpan),t=null!==e?e.asMilliseconds():0;return this._chartInterval.getInterval().asMilliseconds()/t}}class categorization_examples_loader_CategorizationExamplesLoader{constructor(e,t,a){Y()(this,"_jobCreator",void 0),Y()(this,"_indexPatternTitle",""),Y()(this,"_timeFieldName",""),Y()(this,"_query",{}),this._jobCreator=e,this._indexPatternTitle=t.title,this._query=a,"string"==typeof t.timeFieldName&&(this._timeFieldName=t.timeFieldName)}async loadExamples(){var e;const t=this._jobCreator.categorizationAnalyzer,a=this._jobCreator.categorizationFieldName;return null===a?{examples:[],sampleSize:0,overallValidStatus:Lt.INVALID,validationChecks:[]}:await X.ml.jobs.categorizationFieldExamples(this._indexPatternTitle,this._query,5,a,this._timeFieldName,this._jobCreator.start,this._jobCreator.end,t,null!==(e=this._jobCreator.runtimeMappings)&&void 0!==e?e:void 0,this._jobCreator.datafeedConfig.indices_options)}}class categorization_job_creator_CategorizationJobCreator extends job_creator_JobCreator{constructor(e,t,a){super(e,t,a),Y()(this,"_type",wt.f.CATEGORIZATION),Y()(this,"_createCountDetector",(()=>{})),Y()(this,"_createRareDetector",(()=>{})),Y()(this,"_examplesLoader",void 0),Y()(this,"_categoryFieldExamples",[]),Y()(this,"_validationChecks",[]),Y()(this,"_overallValidStatus",Lt.INVALID),Y()(this,"_detectorType",xt.b.COUNT),Y()(this,"_categorizationAnalyzer",{}),Y()(this,"_defaultCategorizationAnalyzer",void 0),Y()(this,"_partitionFieldName",null),Y()(this,"_ccsVersionFailure",!1),this.createdBy=wt.a.CATEGORIZATION,this._examplesLoader=new categorization_examples_loader_CategorizationExamplesLoader(this,e,a);const{anomaly_detectors:i}=Object(A.c)();this._defaultCategorizationAnalyzer=i.categorization_analyzer||{}}setDefaultDetectorProperties(e,t,a){if(null===e||null===t||null===a)throw Error("event_rate field or count or rare aggregations missing");this._createCountDetector=()=>{this._createDetector(e,a)},this._createRareDetector=()=>{this._createDetector(t,a)}}_createDetector(e,t){const a=Object(Ot.a)(e,t);a.by_field_name=Dt.c.id,this.perPartitionCategorization&&null!==this.categorizationPerPartitionField&&(a.partition_field_name=this.categorizationPerPartitionField),this._addDetector(a,e,Dt.c)}setDetectorType(e){this._detectorType=e,this.removeAllDetectors(),e===xt.b.COUNT?(this._createCountDetector(),this.bucketSpan=wt.b):(this._createRareDetector(),this.bucketSpan=wt.e,this.modelPlot=!1)}set categorizationFieldName(e){null!==e?(this._job_config.analysis_config.categorization_field_name=e,this.setDetectorType(this._detectorType),this.addInfluencer(Dt.c.id)):(delete this._job_config.analysis_config.categorization_field_name,this._categoryFieldExamples=[],this._validationChecks=[],this._overallValidStatus=Lt.INVALID)}get categorizationFieldName(){return this._job_config.analysis_config.categorization_field_name||null}async loadCategorizationFieldExamples(){const{examples:e,sampleSize:t,overallValidStatus:a,validationChecks:i}=await this._examplesLoader.loadExamples();return this._categoryFieldExamples=e,this._validationChecks=i,this._overallValidStatus=a,this._ccsVersionFailure=this._checkCcsFailure(e,a,i),!0===this._ccsVersionFailure&&(this._overallValidStatus=Lt.VALID),this._wizardInitialized$.next(!0),{examples:e,sampleSize:t,overallValidStatus:a,validationChecks:i,ccsVersionFailure:this._ccsVersionFailure}}_checkCcsFailure(e,t,a){var i;return 0===e.length&&t===Lt.INVALID&&(null===(i=a[0])||void 0===i?void 0:i.id)===At.NO_EXAMPLES&&Object(C.g)(this.indexPatternTitle)}get categoryFieldExamples(){return this._categoryFieldExamples}get validationChecks(){return this._validationChecks}get overallValidStatus(){return this._overallValidStatus}get selectedDetectorType(){return this._detectorType}set categorizationAnalyzer(e){this._categorizationAnalyzer=e,Object(Q.isEqual)(this._categorizationAnalyzer,this._defaultCategorizationAnalyzer)?delete this._job_config.analysis_config.categorization_analyzer:this._job_config.analysis_config.categorization_analyzer=e}get categorizationAnalyzer(){return this._categorizationAnalyzer}get categorizationPerPartitionField(){return this._partitionFieldName}set categorizationPerPartitionField(e){null===e?(this._detectors.forEach((e=>{delete e.partition_field_name})),null!==this._partitionFieldName&&this.removeInfluencer(this._partitionFieldName),this._partitionFieldName=null):this._partitionFieldName!==e&&(null!==this._partitionFieldName&&this.removeInfluencer(this._partitionFieldName),this.addInfluencer(e),this._partitionFieldName=e,this._detectors.forEach((t=>{t.partition_field_name=e})))}get perPartitionCategorization(){var e;return!0===(null===(e=this._job_config.analysis_config.per_partition_categorization)||void 0===e?void 0:e.enabled)}set perPartitionCategorization(e){this._initPerPartitionCategorization(),this._job_config.analysis_config.per_partition_categorization.enabled=e,!1===e&&(this.categorizationPerPartitionField=null)}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=wt.a.CATEGORIZATION;const a=Object(Mt.j)(e,t,this.additionalFields,!1)[0];if(void 0!==a&&null!==a.agg&&null!==a.field){const t=a.agg.id===xt.b.COUNT?xt.b.COUNT:xt.b.RARE,i=e.analysis_config.bucket_span;this.setDetectorType(t),null!==a.partitionField&&(this.categorizationPerPartitionField=a.partitionField.id),this.bucketSpan=i}}}class rare_job_creator_RareJobCreator extends job_creator_JobCreator{constructor(e,t,a){super(e,t,a),Y()(this,"_rareField",null),Y()(this,"_populationField",null),Y()(this,"_splitField",null),Y()(this,"_type",wt.f.RARE),Y()(this,"_rareInPopulation",!1),Y()(this,"_frequentlyRare",!1),Y()(this,"_rareAgg",void 0),Y()(this,"_freqRareAgg",void 0),this.createdBy=wt.a.RARE,this._wizardInitialized$.next(!0),this._rareAgg={},this._freqRareAgg={}}setDefaultDetectorProperties(e,t){if(null===e||null===t)throw Error("rare or freq_rare aggregations missing");this._rareAgg=e,this._freqRareAgg=t}setRareField(e){if(this._rareField=e,null===e)return this.removePopulationField(),this.removeSplitField(),this._removeDetector(0),this._detectors.length=0,void(this._fields.length=0);const t=this._frequentlyRare?this._freqRareAgg:this._rareAgg,a={function:t.id};0===this._detectors.length?this._addDetector(a,t,e):this._editDetector(a,t,e,0),this._detectors[0].by_field_name=e.id}get rareField(){return this._rareField}get rareInPopulation(){return this._rareInPopulation}set rareInPopulation(e){this._rareInPopulation=e,!1===e&&this.removePopulationField()}get frequentlyRare(){return this._frequentlyRare}set frequentlyRare(e){if(this._frequentlyRare=e,this._detectors.length){const t=e?this._freqRareAgg:this._rareAgg;this._detectors[0].function=t.id,this._aggs[0]=t}}setPopulationField(e){if(this._populationField=e,null===this._populationField)this.removePopulationField();else for(let e=0;e<this._detectors.length;e++)this._detectors[e].over_field_name=this._populationField.id}removePopulationField(){this._populationField=null,this._detectors.forEach((e=>{delete e.over_field_name}))}get populationField(){return this._populationField}setSplitField(e){if(this._splitField=e,null===this._splitField)this.removeSplitField();else for(let e=0;e<this._detectors.length;e++)this._detectors[e].partition_field_name=this._splitField.id}removeSplitField(){this._detectors.forEach((e=>{delete e.partition_field_name}))}get splitField(){return this._splitField}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=wt.a.RARE,this._sparseData=Object(Mt.k)(e,t);const a=Object(Mt.j)(e,t,this.additionalFields,!1);var i;this.removeSplitField(),this.removePopulationField(),this.removeAllDetectors(),a.length&&(this.setRareField(a[0].byField),this.frequentlyRare=(null===(i=a[0].agg)||void 0===i?void 0:i.id)===xt.b.FREQ_RARE,null!==a[0].overField&&(this.setPopulationField(a[0].overField),this.rareInPopulation=!0),null!==a[0].partitionField&&this.setSplitField(a[0].partitionField))}}function Pt(e){return e.type===wt.f.SINGLE_METRIC}function zt(e){return e.type===wt.f.MULTI_METRIC}function Bt(e){return e.type===wt.f.POPULATION}function Vt(e){return e.type===wt.f.ADVANCED}function Jt(e){return e.type===wt.f.CATEGORIZATION}function Ut(e){return e.type===wt.f.RARE}var Gt=a(124),qt=a(187);function $t(){const e=Object(qt.a)().get("theme:darkMode")?gt.euiDarkVars:gt.euiLightVars;return{LINE_COLOR:e.euiColorPrimary,MODEL_COLOR:e.euiColorPrimary,EVENT_RATE_COLOR:e.euiColorPrimary,EVENT_RATE_COLOR_WITH_ANOMALIES:e.euiColorLightShade}}const Wt={width:"100%",height:"300px",cols:1,intervalMs:0},Ht={line:{strokeWidth:2,visible:!0,opacity:1},border:{visible:!1,strokeWidth:0},point:{visible:!1,radius:2,strokeWidth:4,opacity:.5},area:{opacity:.25,visible:!1}};function Yt(e,t){const a={...Wt,intervalMs:t.getInterval().asMilliseconds()};if(Bt(e)){const e=Object(Gt.c)();e.setInterval("auto"),e.setBounds(t.getBounds()),a.intervalMs=e.getInterval().asMilliseconds()}return a.intervalMs<e.bucketSpanMs&&(a.intervalMs=e.bucketSpanMs),(zt(e)||Bt(e))&&(e.aggFieldPairs.length>2&&zt(e)?(a.cols=3,a.height="150px",a.intervalMs=3*a.intervalMs):e.aggFieldPairs.length>1&&(a.cols=2,a.height="200px",a.intervalMs=2*a.intervalMs)),a}const Xt=({hasData:e,loading:t=!1,height:a,children:i})=>{const s=!0===t?!0===e?.3:0:1;return Object(g.jsx)(n.Fragment,null,Object(g.jsx)("div",{style:{height:"100%",opacity:s,transition:"opacity 0.2s"}},t&&!e?null:i),!0===t&&Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround",alignItems:"center",style:void 0!==a?{height:a,marginTop:`-${a}`}:{}},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiLoadingSpinner,{size:"xl"}))))};var Qt=a(1);function Kt(e){return{line:{stroke:Object(pt.j)(e),strokeWidth:3,opacity:1}}}const Zt=({anomalyData:e})=>{const t=function(e){const t={critical:[],major:[],minor:[],warning:[],unknown:[],low:[]};return e.forEach((e=>{0!==e.value&&t[e.severity].push({dataValue:e.time})})),t}(void 0===e?[]:e);return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(dt.LineAnnotation,{id:"low",domainType:dt.AnnotationDomainType.XDomain,dataValues:t.low,style:Kt(Qt.c.LOW),hideTooltips:!0}),Object(g.jsx)(dt.LineAnnotation,{id:"warning",domainType:dt.AnnotationDomainType.XDomain,dataValues:t.warning,style:Kt(Qt.c.WARNING),hideTooltips:!0}),Object(g.jsx)(dt.LineAnnotation,{id:"minor",domainType:dt.AnnotationDomainType.XDomain,dataValues:t.minor,style:Kt(Qt.c.MINOR),hideTooltips:!0}),Object(g.jsx)(dt.LineAnnotation,{id:"major",domainType:dt.AnnotationDomainType.XDomain,dataValues:t.major,style:Kt(Qt.c.MAJOR),hideTooltips:!0}),Object(g.jsx)(dt.LineAnnotation,{id:"critical",domainType:dt.AnnotationDomainType.XDomain,dataValues:t.critical,style:Kt(Qt.c.CRITICAL),hideTooltips:!0}))},ea=({overlayKey:e,start:t,end:a,color:i,showMarker:n=!0})=>{const{euiTheme:r}=Object(ut.e)();return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(dt.RectAnnotation,{id:`rect_annotation_${e}`,zIndex:1,hideTooltips:!0,dataValues:[{coordinates:{x0:t,x1:a}}],style:{fill:i,strokeWidth:0}}),Object(g.jsx)(dt.LineAnnotation,{id:"annotation_1",domainType:dt.AnnotationDomainType.XDomain,dataValues:[{dataValue:t}],style:{line:{strokeWidth:1,stroke:"#343741",opacity:0}},markerPosition:dt.Position.Bottom,hideTooltips:!0,marker:n?Object(g.jsx)(o.EuiIcon,{type:"arrowUp"}):void 0,markerBody:n?Object(g.jsx)("div",{style:{fontWeight:"normal",color:r.euiTextColor}},Object(Je.e)(t)):void 0}))},ta=({eventRateChartData:e,anomalyData:t,height:a,width:i,showAxis:n,loading:s=!1,fadeChart:o,overlayRanges:r,onBrushEnd:l})=>{const{EVENT_RATE_COLOR_WITH_ANOMALIES:c,EVENT_RATE_COLOR:d}=$t(),u=o?c:d;return Object(g.jsx)("div",{style:{width:i,height:a},"data-test-subj":"mlEventRateChart "+(e.length?"withData":"empty")},Object(g.jsx)(Xt,{height:a,hasData:e.length>0,loading:s},Object(g.jsx)(dt.Chart,null,!0===n&&Object(g.jsx)(ht,null),Object(g.jsx)(dt.Settings,{tooltip:dt.TooltipType.None,onBrushEnd:l,theme:{scales:{histogramPadding:.2}}}),r&&r.map(((e,t)=>Object(g.jsx)(ea,{key:t,overlayKey:t,start:e.start,end:e.end,color:e.color,showMarker:e.showMarker}))),Object(g.jsx)(Zt,{anomalyData:t}),Object(g.jsx)(dt.HistogramBarSeries,{id:"event_rate",xScaleType:dt.ScaleType.Time,yScaleType:dt.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:e,color:u}))))},aa=({calendarEvents:e,setCalendarEvents:t,minSelectableTimeStamp:a,maxSelectableTimeStamp:i,eventRateData:l,anomalies:c,chartReady:d})=>{const u=Oe()(i),p=Oe()(a),{euiTheme:b}=Object(ut.e)(),f=Object(n.useCallback)((({x:i})=>{if(i&&2===i.length){const n=i[1]<a?null:i[1];if(null!==n){const s=i[0]<a?a:i[0];t([...e,{start:Oe()(s),end:Oe()(n),description:sa(e.length+1)}])}}}),[e]),h=Object(n.useCallback)(((a,i)=>{const n=e[i];void 0===n?t([...e,{start:a,end:null,description:sa(i)}]):(n.start=a,t([...e]))}),[e]),j=Object(n.useCallback)(((a,i)=>{const n=e[i];void 0===n?t([...e,{start:null,end:a,description:sa(i)}]):(n.end=a,t([...e]))}),[e]),x=Object(n.useCallback)(((a,i)=>{const n=e[i];void 0!==n&&(n.description=a,t([...e]))}),[e]),v=Object(n.useCallback)((a=>{if(void 0!==e[a]){const i=[...e];i.splice(a,1),t(i)}}),[e]);return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)("div",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.revertModelSnapshotFlyout.createCalendar.title",defaultMessage:"Select time range for calendar event."})),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(ia,{eventRateData:l,anomalies:c,loading:!1===d,overlayRanges:e.filter(na).map((e=>({start:e.start.valueOf(),end:e.end.valueOf()}))),onBrushEnd:f,overlayColor:b.euiColorPrimary}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),e.map(((e,t)=>{var a,i;return Object(g.jsx)(n.Fragment,{key:t},Object(g.jsx)(o.EuiPanel,{paddingSize:"s"},Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.fromLabel",{defaultMessage:"From"})},Object(g.jsx)(o.EuiDatePicker,{showTimeSelect:!0,selected:e.start,minDate:p,maxDate:null!==(a=e.end)&&void 0!==a?a:u,onChange:e=>h(e,t)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.toLabel",{defaultMessage:"To"})},Object(g.jsx)(o.EuiDatePicker,{showTimeSelect:!0,selected:e.end,minDate:null!==(i=e.start)&&void 0!==i?i:p,maxDate:u,onChange:e=>j(e,t)})))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:r.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.descriptionLabel",{defaultMessage:"Description"})},Object(g.jsx)(o.EuiFieldText,{fullWidth:!0,value:e.description,onChange:e=>x(e.target.value,t)}))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{borderLeft:`1px solid ${b.euiColorLightShade}`,marginRight:"0px"}}),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonIcon,{style:{margin:"auto"},color:"danger",onClick:()=>v(t),iconType:"trash","aria-label":r.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.deleteLabel",{defaultMessage:"Delete event"})})))),Object(g.jsx)(o.EuiSpacer,{size:"m"}))})))},ia=Object(n.memo)((({eventRateData:e,anomalies:t,loading:a,onBrushEnd:i,overlayRanges:n,overlayColor:s})=>Object(g.jsx)(ta,{eventRateChartData:e,anomalyData:t,loading:a,height:"100px",width:"100%",fadeChart:!0,overlayRanges:n.map((e=>({start:e.start,end:e.end,color:s,showMarker:!1}))),onBrushEnd:i})),((e,t)=>e.overlayRanges.length===t.overlayRanges.length&&JSON.stringify(e.overlayRanges)===JSON.stringify(t.overlayRanges)));function na(e){return null!==e.start&&null!==e.end}function sa(e){return r.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.defaultEventDescription",{defaultMessage:"Auto created event {index}",values:{index:e}})}const oa=({snapshot:e,snapshots:t,job:a,closeFlyout:i,refresh:l})=>{const{toasts:c}=Object(y.f)(),{loadAnomalyDataForJob:d,loadEventRateForJob:u}=Object(n.useMemo)((()=>{return e=mt.mlResultsService,{loadEventRateForJob:async function(t,a,i){const n=Math.max(Math.floor((t.data_counts.latest_record_timestamp-t.data_counts.earliest_record_timestamp)/i),a),s=await e.getEventRateData(t.datafeed_config.indices.join(),t.datafeed_config.query,t.data_description.time_field,t.data_counts.earliest_record_timestamp,t.data_counts.latest_record_timestamp,n,t.datafeed_config.runtime_mappings,t.datafeed_config.indices_options);if(void 0!==s.error)throw s.error;const o=Object.entries(s.results).map((([e,t])=>({time:+e,value:t})));return o.length&&o.push({time:o[o.length-1].time+n,value:0}),o},loadAnomalyDataForJob:async function(t,a,i){const n=Math.max(Math.floor((t.data_counts.latest_record_timestamp-t.data_counts.earliest_record_timestamp)/i),a),s=(await e.getScoresByBucket([t.job_id],t.data_counts.earliest_record_timestamp,t.data_counts.latest_record_timestamp,n,1)).results[t.job_id];if(void 0===s)return[];const o={};return o[0]=Object.entries(s).map((([e,t])=>({time:+e,value:t,severity:Object(pt.k)(t)}))),o}};var e}),[]),[p,b]=Object(n.useState)(e),[f,h]=Object(n.useState)(!1),[j,x]=Object(n.useState)(!1),[v,O]=Object(n.useState)(!1),[E,w]=Object(n.useState)(!1),[M,S]=Object(n.useState)([]),[_,T]=Object(n.useState)(!0),[C,k]=Object(n.useState)([]),[F,I]=Object(n.useState)([]),[D,A]=Object(n.useState)(!1);Object(n.useEffect)((()=>{L()}),[p]),Object(n.useEffect)((()=>{const e=M.some((e=>""===e.description||null===e.end||null===e.start));T(!1===e);const t=[...new Map(M.map((e=>{var t,a;return[`${null===(t=e.start)||void 0===t?void 0:t.valueOf()}${null===(a=e.end)||void 0===a?void 0:a.valueOf()}`,e]}))).values()];t.length<M.length&&S(t)}),[M]);const L=Object(n.useCallback)((async()=>{const e=Object(se.a)(a.analysis_config.bucket_span).asMilliseconds(),t=await u(a,e,100),i=await d(a,e,100);k(t),void 0!==i[0]&&I(i[0]),A(!0)}),[a]);function R(){h(!1)}return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlyout,{onClose:i,hideCloseButton:!0,size:"m"},Object(g.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h5",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.title",defaultMessage:"Revert to model snapshot {ssId}",values:{ssId:p.snapshot_id}}))),Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)("p",null,p.description))),Object(g.jsx)(o.EuiFlyoutBody,null,!1,Object(g.jsx)(ta,{eventRateChartData:C,anomalyData:F,loading:!1===D,height:"100px",width:"100%",fadeChart:!0,overlayRanges:[{start:p.latest_record_time_stamp,end:a.data_counts.latest_record_timestamp,color:"#ff0000"}]}),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.warningCallout.title",{defaultMessage:"Anomaly data will be deleted"}),color:"warning",iconType:"alert"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.warningCallout.contents",defaultMessage:"All anomaly detection results after {date} will be deleted.",values:{date:Object(Je.e)(p.latest_record_time_stamp)}})),Object(g.jsx)(o.EuiHorizontalRule,{margin:"xl"}),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,helpText:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.replaySwitchHelp",{defaultMessage:"Reopen job and replay analysis after the revert has been applied."})},Object(g.jsx)(o.EuiSwitch,{id:"replaySwitch",label:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.replaySwitchLabel",{defaultMessage:"Replay analysis"}),checked:j,onChange:e=>x(e.target.checked)})),j&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,helpText:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.realTimeSwitchHelp",{defaultMessage:"Job will continue to run until manually stopped. All new data added to the index will be analyzed."})},Object(g.jsx)(o.EuiSwitch,{id:"realTimeSwitch",label:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.realTimeSwitchLabel",{defaultMessage:"Run job in real time"}),checked:v,onChange:e=>O(e.target.checked)})),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,helpText:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.createCalendarSwitchHelp",{defaultMessage:"Create a new calendar and event to skip over a period of time when analyzing the data."})},Object(g.jsx)(o.EuiSwitch,{id:"createCalendarSwitch",label:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.createCalendarSwitchLabel",{defaultMessage:"Create calendar to skip a range of time"}),checked:E,onChange:e=>w(e.target.checked)})),E&&Object(g.jsx)(aa,{calendarEvents:M,setCalendarEvents:S,minSelectableTimeStamp:e.latest_record_time_stamp,maxSelectableTimeStamp:a.data_counts.latest_record_timestamp,eventRateData:C,anomalies:F,chartReady:D}))),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:i,flush:"left"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.closeButton",defaultMessage:"Close"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!0}),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:function(){h(!0)},disabled:!0===E&&!1===_,fill:!0},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.saveButton",defaultMessage:"Apply"})))))),f&&Object(g.jsx)(o.EuiConfirmModal,{title:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.deleteTitle",{defaultMessage:"Apply snapshot revert"}),onCancel:R,onConfirm:async function(){const e=j&&!1===v?a.data_counts.latest_record_timestamp:void 0;try{const t=j&&E?M.filter(ra).map((e=>({start:e.start.valueOf(),end:e.end.valueOf(),description:e.description}))):void 0;X.ml.jobs.revertModelSnapshot(a.job_id,p.snapshot_id,j,e,t).then((()=>{c.addSuccess(r.i18n.translate("xpack.ml.revertModelSnapshotFlyout.revertSuccessTitle",{defaultMessage:"Model snapshot revert successful"})),l()})).catch((e=>{const{displayErrorToast:t}=Object(Z.b)(c);t(e)})),R(),i()}catch(e){c.addError(new Error(e.body.message),{title:r.i18n.translate("xpack.ml.revertModelSnapshotFlyout.revertErrorTitle",{defaultMessage:"Model snapshot revert failed"})})}},cancelButtonText:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:r.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.deleteButton",{defaultMessage:"Apply"}),buttonColor:"danger",defaultFocusedButton:"confirm"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.modalBody",defaultMessage:"The snapshot revert will be carried out in the background and may take some time."})))};function ra(e){return null!==e.start&&null!==e.end}var la=a(173);const ca=({messages:e,loading:t,error:a,refreshMessage:i,actionHandler:n})=>{const l=[{name:i?Object(g.jsx)(o.EuiToolTip,{content:r.i18n.translate("xpack.ml.jobMessages.refreshLabel",{defaultMessage:"Refresh"})},Object(g.jsx)(o.EuiButtonIcon,{onClick:Object(la.a)((()=>{i()})),iconType:"refresh","aria-label":r.i18n.translate("xpack.ml.jobMessages.refreshAriaLabel",{defaultMessage:"Refresh"})})):"",render:e=>Object(g.jsx)(Le,{message:e}),width:`${gt.euiLightVars.euiSizeL}`},{field:"timestamp",name:r.i18n.translate("xpack.ml.jobMessages.timeLabel",{defaultMessage:"Time"}),render:Je.e,width:"120px",sortable:!0},{field:"node_name",name:r.i18n.translate("xpack.ml.jobMessages.nodeLabel",{defaultMessage:"Node"}),width:"150px"},{field:"message",name:r.i18n.translate("xpack.ml.jobMessages.messageLabel",{defaultMessage:"Message"}),width:"50%"}];return"function"==typeof n&&l.push({name:r.i18n.translate("xpack.ml.jobMessages.actionsLabel",{defaultMessage:"Actions"}),width:"10%",actions:[{render:e=>Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobMessages.toggleInChartTooltipText",defaultMessage:"Toggle in chart"})},Object(g.jsx)(o.EuiButtonIcon,{size:"xs","aria-label":r.i18n.translate("xpack.ml.jobMessages.toggleInChartAriaLabel",{defaultMessage:"Toggle in chart"}),iconType:"visAreaStacked",onClick:()=>n(e)}))}]}),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiInMemoryTable,{className:"job-messages-table",items:e,columns:l,sorting:{sort:{field:"timestamp",direction:"desc"}},compressed:!0,loading:t,error:a,pagination:!0,"data-test-subj":"mlAnalyticsDetailsJobMessagesTable"}))};var da=a(26);const ua=s.a.memo((({jobId:e,start:t,end:a,actionHandler:i,refreshJobList:l,showClearButton:c})=>{const d=Object(w.e)("canCreateJob"),[u,p]=Object(n.useState)([]),[b,f]=Object(n.useState)([]),[h,j]=Object(n.useState)(!1),[x,v]=Object(n.useState)(""),[O,E]=Object(n.useState)(!1),M=Object(Z.c)(),{jobs:{clearJobAuditMessages:S}}=Object(y.a)(),_=async()=>{j(!0);try{const i=await X.ml.jobs.jobAuditMessages({jobId:e,start:t,end:a});p(i.messages),f(i.notificationIndices),j(!1)}catch(e){j(!1),M.displayErrorToast(e,r.i18n.translate("xpack.ml.jobService.jobAuditMessagesErrorTitle",{defaultMessage:"Error loading job messages"})),v(Object(da.b)(e))}},T=Object(n.useCallback)(_,[e]),C=Object(n.useCallback)((async()=>{E(!0);try{await S(e,b),E(!1),"function"==typeof l&&l()}catch(e){E(!1),M.displayErrorToast(e,r.i18n.translate("xpack.ml.jobMessages.clearJobAuditMessagesErrorTitle",{defaultMessage:"Error clearing job message warnings and errors"}))}}),[e,JSON.stringify(b)]);Object(n.useEffect)((()=>{_()}),[]);const k=0===b.length,F=Object(g.jsx)(o.EuiButton,{size:"s",isLoading:O,isDisabled:k,onClick:Object(la.a)((()=>{C()})),"data-test-subj":"mlJobMessagesClearButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobMessages.clearMessagesLabel",defaultMessage:"Clear notifications"}));return Object(g.jsx)(s.a.Fragment,null,d&&c?Object(g.jsx)(o.EuiSpacer,null):null,Object(g.jsx)(o.EuiFlexGroup,{direction:"column"},d&&c?Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("div",null,!0===k?Object(g.jsx)(o.EuiToolTip,{content:r.i18n.translate("xpack.ml.jobMessages.clearJobAuditMessagesDisabledTooltip",{defaultMessage:"Notification clearing not supported."})},F):Object(g.jsx)(o.EuiToolTip,{content:r.i18n.translate("xpack.ml.jobMessages.clearJobAuditMessagesTooltip",{defaultMessage:"Clears warning icon from jobs list for messages produced in the last 24 hours."})},F))):null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(ca,{refreshMessage:T,messages:u,loading:h,error:x,actionHandler:i}))))})),pa=r.i18n.translate("xpack.ml.jobsList.datafeedChart.editQueryDelay.tooltipContent",{defaultMessage:"To edit the query delay, you must have permission to edit the datafeed and the datafeed cannot be running."}),ma=({datafeedId:e,queryDelay:t,isEnabled:a})=>{const[i,l]=Object(n.useState)(),[c,d]=Object(n.useState)(!1),{updateDatafeed:u}=Object(y.a)(),{displaySuccessToast:p,displayErrorToast:b}=Object(Z.c)(),f=Object(n.useCallback)((async()=>{try{await u({datafeedId:e,datafeedConfig:{query_delay:i}}),p(r.i18n.translate("xpack.ml.jobsList.datafeedChart.editQueryDelay.changesSavedNotificationMessage",{defaultMessage:"Changes to query delay for {datafeedId} saved",values:{datafeedId:e}}))}catch(t){b(t,r.i18n.translate("xpack.ml.jobsList.datafeedChart.editQueryDelay.changesNotSavedNotificationMessage",{defaultMessage:"Could not save changes to query delay for {datafeedId}",values:{datafeedId:e}}))}d(!1)}),[e,i]),h=Object(g.jsx)(o.EuiButtonEmpty,{color:"primary",size:"xs",isDisabled:!1===a,onClick:()=>{d(!0)},iconType:"pencil"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.queryDelayLinkLabel",defaultMessage:"Query delay: {queryDelay}",values:{queryDelay:i||t}})),j=Object(g.jsx)(o.EuiToolTip,{content:pa},h);return Object(g.jsx)(s.a.Fragment,null,!1===c?!1===a?j:h:null,!0===c?Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.queryDelayLabel",defaultMessage:"Query delay"})},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFieldText,{value:i||t,placeholder:t,onChange:e=>{l(e.target.value)}})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"none",direction:"column"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{color:"primary",size:"xs",onClick:f},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.applyQueryDelayLabel",defaultMessage:"Apply"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{color:"text",size:"xs",onClick:()=>d(!1)},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.cancelQueryDelayUpdateLabel",defaultMessage:"Cancel"}))))))):null)},ba="forward",fa=["100%",380],ha=(r.i18n.translate("xpack.ml.jobsList.datafeedChart.chartTabName",{defaultMessage:"Chart"}),r.i18n.translate("xpack.ml.jobsList.datafeedChart.messagesTabName",{defaultMessage:"Messages"}),(e,t)=>{const a=new Map(e);return t.reduce(((e,t)=>{var i;return e.push(a.has(t[0])?[t[0],null!==(i=a.get(t[0]))&&void 0!==i?i:null]:[t[0],null]),e}),[])}),ga=Object(dt.timeFormatter)("MM-DD HH:mm:ss"),ja=r.i18n.translate("xpack.ml.jobsList.datafeedChart.revertSnapshotMessage",{defaultMessage:"Click to revert to this model snapshot."}),xa=r.i18n.translate("xpack.ml.jobsList.datafeedChart.notAvailableMessage",{defaultMessage:"N/A"});function va(e){return e.header=ga(e.dataValue),e}const ya=({details:e,datum:t})=>Object(g.jsx)("div",{className:"echAnnotation__tooltip"},Object(g.jsx)("p",{className:"echAnnotation__header"},ga(t.header)),Object(g.jsx)("div",{className:"echAnnotation__details"},e)),Oa=({jobId:e,end:t,onClose:a,onModelSnapshotAnnotationClick:i})=>{const[l,c]=Object(n.useState)({datafeedConfig:void 0,bucketSpan:void 0,isInitialized:!1,modelSnapshotData:[]}),[d,u]=Object(n.useState)(Oe()(t)),[p,b]=Object(n.useState)(!1),[f,h]=Object(n.useState)([]),[j,x]=Object(n.useState)({rect:[],line:[]}),[v,O]=Object(n.useState)([]),[E,M]=Object(n.useState)([]),[S,T]=Object(n.useState)([]),[C,k]=Object(n.useState)(!0),[F,I]=Object(n.useState)(!0),[D,A]=Object(n.useState)(),L=Object(n.useMemo)((()=>Object(w.e)("canUpdateDatafeed")),[]),R=Object(n.useMemo)((()=>Object(w.e)("canCreateJob")),[]),N=Object(n.useMemo)((()=>Object(w.e)("canStartStopDatafeed")),[]),{getModelSnapshots:P,results:{getDatafeedResultChartData:z}}=Object(y.a)(),{displayErrorToast:B}=Object(Z.c)(),{euiTheme:V}=Object(ut.e)(),J=e=>{if(void 0===l.bucketSpan)return;const t=d.clone(),a=l.bucketSpan.match(/[d | h| m | s]/g)[0],i=Number(l.bucketSpan.replace(/[^0-9]/g,""));e===ba?t.add(480*i,a):t.subtract(480*i,a),u(t)},U=Object(n.useCallback)((async()=>{if(void 0===l.bucketSpan)return;const t=Oe()(d).valueOf(),a=l.bucketSpan.match(/[d | h| m | s]/g)[0],i=Number(l.bucketSpan.replace(/[^0-9]/g,"")),n=d.clone().subtract(480*i,a),s=Oe()(n).valueOf();A({start:String(s),end:String(t)});try{const a=await z(e,s,t);let i=a.datafeedResults,n=a.bucketResults;i.length!==n.length&&(i.length>n.length?n=ha(n,i):i=ha(i,n)),T(i),h(n),x({rect:a.annotationResultsRect,line:a.annotationResultsLine.map(va)}),O(l.modelSnapshotData.filter((e=>e.dataValue>=s&&e.dataValue<=t)))}catch(e){const t=r.i18n.translate("xpack.ml.jobsList.datafeedChart.errorToastTitle",{defaultMessage:"Error fetching data"});B(e,t)}b(!1)}),[d,l.bucketSpan]),G=Object(n.useCallback)((async()=>{try{var t;const a=await ce(e),i=[];(null!==(t=(await P(e)).model_snapshots)&&void 0!==t?t:[]).forEach((e=>{const t=Number(e.latest_record_time_stamp);i.push({dataValue:t,details:`${e.description}. ${R&&N?ja:""}`,modelSnapshot:e})})),c({datafeedConfig:a.datafeed_config,bucketSpan:a.analysis_config.bucket_span,isInitialized:!0,modelSnapshotData:i.map(va)})}catch(e){B(e)}}),[e]);Object(n.useEffect)((function(){G()}),[]),Object(n.useEffect)((function(){void 0!==l.bucketSpan&&(b(!0),U())}),[d,l.bucketSpan]);const{datafeedConfig:q,bucketSpan:$,isInitialized:W}=l,H=Object(n.useMemo)((()=>Object(o.htmlIdGenerator)()()),[]),Y=Object(n.useMemo)((()=>Object(o.htmlIdGenerator)()()),[]);return Object(g.jsx)(o.EuiPortal,null,Object(g.jsx)(o.EuiFlyout,{size:"m",ownFocus:!0,onClose:a.bind(null,!1),"aria-label":r.i18n.translate("xpack.ml.jobsList.datafeedChart.datafeedChartFlyoutAriaLabel",{defaultMessage:"Datafeed chart flyout"}),"data-test-subj":"mlAnnotationsViewDatafeedFlyout"},Object(g.jsx)(o.EuiFlyoutHeader,{hasBorder:!0,"data-test-subj":"mlAnnotationsViewDatafeedFlyoutTitle"},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIconTip,{color:"primary",type:"help",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.headerTooltipContent",defaultMessage:"Charts the event counts of the job and the source data to identify where missing data has occurred."})})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.header",defaultMessage:"Datafeed chart for {jobId}",values:{jobId:e}})))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{padding:"10px"}},Object(g.jsx)(o.EuiDatePicker,{"aria-label":r.i18n.translate("xpack.ml.jobsList.datafeedChart.chartIntervalEndTime",{defaultMessage:"Chart interval end time"}),showTimeSelect:!0,selected:d,onChange:e=>u(e),popoverPlacement:"leftUp"})))),Object(g.jsx)(o.EuiFlyoutBody,null,p||!1===W?Object(g.jsx)(o.EuiLoadingChart,{size:"l"}):null,!p&&W&&void 0!==q&&$?Object(g.jsx)(o.EuiFlexGroup,{direction:"column"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(ma,{datafeedId:q.datafeed_id,queryDelay:q.query_delay,isEnabled:q.state===ae.a.STOPPED&&L})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiCheckbox,{id:H,label:Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.showAnnotationsCheckboxLabel",defaultMessage:"Show annotations"})),checked:C,onChange:()=>k(!C)})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiCheckbox,{id:Y,label:Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.showModelSnapshotsCheckboxLabel",defaultMessage:"Show model snapshots"})),checked:F,onChange:()=>I(!F)})))))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.chartLeftArrowTooltip",defaultMessage:"Previous time window"})},Object(g.jsx)(o.EuiButtonEmpty,{"aria-label":r.i18n.translate("xpack.ml.jobsList.datafeedChart.chartIntervalLeftArrow",{defaultMessage:"Previous time window"}),color:"primary",onClick:()=>{J("back")},iconType:"arrowLeft"}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)("div",{"data-test-subj":"mlAnnotationsViewDatafeedFlyoutChart"},Object(g.jsx)(dt.Chart,{size:fa},Object(g.jsx)(dt.Tooltip,{type:dt.TooltipType.VerticalCursor,showNullValues:!0}),Object(g.jsx)(dt.Settings,{showLegend:!0,legendPosition:dt.Position.Bottom,onAnnotationClick:e=>{var t;R&&N&&0!==(null===(t=e.lines)||void 0===t?void 0:t.length)&&(!e.lines||e.lines[0].id.includes("Model snapshots"))&&i(e.lines[0].datum.modelSnapshot)},theme:{lineSeriesStyle:{point:{visible:!1}}}}),Object(g.jsx)(dt.Axis,{id:"bottom",position:dt.Position.Bottom,showOverlappingTicks:!0,tickFormat:ga,title:r.i18n.translate("xpack.ml.jobsList.datafeedChart.xAxisTitle",{defaultMessage:"Bucket span ({bucketSpan})",values:{bucketSpan:$}})}),Object(g.jsx)(dt.Axis,{id:"left",title:r.i18n.translate("xpack.ml.jobsList.datafeedChart.yAxisTitle",{defaultMessage:"Count"}),position:dt.Position.Left,tickFormat:e=>null===e?xa:e}),C?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(dt.LineAnnotation,{id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.annotationLineSeriesId",{defaultMessage:"Annotations line result"}),key:"annotation-results-line",domainType:dt.AnnotationDomainType.XDomain,dataValues:j.line,marker:Object(g.jsx)(o.EuiIcon,{type:"annotation"}),markerPosition:dt.Position.Top,style:{line:{strokeWidth:3,stroke:V.euiColorDangerText,opacity:.5}}}),Object(g.jsx)(dt.RectAnnotation,{key:"annotation-results-rect",customTooltip:ya,dataValues:j.rect,id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.annotationRectSeriesId",{defaultMessage:"Annotations rectangle result"}),style:{fill:V.euiColorDangerText}})):null,F?Object(g.jsx)(dt.LineAnnotation,{id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.modelSnapshotsLineSeriesId",{defaultMessage:"Model snapshots"}),key:"model-snapshots-results-line",domainType:dt.AnnotationDomainType.XDomain,dataValues:v,marker:Object(g.jsx)(o.EuiIcon,{type:"asterisk"}),markerPosition:dt.Position.Top,style:{line:{strokeWidth:3,stroke:V.euiColorVis1,opacity:.5}}}):null,E.length>0?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(dt.LineAnnotation,{id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.messageLineAnnotationId",{defaultMessage:"Job messages line result"}),key:"messages-results-line",domainType:dt.AnnotationDomainType.XDomain,dataValues:E,marker:Object(g.jsx)(o.EuiIcon,{type:"tableDensityNormal"}),markerPosition:dt.Position.Top,style:{line:{strokeWidth:3,stroke:V.euiColorAccent,opacity:.5}}})):null,Object(g.jsx)(dt.LineSeries,{key:"source-results",color:V.euiColorPrimary,id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.sourceSeriesId",{defaultMessage:"Source indices document count"}),xScaleType:dt.ScaleType.Time,yScaleType:dt.ScaleType.Linear,xAccessor:0,yAccessors:[1],data:S,curve:dt.CurveType.LINEAR}),Object(g.jsx)(dt.LineSeries,{key:"job-results",color:V.euiColorAccentText,id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.bucketSeriesId",{defaultMessage:"Datafeed document count"}),xScaleType:dt.ScaleType.Time,yScaleType:dt.ScaleType.Linear,xAccessor:0,yAccessors:[1],data:f,curve:dt.CurveType.LINEAR})))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.chartRightArrowTooltip",defaultMessage:"Next time window"})},Object(g.jsx)(o.EuiButtonEmpty,{"aria-label":r.i18n.translate("xpack.ml.jobsList.datafeedChart.chartIntervalRightArrow",{defaultMessage:"Next time window"}),color:"primary",onClick:()=>{J(ba)},iconType:"arrowRight"}))))),void 0!==D?Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{direction:"column"},Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.messagesTableTitle",defaultMessage:"Job messages"}))),Object(g.jsx)(ua,_()({jobId:e},D,{actionHandler:function(e){if(E.length>0&&E[0].dataValue===e.timestamp)M([]);else{const t=va({dataValue:e.timestamp,details:e.message});M([t])}}})))):null):null)))},Ea=({setShowFunction:e,unsetShowFunction:t,refreshJobs:a})=>{const[i,s]=Object(n.useState)(!1),[o,r]=Object(n.useState)(),[l,c]=Object(n.useState)(),[d,u]=Object(n.useState)(!1),[p,m]=Object(n.useState)(null),b=Object(n.useCallback)((e=>{r(e),s(!0)}),[]),f=Object(n.useCallback)((async()=>{const e=await ce(o.id);c(e),u(!0)}),[o]);return Object(n.useEffect)((()=>(e(b),()=>{t()})),[]),!0===i&&void 0!==o?Object(g.jsx)(Oa,{onClose:()=>s(!1),onModelSnapshotAnnotationClick:e=>{s(!1),m(e),f()},end:o.latestResultsTimestampMs||Date.now(),jobId:o.id}):!0===d&&void 0!==l&&null!==p?Object(g.jsx)(oa,{snapshot:p,snapshots:[p],job:l,closeFlyout:()=>{u(!1)},refresh:a}):null},wa=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationsTable.editAnnotationsTooltip",defaultMessage:"Edit annotation"}),Ma=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationsTable.datafeedChartTooltip",defaultMessage:"View datafeed counts"}),Sa="current_series";class annotations_table_AnnotationsTableUI extends n.Component{constructor(e){super(e),Y()(this,"getAnnotationsWithExtraInfo",Ze()((e=>{var t,a;return Array.isArray(null===(t=this.props.chartDetails)||void 0===t||null===(a=t.entityData)||void 0===a?void 0:a.entities)?e.map((e=>{var t,a;const i=null===(t=this.props.chartDetails)||void 0===t||null===(a=t.entityData)||void 0===a?void 0:a.entities.every((({fieldType:t,fieldValue:a})=>{const i=`${t}_value`;return!(!e[i]||e[i]!==a)}));return{...e,[Sa]:i}})):e}))),Y()(this,"annotationsRefreshSubscription",null),Y()(this,"previousJobId",void 0),Y()(this,"openSingleMetricView",(async(e={})=>{const{services:{application:{navigateToUrl:t},share:a}}=this.props.kibana,i=this.getJob(e.job_id),n=i.data_counts,s=Object(Qe.i)(n.latest_record_timestamp,n.latest_bucket_timestamp),o={from:new Date(n.earliest_record_timestamp).toISOString(),to:new Date(s).toISOString(),mode:"absolute"};let r={};const l={};void 0!==e.timestamp&&void 0!==e.end_timestamp&&(r={zoom:{from:new Date(e.timestamp).toISOString(),to:new Date(e.end_timestamp).toISOString()}},e.timestamp<n.earliest_record_timestamp&&(o.from=new Date(e.timestamp).toISOString()),e.end_timestamp>n.latest_record_timestamp&&(o.to=new Date(e.end_timestamp).toISOString())),void 0!==e.detector_index&&(r.detectorIndex=e.detector_index),void 0!==e.partition_field_value&&(l[e.partition_field_name]=e.partition_field_value),void 0!==e.over_field_value&&(l[e.over_field_name]=e.over_field_value),void 0!==e.by_field_value&&(l[e.by_field_name]=e.by_field_value),r.entities=l;const c=a.url.locators.get(E.a),d=await c.getUrl({page:E.b.SINGLE_METRIC_VIEWER,pageState:{timeRange:o,refreshInterval:{display:"Off",pause:!0,value:0},jobIds:[i.job_id],query:{query_string:{analyze_wildcard:!0,query:"*"}},...r}},{absolute:!0});Object(tt.a)("timeseriesexplorer",i.job_id,d),await t(d)})),Y()(this,"onMouseOverRow",(e=>{void 0!==this.mouseOverRecord?this.mouseOverRecord.rowId!==e.rowId&&(it.rowMouseleave$.next({record:this.mouseOverRecord,type:"annotation"}),it.rowMouseenter$.next({record:e,type:"annotation"})):it.rowMouseenter$.next({record:e,type:"annotation"}),this.mouseOverRecord=e})),Y()(this,"onMouseLeaveRow",(()=>{void 0!==this.mouseOverRecord&&(it.rowMouseleave$.next({record:this.mouseOverRecord,type:"annotation"}),this.mouseOverRecord=void 0)})),this.state={annotations:[],isLoading:!1,queryText:"event:(user or delayed_data)",searchError:void 0,jobId:Array.isArray(this.props.jobs)&&this.props.jobs.length>0&&void 0!==this.props.jobs[0]?this.props.jobs[0].job_id:void 0,datafeedFlyoutVisible:!1,modelSnapshot:null,revertSnapshotFlyoutVisible:!1,datafeedEnd:null},this.sorting={sort:{field:"timestamp",direction:"asc"}}}getAnnotations(){const e=this.props.jobs[0],t=e.data_counts;this.setState({isLoading:!0}),t.processed_record_count>0?X.ml.annotations.getAnnotations$({jobIds:[e.job_id],earliestMs:null,latestMs:null,maxAnnotations:nt.a}).toPromise().then((e=>{this.setState(((t,a)=>({annotations:e.annotations[a.jobs[0].job_id]||[],errorMessage:void 0,isLoading:!1,jobId:a.jobs[0].job_id})))})).catch((e=>{console.log("Error loading list of annotations for jobs list:",e),this.setState({annotations:[],errorMessage:"Error loading the list of annotations for this job",isLoading:!1,jobId:void 0})})):this.setState({annotations:[],isLoading:!1,jobId:void 0})}getJob(e){if(Array.isArray(this.props.jobs)&&this.props.jobs.length>0){const t=this.props.jobs[0];if(void 0===e||t.job_id===e)return t}return K.a.getJob(e)}componentDidMount(){void 0===this.props.annotations&&Array.isArray(this.props.jobs)&&this.props.jobs.length>0&&(this.annotationsRefreshSubscription=st.b.subscribe((()=>{this.getAnnotations()})),Object(st.c)())}componentDidUpdate(){Array.isArray(this.props.jobs)&&this.props.jobs.length>0&&this.previousJobId!==this.props.jobs[0].job_id&&void 0===this.props.annotations&&!1===this.state.isLoading&&this.state.jobId!==this.props.jobs[0].job_id&&(Object(st.c)(),this.previousJobId=this.props.jobs[0].job_id)}componentWillUnmount(){null!==this.annotationsRefreshSubscription&&this.annotationsRefreshSubscription.unsubscribe()}render(){var e,t,a;const{isSingleMetricViewerLinkVisible:i=!0,isNumberBadgeVisible:s=!1,annotationUpdatesService:l}=this.props,{queryText:c,searchError:d}=this.state;if(void 0===this.props.annotations){if(!0===this.state.isLoading)return Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiLoadingSpinner,{size:"l"})));if(void 0!==this.state.errorMessage)return Object(g.jsx)(o.EuiCallOut,{title:this.state.errorMessage,color:"danger",iconType:"cross"})}const u=this.props.annotations||this.state.annotations;if(0===u.length)return Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationsTable.annotationsNotCreatedTitle",defaultMessage:"No annotations created for this job"}),iconType:"iInCircle",role:"alert"},this.state.jobId&&Object(Qe.q)(this.getJob(this.state.jobId))&&Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationsTable.howToCreateAnnotationDescription",defaultMessage:"To create an annotation, open the {linkToSingleMetricView}",values:{linkToSingleMetricView:Object(g.jsx)(o.EuiLink,{onClick:()=>this.openSingleMetricView()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationsTable.howToCreateAnnotationDescription.singleMetricViewerLinkText",defaultMessage:"Single Metric Viewer"}))}})));const p=[{field:"annotation",name:r.i18n.translate("xpack.ml.annotationsTable.annotationColumnName",{defaultMessage:"Annotation"}),sortable:!0,width:"40%",scope:"row","data-test-subj":"mlAnnotationsColumnAnnotation"},{field:"timestamp",name:r.i18n.translate("xpack.ml.annotationsTable.fromColumnName",{defaultMessage:"From"}),dataType:"date",render:Je.e,sortable:!0,"data-test-subj":"mlAnnotationsColumnFrom"},{field:"end_timestamp",name:r.i18n.translate("xpack.ml.annotationsTable.toColumnName",{defaultMessage:"To"}),dataType:"date",render:Je.e,sortable:!0,"data-test-subj":"mlAnnotationsColumnTo"},{field:"modified_time",name:r.i18n.translate("xpack.ml.annotationsTable.lastModifiedDateColumnName",{defaultMessage:"Last modified date"}),dataType:"date",render:Je.e,sortable:!0,"data-test-subj":"mlAnnotationsColumnModifiedDate"},{field:"modified_username",name:r.i18n.translate("xpack.ml.annotationsTable.lastModifiedByColumnName",{defaultMessage:"Last modified by"}),sortable:!0,"data-test-subj":"mlAnnotationsColumnModifiedBy"},{field:"event",name:r.i18n.translate("xpack.ml.annotationsTable.eventColumnName",{defaultMessage:"Event"}),sortable:!0,width:"10%","data-test-subj":"mlAnnotationsColumnEvent"}];Object(Q.uniq)(u.map((e=>e.job_id))).length>1&&p.unshift({field:"job_id",name:r.i18n.translate("xpack.ml.annotationsTable.jobIdColumnName",{defaultMessage:"job ID"}),sortable:!0,"data-test-subj":"mlAnnotationsColumnJobId"}),s&&p.unshift({field:"key",name:r.i18n.translate("xpack.ml.annotationsTable.labelColumnName",{defaultMessage:"Label"}),sortable:e=>+e,width:"60px",render:e=>Object(g.jsx)(o.EuiBadge,{color:"default"},e),"data-test-subj":"mlAnnotationsColumnLabel"});const b=[];b.push({name:wa,description:wa,icon:"pencil",type:"icon",onClick:e=>{const t=e._id,a=u.find((e=>e._id===t));l.setValue(null!=a?a:e)},"data-test-subj":"mlAnnotationsActionEdit"}),this.state.jobId&&this.props.jobs[0].analysis_config.bucket_span&&b.push({name:Ma,description:Ma,icon:"visAreaStacked",type:"icon",onClick:e=>{this.setState({datafeedFlyoutVisible:!0,datafeedEnd:e.end_timestamp})},"data-test-subj":"mlAnnotationsActionViewDatafeed"}),i&&b.push({name:e=>Object(Qe.q)(this.getJob(e.job_id))?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationsTable.openInSingleMetricViewerTooltip",defaultMessage:"Open in Single Metric Viewer"}):Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationsTable.jobConfigurationNotSupportedInSingleMetricViewerTooltip",defaultMessage:"Job configuration not supported in Single Metric Viewer"})},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationsTable.openInSingleMetricViewerTooltip",defaultMessage:"Open in Single Metric Viewer"})),description:e=>Object(Qe.q)(this.getJob(e.job_id))?r.i18n.translate("xpack.ml.annotationsTable.openInSingleMetricViewerAriaLabel",{defaultMessage:"Open in Single Metric Viewer"}):r.i18n.translate("xpack.ml.annotationsTable.jobConfigurationNotSupportedInSingleMetricViewerAriaLabel",{defaultMessage:"Job configuration not supported in Single Metric Viewer"}),enabled:e=>Object(Qe.q)(this.getJob(e.job_id)),icon:"visLine",type:"icon",onClick:e=>this.openSingleMetricView(e),"data-test-subj":"mlAnnotationsActionOpenInSingleMetricViewer"});const f={[lt]:0,delayed_data:0};u.forEach((e=>{var t;const a=null!==(t=e.event)&&void 0!==t?t:lt;void 0===f[a]&&(f[a]=0),f[a]++}));const h=[{type:"field_value_selection",field:"event",name:"Event",multiSelect:"or",options:Object.entries(f).map((([e,t])=>({value:e,name:e,view:`${e} (${t})`}))),"data-test-subj":"mlAnnotationTableEventFilter"}];var j,x;this.props.detectors&&p.push({name:r.i18n.translate("xpack.ml.annotationsTable.detectorColumnName",{defaultMessage:"Detector"}),width:"10%",render:e=>"detector_index"in e?this.props.detectors[e.detector_index].detector_description:""}),Array.isArray(null===(e=this.props.chartDetails)||void 0===e||null===(t=e.entityData)||void 0===t?void 0:t.entities)?(null===(j=this.props.chartDetails)||void 0===j||null===(x=j.entityData)||void 0===x||x.entities.forEach((e=>{"partition_field"===e.fieldType&&p.push({field:"partition_field_value",name:r.i18n.translate("xpack.ml.annotationsTable.partitionSMVColumnName",{defaultMessage:"Partition"}),sortable:!0}),"over_field"===e.fieldType&&p.push({field:"over_field_value",name:r.i18n.translate("xpack.ml.annotationsTable.overColumnSMVName",{defaultMessage:"Over"}),sortable:!0}),"by_field"===e.fieldType&&p.push({field:"by_field_value",name:r.i18n.translate("xpack.ml.annotationsTable.byColumnSMVName",{defaultMessage:"By"}),sortable:!0})})),h.push({type:"is",field:Sa,name:r.i18n.translate("xpack.ml.annotationsTable.seriesOnlyFilterName",{defaultMessage:"Filter to series"})})):(p.push({field:"partition_field_value",name:r.i18n.translate("xpack.ml.annotationsTable.partitionAEColumnName",{defaultMessage:"Partition"}),sortable:!0}),p.push({field:"over_field_value",name:r.i18n.translate("xpack.ml.annotationsTable.overAEColumnName",{defaultMessage:"Over"}),sortable:!0}),p.push({field:"by_field_value",name:r.i18n.translate("xpack.ml.annotationsTable.byAEColumnName",{defaultMessage:"By"}),sortable:!0}));const v={defaultQuery:c,box:{incremental:!0,schema:!0},filters:h};p.push({align:et.RIGHT_ALIGNMENT,width:"60px",name:r.i18n.translate("xpack.ml.annotationsTable.actionsColumnName",{defaultMessage:"Actions"}),actions:b,"data-test-subj":"mlAnnotationsColumnActions"},{field:Sa,name:Sa,dataType:"boolean",width:"0px",render:()=>""});const y=this.getAnnotationsWithExtraInfo(u);return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiInMemoryTable,{"data-test-subj":"mlAnnotationsTable",error:d,className:"eui-textBreakWord",compressed:!0,items:y,columns:p,pagination:{pageSizeOptions:[5,10,25]},sorting:this.sorting,search:v,rowProps:e=>({"data-test-subj":`mlAnnotationsTableRow row-${e._id}`,onMouseOver:()=>this.onMouseOverRow(e),onMouseLeave:()=>this.onMouseLeaveRow()})}),this.state.jobId&&this.state.datafeedFlyoutVisible&&this.state.datafeedEnd?Object(g.jsx)(Oa,{onClose:()=>{this.setState({datafeedFlyoutVisible:!1})},onModelSnapshotAnnotationClick:e=>{this.setState({modelSnapshot:e,revertSnapshotFlyoutVisible:!0,datafeedFlyoutVisible:!1})},end:this.state.datafeedEnd,jobId:this.state.jobId}):null,!0===this.state.revertSnapshotFlyoutVisible&&null!==this.state.modelSnapshot?Object(g.jsx)(oa,{snapshot:this.state.modelSnapshot,snapshots:[this.state.modelSnapshot],job:this.getJob(this.state.jobId),closeFlyout:()=>{this.setState({revertSnapshotFlyoutVisible:!1})},refresh:null!==(a=this.props.refreshJobList)&&void 0!==a?a:()=>{}}):null)}}const _a=Object(c.withKibana)((e=>{const t=Object(n.useContext)(ct);return Object(g.jsx)(annotations_table_AnnotationsTableUI,_()({annotationUpdatesService:t},e))})),Ta=({annotation:e,detectorDescription:t})=>{const a=[{title:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.jobIdTitle",{defaultMessage:"Job ID"}),description:e.job_id},{title:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.startTitle",{defaultMessage:"Start"}),description:Object(Je.d)(e.timestamp)}];var i,n,s,l,c;return void 0!==e.end_timestamp&&a.push({title:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.endTitle",{defaultMessage:"End"}),description:Object(Je.d)(e.end_timestamp)}),void 0!==e.create_time&&void 0!==e.modified_time&&(a.push({title:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.createdTitle",{defaultMessage:"Created"}),description:Object(Je.d)(e.create_time)}),a.push({title:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.createdByTitle",{defaultMessage:"Created by"}),description:null!==(i=e.create_username)&&void 0!==i?i:""}),a.push({title:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.lastModifiedTitle",{defaultMessage:"Last modified"}),description:Object(Je.d)(e.modified_time)}),a.push({title:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.modifiedByTitle",{defaultMessage:"Modified by"}),description:null!==(n=e.modified_username)&&void 0!==n?n:""})),void 0!==t&&a.push({title:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.detectorTitle",{defaultMessage:"Detector"}),description:t}),void 0!==e.partition_field_name&&a.push({title:e.partition_field_name,description:null!==(s=e.partition_field_value)&&void 0!==s?s:""}),void 0!==e.over_field_name&&a.push({title:e.over_field_name,description:null!==(l=e.over_field_value)&&void 0!==l?l:""}),void 0!==e.by_field_name&&a.push({title:e.by_field_name,description:null!==(c=e.by_field_value)&&void 0!==c?c:""}),Object(g.jsx)(o.EuiDescriptionList,{"data-test-subj":"mlAnnotationDescriptionList",className:"ml-annotation-description-list",type:"column",listItems:a})},Ca=({cancelAction:e,deleteAction:t,isVisible:a})=>Object(g.jsx)(n.Fragment,null,!0===a&&Object(g.jsx)(o.EuiConfirmModal,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.deleteAnnotationModal.deleteAnnotationTitle",defaultMessage:"Delete this annotation?"}),onCancel:e,onConfirm:t,cancelButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.deleteAnnotationModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.deleteAnnotationModal.deleteButtonLabel",defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:o.EUI_MODAL_CONFIRM_BUTTON,className:"eui-textBreakWord","data-test-subj":"mlAnnotationFlyoutConfirmDeleteModal"}));function ka(e){return`${e}_name`}function Fa(e){return`${e}_value`}class annotation_flyout_AnnotationFlyoutUI extends n.Component{constructor(...e){super(...e),Y()(this,"deletionInProgress",!1),Y()(this,"state",{isDeleteModalVisible:!1,applyAnnotationToSeries:!0,annotationState:null}),Y()(this,"annotationSub",null),Y()(this,"annotationTextChangeHandler",(e=>{if(null===this.state.annotationState)return;const{annotationUpdatesService:t}=this.props;t.setValue({...this.state.annotationState,annotation:e.target.value})})),Y()(this,"cancelEditingHandler",(()=>{const{annotationUpdatesService:e}=this.props;e.setValue(null)})),Y()(this,"deleteConfirmHandler",(()=>{this.setState({isDeleteModalVisible:!0})})),Y()(this,"deleteHandler",(async()=>{if(this.deletionInProgress)return;const{annotationState:e}=this.state,t=Object(ee.n)();if(null===e||void 0===e._id)return;this.deletionInProgress=!0;try{await X.ml.annotations.deleteAnnotation(e._id),t.addSuccess(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.deletedAnnotationNotificationMessage",{defaultMessage:"Deleted annotation for job with ID {jobId}.",values:{jobId:e.job_id}}))}catch(a){t.addDanger(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.errorWithDeletingAnnotationNotificationErrorMessage",{defaultMessage:"An error occurred deleting the annotation for job with ID {jobId}: {error}",values:{jobId:e.job_id,error:JSON.stringify(a)}}))}this.closeDeleteModal(),this.deletionInProgress=!1;const{annotationUpdatesService:a}=this.props;a.setValue(null),Object(st.c)()})),Y()(this,"closeDeleteModal",(()=>{this.setState({isDeleteModalVisible:!1})})),Y()(this,"validateAnnotationText",(()=>{const{annotationState:e}=this.state,t=[];if(null===e)return t;0===e.annotation.trim().length&&t.push(r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationFlyout.noAnnotationTextError",{defaultMessage:"Enter annotation text"}));const a=e.annotation.length;if(a>rt){const e=a-rt;t.push(r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationFlyout.maxLengthError",{defaultMessage:"{charsOver, number} {charsOver, plural, one {character} other {characters}} above maximum length of {maxChars}",values:{maxChars:rt,charsOver:e}}))}return t})),Y()(this,"saveOrUpdateAnnotation",(()=>{var e,t;const{annotationState:a}=this.state,{chartDetails:i,detectorIndex:n,annotationUpdatesService:s}=this.props;if(null===a)return;const o=Object(Q.cloneDeep)(a);this.state.applyAnnotationToSeries&&null!=i&&null!==(e=i.entityData)&&void 0!==e&&e.entities&&(i.entityData.entities.forEach((e=>{const{fieldName:t,fieldValue:a}=e,i=e.fieldType;o[ka(i)]=t,o[Fa(i)]=a})),o.detector_index=n),this.state.applyAnnotationToSeries||(delete o.detector_index,Qt.e.forEach((e=>{delete o[ka(e)],delete o[Fa(e)]}))),o.event=null!==(t=o.event)&&void 0!==t?t:lt,s.setValue(null),X.ml.annotations.indexAnnotation(o).then((()=>{Object(st.c)();const e=Object(ee.n)();void 0===o._id?e.addSuccess(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.addedAnnotationNotificationMessage",{defaultMessage:"Added an annotation for job with ID {jobId}.",values:{jobId:o.job_id}})):e.addSuccess(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.updatedAnnotationNotificationMessage",{defaultMessage:"Updated annotation for job with ID {jobId}.",values:{jobId:o.job_id}}))})).catch((e=>{const t=Object(ee.n)();void 0===o._id?t.addDanger(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.errorWithCreatingAnnotationNotificationErrorMessage",{defaultMessage:"An error occurred creating the annotation for job with ID {jobId}: {error}",values:{jobId:o.job_id,error:JSON.stringify(e)}})):t.addDanger(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.errorWithUpdatingAnnotationNotificationErrorMessage",{defaultMessage:"An error occurred updating the annotation for job with ID {jobId}: {error}",values:{jobId:o.job_id,error:JSON.stringify(e)}}))}))}))}componentDidMount(){const{annotationUpdatesService:e}=this.props;this.annotationSub=e.update$().subscribe((e=>{this.setState({annotationState:e})}))}componentWillUnmount(){this.annotationSub.unsubscribe()}render(){const{detectors:e,detectorIndex:t}=this.props,{annotationState:a,isDeleteModalVisible:i}=this.state;if(!a)return null;const n=void 0!==a._id,l=this.validateAnnotationText(),c=l.length>0;let d=null;!1===c&&a.annotation.length>950&&(d=r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationFlyout.approachingMaxLengthWarning",{defaultMessage:"{charsRemaining, number} {charsRemaining, plural, one {character} other {characters}} remaining",values:{charsRemaining:rt-a.annotation.length}}));const u=e?e.find((e=>e.index===t)):void 0,p=u&&"detector_description"in u?u.detector_description:"";return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlyoutBody,null,Object(g.jsx)(Ta,{annotation:a,detectorDescription:p}),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.annotationTextLabel",defaultMessage:"Annotation text"}),fullWidth:!0,helpText:d,isInvalid:c,error:l},Object(g.jsx)(o.EuiTextArea,{fullWidth:!0,isInvalid:c,onChange:this.annotationTextChangeHandler,placeholder:"...",value:a.annotation,"data-test-subj":"mlAnnotationsFlyoutTextInput"})),Object(g.jsx)(o.EuiFormRow,null,Object(g.jsx)(o.EuiCheckbox,{id:"xpack.ml.annotationFlyout.applyToPartition",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationFlyout.applyToPartitionTextLabel",defaultMessage:"Apply annotation to this series"}),checked:this.state.applyAnnotationToSeries,onChange:()=>this.setState({applyAnnotationToSeries:!this.state.applyAnnotationToSeries}),"data-test-subj":"mlAnnotationsFlyoutApplyToSeriesButton"}))),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{onClick:this.cancelEditingHandler,flush:"left","data-test-subj":"mlAnnotationsFlyoutCancelButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{marginLeft:"auto"}},n&&Object(g.jsx)(o.EuiButtonEmpty,{color:"danger",onClick:this.deleteConfirmHandler,"data-test-subj":"mlAnnotationsFlyoutDeleteButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.deleteButtonLabel",defaultMessage:"Delete"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{fill:!0,isDisabled:!0===c,onClick:this.saveOrUpdateAnnotation,"data-test-subj":"annotationFlyoutUpdateOrCreateButton"},n?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.updateButtonLabel",defaultMessage:"Update"}):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.createButtonLabel",defaultMessage:"Create"}))))),Object(g.jsx)(Ca,{cancelAction:this.closeDeleteModal,deleteAction:this.deleteHandler,isVisible:i}))}}const Ia=e=>{const t=Object(n.useContext)(ct),a=G()(t.isAnnotationInitialized$()),i=Object(n.useCallback)((()=>{t.setValue(null)}),[]);if(null==a)return null;const s=void 0!==a._id;return Object(g.jsx)(o.EuiFlyout,{onClose:i,size:"m","aria-labelledby":"Add annotation","data-test-subj":"mlAnnotationFlyout",className:"mlAnnotationFlyout"},Object(g.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(g.jsx)(o.EuiTitle,{size:"s","data-test-subj":"mlAnnotationFlyoutTitle"},Object(g.jsx)("h2",{id:"mlAnnotationFlyoutTitle"},s?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.editAnnotationTitle",defaultMessage:"Edit annotation"}):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.addAnnotationTitle",defaultMessage:"Add annotation"})))),Object(g.jsx)(annotation_flyout_AnnotationFlyoutUI,_()({},e,{annotationUpdatesService:t})))},Da=({snapshot:e,job:t,closeFlyout:a})=>{const{toasts:i}=Object(y.f)(),[l,c]=Object(n.useState)(e.description),[d,u]=Object(n.useState)(e.retain),[p,b]=Object(n.useState)(!1),[f,h]=Object(n.useState)(e.snapshot_id===t.model_snapshot_id);Object(n.useEffect)((()=>{h(e.snapshot_id===t.model_snapshot_id)}),[e]);const j=Object(n.useCallback)((async()=>{try{await X.ml.updateModelSnapshot(e.job_id,e.snapshot_id,{description:l,retain:d}),v()}catch(e){i.addError(new Error(e.body.message),{title:r.i18n.translate("xpack.ml.editModelSnapshotFlyout.saveErrorTitle",{defaultMessage:"Model snapshot update failed"})})}}),[d,l,e]),x=Object(n.useCallback)((async()=>{try{await X.ml.deleteModelSnapshot(e.job_id,e.snapshot_id),E(),v()}catch(e){i.addError(new Error(e.body.message),{title:r.i18n.translate("xpack.ml.editModelSnapshotFlyout.deleteErrorTitle",{defaultMessage:"Model snapshot deletion failed"})})}}),[e]);function v(){a(!0)}function O(){a(!1)}function E(){b(!1)}return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlyout,{onClose:O,hideCloseButton:!0,size:"m"},Object(g.jsx)(o.EuiFlyoutBody,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h5",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.title",defaultMessage:"Edit snapshot {ssId}",values:{ssId:e.snapshot_id}}))),f&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiCallOut,{size:"s",title:r.i18n.translate("xpack.ml.editModelSnapshotFlyout.calloutTitle",{defaultMessage:"Current snapshot"})},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.calloutText",defaultMessage:"This is the current snapshot being used by job {jobId} and so cannot be deleted.",values:{jobId:t.job_id}}))),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.editModelSnapshotFlyout.descriptionTitle",{defaultMessage:"Description"}),fullWidth:!0},Object(g.jsx)(o.EuiTextArea,{fullWidth:!0,value:l,onChange:e=>c(e.target.value)})),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0},Object(g.jsx)(o.EuiSwitch,{label:r.i18n.translate("xpack.ml.editModelSnapshotFlyout.retainSwitchLabel",{defaultMessage:"Retain snapshot during automatic snapshot cleanup process"}),checked:d,onChange:e=>u(e.target.checked)})))),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:O,flush:"left"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.closeButton",defaultMessage:"Close"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!0}),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{onClick:function(){b(!0)},color:"danger",disabled:!0===f},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.useDefaultButton",defaultMessage:"Delete"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:j,fill:!0},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.saveButton",defaultMessage:"Save"})))))),p&&Object(g.jsx)(o.EuiConfirmModal,{title:r.i18n.translate("xpack.ml.editModelSnapshotFlyout.deleteTitle",{defaultMessage:"Delete snapshot?"}),onCancel:E,onConfirm:x,cancelButtonText:r.i18n.translate("xpack.ml.editModelSnapshotFlyout.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:r.i18n.translate("xpack.ml.editModelSnapshotFlyout.deleteButton",{defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:"confirm"}))},Aa=({combinedJobState:e,hideCloseJobModalVisible:t,forceCloseJob:a})=>Object(g.jsx)(o.EuiConfirmModal,{title:e===La.OPEN_AND_RUNNING?r.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.stopAndClose.title",{defaultMessage:"Stop datafeed and close job?"}):r.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.close.title",{defaultMessage:"Close job?"}),onCancel:t,onConfirm:a,cancelButtonText:r.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:e===La.OPEN_AND_RUNNING?r.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.stopAndClose.button",{defaultMessage:"Stop and close"}):r.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.close.button",{defaultMessage:"Close"}),defaultFocusedButton:"confirm"},Object(g.jsx)("p",null,e===La.OPEN_AND_RUNNING&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.modelSnapshotTable.closeJobConfirm.contentOpenAndRunning",defaultMessage:"Job is currently open and running."}),e===La.OPEN_AND_STOPPED&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.modelSnapshotTable.closeJobConfirm.contentOpen",defaultMessage:"Job is currently open."}),Object(g.jsx)("br",null),Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.modelSnapshotTable.closeJobConfirm.content",defaultMessage:"Snapshot revert can only happen on jobs which are closed."})));let La;!function(e){e[e.OPEN_AND_RUNNING=0]="OPEN_AND_RUNNING",e[e.OPEN_AND_STOPPED=1]="OPEN_AND_STOPPED",e[e.CLOSED=2]="CLOSED",e[e.UNKNOWN=3]="UNKNOWN"}(La||(La={}));const Ra=({job:e,refreshJobList:t})=>{const a=Object(w.e)("canCreateJob"),i=Object(w.e)("canStartStopDatafeed"),[l,c]=Object(n.useState)([]),[d,u]=Object(n.useState)(!1),[p,m]=Object(n.useState)(null),[b,f]=Object(n.useState)(null),[h,j]=Object(n.useState)(null),[x,v]=Object(n.useState)(null),y=Object(n.useRef)(!0);async function O(){if(!1===y.current)return;const{model_snapshots:t}=await X.ml.getModelSnapshots(e.job_id);c(t),u(!0)}Object(n.useEffect)((()=>(O(),()=>{y.current=!1})),[]);const E=Object(n.useCallback)((async t=>{const a=await Na(e.job_id);a!==La.UNKNOWN?(v(a),a===La.CLOSED?f(t):j(t)):console.error(`Error retrieving state for job ${e.job_id}`)}),[e]);function M(){v(null),j(null)}const S=Object(n.useCallback)((async()=>{await X.ml.jobs.forceStopAndCloseJob(e.job_id),null!==h&&await Na(e.job_id)===La.CLOSED&&f(h),M()}),[e,h]),_=Object(n.useCallback)((e=>{m(null),e&&O()}),[]),T=Object(n.useCallback)((()=>{f(null)}),[]),C=Object(n.useCallback)((()=>{O(),setTimeout(t,500)}),[]),k=[{field:"snapshot_id",name:r.i18n.translate("xpack.ml.modelSnapshotTable.id",{defaultMessage:"ID"}),sortable:!0},{field:"description",name:r.i18n.translate("xpack.ml.modelSnapshotTable.description",{defaultMessage:"Description"}),sortable:!0},{field:"timestamp",name:r.i18n.translate("xpack.ml.modelSnapshotTable.time",{defaultMessage:"Date created"}),dataType:"date",render:Je.e,sortable:!0},{field:"latest_record_time_stamp",name:r.i18n.translate("xpack.ml.modelSnapshotTable.latestTimestamp",{defaultMessage:"Latest timestamp"}),dataType:"date",render:Je.e,sortable:!0},{field:"retain",name:r.i18n.translate("xpack.ml.modelSnapshotTable.retain",{defaultMessage:"Retain"}),width:"100px",sortable:!0},{field:"",width:"100px",name:r.i18n.translate("xpack.ml.modelSnapshotTable.actions",{defaultMessage:"Actions"}),actions:[{name:r.i18n.translate("xpack.ml.modelSnapshotTable.actions.revert.name",{defaultMessage:"Revert"}),description:r.i18n.translate("xpack.ml.modelSnapshotTable.actions.revert.description",{defaultMessage:"Revert to this snapshot"}),enabled:()=>a&&i,type:"icon",icon:"crosshairs",onClick:E},{name:r.i18n.translate("xpack.ml.modelSnapshotTable.actions.edit.name",{defaultMessage:"Edit"}),description:r.i18n.translate("xpack.ml.modelSnapshotTable.actions.edit.description",{defaultMessage:"Edit this snapshot"}),enabled:()=>a,type:"icon",icon:"pencil",onClick:m}]}];return!1===d?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiLoadingSpinner,{size:"l"})))):Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiInMemoryTable,{className:"eui-textBreakWord",compressed:!0,items:l,columns:k,pagination:{pageSizeOptions:[5,10,25]},sorting:{sort:{field:"timestamp",direction:"asc"}}}),null!==p&&Object(g.jsx)(Da,{snapshot:p,job:e,closeFlyout:_}),null!==b&&Object(g.jsx)(oa,{snapshot:b,snapshots:l,job:e,closeFlyout:T,refresh:C}),null!==h&&null!==x&&Object(g.jsx)(Aa,{combinedJobState:x,hideCloseJobModalVisible:M,forceCloseJob:S}))};async function Na(e){const t=await X.ml.jobs.jobs([e]);return 1!==t.length?La.UNKNOWN:t[0].state!==ae.c.CLOSED?t[0].datafeed_config.state!==ae.a.STOPPED?La.OPEN_AND_RUNNING:La.OPEN_AND_STOPPED:La.CLOSED}var Pa=a(74),za=a(25);const Ba=function(e,t,a,i){return new Promise(((n,s)=>{const o={success:!0,forecasts:[]},r=[{term:{result_type:"model_forecast_request_stats"}},{term:{job_id:e.job_id}},{range:{timestamp:{gte:a,format:"epoch_millis"}}}];t&&r.push(t),X.ml.results.anomalySearch({size:i,body:{query:{bool:{filter:r}},sort:[{forecast_create_timestamp:{order:"desc"}}]}},[e.job_id]).then((e=>{e.hits.total.value>0&&(o.forecasts=e.hits.hits.map((e=>e._source))),n(o)})).catch((e=>{s(e)}))}))},Va=function(e,t){return new Promise(((a,i)=>{const n={success:!0,earliest:null,latest:null},s=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:!0}},{term:{job_id:e.job_id}},{term:{forecast_id:t}}];X.ml.results.anomalySearch({size:0,body:{query:{bool:{filter:s}},aggs:{earliest:{min:{field:"timestamp"}},latest:{max:{field:"timestamp"}}}}},[e.job_id]).then((e=>{n.earliest=Object(Q.get)(e,"aggregations.earliest.value",null),n.latest=Object(Q.get)(e,"aggregations.latest.value",null),null===n.earliest||null===n.latest?i(e):a(n)})).catch((e=>{i(e)}))}))},Ja=function(e,t,a,i,n,s,o,r){const l=[],c=e.analysis_config.detectors[t];if(void 0!==c.partition_field_name){const e=Object(Q.find)(i,{fieldName:c.partition_field_name});void 0!==e&&l.push({fieldName:"partition_field_name",fieldValue:e.fieldName},{fieldName:"partition_field_value",fieldValue:e.fieldValue})}if(void 0!==c.over_field_name){const e=Object(Q.find)(i,{fieldName:c.over_field_name});void 0!==e&&l.push({fieldName:"over_field_name",fieldValue:e.fieldName},{fieldName:"over_field_value",fieldValue:e.fieldValue})}if(void 0!==c.by_field_name){const e=Object(Q.find)(i,{fieldName:c.by_field_name});void 0!==e&&l.push({fieldName:"by_field_name",fieldValue:e.fieldName},{fieldName:"by_field_value",fieldValue:e.fieldValue})}const d={success:!0,results:{}},u=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:!0}},{term:{job_id:e.job_id}},{term:{forecast_id:a}},{term:{detector_index:t}},{range:{timestamp:{gte:n,lte:s,format:"epoch_millis"}}}];Object(Q.each)(l,(e=>{u.push({term:{[e.fieldName]:e.fieldValue}})}));const p=void 0===r?{avg:"avg",max:"max",min:"min"}:{avg:r.avg,max:r.max,min:r.min};return X.ml.results.anomalySearch$({size:0,body:{query:{bool:{filter:u}},aggs:{times:{date_histogram:{field:"timestamp",fixed_interval:`${o}ms`,min_doc_count:1},aggs:{prediction:{[p.avg]:{field:"forecast_prediction"}},forecastUpper:{[p.max]:{field:"forecast_upper"}},forecastLower:{[p.min]:{field:"forecast_lower"}}}}}}},[e.job_id]).pipe(Object(za.map)((e=>{const t=Object(Q.get)(e,["aggregations","times","buckets"],[]);return Object(Q.each)(t,(e=>{const t=e.key;d.results[t]={prediction:Object(Q.get)(e,["prediction","value"]),forecastUpper:Object(Q.get)(e,["forecastUpper","value"]),forecastLower:Object(Q.get)(e,["forecastLower","value"])}})),d})))},Ua=function(e,t){return console.log("ML forecast service run forecast with duration:",t),new Promise(((a,i)=>{X.ml.forecast({jobId:e,duration:t}).then((e=>{a(e)})).catch((e=>{i(e)}))}))},Ga=function(e,t){return new Promise(((a,i)=>{const n={success:!0,stats:{}},s=[{query_string:{query:"result_type:model_forecast_request_stats",analyze_wildcard:!0}},{term:{job_id:e.job_id}},{term:{forecast_id:t}}];X.ml.results.anomalySearch({size:1,body:{query:{bool:{filter:s}}}},[e.job_id]).then((e=>{e.hits.total.value>0&&(n.stats=e.hits.hits[0]._source),a(n)})).catch((e=>{i(e)}))}))};class forecasts_table_ForecastsTableUI extends n.Component{constructor(e){super(e),this.state={isLoading:0!==e.job.data_counts.processed_record_count,forecasts:[]}}componentDidMount(){const e=this.props.job.data_counts;e.processed_record_count>0&&Ba(this.props.job,null,e.earliest_record_timestamp,500).then((e=>{this.setState({isLoading:!1,forecasts:e.forecasts})})).catch((e=>{console.log("Error loading list of forecasts for jobs list:",e),this.setState({isLoading:!1,errorMessage:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.loadingErrorMessage",{defaultMessage:"Error loading the list of forecasts run on this job"}),forecasts:[]})}))}async openSingleMetricView(e){const{services:{application:{navigateToUrl:t},share:a}}=this.props.kibana,i=this.props.job.data_counts,n=i.earliest_record_timestamp,s=Object(Qe.i)(i.latest_record_timestamp,i.latest_bucket_timestamp),o=new Date(i.earliest_record_timestamp).toISOString(),r=void 0!==e?new Date(e.forecast_end_timestamp).toISOString():new Date(s).toISOString();let l={};if(void 0!==e){const t=e.forecast_end_timestamp-e.forecast_start_timestamp,a=Math.max(e.forecast_start_timestamp-t,n);l={forecastId:e.forecast_id,zoom:{from:new Date(a).toISOString(),to:new Date(e.forecast_end_timestamp).toISOString()}}}const c=a.url.locators.get(E.a),d=await c.getUrl({page:E.b.SINGLE_METRIC_VIEWER,pageState:{timeRange:{from:o,to:r,mode:"absolute"},refreshInterval:{display:"Off",pause:!0,value:0},jobIds:[this.props.job.job_id],query:{query_string:{analyze_wildcard:!0,query:"*"}},...l}},{absolute:!0});Object(tt.a)("timeseriesexplorer",this.props.job.job_id,d),await t(d)}render(){if(!0===this.state.isLoading)return Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiLoadingSpinner,{size:"l"})));if(void 0!==this.state.errorMessage)return Object(g.jsx)(o.EuiCallOut,{title:this.state.errorMessage,color:"danger",iconType:"cross"});const e=this.state.forecasts;if(0===e.length)return Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsTitle",defaultMessage:"No forecasts have been run for this job"}),iconType:"iInCircle",role:"alert"},Object(Qe.q)(this.props.job)&&Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsDescription",defaultMessage:"To run a forecast, open the {singleMetricViewerLink}",values:{singleMetricViewerLink:Object(g.jsx)(o.EuiLink,{onClick:()=>this.openSingleMetricView()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsDescription.linkText",defaultMessage:"Single Metric Viewer"}))}})));const t=[{field:"forecast_create_timestamp",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.createdLabel",{defaultMessage:"Created"}),dataType:"date",render:Je.e,textOnly:!0,sortable:!0,scope:"row"},{field:"forecast_start_timestamp",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.fromLabel",{defaultMessage:"From"}),dataType:"date",render:Je.e,textOnly:!0,sortable:!0},{field:"forecast_end_timestamp",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.toLabel",{defaultMessage:"To"}),dataType:"date",render:Je.e,textOnly:!0,sortable:!0},{field:"forecast_status",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.statusLabel",{defaultMessage:"Status"}),sortable:!0},{field:"forecast_memory_bytes",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.memorySizeLabel",{defaultMessage:"Memory size"}),render:e=>Object(Pa.formatNumber)(e,"0b"),sortable:!0},{field:"processing_time_ms",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.processingTimeLabel",{defaultMessage:"Processing time"}),render:e=>r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.msTimeUnitLabel",{defaultMessage:"{ms} ms",values:{ms:e}}),sortable:!0},{field:"forecast_expiry_timestamp",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.expiresLabel",{defaultMessage:"Expires"}),render:Je.e,textOnly:!0,sortable:!0},{field:"forecast_messages",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.messagesLabel",{defaultMessage:"Messages"}),sortable:!1,render:e=>Object(g.jsx)("div",null,e.map(((e,t)=>Object(g.jsx)("p",{key:t},e)))),textOnly:!0},{name:r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.viewLabel",{defaultMessage:"View"}),width:"60px",render:e=>{const t=r.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.viewAriaLabel",{defaultMessage:"View forecast created at {createdDate}",values:{createdDate:Object(Je.e)(e.forecast_create_timestamp)}});return Object(g.jsx)(o.EuiButtonIcon,{onClick:()=>this.openSingleMetricView(e),isDisabled:e.forecast_status!==ae.b.FINISHED,iconType:"visLine","aria-label":t})}}];return Object(g.jsx)(o.EuiInMemoryTable,{compressed:!0,items:e,columns:t,pagination:{pageSizeOptions:[5,10,25]},sorting:!0})}}const qa=Object(c.withKibana)(forecasts_table_ForecastsTableUI);function $a({item:e}){return Object(g.jsx)(o.EuiTableRow,null,""!==e[0]&&Object(g.jsx)(o.EuiTableRowCell,null,Object(g.jsx)("span",{className:"job-item header"},e[0])),Object(g.jsx)(o.EuiTableRowCell,null,Object(g.jsx)("span",{className:"job-item"},e[1])))}function Wa({section:e}){return 0===e.items.length?Object(g.jsx)("div",null):Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h4",null,e.title))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},e.titleAction)),Object(g.jsx)("div",{className:"job-section","data-test-subj":`mlJobRowDetailsSection-${e.id}`},Object(g.jsx)(o.EuiTable,{compressed:!0},Object(g.jsx)(o.EuiTableBody,null,e.items.map(((e,t)=>Object(g.jsx)($a,{item:e,key:t})))))))}class job_details_pane_JobDetailsPane extends n.Component{constructor(e){super(e),this.state={}}static getDerivedStateFromProps(e){const{sections:t,time:a}=e;return{sections:t,time:a}}render(){const{sections:e,time:t}=this.state;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)("div",{className:"row",time:t,"data-test-subj":this.props["data-test-subj"]},Object(g.jsx)("div",{className:"col-md-6"},e.filter((e=>"left"===e.position)).map(((e,t)=>Object(g.jsx)(Wa,{section:e,key:t})))),Object(g.jsx)("div",{className:"col-md-6"},e.filter((e=>"right"===e.position)).map(((e,t)=>Object(g.jsx)(Wa,{section:e,key:t}))))))}}class job_details_JobDetailsUI extends n.Component{constructor(e){super(e),this.state={datafeedChartFlyoutVisible:!1,modelSnapshot:null,revertSnapshotFlyoutVisible:!1},this.props.addYourself&&this.props.addYourself(e.jobId,(e=>this.updateJob(e)))}componentWillUnmount(){this.props.removeYourself(this.props.jobId)}updateJob(e){this.setState({job:e})}render(){var e;const t=null!==(e=this.state.job)&&void 0!==e?e:this.props.job,{services:{http:{basePath:a}}}=this.props.kibana;if(void 0===t)return Object(g.jsx)("div",{className:"job-loading-spinner","data-test-subj":"mlJobDetails loading"},Object(g.jsx)(o.EuiLoadingSpinner,{size:"l"}));{const{refreshJobList:e,showClearButton:i}=this.props,{general:l,customUrl:c,node:d,calendars:u,detectors:p,influencers:b,analysisConfig:f,analysisLimits:h,dataDescription:j,customSettings:x,jobTags:v,datafeed:y,counts:O,modelSizeStats:E,jobTimingStats:w,datafeedTimingStats:M,alertRules:S}=function(e,t,a){var i,n;if(0===Object.keys(e).length)return{};const s={id:"general",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.generalTitle",{defaultMessage:"General"}),position:"left",items:Ge(e,!0).map(Ue)},{job_tags:l,custom_urls:c,...d}=null!==(i=e.custom_settings)&&void 0!==i?i:{},u={id:"customUrl",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.customUrlsTitle",{defaultMessage:"Custom URLs"}),position:"right",items:c?c.map((e=>[e.url_name,e.url_value,e.time_range])):[]},p={id:"analysisConfig",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.customSettingsTitle",{defaultMessage:"Custom settings"}),position:"right",items:d?Ge(d,!0,!0).map(Ue):[]},m={id:"analysisConfig",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.jobTagsTitle",{defaultMessage:"Job tags"}),position:"right",items:l?Ge(l):[]},b={id:"node",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.nodeTitle",{defaultMessage:"Node"}),position:"right",items:[]};e.node&&b.items.push(["name",e.node.name]);const f={id:"calendars",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.calendarsTitle",{defaultMessage:"Calendars"}),position:"right",items:[]};if(e.calendars){f.items=e.calendars.map((e=>["",Object(g.jsx)(o.EuiLink,{href:t.prepend(`/app/ml/settings/calendars_list/edit_calendar/${e}?_g=()`)},e)]));const a=s.items.findIndex((e=>"calendars"===e[0]));a>=0&&s.items.splice(a,1)}const h={id:"alertRules",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.alertRulesTitle",{defaultMessage:"Alert rules"}),position:"right",items:(null!==(n=e.alerting_rules)&&void 0!==n?n:[]).map((e=>["",Object(g.jsx)(He,{initialAlert:e,onSave:a})]))};if(e.alerting_rules){const e=s.items.findIndex((e=>"alerting_rules"===e[0]));e>=0&&s.items.splice(e,1)}const j={id:"detectors",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.detectorsTitle",{defaultMessage:"Detectors"}),position:"left",items:[]};e.analysis_config&&e.analysis_config.detectors&&j.items.push(...e.analysis_config.detectors.map((e=>{const t=Object(te.b)(e);return[t,t!==e.detector_description?e.detector_description:""]})));const x={id:"influencers",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.influencersTitle",{defaultMessage:"Influencers"}),position:"left",items:e.analysis_config.influencers.map((e=>["",e]))},v={id:"analysisConfig",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.analysisConfigTitle",{defaultMessage:"Analysis config"}),position:"left",items:Ge(e.analysis_config)},y={id:"analysisLimits",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.analysisLimitsTitle",{defaultMessage:"Analysis limits"}),position:"left",items:Ge(e.analysis_limits)},O={id:"dataDescription",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.dataDescriptionTitle",{defaultMessage:"Data description"}),position:"right",items:Ge(e.data_description)},E={id:"datafeed",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.datafeedTitle",{defaultMessage:"Datafeed"}),position:"left",items:Ge(e.datafeed_config||{},!0,!0)};if(e.node&&E.items.push(["node",JSON.stringify(e.node)]),e.datafeed_config&&e.datafeed_config.timing_stats){const e=E.items.findIndex((e=>"timing_stats"===e[0]));e>=0&&E.items.splice(e,1)}return{general:s,customUrl:u,node:b,calendars:f,detectors:j,influencers:x,analysisConfig:v,analysisLimits:y,dataDescription:O,customSettings:p,jobTags:m,datafeed:E,counts:{id:"counts",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.countsTitle",{defaultMessage:"Counts"}),position:"left",items:Ge(e.data_counts).map(Ue)},modelSizeStats:{id:"modelSizeStats",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.modelSizeStatsTitle",{defaultMessage:"Model size stats"}),position:"right",items:Ge(e.model_size_stats).map(Ue)},jobTimingStats:{id:"jobTimingStats",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.jobTimingStatsTitle",{defaultMessage:"Job timing stats"}),position:"left",items:Ge(e.timing_stats).map(Ue)},datafeedTimingStats:{id:"datafeedTimingStats",title:r.i18n.translate("xpack.ml.jobsList.jobDetails.datafeedTimingStatsTitle",{defaultMessage:"Timing stats"}),position:"right",items:e.datafeed_config&&e.datafeed_config.timing_stats?Ge(e.datafeed_config.timing_stats).filter((e=>"total_search_time_ms"!==e[0])).map(Ue):[]},alertRules:h}}(t,a,e);y.titleAction=Object(g.jsx)(o.EuiButtonEmpty,{onClick:()=>this.setState({datafeedChartFlyoutVisible:!0}),iconType:"visAreaStacked",size:"s"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobDetails.tabs.datafeed.viewCountsButtonText",defaultMessage:"View datafeed counts"}));const _=[{id:"job-settings","data-test-subj":"mlJobListTab-job-settings",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.jobSettingsLabel",{defaultMessage:"Job settings"}),content:Object(g.jsx)(job_details_pane_JobDetailsPane,{"data-test-subj":"mlJobDetails-job-settings",sections:[l,x,c,v,d,u,S]}),time:t.open_time},{id:"job-config","data-test-subj":"mlJobListTab-job-config",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.jobConfigLabel",{defaultMessage:"Job config"}),content:Object(g.jsx)(job_details_pane_JobDetailsPane,{"data-test-subj":"mlJobDetails-job-config",sections:[p,b,f,h,j]})},{id:"datafeed","data-test-subj":"mlJobListTab-datafeed",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.datafeedLabel",{defaultMessage:"Datafeed"}),content:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(job_details_pane_JobDetailsPane,{"data-test-subj":"mlJobDetails-datafeed",sections:[y,M]}),this.props.jobId&&this.state.datafeedChartFlyoutVisible?Object(g.jsx)(Oa,{onClose:()=>{this.setState({datafeedChartFlyoutVisible:!1})},onModelSnapshotAnnotationClick:e=>{this.setState({modelSnapshot:e,revertSnapshotFlyoutVisible:!0,datafeedChartFlyoutVisible:!1})},end:t.data_counts.latest_bucket_timestamp,jobId:this.props.jobId}):null,!0===this.state.revertSnapshotFlyoutVisible&&null!==this.state.modelSnapshot?Object(g.jsx)(oa,{snapshot:this.state.modelSnapshot,snapshots:[this.state.modelSnapshot],job:t,closeFlyout:()=>{this.setState({revertSnapshotFlyoutVisible:!1})},refresh:e}):null)},{id:"counts","data-test-subj":"mlJobListTab-counts",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.countsLabel",{defaultMessage:"Counts"}),content:Object(g.jsx)(job_details_pane_JobDetailsPane,{"data-test-subj":"mlJobDetails-counts",sections:[O,E,w]})},{id:"json","data-test-subj":"mlJobListTab-json",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.jsonLabel",{defaultMessage:"JSON"}),content:Object(g.jsx)(Xe,{job:t})},{id:"job-messages","data-test-subj":"mlJobListTab-job-messages",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.jobMessagesLabel",{defaultMessage:"Job messages"}),content:Object(g.jsx)(ua,{jobId:t.job_id,refreshJobList:e,showClearButton:i})}];return y.items.length&&_.push({id:"datafeed-preview","data-test-subj":"mlJobListTab-datafeed-preview",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.datafeedPreviewLabel",{defaultMessage:"Datafeed preview"}),content:Object(g.jsx)(datafeed_preview_tab_DatafeedPreviewPane,{job:t})},{id:"forecasts","data-test-subj":"mlJobListTab-forecasts",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.forecastsLabel",{defaultMessage:"Forecasts"}),content:Object(g.jsx)(qa,{job:t})}),_.push({id:"annotations","data-test-subj":"mlJobListTab-annotations",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.annotationsLabel",{defaultMessage:"Annotations"}),content:Object(g.jsx)(n.Fragment,null,Object(g.jsx)(_a,{jobs:[t],refreshJobList:e}),Object(g.jsx)(Ia,null))}),_.push({id:"modelSnapshots","data-test-subj":"mlJobListTab-modelSnapshots",name:r.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.modelSnapshotsLabel",{defaultMessage:"Model snapshots"}),content:Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Ra,{job:t,refreshJobList:e}))}),Object(g.jsx)("div",{className:"tab-contents","data-test-subj":`mlJobListRowDetails details-${t.job_id}`},Object(g.jsx)(o.EuiTabbedContent,{tabs:_,initialSelectedTab:_[0],onTabClick:()=>{}}))}}}const Ha=Object(c.withKibana)(job_details_JobDetailsUI),Ya=({queryText:e,setFilters:t})=>{const[a,i]=Object(n.useState)(null),{services:{mlServices:{mlApiServices:s}}}=Object(y.b)(),l=Object(n.useCallback)((async()=>{try{return(await s.jobs.groups()).map((e=>({value:e.id,view:Object(g.jsx)("div",{className:"group-item"},Object(g.jsx)(ke.a,{name:e.id})," ",Object(g.jsx)("span",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.jobFilterBar.jobGroupTitle",defaultMessage:"({jobsCount, plural, one {# job} other {# jobs}})",values:{jobsCount:e.jobIds.length}})))})))}catch(e){return[]}}),[]),c=Object(n.useMemo)((()=>o.EuiSearchBar.Query.parse(null!=e?e:"")),[e]);Object(n.useEffect)((()=>{void 0!==e&&t(c)}),[e]);const d=Object(n.useMemo)((()=>[{type:"field_value_toggle_group",field:"job_state",items:[{value:"opened",name:r.i18n.translate("xpack.ml.jobsList.jobFilterBar.openedLabel",{defaultMessage:"Opened"})},{value:"closed",name:r.i18n.translate("xpack.ml.jobsList.jobFilterBar.closedLabel",{defaultMessage:"Closed"})},{value:"failed",name:r.i18n.translate("xpack.ml.jobsList.jobFilterBar.failedLabel",{defaultMessage:"Failed"})}]},{type:"field_value_toggle_group",field:"datafeed_state",items:[{value:"started",name:r.i18n.translate("xpack.ml.jobsList.jobFilterBar.startedLabel",{defaultMessage:"Started"})},{value:"stopped",name:r.i18n.translate("xpack.ml.jobsList.jobFilterBar.stoppedLabel",{defaultMessage:"Stopped"})}]},{type:"field_value_selection",field:"groups",name:r.i18n.translate("xpack.ml.jobsList.jobFilterBar.groupLabel",{defaultMessage:"Group"}),multiSelect:"or",cache:1e4,options:()=>l()}]),[]),u=Object(n.useMemo)((()=>null===a?"":r.i18n.translate("xpack.ml.jobsList.jobFilterBar.invalidSearchErrorMessage",{defaultMessage:"Invalid search: {errorMessage}",values:{errorMessage:a.message}})),[a]);return Object(g.jsx)(o.EuiFlexGroup,{direction:"column"},Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"mlJobListSearchBar",grow:!1},Object(g.jsx)(o.EuiSearchBar,{box:{incremental:!0},query:c,filters:d,onChange:({query:e,error:a})=>{a?i(a):(t(e),i(null))},className:"mlJobFilterBar"}),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,isInvalid:null!==a,error:u,style:{maxHeight:0}},Object(g.jsx)(n.Fragment,null))))};var Xa=a(153);class tabs_job_details_JobDetails extends n.Component{constructor(e){super(e),Y()(this,"onDescriptionChange",(e=>{this.setJobDetails({jobDescription:e.target.value})})),Y()(this,"onMmlChange",(e=>{this.setJobDetails({jobModelMemoryLimit:e.target.value})})),Y()(this,"onModelSnapshotRetentionDaysChange",(e=>{const t=Math.floor(+e.target.value);this.setJobDetails({jobModelSnapshotRetentionDays:t,...this.state.dailyModelSnapshotRetentionAfterDays>t?{jobDailyModelSnapshotRetentionAfterDays:t}:{}})})),Y()(this,"onDailyModelSnapshotRetentionAfterDaysChange",(e=>{const t=Math.floor(+e.target.value);t<=this.state.modelSnapshotRetentionDays&&this.setJobDetails({jobDailyModelSnapshotRetentionAfterDays:t})})),Y()(this,"onGroupsChange",(e=>{this.setJobDetails({jobGroups:e.map((e=>e.label))})})),Y()(this,"onCreateGroup",((e,t)=>{const a=e.trim().toLowerCase();if(!a)return;const i={label:e},n=this.state.groups;-1===t.findIndex((e=>e.label.trim().toLowerCase()===a))&&n.push(i);const s=this.state.selectedGroups.concat(i);this.setState({groups:n},(()=>this.onGroupsChange(s)))})),this.state={description:"",groups:[],selectedGroups:[],mml:"",mmlValidationError:"",groupsValidationError:"",modelSnapshotRetentionDays:1,dailyModelSnapshotRetentionAfterDays:1},this.setJobDetails=e.setJobDetails}componentDidMount(){X.ml.jobs.groups().then((e=>{const t=e.map((e=>({label:e.id,color:Object(Xa.a)(e.id)})));this.setState({groups:t})})).catch((e=>{console.error("Could not load groups",e)}))}static getDerivedStateFromProps(e){const t=void 0!==e.jobGroups?e.jobGroups.map((e=>({label:e,color:Object(Xa.a)(e)}))):[],{datafeedRunning:a,jobClosed:i}=e;let n=null;return i||(n=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelMemoryLimitJobOpenLabelHelp",defaultMessage:"Model memory limit cannot be edited while the job is open."})),a&&(n=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelMemoryLimitLabelHelp",defaultMessage:"Model memory limit cannot be edited while the datafeed is running."})),{description:e.jobDescription,selectedGroups:t,mml:e.jobModelMemoryLimit,mmlHelpText:n,mmlValidationError:e.jobModelMemoryLimitValidationError,groupsValidationError:e.jobGroupsValidationError,modelSnapshotRetentionDays:e.jobModelSnapshotRetentionDays,dailyModelSnapshotRetentionAfterDays:e.jobDailyModelSnapshotRetentionAfterDays}}render(){const{description:e,selectedGroups:t,mml:a,groups:i,mmlValidationError:n,groupsValidationError:l,modelSnapshotRetentionDays:c,dailyModelSnapshotRetentionAfterDays:d,mmlHelpText:u}=this.state,{datafeedRunning:p,jobClosed:b}=this.props;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiForm,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.jobDescriptionLabel",defaultMessage:"Job description"})},Object(g.jsx)(o.EuiFieldText,{value:e,onChange:this.onDescriptionChange})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.jobGroupsLabel",defaultMessage:"Job groups"}),isInvalid:""!==l,error:l},Object(g.jsx)(o.EuiComboBox,{placeholder:r.i18n.translate("xpack.ml.jobsList.editJobFlyout.jobDetails.jobGroupsPlaceholder",{defaultMessage:"Select or create groups"}),options:i,selectedOptions:t,onChange:this.onGroupsChange,onCreateOption:this.onCreateGroup,isClearable:!0,isInvalid:""!==l,error:l})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelMemoryLimitLabel",defaultMessage:"Model memory limit"}),helpText:u,isInvalid:""!==n,error:n},Object(g.jsx)(o.EuiFieldText,{value:a,onChange:this.onMmlChange,isInvalid:""!==n,error:n,disabled:p||!b})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelSnapshotRetentionDaysLabel",defaultMessage:"Model snapshot retention days"})},Object(g.jsx)(o.EuiFieldNumber,{min:0,value:c,onChange:this.onModelSnapshotRetentionDaysChange})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.dailyModelSnapshotRetentionAfterDaysLabel",defaultMessage:"Daily model snapshot retention after days"})},Object(g.jsx)(o.EuiFieldNumber,{min:0,max:c,value:d,onChange:this.onDailyModelSnapshotRetentionAfterDaysChange}))))}}class detectors_Detectors extends n.Component{constructor(e){super(e),Y()(this,"onDescriptionChange",((e,t)=>{const a=this.state.detectorDescriptions;a[t]=e.target.value,this.setDetectorDescriptions({jobDetectorDescriptions:a})})),this.detectors=K.a.getJobGroups().map((e=>({label:e.id}))),this.state={detectors:[],detectorDescriptions:[]},this.setDetectorDescriptions=e.setDetectorDescriptions}static getDerivedStateFromProps(e){return{detectors:e.jobDetectors,detectorDescriptions:e.jobDetectorDescriptions}}render(){const{detectors:e,detectorDescriptions:t}=this.state;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.detectors.title",defaultMessage:"Edit detector descriptions"}))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiForm,null,t.map(((t,a)=>Object(g.jsx)(o.EuiFormRow,{label:Object(te.b)(e[a]),key:a},Object(g.jsx)(o.EuiFieldText,{value:t,onChange:e=>this.onDescriptionChange(e,a)}))))))}}function Qa(e,t){const a=void 0!==e?Object(se.a)(e).asSeconds():"";return{queryDelay:"60s",frequency:Object(Qe.f)(a)+"s",scrollSize:t.datafeeds.scroll_size}}class datafeed_Datafeed extends n.Component{constructor(e){super(e),Y()(this,"onQueryChange",(e=>{this.setDatafeed({datafeedQuery:e})})),Y()(this,"onQueryDelayChange",(e=>{this.setDatafeed({datafeedQueryDelay:e.target.value})})),Y()(this,"onFrequencyChange",(e=>{this.setDatafeed({datafeedFrequency:e.target.value})})),Y()(this,"onScrollSizeChange",(e=>{this.setDatafeed({datafeedScrollSize:+e.target.value})})),this.state={query:"",queryDelay:"",frequency:"",scrollSize:"",defaults:{queryDelay:"",frequency:"",scrollSize:0},jobDefaults:Object(A.c)()},this.setDatafeed=e.setDatafeed}static getDerivedStateFromProps(e,t){return{query:e.datafeedQuery,queryDelay:e.datafeedQueryDelay,frequency:e.datafeedFrequency,scrollSize:e.datafeedScrollSize,defaults:Qa(e.jobBucketSpan,t.jobDefaults)}}render(){const{query:e,queryDelay:t,frequency:a,scrollSize:i,defaults:n}=this.state,{datafeedRunning:r}=this.props;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),r&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiCallOut,{color:"warning"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.readOnlyCalloutText",defaultMessage:"Datafeed settings cannot be edited while the datafeed is running. Please stop the job if you wish to edit these settings."})),Object(g.jsx)(o.EuiSpacer,{size:"l"})),Object(g.jsx)(o.EuiForm,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.queryLabel",defaultMessage:"Query"}),style:{maxWidth:"inherit"}},Object(g.jsx)(Ye.a,{mode:Ye.b.XJSON,value:e,onChange:this.onQueryChange,height:"200px",readOnly:r})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.queryDelayLabel",defaultMessage:"Query delay"})},Object(g.jsx)(o.EuiFieldText,{value:t,placeholder:n.queryDelay,onChange:this.onQueryDelayChange,disabled:r})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.frequencyLabel",defaultMessage:"Frequency"})},Object(g.jsx)(o.EuiFieldText,{value:a,placeholder:n.frequency,onChange:this.onFrequencyChange,disabled:r})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.scrollSizeLabel",defaultMessage:"Scroll size"})},Object(g.jsx)(o.EuiFieldNumber,{value:i,placeholder:n.scrollSize,onChange:this.onScrollSizeChange,disabled:r}))))}}var Ka=a(59),Za=a.n(Ka);function ei(e,t,a,i){const n=e.url_value,s=a[i],o="time_range"in e&&e.time_range?Object(se.a)(e.time_range):null,r={...a};if(n.includes("$earliest$")){const e=Oe()(s);null!==o?e.subtract(o):e.subtract(t,"s"),r.earliest=e.toISOString()}if(n.includes("$latest$")){const e=Oe()(s).add(t,"s");null!==o?e.add(o):e.add(t,"s"),r.latest=e.toISOString()}return ti(e,r)}function ti(e,t){return!0===ii(e)?function(e,t){const a=e.url_value,i=a.includes("language:lucene"),n=i?te.c:ni,s=Object(Q.flow)(encodeURIComponent),o=e=>{const a=Object(Q.flow)(i?e=>e:n,s);return e.replace(/\$([^?&$\'"]+)\$(\/)?/g,((e,i,n="")=>{let s=Object(Q.get)(t,i);return s=Array.isArray(s)?s[0]:s,void 0===s?"":a(s)+n}))};return Object(Q.flow)(decodeURIComponent,(e=>e.replace("$earliest$",t.earliest).replace("$latest$",t.latest)),(e=>{const a=Object(Q.flow)(n,s),i=((e,t)=>(a,i,n,s)=>{let o=2e3-a.length-n.length;const r=i.split(/\sand\s/i).map((e=>(e=>{let t="";for(let a=0;a<e.length;a++)if("$"===e[a]){let i=a;for(let t=i;t>-1;t--)if(":"===e[t]){i=t;break}t=e.slice(0,i).trim();let n=e.slice(i,e.length);const s=n.indexOf("$"),o=n.lastIndexOf("$");if(n=n.slice(s,o+1),n===`$${t}$`)break}return t})(String(e).replace(/\\/g,"")))),l=[];e:for(let a=0;a<r.length;a++){const i=r[a],n=s?`"${r[a]}"`:Object(te.c)(i);let c=Object(Q.get)(e,i)||null;if(null===c)continue;c=Array.isArray(c)?c:[c];let d="";for(let e=0;e<c.length;e++){const a=`${e>0?" OR ":""}${n}:"${t(c[e])}"`;if(o<a.length){d.length>0&&l.push(e>0?`(${d})`:d);break e}d+=a,o-=d.length}d.length>0&&l.push(c.length>1?`(${d})`:d)}return l.join(" AND ")})(t,a),r=e.match(/(.+)(\(.*\blanguage:(?:lucene|kuery)\b.*?\))(.+)/);if(null!==r&&void 0!==r[2]){const[,e,t,a]=r,n=t.indexOf("language:kuery")>-1,s=Za.a.decode(t);if(null!==(l=s)&&"object"==typeof l&&s.hasOwnProperty("query")){const[t,r]=[e,a].map(o),l=i(t,s.query,r,n);return`${t}${Za.a.encode({...s,query:l})}${r}`}}var l;return e.replace(/(.+&kuery=)(.*?)[^!](&.+)/,((t,a,n,s)=>{const[r,l]=[a,s].map(o);return`${r}${i(r,n,l,e.indexOf("language:kuery")>-1)}${l}`}))}),o)(a)}(e,t):Object(te.f)(e.url_value,t,!1)}function ai(e,t,a){if(!1===/^(?:[a-z]+:)?\/\//i.test(t.url_value))"/"!==e.charAt(0)&&(e=`${a}${ii(t)?"/app/":"/"}${e}`),window.open(e,"_blank");else{const t=window.open(e,"_blank","noopener,noreferrer");null!=t&&(t.opener=null)}}function ii(e){const t=e.url_value;return t.startsWith("discover#/")||t.startsWith("dashboards#/")||t.startsWith("apm#/")||t.startsWith("metrics/")||t.startsWith("security/")||t.startsWith("siem#/")}function ni(e){return String(e).replace(/\"/g,'\\"')}function si(e,t){let a=void 0!==e&&e.trim().length>0;return!0===a&&void 0!==t&&(a=!t.map((e=>e.url_name)).includes(e)),a}const oi="KIBANA_DASHBOARD",ri="KIBANA_DISCOVER",li="OTHER",ci={AUTO:"auto",INTERVAL:"interval"};var di=a(381),ui=a.n(di),pi=a(3),mi=a(64),bi=a(51);function fi(e,t,a){const i={queryFieldNames:[]};let n=li;void 0!==t&&t.length>0?(n=oi,i.dashboardId=t[0].id):void 0!==a&&a.length>0&&(n=ri);const s=e.datafeed_config;if(void 0!==a&&a.length>0&&void 0!==s&&void 0!==s.indices&&s.indices.length>0){var o;const t=s.indices.join(),n=null===(o=a.find((e=>e.title===t)))||void 0===o?void 0:o.id;i.discoverIndexPatternId=n,i.filters=null===n?[]:Object(Qe.h)(e.datafeed_config.query,n,e.job_id)}return{label:"",type:n,timeRange:{type:ci.AUTO,interval:""},kibanaSettings:i,otherUrlSettings:{urlValue:""}}}function hi(e){const t=e.analysis_config.influencers,a=e.analysis_config.detectors,i=[];return void 0!==t&&i.push(...t),a.forEach(((t,a)=>{Object(Qe.j)(e,a).forEach((e=>{-1===i.indexOf(e)&&i.push(e)}))})),i}function gi(e){return e.type!==ci.INTERVAL||null!==Object(se.a)(e.interval)}function ji(e){if(e.type===oi)return async function(e){var t;const{dashboardId:a,queryFieldNames:i}=e.kibanaSettings,n=Object(ee.j)(),s=await n.get("dashboard",a);let o,r=e.kibanaSettings.filters;const l=s.get("kibanaSavedObjectMeta.searchSourceJSON");if(void 0!==l){const e=JSON.parse(l);Array.isArray(e.filter)&&e.filter.length>0&&(r=e.filter),o=e.query}const c=xi(i);void 0!==c&&(o=c);const d=Object(ee.c)(),u=await d.locator.getLocation({dashboardId:a,timeRange:{from:"$earliest$",to:"$latest$",mode:"absolute"},filters:r,query:o,useHash:!1}),p=u.state,m=Object(pi.setStateToKbnUrl)("_a",Object(mi.cleanEmptyKeys)({query:p.query,filters:null===(t=p.filters)||void 0===t?void 0:t.filter((e=>!Object(bi.isFilterPinned)(e))),savedQuery:p.savedQuery}),{useHash:!1,storeInHashQuery:!0},u.path),b={url_name:e.label,url_value:decodeURIComponent(`dashboards${ui.a.parse(m).hash}`),time_range:ci.AUTO};return e.timeRange.type===ci.INTERVAL&&(b.time_range=e.timeRange.interval),b}(e);if(e.type===ri)return Promise.resolve(function(e){const{discoverIndexPatternId:t,queryFieldNames:a,filters:i}=e.kibanaSettings,n=Za.a.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}}),s={index:t,filters:i},o=xi(a);void 0!==o&&(s.query=o);const r=`discover#/?_g=${n}&_a=${Za.a.encode(s)}`,l={url_name:e.label,url_value:r,time_range:ci.AUTO};return e.timeRange.type===ci.INTERVAL&&(l.time_range=e.timeRange.interval),l}(e));{const t={url_name:e.label,url_value:e.otherUrlSettings.urlValue};return Promise.resolve(t)}}function xi(e){let t;if(void 0!==e&&e.length>0){let a="";e.forEach(((e,t)=>{t>0&&(a+=" and "),a+=`${Object(te.c)(e)}:"$${e}$"`})),t={language:"kuery",query:a}}return t}async function vi(e,t){const a=Object(se.a)(e.analysis_config.bucket_span).asSeconds();let i=t.url_value;const n={query:{bool:{must:[{term:{job_id:e.job_id}},{term:{result_type:"record"}}]}},size:1,_source:{excludes:[]},sort:[{record_score:{order:"desc"}}]};let s;try{s=await X.ml.results.anomalySearch({body:n},[e.job_id])}catch(e){}if(s&&s.hits.total.value>0)return i=ei(t,a,s.hits.hits[0]._source,"timestamp"),i;{let{datafeed_config:n,...s}=e;try{const[{jobs:t},{datafeeds:a}]=await Promise.all([X.ml.getJobs({jobId:e.job_id}),X.ml.getDatafeeds({datafeedId:e.datafeed_config.datafeed_id})]);n=a[0],s=t[0]}catch(e){}if(void 0===s||void 0===n)return i;const o=await X.ml.jobs.datafeedPreview(void 0,s,n),r=e.data_description.time_field,l=o[0];return void 0!==l&&(i=ei(t,a,l,r)),i}}const yi=({job:e,customUrls:t,setCustomUrls:a})=>{const{services:{http:i,notifications:s}}=Object(y.b)(),[l,c]=Object(n.useState)(null),d=t.map(((n,d)=>{const u=n.url_name,p=[...t];p.splice(d,1);const b=!si(u,p),f=b?[r.i18n.translate("xpack.ml.customUrlEditorList.labelIsNotUniqueErrorMessage",{defaultMessage:"A unique label must be supplied"})]:[],h=!(void 0===(x=n.time_range)||0===x.length||x===ci.AUTO||null!==Object(se.a)(x)),j=h?[r.i18n.translate("xpack.ml.customUrlEditorList.invalidTimeRangeFormatErrorMessage",{defaultMessage:"Invalid format"})]:[];var x;return Object(g.jsx)(o.EuiFlexGroup,{key:`url_${d}`,"data-test-subj":`mlJobEditCustomUrlItem_${d}`},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlEditorList.labelLabel",defaultMessage:"Label"}),isInvalid:b,error:f,"data-test-subj":"mlJobEditCustomUrlItemLabel"},Object(g.jsx)(o.EuiFieldText,{value:u,isInvalid:b,onChange:e=>((e,i)=>{i<t.length&&(t[i]={...t[i],url_name:e.target.value},a(t))})(e,d),"data-test-subj":`mlJobEditCustomUrlLabelInput_${d}`}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlEditorList.urlLabel",defaultMessage:"URL"})},d===l?Object(g.jsx)(o.EuiTextArea,{inputRef:e=>{e&&e.focus()},fullWidth:!0,value:n.url_value,onChange:e=>((e,i)=>{i<t.length&&(t[i]={...t[i],url_value:e.target.value},a(t))})(e,d),onBlur:()=>{c(null)},"data-test-subj":`mlJobEditCustomUrlTextarea_${d}`}):Object(g.jsx)(o.EuiFieldText,{fullWidth:!0,value:n.url_value,readOnly:!0,onFocus:()=>c(d),"data-test-subj":`mlJobEditCustomUrlInput_${d}`}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlEditorList.timeRangeLabel",defaultMessage:"Time range"}),error:j,isInvalid:h},Object(g.jsx)(o.EuiFieldText,{value:n.time_range||"",isInvalid:h,placeholder:ci.AUTO,onChange:e=>((e,i)=>{if(i<t.length){t[i]={...t[i]};const n=e.target.value;void 0!==n&&n.length>0?t[i].time_range=n:delete t[i].time_range,a(t)}})(e,d)}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{hasEmptyLabelSpace:!0},Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlEditorList.testCustomUrlTooltip",defaultMessage:"Test custom URL"})},Object(g.jsx)(o.EuiButtonIcon,{size:"s",color:"primary",onClick:()=>(a=>{a<t.length&&vi(e,t[a]).then((e=>{ai(e,t[a],i.basePath.get())})).catch((e=>{console.error("Error obtaining URL for test:",e);const{toasts:t}=s;t.addDanger(r.i18n.translate("xpack.ml.customUrlEditorList.obtainingUrlToTestConfigurationErrorMessage",{defaultMessage:"An error occurred obtaining the URL to test the configuration"}))}))})(d),iconType:"popout","aria-label":r.i18n.translate("xpack.ml.customUrlEditorList.testCustomUrlAriaLabel",{defaultMessage:"Test custom URL"}),"data-test-subj":"mlJobEditTestCustomUrlButton"})))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{hasEmptyLabelSpace:!0},Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlEditorList.deleteCustomUrlTooltip",defaultMessage:"Delete custom URL"})},Object(g.jsx)(o.EuiButtonIcon,{size:"s",color:"danger",onClick:()=>(e=>{e<t.length&&(t.splice(e,1),a(t))})(d),iconType:"trash","aria-label":r.i18n.translate("xpack.ml.customUrlEditorList.deleteCustomUrlAriaLabel",{defaultMessage:"Delete custom URL"}),"data-test-subj":`mlJobEditDeleteCustomUrlButton_${d}`})))))}));return Object(g.jsx)("div",{"data-test-subj":"mlJobEditCustomUrlsList"},d)},Oi=({customUrl:e,setEditCustomUrl:t,savedCustomUrls:a,dashboards:i,dataViewListItems:n,queryEntityFieldNames:l})=>{if(void 0===e)return null;const{label:c,type:d,timeRange:u,kibanaSettings:p,otherUrlSettings:b}=e,f=i.map((e=>({value:e.id,text:e.title}))),h=n.map((({id:e,title:t})=>({value:e,text:t}))),j=l.map((e=>({label:e})));let x=[];void 0!==p&&void 0!==p.queryFieldNames&&(x=p.queryFieldNames.map((e=>({label:e}))));const v=Object.values(ci).map((e=>({value:e,text:e}))),y=!si(c,a),O=y?[r.i18n.translate("xpack.ml.customUrlsEditor.invalidLabelErrorMessage",{defaultMessage:"A unique label must be supplied"})]:[],E=!gi(u),w=E?[r.i18n.translate("xpack.ml.customUrlsList.invalidIntervalFormatErrorMessage",{defaultMessage:"Invalid interval format"})]:[];return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlsEditor.createNewCustomUrlTitle",defaultMessage:"Create new custom URL"}))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiForm,{className:"ml-edit-url-form","data-test-subj":"mlJobCustomUrlForm"},Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlsEditor.labelLabel",defaultMessage:"Label"}),className:"url-label",error:O,isInvalid:y,display:"rowCompressed"},Object(g.jsx)(o.EuiFieldText,{name:"label",value:c,onChange:a=>{t({...e,label:a.target.value})},isInvalid:y,compressed:!0,"data-test-subj":"mlJobCustomUrlLabelInput"})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlsEditor.linkToLabel",defaultMessage:"Link to"}),display:"rowCompressed"},Object(g.jsx)(o.EuiRadioGroup,{options:[{id:oi,label:r.i18n.translate("xpack.ml.customUrlEditor.kibanaDashboardLabel",{defaultMessage:"Kibana dashboard"})},{id:ri,label:r.i18n.translate("xpack.ml.customUrlEditor.discoverLabel",{defaultMessage:"Discover"})},{id:li,label:r.i18n.translate("xpack.ml.customUrlEditor.otherLabel",{defaultMessage:"Other"})}],idSelected:d,onChange:a=>{t({...e,type:a})},className:"url-link-to-radio","data-test-subj":"mlJobCustomUrlLinkToTypeInput"})),d===oi&&Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlsEditor.dashboardNameLabel",defaultMessage:"Dashboard name"}),display:"rowCompressed"},Object(g.jsx)(o.EuiSelect,{options:f,value:null==p?void 0:p.dashboardId,onChange:a=>{const i=e.kibanaSettings;t({...e,kibanaSettings:{...i,dashboardId:a.target.value}})},"data-test-subj":"mlJobCustomUrlDashboardNameInput",compressed:!0})),d===ri&&Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlsEditor.dataViewLabel",defaultMessage:"Data view"}),display:"rowCompressed"},Object(g.jsx)(o.EuiSelect,{options:h,value:null==p?void 0:p.discoverIndexPatternId,onChange:a=>{const i=e.kibanaSettings;t({...e,kibanaSettings:{...i,discoverIndexPatternId:a.target.value}})},"data-test-subj":"mlJobCustomUrlDiscoverIndexPatternInput",compressed:!0})),(d===oi||d===ri)&&j.length>0&&Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlsEditor.queryEntitiesLabel",defaultMessage:"Query entities"})},Object(g.jsx)(o.EuiComboBox,{placeholder:r.i18n.translate("xpack.ml.customUrlsEditor.selectEntitiesPlaceholder",{defaultMessage:"Select entities"}),options:j,selectedOptions:x,onChange:a=>{const i=a.map((e=>e.label)),n=e.kibanaSettings;t({...e,kibanaSettings:{...n,queryFieldNames:i}})},isClearable:!0,"data-test-subj":"mlJobCustomUrlQueryEntitiesInput"})),(d===oi||d===ri)&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlsEditor.timeRangeLabel",defaultMessage:"Time range"}),className:"url-time-range",display:"rowCompressed"},Object(g.jsx)(o.EuiSelect,{options:v,value:u.type,onChange:a=>{const i=e.timeRange;t({...e,timeRange:{...i,type:a.target.value}})},"data-test-subj":"mlJobCustomUrlTimeRangeInput",compressed:!0}))),u.type===ci.INTERVAL&&Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlsEditor.intervalLabel",defaultMessage:"Interval"}),className:"url-time-range",error:w,isInvalid:E,display:"rowCompressed"},Object(g.jsx)(o.EuiFieldText,{value:u.interval,onChange:a=>{const i=e.timeRange;t({...e,timeRange:{...i,interval:a.target.value}})},isInvalid:E,"data-test-subj":"mlJobCustomUrlTimeRangeIntervalInput",compressed:!0}))))),d===li&&Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.customUrlsEditor.urlLabel",defaultMessage:"URL"}),display:"rowCompressed",fullWidth:!0},Object(g.jsx)(o.EuiTextArea,{fullWidth:!0,rows:2,value:null==b?void 0:b.urlValue,onChange:a=>{t({...e,otherUrlSettings:{urlValue:a.target.value}})},"data-test-subj":"mlJobCustomUrlOtherTypeUrlInput",compressed:!0}))))};function Ei(e,t){const a=t.description;return t.description!==e.description?{description:a}:{}}function wi(e,t){const a=t.groups;return void 0!==t.groups?0===Object(Q.difference)(e.groups,a).length+Object(Q.difference)(a,e.groups).length?{}:{groups:a}:{}}function Mi(e,t){const a=Object(A.d)(),i={};if(void 0!==e.analysis_limits.model_memory_limit){let{mml:n}=t;""===n&&(n=a.max_model_memory_limit),n!==e.analysis_limits.model_memory_limit&&(i.analysis_limits={model_memory_limit:n})}return i}function Si(e,t){const a=t.modelSnapshotRetentionDays;return a!==e.model_snapshot_retention_days?{model_snapshot_retention_days:a}:{}}function _i(e,t){const a=t.dailyModelSnapshotRetentionAfterDays;return a!==e.daily_model_snapshot_retention_after_days?{daily_model_snapshot_retention_after_days:a}:{}}function Ti(e,t){const a=[],i=t.detectorDescriptions.map(((e,t)=>({detector_index:t,description:e})));return e.analysis_config.detectors.forEach((e=>{i[e.detector_index].description!==e.detector_description&&a.push(i[e.detector_index])})),a.length?{detectors:a}:{}}function Ci(e,t){const a={};return t&&t.customUrls&&(a.custom_settings=e.custom_settings||{},a.custom_settings.custom_urls=t.customUrls),a}function ki(e,t){const a={};if(void 0!==e.datafeed_config){const i=JSON.stringify(e.datafeed_config.query),n=JSON.parse(t.datafeedQuery);i!==JSON.stringify(n)&&(a.query=n),e.datafeed_config.query_delay!==t.datafeedQueryDelay&&(a.query_delay=t.datafeedQueryDelay),e.datafeed_config.frequency!==t.datafeedFrequency&&""!==t.datafeedFrequency&&(a.frequency=t.datafeedFrequency),e.datafeed_config.scroll_size!==t.datafeedScrollSize&&(a.scroll_size=t.datafeedScrollSize)}return a}class custom_urls_CustomUrlsUI extends n.Component{constructor(e){super(e),Y()(this,"editNewCustomUrl",(()=>{this.setState((e=>{const{dashboards:t,dataViewListItems:a}=e;return{editorOpen:!0,editorSettings:fi(this.props.job,t,a)}}))})),Y()(this,"setEditCustomUrl",(e=>{this.setState({editorSettings:e})})),Y()(this,"addNewCustomUrl",(()=>{ji(this.state.editorSettings).then((e=>{const t=[...this.state.customUrls,e];this.props.setCustomUrls(t),this.setState({editorOpen:!1})})).catch((e=>{console.error("Error building custom URL from settings:",e);const{toasts:t}=this.props.kibana.services.notifications;t.addDanger(r.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.addNewUrlErrorNotificationMessage",{defaultMessage:"An error occurred building the new custom URL from the supplied settings"}))}))})),Y()(this,"onTestButtonClick",(()=>{const{http:{basePath:e},notifications:{toasts:t}}=this.props.kibana.services,a=this.props.job;ji(this.state.editorSettings).then((i=>{vi(a,i).then((t=>{ai(t,i,e.get())})).catch((e=>{console.error("Error obtaining URL for test:",e),t.addWarning(r.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.getTestUrlErrorNotificationMessage",{defaultMessage:"An error occurred obtaining the URL to test the configuration"}))}))})).catch((e=>{console.error("Error building custom URL from settings:",e),t.addWarning(r.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.buildUrlErrorNotificationMessage",{defaultMessage:"An error occurred building the custom URL for testing from the supplied settings"}))}))})),Y()(this,"closeEditor",(()=>{this.setState({editorOpen:!1})})),this.state={customUrls:[],dashboards:[],dataViewListItems:[],queryEntityFieldNames:[],editorOpen:!1}}static getDerivedStateFromProps(e){return{job:e.job,customUrls:e.jobCustomUrls,queryEntityFieldNames:hi(e.job)}}componentDidMount(){const{toasts:e}=this.props.kibana.services.notifications;(1e3,new Promise(((e,t)=>{Object(ee.j)().find({type:"dashboard",fields:["title"],perPage:1e3}).then((t=>{const a=t.savedObjects;if(void 0!==a){const t=a.map((e=>({id:e.id,title:e.attributes.title})));t.sort(((e,t)=>e.title.localeCompare(t.title))),e(t)}})).catch((e=>{t(e)}))}))).then((e=>{this.setState({dashboards:e})})).catch((t=>{console.error("Error loading list of dashboards:",t),e.addDanger(r.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.loadSavedDashboardsErrorNotificationMessage",{defaultMessage:"An error occurred loading the list of saved Kibana dashboards"}))})),async function(){const e=Object(ee.d)();return(await e.getIdsWithTitle()).sort(((e,t)=>e.title.localeCompare(t.title)))}().then((e=>{this.setState({dataViewListItems:e})})).catch((t=>{console.error("Error loading list of dashboards:",t),e.addDanger(r.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.loadDataViewsErrorNotificationMessage",{defaultMessage:"An error occurred loading the list of saved data views"}))}))}renderEditor(){var e;const{customUrls:t,editorOpen:a,editorSettings:i,dashboards:n,dataViewListItems:s,queryEntityFieldNames:l}=this.state,c=null!==(e=this.props.editMode)&&void 0!==e?e:"inline",d=Object(g.jsx)(Oi,{customUrl:i,setEditCustomUrl:this.setEditCustomUrl,savedCustomUrls:t,dashboards:n,dataViewListItems:s,queryEntityFieldNames:l}),u=!a||void 0===i||function(e,t){let a=si(e.label,t);return!0===a&&(a=gi(e.timeRange)),a}(i,t),p=Object(g.jsx)(o.EuiButton,{onClick:this.addNewCustomUrl,isDisabled:!u,"data-test-subj":"mlJobAddCustomUrl"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addButtonLabel",defaultMessage:"Add"})),b=Object(g.jsx)(o.EuiButtonEmpty,{iconType:"popout",iconSide:"right",onClick:this.onTestButtonClick,isDisabled:!u},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.testButtonLabel",defaultMessage:"Test"}));return"inline"===c?Object(g.jsx)(o.EuiPanel,{className:"edit-custom-url-panel"},Object(g.jsx)(o.EuiButtonIcon,{color:"text",onClick:this.closeEditor,iconType:"cross","aria-label":r.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.closeEditorAriaLabel",{defaultMessage:"Close custom URL editor"}),className:"close-editor-button"}),d,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},p),Object(g.jsx)(o.EuiFlexItem,{grow:!1},b))):Object(g.jsx)(o.EuiModal,{onClose:this.closeEditor,initialFocus:"[name=label]",style:{width:500},"data-test-subj":"mlJobNewCustomUrlFormModal"},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addCustomUrlButtonLabel",defaultMessage:"Add custom URL"}))),Object(g.jsx)(o.EuiModalBody,null,d),Object(g.jsx)(o.EuiModalFooter,null,b,p))}render(){const{customUrls:e,editorOpen:t}=this.state,{editMode:a="inline"}=this.props;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),(!t||"modal"===a)&&Object(g.jsx)(o.EuiButton,{size:"s",onClick:this.editNewCustomUrl,"data-test-subj":"mlJobOpenCustomUrlFormButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addCustomUrlButtonLabel",defaultMessage:"Add custom URL"})),t&&this.renderEditor(),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(yi,{job:this.props.job,customUrls:e,setCustomUrls:this.props.setCustomUrls}))}}const Fi=Object(c.withKibana)(custom_urls_CustomUrlsUI);var Ii=a(146);function Di(e){const t={groups:e},a=Object(Qe.v)(t),{valid:i}=a,n={valid:i,message:""};return Object(Ii.b)(a,{groupIds:n}),n}var Ai=a(60),Li=a(155);const{collapseLiteralStrings:Ri}=Ai.XJson;class edit_job_flyout_EditJobFlyoutUI extends n.Component{constructor(e){super(e),Y()(this,"_initialJobFormState",null),Y()(this,"closeFlyout",((e=!1)=>{!this.containsUnsavedChanges()||e?(this.setState({isConfirmationModalVisible:!1}),this.setState({isFlyoutVisible:!1})):this.setState({isConfirmationModalVisible:!0})})),Y()(this,"showFlyout",(e=>{const t=e.hasDatafeed;ce(e.id).then((e=>{this.extractJob(e,t),this.setState({job:e,isFlyoutVisible:!0})})).catch((e=>{console.error(e)}))})),Y()(this,"setJobDetails",(e=>{let{jobModelMemoryLimitValidationError:t,jobGroupsValidationError:a}=this.state;void 0!==e.jobModelMemoryLimit&&(t=function(e){const t=Object(A.d)(),a={analysis_limits:{model_memory_limit:e}};let i=Object(Qe.x)(e),{valid:n}=i;n&&(i=Object(Qe.w)(a,t),n=i.valid);const s={valid:n,message:""};return Object(Ii.b)(i,{modelMemoryLimit:s}),s}(e.jobModelMemoryLimit).message),void 0!==e.jobGroups&&(a=Di(e.jobGroups).message,""===a&&X.ml.jobs.jobsExist(e.jobGroups,!0).then((e=>{!1==(!1===Object.values(e).some((e=>!0===e.exists&&!1===e.isGroup)))&&this.setState({jobGroupsValidationError:r.i18n.translate("xpack.ml.jobsList.editJobFlyout.groupsAndJobsHasSameIdErrorMessage",{defaultMessage:"A job with this ID already exists. Groups and jobs cannot use the same ID."}),isValidJobDetails:!1})})));const i=""===t&&""===a;this.setState({...e,jobModelMemoryLimitValidationError:t,jobGroupsValidationError:a,isValidJobDetails:i})})),Y()(this,"setDetectorDescriptions",(e=>{this.setState({...e})})),Y()(this,"setDatafeed",(e=>{this.setState({...e})})),Y()(this,"setCustomUrls",(e=>{const t=void 0===(a=e)||0===a.length||!a.some(((e,t)=>{const i=e.url_name,n=[...a];n.splice(t,1);let s=si(i,n);var o;return!0===s&&(s=void 0===(o=e.time_range)||0===o.length||"auto"===o||null!==Object(se.a)(o)),!s}));var a;this.setState({jobCustomUrls:e,isValidJobCustomUrls:t})})),Y()(this,"save",(()=>{const e={description:this.state.jobDescription,groups:this.state.jobGroups,mml:this.state.jobModelMemoryLimit,modelSnapshotRetentionDays:this.state.jobModelSnapshotRetentionDays,dailyModelSnapshotRetentionAfterDays:this.state.jobDailyModelSnapshotRetentionAfterDays,detectorDescriptions:this.state.jobDetectorDescriptions,datafeedQuery:Ri(this.state.datafeedQuery),datafeedQueryDelay:this.state.datafeedQueryDelay,datafeedFrequency:this.state.datafeedFrequency,datafeedScrollSize:this.state.datafeedScrollSize,customUrls:this.state.jobCustomUrls},{toasts:t}=this.props.kibana.services.notifications,a=Object(Z.b)(t);(function(e,t,a){return new Promise(((a,i)=>{const n={...Ei(e,t),...wi(e,t),...Mi(e,t),...Si(e,t),..._i(e,t),...Ti(e,t),...Ci(e,t)},s={...ki(e,t)};void 0!==n.custom_settings&&(n.custom_settings=function(e,t){let a={};return void 0!==e.custom_settings&&(a={...e.custom_settings},void 0===e.custom_settings.created_by||void 0===e.detectors&&!Object.keys(t).length||Object(Qe.s)(a)),a}(n,s));const o=()=>{(function(e,t){return new Promise(((a,i)=>{if(Object.keys(e).length){const n=t.datafeed_config.datafeed_id;X.ml.updateDatafeed({datafeedId:n,datafeedConfig:e}).then((()=>{a()})).catch((e=>{i(e)}))}else a()}))})(s,e).then((()=>{a()})).catch((e=>{i(e)}))};Object.keys(n).length?X.ml.updateJob({jobId:e.job_id,job:n}).then((()=>{o()})).catch((e=>{i(e)})):o()}))})(this.state.job,e).then((()=>{t.addSuccess(r.i18n.translate("xpack.ml.jobsList.editJobFlyout.changesSavedNotificationMessage",{defaultMessage:"Changes to {jobId} saved",values:{jobId:this.state.job.job_id}})),this.refreshJobs(),this.closeFlyout(!0)})).catch((e=>{console.error(e),a.displayErrorToast(e,r.i18n.translate("xpack.ml.jobsList.editJobFlyout.changesNotSavedNotificationMessage",{defaultMessage:"Could not save changes to {jobId}",values:{jobId:this.state.job.job_id}}))}))})),this.state={job:{},hasDatafeed:!1,datafeedRunning:!1,isFlyoutVisible:!1,isConfirmationModalVisible:!1,jobDescription:"",jobGroups:[],jobModelMemoryLimit:"",jobModelSnapshotRetentionDays:10,jobDailyModelSnapshotRetentionAfterDays:10,jobDetectors:[],jobDetectorDescriptions:[],jobCustomUrls:[],datafeedQuery:"",datafeedQueryDelay:"",datafeedFrequency:"",datafeedScrollSize:"",jobModelMemoryLimitValidationError:"",jobGroupsValidationError:"",isValidJobDetails:!0,isValidJobCustomUrls:!0},this.refreshJobs=this.props.refreshJobs}componentDidMount(){"function"==typeof this.props.setShowFunction&&this.props.setShowFunction(this.showFlyout)}componentWillUnmount(){"function"==typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}containsUnsavedChanges(){return!Object(Q.isEqual)(this._initialJobFormState,Object(Q.pick)(this.state,["jobDescription","jobGroups","jobModelMemoryLimit","jobModelSnapshotRetentionDays","jobDailyModelSnapshotRetentionAfterDays","jobCustomUrls","jobDetectors","jobDetectorDescriptions","jobBucketSpan","datafeedQuery","datafeedQueryDelay","datafeedFrequency","datafeedScrollSize"]))}extractInitialJobFormState(e,t){const a=e.analysis_limits&&e.analysis_limits.model_memory_limit?e.analysis_limits.model_memory_limit:"",i=void 0!==e.model_snapshot_retention_days?e.model_snapshot_retention_days:10,n=void 0!==e.daily_model_snapshot_retention_after_days?e.daily_model_snapshot_retention_after_days:i,s=e.analysis_config&&e.analysis_config.detectors?[...e.analysis_config.detectors]:[],o=e.analysis_config?e.analysis_config.bucket_span:"",r={...e.datafeed_config},l=void 0!==r.frequency?r.frequency:"",c=e.custom_settings&&e.custom_settings.custom_urls?[...e.custom_settings.custom_urls]:[];this._initialJobFormState=Object.freeze({jobDescription:e.description,jobGroups:void 0!==e.groups?e.groups:[],jobModelMemoryLimit:a,jobModelSnapshotRetentionDays:i,jobDailyModelSnapshotRetentionAfterDays:n,jobDetectors:s,jobDetectorDescriptions:s.map((e=>e.detector_description)),jobBucketSpan:o,jobCustomUrls:c,datafeedQuery:t?JSON.stringify(r.query,null,2):"",datafeedQueryDelay:t?r.query_delay:"",datafeedFrequency:t?l:"",datafeedScrollSize:t?+r.scroll_size:null})}extractJob(e,t){this.extractInitialJobFormState(e,t);const a=t&&e.datafeed_config.state!==ae.a.STOPPED,i=e.state===ae.c.CLOSED;this.setState({job:e,hasDatafeed:t,datafeedRunning:a,jobClosed:i,jobModelMemoryLimitValidationError:"",jobGroupsValidationError:"",...Object(Q.cloneDeep)(this._initialJobFormState)})}render(){let e,t;if(this.state.isFlyoutVisible){const{job:t,jobDescription:a,jobGroups:i,jobModelMemoryLimit:n,jobModelSnapshotRetentionDays:l,jobDailyModelSnapshotRetentionAfterDays:c,jobDetectors:d,jobDetectorDescriptions:u,jobBucketSpan:p,jobCustomUrls:b,datafeedQuery:f,datafeedQueryDelay:h,datafeedFrequency:j,datafeedScrollSize:x,jobGroupsValidationError:v,jobModelMemoryLimitValidationError:y,isValidJobDetails:O,isValidJobCustomUrls:E,datafeedRunning:w,jobClosed:M}=this.state,S=[{id:"job-details","data-test-subj":"mlEditJobFlyout-jobDetails",name:r.i18n.translate("xpack.ml.jobsList.editJobFlyout.jobDetailsTitle",{defaultMessage:"Job details"}),content:Object(g.jsx)(tabs_job_details_JobDetails,{jobClosed:M,datafeedRunning:w,jobDescription:a,jobGroups:i,jobModelMemoryLimit:n,jobModelSnapshotRetentionDays:l,jobDailyModelSnapshotRetentionAfterDays:c,setJobDetails:this.setJobDetails,jobGroupsValidationError:v,jobModelMemoryLimitValidationError:y})},{id:"detectors","data-test-subj":"mlEditJobFlyout-detectors",name:r.i18n.translate("xpack.ml.jobsList.editJobFlyout.detectorsTitle",{defaultMessage:"Detectors"}),content:Object(g.jsx)(detectors_Detectors,{jobDetectors:d,jobDetectorDescriptions:u,setDetectorDescriptions:this.setDetectorDescriptions})},{id:"datafeed","data-test-subj":"mlEditJobFlyout-datafeed",name:r.i18n.translate("xpack.ml.jobsList.editJobFlyout.datafeedTitle",{defaultMessage:"Datafeed"}),content:Object(g.jsx)(datafeed_Datafeed,{datafeedQuery:f,datafeedQueryDelay:h,datafeedFrequency:j,datafeedScrollSize:x,jobBucketSpan:p,setDatafeed:this.setDatafeed,datafeedRunning:w})},{id:"custom-urls","data-test-subj":"mlEditJobFlyout-customUrls",name:r.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrlsTitle",{defaultMessage:"Custom URLs"}),content:Object(g.jsx)(Fi,{job:t,jobCustomUrls:b,setCustomUrls:this.setCustomUrls})}];e=Object(g.jsx)(o.EuiFlyout,{onClose:()=>{this.closeFlyout()},size:"m","data-test-subj":"mlJobEditFlyout"},Object(g.jsx)(o.EuiFlyoutHeader,null,Object(g.jsx)(o.EuiTitle,null,Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.pageTitle",defaultMessage:"Edit {jobId}",values:{jobId:t.job_id}}))),Ee(t)?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(Li.a,{jobsCount:1,action:r.i18n.translate("xpack.ml.jobsList.editJobModal.editManagedJobDescription",{defaultMessage:"editing"})})):null),Object(g.jsx)(o.EuiFlyoutBody,null,Object(g.jsx)(o.EuiTabbedContent,{tabs:S,initialSelectedTab:S[0],onTabClick:()=>{}})),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:()=>{this.closeFlyout()},flush:"left","data-test-subj":"mlEditJobFlyoutCloseButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.closeButtonLabel",defaultMessage:"Close"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:this.save,fill:!0,isDisabled:!1===O||!1===E,"data-test-subj":"mlEditJobFlyoutSaveButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.saveButtonLabel",defaultMessage:"Save"}))))))}return this.state.isConfirmationModalVisible&&(t=Object(g.jsx)(o.EuiConfirmModal,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.unsavedChangesDialogTitle",defaultMessage:"Save changes before leaving?"}),onCancel:()=>this.closeFlyout(!0),onConfirm:()=>this.save(),cancelButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.leaveAnywayButtonLabel",defaultMessage:"Leave anyway"}),confirmButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.saveChangesButtonLabel",defaultMessage:"Save changes"}),defaultFocusedButton:"confirm"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.unsavedChangesDialogMessage",defaultMessage:"If you don't save, your changes will be lost."})))),Object(g.jsx)("div",null,e,t)}}const Ni=Object(c.withKibana)(edit_job_flyout_EditJobFlyoutUI);var Pi=a(215);const zi=({setShowFunction:e,unsetShowFunction:t,refreshJobs:a})=>{const[i,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(!1),[u,p]=Object(n.useState)([]),[b,f]=Object(n.useState)(!1),[h,j]=Object(n.useState)(!1);Object(n.useEffect)((()=>("function"==typeof e&&e(x),()=>{"function"==typeof t&&t()})),[]);const x=Object(n.useCallback)((e=>{p(e.map((({id:e})=>e))),j(e.some((e=>Ee(e)))),d(!0),l(!1)}),[]),v=Object(n.useCallback)((()=>{d(!1),f(!1)}),[]),y=Object(n.useCallback)((()=>{l(!0),function(e,t=(()=>{})){const a=e.map((e=>e.id));K.a.deleteJobs(a).then((e=>{he(e,ae.c.DELETED),t()})).catch((e=>{Object(Z.a)().displayErrorToast(e,r.i18n.translate("xpack.ml.jobsList.deleteJobErrorMessage",{defaultMessage:"Jobs failed to delete"})),t()}))}(u.map((e=>({id:e})))),setTimeout((()=>{v(),a()}),2e3)}),[u,a]);return!1===c||0===u.length?null:b?Object(g.jsx)(o.EuiModal,{"data-test-subj":"mlDeleteJobConfirmModal",onClose:v},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteJobsTitle",defaultMessage:"Delete {jobsCount, plural, one {{jobId}} other {# jobs}}?",values:{jobsCount:u.length,jobId:u[0]}}))),Object(g.jsx)(o.EuiModalBody,null,Object(g.jsx)("p",null,!0===i?Object(g.jsx)("div",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deletingJobsStatusLabel",defaultMessage:"Deleting jobs"}),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)("div",{style:{textAlign:"center"}},Object(g.jsx)(o.EuiLoadingSpinner,{size:"l"}))):Object(g.jsx)(s.a.Fragment,null,h?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Li.a,{jobsCount:u.length,action:r.i18n.translate("xpack.ml.jobsList.deleteJobModal.deleteAction",{defaultMessage:"deleting"})}),Object(g.jsx)(o.EuiSpacer,null)):null,Object(g.jsx)(o.EuiText,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteMultipleJobsDescription",defaultMessage:"Deleting {jobsCount, plural, one {a job} other {multiple jobs}} can be time consuming. {jobsCount, plural, one {It} other {They}} will be deleted in the background and may not disappear from the jobs list instantly.",values:{jobsCount:u.length}}))))),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:v,disabled:i},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(g.jsx)(o.EuiButton,{onClick:y,fill:!0,disabled:i,color:"danger","data-test-subj":"mlDeleteJobConfirmModalButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteButtonLabel",defaultMessage:"Delete"}))))):Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Pi.a,{ids:u,mlSavedObjectType:"anomaly-detector",canDeleteCallback:()=>{f(!0)},onCloseCallback:v,refreshJobsCallback:a,hasManagedJob:h}))},Bi=({jobs:e})=>{const t=Object(n.useMemo)((()=>e.filter((e=>e.jobState!==ae.c.CLOSED)).length),[e]);return 0===t?null:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.openJobsWarningCallout.title",defaultMessage:"{openJobsCount, plural, one {# job is} other {# jobs are}} not closed",values:{openJobsCount:t}}),color:"warning"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.openJobsWarningCallout.description1",defaultMessage:"{openJobsCount, plural, one {This job} other {These jobs}} must be closed before {openJobsCount, plural, one {it} other {they}} can be reset. ",values:{openJobsCount:t}}),Object(g.jsx)("br",null),Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.openJobsWarningCallout.description2",defaultMessage:"{openJobsCount, plural, one {This job} other {These jobs}} will not be reset when clicking the Reset button below.",values:{openJobsCount:t}})),Object(g.jsx)(o.EuiSpacer,{size:"m"}))},Vi=({setShowFunction:e,unsetShowFunction:t,refreshJobs:a})=>{const[i,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(!1),[u,p]=Object(n.useState)([]),[b,f]=Object(n.useState)([]),[h,j]=Object(n.useState)(!1);Object(n.useEffect)((()=>("function"==typeof e&&e(x),()=>{"function"==typeof t&&t()})),[]);const x=Object(n.useCallback)((e=>{p(e.map((({id:e})=>e))),f(e),j(e.some((e=>Ee(e)))),d(!0),l(!1)}),[]),v=Object(n.useCallback)((()=>{d(!1)}),[]),y=Object(n.useCallback)((async()=>{l(!0),await function(e,t=(()=>{})){K.a.resetJobs(e).then((e=>{he(e,ie),t()})).catch((e=>{Object(Z.a)().displayErrorToast(e,r.i18n.translate("xpack.ml.jobsList.resetJobErrorMessage",{defaultMessage:"Jobs failed to reset"})),t()}))}(u),v(),setTimeout((()=>{a()}),1e3)}),[u,a]);return!1===c||0===u.length?null:Object(g.jsx)(o.EuiModal,{"data-test-subj":"mlResetJobConfirmModal",onClose:v},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.resetJobsTitle",defaultMessage:"Reset {jobsCount, plural, one {{jobId}} other {# jobs}}?",values:{jobsCount:u.length,jobId:u[0]}}))),Object(g.jsx)(o.EuiModalBody,null,Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Bi,{jobs:b}),!0===h?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Li.a,{jobsCount:u.length,action:r.i18n.translate("xpack.ml.jobsList.startDatafeedsModal.resetManagedDatafeedsDescription",{defaultMessage:"resetting"})}),Object(g.jsx)(o.EuiSpacer,null)):null,Object(g.jsx)(o.EuiText,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.resetMultipleJobsDescription",defaultMessage:"Resetting {jobsCount, plural, one {a job} other {multiple jobs}} can be time consuming. {jobsCount, plural, one {It} other {They}} will be reset in the background and may not be updated in the jobs list instantly.",values:{jobsCount:u.length}})))),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:v,disabled:i},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(g.jsx)(o.EuiButton,{onClick:y,fill:!0,disabled:i,color:"danger","data-test-subj":"mlResetJobConfirmModalButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.resetButtonLabel",defaultMessage:"Reset"})))))};a(387);class time_range_selector_TimeRangeSelector extends n.Component{constructor(e){super(e),Y()(this,"setStartTab",(e=>{switch(this.setState({startTab:e}),e){case 0:this.setStartTime(void 0);break;case 1:this.setStartTime(this.now)}})),Y()(this,"setEndTab",(e=>{switch(this.setState({endTab:e}),e){case 0:this.setEndTime(void 0);break;case 1:this.setEndTime(this.now)}})),Y()(this,"setStartTime",(e=>{this.props.setStartTime(e)})),Y()(this,"setEndTime",(e=>{this.props.setEndTime(e)})),this.state={startTab:0,endTab:1},this.latestTimestamp=this.props.startTime,this.now=this.props.now}getTabItems(){const e={start:Oe.a.isMoment(this.props.startTime)?this.props.startTime:this.latestTimestamp,end:Oe.a.isMoment(this.props.endTime)?this.props.endTime:this.now},t=this.latestTimestamp.format(Re.a),a=!0==this.latestTimestamp.valueOf()>0?[Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.continueFromStartTimeLabel",defaultMessage:"Continue from {formattedLatestStartTime}",values:{formattedLatestStartTime:t}}),Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.continueFromNowLabel",defaultMessage:"Continue from now"}),Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.continueFromSpecifiedTimeLabel",defaultMessage:"Continue from specified time"})]:[Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startAtBeginningOfDataLabel",defaultMessage:"Start at beginning of data"}),Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startFromNowLabel",defaultMessage:"Start from now"}),Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.specifyStartTimeLabel",defaultMessage:"Specify start time"})];return{startItems:[{index:0,label:a[0]},{index:1,label:a[1]},{index:2,label:a[2],body:Object(g.jsx)(Ui,{date:e.start,onChange:this.setStartTime,maxDate:e.end,setIsValid:this.props.setTimeRangeValid,tab:this.state.startTab})}],endItems:[{index:0,label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.noEndTimeLabel",defaultMessage:"No end time (Real-time search)"})},{index:1,label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.specifyEndTimeLabel",defaultMessage:"Specify end time"}),body:Object(g.jsx)(Ui,{date:e.end,onChange:this.setEndTime,minDate:e.start,setIsValid:this.props.setTimeRangeValid,tab:this.state.endTab})}]}}render(){const{startItems:e,endItems:t}=this.getTabItems();return Object(g.jsx)("div",{className:"time-range-selector"},!0===this.props.hasManagedJob&&0!==this.state.endTab?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Li.a,{jobsCount:this.props.jobsCount,message:r.i18n.translate("xpack.ml.jobsList.startDatafeedsModal.startManagedDatafeedsDescription",{defaultMessage:"{jobsCount, plural, one {This job} other {At least one of these jobs}} is preconfigured by Elastic; starting {jobsCount, plural, one {it} other {them}} with a specific end time might impact other parts of the product.",values:{jobsCount:this.props.jobsCount}})}),Object(g.jsx)(o.EuiSpacer,null)):null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Ji,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.searchStartTimeTitle",defaultMessage:"Search start time"}),items:e,switchState:this.state.startTab,switchFunc:this.setStartTab})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Ji,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.searchEndTimeTitle",defaultMessage:"Search end time"}),items:t,switchState:this.state.endTab,switchFunc:this.setEndTab}))))}}function Ji({title:e,items:t,switchState:a,switchFunc:i}){return Object(g.jsx)("div",{className:"time-range-section"},Object(g.jsx)("div",{className:"time-range-section-title"},e),Object(g.jsx)("ul",{className:"tab-stack"},t.map(((e,t)=>{let n="";return a===e.index&&(n+="active "),void 0!==e.body&&(n+="has-body "),Object(g.jsx)("li",{key:t,className:n},Object(g.jsx)("a",{onClick:()=>i(e.index),onKeyUp:()=>{}},e.label),void 0!==e.body&&Object(g.jsx)("div",{className:"body"},e.body))}))))}const Ui=({date:e,onChange:t,minDate:a,setIsValid:i,tab:l})=>{const[c,d]=Object(n.useState)(e.format(Re.a)),[u,p]=Object(n.useState)(l);return Object(n.useEffect)((()=>{u!==l&&(d(e.format(Re.a)),p(l))}),[l]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFieldText,{value:c,onChange:function(e){const a=e.target.value;d(a);const n=Oe()(a);n.isValid()?(i(!0),t(n)):i(!1)},placeholder:Re.a,"aria-label":r.i18n.translate('xpack.ml.jobsList.startDatafeedModal.enterDateText"',{defaultMessage:"Enter date"})}),Object(g.jsx)(o.EuiDatePicker,{selected:e,onChange:function(e){d(e.format(Re.a)),i(!0),t(e)},minDate:a,inline:!0,showTimeSelect:!0}))};class start_datafeed_modal_StartDatafeedModal extends n.Component{constructor(e){super(e),Y()(this,"setStartTime",(e=>{this.setState({startTime:e})})),Y()(this,"setEndTime",(e=>{this.setState({endTime:e})})),Y()(this,"setCreateAlert",(e=>{this.setState({createAlert:e.target.checked})})),Y()(this,"closeModal",(()=>{this.setState({isModalVisible:!1})})),Y()(this,"setTimeRangeValid",(e=>{this.setState({timeRangeValid:e})})),Y()(this,"showModal",((e,t)=>{const a=Oe()(),i=a,n=function(e){const t=e.map((e=>e.earliestStartTimestampMs||0));return Oe()(Math.min(...t))}(e),s=e.length>0;this.setState({jobs:e,isModalVisible:!0,startTime:void 0,endTime:i,initialSpecifiedStartTime:n,showCreateAlertFlyout:t,allowCreateAlert:s,createAlert:!1,now:a,hasManagedJob:e.some((e=>Ee(e)))})})),Y()(this,"save",(()=>{const{jobs:e}=this.state,t=Oe.a.isMoment(this.state.startTime)?this.state.startTime.valueOf():this.state.startTime,a=Oe.a.isMoment(this.state.endTime)?this.state.endTime.valueOf():this.state.endTime;!function(e,t,a,i=(()=>{})){const n=e.filter((e=>e.hasDatafeed)).map((e=>e.datafeedId));K.a.forceStartDatafeeds(n,t,a).then((e=>{he(e,ae.a.STARTED),i()})).catch((e=>{Object(ee.n)().addDanger(r.i18n.translate("xpack.ml.jobsList.startJobErrorMessage",{defaultMessage:"Jobs failed to start"}),e),i()}))}(e,t,a,(()=>{this.state.createAlert&&e.length>0&&this.getShowCreateAlertFlyoutFunction()(e.map((e=>e.id))),this.refreshJobs()})),this.closeModal()}));const t=Oe()();this.state={jobs:this.props.jobs,isModalVisible:!1,startTime:t,endTime:t,createAlert:!1,allowCreateAlert:!1,initialSpecifiedStartTime:t,now:t,timeRangeValid:!0,hasManagedJob:!1},this.initialSpecifiedStartTime=t,this.refreshJobs=this.props.refreshJobs,this.getShowCreateAlertFlyoutFunction=this.props.getShowCreateAlertFlyoutFunction}componentDidMount(){"function"==typeof this.props.setShowFunction&&this.props.setShowFunction(this.showModal)}componentWillUnmount(){"function"==typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}render(){const{jobs:e,initialSpecifiedStartTime:t,startTime:a,endTime:i,createAlert:n,now:s,timeRangeValid:r}=this.state,l=void 0!==e?e.filter((e=>e.hasDatafeed)):[],c=!1===r||void 0!==a&&a===i;let d;return this.state.isModalVisible&&(d=Object(g.jsx)(o.EuiModal,{onClose:this.closeModal,style:{minWidth:"850px"},maxWidth:!1,"data-test-subj":"mlStartDatafeedModal"},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startJobsTitle",defaultMessage:"Start {jobsCount, plural, one {{jobId}} other {# jobs}}",values:{jobsCount:l.length,jobId:l[0].id}}))),Object(g.jsx)(o.EuiModalBody,null,Object(g.jsx)(time_range_selector_TimeRangeSelector,{startTime:void 0===a?t:a,endTime:i,setStartTime:this.setStartTime,setEndTime:this.setEndTime,now:s,setTimeRangeValid:this.setTimeRangeValid,hasManagedJob:this.state.hasManagedJob,jobsCount:l.length}),void 0===this.state.endTime&&Object(g.jsx)("div",{className:"create-watch"},Object(g.jsx)(o.EuiHorizontalRule,null),Object(g.jsx)(o.EuiCheckbox,{id:"createAlert",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.createAlertDescription",defaultMessage:"Create alert rule after datafeed has started"}),checked:n,onChange:this.setCreateAlert}))),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:this.closeModal,"data-test-subj":"mlStartDatafeedModalCancelButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(g.jsx)(o.EuiButton,{onClick:this.save,isDisabled:c,fill:!0,"data-test-subj":"mlStartDatafeedModalStartButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startButtonLabel",defaultMessage:"Start"}))))),Object(g.jsx)("div",null,d)}}class actions_menu_MultiJobActionsMenuUI extends n.Component{constructor(e){super(e),Y()(this,"onButtonClick",(()=>{this.setState((e=>({isOpen:!e.isOpen})))})),Y()(this,"closePopover",(()=>{this.setState({isOpen:!1})})),this.state={isOpen:!1},this.canDeleteJob=Object(w.e)("canDeleteJob"),this.canStartStopDatafeed=Object(w.e)("canStartStopDatafeed")&&Object($.e)(),this.canCloseJob=Object(w.e)("canCloseJob")&&Object($.e)(),this.canResetJob=Object(w.e)("canResetJob")&&Object($.e)(),this.canCreateMlAlerts=Object(w.e)("canCreateMlAlerts")}render(){const e=this.props.jobs.some((e=>void 0!==e.blocked)),t=Object(g.jsx)(o.EuiButtonIcon,{size:"s",onClick:this.onButtonClick,iconType:"gear","aria-label":r.i18n.translate("xpack.ml.jobsList.multiJobActionsMenu.managementActionsAriaLabel",{defaultMessage:"Management actions"}),color:"text",disabled:e||!1===this.canDeleteJob&&!1===this.canStartStopDatafeed,"data-test-subj":"mlADJobListMultiSelectManagementActionsButton"}),a=[Object(g.jsx)(o.EuiContextMenuItem,{key:"delete",icon:"trash",disabled:!1===this.canDeleteJob,onClick:()=>{this.props.showDeleteJobModal(this.props.jobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectDeleteJobActionButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.deleteJobsLabel",defaultMessage:"Delete {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}}))];return me(this.props.jobs)&&a.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"close job",icon:"cross",disabled:!1===this.canCloseJob,onClick:()=>{this.props.jobs.some((e=>Ee(e)))?this.props.showCloseJobsConfirmModal(this.props.jobs):ge(this.props.jobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectCloseJobActionButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.closeJobsLabel",defaultMessage:"Close {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}}))),be(this.props.jobs)&&a.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"reset job",icon:"refresh",disabled:!1===this.canCloseJob,onClick:()=>{this.props.showResetJobModal(this.props.jobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectResetJobActionButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.resetJobsLabel",defaultMessage:"Reset {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}}))),pe(this.props.jobs)&&a.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"stop datafeed",icon:"stop",disabled:!1===this.canStartStopDatafeed,onClick:()=>{this.props.jobs.some((e=>Ee(e)))?this.props.showStopDatafeedsConfirmModal(this.props.jobs):fe(this.props.jobs,this.props.refreshJobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectStopDatafeedActionButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.stopDatafeedsLabel",defaultMessage:"Stop {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:this.props.jobs.length}}))),ue(this.props.jobs)&&a.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"start datafeed",icon:"play",disabled:!1===this.canStartStopDatafeed,onClick:()=>{this.props.showStartDatafeedModal(this.props.jobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectStartDatafeedActionButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.startDatafeedsLabel",defaultMessage:"Start {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:this.props.jobs.length}}))),this.canCreateMlAlerts&&1===this.props.jobs.length&&a.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"create alert",icon:"bell",disabled:!1,onClick:()=>{this.props.showCreateAlertFlyout(this.props.jobs.map((({id:e})=>e))),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectCreateAlertActionButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.createAlertsLabel",defaultMessage:"Create alert rule"}))),Object(g.jsx)(o.EuiPopover,{button:t,isOpen:this.state.isOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downCenter"},Object(g.jsx)(o.EuiContextMenuPanel,{items:a.reverse()}))}}const Gi=actions_menu_MultiJobActionsMenuUI;function qi({group:e,selectedGroups:t}){return void 0!==t[e.id]?t[e.id].partial?Object(g.jsx)("div",{className:"check selected"},Object(g.jsx)("span",null,"—")):Object(g.jsx)("div",{className:"check selected"},Object(g.jsx)(o.EuiIcon,{type:"check"})):Object(g.jsx)("div",{className:"check"})}class group_list_GroupList extends n.Component{constructor(e){super(e),Y()(this,"selectGroup",(e=>{this.props.selectGroup(e)})),Y()(this,"moveUp",((e,t)=>{e.preventDefault(),t<0||t>0&&this.selectItems[t-1].focus()})),Y()(this,"moveDown",((e,t)=>{e.preventDefault(),t<this.selectItems.length-1&&this.selectItems[t+1].focus()})),Y()(this,"handleKeyDown",((e,t,a)=>{switch(e.key){case o.keys.ENTER:case o.keys.SPACE:this.selectGroup(t);break;case o.keys.ARROW_DOWN:this.moveDown(e,a);break;case o.keys.ARROW_UP:this.moveUp(e,a)}})),Y()(this,"setRef",((e,t)=>{this.selectItems[t]=e})),this.state={groups:[]},this.selectItems=[]}render(){const{selectedGroups:e,groups:t}=this.props;return Object(g.jsx)("div",{className:"group-list"},t.map(((t,a)=>Object(g.jsx)("div",{tabIndex:"0",onKeyDown:e=>this.handleKeyDown(e,t,a),key:t.id,className:"group-item",onClick:()=>this.selectGroup(t),ref:e=>this.setRef(e,a)},Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(ke.a,{name:t.id})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(qi,{group:t,selectedGroups:e})))))))}}class new_group_input_NewGroupInput extends n.Component{constructor(e){super(e),Y()(this,"changeTempNewGroup",(e=>{const t=e.target.value;let a="";a=""===t?"":this.props.allJobIds.includes(t)?r.i18n.translate("xpack.ml.jobsList.multiJobActions.groupSelector.groupsAndJobsCanNotUseSameIdErrorMessage",{defaultMessage:"A job with this ID already exists. Groups and jobs cannot use the same ID."}):Di([t]).message,this.setState({tempNewGroupName:t,groupsValidationError:a})})),Y()(this,"newGroupKeyPress",(e=>{e.key===o.keys.ENTER&&""===this.state.groupsValidationError&&""!==this.state.tempNewGroupName&&this.addNewGroup()})),Y()(this,"addNewGroup",(()=>{this.props.addNewGroup(this.state.tempNewGroupName),this.setState({tempNewGroupName:""})})),this.state={tempNewGroupName:"",groupsValidationError:""}}render(){const{tempNewGroupName:e,groupsValidationError:t}=this.state;return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{display:"rowCompressed",isInvalid:""!==t,error:t,className:"new-group-input"},Object(g.jsx)(o.EuiFieldText,{compressed:!0,placeholder:r.i18n.translate("xpack.ml.jobsList.multiJobActions.groupSelector.addNewGroupPlaceholder",{defaultMessage:"Add new group"}),value:e,onChange:this.changeTempNewGroup,onKeyDown:this.newGroupKeyPress,isInvalid:""!==t,error:t}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{className:"new-group-input"},Object(g.jsx)(o.EuiButtonIcon,{onClick:this.addNewGroup,iconType:"plusInCircle","aria-label":r.i18n.translate("xpack.ml.jobsList.multiJobActions.groupSelector.addButtonAriaLabel",{defaultMessage:"Add"}),disabled:""===e||""!==t})))))}}function $i(e,t){const a=e.map((e=>e.id)),i={};return e.forEach((e=>{e.groups.forEach((e=>{void 0===i[e]&&(i[e]=0),i[e]++}))})),t.reduce(((e,t)=>(t.jobIds.some((e=>a.includes(e)))&&(e[t.id]={partial:i[t.id]!==a.length}),e)),{})}class group_selector_GroupSelector extends n.Component{constructor(e){super(e),Y()(this,"togglePopover",(()=>{this.state.isPopoverOpen?this.closePopover():X.ml.jobs.groups().then((e=>{const t=$i(this.props.jobs,e);this.setState({isPopoverOpen:!0,edited:!1,selectedGroups:t,groups:e})})).catch((e=>{console.error(e)}))})),Y()(this,"closePopover",(()=>{this.setState({edited:!1,isPopoverOpen:!1})})),Y()(this,"selectGroup",(e=>{const t=Object(Q.cloneDeep)(this.state.selectedGroups);void 0===t[e.id]?t[e.id]={partial:!1}:!0===t[e.id].partial?t[e.id].partial=!1:delete t[e.id],this.setState({selectedGroups:t,edited:!0})})),Y()(this,"applyChanges",(()=>{const{selectedGroups:e}=this.state,{jobs:t}=this.props,a=t.map((e=>({id:e.id,oldGroups:e.groups,newGroups:[]})));for(const t in e)if(e.hasOwnProperty(t)){const i=e[t];a.forEach((e=>{(!1===i.partial||!0===i.partial&&e.oldGroups.includes(t))&&e.newGroups.push(t)}))}const i=a.map((e=>({jobId:e.id,groups:e.newGroups})));X.ml.jobs.updateGroups(i).then((e=>{let t=!0;for(const a in e)e.hasOwnProperty(a)&&!1===e[a].success&&(Object(Z.a)().displayErrorToast(e[a].error),t=!1);t?(this.refreshJobs(),this.closePopover()):console.error(e)})).catch((e=>{Object(Z.a)().displayErrorToast(e),console.error(e)}))})),Y()(this,"addNewGroup",(e=>{const t={id:e,calendarIds:[],jobIds:[]},a=this.state.groups;!1===a.some((e=>e.id===t.id))&&a.push(t),this.setState({groups:a})})),this.state={isPopoverOpen:!1,groups:[],selectedGroups:{},edited:!1},this.refreshJobs=this.props.refreshJobs,this.canUpdateJob=Object(w.e)("canUpdateJob")}static getDerivedStateFromProps(e,t){return!1===t.edited?{selectedGroups:$i(e.jobs,t.groups)}:{}}render(){const{groups:e,selectedGroups:t,edited:a}=this.state,i=Object(g.jsx)(o.EuiToolTip,{position:"bottom",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobActions.groupSelector.editJobGroupsButtonTooltip",defaultMessage:"Edit job groups"})},Object(g.jsx)(o.EuiButtonIcon,{iconType:"indexEdit","aria-label":r.i18n.translate("xpack.ml.jobsList.multiJobActions.groupSelector.editJobGroupsButtonAriaLabel",{defaultMessage:"Edit job groups"}),onClick:()=>this.togglePopover(),disabled:!1===this.canUpdateJob,"data-test-subj":"mlADJobListMultiSelectEditJobGroupsButton"}));return Object(g.jsx)(o.EuiPopover,{id:"trapFocus",ownFocus:!0,button:i,isOpen:this.state.isPopoverOpen,closePopover:()=>this.closePopover()},Object(g.jsx)("div",{className:"group-selector"},Object(g.jsx)(o.EuiPopoverTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobActions.groupSelector.applyGroupsToJobTitle",defaultMessage:"Apply groups to {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}})),Object(g.jsx)(group_list_GroupList,{groups:e,selectedGroups:t,selectGroup:this.selectGroup}),Object(g.jsx)(o.EuiHorizontalRule,{margin:"xs"}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(new_group_input_NewGroupInput,{addNewGroup:this.addNewGroup,allJobIds:this.props.allJobIds}),Object(g.jsx)(o.EuiHorizontalRule,{margin:"m"}),Object(g.jsx)("div",null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{size:"s",onClick:this.applyChanges,isDisabled:!1===a},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobActions.groupSelector.applyButtonLabel",defaultMessage:"Apply"})))))))}}class multi_job_actions_MultiJobActions extends n.Component{constructor(e){super(e),this.state={}}render(){const e=this.props.selectedJobs.length>0;return Object(g.jsx)("div",{className:"multi-select-actions"+(e?"":"-no-display"),"data-test-subj":"mlADJobListMultiSelectActionsArea "+(e?"active":"inactive")},e&&Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center",wrap:!1,direction:"row",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.jobsSelectedLabel",defaultMessage:"{selectedJobsCount, plural, one {# job} other {# jobs}}   selected",values:{selectedJobsCount:this.props.selectedJobs.length}})))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("div",{className:"actions-border-large"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Ce,{jobs:this.props.selectedJobs})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(group_selector_GroupSelector,{jobs:this.props.selectedJobs,allJobIds:this.props.allJobIds,refreshJobs:this.props.refreshJobs})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Gi,{jobs:this.props.selectedJobs,showCloseJobsConfirmModal:this.props.showCloseJobsConfirmModal,showStartDatafeedModal:this.props.showStartDatafeedModal,showDeleteJobModal:this.props.showDeleteJobModal,showResetJobModal:this.props.showResetJobModal,showStopDatafeedsConfirmModal:this.props.showStopDatafeedsConfirmModal,refreshJobs:this.props.refreshJobs,showCreateAlertFlyout:this.props.showCreateAlertFlyout}))))}}function Wi(){const e=Object(w.e)("canCreateJob")&&Object($.e)(),t=Object(F.a)(E.b.ANOMALY_DETECTION_CREATE_JOB_SELECT_INDEX);return Object(g.jsx)(o.EuiButton,{"data-test-subj":"mlCreateNewJobButton",onClick:t,size:"s",disabled:!1===e,fill:!0,iconType:"plusInCircle"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.createNewJobButtonLabel",defaultMessage:"Create job"}))}var Hi=a(168);const Yi=({jobsSummaryList:e})=>{const t=function(e){const t={activeNodes:{label:r.i18n.translate("xpack.ml.jobsList.statsBar.activeMLNodesLabel",{defaultMessage:"Active ML nodes"}),value:0,show:!0},total:{label:r.i18n.translate("xpack.ml.jobsList.statsBar.totalJobsLabel",{defaultMessage:"Total jobs"}),value:0,show:!0},open:{label:r.i18n.translate("xpack.ml.jobsList.statsBar.openJobsLabel",{defaultMessage:"Open jobs"}),value:0,show:!0},closed:{label:r.i18n.translate("xpack.ml.jobsList.statsBar.closedJobsLabel",{defaultMessage:"Closed jobs"}),value:0,show:!0},failed:{label:r.i18n.translate("xpack.ml.jobsList.statsBar.failedJobsLabel",{defaultMessage:"Failed jobs"}),value:0,show:!1},activeDatafeeds:{label:r.i18n.translate("xpack.ml.jobsList.statsBar.activeDatafeedsLabel",{defaultMessage:"Active datafeeds"}),value:0,show:!0}};if(void 0===e)return t;const a={};let i=0;return e.forEach((e=>{e.jobState===ae.c.OPENED?t.open.value++:e.jobState===ae.c.CLOSED?t.closed.value++:e.jobState===ae.c.FAILED&&i++,e.hasDatafeed&&e.datafeedState===ae.a.STARTED&&t.activeDatafeeds.value++,void 0!==e.nodeName&&(a[e.nodeName]={})})),t.total.value=e.length,i?(t.failed.value=i,t.failed.show=!0):t.failed.show=!1,t.activeNodes.value=Object.keys(a).length,t}(e);return Object(g.jsx)(Hi.a,{stats:t,dataTestSub:"mlJobStatsBar"})};var Xi=a(183),Qi=a(167),Ki=a(159),Zi=a(186);const en=({setShowFunction:e,unsetShowFunction:t,refreshJobs:a})=>{const[i,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(!0),[u,p]=Object(n.useState)([]),b=Object(n.useMemo)((()=>u.map((({id:e})=>e))),[u]);Object(n.useEffect)((()=>("function"==typeof e&&e(f),()=>{"function"==typeof t&&t()})),[]);const f=Object(n.useCallback)((e=>{p(e),e.some((e=>Ee(e)))&&(l(!0),d(!0))}),[]),h=Object(n.useCallback)((()=>{l(!1),d(!1)}),[]);if(!1===i)return null;if(c){const e=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.stopDatafeedsModal.stopDatafeedsTitle",defaultMessage:"Stop datafeed for {jobsCount, plural, one {{jobId}} other {# jobs}}?",values:{jobsCount:b.length,jobId:b[0]}});return Object(g.jsx)(o.EuiModal,{"data-test-subj":"mlStopDatafeedsConfirmModal",onClose:h},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,e)),Object(g.jsx)(o.EuiModalBody,null,Object(g.jsx)(Li.a,{jobsCount:b.length,action:r.i18n.translate("xpack.ml.jobsList.stopDatafeedsModal.stopManagedDatafeedsDescription",{defaultMessage:"stopping"})})),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:h},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.stopDatafeedsConfirmModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(g.jsx)(o.EuiButton,{onClick:()=>{fe(u,a),h()},fill:!0,color:"danger","data-test-subj":"mlStopDatafeedsConfirmModalButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.stopDatafeedsConfirmModal.stopButtonLabel",defaultMessage:"Stop {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:b.length}})))))}return Object(g.jsx)(s.a.Fragment,null)},tn=({setShowFunction:e,unsetShowFunction:t,refreshJobs:a})=>{const[i,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(!0),[u,p]=Object(n.useState)([]),b=Object(n.useMemo)((()=>u.map((({id:e})=>e))),[u]);Object(n.useEffect)((()=>("function"==typeof e&&e(f),()=>{"function"==typeof t&&t()})),[]);const f=Object(n.useCallback)((e=>{p(e),e.some((e=>Ee(e)))&&(l(!0),d(!0))}),[]),h=Object(n.useCallback)((()=>{l(!1),d(!1)}),[]);if(!1===i)return null;if(c){const e=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedsModal.closeDatafeedsTitle",defaultMessage:"Close {jobsCount, plural, one {{jobId}} other {# jobs}}?",values:{jobsCount:b.length,jobId:b[0]}});return Object(g.jsx)(o.EuiModal,{"data-test-subj":"mlCloseJobsConfirmModal",onClose:h},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,e)),Object(g.jsx)(o.EuiModalBody,null,Object(g.jsx)(Li.a,{jobsCount:b.length,action:r.i18n.translate("xpack.ml.jobsList.closeJobsModal.closeManagedDatafeedsDescription",{defaultMessage:"closing"})})),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:h},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedsConfirmModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(g.jsx)(o.EuiButton,{onClick:()=>{ge(u,a),h()},fill:!0,color:"danger","data-test-subj":"mlCloseJobsConfirmModalButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedsConfirmModal.closeButtonLabel",defaultMessage:"Close {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:b.length}})))))}return Object(g.jsx)(s.a.Fragment,null)};var an=a(268);let nn=null;class jobs_list_view_JobsListView extends n.Component{constructor(e){super(e),Y()(this,"toggleRow",(e=>{if(this.state.itemIdToExpandedRowMap[e]){const t={...this.state.itemIdToExpandedRowMap};delete t[e],this.setState({itemIdToExpandedRowMap:t})}else{const t=this.state.jobsSummaryList.filter((t=>t.id===e)),a=t.length>0&&void 0!==t[0].auditMessage;let i={...this.state.itemIdToExpandedRowMap};void 0!==this.state.fullJobsList[e]?i[e]=Object(g.jsx)(Ha,{jobId:e,job:this.state.fullJobsList[e],addYourself:this.addUpdateFunction,removeYourself:this.removeUpdateFunction,refreshJobList:this.onRefreshClick,showClearButton:a}):i[e]=Object(g.jsx)(Ha,{jobId:e,addYourself:this.addUpdateFunction,removeYourself:this.removeUpdateFunction,refreshJobList:this.onRefreshClick,showClearButton:a}),this.setState({itemIdToExpandedRowMap:i},(()=>{ce(e).then((t=>{const n={...this.state.fullJobsList};n[e]=t,this.setState({fullJobsList:n},(()=>{i={...this.state.itemIdToExpandedRowMap},void 0!==i[e]&&(i[e]=Object(g.jsx)(Ha,{jobId:e,job:t,addYourself:this.addUpdateFunction,removeYourself:this.removeUpdateFunction,refreshJobList:this.onRefreshClick,showClearButton:a})),this.setState({itemIdToExpandedRowMap:i},(()=>{this.updateFunctions[e](t)}))}))})).catch((e=>{console.error(e)}))}))}})),Y()(this,"addUpdateFunction",((e,t)=>{this.updateFunctions[e]=t})),Y()(this,"removeUpdateFunction",(e=>{delete this.updateFunctions[e]})),Y()(this,"setShowEditJobFlyoutFunction",(e=>{this.showEditJobFlyout=e})),Y()(this,"unsetShowEditJobFlyoutFunction",(()=>{this.showEditJobFlyout=()=>{}})),Y()(this,"setShowDatafeedChartFlyoutFunction",(e=>{this.showDatafeedChartFlyout=e})),Y()(this,"unsetShowDatafeedChartFlyoutFunction",(()=>{this.showDatafeedChartFlyout=()=>{}})),Y()(this,"setShowStopDatafeedsConfirmModalFunction",(e=>{this.showStopDatafeedsConfirmModal=e})),Y()(this,"unsetShowStopDatafeedsConfirmModalFunction",(()=>{this.showStopDatafeedsConfirmModal=()=>{}})),Y()(this,"setShowCloseJobsConfirmModalFunction",(e=>{this.showCloseJobsConfirmModal=e})),Y()(this,"unsetShowCloseJobsConfirmModalFunction",(()=>{this.showCloseJobsConfirmModal=()=>{}})),Y()(this,"setShowDeleteJobModalFunction",(e=>{this.showDeleteJobModal=e})),Y()(this,"unsetShowDeleteJobModalFunction",(()=>{this.showDeleteJobModal=()=>{}})),Y()(this,"setShowResetJobModalFunction",(e=>{this.showResetJobModal=e})),Y()(this,"unsetShowResetJobModalFunction",(()=>{this.showResetJobModal=()=>{}})),Y()(this,"setShowStartDatafeedModalFunction",(e=>{this.showStartDatafeedModal=e})),Y()(this,"unsetShowStartDatafeedModalFunction",(()=>{this.showStartDatafeedModal=()=>{}})),Y()(this,"setShowCreateAlertFlyoutFunction",(e=>{this.showCreateAlertFlyout=e})),Y()(this,"unsetShowCreateAlertFlyoutFunction",(()=>{this.showCreateAlertFlyout=()=>{}})),Y()(this,"getShowCreateAlertFlyoutFunction",(()=>this.showCreateAlertFlyout)),Y()(this,"selectJobChange",(e=>{this.setState({selectedJobs:e})})),Y()(this,"setFilters",(async e=>{if(null===e)return void this.setState({filteredJobsSummaryList:this.state.jobsSummaryList,filterClauses:[]},(()=>{this.refreshSelectedJobs()}));this.props.onJobsViewStateUpdate({queryText:null==e?void 0:e.text},!1===this._isFiltersSet);const t=e&&e.ast&&e.ast.clauses||[];if(0===t.length)return void this.setState({filteredJobsSummaryList:this.state.jobsSummaryList,filterClauses:t},(()=>{this.refreshSelectedJobs()}));const a=je(this.state.jobsSummaryList,t);this.setState({filteredJobsSummaryList:a,filterClauses:t},(()=>{this.refreshSelectedJobs()})),this._isFiltersSet=!0})),Y()(this,"onRefreshClick",(()=>{this.setState({isRefreshing:!0}),this.refreshJobSummaryList()})),Y()(this,"isDoneRefreshing",(()=>{this.setState({isRefreshing:!1})})),this.state={isRefreshing:!1,loading:null,jobsSummaryList:[],filteredJobsSummaryList:[],fullJobsList:{},selectedJobs:[],itemIdToExpandedRowMap:{},filterClauses:[],blockingJobIds:[],jobsAwaitingNodeCount:0},this.updateFunctions={},this.showEditJobFlyout=()=>{},this.showDatafeedChartFlyout=()=>{},this.showStopDatafeedsConfirmModal=()=>{},this.showCloseJobsConfirmModal=()=>{},this.showDeleteJobModal=()=>{},this.showResetJobModal=()=>{},this.showStartDatafeedModal=()=>{},this.showCreateAlertFlyout=()=>{},this._isMounted=!1,this._isFiltersSet=!1}componentDidMount(){this._isMounted=!0,this.refreshJobSummaryList(),this.openAutoStartDatafeedModal()}componentDidUpdate(e){e.lastRefresh!==this.props.lastRefresh&&(this.setState({isRefreshing:!0}),this.refreshJobSummaryList())}componentWillUnmount(){nn=null,this._isMounted=!1}openAutoStartDatafeedModal(){const e=function(){const e=K.a.tempJobCloningObjects.job,t=K.a.tempJobCloningObjects.datafeed;if(void 0!==e){K.a.tempJobCloningObjects.job=void 0,K.a.tempJobCloningObjects.datafeed=void 0,K.a.tempJobCloningObjects.createdBy=void 0;const a=Object(re.isPopulatedObject)(t),i=a?t.datafeed_id:"";return{id:e.job_id,hasDatafeed:a,latestTimestampSortValue:0,datafeedId:i}}}();void 0!==e&&this.showStartDatafeedModal([e])}refreshSelectedJobs(){var e;const t=this.state.selectedJobs.map((e=>e.id)),a=(null!==(e=this.state.filteredJobsSummaryList)&&void 0!==e?e:[]).map((e=>e.id)),i=this.state.jobsSummaryList.filter((e=>t.find((t=>t===e.id)))).filter((e=>a.find((t=>t===e.id))));this.setState({selectedJobs:i})}async refreshJobSummaryList(){if(!1===this._isMounted)return;null===this.state.loading&&this.setState({loading:!0});const e=Object.keys(this.state.itemIdToExpandedRowMap);try{let t=0;const a=await X.ml.jobs.jobsSummary(e),i={},n=a.map((e=>(void 0!==e.fullJob&&(i[e.id]=e.fullJob,delete e.fullJob),e.latestTimestampSortValue=e.latestTimestampMs||0,!0===e.awaitingNodeAssignment&&t++,e))),s=je(n,this.state.filterClauses);this.setState({jobsSummaryList:n,filteredJobsSummaryList:s,fullJobsList:i,loading:!1,jobsAwaitingNodeCount:t},(()=>{this.refreshSelectedJobs()})),Object.keys(this.updateFunctions).forEach((e=>{this.updateFunctions[e](i[e])})),a.forEach((e=>{void 0!==e.blocked&&this.state.itemIdToExpandedRowMap[e.id]&&this.toggleRow(e.id)})),this.isDoneRefreshing(),n.some((e=>void 0!==e.blocked))&&this.checkBlockingJobTasks(!0)}catch(e){console.error(e),this.setState({loading:!1})}}async checkBlockingJobTasks(e=!1){if(!1===this._isMounted)return;const{jobs:t}=await X.ml.jobs.blockingJobTasks(),a=t.map((e=>Object.keys(e)[0])).sort(),i=a.join()!==this.state.blockingJobIds.join();this.setState({blockingJobIds:a}),(i||e)&&this.refreshJobSummaryList(),a.length>0&&null===nn&&(nn=setTimeout((()=>{nn=null,this.checkBlockingJobTasks()}),2e3))}renderJobsListComponents(){const{isRefreshing:e,loading:t,jobsSummaryList:a,jobsAwaitingNodeCount:i}=this.state,n=a.map((e=>e.id)),r=!t&&0===n.length;return Object(g.jsx)("div",{"data-test-subj":"ml-jobs-list"},Object(g.jsx)(Xi.a,null),Object(g.jsx)(Qi.a,{jobCount:i}),Object(g.jsx)(Ki.a,{onCloseFlyout:this.onRefreshClick,forceRefresh:t||e}),Object(g.jsx)(Zi.a,null),Object(g.jsx)(s.a.Fragment,null,r?Object(g.jsx)(an.a,null):null,n.length>0?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Yi,{jobsSummaryList:a})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Wi,null))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)("div",null,Object(g.jsx)("div",{className:"actions-bar"},Object(g.jsx)(multi_job_actions_MultiJobActions,{selectedJobs:this.state.selectedJobs,allJobIds:n,showCloseJobsConfirmModal:this.showCloseJobsConfirmModal,showStartDatafeedModal:this.showStartDatafeedModal,showDeleteJobModal:this.showDeleteJobModal,showResetJobModal:this.showResetJobModal,showCreateAlertFlyout:this.showCreateAlertFlyout,showStopDatafeedsConfirmModal:this.showStopDatafeedsConfirmModal,refreshJobs:()=>this.refreshJobSummaryList()}),Object(g.jsx)(Ya,{setFilters:this.setFilters,queryText:this.props.jobsViewState.queryText})),Object(g.jsx)(jobs_list_JobsList,{jobsSummaryList:this.state.filteredJobsSummaryList,fullJobsList:this.state.fullJobsList,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,toggleRow:this.toggleRow,selectJobChange:this.selectJobChange,showEditJobFlyout:this.showEditJobFlyout,showDatafeedChartFlyout:this.showDatafeedChartFlyout,showDeleteJobModal:this.showDeleteJobModal,showResetJobModal:this.showResetJobModal,showCloseJobsConfirmModal:this.showCloseJobsConfirmModal,showStartDatafeedModal:this.showStartDatafeedModal,showStopDatafeedsConfirmModal:this.showStopDatafeedsConfirmModal,refreshJobs:()=>this.refreshJobSummaryList(),jobsViewState:this.props.jobsViewState,onJobsViewStateUpdate:this.props.onJobsViewStateUpdate,selectedJobsCount:this.state.selectedJobs.length,showCreateAlertFlyout:this.showCreateAlertFlyout,loading:t}))):null,Object(g.jsx)(Ni,{setShowFunction:this.setShowEditJobFlyoutFunction,unsetShowFunction:this.unsetShowEditJobFlyoutFunction,refreshJobs:()=>this.refreshJobSummaryList(),allJobIds:n}),Object(g.jsx)(Ea,{setShowFunction:this.setShowDatafeedChartFlyoutFunction,unsetShowFunction:this.unsetShowDatafeedChartFlyoutFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(g.jsx)(en,{setShowFunction:this.setShowStopDatafeedsConfirmModalFunction,unsetShowFunction:this.unsetShowStopDatafeedsConfirmModalFunction,refreshJobs:()=>this.refreshJobSummaryList(),allJobIds:n}),Object(g.jsx)(tn,{setShowFunction:this.setShowCloseJobsConfirmModalFunction,unsetShowFunction:this.unsetShowCloseJobsConfirmModalFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(g.jsx)(zi,{setShowFunction:this.setShowDeleteJobModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(g.jsx)(Vi,{setShowFunction:this.setShowResetJobModalFunction,unsetShowFunction:this.unsetShowResetJobModalFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(g.jsx)(start_datafeed_modal_StartDatafeedModal,{setShowFunction:this.setShowStartDatafeedModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,getShowCreateAlertFlyoutFunction:this.getShowCreateAlertFlyoutFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(g.jsx)(We,{setShowFunction:this.setShowCreateAlertFlyoutFunction,unsetShowFunction:this.unsetShowCreateAlertFlyoutFunction,onSave:this.onRefreshClick})))}render(){return Object(g.jsx)("div",null,this.renderJobsListComponents())}}var sn=a(107),on=a(94),rn=a(273);const ln=({children:e})=>{const{services:t}=Object(y.b)(),{setHeaderActionMenu:a}=Object(n.useContext)(rn.b),i=Object(n.useMemo)((()=>Object(d.c)()),[]);return Object(n.useEffect)((()=>{if(a)return a((e=>Object(c.toMountPoint)(Object(g.jsx)(c.KibanaContextProvider,{services:t},Object(g.jsx)(d.b,{node:i})),{theme$:t.theme.theme$})(e))),()=>{i.unmount(),a(void 0)}}),[i,a,t.theme.theme$]),Object(g.jsx)(d.a,{node:i},e)},cn=()=>{const e=Object(y.e)(),t=Object(y.d)();return Object(g.jsx)(o.EuiButtonEmpty,{onClick:async()=>{if(!t)return;const a=await t.getUrl({page:E.b.SETTINGS});e(a)},iconType:"gear"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.navMenu.settingsTabLinkText",defaultMessage:"Settings"}))},dn=({isMlEnabledInSpace:e,lastRefresh:t})=>{const[a,i]=Object(v.b)(E.b.ANOMALY_DETECTION_JOBS_MANAGE,{pageIndex:0,pageSize:10,sortField:"id",sortDirection:"asc"}),{services:{docLinks:n}}=Object(y.b)(),o=n.links.ml.anomalyDetection;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.jobsList.title",defaultMessage:"Anomaly Detection Jobs"})),Object(g.jsx)(ln,null,Object(g.jsx)(cn,null)),Object(g.jsx)(jobs_list_view_JobsListView,{isMlEnabledInSpace:e,lastRefresh:t,jobsViewState:a,onJobsViewStateUpdate:i}),Object(g.jsx)(sn.a,{docLink:o}))};var un=a(149);const pn=(e,t)=>({id:"anomaly_detection",title:r.i18n.translate("xpack.ml.anomalyDetection.jobs.docTitle",{defaultMessage:"Anomaly Detection Jobs"}),path:"/jobs",render:(e,t)=>Object(g.jsx)(mn,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.anomalyDetection.jobsManagementLabel",{defaultMessage:"Jobs"})}],"data-test-subj":"mlPageJobManagement",enableDatePicker:!0}),mn=({deps:e})=>{var t,a,i;const{context:s}=I(void 0,void 0,e.config,e.dataViewsContract,W(e)),o=Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!0}),r=Object(un.a)(),l=G()(q.a),c=null!==(t=null==l?void 0:l.lastRefresh)&&void 0!==t?t:0,d=null!==(a=r.value)&&void 0!==a?a:0,u=null===(i=r.pause)||void 0===i||i;Object(n.useEffect)((()=>{const e=0===d&&!0===u?{pause:!1,value:3e4}:{pause:u,value:d};o.setRefreshInterval(e)}),[]);const p=Object(n.useMemo)((()=>new st.a),[]);return Object(g.jsx)(T.b,{context:s},Object(g.jsx)(ct.Provider,{value:p},Object(g.jsx)(dn,{lastRefresh:c})))};var bn=a(65);const fn=({nextStepPath:e})=>{const{uiSettings:t,savedObjects:a}=Object(y.b)().services,i=Object(y.e)();return Object(g.jsx)("div",{"data-test-subj":"mlPageSourceSelection"},Object(g.jsx)(o.EuiPageBody,{restrictWidth:1200},Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.selectDataViewOrSavedSearch",defaultMessage:"Select data view or saved search"})),Object(g.jsx)(o.EuiPageContent_Deprecated,{hasShadow:!1,hasBorder:!0},Object(g.jsx)(bn.SavedObjectFinderUi,{key:"searchSavedObjectFinder",onChoose:(t,a)=>{i(`${e}?${"index-pattern"===a?"index":"savedSearchId"}=${encodeURIComponent(t)}`)},showFilter:!0,noItemsMessage:r.i18n.translate("xpack.ml.newJob.wizard.searchSelection.notFoundLabel",{defaultMessage:"No matching data views or saved searches found."}),savedObjectMetaData:[{type:"search",getIconForSavedObject:()=>"search",name:r.i18n.translate("xpack.ml.newJob.wizard.searchSelection.savedObjectType.search",{defaultMessage:"Saved search"})},{type:"index-pattern",getIconForSavedObject:()=>"indexPatternApp",name:r.i18n.translate("xpack.ml.newJob.wizard.searchSelection.savedObjectType.dataView",{defaultMessage:"Data view"}),defaultSearchField:"name"}],fixedPageSize:20,uiSettings:t,savedObjects:a}))))};var hn;!function(e){e[e.NEW_JOB=0]="NEW_JOB",e[e.DATAVISUALIZER=1]="DATAVISUALIZER"}(hn||(hn={}));const gn=(e,t)=>[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.createJobLabel",{defaultMessage:"Create job"})}],jn=(e,t)=>[N("ML_BREADCRUMB",e,t),N("DATA_VISUALIZER_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.selectDateViewLabel",{defaultMessage:"Select Data View"})}],xn=(e,t)=>[N("ML_BREADCRUMB",e,t),N("AIOPS_BREADCRUMB_EXPLAIN_LOG_RATE_SPIKES",e,t),N("EXPLAIN_LOG_RATE_SPIKES",e,t),{text:r.i18n.translate("xpack.ml.aiopsBreadcrumbs.selectDataViewLabel",{defaultMessage:"Select Data View"})}],vn=(e,t)=>[N("ML_BREADCRUMB",e,t),N("AIOPS_BREADCRUMB_LOG_PATTERN_ANALYSIS",e,t),N("LOG_PATTERN_ANALYSIS",e,t),{text:r.i18n.translate("xpack.ml.aiopsBreadcrumbs.selectDataViewLabel",{defaultMessage:"Select Data View"})}],yn=(e,t)=>[N("ML_BREADCRUMB",e,t),N("AIOPS_BREADCRUMB_CHANGE_POINT_DETECTION",e,t),N("CHANGE_POINT_DETECTION",e,t),{text:r.i18n.translate("xpack.ml.aiopsBreadcrumbs.selectDataViewLabel",{defaultMessage:"Select Data View"})}],On=(e,t)=>({path:"/jobs/new_job/step/index_or_search",render:(e,t)=>Object(g.jsx)(_n,_()({},e,{nextStepPath:"/jobs/new_job/step/job_type",deps:t,mode:hn.NEW_JOB})),breadcrumbs:gn(e,t)}),En=(e,t)=>({id:"data_view_datavisualizer",path:"/datavisualizer_index_select",title:r.i18n.translate("xpack.ml.selectDataViewLabel",{defaultMessage:"Select Data View"}),render:(e,t)=>Object(g.jsx)(_n,_()({},e,{nextStepPath:"/jobs/new_job/datavisualizer",deps:t,mode:hn.DATAVISUALIZER})),breadcrumbs:jn(e,t)}),wn=(e,t)=>({id:"data_view_explain_log_rate_spikes",path:"/aiops/explain_log_rate_spikes_index_select",title:r.i18n.translate("xpack.ml.selectDataViewLabel",{defaultMessage:"Select Data View"}),render:(e,t)=>Object(g.jsx)(_n,_()({},e,{nextStepPath:"aiops/explain_log_rate_spikes",deps:t,mode:hn.DATAVISUALIZER})),breadcrumbs:xn(e,t)}),Mn=(e,t)=>({id:"data_view_log_categorization",path:"/aiops/log_categorization_index_select",title:r.i18n.translate("xpack.ml.selectDataViewLabel",{defaultMessage:"Select Data View"}),render:(e,t)=>Object(g.jsx)(_n,_()({},e,{nextStepPath:"aiops/log_categorization",deps:t,mode:hn.DATAVISUALIZER})),breadcrumbs:vn(e,t)}),Sn=(e,t)=>({id:"data_view_change_point_detection",path:"/aiops/change_point_detection_index_select",title:r.i18n.translate("xpack.ml.selectDataViewLabel",{defaultMessage:"Select Data View"}),render:(e,t)=>Object(g.jsx)(_n,_()({},e,{nextStepPath:"aiops/change_point_detection",deps:t,mode:hn.DATAVISUALIZER})),breadcrumbs:yn(e,t)}),_n=({nextStepPath:e,deps:t,mode:a})=>{const{services:{http:{basePath:i},application:{navigateToUrl:n}}}=Object(y.b)(),{redirectToMlAccessDeniedPage:s}=t,o={...W(t),preConfiguredJobRedirect:()=>async function(e,t,a){const{createdBy:i,job:n,datafeed:s}=K.a.tempJobCloningObjects;if(!n||!s)return Promise.resolve();{const n=await async function(e,t){var a;if(null===t)throw new Error("Data views are not initialized!");const[i]=await(null==t?void 0:t.find(e.indices.join(",")));return i?null!==(a=i.id)&&void 0!==a?a:i.title:null}(s,e);if(null===n)return Promise.resolve();try{const e=await async function(e,t){let a="";switch(e){case wt.a.SINGLE_METRIC:case wt.a.SINGLE_METRIC_FROM_LENS:a=wt.f.SINGLE_METRIC;break;case wt.a.MULTI_METRIC:case wt.a.MULTI_METRIC_FROM_LENS:a=wt.f.MULTI_METRIC;break;case wt.a.POPULATION:a=wt.f.POPULATION;break;case wt.a.CATEGORIZATION:a=wt.f.CATEGORIZATION;break;case wt.a.RARE:a=wt.f.RARE;break;default:a=wt.f.ADVANCED}return`jobs/new_job/${a}?index=${t}&_g=()`}(i,n);return await a(`${t}/app/ml/${e}`),Promise.reject()}catch(e){return Promise.resolve()}}}(t.dataViewsContract,i.get(),n)},r={checkBasicLicense:O.a,cacheDataViewsContract:()=>Object(C.a)(t.dataViewsContract),checkGetJobsCapabilities:()=>Object(w.c)(s)},{context:l}=I(void 0,void 0,t.config,t.dataViewsContract,a===hn.NEW_JOB?o:r);return Object(g.jsx)(T.b,{context:l},Object(g.jsx)(fn,{nextStepPath:e}))};var Tn=a(132),Cn=a(102);function kn(e){return null!==e}const Fn=({icon:e,iconAreaLabel:t,title:a,description:i,onClick:n,href:s,isDisabled:r,"data-test-subj":l})=>{const c={...s?{href:s}:{},...n?{onClick:n}:{}};return Object(g.jsx)(o.EuiPanel,{style:{cursor:r?"not-allowed":void 0},hasShadow:!1,hasBorder:!0},Object(g.jsx)(o.EuiLink,_()({style:{display:"block",pointerEvents:r?"none":void 0,background:"transparent",outline:"none"},"data-test-subj":l,color:"subdued"},c),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"l",responsive:!0},Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{paddingTop:"8px"}},"string"==typeof e?Object(g.jsx)(o.EuiIcon,{size:"xl",type:e,"aria-label":t}):e),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h3",null,a)),Object(g.jsx)(o.EuiText,{color:"subdued"},Object(g.jsx)("p",null,i))))))},In=({config:e,indexPattern:t,savedSearch:a})=>{const{services:{http:{basePath:i}}}=Object(y.b)(),n=null===a?`index=${t.id}`:`savedSearchId=${a.id}`,s=`${i.get()}/app/ml/jobs/new_job/recognize?id=${e.id}&${n}`;let r=null;return r=e.logo&&e.logo.icon?Object(g.jsx)(o.EuiIcon,{type:e.logo.icon,size:"xl"}):e.logo&&e.logo.src?Object(g.jsx)("img",{alt:"",src:e.logo.src}):Object(g.jsx)("h3",{className:"euiTitle euiTitle--small"},e.id),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Fn,{"data-test-subj":`mlRecognizerCard ${e.id}`,href:s,title:e.title,description:e.description,icon:r}))};class data_recognizer_DataRecognizer extends n.Component{constructor(e){super(e),this.state={results:[]},this.indexPattern=e.indexPattern,this.savedSearch=e.savedSearch,this.className=e.className,this.results=e.results}componentDidMount(){X.ml.recognizeIndex({indexPatternTitle:this.indexPattern.title}).then((e=>{e.sort(((e,t)=>e.title.localeCompare(t.title)));const t=e.map((e=>Object(g.jsx)(In,{key:e.id,config:e,indexPattern:this.indexPattern,savedSearch:this.savedSearch})));"object"==typeof this.results&&(this.results.count=t.length,"function"==typeof this.results.onChange&&this.results.onChange()),this.setState({results:t})})).catch((e=>{console.error("Error attempting to recognize index",e)}))}render(){return Object(g.jsx)(s.a.Fragment,null,this.state.results)}}const Dn=Object(g.jsx)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Object(g.jsx)("path",{d:"M16 32C7.16344 32 0 24.8366 0 16C0 7.16344 7.16344 0 16 0C24.8366 0 32 7.16344 32 16H30C30 8.26801 23.732 2 16 2C8.26801 2 2 8.26801 2 16C2 23.732 8.26801 30 16 30V32Z",fill:"#343741"}),Object(g.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17 15H23V17H17V23H15V17H9V15H15V9H17V15ZM32 30V32H20V30H32ZM32 22L20 22V24L32 24V22ZM32 26V28H20V26H32Z",fill:"#017D73"})),An=Object(g.jsx)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Object(g.jsx)("path",{d:"M16 32C7.16344 32 0 24.8366 0 16C0 7.16344 7.16344 0 16 0C24.8366 0 32 7.16344 32 16H30C30 8.26801 23.732 2 16 2C8.26801 2 2 8.26801 2 16C2 23.732 8.26801 30 16 30V32Z",fill:"#343741"}),Object(g.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17 15H23V17H17V23H15V17H9V15H15V9H17V15ZM32 30V32H20V30H32ZM32 22L20 22V24L32 24V22ZM32 26V28H20V26H32Z",fill:"#017D73"})),Ln=()=>{const{services:{share:e}}=Object(y.b)(),t=Object(Cn.b)(),a=Object(y.e)(),i=Object(F.a)(E.b.ANOMALY_DETECTION_CREATE_JOB_SELECT_INDEX),[l,c]=Object(n.useState)(0),{currentSavedSearch:d,currentDataView:u}=t,p=Object(C.i)(u),b=!p&&kn(d)?r.i18n.translate("xpack.ml.newJob.wizard.jobType.dataViewFromSavedSearchNotTimeBasedMessage",{defaultMessage:"{savedSearchTitle} uses data view {dataViewName} which is not time based",values:{savedSearchTitle:d.attributes.title,dataViewName:u.title}}):r.i18n.translate("xpack.ml.newJob.wizard.jobType.dataViewNotTimeBasedMessage",{defaultMessage:"Data view {dataViewName} is not time based",values:{dataViewName:u.title}}),f=kn(d)?r.i18n.translate("xpack.ml.newJob.wizard.jobType.savedSearchPageTitleLabel",{defaultMessage:"saved search {savedSearchTitle}",values:{savedSearchTitle:d.attributes.title}}):r.i18n.translate("xpack.ml.newJob.wizard.jobType.dataViewPageTitleLabel",{defaultMessage:"data view {dataViewName}",values:{dataViewName:u.getName()}}),h={count:0,onChange(){c(h.count)}},j=()=>kn(d)?`?savedSearchId=${d.id}`:`?index=${u.id}`,x=[{onClick:()=>a(`/jobs/new_job/single_metric${j()}`),icon:{type:"createSingleMetricJob",ariaLabel:r.i18n.translate("xpack.ml.newJob.wizard.jobType.singleMetricAriaLabel",{defaultMessage:"Single metric job"})},title:r.i18n.translate("xpack.ml.newJob.wizard.jobType.singleMetricTitle",{defaultMessage:"Single metric"}),description:r.i18n.translate("xpack.ml.newJob.wizard.jobType.singleMetricDescription",{defaultMessage:"Detect anomalies in a single time series."}),id:"mlJobTypeLinkSingleMetricJob"},{onClick:()=>a(`/jobs/new_job/multi_metric${j()}`),icon:{type:"createMultiMetricJob",ariaLabel:r.i18n.translate("xpack.ml.newJob.wizard.jobType.multiMetricAriaLabel",{defaultMessage:"Multi-metric job"})},title:r.i18n.translate("xpack.ml.newJob.wizard.jobType.multiMetricTitle",{defaultMessage:"Multi-metric"}),description:r.i18n.translate("xpack.ml.newJob.wizard.jobType.multiMetricDescription",{defaultMessage:"Detect anomalies with one or more metrics and optionally split the analysis."}),id:"mlJobTypeLinkMultiMetricJob"},{onClick:()=>a(`/jobs/new_job/population${j()}`),icon:{type:"createPopulationJob",ariaLabel:r.i18n.translate("xpack.ml.newJob.wizard.jobType.populationAriaLabel",{defaultMessage:"Population job"})},title:r.i18n.translate("xpack.ml.newJob.wizard.jobType.populationTitle",{defaultMessage:"Population"}),description:r.i18n.translate("xpack.ml.newJob.wizard.jobType.populationDescription",{defaultMessage:"Detect activity that is unusual compared to the behavior of the population."}),id:"mlJobTypeLinkPopulationJob"},{onClick:()=>a(`/jobs/new_job/advanced${j()}`),icon:{type:"createAdvancedJob",ariaLabel:r.i18n.translate("xpack.ml.newJob.wizard.jobType.advancedAriaLabel",{defaultMessage:"Advanced job"})},title:r.i18n.translate("xpack.ml.newJob.wizard.jobType.advancedTitle",{defaultMessage:"Advanced"}),description:r.i18n.translate("xpack.ml.newJob.wizard.jobType.advancedDescription",{defaultMessage:"Use the full range of options to create a job for more advanced use cases."}),id:"mlJobTypeLinkAdvancedJob"},{onClick:()=>a(`/jobs/new_job/categorization${j()}`),icon:{type:Dn,ariaLabel:r.i18n.translate("xpack.ml.newJob.wizard.jobType.categorizationAriaLabel",{defaultMessage:"Categorization job"})},title:r.i18n.translate("xpack.ml.newJob.wizard.jobType.categorizationTitle",{defaultMessage:"Categorization"}),description:r.i18n.translate("xpack.ml.newJob.wizard.jobType.categorizationDescription",{defaultMessage:"Group log messages into categories and detect anomalies within them."}),id:"mlJobTypeLinkCategorizationJob"},{onClick:()=>a(`/jobs/new_job/rare${j()}`),icon:{type:An,ariaLabel:r.i18n.translate("xpack.ml.newJob.wizard.jobType.rareAriaLabel",{defaultMessage:"Rare job"})},title:r.i18n.translate("xpack.ml.newJob.wizard.jobType.rareTitle",{defaultMessage:"Rare"}),description:r.i18n.translate("xpack.ml.newJob.wizard.jobType.rareDescription",{defaultMessage:"Detect rare values in time series data."}),id:"mlJobTypeLinkrareJob"}];return Object(g.jsx)("div",{"data-test-subj":"mlPageJobTypeSelection"},Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.createJobFromTitle",defaultMessage:"Create a job from the {pageTitleLabel}",values:{pageTitleLabel:f}})),!1===p&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiCallOut,{title:b,color:"warning",iconType:"alert"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.howToRunAnomalyDetectionDescription",defaultMessage:"Anomaly detection can only be run over indices which are time based."}),Object(g.jsx)("br",null),Object(g.jsx)(o.EuiLink,{onClick:i},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.selectDifferentIndexLinkText",defaultMessage:"Select a different data view or saved search"}))),Object(g.jsx)(o.EuiSpacer,{size:"xxl"})),Object(g.jsx)("div",{hidden:0===l},Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.useSuppliedConfigurationTitle",defaultMessage:"Use preconfigured jobs"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiText,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.useSuppliedConfigurationDescription",defaultMessage:"The fields in your data match known configurations. Create a set of preconfigured jobs."}))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGrid,{gutterSize:"l",columns:4},Object(g.jsx)(data_recognizer_DataRecognizer,{indexPattern:u,savedSearch:d,results:h})),Object(g.jsx)(o.EuiSpacer,{size:"xxl"})),Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.useWizardTitle",defaultMessage:"Use a wizard"}))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGrid,{gutterSize:"l",columns:4},x.map((({onClick:e,icon:t,title:a,description:i,id:n})=>Object(g.jsx)(o.EuiFlexItem,{key:n},Object(g.jsx)(Fn,{"data-test-subj":n,onClick:e,icon:t.type,iconAreaLabel:t.ariaLabel,title:a,description:i,isDisabled:!p}))))),Object(g.jsx)(o.EuiSpacer,{size:"xxl"}),Object(g.jsx)(o.EuiText,null,Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.learnMoreAboutDataTitle",defaultMessage:"Learn more about your data"}))),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.learnMoreAboutDataDescription",defaultMessage:"If you're not sure what type of job to create, first explore the fields and metrics in your data."}))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGrid,{gutterSize:"l",columns:4},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Fn,{icon:"dataVisualizer",iconAreaLabel:r.i18n.translate("xpack.ml.newJob.wizard.jobType.dataVisualizerAriaLabel",{defaultMessage:"Data Visualizer"}),title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.dataVisualizerTitle",defaultMessage:"Data Visualizer"}),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobType.dataVisualizerDescription",defaultMessage:"Learn more about the characteristics of your data and identify the fields for analysis with machine learning."}),onClick:async()=>{const t=kn(d)?d.attributes.title:u.title,i=e.url.locators.get(E.a),n=await i.getUrl({page:E.b.DATA_VISUALIZER_INDEX_VIEWER,pageState:{...null!=d&&d.id?{savedSearchId:d.id}:{index:u.id}}},{absolute:!0});Object(tt.a)(E.b.DATA_VISUALIZER_INDEX_VIEWER,t,n),a(`/jobs/new_job/datavisualizer${j()}`)}}))))},Rn=(e,t)=>({path:"/jobs/new_job/step/job_type",render:(e,t)=>Object(g.jsx)(Nn,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.selectJobType",{defaultMessage:"Create job"}),href:""}]}),Nn=({location:e,deps:t})=>{const{index:a,savedSearchId:i}=Object(Tn.parse)(e.search,{sort:!1}),{context:n}=I(a,i,t.config,t.dataViewsContract,W(t));return Object(g.jsx)(T.b,{context:n},Object(g.jsx)(Ln,null))},Pn=()=>({path:"/jobs/new_job",render:()=>Object(g.jsx)(zn,null),breadcrumbs:[]}),zn=()=>Object(g.jsx)(l.Redirect,{to:"/jobs/new_job/step/index_or_search"});var Bn=a(192);let Vn;!function(e){e[e.ERROR=0]="ERROR",e[e.WARNING=1]="WARNING"}(Vn||(Vn={}));const Jn=r.i18n.translate("xpack.ml.newJob.wizard.validateJob.asyncJobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."}),Un=r.i18n.translate("xpack.ml.newJob.wizard.validateJob.asyncGroupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing group or job."});function Gn(e){return e.pipe(Object(za.map)((e=>e.jobId)),Object(za.distinctUntilChanged)(((e,t)=>e===t)),Object(za.switchMap)((e=>X.ml.jobs.jobsExist$([e],!0))),Object(za.map)((e=>{const t=Object.values(e),a=!1===(null==t?void 0:t[0].exists);return{jobIdExists:{valid:a,...a?{}:{message:Jn}}}})))}function qn(e){return e.pipe(Object(za.map)((e=>e.groups)),Object(za.distinctUntilChanged)(((e,t)=>JSON.stringify(e)===JSON.stringify(t))),Object(za.switchMap)((e=>X.ml.jobs.jobsExist$(e,!0))),Object(za.map)((e=>{const t=!1===Object.values(e).some((e=>!0===e.exists&&!1===e.isGroup));return{groupIdsExist:{valid:t,...t?{}:{message:Un}}}})))}class job_validator_JobValidator{constructor(e){var t;Y()(this,"_jobCreator",void 0),Y()(this,"_validationSummary",void 0),Y()(this,"_lastJobConfig",void 0),Y()(this,"_lastDatafeedConfig",void 0),Y()(this,"_validateTimeout",null),Y()(this,"_asyncValidators$",[]),Y()(this,"_asyncValidatorsResult$",void 0),Y()(this,"_basicValidations",{jobId:{valid:!0},groupIds:{valid:!0},modelMemoryLimit:{valid:!0},bucketSpan:{valid:!0},duplicateDetectors:{valid:!0},query:{valid:!0},queryDelay:{valid:!0},frequency:{valid:!0},scrollSize:{valid:!0},categorizerMissingPerPartition:{valid:!0},categorizerVaryingPerPartitionField:{valid:!0},summaryCountField:{valid:!0}}),Y()(this,"_advancedValidations",{categorizationFieldValid:{valid:!0}}),Y()(this,"_validating",!1),Y()(this,"_basicValidationResult$",new at.ReplaySubject(2)),Y()(this,"_jobCreatorSubject$",new at.Subject),Y()(this,"validationResult$",void 0),Y()(this,"latestValidationResult",this._basicValidations),this._jobCreator=e,this._lastJobConfig=this._jobCreator.formattedJobJson,this._lastDatafeedConfig=this._jobCreator.formattedDatafeedJson,this._validationSummary={basic:!1,advanced:!1},this._asyncValidators$=[(t=this._jobCreatorSubject$,Object(at.combineLatest)([t.pipe(Object(za.pluck)("modelPlot")),t.pipe(Object(za.filter)((e=>null==e?void 0:e.modelPlot)),Object(za.map)((e=>({jobCreator:e,analysisConfigString:JSON.stringify(e.jobConfig.analysis_config,null,2)}))),Object(za.distinctUntilChanged)(((e,t)=>e.analysisConfigString===t.analysisConfigString)),Object(za.switchMap)((({jobCreator:e})=>X.ml.validateCardinality$({...e.jobConfig,datafeed_config:e.datafeedConfig}).pipe(Object(za.map)((e=>{for(const t of e)if(void 0!==t.modelPlotCardinality)return{highCardinality:{value:t.modelPlotCardinality,severity:Vn.WARNING}};return null}))))),Object(za.startWith)(null))]).pipe(Object(za.map)((([e,t])=>e?t:null)))),Gn(this._jobCreatorSubject$),qn(this._jobCreatorSubject$)],this._asyncValidatorsResult$=Object(at.combineLatest)(this._asyncValidators$).pipe(Object(za.map)((e=>e.reduce(((e,t)=>({...e,...t||{}})),{}))),Object(za.startWith)({})),this.validationResult$=Object(at.combineLatest)([this._basicValidationResult$,this._asyncValidatorsResult$]).pipe(Object(za.map)((([e,t])=>({...e,...t}))),Object(za.tap)((e=>{this.latestValidationResult=e})))}validate(e,t=!1){this._validating=!0;const a=this._jobCreator.formattedJobJson,i=this._jobCreator.formattedDatafeedJson;this._runAdvancedValidation(),t||a!==this._lastJobConfig||i!==this._lastDatafeedConfig?(null!==this._validateTimeout&&clearTimeout(this._validateTimeout),this._lastJobConfig=a,this._lastDatafeedConfig=i,this._validateTimeout=setTimeout((()=>{this._runBasicValidation(),this._jobCreatorSubject$.next(this._jobCreator),this._validating=!1,this._validateTimeout=null,e()}),500)):this._validating=null!==this._validateTimeout,e()}_resetBasicValidations(){this._validationSummary.basic=!0,Object.values(this._basicValidations).forEach((e=>{e.valid=!0,delete e.message}))}_runBasicValidation(){this._resetBasicValidations();const e=this._jobCreator.jobConfig,t=this._jobCreator.datafeedConfig,a=Object(A.d)(),i=Object(Qe.e)(e,void 0,a);Object(Ii.b)(i,this._basicValidations,e,t);const n=Object(Qe.c)(t);Object(Ii.b)(n,this._basicValidations,e,t);const s=Object(Qe.d)(e,t);Object(Ii.b)(s,this._basicValidations,e,t),this._validationSummary.basic=this._isOverallBasicValid(),this._basicValidationResult$.next(this._basicValidations)}_runAdvancedValidation(){Jt(this._jobCreator)&&(this._advancedValidations.categorizationFieldValid.valid=this._jobCreator.overallValidStatus!==Lt.INVALID)}_isOverallBasicValid(){return!1===Object.values(this._basicValidations).some((e=>!1===e.valid))}get validationSummary(){return this._validationSummary}get bucketSpan(){return this._basicValidations.bucketSpan}get summaryCountField(){return this._basicValidations.summaryCountField}get duplicateDetectors(){return this._basicValidations.duplicateDetectors}get jobId(){return this._basicValidations.jobId}get groupIds(){return this._basicValidations.groupIds}get modelMemoryLimit(){return this._basicValidations.modelMemoryLimit}get query(){return this._basicValidations.query}get queryDelay(){return this._basicValidations.queryDelay}get frequency(){return this._basicValidations.frequency}get scrollSize(){return this._basicValidations.scrollSize}set advancedValid(e){this._validationSummary.advanced=e}get validating(){return this._validating}get categorizationField(){return this._advancedValidations.categorizationFieldValid.valid}set categorizationField(e){this._advancedValidations.categorizationFieldValid.valid=e}get categorizerMissingPerPartition(){return this._basicValidations.categorizerMissingPerPartition}get categorizerVaryingPerPartitionField(){return this._basicValidations.categorizerVaryingPerPartitionField}get isPickFieldsStepValid(){return this._jobCreator.detectors.length>0&&(this._jobCreator.type!==wt.f.ADVANCED||this._jobCreator.type===wt.f.ADVANCED&&this.modelMemoryLimit.valid)&&this.bucketSpan.valid&&this.duplicateDetectors.valid&&this.categorizerMissingPerPartition.valid&&this.categorizerVaryingPerPartitionField.valid&&this.summaryCountField.valid&&!this.validating&&(this._jobCreator.type!==wt.f.CATEGORIZATION||this._jobCreator.type===wt.f.CATEGORIZATION&&this.categorizationField)}get isModelMemoryEstimationPayloadValid(){return this._jobCreator.detectors.length>0&&this.bucketSpan.valid&&this.duplicateDetectors.valid&&(this._jobCreator.type!==wt.f.CATEGORIZATION||this._jobCreator.type===wt.f.CATEGORIZATION&&this.categorizationField)}}let $n;!function(e){e[e.TIME_RANGE=0]="TIME_RANGE",e[e.ADVANCED_CONFIGURE_DATAFEED=1]="ADVANCED_CONFIGURE_DATAFEED",e[e.PICK_FIELDS=2]="PICK_FIELDS",e[e.JOB_DETAILS=3]="JOB_DETAILS",e[e.VALIDATION=4]="VALIDATION",e[e.SUMMARY=5]="SUMMARY"}($n||($n={}));const Wn=Object(n.createContext)({jobCreatorUpdated:0,jobCreatorUpdate:()=>{},jobCreator:{},chartLoader:{},resultsLoader:{},chartInterval:{},jobValidator:{},jobValidatorUpdated:0,fields:[],aggs:[],existingJobsAndGroups:{}});var Hn=a(112);const Yn=({previous:e,previousActive:t=!0,next:a,nextActive:i=!0,children:s})=>Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,null),Object(g.jsx)(o.EuiFlexGroup,null,e&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Xn,{previous:e,previousActive:t})),a&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Qn,{next:a,nextActive:i})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},s),Object(g.jsx)(o.EuiFlexItem,null))),Xn=({previous:e,previousActive:t=!0})=>Object(g.jsx)(o.EuiButtonEmpty,{disabled:!t,onClick:e,iconType:"arrowLeft",iconSide:"left","data-test-subj":"mlJobWizardNavButtonPrevious"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.previousStepButton",defaultMessage:"Previous"})),Qn=({next:e,nextActive:t=!0})=>Object(g.jsx)(o.EuiButton,{fill:!0,disabled:!t,onClick:e,iconSide:"right",iconType:"arrowRight","data-test-subj":"mlJobWizardNavButtonNext"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.nextStepButton",defaultMessage:"Next"}));var Kn=a(31),Zn=a.n(Kn);function es(){const e=Object(ee.m)(),t=Zn.a.parse(e.getTime().from),a=Zn.a.parse(e.getTime().to),i=void 0!==t?t.valueOf():0;return{to:void 0!==a?a.valueOf():0,from:i}}var ts=a(158),as=a(152);const is="exclude-frozen",ns=({dataView:e,query:t,disabled:a,callback:i})=>{async function s(e,t,a=!0){const n=await async function(e,t,a){try{const i=Object(ee.m)(),n=e.getComputedFields().runtimeFields,s=await X.ml.getTimeFieldRange({index:e.title,timeFieldName:e.timeFieldName,query:a?yt(t):t,...Object(re.isPopulatedObject)(n)?{runtimeMappings:n}:{}});return i.setTime({from:Oe()(s.start).toISOString(),to:Oe()(s.end).toISOString()}),s}catch(e){return Object(ee.n)().addDanger(r.i18n.translate("xpack.ml.fullTimeRangeSelector.errorSettingTimeRangeNotification",{defaultMessage:"An error occurred setting the time range."})),e}}(e,t,a);"function"==typeof i&&i(n)}const[l,c]=Object(n.useState)(!1),[d,u]=Object(ts.b)(as.d,is),p=()=>{c(!1)},b=Object(n.useMemo)((()=>[{id:is,label:r.i18n.translate("xpack.ml.fullTimeRangeSelector.useFullDataExcludingFrozenMenuLabel",{defaultMessage:"Exclude frozen data tier"})},{id:"include-frozen",label:r.i18n.translate("xpack.ml.fullTimeRangeSelector.useFullDataIncludingFrozenMenuLabel",{defaultMessage:"Include frozen data tier"})}]),[]),f=Object(n.useCallback)((a=>{u(a),s(e,t,a===is),p()}),[]),h=Object(n.useMemo)((()=>Object(g.jsx)(o.EuiPanel,null,Object(g.jsx)(o.EuiRadioGroup,{options:b,idSelected:d,onChange:f,compressed:!0}))),[d,b]),j=Object(n.useMemo)((()=>d===is?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.fullTimeRangeSelector.useFullDataExcludingFrozenButtonTooltip",defaultMessage:"Use full range of data excluding frozen data tier."}):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.fullTimeRangeSelector.useFullDataIncludingFrozenButtonTooltip",defaultMessage:"Use full range of data including frozen data tier, which might have slower search results."})),[d]);return Object(g.jsx)(o.EuiFlexGroup,{responsive:!1,gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiToolTip,{content:j},Object(g.jsx)(o.EuiButton,{isDisabled:a,onClick:()=>s(e,t,!0),"data-test-subj":"mlButtonUseFullData"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.fullTimeRangeSelector.useFullDataButtonLabel",defaultMessage:"Use full data"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiPopover,{id:"mlFullTimeRangeSelectorOption",button:Object(g.jsx)(o.EuiButtonIcon,{display:"base",size:"m",iconType:"boxesVertical","aria-label":"More",onClick:()=>{c(!l)}}),isOpen:l,closePopover:p,panelPaddingSize:"none",anchorPosition:"downRight"},h)))},ss=Object(n.memo)((({children:e,validation:t})=>{const a=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.title",{defaultMessage:"Groups"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,a),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.description",defaultMessage:" Optional grouping for jobs. New groups can be created or picked from the list of existing groups."})},Object(g.jsx)(o.EuiFormRow,{label:a,error:t.message,isInvalid:!1===t.valid},Object(g.jsx)(s.a.Fragment,null,e)))})),os=Object(n.memo)((({existingGroups:e,selectedGroups:t,onChange:a,validation:i})=>{const n=e.map((e=>({label:e,color:Object(Xa.a)(e)}))),s=t.map((e=>({label:e,color:Object(Xa.a)(e)})));function l(e){a(e.map((e=>e.label)))}return Object(g.jsx)(ss,{validation:i},Object(g.jsx)(o.EuiComboBox,{placeholder:r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.placeholder",{defaultMessage:"Select or create groups"}),options:n,selectedOptions:s,onChange:l,onCreateOption:function(e,t){const a=e.trim().toLowerCase();if(!a)return;const i={label:e,color:Object(Xa.a)(e)};-1===t.findIndex((e=>e.label.trim().toLowerCase()===a))&&n.push(i),l([...s,i])},isClearable:!0,isInvalid:!i.valid,"data-test-subj":"mlJobWizardComboBoxJobGroups"}))})),rs=({setTimeRange:e,timeRange:t})=>{const a=Object(Cn.b)().kibanaConfig.get("dateFormat"),[i,s]=Object(n.useState)(Oe()(t.start)),[l,c]=Object(n.useState)(Oe()(t.end));return Object(n.useEffect)((()=>{void 0!==i&&void 0!==l&&e({start:i.valueOf(),end:l.valueOf()})}),[i,l,e]),Object(n.useEffect)((()=>{s(Oe()(t.start)),c(Oe()(t.end))}),[JSON.stringify(t)]),Object(g.jsx)(n.Fragment,null,Object(g.jsx)("div",{style:{minWidth:"512px"},"data-test-subj":"mlJobWizardDateRange"},Object(g.jsx)(o.EuiDatePickerRange,{fullWidth:!0,startDateControl:Object(g.jsx)(o.EuiDatePicker,{selected:i,onChange:function(e){s(e||void 0)},startDate:i,endDate:l,"aria-label":r.i18n.translate("xpack.ml.newJob.wizard.timeRangeStep.timeRangePicker.startDateLabel",{defaultMessage:"Start date"}),showTimeSelect:!0,dateFormat:a,maxDate:l}),endDateControl:Object(g.jsx)(o.EuiDatePicker,{selected:l,onChange:function(e){c(e||void 0)},startDate:i,endDate:l,"aria-label":r.i18n.translate("xpack.ml.newJob.wizard.timeRangeStep.timeRangePicker.endDateLabel",{defaultMessage:"End date"}),showTimeSelect:!0,dateFormat:a,minDate:i})})))},ls=({setCurrentStep:e,isCurrentStep:t})=>{const{services:a}=Object(y.b)(),i=Object(Cn.b)(),{jobCreator:s,jobCreatorUpdate:l,jobCreatorUpdated:c,chartLoader:d,chartInterval:u}=Object(n.useContext)(Wn),[p,m]=Object(n.useState)({start:s.start,end:s.end}),[b,f]=Object(n.useState)([]),[h,j]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{const{start:e,end:t}=p;s.setTimeRange(e,t),u.setBounds({min:Oe()(e),max:Oe()(t)});const{timefilter:i}=a.data.query.timefilter;i.setTime({from:Oe()(e).toISOString(),to:Oe()(t).toISOString()}),l(),async function(){j(!0);try{var e;const t=await d.loadEventRateChart(s.start,s.end,u.getInterval().asMilliseconds(),null!==(e=s.runtimeMappings)&&void 0!==e?e:void 0,s.datafeedConfig.indices_options);f(t)}catch(e){f([])}j(!1)}()}),[s,u,p.start,p.end,l,a.data.query.timefilter]),Object(n.useEffect)((()=>{m({start:s.start,end:s.end})}),[s,c]),Object(g.jsx)(n.Fragment,null,t&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(rs,{setTimeRange:m,timeRange:p})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(ns,{dataView:i.currentDataView,query:i.combinedQuery,disabled:!1,callback:function(e){if(null!==e.start&&null!==e.end)m({start:e.start,end:e.end});else{const{toasts:e}=a.notifications;e.addDanger(r.i18n.translate("xpack.ml.newJob.wizard.timeRangeStep.fullTimeRangeError",{defaultMessage:"An error occurred obtaining the time range for the index"}))}}})),Object(g.jsx)(o.EuiFlexItem,null)),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(ta,{eventRateChartData:b,height:"300px",width:"100%",showAxis:!0,loading:h}),Object(g.jsx)(Yn,{next:()=>e(s.type===wt.f.ADVANCED?$n.ADVANCED_CONFIGURE_DATAFEED:$n.PICK_FIELDS),nextActive:!0})))},cs=({fields:e,changeHandler:t,selectedOptions:a,removeOptions:i})=>{const{jobValidator:s,jobValidatorUpdated:r}=Object(n.useContext)(Wn),[l,c]=Object(n.useState)(s.duplicateDetectors),d=i.map(ds),u=e.map((e=>{const t={label:e.name,options:[]};return void 0!==e.aggs&&(t.options=e.aggs.filter((e=>null!==e.dslName)).map((t=>({label:`${t.title}(${e.name})`,agg:t,field:e}))).filter((e=>!1===d.includes(e.label)))),t}));return Object(n.useEffect)((()=>{c(s.duplicateDetectors)}),[r]),Object(g.jsx)(o.EuiFormRow,{error:l.message,isInvalid:!1===l.valid,"data-test-subj":"mlJobWizardAggSelection"},Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:u,selectedOptions:a,onChange:t,isClearable:!1,isInvalid:!1===l.valid}))};function ds(e){return`${e.agg.title}(${e.field.name})`}const us={...Ht,area:{...Ht.area,visible:!0},line:{...Ht.line,strokeWidth:1,opacity:.4}},ps=({modelData:e})=>{const{MODEL_COLOR:t}=$t(),a=void 0===e?[]:e;return Object(g.jsx)(dt.AreaSeries,{id:"model",xScaleType:dt.ScaleType.Time,yScaleType:dt.ScaleType.Linear,xAccessor:"time",yAccessors:["modelUpper"],y0Accessors:["modelLower"],data:a,curve:dt.CurveType.CURVE_MONOTONE_X,areaSeriesStyle:us,color:t})},ms={...Ht},bs=({chartData:e})=>{const{LINE_COLOR:t}=$t();return Object(g.jsx)(dt.LineSeries,{id:"line",xScaleType:dt.ScaleType.Time,yScaleType:dt.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:e,curve:dt.CurveType.CURVE_MONOTONE_X,lineSeriesStyle:ms,color:t})},fs={...Ht,line:{...Ht.line,visible:!1},point:{...Ht.point,visible:!0}},hs=({chartData:e})=>{const{LINE_COLOR:t}=$t();return Object(g.jsx)(dt.LineSeries,{id:"scatter",xScaleType:dt.ScaleType.Time,yScaleType:dt.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:e,curve:dt.CurveType.CURVE_MONOTONE_X,lineSeriesStyle:fs,color:t})};let gs;!function(e){e[e.LINE=0]="LINE",e[e.SCATTER=1]="SCATTER"}(gs||(gs={}));const js=({chartType:e,chartData:t=[],modelData:a,anomalyData:i,height:n,width:s,loading:o=!1})=>{const r=e===gs.SCATTER?function(e){return e.reduce(((e,t)=>(e.push(...t.values.map((e=>({time:t.time,value:e.value})))),e)),[])}(t):t,l=0===(c=r).length?{min:0,max:0}:{min:c[0].time,max:c[c.length-1].time};var c;return Object(g.jsx)("div",{style:{width:s,height:n},"data-test-subj":`mlAnomalyChart ${gs[e]}`},Object(g.jsx)(Xt,{height:n,hasData:r.length>0,loading:o},Object(g.jsx)(dt.Chart,null,Object(g.jsx)(dt.Settings,{xDomain:l,tooltip:dt.TooltipType.None}),Object(g.jsx)(ht,{chartData:r}),Object(g.jsx)(Zt,{anomalyData:i}),Object(g.jsx)(ps,{modelData:a}),e===gs.LINE&&Object(g.jsx)(bs,{chartData:r}),e===gs.SCATTER&&Object(g.jsx)(hs,{chartData:r}))))},xs=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:i,chartLoader:s,chartInterval:o}=Object(n.useContext)(Wn),r=t,l=Object(n.useMemo)((()=>Object(vt.c)([...Hn.a.fields,...r.runtimeFields])),[]),[c,d]=Object(n.useState)(null!==r.aggFieldPair?[{label:ds(r.aggFieldPair)}]:[]),[u,p]=Object(n.useState)(r.aggFieldPair),[m,b]=Object(n.useState)({}),[f,h]=Object(n.useState)(!1),[j,x]=Object(n.useState)(r.start),[v,y]=Object(n.useState)(r.end),[O,E]=Object(n.useState)(r.bucketSpanMs);async function w(){if(null!==u){h(!0);try{const e=Yt(r,o),t=await s.loadLineCharts(r.start,r.end,[u],null,null,e.intervalMs,r.runtimeMappings,r.datafeedConfig.indices_options);void 0!==t[0]&&b(t)}catch(e){Object(Z.a)().displayErrorToast(e),b({})}h(!1)}}return Object(n.useEffect)((()=>{null!==u&&(r.setDetector(u.agg,u.field),a(),w(),e(null!==u))}),[r,u]),Object(n.useEffect)((()=>{r.start===j&&r.end===v||(x(r.start),y(r.end),w()),r.bucketSpanMs!==O&&(E(r.bucketSpanMs),w())}),[r,i]),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(cs,{fields:l,changeHandler:function(e){if(d(e),e.length){const t=e[0];p(void 0!==t?{agg:t.agg,field:t.field}:null)}},selectedOptions:c,removeOptions:[]}),(void 0!==m[0]||!0===f)&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(js,{chartType:gs.LINE,chartData:m[0],modelData:[],anomalyData:[],height:"300px",width:"100%",loading:f})))},vs=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:i}=Object(n.useContext)(Wn),s=e,[o,r]=Object(n.useState)({}),[l,c]=Object(n.useState)(!1),[d,u]=Object(n.useState)([]),[p,m]=Object(n.useState)([]);function b(e){const t=e.model[0];void 0!==t&&u(t);const a=e.anomalies[0];void 0!==a&&m(a)}return Object(n.useEffect)((()=>{const e=a.subscribeToResults(b);return async function(){if(null!==s.aggFieldPair){c(!0);try{const e=Yt(s,i),a=await t.loadLineCharts(s.start,s.end,[s.aggFieldPair],null,null,e.intervalMs,s.runtimeMappings,s.datafeedConfig.indices_options);void 0!==a[0]&&r(a)}catch(e){Object(Z.a)().displayErrorToast(e),r({})}c(!1)}}(),()=>{e.unsubscribe()}}),[a]),Object(g.jsx)(n.Fragment,null,(void 0!==o[0]||!0===l)&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(js,{chartType:gs.LINE,chartData:o[0],modelData:d,anomalyData:p,height:"300px",width:"100%",loading:l})))},ys=({bucketSpan:e,setBucketSpan:t,isInvalid:a,disabled:i})=>Object(g.jsx)(o.EuiFieldText,{disabled:i,placeholder:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.placeholder",{defaultMessage:"Bucket span"}),value:e,onChange:e=>t(e.target.value),isInvalid:a,"data-test-subj":"mlJobWizardInputBucketSpan"}),Os=Object(n.memo)((({children:e,validation:t})=>{const a=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.title",{defaultMessage:"Bucket span"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,a),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.description",defaultMessage:"Set the interval for time series analysis, typically between 15m to 1h."})},Object(g.jsx)(o.EuiFormRow,{label:a,error:t.message,isInvalid:!1===t.valid},Object(g.jsx)(s.a.Fragment,null,e)))}));let Es;!function(e){e[e.NOT_RUNNING=0]="NOT_RUNNING",e[e.RUNNING=1]="RUNNING"}(Es||(Es={}));const ws=({setEstimating:e})=>{const{jobCreator:t,jobCreatorUpdate:a}=Object(n.useContext)(Wn),{status:i,estimateBucketSpan:s}=function(){var e;const{jobCreator:t,jobCreatorUpdate:a}=Object(n.useContext)(Wn),i=Object(Cn.b)(),[s,o]=Object(n.useState)(Es.NOT_RUNNING),l={aggTypes:t.aggregations.map((e=>e.dslName)),duration:{start:t.start,end:t.end},fields:t.fields.map((e=>e.id===Dt.a?null:e.id)),index:i.currentDataView.title,query:i.combinedQuery,splitField:void 0,timeField:i.currentDataView.timeFieldName,runtimeMappings:null!==(e=t.runtimeMappings)&&void 0!==e?e:void 0,indicesOptions:t.datafeedConfig.indices_options};if(zt(t)&&null!==t.splitField)l.splitField=t.splitField.id;else if(Bt(t)&&null!==t.populationField)l.splitField=t.populationField.id;else if(Ut(t)){var c;l.fields=[null],t.populationField?l.splitField=t.populationField.id:l.splitField=null===(c=t.rareField)||void 0===c?void 0:c.id}else Vt(t)&&t.richDetectors.some((e=>null!==e.partitionField?(l.splitField=e.partitionField.id,!0):null!==e.overField?(l.splitField=e.overField.id,!0):null!==e.byField?(l.splitField=e.byField.id,!0):void 0));return{status:s,estimateBucketSpan:async function(){o(Es.RUNNING);const{name:e,error:i,message:n}=await X.ml.estimateBucketSpan(l);if(o(Es.NOT_RUNNING),!0===i){const e=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpanEstimator.errorTitle",{defaultMessage:"Bucket span could not be estimated"});Object(Z.a)().displayWarningToast({title:e,text:n})}else t.bucketSpan=e,a()}}}(),[l,c]=Object(n.useState)(0===t.detectors.length),[d,u]=Object(n.useState)(p());function p(){return Vt(t)&&t.detectors.some((e=>{if(e.partition_field_name===Ft.b||e.over_field_name===Ft.b||e.by_field_name===Ft.b)return!0}))}return Object(n.useEffect)((()=>{e(i===Es.RUNNING)}),[i]),Object(n.useEffect)((()=>{c(0===t.detectors.length),u(p())}),[a]),Object(g.jsx)(o.EuiButton,{disabled:i===Es.RUNNING||!0===l||!0===d,onClick:s},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.bucketSpanEstimatorButton",defaultMessage:"Estimate bucket span"}))},Ms=({setIsValid:e,hideEstimateButton:t=!1})=>{const{jobCreator:a,jobCreatorUpdate:i,jobCreatorUpdated:s,jobValidator:r,jobValidatorUpdated:l}=Object(n.useContext)(Wn),[c,d]=Object(n.useState)(a.bucketSpan),[u,p]=Object(n.useState)(r.bucketSpan),[m,b]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{a.bucketSpan=c,i()}),[c]),Object(n.useEffect)((()=>{d(a.bucketSpan)}),[s]),Object(n.useEffect)((()=>{p(r.bucketSpan)}),[l]),Object(n.useEffect)((()=>{e(!1===m)}),[m]),Object(g.jsx)(Os,{validation:u},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(ys,{setBucketSpan:d,bucketSpan:c,isInvalid:!1===u.valid,disabled:m})),!1===t&&Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(ws,{setEstimating:b}))))},Ss=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.sparseData.title",{defaultMessage:"Sparse data"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.sparseData.description",defaultMessage:"Select if you wish to ignore empty buckets from being considered anomalous. Available for count and sum analysis."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),_s=()=>{const{jobCreator:e,jobCreatorUpdated:t,jobCreatorUpdate:a}=Object(n.useContext)(Wn),[i,s]=Object(n.useState)(e.sparseData),[l,c]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{e.sparseData=i,a()}),[i]),Object(n.useEffect)((()=>{const t=[xt.a.COUNT,xt.a.SUM],a=e.aggregations.some((e=>null!==e.dslName&&t.includes(e.dslName)));c(a),!1===a&&!0===i&&s(!1)}),[t]),Object(g.jsx)(Ss,null,Object(g.jsx)(o.EuiSwitch,{name:"switch",disabled:!1===l,checked:i,onChange:function(){s(!i)},"data-test-subj":"mlJobWizardSwitchSparseData",label:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.sparseData.title",{defaultMessage:"Sparse data"})}))},Ts=({setIsValid:e})=>{const{jobCreator:t}=Object(n.useContext)(Wn),a=Object(y.e)();return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Ms,{setIsValid:e})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(_s,null))),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{onClick:()=>{Object(Mt.e)(t,a)}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.singleMetricView.convertToMultiMetricButton",defaultMessage:"Convert to multi-metric job"})))))},Cs=({isActive:e,setCanProceed:t})=>{const[a,i]=Object(n.useState)(!1),[s,r]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{"function"==typeof t&&t(a&&s)}),[a,s]),Object(g.jsx)(n.Fragment,null,!1===e?Object(g.jsx)(vs,null):Object(g.jsx)(n.Fragment,null,Object(g.jsx)(xs,{setIsValid:i}),a&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),Object(g.jsx)(Ts,{setIsValid:r}))))},ks=({fields:e,detectorChangeHandler:t,selectedOptions:a,maxWidth:i,removeOptions:n})=>Object(g.jsx)(o.EuiFlexGroup,{style:{maxWidth:void 0!==i?i:560}},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.multiMetricView.addMetric",{defaultMessage:"Add metric"})},Object(g.jsx)(cs,{fields:e,changeHandler:t,selectedOptions:a,removeOptions:n}))));a(393);const Fs=Object(n.memo)((({fieldValues:e,splitField:t,children:a,numberOfDetectors:i,jobType:r,animate:l=!1})=>{const c=[];return Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"mlDataSplit"},(0===e.length||0===i)&&Object(g.jsx)(s.a.Fragment,null,a),e.length>0&&i>0&&null!==t&&Object(g.jsx)(n.Fragment,null,r===wt.f.MULTI_METRIC&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)("div",{style:{fontSize:"small"},"data-test-subj":`mlDataSplitTitle ${t.name}`},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.splitCards.dataSplitBy",defaultMessage:"Data split by {field}",values:{field:t.name}})),Object(g.jsx)(o.EuiSpacer,{size:"m"})),function(){c.length=0;const t=[...e];t.shift();let a=5;const i=t.map(((e,t)=>a+=10-t)).reverse();return!0===l&&setTimeout((()=>{c.forEach((e=>e.panel.style.marginBottom=`${e.marginBottom}px`))}),100),t.map(((e,a)=>{const n=(a+1)*(10/t.length*1.6)-100,s=i[a],r={height:"100px",marginBottom:"-100px",marginLeft:`${s}px`,marginRight:`${s}px`,...l?{transition:"margin 0.5s"}:{}};return Object(g.jsx)("div",{key:e,ref:e=>function(e,t){null!==e&&(!1===l&&(e.style.marginBottom=`${t}px`),c.push({panel:e,marginBottom:t}))}(e,n),style:r},Object(g.jsx)(o.EuiPanel,{paddingSize:"m",className:"mlPickFields__splitCard","data-test-subj":"mlSplitCard back"},Object(g.jsx)("div",{style:{fontWeight:"bold",fontSize:"small"},"data-test-subj":"mlSplitCardTitle"},e)))}))}(),Object(g.jsx)(o.EuiPanel,{paddingSize:"m",className:"mlPickFields__splitCard","data-test-subj":"mlSplitCard front"},Object(g.jsx)("div",{style:{fontWeight:"bold",fontSize:"small"},"data-test-subj":"mlSplitCardTitle"},e[0]),Object(g.jsx)(o.EuiHorizontalRule,{margin:"s"}),Object(g.jsx)(s.a.Fragment,null,a)))))}));function Is(){const[e,t]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{setTimeout((()=>{t(!0)}),1e3)}),[]),e}const Ds=({index:e,agg:t,field:a,byField:i,deleteDetector:n,children:s})=>{const l=!1===s&&void 0!==i?i.field:null;return Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s",justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)("span",{style:{fontSize:"small"},"data-test-subj":"mlDetectorTitle"},function(e,t,a){const i=`${e.title}(${t.name})`;return null===a?i:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.detectorTitle.placeholder",{defaultMessage:"{title} split by {field}",values:{title:i,field:a.name}})}(t,a,l))),!1!==s&&Object(g.jsx)(o.EuiFlexItem,{style:{width:"100%",maxWidth:"400px"}},s),Object(g.jsx)(o.EuiFlexItem,{grow:!1},void 0!==n&&Object(g.jsx)(o.EuiButtonIcon,{color:"danger",onClick:()=>n(e),iconType:"cross",size:"s","aria-label":"Next"})))},As=({aggFieldPairList:e,chartSettings:t,splitField:a,fieldValues:i,lineChartsData:s,modelData:r,anomalyData:l,deleteDetector:c,jobType:d,loading:u=!1})=>{const p=Is();return Object(g.jsx)(Fs,{fieldValues:i,splitField:a,numberOfDetectors:e.length,jobType:d,animate:p},Object(g.jsx)(o.EuiFlexGrid,{columns:t.cols},e.map(((a,i)=>Object(g.jsx)(o.EuiFlexItem,{key:i,"data-test-subj":`mlDetector ${i}`},Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Ds,{index:i,agg:e[i].agg,field:e[i].field,deleteDetector:c}),Object(g.jsx)(js,{chartType:gs.LINE,chartData:s[i],modelData:r[i],anomalyData:l[i],height:t.height,width:t.width,loading:u})))))))},Ls=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:i,chartLoader:s,chartInterval:o}=Object(n.useContext)(Wn),r=t,l=Object(n.useMemo)((()=>Object(vt.c)([...Hn.a.fields,...r.runtimeFields])),[]),[c,d]=Object(n.useState)([]),[u,p]=Object(n.useState)(r.aggFieldPairs),[m,b]=Object(n.useState)({}),[f,h]=Object(n.useState)(!1),[j,x]=Object(n.useState)(r.start),[v,y]=Object(n.useState)(r.end),[O,E]=Object(n.useState)(r.bucketSpanMs),[w,M]=Object(n.useState)(Wt),[S,_]=Object(n.useState)(r.splitField),[T,C]=Object(n.useState)([]),[k,F]=Object(n.useState)(!1);async function I(){if(k&&u.length>0&&(null===S||null!==S&&T.length>0)){h(!0);try{const e=Yt(r,o);M(e);const t=await s.loadLineCharts(r.start,r.end,u,r.splitField,T.length>0?T[0]:null,e.intervalMs,r.runtimeMappings,r.datafeedConfig.indices_options);b(t)}catch(e){Object(Z.a)().displayErrorToast(e),b([])}h(!1)}}return Object(n.useEffect)((()=>{F(!0)}),[]),Object(n.useEffect)((()=>{r.removeAllDetectors(),u.forEach((e=>{r.addDetector(e.agg,e.field)})),a(),I(),e(u.length>0)}),[u.length]),Object(n.useEffect)((()=>{r.start===j&&r.end===v||(x(r.start),y(r.end),I()),r.bucketSpanMs!==O&&(E(r.bucketSpanMs),I()),_(r.splitField)}),[i]),Object(n.useEffect)((()=>{null!==S?s.loadFieldExampleValues(S,r.runtimeMappings,r.datafeedConfig.indices_options).then(C).catch((e=>{Object(Z.a)().displayErrorToast(e)})):C([])}),[S]),Object(n.useEffect)((()=>{I()}),[T]),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(As,{aggFieldPairList:u,chartSettings:w,splitField:S,fieldValues:T,lineChartsData:m,modelData:[],anomalyData:[],deleteDetector:function(e){u.splice(e,1),p([...u])},jobType:r.type,loading:f}),Object(g.jsx)(ks,{fields:l,detectorChangeHandler:function(e){!function(e){if(null!==e&&e.length){const t=e[0];if(void 0!==t){const e={agg:t.agg,field:t.field};p([...u,e]),d([])}else p([])}}(e)},selectedOptions:c,removeOptions:u}))},Rs=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:i}=Object(n.useContext)(Wn),s=e,[o,r]=Object(n.useState)({}),[l,c]=Object(n.useState)(!1),[d,u]=Object(n.useState)([]),[p,m]=Object(n.useState)([]),[b,f]=Object(n.useState)(Wt),[h,j]=Object(n.useState)([]);function x(e){u(e.model),m(e.anomalies)}function v(){return s.aggFieldPairs.length>0&&(null===s.splitField||null!==s.splitField&&h.length>0)}return Object(n.useEffect)((()=>{const e=a.subscribeToResults(x);return(async()=>{if(null!==s.splitField)try{const e=await t.loadFieldExampleValues(s.splitField,s.runtimeMappings,s.datafeedConfig.indices_options);j(e)}catch(e){Object(Z.a)().displayErrorToast(e)}})(),()=>{e.unsubscribe()}}),[t,a,s]),Object(n.useEffect)((()=>{v()&&async function(){if(v()){c(!0);try{const e=Yt(s,i);f(e);const a=await t.loadLineCharts(s.start,s.end,s.aggFieldPairs,s.splitField,h.length>0?h[0]:null,e.intervalMs,s.runtimeMappings,s.datafeedConfig.indices_options);r(a)}catch(e){Object(Z.a)().displayErrorToast(e),r({})}c(!1)}}()}),[h]),Object(g.jsx)(n.Fragment,null,Object.keys(o).length&&Object(g.jsx)(As,{aggFieldPairList:s.aggFieldPairs,chartSettings:b,splitField:s.splitField,fieldValues:h,lineChartsData:o,modelData:d,anomalyData:p,deleteDetector:void 0,jobType:s.type,loading:l}))},Ns=({fields:e,changeHandler:t,selectedField:a,isClearable:i,testSubject:n,placeholder:s})=>{const r=e.map((e=>({label:e.name,field:e}))),l=[];return null!==a&&l.push({label:a.name,field:a}),Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:r,selectedOptions:l,onChange:function(e){const a=e[0];t(void 0!==a?a.field:null)},isClearable:i,placeholder:s,"data-test-subj":n})},Ps=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.splitField.title",{defaultMessage:"Split field"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.splitField.description",defaultMessage:"Select a field to split analysis by. Each value of this field will be modeled independently."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),zs=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=e,s=Object(n.useMemo)((()=>Object(vt.b)(i.runtimeFields)),[]),o=function(e,t,a){const[i,s]=Object(n.useState)(e);return Object(n.useEffect)((()=>{if(zt(t))s(e);else{const a=t.rareField,i=t.populationField;s(null!==a||null!==i?e.filter((({name:e})=>e!==(null==a?void 0:a.name)&&e!==(null==i?void 0:i.name))):e)}}),[a]),i}(Object(n.useMemo)((()=>[...Hn.a.categoryFields,...s].sort(((e,t)=>e.name.localeCompare(t.name)))),[]),i,a),[r,l]=Object(n.useState)(i.splitField);return Object(n.useEffect)((()=>{i.setSplitField(r),null!==r&&!1===i.influencers.includes(r.name)&&i.addInfluencer(r.name),t()}),[r]),Object(n.useEffect)((()=>{l(i.splitField)}),[a]),Object(g.jsx)(Ps,null,Object(g.jsx)(Ns,{fields:o,changeHandler:l,selectedField:r,isClearable:!0,testSubject:"mlMultiMetricSplitFieldSelect"}))},Bs=({fields:e,changeHandler:t,selectedInfluencers:a})=>{const{jobCreator:i}=Object(n.useContext)(Wn),s=[...Object(Mt.g)(e,i.additionalFields),...Object(Mt.h)(i.categorizationFieldName)],r=a.map((e=>({label:e})));return Object(g.jsx)(o.EuiComboBox,{options:s,selectedOptions:r,onChange:function(e){t(e.map((e=>e.label)))},isClearable:!1,"data-test-subj":"mlInfluencerSelect"})},Vs=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.influencers.title",{defaultMessage:"Influencers"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.influencers.description",defaultMessage:"Select which categorical fields have influence on the results. Who/what might you 'blame' for an anomaly? Recommend 1-3 influencers."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),Js=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=e,{fields:s}=Hn.a,[o,r]=Object(n.useState)([...i.influencers]);return Object(n.useEffect)((()=>{i.removeAllInfluencers(),o.forEach((e=>i.addInfluencer(e))),t()}),[o.join()]),Object(n.useEffect)((()=>{r([...i.influencers])}),[a]),Object(g.jsx)(Vs,null,Object(g.jsx)(Bs,{fields:s,changeHandler:r,selectedInfluencers:o}))},Us=({setIsValid:e})=>Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zs,null)),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Js,null))),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Ms,{setIsValid:e})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(_s,null)))),Gs=({isActive:e,setCanProceed:t})=>{const[a,i]=Object(n.useState)(!1),[s,r]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{"function"==typeof t&&t(a&&s)}),[a,s]),Object(g.jsx)(n.Fragment,null,!1===e?Object(g.jsx)(Rs,null):Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Ls,{setIsValid:i}),a&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),Object(g.jsx)(Us,{setIsValid:r}))))},qs=({fields:e,detectorChangeHandler:t,selectedOptions:a,maxWidth:i,removeOptions:n})=>Object(g.jsx)(o.EuiFlexGroup,{style:{maxWidth:void 0!==i?i:560}},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.populationView.addMetric",{defaultMessage:"Add metric"})},Object(g.jsx)(cs,{fields:e,changeHandler:t,selectedOptions:a,removeOptions:n})))),$s=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.populationField.title",{defaultMessage:"Population field"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.populationField.description",defaultMessage:"All values in the selected field will be modeled together as a population. This analysis type is recommended for high cardinality data."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),Ws=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=e,s=Object(n.useMemo)((()=>Object(vt.b)(i.runtimeFields)),[]),o=function(e,t,a){const[i,s]=Object(n.useState)(e);return Object(n.useEffect)((()=>{if(Bt(t))s(e);else{const a=t.rareField,i=t.splitField;s(null!==a||null!==i?e.filter((({name:e})=>e!==(null==a?void 0:a.name)&&e!==(null==i?void 0:i.name))):e)}}),[a]),i}(Object(n.useMemo)((()=>[...Hn.a.categoryFields,...s].sort(((e,t)=>e.name.localeCompare(t.name)))),[]),i,a),[r,l]=Object(n.useState)(i.populationField);return Object(n.useEffect)((()=>{i.setPopulationField(r),null!==r&&!1===i.influencers.includes(r.name)&&i.addInfluencer(r.name),t()}),[r]),Object(n.useEffect)((()=>{l(i.populationField)}),[a]),Object(g.jsx)($s,null,Object(g.jsx)(Ns,{fields:o,changeHandler:l,selectedField:r,isClearable:!1,testSubject:"mlPopulationSplitFieldSelect"}))},Hs=({detectorIndex:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:i}=Object(n.useContext)(Wn),s=t,o=Object(n.useMemo)((()=>Object(vt.b)(s.runtimeFields)),[]),l=Object(n.useMemo)((()=>[...Hn.a.categoryFields,...o].sort(((e,t)=>e.name.localeCompare(t.name)))),[]),[c,d]=Object(n.useState)(s.getByField(e)),u=function(e,t,a){const[i,s]=Object(n.useState)(e);return Object(n.useEffect)((()=>{const a=t.populationField;s(null!==a?e.filter((({name:e})=>e!==a.name)):e)}),[a]),i}(l,s,i);return Object(n.useEffect)((()=>{s.setByField(c,e),null!==c&&!1===s.influencers.includes(c.name)&&s.addInfluencer(c.name),a()}),[c]),Object(n.useEffect)((()=>{const t=s.getByField(e);d(t)}),[i]),Object(g.jsx)(Ns,{fields:u,changeHandler:d,selectedField:c,isClearable:!0,testSubject:"mlByFieldSelect",placeholder:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.populationField.placeholder",{defaultMessage:"Split data"})})},Ys=({aggFieldPairList:e,chartSettings:t,splitField:a,lineChartsData:i,modelData:s,anomalyData:r,deleteDetector:l,jobType:c,fieldValuesPerDetector:d,loading:u=!1})=>{const p=Is();return Object(g.jsx)(o.EuiFlexGrid,{columns:t.cols},e.map(((m,b)=>Object(g.jsx)(o.EuiFlexItem,{key:b,"data-test-subj":`mlDetector ${b}`},Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Ds,{index:b,agg:e[b].agg,field:e[b].field,byField:e[b].by,deleteDetector:l},void 0!==l&&Object(g.jsx)(Hs,{detectorIndex:b})),c===wt.f.POPULATION&&Object(g.jsx)(o.EuiSpacer,{size:"s"}))),Object(g.jsx)(Fs,{fieldValues:d[b]||[],splitField:a,numberOfDetectors:e.length,jobType:c,animate:p},Object(g.jsx)(js,{chartType:gs.SCATTER,chartData:i[b],modelData:s[b],anomalyData:r[b],height:t.height,width:t.width,loading:u})))))))},Xs=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:i,chartLoader:s,chartInterval:r}=Object(n.useContext)(Wn),l=t,c=Object(n.useMemo)((()=>Object(vt.c)([...Hn.a.fields,...l.runtimeFields])),[]),[d,u]=Object(n.useState)([]),[p,m]=Object(n.useState)(l.aggFieldPairs),[b,f]=Object(n.useState)({}),[h,j]=Object(n.useState)(!1),[x,v]=Object(n.useState)(l.start),[y,O]=Object(n.useState)(l.end),[E,w]=Object(n.useState)(l.bucketSpanMs),[M,S]=Object(n.useState)(Wt),[_,T]=Object(n.useState)(l.populationField),[C,k]=Object(n.useState)({}),[F,I]=Object(n.useReducer)((e=>e+1),0),[D,A]=Object(n.useState)(!1),L=()=>I(0);async function R(){if(function(){let e=p.length>0;return p.forEach((t=>{void 0!==t.by&&null!==t.by.field&&(e=e&&null!==t.by.value)})),e}()){j(!0);try{const e=Yt(l,r);S(e);const t=await s.loadPopulationCharts(l.start,l.end,p,l.populationField,e.intervalMs,l.runtimeMappings,l.datafeedConfig.indices_options);f(t)}catch(e){Object(Z.a)().displayErrorToast(e),f([])}j(!1)}}return Object(n.useEffect)((()=>{A(!0)}),[]),Object(n.useEffect)((()=>{l.removeAllDetectors(),p.forEach(((e,t)=>{l.addDetector(e.agg,e.field),void 0!==e.by&&l.setByField(e.by.field,t)})),a(),R(),e(p.length>0)}),[p.length]),Object(n.useEffect)((()=>{R()}),[JSON.stringify(C),_,D]),Object(n.useEffect)((()=>{l.start===x&&l.end===y||(v(l.start),O(l.end),R()),l.bucketSpanMs!==E&&(w(l.bucketSpanMs),R()),T(l.populationField);let e=!1;const t=[...p];t.forEach(((t,a)=>{const i=l.getByField(a);void 0!==t.by&&t.by.field!==i&&(t.by.field=i,e=!0)})),e&&(m(t),L())}),[i]),Object(n.useEffect)((()=>{!async function(){const e=[];p.forEach(((t,a)=>{void 0!==t.by&&null!==t.by.field&&e.push((async(e,t)=>({index:e,fields:await s.loadFieldExampleValues(t,l.runtimeMappings,l.datafeedConfig.indices_options)}))(a,t.by.field))}));const t=(await Promise.all(e)).reduce(((e,t)=>(e[t.index]=t.fields,e)),{}),a=p.map(((e,a)=>({...e,...void 0===e.by||null===e.by.field?{}:{by:{...e.by,value:t[a][0]}}})));m([...a]),k(t)}()}),[_,F]),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Ws,null),null!==_&&Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),null!==_&&Object(g.jsx)(Ys,{aggFieldPairList:p,chartSettings:M,splitField:_,lineChartsData:b,modelData:[],anomalyData:[],deleteDetector:function(e){p.splice(e,1),m([...p]),L()},jobType:l.type,fieldValuesPerDetector:C,loading:h}),null!==_&&Object(g.jsx)(qs,{fields:c,detectorChangeHandler:function(e){!function(e){if(null!==e&&e.length){const t=e[0];if(void 0!==t){const e={agg:t.agg,field:t.field,by:{field:null,value:null}};m([...p,e]),u([])}else m([])}}(e)},selectedOptions:d,removeOptions:[]}))},Qs=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:i}=Object(n.useContext)(Wn),s=e,[r,l]=Object(n.useState)(s.aggFieldPairs),[c,d]=Object(n.useState)({}),[u,p]=Object(n.useState)(!1),[b,f]=Object(n.useState)([]),[h,j]=Object(n.useState)([]),[x,v]=Object(n.useState)(Wt),[y,O]=Object(n.useState)({});function E(e){f(e.model),j(e.anomalies)}function w(){let e=r.length>0;return r.forEach((t=>{void 0!==t.by&&null!==t.by.field&&(e=e&&null!==t.by.value)})),e}return Object(n.useEffect)((()=>{const e=a.subscribeToResults(E);return()=>{e.unsubscribe()}}),[]),Object(n.useEffect)((()=>{w()&&async function(){if(w()){p(!0);try{const e=Yt(s,i);v(e);const a=await t.loadPopulationCharts(s.start,s.end,r,s.populationField,e.intervalMs,s.runtimeMappings,s.datafeedConfig.indices_options);d(a)}catch(e){Object(Z.a)().displayErrorToast(e),d({})}p(!1)}}()}),[JSON.stringify(y),s.populationField]),Object(n.useEffect)((()=>{!async function(){const e=[];r.forEach(((a,i)=>{void 0!==a.by&&null!==a.by.field&&e.push((async(e,a)=>({index:e,fields:await t.loadFieldExampleValues(a,s.runtimeMappings,s.datafeedConfig.indices_options)}))(i,a.by.field))}));const a=(await Promise.all(e)).reduce(((e,t)=>(e[t.index]=t.fields,e)),{}),i=r.map(((e,t)=>({...e,...void 0===e.by||null===e.by.field?{}:{by:{...e.by,value:a[t][0]}}})));l([...i]),O(a)}()}),[s.populationField]),Object(g.jsx)(n.Fragment,null,null!==s.populationField&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.populationView.splitFieldTitle",defaultMessage:"Population split by {field}",values:{field:s.populationField.name}}),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(Ys,{aggFieldPairList:s.aggFieldPairs,chartSettings:x,splitField:s.populationField,lineChartsData:c,modelData:b,anomalyData:h,jobType:s.type,fieldValuesPerDetector:y,loading:u})))},Ks=({setIsValid:e})=>Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Ms,{setIsValid:e})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Js,null)))),Zs=({isActive:e,setCanProceed:t})=>{const[a,i]=Object(n.useState)(!1),[s,r]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{"function"==typeof t&&t(a&&s)}),[a,s]),Object(g.jsx)(n.Fragment,null,!1===e?Object(g.jsx)(Qs,null):Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Xs,{setIsValid:i}),a&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),Object(g.jsx)(Ks,{setIsValid:r}))))},eo=({onCreateClick:e,closeModal:t,saveEnabled:a,children:i})=>Object(g.jsx)(o.EuiModal,{onClose:t,maxWidth:1200,"data-test-subj":"mlCreateDetectorModal"},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.title",defaultMessage:"Create detector"}))),Object(g.jsx)(o.EuiModalBody,null,i),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:t,"data-test-subj":"mlCreateDetectorModalCancelButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.cancelButton",defaultMessage:"Cancel"})),Object(g.jsx)(o.EuiButton,{onClick:e,isDisabled:!1===a,fill:!0,"data-test-subj":"mlCreateDetectorModalSaveButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.saveButton",defaultMessage:"Save"})))),to=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.aggSelect.title",{defaultMessage:"Function"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.aggSelect.description",defaultMessage:"Analysis functions to be performed e.g. sum, count."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),ao=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.fieldSelect.title",{defaultMessage:"Field"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.fieldSelect.description",defaultMessage:"Required for functions: sum, mean, median, max, min, info_content, distinct_count, lat_long."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),io=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.byFieldSelect.title",{defaultMessage:"By field"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.byFieldSelect.description",defaultMessage:"Required for individual analysis where anomalies are detected compared to an entity's own past behavior."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),no=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.overFieldSelect.title",{defaultMessage:"Over field"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.overFieldSelect.description",defaultMessage:"Required for population analysis where anomalies are detected compared to the behavior of the population."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),so=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.partitionFieldSelect.title",{defaultMessage:"Partition field"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.partitionFieldSelect.description",defaultMessage:"Allows segmentation of modeling into logical groups."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),oo=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.excludeFrequent.title",{defaultMessage:"Exclude frequent"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.excludeFrequent.description",defaultMessage:"If set, it will automatically identify and exclude frequently occurring entities which may otherwise have dominated results."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),ro=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.description.title",{defaultMessage:"Description"});return Object(g.jsx)(o.EuiDescribedFormGroup,{fullWidth:!0,title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.description.description",defaultMessage:"Override the default detector description with a meaningful description of what the detector is analyzing."})},Object(g.jsx)(o.EuiFormRow,{label:t,fullWidth:!0},Object(g.jsx)(s.a.Fragment,null,e)))})),lo={label:""},co=[{label:"all"},{label:"none"},{label:"by"},{label:"over"}],uo=({payload:e,fields:t,aggs:a,detectorChangeHandler:i,closeModal:s})=>{const{jobCreator:r}=Object(n.useContext)(Wn),l=r,[c,d]=Object(n.useState)(e.detector),[u,p]=Object(n.useState)(po(c.agg)),[m,b]=Object(n.useState)(mo(c.field)),[f,h]=Object(n.useState)(mo(c.byField)),[j,x]=Object(n.useState)(mo(c.overField)),[v,y]=Object(n.useState)(mo(c.partitionField)),[O,E]=Object(n.useState)(null===(U=c.excludeFrequent)?lo:{label:U}),[w,M]=Object(n.useState)(c.description||""),[S,_]=Object(n.useState)(!0),[T,C]=Object(n.useState)(!0),[k,F]=Object(n.useState)(!0),{descriptionPlaceholder:I,setDescriptionPlaceholder:D}=function(e){const[t,a]=Object(n.useState)(ho(e));return{descriptionPlaceholder:t,setDescriptionPlaceholder:function(e){a(ho(e))}}}(c),[A,L]=Object(n.useState)([]),R=l.additionalFields.length>0,N=a.filter((e=>function(e,t){return void 0!==e.fields&&(t||e.fields.length)}(e,R))).map(po),{currentFieldOptions:P,setCurrentFieldOptions:z}=function(e,t,a){const[i,s]=Object(n.useState)(fo(e,t));return{currentFieldOptions:i.filter((({label:e})=>!1===a.includes(e))),setCurrentFieldOptions:e=>s(fo(e,t))}}(c.agg,Object(vt.b)(l.additionalFields,!1),A),B=[...[...Object(Mt.g)(t,l.additionalFields)].sort(jo),...Object(Mt.h)(l.categorizationFieldName)].sort(jo).filter((({label:e})=>!1===A.includes(e))),V=t.find((e=>e.id===Dt.a)),J=e=>t=>{e(t[0]||lo)};var U;function G(e){return a.find((t=>t.id===e))||null}function q(e){return e===Dt.c.id?Dt.c:t.find((t=>t.id===e))||l.additionalFields.find((t=>t.id===e))||null}return Object(n.useEffect)((()=>{const e=G(u.label);let t=q(m.label);const a=q(f.label),i=q(j.label),n=q(v.label);null!==e?(z(e),bo(e)&&void 0!==V?(_(!0),b(lo),F(!1),t=V):(_(null!==t),F(!0)),C(null!==a||null!==i)):(_(!1),F(!1)),L([...t?[t.name]:[],...a?[a.name]:[],...i?[i.name]:[],...n?[n.name]:[]]);const s={agg:e,field:t,byField:a,overField:i,partitionField:n,excludeFrequent:""!==O.label?O.label:null,description:""!==w?w:null,customRules:null,useNull:null};d(s),D(s)}),[u,m,f,j,v,O,w]),Object(n.useEffect)((()=>{const e=G(u.label);if(_(""!==u.label),null!==e){F(!1===bo(e));const t=q(f.label),a=q(j.label);C(null!==t||null!==a)}}),[]),Object(n.useEffect)((()=>{!1===T&&E(lo)}),[T]),Object(g.jsx)(eo,{onCreateClick:function(){i(c,e.index)},closeModal:s,saveEnabled:S&&(!1===k||!0===k&&""!==m.label)},Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"mlAdvancedFunctionSelect"},Object(g.jsx)(to,null,Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:N,selectedOptions:go(u),onChange:J(p),isClearable:!0}))),Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"mlAdvancedFieldSelect"},Object(g.jsx)(ao,null,Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:P,selectedOptions:go(m),onChange:J(b),isClearable:!0,isDisabled:!1===k})))),Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),Object(g.jsx)(o.EuiFlexGrid,{columns:2},Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"mlAdvancedByFieldSelect"},Object(g.jsx)(io,null,Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:B,selectedOptions:go(f),onChange:J(h),isClearable:!0,isDisabled:!1===S}))),Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"mlAdvancedOverFieldSelect"},Object(g.jsx)(no,null,Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:B,selectedOptions:go(j),onChange:J(x),isClearable:!0,isDisabled:!1===S}))),Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"mlAdvancedPartitionFieldSelect"},Object(g.jsx)(so,null,Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:B,selectedOptions:go(v),onChange:J(y),isClearable:!0,isDisabled:!1===S}))),Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"mlAdvancedExcludeFrequentSelect"},Object(g.jsx)(oo,null,Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:co,selectedOptions:go(O),onChange:J(E),isClearable:!0,isDisabled:!1===S||!1===T})))),Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(ro,null,Object(g.jsx)(o.EuiTextArea,{rows:2,fullWidth:!0,placeholder:I,value:w,onChange:e=>M(e.target.value),"data-test-subj":"mlAdvancedDetectorDescriptionInput"}))))))};function po(e){return null===e?lo:{label:e.id}}function mo(e){return null===e?lo:{label:e.name}}function bo(e){return e.fields&&1===e.fields.length&&e.fields[0].id===Dt.a}function fo(e,t){return Object(Mt.g)(null!==e&&void 0!==e.fields?e.fields:[],t)}function ho(e){if(null===e.agg||null===e.field)return"";const t=Object(Ot.a)(e.agg,e.field);return t.by_field_name=e.byField?e.byField.id:void 0,t.over_field_name=e.overField?e.overField.id:void 0,t.partition_field_name=e.partitionField?e.partitionField.id:void 0,t.exclude_frequent=e.excludeFrequent?e.excludeFrequent:void 0,Object(te.b)(t)}function go(e){return void 0===e||""===e.label?[]:[e]}function jo(e,t){return e.label.localeCompare(t.label)}const xo=({payload:e,fields:t,aggs:a,detectorChangeHandler:i,closeModal:s,showModal:r})=>Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{style:{maxWidth:560}},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,null,Object(g.jsx)(o.EuiButton,{onClick:r,"data-test-subj":"mlAddDetectorButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.addDetectorButton",defaultMessage:"Add detector"}))))),null!==e&&Object(g.jsx)(uo,{payload:e,fields:t,aggs:a,detectorChangeHandler:i,closeModal:s})),vo=({isActive:e,onEditJob:t,onDeleteJob:a})=>{const{jobCreator:i,jobCreatorUpdated:s,jobValidator:l,jobValidatorUpdated:c}=Object(n.useContext)(Wn),d=i,[u,p]=Object(n.useState)(d.detectors),[b,f]=Object(n.useState)(l.duplicateDetectors);Object(n.useEffect)((()=>{p(d.detectors)}),[s]),Object(n.useEffect)((()=>{l.duplicateDetectors.valid||f(l.duplicateDetectors),l.categorizerVaryingPerPartitionField.valid||f(l.categorizerVaryingPerPartitionField),l.categorizerMissingPerPartition.valid||f(l.categorizerMissingPerPartition)}),[c]);const h=({index:e})=>Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiButtonIcon,{color:"primary",onClick:()=>t(e),iconType:"pencil","aria-label":r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorList.editButton",{defaultMessage:"Edit"}),"data-test-subj":"mlAdvancedDetectorEditButton"})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiButtonIcon,{color:"danger",onClick:()=>a(e),iconType:"trash","aria-label":r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorList.deleteButton",{defaultMessage:"Delete"}),"data-test-subj":"mlAdvancedDetectorDeleteButton"})));return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorList.title",defaultMessage:"Detectors"}))),Object(g.jsx)(yo,{show:0===u.length}),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGrid,{columns:3},u.map(((t,a)=>Object(g.jsx)(o.EuiFlexItem,{key:a,"data-test-subj":`mlAdvancedDetector ${a}`},Object(g.jsx)(o.EuiPanel,{paddingSize:"m"},Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,void 0!==t.detector_description?Object(g.jsx)("div",{style:{fontWeight:"bold"},"data-test-subj":"mlDetectorDescription"},t.detector_description):Object(g.jsx)(Eo,{detector:t})),e&&Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{margin:"8px"}},Object(g.jsx)(h,{index:a}))),void 0!==t.detector_description&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,{margin:"s"}),Object(g.jsx)(Eo,{detector:t}))))))),Object(g.jsx)(Oo,{validation:b}))},yo=({show:e})=>!1===e?null:Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.noDetectorsCallout.title",{defaultMessage:"No detectors"}),iconType:"alert","data-test-subj":"mlAdvancedNoDetectorsMessage"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.noDetectorsCallout.message",defaultMessage:"At least one detector is needed to create a job."})),Object(g.jsx)(o.EuiSpacer,{size:"s"})),Oo=({validation:e})=>!0===e.valid?null:Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFormRow,{error:e.message,isInvalid:!1===e.valid},Object(g.jsx)(n.Fragment,null)),Object(g.jsx)(o.EuiSpacer,{size:"s"})),Eo=({detector:e})=>Object(g.jsx)("div",{"data-test-subj":"mlDetectorIdentifier"},Object(te.b)(e)),wo={agg:null,field:null,byField:null,overField:null,partitionField:null,excludeFrequent:null,description:null,customRules:null,useNull:null},Mo=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:i}=Object(n.useContext)(Wn),s=t,{fields:o,aggs:r}=Hn.a,[l,c]=Object(n.useState)(null);return Object(n.useEffect)((()=>{e(s.detectors.length>0)}),[i]),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(vo,{isActive:!0,onEditJob:function(e){const t=s.richDetectors[e];void 0!==t&&c({detector:t,index:e})},onDeleteJob:function(e){s.removeDetector(e),a()}}),Object(g.jsx)(xo,{payload:l,fields:o,aggs:r,detectorChangeHandler:function(e,t){void 0===t?s.addDetector(e.agg,e.field,e.byField,e.overField,e.partitionField,e.excludeFrequent,e.description,e.useNull):s.editDetector(e.agg,e.field,e.byField,e.overField,e.partitionField,e.excludeFrequent,e.description,t,e.useNull),a(),c(null)},showModal:function(){c({detector:wo})},closeModal:function(){c(null)}}))},So=()=>Object(g.jsx)(vo,{isActive:!1,onEditJob:()=>{},onDeleteJob:()=>{}}),_o=Object(n.memo)((({children:e,validation:t})=>{const a=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.modelMemoryLimit.title",{defaultMessage:"Model memory limit"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,a),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.modelMemoryLimit.description",defaultMessage:"Set an approximate upper limit for the amount of memory that can be used by the analytical models."})},Object(g.jsx)(o.EuiFormRow,{label:a,error:t.message,isInvalid:!1===t.valid},Object(g.jsx)(s.a.Fragment,null,e)))})),To=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a,jobValidator:i,jobValidatorUpdated:s}=Object(n.useContext)(Wn),[r,l]=Object(n.useState)(i.modelMemoryLimit),[c,d]=Object(n.useState)(null===e.modelMemoryLimit?"":e.modelMemoryLimit),{anomaly_detectors:u}=Object(A.c)(),{model_memory_limit:p}=u;return Object(n.useEffect)((()=>{e.modelMemoryLimit=""===c?null:c,t()}),[c]),Object(n.useEffect)((()=>{d(null===e.modelMemoryLimit?"":e.modelMemoryLimit)}),[a]),Object(n.useEffect)((()=>{l(i.modelMemoryLimit)}),[s]),Object(g.jsx)(_o,{validation:r},Object(g.jsx)(o.EuiFieldText,{value:c,placeholder:p,onChange:e=>d(e.target.value),isInvalid:!1===r.valid,"data-test-subj":"mlJobWizardInputModelMemoryLimit"}))},Co=({setIsValid:e})=>Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Ms,{setIsValid:e})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Js,null))),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(To,null)),Object(g.jsx)(o.EuiFlexItem,null))),ko=({fields:e,changeHandler:t,selectedField:a})=>{const{jobCreator:i}=Object(n.useContext)(Wn),s=[...Object(Mt.f)(i.aggregationFields.length>0),...Object(Mt.g)(e,i.additionalFields)],r=[];return null!==a&&r.push({label:a}),Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:s,selectedOptions:r,onChange:function(e){const a=e[0];t(void 0!==a?a.label:null)},isClearable:!0,"data-test-subj":"mlSummaryCountFieldNameSelect"})},Fo=Object(n.memo)((({children:e,validation:t})=>{const a=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.summaryCountField.title",{defaultMessage:"Summary count field"}),{services:{docLinks:i}}=Object(y.b)(),n=i.links.ml.aggregations;return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,a),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.summaryCountField.description",defaultMessage:"If the input data is {aggregated}, specify the field that contains the document count.",values:{aggregated:Object(g.jsx)(o.EuiLink,{href:n,target:"_blank"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.summaryCountField.aggregatedText",defaultMessage:"aggregated"}))}})},Object(g.jsx)(o.EuiFormRow,{label:a,error:t.message,isInvalid:!1===t.valid},Object(g.jsx)(s.a.Fragment,null,e)))})),Io=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a,jobValidator:i,jobValidatorUpdated:s}=Object(n.useContext)(Wn),o=e,{fields:r}=Hn.a,[l,c]=Object(n.useState)(o.summaryCountFieldName),[d,u]=Object(n.useState)(i.summaryCountField);return Object(n.useEffect)((()=>{u(i.summaryCountField)}),[s]),Object(n.useEffect)((()=>{o.summaryCountFieldName=l,t()}),[l]),Object(n.useEffect)((()=>{c(o.summaryCountFieldName)}),[a]),Object(g.jsx)(Fo,{validation:d},Object(g.jsx)(ko,{fields:r,changeHandler:c,selectedField:l}))},Do=({fields:e,changeHandler:t,selectedField:a})=>{const{jobCreator:i,jobCreatorUpdated:s}=Object(n.useContext)(Wn),r=Object(n.useMemo)((()=>[...Object(Mt.g)(e,i.additionalFields)]),[e,s]),l=Object(n.useMemo)((()=>{const e=[];return null!==a&&e.push({label:a}),e}),[a]),c=Object(n.useCallback)((e=>{var a;return t(null!==(a=e[0]&&e[0].label)&&void 0!==a?a:null)}),[t]);return Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:r,selectedOptions:l,onChange:c,isClearable:!0,"data-test-subj":"mlCategorizationFieldNameSelect"})},Ao=Object(n.memo)((({children:e,isOptional:t})=>{const a=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationField.title",{defaultMessage:"Categorization field"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,a),description:Object(g.jsx)(s.a.Fragment,null,t?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldOptional.description",defaultMessage:"Optional, for use if analyzing unstructured log data. Using text data types is recommended."}):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationField.description",defaultMessage:"Specifies which field will be categorized. Using text data types is recommended. Categorization works best on machine written log messages, typically logging written by a developer for the purpose of system troubleshooting."}))},Object(g.jsx)(o.EuiFormRow,{label:a},Object(g.jsx)(s.a.Fragment,null,e)))})),Lo=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=e,{catFields:s}=Hn.a,[o,r]=Object(n.useState)(i.categorizationFieldName),l=Jt(i);return Object(n.useEffect)((()=>{i.categorizationFieldName!==o&&(i.categorizationFieldName=o,t())}),[o]),Object(n.useEffect)((()=>{r(i.categorizationFieldName)}),[a]),Object(g.jsx)(Ao,{isOptional:!1===l},Object(g.jsx)(Do,{fields:s,changeHandler:r,selectedField:o}))},Ro=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.perPartitionCategorization.enable.title",{defaultMessage:"Enable per-partition categorization"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.perPartitionCategorization.enable.description",defaultMessage:"If per-partition categorization is enabled then categories are determined independently for each value of the partition field."})},Object(g.jsx)(s.a.Fragment,null,e))})),No=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=e,[s,r]=Object(n.useState)(i.perPartitionCategorization),l=Object(n.useCallback)((()=>r(!s)),[s]);return Object(n.useEffect)((()=>{r(i.perPartitionCategorization)}),[a]),Object(n.useEffect)((()=>{!1===s&&(i.perPartitionStopOnWarn=!1),i.perPartitionCategorization=s,t()}),[s]),Object(g.jsx)(o.EuiSwitch,{name:"categorizationPerPartitionSwitch",disabled:!1,checked:s,onChange:l,"data-test-subj":"mlJobWizardSwitchCategorizationPerPartition",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.perPartitionCategorizationSwitchLabel",defaultMessage:"Enable per-partition categorization"})})},Po=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=e,[s,r]=Object(n.useState)(i.perPartitionStopOnWarn),l=Object(n.useCallback)((()=>r(!s)),[s]);return Object(n.useEffect)((()=>{i.perPartitionStopOnWarn=s,t()}),[s]),Object(n.useEffect)((()=>{r(i.perPartitionStopOnWarn)}),[a]),Object(g.jsx)(o.EuiSwitch,{name:"categorizationPerPartitionStopOnWarnSwitch",disabled:!1,checked:s,onChange:l,"data-test-subj":"mlJobWizardSwitchCategorizationPerPartitionStopOnWarn",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.perPartitionCategorizationtopOnWarnSwitchLabel",defaultMessage:"Stop on warn"})})},zo=({fields:e,changeHandler:t,selectedField:a})=>{const{jobCreator:i,jobCreatorUpdated:s}=Object(n.useContext)(Wn),r=Object(n.useMemo)((()=>[...Object(Mt.g)(e,i.additionalFields)]),[e,s]),l=Object(n.useMemo)((()=>{const e=[];return null!==a&&e.push({label:a}),e}),[a]),c=Object(n.useCallback)((e=>{var a;return t(null!==(a=e[0]&&e[0].label)&&void 0!==a?a:null)}),[t]);return Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:r,selectedOptions:l,onChange:c,isClearable:!0,"data-test-subj":"mlJobWizardCategorizationPerPartitionFieldNameSelect"})},Bo=({setEnablePerPartitionCategorization:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:i}=Object(n.useContext)(Wn),s=t,[r,l]=Object(n.useState)(s.categorizationPerPartitionField),{categoryFields:c}=Hn.a,d=Object(n.useMemo)((()=>c.filter((e=>e.id!==s.categorizationFieldName))),[c,i]);return Object(n.useEffect)((()=>{s.categorizationPerPartitionField=r,a()}),[r]),Object(n.useEffect)((()=>{s.perPartitionCategorization&&null===s.categorizationPerPartitionField&&d.length>0&&(s.categorizationPerPartitionField=d[0].id),l(s.categorizationPerPartitionField),e(s.perPartitionCategorization)}),[i]),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.extraStep.categorizationJob.categorizationPerPartitionFieldLabel",defaultMessage:"Partition field"})},Object(g.jsx)(zo,{fields:d,changeHandler:l,selectedField:r||""}))},Vo=()=>{const{jobCreator:e,jobCreatorUpdated:t}=Object(n.useContext)(Wn),a=e,[i,r]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{r(a.perPartitionCategorization)}),[t]),Object(g.jsx)(Ro,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.extraStep.categorizationJob.perPartitionCategorizationLabel",defaultMessage:"Enable per-partition categorization"})},Object(g.jsx)(No,null)),i&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.extraStep.categorizationJob.stopOnWarnLabel",defaultMessage:"Stop on warn"})},Object(g.jsx)(Po,null))),Jt(a)&&i&&Object(g.jsx)(Bo,{setEnablePerPartitionCategorization:r}))},Jo=()=>{const{jobCreator:e}=Object(n.useContext)(Wn),t=Vt(e)&&null!==e.categorizationFieldName;return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Lo,null)),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Io,null))),t&&Object(g.jsx)(Vo,null))},Uo=({isActive:e,setCanProceed:t})=>{const[a,i]=Object(n.useState)(!1),[s,r]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{"function"==typeof t&&t(a&&s)}),[a,s]),Object(g.jsx)(n.Fragment,null,!1===e?Object(g.jsx)(So,null):Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Jo,null),Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),Object(g.jsx)(Mo,{setIsValid:i}),Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),Object(g.jsx)(Co,{setIsValid:r})))},Go=({onClick:e,isSelected:t})=>Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorCountCard"+(t?" selected":""),title:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.countCard.title",{defaultMessage:"Count"}),description:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.countCard.description",defaultMessage:"Look for anomalies in the event rate of a particular category."})),selectable:{onClick:e,isSelected:t}})),qo=({onClick:e,isSelected:t})=>Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorRareCard"+(t?" selected":""),title:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.rareCard.title",{defaultMessage:"Rare"}),description:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.rareCard.description",defaultMessage:"Look for categories that occur rarely in time."})),selectable:{onClick:e,isSelected:t}})),$o=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=e,[r,l]=Object(n.useState)(i.selectedDetectorType);return Object(n.useEffect)((()=>{r!==i.selectedDetectorType&&(i.setDetectorType(r),t())}),[r]),Object(n.useEffect)((()=>{l(i.selectedDetectorType)}),[a]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.title",defaultMessage:"Categorization detector"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"l",style:{maxWidth:"824px"}},Object(g.jsx)(Go,{onClick:function(){l(xt.b.COUNT)},isSelected:r===xt.b.COUNT}),Object(g.jsx)(qo,{onClick:function(){l(xt.b.RARE)},isSelected:r===xt.b.RARE})))},Wo=({fieldExamples:e})=>{if(null===e||0===e.length)return null;const t=[{field:"example",name:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldExamples.title",{defaultMessage:"Examples"}),render:e=>Object(g.jsx)(o.EuiCodeBlock,{fontSize:"s",paddingSize:"none",transparentBackground:!0,style:{maxHeight:"200px"}},e)}],a=e.map(((e,t)=>{const a=[];let i=0,n="",s=0;for(;s<e.text.length;){const o=e.tokens[i];o&&s===o.start_offset?(a.push(n),n="",a.push(Object(g.jsx)(Ho,{key:`${t}${s}`},o.token)),s+=o.end_offset-o.start_offset,i++):(n+=e.text[s],s++)}return a.push(n),{example:a}}));return Object(g.jsx)(o.EuiBasicTable,{columns:t,items:a,"data-test-subj":"mlJobWizardCategorizationExamplesTable"})},Ho=({children:e})=>Object(g.jsx)("span",{style:{backgroundColor:"#b0ccf7"}},e),Yo=()=>{const{jobCreator:e,jobCreatorUpdate:t}=Object(n.useContext)(Wn),a=e,[i,s]=Object(n.useState)(!1),[l,c]=Object(n.useState)(!1),[d,u]=Object(n.useState)(JSON.stringify(a.categorizationAnalyzer,null,2));function p(e){u(e);const t=Object(It.c)(e);c(t)}return Object(n.useEffect)((()=>{!0===i&&u(JSON.stringify(a.categorizationAnalyzer,null,2))}),[i]),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Xo,{onClick:function(){c(!1),s(!i)}}),!0===i&&Object(g.jsx)(o.EuiFlyout,{onClose:()=>s(!1),hideCloseButton:!0,size:"m"},Object(g.jsx)(o.EuiFlyoutBody,null,Object(g.jsx)(Qo,{onChange:p,title:r.i18n.translate("xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.title",{defaultMessage:"Edit categorization analyzer JSON"}),value:d})),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:()=>s(!1),flush:"left"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.closeButton",defaultMessage:"Close"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!0}),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{onClick:function(){const{anomaly_detectors:e}=Object(A.c)();p(JSON.stringify(e.categorization_analyzer,null,2))}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.useDefaultButton",defaultMessage:"Use default ML analyzer"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:function(){a.categorizationAnalyzer=JSON.parse(d),t(),s(!1)},fill:!0,isDisabled:!1===l},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.saveButton",defaultMessage:"Save"})))))))},Xo=({onClick:e})=>Object(g.jsx)(o.EuiButtonEmpty,{onClick:e,flush:"left","data-test-subj":"mlJobWizardButtonPreviewJobJson"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.editCategorizationAnalyzerFlyoutButton",defaultMessage:"Edit categorization analyzer"})),Qo=({title:e,value:t,onChange:a})=>Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h5",null,e)),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(Ye.a,{value:t,height:"800px",readOnly:!1,onChange:a})),Ko=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.allChecksButton",{defaultMessage:"View all checks performed"}),Zo=({overallValidStatus:e,validationChecks:t,categorizationAnalyzer:a})=>{const i=Object(g.jsx)(er,{categorizationAnalyzer:a});let n="success",s=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldCalloutTitle.valid",{defaultMessage:"Selected category field is valid"});return e===Lt.INVALID?(n="danger",s=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldCalloutTitle.invalid",{defaultMessage:"Selected category field is invalid"})):e===Lt.PARTIALLY_VALID&&(n="warning",s=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldCalloutTitle.possiblyInvalid",{defaultMessage:"Selected category field is possibly invalid"})),Object(g.jsx)(o.EuiCallOut,{color:n,title:s,"data-test-subj":`mlJobWizardCategorizationExamplesCallout ${e}`},t.map(((e,t)=>Object(g.jsx)("div",{key:t},e.message))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),i,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiAccordion,{id:"all-checks",buttonContent:Ko},Object(g.jsx)(tr,{validationChecks:t})))},er=({categorizationAnalyzer:e})=>{let t="";return void 0!==(null==e?void 0:e.tokenizer)?t=e.tokenizer:void 0!==(null==e?void 0:e.analyzer)&&(t=e.analyzer),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldAnalyzer",defaultMessage:"Analyzer used: {analyzer}",values:{analyzer:t}})),Object(g.jsx)("div",null,Object(g.jsx)(Yo,null)))},tr=({validationChecks:e})=>{const t=Object.keys(Rt).map(((t,a)=>{const i=e.find((e=>e.id===a));return void 0!==i&&(null==i?void 0:i.valid)!==Lt.VALID?{iconType:"cross",label:i.message,size:"s"}:{iconType:"check",label:Rt[a],size:"s"}}));return Object(g.jsx)(o.EuiListGroup,{listItems:t,maxWidth:!1})},ar=()=>Object(g.jsx)(o.EuiCallOut,{color:"warning",title:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.invalidCssVersionCallout.title",{defaultMessage:"The data view appears to be cross-cluster"})},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.invalidCssVersionCallout.mesage",defaultMessage:"No example categories could be found, this could be due to one of the clusters being an unsupported version."})),ir=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:i}=Object(n.useContext)(Wn),r=t,[l,c]=Object(n.useState)(!1),[d,u]=Object(n.useState)(!1),[p,m]=Object(n.useState)(r.start),[b,f]=Object(n.useState)(r.end),[h,j]=Object(n.useState)(JSON.stringify(r.categorizationAnalyzer)),[x,v]=Object(n.useState)(null),[y,O]=Object(n.useState)(Lt.INVALID),[E,w]=Object(n.useState)([]),[M,S]=Object(n.useState)(r.categorizationFieldName);async function _(){if(null!==M){c(!0);try{const{examples:e,overallValidStatus:t,validationChecks:a,ccsVersionFailure:i}=await r.loadCategorizationFieldExamples();v(e),O(t),w(a),u(i),c(!1)}catch(e){c(!1),v(null),w([]),O(Lt.INVALID),Object(Z.a)().displayErrorToast(e),u(!1)}}else v(null),w([]),O(Lt.INVALID),u(!1);e(null!==M)}return Object(n.useEffect)((()=>{r.categorizationFieldName!==M&&(r.categorizationFieldName=M,a()),_()}),[M]),Object(n.useEffect)((()=>{let e=!1;r.start===p&&r.end===b||(m(r.start),f(r.end),e=!0);const t=JSON.stringify(r.categorizationAnalyzer);t!==h&&(j(t),e=!0),e&&_(),r.categorizationFieldName!==M&&S(r.categorizationFieldName)}),[i]),Object(n.useEffect)((()=>{a()}),[y]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)($o,null),Object(g.jsx)(o.EuiHorizontalRule,null),Object(g.jsx)(Lo,null),!0===l&&Object(g.jsx)(Xt,{hasData:!1,loading:!0},Object(g.jsx)("div",null)),!1===d&&null!==x&&!1===l&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Zo,{overallValidStatus:y,validationChecks:E,categorizationAnalyzer:r.categorizationAnalyzer}),Object(g.jsx)(Wo,{fieldExamples:x})),!0===d&&Object(g.jsx)(ar,null),Object(g.jsx)(o.EuiHorizontalRule,null),Object(g.jsx)(Vo,null))},nr=()=>{const{displayErrorToast:e}=Object(Z.c)(),{jobCreator:t,resultsLoader:a}=Object(n.useContext)(Wn),i=t,[r,l]=Object(n.useState)([]),[c,d]=Object(n.useState)(0);function u(t){!async function(){try{const e=await X.ml.jobs.topCategories(i.jobId,5);l(e.categories.map((e=>{var t;return{count:e.count,example:null!==(t=e.category.examples)&&void 0!==t&&t.length?e.category.examples[0]:""}}))),d(e.total)}catch(t){404!==Object(da.c)(t).statusCode&&e(t)}}()}Object(n.useEffect)((()=>{const e=a.subscribeToResults(u);return()=>{e.unsubscribe()}}),[]);const p=[...i.modelPlot?[{field:"count",name:"count",width:"100px",render:e=>Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)("code",null,e))}]:[],{field:"example",name:"Example",render:e=>Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)("code",null,e))}];return Object(g.jsx)(s.a.Fragment,null,c>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationTotalCategories",defaultMessage:"Total categories: {totalCategories}",values:{totalCategories:c}})),Object(g.jsx)(o.EuiBasicTable,{columns:p,items:r})))},sr=()=>{const{jobCreator:e,resultsLoader:t}=Object(n.useContext)(Wn),a=e,[i,l]=Object(n.useState)([]),[c,d]=Object(n.useState)(),u=Object(n.useMemo)((()=>[{field:"partitionName",name:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.stoppedPartitionsPreviewColumnName",{defaultMessage:"Stopped partition names"}),render:e=>Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)("code",null,e))}]),[]),p=Object(n.useCallback)((async()=>{try{const{jobs:e}=await X.ml.results.getCategoryStoppedPartitions([a.jobId]);if(!Array.isArray(e)&&Array.isArray(e[a.jobId])&&e[a.jobId].length>0)return e[a.jobId]}catch(e){const t=Object(da.c)(e);404!==t.statusCode&&d(t.message)}}),[a.jobId]);return Object(n.useEffect)((()=>{if(a.perPartitionCategorization&&a.perPartitionStopOnWarn){const e=t.results$.pipe(Object(za.switchMap)((()=>Object(at.from)(p()))),Object(za.tap)((e=>{Array.isArray(e)&&l(e.slice(0,5).map((e=>({partitionName:e}))))})),Object(za.takeWhile)((e=>!e||Array.isArray(e)&&e.length<=5))).subscribe();return()=>e.unsubscribe()}}),[]),Object(g.jsx)(s.a.Fragment,null,c&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiCallOut,{color:"danger",size:"s",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.stoppedPartitionsErrorCallout",defaultMessage:"An error occurred while fetching list of stopped partitions."})})),Array.isArray(i)&&i.length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)("div",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationStoppedPartitionsTitle",defaultMessage:"Stopped partitions"})),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiCallOut,{color:"warning",size:"s",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.stoppedPartitionsExistCallout",defaultMessage:"Per-partition categorization and stop_on_warn settings are enabled. Some partitions in job '{jobId}' are unsuitable for categorization and have been excluded from further categorization or anomaly detection analysis.",values:{jobId:a.jobId}})}),Object(g.jsx)(o.EuiBasicTable,{columns:u,items:i})))},or=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:i}=Object(n.useContext)(Wn),o=e,[r,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)([]),[u,p]=Object(n.useState)([]),[m,b]=Object(n.useState)(!1);function f(e){const t=e.anomalies[0];void 0!==t&&d(t)}function h(e){b(e>0)}return Object(n.useEffect)((()=>{const e=a.subscribeToResults(f);return o.subscribeToProgress(h),async function(){l(!0);try{var e;const a=await t.loadEventRateChart(o.start,o.end,i.getInterval().asMilliseconds(),null!==(e=o.runtimeMappings)&&void 0!==e?e:void 0,o.datafeedConfig.indices_options);p(a)}catch(e){p([])}l(!1)}(),()=>{e.unsubscribe()}}),[]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(ta,{eventRateChartData:u,anomalyData:c,height:"300px",width:"100%",showAxis:!0,loading:r,fadeChart:m}),Object(g.jsx)(nr,null),Object(g.jsx)(sr,null))},rr=({setIsValid:e})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Ms,{setIsValid:e,hideEstimateButton:!0})))),lr=({isActive:e,setCanProceed:t})=>{const[a,i]=Object(n.useState)(!1),[r,l]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{"function"==typeof t&&t(a&&r)}),[a,r]),!1===e?Object(g.jsx)(or,null):Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(ir,{setIsValid:i}),a&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),Object(g.jsx)(rr,{setIsValid:l})))},cr=({fields:e,changeHandler:t,selectedField:a,testSubject:i,placeholder:n})=>{const s=e.map((e=>({label:e.name,field:e}))),r=[];return null!==a&&r.push({label:a.name,field:a}),Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:s,selectedOptions:r,onChange:function(e){const a=e[0];t(void 0!==a?a.field:null)},placeholder:n,"data-test-subj":i,isClearable:!1})},dr=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.splitRareField.title",{defaultMessage:"Rare field"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareField.description",defaultMessage:"Select a field in which to detect rare values."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),ur=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=e,s=Object(n.useMemo)((()=>Object(vt.b)(i.runtimeFields)),[]),o=function(e,t,a){const[i,s]=Object(n.useState)(e);return Object(n.useEffect)((()=>{const a=t.populationField,i=t.splitField;s(null!==a||null!==i?e.filter((({name:e})=>e!==(null==a?void 0:a.name)&&e!==(null==i?void 0:i.name))):e)}),[a]),i}(Object(n.useMemo)((()=>[...Hn.a.categoryFields,...s].sort(((e,t)=>e.name.localeCompare(t.name)))),[]),i,a),[r,l]=Object(n.useState)(i.rareField);return Object(n.useEffect)((()=>{i.setRareField(r),null!==r&&!1===i.influencers.includes(r.name)&&i.addInfluencer(r.name),t()}),[r]),Object(n.useEffect)((()=>{l(i.rareField)}),[a]),Object(g.jsx)(dr,null,Object(g.jsx)(cr,{fields:o,changeHandler:l,selectedField:r,testSubject:"mlRareFieldSelect"}))},pr=({onClick:e,isSelected:t})=>Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorRareCard"+(t?" selected":""),title:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.rareCard.title",{defaultMessage:"Rare"}),description:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.rareCard.description",defaultMessage:"Find rare values over time."})),selectable:{onClick:e,isSelected:t}})),mr=({onClick:e,isSelected:t})=>Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorRareCard"+(t?" selected":""),title:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.rarePopulationCard.title",{defaultMessage:"Rare in population"}),description:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.rarePopulationCard.description",defaultMessage:"Find members of a population that have rare values over time."})),selectable:{onClick:e,isSelected:t}})),br=({onClick:e,isSelected:t})=>Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorRareCard"+(t?" selected":""),title:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.freqRareCard.title",{defaultMessage:"Frequently rare in population"}),description:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.freqRareCard.description",defaultMessage:"Find members of a population that frequently have rare values."})),selectable:{onClick:e,isSelected:t}})),fr=({onChange:e})=>{const{jobCreator:t,jobCreatorUpdate:a}=Object(n.useContext)(Wn),i=t,[r,l]=Object(n.useState)(null);return Object(n.useEffect)((()=>{null!==i.rareField?null===i.populationField?l(vr.RARE):l(i.frequentlyRare?vr.FREQ_RARE_POPULATION:vr.RARE_POPULATION):l(vr.RARE)}),[]),Object(n.useEffect)((()=>{null!==r&&(e(r),r===vr.RARE&&null!==i.populationField&&i.removePopulationField(),i.frequentlyRare=r===vr.FREQ_RARE_POPULATION,a())}),[r]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.title",defaultMessage:"Rare detector"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"l",style:{maxWidth:"824px"}},Object(g.jsx)(pr,{onClick:function(){l(vr.RARE)},isSelected:r===vr.RARE}),Object(g.jsx)(mr,{onClick:function(){l(vr.RARE_POPULATION)},isSelected:r===vr.RARE_POPULATION}),Object(g.jsx)(br,{onClick:function(){l(vr.FREQ_RARE_POPULATION)},isSelected:r===vr.FREQ_RARE_POPULATION})))},hr=({detectorType:e})=>{const{jobCreator:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=t,[s,l]=Object(n.useState)(null);return Object(n.useEffect)((()=>{const t=function(e,t){var a,i;if(null===e.rareField)return null;const n=e.rareField.id,s=null===(a=e.populationField)||void 0===a?void 0:a.id,o=null===(i=e.splitField)||void 0===i?void 0:i.id,l=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.rareSummary",{defaultMessage:"Detects rare {rareFieldName} values.",values:{rareFieldName:n}}),c=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.rareSplitSummary",{defaultMessage:"For each {splitFieldName}, detects rare {rareFieldName} values.",values:{splitFieldName:o,rareFieldName:n}}),d=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.freqRarePopulationSummary",{defaultMessage:"Detects {populationFieldName} values that frequently have rare {rareFieldName} values relative to the population.",values:{populationFieldName:s,rareFieldName:n}}),u=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.freqRareSplitPopulationSummary",{defaultMessage:"For each {splitFieldName}, detects {populationFieldName} values that frequently have rare {rareFieldName} values relative to the population.",values:{splitFieldName:o,populationFieldName:s,rareFieldName:n}}),p=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.rarePopulationSummary",{defaultMessage:"Detects {populationFieldName} values that have rare {rareFieldName} values relative to the population.",values:{populationFieldName:s,rareFieldName:n}}),m=r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.rareSplitPopulationSummary",{defaultMessage:"For each {splitFieldName}, detects {populationFieldName} values that have rare {rareFieldName} values relative to the population.",values:{splitFieldName:o,populationFieldName:s,rareFieldName:n}});return t===vr.RARE?void 0!==o?c:l:t===vr.FREQ_RARE_POPULATION?void 0!==o?u:d:t===vr.RARE_POPULATION?void 0!==o?m:p:null}(i,e);l(t)}),[a]),null===s?null:Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.calloutTitle",{defaultMessage:"Job summary"})},Object(g.jsx)("ul",null,Object(g.jsx)("li",null,s)))},gr=({setIsValid:e,rareDetectorType:t,setRareDetectorType:a})=>{const{jobCreator:i,jobCreatorUpdated:r}=Object(n.useContext)(Wn),l=i,[c,d]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{let a=!1;null!==l.rareField&&(t===vr.RARE||null!==l.populationField)&&(a=!0),e(a),d(a)}),[r]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(fr,{onChange:a}),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,null),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(ur,null)),Object(g.jsx)(o.EuiFlexItem,null,t!==vr.RARE&&Object(g.jsx)(Ws,null))),c&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(hr,{detectorType:t}))))},jr=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:i,jobCreatorUpdated:r}=Object(n.useContext)(Wn),l=e,[c,d]=Object(n.useState)(!1),[u,p]=Object(n.useState)([]),[m,b]=Object(n.useState)([]),[f,h]=Object(n.useState)(!1),j=Object(n.useMemo)((()=>null!==l.rareField?null===l.populationField?vr.RARE:l.frequentlyRare?vr.FREQ_RARE_POPULATION:vr.RARE_POPULATION:vr.RARE),[r]);function x(e){const t=e.anomalies[0];void 0!==t&&p(t)}function v(e){h(e>0)}return Object(n.useEffect)((()=>{const e=a.subscribeToResults(x);return l.subscribeToProgress(v),async function(){d(!0);try{var e;const a=await t.loadEventRateChart(l.start,l.end,i.getInterval().asMilliseconds(),null!==(e=l.runtimeMappings)&&void 0!==e?e:void 0,l.datafeedConfig.indices_options);b(a)}catch(e){b([])}d(!1)}(),()=>{e.unsubscribe()}}),[]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(hr,{detectorType:j}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(ta,{eventRateChartData:m,anomalyData:u,height:"300px",width:"100%",showAxis:!0,loading:c,fadeChart:f}))},xr=({setIsValid:e})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zs,null)),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Js,null))),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Ms,{setIsValid:e})),Object(g.jsx)(o.EuiFlexItem,null)));let vr;!function(e){e[e.RARE=0]="RARE",e[e.RARE_POPULATION=1]="RARE_POPULATION",e[e.FREQ_RARE_POPULATION=2]="FREQ_RARE_POPULATION"}(vr||(vr={}));const yr=({isActive:e,setCanProceed:t})=>{const[a,i]=Object(n.useState)(!1),[r,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(vr.RARE);return Object(n.useEffect)((()=>{"function"==typeof t&&t(a&&r)}),[a,r]),!1===e?Object(g.jsx)(jr,null):Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(gr,{setIsValid:i,rareDetectorType:c,setRareDetectorType:d}),a&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,{margin:"l"}),Object(g.jsx)(xr,{setIsValid:l})))},Or=({combinedJob:e,heightOffset:t=0})=>{const{jobs:{datafeedPreview:a}}=Object(y.a)(),i=Object(n.useMemo)((()=>window.innerHeight-230-t+"px"),[t]),[s,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(""),[u,p]=Object(n.useState)(!1),[b,f]=Object(n.useState)("");Object(n.useEffect)((()=>{try{null!==e&&(""===b?h():p(JSON.stringify(e)!==b))}catch(e){}}),[e]);const h=Object(n.useCallback)((async()=>{if(d(""),null!==e)if(l(!0),f(JSON.stringify(e)),e.datafeed_config&&e.datafeed_config.indices.length){try{const{datafeed_config:t,...i}=e;if(0===i.analysis_config.detectors.length)d(r.i18n.translate("xpack.ml.newJob.wizard.datafeedPreviewFlyout.noDetectors",{defaultMessage:"No detectors configured"}));else{const e=await a(void 0,i,t);d(JSON.stringify(e,null,2))}}catch(e){d(JSON.stringify(e,null,2))}l(!1),p(!1)}else{const e=r.i18n.translate("xpack.ml.newJob.wizard.datafeedPreviewFlyout.datafeedDoesNotExistLabel",{defaultMessage:"Datafeed does not exist"});d(e)}}),[e]);return Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h5",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedPreviewFlyout.title",defaultMessage:"Datafeed preview"})))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},u&&Object(g.jsx)(o.EuiButton,{size:"s",onClick:h,iconType:"refresh"},"Refresh"))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),!0===s?Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiSpacer,{size:"xxl"}),Object(g.jsx)(o.EuiLoadingSpinner,{size:"l"}))):Object(g.jsx)(Ye.a,{value:c,height:i,readOnly:!0}))};let Er;!function(e){e[e.HIDDEN=0]="HIDDEN",e[e.READONLY=1]="READONLY",e[e.EDITABLE=2]="EDITABLE"}(Er||(Er={}));const{collapseLiteralStrings:wr}=Ai.XJson;let Mr;!function(e){e[e.HIDDEN=0]="HIDDEN",e[e.READONLY=1]="READONLY",e[e.EDITABLE=2]="EDITABLE"}(Mr||(Mr={}));const Sr=({isDisabled:e,jobEditorMode:t,datafeedEditorMode:a})=>{const{jobCreator:i,jobCreatorUpdate:l,jobCreatorUpdated:c}=Object(n.useContext)(Wn),{displayErrorToast:d}=Object(Z.c)(),[u,p]=Object(n.useState)(!1),[b,f]=Object(n.useState)(!1),[h,j]=Object(n.useState)(i.formattedJobJson),[x,v]=Object(n.useState)(i.formattedDatafeedJson),[y,O]=Object(n.useState)(!1),[E,w]=Object(n.useState)(null);Object(n.useEffect)((()=>{j(i.formattedJobJson),v(i.formattedDatafeedJson)}),[c]),Object(n.useEffect)((()=>{!0===u?(j(i.formattedJobJson),v(i.formattedDatafeedJson),w({...JSON.parse(i.formattedJobJson),datafeed_config:JSON.parse(i.formattedDatafeedJson)}),f(!1)):w(null)}),[u]);const M=t===Mr.EDITABLE||a===Mr.EDITABLE,S=t===Mr.READONLY&&a===Mr.READONLY;return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(_r,{onClick:function(){O(!1),p(!u)},isDisabled:e,editJsonMode:M}),!0===u&&!1===e&&Object(g.jsx)(o.EuiFlyout,{onClose:()=>p(!1),hideCloseButton:!0,size:"l"},Object(g.jsx)(o.EuiFlyoutBody,null,Object(g.jsx)(o.EuiFlexGroup,null,t!==Mr.HIDDEN&&Object(g.jsx)(Tr,{editJson:t===Mr.EDITABLE,onChange:function(e){j(e);const t=Object(It.c)(e);w(t?{...JSON.parse(e),datafeed_config:JSON.parse(x)}:null),O(t)},title:r.i18n.translate("xpack.ml.newJob.wizard.jsonFlyout.job.title",{defaultMessage:"Job configuration JSON"}),value:h,heightOffset:b?100:0}),a!==Mr.HIDDEN&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Tr,{editJson:a===Mr.EDITABLE,onChange:function(e){v(e);const t=wr(e);let a=Object(It.c)(t);if(a){const e=JSON.parse(t),n=i.indices.sort();a=n.length===e.indices.length&&n.every(((t,a)=>t===e.indices[a])),f(!1===a),w({...JSON.parse(h),datafeed_config:e})}else f(!1),w(null);O(a)},title:r.i18n.translate("xpack.ml.newJob.wizard.jsonFlyout.datafeed.title",{defaultMessage:"Datafeed configuration JSON"}),value:x,heightOffset:b?100:0}),a===Mr.EDITABLE&&Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Or,{combinedJob:E,heightOffset:b?100:0})))),b&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiCallOut,{color:"warning",size:"s",title:r.i18n.translate("xpack.ml.newJob.wizard.jsonFlyout.indicesChange.calloutTitle",{defaultMessage:"Indices have changed"})},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jsonFlyout.indicesChange.calloutText",defaultMessage:"You cannot alter the indices being used by the datafeed here. To select a different data view or saved search, go to step 1 of the wizard and select the Change data view option."})))),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:()=>p(!1),flush:"left"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jsonFlyout.closeButton",defaultMessage:"Close"}))),!1===S&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:async function(){const e=JSON.parse(h),t=JSON.parse(wr(x));if(i.cloneFromExistingJob(e,t),Vt(i))try{await i.autoSetTimeRange()}catch(e){const t=r.i18n.translate("xpack.ml.newJob.wizard.jsonFlyout.autoSetJobCreatorTimeRange.error",{defaultMessage:"Error retrieving beginning and end times of index"});d(e,t)}l(),p(!1)},fill:!0,isDisabled:!1===y},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jsonFlyout.saveButton",defaultMessage:"Save"})))))))},_r=({isDisabled:e,onClick:t,editJsonMode:a})=>{const i=r.i18n.translate("xpack.ml.newJob.wizard.previewJsonButton",{defaultMessage:"Preview JSON"}),n=r.i18n.translate("xpack.ml.newJob.wizard.editJsonButton",{defaultMessage:"Edit JSON"});return Object(g.jsx)(o.EuiButtonEmpty,{onClick:t,isDisabled:e,"data-test-subj":"mlJobWizardButtonPreviewJobJson"},a?n:i)},Tr=({title:e,value:t,editJson:a,onChange:i,heightOffset:s=0})=>{const r=Object(n.useMemo)((()=>window.innerHeight-230-s+"px"),[s]);return Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h5",null,e)),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(Ye.a,{value:t,height:r,mode:Ye.b.XJSON,readOnly:!1===a,onChange:i}))},Cr=({setCurrentStep:e,isCurrentStep:t})=>{const{jobCreator:a,jobValidator:i,jobValidatorUpdated:s}=Object(n.useContext)(Wn),[o,r]=Object(n.useState)(!1),[l,c]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{r(l&&i.isPickFieldsStepValid)}),[i,s,l]),Object(g.jsx)(n.Fragment,null,t&&Object(g.jsx)(n.Fragment,null,Pt(a)&&Object(g.jsx)(Cs,{isActive:t,setCanProceed:c}),zt(a)&&Object(g.jsx)(Gs,{isActive:t,setCanProceed:c}),Bt(a)&&Object(g.jsx)(Zs,{isActive:t,setCanProceed:c}),Vt(a)&&Object(g.jsx)(Uo,{isActive:t,setCanProceed:c}),Jt(a)&&Object(g.jsx)(lr,{isActive:t,setCanProceed:c}),Ut(a)&&Object(g.jsx)(yr,{isActive:t,setCanProceed:c}),Object(g.jsx)(Yn,{previous:()=>e(Vt(a)?$n.ADVANCED_CONFIGURE_DATAFEED:$n.TIME_RANGE),next:()=>e($n.JOB_DETAILS),nextActive:o},Vt(a)&&Object(g.jsx)(Sr,{isDisabled:!1,jobEditorMode:Mr.EDITABLE,datafeedEditorMode:Mr.EDITABLE}))))},kr=Object(n.memo)((({children:e,validation:t})=>{const a=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobId.title",{defaultMessage:"Job ID"}),i=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobId.description",{defaultMessage:'A unique identifier for the job. Spaces and the characters  / ? , " < > | * are not allowed'});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,a),description:i},Object(g.jsx)(o.EuiFormRow,{label:a,error:t.message,isInvalid:!1===t.valid},Object(g.jsx)(s.a.Fragment,null,e)))})),Fr=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobValidator:a,jobValidatorUpdated:i}=Object(n.useContext)(Wn),[s,r]=Object(n.useState)(e.jobId),l=Object(n.useMemo)((()=>{var e,t,i;return{valid:!0==(""===s)||!0===a.jobId.valid&&!0===(null===(e=a.latestValidationResult.jobIdExists)||void 0===e?void 0:e.valid),message:null!==(t=a.jobId.message)&&void 0!==t?t:null===(i=a.latestValidationResult.jobIdExists)||void 0===i?void 0:i.message}}),[i]);return Object(n.useEffect)((()=>{e.jobId=s,t()}),[s]),Object(g.jsx)(kr,{validation:l},Object(g.jsx)(o.EuiFieldText,{value:s,onChange:e=>r(e.target.value),isInvalid:!1===l.valid,"data-test-subj":"mlJobWizardInputJobId"}))},Ir=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobDescription.title",{defaultMessage:"Job description"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.jobDescription.description",defaultMessage:"Optional descriptive text"})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),Dr=()=>{const{jobCreator:e,jobCreatorUpdate:t}=Object(n.useContext)(Wn),[a,i]=Object(n.useState)(e.description);return Object(n.useEffect)((()=>{e.description=a,t()}),[a]),Object(g.jsx)(Ir,null,Object(g.jsx)(o.EuiTextArea,{value:a,onChange:e=>i(e.target.value),"data-test-subj":"mlJobWizardInputJobDescription"}))},Ar=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobValidator:a,jobValidatorUpdated:i}=Object(n.useContext)(Wn),{existingJobsAndGroups:s}=Object(n.useContext)(Wn),[l,c]=Object(n.useState)(e.groups),d=Object(n.useMemo)((()=>{var e,t,i;return{valid:!0===a.groupIds.valid&&!0===(null===(e=a.latestValidationResult.groupIdsExist)||void 0===e?void 0:e.valid),message:null!==(t=a.groupIds.message)&&void 0!==t?t:null===(i=a.latestValidationResult.groupIdsExist)||void 0===i?void 0:i.message}}),[i]);Object(n.useEffect)((()=>{e.groups=l,t()}),[l.join()]);const u=s.groupIds.map((e=>({label:e,color:Object(Xa.a)(e)}))),p=l.map((e=>({label:e,color:Object(Xa.a)(e)})));return Object(g.jsx)(ss,{validation:d},Object(g.jsx)(o.EuiComboBox,{placeholder:r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.placeholder",{defaultMessage:"Select or create groups"}),options:u,selectedOptions:p,onChange:function(e){c(e.map((e=>e.label)))},onCreateOption:function(e,t){const a=e.trim().toLowerCase();if(!a)return;const i={label:e,color:Object(Xa.a)(e)};-1===t.findIndex((e=>e.label.trim().toLowerCase()===a))&&u.push(i),c([...p,i].map((e=>e.label)))},isClearable:!0,isInvalid:!1===d.valid,"data-test-subj":"mlJobWizardComboBoxJobGroups"}))},Lr=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlot.title",{defaultMessage:"Enable model plot"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlot.description",defaultMessage:"Select to store additional model information used for plotting model bounds. This will add overhead to the performance of the system and is not recommended for high cardinality data."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),Rr=()=>{const{jobCreator:e,jobValidator:t,jobValidatorUpdated:a}=Object(n.useContext)(Wn),[i,s]=Object(n.useState)(null);return Object(n.useEffect)((()=>{var e,a,i;const n=null!==(e=null===(a=t.latestValidationResult)||void 0===a||null===(i=a.highCardinality)||void 0===i?void 0:i.value)&&void 0!==e?e:null;s(n)}),[a]),e.modelPlot&&null!==i?Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.mmlWarning.title",defaultMessage:"Proceed with caution!"}),color:"warning",iconType:"help"},Object(g.jsx)(o.EuiText,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.mmlWarning.message",defaultMessage:"Creating model plots is resource intensive and not recommended where the cardinality of the selected fields is greater than 100. Estimated cardinality for this job is {highCardinality}. If you enable model plot with this configuration we recommend you use a dedicated results index.",values:{highCardinality:i}}))):null},Nr=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),[i,l]=Object(n.useState)(e.modelPlot),[c,d]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{e.modelPlot=i,t()}),[i]),Object(n.useEffect)((()=>{const t=[xt.b.RARE],a=Jt(e)&&e.aggregations.some((e=>t.includes(e.id)));d(!1===a)}),[a]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Lr,null,Object(g.jsx)(o.EuiSwitch,{name:"switch",disabled:!1===c,checked:i,onChange:function(){l(!i)},"data-test-subj":"mlJobWizardSwitchModelPlot",label:r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlot.title",{defaultMessage:"Enable model plot"})})),Object(g.jsx)(Rr,null),Object(g.jsx)(o.EuiSpacer,null))},Pr=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlotAnnotations.title",{defaultMessage:"Enable model change annotations"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlotAnnotations.description",defaultMessage:"Select to generate annotations when the model changes significantly. For example, when step changes, periodicity or trends are detected."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),zr=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),[i,l]=Object(n.useState)(e.modelChangeAnnotations),[c,d]=Object(n.useState)(e.modelPlot&&!e.modelChangeAnnotations);return Object(n.useEffect)((()=>{e.modelChangeAnnotations=i,t()}),[i]),Object(n.useEffect)((()=>{d(e.modelPlot&&!i)}),[a,i]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Pr,null,Object(g.jsx)(o.EuiSwitch,{name:"switch",checked:i,onChange:function(){l(!i)},"data-test-subj":"mlJobWizardSwitchAnnotations",label:r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlotAnnotations.title",{defaultMessage:"Enable model change annotations"})})),c&&Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.annotationsSwitchCallout.title",defaultMessage:"If you enable model plot with this configuration, we recommend you also enable annotations."}),color:"primary",iconType:"help"}),Object(g.jsx)(o.EuiSpacer,null))},Br=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.useDedicatedIndex.title",{defaultMessage:"Use dedicated index"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.useDedicatedIndex.description",defaultMessage:"Store results in a separate index for this job."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),Vr=()=>{const{jobCreator:e,jobCreatorUpdate:t}=Object(n.useContext)(Wn),[a,i]=Object(n.useState)(e.useDedicatedIndex);return Object(n.useEffect)((()=>{e.useDedicatedIndex=a,t()}),[a]),Object(g.jsx)(Br,null,Object(g.jsx)(o.EuiSwitch,{name:"switch",checked:a,onChange:function(){i(!a)},"data-test-subj":"mlJobWizardSwitchUseDedicatedIndex",label:r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.useDedicatedIndex.title",{defaultMessage:"Use dedicated index"})}))},Jr=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSectionButton",{defaultMessage:"Advanced"}),Ur=({advancedExpanded:e,setAdvancedExpanded:t})=>{const{jobCreator:a}=Object(n.useContext)(Wn);return a.type===wt.f.ADVANCED?Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,{margin:"xl"}),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Nr,null),Object(g.jsx)(zr,null)),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Vr,null)))):Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"xl"}),Object(g.jsx)(o.EuiAccordion,{id:"advanced-section",buttonContent:Jr,onToggle:t,initialIsOpen:e,"data-test-subj":"mlJobWizardToggleAdvancedSection"},Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"},"data-test-subj":"mlJobWizardAdvancedSection"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Nr,null),Object(g.jsx)(zr,null),Object(g.jsx)(To,null)),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Vr,null)))))},Gr=Object(n.memo)((({children:e})=>{const{services:{docLinks:t}}=Object(y.b)(),a=t.links.ml.calendars,i=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.title",{defaultMessage:"Calendars"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,i),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.description",defaultMessage:"Contains a list of scheduled events that you want to ignore, such as planned system outages or public holidays. {learnMoreLink}",values:{learnMoreLink:Object(g.jsx)(o.EuiLink,{href:a,target:"_blank"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.learnMoreLinkText",defaultMessage:"Learn more"}))}})},Object(g.jsx)(o.EuiFormRow,null,Object(g.jsx)(s.a.Fragment,null,e)))}));var qr=a(193);const $r=()=>{const{services:{application:{getUrlForApp:e}}}=Object(y.b)(),{jobCreator:t,jobCreatorUpdate:a}=Object(n.useContext)(Wn),[i,s]=Object(n.useState)(t.calendars),[l,c]=Object(n.useState)([]),[d,u]=Object(n.useState)([]),[p,b]=Object(n.useState)(!1);async function f(){b(!0);const e=(await X.ml.calendars()).filter((e=>!1===e.job_ids.includes(qr.a)));u(e.map((e=>({label:e.calendar_id,value:e})))),c(i.map((e=>({label:e.calendar_id,value:e})))),b(!1)}Object(n.useEffect)((()=>{f()}),[]),Object(n.useEffect)((()=>{t.calendars=i,a()}),[i.join()]);const h={async:!0,options:d,selectedOptions:l,isLoading:p,onChange:e=>{c(e),s(e.map((e=>e.value)))}},j=e(le.e,{path:E.b.CALENDARS_MANAGE});return Object(g.jsx)(Gr,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiComboBox,_()({},h,{"data-test-subj":"mlJobWizardComboBoxCalendars"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiToolTip,{position:"right",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.refreshCalendarsButtonLabel",defaultMessage:"Refresh calendars"})},Object(g.jsx)(o.EuiButtonIcon,{iconType:"refresh",color:"primary","aria-label":r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.refreshCalendarsButtonLabel",{defaultMessage:"Refresh calendars"}),onClick:f})))),Object(g.jsx)(o.EuiSpacer,{size:"xs"}),Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)(o.EuiLink,{href:j,target:"_blank",external:!0},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.manageCalendarsButtonLabel",defaultMessage:"Manage calendars"}))))},Wr=Object(n.memo)((({children:e})=>{const{services:{docLinks:t}}=Object(y.b)(),a=t.links.ml.customUrls,i=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.customUrls.title",{defaultMessage:"Custom URLs"});return Object(g.jsx)(o.EuiDescribedFormGroup,{fullWidth:!0,className:"ml-custom-urls-selection",title:Object(g.jsx)("h3",null,i),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.customUrlsSelection.description",defaultMessage:"Provide links from anomalies to Kibana dashboards, the Discovery page, or other web pages. {learnMoreLink}",values:{learnMoreLink:Object(g.jsx)(o.EuiLink,{href:a,target:"_blank"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.customUrlsSelection.learnMoreLinkText",defaultMessage:"Learn more"}))}})},Object(g.jsx)(o.EuiFormRow,{fullWidth:!0},Object(g.jsx)(s.a.Fragment,null,e)))})),Hr=()=>{var e;const{jobCreator:t,jobCreatorUpdate:a}=Object(n.useContext)(Wn),i={...t.jobConfig,datafeed_config:t.datafeedConfig};return Object(g.jsx)(Wr,null,Object(g.jsx)(Fi,{job:i,jobCustomUrls:null!==(e=t.customUrls)&&void 0!==e?e:[],setCustomUrls:e=>{t.customUrls=e,a()},editMode:"modal"}))},Yr=r.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSectionButton",{defaultMessage:"Additional settings"}),Xr=({additionalExpanded:e,setAdditionalExpanded:t})=>Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiAccordion,{id:"additional-section",buttonContent:Yr,onToggle:t,initialIsOpen:e,"data-test-subj":"mlJobWizardToggleAdditionalSettingsSection"},Object(g.jsx)("section",{"data-test-subj":"mlJobWizardAdditionalSettingsSection"},Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"}},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Hr,null))),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"}},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)($r,null)),Object(g.jsx)(o.EuiFlexItem,null))))),Qr=({setCurrentStep:e,isCurrentStep:t,advancedExpanded:a,setAdvancedExpanded:i,additionalExpanded:s,setAdditionalExpanded:r})=>{const{jobCreator:l,jobValidator:c,jobValidatorUpdated:d}=Object(n.useContext)(Wn),[u,p]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{var e,t;const a=c.jobId.valid&&c.modelMemoryLimit.valid&&c.groupIds.valid&&!0===(null===(e=c.latestValidationResult.jobIdExists)||void 0===e?void 0:e.valid)&&!0===(null===(t=c.latestValidationResult.groupIdsExist)||void 0===t?void 0:t.valid)&&!1===c.validating;p(a)}),[d]),Object(g.jsx)(n.Fragment,null,t&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Fr,null),Object(g.jsx)(Ar,null)),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Dr,null))),Object(g.jsx)(Xr,{additionalExpanded:s,setAdditionalExpanded:r}),Object(g.jsx)(Ur,{advancedExpanded:a,setAdvancedExpanded:i}),Object(g.jsx)(Yn,{previous:()=>e($n.PICK_FIELDS),next:()=>e($n.VALIDATION),nextActive:u},Vt(l)&&Object(g.jsx)(Sr,{isDisabled:!1,jobEditorMode:Mr.EDITABLE,datafeedEditorMode:Mr.EDITABLE}))))};var Kr=a(156),Zr=a.n(Kr),el=a(29),tl=a(10);const al=Object(Q.once)((e=>({categorizer_detector_missing_per_partition_field:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.categorizerMissingPerPartitionFieldMessage",{defaultMessage:'Partition field must be set for detectors that reference "mlcategory" when per-partition categorization is enabled.'}),url:null==e?void 0:e.links.ml.anomalyDetectionConfiguringCategories},categorizer_varying_per_partition_fields:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.categorizerVaryingPerPartitionFieldNamesMessage",{defaultMessage:'Detectors with keyword "mlcategory" cannot have different partition_field_name when per-partition categorization is enabled. Found [{fields}].',values:{fields:'"{{fields}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionConfiguringCategories},field_not_aggregatable:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.fieldNotAggregatableMessage",{defaultMessage:"Detector field {fieldName} is not an aggregatable field.",values:{fieldName:'"{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.aggregrations},fields_not_aggregatable:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.fieldsNotAggregatableMessage",{defaultMessage:"One of the detector fields is not an aggregatable field."}),url:null==e?void 0:e.links.ml.aggregrations},cardinality_no_results:{status:el.c.WARNING,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityNoResultsHeading",{defaultMessage:"Field cardinality"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityNoResultsMessage",{defaultMessage:"Cardinality checks could not be run. The query to validate fields didn't return any documents."})},cardinality_field_not_exists:{status:el.c.WARNING,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityFieldNotExistsHeading",{defaultMessage:"Field cardinality"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityFieldNotExistsMessage",{defaultMessage:"Cardinality checks could not be run for field {fieldName}. The query to validate the field didn't return any documents.",values:{fieldName:'"{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.aggregrations},cardinality_by_field:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityByFieldMessage",{defaultMessage:"Cardinality of {fieldName} is above 1000 and might result in high memory usage.",values:{fieldName:'by_field "{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},cardinality_over_field_low:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityOverFieldLowMessage",{defaultMessage:"Cardinality of {fieldName} is below 10 and might not be suitable for population analysis.",values:{fieldName:'over_field "{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},cardinality_over_field_high:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityOverFieldHighMessage",{defaultMessage:"Cardinality of {fieldName} is above 1000000 and might result in high memory usage.",values:{fieldName:'over_field "{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},cardinality_partition_field:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityPartitionFieldMessage",{defaultMessage:"Cardinality of {fieldName} is above 1000 and might result in high memory usage.",values:{fieldName:'partition_field "{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},cardinality_model_plot_high:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityModelPlotHighMessage",{defaultMessage:"The estimated cardinality of {modelPlotCardinality} of fields relevant to creating model plots might result in resource intensive jobs.",values:{modelPlotCardinality:"{{modelPlotCardinality}}"}})},categorization_filters_valid:{status:el.c.SUCCESS,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.categorizationFiltersValidMessage",{defaultMessage:"Categorization filters checks passed."}),url:null==e?void 0:e.links.ml.anomalyDetectionConfiguringCategories},categorization_filters_invalid:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.categorizationFiltersInvalidMessage",{defaultMessage:"The categorization filters configuration is invalid. Make sure filters are valid regular expressions and {categorizationFieldName} is set.",values:{categorizationFieldName:'"categorization_field_name"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResourceAnalysisConfig},bucket_span_empty:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanEmptyMessage",{defaultMessage:"The bucket span field must be specified."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResourceAnalysisConfig},bucket_span_estimation_mismatch:{status:el.c.INFO,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanEstimationMismatchHeading",{defaultMessage:"Bucket span"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanEstimationMismatchMessage",{defaultMessage:"Current bucket span is {currentBucketSpan}, but bucket span estimation returned {estimateBucketSpan}.",values:{currentBucketSpan:'"{{currentBucketSpan}}"',estimateBucketSpan:'"{{estimateBucketSpan}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionBucketSpan},bucket_span_high:{status:el.c.INFO,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanHighHeading",{defaultMessage:"Bucket span"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanHighMessage",{defaultMessage:"Bucket span is 1 day or more. Be aware that days are considered as UTC days, not local days."}),url:null==e?void 0:e.links.ml.anomalyDetectionBucketSpan},bucket_span_valid:{status:el.c.SUCCESS,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanValidHeading",{defaultMessage:"Bucket span"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanValidMessage",{defaultMessage:"Format of {bucketSpan} is valid.",values:{bucketSpan:'"{{bucketSpan}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResourceAnalysisConfig},bucket_span_invalid:{status:el.c.ERROR,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanInvalidHeading",{defaultMessage:"Bucket span"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanInvalidMessage",{defaultMessage:"The specified bucket span is not a valid time interval format e.g. 10m, 1h. It also needs to be higher than zero."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResourceAnalysisConfig},detectors_duplicates:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsDuplicatesMessage",{defaultMessage:"Duplicate detectors were found. Detectors having the same combined configuration for {functionParam}, {fieldNameParam}, {byFieldNameParam}, {overFieldNameParam} and {partitionFieldNameParam} are not allowed within the same job.",values:{functionParam:"'function'",fieldNameParam:"'field_name'",byFieldNameParam:"'by_field_name'",overFieldNameParam:"'over_field_name'",partitionFieldNameParam:"'partition_field_name'"}}),url:null==e?void 0:e.links.ml.anomalyDetectionDetectors},detectors_empty:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsEmptyMessage",{defaultMessage:"No detectors were found. At least one detector must be specified."}),url:null==e?void 0:e.links.ml.anomalyDetectionDetectors},detectors_function_empty:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsFunctionEmptyMessage",{defaultMessage:"One of the detector functions is empty."}),url:null==e?void 0:e.links.ml.anomalyDetectionDetectors},detectors_function_not_empty:{status:el.c.SUCCESS,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsFunctionNotEmptyHeading",{defaultMessage:"Detector functions"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsFunctionNotEmptyMessage",{defaultMessage:"Presence of detector functions validated in all detectors."}),url:null==e?void 0:e.links.ml.anomalyDetectionDetectors},index_fields_invalid:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.indexFieldsInvalidMessage",{defaultMessage:"Could not load fields from index."})},index_fields_valid:{status:el.c.SUCCESS,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.indexFieldsValidMessage",{defaultMessage:"Index fields are present in the datafeed."})},influencer_high:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.influencerHighMessage",{defaultMessage:"The job configuration includes more than 3 influencers. Consider using fewer influencers or creating multiple jobs."}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},influencer_low:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.influencerLowMessage",{defaultMessage:"No influencers have been configured. Picking an influencer is strongly recommended."}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},influencer_low_suggestion:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.influencerLowSuggestionMessage",{defaultMessage:"No influencers have been configured. Consider using {influencerSuggestion} as an influencer.",values:{influencerSuggestion:"{{influencerSuggestion}}"}}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},influencer_low_suggestions:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.influencerLowSuggestionsMessage",{defaultMessage:"No influencers have been configured. Consider using one or more of {influencerSuggestion}.",values:{influencerSuggestion:"{{influencerSuggestion}}"}}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},job_id_empty:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdEmptyMessage",{defaultMessage:"Job ID field must not be empty."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_id_invalid:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdInvalidMessage",{defaultMessage:"Job ID is invalid. It can contain lowercase alphanumeric (a-z and 0-9) characters, hyphens or underscores and must start and end with an alphanumeric character."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_id_invalid_max_length:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:el.b}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_id_valid:{status:el.c.SUCCESS,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdValidHeading",{defaultMessage:"Job ID format is valid"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdValidMessage",{defaultMessage:"Lowercase alphanumeric (a-z and 0-9) characters, hyphens or underscores, starts and ends with an alphanumeric character, and is no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:el.b}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_group_id_invalid:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdInvalidMessage",{defaultMessage:"One of the job group names is invalid. They can contain lowercase alphanumeric (a-z and 0-9) characters, hyphens or underscores and must start and end with an alphanumeric character."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_group_id_invalid_max_length:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job group name must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:el.b}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_group_id_valid:{status:el.c.SUCCESS,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdValidHeading",{defaultMessage:"Job group id formats are valid"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdValidMessage",{defaultMessage:"Lowercase alphanumeric (a-z and 0-9) characters, hyphens or underscores, starts and ends with an alphanumeric character, and is no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:el.b}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},missing_summary_count_field_name:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.missingSummaryCountFieldNameMessage",{defaultMessage:"A job configured with a datafeed with aggregations must set summary_count_field_name; use doc_count or suitable alternative."})},skipped_extended_tests:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.skippedExtendedTestsMessage",{defaultMessage:"Skipped additional checks because the basic requirements of the job configuration were not met."})},success_cardinality:{status:el.c.SUCCESS,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.successCardinalityHeading",{defaultMessage:"Cardinality"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.successCardinalityMessage",{defaultMessage:"Cardinality of detector fields is within recommended bounds."}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},success_bucket_span:{status:el.c.SUCCESS,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.successBucketSpanHeading",{defaultMessage:"Bucket span"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.successBucketSpanMessage",{defaultMessage:"Format of {bucketSpan} is valid and passed validation checks.",values:{bucketSpan:'"{{bucketSpan}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionBucketSpan},success_influencers:{status:el.c.SUCCESS,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.successInfluencersMessage",{defaultMessage:"Influencer configuration passed the validation checks."}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},estimated_mml_greater_than_max_mml:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.estimatedMmlGreaterThanMaxMmlMessage",{defaultMessage:"The estimated model memory limit is greater than the max model memory limit configured for this cluster."})},mml_greater_than_effective_max_mml:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.mmlGreaterThanEffectiveMaxMmlMessage",{defaultMessage:"Job will not be able to run in the current cluster because model memory limit is higher than {effectiveMaxModelMemoryLimit}.",values:{effectiveMaxModelMemoryLimit:"{{effectiveMaxModelMemoryLimit}}"}})},mml_greater_than_max_mml:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.mmlGreaterThanMaxMmlMessage",{defaultMessage:"The model memory limit is greater than the max model memory limit configured for this cluster."})},mml_value_invalid:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.mmlValueInvalidMessage",{defaultMessage:"{mml} is not a valid value for model memory limit. The value needs to be at least 1MB and should be specified in bytes e.g. 10MB.",values:{mml:"{{mml}}"}}),url:null==e?void 0:e.links.ml.anomalyDetectionModelMemoryLimits},half_estimated_mml_greater_than_mml:{status:el.c.WARNING,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.halfEstimatedMmlGreaterThanMmlMessage",{defaultMessage:"The specified model memory limit is less than half of the estimated model memory limit and will likely hit the hard limit."}),url:null==e?void 0:e.links.ml.anomalyDetectionModelMemoryLimits},estimated_mml_greater_than_mml:{status:el.c.INFO,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.estimatedMmlGreaterThanMmlMessage",{defaultMessage:"The estimated model memory limit is greater than the model memory limit you have configured."}),url:null==e?void 0:e.links.ml.anomalyDetectionModelMemoryLimits},success_mml:{status:el.c.SUCCESS,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.successMmlHeading",{defaultMessage:"Model memory limit"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.successMmlMessage",{defaultMessage:"Valid and within the estimated model memory limit."}),url:null==e?void 0:e.links.ml.anomalyDetectionModelMemoryLimits},success_time_range:{status:el.c.SUCCESS,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.successTimeRangeHeading",{defaultMessage:"Time range"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.successTimeRangeMessage",{defaultMessage:"Valid and long enough to model patterns in the data."})},time_field_invalid:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.timeFieldInvalidMessage",{defaultMessage:"{timeField} cannot be used as the time field because it is not a field of type 'date' or 'date_nanos'.",values:{timeField:"'{{timeField}}'"}})},time_range_short:{status:el.c.WARNING,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.timeRangeShortHeading",{defaultMessage:"Time range"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.timeRangeShortMessage",{defaultMessage:"The selected or available time range might be too short. The recommended minimum time range should be at least {minTimeSpanReadable} and {bucketSpanCompareFactor} times the bucket span.",values:{minTimeSpanReadable:"{{minTimeSpanReadable}}",bucketSpanCompareFactor:"{{bucketSpanCompareFactor}}"}})},time_range_before_epoch:{status:el.c.WARNING,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.timeRangeBeforeEpochHeading",{defaultMessage:"Time range"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.timeRangeBeforeEpochMessage",{defaultMessage:"The selected or available time range contains data with timestamps before the UNIX epoch beginning. Timestamps before 01/01/1970 00:00:00 (UTC) are not supported for machine learning jobs."})},datafeed_preview_no_documents:{status:el.c.WARNING,heading:r.i18n.translate("xpack.ml.models.jobValidation.messages.datafeedPreviewNoDocumentsHeading",{defaultMessage:"Datafeed preview"}),text:r.i18n.translate("xpack.ml.models.jobValidation.messages.datafeedPreviewNoDocumentsMessage",{defaultMessage:"Running the datafeed preview over the current job configuration produces no results. If the index contains no documents this warning can be ignored, otherwise the job may be misconfigured."})},datafeed_preview_failed:{status:el.c.ERROR,text:r.i18n.translate("xpack.ml.models.jobValidation.messages.datafeedPreviewFailedMessage",{defaultMessage:"The datafeed preview failed. This may be due to an error in the job or datafeed configurations."})}}))),il=e=>{switch(e){case el.c.INFO:return"primary";case el.c.ERROR:return"danger";default:return e}},nl=e=>{switch(e){case el.c.INFO:return"iInCircle";case el.c.ERROR:return"cross";case el.c.SUCCESS:return"check";case el.c.WARNING:return"alert";default:return e}},sl=({url:e})=>Object(g.jsx)(o.EuiLink,{href:e,target:"_BLANK"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.validateJob.learnMoreLinkText",defaultMessage:"Learn more"})),ol=({text:e,url:t})=>Object(g.jsx)(s.a.Fragment,null,e," ",t&&Object(g.jsx)(sl,{url:t})),rl=({heading:e,status:t,text:a,url:i})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiCallOut,{"data-test-subj":"mlValidationCallout",color:il(t),size:"s",title:e||Object(g.jsx)(ol,{text:a,url:i}),iconType:t?nl(t):"questionInCircle"},e&&Object(g.jsx)(ol,{text:a,url:i})),Object(g.jsx)(o.EuiSpacer,{size:"m"})),ll="questionInCircle",cl=()=>({ui:{iconType:ll,isLoading:!0,isModalVisible:!1},data:{messages:[],success:!1},title:""}),dl=({messages:e,idFilterList:t})=>{const a=e.filter((e=>!1===t.includes(e.id))).map(((e,t)=>Object(g.jsx)(rl,_()({key:`${e.id}_${t}`},e)))),i=Object(g.jsx)(rl,{text:r.i18n.translate("xpack.ml.validateJob.allPassed",{defaultMessage:"All validation checks passed successfully"}),status:el.c.SUCCESS});return Object(g.jsx)(s.a.Fragment,null,a.length?a:i)},ul=()=>Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiLoadingSpinner,{size:"xl"}))),pl=({close:e,title:t,children:a})=>Object(g.jsx)(o.EuiModal,{onClose:e,style:{width:"800px"}},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,t)),Object(g.jsx)(o.EuiModalBody,null,a),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButton,{onClick:e,size:"s",fill:!0},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.validateJob.modal.closeButtonLabel",defaultMessage:"Close"}))));pl.propType={close:Zr.a.func.isRequired,title:Zr.a.string};class validate_job_view_ValidateJobUI extends n.Component{constructor(e){super(e),Y()(this,"closeModal",(()=>{const e=cl();e.ui.iconType=this.state.ui.iconType,this.setState(e)})),Y()(this,"validate",(()=>{const e=this.props.getJobConfig(),t=this.props.getDuration,a="function"==typeof t?t():void 0,i=this.props.fields;if("object"==typeof e)if("object"==typeof a&&null!==a.start&&null!==a.end){let t=!0;this.props.ml.validateJob({duration:a,fields:i,job:e}).then((a=>{const i=((e,t)=>{const a=al(t);return e.map((e=>{const t=e.id,i=a[t];return void 0!==i?(void 0!==i.heading&&(e.heading=Object(tl.c)(i.heading,e)),e.text=Object(tl.c)(i.text,e),void 0!==i.url&&(e.url=i.url),e.status=i.status):e.text=r.i18n.translate("xpack.ml.models.jobValidation.unknownMessageIdErrorMessage",{defaultMessage:"{messageId} (unknown message id)",values:{messageId:t}}),e}))})(a,Object(ee.e)());t=!1,i.some((e=>e.status===el.c.ERROR))&&i.push({id:"job_validation_includes_error",text:r.i18n.translate("xpack.ml.validateJob.jobValidationIncludesErrorText",{defaultMessage:"Job validation has failed, but you can still continue and create the job. Please be aware the job may encounter problems when running."}),status:el.c.WARNING}),this.setState({...this.state,ui:{...this.state.ui,iconType:nl(Object(It.b)(i)),isLoading:!1,isModalVisible:!0},data:{messages:i,success:!0},title:e.job_id}),"function"==typeof this.props.setIsValid&&this.props.setIsValid(!0)})).catch((e=>{const{toasts:t}=this.props.kibana.services.notifications;Object(Z.b)(t).displayErrorToast(e,r.i18n.translate("xpack.ml.jobService.validateJobErrorTitle",{defaultMessage:"Job Validation Error"}))})),setTimeout((()=>{t&&this.setState({...this.state,ui:{...this.state.ui,isLoading:!0,isModalVisible:!1}})}),250)}else this.setState({...this.state,ui:{...this.state.ui,iconType:nl(el.c.WARNING),isLoading:!1,isModalVisible:!0},data:{messages:[{id:"job_validation_skipped",text:r.i18n.translate("xpack.ml.validateJob.jobValidationSkippedText",{defaultMessage:"Job validation could not be run because of insufficient sample data. Please be aware the job may encounter problems when running."}),status:el.c.WARNING}],success:!0},title:e.job_id}),"function"==typeof this.props.setIsValid&&this.props.setIsValid(!0)})),this.state=cl()}componentDidMount(){!0===this.props.embedded&&this.validate()}render(){const e=Object(ee.e)().links.ml.anomalyDetectionJobTips,t=!1!==this.props.fill,a=!0===this.props.isCurrentJobConfig,i=!0===this.props.isDisabled,s=!0===this.props.embedded,r=this.props.idFilterList||[],l=this.state.ui.isLoading;return Object(g.jsx)(n.Fragment,null,!1===s?Object(g.jsx)("div",null,Object(g.jsx)(o.EuiButton,{onClick:this.validate,size:"s",fill:t,iconType:a?this.state.ui.iconType:ll,iconSide:"right",isDisabled:i,isLoading:l},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.validateJob.validateJobButtonLabel",defaultMessage:"Validate Job"})),!i&&this.state.ui.isModalVisible&&Object(g.jsx)(pl,{close:this.closeModal,title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.validateJob.modal.validateJobTitle",defaultMessage:"Validate job {title}",values:{title:this.state.title}})},l?Object(g.jsx)(ul,null):Object(g.jsx)(dl,{messages:this.state.data.messages,idFilterList:r}),Object(g.jsx)(o.EuiText,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.validateJob.modal.jobValidationDescriptionText",defaultMessage:"Job validation performs certain checks against job configurations and underlying source data and provides specific advice on how to adjust settings that are more likely to produce insightful results."})),Object(g.jsx)(o.EuiText,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.validateJob.modal.linkToJobTipsText",defaultMessage:"For more information, see {mlJobTipsLink}.",values:{mlJobTipsLink:Object(g.jsx)(o.EuiLink,{href:e,target:"_blank"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.validateJob.modal.linkToJobTipsText.mlJobTipsLinkText",defaultMessage:"Machine Learning Job Tips"}))}})))):Object(g.jsx)(n.Fragment,null,l?Object(g.jsx)(ul,null):Object(g.jsx)(dl,{messages:this.state.data.messages,idFilterList:r})))}}const ml=Object(c.withKibana)(validate_job_view_ValidateJobUI),bl=({nextActive:e,setCurrentStep:t})=>e?null:Object(g.jsx)(o.EuiButtonEmpty,{onClick:()=>t($n.SUMMARY),iconType:"arrowRight",iconSide:"right","data-test-subj":"mlJobWizardNavButtonPrevious"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.shopValidationButton",defaultMessage:"Skip validation"})),fl=["job_id_valid","job_group_id_valid","detectors_function_not_empty","success_bucket_span"],hl=({setCurrentStep:e,isCurrentStep:t})=>{const{jobCreator:a,jobCreatorUpdate:i,jobValidator:s}=Object(n.useContext)(Wn),[o,r]=Object(n.useState)(!1);return a.type===wt.f.ADVANCED&&fl.push("time_range_short","success_time_range"),Object(n.useEffect)((()=>{s.validate((()=>{}),!0),i()}),[]),Object(g.jsx)(n.Fragment,null,t&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(ml,{getJobConfig:function(){return{...a.jobConfig,datafeed_config:a.datafeedConfig}},getDuration:function(){return{start:a.start,end:a.end}},ml:X.ml,embedded:!0,setIsValid:function(e){s.advancedValid=e,r(e)},idFilterList:fl}),Object(g.jsx)(Yn,{previous:()=>e($n.JOB_DETAILS),next:()=>e($n.SUMMARY),nextActive:o},Object(g.jsx)(bl,{nextActive:o,setCurrentStep:e}))),!1===t&&Object(g.jsx)(n.Fragment,null))},gl=r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.trueLabel",{defaultMessage:"True"}),jl=r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.falseLabel",{defaultMessage:"False"}),xl=r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.defaultString",{defaultMessage:"default"}),vl=()=>Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobConfig.title",defaultMessage:"Job configuration"}))),yl=()=>Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.datafeedConfig.title",defaultMessage:"Datafeed configuration"}))),Ol=({children:e})=>Object(g.jsx)("span",{style:{fontStyle:"italic"}},e),El=()=>{const{jobCreator:e}=Object(n.useContext)(Wn),t=Object(Cn.b)().kibanaConfig.get("dateFormat"),{anomaly_detectors:a}=Object(A.c)(),i=Vt(e),s=a.model_memory_limit||"",l=null!==e.modelMemoryLimit?e.modelMemoryLimit:Object(g.jsx)(Ol,null,`${s} (${xl})`),c=[{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.jobDetails.title",{defaultMessage:"Job ID"}),description:e.jobId},{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.jobDescription.title",{defaultMessage:"Job description"}),description:e.description.length>0?e.description:Object(g.jsx)(Ol,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.jobDescription.placeholder",defaultMessage:"No description provided"}))},{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.groups.title",{defaultMessage:"Groups"}),description:e.groups.length>0?e.groups.join(", "):Object(g.jsx)(Ol,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.groups.placeholder",defaultMessage:"No groups selected"}))}],d=[{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.bucketSpan.title",{defaultMessage:"Bucket span"}),description:e.bucketSpan}];zt(e)&&d.push({title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.splitField.title",{defaultMessage:"Split field"}),description:zt(e)&&null!==e.splitField?e.splitField.name:Object(g.jsx)(Ol,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.splitField.placeholder",defaultMessage:"No split field selected"}))}),Bt(e)&&d.push({title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.populationField.title",{defaultMessage:"Population field"}),description:Bt(e)&&null!==e.populationField?e.populationField.name:Object(g.jsx)("span",{style:{fontStyle:null!==e.populationField?"inherit":"italic"}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.populationField.placeholder",defaultMessage:"No population field selected"}))}),i&&null!==e.categorizationFieldName&&d.push({title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.categorizationField.title",{defaultMessage:"Categorization field"}),description:e.categorizationFieldName}),i&&null!==e.summaryCountFieldName&&d.push({title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.summaryCountField.title",{defaultMessage:"Summary count field"}),description:e.summaryCountFieldName}),d.push({title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.influencers.title",{defaultMessage:"Influencers"}),description:e.influencers.length>0?e.influencers.join(", "):Object(g.jsx)(Ol,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.influencers.placeholder",defaultMessage:"No influencers selected"}))});const u=[{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.enableModelPlot.title",{defaultMessage:"Enable model plot"}),description:e.modelPlot?gl:jl},{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.useDedicatedIndex.title",{defaultMessage:"Use dedicated index"}),description:e.useDedicatedIndex?gl:jl},{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.modelMemoryLimit.title",{defaultMessage:"Model memory limit"}),description:l}],p=[{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.timeRange.start.title",{defaultMessage:"Start"}),description:Oe()(e.start).format(t)},{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.timeRange.end.title",{defaultMessage:"End"}),description:Oe()(e.end).format(t)}];return Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:c})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:d})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:u})),!1===i&&Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:p})))},wl=()=>{const{jobCreator:e}=Object(n.useContext)(Wn),{datafeeds:t}=Object(A.c)(),a=JSON.stringify(e.query,null,2),i=Object(Qe.f)(e.bucketSpanMs/1e3),s=t.scroll_size||"",l=e.queryDelay||Object(g.jsx)(Ol,null,`${wt.d} (${xl})`),c=e.frequency||Object(g.jsx)(Ol,null,`${i}s (${xl})`),d=null!==e.scrollSize?`${e.scrollSize}`:Object(g.jsx)(Ol,null,`${s} (${xl})`),u=[{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.timeField.title",{defaultMessage:"Time field"}),description:e.timeFieldName},{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.queryDelay.title",{defaultMessage:"Query delay"}),description:l},{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.frequency.title",{defaultMessage:"Frequency"}),description:c},{title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.scrollSize.title",{defaultMessage:"Scroll size"}),description:d}],p=r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.query.title",{defaultMessage:"Elasticsearch query"});return Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:p,fullWidth:!0},Object(g.jsx)(Ye.a,{value:a,height:"200px",readOnly:!0}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:u})))},Ml=()=>{const{jobCreator:e}=Object(n.useContext)(Wn);return Object(g.jsx)(n.Fragment,null,e.type===wt.f.SINGLE_METRIC&&Object(g.jsx)(Cs,{isActive:!1}),e.type===wt.f.MULTI_METRIC&&Object(g.jsx)(Gs,{isActive:!1}),e.type===wt.f.POPULATION&&Object(g.jsx)(Zs,{isActive:!1}),e.type===wt.f.ADVANCED&&Object(g.jsx)(Uo,{isActive:!1}),e.type===wt.f.CATEGORIZATION&&Object(g.jsx)(lr,{isActive:!1}),e.type===wt.f.RARE&&Object(g.jsx)(yr,{isActive:!1}))},Sl=({progress:e})=>e>0&&e<100?Object(g.jsx)(o.EuiProgress,{value:e,color:"primary",size:"xs",max:100}):null,_l=({jobRunner:e})=>{const{services:{notifications:t}}=Object(y.b)(),{jobCreator:a}=Object(n.useContext)(Wn),[i,s]=Object(n.useState)(ae.a.STOPPED),[l,c]=Object(n.useState)(!1);return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{isDisabled:i===ae.a.STARTING||i===ae.a.STARTED,onClick:async function(){const{toasts:i}=t;if(s(ae.a.STARTING),null!==e)try{const t=await e.startDatafeedInRealTime(!0);s(!0===t?ae.a.STARTED:ae.a.STOPPED),i.addSuccess({title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.postSaveOptions.startJobInRealTimeSuccess",{defaultMessage:"Job {jobId} started",values:{jobId:a.jobId}})})}catch(e){s(ae.a.STOPPED),i.addDanger({title:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.postSaveOptions.startJobInRealTimeError",{defaultMessage:"Error starting job"}),text:Object(da.b)(e)})}},"data-test-subj":"mlJobWizardButtonRunInRealTime"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.postSaveOptions.startJobInRealTime",defaultMessage:"Start job running in real time"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{isDisabled:i===ae.a.STOPPED||i===ae.a.STARTING,onClick:c.bind(null,!0),"data-test-subj":"mlJobWizardButtonCreateAlert"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.postSaveOptions.createAlert",defaultMessage:"Create alert rule"}))),i===ae.a.STARTED&&l&&Object(g.jsx)($e,{jobIds:[a.jobId],onCloseFlyout:c.bind(null,!1)}))},Tl=({startDatafeed:e,setStartDatafeed:t,disabled:a=!1})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiFormRow,{helpText:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.startDatafeedCheckboxHelpText",{defaultMessage:"If unselected, job can be started later from the jobs list."})},Object(g.jsx)(o.EuiSwitch,{"data-test-subj":"mlJobWizardStartDatafeedCheckbox",label:r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.startDatafeedCheckbox",{defaultMessage:"Start immediately"}),checked:e,onChange:e=>t(e.target.checked),disabled:a}))),Cl=({setCurrentStep:e,isCurrentStep:t})=>{const{services:{notifications:a,http:{basePath:i}}}=Object(y.b)(),s=Object(y.e)(),{jobCreator:l,jobValidator:c,jobValidatorUpdated:d,resultsLoader:u}=Object(n.useContext)(Wn),[p,b]=Object(n.useState)(u.progress),[f,h]=Object(n.useState)(!1),[j,x]=Object(n.useState)(c.validationSummary.basic),[v,O]=Object(n.useState)(null),[E,w]=Object(n.useState)(!0),[M,S]=Object(n.useState)(!1),_=Vt(l),T=_?Mr.EDITABLE:Mr.READONLY;async function C(e=!0){try{await l.createJob(),await l.createDatafeed(),Object(Mt.a)(e?l:null,s)}catch(e){k(e)}}function k(e){const{displayErrorToast:t}=Object(Z.b)(a.toasts);t(e,r.i18n.translate("xpack.ml.newJob.wizard.summaryStep.createJobError",{defaultMessage:"Job creation error"})),h(!1)}return Object(n.useEffect)((()=>{l.subscribeToProgress(b)}),[]),Object(n.useEffect)((()=>{let e=null;return null!==v&&(e=v.subscribeToJobAssignment((e=>S(!e)))),()=>{var t;null!==e&&(null===(t=e)||void 0===t||t.unsubscribe())}}),[v]),Object(n.useEffect)((()=>{x(c.validationSummary.basic)}),[d]),Object(g.jsx)(n.Fragment,null,t&&Object(g.jsx)(n.Fragment,null,_&&Object(g.jsx)(vl,null),Object(g.jsx)(Ml,null),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(Sl,{progress:p}),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(El,null),!1===_&&Object(g.jsx)(Tl,{startDatafeed:E,setStartDatafeed:w,disabled:f}),_&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,null),Object(g.jsx)(yl,null),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(wl,null)),Object(g.jsx)(o.EuiHorizontalRule,null),M&&Object(g.jsx)(Qi.b,{jobType:"anomaly-detector"}),Object(g.jsx)(o.EuiFlexGroup,null,p<100&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Xn,{previous:()=>e($n.VALIDATION),previousActive:!1===f&&!0===j})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:async function(){h(!0),_?await C():!0===E?await async function(){try{const e=await l.createAndStartJob();O(e)}catch(e){k(e)}}():await C(!1)},isDisabled:!0===f||!1===j,"data-test-subj":"mlJobWizardButtonCreateJob",fill:!0},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.createJobButton",defaultMessage:"Create job"})))),!1===f&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Sr,{isDisabled:p>0,jobEditorMode:T,datafeedEditorMode:T})),!1===_&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{onClick:()=>{Object(Mt.d)(l,s)}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.convertToAdvancedButton",defaultMessage:"Convert to advanced job"})))),p>0&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:function(){const e=K.a.createResultsUrl([l.jobId],l.start,l.end,!0===Pt(l)?"timeseriesexplorer":"explorer");s(`${i.get()}/app/ml/${e}`)},"data-test-subj":"mlJobWizardButtonViewResults"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.viewResultsButton",defaultMessage:"View results"})))),100===p&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:function(){Object(Mt.m)(l,s)},"data-test-subj":"mlJobWizardButtonResetJob"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.resetJobButton",defaultMessage:"Reset job"}))),Object(g.jsx)(_l,{jobRunner:v})))))},kl=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.query.title",{defaultMessage:"Elasticsearch query"});return Object(g.jsx)(o.EuiFormRow,{label:t,describedByIds:["description"],fullWidth:!0},Object(g.jsx)(s.a.Fragment,null,e))})),Fl=({setIsValidQuery:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:i}=Object(n.useContext)(Wn),s=t,[o,r]=Object(n.useState)(JSON.stringify(s.query,null,2));return Object(n.useEffect)((()=>{const t=Object(It.c)(o);e(t),t&&(s.query=JSON.parse(o),a())}),[o]),Object(n.useEffect)((()=>{if(Object(It.c)(o)){const e=JSON.parse(o),t=JSON.stringify(e,null,2),a=JSON.stringify(s.query,null,2);t!==a&&r(a)}}),[i]),Object(n.useEffect)((()=>{const t=Object(It.c)(o);e(t)}),[]),Object(g.jsx)(kl,null,Object(g.jsx)(Ye.a,{value:o,height:"400px",readOnly:!1,onChange:function(e){r(e)}}))},Il=Object(n.memo)((({children:e,validation:t})=>{const a=r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.queryDelay.title",{defaultMessage:"Query delay"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,a),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.queryDelay.description",defaultMessage:"Time delay in seconds, between current time and latest input data time."})},Object(g.jsx)(o.EuiFormRow,{label:a,error:t.message,isInvalid:!1===t.valid},Object(g.jsx)(s.a.Fragment,null,e)))}));function Dl(e){const[t,a]=Object(n.useState)(i(e));function i(e){return null===e?"":e}return{value:t,setValue:function(e){a(i(e))}}}const Al=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobValidator:a,jobValidatorUpdated:i}=Object(n.useContext)(Wn),[s,r]=Object(n.useState)(a.queryDelay),{value:l,setValue:c}=Dl(e.queryDelay);return Object(n.useEffect)((()=>{e.queryDelay=""===l?null:l,t()}),[l]),Object(n.useEffect)((()=>{c(null===e.queryDelay?"":e.queryDelay)}),[t]),Object(n.useEffect)((()=>{r(a.queryDelay)}),[i]),Object(g.jsx)(Il,{validation:s},Object(g.jsx)(o.EuiFieldText,{value:l,placeholder:wt.d,onChange:e=>c(e.target.value),isInvalid:!1===s.valid,"data-test-subj":"mlJobWizardInputQueryDelay"}))},Ll=Object(n.memo)((({children:e,validation:t})=>{const a=r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.frequency.title",{defaultMessage:"Frequency"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,a),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.frequency.description",defaultMessage:"The interval between searches."})},Object(g.jsx)(o.EuiFormRow,{label:a,error:t.message,isInvalid:!1===t.valid},Object(g.jsx)(s.a.Fragment,null,e)))})),Rl=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a,jobValidator:i,jobValidatorUpdated:s}=Object(n.useContext)(Wn),[r,l]=Object(n.useState)(i.frequency),{value:c,setValue:d}=Dl(e.frequency),[u,p]=Object(n.useState)(m());function m(){return`${Object(Qe.f)(e.bucketSpanMs/1e3)}s`}return Object(n.useEffect)((()=>{e.frequency=""===c?null:c,t()}),[c]),Object(n.useEffect)((()=>{d(e.frequency);const t=m();p(t)}),[a]),Object(n.useEffect)((()=>{l(i.frequency)}),[s]),Object(g.jsx)(Ll,{validation:r},Object(g.jsx)(o.EuiFieldText,{value:c,placeholder:u,onChange:e=>d(e.target.value),isInvalid:!1===r.valid,"data-test-subj":"mlJobWizardInputFrequency"}))},Nl=Object(n.memo)((({children:e,validation:t})=>{const a=r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.scrollSize.title",{defaultMessage:"Scroll size"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,a),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.scrollSize.description",defaultMessage:"The maximum number of documents to return in each search request."})},Object(g.jsx)(o.EuiFormRow,{label:a,error:t.message,isInvalid:!1===t.valid},Object(g.jsx)(s.a.Fragment,null,e)))})),Pl=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobValidator:a,jobValidatorUpdated:i}=Object(n.useContext)(Wn),[s,r]=Object(n.useState)(a.scrollSize),[l,c]=Object(n.useState)(null===e.scrollSize?"":`${e.scrollSize}`),{datafeeds:d}=Object(A.c)(),u=void 0!==d.scroll_size?`${d.scroll_size}`:"";return Object(n.useEffect)((()=>{e.scrollSize=""===l?null:+l,t()}),[l]),Object(n.useEffect)((()=>{c(null===e.scrollSize?"":`${e.scrollSize}`)}),[t]),Object(n.useEffect)((()=>{r(a.scrollSize)}),[i]),Object(g.jsx)(Nl,{validation:s},Object(g.jsx)(o.EuiFieldNumber,{min:0,placeholder:u,value:""===l?l:+l,onChange:e=>c(e.target.value),isInvalid:!1===s.valid,"data-test-subj":"mlJobWizardInputScrollSize"}))},zl=()=>{const{jobCreator:e,jobCreatorUpdate:t}=Object(n.useContext)(Wn),[a,i]=Object(n.useState)(!1),[l]=Object(n.useState)(JSON.stringify(Object(k.c)(),null,2)),c=()=>i(!1);return Object(g.jsx)(s.a.Fragment,null,a&&Object(g.jsx)(o.EuiConfirmModal,{title:r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.title",{defaultMessage:"Reset datafeed query"}),onCancel:c,onConfirm:function(){e.query=Object(k.c)(),t(),c()},cancelButtonText:r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.cancel",{defaultMessage:"Cancel"}),confirmButtonText:r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.confirm",{defaultMessage:"Confirm"}),defaultFocusedButton:"confirm"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.description",defaultMessage:"Set the datafeed query to be the default."}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiCodeBlock,{language:"js",fontSize:"m",paddingSize:"s"},l)),Object(g.jsx)(o.EuiButtonEmpty,{size:"s",onClick:()=>i(!0)},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.resetQueryButton",defaultMessage:"Reset datafeed query to default"})))},Bl=({fields:e,changeHandler:t,selectedField:a})=>{const{jobCreator:i}=Object(n.useContext)(Wn),s=Object(Mt.g)(e,i.additionalFields),r=[];return null!==a&&r.push({label:a}),Object(g.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:s,selectedOptions:r,onChange:function(e){const a=e[0];void 0!==a&&t(a.label)},isClearable:!1,"data-test-subj":"mlTimeFieldNameSelect"})},Vl=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.timeField.title",{defaultMessage:"Time field"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.timeField.description",defaultMessage:"The default time field for the data view is automatically selected, but can be overridden."})},Object(g.jsx)(o.EuiFormRow,{label:t},Object(g.jsx)(s.a.Fragment,null,e)))})),Jl=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(n.useContext)(Wn),i=e,{dateFields:s}=Hn.a,[o,r]=Object(n.useState)(i.timeFieldName);return Object(n.useEffect)((()=>{i.timeFieldName=o,t()}),[o]),Object(n.useEffect)((()=>{r(i.timeFieldName)}),[a]),Object(g.jsx)(Vl,null,Object(g.jsx)(Bl,{fields:s,changeHandler:r,selectedField:o}))},Ul=Object(n.memo)((({children:e})=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.title",{defaultMessage:"Data view"});return Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h3",null,t),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.description",defaultMessage:"The data view that is currently used for this job."})},Object(g.jsx)(o.EuiFormRow,null,Object(g.jsx)(s.a.Fragment,null,e)))}));var Gl;!function(e){e[e.PICK_DATA_VIEW=0]="PICK_DATA_VIEW",e[e.VALIDATE=1]="VALIDATE"}(Gl||(Gl={}));const ql=({onClose:e})=>{const{services:{savedObjects:t,uiSettings:a,data:{dataViews:i}}}=Object(y.b)(),l=Object(y.e)(),{validateDatafeedPreview:c}=Object(y.a)(),{jobCreator:d}=Object(n.useContext)(Wn),u=d,[p,b]=Object(n.useState)(!1),[f,h]=Object(n.useState)(Gl.PICK_DATA_VIEW),[j,x]=Object(n.useState)(""),[v,O]=Object(n.useState)(""),[E,w]=Object(n.useState)(null);Object(n.useEffect)((function(){x(u.indexPatternTitle)}),[]),Object(n.useEffect)((function(){f===Gl.PICK_DATA_VIEW&&w(null)}),[f]);const M=Object(n.useCallback)((async e=>{b(!0);const{title:t}=await i.get(e);O(t);const a=t.split(",");if(u.detectors.length){const e={...u.datafeedConfig,indices:a},t=await c({job:{...u.jobConfig,datafeed_config:e}});w(t)}b(!1)}),[i,c,u]),S=Object(n.useCallback)((()=>{const e=v.split(",");u.indices=e,Object(Mt.l)(u,l)}),[u,v,l]);return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiModal,{onClose:e,"data-test-subj":"mlJobMgmtImportJobsFlyout"},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step0.title",defaultMessage:"Change data view"}))),Object(g.jsx)(o.EuiModalBody,null,f===Gl.PICK_DATA_VIEW&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step1.title",defaultMessage:"Select new data view for the job"}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(bn.SavedObjectFinderUi,{key:"searchSavedObjectFinder",onChoose:function(e){!1===p&&(h(Gl.VALIDATE),M(e))},showFilter:!0,noItemsMessage:r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.step1.noMatchingError",{defaultMessage:"No matching indices or saved searches found."}),savedObjectMetaData:[{type:"index-pattern",getIconForSavedObject:()=>"indexPatternApp",name:r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.step1.dataView",{defaultMessage:"Data view"}),defaultSearchField:"name"}],fixedPageSize:8,uiSettings:a,savedObjects:t})),f===Gl.VALIDATE&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step2.title",defaultMessage:"Changing {dv1} for {dv2}",values:{dv1:j,dv2:v}}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),!0===p?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiLoadingSpinner,null),Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step2.validatingText",defaultMessage:"Checking data view and job compatibility"})):Object(g.jsx)($l,{validationResponse:E,dataViewTitle:v}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{onClick:h.bind(null,Gl.PICK_DATA_VIEW),isDisabled:p,flush:"left"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step2.backButton",defaultMessage:"Back"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:()=>S(),isDisabled:p,"data-test-subj":"mlJobsImportButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step2.ApplyButton",defaultMessage:"Apply"}))))))))},$l=({validationResponse:e,dataViewTitle:t})=>null===e?Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.validation.noDetectors.title",{defaultMessage:"Data view valid"}),color:"primary"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.noDetectors.message",defaultMessage:"No detectors have been configured; this data view can be applied to the job."})):!0===e.valid?!0===e.documentsFound?Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.validation.valid.title",{defaultMessage:"Data view valid"}),color:"primary"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.valid.message",defaultMessage:"This data view can be applied to this job."})):Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.validation.possiblyInvalid.title",{defaultMessage:"Data view possibly invalid"}),color:"warning"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.possiblyInvalid.message",defaultMessage:"This data view produced no results when previewing the datafeed. There may be no documents in {dataViewTitle}.",values:{dataViewTitle:t}})):Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.validation.invalid.title",{defaultMessage:"Data view invalid"}),color:"danger"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.invalid.message",defaultMessage:"This data view produced an error when attempting to preview the datafeed. The fields selected for this job might not exist in {dataViewTitle}.",values:{dataViewTitle:t}}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.invalid.reason",defaultMessage:"Reason:"}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),e.error?Object(da.b)(e.error):null),Wl=({isDisabled:e})=>{const[t,a]=Object(n.useState)(!1);return Object(g.jsx)(s.a.Fragment,null,t&&Object(g.jsx)(ql,{onClose:a.bind(null,!1)}),Object(g.jsx)(Ul,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:a.bind(null,!0),isDisabled:e,"data-test-subj":"mlJobsImportButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.changeDataView.button",defaultMessage:"Change data view"}))))},Hl=({setCurrentStep:e,isCurrentStep:t})=>{const{jobValidator:a,jobValidatorUpdated:i}=Object(n.useContext)(Wn),[s,r]=Object(n.useState)(!1),[l,c]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{const e=l&&a.queryDelay.valid&&a.frequency.valid&&a.scrollSize.valid&&!1===a.validating;r(e)}),[i,l]),Object(g.jsx)(n.Fragment,null,t&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,{"data-test-subj":"mlAdvancedDatafeedQueryEditor"},Object(g.jsx)(Fl,{setIsValidQuery:c})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Al,null),Object(g.jsx)(Rl,null),Object(g.jsx)(Pl,null),Object(g.jsx)(Jl,null),Object(g.jsx)(Wl,{isDisabled:!1}))),Object(g.jsx)(zl,null),Object(g.jsx)(Yn,{next:()=>e($n.PICK_FIELDS),nextActive:s},Object(g.jsx)(Sr,{isDisabled:!1,jobEditorMode:Mr.EDITABLE,datafeedEditorMode:Mr.EDITABLE}))))},Yl=({currentStep:e,setCurrentStep:t})=>{const a=Object(Cn.b)(),[i,s]=Object(n.useState)(!1),[o,l]=Object(n.useState)(!1);return Object(g.jsx)(n.Fragment,null,e===$n.TIME_RANGE&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Xl,{"data-test-subj":"mlJobWizardStepTitleTimeRange"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.timeRangeTitle",defaultMessage:"Time range"})),Object(g.jsx)(ls,{isCurrentStep:e===$n.TIME_RANGE,setCurrentStep:t})),e===$n.ADVANCED_CONFIGURE_DATAFEED&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Xl,{"data-test-subj":"mlJobWizardStepTitleConfigureDatafeed"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.configureDatafeedTitle",defaultMessage:"Configure datafeed"})),Object(g.jsx)(Hl,{isCurrentStep:e===$n.ADVANCED_CONFIGURE_DATAFEED,setCurrentStep:t})),e===$n.PICK_FIELDS&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Xl,{"data-test-subj":"mlJobWizardStepTitlePickFields"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.pickFieldsTitle",defaultMessage:"Pick fields"})),Object(g.jsx)(Cr,{isCurrentStep:e===$n.PICK_FIELDS,setCurrentStep:t})),e===$n.JOB_DETAILS&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Xl,{"data-test-subj":"mlJobWizardStepTitleJobDetails"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.jobDetailsTitle",defaultMessage:"Job details"})),Object(g.jsx)(Qr,{isCurrentStep:e===$n.JOB_DETAILS,setCurrentStep:t,advancedExpanded:i,setAdvancedExpanded:s,additionalExpanded:o,setAdditionalExpanded:l})),e===$n.VALIDATION&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Xl,{"data-test-subj":"mlJobWizardStepTitleValidation"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.validationTitle",defaultMessage:"Validation"})),Object(g.jsx)(hl,{isCurrentStep:e===$n.VALIDATION,setCurrentStep:t})),e===$n.SUMMARY&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Xl,{"data-test-subj":"mlJobWizardStepTitleSummary"},null!==a.currentSavedSearch?r.i18n.translate("xpack.ml.newJob.wizard.stepComponentWrapper.summaryTitleSavedSearch",{defaultMessage:"New job from saved search {title}",values:{title:a.currentSavedSearch.attributes.title}}):void 0!==a.currentDataView.id?r.i18n.translate("xpack.ml.newJob.wizard.stepComponentWrapper.summaryTitleDataView",{defaultMessage:"New job from data view {dataViewName}",values:{dataViewName:a.currentDataView.title}}):""),Object(g.jsx)(Cl,{isCurrentStep:e===$n.SUMMARY,setCurrentStep:t})))},Xl=({"data-test-subj":e,children:t})=>Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h2",{"data-test-subj":e},t)),Object(g.jsx)(o.EuiSpacer,null)),Ql=({currentStep:e,highestStep:t,setCurrentStep:a,disableSteps:i,jobType:n})=>{const s=[{title:r.i18n.translate("xpack.ml.newJob.wizard.step.timeRangeTitle",{defaultMessage:"Time range"}),...l($n.TIME_RANGE)},{title:r.i18n.translate("xpack.ml.newJob.wizard.step.pickFieldsTitle",{defaultMessage:"Pick fields"}),...l($n.PICK_FIELDS)},{title:r.i18n.translate("xpack.ml.newJob.wizard.step.jobDetailsTitle",{defaultMessage:"Job details"}),...l($n.JOB_DETAILS)},{title:r.i18n.translate("xpack.ml.newJob.wizard.step.validationTitle",{defaultMessage:"Validation"}),...l($n.VALIDATION)},{title:r.i18n.translate("xpack.ml.newJob.wizard.step.summaryTitle",{defaultMessage:"Summary"}),...l($n.SUMMARY)}];function l(n){return{onClick:()=>function(e){e<=t&&a(e)}(n),status:e===n?"selected":e>n?"complete":"incomplete",disabled:i||t<n}}return n===wt.f.ADVANCED&&s.splice(0,1,{title:r.i18n.translate("xpack.ml.newJob.wizard.step.configureDatafeedTitle",{defaultMessage:"Configure datafeed"}),...l($n.ADVANCED_CONFIGURE_DATAFEED)}),Object(g.jsx)(o.EuiStepsHorizontal,{steps:s,style:{backgroundColor:"inherit"}})},Kl=({jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:i,jobValidator:s,existingJobsAndGroups:o,firstWizardStep:l=$n.TIME_RANGE})=>{const[c,d]=Object(n.useState)(0),u=Object(n.useCallback)((()=>{d((e=>e+1))}),[]),[p,m]=Object(n.useState)(0),b=Object(n.useCallback)((()=>{m((e=>e+1))}),[]),f={jobCreatorUpdated:c,jobCreatorUpdate:u,jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:i,jobValidator:s,jobValidatorUpdated:p,fields:Hn.a.fields,aggs:Hn.a.aggs,existingJobsAndGroups:o},h=e.type===wt.f.ADVANCED?$n.ADVANCED_CONFIGURE_DATAFEED:$n.TIME_RANGE,[j,x]=Object(n.useState)(h),[v,O]=Object(n.useState)(h),[E,w]=Object(n.useState)(!1),[M,S]=Object(n.useState)(a.progress),[_,T]=Object(n.useState)(Zl(e.jobConfig,e.datafeedConfig));return Object(n.useEffect)((()=>{const e=s.validationResult$.subscribe((()=>{b()}));return()=>e.unsubscribe()}),[s]),Object(n.useEffect)((()=>{s.validate((()=>{b()}));const t=Zl(e.jobConfig,e.datafeedConfig);t!==_&&(O(j),T(t))}),[c]),Object(n.useEffect)((()=>{e.subscribeToProgress(S),x(l)}),[]),Object(n.useEffect)((()=>{w(M>0)}),[M]),Object(n.useEffect)((()=>{j>=v&&O(j)}),[j]),((e,t,a,i)=>{const{services:{notifications:s}}=Object(y.b)(),o=Object(n.useMemo)((()=>((e,t)=>{const a=new at.Subject,i=new at.Subject;return{get error$(){return i.asObservable()},get updates$(){return Object(at.combineLatest)([e.wizardInitialized$.pipe(Object(za.skipWhile)((e=>!1===e))),a]).pipe(Object(za.map)((([,e])=>e)),Object(za.debounceTime)(600),Object(za.map)(Q.cloneDeep),Object(za.distinctUntilChanged)(Q.isEqual),Object(za.filter)((()=>t.isModelMemoryEstimationPayloadValid)),Object(za.switchMap)((e=>X.ml.calculateModelMemoryLimit$(e).pipe(Object(za.pluck)("modelMemoryLimit"),Object(za.catchError)((e=>(console.error("Model memory limit could not be calculated",e.body),i.next(e),Object(at.of)(wt.c))))))))},update(e){a.next(e)}}})(e,t)),[e,t]);Object(n.useEffect)((()=>{const t=new at.Subscription;return t.add(o.updates$.pipe(Object(za.startWith)(e.modelMemoryLimit),Object(za.pairwise)()).subscribe((([t,i])=>{null!==e.modelMemoryLimit&&e.modelMemoryLimit!==t||(e.modelMemoryLimit=i,a())}))),t.add(o.error$.subscribe((e=>{s.toasts.addWarning({title:r.i18n.translate("xpack.ml.newJob.wizard.estimateModelMemoryError",{defaultMessage:"Model memory limit could not be calculated"}),text:Object(da.b)(e)})}))),()=>{t.unsubscribe()}}),[o]),Object(n.useEffect)((()=>{o.update({datafeedConfig:e.datafeedConfig,analysisConfig:e.jobConfig.analysis_config,indexPattern:e.indexPatternTitle,query:e.datafeedConfig.query,timeFieldName:e.jobConfig.data_description.time_field,earliestMs:e.start,latestMs:e.end})}),[e,i])})(e,s,u,c),Object(g.jsx)(Wn.Provider,{value:f},Object(g.jsx)(Ql,{currentStep:j,highestStep:v,setCurrentStep:x,disableSteps:E,jobType:e.type}),Object(g.jsx)(Yl,{currentStep:j,setCurrentStep:x}))};function Zl(e,t){return JSON.stringify(e)+JSON.stringify(t)}function ec(e,t,a,i,n,s){return new Promise(((o,r)=>{X.ml.esSearch({index:e,size:0,body:{query:i,aggs:{catFields:{terms:{field:t,size:a}}},...void 0!==n?{runtime_mappings:n}:{}},...null!=s?s:{}}).then((e=>{const t=Object(Q.get)(e,["aggregations","catFields","buckets"],[]);o({success:!0,results:t.map((e=>e.key))})})).catch((e=>{r(e)}))}))}const tc=(e,t)=>Object(Q.isEqual)(e,t);class chart_loader_ChartLoader{constructor(e,t){Y()(this,"_indexPatternTitle",""),Y()(this,"_timeFieldName",""),Y()(this,"_query",{}),Y()(this,"_newJobLineChart",Ze()(X.ml.jobs.newJobLineChart,tc)),Y()(this,"_newJobPopulationsChart",Ze()(X.ml.jobs.newJobPopulationsChart,tc)),Y()(this,"_getEventRateData",Ze()(mt.mlResultsService.getEventRateData,tc)),Y()(this,"_getCategoryFields",Ze()(ec,tc)),this._indexPatternTitle=e.title,this._query=t,"string"==typeof e.timeFieldName&&(this._timeFieldName=e.timeFieldName)}async loadLineCharts(e,t,a,i,n,s,o,r){if(""!==this._timeFieldName){if(!1===Object(Mt.b)(a))return{};const l=null!==i?i.name:null,c=a.map(ac);return(await this._newJobLineChart(this._indexPatternTitle,this._timeFieldName,e,t,s,this._query,c,l,n,null!=o?o:void 0,r)).results}return{}}async loadPopulationCharts(e,t,a,i,n,s,o){if(""!==this._timeFieldName){if(!1===Object(Mt.b)(a))return{};const r=null!==i?i.name:"",l=a.map(ac);return(await this._newJobPopulationsChart(this._indexPatternTitle,this._timeFieldName,e,t,n,this._query,l,r,null!=s?s:void 0,o)).results}return{}}async loadEventRateChart(e,t,a,i,n){if(""!==this._timeFieldName){const s=await this._getEventRateData(this._indexPatternTitle,this._query,this._timeFieldName,e,t,3*a,i,n);if(void 0!==s.error)throw s.error;return Object.entries(s.results).map((([e,t])=>({time:+e,value:t})))}return[]}async loadFieldExampleValues(e,t,a){const{results:i}=await this._getCategoryFields(this._indexPatternTitle,e.name,10,this._query,null!=t?t:void 0,a);return i}}function ac(e){const t=void 0!==e.by&&null!==e.by.field&&null!==e.by.value?{field:e.by.field.id,value:e.by.value}:{field:null,value:null};return{agg:e.agg.dslName||"",field:e.field.id,by:t}}const ic=({existingJobsAndGroups:e,jobType:t})=>{const a=Object(Cn.b)(),i=Object(Bn.a)(),s=Object(n.useMemo)((()=>(e=>(t,a,i)=>{let n;switch(e){case wt.f.SINGLE_METRIC:n=single_metric_job_creator_SingleMetricJobCreator;break;case wt.f.MULTI_METRIC:n=multi_metric_job_creator_MultiMetricJobCreator;break;case wt.f.POPULATION:n=population_job_creator_PopulationJobCreator;break;case wt.f.ADVANCED:n=advanced_job_creator_AdvancedJobCreator;break;case wt.f.CATEGORIZATION:n=categorization_job_creator_CategorizationJobCreator;break;case wt.f.RARE:n=rare_job_creator_RareJobCreator;break;default:n=single_metric_job_creator_SingleMetricJobCreator}return new n(t,a,i)})(t)(a.currentDataView,a.currentSavedSearch,a.combinedQuery)),[t]),l=Object(n.useMemo)((()=>new job_validator_JobValidator(s)),[s]),{displayErrorToast:c}=Object(Z.c)(),{from:d,to:u}=es();s.setTimeRange(d,u);let p=t===wt.f.ADVANCED?$n.ADVANCED_CONFIGURE_DATAFEED:$n.TIME_RANGE,b=K.a.tempJobCloningObjects.autoSetTimeRange;if(K.a.tempJobCloningObjects.autoSetTimeRange=!1,void 0!==K.a.tempJobCloningObjects.job&&void 0!==K.a.tempJobCloningObjects.datafeed){const e=K.a.tempJobCloningObjects.job,a=K.a.cloneDatafeed(K.a.tempJobCloningObjects.datafeed);f(),s.cloneFromExistingJob(e,a),!1===K.a.tempJobCloningObjects.skipTimeRangeStep?s.jobId="":t!==wt.f.ADVANCED&&(p=$n.PICK_FIELDS),K.a.tempJobCloningObjects.skipTimeRangeStep=!1,K.a.tempJobCloningObjects.job=void 0,K.a.tempJobCloningObjects.datafeed=void 0,K.a.tempJobCloningObjects.createdBy=void 0,void 0!==K.a.tempJobCloningObjects.start&&void 0!==K.a.tempJobCloningObjects.end?(s.setTimeRange(K.a.tempJobCloningObjects.start,K.a.tempJobCloningObjects.end),K.a.tempJobCloningObjects.start=void 0,K.a.tempJobCloningObjects.end=void 0):b=b||Vt(s),K.a.tempJobCloningObjects.calendars&&(s.calendars=K.a.tempJobCloningObjects.calendars,K.a.tempJobCloningObjects.calendars=void 0)}else if(s.bucketSpan=wt.b,s.type!==wt.f.POPULATION&&s.type!==wt.f.ADVANCED&&s.type!==wt.f.CATEGORIZATION&&(s.modelMemoryLimit=wt.c),s.type===wt.f.SINGLE_METRIC&&(s.modelPlot=!0,s.modelChangeAnnotations=!0),null!==a.currentSavedSearch&&(s.createdBy=null),b=Vt(s),f(),Jt(s)){const{catFields:e}=Hn.a;1===e.length&&(s.categorizationFieldName=e[0].name)}function f(){if(Jt(s)){const e=Hn.a.getAggById("count"),t=Hn.a.getAggById("rare"),a=Hn.a.getFieldById(Dt.a);s.setDefaultDetectorProperties(e,t,a);const{anomaly_detectors:i}=Object(A.c)();s.categorizationAnalyzer=i.categorization_analyzer}else if(Ut(s)){const e=Hn.a.getAggById("rare"),t=Hn.a.getAggById("freq_rare");s.setDefaultDetectorProperties(e,t)}}b&&s.autoSetTimeRange().catch((e=>{const t=r.i18n.translate("xpack.ml.newJob.wizard.autoSetJobCreatorTimeRange.error",{defaultMessage:"Error retrieving beginning and end times of index"});c(e,t)})),i.setBarTarget(600),i.setMaxBars(1200),i.setInterval("auto");const h=Object(n.useMemo)((()=>new chart_loader_ChartLoader(a.currentDataView,s.query)),[a.currentDataView,s.query]),j=Object(n.useMemo)((()=>new results_loader_ResultsLoader(s,i,h)),[s,i,h]);Object(n.useEffect)((()=>()=>{s.forceStopRefreshPolls()}));const x=Object(Mt.i)(s);return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.page.createJob",defaultMessage:"Create job"}),":"," ",x),Object(g.jsx)("div",{style:{backgroundColor:"inherit"},"data-test-subj":`mlPageJobWizard ${t}`},Object(g.jsx)(o.EuiPageContentHeader_Deprecated,null,Object(g.jsx)(o.EuiPageContentHeaderSection_Deprecated,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.page.createJob.dataViewName",defaultMessage:"Using data view {dataViewName}",values:{dataViewName:s.indexPatternDisplayName}}))),Object(g.jsx)(Kl,{jobCreator:s,chartLoader:h,resultsLoader:j,chartInterval:i,jobValidator:l,existingJobsAndGroups:e,firstWizardStep:p})))};var nc=a(150);const sc="anomaly-detector";function oc(e,t,a,i){return new Promise((async(n,s)=>{try{const o=i===sc?Hn.a:nc.a;if(void 0!==e){const t=await a.get(e);await o.initializeFromDataVIew(t),n(o.newJobCaps)}else if(void 0!==t){const{dataView:e}=await Object(C.b)(t);if(null===e)return console.error("Cannot retrieve data view from saved search"),void s();await o.initializeFromDataVIew(e),n(o.newJobCaps)}else s()}catch(e){s(e)}}))}const rc=(e,t)=>[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),N("CREATE_JOB_BREADCRUMB",e,t)],lc=(e,t)=>[...rc(e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.singleMetricLabel",{defaultMessage:"Single metric"}),href:""}],cc=(e,t)=>[...rc(e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.multiMetricLabel",{defaultMessage:"Multi-metric"}),href:""}],dc=(e,t)=>[...rc(e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.populationLabel",{defaultMessage:"Population"}),href:""}],uc=(e,t)=>[...rc(e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.advancedConfigurationLabel",{defaultMessage:"Advanced configuration"}),href:""}],pc=(e,t)=>[...rc(e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.categorizationLabel",{defaultMessage:"Categorization"}),href:""}],mc=(e,t)=>[...rc(e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.rareLabel",{defaultMessage:"Rare"}),href:""}],bc=(e,t)=>({path:"/jobs/new_job/single_metric",render:(e,t)=>Object(g.jsx)(Oc,_()({},e,{jobType:wt.f.SINGLE_METRIC,deps:t})),breadcrumbs:lc(e,t)}),fc=(e,t)=>({path:"/jobs/new_job/multi_metric",render:(e,t)=>Object(g.jsx)(Oc,_()({},e,{jobType:wt.f.MULTI_METRIC,deps:t})),breadcrumbs:cc(e,t)}),hc=()=>({path:"/jobs/new_job/convert_to_multi_metric",render:e=>Object(g.jsx)(l.Redirect,{to:`/jobs/new_job/multi_metric${e.location.search}`}),breadcrumbs:[]}),gc=(e,t)=>({path:"/jobs/new_job/population",render:(e,t)=>Object(g.jsx)(Oc,_()({},e,{jobType:wt.f.POPULATION,deps:t})),breadcrumbs:dc(e,t)}),jc=(e,t)=>({path:"/jobs/new_job/advanced",render:(e,t)=>Object(g.jsx)(Oc,_()({},e,{jobType:wt.f.ADVANCED,deps:t})),breadcrumbs:uc(e,t)}),xc=()=>({path:"/jobs/new_job/convert_to_advanced",render:e=>Object(g.jsx)(l.Redirect,{to:`/jobs/new_job/advanced${e.location.search}`}),breadcrumbs:[]}),vc=(e,t)=>({path:"/jobs/new_job/categorization",render:(e,t)=>Object(g.jsx)(Oc,_()({},e,{jobType:wt.f.CATEGORIZATION,deps:t})),breadcrumbs:pc(e,t)}),yc=(e,t)=>({path:"/jobs/new_job/rare",render:(e,t)=>Object(g.jsx)(Oc,_()({},e,{jobType:wt.f.RARE,deps:t})),breadcrumbs:mc(e,t)}),Oc=({location:e,jobType:t,deps:a})=>{const i=Object(F.a)(E.b.ANOMALY_DETECTION_JOBS_MANAGE),{index:n,savedSearchId:s}=Object(Tn.parse)(e.search,{sort:!1}),{context:o,results:r}=I(n,s,a.config,a.dataViewsContract,{...W(a),privileges:()=>Object(w.a)(i),jobCaps:()=>oc(n,s,a.dataViewsContract,sc),existingJobsAndGroups:K.a.getJobAndGroupIds});return Object(g.jsx)(T.b,{context:o},Object(g.jsx)(ic,{jobType:t,existingJobsAndGroups:r.existingJobsAndGroups}))},Ec=Object(n.memo)((({saveState:e,resultsUrl:t,onReset:a})=>e===Ic.NOT_SAVED?null:Object(g.jsx)(s.a.Fragment,null,e===Ic.SAVED&&Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobsCreatedTitle",defaultMessage:"Jobs created"}),color:"success",iconType:"checkInCircleFilled"}),e===Ic.FAILED&&Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.simple.recognize.jobsCreationFailedTitle",defaultMessage:"Jobs creation failed"}),color:"danger",iconType:"alert"}),e===Ic.PARTIAL_FAILURE&&Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.someJobsCreationFailedTitle",defaultMessage:"Some jobs failed to be created"}),color:"warning",iconType:"alert"}),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center"},e!==Ic.SAVING&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{color:"primary",fill:!1,"aria-label":r.i18n.translate("xpack.ml.newJob.recognize.jobsCreationFailed.resetButtonAriaLabel",{defaultMessage:"Reset"}),onClick:a},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.someJobsCreationFailed.resetButtonLabel",defaultMessage:"Reset"}))),(e===Ic.SAVED||e===Ic.PARTIAL_FAILURE)&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{color:"primary",fill:!0,href:t,"aria-label":r.i18n.translate("xpack.ml.newJob.recognize.viewResultsAriaLabel",{defaultMessage:"View results"})},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.viewResultsLinkText",defaultMessage:"View results"}))))))),wc=Object(n.memo)((({objectType:e,kibanaObjects:t,isSaving:a})=>{const i={dashboard:r.i18n.translate("xpack.ml.newJob.recognize.dashboardsLabel",{defaultMessage:"Dashboards"}),search:r.i18n.translate("xpack.ml.newJob.recognize.searchesLabel",{defaultMessage:"Searches"}),visualization:r.i18n.translate("xpack.ml.newJob.recognize.visualizationsLabel",{defaultMessage:"Visualizations"})};return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h4",null,i[e])),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)("ul",null,t.map((({id:e,title:i,success:n,exists:s,error:l},c)=>Object(g.jsx)("li",{key:e},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"s",color:s?"subdued":"success"},i),!1===n&&void 0!==l&&Object(g.jsx)(o.EuiText,{size:"xs",color:"danger"},Object(da.b)(l))),s&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"default"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.alreadyExistsLabel",defaultMessage:"(already exists)"}))))),!s&&Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{width:"60px"}},Object(g.jsx)(o.EuiText,{textAlign:"center"},a?Object(g.jsx)(o.EuiLoadingSpinner,{size:"m"}):null,void 0!==n?Object(g.jsx)(o.EuiIcon,{type:n?"check":"cross",color:n?"success":"danger","aria-label":n?r.i18n.translate("xpack.ml.newJob.recognize.results.savedAriaLabel",{defaultMessage:"Saved"}):r.i18n.translate("xpack.ml.newJob.recognize.results.saveFailedAriaLabel",{defaultMessage:"Save failed"})}):null))),(1===t.length||c<t.length-1)&&Object(g.jsx)(o.EuiHorizontalRule,{margin:"s"}))))))})),Mc=Object(n.memo)((({job:e,jobOverride:t,isSaving:a,jobPrefix:i,onEditRequest:n})=>{const{id:s,config:{description:l,groups:c},datafeedResult:d,setupResult:u}=e,p=t&&t.groups||c;return Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",justifyContent:"spaceBetween",responsive:!1},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"s",color:"success"},i,s)),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiToolTip,{position:"right",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.job.overrideJobConfigurationLabel",defaultMessage:"Override job configuration"})},Object(g.jsx)(o.EuiButtonIcon,{"aria-label":r.i18n.translate("xpack.ml.newJob.recognize.job.overrideJobConfigurationLabel",{defaultMessage:"Override job configuration"}),iconType:"pencil",onClick:()=>n(e)})))),Object(g.jsx)(o.EuiText,{size:"s",color:"subdued"},l),Object(g.jsx)(o.EuiFlexGroup,{wrap:!0,responsive:!1,gutterSize:"xs"},(null!=p?p:[]).map((e=>Object(g.jsx)(o.EuiFlexItem,{grow:!1,key:e},Object(g.jsx)(o.EuiBadge,{color:Object(Xa.a)(e)},e))))),u&&u.error&&Object(g.jsx)(o.EuiText,{size:"xs",color:"danger"},Object(da.b)(u.error)),d&&d.error&&Object(g.jsx)(o.EuiText,{size:"xs",color:"danger"},Object(da.b)(d.error))),Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{width:Cc}},a&&Object(g.jsx)(o.EuiLoadingSpinner,{size:"m"}),u&&d&&Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s",wrap:!1,responsive:!1,justifyContent:"spaceAround"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIcon,{type:u.success?"check":"cross",color:u.success?"success":"danger",size:"m","aria-label":u.success?r.i18n.translate("xpack.ml.newJob.recognize.job.savedAriaLabel",{defaultMessage:"Saved"}):r.i18n.translate("xpack.ml.newJob.recognize.job.saveFailedAriaLabel",{defaultMessage:"Save failed"})})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIcon,{type:d.success?"check":"cross",color:d.success?"success":"danger",size:"m","aria-label":u.success?r.i18n.translate("xpack.ml.newJob.recognize.datafeed.savedAriaLabel",{defaultMessage:"Saved"}):r.i18n.translate("xpack.ml.newJob.recognize.datafeed.saveFailedAriaLabel",{defaultMessage:"Save failed"})})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIcon,{type:Sc(d).type,color:Sc(d).color,size:"m","aria-label":u.success?r.i18n.translate("xpack.ml.newJob.recognize.running.startedAriaLabel",{defaultMessage:"Started"}):r.i18n.translate("xpack.ml.newJob.recognize.running.startFailedAriaLabel",{defaultMessage:"Start failed"})})))))}));function Sc({awaitingMlNodeAllocation:e,success:t}){return!0===e?{type:"alert",color:"warning"}:t?{type:"check",color:"success"}:{type:"cross",color:"danger"}}var _c=a(20);const Tc=({job:e,jobOverride:t,existingGroupIds:a,onClose:i})=>{var s;const[r,l]=function(e){const[t,a]=Object(n.useState)(e);return[t,e=>{a({...t,...e})}]}({jobGroups:t&&t.groups||e.config.groups}),[c,d]=Object(n.useState)({}),u=Object(_c.a)((e=>Object(Qe.k)(e)?null:{pattern:!0}),Object(_c.b)(el.b));return Object(n.useEffect)((()=>{(()=>{var e;const t=(null!==(e=r.jobGroups)&&void 0!==e?e:[]).map((e=>u(e))).filter((e=>null!==e));d({jobGroups:t,formValid:0===t.length})})()}),[r.jobGroups]),Object(g.jsx)(o.EuiFlyout,{onClose:()=>i(null)},Object(g.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(g.jsx)(o.EuiTitle,{size:"m"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.overrideConfigurationHeader",defaultMessage:"Override configuration for {jobID}",values:{jobID:e.id}})))),Object(g.jsx)(o.EuiFlyoutBody,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiForm,null,Object(g.jsx)(o.EuiFormRow,{fullWidth:!0},Object(g.jsx)(os,{existingGroups:a,selectedGroups:null!==(s=r.jobGroups)&&void 0!==s?s:[],onChange:e=>{l({jobGroups:e})},validation:{valid:!c.jobGroups||0===c.jobGroups.length,message:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobGroupAllowedCharactersDescription",defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"})}}))),Object(g.jsx)(o.EuiSpacer,null)),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:()=>i(null),flush:"left"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.cancelJobOverrideLabel",defaultMessage:"Close"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:()=>(()=>{const t={job_id:e.id,groups:r.jobGroups};i(t)})(),fill:!0,disabled:!c.formValid},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.saveJobOverrideLabel",defaultMessage:"Save"}))))))},Cc="200px",kc=({jobs:e,jobPrefix:t,jobOverrides:a,saveState:i,existingGroupIds:r,onJobOverridesChange:l})=>{const c=i===Ic.SAVING,[d,u]=Object(n.useState)(null),p=e=>a[e.id],b=null!==d?Object(g.jsx)(Tc,{job:d,jobOverride:p(d),onClose:e=>{u(null),null!==e&&l(e)},existingGroupIds:r}):null;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobsTitle",defaultMessage:"Jobs"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),i!==Ic.SAVING&&i!==Ic.NOT_SAVED&&Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"flexEnd",responsive:!1,gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{style:{width:Cc},grow:!1},Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround",responsive:!1,gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:1},Object(g.jsx)(o.EuiText,{size:"s",textAlign:"center"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobLabel",defaultMessage:"Job"}))),Object(g.jsx)(o.EuiFlexItem,{grow:1},Object(g.jsx)(o.EuiText,{size:"s",textAlign:"center"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.datafeedLabel",defaultMessage:"Datafeed"}))),Object(g.jsx)(o.EuiFlexItem,{grow:1},Object(g.jsx)(o.EuiText,{size:"s",textAlign:"center"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.runningLabel",defaultMessage:"Running"})))))),Object(g.jsx)("ul",null,e.map(((a,i)=>Object(g.jsx)("li",{key:a.id},Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Mc,{jobPrefix:t,job:a,jobOverride:p(a),isSaving:c,onEditRequest:()=>u(a)}))),i<e.length-1&&Object(g.jsx)(o.EuiHorizontalRule,{margin:"s"}))))),b)},Fc=({onSubmit:e,onJobPrefixChange:t,saveState:a,jobs:i})=>{const{from:l,to:c}=es(),{currentDataView:d}=Object(Cn.b)(),u=Object(n.useMemo)((()=>Object(_c.a)(Object(_c.d)(/^([a-z0-9]+[a-z0-9\-_]*)?$/),Object(_c.b)(el.b-Math.max(...i.map((({id:e})=>e.length)))))),[i]),[p,b]=Object(n.useState)(""),[f,h]=Object(n.useState)(!0),[j,x]=Object(n.useState)(!0),[v,y]=Object(n.useState)({start:l,end:c}),[O,E]=Object(n.useState)(!1),[w,M]=Object(n.useState)({}),S=Object(n.useCallback)((()=>{const e=u(p);M({jobPrefix:e,formValid:!e})}),[p,u]);return Object(n.useEffect)((()=>{S(),t(p)}),[S,p,t]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiForm,null,Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobIdPrefixLabel",defaultMessage:"Job ID prefix"})),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.tooltips.newJobRecognizerJobPrefixTooltip",defaultMessage:"The prefix is added to the beginning of each job ID."})},Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobIdPrefixLabel",defaultMessage:"Job ID prefix"}),isInvalid:!!w.jobPrefix,error:Object(g.jsx)(s.a.Fragment,null,w.jobPrefix&&w.jobPrefix.maxLength?Object(g.jsx)("div",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobPrefixInvalidMaxLengthErrorMessage",defaultMessage:"Job ID prefix must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:w.jobPrefix.maxLength.requiredLength}})):null,w.jobPrefix&&w.jobPrefix.pattern&&Object(g.jsx)("div",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobLabelAllowedCharactersDescription",defaultMessage:"Job label can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"})))},Object(g.jsx)(o.EuiFieldText,{name:"jobPrefix",value:p,onChange:({target:{value:e}})=>b(e),isInvalid:!!w.jobPrefix}))),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiFormRow,null,Object(g.jsx)(o.EuiSwitch,{id:"startDataFeed",name:"startDataFeed",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.startDatafeedAfterSaveLabel",defaultMessage:"Start datafeed after save"}),checked:f,onChange:({target:{checked:e}})=>{h(e)}})),Object(g.jsx)(o.EuiFormRow,null,Object(g.jsx)(o.EuiSwitch,{id:"useFullData",name:"useFullData",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.useFullDataLabel",defaultMessage:"Use full {indexPatternTitle} data",values:{indexPatternTitle:d.title}}),checked:j,onChange:({target:{checked:e}})=>{x(e)}})),!j&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(rs,{setTimeRange:e=>{y(e)},timeRange:v})),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiAccordion,{id:"advancedOptions","aria-label":r.i18n.translate("xpack.ml.newJob.recognize.advancedSettingsAriaLabel",{defaultMessage:"Advanced settings"}),buttonContent:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.advancedLabel",defaultMessage:"Advanced"}),paddingSize:"l"},Object(g.jsx)(o.EuiDescribedFormGroup,{title:Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.useDedicatedIndexLabel",defaultMessage:"Use dedicated index"})),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.tooltips.newJobDedicatedIndexTooltip",defaultMessage:"Store results in a separate index for this job."})},Object(g.jsx)(o.EuiFormRow,{describedByIds:["ml_aria_label_new_job_dedicated_index"]},Object(g.jsx)(o.EuiSwitch,{id:"useDedicatedIndex",name:"useDedicatedIndex",checked:O,onChange:({target:{checked:e}})=>{E(e)},label:r.i18n.translate("xpack.ml.newJob.recognize.useDedicatedIndexLabel",{defaultMessage:"Use dedicated index"})})))),Object(g.jsx)(o.EuiSpacer,{size:"l"})),Object(g.jsx)(o.EuiTextAlign,{textAlign:"right"},Object(g.jsx)(o.EuiButton,{fill:!0,type:"submit",isLoading:a===Ic.SAVING,disabled:!w.formValid||a===Ic.SAVING,onClick:()=>{e({jobPrefix:p,startDatafeedAfterSave:f,useFullIndexData:j,timeRange:v,useDedicatedIndex:O})},"aria-label":r.i18n.translate("xpack.ml.newJob.recognize.createJobButtonAriaLabel",{defaultMessage:"Create job"})},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.createJobButtonLabel",defaultMessage:"Create {numberOfJobs, plural, zero {job} one {job} other {jobs}}",values:{numberOfJobs:i.length}}))))};let Ic;!function(e){e[e.NOT_SAVED=0]="NOT_SAVED",e[e.SAVING=1]="SAVING",e[e.SAVED=2]="SAVED",e[e.FAILED=3]="FAILED",e[e.PARTIAL_FAILURE=4]="PARTIAL_FAILURE"}(Ic||(Ic={}));const Dc=({moduleId:e,existingGroupIds:t})=>{const{services:{notifications:a,mlServices:{mlApiServices:{getTimeFieldRange:i,setupDataRecognizerConfig:l,getDataRecognizerModule:c}}}}=Object(y.b)(),d=Object(y.d)(),[u,p]=Object(n.useState)(""),[b,f]=Object(n.useState)([]),[h,j]=Object(n.useState)({}),[x,v]=Object(n.useState)({}),[O,w]=Object(n.useState)(Ic.NOT_SAVED),[M,S]=Object(n.useState)(""),[_,T]=Object(n.useState)(t),[C,k]=Object(n.useState)(0),{currentSavedSearch:F,currentDataView:I,combinedQuery:D}=Object(Cn.b)(),A=null!==F?r.i18n.translate("xpack.ml.newJob.recognize.savedSearchPageTitle",{defaultMessage:"saved search {savedSearchTitle}",values:{savedSearchTitle:F.attributes.title}}):r.i18n.translate("xpack.ml.newJob.recognize.dataViewPageTitle",{defaultMessage:"data view {dataViewName}",values:{dataViewName:I.getName()}}),L=null!==F,R=null===F?void 0:D,N=Object(n.useCallback)((async()=>{try{const t=await c({moduleId:e});f(t.jobs);const a=await(async e=>{const t=Object(ee.j)();try{return await Object.keys(e).reduce((async(a,i)=>{const n=await a,{savedObjects:s}=await t.find({type:i,perPage:1e3});return n[i]=e[i].map((e=>{const t=s.find((t=>t.attributes.title===e.title));return{...e,exists:!!t,id:!!t&&t.id||e.id}})),Promise.resolve(n)}),Promise.resolve({}))}catch(e){console.error("Could not load saved objects",e)}return Promise.resolve(e)})(t.kibana);v(a),w(Ic.NOT_SAVED);const i=[...t.jobs.map((e=>e.config.groups||[]))].flat(),n=[...new Set([..._,...i])].sort();Object(Q.isEqual)(n,_)||T(n)}catch(e){console.error(e)}}),[_,c,e]),P=Object(n.useCallback)((async(e,t)=>{if(e){const e=I.getComputedFields().runtimeFields,{start:t,end:a}=await i({index:I.title,timeFieldName:I.timeFieldName,query:yt(D),...Object(re.isPopulatedObject)(e)?{runtimeMappings:e}:{}});return{start:t,end:a}}return Promise.resolve(t)}),[D,I,i]);Object(n.useEffect)((()=>{N()}),[N]);const z=Object(n.useCallback)((async t=>{w(Ic.SAVING);const{jobPrefix:i,startDatafeedAfterSave:n,useDedicatedIndex:s,useFullIndexData:o,timeRange:c}=t,u=await P(o,c);try{let t=Object.values(h);t=t.length>0?t:null;const a=await l({moduleId:e,prefix:i,query:R,indexPatternName:I.title,useDedicatedIndex:s,startDatafeed:n,...null!==t?{jobOverrides:t}:{},...u}),{datafeeds:o,jobs:r,kibana:c}=a;if(f(b.map((e=>({...e,datafeedResult:o.find((({id:t})=>t.endsWith(e.id))),setupResult:r.find((({id:t})=>t===i+e.id))})))),v(Object(Q.merge)(x,c)),d){const e=await d.getUrl({page:E.b.ANOMALY_EXPLORER,pageState:{jobIds:r.filter((({success:e})=>e)).map((({id:e})=>e)),timeRange:{from:Oe()(u.start).format(Re.a),to:Oe()(u.end).format(Re.a),mode:"absolute"}}});S(e)}const p=r.reduce(((e,{success:t})=>t?e:e+1),0),m=o.reduce(((e,{awaitingMlNodeAllocation:t})=>!0===t?e+1:e),0);k(m),w(0===p?Ic.SAVED:p===b.length?Ic.FAILED:Ic.PARTIAL_FAILURE)}catch(t){w(Ic.FAILED),console.error("Error setting up module",t);const{toasts:i}=a;i.addDanger({title:r.i18n.translate("xpack.ml.newJob.recognize.moduleSetupFailedWarningTitle",{defaultMessage:"Error setting up module {moduleId}",values:{moduleId:e}}),text:r.i18n.translate("xpack.ml.newJob.recognize.moduleSetupFailedWarningDescription",{defaultMessage:"An error occurred trying to create the {count, plural, one {job} other {jobs}} in the module.",values:{count:b.length}})})}}),[I.title,P,h,b,x,d,e,a,l,R]),B=[Ic.NOT_SAVED,Ic.SAVING].includes(O);return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.newJobFromTitle",defaultMessage:"New job from {pageTitle}",values:{pageTitle:A}})),L&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.searchWillBeOverwrittenLabel",defaultMessage:"Search will be overwritten"}),color:"warning",iconType:"alert"},Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.usingSavedSearchDescription",defaultMessage:"Using a saved search will mean the query used in the datafeeds will be different from the default ones we supply in the {moduleId} module.",values:{moduleId:e}}))),Object(g.jsx)(o.EuiSpacer,{size:"l"})),C>0&&Object(g.jsx)(Qi.a,{jobCount:C}),Object(g.jsx)(o.EuiFlexGroup,{wrap:!0,gutterSize:"m"},Object(g.jsx)(o.EuiFlexItem,{grow:1},Object(g.jsx)(o.EuiPanel,{grow:!1,hasShadow:!1,hasBorder:!0},Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobSettingsTitle",defaultMessage:"Job settings"}))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),B&&Object(g.jsx)(Fc,{onSubmit:z,onJobPrefixChange:p,saveState:O,jobs:b}),Object(g.jsx)(Ec,{saveState:O,resultsUrl:M,onReset:N}))),Object(g.jsx)(o.EuiFlexItem,{grow:2},Object(g.jsx)(o.EuiPanel,{grow:!1,hasShadow:!1,hasBorder:!0},Object(g.jsx)(kc,{jobs:b,jobPrefix:u,saveState:O,existingGroupIds:_,jobOverrides:h,onJobOverridesChange:e=>{if(j({...h,[e.job_id]:e}),void 0!==e.groups){const t=[...new Set([..._,...e.groups])];T(t)}}})),Object.keys(x).length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiPanel,{grow:!1,hasShadow:!1,hasBorder:!0},Object.keys(x).map(((e,t)=>Object(g.jsx)(n.Fragment,{key:e},Object(g.jsx)(wc,{objectType:e,kibanaObjects:x[e],isSaving:O===Ic.SAVING}),t<Object.keys(x).length-1&&Object(g.jsx)(o.EuiSpacer,{size:"s"})))))))),Object(g.jsx)(o.EuiSpacer,{size:"l"}))},Ac=(e,t)=>({path:"/jobs/new_job/recognize",render:(e,t)=>Object(g.jsx)(Rc,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),N("CREATE_JOB_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.jobsBreadcrumbs.selectIndexOrSearchLabelRecognize",{defaultMessage:"Recognized index"}),href:""}]}),Lc=()=>({path:"/modules/check_view_or_create",render:(e,t)=>Object(g.jsx)(Nc,_()({},e,{deps:t})),breadcrumbs:[]}),Rc=({location:e,deps:t})=>{const{id:a,index:i,savedSearchId:n}=Object(Tn.parse)(e.search,{sort:!1}),{context:s,results:o}=I(i,n,t.config,t.dataViewsContract,{...W(t),existingJobsAndGroups:K.a.getJobAndGroupIds});return Object(g.jsx)(T.b,{context:s},Object(g.jsx)(Dc,{moduleId:a,existingGroupIds:o.existingJobsAndGroups.groupIds}))},Nc=({location:e,deps:t})=>{const{id:a,index:i}=Object(Tn.parse)(e.search,{sort:!1}),{createLinkWithUserDefaults:n}=Te(),s=Object(y.e)();return I(void 0,void 0,t.config,t.dataViewsContract,{checkViewOrCreateJobs:()=>function(e,t,a,i){return new Promise(((n,s)=>{X.ml.dataRecognizerModuleJobsExist({moduleId:e}).then((async n=>{if(!0===n.jobsExist){const e=a("explorer",n.jobs);await i(e),s()}else await i(`/jobs/new_job/recognize?id=${e}&index=${t}`),s()})).catch((async t=>{console.error(`Error checking whether jobs in module ${e} exists`,t),Object(ee.n)().addWarning({title:r.i18n.translate("xpack.ml.newJob.recognize.moduleCheckJobsExistWarningTitle",{defaultMessage:"Error checking module {moduleId}",values:{moduleId:e}}),text:r.i18n.translate("xpack.ml.newJob.recognize.moduleCheckJobsExistWarningDescription",{defaultMessage:"An error occurred trying to check whether the jobs in the module have been created."})}),await i("/jobs"),s()}))}))}(a,i,n,s)}),null};var Pc=a(262);const zc=()=>({path:"/jobs/new_job/from_lens",render:(e,t)=>Object(g.jsx)(Bc,_()({},e,{deps:t})),breadcrumbs:[]}),Bc=({location:e,deps:t})=>{const{lensId:a,vis:i,from:n,to:s,query:o,filters:r,layerIndex:c}=Object(Tn.parse)(e.search,{sort:!1}),{context:d}=I(void 0,void 0,t.config,t.dataViewsContract,{redirect:()=>Object(Pc.resolver)(a,i,n,s,o,r,c)});return Object(g.jsx)(T.b,{context:d},Object(g.jsx)(l.Redirect,{to:"/jobs/new_job"}))},Vc=()=>{Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1});const{services:{licenseManagement:e,http:{basePath:t},docLinks:a,dataVisualizer:i}}=Object(y.b)(),r=a.links.ml.guide,l=Object(y.e)(),c=void 0!==e&&!0===e.enabled&&!1===Object(O.d)();if(void 0===i)return console.error("File data visualizer plugin not available"),null;const d=i.getMaxBytesFormatted();return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",{"data-test-subj":"mlPageDataVisualizerSelector"},Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.selector.dataVisualizerTitle",defaultMessage:"Data Visualizer"})),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.selector.dataVisualizerDescription",defaultMessage:"The Machine Learning Data Visualizer tool helps you understand your data, by analyzing the metrics and fields in a log file or an existing Elasticsearch index."})))),Object(g.jsx)(o.EuiSpacer,{size:"xl"}),Object(g.jsx)(o.EuiFlexGrid,{gutterSize:"xl",columns:2,style:{maxWidth:"1000px"}},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiCard,{hasBorder:!0,icon:Object(g.jsx)(o.EuiIcon,{size:"xxl",type:"addDataApp"}),title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.selector.importDataTitle",defaultMessage:"Visualize data from a file"}),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.selector.importDataDescription",defaultMessage:"Import data from a log file. You can upload files up to {maxFileSize}.",values:{maxFileSize:d}}),footer:Object(g.jsx)(o.EuiButton,{target:"_self",onClick:()=>l("/filedatavisualizer"),"data-test-subj":"mlDataVisualizerUploadFileButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.selector.uploadFileButtonLabel",defaultMessage:"Select file"})),"data-test-subj":"mlDataVisualizerCardImportData"})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiCard,{hasBorder:!0,icon:Object(g.jsx)(o.EuiIcon,{size:"xxl",type:"dataVisualizer"}),title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.selector.selectDataViewTitle",defaultMessage:"Visualize data from a data view"}),description:"",footer:Object(g.jsx)(o.EuiButton,{target:"_self",onClick:()=>l("/datavisualizer_index_select"),"data-test-subj":"mlDataVisualizerSelectIndexButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.selector.selectDataViewButtonLabel",defaultMessage:"Select data view"})),"data-test-subj":"mlDataVisualizerCardIndexData"}))),!0===c&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"xxl"}),Object(g.jsx)(o.EuiSpacer,{size:"xxl"}),Object(g.jsx)(o.EuiFlexGrid,{gutterSize:"xl",columns:2,style:{maxWidth:"1000px"}},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiCard,{hasBorder:!0,title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.selector.startTrialTitle",defaultMessage:"Start trial"}),description:Object(g.jsx)("span",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.startTrial.fullMLFeaturesDescription",defaultMessage:"To experience the full Machine Learning features that a {subscriptionsLink} offers, start a 30-day trial.",values:{subscriptionsLink:Object(g.jsx)(o.EuiLink,{href:"https://www.elastic.co/subscriptions",target:"_blank"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.startTrial.subscriptionsLinkText",defaultMessage:"Platinum or Enterprise subscription"}))}})),footer:Object(g.jsx)(o.EuiButton,{target:"_blank",href:`${t.get()}/app/management/stack/license_management/home`,"data-test-subj":"mlDataVisualizerStartTrialButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.datavisualizer.selector.startTrialButtonLabel",defaultMessage:"Start trial"})),"data-test-subj":"mlDataVisualizerCardStartTrial"}))))),Object(g.jsx)(sn.a,{docLink:r}))},Jc=(e,t)=>({id:"datavisualizer",path:"/datavisualizer",title:r.i18n.translate("xpack.ml.dataVisualizer.docTitle",{defaultMessage:"Data Visualizer"}),render:(e,t)=>Object(g.jsx)(Uc,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("DATA_VISUALIZER_BREADCRUMB")]}),Uc=({location:e,deps:t})=>{const{redirectToMlAccessDeniedPage:a}=t,{context:i}=I(void 0,void 0,t.config,t.dataViewsContract,{checkBasicLicense:O.a,checkFindFileStructurePrivilege:()=>Object(w.b)(a)});return Object(g.jsx)(T.b,{context:i},Object(g.jsx)(Vc,null))},Gc=()=>{Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1});const{services:{http:e,docLinks:t,dataVisualizer:a,data:{dataViews:{get:i}}}}=Object(y.b)(),o=Object(y.d)(),l=!Object(O.d)();Object($.c)();const[c,d]=Object(n.useState)(null);Object(n.useEffect)((()=>{if(void 0!==a){const{getIndexDataVisualizerComponent:e}=a;e().then(d)}}),[]);const u=async({dataViewId:e,dataViewTitle:t,globalState:a})=>[{id:"create_ml_ad_job",title:r.i18n.translate("xpack.ml.indexDatavisualizer.actionsPanel.anomalyDetectionTitle",{defaultMessage:"Advanced anomaly detection"}),description:r.i18n.translate("xpack.ml.indexDatavisualizer.actionsPanel.anomalyDetectionDescription",{defaultMessage:"Create a job with the full range of options for more advanced use cases."}),icon:"createAdvancedJob",type:"file",getUrl:async()=>await o.getUrl({page:E.b.ANOMALY_DETECTION_CREATE_JOB_ADVANCED,pageState:{index:e,globalState:a}}),canDisplay:async()=>{try{const{timeFieldName:t}=await i(e);return Object(O.d)()&&void 0!==t&&Object(w.e)("canCreateJob")&&Object($.e)()}catch(e){return!1}},"data-test-subj":"dataVisualizerCreateAdvancedJobCard"},{id:"create_ml_dfa_job",title:r.i18n.translate("xpack.ml.indexDatavisualizer.actionsPanel.dataframeTitle",{defaultMessage:"Data frame analytics"}),description:r.i18n.translate("xpack.ml.indexDatavisualizer.actionsPanel.dataframeDescription",{defaultMessage:"Create outlier detection, regression, or classification analytics."}),icon:"classificationJob",type:"file",getUrl:async()=>await o.getUrl({page:E.b.DATA_FRAME_ANALYTICS_CREATE_JOB,pageState:{index:e,globalState:a}}),canDisplay:async()=>Object(O.d)()&&Object(w.e)("canCreateDataFrameAnalytics")&&Object($.e)(),"data-test-subj":"dataVisualizerCreateDataFrameAnalyticsCard"}],p=async t=>{const{dataViewId:a,dataViewTitle:n}=t;try{const t=await e.fetch(`/api/ml/modules/recognize/${n}`,{method:"GET"});return null==t?void 0:t.map((e=>({id:e.id,title:e.title,description:e.description,icon:e.logo.icon,type:"index",getUrl:async()=>await o.getUrl({page:E.b.ANOMALY_DETECTION_CREATE_JOB_RECOGNIZER,pageState:{id:e.id,index:a}}),canDisplay:async()=>{try{const{timeFieldName:e}=await i(a);return Object(O.d)()&&void 0!==e&&Object(w.e)("canCreateJob")&&Object($.e)()}catch(e){return!1}},"data-test-subj":e.id})))}catch(e){return console.error("Platinum, Enterprise or trial license needed"),[]}},b=Object(n.useMemo)((()=>l?[]:[p,u]),[o,l]);return c?Object(g.jsx)(n.Fragment,null,null!==c?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataVisualizer.pageHeader",defaultMessage:"Data Visualizer"})),Object(g.jsx)(c,{getAdditionalLinks:b})):null,Object(g.jsx)(sn.a,{docLink:t.links.ml.guide})):Object(g.jsx)(n.Fragment,null)},qc=(e,t)=>({id:"data_view_datavisualizer",path:"/jobs/new_job/datavisualizer",title:r.i18n.translate("xpack.ml.dataVisualizer.dataView.docTitle",{defaultMessage:"Index Data Visualizer"}),render:(e,t)=>Object(g.jsx)($c,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("DATA_VISUALIZER_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.dataViewLabel",{defaultMessage:"Data View"})}]}),$c=({location:e,deps:t})=>{const{redirectToMlAccessDeniedPage:a}=t,{index:i,savedSearchId:n}=Object(Tn.parse)(e.search,{sort:!1}),{context:s}=I(i,n,t.config,t.dataViewsContract,{checkBasicLicense:O.a,cacheDataViewsContract:()=>Object(C.a)(t.dataViewsContract),checkGetJobsCapabilities:()=>Object(w.c)(a)});return Object(g.jsx)(T.b,{context:s},Object(g.jsx)(Gc,null))},Wc=()=>{Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1});const{services:{docLinks:e,dataVisualizer:t,data:{dataViews:{get:a}}}}=Object(y.b)(),i=Object(y.d)();Object($.c)();const[o,l]=Object(n.useState)(null),c=Object(n.useMemo)((()=>[async({dataViewId:e,globalState:t})=>[{id:"create_ml_job",title:r.i18n.translate("xpack.ml.fileDatavisualizer.actionsPanel.anomalyDetectionTitle",{defaultMessage:"Create ML job"}),description:"",icon:"machineLearningApp",type:"file",getUrl:async()=>await i.getUrl({page:E.b.ANOMALY_DETECTION_CREATE_JOB_SELECT_TYPE,pageState:{index:e,globalState:t}}),canDisplay:async()=>{try{const{timeFieldName:t}=await a(e);return Object(O.d)()&&void 0!==t&&Object(w.e)("canCreateJob")&&Object($.e)()}catch(e){return!1}}},{id:"open_in_data_viz",title:r.i18n.translate("xpack.ml.fileDatavisualizer.actionsPanel.dataframeTitle",{defaultMessage:"Open in Data Visualizer"}),description:"",icon:"dataVisualizer",type:"file",getUrl:async()=>await i.getUrl({page:E.b.DATA_VISUALIZER_INDEX_VIEWER,pageState:{index:e,globalState:t}}),canDisplay:async()=>""!==e}]]),[i]);return Object(n.useEffect)((()=>{if(void 0!==t){Object($.c)();const{getFileDataVisualizerComponent:e}=t;e().then(l)}}),[]),Object(g.jsx)(n.Fragment,null,null!==o?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataVisualizer.pageHeader",defaultMessage:"Data Visualizer"})),Object(g.jsx)(o,{getAdditionalLinks:c})):null,Object(g.jsx)(sn.a,{docLink:e.links.ml.guide}))},Hc=(e,t)=>({id:"filedatavisualizer",path:"/filedatavisualizer",title:r.i18n.translate("xpack.ml.dataVisualizer.file.docTitle",{defaultMessage:"File Data Visualizer"}),render:(e,t)=>Object(g.jsx)(Yc,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("DATA_VISUALIZER_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.dataVisualizer.fileBasedLabel",{defaultMessage:"File"})}]}),Yc=({deps:e})=>{const{redirectToMlAccessDeniedPage:t}=e,{context:a}=I(void 0,void 0,e.config,e.dataViewsContract,{checkBasicLicense:O.a,cacheDataViewsContract:()=>Object(C.a)(e.dataViewsContract),checkFindFileStructurePrivilege:()=>Object(w.b)(t)});return Object(g.jsx)(T.b,{context:a},Object(g.jsx)(Wc,null))},Xc=Object(n.createContext)({canGetFilters:!1,canCreateFilter:!1,canGetCalendars:!1,canCreateCalendar:!1}),Qc=()=>{const[e,t]=Object(n.useState)(0),[a,i]=Object(n.useState)(0),{canGetFilters:s,canCreateFilter:l,canGetCalendars:c,canCreateCalendar:d}=Object(n.useContext)(Xc),{toasts:u}=Object(y.f)(),p=Object(F.a)(E.b.CALENDARS_MANAGE),b=Object(F.a)(E.b.CALENDARS_NEW),f=Object(F.a)(E.b.FILTER_LISTS_MANAGE),h=Object(F.a)(E.b.FILTER_LISTS_NEW);return Object(n.useEffect)((()=>{!async function(){if(!0===c)try{const e=await X.ml.calendars();t(e.length)}catch(e){u.addDanger(r.i18n.translate("xpack.ml.settings.anomalyDetection.loadingCalendarsCountErrorMessage",{defaultMessage:"An error occurred obtaining the count of calendars"}))}if(!0===s)try{const e=await X.ml.filters.filtersStats();i(e.length)}catch(e){u.addDanger(r.i18n.translate("xpack.ml.settings.anomalyDetection.loadingFilterListCountErrorMessage",{defaultMessage:"An error occurred obtaining the count of filter lists"}))}}()}),[]),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiPageContentHeader_Deprecated,null,Object(g.jsx)(o.EuiTitle,null,Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.anomalyDetectionTitle",defaultMessage:"Anomaly Detection"})))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,{grow:5},Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.calendarsTitle",defaultMessage:"Calendars"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)(o.EuiTextColor,{color:"subdued"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.calendarsText",defaultMessage:"Calendars contain a list of scheduled events for which you do not want to generate anomalies, such as planned system outages or public holidays."})))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center"},c&&Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{display:"block"}},Object(g.jsx)(o.EuiText,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.calendarsSummaryCount",defaultMessage:"You have {calendarsCountBadge} {calendarsCount, plural, one {calendar} other {calendars}}",values:{calendarsCountBadge:Object(g.jsx)(o.EuiBadge,null,e),calendarsCount:e}}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{"data-test-subj":"mlCalendarsMngButton",flush:"left",color:"primary",onClick:p,isDisabled:!1===c},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.manageCalendarsLink",defaultMessage:"Manage"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{"data-test-subj":"mlCalendarsCreateButton",flush:"left",color:"primary",onClick:b,isDisabled:!1===d},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.createCalendarLink",defaultMessage:"Create"}))))),Object(g.jsx)(o.EuiFlexItem,{grow:5},Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.filterListsTitle",defaultMessage:"Filter Lists"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)(o.EuiTextColor,{color:"subdued"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.filterListsText",defaultMessage:"Filter lists contain values that you can use to include or exclude events from the machine learning analysis."})))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center"},s&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.filterListsSummaryCount",defaultMessage:"You have {filterListsCountBadge} {filterListsCount, plural, one {filter list} other {filter lists}}",values:{filterListsCountBadge:Object(g.jsx)(o.EuiBadge,null,a),filterListsCount:a}}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{"data-test-subj":"mlFilterListsMngButton",flush:"left",color:"primary",onClick:f,isDisabled:!1===s},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.manageFilterListsLink",defaultMessage:"Manage"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{"data-test-subj":"mlFilterListsCreateButton",color:"primary",onClick:h,isDisabled:!1===l},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.anomalyDetection.createFilterListsLink",defaultMessage:"Create"})))))))},Kc=()=>{const{services:{docLinks:e}}=Object(y.b)(),t=e.links.ml.guide;return Object(g.jsx)(n.Fragment,null,Object(g.jsx)("div",{"data-test-subj":"mlPageSettings"},Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.title",defaultMessage:"Settings"})),Object(g.jsx)(Qc,null)),Object(g.jsx)(sn.a,{docLink:t}))},Zc=(e,t)=>({id:"settings",path:"/settings",title:r.i18n.translate("xpack.ml.settings.docTitle",{defaultMessage:"Settings"}),render:(e,t)=>Object(g.jsx)(ed,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),N("SETTINGS_BREADCRUMB")]}),ed=({deps:e})=>{const{redirectToMlAccessDeniedPage:t}=e,{context:a}=I(void 0,void 0,e.config,e.dataViewsContract,{checkFullLicense:O.b,checkGetJobsCapabilities:()=>Object(w.c)(t),getMlNodeCount:$.c});Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1});const i=Object(w.e)("canGetFilters"),n=Object(w.e)("canCreateFilter"),s=Object(w.e)("canGetCalendars"),o=Object(w.e)("canCreateCalendar");return Object(g.jsx)(T.b,{context:a},Object(g.jsx)(Xc.Provider,{value:{canGetFilters:i,canCreateFilter:n,canGetCalendars:s,canCreateCalendar:o}},Object(g.jsx)(Kc,null)))};function td(){return Math.random().toString(36).substr(2,9)}function ad({onClick:e,testSubj:t,disabled:a}){return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiButtonEmpty,{size:"xs",color:"danger",onClick:e,isDisabled:a,"data-test-subj":t},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.eventsTable.deleteButtonLabel",defaultMessage:"Delete"})))}const id=({canCreateCalendar:e,canDeleteCalendar:t,eventsList:a,onDeleteClick:i,showSearchBar:s,showImportModal:l,showNewEventModal:c,loading:d,saving:u})=>{const p=[{field:"description",name:r.i18n.translate("xpack.ml.calendarsEdit.eventsTable.descriptionColumnName",{defaultMessage:"Description"}),sortable:!0,truncateText:!0,scope:"row"},{field:"start_time",name:r.i18n.translate("xpack.ml.calendarsEdit.eventsTable.startColumnName",{defaultMessage:"Start"}),sortable:!0,render:e=>Oe()(e).format(Re.a)},{field:"end_time",name:r.i18n.translate("xpack.ml.calendarsEdit.eventsTable.endColumnName",{defaultMessage:"End"}),sortable:!0,render:e=>Oe()(e).format(Re.a)},{field:"",name:"",render:e=>Object(g.jsx)(ad,{testSubj:"mlCalendarEventDeleteButton",disabled:!1===t||!0===u||!0===d,onClick:()=>{i(e.event_id)}})}],b={toolsRight:[Object(g.jsx)(o.EuiButton,{isDisabled:!1===e||!0===u||!0===d,key:"ml_new_event","data-test-subj":"mlCalendarNewEventButton",size:"s",iconType:"plusInCircle",onClick:c},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.eventsTable.newEventButtonLabel",defaultMessage:"New event"})),Object(g.jsx)(o.EuiButton,{isDisabled:!1===e||!0===u||!0===d,key:"ml_import_event","data-test-subj":"mlCalendarImportEventsButton",size:"s",iconType:"importAction",onClick:l},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.eventsTable.importEventsButtonLabel",defaultMessage:"Import events"}))],box:{incremental:!0},filters:[]};return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiInMemoryTable,{items:a,itemId:"event_id",columns:p,pagination:{initialPageSize:5,pageSizeOptions:[5,10]},sorting:{sort:{field:"description",direction:"asc"}},search:s?b:void 0,"data-test-subj":"mlCalendarEventsTable",rowProps:e=>({"data-test-subj":`mlCalendarEventListRow row-${e.description}`})}))};function nd({calendarId:e,description:t}){return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)("span",{"data-test-subj":"mlCalendarTitle"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.calendarTitle",defaultMessage:"Calendar {calendarId}",values:{calendarId:e}}))),t?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiText,{"data-test-subj":"mlCalendarDescriptionText"},Object(g.jsx)("p",null,t)),Object(g.jsx)(o.EuiSpacer,{size:"l"})):null)}id.defaultProps={showSearchBar:!1,canCreateCalendar:!0,canDeleteCalendar:!0};const sd=({calendarId:e,canCreateCalendar:t,canDeleteCalendar:a,description:i,eventsList:l,groupIds:c,isEdit:d,isNewCalendarIdValid:u,jobIds:p,onCalendarIdChange:b,onCreate:f,onCreateGroupOption:h,onDescriptionChange:j,onEdit:x,onEventDelete:v,onGroupSelection:y,showImportModal:O,onJobSelection:w,saving:M,loading:S,selectedGroupOptions:_,selectedJobOptions:T,showNewEventModal:C,isGlobalCalendar:k,onGlobalCalendarChange:I})=>{const D=r.i18n.translate("xpack.ml.calendarsEdit.calendarForm.allowedCharactersDescription",{defaultMessage:"Use lowercase alphanumerics (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"}),A=!0!==u||d?void 0:D,L=!1!==u||d?void 0:[D],R=!1===t||M||!u||""===e||!0===S,N=Object(F.a)(E.b.CALENDARS_MANAGE);return Object(g.jsx)(o.EuiForm,{"data-test-subj":"mlCalendarForm"+(!0===d?"Edit":"New")},!0===d?Object(g.jsx)(nd,{calendarId:e,description:i}):Object(g.jsx)(n.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.createCalendarTitle",defaultMessage:"Create new calendar"})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.calendarIdLabel",defaultMessage:"Calendar ID"}),helpText:A,error:L,isInvalid:!u},Object(g.jsx)(o.EuiFieldText,{name:"calendarId",value:e,onChange:b,disabled:!0===d||!0===M||!0===S,"data-test-subj":"mlCalendarIdInput"})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.descriptionLabel",defaultMessage:"Description"})},Object(g.jsx)(o.EuiFieldText,{name:"description",value:i,onChange:j,disabled:!0===d||!0===M||!0===S,"data-test-subj":"mlCalendarDescriptionInput"})),Object(g.jsx)(o.EuiSpacer,{size:"m"})),Object(g.jsx)(o.EuiSwitch,{name:"switch",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.allJobsLabel",defaultMessage:"Apply calendar to all jobs"}),checked:k,onChange:I,disabled:!0===M||!1===t||!0===S,"data-test-subj":"mlCalendarApplyToAllJobsSwitch"}),!1===k&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.jobsLabel",defaultMessage:"Jobs"})},Object(g.jsx)(o.EuiComboBox,{options:p,selectedOptions:T,onChange:w,isDisabled:!0===M||!1===t||!0===S,"data-test-subj":"mlCalendarJobSelection"})),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.groupsLabel",defaultMessage:"Groups"})},Object(g.jsx)(o.EuiComboBox,{onCreateOption:h,options:c,selectedOptions:_,onChange:y,isDisabled:!0===M||!1===t||!0===S,"data-test-subj":"mlCalendarJobGroupSelection"}))),Object(g.jsx)(o.EuiSpacer,{size:"xl"}),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.eventsLabel",defaultMessage:"Events"}),fullWidth:!0},Object(g.jsx)(id,{canCreateCalendar:t,canDeleteCalendar:a,eventsList:l,onDeleteClick:v,showImportModal:O,showNewEventModal:C,loading:S,saving:M,showSearchBar:!0})),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"flexEnd"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{isDisabled:M,onClick:N},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.cancelButtonLabel",defaultMessage:"Cancel"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{"data-test-subj":"mlSaveCalendarButton",fill:!0,onClick:d?x:f,isDisabled:R},M?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.savingButtonLabel",defaultMessage:"Saving…"}):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.calendarForm.saveButtonLabel",defaultMessage:"Save"})))))};class new_event_modal_NewEventModal extends n.Component{constructor(e){super(e),Y()(this,"onDescriptionChange",(e=>{this.setState({description:e.target.value})})),Y()(this,"handleAddEvent",(()=>{const{description:e,startDate:t,endDate:a}=this.state,i=td(),n={description:e,start_time:t.valueOf(),end_time:a.valueOf(),event_id:i};this.props.addEvent(n)})),Y()(this,"handleChangeStart",(e=>{let t=null,a=this.state.endDate;const i=Oe()(e),n=Oe()(e);t=i.startOf("day"),t>a&&(a=n.startOf("day").add(1,"days")),this.setState({startDate:t,endDate:a,startDateString:t.format(Re.a),endDateString:a.format(Re.a)})})),Y()(this,"handleChangeEnd",(e=>{let t=this.state.startDate,a=null;const i=Oe()(e);a=Oe()(e).startOf("day"),t>a&&(t=i.startOf("day").subtract(1,"days")),this.setState({startDate:t,endDate:a,startDateString:t.format(Re.a),endDateString:a.format(Re.a)})})),Y()(this,"handleTimeStartChange",(e=>{const t=e.target.value;let a=!1;19===t.length?a=Oe()(t).isValid(Re.a,!0):this.setState({startDateString:t}),a&&this.setState({startDateString:t,startDate:Oe()(t)})})),Y()(this,"handleTimeEndChange",(e=>{const t=e.target.value;let a=!1;19===t.length?a=Oe()(t).isValid(Re.a,!0):this.setState({endDateString:t}),a&&this.setState({endDateString:t,endDate:Oe()(t)})})),Y()(this,"renderRangedDatePicker",(()=>{const{startDate:e,endDate:t,startDateString:a,endDateString:i}=this.state,s=Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.newEventModal.fromLabel",defaultMessage:"From:"}),helpText:Re.a},Object(g.jsx)(o.EuiFieldText,{name:"startTime",onChange:this.handleTimeStartChange,placeholder:Re.a,value:a}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.newEventModal.toLabel",defaultMessage:"To:"}),helpText:Re.a},Object(g.jsx)(o.EuiFieldText,{name:"endTime",onChange:this.handleTimeEndChange,placeholder:Re.a,value:i})))));return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),s,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0},Object(g.jsx)(o.EuiDatePickerRange,{fullWidth:!0,iconType:!1,startDateControl:Object(g.jsx)(o.EuiDatePicker,{fullWidth:!0,inline:!0,selected:e,onChange:this.handleChangeStart,startDate:e,endDate:t,isInvalid:e>t,"aria-label":r.i18n.translate("xpack.ml.calendarsEdit.newEventModal.startDateAriaLabel",{defaultMessage:"Start date"}),timeFormat:Re.a,dateFormat:Re.a}),endDateControl:Object(g.jsx)(o.EuiDatePicker,{fullWidth:!0,inline:!0,selected:t,onChange:this.handleChangeEnd,startDate:e,endDate:t,isInvalid:e>t,"aria-label":r.i18n.translate("xpack.ml.calendarsEdit.newEventModal.endDateAriaLabel",{defaultMessage:"End date"}),timeFormat:Re.a,dateFormat:Re.a})})))}));const t=Oe()().startOf("day"),a=Oe()().startOf("day").add(1,"days");this.state={startDate:t,endDate:a,description:"",startDateString:t.format(Re.a),endDateString:a.format(Re.a)}}render(){const{closeModal:e}=this.props,{description:t}=this.state;return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiModal,{onClose:e,initialFocus:"[name=eventDescription]",maxWidth:!1,"data-test-subj":"mlCalendarEventForm"},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.newEventModal.createNewEventTitle",defaultMessage:"Create new event"}))),Object(g.jsx)(o.EuiModalBody,null,Object(g.jsx)(o.EuiForm,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.newEventModal.descriptionLabel",defaultMessage:"Description"}),fullWidth:!0},Object(g.jsx)(o.EuiFieldText,{name:"eventDescription",onChange:this.onDescriptionChange,isInvalid:!t,fullWidth:!0,"data-test-subj":"mlCalendarEventDescriptionInput"})),Object(g.jsx)(o.EuiSpacer,{size:"m"}),this.renderRangedDatePicker())),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:e,"data-test-subj":"mlCalendarCancelEventButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.newEventModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(g.jsx)(o.EuiButton,{onClick:this.handleAddEvent,fill:!0,disabled:!t,"data-test-subj":"mlCalendarAddEventButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.newEventModal.addButtonLabel",defaultMessage:"Add"})))))}}function od({events:e,showRecurringWarning:t,includePastEvents:a,onCheckboxToggle:i,onEventDelete:s}){return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiText,null,Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.importedEvents.eventsToImportTitle",defaultMessage:"Events to import: {eventsCount}",values:{eventsCount:e.length}})),t&&Object(g.jsx)(o.EuiText,{color:"danger"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.importedEvents.recurringEventsNotSupportedDescription",defaultMessage:"Recurring events not supported. Only the first event will be imported."}))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(id,{eventsList:e,onDeleteClick:s})),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiCheckbox,{id:"ml-include-past-events",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.importedEvents.includePastEventsLabel",defaultMessage:"Include past events"}),checked:a,onChange:i})))}var rd=a(276),ld=a.n(rd);function cd(e){const t=Oe()().valueOf();return e.filter((e=>e.start_time>t))}class import_modal_ImportModal extends n.Component{constructor(e){super(e),Y()(this,"handleImport",(async e=>{const t=e[0],a=r.i18n.translate("xpack.ml.calendarsEdit.importModal.couldNotParseICSFileErrorMessage",{defaultMessage:"Could not parse ICS file."});let i=[];if(t&&t.size<=1e8){this.setState({fileLoading:!0,fileLoaded:!0});try{n=(await(s=t,new Promise(((e,t)=>{if(s&&s.size){const a=new FileReader;a.readAsText(s),a.onload=()=>{const i=a.result;""===i?t():e({data:i})}}else t()})))).data,i=function(e){const t=e.events(),a=[];return t.forEach((e=>{if("VEVENT"===e.element){const t=e.properties.SUMMARY,i=e.properties.DTSTART,n=e.properties.DTEND,s=void 0!==e.properties.RRULE;if(t&&i&&n&&t.length&&i.length&&n.length){const e=td();a.push({event_id:e,description:t[0].value,start_time:i[0].value.valueOf(),end_time:n[0].value.valueOf(),asterisk:s})}}})),a}(ld.a.parse_calendar(n+"\n")),this.setState({allImportedEvents:i,selectedEvents:cd(i),fileLoading:!1,errorMessage:null,includePastEvents:!1})}catch(e){console.log(a,e),this.setState({errorMessage:a,fileLoading:!1})}}else t&&t.size>1e8?this.setState({fileLoading:!1,errorMessage:a}):this.setState({fileLoading:!1,errorMessage:null});var n,s})),Y()(this,"onEventDelete",(e=>{this.setState((t=>({allImportedEvents:t.allImportedEvents.filter((t=>t.event_id!==e)),selectedEvents:t.selectedEvents.filter((t=>t.event_id!==e))})))})),Y()(this,"onCheckboxToggle",(e=>{this.setState({includePastEvents:e.target.checked})})),Y()(this,"handleEventsAdd",(()=>{const{allImportedEvents:e,selectedEvents:t,includePastEvents:a}=this.state,i=(a?e:t).map((e=>({description:e.description,start_time:e.start_time,end_time:e.end_time,event_id:e.event_id})));this.props.addImportedEvents(i)})),Y()(this,"renderCallout",(()=>Object(g.jsx)(o.EuiCallOut,{color:"danger"},Object(g.jsx)("p",null,this.state.errorMessage)))),this.state={includePastEvents:!1,allImportedEvents:[],selectedEvents:[],fileLoading:!1,fileLoaded:!1,errorMessage:null}}render(){const{closeImportModal:e}=this.props,{fileLoading:t,fileLoaded:a,allImportedEvents:i,selectedEvents:s,errorMessage:l,includePastEvents:c}=this.state;let d,u=!1;return d=c?i:s,void 0!==d.find((e=>e.asterisk))&&(u=!0),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiModal,{onClose:e,maxWidth:!0},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiModalHeaderTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.eventsTable.importEventsTitle",defaultMessage:"Import events"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.eventsTable.importEventsDescription",defaultMessage:"Import events from an ICS file."}))))),Object(g.jsx)(o.EuiModalBody,null,Object(g.jsx)(o.EuiFlexGroup,{direction:"column"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFilePicker,{compressed:!0,initialPromptText:r.i18n.translate("xpack.ml.calendarsEdit.importModal.selectOrDragAndDropFilePromptText",{defaultMessage:"Select or drag and drop a file"}),onChange:this.handleImport,disabled:t})),null!==l&&this.renderCallout(),i.length>0&&Object(g.jsx)(od,{events:d,showRecurringWarning:u,includePastEvents:c,onCheckboxToggle:this.onCheckboxToggle,onEventDelete:this.onEventDelete}))),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:e},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.eventsTable.cancelButtonLabel",defaultMessage:"Cancel"})),Object(g.jsx)(o.EuiButton,{onClick:this.handleEventsAdd,fill:!0,disabled:!1===a||null!==l},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsEdit.eventsTable.importButtonLabel",defaultMessage:"Import"})))))}}class new_calendar_NewCalendarUI extends n.Component{constructor(e){super(e),Y()(this,"returnToCalendarsManagementPage",(async()=>{const{services:{http:{basePath:e},application:{navigateToUrl:t}}}=this.props.kibana;await t(`${e.get()}/app/ml/${E.b.CALENDARS_MANAGE}`,!0)})),Y()(this,"isDuplicateId",(()=>{const{calendars:e,formCalendarId:t}=this.state;for(let a=0;a<e.length;a++)if(e[a].calendar_id===t)return!0;return!1})),Y()(this,"onCreate",(async()=>{const{formCalendarId:e}=this.state;if(this.isDuplicateId()){const{toasts:t}=this.props.kibana.services.notifications;t.addDanger(r.i18n.translate("xpack.ml.calendarsEdit.canNotCreateCalendarWithExistingIdErrorMessag",{defaultMessage:"Cannot create calendar with id [{formCalendarId}] as it already exists.",values:{formCalendarId:e}}))}else{const e=this.setUpCalendarForApi();this.setState({saving:!0});try{await X.ml.addCalendar(e),await this.returnToCalendarsManagementPage()}catch(t){console.log("Error saving calendar",t),this.setState({saving:!1});const{toasts:a}=this.props.kibana.services.notifications;a.addDanger(r.i18n.translate("xpack.ml.calendarsEdit.errorWithCreatingCalendarErrorMessage",{defaultMessage:"An error occurred creating calendar {calendarId}",values:{calendarId:e.calendarId}}))}}})),Y()(this,"onEdit",(async()=>{const e=this.setUpCalendarForApi();this.setState({saving:!0});try{await X.ml.updateCalendar(e),await this.returnToCalendarsManagementPage()}catch(t){console.log("Error saving calendar",t),this.setState({saving:!1});const{toasts:a}=this.props.kibana.services.notifications;a.addDanger(r.i18n.translate("xpack.ml.calendarsEdit.errorWithUpdatingCalendarErrorMessage",{defaultMessage:"An error occurred saving calendar {calendarId}. Try refreshing the page.",values:{calendarId:e.calendarId}}))}})),Y()(this,"setUpCalendarForApi",(()=>{const{formCalendarId:e,description:t,events:a,selectedGroupOptions:i,selectedJobOptions:n,isGlobalCalendar:s}=this.state,o=s?[qr.a]:[...n.map((e=>e.label)),...i.map((e=>e.label))];return{calendarId:e,description:t,events:a.map((e=>({description:e.description,start_time:e.start_time,end_time:e.end_time}))),job_ids:o}})),Y()(this,"onCreateGroupOption",(e=>{const t={label:e};this.setState((e=>({selectedGroupOptions:e.selectedGroupOptions.concat(t)})))})),Y()(this,"onGlobalCalendarChange",(({currentTarget:e})=>{this.setState({isGlobalCalendar:e.checked})})),Y()(this,"onJobSelection",(e=>{this.setState({selectedJobOptions:e})})),Y()(this,"onGroupSelection",(e=>{this.setState({selectedGroupOptions:e})})),Y()(this,"onCalendarIdChange",(e=>{const t=function(e){let t=!0;return(""===e||void 0===e||!1===Object(Qe.k)(e))&&(t=!1),t}(e.target.value);this.setState({formCalendarId:e.target.value,isNewCalendarIdValid:t})})),Y()(this,"onDescriptionChange",(e=>{this.setState({description:e.target.value})})),Y()(this,"showImportModal",(()=>{this.setState((e=>({isImportModalVisible:!e.isImportModalVisible})))})),Y()(this,"closeImportModal",(()=>{this.setState({isImportModalVisible:!1})})),Y()(this,"onEventDelete",(e=>{this.setState((t=>({events:t.events.filter((t=>t.event_id!==e))})))})),Y()(this,"closeNewEventModal",(()=>{this.setState({isNewEventModalVisible:!1})})),Y()(this,"showNewEventModal",(()=>{this.setState({isNewEventModalVisible:!0})})),Y()(this,"addEvent",(e=>{this.setState((t=>({events:[...t.events,e],isNewEventModalVisible:!1})))})),Y()(this,"addImportedEvents",(e=>{this.setState((t=>({events:[...t.events,...e],isImportModalVisible:!1})))})),this.state={isNewEventModalVisible:!1,isImportModalVisible:!1,isNewCalendarIdValid:null,loading:!0,jobIds:[],jobIdOptions:[],groupIds:[],groupIdOptions:[],calendars:[],formCalendarId:"",description:"",selectedJobOptions:[],selectedGroupOptions:[],events:[],saving:!1,selectedCalendar:void 0,isGlobalCalendar:!1}}componentDidMount(){this.formSetup()}async formSetup(){try{const{jobIds:e,groupIds:t,calendars:a}=await new Promise((async(e,t)=>{try{const[t,a,i]=await Promise.all([new Promise(((e,t)=>{X.ml.jobs.jobsSummary().then((t=>{e(t.map((e=>e.id)))})).catch((e=>{const a=r.i18n.translate("xpack.ml.calendarsEdit.errorWithFetchingJobSummariesErrorMessage",{defaultMessage:"Error fetching job summaries: {err}",values:{err:e}});console.log(a),t(a)}))})),new Promise(((e,t)=>{X.ml.jobs.groups().then((t=>{e(t.map((e=>e.id)))})).catch((e=>{const a=r.i18n.translate("xpack.ml.calendarsEdit.errorWithLoadingGroupsErrorMessage",{defaultMessage:"Error loading groups: {err}",values:{err:e}});console.log(a),t(a)}))})),new Promise(((e,t)=>{X.ml.calendars().then((t=>{e(t)})).catch((e=>{const a=r.i18n.translate("xpack.ml.calendarsEdit.errorWithLoadingCalendarsErrorMessage",{defaultMessage:"Error loading calendars: {err}",values:{err:e}});console.log(a),t(a)}))}))]);e({jobIds:t,groupIds:a,calendars:i})}catch(e){console.log(e),t(e)}})),i=e.map((e=>({label:e}))),n=t.map((e=>({label:e}))),s=[],o=[];let l,c=[],d="",u=!1;void 0!==this.props.calendarId&&(l=a.find((e=>e.calendar_id===this.props.calendarId)),l&&(d=l.calendar_id,c=l.events,l.job_ids.includes(qr.a)?u=!0:l.job_ids.forEach((a=>{e.find((e=>e===a))?s.push({label:a}):t.find((e=>e===a))&&o.push({label:a})})))),this.setState({events:c,formCalendarId:d,jobIds:e,jobIdOptions:i,groupIds:t,groupIdOptions:n,calendars:a,loading:!1,selectedJobOptions:s,selectedGroupOptions:o,selectedCalendar:l,isGlobalCalendar:u})}catch(e){console.log(e),this.setState({loading:!1});const{toasts:t}=this.props.kibana.services.notifications;t.addDanger(r.i18n.translate("xpack.ml.calendarsEdit.errorWithLoadingCalendarFromDataErrorMessage",{defaultMessage:"An error occurred loading calendar form data. Try refreshing the page."}))}}render(){const{events:e,isNewEventModalVisible:t,isImportModalVisible:a,isNewCalendarIdValid:i,formCalendarId:s,description:r,groupIdOptions:l,jobIdOptions:c,saving:d,loading:u,selectedCalendar:p,selectedJobOptions:m,selectedGroupOptions:b,isGlobalCalendar:f}=this.state,h=Object(ee.e)().links.ml.calendars;let j="";return t?j=Object(g.jsx)(new_event_modal_NewEventModal,{addEvent:this.addEvent,closeModal:this.closeNewEventModal}):a&&(j=Object(g.jsx)(import_modal_ImportModal,{addImportedEvents:this.addImportedEvents,closeImportModal:this.closeImportModal})),Object(g.jsx)(n.Fragment,null,Object(g.jsx)("div",{"data-test-subj":"mlPageCalendarEdit"},Object(g.jsx)(o.EuiPageBody,null,Object(g.jsx)(sd,{calendarId:p?p.calendar_id:s,canCreateCalendar:this.props.canCreateCalendar,canDeleteCalendar:this.props.canDeleteCalendar,description:p?p.description:r,eventsList:e,groupIds:l,isEdit:void 0!==p,isNewCalendarIdValid:!(!p&&null!==i)||i,jobIds:c,onCalendarIdChange:this.onCalendarIdChange,onCreate:this.onCreate,onDescriptionChange:this.onDescriptionChange,onEdit:this.onEdit,onEventDelete:this.onEventDelete,onGroupSelection:this.onGroupSelection,showImportModal:this.showImportModal,onJobSelection:this.onJobSelection,saving:d,loading:u,selectedGroupOptions:b,selectedJobOptions:m,onCreateGroupOption:this.onCreateGroupOption,showNewEventModal:this.showNewEventModal,isGlobalCalendar:f,onGlobalCalendarChange:this.onGlobalCalendarChange}),j)),Object(g.jsx)(sn.a,{docLink:h}))}}const dd=Object(c.withKibana)(new_calendar_NewCalendarUI),ud=Object(c.withKibana)((function({totalCount:e,refreshCalendars:t,kibana:a}){const i=a.services.docLinks.links.ml.calendars;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.calendars.listHeader.calendarsTitle",defaultMessage:"Calendars"})),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"baseline"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTextColor,{color:"subdued"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.calendars.listHeader.calendarsListTotalCount",defaultMessage:"{totalCount} in total",values:{totalCount:e}})))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{size:"s",iconType:"refresh",onClick:t,"data-test-subj":"mlCalendarListRefreshButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.calendars.listHeader.refreshButtonLabel",defaultMessage:"Refresh"})))))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiText,null,Object(g.jsx)("p",null,Object(g.jsx)(o.EuiTextColor,{color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.calendars.listHeader.calendarsDescription",defaultMessage:"Calendars contain a list of scheduled events for which you do not want to generate anomalies, such as planned system outages or public holidays. The same calendar can be assigned to multiple jobs.{br}{learnMoreLink}",values:{br:Object(g.jsx)("br",null),learnMoreLink:Object(g.jsx)(o.EuiLink,{href:i,target:"_blank"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.calendars.listHeader.calendarsDescription.learnMoreLinkText",defaultMessage:"Learn more"}))}})))),Object(g.jsx)(o.EuiSpacer,{size:"m"}))})),pd=({calendarsList:e,onDeleteClick:t,setSelectedCalendarList:a,loading:i,canCreateCalendar:n,canDeleteCalendar:s,mlNodesAvailable:c,itemsSelected:d})=>{const u=Object(F.a)(E.b.CALENDARS_NEW),p=[{field:"calendar_id",name:r.i18n.translate("xpack.ml.calendarsList.table.idColumnName",{defaultMessage:"ID"}),sortable:!0,truncateText:!0,scope:"row",render:e=>Object(g.jsx)(l.Link,{to:`/${E.b.CALENDARS_EDIT}/${e}`,"data-test-subj":"mlEditCalendarLink"},e),"data-test-subj":"mlCalendarListColumnId"},{field:"job_ids_string",name:r.i18n.translate("xpack.ml.calendarsList.table.jobsColumnName",{defaultMessage:"Jobs"}),sortable:!0,truncateText:!0,render:e=>e===qr.a?Object(g.jsx)("span",{style:{fontStyle:"italic"}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsList.table.allJobsLabel",defaultMessage:"Applies to all jobs"})):e,"data-test-subj":"mlCalendarListColumnJobs"},{field:"events_length",name:r.i18n.translate("xpack.ml.calendarsList.table.eventsColumnName",{defaultMessage:"Events"}),sortable:!0,render:e=>r.i18n.translate("xpack.ml.calendarsList.table.eventsCountLabel",{defaultMessage:"{eventsLength, plural, one {# event} other {# events}}",values:{eventsLength:e}}),"data-test-subj":"mlCalendarListColumnEvents"}],b={onSelectionChange:e=>a(e)},f={toolsRight:[Object(g.jsx)(o.EuiButton,{size:"s","data-test-subj":"mlCalendarButtonCreate",key:"new_calendar_button",onClick:u,isDisabled:!1===n||!1===c},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsList.table.newButtonLabel",defaultMessage:"New"})),Object(g.jsx)(o.EuiButton,{size:"s",color:"danger",iconType:"trash",onClick:t,isDisabled:!1===s||!1===c||!1===d,"data-test-subj":"mlCalendarButtonDelete",key:"delete_calendar_button"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsList.table.deleteButtonLabel",defaultMessage:"Delete"}))],box:{incremental:!0},filters:[]};return Object(g.jsx)("div",{"data-test-subj":"mlCalendarTableContainer"},Object(g.jsx)(o.EuiInMemoryTable,{items:e,itemId:"calendar_id",columns:p,search:f,pagination:{initialPageSize:20,pageSizeOptions:[10,20]},sorting:{sort:{field:"calendar_id",direction:"asc"}},loading:i,selection:b,isSelectable:!0,"data-test-subj":i?"mlCalendarTable loading":"mlCalendarTable loaded",rowProps:e=>({"data-test-subj":`mlCalendarListRow row-${e.calendar_id}`})}))};class calendars_list_CalendarsListUI extends n.Component{constructor(e){super(e),Y()(this,"loadCalendars",(async()=>{this.setState({loading:!0});try{const e=await X.ml.calendars();this.setState({calendars:e,loading:!1,isDestroyModalVisible:!1})}catch(e){console.log(e),this.setState({loading:!1});const{toasts:t}=this.props.kibana.services.notifications;t.addDanger(r.i18n.translate("xpack.ml.calendarsList.errorWithLoadingListOfCalendarsErrorMessage",{defaultMessage:"An error occurred loading the list of calendars."}))}})),Y()(this,"closeDestroyModal",(()=>{this.setState({isDestroyModalVisible:!1,calendarId:null})})),Y()(this,"showDestroyModal",(()=>{this.setState({isDestroyModalVisible:!0})})),Y()(this,"setSelectedCalendarList",(e=>{this.setState({selectedForDeletion:e})})),Y()(this,"deleteCalendars",(()=>{const{selectedForDeletion:e}=this.state;this.closeDestroyModal(),async function(e,t){if(void 0===e||0===e.length)return;const a=Object(ee.n)(),i=e.length>1?r.i18n.translate("xpack.ml.calendarsList.deleteCalendars.calendarsLabel",{defaultMessage:"{calendarsToDeleteCount} calendars",values:{calendarsToDeleteCount:e.length}}):`${e[0].calendar_id}`;a.add(r.i18n.translate("xpack.ml.calendarsList.deleteCalendars.deletingCalendarsNotificationMessage",{defaultMessage:"Deleting {messageId}",values:{messageId:i}}));for(const t of e){const e=t.calendar_id;try{await X.ml.deleteCalendar({calendarId:e})}catch(e){console.log("Error deleting calendar:",e),a.addDanger({title:r.i18n.translate("xpack.ml.calendarsList.deleteCalendars.deletingCalendarErrorMessage",{defaultMessage:"An error occurred deleting calendar {calendarId}",values:{calendarId:t.calendar_id}}),text:Object(da.b)(e)})}}a.addSuccess(r.i18n.translate("xpack.ml.calendarsList.deleteCalendars.deletingCalendarSuccessNotificationMessage",{defaultMessage:"{messageId} deleted",values:{messageId:i}})),t()}(e,this.loadCalendars)})),Y()(this,"addRequiredFieldsToList",((e=[])=>{for(let t=0;t<e.length;t++)e[t].job_ids_string=e[t].job_ids.join(", "),e[t].events_length=e[t].events.length;return e})),this.state={loading:!0,calendars:[],isDestroyModalVisible:!1,calendarId:null,selectedForDeletion:[],nodesAvailable:Object($.e)()}}componentDidMount(){this.loadCalendars()}render(){const{calendars:e,selectedForDeletion:t,loading:a,nodesAvailable:i}=this.state,{canCreateCalendar:n,canDeleteCalendar:r}=this.props;let l="";const c=Object(ee.e)().links.ml.calendars;return this.state.isDestroyModalVisible&&(l=Object(g.jsx)(o.EuiConfirmModal,{"data-test-subj":"mlCalendarDeleteConfirmation",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsList.deleteCalendarsModal.deleteMultipleCalendarsTitle",defaultMessage:"Delete {calendarsCount, plural, one {{calendarsList}} other {# calendars}}?",values:{calendarsCount:t.length,calendarsList:t.map((e=>e.calendar_id)).join(", ")}}),onCancel:this.closeDestroyModal,onConfirm:this.deleteCalendars,cancelButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsList.deleteCalendarsModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.calendarsList.deleteCalendarsModal.deleteButtonLabel",defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:o.EUI_MODAL_CONFIRM_BUTTON})),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",{"data-test-subj":"mlPageCalendarManagement"},Object(g.jsx)(ud,{totalCount:e.length,refreshCalendars:this.loadCalendars}),Object(g.jsx)(pd,{loading:a,calendarsList:this.addRequiredFieldsToList(e),onDeleteClick:this.showDestroyModal,canCreateCalendar:n,canDeleteCalendar:r,mlNodesAvailable:i,setSelectedCalendarList:this.setSelectedCalendarList,itemsSelected:t.length>0}),l),Object(g.jsx)(sn.a,{docLink:c}))}}const md=Object(c.withKibana)(calendars_list_CalendarsListUI),bd=(e,t)=>({path:"/settings/calendars_list",title:r.i18n.translate("xpack.ml.settings.calendarList.docTitle",{defaultMessage:"Calendars"}),render:(e,t)=>Object(g.jsx)(fd,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),N("SETTINGS_BREADCRUMB",e,t),N("CALENDAR_MANAGEMENT_BREADCRUMB")]}),fd=({deps:e})=>{const{redirectToMlAccessDeniedPage:t}=e,{context:a}=I(void 0,void 0,e.config,e.dataViewsContract,{checkFullLicense:O.b,checkGetJobsCapabilities:()=>Object(w.c)(t),getMlNodeCount:$.c});Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1});const i=Object(w.e)("canCreateCalendar"),n=Object(w.e)("canDeleteCalendar");return Object(g.jsx)(T.b,{context:a},Object(g.jsx)(md,{canCreateCalendar:i,canDeleteCalendar:n}))};var hd;!function(e){e[e.NEW=0]="NEW",e[e.EDIT=1]="EDIT"}(hd||(hd={}));const gd=(e,t)=>({path:"/settings/calendars_list/new_calendar",title:r.i18n.translate("xpack.ml.settings.createCalendar.docTitle",{defaultMessage:"Create Calendar"}),render:(e,t)=>Object(g.jsx)(xd,_()({},e,{deps:t,mode:hd.NEW})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),N("SETTINGS_BREADCRUMB",e,t),N("CALENDAR_MANAGEMENT_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.settings.breadcrumbs.calendarManagement.createLabel",{defaultMessage:"Create"})}]}),jd=(e,t)=>({path:"/settings/calendars_list/edit_calendar/:calendarId",title:r.i18n.translate("xpack.ml.settings.editCalendar.docTitle",{defaultMessage:"Edit Calendar"}),render:(e,t)=>Object(g.jsx)(xd,_()({},e,{deps:t,mode:hd.EDIT})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("SETTINGS_BREADCRUMB",e,t),N("CALENDAR_MANAGEMENT_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.settings.breadcrumbs.calendarManagement.editLabel",{defaultMessage:"Edit"})}]}),xd=({location:e,mode:t,deps:a})=>{let i;if(t===hd.EDIT){const t=e.pathname.match(/.+\/(.+)$/);i=t&&t.length>1?t[1]:void 0}const{redirectToMlAccessDeniedPage:n}=a,s=Object(F.a)(E.b.ANOMALY_DETECTION_JOBS_MANAGE),{context:o}=I(void 0,void 0,a.config,a.dataViewsContract,{checkFullLicense:O.b,checkGetJobsCapabilities:()=>Object(w.c)(n),checkMlNodesAvailable:()=>Object($.a)(s)});Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1});const r=Object(w.e)("canCreateCalendar"),l=Object(w.e)("canDeleteCalendar");return Object(g.jsx)(T.b,{context:o},Object(g.jsx)(dd,{calendarId:i,canCreateCalendar:r,canDeleteCalendar:l}))};class edit_description_popover_EditDescriptionPopover extends n.Component{constructor(e){super(e),Y()(this,"onChange",(e=>{this.setState({value:e.target.value})})),Y()(this,"onButtonClick",(()=>{!1===this.state.isPopoverOpen?this.setState({isPopoverOpen:!this.state.isPopoverOpen,value:this.props.description}):this.closePopover()})),Y()(this,"closePopover",(()=>{!0===this.state.isPopoverOpen&&(this.setState({isPopoverOpen:!1}),this.props.updateDescription(this.state.value))})),this.state={isPopoverOpen:!1,value:e.description}}render(){const{isPopoverOpen:e,value:t}=this.state,a=Object(g.jsx)(o.EuiButtonIcon,{size:"s",color:"primary",onClick:this.onButtonClick,iconType:"pencil","aria-label":r.i18n.translate("xpack.ml.settings.filterLists.editDescriptionPopover.editDescriptionAriaLabel",{defaultMessage:"Edit description"}),isDisabled:!1===this.props.canCreateFilter,"data-test-subj":"mlFilterListEditDescriptionButton"});return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiPopover,{id:"filter_list_description_popover",ownFocus:!0,button:a,isOpen:e,closePopover:this.closePopover,initialFocus:"#filter_list_edit_description_row"},Object(g.jsx)("div",{style:{width:"300px"}},Object(g.jsx)(o.EuiForm,null,Object(g.jsx)(o.EuiFormRow,{id:"filter_list_edit_description_row",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editDescriptionPopover.filterListDescriptionAriaLabel",defaultMessage:"Filter list description"})},Object(g.jsx)(o.EuiFieldText,{name:"filter_list_description",value:t,onChange:this.onChange,"data-test-subj":"mlFilterListDescriptionInput"}))))))}}Y()(edit_description_popover_EditDescriptionPopover,"displayName","EditDescriptionPopover");class filter_list_usage_popover_FilterListUsagePopover extends n.Component{constructor(e){super(e),Y()(this,"onButtonClick",(()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})})),Y()(this,"closePopover",(()=>{this.setState({isPopoverOpen:!1})})),this.state={isPopoverOpen:!1}}render(){const{entityType:e,entityValues:t}=this.props,a=`${t.length} ${e}${1!==t.length?"s":""}`,i=t.map((e=>Object(g.jsx)("li",{key:e},e))),n=Object(g.jsx)(o.EuiButtonEmpty,{size:"s",color:"primary",onClick:this.onButtonClick},a);return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiPopover,{id:`${e}_filter_list_usage`,panelClassName:"ml-filter-list-usage-popover",ownFocus:!0,button:n,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover},Object(g.jsx)("ul",null,i)))}}const vd=({canCreateFilter:e,filterId:t,totalItemCount:a,description:i,updateDescription:n,newFilterId:l,isNewFilterIdInvalid:c,updateNewFilterId:d,usedBy:u})=>{const p=void 0!==t?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterHeader.filterListTitle",defaultMessage:"Filter list {filterId}",values:{filterId:t}}):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterHeader.createFilterListTitle",defaultMessage:"Create new filter list"});let b,f,h;if(void 0===t){const e=r.i18n.translate("xpack.ml.settings.filterLists.editFilterHeader.allowedCharactersDescription",{defaultMessage:"Use lowercase alphanumerics (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"}),t=!1===c?e:void 0,a=!0===c?[e]:void 0;b=Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterHeader.filterListIdAriaLabel",defaultMessage:"Filter list ID"}),helpText:t,error:a,isInvalid:c},Object(g.jsx)(o.EuiFieldText,{name:"new_filter_id",value:l,isInvalid:c,onChange:e=>d(e.target.value),"data-test-subj":"mlNewFilterListIdInput"}))}return f=void 0!==i&&i.length>0?Object(g.jsx)(o.EuiText,{"data-test-subj":"mlNewFilterListDescriptionText"},Object(g.jsx)("p",null,i)):Object(g.jsx)(o.EuiText,null,Object(g.jsx)(o.EuiTextColor,{color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterList.addDescriptionText",defaultMessage:"Add a description"}))),void 0!==t&&(h=void 0!==u&&u.jobs.length>0?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",{className:"ml-filter-list-usage"},Object(g.jsx)(o.EuiText,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterList.filterIsUsedInJobsDescription",defaultMessage:"This filter list is used in"})),Object(g.jsx)(filter_list_usage_popover_FilterListUsagePopover,{entityType:"detector",entityValues:u.detectors}),Object(g.jsx)(o.EuiText,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterList.acrossText",defaultMessage:"across"})),Object(g.jsx)(filter_list_usage_popover_FilterListUsagePopover,{entityType:"job",entityValues:u.jobs})),Object(g.jsx)(o.EuiSpacer,{size:"s"})):Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiText,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterList.filterIsNotUsedInJobsDescription",defaultMessage:"This filter list is not used by any jobs."}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}))),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,p),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"baseline"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTextColor,{color:"subdued"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterList.totalItemsDescription",defaultMessage:"{totalItemCount, plural, one {# item} other {# items}} in total",values:{totalItemCount:a}}))))))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),b,Object(g.jsx)(o.EuiFlexGroup,{alignItems:"baseline",gutterSize:"s",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},f),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(edit_description_popover_EditDescriptionPopover,{canCreateFilter:e,description:i,updateDescription:n}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),h)};vd.displayName="EditFilterListHeader";class add_item_popover_AddItemPopover extends n.Component{constructor(e){super(e),Y()(this,"onItemsTextChange",(e=>{this.setState({itemsText:e.target.value})})),Y()(this,"onButtonClick",(()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})})),Y()(this,"closePopover",(()=>{this.setState({isPopoverOpen:!1})})),Y()(this,"onAddButtonClick",(()=>{const e=this.state.itemsText.split("\n"),t=[];e.forEach((e=>{-1===t.indexOf(e)&&e.length>0&&t.push(e)})),this.props.addItems(t),this.setState({isPopoverOpen:!1,itemsText:""})})),this.state={isPopoverOpen:!1,itemsText:""}}render(){const e=Object(g.jsx)(o.EuiButton,{size:"s",color:"primary",iconType:"arrowDown",iconSide:"right",onClick:this.onButtonClick,isDisabled:!1===this.props.canCreateFilter,"data-test-subj":"mlFilterListOpenNewItemsPopoverButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.addItemPopover.addItemButtonLabel",defaultMessage:"Add item"}));return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiPopover,{id:"add_item_popover",panelClassName:"ml-add-filter-item-popover",ownFocus:!0,button:e,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,initialFocus:"#filter_list_add_item_input_row"},Object(g.jsx)(o.EuiForm,null,Object(g.jsx)(o.EuiFormRow,{id:"filter_list_add_item_input_row",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.addItemPopover.itemsLabel",defaultMessage:"Items"})},Object(g.jsx)(o.EuiTextArea,{value:this.state.itemsText,onChange:this.onItemsTextChange,"data-test-subj":"mlFilterListAddItemTextArea"}))),Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.addItemPopover.enterItemPerLineDescription",defaultMessage:"Enter one item per line"})),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"flexEnd"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:this.onAddButtonClick,disabled:0===this.state.itemsText.length,"data-test-subj":"mlFilterListAddItemsButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.addItemPopover.addButtonLabel",defaultMessage:"Add"}))))))}}function yd({canCreateFilter:e,canDeleteFilter:t,onSearchChange:a,addItems:i,deleteSelectedItems:n,selectedItemCount:r}){const l=function(e,t,a,i,n){return[Object(g.jsx)(add_item_popover_AddItemPopover,{addItems:a,canCreateFilter:e,key:"add_item_btn"}),Object(g.jsx)(o.EuiButton,{color:"danger",size:"s",disabled:0===n||!1===t,onClick:i,key:"delete_item_btn","data-test-subj":"mlFilterListDeleteItemButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.toolbar.deleteItemButtonLabel",defaultMessage:"Delete item"}))]}(e,t,i,n,r);return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"xl"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiSearchBar,{toolsRight:l,onChange:a,filters:[]}))))}function Od(e,t){return e===t?"check":"empty"}Y()(add_item_popover_AddItemPopover,"displayName","AddItemPopover");class items_grid_pagination_ItemsGridPagination extends n.Component{constructor(e){super(e),Y()(this,"onButtonClick",(()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})})),Y()(this,"closePopover",(()=>{this.setState({isPopoverOpen:!1})})),Y()(this,"onPageClick",(e=>{this.props.setActivePage(e)})),Y()(this,"onChangeItemsPerPage",(e=>{this.closePopover(),this.props.setItemsPerPage(e)})),this.state={isPopoverOpen:!1}}render(){const{itemCount:e,itemsPerPage:t,itemsPerPageOptions:a,activePage:i}=this.props,n=Object(g.jsx)(o.EuiButtonEmpty,{size:"s",color:"text",iconType:"arrowDown",iconSide:"right",onClick:this.onButtonClick},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.itemsGrid.itemsPerPageButtonLabel",defaultMessage:"Items per page: {itemsPerPage}",values:{itemsPerPage:t}})),s=Math.ceil(e/t),r=a.map((e=>Object(g.jsx)(o.EuiContextMenuItem,{key:`${e} items`,icon:Od(e,t),onClick:()=>{this.onChangeItemsPerPage(e)}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.itemsGrid.itemsCountLabel",defaultMessage:"{pageSize} items",values:{pageSize:e}}))));return Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiPopover,{id:"customizablePagination",button:n,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none"},Object(g.jsx)(o.EuiContextMenuPanel,{items:r,className:"ml-items-grid-page-size-menu"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiPagination,{pageCount:s,activePage:i,onPageClick:this.onPageClick})))}}function Ed({numberColumns:e,totalItemCount:t,items:a,selectedItems:i,itemsPerPage:n,itemsPerPageOptions:s,setItemsPerPage:r,setItemSelected:l,activePage:c,setActivePage:d}){if(void 0===a||0===a.length)return Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,null,Object(g.jsx)("h4",null,0===t?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.itemsGrid.noItemsAddedTitle",defaultMessage:"No items have been added"}):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.itemsGrid.noMatchingItemsTitle",defaultMessage:"No matching items"})))));const u=c*n,p=a.slice(u,u+n).map(((e,t)=>Object(g.jsx)(o.EuiFlexItem,{key:`ml_grid_item_${t}`,"data-test-subj":`mlGridItem ${e}`},Object(g.jsx)(o.EuiCheckbox,{id:`ml_grid_item_${t}`,label:e,checked:i.indexOf(e)>=0,onChange:t=>{l(e,t.target.checked)},"data-test-subj":"mlGridItemCheckbox"}))));return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiFlexGrid,{columns:e,className:"eui-textBreakWord",gutterSize:"m"},p),Object(g.jsx)(items_grid_pagination_ItemsGridPagination,{itemCount:a.length,itemsPerPage:n,itemsPerPageOptions:s,setItemsPerPage:r,activePage:c,setActivePage:d}))}function wd(e,t){if(void 0===t)return[];if(void 0===e)return[...t];const a=t.map((e=>({value:e})));return o.EuiSearchBar.Query.execute(e,a,{defaultFields:["value"]}).map((e=>e.value))}function Md(e,t,a){let i=e;return t*e>a&&(i=Math.max(Math.ceil(a/t)-1,0)),i}Ed.defaultProps={numberColumns:4,itemsPerPage:50,itemsPerPageOptions:[50,100,500,1e3]};class edit_filter_list_EditFilterListUI extends n.Component{constructor(e){super(e),Y()(this,"returnToFiltersList",(async()=>{const{services:{http:{basePath:e},application:{navigateToUrl:t}}}=this.props.kibana;await t(`${e.get()}/app/ml/${E.b.FILTER_LISTS_MANAGE}`,!0)})),Y()(this,"loadFilterList",(e=>{X.ml.filters.filters({filterId:e}).then((e=>{this.setLoadedFilterState(e)})).catch((t=>{console.log(`Error loading filter ${e}:`,t);const{toasts:a}=this.props.kibana.services.notifications;a.addDanger(r.i18n.translate("xpack.ml.settings.filterLists.editFilterList.loadingDetailsOfFilterErrorMessage",{defaultMessage:"An error occurred loading details of filter {filterId}",values:{filterId:e}}))}))})),Y()(this,"setLoadedFilterState",(e=>{this.setState((t=>{const{itemsPerPage:a,searchQuery:i}=t,n=wd(i,e.items),s=Md(t.activePage,a,n.length);return{description:e.description,items:void 0!==e.items?[...e.items]:[],matchingItems:n,selectedItems:[],loadedFilter:e,isNewFilterIdInvalid:!1,activePage:s,searchQuery:i,saveInProgress:!1}}))})),Y()(this,"updateNewFilterId",(e=>{var t;this.setState({newFilterId:e,isNewFilterIdInvalid:(t=e,!(void 0!==t&&t.length>0&&Object(Qe.k)(t)))})})),Y()(this,"updateDescription",(e=>{this.setState({description:e})})),Y()(this,"addItems",(e=>{this.setState((t=>{const{itemsPerPage:a,searchQuery:i}=t,n=[...t.items],s=[];if(e.forEach((e=>{-1===n.indexOf(e)?n.push(e):s.push(e)})),n.sort(((e,t)=>e.localeCompare(t))),s.length>0){const{toasts:e}=this.props.kibana.services.notifications;e.addWarning(r.i18n.translate("xpack.ml.settings.filterLists.editFilterList.duplicatedItemsInFilterListWarningMessage",{defaultMessage:"The following items were already in the filter list: {alreadyInFilter}",values:{alreadyInFilter:s}}))}const o=wd(i,n),l=Md(t.activePage,a,o.length);return{items:n,matchingItems:o,activePage:l,searchQuery:i}}))})),Y()(this,"deleteSelectedItems",(()=>{this.setState((e=>{const{selectedItems:t,itemsPerPage:a,searchQuery:i}=e,n=[...e.items];t.forEach((e=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}));const s=wd(i,n),o=Md(e.activePage,a,s.length);return{items:n,matchingItems:s,selectedItems:[],activePage:o,searchQuery:i}}))})),Y()(this,"onSearchChange",(({query:e})=>{this.setState((t=>{const{items:a,itemsPerPage:i}=t,n=wd(e,a);return{matchingItems:n,activePage:Md(t.activePage,i,n.length),searchQuery:e}}))})),Y()(this,"setItemSelected",((e,t)=>{this.setState((a=>{const i=[...a.selectedItems],n=i.indexOf(e);return!0===t&&-1===n?i.push(e):!1===t&&-1!==n&&i.splice(n,1),{selectedItems:i}}))})),Y()(this,"setActivePage",(e=>{this.setState({activePage:e})})),Y()(this,"setItemsPerPage",(e=>{this.setState({itemsPerPage:e,activePage:0})})),Y()(this,"save",(()=>{this.setState({saveInProgress:!0});const{loadedFilter:e,newFilterId:t,description:a,items:i}=this.state,n=void 0!==this.props.filterId?this.props.filterId:t;(function(e,t,a,i){return new Promise(((n,s)=>{void 0===i||void 0===i.filter_id?function(e,t,a){const i=r.i18n.translate("xpack.ml.settings.filterLists.filterWithIdExistsErrorMessage",{defaultMessage:"A filter with id {filterId} already exists",values:{filterId:e}});return new Promise(((n,s)=>{X.ml.filters.filtersStats().then((o=>{-1===o.map((e=>e.filter_id)).indexOf(e)?X.ml.filters.addFilter(e,t,a).then((e=>{n(e)})).catch((e=>{s(e)})):(Object(ee.n)().addDanger(i),s(new Error(i)))})).catch((e=>{s(e)}))}))}(e,t,a).then((e=>{n(e)})).catch((e=>{s(e)})):function(e,t,a){return new Promise(((i,n)=>{const s=e.items,o=a.filter((e=>!1===s.includes(e))),r=s.filter((e=>!1===a.includes(e)));X.ml.filters.updateFilter(e.filter_id,t,o,r).then((e=>{i(e)})).catch((e=>{n(e)}))}))}(i,t,a).then((e=>{n(e)})).catch((e=>{s(e)}))}))})(n,a,i,e).then((e=>{this.setLoadedFilterState(e),this.returnToFiltersList()})).catch((e=>{console.log(`Error saving filter ${n}:`,e);const{toasts:t}=this.props.kibana.services.notifications;t.addDanger(r.i18n.translate("xpack.ml.settings.filterLists.editFilterList.savingFilterErrorMessage",{defaultMessage:"An error occurred saving filter {filterId}",values:{filterId:n}})),this.setState({saveInProgress:!1})}))})),this.state={description:"",items:[],matchingItems:[],selectedItems:[],loadedFilter:{},newFilterId:"",isNewFilterIdInvalid:!0,activePage:0,itemsPerPage:50,saveInProgress:!1}}componentDidMount(){const e=this.props.filterId;void 0!==e?this.loadFilterList(e):this.setState({newFilterId:""})}render(){const{loadedFilter:e,newFilterId:t,isNewFilterIdInvalid:a,description:i,items:n,matchingItems:r,selectedItems:l,itemsPerPage:c,activePage:d,saveInProgress:u}=this.state,{canCreateFilter:p,canDeleteFilter:b}=this.props,f=void 0!==n?n.length:0,h=Object(ee.e)().links.ml.customRules;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",{"data-test-subj":"mlPageFilterListEdit"},Object(g.jsx)(vd,{canCreateFilter:p,filterId:this.props.filterId,newFilterId:t,isNewFilterIdInvalid:a,updateNewFilterId:this.updateNewFilterId,description:i,updateDescription:this.updateDescription,totalItemCount:f,usedBy:e.used_by}),Object(g.jsx)(yd,{canCreateFilter:p,canDeleteFilter:b,onSearchChange:this.onSearchChange,addItems:this.addItems,deleteSelectedItems:this.deleteSelectedItems,selectedItemCount:l.length}),Object(g.jsx)(o.EuiSpacer,{size:"xl"}),Object(g.jsx)(Ed,{totalItemCount:f,items:r,selectedItems:l,itemsPerPage:c,setItemsPerPage:this.setItemsPerPage,setItemSelected:this.setItemSelected,activePage:d,setActivePage:this.setActivePage}),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"flexEnd"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{"data-test-subj":"mlFilterListCancelButton",onClick:()=>this.returnToFiltersList()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterList.cancelButtonLabel",defaultMessage:"Cancel"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:this.save,disabled:!0===u||!0===a||!1===p,fill:!0,"data-test-subj":"mlFilterListSaveButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.editFilterList.saveButtonLabel",defaultMessage:"Save"}))))),Object(g.jsx)(sn.a,{docLink:h}))}}Y()(edit_filter_list_EditFilterListUI,"displayName","EditFilterList");const Sd=Object(c.withKibana)(edit_filter_list_EditFilterListUI),_d=Object(c.withKibana)((function({totalCount:e,refreshFilterLists:t,kibana:a}){const i=a.services.docLinks.links.ml.customRules;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.listHeader.filterListsTitle",defaultMessage:"Filter Lists"})),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"baseline"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTextColor,{color:"subdued"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.listHeader.filterListsDescription",defaultMessage:"{totalCount} in total",values:{totalCount:e}})))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{size:"s",iconType:"refresh",onClick:()=>t(),"data-test-subj":"mlFilterListRefreshButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.listHeader.refreshButtonLabel",defaultMessage:"Refresh"})))))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiText,null,Object(g.jsx)("p",null,Object(g.jsx)(o.EuiTextColor,{color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.listHeader.filterListsContainsNotAllowedValuesDescription",defaultMessage:"Filter lists contain values that you can use to include or exclude events from the machine learning analysis.\nYou can use the same filter list in multiple jobs.{br}{learnMoreLink}",values:{br:Object(g.jsx)("br",null),learnMoreLink:Object(g.jsx)(o.EuiLink,{href:i,target:"_blank"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.listHeader.filterListsContainsNotAllowedValuesDescription.learnMoreLinkText",defaultMessage:"Learn more"}))}})))),Object(g.jsx)(o.EuiSpacer,{size:"m"}))}));class delete_filter_list_modal_DeleteFilterListModal extends n.Component{constructor(e){super(e),Y()(this,"closeModal",(()=>{this.setState({isModalVisible:!1})})),Y()(this,"showModal",(()=>{this.setState({isModalVisible:!0})})),Y()(this,"onConfirmDelete",(()=>{this.doDelete()})),this.state={isModalVisible:!1}}async doDelete(){const{selectedFilterLists:e,refreshFilterLists:t}=this.props;await async function(e){if(void 0===e||0===e.length)return;const t=Object(ee.n)();t.add(r.i18n.translate("xpack.ml.settings.filterLists.deleteFilterLists.deletingNotificationMessage",{defaultMessage:"Deleting {filterListsToDeleteLength, plural, one {{filterListToDeleteId}} other {# filter lists}}",values:{filterListsToDeleteLength:e.length,filterListToDeleteId:!!e.length&&e[0].filter_id}}));for(const a of e){const e=a.filter_id;try{await X.ml.filters.deleteFilter(e)}catch(e){console.log("Error deleting filter list:",e),t.addDanger(r.i18n.translate("xpack.ml.settings.filterLists.deleteFilterLists.deletingErrorMessage",{defaultMessage:"An error occurred deleting filter list {filterListId}{respMessage}",values:{filterListId:a.filter_id,respMessage:e.message?` : ${e.message}`:""}}))}}t.addSuccess(r.i18n.translate("xpack.ml.settings.filterLists.deleteFilterLists.filtersSuccessfullyDeletedNotificationMessage",{defaultMessage:"{filterListsToDeleteLength, plural, one {{filterListToDeleteId}} other {# filter lists}} deleted",values:{filterListsToDeleteLength:e.length,filterListToDeleteId:!!e.length&&e[0].filter_id}}))}(e),t(),this.closeModal()}render(){const{selectedFilterLists:e,canDeleteFilter:t}=this.props;let a;if(this.state.isModalVisible){const t=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.deleteFilterListModal.modalTitle",defaultMessage:"Delete {selectedFilterListsLength, plural, one {{selectedFilterId}} other {# filter lists}}?",values:{selectedFilterListsLength:e.length,selectedFilterId:!!e.length&&e[0].filter_id}});a=Object(g.jsx)(o.EuiConfirmModal,{title:t,className:"eui-textBreakWord",onCancel:this.closeModal,onConfirm:this.onConfirmDelete,cancelButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.deleteFilterListModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.deleteFilterListModal.confirmButtonLabel",defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:o.EUI_MODAL_CONFIRM_BUTTON,"data-test-subj":"mlFilterListDeleteConfirmation"})}return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiButton,{key:"delete_filter_list",iconType:"trash",color:"danger",onClick:this.showModal,isDisabled:void 0===e||0===e.length||!1===t,"data-test-subj":"mlFilterListsDeleteButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.deleteFilterListModal.deleteButtonLabel",defaultMessage:"Delete"})),a)}}function Td({usedBy:e}){let t;return t=void 0!==e&&e.jobs.length>0?Object(g.jsx)(o.EuiIcon,{type:"check","aria-label":r.i18n.translate("xpack.ml.settings.filterLists.table.inUseAriaLabel",{defaultMessage:"In use"}),"data-test-subj":"mlFilterListUsedByIcon inUse"}):Object(g.jsx)(o.EuiIcon,{type:"cross","aria-label":r.i18n.translate("xpack.ml.settings.filterLists.table.notInUseAriaLabel",{defaultMessage:"Not in use"}),"data-test-subj":"mlFilterListUsedByIcon notInUse"}),t}function Cd({canCreateFilter:e}){const t=Object(F.a)(E.b.FILTER_LISTS_NEW);return Object(g.jsx)(o.EuiButton,{key:"new_filter_list",onClick:t,isDisabled:!1===e,"data-test-subj":"mlFilterListsButtonCreate"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.table.newButtonLabel",defaultMessage:"New"}))}function kd(e,t,a,i){return[Object(g.jsx)(Cd,{key:"new_filter_list",canCreateFilter:e}),Object(g.jsx)(delete_filter_list_modal_DeleteFilterListModal,{canDeleteFilter:t,selectedFilterLists:a,refreshFilterLists:i})]}function Fd({canCreateFilter:e,canDeleteFilter:t,filterLists:a,selectedFilterLists:i,setSelectedFilterLists:n,refreshFilterLists:c}){const d={toolsRight:kd(e,t,i,c),box:{incremental:!0},filters:[]},u={selectable:e=>void 0===e.used_by||0===e.used_by.jobs.length,selectableMessage:()=>{},onSelectionChange:e=>n(e)};return Object(g.jsx)(s.a.Fragment,null,void 0===a||0===a.length?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{alignItems:"flexEnd",justifyContent:"flexEnd"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Cd,null))),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,null,Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.settings.filterLists.table.noFiltersCreatedTitle",defaultMessage:"No filters have been created"})))))):Object(g.jsx)("div",{"data-test-subj":"mlFilterListTableContainer"},Object(g.jsx)(o.EuiInMemoryTable,{className:"ml-filter-lists-table",items:a,itemId:"filter_id",columns:[{field:"filter_id",name:r.i18n.translate("xpack.ml.settings.filterLists.table.idColumnName",{defaultMessage:"ID"}),render:e=>Object(g.jsx)(l.Link,{to:`/${E.b.FILTER_LISTS_EDIT}/${e}`,"data-test-subj":"mlEditFilterListLink"},e),sortable:!0,scope:"row","data-test-subj":"mlFilterListColumnId"},{field:"description",name:r.i18n.translate("xpack.ml.settings.filterLists.table.descriptionColumnName",{defaultMessage:"Description"}),sortable:!0,"data-test-subj":"mlFilterListColumnDescription"},{field:"item_count",name:r.i18n.translate("xpack.ml.settings.filterLists.table.itemCountColumnName",{defaultMessage:"Item count"}),sortable:!0,"data-test-subj":"mlFilterListColumnItemCount"},{field:"used_by",name:r.i18n.translate("xpack.ml.settings.filterLists.table.inUseColumnName",{defaultMessage:"In use"}),render:e=>Object(g.jsx)(Td,{usedBy:e}),sortable:!0,"data-test-subj":"mlFilterListColumnInUse"}],search:d,pagination:!0,sorting:{sort:{field:"filter_id",direction:"asc"}},selection:u,isSelectable:!0,"data-test-subj":"mlFilterListsTable",rowProps:e=>({"data-test-subj":`mlFilterListRow row-${e.filter_id}`})})))}Y()(delete_filter_list_modal_DeleteFilterListModal,"displayName","DeleteFilterListModal"),Td.propTypes={usedBy:Zr.a.object},Td.displayName="UsedByIcon";class filter_lists_FilterListsUI extends n.Component{constructor(e){super(e),Y()(this,"setFilterLists",(e=>{this.setState((t=>{const a=e.map((e=>e.filter_id)),i=t.selectedFilterLists.filter((e=>-1!==a.indexOf(e.filter_id)));return{filterLists:e,selectedFilterLists:i}}))})),Y()(this,"setSelectedFilterLists",(e=>{this.setState({selectedFilterLists:e})})),Y()(this,"refreshFilterLists",(()=>{X.ml.filters.filtersStats().then((e=>{this.setFilterLists(e)})).catch((e=>{console.log("Error loading list of filters:",e);const{toasts:t}=this.props.kibana.services.notifications;t.addDanger(r.i18n.translate("xpack.ml.settings.filterLists.filterLists.loadingFilterListsErrorMessage",{defaultMessage:"An error occurred loading the filter lists"}))}))})),this.state={filterLists:[],selectedFilterLists:[]}}componentDidMount(){this.refreshFilterLists()}render(){const{filterLists:e,selectedFilterLists:t}=this.state,{canCreateFilter:a,canDeleteFilter:i}=this.props,n=Object(ee.e)().links.ml.customRules;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",{"data-test-subj":"mlPageFilterListManagement"},Object(g.jsx)(_d,{totalCount:e.length,refreshFilterLists:this.refreshFilterLists}),Object(g.jsx)(Fd,{canCreateFilter:a,canDeleteFilter:i,filterLists:e,selectedFilterLists:t,setSelectedFilterLists:this.setSelectedFilterLists,refreshFilterLists:this.refreshFilterLists})),Object(g.jsx)(sn.a,{docLink:n}))}}Y()(filter_lists_FilterListsUI,"displayName","FilterLists");const Id=Object(c.withKibana)(filter_lists_FilterListsUI),Dd=(e,t)=>({path:"/settings/filter_lists",title:r.i18n.translate("xpack.ml.settings.filterList.docTitle",{defaultMessage:"Filters"}),render:(e,t)=>Object(g.jsx)(Ad,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),N("SETTINGS_BREADCRUMB",e,t),N("FILTER_LISTS_BREADCRUMB")]}),Ad=({deps:e})=>{const{redirectToMlAccessDeniedPage:t}=e,{context:a}=I(void 0,void 0,e.config,e.dataViewsContract,{checkFullLicense:O.b,checkGetJobsCapabilities:()=>Object(w.c)(t),getMlNodeCount:$.c});Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1});const i=Object(w.e)("canCreateFilter"),n=Object(w.e)("canDeleteFilter");return Object(g.jsx)(T.b,{context:a},Object(g.jsx)(Id,{canCreateFilter:i,canDeleteFilter:n}))};var Ld;!function(e){e[e.NEW=0]="NEW",e[e.EDIT=1]="EDIT"}(Ld||(Ld={}));const Rd=(e,t)=>({path:"/settings/filter_lists/new_filter_list",title:r.i18n.translate("xpack.ml.settings.createFilter.docTitle",{defaultMessage:"Create Filter"}),render:(e,t)=>Object(g.jsx)(Pd,_()({},e,{mode:Ld.NEW,deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),N("SETTINGS_BREADCRUMB",e,t),N("FILTER_LISTS_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.settings.breadcrumbs.filterLists.createLabel",{defaultMessage:"Create"})}]}),Nd=(e,t)=>({path:"/settings/filter_lists/edit_filter_list/:filterId",title:r.i18n.translate("xpack.ml.settings.editFilter.docTitle",{defaultMessage:"Edit Filter"}),render:(e,t)=>Object(g.jsx)(Pd,_()({},e,{mode:Ld.EDIT,deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("SETTINGS_BREADCRUMB",e,t),N("FILTER_LISTS_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.settings.breadcrumbs.filterLists.editLabel",{defaultMessage:"Edit"})}]}),Pd=({location:e,mode:t,deps:a})=>{let i;if(t===Ld.EDIT){const t=e.pathname.match(/.+\/(.+)$/);i=t&&t.length>1?t[1]:void 0}const{redirectToMlAccessDeniedPage:n}=a,s=Object(F.a)(E.b.ANOMALY_DETECTION_JOBS_MANAGE),{context:o}=I(void 0,void 0,a.config,a.dataViewsContract,{checkFullLicense:O.b,checkGetJobsCapabilities:()=>Object(w.c)(n),checkMlNodesAvailable:()=>Object($.a)(s)});Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1});const r=Object(w.e)("canCreateFilter"),l=Object(w.e)("canDeleteFilter");return Object(g.jsx)(T.b,{context:o},Object(g.jsx)(Sd,{filterId:i,canCreateFilter:r,canDeleteFilter:l}))};var zd=a(97),Bd=a(92),Vd=a(115),Jd=a(181),Ud=a(210),Gd=a(57),qd=a.n(Gd);a(401);const $d=({section:e})=>{if(0===e.items.length)return null;const t=[{field:"title",name:"",render:e=>Object(g.jsx)("strong",null,e)},{field:"description",name:"",render:e=>Object(g.jsx)(s.a.Fragment,null,e)}];return Object(g.jsx)("div",{"data-test-subj":e.dataTestSubj},Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("span",null,e.title)),Object(g.jsx)(o.EuiBasicTable,{compressed:!0,items:e.items,columns:t,tableCaption:e.title,tableLayout:"auto",className:"mlExpandedRowDetailsSection","data-test-subj":`${e.dataTestSubj}-table`}))},Wd=({sections:e,dataTestSubj:t})=>Object(g.jsx)(o.EuiFlexGroup,{className:"mlExpandedRowDetails","data-test-subj":t},Object(g.jsx)(o.EuiFlexItem,{style:{width:"50%"}},e.filter((e=>"left"===e.position)).map((e=>Object(g.jsx)(n.Fragment,{key:e.title},Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)($d,{section:e}))))),Object(g.jsx)(o.EuiFlexItem,{style:{width:"50%"}},e.filter((e=>"right"===e.position)).map((e=>Object(g.jsx)(n.Fragment,{key:e.title},Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)($d,{section:e})))))),Hd=({json:e,dataTestSubj:t})=>Object(g.jsx)(o.EuiFlexGroup,{"data-test-subj":t},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiCodeBlock,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analyticsList.analyticsDetails.expandedRowJsonPane",{defaultMessage:"JSON of data frame analytics configuration"}),style:{width:"100%"},language:"json",fontSize:"s",paddingSize:"s",overflowHeight:300,isCopyable:!0,"data-test-subj":"mlAnalyticsDetailsJsonPreview"},JSON.stringify(e,null,2))),Object(g.jsx)(o.EuiFlexItem,{grow:!1}," ")),Yd=({progress:e})=>Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},Object(g.jsx)(o.EuiFlexItem,{style:{width:"100px"},grow:!1},Object(g.jsx)(o.EuiProgress,{value:e,max:100,color:"primary",size:"m"},e,"%")),Object(g.jsx)(o.EuiFlexItem,{style:{width:"35px"},grow:!1},Object(g.jsx)(o.EuiText,{size:"xs"},`${e}%`)));var Xd=a(83);a(406);const Qd=({analyticsId:e,dataTestSubj:t})=>{const[a,i]=Object(n.useState)([]),[s,o]=Object(n.useState)(!1),[l,c]=Object(n.useState)(""),d=Object(Z.c)(),u=Object(n.useCallback)((async()=>{try{o(!0);const t=await X.ml.dataFrameAnalytics.getAnalyticsAuditMessages(e);o(!1),i(t)}catch(e){o(!1),d.displayErrorToast(e,r.i18n.translate("xpack.ml.dfAnalyticsList.analyticsDetails.messagesPane.errorToastMessageTitle",{defaultMessage:"Error loading job messages"})),c(r.i18n.translate("xpack.ml.dfAnalyticsList.analyticsDetails.messagesPane.errorMessage",{defaultMessage:"Messages could not be loaded"}))}}),[]);return Object(n.useEffect)((()=>{u()}),[]),Object(Bd.x)({onRefresh:u}),Object(g.jsx)("div",{className:"mlExpandedRowJobMessages","data-test-subj":t},Object(g.jsx)(ca,{messages:a,loading:s,error:l,refreshMessage:u}))};function Kd(e){return"object"==typeof e?JSON.stringify(e):e.toString()}const Zd=({isLoading:e,evalData:t,resultProperty:a})=>Object(g.jsx)(n.Fragment,null,!1===e&&null!==t.error&&Object(g.jsx)(o.EuiIcon,{type:"alert",size:"s"}),!0===e&&Object(g.jsx)(o.EuiLoadingSpinner,{size:"s"}),!1===e&&null===t.error&&t[a]),eu={mse:"",msle:"",huber:"",rSquared:"",error:null},tu=({item:e})=>{var t,a,i,s,l,c;const[d,u]=Object(n.useState)(eu),[p,m]=Object(n.useState)(eu),[b,f]=Object(n.useState)(!1),[h,j]=Object(n.useState)(!1),x=null==e||null===(t=e.config)||void 0===t||null===(a=t.dest)||void 0===a?void 0:a.index,v=Object(Bd.k)(e.config.analysis),y=Object(Bd.p)(e.config.analysis),O=null!==(i=e.config.dest.results_field)&&void 0!==i?i:"ml",E=Object(Vd.e)(e.stats),w=Object(Xd.y)(e.config.analysis),M=Object(Xd.m)(e.config.analysis);Object(n.useEffect)((()=>{E&&w&&(async()=>{j(!0),f(!0);const e=await Object(Bd.u)({isTraining:!1,index:x,dependentVariable:v,resultsField:O,predictionFieldName:y,jobType:Xd.b.REGRESSION});if(!0===e.success&&e.eval&&Object(Xd.z)(e.eval)){const{mse:t,msle:a,huber:i,r_squared:n}=Object(Bd.r)(e.eval);m({mse:t,msle:a,huber:i,rSquared:n,error:null}),j(!1)}else j(!1),m({mse:"",msle:"",huber:"",rSquared:"",error:e.error});const t=await Object(Bd.u)({isTraining:!0,index:x,dependentVariable:v,resultsField:O,predictionFieldName:y,jobType:Xd.b.REGRESSION});if(!0===t.success&&t.eval&&Object(Xd.z)(t.eval)){const{mse:e,msle:a,huber:i,r_squared:n}=Object(Bd.r)(t.eval);u({mse:e,msle:a,huber:i,rSquared:n,error:null}),f(!1)}else f(!1),u({mse:"",msle:"",huber:"",rSquared:"",error:e.error})})()}),[E]);const S={...e.stats},_=S.analysis_stats?S.analysis_stats[`${M}_stats`]:void 0;null!==(s=e.config)&&void 0!==s&&s.description&&(S.description=e.config.description),delete S.progress;const T=Object.entries(S).map((([e,t])=>{const a=e.toString();return"state"===a?{title:a,description:Object(Ud.c)(Kd(t))}:"analysis_stats"!==a?{title:a,description:Kd(t)}:void 0})).filter((e=>void 0!==e)),C={title:r.i18n.translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.state",{defaultMessage:"State"}),items:T,position:"left",dataTestSubj:"mlAnalyticsTableRowDetailsSection state"},{currentPhase:k,totalPhases:F}=Object(Vd.d)(e.stats),I={title:r.i18n.translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.progress",{defaultMessage:"Progress"}),items:[{title:r.i18n.translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.phase",{defaultMessage:"Phase"}),description:`${k}/${F}`},...e.stats.progress.map((e=>({title:e.phase,description:Object(g.jsx)(Yd,{progress:e.progress_percent})})))],position:"right",dataTestSubj:"mlAnalyticsTableRowDetailsSection progress"},D={title:r.i18n.translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.stats",{defaultMessage:"Stats"}),items:[{title:"create_time",description:Object(Je.d)(1e3*qd()(e.config.create_time).unix())},{title:"model_memory_limit",description:null!==(l=e.config.model_memory_limit)&&void 0!==l?l:""},{title:"version",description:null!==(c=e.config.version)&&void 0!==c?c:""}],position:"left",dataTestSubj:"mlAnalyticsTableRowDetailsSection stats"},A=_?{title:r.i18n.translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.analysisStats",{defaultMessage:"Analysis stats"}),items:[{title:"timestamp",description:Object(Je.d)(1e3*qd()(_.timestamp).unix())},{title:"timing_stats",description:Kd(_.timing_stats)},...Object.entries(_.parameters||_.hyperparameters||{}).map((([e,t])=>({title:e.toString(),description:Kd(t)})))],position:"right",dataTestSubj:"mlAnalyticsTableRowDetailsSection analysisStats"}:void 0;E&&w&&D.items.push({title:"generalization mean squared error",description:Object(g.jsx)(Zd,{isLoading:h,evalData:p,resultProperty:Xd.h.MSE})},{title:"generalization mean squared logarithmic error",description:Object(g.jsx)(Zd,{isLoading:h,evalData:p,resultProperty:Xd.h.MSLE})},{title:"generalization r squared",description:Object(g.jsx)(Zd,{isLoading:h,evalData:p,resultProperty:Xd.h.R_SQUARED})},{title:"generalization pseudo huber loss function",description:Object(g.jsx)(Zd,{isLoading:b,evalData:p,resultProperty:Xd.h.HUBER})},{title:"training mean squared error",description:Object(g.jsx)(Zd,{isLoading:b,evalData:d,resultProperty:Xd.h.MSE})},{title:"training mean squared logarithmic error",description:Object(g.jsx)(Zd,{isLoading:b,evalData:d,resultProperty:Xd.h.MSLE})},{title:"training r squared",description:Object(g.jsx)(Zd,{isLoading:b,evalData:d,resultProperty:Xd.h.R_SQUARED})},{title:"training pseudo huber loss function",description:Object(g.jsx)(Zd,{isLoading:b,evalData:d,resultProperty:Xd.h.HUBER})});const L=[C,I],R=[D];void 0!==A&&R.push(A);const N=[{id:"ml-analytics-job-details",name:r.i18n.translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettingsLabel",{defaultMessage:"Job details"}),content:Object(g.jsx)(Wd,{sections:L,dataTestSubj:`mlAnalyticsTableRowDetailsTabContent job-details ${e.config.id}`}),"data-test-subj":`mlAnalyticsTableRowDetailsTab job-details ${e.config.id}`},{id:"ml-analytics-job-stats",name:r.i18n.translate("xpack.ml.dataframe.analyticsList.analyticsDetails.tabs.analyticsStatsLabel",{defaultMessage:"Job stats"}),content:Object(g.jsx)(Wd,{sections:R,dataTestSubj:`mlAnalyticsTableRowDetailsTabContent job-stats ${e.config.id}`}),"data-test-subj":`mlAnalyticsTableRowDetailsTab job-stats ${e.config.id}`},{id:"ml-analytics-job-json",name:"JSON",content:Object(g.jsx)(Hd,{json:e.config,dataTestSubj:`mlAnalyticsTableRowDetailsTabContent json ${e.config.id}`}),"data-test-subj":`mlAnalyticsTableRowDetailsTab json ${e.config.id}`},{id:"ml-analytics-job-messages",name:r.i18n.translate("xpack.ml.dataframe.analyticsList.analyticsDetails.tabs.analyticsMessagesLabel",{defaultMessage:"Job messages"}),content:Object(g.jsx)(Qd,{analyticsId:e.id,dataTestSubj:`mlAnalyticsTableRowDetailsTabContent job-messages ${e.config.id}`}),"data-test-subj":`mlAnalyticsTableRowDetailsTab job-messages ${e.config.id}`}];return Object(g.jsx)(o.EuiTabbedContent,{size:"s",tabs:N,initialSelectedTab:N[0],onTabClick:()=>{},expand:!1,style:{width:"100%"},"data-test-subj":`mlAnalyticsTableRowDetails-${e.config.id}`})},au=({isDisabled:e,navigateToSourceSelection:t})=>{const a=Object(g.jsx)(o.EuiButton,{disabled:e,fill:!0,onClick:()=>{t()},iconType:"plusInCircle",size:"s","data-test-subj":"mlAnalyticsButtonCreate"},r.i18n.translate("xpack.ml.dataframe.analyticsList.createDataFrameAnalyticsButton",{defaultMessage:"Create job"}));return e?Object(g.jsx)(o.EuiToolTip,{position:"top",content:Object(w.f)("canCreateDataFrameAnalytics")},a):a};var iu=a(214),nu=a(198),su=a(141);const ou=[{type:"field_value_selection",field:"job_type",name:r.i18n.translate("xpack.ml.dataframe.analyticsList.typeFilter",{defaultMessage:"Type"}),multiSelect:"or",options:Object.values(zd.a).map((e=>({value:e,name:e,view:Object(Ud.b)(e)})))},{type:"field_value_selection",field:"state",name:r.i18n.translate("xpack.ml.dataframe.analyticsList.statusFilter",{defaultMessage:"Status"}),multiSelect:"or",options:Object.values(Vd.b).map((e=>({value:e,name:e,view:Object(Ud.c)(e)})))}],ru=({isMlEnabledInSpace:e=!0,blockRefresh:t=!1,pageState:a,updatePageState:i})=>{var s;const l=Object(y.e)(),c=null!==(s=a.queryText)&&void 0!==s?s:"",d=Object(n.useCallback)((e=>{i({queryText:e})}),[i]),[u,p]=Object(n.useState)(!1),[m,b]=Object(n.useState)(!1),[f,h]=Object(n.useState)([]),[j,x]=Object(n.useState)(),[v,O]=Object(n.useState)([]),[M,S]=Object(n.useState)(void 0),[_,T]=Object(n.useState)([]),[C,k]=Object(n.useState)(void 0),[F,I]=Object(n.useState)(0),D=Object(su.a)(),A=!Object(w.e)("canCreateDataFrameAnalytics")||!Object(w.e)("canStartStopDataFrameAnalytics"),L=Object(Jd.d)(O,S,k,p,I,t),R=Object(n.useCallback)((e=>{if(e.length){const t=function(e,t){if(0===t.length)return e;const a=e.reduce(((e,t)=>(e[t.id]={job:t,count:0},e)),{});return t.forEach((t=>{const i="must"===t.match;let n=[];n="term"===t.type?!0===i?e.filter((e=>{var a,n;return Object(te.g)(e.id,t.value)===i||Object(te.g)(e.config.description,t.value)===i||Object(te.g)(null===(a=e.stats)||void 0===a||null===(n=a.memory_usage)||void 0===n?void 0:n.status,t.value)===i})):e.filter((e=>{var a,n;return Object(te.g)(e.id,t.value)===i&&Object(te.g)(e.config.description,t.value)===i&&Object(te.g)(null===(a=e.stats)||void 0===a||null===(n=a.memory_usage)||void 0===n?void 0:n.status,t.value)===i})):Array.isArray(t.value)?e.filter((e=>t.value.includes(e[t.field]))):e.filter((e=>e[t.field]===t.value)),n.forEach((e=>a[e.id].count++))})),Object.values(a).filter((e=>(e&&e.count)>=t.length)).map((e=>e.job))}(v,e);h(t)}else h(v)}),[v]);Object(n.useEffect)((()=>{(()=>{if(""!==c){const e=o.EuiSearchBar.Query.parse(c);let t=[];e&&void 0!==e.ast&&void 0!==e.ast.clauses&&(t=e.ast.clauses),R(t)}else R([])})()}),[c]);const N=Object(n.useCallback)((()=>L(!0)),[]),{refresh:P}=Object(Bd.x)({isLoading:b,onRefresh:N});Object(n.useEffect)((function(){N()}),[D]);const{columns:z,modals:B}=Object(Ud.e)(_,T,e,P),{onTableChange:V,pagination:J,sorting:U}=Object(nu.a)(f.length,a,i),G=Object(n.useCallback)((async()=>{await l(E.b.DATA_FRAME_ANALYTICS_SOURCE_SELECTION)}),[]);if(!u)return null;if(void 0!==C)return Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.dataFrame.analyticsList.errorPromptTitle",{defaultMessage:"An error occurred getting the data frame analytics list."}),color:"danger",iconType:"alert"},Object(g.jsx)("pre",null,JSON.stringify(C)));if(0===v.length)return Object(g.jsx)("div",{"data-test-subj":"mlAnalyticsJobList"},Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(iu.a,null));const q=($=v,_.reduce(((e,t)=>{const a=$.find((e=>e.config.id===t));return void 0!==a&&(e[t]=Object(g.jsx)(tu,{item:a})),e}),{}));var $;const W=M&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Hi.a,{stats:M,dataTestSub:"mlAnalyticsStatsBar"})),H={query:c,onChange:e=>{null===e.error?(x(void 0),d(e.queryText)):x(e.error.message)},box:{incremental:!0},filters:ou};return Object(g.jsx)("div",{"data-test-subj":"mlAnalyticsJobList"},B,Object(g.jsx)(Qi.a,{jobCount:F}),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},W,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(au,{isDisabled:A,navigateToSourceSelection:G}))))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)("div",{"data-test-subj":"mlAnalyticsTableContainer"},Object(g.jsx)(o.EuiInMemoryTable,{allowNeutralSort:!1,columns:z,hasActions:!1,isExpandable:!0,itemIdToExpandedRowMap:q,isSelectable:!1,items:v,itemId:Vd.c.id,loading:m,onTableChange:V,pagination:J,sorting:U,search:H,"data-test-subj":m?"mlAnalyticsTable loading":"mlAnalyticsTable loaded",rowProps:e=>({"data-test-subj":`mlAnalyticsTableRow row-${e.id}`}),error:j})))};var lu=a(412),cu=a.n(lu),du=a(418),uu=a.n(du),pu=a(543),mu=a.n(pu),bu=a(544),fu=a.n(bu),hu=a(545),gu=a.n(hu);const ju="#C5CCD7",xu="ellipse",vu=e=>({autoungrabify:!0,boxSelectionEnabled:!1,maxZoom:3,minZoom:.2,style:[{selector:"node",style:{"background-color":t=>t.data("isRoot")?e.euiColorWarning:e.euiColorGhost,"background-height":"60%","background-width":"60%","border-color":t=>function(e,t){if(e.selected())return t.euiColorPrimary;switch(e.data("type")){case zd.e.ANALYTICS:return t.euiColorSuccess;case zd.e.TRANSFORM:return t.euiColorVis1;case zd.e.INDEX:return t.euiColorVis2;case zd.e.TRAINED_MODEL:return t.euiColorVis3;default:return t.euiColorMediumShade}}(t,e),"border-style":"solid","background-image":e=>function(e){switch(e.data("analysisType")){case zd.a.OUTLIER_DETECTION:return fu.a;case zd.a.CLASSIFICATION:return mu.a;case zd.a.REGRESSION:return gu.a;default:return}}(e),"border-width":e=>e.selected()?4:3,color:e.euiTextColor,"font-family":"Inter UI, Segoe UI, Helvetica, Arial, sans-serif","font-size":e.euiFontSizeXS,"min-zoomed-font-size":parseInt(e.euiSizeL,10),label:"data(label)",shape:e=>function(e,t){switch(e.data("type")){case zd.e.ANALYTICS:return xu;case zd.e.TRANSFORM:return"rectangle";case zd.e.INDEX:return"diamond";case zd.e.TRAINED_MODEL:return"triangle";default:return xu}}(e),"text-background-color":e.euiColorLightestShade,"text-background-opacity":0,"text-background-padding":e.euiSizeXS,"text-background-shape":"roundrectangle","text-margin-y":parseInt(e.euiSizeS,10),"text-max-width":"200px","text-valign":"bottom","text-wrap":"wrap"}},{selector:"edge",style:{"curve-style":"taxi","taxi-direction":"rightward","line-color":ju,"overlay-opacity":0,"target-arrow-color":ju,"target-arrow-shape":"triangle","target-distance-from-node":e.euiSizeXS,width:1,"source-arrow-shape":"none"}}]});cu.a.use(uu.a);const yu=Object(n.createContext)(void 0);function Ou({children:e,elements:t,theme:a,height:i,itemsDeleted:s,resetCy:o,style:r,width:l}){const[c,d]=function(e){const[t,a]=Object(n.useState)(),i=Object(n.useRef)(null);return Object(n.useEffect)((()=>{t||a(cu()({...e,container:i.current}))}),[e,t]),Object(n.useEffect)((()=>()=>{t&&t.destroy()}),[t]),[i,t]}({...vu(a),elements:t}),u={...r,height:i},p=Object(n.useCallback)((e=>{d&&i>0&&setTimeout((()=>d.layout(function(e,t){return{name:"dagre",rankDir:"LR",fit:!0,padding:20,spacingFactor:.95,boundingBox:{x1:0,y1:0,w:e,h:t}}}(l,i)).run()),150)}),[d,i,l]);return Object(n.useEffect)((()=>(d&&d.on("data",p),()=>{d&&d.removeListener("data",void 0,p)})),[d,t,i,l]),Object(n.useEffect)((()=>{d&&(!1===s||d.elements().remove(),d.add(t),d.trigger("data"))}),[d,t]),Object(n.useEffect)((()=>{d&&d.reset()}),[d,o]),Object(g.jsx)(yu.Provider,{value:d},Object(g.jsx)("div",{ref:c,style:u,"data-test-subj":"mlPageDataFrameAnalyticsMapCytoscape"},e))}var Eu=a(161),wu=a(343);function Mu(e){return Object.entries(e).map((([e,t])=>{let a;return a="create_time"===e?Object(Je.d)(1e3*qd()(t).unix()):"object"==typeof t?Object(g.jsx)(o.EuiCodeBlock,{language:"json",fontSize:"s",paddingSize:"s"},JSON.stringify(t,null,2)):t,{title:e,description:a}}))}const Su=s.a.memo((({details:e,getNodeData:t,modelId:a,refreshJobsCallback:i,updateElements:s})=>{const[l,c]=Object(n.useState)(!1),[d,u]=Object(n.useState)(),[p,b]=Object(n.useState)(!1),[f,h]=Object(n.useState)(!1),j=Object(w.e)("canCreateDataFrameAnalytics"),x=Object(w.e)("canDeleteDataFrameAnalytics"),v=Object(wu.b)(x),{closeDeleteJobCheckModal:O,deleteItem:M,deleteTargetIndex:S,isModalVisible:_,isDeleteJobCheckModalVisible:T,item:k,jobType:F,openModal:I,openDeleteJobCheckModal:D}=v,{toasts:A}=Object(y.f)(),L=Object(y.d)(),R=Object(y.e)(),N=Object(Eu.e)(),P=Object(n.useContext)(yu),z=Object(n.useCallback)((()=>{P&&P.elements().unselect(),c(!1),u(void 0)}),[P,u]),B=null==d?void 0:d.data("id"),V=null==d?void 0:d.data("label"),J=null==d?void 0:d.data("type"),U=Object(n.useCallback)((async()=>{const e=await Object(C.d)(V);if(null!==e){const t=await L.getUrl({page:E.b.DATA_FRAME_ANALYTICS_CREATE_JOB,pageState:{index:e}});await R(t)}else A.addDanger(r.i18n.translate("xpack.ml.dataframe.analyticsMap.flyout.dataViewMissingMessage",{defaultMessage:"To create a job from this index please create a data view for {indexTitle}.",values:{indexTitle:V}}))}),[V]),G=Object(n.useCallback)((async()=>{var t;N({config:e[B],stats:null===(t=e[B])||void 0===t?void 0:t.stats})}),[B]);if(Object(n.useEffect)((()=>{const e=e=>{u(e.target),c(!0)};return P&&(P.on("select","node",e),P.on("unselect","node",z)),()=>{P&&(P.removeListener("select","node",e),P.removeListener("unselect","node",z))}}),[P,z]),Object(n.useEffect)((function(){if(!1===_&&!0===M||!0===f){let t;!0!==S&&!0!==f||(t=`${e[B].dest.index}-${zd.e.INDEX}`),s(B,V,t),c(!1)}}),[_,M,f]),!1===l)return null;const q=Object(g.jsx)(o.EuiButton,{size:"s",iconType:"arrowDown",iconSide:"right",onClick:()=>{b(!p)}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.flyout.nodeActionsButton",defaultMessage:"Node actions"})),$=[...J===zd.e.ANALYTICS?[Object(g.jsx)(o.EuiContextMenuItem,{key:`${B}-delete`,icon:"trash",disabled:!x,onClick:()=>{var t;D({config:e[B],stats:null===(t=e[B])||void 0===t?void 0:t.stats})}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.flyout.deleteJobButton",defaultMessage:"Delete job"})),Object(g.jsx)(o.EuiContextMenuItem,{key:`${B}-clone`,icon:"copy",disabled:!j,onClick:G},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.flyout.cloneJobButton",defaultMessage:"Clone job"}))]:[],...J===zd.e.INDEX?[Object(g.jsx)(o.EuiContextMenuItem,{disabled:!j,key:`${B}-create`,icon:"plusInCircle",onClick:U},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.flyout.createJobButton",defaultMessage:"Create job from this index"}))]:[],...a===V||J!==zd.e.ANALYTICS&&J!==zd.e.INDEX?[]:[Object(g.jsx)(o.EuiContextMenuItem,{key:`${B}-fetch-related`,icon:"branch",onClick:()=>{t({id:V,type:J}),P&&P.elements().unselect(),c(!1),b(!1)}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.flyout.fetchRelatedNodesButton",defaultMessage:"Fetch related nodes"}))]];return Object(g.jsx)(o.EuiPortal,null,Object(g.jsx)(o.EuiFlyout,{ownFocus:!0,size:"m",onClose:z,"data-test-subj":"mlAnalyticsJobMapFlyout"},Object(g.jsx)(o.EuiFlyoutHeader,null,Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"xs"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTitle,{size:"s"},Object(g.jsx)("h3",{"data-test-subj":"mlDataFrameAnalyticsNodeDetailsTitle"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.flyoutHeaderTitle",defaultMessage:"Details for {type} {id}",values:{id:V,type:J}})))))),Object(g.jsx)(o.EuiFlyoutBody,null,Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,type:"column",listItems:Mu("index-pattern"===J?e[B][V]:e[B])})))),Object(g.jsx)(o.EuiFlyoutFooter,null,J!==zd.e.TRAINED_MODEL&&Object(g.jsx)(o.EuiPopover,{button:q,isOpen:p,closePopover:()=>{b(!1)},panelPaddingSize:"s",anchorPosition:"downLeft"},Object(g.jsx)(o.EuiContextMenuPanel,{items:$})))),T&&k&&Object(g.jsx)(Pi.a,{mlSavedObjectType:F,ids:[k.config.id],onCloseCallback:O,canDeleteCallback:()=>{I(v.item),O()},refreshJobsCallback:i,setDidUntag:h}),_&&Object(g.jsx)(wu.a,v))})),_u=({theme:e})=>{const[t,a]=Object(n.useState)(!1);return Object(g.jsx)(o.EuiFlexGroup,{className:"mlJobMapLegend__container",alignItems:"center","data-test-subj":"mlPageDataFrameAnalyticsMapLegend"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("span",{className:"mlJobMapLegend__sourceNode"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.legend.rootNodeLabel",defaultMessage:"source node"}))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("span",{className:"mlJobMapLegend__indexPattern"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.legend.indexLabel",defaultMessage:"index"}))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("span",{className:"mlJobMapLegend__transform"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},zd.e.TRANSFORM)))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("span",{style:{display:"inline-block",width:"0px",height:"0px",borderLeft:`${e.euiSizeS} solid ${e.euiPageBackgroundColor}`,borderRight:`${e.euiSizeS} solid ${e.euiPageBackgroundColor}`,borderBottom:`${e.euiSizeM} solid ${e.euiColorVis3}`}})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.legend.trainedModelLabel",defaultMessage:"trained model"}))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("span",{className:"mlJobMapLegend__analytics"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.legend.analyticsJobLabel",defaultMessage:"analytics jobs"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiPopover,{ownFocus:!0,button:Object(g.jsx)(o.EuiButtonIcon,{iconSize:"s",onClick:()=>a(!t),iconType:t?"arrowUp":"arrowDown","aria-label":r.i18n.translate("xpack.ml.dataframe.analyticsMap.legend.showJobTypesAriaLabel",{defaultMessage:"Show job types"})}),isOpen:t,closePopover:()=>a(!1)},Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiListGroup,{flush:!0},Object(g.jsx)(o.EuiListGroupItem,{iconType:"outlierDetectionJob",label:"Outlier detection",size:"xs"}),Object(g.jsx)(o.EuiListGroupItem,{iconType:"regressionJob",label:"Regression",size:"xs"}),Object(g.jsx)(o.EuiListGroupItem,{iconType:"classificationJob",label:"Classification",size:"xs"}))))))))))};var Tu=a(546),Cu=a.n(Tu);const ku=({analyticsId:e,modelId:t,forceRefresh:a})=>{const[i,s]=Object(n.useState)(!1),[l,c]=Object(n.useState)(!1),{elements:d,error:u,fetchAndSetElementsWrapper:p,message:b,nodeDetails:f,setElements:h,setError:j}=(()=>{const[e,t]=Object(n.useState)(!1),[a,i]=Object(n.useState)([]),[s,o]=Object(n.useState)({}),[l,c]=Object(n.useState)(),[d,u]=Object(n.useState)(),[p,m]=Object(n.useState)({}),b=async(e,n,l)=>{t(!0),n&&void 0===p[e]&&m({...p,[e]:l});const d=await X.ml.dataFrameAnalytics.getDataFrameAnalyticsMap(e,n,l),{elements:b,details:f,error:h}=d;if(null!==h&&(t(!1),c(h)),0===(null==b?void 0:b.length)&&u(r.i18n.translate("xpack.ml.dataframe.analyticsMap.emptyResponseMessage",{defaultMessage:"No related analytics jobs found for {id}.",values:{id:e}})),(null==b?void 0:b.length)>0)if(!1===n)i(b),o(f);else{const e=Object(Q.uniqWith)([...b,...a],Q.isEqual);i(e),o({...f,...s})}t(!1)};return{elements:a,error:l,fetchAndSetElementsWrapper:async e=>{const{analyticsId:t,id:a,modelId:i,type:n}=null!=e?e:{},s=void 0!==a;let o;if(o=void 0!==a?a:void 0!==i?i:t,await b(o,s,void 0!==i&&!1===s?zd.e.TRAINED_MODEL:n),Object.keys(p).length)for(const e in p)p.hasOwnProperty(e)&&await b(e,!0,p[e])},isLoading:e,message:d,nodeDetails:s,setElements:i,setError:c}})(),{services:{notifications:x,application:{navigateToUrl:v}}}=Object(y.b)(),O=Object(y.d)(),{euiTheme:w}=Object(ut.e)(),M=Object(su.a)();Object(n.useEffect)((()=>{p({analyticsId:e,modelId:t})}),[e,t]),Object(n.useEffect)((()=>{!0===a&&p({analyticsId:e,modelId:t})}),[a]),Object(n.useEffect)((()=>{void 0!==b&&x.toasts.add(b)}),[b]),Object(n.useEffect)((function(){M&&p({analyticsId:e,modelId:t})}),[M]),void 0!==u&&(x.toasts.addDanger(r.i18n.translate("xpack.ml.dataframe.analyticsMap.fetchDataErrorMessage",{defaultMessage:"Unable to fetch some data. An error occurred: {error}",values:{error:JSON.stringify(u)}})),j(void 0));const{ref:S,width:_,height:T}=function(){const e=Object(n.useRef)(null),t=Cu()().height;if(!e.current)return{ref:e,width:0,height:0};const{top:a,width:i}=e.current.getBoundingClientRect();return{ref:e,width:i,height:t-a}}();return Object(g.jsx)("div",{"data-test-subj":"mlPageDataFrameAnalyticsMap"},Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,{direction:"row",gutterSize:"none",justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(_u,{theme:w})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{size:"xs","data-test-subj":"mlAnalyticsResetGraphButton",onClick:()=>c(!l)},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsList.resetMapButtonLabel",defaultMessage:"Reset"})))),Object(g.jsx)("div",{style:{height:T-parseInt(w.gutterTypes.gutterLarge,10)-20},ref:S},Object(g.jsx)(Ou,{theme:w,height:T-20,elements:d,width:_,style:(C=w,{background:`linear-gradient(\n  90deg,\n  ${C.euiPageBackgroundColor}\n    calc(${C.euiSizeL} - calc(${C.euiSizeXS} / 2)),\n  transparent 1%\n)\ncenter,\nlinear-gradient(\n  ${C.euiPageBackgroundColor}\n    calc(${C.euiSizeL} - calc(${C.euiSizeXS} / 2)),\n  transparent 1%\n)\ncenter,\n${C.euiColorLightShade}`,backgroundSize:`${C.euiSizeL} ${C.euiSizeL}`,margin:`-${C.gutterTypes.gutterLarge}`,marginTop:0}),itemsDeleted:i,resetCy:l},Object(g.jsx)(Su,{details:f,getNodeData:p,modelId:t,updateElements:(t,a,i)=>{if(a===e)(async()=>{const e=await O.getUrl({page:E.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE});await v(e)})();else{const e=d.filter((e=>{let n=e.data.id!==t&&e.data.target!==t&&e.data.source!==t;var s,o,r;return void 0!==e.data.id&&e.data.type===zd.e.TRAINED_MODEL&&(n=n&&(null===(s=f[e.data.id])||void 0===s||null===(o=s.metadata)||void 0===o||null===(r=o.analytics_config)||void 0===r?void 0:r.id)!==a),void 0!==i?n&&e.data.id!==i&&e.data.target!==i&&e.data.source!==i:n}));s(!0),h(e)}},refreshJobsCallback:()=>p({analyticsId:e,modelId:t})}))));var C},Fu=()=>{var e,t;const[a,i]=Object(n.useState)(!1),[o]=Object(v.c)("_g"),[r,c]=Object(v.b)(E.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE,{pageIndex:0,pageSize:10,sortField:Vd.c.id,sortDirection:"asc"});(e=>{const{services:t}=Object(y.b)(),[a]=Object(v.c)("_g"),{timefilter:i}=t.data.query.timefilter,{refresh:s}=Object(Bd.x)();Object(n.useEffect)((()=>{let t=null;const n=i.getRefreshIntervalUpdate$().subscribe(o);function o(){const{value:a,pause:n}=i.getRefreshInterval();n?r():function(a){if(r(),a>=1e3){e(!1);const i=window.setInterval((()=>{s()}),a);t=i}}(a),s()}function r(){e(!0),null!==t&&window.clearInterval(t)}return i.disableTimeRangeSelector(),i.enableAutoRefreshSelector(),function(){var e;const t=null!==(e=null==a?void 0:a.refreshInterval)&&void 0!==e?e:i.getRefreshInterval(),{value:n}=t;0===n&&i.setRefreshInterval({pause:!1,value:3e4}),o()}(),()=>{n.unsubscribe(),r()}}),[])})(i);const[d,u]=Object(n.useState)(!1),{refresh:p}=Object(Bd.x)({isLoading:u}),b=Object(l.useLocation)(),f=Object(n.useMemo)((()=>b.pathname.split("/").pop()),[b]),h=null==o||null===(e=o.ml)||void 0===e?void 0:e.jobId,j=null==o||null===(t=o.ml)||void 0===t?void 0:t.modelId,{services:{docLinks:x}}=Object(y.b)(),O=x.links.ml.dataFrameAnalytics;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsList.title",defaultMessage:"Data Frame Analytics Jobs"})),Object(g.jsx)(Xi.a,null),Object(g.jsx)(Ki.a,{onCloseFlyout:p,forceRefresh:d}),Object(g.jsx)(Zi.a,null),"map"===f&&(h||j)&&Object(g.jsx)(ku,{analyticsId:h,modelId:j}),"data_frame_analytics"===f&&Object(g.jsx)(ru,{blockRefresh:a,pageState:r,updatePageState:c}),Object(g.jsx)(sn.a,{docLink:O}))},Iu=(e,t)=>({id:"data_frame_analytics",path:"/data_frame_analytics",title:r.i18n.translate("xpack.ml.dataFrameAnalytics.jobs.docTitle",{defaultMessage:"Data Frame Analytics Jobs"}),render:(e,t)=>Object(g.jsx)(Du,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("DATA_FRAME_ANALYTICS_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.jobsManagementLabel",{defaultMessage:"Jobs"})}],"data-test-subj":"mlPageDataFrameAnalytics",enableDatePicker:!0}),Du=({location:e,deps:t})=>{const{context:a}=I(void 0,void 0,t.config,t.dataViewsContract,W(t));return Object(g.jsx)(T.b,{context:a},Object(g.jsx)(Fu,null))};var Au=a(118);const Lu=(e,t,a,i="")=>Object(n.useMemo)((()=>{const n=[];return void 0===e||void 0===t?n:(t.length>1?n.push(...t.filter((t=>e.fields.some((e=>e.name===t&&"number"===e.type))))):n.push(...e.fields.filter((t=>"number"===t.type&&!e.metaFields.includes(t.name)&&!t.name.startsWith(`${i}.`)&&t.name!==Au.e)).map((e=>e.name))),Array.isArray(a)&&a.length>0?n.filter((e=>!a.includes(e))):n)}),[e,t,a]);var Ru=a(172),Nu=a(18),Pu=a(21),zu=a(130);const Bu=()=>Object(g.jsx)(o.EuiText,{textAlign:"center"},Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiLoadingSpinner,{size:"l"}),Object(g.jsx)(o.EuiSpacer,{size:"l"})),Vu=s.a.lazy((()=>a.e(14).then(a.bind(null,636)))),Ju=e=>Object(g.jsx)(o.EuiErrorBoundary,null,Object(g.jsx)(n.Suspense,{fallback:Object(g.jsx)(Bu,null)},Object(g.jsx)(Vu,e)));var Uu=a(222);const Gu="user_selection",qu="single_point_click",$u="#bbb",Wu=(Object(o.euiPaletteNegative)(2)[1],Object(o.euiPaletteColorBlind)()[2],[Object(o.euiPaletteColorBlind)()[1],Object(o.euiPaletteColorBlind)()[2]]),Hu=Object(o.euiPaletteColorBlind)({rotations:2}),Yu=Object(o.euiPalettePositive)(5),Xu=(e,t,a,i,n,s,o,l)=>{const c=n?{selection:{[Gu]:{type:"interval"},[qu]:{type:"single"},mlOutlierScoreThreshold:{type:"single",fields:["cutoff"],bind:{input:"range",max:1,min:0,name:r.i18n.translate("xpack.ml.splomSpec.outlierScoreThresholdName",{defaultMessage:"Outlier score threshold: "}),step:.01},init:{cutoff:.99}}}}:{selection:{[Gu]:{type:"interval"},[qu]:{type:"single",empty:"none"}}};return{data:{values:[...t]},mark:{...n&&s?{type:"circle",strokeWidth:1.2,strokeOpacity:.75,fillOpacity:.1}:{type:"circle",opacity:.75,size:8}},...n?{transform:[{calculate:`datum['${i}'] >= mlOutlierScoreThreshold.cutoff`,as:"is_outlier"}]}:{},encoding:{color:e?{value:$u}:a,opacity:{condition:{selection:Gu,value:.8},value:.5},...s?{stroke:a,opacity:{condition:{value:1,test:`(datum['${i}'] >= mlOutlierScoreThreshold.cutoff)`},value:.5}}:{},...n?{order:{field:i},size:{...s?{type:Uu.a.QUANTITATIVE,field:i,scale:{type:"linear",range:[8,200],domain:[0,1]}}:{condition:{value:40,test:`(datum['${i}'] >= mlOutlierScoreThreshold.cutoff)`},value:8}}}:{},x:{type:Uu.a.QUANTITATIVE,field:{repeat:"column"},scale:{zero:!1}},y:{type:Uu.a.QUANTITATIVE,field:{repeat:"row"},scale:{zero:!1}},tooltip:[...void 0!==l?[{type:a.condition.type,field:Qu(l)}]:[],...o.map((e=>({type:Uu.a.QUANTITATIVE,field:e}))),...n?[{type:Uu.a.QUANTITATIVE,field:i,format:".3f"}]:[]]},...e?{}:c,width:125,height:125}};function Qu(e){return e.replace(/([\.|\[|\]])/g,"\\$1")}a(551);const Ku=r.i18n.translate("xpack.ml.splom.toggleOn",{defaultMessage:"On"}),Zu=r.i18n.translate("xpack.ml.splom.toggleOff",{defaultMessage:"Off"}),ep=[100,1e3,1e4].map((e=>({value:e,text:""+e}))),tp=({label:e,tooltip:t})=>Object(g.jsx)(s.a.Fragment,null,e,Object(g.jsx)(o.EuiIconTip,{content:t,iconProps:{className:"eui-alignTop"},size:"s"}));function ap(e,t){var a;return null!==(a=e.map((e=>{var a;return Object(zu.i)(null!==(a=e.fields)&&void 0!==a?a:{},(e=>e.startsWith(`${t}.feature_importance`)))})).filter((e=>!Object.keys(e).some((t=>Array.isArray(e[t]))))))&&void 0!==a?a:[]}const ip=({fields:e,index:t,resultsField:a,color:i,legendType:l,searchQuery:c,runtimeMappings:d,indexPattern:u})=>{const{esSearch:p}=Object(y.a)(),[m,b]=Object(n.useState)(!1),[f,h]=Object(n.useState)([]);Object(n.useEffect)((()=>{const t=e.length>4?e.slice(0,4):e;h(t)}),[e]);const[j,x]=Object(n.useState)(1e3),[v,O]=Object(n.useState)(!1),[E,w]=Object(n.useState)(!1),[M,S]=Object(n.useState)(),_=Object(n.useMemo)((()=>e.map((e=>({label:e})))),[e]),{euiTheme:T}=Object(ut.e)();Object(n.useEffect)((()=>{if(0===f.length)return S({columns:[],items:[],backgroundItems:[],messages:[]}),void w(!1);const e={didCancel:!1};return async function(e){w(!0);const n=[];try{const o=`${a}.outlier_score`,l=void 0!==a,m=[...f,...void 0!==i?[i]:[],...l?[o]:[]],b=v?{function_score:{query:c,random_score:{seed:10,field:"_seq_no"}}}:c;let h;c&&(c.match_all&&Object.keys(c.match_all).length>0||c.bool&&Object.keys(c.bool).length>0)&&(h=v?{function_score:{query:{bool:{must_not:[c]}},random_score:{seed:10,field:"_seq_no"}}}:{bool:{must_not:[c]}});const g=u&&Object(zu.b)(u,d),x={fields:m,_source:!1,query:b,from:0,size:j,...Object(Pu.b)(g)?{runtime_mappings:g}:{}},y=[p({index:t,body:x})];h&&y.push(p({index:t,body:{...x,query:h}}));const[O,E]=await Promise.all(y);if(!e.didCancel){var s;const e=ap(O.hits.hits,a),t=ap(null!==(s=null==E?void 0:E.hits.hits)&&void 0!==s?s:[],a),i=O.hits.hits.length,o=i-e.length;i===o?n.push(r.i18n.translate("xpack.ml.splom.allDocsFilteredWarningMessage",{defaultMessage:"All fetched documents included fields with arrays of values and cannot be visualized."})):O.hits.hits.length!==e.length&&n.push(r.i18n.translate("xpack.ml.splom.arrayFieldsWarningMessage",{defaultMessage:"{filteredDocsCount} out of {originalDocsCount} fetched documents include fields with arrays of values and cannot be visualized.",values:{originalDocsCount:i,filteredDocsCount:o}})),S({columns:f,items:e,backgroundItems:t,messages:n}),w(!1)}}catch(e){w(!1),S({columns:[],items:[],backgroundItems:[],messages:[Object(Nu.extractErrorMessage)(e)]})}}(e),()=>{e.didCancel=!0}}),[j,JSON.stringify({fields:f,searchQuery:c}),t,v,a]);const C=Object(n.useMemo)((()=>{if(void 0===M)return;const{items:e,backgroundItems:t,columns:n}=M;return((e,t,a,i,n,s,o,r)=>{const l=e,c=a.map(Qu),d=void 0!==n,u=`${n}\\.outlier_score`,p=((e,t,a,i)=>"string"==typeof t?{condition:{selection:Gu,field:Qu("is_outlier"),type:Uu.a.NOMINAL,scale:{range:Wu}},value:$u}:void 0!==a&&void 0!==i?{condition:{selection:Gu,field:Qu(null!=a?a:"00FF00"),type:i,scale:{range:i===Uu.a.NOMINAL?Hu:Yu}},value:$u}:{condition:[{selection:Gu},{selection:qu}],value:$u})(0,n&&u,s,o),m={$schema:"https://vega.github.io/schema/vega-lite/v4.17.0.json",background:"transparent",view:{fill:"transparent",stroke:i.euiColorLightestShade},padding:10,config:{axis:{domainColor:i.euiColorLightShade,gridColor:i.euiColorLightestShade,tickColor:i.euiColorLightestShade,labelColor:i.euiTextSubduedColor,titleColor:i.euiTextSubduedColor},legend:{orient:"right",labelColor:i.euiTextSubduedColor,titleColor:i.euiTextSubduedColor}},repeat:{column:c,row:c.slice().reverse()},spec:{layer:[Xu(!1,l,p,u,d,!!r,c,s)]}};return t.length&&m.spec.layer.unshift(Xu(!0,t,p,u,d,!!r,c,s)),m})(e,t,n,T,a,i,l,m)}),[a,M,i,l,m]);return Object(g.jsx)(s.a.Fragment,null,void 0===M||void 0===C?Object(g.jsx)(Bu,null):Object(g.jsx)("div",{"data-test-subj":"mlScatterplotMatrix "+(E?"loading":"loaded")},Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(tp,{label:r.i18n.translate("xpack.ml.splom.fieldSelectionLabel",{defaultMessage:"Fields"}),tooltip:r.i18n.translate("xpack.ml.splom.fieldSelectionInfoTooltip",{defaultMessage:"Pick fields to explore their relationships."})}),display:"rowCompressed",fullWidth:!0},Object(g.jsx)(o.EuiComboBox,{compressed:!0,fullWidth:!0,placeholder:r.i18n.translate("xpack.ml.splom.fieldSelectionPlaceholder",{defaultMessage:"Select fields"}),options:_,selectedOptions:f.map((e=>({label:e}))),onChange:e=>{h(e.map((e=>e.label)))},isClearable:!0,"data-test-subj":"mlScatterplotMatrixFieldsComboBox"}))),Object(g.jsx)(o.EuiFlexItem,{style:{width:"200px"},grow:!1},Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(tp,{label:r.i18n.translate("xpack.ml.splom.sampleSizeLabel",{defaultMessage:"Sample size"}),tooltip:r.i18n.translate("xpack.ml.splom.sampleSizeInfoTooltip",{defaultMessage:"Amount of documents to display in the scatterplot matrix."})}),display:"rowCompressed",fullWidth:!0},Object(g.jsx)(o.EuiSelect,{"data-test-subj":"mlScatterplotMatrixSampleSizeSelect",compressed:!0,options:ep,value:j,onChange:e=>{x(Math.min(Math.max(parseInt(e.target.value,10),1),1e4))}}))),Object(g.jsx)(o.EuiFlexItem,{style:{width:"120px"},grow:!1},Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(tp,{label:r.i18n.translate("xpack.ml.splom.randomScoringLabel",{defaultMessage:"Random scoring"}),tooltip:r.i18n.translate("xpack.ml.splom.randomScoringInfoTooltip",{defaultMessage:"Uses a function score query to get randomly selected documents as the sample."})}),display:"rowCompressed",fullWidth:!0},Object(g.jsx)(o.EuiSwitch,{"data-test-subj":"mlScatterplotMatrixRandomizeQuerySwitch",name:"mlScatterplotMatrixRandomizeQuery",label:v?Ku:Zu,checked:v,onChange:()=>{O(!v)},disabled:E}))),void 0!==a&&void 0===l&&Object(g.jsx)(o.EuiFlexItem,{style:{width:"120px"},grow:!1},Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(tp,{label:r.i18n.translate("xpack.ml.splom.dynamicSizeLabel",{defaultMessage:"Dynamic size"}),tooltip:r.i18n.translate("xpack.ml.splom.dynamicSizeInfoTooltip",{defaultMessage:"Scales the size of each point by its outlier score."})}),display:"rowCompressed",fullWidth:!0},Object(g.jsx)(o.EuiSwitch,{name:"mlScatterplotMatrixDynamicSize",label:m?Ku:Zu,checked:m,onChange:()=>{b(!m)},disabled:E})))),M.messages.length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiCallOut,{color:"warning"},M.messages.map((e=>Object(g.jsx)("span",{key:Object(Ru.stringHash)(e)},e,Object(g.jsx)("br",null)))))),M.items.length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Ju,{vegaSpec:C}),M.backgroundItems.length?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,helpText:r.i18n.translate("xpack.ml.splom.backgroundLayerHelpText",{defaultMessage:"If the data points match your filter, they're shown in color; otherwise, they're blurred gray."})},Object(g.jsx)(s.a.Fragment,null))):null)))};var np=a(160);function sp(e){return{queryText:"",queryLanguage:nt.c.KUERY,pageIndex:0,pageSize:25,analysis:!1,evaluation:!0,feature_importance:!0,results:!0,splom:!0,...Object(re.isPopulatedObject)(e)?e:{}}}function op(e){return Object(v.b)(E.b.DATA_FRAME_ANALYTICS_EXPLORATION,sp(e))}a(323);const rp="header_items_loading",lp=({headerItems:e,content:t,isExpanded:a,contentPadding:i=!1,dataTestId:r,title:l,docsLink:c,urlStateKey:d})=>{const u=Object(n.useMemo)((()=>void 0!==a?{[d]:a}:void 0),[d,a]),[p,m]=op(u),b=void 0!==a&&p[d]===sp(u)[d]?a:p[d],f=Object(n.useCallback)((()=>{m({[d]:!b})}),[b,m,d]);return Object(g.jsx)(o.EuiPanel,{paddingSize:"none","data-test-subj":`mlDFExpandableSection-${r}`,hasShadow:!1,hasBorder:!0},Object(g.jsx)("div",{className:"mlExpandableSection"},Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween",gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{onClick:f,iconType:b?"arrowDown":"arrowRight",iconSide:"right",flush:"left","data-test-subj":`mlDFExpandableSection-${r}-toggle-button`},l)),void 0!==c&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},c)),e===rp&&Object(g.jsx)(o.EuiLoadingContent,{lines:1}),(h=e,Array.isArray(h)&&Object(g.jsx)(o.EuiFlexGroup,null,e.map((({label:e,value:t,id:a})=>Object(g.jsx)(o.EuiFlexItem,{grow:!1,key:a,"data-test-subj":`mlDFExpandableSectionItem-${r}-${a}`},void 0!==e&&void 0!==t&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(g.jsx)("p",null,e)))),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiBadge,null,t)))),void 0===e&&Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},t))))))),b&&Object(g.jsx)("div",{className:i?"mlExpandableSection-contentPadding":"","data-test-subj":`mlDFExpandableSection-${r}-content`},t));var h};var cp=a(169);const dp=({jobId:e})=>{const[t,a]=Object(n.useState)();Object(n.useEffect)((()=>{(async()=>{const t=await X.ml.dataFrameAnalytics.getDataFrameAnalytics(e),i=await X.ml.dataFrameAnalytics.getDataFrameAnalyticsStats(e),n=t.data_frame_analytics[0],s=Object(cp.b)(i)?i.data_frame_analytics[0]:void 0;if(void 0===s)return;const o={checkpointing:{},config:n,id:n.id,job_type:Object(Bd.h)(n.analysis),mode:Vd.a.BATCH,state:s.state,stats:s};a(o)})()}),[e]);const i=(e=>{if(void 0===e)return rp;const t=Array.isArray(e.config.source.index)?e.config.source.index.join():e.config.source.index;return[{id:"analysisTypeLabel",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.analysisTypeLabel",defaultMessage:"Type"}),value:e.job_type},{id:"analysisSourceIndexLabel",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.analysisSourceIndexLabel",defaultMessage:"Source index"}),value:t},{id:"analysisDestinationIndexLabel",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.analysisDestinationIndexLabel",defaultMessage:"Destination index"}),value:e.config.dest.index}]})(t),r=Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,{size:"full",margin:"none"}),void 0===t&&Object(g.jsx)(o.EuiText,{textAlign:"center"},Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiLoadingSpinner,{size:"l"}),Object(g.jsx)(o.EuiSpacer,{size:"l"})),void 0!==t&&Object(g.jsx)(tu,{item:t}));return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(lp,{dataTestId:"analysis",content:r,headerItems:i,urlStateKey:"analysis",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.analysisSectionTitle",defaultMessage:"Analysis"})}),Object(g.jsx)(o.EuiSpacer,{size:"m"}))};var up=a(114),pp=a(14);const mp=({destIndex:e,color:t})=>{const{services:{http:{basePath:a},application:{capabilities:i}}}=Object(y.b)(),r=Object(n.useMemo)((()=>!0===i.savedObjectsManagement.edit||!0===i.indexPatterns.save),[i]);return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiText,{size:"xs",color:null!=t?t:"warning"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.dataViewPromptMessage",defaultMessage:"No data view exists for index {destIndex}. ",values:{destIndex:null!=e?e:""}}),!0===r?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.dataViewPromptLink",defaultMessage:"{linkToDataViewManagement}{destIndex}.",values:{destIndex:e?` for ${e}`:"",linkToDataViewManagement:Object(g.jsx)(o.EuiLink,{href:`${a.get()}/app/management/kibana/dataViews/create`,target:"_blank"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.dataViewPromptLinkText",defaultMessage:"Create a data view"}))}}):null))},bp=r.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.documentsShownHelpText",{defaultMessage:"Showing documents for which predictions exist"}),fp=r.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.firstDocumentsShownHelpText",{defaultMessage:"Showing first {searchSize} documents for which predictions exist",values:{searchSize:Bd.f}}),hp=({colorRange:e,indexData:t,indexPattern:a,jobConfig:i,needsDestIndexPattern:n,searchQuery:l})=>{const{columnsWithCharts:c,status:d,tableItems:u}=t,p=((e,t,a,i,n,s)=>e.length>0&&(a.length>0||t===Bd.b.LOADED)?[{id:"explorationTableTotalDocs",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.explorationTableTotalDocsLabel",defaultMessage:"Total docs"}),value:`${n===pp.a.GTE?">":""}${i}`},...void 0!==s?[{id:"colorRangeLegend",value:Object(g.jsx)(ut.c,{colorRange:s,title:r.i18n.translate("xpack.ml.dataframe.analytics.exploration.colorRangeLegendTitle",{defaultMessage:"Feature influence score"})})}]:[]]:rp)(c,d,u,t.rowCount,t.rowCountRelation,e),b=i&&i.analysis?Object(Bd.h)(i.analysis):void 0,f=Object(g.jsx)(s.a.Fragment,null,void 0!==i&&n&&Object(g.jsx)("div",{className:"mlExpandableSection-contentPadding"},Object(g.jsx)(mp,{destIndex:i.dest.index})),void 0!==i&&(Object(up.h)(i.analysis)||Object(up.f)(i.analysis))&&Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued",className:"mlExpandableSection-contentPadding"},u.length===Bd.f?fp:bp),(c.length>0||l!==Bd.g)&&void 0!==a&&Object(g.jsx)(s.a.Fragment,null,c.length>0&&(u.length>0||d===Bd.b.LOADED)&&Object(g.jsx)(zu.a,_()({},t,{analysisType:b,dataTestSubj:"mlExplorationDataGrid",toastNotifications:Object(ee.n)()}))));return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(lp,{urlStateKey:"results",dataTestId:"results",content:f,headerItems:p,title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.explorationTableTitle",defaultMessage:"Results"})}),Object(g.jsx)(o.EuiSpacer,{size:"m"}))},gp=e=>{const t=Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiHorizontalRule,{size:"full",margin:"none"}),Object(g.jsx)("div",{className:"mlExpandableSection-contentPadding"},Object(g.jsx)(ip,e)));return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(lp,{dataTestId:"splom",urlStateKey:"splom",content:t,headerItems:void 0,isExpanded:!0,title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.splomSectionTitle",defaultMessage:"Scatterplot matrix"})}),Object(g.jsx)(o.EuiSpacer,{size:"m"}))};var jp=a(70),xp=a(113);const vp=({indexPattern:e,setSearchQuery:t,filters:a,query:i})=>{const[s,l]=Object(n.useState)(i),[c,d]=Object(n.useState)({}),[u,p]=Object(n.useState)(void 0),{services:m}=Object(y.b)(),{unifiedSearch:b,data:f,storage:h,appName:j,notifications:x,http:v,docLinks:O,uiSettings:E,dataViews:w}=m,M=Object(n.useMemo)((()=>new RegExp(`${null==a?void 0:a.columnId}\\s*:\\s*(true|false)`,"g")),[null==a?void 0:a.columnId]);Object(n.useEffect)((function(){if(void 0!==a){const e=i.query.match(M);let t;null!==e&&e[0].includes("true")?t=Object.keys(a.key).find((e=>!0===a.key[e])):null!==e&&e[0].includes("false")&&(t=Object.keys(a.key).find((e=>!1===a.key[e]))),t&&d({[t]:!0})}}),[]),Object(n.useEffect)((()=>{try{let a={};switch(i.language){case nt.c.KUERY:a=Object(bi.toElasticsearchQuery)(Object(bi.fromKueryExpression)(i.query),e);break;case nt.c.LUCENE:a=Object(bi.luceneStringToDsl)(i.query);break;default:return void p({query:i.query,message:r.i18n.translate("xpack.ml.queryBar.queryLanguageNotSupported",{defaultMessage:"Query language is not supported"})})}t({queryString:i.query,query:a,language:i.language})}catch(e){p({query:i.query,message:e.message})}}),[i.query]);const S=(e,a)=>{void 0===a&&d({}),t({queryString:e.query,language:e.language})},_=Object(Q.debounce)(((e,t)=>{let i="";const n=null==a?void 0:a.key[e],o=`${null==a?void 0:a.columnId}:${n}`;!1===t[e]?i=""!==s.query?Object(xp.q)(s.query,null==a?void 0:a.columnId,String(n)):"":!0===t[e]&&(i=""===s.query?o:null!==s.query.match(M)?s.query.replace(M,o):`${s.query} and ${o}`);const r={...s,query:i};l(r),S(r,!0)}),200);return Object(g.jsx)(o.EuiInputPopover,{style:{maxWidth:"100%"},closePopover:()=>p(void 0),input:Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(jp.QueryStringInput,{bubbleSubmitEvent:!1,query:s,indexPatterns:[e],onChange:e=>l(e),onSubmit:S,placeholder:s.language===nt.c.KUERY?r.i18n.translate("xpack.ml.stepDefineForm.queryPlaceholderKql",{defaultMessage:"Search for e.g. {example}",values:{example:'method : "GET" or status : "404"'}}):r.i18n.translate("xpack.ml.stepDefineForm.queryPlaceholderLucene",{defaultMessage:"Search for e.g. {example}",values:{example:"method:GET OR status:404"}}),disableAutoFocus:!0,dataTestSubj:"mlDFAnalyticsQueryInput",languageSwitcherPopoverAnchorPosition:"rightDown",appName:j,deps:{unifiedSearch:b,notifications:x,http:v,docLinks:O,uiSettings:E,data:f,storage:h,dataViews:w}})),a&&a.options&&Object(g.jsx)(o.EuiFlexItem,{grow:!1,"data-test-subj":"mlDFAnalyticsExplorationQueryBarFilterButtons"},Object(g.jsx)(o.EuiButtonGroup,{legend:r.i18n.translate("xpack.ml.dataframe.analytics.explorationQueryBar.buttonGroupLegend",{defaultMessage:"Analytics query bar filter buttons"}),options:a.options,type:"multi",idToSelectedMap:c,onChange:e=>{const t={[e]:!c[e]};d(t),_(e,t)}}))),isOpen:(null==u?void 0:u.query)===s.query&&""!==(null==u?void 0:u.message)},Object(g.jsx)(o.EuiCode,null,r.i18n.translate("xpack.ml.stepDefineForm.invalidQuery",{defaultMessage:"Invalid Query"}),": ",null==u?void 0:u.message.split("\n")[0]))},yp=e=>`${e.dest.results_field}.${np.c}`,Op=(e,t=[])=>t.reduce(((t,a)=>Array.isArray(a[`${e}.${np.b}`])?Math.max(t,a[`${e}.${np.b}`].length):t),0);var Ep=a(223);class data_loader_DataLoader{constructor(e,t){Y()(this,"_indexPattern",void 0),Y()(this,"_runtimeMappings",void 0),Y()(this,"_indexPatternTitle",""),Y()(this,"_maxExamples",10),this._indexPattern=e,this._runtimeMappings=this._indexPattern.getComputedFields().runtimeFields,this._indexPatternTitle=e.title}async loadFieldHistograms(e,t,a=Ep.a,i){return await X.ml.getVisualizerFieldHistograms({indexPattern:this._indexPatternTitle,query:t,fields:e,samplerShardSize:a,runtimeMappings:i||this._runtimeMappings})}set maxExamples(e){this._maxExamples=e}get maxExamples(){return this._maxExamples}isDisplayField(e){return!Ft.c.includes(e)}}var wp=a(560),Mp=a.n(wp),Sp=a(111);const _p=(e,t=Sp.b,a)=>{const[i,s]=op(),o=Object(zu.l)(e,25,t,a);return o.pagination=Object(n.useMemo)((()=>({pageSize:i.pageSize,pageIndex:i.pageIndex})),[i.pageSize,i.pageIndex]),o.setPagination=Object(n.useCallback)((e=>{s({...e})}),[s]),o.onChangePage=Object(n.useCallback)((e=>{s({pageIndex:e})}),[s]),o.onChangeItemsPerPage=Object(n.useCallback)((e=>{s({pageSize:e})}),[s]),o.resetPagination=Object(n.useCallback)((()=>{const e=sp();s({pageSize:e.pageSize,pageIndex:e.pageIndex})}),[s]),Mp()((function(){o.resetPagination()}),[i.queryText]),o},Tp=s.a.memo((({jobId:e})=>{var t,a,i;const{indexPattern:l,indexPatternErrorMessage:c,jobConfig:d,needsDestIndexPattern:u}=Object(Bd.y)(e),[p,m]=op(),[b,f]=Object(n.useState)(Bd.g),h=((e,t,a)=>{var i;const s=void 0!==e&&e.title===(null==t?void 0:t.source.index[0]),o=Object(n.useMemo)((()=>{const a=[];if(void 0!==t&&void 0!==e){const e=t.dest.results_field,{fieldTypes:i}=Object(Bd.n)(t,s);a.push(...Object(zu.e)(i,e).sort(((e,a)=>Object(Au.h)(e.id,a.id,t))))}return a}),[t,e]),r=_p(o,8,(e=>!e.includes(`.${np.b}.`)&&e!==Au.d&&e!==Au.e));Object(n.useEffect)((()=>{void 0!==t&&r.setSortingColumns([{id:yp(t),direction:"desc"}])}),[t&&t.id]),Object(n.useEffect)((()=>{const e={didCancel:!1};return Object(Bd.m)(t,r,a,e),()=>{e.didCancel=!0}}),[t&&t.id,r.pagination,a,r.sortingColumns]);const l=Object(n.useMemo)((()=>void 0!==e?new data_loader_DataLoader(e,Object(ee.n)()):void 0),[e]);Object(n.useEffect)((()=>{r.chartsVisible&&async function(){try{if(void 0!==t&&void 0!==l){const e=await l.loadFieldHistograms(o.filter((e=>r.visibleColumns.includes(e.id))).map((e=>({fieldName:e.id,type:Object(zu.f)(e.schema)}))),a);r.setColumnCharts(e)}}catch(e){Object(zu.k)(e,Object(ee.n)())}}()}),[r.chartsVisible,null==t?void 0:t.dest.index,JSON.stringify([a,[...r.visibleColumns].sort()])]);const c=Object(ut.d)(ut.a.BLUE,ut.b.INFLUENCER,void 0!==t?Op(t.dest.results_field,r.tableItems):1),d=Object(zu.m)(e,r.pagination,r.tableItems,null!==(i=null==t?void 0:t.dest.results_field)&&void 0!==i?i:zd.d,((e,a,i,n)=>{var s;let o;const r=i[`${null!==(s=null==t?void 0:t.dest.results_field)&&void 0!==s?s:""}.${np.b}`];if(Array.isArray(r)){const t=r.find((t=>e===t.feature_name[0]));t&&(o=c(t.influence[0]))}void 0!==o&&n({style:{backgroundColor:String(o)}})}));return{...r,renderCellValue:d}})(l,d,b),j=Object(n.useCallback)((e=>{e.query&&f(e.query),e.queryString!==p.queryText&&m({queryText:e.queryString,queryLanguage:e.language})}),[p,m]),x={query:p.queryText,language:p.queryLanguage},{columnsWithCharts:v,tableItems:y}=h,O=null!==(t=null==d?void 0:d.dest.results_field)&&void 0!==t?t:"",E=Op(O,y),w=Object(ut.d)(ut.a.BLUE,ut.b.INFLUENCER,E),M=Object(Bd.s)(null==d?void 0:d.analysis)&&!0===(null==d?void 0:d.analysis.outlier_detection.compute_feature_influence),S=!u&&Object(Bd.s)(null==d?void 0:d.analysis)&&!0===(null==d?void 0:d.analysis.outlier_detection.compute_feature_influence)&&-1===v.findIndex((e=>e.id===`${O}.${np.b}`)),_=Lu(l,null==d||null===(a=d.analyzed_fields)||void 0===a?void 0:a.includes,null==d||null===(i=d.analyzed_fields)||void 0===i?void 0:i.excludes,O),T=Object(Bd.l)(d);return void 0!==c?Object(g.jsx)(o.EuiPanel,{grow:!1,hasShadow:!1,hasBorder:!0},Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.dataframe.analytics.exploration.indexError",{defaultMessage:"An error occurred loading the index data."}),color:"danger",iconType:"cross"},Object(g.jsx)("p",null,c,u?Object(g.jsx)(mp,{destIndex:T,color:"text"}):null))):Object(g.jsx)(s.a.Fragment,null,void 0!==(null==d?void 0:d.description)&&""!==(null==d?void 0:d.description)&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiText,null,null==d?void 0:d.description),Object(g.jsx)(o.EuiSpacer,{size:"m"})),(v.length>0||b!==Bd.g)&&void 0!==l&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(vp,{indexPattern:l,setSearchQuery:j,query:x}),Object(g.jsx)(o.EuiSpacer,{size:"m"})),"string"==typeof(null==d?void 0:d.id)&&Object(g.jsx)(dp,{jobId:null==d?void 0:d.id}),"string"==typeof(null==d?void 0:d.id)&&_.length>1&&Object(g.jsx)(gp,{fields:_,index:null==d?void 0:d.dest.index,resultsField:null==d?void 0:d.dest.results_field,searchQuery:b}),S&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiCallOut,{size:"s",title:r.i18n.translate("xpack.ml.dataframe.analytics.outlierExploration.legacyFeatureInfluenceFormatCalloutTitle",{defaultMessage:"Color coded table cells based on feature influence are not available because the results index uses an unsupported legacy format. Please clone and rerun the job."}),iconType:"pin"}),Object(g.jsx)(o.EuiSpacer,{size:"m"})),Object(g.jsx)(hp,{colorRange:M&&!S?w:void 0,indexData:h,indexPattern:l,jobConfig:d,needsDestIndexPattern:u,searchQuery:b}))}));var Cp=a(137);const kp=s.a.memo((({indexPattern:e,jobConfig:t,needsDestIndexPattern:a,searchQuery:i})=>{const{services:{mlServices:{mlApiServices:s}}}=Object(y.b)(),o=((e,t,a,i,s)=>{var o;const[l,c]=Object(n.useState)(),d=Object(Cp.b)(),u=void 0!==e&&e.title===(null==t?void 0:t.source.index[0]),p=[];if(void 0!==t){const e=t.dest.results_field,{fieldTypes:a}=Object(Bd.n)(t,u);p.push(...Object(zu.e)(a,e).sort(((e,a)=>Object(Au.h)(e.id,a.id,t))))}const m=_p(p,8,(e=>!e.includes(`.${np.a}.`)&&!e.includes(`.${np.d}.`)&&e!==Au.d));Object(n.useEffect)((()=>{const e={didCancel:!1};return Object(Bd.m)(t,m,a,e),()=>{e.didCancel=!0}}),[t&&t.id,m.pagination,a,m.sortingColumns]);const b=Object(n.useMemo)((()=>void 0!==e?new data_loader_DataLoader(e,i):void 0),[e]);Object(n.useEffect)((()=>{m.chartsVisible&&async function(){try{if(void 0!==t&&void 0!==b){const e=await b.loadFieldHistograms(p.filter((e=>m.visibleColumns.includes(e.id))).map((e=>({fieldName:e.id,type:Object(zu.f)(e.schema)}))),a);m.setColumnCharts(e)}}catch(e){Object(zu.k)(e,i)}}()}),[m.chartsVisible,null==t?void 0:t.dest.index,JSON.stringify([a,m.visibleColumns])]);const f=Object(n.useMemo)((()=>{var e;if(t)return null!==(e=Object(up.e)(t.analysis))&&void 0!==e?e:Object(up.b)(t.analysis)}),[t]),h=Object(n.useCallback)((async()=>{try{if(void 0!==t&&void 0!==t.analysis&&(Object(Xd.y)(t.analysis)||Object(up.f)(t.analysis))){var e;const i=t.id,n=(await d.getTrainedModels(`${i}*`,{include:"feature_importance_baseline"})).find((e=>{var t,a;return(null===(t=e.metadata)||void 0===t||null===(a=t.analytics_config)||void 0===a?void 0:a.id)===i}));var a;void 0!==(null==n||null===(e=n.metadata)||void 0===e?void 0:e.feature_importance_baseline)&&c(null==n||null===(a=n.metadata)||void 0===a?void 0:a.feature_importance_baseline)}}catch(e){const t=Object(da.b)(e);i.addDanger({title:r.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.baselineErrorMessageToast",{defaultMessage:"An error occurred getting feature importance baseline"}),text:t})}}),[s,t]);Object(n.useEffect)((()=>{h()}),[t]);const g=null!==(o=null==t?void 0:t.dest.results_field)&&void 0!==o?o:zd.d,j=Object(zu.m)(e,m.pagination,m.tableItems,g);return{...m,renderCellValue:j,baseline:l,predictionFieldName:f,resultsField:g}})(e,t,i,Object(ee.n)(),s);return void 0===t||void 0===o?null:Object(g.jsx)("div",{"data-test-subj":"mlDFAnalyticsExplorationTablePanel"},Object(g.jsx)(hp,{indexData:o,indexPattern:e,jobConfig:t,needsDestIndexPattern:a,searchQuery:i}))})),Fp=r.i18n.translate("xpack.ml.dataframe.analytics.jobConfig.errorTitle",{defaultMessage:"Unable to fetch results. An error occurred loading the job configuration data."}),Ip=r.i18n.translate("xpack.ml.dataframe.analytics.jobCaps.errorTitle",{defaultMessage:"Unable to fetch results. An error occurred loading the index's field data."}),Dp=({jobCapsServiceErrorMessage:e,jobConfigErrorMessage:t,title:a})=>{const{services:{application:{getUrlForApp:i}}}=Object(y.b)(),s="string"==typeof e&&e.includes("locate that index-pattern")&&e.includes("click here to re-create"),r=Object(g.jsx)("p",null,t||e),l=Object(n.useMemo)((()=>i("management",{path:"kibana/indexPatterns"})),[]),c=s?Object(g.jsx)(o.EuiLink,{href:l,target:"_blank"},r):r;return Object(g.jsx)(o.EuiPanel,{grow:!1},Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiCallOut,{title:t?Fp:Ip,color:"danger",iconType:"cross"},c))},Ap=()=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiPanel,{className:"eui-textCenter"},Object(g.jsx)(o.EuiLoadingSpinner,{size:"xl"})),Object(g.jsx)(o.EuiSpacer,{size:"m"}));function Lp(e){return{options:[{id:"training",label:r.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.trainingSubsetLabel",{defaultMessage:"Training"})},{id:"testing",label:r.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.testingSubsetLabel",{defaultMessage:"Testing"})}],columnId:`${e}.is_training`,key:{training:!0,testing:!1}}}const Rp=({jobId:e,title:t,EvaluatePanel:a,FeatureImportanceSummaryPanel:i})=>{var l,c,d;const{indexPattern:u,indexPatternErrorMessage:p,isInitialized:m,isLoadingJobConfig:b,jobCapsServiceErrorMessage:f,jobConfig:h,jobConfigErrorMessage:j,jobStatus:x,needsDestIndexPattern:v,totalFeatureImportance:y}=Object(Bd.y)(e),[O,E]=op(),[w,M]=Object(n.useState)(Bd.g),S=Object(n.useCallback)((e=>{e.query&&M(e.query),e.queryString!==O.queryText&&E({queryText:e.queryString,queryLanguage:e.language})}),[O,E]),_={query:O.queryText,language:O.queryLanguage},T=null!==(l=null==h?void 0:h.dest.results_field)&&void 0!==l?l:"",C=Object(Bd.l)(h),k=Lu(u,null==h||null===(c=h.analyzed_fields)||void 0===c?void 0:c.includes,null==h||null===(d=h.analyzed_fields)||void 0===d?void 0:d.excludes,T);if(void 0!==p)return Object(g.jsx)(o.EuiPanel,{grow:!1},Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.dataframe.analytics.exploration.indexError",{defaultMessage:"An error occurred loading the index data."}),color:"danger",iconType:"cross"},Object(g.jsx)("p",null,p,v?Object(g.jsx)(mp,{destIndex:C,color:"text"}):null)));if(void 0!==j||void 0!==f)return Object(g.jsx)(Dp,{jobCapsServiceErrorMessage:f,jobConfigErrorMessage:j,title:t});const F=h&&h.analysis?Object(up.a)(null==h?void 0:h.analysis):void 0;return Object(g.jsx)(s.a.Fragment,null,void 0!==(null==h?void 0:h.description)&&""!==(null==h?void 0:h.description)&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiText,null,null==h?void 0:h.description),Object(g.jsx)(o.EuiSpacer,{size:"m"})),void 0!==u&&h&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{direction:"column"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(vp,{indexPattern:u,setSearchQuery:S,query:_,filters:Lp(h.dest.results_field)}))))),Object(g.jsx)(o.EuiSpacer,{size:"m"})),!0===b&&void 0===h&&Object(g.jsx)(Ap,null),!1===b&&void 0!==h&&!0===m&&Object(g.jsx)(dp,{jobId:h.id}),!0===b&&void 0===h&&Object(g.jsx)(Ap,null),!1===b&&void 0!==h&&!0===m&&Object(g.jsx)(a,{jobConfig:h,jobStatus:x,searchQuery:w}),!0===b&&void 0!==h&&void 0===y&&Object(g.jsx)(Ap,null),!1===b&&void 0!==h&&void 0!==y&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(i,{totalFeatureImportance:y,jobConfig:h})),Object(g.jsx)(o.EuiSpacer,{size:"m"}),!0===b&&void 0===h&&Object(g.jsx)(Ap,null),!1===b&&void 0!==h&&!0===m&&"string"==typeof(null==h?void 0:h.id)&&k.length>1&&void 0!==(null==h?void 0:h.analysis)&&Object(g.jsx)(gp,{fields:k,index:null==h?void 0:h.dest.index,color:F===Xd.b.REGRESSION||F===Xd.b.CLASSIFICATION?Object(up.c)(h.analysis):void 0,legendType:Object(Bd.q)(F),searchQuery:w}),!0===b&&void 0===h&&Object(g.jsx)(Ap,null),!1===b&&void 0!==h&&void 0!==u&&!0===m&&Object(g.jsx)(kp,{indexPattern:u,jobConfig:h,jobStatus:x,needsDestIndexPattern:v,searchQuery:w}))},Np={[Xd.h.MSE]:r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.meanSquaredErrorText",{defaultMessage:"Mean squared error"}),[Xd.h.MSLE]:r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.msleText",{defaultMessage:"Mean squared logarithmic error"}),[Xd.h.R_SQUARED]:r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.rSquaredText",{defaultMessage:"R squared"}),[Xd.h.HUBER]:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.huberText",defaultMessage:"{wikiLink}",values:{wikiLink:Object(g.jsx)(o.EuiLink,{href:"https://en.wikipedia.org/wiki/Huber_loss#Pseudo-Huber_loss_function",target:"_blank",external:!0},r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.huberLinkText",{defaultMessage:"Pseudo Huber loss function"}))}})},Pp={[Xd.h.MSE]:r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.meanSquaredErrorTooltipContent",{defaultMessage:"Measures how well the regression analysis model is performing. Mean squared sum of the difference between true and predicted values."}),[Xd.h.MSLE]:r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.msleTooltipContent",{defaultMessage:"Average squared difference between the logarithm of the predicted values and the logarithm of the actual (ground truth) value"}),[Xd.h.R_SQUARED]:r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.rSquaredTooltipContent",{defaultMessage:"Represents the goodness of fit. Measures how well the observed outcomes are replicated by the model."})},zp=({isLoading:e,statType:t,title:a,dataTestSubj:i})=>Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs","data-test-subj":i},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiStat,{reverse:!0,isLoading:e,title:a,description:Np[t],titleSize:"xxs"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},t!==Xd.h.HUBER&&Object(g.jsx)(o.EuiIconTip,{anchorClassName:"mlDataFrameAnalyticsRegression__evaluateStat",content:Pp[t]}))),Bp={mse:Xd.c,msle:Xd.c,huber:Xd.c,rSquared:Xd.c},Vp={...Bp,error:null},Jp=({jobConfig:e,jobStatus:t,searchQuery:a})=>{var i;const{services:{docLinks:l}}=Object(y.b)(),c=l.links.ml.regressionEvaluation,[d,u]=Object(n.useState)(Vp),[p,b]=Object(n.useState)(Vp),[f,h]=Object(n.useState)(!1),[j,x]=Object(n.useState)(!1),[v,O]=Object(n.useState)(void 0),[E,w]=Object(n.useState)(null),[M,S]=Object(n.useState)(null),_=e.dest.index,T=Object(Bd.k)(e.analysis),C=Object(Bd.p)(e.analysis),k=null!==(i=e.dest.results_field)&&void 0!==i?i:"ml";return Object(n.useEffect)((()=>{let t;const i=Object(Xd.A)(a)&&(a.bool.should||a.bool.filter);if(void 0!==i&&!1!==i)for(let e=0;e<i.length;e++){const a=i[e];if(a.match&&void 0!==a.match[`${k}.is_training`]){t=a.match[`${k}.is_training`];break}if(a.bool&&(void 0!==a.bool.should||void 0!==a.bool.filter)){const e=a.bool.should||a.bool.filter;if(void 0!==e)for(let a=0;a<e.length;a++){const i=e[a];if(i.match&&void 0!==i.match[`${k}.is_training`]){t=i.match[`${k}.is_training`];break}}}}O(t),(async()=>{(async(e=!0)=>{x(!0);const t=await Object(Bd.u)({isTraining:!1,index:_,dependentVariable:T,resultsField:k,predictionFieldName:C,searchQuery:a,ignoreDefaultQuery:e,jobType:Xd.b.REGRESSION});if(!0===t.success&&t.eval&&Object(Xd.z)(t.eval)){const{mse:e,msle:a,huber:i,r_squared:n}=Object(Bd.r)(t.eval);b({mse:e,msle:a,huber:i,rSquared:n,error:null}),x(!1)}else x(!1),b({...Bp,error:t.error})})(!1);const t=await Object(Bd.t)({ignoreDefaultQuery:!1,isTraining:!1,searchQuery:a,resultsField:k,destIndex:e.dest.index});!0===t.success?S(t.docsCount):S(null),(async(e=!0)=>{h(!0);const t=await Object(Bd.u)({isTraining:!0,index:_,dependentVariable:T,resultsField:k,predictionFieldName:C,searchQuery:a,ignoreDefaultQuery:e,jobType:Xd.b.REGRESSION});if(!0===t.success&&t.eval&&Object(Xd.z)(t.eval)){const{mse:e,msle:a,huber:i,r_squared:n}=Object(Bd.r)(t.eval);u({mse:e,msle:a,huber:i,rSquared:n,error:null}),h(!1)}else h(!1),u({...Bp,error:t.error})})(!1);const i=await Object(Bd.t)({ignoreDefaultQuery:!1,isTraining:!0,searchQuery:a,resultsField:k,destIndex:e.dest.index});!0===i.success?w(i.docsCount):w(null)})()}),[JSON.stringify(a)]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(lp,{urlStateKey:"evaluation",dataTestId:"RegressionEvaluation",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.evaluateSectionTitle",defaultMessage:"Model evaluation"}),docsLink:Object(g.jsx)(o.EuiButtonEmpty,{target:"_blank",iconType:"help",iconSide:"left",color:"primary",href:c},r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.regressionDocsLink",{defaultMessage:"Regression evaluation docs "})),headerItems:void 0!==t?[{id:"jobStatus",label:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateJobStatusLabel",{defaultMessage:"Job status"}),value:t}]:[],contentPadding:!0,content:Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiTitle,{size:"xxs"},Object(g.jsx)("span",null,r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.generalizationErrorTitle",{defaultMessage:"Generalization error"}))),null!==M&&Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.generalizationDocsCount",defaultMessage:"{docsCount, plural, one {# doc} other {# docs}} evaluated",values:{docsCount:M}}),!0===v&&0===M&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.generalizationFilterText",defaultMessage:". Filtering for training data."})),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zp,{dataTestSubj:"mlDFAnalyticsRegressionGenMSEstat",isLoading:j,title:p.mse,statType:Xd.h.MSE})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zp,{dataTestSubj:"mlDFAnalyticsRegressionGenRSquaredStat",isLoading:j,title:p.rSquared,statType:Xd.h.R_SQUARED})))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zp,{dataTestSubj:"mlDFAnalyticsRegressionGenMsleStat",isLoading:j,title:p.msle,statType:Xd.h.MSLE})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zp,{dataTestSubj:"mlDFAnalyticsRegressionGenHuberStat",isLoading:j,title:p.huber,statType:Xd.h.HUBER})))))),null!==p.error&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"danger"},!0===v&&0===M&&p.error.includes("No documents found")?r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.evaluateNoTestingDocsError",{defaultMessage:"No testing documents found"}):p.error)))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiTitle,{size:"xxs"},Object(g.jsx)("span",null,r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.trainingErrorTitle",{defaultMessage:"Training error"}))),null!==E&&Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.trainingDocsCount",defaultMessage:"{docsCount, plural, one {# doc} other {# docs}} evaluated",values:{docsCount:E}}),!1===v&&0===E&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.trainingFilterText",defaultMessage:". Filtering for testing data."})),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zp,{dataTestSubj:"mlDFAnalyticsRegressionTrainingMSEstat",isLoading:f,title:d.mse,statType:Xd.h.MSE})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zp,{dataTestSubj:"mlDFAnalyticsRegressionTrainingRSquaredStat",isLoading:f,title:d.rSquared,statType:Xd.h.R_SQUARED})))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zp,{dataTestSubj:"mlDFAnalyticsRegressionTrainingMsleStat",isLoading:f,title:d.msle,statType:Xd.h.MSLE})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(zp,{dataTestSubj:"mlDFAnalyticsRegressionTrainingHuberStat",isLoading:f,title:d.huber,statType:Xd.h.HUBER})))))),null!==d.error&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"danger"},!1===v&&0===E&&d.error.includes("No documents found")?r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.evaluateNoTrainingDocsError",{defaultMessage:"No training documents found"}):d.error)))))}),Object(g.jsx)(o.EuiSpacer,{size:"m"}))};var Up=a(188);const{euiColorMediumShade:Gp}=gt.euiLightVars,qp={axes:{axisLine:{stroke:Gp},tickLabel:{fontSize:12,fill:Gp},tickLine:{stroke:Gp},gridLine:{horizontal:{dash:[1,2]},vertical:{strokeWidth:0}}},legend:{spacingBuffer:100}},$p=r.i18n.translate("xpack.ml.dataframe.analytics.exploration.featureImportanceSummaryTooltipContent",{defaultMessage:"Total feature importance values indicate how significantly a field affects the predictions across all the training data."}),Wp=e=>e.classes.reduce(((e,t)=>e+t.importance.mean_magnitude),0),Hp=({totalFeatureImportance:e,jobConfig:t})=>{const{services:{docLinks:a}}=Object(y.b)(),[i,l,c,d]=Object(n.useMemo)((()=>{let t=[],a={xAccessor:"featureName",yAccessors:["meanImportance"],name:r.i18n.translate("xpack.ml.dataframe.analytics.exploration.featureImportanceYSeriesName",{defaultMessage:"magnitude"})},i="";if(e.length<1)return[t,a,void 0,void 0];Object(Up.b)(e[0])&&(2===e[0].classes.length&&(i="binary_classification",t=e.map((e=>({featureName:e.feature_name,meanImportance:e.classes[0].importance.mean_magnitude}))).sort(((e,t)=>t.meanImportance-e.meanImportance))),e[0].classes.length>2&&(i="multiclass_classification",e.sort(((e,t)=>Wp(t)-Wp(e))).forEach((e=>{const a=e.classes.sort(((e,t)=>t.importance.mean_magnitude-e.importance.mean_magnitude));t.push(...a.map((t=>({featureName:e.feature_name,meanImportance:t.importance.mean_magnitude,className:t.class_name}))))})),a={xAccessor:"featureName",yAccessors:["meanImportance"],splitSeriesAccessors:["className"],stackAccessors:["featureName"]})),Object(Up.d)(e[0])&&(i="regression",t=e.map((e=>({featureName:e.feature_name,meanImportance:e.importance.mean_magnitude}))).sort(((e,t)=>t.meanImportance-e.meanImportance)));const n="multiclass_classification"===i,s=e.length*(e.length<5?40:20)+50;return[t,a,n,s]}),[e]),u=a.links.ml.featureImportance,p=Object(n.useCallback)((e=>Number(e.toPrecision(3)).toString()),[]),b=Object(n.useMemo)((()=>{if(0===e.length&&(null!=t&&t.analysis&&Object(Xd.y)(null==t?void 0:t.analysis)||Object(Xd.v)(null==t?void 0:t.analysis))){const e=Object(Bd.h)(t.analysis);return"unknown"!==e&&0===t.analysis[e].num_top_feature_importance_values?Object(g.jsx)(o.EuiCallOut,{"data-test-subj":"mlTotalFeatureImportanceNotCalculatedCallout",size:"s",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.totalFeatureImportanceNotCalculatedCalloutMessage",defaultMessage:"Feature importance was not calculated because num_top_feature_importance values is set to 0."})}):Object(g.jsx)(o.EuiCallOut,{"data-test-subj":"mlNoTotalFeatureImportanceCallout",size:"s",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.noTotalFeatureImportanceCalloutMessage",defaultMessage:"Total feature importance data is not available; the data set is uniform and the features have no significant impact on the prediction."})})}}),[e,t]);return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(lp,{urlStateKey:"feature_importance",isExpanded:void 0===b,dataTestId:"FeatureImportanceSummary",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.featureImportanceSummaryTitle",defaultMessage:"Total feature importance"}),docsLink:Object(g.jsx)(o.EuiButtonEmpty,{target:"_blank",iconType:"help",iconSide:"left",color:"primary",href:u},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.featureImportanceDocsLink",defaultMessage:"Feature importance docs"})),headerItems:[{id:"FeatureImportanceSummary",value:$p}],content:b||Object(g.jsx)("div",{"data-test-subj":"mlTotalFeatureImportanceChart"},Object(g.jsx)(dt.Chart,{size:{width:"100%",height:d}},Object(g.jsx)(dt.Settings,{rotation:90,theme:qp,showLegend:c}),Object(g.jsx)(dt.Axis,{id:"x-axis",title:r.i18n.translate("xpack.ml.dataframe.analytics.exploration.featureImportanceXAxisTitle",{defaultMessage:"Feature importance average magnitude"}),position:dt.Position.Bottom,tickFormat:p}),Object(g.jsx)(dt.Axis,{id:"y-axis",title:"",position:dt.Position.Left}),Object(g.jsx)(dt.BarSeries,_()({id:"magnitude",xScaleType:dt.ScaleType.Ordinal,yScaleType:dt.ScaleType.Linear,data:i},l))))}),Object(g.jsx)(o.EuiSpacer,{size:"m"}))},Yp=({jobId:e})=>Object(g.jsx)(Rp,{jobId:e,title:r.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.tableJobIdTitle",{defaultMessage:"Destination index for regression job ID {jobId}",values:{jobId:e}}),EvaluatePanel:Jp,FeatureImportanceSummaryPanel:Hp});a(562);const Xp=({error:e})=>{let t=Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.generalErrorTitle",{defaultMessage:"An error occurred loading the data."}),color:"danger",iconType:"cross"},Object(g.jsx)("p",null,e));return"string"==typeof e&&e.includes("index_not_found")?t=Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.evaluateErrorTitle",{defaultMessage:"An error occurred loading the data."}),color:"danger",iconType:"cross"},Object(g.jsx)("p",null,r.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.noIndexCalloutBody",{defaultMessage:"The query for the index returned no results. Please make sure the destination index exists and contains documents."}))):"string"==typeof e&&e.includes("No documents found")?t=Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.noDataCalloutTitle",{defaultMessage:"Empty index query result."}),color:"primary"},Object(g.jsx)("p",null,r.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.noDataCalloutBody",{defaultMessage:"The query for the index returned no results. Please make sure the job has completed and the index contains documents."}))):"string"==typeof e&&e.includes("userProvidedQueryBuilder")&&(t=Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.queryParsingErrorTitle",{defaultMessage:"Unable to parse query."}),color:"primary"},Object(g.jsx)("p",null,r.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.queryParsingErrorBody",{defaultMessage:"The query syntax is invalid and returned no results. Please check the query syntax and try again."})))),Object(g.jsx)(n.Fragment,null,t)},Qp=({isLoading:e,title:t,description:a,dataTestSubj:i,tooltipContent:n})=>Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs","data-test-subj":i},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiStat,{reverse:!0,isLoading:e,title:null!==t?Math.round(1e3*t)/1e3:Xd.c,description:a,titleSize:"xs"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIconTip,{anchorClassName:"mlDataFrameAnalyticsRegression__evaluateStat",content:n}))),Kp=[{field:"className",name:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.recallAndAccuracyClassColumn",{defaultMessage:"Class"}),sortable:!0,truncateText:!0},{field:"accuracy",name:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.recallAndAccuracyAccuracyColumn",{defaultMessage:"Accuracy"}),render:e=>Math.round(1e3*e)/1e3},{field:"recall",name:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.recallAndAccuracyRecallColumn",{defaultMessage:"Recall"}),render:e=>Math.round(1e3*e)/1e3}],Zp=({evaluationMetricsItems:e})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiAccordion,{id:"recall-and-accuracy",buttonContent:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionRecallAndAccuracy",defaultMessage:"Per class recall and accuracy"})},Object(g.jsx)(o.EuiPanel,null,Object(g.jsx)(o.EuiInMemoryTable,{items:e,columns:Kp,pagination:!0,sorting:!0})))),em=Object(o.euiPaletteGray)(1)[0],tm="baseline",am=300,im=(e,t,a,i)=>{t.push({tpr:0,fpr:0,threshold:1,class_name:tm}),t.push({tpr:1,fpr:1,threshold:1,class_name:tm});const n=function(e){const t=[...e,tm].sort().indexOf(tm),a=Object(o.euiPaletteColorBlind)({rotations:2}).slice(0,e.length);return a.splice(t,0,em),a}(e);return{$schema:"https://vega.github.io/schema/vega-lite/v4.8.1.json",background:"transparent",padding:{left:45,top:0,right:0,bottom:0},config:{legend:{orient:"right",labelColor:i.euiTextSubduedColor,titleColor:i.euiTextSubduedColor},view:{continuousHeight:am,continuousWidth:am}},data:{name:"roc-curve-data"},datasets:{"roc-curve-data":t},encoding:{color:{field:"class_name",type:Uu.a.NOMINAL,scale:{range:n},legend:{title:a}},size:{value:2},strokeDash:{condition:{test:`(datum.class_name === '${tm}')`,value:[5,5]},value:[0]},x:{field:"fpr",sort:null,title:r.i18n.translate("xpack.ml.dataframe.analytics.rocChartSpec.xAxisTitle",{defaultMessage:"False Positive Rate (FPR)"}),type:"quantitative",axis:{tickColor:em,labelColor:i.euiTextSubduedColor,domainColor:em,titleColor:i.euiTextSubduedColor}},y:{field:"tpr",title:r.i18n.translate("xpack.ml.dataframe.analytics.rocChartSpec.yAxisTitle",{defaultMessage:"True Positive Rate (TPR) (a.k.a Recall)"}),type:"quantitative",axis:{tickColor:em,labelColor:i.euiTextSubduedColor,domainColor:em,titleColor:i.euiTextSubduedColor}},tooltip:[{type:Uu.a.NOMINAL,field:"class_name"},{type:Uu.a.QUANTITATIVE,field:"fpr"},{type:Uu.a.QUANTITATIVE,field:"tpr"}]},height:am,width:am,mark:{type:"line",strokeCap:"round",strokeJoin:"round"}}},nm="actual_class",sm="other";function om(e,t){return[{id:"actions",width:60,headerCellRender:()=>Object(g.jsx)("span",null,`${e} more`),rowCellRender:function(){const[e,a]=Object(n.useState)(!1);return Object(g.jsx)(o.EuiPopover,{isOpen:e,anchorPosition:"upCenter",button:Object(g.jsx)(o.EuiButtonIcon,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.showActions",{defaultMessage:"Show actions"}),iconType:"boxesHorizontal",color:"text",onClick:()=>a(!e)}),closePopover:()=>a(!1),ownFocus:!0},Object(g.jsx)(o.EuiButtonEmpty,{onClick:()=>t(!0)},Object(g.jsx)(o.EuiText,{size:"s",grow:!1,textAlign:"center"},r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.showAllColumns",{defaultMessage:"Show all columns"}))))}}]}function rm(e,t){let a;const i=Object(Xd.A)(e)&&(e.bool.should||e.bool.filter);if(void 0!==i&&!1!==i)for(let e=0;e<i.length;e++){const n=i[e];if(n.match&&void 0!==n.match[`${t}.is_training`]){a=n.match[`${t}.is_training`];break}if(n.bool&&(void 0!==n.bool.should||void 0!==n.bool.filter)){const e=n.bool.should||n.bool.filter;if(void 0!==e)for(let i=0;i<e.length;i++){const n=e[i];if(n.match&&void 0!==n.match[`${t}.is_training`]){a=n.match[`${t}.is_training`];break}}}}return a}const lm=1e5;a(567);const cm=({onClick:e})=>Object(g.jsx)(o.EuiButtonIcon,{className:"mlHelpPopover__buttonIcon",size:"s",iconType:"help","aria-label":r.i18n.translate("xpack.ml.helpPopover.ariaLabel",{defaultMessage:"Help"}),onClick:e}),dm=({anchorPosition:e,children:t,title:a})=>{const[i,s]=Object(n.useState)(!1);return Object(g.jsx)(o.EuiPopover,{anchorPosition:e,button:Object(g.jsx)(cm,{onClick:s.bind(null,!i)}),className:"mlHelpPopover",closePopover:s.bind(null,!1),isOpen:i,ownFocus:!0,panelClassName:"mlHelpPopover__panel",panelPaddingSize:"none"},a&&Object(g.jsx)(o.EuiPopoverTitle,{paddingSize:"s"},a),Object(g.jsx)(o.EuiText,{className:"mlHelpPopover__content",size:"s"},t))},um=()=>Object(g.jsx)(dm,{anchorPosition:"upCenter",title:r.i18n.translate("xpack.ml.dataframe.analytics.confusionMatrixPopoverTitle",{defaultMessage:"Normalized confusion matrix"})},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.confusionMatrixBasicExplanation",defaultMessage:"The multiclass confusion matrix provides a summary of the performance of the classification analysis. It contains the proportion of the data points that the analysis classified correctly with their actual class as well as the proportion of the misclassified data points."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.confusionMatrixAxisExplanation",defaultMessage:"The matrix contains the actual labels on the left side while the predicted labels are on the top. The proportion of correct and incorrect predictions is broken down for each class. This enables you to examine how the classification analysis confused the different classes while it made its predictions. If you want to see the exact number of occurrences, select a cell in the matrix and click the appearing icon."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.confusionMatrixShadeExplanation",defaultMessage:"As the number of classes in the classification analysis increases, the confusion matrix also increases in complexity. For an easier overview, darker cells indicate higher percentage of the predictions."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.confusionMatrixColumnExplanation",defaultMessage:"The Columns selector enables you to toggle between showing or hiding some of the columns or all of them."}))),pm=()=>Object(g.jsx)(dm,{anchorPosition:"upCenter",title:r.i18n.translate("xpack.ml.dataframe.analytics.rocCurvePopoverTitle",{defaultMessage:"Receiver operating characteristic (ROC) curve"})},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.rocCurveBasicExplanation",defaultMessage:"The ROC curve is a plot that represents the performance of the classification process at different predicted probability thresholds."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.rocCurveCompute",defaultMessage:"It compares the true positive rate (y-axis) for a specific class against the false positive rate (x-axis) at the different threshold levels to create the curve."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.rocCurveAuc",defaultMessage:"From this plot, the area under the curve (AUC) value can be computed, which is a number between 0 and 1. The closer to 1, the better the algorithm performance."})));var mm;!function(e){e.TRAINING="training",e.TESTING="testing",e.ENTIRE="entire"}(mm||(mm={}));const bm=r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixEntireHelpText",{defaultMessage:"Normalized confusion matrix for entire dataset"}),fm=r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixTestingHelpText",{defaultMessage:"Normalized confusion matrix for testing dataset"}),hm=r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixTrainingHelpText",{defaultMessage:"Normalized confusion matrix for training dataset"}),gm=r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluationQualityMetricsHelpText",{defaultMessage:"Evaluation quality metrics"});function jm(e){let t=bm;return e===mm.TESTING?t=fm:e===mm.TRAINING&&(t=hm),t}const xm=({jobConfig:e,jobStatus:t,searchQuery:a})=>{const{services:{docLinks:i}}=Object(y.b)(),{euiTheme:l}=Object(ut.e)(),[c,d]=Object(n.useState)([]),[u,p]=Object(n.useState)([]),[b,f]=Object(n.useState)(!1),[h,j]=Object(n.useState)(mm.ENTIRE),[x,v]=Object(n.useState)((()=>c.map((({id:e})=>e)))),O=rm(a,e.dest.results_field),{avgRecall:E,confusionMatrixData:w,docsCount:M,error:S,isLoading:_,overallAccuracy:T,evaluationMetricsItems:C}=((e,t)=>{const[a,i]=Object(n.useState)([]),[s,o]=Object(n.useState)(null),[r,l]=Object(n.useState)(null),[c,d]=Object(n.useState)([]),[u,p]=Object(n.useState)(!1),[m,b]=Object(n.useState)(null),[f,h]=Object(n.useState)(null);return Object(n.useEffect)((()=>{!async function(){p(!0);let a=!1;const n=Object(Bd.k)(e.analysis),s=e.dest.results_field,r=rm(t,s);try{a=Object(Au.g)(n)}catch(e){console.error("Unable to load new field types",e)}const c=await Object(Bd.u)({isTraining:r,index:e.dest.index,dependentVariable:n,resultsField:s,predictionFieldName:Object(Bd.p)(e.analysis),searchQuery:t,jobType:Xd.b.CLASSIFICATION,requiresKeyword:a}),u=await Object(Bd.t)({isTraining:r,searchQuery:t,resultsField:s,destIndex:e.dest.index});if(!0===c.success&&c.eval&&Object(Xd.w)(c.eval)){var m,f,g,j,x,v,y,O,E,w;const e=null===(m=c.eval)||void 0===m||null===(f=m.classification)||void 0===f||null===(g=f.multiclass_confusion_matrix)||void 0===g?void 0:g.confusion_matrix;h(null),i(e||[]),l((null===(j=c.eval)||void 0===j||null===(x=j.classification)||void 0===x||null===(v=x.recall)||void 0===v?void 0:v.avg_recall)||null),o((null===(y=c.eval)||void 0===y||null===(O=y.classification)||void 0===O||null===(E=O.accuracy)||void 0===E?void 0:E.overall_accuracy)||null),d(function(e){var t,a;if(void 0===e)return[];const i=(null===(t=e.accuracy)||void 0===t?void 0:t.classes)||[],n=(null===(a=e.recall)||void 0===a?void 0:a.classes)||[],s=i.reduce(((e,t)=>(e[t.class_name]={className:t.class_name,accuracy:t.value},e)),{});return n.forEach((e=>{void 0!==s[e.class_name]?s[e.class_name]={recall:e.value,...s[e.class_name]}:s[e.class_name]={className:e.class_name,recall:e.value}})),Object.values(s)}(null===(w=c.eval)||void 0===w?void 0:w.classification)),p(!1)}else p(!1),i([]),h(c.error);!0===u.success?b(u.docsCount):b(null)}()}),[JSON.stringify([e,t])]),{avgRecall:r,confusionMatrixData:a,docsCount:m,error:f,isLoading:u,overallAccuracy:s,evaluationMetricsItems:c}})(e,a);Object(n.useEffect)((()=>{j(void 0===O?mm.ENTIRE:O&&!0===O?mm.TRAINING:mm.TESTING)}),[O]),Object(n.useEffect)((()=>{if(w.length>0){const{columns:e,columnData:t}=function(e){const t=[],a=[{id:nm,display:Object(g.jsx)("span",null),initialWidth:165}];let i=!1;for(const n of e){const e=n.other_predicted_class_doc_count;e>0&&(i=!0);const s={actual_class:n.actual_class,actual_class_doc_count:n.actual_class_doc_count,other:e,predicted_classes_count:{}},o=n.predicted_classes||[];a.push({id:n.actual_class,initialWidth:165});for(let e=0;e<o.length;e++){const t=o[e].predicted_class,a=o[e].count;s.predicted_classes_count[t]=a}t.push(s)}return i&&a.push({id:sm,initialWidth:165}),{columns:a,columnData:t}}(w);v((()=>e.map((({id:e})=>e)))),d(e),p(t)}}),[w]);const{rocCurveData:k,classificationClasses:F,error:I,isLoading:D}=((e,t,a)=>{const i=a.filter((e=>e!==nm&&e!==sm));i.length<=2&&i.splice(1);const[s,o]=Object(n.useState)([]),[r,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(null);return Object(n.useEffect)((()=>{!async function(){l(!0);const a=Object(Bd.k)(e.analysis),n=e.dest.results_field,s=[];let r=!1;const c=[];try{r=Object(Au.g)(a)}catch(e){console.error("Unable to load new field types",e)}for(let o=0;o<i.length;o++){const l=i[o],d=await Object(Bd.u)({isTraining:rm(t,n),index:e.dest.index,dependentVariable:a,resultsField:n,predictionFieldName:Object(Bd.p)(e.analysis),searchQuery:t,jobType:Xd.b.CLASSIFICATION,requiresKeyword:r,rocCurveClassName:l,includeMulticlassConfusionMatrix:!1});if(!0===d.success&&d.eval&&Object(Xd.w)(d.eval)){var u,p,m,b,f,h;const e=(null===(u=d.eval)||void 0===u||null===(p=u.classification)||void 0===p||null===(m=p.auc_roc)||void 0===m?void 0:m.value)||0,t=i.length>2?i[o]:"ROC",a=((null===(b=d.eval)||void 0===b||null===(f=b.classification)||void 0===f||null===(h=f.auc_roc)||void 0===h?void 0:h.curve)||[]).map((a=>({class_name:`${t} (AUC: ${Math.round(e*lm)/lm})`,...a})));s.push(...a)}else null!==d.error&&c.push(d.error)}d(c.length>0?c:null),o(s),l(!1)}()}),[JSON.stringify([e,t,a])]),{rocCurveData:s,classificationClasses:i.length>2?i:["ROC"],error:c,isLoading:r}})(e,a,c.map((e=>e.id))),A=i.links.ml.classificationEvaluation,L=u.length>6,R=u.length-6,N=!0===L&&!1===b?c.slice(0,7):c,P=!0===L&&!1===b?6:u.length;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(lp,{urlStateKey:"evaluation",dataTestId:"ClassificationEvaluation",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionTitle",defaultMessage:"Model evaluation"}),docsLink:Object(g.jsx)(o.EuiButtonEmpty,{target:"_blank",iconType:"help",iconSide:"left",color:"primary",href:A},r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.classificationDocsLink",{defaultMessage:"Classification evaluation docs "})),headerItems:_?rp:[...void 0!==t?[{id:"jobStatus",label:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateJobStatusLabel",{defaultMessage:"Job status"}),value:t}]:[],...null!==M?[{id:"docsEvaluated",label:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.generalizationDocsCount",{defaultMessage:"{docsCount, plural, one {doc} other {docs}} evaluated",values:{docsCount:M}}),value:M}]:[]],contentPadding:!0,content:Object(g.jsx)(s.a.Fragment,null,_?null:Object(g.jsx)(s.a.Fragment,null,null!==S&&Object(g.jsx)(Xp,{error:S}),null===S&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(g.jsx)(o.EuiTitle,{size:"xxs"},Object(g.jsx)("span",null,jm(h))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(um,null))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)("div",{className:"mlDataFrameAnalyticsClassification__evaluateSectionContent"},Object(g.jsx)("div",{className:"mlDataFrameAnalyticsClassification__actualLabel"},Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixActualLabel",defaultMessage:"Actual class"}))),Object(g.jsx)("div",{className:"mlDataFrameAnalyticsClassification__dataGridMinWidth"},c.length>0&&u.length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",null,Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixPredictedLabel",defaultMessage:"Predicted class"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiDataGrid,{"data-test-subj":"mlDFAnalyticsClassificationExplorationConfusionMatrix","aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixLabel",{defaultMessage:"Classification confusion matrix"}),columns:N,columnVisibility:{visibleColumns:x,setVisibleColumns:v},rowCount:P,renderCellValue:({rowIndex:e,columnId:t,setCellProps:a,schema:i,isDetails:s})=>{const o=t===nm?u[e][t]:u[e].predicted_classes_count[t],r=u[e]&&u[e].actual_class_doc_count;let l="0%";if(t!==nm&&r&&"number"==typeof o){let e=o/r;e=Math.round(100*e)/100,l=`${Math.round(100*e)}%`}Object(n.useEffect)((()=>{t!==nm&&a({style:{backgroundColor:`rgba(0, 179, 164, ${l})`}})}),[e,t,a]);let c=t===nm?o:l;if(s&&"numeric"===i){const a=u[e];void 0!==a&&t!==nm&&(c=`${a.predicted_classes_count[t]} / ${a.actual_class_doc_count} * 100 = ${c}`)}return Object(g.jsx)("span",null,c)},inMemory:{level:"sorting"},toolbarVisibility:{showColumnSelector:!0,showDisplaySelector:!1,showFullScreenSelector:!1,showSortSelector:!1},gridStyle:{border:"all",fontSize:"s",cellPadding:"s",stripes:!1,rowHover:"none",header:"shade"},trailingControlColumns:!0===L&&!1===b?om(R,f):void 0})))))),Object(g.jsx)(o.EuiSpacer,{size:"xl"}),Object(g.jsx)(o.EuiTitle,{size:"xxs"},Object(g.jsx)("span",null,gm)),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{direction:"column",justifyContent:"center",className:"mlDataFrameAnalyticsClassification__evaluationMetrics"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"l"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Qp,{dataTestSubj:"mlDFAEvaluateSectionOverallAccuracyStat",title:T,isLoading:_,description:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionOverallAccuracyStat",{defaultMessage:"Overall accuracy"}),tooltipContent:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionOverallAccuracyTooltip",{defaultMessage:"The ratio of the number of correct class predictions to the total number of predictions."})})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Qp,{dataTestSubj:"mlDFAEvaluateSectionAvgRecallStat",title:E,isLoading:_,description:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionMeanRecallStat",{defaultMessage:"Mean recall"}),tooltipContent:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionAvgRecallTooltip",{defaultMessage:"Mean recall shows how many of the data points that are actual class members were identified correctly as class members."})})))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Zp,{evaluationMetricsItems:C}))),Object(g.jsx)(o.EuiSpacer,{size:"l"}),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(g.jsx)(o.EuiTitle,{size:"xxs"},Object(g.jsx)("span",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionRocTitle",defaultMessage:"Receiver operating characteristic (ROC) curve"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(pm,null))),Array.isArray(I)&&Object(g.jsx)(Xp,{error:Object(g.jsx)(s.a.Fragment,null,I.map((e=>Object(g.jsx)(s.a.Fragment,null,e,Object(g.jsx)("br",null)))))}),!D&&null===I&&k.length>0&&Object(g.jsx)("div",{className:"mlDataFrameAnalyticsClassification__evaluateSectionContent","data-test-subj":"mlDFAnalyticsClassificationExplorationRocCurveChart"},Object(g.jsx)(Ju,{vegaSpec:im(F,k,Object(Bd.k)(e.analysis),l)})),D&&Object(g.jsx)(Bu,null))}),Object(g.jsx)(o.EuiSpacer,{size:"m"}))},vm=({jobId:e})=>Object(g.jsx)("div",{className:"mlDataFrameAnalyticsClassification"},Object(g.jsx)(Rp,{jobId:e,title:r.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.tableJobIdTitle",{defaultMessage:"Destination index for classification job ID {jobId}",values:{jobId:e}}),EvaluatePanel:xm,FeatureImportanceSummaryPanel:Hp}));var ym=a(261);function Om(e){return e.dest&&e.analysis&&e.id}const Em=[{field:"id",name:r.i18n.translate("xpack.ml.analyticsSelector.id",{defaultMessage:"ID"}),sortable:e=>e.id,truncateText:!0,"data-test-subj":"mlAnalyticsSelectorTableColumnId",scope:"row"},{field:"description",name:r.i18n.translate("xpack.ml.analyticsSelector.description",{defaultMessage:"Description"}),sortable:!0,truncateText:!0,"data-test-subj":"mlAnalyticsSelectorColumnJobDescription"},{field:"source.index",name:r.i18n.translate("xpack.ml.analyticsSelector.sourceIndex",{defaultMessage:"Source index"}),sortable:!0,truncateText:!0,"data-test-subj":"mlAnalyticsSelectorColumnSourceIndex"},{field:"dest.index",name:r.i18n.translate("xpack.ml.analyticsSelector.destinationIndex",{defaultMessage:"Destination index"}),sortable:!0,truncateText:!0,"data-test-subj":"mlAnalyticsSelectorColumnDestIndex"}],wm=[{field:ym.b.id,name:r.i18n.translate("xpack.ml.analyticsSelector.modelsList.modelIdHeader",{defaultMessage:"ID"}),sortable:!0,truncateText:!1,"data-test-subj":"mlAnalyticsSelectorColumnId"},{field:ym.b.description,width:"350px",name:r.i18n.translate("xpack.ml.analyticsSelector.modelsList.modelDescriptionHeader",{defaultMessage:"Description"}),sortable:!1,truncateText:!1,"data-test-subj":"mlAnalyticsSelectorColumnDescription"}];function Mm({setAnalyticsId:e,jobsOnly:t=!1,setIsIdSelectorFlyoutVisible:a}){const[i,s]=Object(n.useState)(),[l,c]=Object(n.useState)([]),[d,u]=Object(n.useState)([]),[p,b]=Object(n.useState)(!1),{displayErrorToast:f}=Object(Z.c)(),h=Object(Cp.b)(),{dataFrameAnalytics:{getDataFrameAnalytics:j}}=Object(y.a)();function x(){a(!1)}Object(n.useEffect)((()=>{!async function(){b(!0);try{const{data_frame_analytics:e}=await j();c(e)}catch(e){console.error("Error fetching analytics",e),f(e,r.i18n.translate("xpack.ml.analyticsSelector.analyticsFetchErrorMessage",{defaultMessage:"An error occurred fetching analytics jobs. Refresh and try again."}))}b(!1)}(),!1===t&&async function(){b(!0);try{const e=await h.getTrainedModels();u(e)}catch(e){console.error("Error fetching trained models",e),f(e,r.i18n.translate("xpack.ml.analyticsSelector.trainedModelsFetchErrorMessage",{defaultMessage:"An error occurred fetching trained models. Refresh and try again."}))}b(!1)}()}),[]);const v=Object(n.useCallback)((()=>{void 0!==i&&e(i),x()}),[null==i?void 0:i.model_id,null==i?void 0:i.job_id]),O={initialPageSize:20,pageSizeOptions:[5,10,20,50]},E={selectable:e=>{const t=Om(e),a=t?e.id:e.model_id,n=!t&&e.tags.includes(zd.b);return(void 0===i||(null==i?void 0:i.job_id)===a||(null==i?void 0:i.model_id)===a)&&!n},onSelectionChange:e=>{var t;const a=e[0];if(!a)return void s(void 0);const i=Om(a),n=i?a.analysis:a.inference_config,o=n?Object.keys(n)[0]:void 0;s({model_id:i?void 0:a.model_id,job_id:i?a.id:null===(t=a.metadata)||void 0===t?void 0:t.analytics_config.id,analysis_type:o})}},w=[{id:"Jobs",name:r.i18n.translate("xpack.ml.analyticsSelector.jobsTab",{defaultMessage:"Jobs"}),content:Object(g.jsx)(o.EuiInMemoryTable,{items:l,itemId:"id",loading:p,columns:Em,pagination:O,sorting:!0,selection:E,isSelectable:!0})}];return!1===t&&w.push({id:"Models",name:r.i18n.translate("xpack.ml.analyticsSelector.modelsTab",{defaultMessage:"Models"}),content:Object(g.jsx)(o.EuiInMemoryTable,{items:d,itemId:"model_id",loading:p,columns:wm,pagination:O,sorting:!0,selection:E,isSelectable:!0})}),Object(g.jsx)(o.EuiFlyout,{onClose:x,"data-test-subj":"mlFlyoutJobSelector","aria-labelledby":"jobSelectorFlyout"},Object(g.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(g.jsx)(o.EuiTitle,{size:"m"},Object(g.jsx)("h2",{id:"flyoutTitle"},r.i18n.translate("xpack.ml.analyticsSelector.flyoutTitle",{defaultMessage:"Analytics selection"})))),Object(g.jsx)(o.EuiFlyoutBody,{"data-test-subj":"mlJobSelectorFlyoutBody"},Object(g.jsx)(o.EuiTabbedContent,{size:"s",tabs:w,initialSelectedTab:w[0]})),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:v,fill:!0,isDisabled:void 0===i,"data-test-subj":"mlFlyoutAnalyticsSelectorButtonApply"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.analyticsSelector.applyFlyoutButton",defaultMessage:"Apply"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:x,"data-test-subj":"mlFlyoutAnalyticsSelectorButtonClose"},r.i18n.translate("xpack.ml.analyticsSelector.closeFlyoutButton",{defaultMessage:"Close"}))))))}const Sm=({setIsIdSelectorFlyoutVisible:e,selectedId:t})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},t?Object(g.jsx)(o.EuiBadge,{key:`${t}-id`,"data-test-subj":`mlAnalyticsIdSelectionBadge ${t}`,color:"hollow"},t):null,t?null:Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.noIdsSelectedLabel",defaultMessage:"No Analytics ID selected"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{size:"xs",iconType:"pencil",onClick:e.bind(null,!0),"data-test-subj":"mlButtonEditAnalyticsIdSelection"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.editSelection",defaultMessage:"Edit selection"})))),Object(g.jsx)(o.EuiHorizontalRule,null)),_m=({jobId:e,analysisType:t})=>{const[a,i]=Object(n.useState)(),[r,l]=Object(n.useState)(!e),[c,d]=Object(n.useState)(!0),{services:{docLinks:u}}=Object(y.b)(),{dataFrameAnalytics:{getDataFrameAnalytics:p}}=Object(y.a)(),b=u.links.ml.dataFrameAnalytics,f=null!=e?e:null==a?void 0:a.job_id,[h,j]=Object(n.useState)(t||(null==a?void 0:a.analysis_type)),[,x]=Object(v.c)("_g");return Object(n.useEffect)((function(){(h!==t||null!=a&&a.analysis_type)&&j(t||(null==a?void 0:a.analysis_type))}),[a,t,h]),Object(n.useEffect)((function(){(async()=>{try{const{count:e}=await p(void 0,void 0,0);d(e>0)}catch(e){console.error("Error checking analytics jobs exist",e)}})()}),[]),Object(n.useEffect)((function(){void 0!==a&&x({ml:{...a.analysis_type?{analysisType:a.analysis_type}:{},...a.job_id?{jobId:a.job_id}:{}}})}),[null==a?void 0:a.job_id,null==a?void 0:a.model_id]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Sm,{setIsIdSelectorFlyoutVisible:l,selectedId:f}),r?Object(g.jsx)(Mm,{setAnalyticsId:i,setIsIdSelectorFlyoutVisible:l}):null,void 0!==f&&Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsExploration.titleWithId",defaultMessage:"Explore results for job ID {id}",values:{id:f}})),void 0===f&&Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsExploration.title",defaultMessage:"Explore results"})),Object(g.jsx)(Ki.a,{onCloseFlyout:()=>{j(void 0)}}),f&&h?Object(g.jsx)("div",{"data-test-subj":"mlPageDataFrameAnalyticsExploration"},h===zd.a.OUTLIER_DETECTION&&Object(g.jsx)(Tp,{jobId:f}),h===zd.a.REGRESSION&&Object(g.jsx)(Yp,{jobId:f}),h===zd.a.CLASSIFICATION&&Object(g.jsx)(vm,{jobId:f})):!1===c?Object(g.jsx)(iu.a,null):Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiEmptyPrompt,{iconType:"alert",title:Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.noJobSelectedLabel",defaultMessage:"No Analytics ID selected"})),"data-test-subj":"mlNoAnalyticsFound"})),Object(g.jsx)(sn.a,{docLink:b}))},Tm=(e,t)=>({path:"/data_frame_analytics/exploration",render:(e,t)=>Object(g.jsx)(Cm,_()({},e,{deps:t})),title:r.i18n.translate("xpack.ml.dataFrameAnalytics.exploration.docTitle",{defaultMessage:"Results Explorer"}),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("DATA_FRAME_ANALYTICS_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.dataFrameExplorationLabel",{defaultMessage:"Results Explorer"})}]}),Cm=({deps:e})=>{const{context:t}=I(void 0,void 0,e.config,e.dataViewsContract,W(e)),[a]=Object(v.c)("_g"),i=null==a?void 0:a.ml.jobId,n=null==a?void 0:a.ml.analysisType;return Object(g.jsx)(T.b,{context:t},Object(g.jsx)(_m,{jobId:i,analysisType:n}))};var km=a(348);const Fm=({messages:e})=>Object(g.jsx)(s.a.Fragment,null,e.map(((e,t)=>Object(g.jsx)(n.Fragment,{key:t},Object(g.jsx)(o.EuiCallOut,{"data-test-subj":`analyticsWizardCreationCallout_${t}`,title:e.message,color:void 0!==e.error?"danger":"primary",iconType:void 0!==e.error?"alert":"checkInCircleFilled",size:"s"},void 0!==e.error&&Object(g.jsx)(o.EuiCodeBlock,{language:"json",fontSize:"s",paddingSize:"s",isCopyable:!0},e.error)),Object(g.jsx)(o.EuiSpacer,{size:"s"})))));var Im=a(135);const Dm=async e=>{const t=Object(Im.f)(e);let a="",i="",n=!0,s="",o=[],r=!1;try{var l;delete t.dest,delete t.model_memory_limit;const e=await X.ml.dataFrameAnalytics.explainDataFrameAnalytics(t);s=null===(l=e.memory_estimation)||void 0===l?void 0:l.expected_memory_without_disk,o=e.field_selection||[]}catch(e){const t=Object(da.c)(e);n=!1,a=t.message,t.causedBy&&(i=t.causedBy)}return a.includes("status_exception")&&a.includes("Unable to estimate memory usage as no documents")&&(r=!0),{success:n,expectedMemory:s,fieldSelection:o,errorMessage:a,errorReason:i,noDocsContainMappedFields:r}},Am=()=>{const e=Object(y.c)({page:E.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE});return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiCard,{className:"dfAnalyticsCreationWizard__card",icon:Object(g.jsx)(o.EuiIcon,{size:"xxl",type:"list"}),title:r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsListCardTitle",{defaultMessage:"Data Frame Analytics"}),description:r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsListCardDescription",{defaultMessage:"Return to the analytics management page."}),href:e,"data-test-subj":"analyticsWizardCardManagement"}))},Lm=({jobId:e,analysisType:t})=>{const a=Object(y.c)({page:E.b.DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:e,analysisType:t}});return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiCard,{className:"dfAnalyticsCreationWizard__card",icon:Object(g.jsx)(o.EuiIcon,{size:"xxl",type:"visTable"}),title:r.i18n.translate("xpack.ml.dataframe.analytics.create.viewResultsCardTitle",{defaultMessage:"View Results"}),description:r.i18n.translate("xpack.ml.dataframe.analytics.create.viewResultsCardDescription",{defaultMessage:"View results for the analytics job."}),href:a,"data-test-subj":"analyticsWizardViewResultsCard"}))},Rm=({currentProgress:e,failedJobMessage:t})=>void 0===e?null:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,null),void 0!==t&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiCallOut,{"data-test-subj":"analyticsWizardProgressCallout",title:r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsProgressCalloutTitle",{defaultMessage:"Job failed"}),color:"danger",iconType:"alert",size:"s"},Object(g.jsx)("p",null,t)),Object(g.jsx)(o.EuiSpacer,{size:"s"})),Object(g.jsx)(o.EuiText,{size:"m"},Object(g.jsx)("strong",null,r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsProgressTitle",{defaultMessage:"Progress"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)("strong",null,r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsProgressPhaseTitle",{defaultMessage:"Phase"})," ",e.currentPhase,"/",e.totalPhases))),Object(g.jsx)(o.EuiFlexItem,{style:{width:"400px"},grow:!1},Object(g.jsx)(o.EuiProgress,{value:e.progress,max:100,color:"primary",size:"l","data-test-subj":"mlAnalyticsCreationWizardProgress"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"s"},`${e.progress}%`)))),Nm=({jobId:e,jobType:t,showProgress:a})=>{const[i,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(void 0),[u,p]=Object(n.useState)(!1),[m,b]=Object(n.useState)(void 0),[f,h]=Object(n.useState)(!1),{services:{notifications:j}}=Object(y.b)();return Object(n.useEffect)((()=>{l(!0)}),[]),Object(n.useEffect)((()=>{if(!1===a)return;const t=setInterval((async()=>{try{const a=await X.ml.dataFrameAnalytics.getDataFrameAnalyticsStats(e),i=Object(cp.b)(a)?a.data_frame_analytics[0]:void 0;if(h((null==i?void 0:i.state)===Vd.b.STARTING&&void 0===(null==i?void 0:i.node)),void 0!==i){const a=Object(Vd.d)(i);i.state===Vd.b.FAILED&&(clearInterval(t),d(i.failure_reason||r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsProgressCalloutMessage",{defaultMessage:"Analytics job {jobId} has failed.",values:{jobId:e}}))),b(a),(a.currentPhase===a.totalPhases&&100===a.progress||i.state===Vd.b.STOPPED&&(1!==a.currentPhase||0!==a.progress))&&(clearInterval(t),p(a.currentPhase===a.totalPhases&&100===a.progress))}else clearInterval(t)}catch(a){j.toasts.addDanger(r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsProgressErrorMessage",{defaultMessage:"An error occurred getting progress stats for analytics job {jobId}",values:{jobId:e}})),clearInterval(t)}}),1e3);return()=>clearInterval(t)}),[i]),Object(g.jsx)(s.a.Fragment,null,f&&Object(g.jsx)(Qi.b,{jobType:"data-frame-analytics"}),Object(g.jsx)(o.EuiFlexGroup,{direction:"column"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},a&&Object(g.jsx)(Rm,{currentProgress:m,failedJobMessage:c})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiHorizontalRule,null),Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Am,null)),!0===u?Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Lm,{jobId:e,analysisType:t})):null))))},Pm=({actions:e,state:t,step:a})=>{const{services:{application:{capabilities:i}}}=Object(y.b)(),s=Object(n.useMemo)((()=>!0===i.savedObjectsManagement.edit||!0===i.indexPatterns.save),[i]),{createAnalyticsJob:l,setFormState:c,startAnalyticsJob:d}=e,{isAdvancedEditorValidJson:u,isJobCreated:p,isJobStarted:m,isValid:b,requestMessages:f}=t,{createIndexPattern:h,destinationIndex:j,destinationIndexPatternTitleExists:x,jobId:v,jobType:O}=t.form,[E,w]=Object(n.useState)(!0),[M,S]=Object(n.useState)(!1),[_,T]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{!1===s&&c({createIndexPattern:!1})}),[i]),a!==qb.CREATE?null:Object(g.jsx)("div",{"data-test-subj":"mlAnalyticsCreateJobWizardCreateStep active"},!p&&!m&&Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.startCheckboxHelpText",{defaultMessage:"If unselected, job can be started later by returning to the jobs list."})},Object(g.jsx)(o.EuiCheckbox,{"data-test-subj":"mlAnalyticsCreateJobWizardStartJobCheckbox",id:"dataframe-create-start-checkbox",label:r.i18n.translate("xpack.ml.dataframe.analytics.create.wizardStartCheckbox",{defaultMessage:"Start immediately"}),checked:E,onChange:e=>{w(e.target.checked),!1===e.target.checked&&c({createIndexPattern:!1})}}))),E?Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,isInvalid:h&&x||!1===h||!1===s,error:[...!1===s?[Object(g.jsx)(o.EuiText,{size:"xs",color:"warning"},r.i18n.translate("xpack.ml.dataframe.analytics.create.dataViewPermissionWarning",{defaultMessage:"You need permission to create data views."}))]:[],...h&&x?[r.i18n.translate("xpack.ml.dataframe.analytics.create.dataViewExistsError",{defaultMessage:"A data view with the title {title} already exists.",values:{title:j}})]:[],...h||x?[]:[Object(g.jsx)(o.EuiText,{size:"xs",color:"warning"},r.i18n.translate("xpack.ml.dataframe.analytics.create.shouldCreateDataViewMessage",{defaultMessage:"You may not be able to view job results if a data view is not created for the destination index."}))]]},Object(g.jsx)(o.EuiCheckbox,{disabled:p||!1===s,name:"mlDataFrameAnalyticsCreateIndexPattern",id:"dataframe-create-data-view-checkbox",label:r.i18n.translate("xpack.ml.dataframe.analytics.create.createDataViewLabel",{defaultMessage:"Create data view"}),checked:!0===h,onChange:()=>c({createIndexPattern:!h}),"data-test-subj":"mlAnalyticsCreateJobWizardCreateIndexPatternCheckbox"}))):null)),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{className:"mlAnalyticsCreateWizard__footerButton",disabled:!b||!u||!0===x&&!0===h,onClick:async()=>{S(!0);const e=await l();!1===e&&S(!1),E&&!0===e&&(T(!0),d())},fill:!0,isLoading:M,"data-test-subj":"mlAnalyticsCreateJobWizardCreateButton"},r.i18n.translate("xpack.ml.dataframe.analytics.create.wizardCreateButton",{defaultMessage:"Create"})))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(Fm,{messages:f}),!0===p?Object(g.jsx)(Nm,{jobId:v,jobType:O,showProgress:_}):null)},zm=e=>{const{actions:t,state:a}=e,{setAdvancedEditorRawString:i,setFormState:s}=t,{advancedEditorMessages:l,advancedEditorRawString:d,isJobCreated:u}=a,{jobId:p,jobIdEmpty:m,jobIdExists:b,jobIdValid:f}=a.form,h=Object(n.useRef)(null),{toasts:j}=Object(y.f)(),x=Object(n.useMemo)((()=>Object(Q.debounce)((async()=>{try{const e=await X.ml.dataFrameAnalytics.jobsExist([p],!0);s({jobIdExists:e[p].exists})}catch(e){j.addDanger(r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditor.errorCheckingJobIdExists",{defaultMessage:"The following error occurred checking if job id exists: {error}",values:{error:Object(da.b)(e)}}))}}),400)),[p]);return Object(n.useEffect)((()=>{if(null===h.current)return;const e=document.createEvent("MouseEvents");e.initEvent("mouseup",!0,!0),h.current.dispatchEvent(e)}),[]),Object(n.useEffect)((()=>(!0===f?x():"string"==typeof p&&""===p.trim()&&!0===b&&s({jobIdExists:!1}),()=>{x.cancel()})),[p]),Object(g.jsx)(o.EuiForm,{className:"mlDataFrameAnalyticsCreateForm"},Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditor.jobIdLabel",{defaultMessage:"Analytics job ID"}),isInvalid:!m&&!f||b,error:[...m||f?[]:[r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditor.jobIdInvalidError",{defaultMessage:"Must contain lowercase alphanumeric characters (a-z and 0-9), hyphens, and underscores only and must start and end with alphanumeric characters."})],...b?[r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditor.jobIdExistsError",{defaultMessage:"An analytics job with this ID already exists."})]:[]]},Object(g.jsx)(o.EuiFieldText,{inputRef:e=>{e&&(h.current=e)},disabled:u,placeholder:"analytics job ID",value:p,onChange:e=>s({jobId:e.target.value}),"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditor.jobIdInputAriaLabel",{defaultMessage:"Choose a unique analytics job ID."}),isInvalid:!m&&!f||b})),Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditor.configRequestBody",{defaultMessage:"Configuration request body"}),style:{maxWidth:"100%"}},Object(g.jsx)(c.CodeEditor,{languageId:"json",height:500,languageConfiguration:{autoClosingPairs:[{open:"{",close:"}"}]},value:d,onChange:e=>{i(e)},options:{ariaLabel:r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditor.codeEditorAriaLabel",{defaultMessage:"Advanced analytics job editor"}),automaticLayout:!0,readOnly:u,fontSize:12,scrollBeyondLastLine:!1,quickSuggestions:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent"}})),Object(g.jsx)(o.EuiSpacer,null),l.map(((e,t)=>Object(g.jsx)(n.Fragment,{key:t},Object(g.jsx)(o.EuiCallOut,{title:""!==e.message?e.message:e.error,color:void 0!==e.error?"danger":"primary",iconType:void 0!==e.error?"alert":"checkInCircleFilled",size:"s"},""!==e.message&&void 0!==e.error?Object(g.jsx)("p",null,e.error):null),Object(g.jsx)(o.EuiSpacer,null)))),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(Pm,_()({},e,{step:qb.CREATE})))},Bm=({setCurrentStep:e,state:t})=>{const a=Object(Cn.b)(),{currentDataView:i}=a,{form:s,isJobCreated:l}=t,{dependentVariable:c,includes:d,jobConfigQueryString:u,jobType:p,trainingPercent:m}=s,b=p===Xd.b.REGRESSION||p===Xd.b.CLASSIFICATION,f=[{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.sourceIndex",{defaultMessage:"Source index"}),description:i.title||Im.c},{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.Query",{defaultMessage:"Query"}),description:u||Im.c}],h=[{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.jobType",{defaultMessage:"Job type"}),description:p}],j=[{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.includedFields",{defaultMessage:"Included fields"}),description:d.length>5?r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.includedFieldsAndMoreDescription",{defaultMessage:"{includedFields} ... (and {extraCount} more)",values:{extraCount:d.length-5,includedFields:d.slice(0,5).join(", ")}}):d.join(", ")}];return b&&(h.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.trainingPercent",{defaultMessage:"Training percent"}),description:`${m}`}),j.unshift({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.dependentVariable",{defaultMessage:"Dependent variable"}),description:c})),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{style:{width:"70%"},justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:f})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:h})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:j}))),Object(g.jsx)(o.EuiSpacer,null),!l&&Object(g.jsx)(o.EuiButtonEmpty,{iconType:"pencil",size:"s",onClick:()=>{e(qb.CONFIGURATION)}},r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.editButtonText",{defaultMessage:"Edit"})))};var Vm=a(221);const Jm=new Set(["ip","keyword"]),Um=(e,t,a)=>{if(e===Dt.a)return!1;const i=Au.a.has(t),n=i||Jm.has(t)||t===jt.ES_FIELD_TYPES.BOOLEAN;return a===Xd.b.REGRESSION?i||Au.b.has(t):a===Xd.b.CLASSIFICATION?n:void 0},Gm=(e,t,a)=>{let i,n,s,o;return a===Xd.b.CLASSIFICATION&&(e.includes("must have at most")||e.includes("must have at least"))?i=e:e.includes("status_exception")&&e.includes("unsupported type")?n=e:e.includes("status_exception")&&e.includes("Unable to estimate memory usage as no documents")?s=r.i18n.translate("xpack.ml.dataframe.analytics.create.allDocsMissingFieldsErrorMessage",{defaultMessage:"Unable to estimate memory usage. There are mapped fields for source index [{index}] that do not exist in any indexed documents. You will have to switch to the JSON editor for explicit field selection and include only fields that exist in indexed documents.",values:{index:t}}):o={title:r.i18n.translate("xpack.ml.dataframe.analytics.create.unableToFetchExplainDataMessage",{defaultMessage:"An error occurred fetching analysis fields data."}),text:e},{maxDistinctValuesErrorMessage:i,unsupportedFieldsErrorMessage:n,toastNotificationDanger:o,toastNotificationWarning:s}},qm=r.i18n.translate("xpack.ml.dataframe.analytics.creation.continueButtonText",{defaultMessage:"Continue"}),$m=({isDisabled:e,onClick:t})=>Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{"data-test-subj":"mlAnalyticsCreateJobWizardContinueButton",isDisabled:e,size:"s",onClick:t},qm))),Wm={[zd.a.OUTLIER_DETECTION]:{helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.outlierDetectionHelpText",{defaultMessage:"Outlier detection identifies unusual data points in the data set."}),icon:"outlierDetectionJob",title:r.i18n.translate("xpack.ml.dataframe.analytics.create.outlierDetectionTitle",{defaultMessage:"Outlier detection"})},[zd.a.REGRESSION]:{helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.regressionHelpText",{defaultMessage:"Regression predicts numerical values in the data set."}),icon:"regressionJob",title:r.i18n.translate("xpack.ml.dataframe.analytics.create.regressionTitle",{defaultMessage:"Regression"})},[zd.a.CLASSIFICATION]:{helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.classificationHelpText",{defaultMessage:"Classification predicts classes of data points in the data set."}),icon:"classificationJob",title:r.i18n.translate("xpack.ml.dataframe.analytics.create.classificationTitle",{defaultMessage:"Classification"})}},Hm=({type:e,setFormState:t})=>{const[a,i]=Object(n.useState)({});return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"m","data-test-subj":"mlAnalyticsCreateJobWizardJobTypeSelect"},Object.keys(Wm).map((n=>Object(g.jsx)(o.EuiFlexItem,{key:n,grow:1},Object(g.jsx)(o.EuiCard,{icon:Object(g.jsx)(o.EuiIcon,{size:"xl",type:Wm[n].icon}),title:Wm[n].title,description:Wm[n].helpText,"data-test-subj":`mlAnalyticsCreation-${n}-option${e===n?" selectedJobType":""}`,selectable:{onClick:()=>{!0!==a[n]&&(t({previousJobType:e,jobType:n,requiredFieldsError:void 0}),i({[n]:!a[n]}))},isSelected:!0===a[n]||e===n}}))))),Object(g.jsx)(o.EuiSpacer,{size:"m"}))},Ym={[Xd.b.CLASSIFICATION]:({name:e,type:t})=>!Ft.c.includes(e)&&e!==Dt.a&&(Au.a.has(t)||Jm.has(t)||t===jt.ES_FIELD_TYPES.BOOLEAN),[Xd.b.REGRESSION]:({name:e,type:t})=>!Ft.c.includes(e)&&e!==Dt.a&&(Au.a.has(t)||Au.b.has(t)),[Xd.b.OUTLIER_DETECTION]:({name:e,type:t})=>!Ft.c.includes(e)&&e!==Dt.a&&(Au.a.has(t)||Au.b.has(t))},Xm={[Xd.b.CLASSIFICATION]:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.sourceObjectClassificationHelpText",defaultMessage:"This data view does not contain any supported fields. Classification jobs require categorical, numeric, or boolean fields."}),[Xd.b.REGRESSION]:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.sourceObjectRegressionHelpText",defaultMessage:"This data view does not contain any supported fields. Regression jobs require numeric fields."}),[Xd.b.OUTLIER_DETECTION]:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.sourceObjectHelpText",defaultMessage:"This data view does not contain any numeric type fields. The analytics job may not be able to come up with any outliers."})},Qm=({jobType:e})=>{const[t,a]=Object(n.useState)(!0),[i,s]=Object(n.useState)(!1),{fields:r}=nc.a;return Object(n.useEffect)((()=>{void 0!==e&&(()=>{if(r&&void 0!==e)try{const t=r.some(Ym[e]);a(t),s(!1)}catch(e){s(!0)}})()}),[e]),!0===t?null:!0===i?Object(g.jsx)(n.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.sourceIndexFieldsCheckError",defaultMessage:"There was a problem checking for supported fields for job type. Please refresh the page and try again."}),Object(g.jsx)(o.EuiSpacer,{size:"s"})):Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiText,{size:"xs",color:"danger"},void 0!==e&&Xm[e]),Object(g.jsx)(o.EuiSpacer,{size:"s"}))};var Km=a(346);const Zm=r.i18n.translate("xpack.ml.dataframe.analytics.create.analysisFieldsTable.minimumFieldsMessage",{defaultMessage:"At least one field must be selected."}),eb=[{id:"checkbox",isCheckbox:!0,textOnly:!1,width:"32px"},{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.analysisFieldsTable.fieldNameColumn",{defaultMessage:"Field name"}),id:"name",isSortable:!0,alignment:et.LEFT_ALIGNMENT},{id:"mapping_types",label:r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsTable.mappingColumn",{defaultMessage:"Mapping"}),isSortable:!1,alignment:et.LEFT_ALIGNMENT},{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsTable.isIncludedColumn",{defaultMessage:"Is included"}),id:"is_included",alignment:et.LEFT_ALIGNMENT,isSortable:!0,render:({is_included:e})=>e?"Yes":"No"},{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsTable.isRequiredColumn",{defaultMessage:"Is required"}),id:"is_required",alignment:et.LEFT_ALIGNMENT,isSortable:!0,render:({is_required:e})=>e?"Yes":"No"},{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.analyticsTable.reasonColumn",{defaultMessage:"Reason"}),id:"reason",alignment:et.LEFT_ALIGNMENT,isSortable:!1}],tb=e=>!0===e.is_required||e.reason&&e.reason.includes("unsupported type"),ab=s.a.memo((({dependentVariable:e,includes:t,isJobTypeWithDepVar:a,setFormState:i,minimumFieldsRequiredMessage:s,setMinimumFieldsRequiredMessage:l,tableItems:c,unsupportedFieldsError:d,setUnsupportedFieldsError:u})=>{const[p,b]=Object(n.useState)(),[f,h]=Object(n.useState)({pageIndex:0,itemsPerPage:5});Object(n.useEffect)((()=>{if(0===t.length&&c.length>0){const e=[];c.forEach((t=>{!0===t.is_included&&e.push(t.name)})),i({includes:e})}else t.length>0&&i({includes:e&&t.includes(e)||!a?t:[...t,e]});l(void 0)}),[c]),Object(n.useEffect)((()=>{let e=[];e=[{name:"name",getValue:e=>e.name.toLowerCase(),isAscending:!0},{name:"is_included",getValue:e=>e.is_included,isAscending:!0},{name:"is_required",getValue:e=>e.is_required,isAscending:!0}];const t=new et.SortableProperties(e,"name");b(t)}),[]);const j=[{type:"field_value_toggle_group",field:"is_included",items:[{value:!0,name:r.i18n.translate("xpack.ml.dataframe.analytics.create.isIncludedOption",{defaultMessage:"Is included"})},{value:!1,name:r.i18n.translate("xpack.ml.dataframe.analytics.create.isNotIncludedOption",{defaultMessage:"Is not included"})}]}];return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFormRow,{"data-test-subj":"mlAnalyticsCreateJobWizardIncludesTable",label:r.i18n.translate("xpack.ml.dataframe.analytics.create.includedFieldsLabel",{defaultMessage:"Included fields"}),fullWidth:!0,isInvalid:void 0!==s||void 0!==d,error:[...void 0!==s?[s]:[],...void 0!==d?[r.i18n.translate("xpack.ml.dataframe.analytics.create.unsupportedFieldsError",{defaultMessage:"Invalid. {message}",values:{message:d}})]:[]]},Object(g.jsx)(n.Fragment,null)),c.length>0&&void 0===s&&Object(g.jsx)(o.EuiText,{size:"xs"},r.i18n.translate("xpack.ml.dataframe.analytics.create.includedFieldsCount",{defaultMessage:"{numFields, plural, one {# field} other {# fields}} included in the analysis",values:{numFields:t.length}})),0===c.length&&Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.calloutTitle",{defaultMessage:"Analysis fields not available"})},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.calloutMessage",defaultMessage:"Additional data required to load analysis fields."})),c.length>0&&Object(g.jsx)(o.EuiPanel,{paddingSize:"m","data-test-subj":"mlAnalyticsCreateJobWizardIncludesSelect"},Object(g.jsx)(Km.a,{currentPage:f.pageIndex,"data-test-subj":"mlAnalyticsCreationAnalysisFieldsTable",checkboxDisabledCheck:tb,columns:eb,filters:j,items:c,itemsPerPage:f.itemsPerPage,onTableChange:t=>{a&&void 0!==e&&""!==e&&0===t.length&&(t=[e]),0===t.length?(l(Zm),u(void 0)):(l(void 0),i({includes:t}))},selectedIds:t,setCurrentPaginationData:h,singleSelection:!1,sortableProperties:p,tableItemId:"name"})),Object(g.jsx)(o.EuiSpacer,null))}),((e,t)=>e.dependentVariable===t.dependentVariable&&Object(Q.isEqual)(e.includes,t.includes)&&Object(Q.isEqual)(e.tableItems,t.tableItems)&&e.unsupportedFieldsError===t.unsupportedFieldsError));function ib(e){return Object.keys(e).map((t=>{let a=e[t];Array.isArray(a)&&(a=a[0]);const i=Object(zu.c)(a.type);return{id:t,schema:i,isExpandable:"boolean"!==i,isRuntimeFieldColumn:!0}}))}function nb(e,t){const{fields:a}=nc.a;return a.filter((e=>t.includes(e.name))).map((e=>{const t=Object(zu.c)(e.type)||Object(zu.d)(e);return{id:e.name,schema:t,isExpandable:"boolean"!==t,isRuntimeFieldColumn:!1}}))}var sb=a(339);const ob=Object(n.memo)((({convertToJson:e,xJsonMode:t,setAdvancedRuntimeMappingsConfig:a,setIsRuntimeMappingsEditorApplyButtonEnabled:i,advancedEditorRuntimeMappingsLastApplied:n,advancedRuntimeMappingsConfig:s})=>Object(g.jsx)("div",{"data-test-subj":"mlDataFrameAnalyticsAdvancedRuntimeMappingsEditor"},Object(g.jsx)(c.CodeEditor,{height:250,languageId:"json",onChange:t=>{if(a(t),n!==t)if(""!==t)try{const a=JSON.parse(e(t));i(Object(Pu.b)(a))}catch(e){i(!1)}else i(!0);else i(!1)},options:{ariaLabel:r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.runtimeMappings.advancedEditorAriaLabel",{defaultMessage:"Advanced runtime editor"}),automaticLayout:!0,fontSize:12,scrollBeyondLastLine:!1,quickSuggestions:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent"},value:s}))),((e,t)=>Object(Q.isEqual)(rb(e),rb(t))));function rb(e){return[e.advancedEditorRuntimeMappingsLastApplied,e.advancedRuntimeMappingsConfig]}const lb=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.runtimeEditorSwitchModalTitle",{defaultMessage:"Edits will be lost"}),cb=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.runtimeEditorSwitchModalCancelButtonText",{defaultMessage:"Cancel"}),db=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.runtimeEditorSwitchModalConfirmButtonText",{defaultMessage:"Close editor"}),ub=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.runtimeEditorSwitchModalBodyText",{defaultMessage:"The changes in the editor haven't been applied yet. By closing the editor you will lose your edits."}),pb=({onCancel:e,onConfirm:t})=>Object(g.jsx)(o.EuiConfirmModal,{title:lb,onCancel:e,onConfirm:t,cancelButtonText:cb,confirmButtonText:db,buttonColor:"danger",defaultFocusedButton:"confirm"},Object(g.jsx)("p",null,ub)),mb="220px",bb=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.indexPreview.copyRuntimeMappingsClipboardTooltip",{defaultMessage:"Copy Dev Console statement of the runtime fields to the clipboard."}),fb=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.advancedSourceEditorApplyButtonText",{defaultMessage:"Apply changes"}),hb=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.advancedRuntimeFieldsEditorHelpText",{defaultMessage:"The advanced editor allows you to edit the runtime fields of the source."}),gb=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.advancedEditorRuntimeFieldsSwitchLabel",{defaultMessage:"Edit runtime fields"}),jb=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.runtimeFieldsLabel",{defaultMessage:"Runtime fields"}),{useXJsonMode:xb}=Ai.XJson,vb=new sb.a,yb=({actions:e,state:t})=>{const[a,i]=Object(n.useState)(!1),[r,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(!1),[u,p]=Object(n.useState)(),{setFormState:b}=e,{jobType:f,previousRuntimeMapping:h,runtimeMappings:j}=t.form,{convertToJson:x,setXJson:v,xJson:y}=xb(j||""),O=Object(Cn.b)(),{currentDataView:E}=O,w=(e=!1)=>{!0===e&&(b({runtimeMappingsUpdated:!1}),v(null!=u?u:"")),i(!a),d(Object(Nu.isRuntimeMappings)(j))};return Object(n.useEffect)((function(){const e=Object(Sp.f)(E,j),t=JSON.stringify(e,null,2);e&&(v(t),p(t),b({runtimeMappings:e}))}),[]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:jb},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"baseline",justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!0},Object(re.isPopulatedObject)(j)?Object(g.jsx)(o.EuiText,{size:"s",grow:!1},Object.keys(j).join(",")):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.createWizard.noRuntimeFieldLabel",defaultMessage:"No runtime field"}),a&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(ob,{advancedEditorRuntimeMappingsLastApplied:u,advancedRuntimeMappingsConfig:y,setIsRuntimeMappingsEditorApplyButtonEnabled:d,setAdvancedRuntimeMappingsConfig:v,convertToJson:x,xJsonMode:vb}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{width:mb}},Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",direction:"column",justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiSwitch,{disabled:void 0===f,label:gb,checked:a,onChange:()=>{a&&y!==u?l(!0):w()},"data-test-subj":"mlDataFrameAnalyticsRuntimeMappingsEditorSwitch"}),r&&Object(g.jsx)(pb,{onCancel:()=>l(!1),onConfirm:()=>{l(!1),w(!0)}})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiCopy,{beforeMessage:bb,textToCopy:null!=y?y:""},(e=>Object(g.jsx)(o.EuiButtonIcon,{onClick:e,iconType:"copyClipboard","aria-label":bb})))))),a&&Object(g.jsx)(o.EuiFlexItem,{style:{width:mb}},Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiText,{size:"xs"},hb),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiButton,{style:{width:"fit-content"},size:"s",fill:!0,onClick:()=>{const e=""===y,t=e?void 0:JSON.parse(y),a=e?"":JSON.stringify(t,null,2);b({runtimeMappings:t,runtimeMappingsUpdated:!0,previousRuntimeMapping:void 0===h&&void 0===j?t:j}),v(a),p(a),d(!1)},disabled:!c,"data-test-subj":"mlDataFrameAnalyticsRuntimeMappingsApplyButton"},fb)))))),Object(g.jsx)(o.EuiSpacer,{size:"s"}))},Ob="runtime_mapping",Eb=r.i18n.translate("xpack.ml.dataframe.analytics.createWizard.requiredFieldsErrorMessage",{defaultMessage:"At least one field must be included in the analysis in addition to the dependent variable."});function wb(e,t){const a=[];return Object.keys(t).forEach((i=>{const n=t[i];Object(Pu.a)(n)&&Um(i,n.type,e)&&a.push({label:i})})),a}const Mb=({actions:e,isClone:t,state:a,setCurrentStep:i})=>{const l=Object(Cn.b)(),{currentSavedSearch:c,currentDataView:d}=l,{savedSearchQuery:u,savedSearchQueryStr:p}=function(){const[e,t]=Object(n.useState)(void 0),[a,i]=Object(n.useState)(void 0),s=Object(Cn.b)(),{currentSavedSearch:o,currentDataView:r,kibanaConfig:l}=s;return Object(n.useEffect)((()=>{(()=>{let e,a={};if(null!==o){const{query:n,filter:s}=Object(C.f)(o),c=n.language;if(e=n.query,c===nt.c.KUERY){const t=Object(bi.fromKueryExpression)(e);a=Object(bi.toElasticsearchQuery)(t,r);const i=Object(bi.buildQueryFromFilters)(s,r);void 0===a.bool&&(a.bool={},void 0!==a.match_all&&(a.bool.should={match_all:a.match_all},delete a.match_all)),!1===Array.isArray(a.bool.filter)&&(a.bool.filter=void 0===a.bool.filter?[]:[a.bool.filter]),!1===Array.isArray(a.bool.must_not)&&(a.bool.must_not=void 0===a.bool.must_not?[]:[a.bool.must_not]),a.bool.filter=[...a.bool.filter,...i.filter],a.bool.must_not=[...a.bool.must_not,...i.must_not]}else a=Object(bi.buildEsQuery)(r,[n],s),Object(bi.decorateQuery)(a,l.get("query:queryString:options"));t(a),i(e)}else t(null),i(null)})()}),[]),{savedSearchQuery:e,savedSearchQueryStr:a}}(),[m,b]=Object(n.useState)(!1),[f,h]=Object(n.useState)(!1),[j,x]=Object(n.useState)(!1),[v,y]=Object(n.useState)([]),[O,E]=Object(n.useState)([]),[w,M]=Object(n.useState)(!1),[S,_]=Object(n.useState)(),[T,k]=Object(n.useState)(),[F,I]=Object(n.useState)(!1),[D,A]=Object(n.useState)(),{setEstimatedModelMemoryLimit:L,setFormState:R}=e,{cloneJob:N,estimatedModelMemoryLimit:P,form:z,isJobCreated:B,requestMessages:V}=a,J=Object(n.useRef)(!0),{dependentVariable:U,includes:G,jobConfigQuery:q,jobConfigQueryLanguage:$,jobConfigQueryString:W,jobType:H,modelMemoryLimit:Y,previousJobType:K,requiredFieldsError:Z,runtimeMappings:te,previousRuntimeMapping:ae,runtimeMappingsUpdated:ie,sourceIndex:ne,trainingPercent:se,useEstimatedMml:oe}=z,re=H===Xd.b.REGRESSION||H===Xd.b.CLASSIFICATION,le=re&&""===U,ce=void 0!==H,de=re&&""!==U||H===Xd.b.OUTLIER_DETECTION,[ue,pe]=Object(n.useState)({query:null!=W?W:"",language:null!=$?$:nt.c.KUERY}),me=Object(ee.n)(),be=((e,t,a,i)=>{const[s,o]=Object(n.useState)();Object(n.useEffect)((()=>{!async function(){m(""),h(Xd.d.LOADING);const t={index:e.title,body:{fields:["*"],_source:!1,query:{function_score:{query:{match_all:{}},random_score:{}}},size:500}};try{const a=(await X.ml.esSearch(t)).hits.hits.map((e=>{var t;return Object(zu.i)(null!==(t=e.fields)&&void 0!==t?t:{})})),i=Object(zu.g)(e),n=[...new Set(a.map(Object.keys).flat(1))].filter((e=>i.includes(e))).sort();h(Xd.d.LOADED),o(n)}catch(e){m(Object(da.b)(e)),h(Xd.d.ERROR)}}()}),[]);const r=Object(n.useMemo)((()=>Object(zu.b)(e,i)),[e,i]),[l,c]=Object(n.useState)([]);Object(n.useEffect)((()=>{Array.isArray(s)&&c([...nb(0,s),...r?ib(r):[]])}),[e,s,r]);const d=Object(zu.l)(l),{pagination:u,resetPagination:p,setErrorMessage:m,setRowCount:b,setRowCountRelation:f,setStatus:h,setTableItems:g,sortingColumns:j,tableItems:x}=d;Object(n.useEffect)((()=>{p()}),[JSON.stringify(t)]),Object(n.useEffect)((()=>{void 0!==s&&void 0!==t&&async function(){m(""),h(Xd.d.LOADING);const a=j.reduce(((e,t)=>(e[t.id]={order:t.direction},e)),{}),i={index:e.title,body:{query:t,from:u.pageIndex*u.pageSize,size:u.pageSize,fields:[...null!=s?s:[],...Object(Pu.b)(r)?Object.keys(r):[]],_source:!1,...Object.keys(a).length>0?{sort:a}:{},...Object(Pu.b)(r)?{runtime_mappings:r}:{}}};try{const e=await X.ml.esSearch(i),t=e.hits.hits.map((e=>{var t;return Object(zu.i)(null!==(t=e.fields)&&void 0!==t?t:{})}));b("number"==typeof e.hits.total?e.hits.total:e.hits.total.value),f("number"==typeof e.hits.total?"eq":e.hits.total.relation),g(t),h(Xd.d.LOADED)}catch(e){m(Object(da.b)(e)),h(Xd.d.ERROR)}}()}),[e.title,s,JSON.stringify([t,u,j,r])]);const v=Object(n.useMemo)((()=>new data_loader_DataLoader(e,a)),[e]);Object(n.useEffect)((()=>{d.chartsVisible&&void 0!==t&&async function(e){try{const t=await v.loadFieldHistograms(l.filter((e=>d.visibleColumns.includes(e.id))).map((e=>({fieldName:e.id,type:Object(zu.f)(e.schema)}))),e,Ep.a,r);d.setColumnCharts(t)}catch(e){Object(zu.k)(e,a)}}(t)}),[d.chartsVisible,e.title,JSON.stringify([t,d.visibleColumns,i])]);const y=Object(zu.m)(e,u,x);return{...d,indexPatternFields:s,renderCellValue:y}})(d,function(e,t){if(void 0!==e)return null!==e?e:t}(u,q),me,te),fe={...be,dataTestSubj:"mlAnalyticsCreationDataGrid",toastNotifications:me},he=le||void 0===H||void 0!==S||void 0!==D||void 0!==Z||void 0!==T||w,ge=Object(Q.debounce)((async()=>{M(!0);const e=K!==H,t=!(J.current&&Y||!0!==oe),a=!J.current||!Y||""===P;J.current&&(J.current=!1);const i=re&&G.length>0&&!1===G.includes(U),n=i&&te&&Object.keys(te).includes(U);let s=z;(n||i)&&(s=Object(Q.cloneDeep)(z),s.includes=[...G,U]);const{success:o,expectedMemory:r,fieldSelection:l,errorMessage:c,noDocsContainMappedFields:d}=await Dm(s);if(o){a&&L(r);const o=l.some((e=>!0===e.is_included&&!1===e.is_required)),c={...t?{modelMemoryLimit:r}:{},...n||e||i?{includes:s.includes}:{},requiredFieldsError:o?void 0:Eb};e&&(b(!1),_(void 0),k(void 0),I(!1),E(l||[])),R(c),M(!1)}else{const{maxDistinctValuesErrorMessage:e,unsupportedFieldsErrorMessage:a,toastNotificationDanger:i,toastNotificationWarning:n}=Gm(c,ne,H);i&&me.addDanger(i),n&&me.addWarning(n);const s=void 0!==H?Im.a[H]:Im.a.outlier_detection;L(s),b(!0),_(e),k(a),I(d),M(!1),R({...t?{modelMemoryLimit:s}:{}})}}),300);Object(n.useEffect)((()=>{R({sourceIndex:d.title})}),[]);const je=Object(n.useMemo)((()=>void 0!==(null==be?void 0:be.indexPatternFields)?be.indexPatternFields.map((e=>({name:e,is_included:!1,is_required:!1}))):[]),[`${null==be?void 0:be.indexPatternFields}`]);Object(n.useEffect)((()=>{"string"==typeof p&&R({jobConfigQuery:u,jobConfigQueryString:p})}),[JSON.stringify(u),p]),Object(n.useEffect)((()=>{if(re){const e=Object(Sp.f)(d);let t;e&&(t=wb(H,e)),(async(e,t=[])=>{h(!0),_(void 0);try{if(void 0!==d){const a=[];let i=e.dependentVariable;const{fields:n}=nc.a;let s=!0;for(const t of n)Um(t.id,t.type,H)&&(a.push({label:t.id}),e.dependentVariable===t.id&&(s=!1));Object(Pu.b)(e.runtimeMappings)&&Object.keys(e.runtimeMappings).includes(z.dependentVariable)&&(s=!1,a.push({label:z.dependentVariable,key:`runtime_mapping_${z.dependentVariable}`})),s&&(i=""),y([...t,...a]),h(!1),x(!1),R({dependentVariable:i})}}catch(e){h(!1),x(!0)}})(z,t)}}),[H]);const xe=Object(n.useCallback)((async()=>{if(ie){let e=!1;if(re){const t=v.filter((t=>{var a,i;return t.label===U&&null!==(a=t.key)&&void 0!==a&&a.includes(Ob)&&(e=!0),!(null!==(i=t.key)&&void 0!==i&&i.includes(Ob))}));if(void 0===te&&!0===ie)y(t);else if(te){const e=wb(H,te);y([...t,...e])}}const t=G.filter((e=>!(ae&&ae[e])));if(e&&(R({dependentVariable:"",includes:t}),E(O.filter((({name:e})=>!(ae&&ae[e]))))),!e&&ce&&de){const e=Object(Q.cloneDeep)(z),a=re&&te&&Object.keys(te).includes(U)&&e.includes.length>0&&!1===e.includes.includes(U);e.includes=a?[...t,U]:t;const{success:i,fieldSelection:n,errorMessage:s,noDocsContainMappedFields:o}=await Dm(e);if(i){const e=n.some((e=>!0===e.is_included&&!1===e.is_required));let a;Object(Pu.b)(te)&&(a=n.map((e=>{var a;return void 0!==te[e.name]&&!1===e.is_included&&null!==(a=e.reason)&&void 0!==a&&a.includes("field not in includes list")&&(t.push(e.name),e.is_included=!0),e}))),E(a||n),_(void 0),k(void 0),I(o),R({includes:t,requiredFieldsError:e?void 0:Eb})}else{const{maxDistinctValuesErrorMessage:e,unsupportedFieldsErrorMessage:t,toastNotificationDanger:a,toastNotificationWarning:i}=Gm(s,ne,H);a&&me.addDanger(a),i&&me.addWarning(i),_(e),k(t),I(o)}}}}),[JSON.stringify(te)]);Object(n.useEffect)((()=>{xe()}),[JSON.stringify(te)]),Object(n.useEffect)((()=>(ce&&de&&ge(),()=>{ge.cancel()})),[H,U,se,JSON.stringify(G),W]);const ve=Object(n.useMemo)((()=>({color:re?U:void 0,fields:O.filter((e=>"numerical"===e.feature_type&&e.is_included)).map((e=>e.name)),index:d.title,legendType:Object(Vm.a)(H),searchQuery:q,runtimeMappings:te,indexPattern:d})),[d.title,U,O,re,q,H]),ye=Object(n.useMemo)((()=>(H===Xd.b.OUTLIER_DETECTION||re&&!le)&&ve.fields.length>1),[le,H,ve.fields.length]);if(void 0===u)return null;const Oe=O.length>0&&!F?O:je;return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(Fm,{messages:V}),Object(g.jsx)(Qm,{jobType:H}),Object(g.jsx)(Hm,{type:H,setFormState:R}),null===u&&Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.sourceQueryLabel",{defaultMessage:"Query"}),fullWidth:!0},Object(g.jsx)(vp,{indexPattern:d,setSearchQuery:e=>{e.query&&R({jobConfigQuery:e.query,jobConfigQueryLanguage:e.language,jobConfigQueryString:e.queryString}),pe({query:e.queryString,language:e.language})},query:ue})),(t&&N||!t)&&Object(g.jsx)(yb,{actions:e,state:a}),Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(n.Fragment,null,null!==u&&Object(g.jsx)(o.EuiText,null,r.i18n.translate("xpack.ml.dataframe.analytics.create.savedSearchLabel",{defaultMessage:"Saved search"})),Object(g.jsx)(o.EuiBadge,{color:"hollow"},null!==u?null==c?void 0:c.attributes.title:d.title)),fullWidth:!0},Object(g.jsx)(zu.a,fe)),re&&Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:r.i18n.translate("xpack.ml.dataframe.analytics.create.dependentVariableLabel",{defaultMessage:"Dependent variable"}),helpText:0===v.length&&!1===j&&d&&r.i18n.translate("xpack.ml.dataframe.analytics.create.dependentVariableOptionsNoNumericalFields",{defaultMessage:"No numeric type fields were found for this data view."}),isInvalid:void 0!==S,error:[...!0===j?[Object(g.jsx)(n.Fragment,null,r.i18n.translate("xpack.ml.dataframe.analytics.create.dependentVariableOptionsFetchError",{defaultMessage:"There was a problem fetching fields. Please refresh the page and try again."}))]:[],...!0===m&&void 0!==S?[Object(g.jsx)(n.Fragment,null,r.i18n.translate("xpack.ml.dataframe.analytics.create.dependentVariableMaxDistictValuesError",{defaultMessage:"Invalid. {message}",values:{message:S}}))]:[]]},Object(g.jsx)(o.EuiComboBox,{fullWidth:!0,"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.dependentVariableInputAriaLabel",{defaultMessage:"Enter field to be used as dependent variable."}),placeholder:H===Xd.b.REGRESSION?r.i18n.translate("xpack.ml.dataframe.analytics.create.dependentVariableRegressionPlaceholder",{defaultMessage:"Select the numeric field that you want to predict."}):r.i18n.translate("xpack.ml.dataframe.analytics.create.dependentVariableClassificationPlaceholder",{defaultMessage:"Select the numeric, categorical, or boolean field that you want to predict."}),isDisabled:B,isLoading:f,singleSelection:!0,options:v,selectedOptions:U?[{label:U}]:[],onChange:e=>{R({dependentVariable:e[0].label||""})},isClearable:!1,isInvalid:""===U,"data-test-subj":"mlAnalyticsCreateJobWizardDependentVariableSelect"+(f?" loading":" loaded")}))),Object(g.jsx)(ab,{dependentVariable:U,includes:G,isJobTypeWithDepVar:re,minimumFieldsRequiredMessage:D,setMinimumFieldsRequiredMessage:A,tableItems:J.current?O:Oe,unsupportedFieldsError:T,setUnsupportedFieldsError:k,setFormState:R}),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,isInvalid:void 0!==Z,error:r.i18n.translate("xpack.ml.dataframe.analytics.create.requiredFieldsError",{defaultMessage:"Invalid. {message}",values:{message:Z}})},Object(g.jsx)(n.Fragment,null)),Object(g.jsx)(o.EuiSpacer,null),ye&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFormRow,{"data-test-subj":"mlAnalyticsCreateJobWizardScatterplotMatrixFormRow",label:r.i18n.translate("xpack.ml.dataframe.analytics.create.scatterplotMatrixLabel",{defaultMessage:"Scatterplot matrix"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.scatterplotMatrixLabelHelpText",{defaultMessage:"Visualizes the relationships between pairs of selected included fields."}),fullWidth:!0},Object(g.jsx)(n.Fragment,null)),Object(g.jsx)(o.EuiPanel,{paddingSize:"m","data-test-subj":"mlAnalyticsCreateJobWizardScatterplotMatrixPanel"},Object(g.jsx)(ip,ve)),Object(g.jsx)(o.EuiSpacer,null)),re&&Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:r.i18n.translate("xpack.ml.dataframe.analytics.create.trainingPercentLabel",{defaultMessage:"Training percent"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.trainingPercentHelpText",{defaultMessage:"Defines the percentage of eligible documents that will be used for training."})},Object(g.jsx)(o.EuiRange,{fullWidth:!0,min:Xd.k,max:Xd.j,step:1,showLabels:!0,showRange:!0,showValue:!0,value:se,onChange:e=>R({trainingPercent:+e.target.value}),"data-test-subj":"mlAnalyticsCreateJobWizardTrainingPercentSlider"})),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)($m,{isDisabled:he,onClick:()=>{i(qb.ADVANCED)}}))},Sb=({actions:e,state:t,setCurrentStep:a,step:i,stepActivated:n,isClone:s})=>{const r=i===qb.CONFIGURATION,l=i!==qb.CONFIGURATION&&!0===n,c=`mlAnalyticsCreateJobWizardConfigurationStep${r?" active":""}${l?" summary":""}`;return Object(g.jsx)(o.EuiForm,{className:"mlDataFrameAnalyticsCreateForm","data-test-subj":c},r&&Object(g.jsx)(Mb,{actions:e,isClone:s,state:t,setCurrentStep:a}),l&&Object(g.jsx)(Bm,{setCurrentStep:a,state:t}))},_b=({actions:e,state:t,advancedParamErrors:a})=>{const{setFormState:i}=e,{alpha:s,downsampleFactor:l,eta:c,etaGrowthRatePerTree:d,featureBagFraction:u,gamma:p,lambda:m,maxOptimizationRoundsPerHyperparameter:b,maxTrees:f,softTreeDepthLimit:h,softTreeDepthTolerance:j}=t.form;return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.lambdaLabel",{defaultMessage:"Lambda"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.lambdaHelpText",{defaultMessage:"A multiplier of the leaf weights in loss calculations. Must be a nonnegative value."}),isInvalid:void 0!==a[Xd.a.LAMBDA],error:a[Xd.a.LAMBDA]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.lambdaInputAriaLabel",{defaultMessage:"A multiplier of leaf weights in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobFlyoutLambdaInput",onChange:e=>i({lambda:""===e.target.value?void 0:+e.target.value}),step:.001,min:0,value:Db(m)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.maxTreesLabel",{defaultMessage:"Max trees"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.maxTreesText",{defaultMessage:"The maximum number of decision trees in the forest."}),isInvalid:void 0!==a[Xd.a.MAX_TREES],error:a[Xd.a.MAX_TREES]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.maxTreesInputAriaLabel",{defaultMessage:"The maximum number of decision trees in the forest."}),"data-test-subj":"mlAnalyticsCreateJobFlyoutMaxTreesInput",onChange:e=>i({maxTrees:""===e.target.value?void 0:+e.target.value}),isInvalid:void 0!==f&&!Number.isInteger(f),step:1,min:1,max:2e3,value:Db(f)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.gammaLabel",{defaultMessage:"Gamma"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.gammaText",{defaultMessage:"A multiplier of the tree size in loss calcuations. Must be nonnegative value."}),isInvalid:void 0!==a[Xd.a.GAMMA],error:a[Xd.a.GAMMA]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.gammaInputAriaLabel",{defaultMessage:"A multiplier of the tree size in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobWizardGammaInput",onChange:e=>i({gamma:""===e.target.value?void 0:+e.target.value}),step:.001,min:0,value:Db(p)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.etaLabel",{defaultMessage:"Eta"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.etaText",{defaultMessage:"The shrinkage applied to the weights. Must be between 0.001 and 1."}),isInvalid:void 0!==a[Xd.a.ETA],error:a[Xd.a.ETA]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.etaInputAriaLabel",{defaultMessage:"The shrinkage applied to the weights."}),"data-test-subj":"mlAnalyticsCreateJobWizardEtaInput",onChange:e=>i({eta:""===e.target.value?void 0:+e.target.value}),step:.001,min:.001,max:1,value:Db(c)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.featureBagFractionLabel",{defaultMessage:"Feature bag fraction"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.featureBagFractionText",{defaultMessage:"The fraction of features used when selecting a random bag for each candidate split."}),isInvalid:void 0!==a[Xd.a.FEATURE_BAG_FRACTION],error:a[Xd.a.FEATURE_BAG_FRACTION]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.featureBagFractionInputAriaLabel",{defaultMessage:"The fraction of features used when selecting a random bag for each candidate split"}),"data-test-subj":"mlAnalyticsCreateJobWizardFeatureBagFractionInput",onChange:e=>i({featureBagFraction:""===e.target.value?void 0:+e.target.value}),isInvalid:void 0!==u&&(u>1||u<=0),step:.001,max:1,value:Db(u)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.alphaLabel",{defaultMessage:"Alpha"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.alphaText",{defaultMessage:"A multiplier of the tree depth in loss calculations. Must be greater than or equal to 0."}),isInvalid:void 0!==a[Xd.a.ALPHA],error:a[Xd.a.ALPHA]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.alphaInputAriaLabel",{defaultMessage:"A multiplier of the tree depth in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobWizardAlphaInput",onChange:e=>i({alpha:""===e.target.value?void 0:+e.target.value}),step:.001,min:0,value:Db(s)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.downsampleFactorLabel",{defaultMessage:"Downsample factor"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.downsampleFactorText",{defaultMessage:"The fraction of data used to compute derivatives of the loss function for tree training. Must be between 0 and 1."}),isInvalid:void 0!==a[Xd.a.DOWNSAMPLE_FACTOR],error:a[Xd.a.DOWNSAMPLE_FACTOR]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.downsampleFactorInputAriaLabel",{defaultMessage:"The fraction of data used to compute derivatives of the loss function for tree training."}),"data-test-subj":"mlAnalyticsCreateJobWizardDownsampleFactorInput",onChange:e=>i({downsampleFactor:""===e.target.value?void 0:+e.target.value}),step:.001,min:0,max:1,value:Db(l)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.etaGrowthRatePerTreeLabel",{defaultMessage:"Eta growth rate per tree"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.etaGrowthRatePerTreeText",{defaultMessage:"The rate at which eta increases for each new tree that is added to the forest. Must be between 0.5 and 2."}),isInvalid:void 0!==a[Xd.a.ETA_GROWTH_RATE_PER_TREE],error:a[Xd.a.ETA_GROWTH_RATE_PER_TREE]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.etaGrowthRatePerTreeInputAriaLabel",{defaultMessage:"The rate at which eta increases for each new tree that is added to the forest."}),"data-test-subj":"mlAnalyticsCreateJobWizardEtaGrowthRatePerTreeInput",onChange:e=>i({etaGrowthRatePerTree:""===e.target.value?void 0:+e.target.value}),step:.001,min:.5,max:2,value:Db(d)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.maxOptimizationRoundsPerHyperparameterLabel",{defaultMessage:"Max optimization rounds per hyperparameter"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.maxOptimizationRoundsPerHyperparameterText",{defaultMessage:"The maximum number of optimization rounds for each undefined hyperparameter."}),isInvalid:void 0!==a[Xd.a.MAX_OPTIMIZATION_ROUNDS_PER_HYPERPARAMETER],error:a[Xd.a.MAX_OPTIMIZATION_ROUNDS_PER_HYPERPARAMETER]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.maxOptimizationRoundsPerHyperparameterInputAriaLabel",{defaultMessage:"The maximum number of optimization rounds for each undefined hyperparameter. Must be an integer between 0 and 20."}),"data-test-subj":"mlAnalyticsCreateJobWizardMaxOptimizationRoundsPerHyperparameterInput",onChange:e=>i({maxOptimizationRoundsPerHyperparameter:""===e.target.value?void 0:+e.target.value}),min:0,max:20,step:1,value:Db(b)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.softTreeDepthLimitLabel",{defaultMessage:"Soft tree depth limit"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.softTreeDepthLimitText",{defaultMessage:"Decision trees that exceed this depth are penalized in loss calculations. Must be greater than or equal to 0. "}),isInvalid:void 0!==a[Xd.a.SOFT_TREE_DEPTH_LIMIT],error:a[Xd.a.SOFT_TREE_DEPTH_LIMIT]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.softTreeDepthLimitInputAriaLabel",{defaultMessage:"Decision trees that exceed this depth are penalized in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobWizardSoftTreeDepthLimitInput",onChange:e=>i({softTreeDepthLimit:""===e.target.value?void 0:+e.target.value}),step:.001,min:0,value:Db(h)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.softTreeDepthToleranceLabel",{defaultMessage:"Soft tree depth tolerance"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.softTreeDepthToleranceText",{defaultMessage:"Controls how quickly the loss increases when tree depths exceed soft limits. The smaller the value, the faster the loss increases. Must be greater than or equal to 0.01. "}),isInvalid:void 0!==a[Xd.a.SOFT_TREE_DEPTH_TOLERANCE],error:a[Xd.a.SOFT_TREE_DEPTH_TOLERANCE]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.softTreeDepthToleranceInputAriaLabel",{defaultMessage:"Decision trees that exceed this depth are penalized in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobWizardSoftTreeDepthToleranceInput",onChange:e=>i({softTreeDepthTolerance:""===e.target.value?void 0:+e.target.value}),step:.001,min:.01,value:Db(j)}))))};var Tb=a(279);const Cb=({actions:e,state:t,advancedParamErrors:a})=>{const{setFormState:i}=e,{method:s,nNeighbors:l,outlierFraction:c,standardizationEnabled:d}=t.form;return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.methodLabel",{defaultMessage:"Method"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.methodHelpText",{defaultMessage:"Sets the method that outlier detection uses. If not set, uses an ensemble of different methods, normalizes and combines their individual outlier scores to obtain the overall outlier score. It is recommended to use the ensemble method."}),isInvalid:void 0!==a[Xd.a.METHOD],error:a[Xd.a.METHOD]},Object(g.jsx)(o.EuiSelect,{options:Object.values(Xd.f).map((e=>({value:e,text:e}))),value:s,hasNoInitialSelection:!0,onChange:e=>{i({method:e.target.value})},"data-test-subj":"mlAnalyticsCreateJobWizardMethodInput"}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.nNeighborsLabel",{defaultMessage:"N neighbors"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.nNeighborsHelpText",{defaultMessage:"The value for how many nearest neighbors each method of outlier detection uses to calculate its outlier score. When not set, different values are used for different ensemble members. Must be a positive integer."}),isInvalid:void 0!==a[Xd.a.N_NEIGHBORS],error:a[Xd.a.N_NEIGHBORS]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.nNeighborsInputAriaLabel",{defaultMessage:"The value for how many nearest neighbors each method of outlier detection uses to calculate its outlier score."}),"data-test-subj":"mlAnalyticsCreateJobWizardnNeighborsInput",onChange:e=>i({nNeighbors:""===e.target.value?void 0:+e.target.value}),step:1,min:1,value:Db(l)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.outlierFractionLabel",{defaultMessage:"Outlier fraction"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.outlierFractionHelpText",{defaultMessage:"Sets the proportion of the data set that is assumed to be outlying prior to outlier detection."}),isInvalid:void 0!==a[Xd.a.OUTLIER_FRACTION],error:a[Xd.a.OUTLIER_FRACTION]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.outlierFractionInputAriaLabel",{defaultMessage:"Sets the proportion of the data set that is assumed to be outlying prior to outlier detection."}),"data-test-subj":"mlAnalyticsCreateJobWizardoutlierFractionInput",onChange:e=>i({outlierFraction:""===e.target.value?void 0:+e.target.value}),step:.001,min:0,max:1,value:Db(c)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.standardizationEnabledLabel",{defaultMessage:"Standardization enabled"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.standardizationEnabledHelpText",{defaultMessage:"If true, the following operation is performed on the columns before computing outlier scores: (x_i - mean(x_i)) / sd(x_i)."})},Object(g.jsx)(o.EuiSelect,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.standardizationEnabledInputAriaLabel",{defaultMessage:"Sets standardization enabled setting."}),"data-test-subj":"mlAnalyticsCreateJobWizardStandardizationEnabledInput",options:[{value:"true",text:r.i18n.translate("xpack.ml.dataframe.analytics.create.standardizationEnabledTrueValue",{defaultMessage:"True"})},{value:"false",text:r.i18n.translate("xpack.ml.dataframe.analytics.create.standardizationEnabledFalseValue",{defaultMessage:"False"})}],value:d,hasNoInitialSelection:!0,onChange:e=>{i({standardizationEnabled:e.target.value})}}))))},kb={label:r.i18n.translate("xpack.ml.dataframe.analytics.create.allClassesLabel",{defaultMessage:"All classes"}),value:-1},Fb=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.numTopClassTypeWarning",defaultMessage:"Value must be an integer of -1 or greater, where -1 indicates all classes."});function Ib(e){return-1===e?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.numTopClassesHelpText",defaultMessage:"The number of categories for which the predicted probabilities are reported."})," ",Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.allClassesMessage",defaultMessage:"If you have a large number of classes there could be a significant effect on the size of your destination index."})):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.numTopClassesHelpText",defaultMessage:"The number of categories for which the predicted probabilities are reported."})}function Db(e){return void 0===e?"":+e}const Ab=({actions:e,state:t,setCurrentStep:a})=>{var i;const[l,c]=Object(n.useState)({}),[d,u]=Object(n.useState)(!1),{services:{docLinks:p}}=Object(y.b)(),b=p.links.ml.classificationAucRoc,{setEstimatedModelMemoryLimit:f,setFormState:h}=e,{form:j,isJobCreated:x,estimatedModelMemoryLimit:v}=t,{alpha:O,computeFeatureInfluence:E,downsampleFactor:w,eta:M,etaGrowthRatePerTree:S,featureBagFraction:_,featureInfluenceThreshold:T,gamma:C,jobType:k,lambda:F,maxNumThreads:I,maxOptimizationRoundsPerHyperparameter:D,maxTrees:A,method:L,modelMemoryLimit:R,modelMemoryLimitValidationResult:N,nNeighbors:P,numTopClasses:z,numTopFeatureImportanceValues:B,numTopFeatureImportanceValuesValid:V,outlierFraction:J,predictionFieldName:U,randomizeSeed:G,softTreeDepthLimit:q,softTreeDepthTolerance:$,useEstimatedMml:W}=j,[H,Y]=Object(n.useState)([kb]),[X,Q]=Object(n.useState)(function(e){const t=[];return-1===e?t.push(kb):void 0!==e&&t.push({label:`${e}`}),t}(z)),K=X[0]&&(null!==(i=X[0].value)&&void 0!==i?i:Number(X[0].label)),Z=void 0!==(ee=K)&&(isNaN(ee)||ee<-1||ee-Math.floor(ee)!=0);var ee;const te=Object(n.useMemo)((()=>Object(Tb.a)(N)),[N]),ae=k===Xd.b.REGRESSION||k===Xd.b.CLASSIFICATION,ie=null!==N&&(void 0!==N.invalidUnits||!0===N.required),ne=Z||ie||Object.keys(l).length>0||!0===d||0===I;Object(n.useEffect)((()=>{u(!0),async function(){const{success:e,errorMessage:t,errorReason:a,expectedMemory:i}=await Dm(j),n={};e?R!==i&&(f(i),!0===W&&h({modelMemoryLimit:i})):Object.values(Xd.a).forEach((e=>{t.includes(`[${e}]`)?n[e]=t:null!=a&&a.includes(`[${e}]`)&&(n[e]=a)})),u(!1),c(n)}()}),[O,w,M,S,_,T,C,F,I,D,A,L,P,z,B,J,G,q,$]);const se=Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.computeFeatureInfluenceLabel",{defaultMessage:"Compute feature influence"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.computeFeatureInfluenceLabelHelpText",{defaultMessage:"Specifies whether the feature influence calculation is enabled. Defaults to true."})},Object(g.jsx)(o.EuiSelect,{"data-test-subj":"mlAnalyticsCreateJobWizardComputeFeatureInfluenceLabelInput",options:[{value:"true",text:r.i18n.translate("xpack.ml.dataframe.analytics.create.computeFeatureInfluenceTrueValue",{defaultMessage:"True"})},{value:"false",text:r.i18n.translate("xpack.ml.dataframe.analytics.create.computeFeatureInfluenceFalseValue",{defaultMessage:"False"})}],value:E,hasNoInitialSelection:!1,onChange:e=>{h({computeFeatureInfluence:e.target.value})}}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.featureInfluenceThresholdLabel",{defaultMessage:"Feature influence threshold"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.featureInfluenceThresholdHelpText",{defaultMessage:"The minimum outlier score that a document needs to have in order to calculate its feature influence score. Value range: 0-1. Defaults to 0.1."}),isInvalid:void 0!==l[Xd.a.FEATURE_INFLUENCE_THRESHOLD],error:l[Xd.a.FEATURE_INFLUENCE_THRESHOLD]},Object(g.jsx)(o.EuiFieldNumber,{onChange:e=>h({featureInfluenceThreshold:""===e.target.value?void 0:+e.target.value}),"data-test-subj":"mlAnalyticsCreateJobWizardFeatureInfluenceThresholdInput",min:0,max:1,step:.001,value:Db(T)})))),oe=Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.numTopFeatureImportanceValuesLabel",{defaultMessage:"Feature importance values"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.numTopFeatureImportanceValuesHelpText",{defaultMessage:"Specify the maximum number of feature importance values per document to return."}),isInvalid:!1===V,error:[...!1===V?[Object(g.jsx)(n.Fragment,null,r.i18n.translate("xpack.ml.dataframe.analytics.create.numTopFeatureImportanceValuesErrorText",{defaultMessage:"Invalid maximum number of feature importance values."}))]:[]]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.numTopFeatureImportanceValuesInputAriaLabel",{defaultMessage:"Maximum number of feature importance values per document."}),"data-test-subj":"mlAnalyticsCreateJobFlyoutnumTopFeatureImportanceValuesInput",isInvalid:!1===V,min:Xd.e,onChange:e=>h({numTopFeatureImportanceValues:""===e.target.value?void 0:+e.target.value}),step:1,value:Db(B)}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.predictionFieldNameLabel",{defaultMessage:"Prediction field name"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.predictionFieldNameHelpText",{defaultMessage:"Defines the name of the prediction field in the results. Defaults to <dependent_variable>_prediction."})},Object(g.jsx)(o.EuiFieldText,{disabled:x,value:U,onChange:e=>h({predictionFieldName:e.target.value}),"data-test-subj":"mlAnalyticsCreateJobWizardPredictionFieldNameInput"}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.randomizeSeedLabel",{defaultMessage:"Randomize seed"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.randomizeSeedText",{defaultMessage:"The seed for the random generator used to pick training data."}),isInvalid:void 0!==l[Xd.a.RANDOMIZE_SEED],error:l[Xd.a.RANDOMIZE_SEED]},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.randomizeSeedInputAriaLabel",{defaultMessage:"The seed for the random generator used to pick training data."}),"data-test-subj":"mlAnalyticsCreateJobWizardRandomizeSeedInput",onChange:e=>h({randomizeSeed:""===e.target.value?void 0:+e.target.value}),isInvalid:void 0!==G&&"number"!=typeof G,value:Db(G),step:1}))));return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h3",null,r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedConfigSectionTitle",{defaultMessage:"Advanced configuration"}))),Object(g.jsx)(o.EuiFlexGrid,{columns:3},k===Xd.b.OUTLIER_DETECTION&&se,ae&&oe,k===Xd.b.CLASSIFICATION&&Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.numTopClassesLabel",{defaultMessage:"Top classes"}),helpText:Ib(K),isInvalid:0===K||Z,error:[...0===K?[(re=b,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.create.zeroClassesMessage",defaultMessage:"To evaluate the {wikiLink}, select all classes or a value greater than the total number of categories.",values:{wikiLink:Object(g.jsx)(o.EuiLink,{href:re,target:"_blank",external:!0},r.i18n.translate("xpack.ml.dataframe.analytics.create.aucRocLabel",{defaultMessage:"AUC ROC"}))}}))]:[],...Z?[Fb]:[]]},Object(g.jsx)(o.EuiComboBox,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.numTopClassesInputAriaLabel",{defaultMessage:"The number of categories for which the predicted probabilities are reported"}),singleSelection:!0,options:H,selectedOptions:X,onCreateOption:(e,t=[])=>{const a=e.trim().toLowerCase();if(""===a)return;const i={label:e};-1===t.findIndex((e=>e.label.trim().toLowerCase()===a))&&Y([...H,i]),Q([i])},onChange:e=>{Q(e)},isClearable:!0,isInvalid:void 0!==K&&K<-1,"data-test-subj":"mlAnalyticsCreateJobWizardnumTopClassesInput"}))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.modelMemoryLimitLabel",{defaultMessage:"Model memory limit"}),isInvalid:null!==N,error:te,helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.modelMemoryLimitHelpText",{defaultMessage:"The approximate maximum amount of memory resources that are permitted for analytical processing."})},Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFieldText,{placeholder:void 0!==k?Im.a[k]:Im.a.outlier_detection,disabled:x||W,value:W?v:R||"",onChange:e=>h({modelMemoryLimit:e.target.value}),isInvalid:null!==N,"data-test-subj":"mlAnalyticsCreateJobWizardModelMemoryInput"}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiSwitch,{disabled:x,name:"mlDataFrameAnalyticsUseEstimatedMml",label:r.i18n.translate("xpack.ml.dataframe.analytics.create.useEstimatedMmlLabel",{defaultMessage:"Use estimated model memory limit"}),checked:!0===W,onChange:()=>h({useEstimatedMml:!W}),"data-test-subj":"mlAnalyticsCreateJobWizardUseEstimatedMml"})))),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.dataframe.analytics.create.maxNumThreadsLabel",{defaultMessage:"Maximum number of threads"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.maxNumThreadsHelpText",{defaultMessage:"The maximum number of threads to be used by the analysis. The default value is 1."}),isInvalid:0===I,error:0===I&&r.i18n.translate("xpack.ml.dataframe.analytics.create.maxNumThreadsError",{defaultMessage:"The minimum value is 1."})},Object(g.jsx)(o.EuiFieldNumber,{"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.maxNumThreadsInputAriaLabel",{defaultMessage:"The maximum number of threads to be used by the analysis."}),"data-test-subj":"mlAnalyticsCreateJobWizardMaxNumThreadsInput",min:1,onChange:e=>h({maxNumThreads:""===e.target.value?void 0:+e.target.value}),step:1,value:Db(I)})))),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiAccordion,{id:"hyper-parameters",buttonContent:Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h3",null,r.i18n.translate("xpack.ml.dataframe.analytics.create.hyperParametersSectionTitle",{defaultMessage:"Hyperparameters"}))),initialIsOpen:!1,"data-test-subj":"mlAnalyticsCreateJobWizardHyperParametersSection"},Object(g.jsx)(o.EuiFlexGrid,{columns:3},k===Xd.b.OUTLIER_DETECTION&&Object(g.jsx)(Cb,{actions:e,state:t,advancedParamErrors:l}),ae&&Object(g.jsx)(_b,{actions:e,state:t,advancedParamErrors:l}))),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)($m,{isDisabled:ne,onClick:()=>{h({numTopClasses:!1===Z?K:void 0}),a(qb.DETAILS)}}));var re};function Lb(e){return"number"==typeof e?`${e}`:Im.c}const Rb=({setCurrentStep:e,state:t})=>{const{form:a,isJobCreated:i}=t,{computeFeatureInfluence:s,dependentVariable:l,eta:c,featureBagFraction:d,featureInfluenceThreshold:u,gamma:p,jobType:m,lambda:b,method:f,maxNumThreads:h,maxTrees:j,modelMemoryLimit:x,nNeighbors:v,numTopClasses:y,numTopFeatureImportanceValues:O,outlierFraction:E,predictionFieldName:w,randomizeSeed:M,standardizationEnabled:S}=a,_=m===Xd.b.REGRESSION||m===Xd.b.CLASSIFICATION,T=[],C=[],k=[],F=[],I=[],D=[];return m===Xd.b.OUTLIER_DETECTION&&(T.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.computeFeatureInfluence",{defaultMessage:"Compute feature influence"}),description:s}),C.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.featureInfluenceThreshold",{defaultMessage:"Feature influence threshold"}),description:Lb(u)}),k.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.modelMemoryLimit",{defaultMessage:"Model memory limit"}),description:`${x}`}),F.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.nNeighbors",{defaultMessage:"N neighbors"}),description:Lb(v)},{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.outlierFraction",{defaultMessage:"Outlier fraction"}),description:Lb(E)}),I.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.method",{defaultMessage:"Method"}),description:void 0!==f?f:Im.c}),D.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.standardizationEnabled",{defaultMessage:"Standardization enabled"}),description:`${S}`})),_&&(T.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.numTopFeatureImportanceValues",{defaultMessage:"Top feature importance values"}),description:`${O}`}),F.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.lambdaFields",{defaultMessage:"Lambda"}),description:Lb(b)},{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.eta",{defaultMessage:"Eta"}),description:Lb(c)}),C.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.predictionFieldName",{defaultMessage:"Prediction field name"}),description:w||`${l}_prediction`},{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.randomizedSeed",{defaultMessage:"Randomized seed"}),description:Lb(M)}),I.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.maxTreesFields",{defaultMessage:"Max trees"}),description:Lb(j)},{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.featureBagFraction",{defaultMessage:"Feature bag fraction"}),description:Lb(d)}),k.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.modelMemoryLimit",{defaultMessage:"Model memory limit"}),description:`${x}`}),D.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.gamma",{defaultMessage:"Gamma"}),description:Lb(p)})),m===Xd.b.CLASSIFICATION&&k.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.numTopClasses",{defaultMessage:"Top classes"}),description:-1===y?r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.allClasses",{defaultMessage:"All classes"}):Lb(y)}),void 0!==h&&T.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.maxNumThreads",{defaultMessage:"Maximum number of threads"}),description:`${h}`}),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h3",null,r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedConfigDetailsTitle",{defaultMessage:"Advanced configuration"}))),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiFlexGroup,{style:{width:"70%"},justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:T})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:C})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:k}))),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h3",null,r.i18n.translate("xpack.ml.dataframe.analytics.create.hyperParametersDetailsTitle",{defaultMessage:"Hyperparameters"}))),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiFlexGroup,{style:{width:"70%"},justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:F})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:I})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:D}))),Object(g.jsx)(o.EuiSpacer,null),!i&&Object(g.jsx)(o.EuiButtonEmpty,{iconType:"pencil",size:"s",onClick:()=>{e(qb.ADVANCED)}},r.i18n.translate("xpack.ml.dataframe.analytics.create.advancedDetails.editButtonText",{defaultMessage:"Edit"})))},Nb=({actions:e,state:t,step:a,setCurrentStep:i,stepActivated:n})=>{const s=a===qb.ADVANCED,r=a!==qb.ADVANCED&&!0===n,l=`mlAnalyticsCreateJobWizardAdvancedStep${s?" active":""}${r?" summary":""}`;return Object(g.jsx)(o.EuiForm,{"data-test-subj":l},s&&Object(g.jsx)(Ab,{actions:e,state:t,setCurrentStep:i}),r&&Object(g.jsx)(Rb,{setCurrentStep:i,state:t}))},Pb=({setCurrentStep:e,state:t})=>{const{form:a,isJobCreated:i}=t,{description:s,jobId:l,destinationIndex:c,resultsField:d}=a,u=[{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.jobId",{defaultMessage:"Job ID"}),description:l}];void 0!==d&&"string"==typeof d&&""!==d.trim()&&u.push({title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.resultsField",{defaultMessage:"Results field"}),description:d});const p=[{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.jobDescription",{defaultMessage:"Job description"}),description:s}],m=[{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.configDetails.destIndex",{defaultMessage:"Destination index"}),description:c||""}];return Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{style:{width:"70%"},justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:u})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{style:{wordBreak:"break-word"},compressed:!0,listItems:p})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:m}))),Object(g.jsx)(o.EuiSpacer,null),!i&&Object(g.jsx)(o.EuiButtonEmpty,{iconType:"pencil",size:"s",onClick:()=>{e(qb.DETAILS)}},r.i18n.translate("xpack.ml.dataframe.analytics.create.detailsDetails.editButtonText",{defaultMessage:"Edit"})))},zb=r.i18n.translate("xpack.ml.dataframe.analytics.create.destinationIndexHelpText",{defaultMessage:"An index with this name already exists. Be aware that running this analytics job will modify this destination index."}),Bb=({actions:e,state:t,setCurrentStep:a})=>{const{services:{docLinks:i,notifications:s}}=Object(y.b)(),l=i.links.apis.createIndex,{setFormState:c}=e,{form:d,cloneJob:u,hasSwitchedToEditor:p,isJobCreated:m}=t,{description:b,destinationIndex:f,destinationIndexNameEmpty:h,destinationIndexNameExists:j,destinationIndexNameValid:x,jobId:v,jobIdEmpty:O,jobIdExists:E,jobIdInvalidMaxLength:w,jobIdValid:M,resultsField:S}=d,[_,T]=Object(n.useState)(void 0===u&&!1===p),[C,k]=Object(n.useState)(void 0===u&&!1===p&&void 0===S||void 0!==u&&"ml"===S),F=Object(n.useRef)(null),I=!0===O||!0===E||!1===M||!0===h||!1===x,D=Object(Q.debounce)((async()=>{try{const e=await X.ml.checkIndicesExists({indices:[f]});c({destinationIndexNameExists:e[f].exists})}catch(e){s.toasts.addDanger(r.i18n.translate("xpack.ml.dataframe.analytics.create.errorCheckingIndexExists",{defaultMessage:"The following error occurred getting the existing index names: {error}",values:{error:Object(da.b)(e)}}))}}),400),A=Object(n.useMemo)((()=>Object(Q.debounce)((async()=>{try{const e=await X.ml.dataFrameAnalytics.jobsExist([v],!0);c({jobIdExists:e[v].exists})}catch(e){s.toasts.addDanger(r.i18n.translate("xpack.ml.dataframe.analytics.create.errorCheckingJobIdExists",{defaultMessage:"The following error occurred checking if job id exists: {error}",values:{error:Object(da.b)(e)}}))}}),400)),[v]);return Object(n.useEffect)((()=>(!0===M?A():"string"==typeof v&&""===v.trim()&&!0===E&&c({jobIdExists:!1}),()=>{A.cancel()})),[v]),Object(n.useEffect)((()=>(!0===x?D():"string"==typeof f&&""===f.trim()&&!0===j&&c({destinationIndexNameExists:!1}),()=>{D.cancel()})),[f]),Object(n.useEffect)((()=>{!0===_&&!O&&M?c({destinationIndex:v}):!1===_&&!1===p&&c({destinationIndex:""})}),[_,v]),Object(g.jsx)(n.Fragment,null,Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:r.i18n.translate("xpack.ml.dataframe.analytics.create.jobIdLabel",{defaultMessage:"Job ID"}),isInvalid:!O&&!M||E||w,error:[...O||M?[]:[r.i18n.translate("xpack.ml.dataframe.analytics.create.jobIdInvalidError",{defaultMessage:"Must contain lowercase alphanumeric characters (a-z and 0-9), hyphens, and underscores only and must start and end with alphanumeric characters."})],...E?[r.i18n.translate("xpack.ml.dataframe.analytics.create.jobIdExistsError",{defaultMessage:"An analytics job with this ID already exists."})]:[],...w?[r.i18n.translate("xpack.ml.dataframe.analytics.create.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:el.b}})]:[]]},Object(g.jsx)(o.EuiFieldText,{fullWidth:!0,inputRef:e=>{e&&(F.current=e)},disabled:m,placeholder:r.i18n.translate("xpack.ml.dataframe.analytics.create.jobIdPlaceholder",{defaultMessage:"Job ID"}),value:v,onChange:e=>c({jobId:e.target.value}),"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.jobIdInputAriaLabel",{defaultMessage:"Choose a unique analytics job ID."}),isInvalid:!O&&!M||E||O,"data-test-subj":"mlAnalyticsCreateJobFlyoutJobIdInput"})),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:r.i18n.translate("xpack.ml.dataframe.analytics.create.jobDescription.label",{defaultMessage:"Job description"})},Object(g.jsx)(o.EuiTextArea,{fullWidth:!0,value:b,placeholder:r.i18n.translate("xpack.ml.dataframe.analytics.create.jobDescription.helpText",{defaultMessage:"Optional descriptive text"}),rows:2,onChange:e=>{const t=e.target.value;c({description:t})},"data-test-subj":"mlDFAnalyticsJobCreationJobDescription"})),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,helpText:!0===_&&j&&zb},Object(g.jsx)(o.EuiSwitch,{disabled:m,name:"mlDataFrameAnalyticsDestIndexSameAsId",label:r.i18n.translate("xpack.ml.dataframe.analytics.create.DestIndexSameAsIdLabel",{defaultMessage:"Destination index same as job ID"}),checked:!0===_,onChange:()=>T(!_),"data-test-subj":"mlAnalyticsCreateJobWizardDestIndexSameAsIdSwitch"})),!1===_&&Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:r.i18n.translate("xpack.ml.dataframe.analytics.create.destinationIndexLabel",{defaultMessage:"Destination index"}),isInvalid:h||!h&&!x,helpText:j&&zb,error:!h&&!x&&[Object(g.jsx)(n.Fragment,null,r.i18n.translate("xpack.ml.dataframe.analytics.create.destinationIndexInvalidError",{defaultMessage:"Invalid destination index name."}),Object(g.jsx)("br",null),Object(g.jsx)(o.EuiLink,{href:l,target:"_blank"},r.i18n.translate("xpack.ml.dataframe.stepDetailsForm.destinationIndexInvalidErrorLink",{defaultMessage:"Learn more about index name limitations."})))]},Object(g.jsx)(o.EuiFieldText,{fullWidth:!0,disabled:m,placeholder:"destination index",value:f,onChange:e=>c({destinationIndex:e.target.value}),"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.destinationIndexInputAriaLabel",{defaultMessage:"Choose a unique destination index name."}),isInvalid:!h&&!x,"data-test-subj":"mlAnalyticsCreateJobFlyoutDestinationIndexInput"})),Object(g.jsx)(o.EuiFormRow,{fullWidth:!0},Object(g.jsx)(o.EuiSwitch,{disabled:m,name:"mlDataFrameAnalyticsUseResultsFieldDefault",label:r.i18n.translate("xpack.ml.dataframe.analytics.create.UseResultsFieldDefaultLabel",{defaultMessage:'Use results field default value "{defaultValue}"',values:{defaultValue:"ml"}}),checked:!0===C,onChange:()=>{1==!C&&c({resultsField:void 0}),k(!C)},"data-test-subj":"mlAnalyticsCreateJobWizardUseResultsFieldDefault"})),!1===C&&Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:r.i18n.translate("xpack.ml.dataframe.analytics.create.resultsFieldLabel",{defaultMessage:"Results field"}),helpText:r.i18n.translate("xpack.ml.dataframe.analytics.create.resultsFieldHelpText",{defaultMessage:"Defines the name of the field in which to store the results of the analysis. Defaults to ml."})},Object(g.jsx)(o.EuiFieldText,{disabled:m,placeholder:"results field",value:S,onChange:e=>c({resultsField:e.target.value}),"aria-label":r.i18n.translate("xpack.ml.dataframe.analytics.create.resultsFieldInputAriaLabel",{defaultMessage:"The name of the field in which to store the results of the analysis."}),"data-test-subj":"mlAnalyticsCreateJobWizardResultsFieldInput"})),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)($m,{isDisabled:I,onClick:()=>{a(qb.VALIDATION)}}))},Vb=({actions:e,state:t,setCurrentStep:a,step:i,stepActivated:n})=>{const s=i===qb.DETAILS,r=i!==qb.DETAILS&&!0===n,l=`mlAnalyticsCreateJobWizardDetailsStep${s?" active":""}${r?" summary":""}`;return Object(g.jsx)(o.EuiForm,{className:"mlDataFrameAnalyticsCreateForm","data-test-subj":l},s&&Object(g.jsx)(Bb,{actions:e,state:t,setCurrentStep:a}),r&&Object(g.jsx)(Pb,{setCurrentStep:a,state:t}))},Jb=({checksInProgress:e,validationMessages:t,setCurrentStep:a})=>{const i=t.map(((e,t)=>Object(g.jsx)(rl,_()({key:`${e.id}_${t}`},e))));return Object(g.jsx)(s.a.Fragment,null,e&&Object(g.jsx)(o.EuiLoadingSpinner,{size:"xl"}),!e&&Object(g.jsx)(s.a.Fragment,null,i,Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)($m,{isDisabled:!1,onClick:()=>{a(qb.CREATE)}})))},Ub=({setCurrentStep:e,state:t,validationSummary:a})=>{const{isJobCreated:i}=t,n=[{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.validatioinDetails.successfulChecks",{defaultMessage:"Successful checks"}),description:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"s"},a.success)),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIcon,{type:"check"}))))}],l=[{title:r.i18n.translate("xpack.ml.dataframe.analytics.create.validatioinDetails.warnings",{defaultMessage:"Warnings"}),description:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"s"},a.warning)),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIcon,{type:"alert"}))))}];return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{style:{width:"70%"}},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{compressed:!0,listItems:n})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiDescriptionList,{style:{wordBreak:"break-word"},compressed:!0,listItems:l}))),Object(g.jsx)(o.EuiSpacer,null),!i&&Object(g.jsx)(o.EuiButtonEmpty,{size:"s",onClick:()=>{e(qb.VALIDATION)}},r.i18n.translate("xpack.ml.dataframe.analytics.create.validationDetails.viewButtonText",{defaultMessage:"View"})))},Gb=({state:e,setCurrentStep:t,step:a,stepActivated:i})=>{const[s,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)([]),[u,p]=Object(n.useState)(),{form:m,jobConfig:b,isAdvancedEditorEnabled:f}=e,{dependentVariable:h,jobType:j,trainingPercent:x,numTopFeatureImportanceValues:v,numTopClasses:O,includes:E}=m,w=a===qb.VALIDATION,M=a!==qb.VALIDATION&&!0===i,{dataFrameAnalytics:{validateDataFrameAnalytics:S}}=Object(y.a)(),_=`mlAnalyticsCreateJobWizardValidationStepWrapper${w?" active":""}${M?" summary":""}`,T=Object(Q.debounce)((async()=>{l(!0);try{const e=f?b:Object(Im.f)(m),t=await S(e);d(t),p(void 0),l(!1)}catch(e){p({heading:r.i18n.translate("xpack.ml.dataframe.analytics.validation.validationFetchErrorMessage",{defaultMessage:"Error validating job"}),id:"error",status:el.c.ERROR,text:Object(da.b)(e)}),l(!1)}}),500);Object(n.useEffect)((function(){void 0===j||!w&&!0!==i||T()}),[w,h,x,v,O,E]),void 0!==u&&c.push(u);const C=Object(n.useMemo)((()=>c.reduce(((e,t)=>((null==t?void 0:t.status)===el.c.WARNING?e.warning+=1:(null==t?void 0:t.status)===el.c.SUCCESS&&(e.success+=1),e)),{warning:0,success:0})),[c]);return Object(g.jsx)(o.EuiForm,{className:"mlDataFrameAnalyticsCreateForm","data-test-subj":_},w&&Object(g.jsx)(Jb,{checksInProgress:s,validationMessages:c,setCurrentStep:t}),M&&Object(g.jsx)(Ub,{setCurrentStep:t,state:e,validationSummary:C}))};let qb;!function(e){e[e.CONFIGURATION=0]="CONFIGURATION",e[e.ADVANCED=1]="ADVANCED",e[e.DETAILS=2]="DETAILS",e[e.VALIDATION=3]="VALIDATION",e[e.CREATE=4]="CREATE"}(qb||(qb={}));const $b=({jobId:e})=>{const[t,a]=Object(n.useState)(qb.CONFIGURATION),[i,s]=Object(n.useState)([!0,!1,!1,!1,!1]),l=Object(Cn.b)(),{currentDataView:c}=l,d=Object(km.b)(),{state:u}=d,{isAdvancedEditorEnabled:p,disableSwitchToForm:b,isJobCreated:f}=u,{jobType:h}=u.form,{initiateWizard:j,setJobClone:x,switchToAdvancedEditor:v,switchToForm:y}=d.actions;Object(n.useEffect)((()=>{j(),c&&async function(){if(void 0!==e){const t=await X.ml.dataFrameAnalytics.getDataFrameAnalytics(e,!0);if(Array.isArray(t.data_frame_analytics)&&t.data_frame_analytics.length>0){const e=t.data_frame_analytics[0];await x(e)}}}()}),[]),Object(n.useEffect)((()=>{!1===i[t]&&(i.splice(t,1,!0),s(i))}),[t]);const O=[{title:r.i18n.translate("xpack.ml.dataframe.analytics.creation.configurationStepTitle",{defaultMessage:"Configuration"}),children:Object(g.jsx)(Sb,_()({},d,{isClone:void 0!==e,setCurrentStep:a,step:t,stepActivated:i[qb.CONFIGURATION]})),status:t>=qb.CONFIGURATION?void 0:"incomplete"},{title:r.i18n.translate("xpack.ml.dataframe.analytics.creation.advancedStepTitle",{defaultMessage:"Additional options"}),children:Object(g.jsx)(Nb,_()({},d,{setCurrentStep:a,step:t,stepActivated:i[qb.ADVANCED]})),status:t>=qb.ADVANCED?void 0:"incomplete"},{title:r.i18n.translate("xpack.ml.dataframe.analytics.creation.detailsStepTitle",{defaultMessage:"Job details"}),children:Object(g.jsx)(Vb,_()({},d,{setCurrentStep:a,step:t,stepActivated:i[qb.DETAILS]})),status:t>=qb.DETAILS?void 0:"incomplete"},{title:r.i18n.translate("xpack.ml.dataframe.analytics.creation.validationStepTitle",{defaultMessage:"Validation"}),children:Object(g.jsx)(Gb,_()({},d,{setCurrentStep:a,step:t,stepActivated:i[qb.VALIDATION]})),status:t>=qb.VALIDATION?void 0:"incomplete"},{title:r.i18n.translate("xpack.ml.dataframe.analytics.creation.createStepTitle",{defaultMessage:"Create"}),children:Object(g.jsx)(Pm,_()({},d,{step:t})),status:t>=qb.CREATE?void 0:"incomplete"}];return Object(g.jsx)("div",{"data-test-subj":"mlAnalyticsCreationContainer"},Object(g.jsx)(on.a,null,Object(g.jsx)("span",{"data-test-subj":"mlDataFrameAnalyticsWizardHeaderTitle"},void 0===e&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.creationPageTitle",defaultMessage:"Create job"}),void 0!==e&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.clone.creationPageTitle",defaultMessage:"Clone job from {jobId}",values:{jobId:e}}))),Object(g.jsx)(o.EuiPageBody,{restrictWidth:1200},Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analytics.creationPageSourceIndexTitle",defaultMessage:"Source data view: {dataViewTitle}",values:{dataViewTitle:c.title}}))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{helpText:b&&r.i18n.translate("xpack.ml.dataframe.analytics.create.jsonEditorDisabledSwitchText",{defaultMessage:"Configuration contains advanced fields not supported by the form. You cannot switch back to the form."})},Object(g.jsx)(o.EuiSwitch,{disabled:void 0===h||b||f,label:r.i18n.translate("xpack.ml.dataframe.analytics.create.switchToJsonEditorSwitch",{defaultMessage:"Switch to json editor"}),checked:p,onChange:e=>{!0===e.target.checked?v():y()},"data-test-subj":"mlAnalyticsCreateJobWizardAdvancedEditorSwitch"})))),Object(g.jsx)(o.EuiSpacer,null),!0===p&&Object(g.jsx)(zm,d),!1===p&&Object(g.jsx)(o.EuiSteps,{"data-test-subj":"mlAnalyticsCreateJobWizardSteps",steps:O})))},Wb=(e,t)=>({path:"/data_frame_analytics/new_job",render:(e,t)=>Object(g.jsx)(Hb,_()({},e,{deps:t})),title:r.i18n.translate("xpack.ml.dataFrameAnalytics.createJob.docTitle",{defaultMessage:"Create Job"}),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("DATA_FRAME_ANALYTICS_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.dataFrameCreationLabel",{defaultMessage:"Create Job"})}]}),Hb=({location:e,deps:t})=>{const{index:a,jobId:i,savedSearchId:n}=Object(Tn.parse)(e.search,{sort:!1}),{context:s}=I(a,n,t.config,t.dataViewsContract,{...W(t),analyticsFields:()=>oc(a,n,t.dataViewsContract,"data-frame-analytics")});return Object(g.jsx)(T.b,{context:s},Object(g.jsx)($b,{jobId:i}))},Yb=()=>{var e,t;const[a,i]=Object(v.c)("_g"),r=null==a||null===(e=a.ml)||void 0===e?void 0:e.jobId,l=null==a||null===(t=a.ml)||void 0===t?void 0:t.modelId,[c,d]=Object(n.useState)(!1),[u,p]=Object(n.useState)(!r&&!l),[b,f]=Object(n.useState)(!0),{refresh:h}=Object(Bd.x)({isLoading:d}),j=Object(n.useCallback)((e=>{i({ml:{...e.job_id&&!e.model_id?{jobId:e.job_id}:{},...e.model_id?{modelId:e.model_id}:{}}})}),[i]),{services:{docLinks:x}}=Object(y.b)(),{dataFrameAnalytics:{getDataFrameAnalytics:O}}=Object(y.a)(),E=x.links.ml.dataFrameAnalytics;return Object(n.useEffect)((function(){(async()=>{try{const{count:e}=await O(void 0,void 0,0);f(e>0)}catch(e){console.error("Error checking analytics jobs exist",e)}})()}),[]),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Sm,{setIsIdSelectorFlyoutVisible:p,selectedId:null!=r?r:l}),u?Object(g.jsx)(Mm,{setAnalyticsId:j,setIsIdSelectorFlyoutVisible:p}):null,void 0===r&&void 0===l?Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{"data-test-subj":"mlPageDataFrameAnalyticsMapTitle",id:"xpack.ml.dataframe.analyticsMap.title",defaultMessage:"Map for Analytics"})):null,void 0!==r&&void 0===l?Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{"data-test-subj":"mlPageDataFrameAnalyticsMapTitle",id:"xpack.ml.dataframe.analyticsMap.analyticsIdTitle",defaultMessage:"Map for job ID {jobId}",values:{jobId:r}})):null,void 0!==l&&void 0===r?Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{"data-test-subj":"mlPageDataFrameAnalyticsMapTitle",id:"xpack.ml.dataframe.analyticsMap.modelIdTitle",defaultMessage:"Map for trained model ID {modelId}",values:{modelId:l}})):null,Object(g.jsx)(Xi.a,null),Object(g.jsx)(Ki.a,{onCloseFlyout:h}),Object(g.jsx)(Zi.a,null),r||l?Object(g.jsx)(ku,{key:`${null!=r?r:l}-id`,analyticsId:r,modelId:l,forceRefresh:c}):!1===b?Object(g.jsx)(iu.a,null):Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiEmptyPrompt,{iconType:"alert",title:Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.noJobSelectedLabel",defaultMessage:"No Analytics ID selected"})),"data-test-subj":"mlNoAnalyticsFound"})),Object(g.jsx)(sn.a,{docLink:E}))},Xb=(e,t)=>({path:"/data_frame_analytics/map",render:(e,t)=>Object(g.jsx)(Qb,_()({},e,{deps:t})),title:r.i18n.translate("xpack.ml.dataFrameAnalytics.analyticsMap.docTitle",{defaultMessage:"Analytics Map"}),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("DATA_FRAME_ANALYTICS_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.analyticsMapLabel",{defaultMessage:"Analytics Map"})}],enableDatePicker:!0,"data-test-subj":"mlPageAnalyticsMap"}),Qb=({deps:e})=>{const{context:t}=I(void 0,void 0,e.config,e.dataViewsContract,W(e));return Object(g.jsx)(T.b,{context:t},Object(g.jsx)(Yb,null))};var Kb=a(217);const Zb=()=>{const{services:{savedObjects:e,uiSettings:t}}=Object(y.b)(),a=Object(y.e)(),[i,l]=Object(n.useState)(!1),[c,d]=Object(n.useState)(),u=Object(Z.c)();return Object(g.jsx)("div",{"data-test-subj":"mlDFAPageSourceSelection"},Object(g.jsx)(o.EuiPageBody,{restrictWidth:1200},Object(g.jsx)(o.EuiPageContent_Deprecated,{hasShadow:!1,hasBorder:!0},i&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiCallOut,{"data-test-subj":"analyticsCreateSourceIndexModalCcsErrorCallOut",title:r.i18n.translate("xpack.ml.dataFrame.analytics.create.searchSelection.CcsErrorCallOutTitle",{defaultMessage:"Data views using cross-cluster search are not supported."}),color:"danger"},"string"==typeof c&&Object(g.jsx)("p",null,c)),Object(g.jsx)(o.EuiSpacer,{size:"m"})),Object(g.jsx)(bn.SavedObjectFinderUi,{key:"searchSavedObjectFinder",onChoose:async(e,t,i,n)=>{let s="";if("index-pattern"===t)s=Object(Kb.a)(n,"attributes.title");else if("search"===t)try{var o,c;s=null!==(o=null===(c=(await Object(C.b)(e)).dataView)||void 0===c?void 0:c.title)&&void 0!==o?o:""}catch(e){return void u.displayErrorToast(e,r.i18n.translate("xpack.ml.dataFrame.analytics.create.searchSelection.errorGettingDataViewTitle",{defaultMessage:"Error loading data view used by the saved search"}))}if(Object(C.g)(s))return l(!0),void d("search"===t?r.i18n.translate("xpack.ml.dataFrame.analytics.create.searchSelection.CcsErrorCallOutBody",{defaultMessage:"The saved search '{savedSearchTitle}' uses the data view '{dataViewName}'.",values:{savedSearchTitle:Object(Kb.a)(n,"attributes.title"),dataViewName:s}}):void 0);await a(`/data_frame_analytics/new_job?${"index-pattern"===t?"index":"savedSearchId"}=${encodeURIComponent(e)}`)},showFilter:!0,noItemsMessage:r.i18n.translate("xpack.ml.dataFrame.analytics.create.searchSelection.notFoundLabel",{defaultMessage:"No matching indices or saved searches found."}),savedObjectMetaData:[{type:"search",getIconForSavedObject:()=>"search",name:r.i18n.translate("xpack.ml.dataFrame.analytics.create.searchSelection.savedObjectType.search",{defaultMessage:"Saved search"})},{type:"index-pattern",getIconForSavedObject:()=>"indexPatternApp",name:r.i18n.translate("xpack.ml.dataFrame.analytics.create.searchSelection.savedObjectType.indexPattern",{defaultMessage:"Data view"}),defaultSearchField:"name"}],fixedPageSize:20,uiSettings:t,savedObjects:e}))))},ef=()=>{const{services:{docLinks:e}}=Object(y.b)(),t=e.links.ml.dataFrameAnalytics;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.dataframe.analyticsSourceSelection.title",defaultMessage:"New analytics job / Choose a source data view"})),Object(g.jsx)(Zb,null),Object(g.jsx)(sn.a,{docLink:t}))},tf=(e,t)=>({path:"/data_frame_analytics/source_selection",render:(e,t)=>Object(g.jsx)(af,_()({},e,{deps:t})),title:r.i18n.translate("xpack.ml.dataFrameAnalytics.sourceSelection.docTitle",{defaultMessage:"Source Selection"}),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("DATA_FRAME_ANALYTICS_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.dataFrameSourceSelectionLabel",{defaultMessage:"Source Selection"})}]}),af=({deps:e})=>{const{context:t}=I(void 0,void 0,e.config,e.dataViewsContract,W(e));return Object(g.jsx)(T.b,{context:t},Object(g.jsx)(ef,null))};var nf=a(66);const sf=()=>Object(g.jsx)(o.EuiBetaBadge,{label:r.i18n.translate("xpack.ml.navMenu.trainedModelsTabBetaLabel",{defaultMessage:"Technical preview"}),size:"m",color:"hollow",tooltipContent:r.i18n.translate("xpack.ml.navMenu.trainedModelsTabBetaTooltipContent",{defaultMessage:"This functionality is in technical preview and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but features in technical preview are not subject to the support SLA of official GA features."}),tooltipPosition:"right"}),of=()=>{const{services:e}=Object(y.b)(),t=Object(Cn.b)(),a=t.currentDataView,i=t.currentSavedSearch;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(o.EuiFlexGroup,{responsive:!1,wrap:!1,alignItems:"center",gutterSize:"m"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explainLogRateSpikes.pageHeader",defaultMessage:"Explain log rate spikes"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(sf,null)))),a&&Object(g.jsx)(nf.ExplainLogRateSpikes,{dataView:a,savedSearch:i,appDependencies:Object(Q.pick)(e,["application","data","charts","fieldFormats","http","notifications","share","storage","uiSettings","unifiedSearch","theme","lens"])}),Object(g.jsx)(sn.a,{docLink:e.docLinks.links.ml.guide}))},rf=(e,t)=>({id:"explain_log_rate_spikes",path:"/aiops/explain_log_rate_spikes",title:r.i18n.translate("xpack.ml.aiops.explainLogRateSpikes.docTitle",{defaultMessage:"Explain log rate spikes"}),render:(e,t)=>Object(g.jsx)(lf,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("AIOPS_BREADCRUMB_EXPLAIN_LOG_RATE_SPIKES",e,t),{text:r.i18n.translate("xpack.ml.aiopsBreadcrumbs.explainLogRateSpikesLabel",{defaultMessage:"Explain log rate spikes"})}],disabled:!p.AIOPS_ENABLED}),lf=({location:e,deps:t})=>{const{redirectToMlAccessDeniedPage:a}=t,{index:i,savedSearchId:n}=Object(Tn.parse)(e.search,{sort:!1}),{context:s}=I(i,n,t.config,t.dataViewsContract,{checkBasicLicense:O.a,cacheDataViewsContract:()=>Object(C.a)(t.dataViewsContract),checkGetJobsCapabilities:()=>Object(w.c)(a)});return Object(g.jsx)(T.b,{context:s},Object(g.jsx)(of,null))},cf=()=>{const{services:e}=Object(y.b)(),t=Object(Cn.b)(),a=t.currentDataView,i=t.currentSavedSearch;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(o.EuiFlexGroup,{responsive:!1,wrap:!1,alignItems:"center",gutterSize:"m"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.logCategorization.pageHeader",defaultMessage:"Log pattern analysis"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(sf,null)))),a&&Object(g.jsx)(nf.LogCategorization,{dataView:a,savedSearch:i,appDependencies:Object(Q.pick)(e,["application","data","charts","fieldFormats","http","notifications","share","storage","uiSettings","unifiedSearch","theme","lens"])}),Object(g.jsx)(sn.a,{docLink:e.docLinks.links.ml.guide}))},df=(e,t)=>({id:"log_categorization",path:"/aiops/log_categorization",title:r.i18n.translate("xpack.ml.aiops.logCategorization.docTitle",{defaultMessage:"Log Pattern Analysis"}),render:(e,t)=>Object(g.jsx)(uf,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("AIOPS_BREADCRUMB_LOG_PATTERN_ANALYSIS",e,t),{text:r.i18n.translate("xpack.ml.aiops.logCategorization.docTitle",{defaultMessage:"Log Pattern Analysis"})}],disabled:!p.AIOPS_ENABLED}),uf=({location:e,deps:t})=>{const{redirectToMlAccessDeniedPage:a}=t,{index:i,savedSearchId:n}=Object(Tn.parse)(e.search,{sort:!1}),{context:s}=I(i,n,t.config,t.dataViewsContract,{checkBasicLicense:O.a,cacheDataViewsContract:()=>Object(C.a)(t.dataViewsContract),checkGetJobsCapabilities:()=>Object(w.c)(a)});return Object(g.jsx)(T.b,{context:s},Object(g.jsx)(cf,null))},pf=()=>{const{services:e}=Object(y.b)(),t=Object(Cn.b)(),a=t.currentDataView,i=t.currentSavedSearch;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(on.a,null,Object(g.jsx)(o.EuiFlexGroup,{responsive:!1,wrap:!1,alignItems:"center",gutterSize:"m"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.changePointDetection.pageHeader",defaultMessage:"Change point detection"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(sf,null)))),a?Object(g.jsx)(nf.ChangePointDetection,{dataView:a,savedSearch:i,appDependencies:Object(Q.pick)(e,["application","data","charts","fieldFormats","http","notifications","share","storage","uiSettings","unifiedSearch","theme","lens"])}):null,Object(g.jsx)(sn.a,{docLink:e.docLinks.links.ml.guide}))},mf=(e,t)=>({id:"change_point_detection",path:"/aiops/change_point_detection",title:r.i18n.translate("xpack.ml.aiops.changePointDetection.docTitle",{defaultMessage:"Change point detection"}),render:(e,t)=>Object(g.jsx)(bf,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("AIOPS_BREADCRUMB_CHANGE_POINT_DETECTION",e,t),{text:r.i18n.translate("xpack.ml.aiopsBreadcrumbs.changePointDetectionLabel",{defaultMessage:"Change point detection"})}],disabled:!p.CHANGE_POINT_DETECTION_ENABLED}),bf=({location:e,deps:t})=>{const{index:a,savedSearchId:i}=Object(Tn.parse)(e.search,{sort:!1}),{context:n}=I(a,i,t.config,t.dataViewsContract,{checkBasicLicense:O.a,cacheDataViewsContract:()=>Object(C.a)(t.dataViewsContract)});return Object(g.jsx)(T.b,{context:n},Object(g.jsx)(pf,null))};var ff=a(597),hf=a.n(ff);function gf(e){const t=e.analysis_config.detectors,a=[];return t.forEach(((t,i)=>{Object(Qe.p)(e,i)&&a.push({index:i,detector_description:t.detector_description,function:t.function})})),a}const jf=()=>Object(g.jsx)(dm,{anchorPosition:"upCenter",title:r.i18n.translate("xpack.ml.timeSeriesExplorer.popoverTitle",{defaultMessage:"Single time series analysis"})},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.popoverBasicExplanation",defaultMessage:"This chart illustrates the actual data values over time for a specific detector. You can examine an event by sliding the time selector and changing its length. For the most accurate view, set the zoom size to auto."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.popoverAnomalyExplanation",defaultMessage:"An anomaly score is calculated for each bucket time interval, with a value from 0 to 100. Anomalous events are highlighted in colors that indicate their severity. If an anomaly is depicted with a cross symbol instead of a dot, it has a medium or high multi-bucket impact. This extra analysis can catch anomalies even when they fall within the bounds of expected behavior."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.popoverForecastExplanation",defaultMessage:"If you create a forecast, predicted data values are added to the chart. A shaded area around these values represents the confidence level; as you forecast further into the future, the confidence level generally decreases."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.popoverAnnotationsExplanation",defaultMessage:"You can also optionally annotate your job results by drag-selecting a period of time in the chart and adding a description. Some annotations are generated automatically to indicate noteworthy occurrences."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.popoverModelPlotExplanation",defaultMessage:"If model plot is enabled, you can optionally show model bounds, which are represented by a shaded area in the chart. As the job analyzes more data, it learns to more closely predict the expected patterns of behavior."})));var xf=a(216);function vf({actual:e,typical:t}){const{iconType:a,message:i}=Object(xf.a)(e,t);return Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},void 0!==a&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIcon,{type:a,size:"s"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs"},i)))}function yf({detectorDescription:e,numberOfRules:t}){let a;return void 0!==t&&t>0&&(a=Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.detectorCell.rulesConfiguredTooltip",defaultMessage:"rules have been configured for this detector"})},Object(g.jsx)(o.EuiIcon,{type:"controlsHorizontal",className:"detector-rules-icon"}))),Object(g.jsx)(s.a.Fragment,null,e,a)}var Of=a(185);function Ef({entityName:e,entityValue:t,filter:a}){if(void 0!==a)return Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.entityCell.addFilterTooltip",defaultMessage:"Add filter"})},Object(g.jsx)(o.EuiButtonIcon,{size:"s","data-test-subj":`mlAnomaliesTableEntityCellAddFilterButton-${t}`,className:"filter-button",onClick:Object(la.a)((()=>{a(e,t,pt.a.ADD)})),iconType:"plusInCircle","aria-label":r.i18n.translate("xpack.ml.anomaliesTable.entityCell.addFilterAriaLabel",{defaultMessage:"Add filter"})}))}function wf({entityName:e,entityValue:t,filter:a}){if(void 0!==a)return Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.entityCell.removeFilterTooltip",defaultMessage:"Remove filter"})},Object(g.jsx)(o.EuiButtonIcon,{size:"s","data-test-subj":`mlAnomaliesTableEntityCellRemoveFilterButton-${t}`,className:"filter-button",onClick:Object(la.a)((()=>{a(e,t,pt.a.REMOVE)})),iconType:"minusInCircle","aria-label":r.i18n.translate("xpack.ml.anomaliesTable.entityCell.removeFilterAriaLabel",{defaultMessage:"Remove filter"})}))}const Mf=({entityName:e,entityValue:t,filter:a,wrapText:i=!1})=>{let n=""===t?Object(g.jsx)("i",null,Of.a):t;e===Ft.b&&(n=`${Ft.b} ${n}`);const r=i?"field-value-long":"field-value-short",l=void 0!==a&&void 0!==e&&void 0!==t;return!0===i?Object(g.jsx)("div",null,Object(g.jsx)("span",{className:r},n),l&&Object(g.jsx)(s.a.Fragment,null,Ef({entityName:e,entityValue:t,filter:a}),wf({entityName:e,entityValue:t,filter:a}))):Object(g.jsx)(o.EuiFlexGroup,{direction:"row",alignItems:"center",gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{maxWidth:"100%"}},Object(g.jsx)(o.EuiText,{size:"xs",className:r},n)),l&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFlexGroup,{direction:"row",alignItems:"center",gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Ef({entityName:e,entityValue:t,filter:a})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},wf({entityName:e,entityValue:t,filter:a})))))};class influencers_cell_InfluencersCell extends n.Component{constructor(e){super(e),this.state={showAll:!1}}toggleAllInfluencers(){this.setState({showAll:!this.state.showAll})}renderInfluencers(e){const t=!1===this.state.showAll?this.props.limit:e.length,a=e.slice(0,t),{influencerFilter:i}=this.props;let n=Math.max(e.length-t,0);1===n&&(a.push(e[this.props.limit]),n=0);const l=a.map(((e,t)=>Object(g.jsx)("div",{key:t},e.influencerFieldName,": ",e.influencerFieldValue,void 0!==i&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.influencersCell.addFilterTooltip",defaultMessage:"Add filter"})},Object(g.jsx)(o.EuiButtonIcon,{size:"s",className:"filter-button",onClick:Object(la.a)((()=>{i(e.influencerFieldName,e.influencerFieldValue,"+")})),iconType:"plusInCircle","aria-label":r.i18n.translate("xpack.ml.anomaliesTable.influencersCell.addFilterAriaLabel",{defaultMessage:"Add filter"})})),Object(g.jsx)(o.EuiToolTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.influencersCell.removeFilterTooltip",defaultMessage:"Remove filter"})},Object(g.jsx)(o.EuiButtonIcon,{size:"s",className:"filter-button",onClick:Object(la.a)((()=>{i(e.influencerFieldName,e.influencerFieldValue,"-")})),iconType:"minusInCircle","aria-label":r.i18n.translate("xpack.ml.anomaliesTable.influencersCell.removeFilterAriaLabel",{defaultMessage:"Remove filter"})}))))));return Object(g.jsx)(s.a.Fragment,null,l,this.renderOthers(e.length,n))}renderOthers(e,t){return t>0?Object(g.jsx)("div",null,Object(g.jsx)(o.EuiLink,{onClick:()=>this.toggleAllInfluencers()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.influencersCell.moreInfluencersLinkText",defaultMessage:"and {othersCount} more",values:{othersCount:t}}))):e>this.props.limit+1?Object(g.jsx)("div",null,Object(g.jsx)(o.EuiLink,{onClick:()=>this.toggleAllInfluencers()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.influencersCell.showLessInfluencersLinkText",defaultMessage:"show less"}))):void 0}render(){const e=this.props.influencers||[],t=[];return e.forEach((e=>{Object(Q.each)(e,((e,a)=>{t.push({influencerFieldName:a,influencerFieldValue:e})}))})),Object(g.jsx)("div",null,this.renderInfluencers(t),this.renderOthers(t))}}var Sf=a(52),_f=a(263),Tf=a(67),Cf=a(163);const kf=e=>{const[t,a]=Object(n.useState)(),[i,s]=Object(n.useState)(),l=Object(pt.m)(e.anomaly),c=e.onItemClick,d=Object(y.b)(),{services:{data:u,share:p,application:b}}=d,f=Object(n.useMemo)((()=>K.a.getJob(e.anomaly.jobId)),[e.anomaly.jobId]);Object(n.useEffect)((()=>{let t=!1;const i=p.url.locators.get("DISCOVER_APP_LOCATOR");if(!i){const e=r.i18n.translate("xpack.ml.anomaliesTable.linksMenu.discoverLocatorMissingErrorMessage",{defaultMessage:"No locator for Discover detected"});return void(t||s(e))}const n=async()=>{const e=f.datafeed_config.indices[0],a=await Object(C.d)(e);if(!a&&!t){const t=r.i18n.translate("xpack.ml.anomaliesTable.linksMenu.autoGeneratedDiscoverLinkErrorMessage",{defaultMessage:"Unable to link to Discover; no data view exists for index '{index}'",values:{index:e}});s(t)}return a};return l?n():(async()=>{const s=e.interval,o=await n(),r=e.anomaly.source,l=Oe()(r.timestamp).startOf(s);"hour"===s&&l.subtract(1,"h");let c=Oe()(r.timestamp).add(r.bucket_span,"s");!0===e.isAggregatedData&&(c=Oe()(r.timestamp).endOf(s),"hour"===s&&c.add(1,"h"));const d=Object(Je.e)(1e3*l.unix()),u=Object(Je.e)(1e3*c.unix());let p="";r.influencers&&(p=r.influencers.map((e=>{var t;return`"${e.influencer_field_name}":"${null!==(t=e.influencer_field_values[0])&&void 0!==t?t:""}"`})).join(" AND "));const m=await i.getRedirectUrl({indexPatternId:o,timeRange:{from:d,to:u,mode:"absolute"},query:{language:"kuery",query:p},filters:null===o?[]:Object(Qe.h)(f.datafeed_config.query,o,f.job_id)});t||a(m)})(),()=>{t=!0}}),[JSON.stringify(e.anomaly)]);const h=async()=>{const t=p.url.locators.get(E.a),a=e.anomaly.source,i=e.bounds;if(!t)return void console.error("Unable to detect locator for ML or bounds");if(!i||!i.min||!i.max)return void console.error("Invalid bounds");const n=i.min.toISOString(),s=i.max.toISOString(),o=Oe()(a.timestamp),r=o.subtract(50*a.bucket_span,"s").toISOString(),l=o.add(100*a.bucket_span,"s").toISOString(),c={};void 0!==a.partition_field_name&&void 0!==a.partition_field_value&&(c[a.partition_field_name]=a.partition_field_value),void 0!==a.over_field_name&&void 0!==a.over_field_value&&(c[a.over_field_name]=a.over_field_value),void 0!==a.by_field_name&&void 0!==a.by_field_value&&(c[a.by_field_name]=a.by_field_value);const d=await t.getUrl({page:E.b.SINGLE_METRIC_VIEWER,pageState:{jobIds:[a.job_id],refreshInterval:{display:"Off",pause:!0,value:0},timeRange:{from:n,to:s,mode:"absolute"},zoom:{from:r,to:l},detectorIndex:a.detector_index,entities:c,query_string:{analyze_wildcard:!0,query:"*"}}},{absolute:!0});window.open(d,"_blank")},j=()=>{const t=e.anomaly.entityValue,a=e.anomaly.source;if(void 0===f){console.log(`viewExamples(): no job found with ID: ${e.anomaly.jobId}`);const{toasts:t}=d.services.notifications;return void t.addDanger(r.i18n.translate("xpack.ml.anomaliesTable.linksMenu.unableToViewExamplesErrorMessage",{defaultMessage:"Unable to view examples as no details could be found for job ID {jobId}",values:{jobId:e.anomaly.jobId}}))}const i=f.analysis_config.categorization_field_name,n=f.datafeed_config.indices;let s=0;!function e(l){(function(e,t){return new Promise(((a,i)=>{""!==e?X.ml.getFieldCaps({index:e,fields:[t]}).then((e=>{let t="";Object(Q.each)(e.fields,(e=>{Object(Q.each)(e,(e=>{""===t&&(t=e.type)}))})),a(t)})).catch((e=>{i(e)})):i()}))})(l,i).then((l=>{""!==l?((e,n)=>{X.ml.results.getCategoryDefinition(a.job_id,t).then((async t=>{const s=await Object(C.d)(e);if(!s)return;let o=null;if(n===_f.ES_FIELD_TYPES.KEYWORD)t.regex&&(o={language:nt.c.LUCENE,query:`${i}:/${t.regex}/`});else if(t.terms){const e=Object(xp.b)(t.terms);o={language:nt.c.KUERY,query:`${i}:"`+e.split(" ").join(`" and ${i}:"`)+'"'}}const r=Oe()(a.timestamp),l=r.toISOString(),c=r.add(a.bucket_span,"s").toISOString(),u=Za.a.encode({refreshInterval:{display:"Off",pause:!0,value:0},time:{from:l,to:c,mode:"absolute"}}),p={index:s,filters:Object(Qe.h)(f.datafeed_config.query,s,f.job_id)};null!==o&&(p.query=o);const m=Za.a.encode(p),{basePath:b}=d.services.http;let h=b.get();h+="/app/discover#/",h+="?_g="+u,h+="&_a="+encodeURIComponent(m),window.open(h,"_blank")})).catch((e=>{console.log("viewExamples(): error loading categoryDefinition:",e);const{toasts:a}=d.services.notifications;a.addDanger(r.i18n.translate("xpack.ml.anomaliesTable.linksMenu.loadingDetailsErrorMessage",{defaultMessage:"Unable to view examples as an error occurred loading details on category ID {categoryId}",values:{categoryId:t}}))}))})(n.join(),l):(s++,s<n.length?e(n[s]):o())})).catch((()=>{o()}))}(n[s]);const o=()=>{console.log(`viewExamples(): error finding type of field ${i} in indices:`,n);const{toasts:e}=d.services.notifications;e.addDanger(r.i18n.translate("xpack.ml.anomaliesTable.linksMenu.noMappingCouldBeFoundErrorMessage",{defaultMessage:"Unable to view examples of documents with mlcategory {categoryId} as no mapping could be found for the categorization field {categorizationFieldName}",values:{categoryId:t,categorizationFieldName:i}}))}},{anomaly:x,showViewSeriesLink:v}=e,O=Object(pt.n)(x.source)&&Object(w.e)("canUpdateJob"),M=Object(n.useMemo)((()=>{var a,n,s;const y=[];if(void 0!==x.customUrls&&x.customUrls.forEach(((t,a)=>{y.push(Object(g.jsx)(o.EuiContextMenuItem,{key:`custom_url_${a}`,icon:"popout",onClick:()=>{c(),(t=>{const{anomaly:a,interval:i,isAggregatedData:n}=e;console.log("Anomalies Table - open customUrl for record:",a);const s=Object(Q.cloneDeep)(a.source),o=s.timestamp,l=t.url_value,c=void 0!==t.time_range?Object(se.a)(t.time_range):null,u=d.services.http.basePath.get();if(l.includes("$earliest$")){let e=Oe()(o);null!==c?e.subtract(c):(e=Oe()(o).startOf(i),"hour"===i&&e.subtract(1,"h")),s.earliest=e.toISOString()}if(l.includes("$latest$")){let e=Oe()(o).add(s.bucket_span,"s");null!==c?e.add(c):!0===n&&(e=Oe()(o).endOf(i),"hour"===i&&e.add(1,"h")),s.latest=e.toISOString()}if((l.includes("$mlcategoryterms$")||l.includes("$mlcategoryregex$"))&&void 0!==s.mlcategory){const e=s.job_id,a=s.mlcategory[0];X.ml.results.getCategoryDefinition(e,a).then((e=>{const a=e.terms.split(" ").map((e=>`+${e}`));s.mlcategoryterms=a.join(" "),s.mlcategoryregex=e.regex,ai(Object(te.f)(t.url_value,s,!0),t,u)})).catch((e=>{console.log("openCustomUrl(): error loading categoryDefinition:",e);const{toasts:t}=d.services.notifications;t.addDanger(r.i18n.translate("xpack.ml.anomaliesTable.linksMenu.unableToOpenLinkErrorMessage",{defaultMessage:"Unable to open link as an error occurred loading details on category ID {categoryId}",values:{categoryId:a}}))}))}else ai(ti(t,s),t,u)})(t)},"data-test-subj":`mlAnomaliesListRowActionCustomUrlButton_${a}`},t.url_name))})),null!==(a=b.capabilities.discover)&&void 0!==a&&a.show&&!l){const e=void 0===i&&void 0===t;y.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"auto_raw_data_url",icon:"discoverApp",disabled:void 0!==i||e,href:t,"data-test-subj":"mlAnomaliesListRowAction_viewInDiscoverButton"},i?Object(g.jsx)(o.EuiToolTip,{content:i},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewInDiscover",defaultMessage:"View in Discover"})):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewInDiscover",defaultMessage:"View in Discover"}),e?Object(g.jsx)(o.EuiProgress,{size:"xs",color:"accent"}):null))}return!0===v&&x.isTimeSeriesViewRecord&&y.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"view_series",icon:"visLine",onClick:()=>{c(),h()},"data-test-subj":"mlAnomaliesListRowActionViewSeriesButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewSeriesLabel",defaultMessage:"View series"}))),null!==(n=b.capabilities.maps)&&void 0!==n&&n.show&&(!0===x.isGeoRecord?y.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"view_in_maps",icon:"gisApp",onClick:async()=>{const e=await(async e=>{const t=f.datafeed_config.indices[0],a=await Object(C.d)(t),i=Object(Cf.c)(e.jobId),n=Oe()(e.source.timestamp).tz(Object(xp.e)()),s=n.toISOString(),o=n.add(e.source.bucket_span,"seconds").subtract(1,"ms").toISOString(),r=u.query.timefilter.timefilter.getTime();r.from=s,r.to=o;const l=p.url.locators.get(Tf.MAPS_APP_LOCATOR);return await(null==l?void 0:l.getLocation({initialLayers:i,timeRange:r,...e.entityName&&e.entityValue?{query:{language:nt.c.KUERY,query:Object(te.d)(e.entityName,e.entityValue)}}:{},filters:null===a?[]:Object(Qe.h)(f.datafeed_config.query,a,f.job_id)}))})(x);await b.navigateToApp(Sf.APP_ID,{path:null==e?void 0:e.path})},"data-test-subj":"mlAnomaliesListRowActionViewInMapsButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewInMapsLabel",defaultMessage:"View in Maps"}))):e.sourceIndicesWithGeoFields&&e.sourceIndicesWithGeoFields[x.jobId]&&y.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"view_in_maps",icon:"gisApp",onClick:async()=>{const t=await(async(e,t)=>{const a=f.datafeed_config.indices[0],i=await Object(C.d)(a),n=Object(Cf.d)(t[e.jobId]),s=Oe()(e.source.timestamp).tz(Object(xp.e)()),o=s.subtract(e.source.bucket_span,"seconds").toISOString(),r=s.add(3*e.source.bucket_span,"seconds").subtract(1,"ms").toISOString(),l=u.query.timefilter.timefilter.getTime();l.from=o,l.to=r;const c=function(e=[],t){return e.reduce(((e,a)=>(Object.entries(a).filter((([e])=>e!==t)).forEach((([t,a])=>e.push(`${t}: ${a}`))),e)),[]).join(" or ")}(e.influencers,e.entityName),d=p.url.locators.get(Tf.MAPS_APP_LOCATOR),m=null===i?[]:Object(Qe.h)(f.datafeed_config.query,i,f.job_id);return await(null==d?void 0:d.getLocation({initialLayers:n,timeRange:l,filters:m.length>0?m:u.query.filterManager.getFilters(),...e.entityName&&e.entityValue?{query:{language:nt.c.KUERY,query:`${Object(te.d)(e.entityName,e.entityValue)}${""!==c?` and (${c})`:""}`}}:{}}))})(x,e.sourceIndicesWithGeoFields);await b.navigateToApp(Sf.APP_ID,{path:null==t?void 0:t.path})},"data-test-subj":"mlAnomaliesListRowActionViewSourceIndexInMapsButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewSourceIndexInMapsLabel",defaultMessage:"View source index in Maps"})))),null!==(s=b.capabilities.discover)&&void 0!==s&&s.show&&l&&y.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"view_examples",icon:"popout",onClick:()=>{c(),j()},"data-test-subj":"mlAnomaliesListRowActionViewExamplesButton",disabled:void 0!==i},void 0!==i?Object(g.jsx)(o.EuiToolTip,{content:i},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewExamplesLabel",defaultMessage:"View examples"})):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewExamplesLabel",defaultMessage:"View examples"}))),O&&y.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"create_rule",icon:"controlsHorizontal",onClick:()=>{c(),e.showRuleEditorFlyout(x)},"data-test-subj":"mlAnomaliesListRowActionConfigureRulesButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.configureRulesLabel",defaultMessage:"Configure job rules"}))),y}),[t,i,j,h,O,l]);return Object(g.jsx)(o.EuiContextMenuPanel,{items:M,"data-test-subj":"mlAnomaliesListRowActionsMenu"})},Ff=e=>{const[t,a]=Object(n.useState)(!1),i=a.bind(null,!t),s=a.bind(null,!1),l=Object(g.jsx)(o.EuiButtonIcon,{size:"s",color:"text",onClick:i,iconType:"gear","aria-label":r.i18n.translate("xpack.ml.anomaliesTable.linksMenu.selectActionAriaLabel",{defaultMessage:"Select action for anomaly at {time}",values:{time:Object(Je.d)(e.anomaly.time)}}),"data-test-subj":"mlAnomaliesListRowActionsButton"});return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiPopover,{button:l,isOpen:t,closePopover:s,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(g.jsx)(kf,_()({},e,{onItemClick:s}))))};var If=a(144),Df=a(139);const Af=500;var Lf=a(15);const Rf=Object(n.memo)((({score:e,multiBucketImpact:t})=>{const a=Object(pt.g)(e),i=Object(pt.j)(e);return t>=Lf.a.MEDIUM?Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("svg",{width:"16",height:"16",viewBox:"-2 -2 20 20",fill:i},Object(g.jsx)("path",{d:"M-6.708203932499369,-2.23606797749979H-2.23606797749979V-6.708203932499369H2.23606797749979V-2.23606797749979H6.708203932499369V2.23606797749979H2.23606797749979V6.708203932499369H-2.23606797749979V2.23606797749979H-6.708203932499369Z",transform:"translate(8,8)"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},a)):Object(g.jsx)(o.EuiHealth,{color:i},a)}));function Nf(e,t,a){return Object(pt.n)(e.source)&&Object(w.e)("canUpdateJob")||t&&e.isTimeSeriesViewRecord||"mlcategory"===e.entityName||void 0!==e.customUrls||e.detector.includes(xt.b.LAT_LONG)||e.sourceIndices&&e.sourceIndices((t=>void 0!==a[e.jobId][t]))}function Pf(e,t,a){return Object(g.jsx)(Mf,{entityName:e,entityValue:t,filter:a})}var zf={name:"educr3",styles:"width:180px"};const Bf=({anomaly:e,filter:t,modelPlotEnabled:a})=>{const i=e.source;let n=[];const l=i.causes||[];let c,d;1===l.length?void 0!==l[0].by_field_name&&(c=l[0].by_field_name,d=l[0].by_field_value):n=l.map((e=>({typical:e.typical,actual:e.actual,probability:e.probability,entityName:e.by_field_name?e.by_field_name:e.over_field_name,entityValue:e.by_field_value?e.by_field_value:e.over_field_value})));const u=[];void 0!==i.partition_field_value&&void 0!==i.partition_field_name&&u.push({title:i.partition_field_name,description:Pf(i.partition_field_name,String(i.partition_field_value),t)}),void 0!==i.by_field_value&&void 0!==i.by_field_name&&u.push({title:i.by_field_name,description:Pf(i.by_field_name,i.by_field_value,t)}),void 0!==c&&void 0!==d&&u.push({title:c,description:Pf(c,d,t)}),void 0!==i.over_field_value&&void 0!==i.over_field_name&&u.push({title:i.over_field_name,description:Pf(i.over_field_name,i.over_field_value,t)});const p=i.timestamp;let m=`${Object(Je.d)(p)}`;if(void 0!==i.bucket_span){const e=p+1e3*i.bucket_span;m=r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyTimeRangeLabel",{defaultMessage:"{anomalyTime} to {anomalyEndTime}",values:{anomalyTime:Object(Je.d)(p),anomalyEndTime:Object(Je.d)(e)}})}u.push({title:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.timeTitle",{defaultMessage:"Time"}),description:m}),u.push({title:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.functionTitle",{defaultMessage:"Function"}),description:i.function!==xt.b.METRIC?i.function:i.function_description}),void 0!==i.field_name&&u.push({title:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.fieldNameTitle",{defaultMessage:"Field name"}),description:i.field_name});const b=i.function_description||"";var f,h,j,x;return void 0!==e.actual&&!0===Object(pt.o)(b)&&u.push({title:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.actualTitle",{defaultMessage:"Actual"}),description:Object(Df.b)(e.actual,i.function,void 0,i)}),void 0!==e.typical&&!0===Object(pt.p)(b)&&(u.push({title:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.typicalTitle",{defaultMessage:"Typical"}),description:Object(Df.b)(e.typical,i.function,void 0,i)}),!1===a&&void 0!==(null===(f=e.source.anomaly_score_explanation)||void 0===f?void 0:f.lower_confidence_bound)&&void 0!==(null===(h=e.source.anomaly_score_explanation)||void 0===h?void 0:h.upper_confidence_bound)&&(u.push({title:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.upperBoundsTitle",{defaultMessage:"Upper bound"}),description:Object(Df.b)(null===(j=e.source.anomaly_score_explanation)||void 0===j?void 0:j.upper_confidence_bound,i.function,void 0,i)}),u.push({title:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.lowerBoundsTitle",{defaultMessage:"Lower bound"}),description:Object(Df.b)(null===(x=e.source.anomaly_score_explanation)||void 0===x?void 0:x.lower_confidence_bound,i.function,void 0,i)}))),u.push({title:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.jobIdTitle",{defaultMessage:"Job ID"}),description:e.jobId}),u.push({title:Object(g.jsx)(o.EuiToolTip,{position:"left",content:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.recordScoreTooltip",{defaultMessage:"A normalized score between 0-100, which indicates the relative significance of the anomaly record result. This value might change as new data is analyzed."})},Object(g.jsx)("span",null,r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.recordScoreTitle",{defaultMessage:"Record score"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),description:Math.floor(1e3*i.record_score)/1e3}),u.push({title:Object(g.jsx)(o.EuiToolTip,{position:"left",content:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.initialRecordScoreTooltip",{defaultMessage:"A normalized score between 0-100, which indicates the relative significance of the anomaly record when the bucket was initially processed."})},Object(g.jsx)("span",null,r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.initialRecordScoreTitle",{defaultMessage:"Initial record score"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),description:Math.floor(1e3*i.initial_record_score)/1e3}),u.push({title:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.probabilityTitle",{defaultMessage:"Probability"}),description:void 0!==i.probability?Number.parseFloat(i.probability).toPrecision(3):""}),n.length>1&&n.forEach(((e,t)=>{const a=0===t?r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.causeValuesTitle",{defaultMessage:"{causeEntityName} values",values:{causeEntityName:e.entityName}}):"",n=r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.causeValuesDescription",{defaultMessage:"{causeEntityValue} (actual {actualValue}, typical {typicalValue}, probability {probabilityValue})",values:{causeEntityValue:e.entityValue,actualValue:Object(Df.b)(e.actual,i.function),typicalValue:Object(Df.b)(e.typical,i.function),probabilityValue:e.probability}});u.push({title:a,description:n})})),Object(g.jsx)(s.a.Fragment,null,u.map((({title:e,description:t})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{css:zf,grow:!1},e),Object(g.jsx)(o.EuiFlexItem,null,t)),Object(g.jsx)(o.EuiSpacer,{size:"xs"})))))};var Vf={name:"1v1nmsf",styles:"width:220px"};const Jf=({anomaly:e})=>{const t=e.source.anomaly_score_explanation;if(void 0===t)return null;const a=Math.floor(1e3*e.source.initial_record_score)/1e3,i=Math.floor(1e3*e.source.record_score)/1e3,n=a-i,l=r.i18n.translate("xpack.ml.anomaliesTable.anomalyExplanationDetails.yes",{defaultMessage:"Yes"}),c=r.i18n.translate("xpack.ml.anomaliesTable.anomalyExplanationDetails.no",{defaultMessage:"No"}),d=[],u=function(e){if(void 0===e||void 0===e.anomaly_length||void 0===e.anomaly_type)return null;const t=r.i18n.translate("xpack.ml.anomaliesTable.anomalyExplanationDetails.anomalyType.dip",{defaultMessage:"Dip over {anomalyLength, plural, one {# bucket} other {# buckets}}",values:{anomalyLength:e.anomaly_length}}),a=r.i18n.translate("xpack.ml.anomaliesTable.anomalyExplanationDetails.anomalyType.spike",{defaultMessage:"Spike over {anomalyLength, plural, one {# bucket} other {# buckets}}",values:{anomalyLength:e.anomaly_length}});return"dip"===e.anomaly_type?t:a}(t);null!==u&&d.push({title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyType",defaultMessage:"Anomaly type"}),description:Object(g.jsx)(s.a.Fragment,null,u)}),n>10&&d.push({title:Object(g.jsx)(o.EuiToolTip,{position:"left",content:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.recordScoreTooltip",{defaultMessage:"The initial record score has been reduced based on the analysis of subsequent data."})},Object(g.jsx)("span",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.recordScore",defaultMessage:"Record score reduction"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),description:Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Gf,{score:a})),Object(g.jsx)(o.EuiFlexItem,{grow:!1}," -> "),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Gf,{score:i})))});const p=[];return void 0!==t.anomaly_characteristics_impact&&p.push({title:Object(g.jsx)(o.EuiToolTip,{position:"left",content:Wf(t.anomaly_characteristics_impact,"anomaly_characteristics")},Object(g.jsx)("span",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyCharacteristics",defaultMessage:"Anomaly characteristics impact"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),description:Object(g.jsx)(Hf,{score:t.anomaly_characteristics_impact})}),void 0!==t.single_bucket_impact&&p.push({title:Object(g.jsx)(o.EuiToolTip,{position:"left",content:Wf(t.single_bucket_impact,"single_bucket")},Object(g.jsx)("span",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.singleBucket",defaultMessage:"Single bucket impact"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),description:Object(g.jsx)(Hf,{score:t.single_bucket_impact})}),void 0!==t.multi_bucket_impact&&p.push({title:Object(g.jsx)(o.EuiToolTip,{position:"left",content:Wf(t.multi_bucket_impact,"multi_bucket")},Object(g.jsx)("span",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multiBucket",defaultMessage:"Multi bucket impact"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),description:Object(g.jsx)(Hf,{score:t.multi_bucket_impact})}),void 0!==t.high_variance_penalty&&p.push({title:Object(g.jsx)(o.EuiToolTip,{position:"left",content:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.highVarianceTooltip",{defaultMessage:"Indicates reduction of anomaly score for the bucket with large confidence intervals. If a bucket has large confidence intervals, the score is reduced."})},Object(g.jsx)("span",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.highVariance",defaultMessage:"High variance interval"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),description:t.high_variance_penalty?l:c}),void 0!==t.incomplete_bucket_penalty&&p.push({title:Object(g.jsx)(o.EuiToolTip,{position:"left",content:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.incompleteBucketTooltip",{defaultMessage:"If the bucket contains fewer samples than expected, the score is reduced."})},Object(g.jsx)("span",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.incompleteBucket",defaultMessage:"Incomplete bucket"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),description:t.incomplete_bucket_penalty?l:c}),Object(g.jsx)("div",null,Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationTitle",defaultMessage:"Anomaly explanation"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),d.map((({title:e,description:t})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{style:{width:"220px"},grow:!1},e),Object(g.jsx)(o.EuiFlexItem,null,t)),Object(g.jsx)(o.EuiSpacer,{size:"xs"})))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),p.length?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.impactOnScoreTitle",defaultMessage:"Impact on initial score"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),p.map((({title:e,description:t})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{css:Vf,grow:!1},e),Object(g.jsx)(o.EuiFlexItem,null,t)),Object(g.jsx)(o.EuiSpacer,{size:"xs"}))))):null)};var Uf={name:"163mag1",styles:"border-bottom:2px solid"};const Gf=({score:e})=>Object(g.jsx)("div",{css:Uf,style:{borderBottomColor:Object(pt.j)(e)}},e);function qf(e){return e<2?1:e<4?2:e<7?3:e<12?4:5}const $f={anomaly_characteristics:{low:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyCharacteristicsTooltip.low",{defaultMessage:"Moderate impact from the duration and magnitude of the detected anomaly relative to the historical average."}),medium:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyCharacteristicsTooltip.medium",{defaultMessage:"Medium impact from the duration and magnitude of the detected anomaly relative to the historical average."}),high:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyCharacteristicsTooltip.high",{defaultMessage:"High impact from the duration and magnitude of the detected anomaly relative to the historical average."})},single_bucket:{low:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.singleBucketTooltip.low",{defaultMessage:"The difference between actual and typical values in this bucket has a moderate impact."}),medium:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.singleBucketTooltip.medium",{defaultMessage:"The difference between actual and typical values in this bucket has a significant impact."}),high:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.singleBucketTooltip.high",{defaultMessage:"The difference between actual and typical values in this bucket has a high impact."})},multi_bucket:{low:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multiBucketTooltip.low",{defaultMessage:"The differences between actual and typical values in the past 12 buckets have a moderate impact."}),medium:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multiBucketTooltip.medium",{defaultMessage:"The differences between actual and typical values in the past 12 buckets have a significant impact."}),high:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multiBucketTooltip.high",{defaultMessage:"The differences between actual and typical values in the past 12 buckets have a high impact."})}};function Wf(e,t){const a=qf(e);return a<3?$f[t].low:a>3?$f[t].high:$f[t].medium}const Hf=({score:e})=>{const{euiTheme:{colors:t}}=Object(o.useEuiTheme)(),a=qf(e),i="10px",n=t.lightShade,s=t.primary;return Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs"},Array(5).fill(null).map(((e,t)=>Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)("div",{css:Object(g.css)({height:i,width:i,borderRadius:"2px"},"",""),style:{backgroundColor:a>t?s:n}})))))},Yf=({anomaly:e,examples:t,definition:a,isAggregatedData:i,filter:n,influencersLimit:s,influencerFilter:l,tabIndex:c,job:d})=>{if(void 0!==t&&t.length>0){const u=[{id:"Details",name:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.detailsTitle",{defaultMessage:"Details"}),content:Object(g.jsx)(Xf,{anomaly:e,filter:n,influencerFilter:l,influencersLimit:s,isAggregatedData:i,job:d})},{id:"category-examples",name:r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.categoryExamplesTitle",{defaultMessage:"Category examples"}),content:Object(g.jsx)(eh,{examples:t,definition:a})}];return Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiTabbedContent,{tabs:u,size:"s",initialSelectedTab:u[c],onTabClick:()=>{}})))}return Object(g.jsx)(Xf,{anomaly:e,filter:n,influencerFilter:l,influencersLimit:s,isAggregatedData:i,job:d})},Xf=({anomaly:e,isAggregatedData:t,filter:a,influencersLimit:i,influencerFilter:s,job:r})=>{const{euiTheme:{colors:l}}=Object(o.useEuiTheme)(),c=Object(n.useMemo)((()=>Object(re.isPopulatedObject)(e.source.anomaly_score_explanation)?{borderRight:`1px solid ${l.lightShade}`}:{}),[l,e]);return Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)("div",{className:"ml-anomalies-table-details","data-test-subj":"mlAnomaliesListRowDetails"},Object(g.jsx)(Qf,{anomaly:e}),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"l"},Object(g.jsx)(o.EuiFlexItem,{css:c},Object(g.jsx)(Kf,{anomaly:e,isAggregatedData:t,filter:a,job:r}),Object(g.jsx)(Zf,{anomaly:e,influencerFilter:s,influencersLimit:i})),Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(Jf,{anomaly:e}))))))},Qf=({anomaly:e})=>{const t=e.source;let a,i=r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyInLabel",{defaultMessage:"{anomalySeverity} anomaly in {anomalyDetector}",values:{anomalySeverity:Object(Q.capitalize)(Object(pt.i)(e.severity).label),anomalyDetector:e.detector}});return void 0!==e.entityName&&(i+=r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.foundForLabel",{defaultMessage:" found for {anomalyEntityName} {anomalyEntityValue}",values:{anomalyEntityName:e.entityName,anomalyEntityValue:e.entityValue}})),void 0!==t.partition_field_name&&t.partition_field_name!==e.entityName&&(i+=r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.detectedInLabel",{defaultMessage:" detected in {sourcePartitionFieldName} {sourcePartitionFieldValue}",values:{sourcePartitionFieldName:t.partition_field_name,sourcePartitionFieldValue:t.partition_field_value}})),void 0!==t.correlated_by_field_value&&(a=r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.multivariateDescription",{defaultMessage:"multivariate correlations found in {sourceByFieldName}; {sourceByFieldValue} is considered anomalous given {sourceCorrelatedByFieldValue}",values:{sourceByFieldName:t.by_field_name,sourceByFieldValue:t.by_field_value,sourceCorrelatedByFieldValue:t.correlated_by_field_value}})),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.descriptionTitle",defaultMessage:"Description"})),i),void 0!==a&&Object(g.jsx)(o.EuiText,{size:"xs"},a))},Kf=({anomaly:e,isAggregatedData:t,filter:a,job:i})=>{var n,r;const l=null!==(n=null===(r=e.source)||void 0===r?void 0:r.is_interim)&&void 0!==n&&n;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiText,{size:"xs"},!0===t?Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.detailsOnHighestSeverityAnomalyTitle",defaultMessage:"Details on highest severity anomaly"})):Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyDetailsTitle",defaultMessage:"Anomaly details"})),!0===l&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiIcon,{type:"alert"}),Object(g.jsx)("span",{className:"interim-result"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.interimResultLabel",defaultMessage:"Interim result"})))),Object(g.jsx)(o.EuiSpacer,{size:"xs"}),Object(g.jsx)(Bf,{anomaly:e,filter:a,modelPlotEnabled:i.modelPlotEnabled}))},Zf=({anomaly:e,influencersLimit:t,influencerFilter:a})=>{const[i,r]=Object(n.useState)(!1),l=r.bind(null,(e=>!e)),c=e.influencers;let d=[],u=0,p=0;return void 0!==c&&(p=!0===i?c.length:Math.min(t,c.length),u=Math.max(c.length-p,0),1===u&&(p++,u=0),d=function(e,t,a){const i=[];for(let n=0;n<a;n++)Object.keys(e[n]).forEach((a=>{const s=e[n][a];i.push({title:a,description:Pf(a,s,t)})}));return i}(c,a,p)),d.length>0?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.influencersTitle",defaultMessage:"Influencers"}))),d.map((({title:e,description:t})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"none"},Object(g.jsx)(o.EuiFlexItem,{style:{width:"180px"},grow:!1},e),Object(g.jsx)(o.EuiFlexItem,null,t)),Object(g.jsx)(o.EuiSpacer,{size:"xs"})))),u>0&&Object(g.jsx)(o.EuiLink,{onClick:()=>l()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyDescriptionListMoreLinkText",defaultMessage:"and {othersCount} more",values:{othersCount:u}})),p>t+1&&Object(g.jsx)(o.EuiLink,{onClick:()=>l()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyDescriptionShowLessLinkText",defaultMessage:"Show less"}))):null},eh=({definition:e,examples:t})=>Object(g.jsx)(o.EuiFlexGroup,{direction:"column",justifyContent:"center",gutterSize:"m",className:"mlAnomalyCategoryExamples"},void 0!==e&&e.terms&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexItem,{key:"example-terms"},Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)("h4",{className:"mlAnomalyCategoryExamples__header"},r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.termsTitle",{defaultMessage:"Terms"}))," ",Object(g.jsx)(o.EuiIconTip,{"aria-label":r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.termsDescriptionAriaLabel",{defaultMessage:"Description"}),type:"questionInCircle",color:"subdued",size:"s",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.termsDescriptionTooltip",defaultMessage:"A space separated list of the common tokens that are matched in values of the category (may have been truncated to a max character limit of {maxChars})",values:{maxChars:Af}})})),Object(g.jsx)(o.EuiText,{size:"xs"},e.terms)),Object(g.jsx)(o.EuiSpacer,{size:"xs"})),void 0!==e&&e.regex&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexItem,{key:"example-regex"},Object(g.jsx)(o.EuiText,{size:"xs"},Object(g.jsx)("h4",{className:"mlAnomalyCategoryExamples__header"},r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.regexTitle",{defaultMessage:"Regex"}))," ",Object(g.jsx)(o.EuiIconTip,{"aria-label":r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.regexDescriptionAriaLabel",{defaultMessage:"Description"}),type:"questionInCircle",color:"subdued",size:"s",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.regexDescriptionTooltip",defaultMessage:"The regular expression that is used to search for values that match the category (may have been truncated to a max character limit of {maxChars})",values:{maxChars:Af}})})),Object(g.jsx)(o.EuiText,{size:"xs"},e.regex)),Object(g.jsx)(o.EuiSpacer,{size:"xs"})),t.map(((t,a)=>Object(g.jsx)(o.EuiFlexItem,{key:`example${a}`},0===a&&void 0!==e&&Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)("h4",null,r.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.examplesTitle",{defaultMessage:"Examples"}))),Object(g.jsx)("span",{className:"mlAnomalyCategoryExamples__item"},t)))));function th({job:e,detector:t,anomaly:a}){const i=[{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.detectorDescriptionList.jobIdTitle",defaultMessage:"Job ID"}),description:e.job_id},{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.detectorDescriptionList.detectorTitle",defaultMessage:"Detector"}),description:t.detector_description}];if(void 0!==a.actual){const e=Object(Df.b)(a.actual,a.source.function),t=Object(Df.b)(a.typical,a.source.function);i.push({title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.detectorDescriptionList.selectedAnomalyTitle",defaultMessage:"Selected anomaly"}),description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.detectorDescriptionList.selectedAnomalyDescription",defaultMessage:"actual {actual}, typical {typical}",values:{actual:e,typical:t}})})}return Object(g.jsx)(o.EuiDescriptionList,{className:"rule-detector-description-list",type:"column",listItems:i})}var ah=a(30);function ih({actions:e,onSkipResultChange:t,onSkipModelUpdateChange:a}){return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiText,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.chooseActionsDescription",defaultMessage:"Choose the actions to take when the job rule matches an anomaly."}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiCheckbox,{id:"skip_result_cb",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.skipResultLabel",defaultMessage:"Skip result (recommended)"}),checked:e.indexOf(ah.a.SKIP_RESULT)>-1,onChange:t})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIconTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.resultWillNotBeCreatedTooltip",defaultMessage:"The result will not be created."}),size:"s",position:"right"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiCheckbox,{id:"skip_model_update_cb",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.skipModelUpdateLabel",defaultMessage:"Skip model update"}),checked:e.indexOf(ah.a.SKIP_MODEL_UPDATE)>-1,onChange:a})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIconTip,{content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.valueWillNotBeUsedToUpdateModelTooltip",defaultMessage:"The value for that series will not be used to update the model."}),size:"s",position:"right"}))))}function nh(){return{applies_to:ah.b.ACTUAL,operator:ah.e.LESS_THAN,value:1}}function sh(){return{actions:[ah.a.SKIP_RESULT],conditions:[]}}function oh(e){let t=!1;if(e.actions.length>0){const a=e.conditions;if(void 0!==a&&a.length>0)t=!0;else{const a=e.scope;void 0!==a&&(t=Object.keys(a).some((e=>!0===a[e].enabled)))}}return t}function rh(e,t,a){const i=e.job_id,n={detectors:[{detector_index:t,custom_rules:a}]};let s={};return void 0!==e.custom_settings&&(s={...e.custom_settings},Object(Qe.s)(s),n.custom_settings=s),new Promise(((e,t)=>{X.ml.updateJob({jobId:i,job:n}).then((()=>{K.a.refreshJob(i).then((()=>{e({success:!0})})).catch((e=>{t(e)}))})).catch((e=>{t(e)}))}))}function lh(e){const{actions:t,conditions:a,scope:i}=e;let n="",s="",o="";return t.forEach(((e,t)=>{switch(t>0&&(n+=" AND "),e){case ah.a.SKIP_RESULT:n+=r.i18n.translate("xpack.ml.ruleEditor.ruleDescription.resultActionTypeText",{defaultMessage:"result",description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText +xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"});break;case ah.a.SKIP_MODEL_UPDATE:n+=r.i18n.translate("xpack.ml.ruleEditor.ruleDescription.modelUpdateActionTypeText",{defaultMessage:"model update",description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"})}})),void 0!==a&&a.forEach(((e,t)=>{t>0&&(s+=" AND "),s+=r.i18n.translate("xpack.ml.ruleEditor.ruleDescription.conditionsText",{defaultMessage:"{appliesTo} is {operator} {value}",values:{appliesTo:dh(e.applies_to),operator:uh(e.operator),value:e.value},description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"})})),void 0!==i&&(void 0!==a&&a.length>0&&(o+=" AND "),Object.keys(i).forEach(((e,t)=>{t>0&&(o+=" AND ");const a=i[e];o+=r.i18n.translate("xpack.ml.ruleEditor.ruleDescription.filtersText",{defaultMessage:"{fieldName} is {filterType} {filterId}",values:{fieldName:e,filterType:ch(a.filter_type),filterId:a.filter_id},description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"})}))),r.i18n.translate("xpack.ml.ruleEditor.ruleDescription",{defaultMessage:"skip {actions} when {conditions}{filters}",values:{actions:n,conditions:s,filters:o},description:"Composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText. (Example: skip model update when actual is less than 1 AND ip is in xxx)"})}function ch(e){switch(e){case ah.d.INCLUDE:return r.i18n.translate("xpack.ml.ruleEditor.includeFilterTypeText",{defaultMessage:"in"});case ah.d.EXCLUDE:return r.i18n.translate("xpack.ml.ruleEditor.excludeFilterTypeText",{defaultMessage:"not in"});default:return void 0!==e?e:""}}function dh(e){switch(e){case ah.b.ACTUAL:return r.i18n.translate("xpack.ml.ruleEditor.actualAppliesTypeText",{defaultMessage:"actual"});case ah.b.TYPICAL:return r.i18n.translate("xpack.ml.ruleEditor.typicalAppliesTypeText",{defaultMessage:"typical"});case ah.b.DIFF_FROM_TYPICAL:return r.i18n.translate("xpack.ml.ruleEditor.diffFromTypicalAppliesTypeText",{defaultMessage:"diff from typical"});default:return void 0!==e?e:""}}function uh(e){switch(e){case ah.e.LESS_THAN:return r.i18n.translate("xpack.ml.ruleEditor.lessThanOperatorTypeText",{defaultMessage:"less than"});case ah.e.LESS_THAN_OR_EQUAL:return r.i18n.translate("xpack.ml.ruleEditor.lessThanOrEqualToOperatorTypeText",{defaultMessage:"less than or equal to"});case ah.e.GREATER_THAN:return r.i18n.translate("xpack.ml.ruleEditor.greaterThanOperatorTypeText",{defaultMessage:"greater than"});case ah.e.GREATER_THAN_OR_EQUAL:return r.i18n.translate("xpack.ml.ruleEditor.greaterThanOrEqualToOperatorTypeText",{defaultMessage:"greater than or equal to"});default:return void 0!==e?e:""}}class condition_expression_ConditionExpression extends n.Component{constructor(e){super(e),Y()(this,"openAppliesTo",(()=>{this.setState({isAppliesToOpen:!0,isOperatorValueOpen:!1})})),Y()(this,"closeAppliesTo",(()=>{this.setState({isAppliesToOpen:!1})})),Y()(this,"openOperatorValue",(()=>{this.setState({isAppliesToOpen:!1,isOperatorValueOpen:!0})})),Y()(this,"closeOperatorValue",(()=>{this.setState({isOperatorValueOpen:!1})})),Y()(this,"changeAppliesTo",(e=>{const{index:t,operator:a,value:i,updateCondition:n}=this.props;n(t,e.target.value,a,i)})),Y()(this,"changeOperator",(e=>{const{index:t,appliesTo:a,value:i,updateCondition:n}=this.props;n(t,a,e.target.value,i)})),Y()(this,"changeValue",(e=>{const{index:t,appliesTo:a,operator:i,updateCondition:n}=this.props;n(t,a,i,+e.target.value)})),this.state={isAppliesToOpen:!1,isOperatorValueOpen:!1}}renderAppliesToPopover(){return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiPopoverTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionExpression.appliesToPopoverTitle",defaultMessage:"When"})),Object(g.jsx)("div",{className:"euiExpression",style:{width:200}},Object(g.jsx)(o.EuiSelect,{value:this.props.appliesTo,onChange:this.changeAppliesTo,options:[{value:ah.b.ACTUAL,text:dh(ah.b.ACTUAL)},{value:ah.b.TYPICAL,text:dh(ah.b.TYPICAL)},{value:ah.b.DIFF_FROM_TYPICAL,text:dh(ah.b.DIFF_FROM_TYPICAL)}]})))}renderOperatorValuePopover(){return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiPopoverTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionExpression.operatorValuePopoverTitle",defaultMessage:"Is"})),Object(g.jsx)("div",{className:"euiExpression"},Object(g.jsx)(o.EuiFlexGroup,{style:{maxWidth:450}},Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{width:250}},Object(g.jsx)(o.EuiSelect,{value:this.props.operator,onChange:this.changeOperator,options:[{value:ah.e.LESS_THAN,text:uh(ah.e.LESS_THAN)},{value:ah.e.LESS_THAN_OR_EQUAL,text:uh(ah.e.LESS_THAN_OR_EQUAL)},{value:ah.e.GREATER_THAN,text:uh(ah.e.GREATER_THAN)},{value:ah.e.GREATER_THAN_OR_EQUAL,text:uh(ah.e.GREATER_THAN_OR_EQUAL)}]})),Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{width:200}},Object(g.jsx)(o.EuiFieldNumber,{value:+this.props.value,onChange:this.changeValue})))))}render(){const{index:e,appliesTo:t,operator:a,value:i,deleteCondition:n}=this.props;return Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"m"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiPopover,{id:"appliesToPopover",button:Object(g.jsx)(o.EuiExpression,{description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionExpression.appliesToButtonLabel",defaultMessage:"when"}),value:dh(t),isActive:this.state.isAppliesToOpen,onClick:this.openAppliesTo}),isOpen:this.state.isAppliesToOpen,closePopover:this.closeAppliesTo,panelPaddingSize:"s",ownFocus:!0,anchorPosition:"downLeft"},this.renderAppliesToPopover())),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiPopover,{id:"operatorValuePopover",button:Object(g.jsx)(o.EuiExpression,{description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionExpression.operatorValueButtonLabel",defaultMessage:"is {operator}",values:{operator:uh(a)}}),value:`${i}`,isActive:this.state.isOperatorValueOpen,onClick:this.openOperatorValue}),isOpen:this.state.isOperatorValueOpen,closePopover:this.closeOperatorValue,panelPaddingSize:"s",ownFocus:!0,withTitle:!0,anchorPosition:"downLeft"},this.renderOperatorValuePopover())),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonIcon,{size:"s",color:"danger",onClick:()=>n(e),iconType:"trash","aria-label":r.i18n.translate("xpack.ml.ruleEditor.conditionExpression.deleteConditionButtonAriaLabel",{defaultMessage:"Delete condition"})})))}}function ph({isEnabled:e,conditions:t,addCondition:a,updateCondition:i,deleteCondition:n}){if(!1===e)return null;let r=[];return void 0!==t&&(r=t.map(((e,t)=>Object(g.jsx)(condition_expression_ConditionExpression,{key:t,index:t,appliesTo:e.applies_to,operator:e.operator,value:e.value,updateCondition:i,deleteCondition:n})))),Object(g.jsx)(s.a.Fragment,null,r,Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiButtonEmpty,{onClick:()=>a()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionsSection.addNewConditionButtonLabel",defaultMessage:"Add new condition"})))}function mh(e){return e.map((e=>({value:e,text:e})))}class scope_expression_ScopeExpression extends n.Component{constructor(e){super(e),Y()(this,"openFilterList",(()=>{this.setState({isFilterListOpen:!0})})),Y()(this,"closeFilterList",(()=>{this.setState({isFilterListOpen:!1})})),Y()(this,"onChangeFilterType",(e=>{const{fieldName:t,filterId:a,enabled:i,updateScope:n}=this.props;n(t,a,e.target.value,i)})),Y()(this,"onChangeFilterId",(e=>{const{fieldName:t,filterType:a,enabled:i,updateScope:n}=this.props;n(t,e.target.value,a,i)})),Y()(this,"onEnableChange",(e=>{const{fieldName:t,filterId:a,filterType:i,updateScope:n}=this.props;n(t,a,i,e.target.checked)})),this.state={isFilterListOpen:!1}}renderFilterListPopover(){const{filterId:e,filterType:t,filterListIds:a}=this.props;return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiPopoverTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeExpression.scopeFilterTypePopoverTitle",defaultMessage:"Is"})),Object(g.jsx)("div",{className:"euiExpression"},Object(g.jsx)(o.EuiFlexGroup,{style:{maxWidth:450}},Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{width:150}},Object(g.jsx)(o.EuiSelect,{value:t,onChange:this.onChangeFilterType,options:[{value:ah.d.INCLUDE,text:ch(ah.d.INCLUDE)},{value:ah.d.EXCLUDE,text:ch(ah.d.EXCLUDE)}]})),Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{width:300}},Object(g.jsx)(o.EuiSelect,{value:e,onChange:this.onChangeFilterId,options:mh(a)})))))}render(){const{fieldName:e,filterId:t,filterType:a,enabled:i,filterListIds:n}=this.props;return Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"m"},Object(g.jsx)(o.EuiFlexItem,{grow:!1,className:"scope-field-checkbox"},Object(g.jsx)(o.EuiCheckbox,{id:`scope_cb_${e}`,checked:i,onChange:this.onEnableChange})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiExpression,{className:"scope-field-button",description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeExpression.scopeFieldWhenLabel",defaultMessage:"when"}),value:e,isActive:!1,onClick:e=>e.preventDefault()})),void 0!==n&&n.length>0&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiPopover,{id:"operatorValuePopover",button:Object(g.jsx)(o.EuiExpression,{description:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeExpression.scopeFilterTypeButtonLabel",defaultMessage:"is {filterType}",values:{filterType:ch(a)}}),value:t||"",isActive:this.state.isFilterListOpen,onClick:this.openFilterList}),isOpen:this.state.isFilterListOpen,closePopover:this.closeFilterList,panelPaddingSize:"s",ownFocus:!0,anchorPosition:"downLeft"},this.renderFilterListPopover())))}}function bh(){const e=Object(y.d)(),t=Object(y.e)();return Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.noFilterListsConfiguredTitle",defaultMessage:"No filter lists configured"}),iconType:"gear"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.createFilterListsDescription",defaultMessage:"To configure scope, you must first use the {filterListsLink} settings page to create the list of values you want to include or exclude in the job rule.",values:{filterListsLink:Object(g.jsx)(o.EuiLink,{onClick:async()=>{const a=await e.getUrl({page:E.b.FILTER_LISTS_MANAGE});await t(a,!0)}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.createFilterListsDescription.filterListsLinkText",defaultMessage:"Filter Lists"}))}})))}function fh(){return Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.noPermissionToViewFilterListsTitle",defaultMessage:"You do not have permission to view filter lists"}),iconType:"gear"})}function hh({isEnabled:e,onEnabledChange:t,partitioningFieldNames:a,filterListIds:i,scope:n,updateScope:r}){const l=Object(w.e)("canGetFilters");if(null===a||0===a.length)return null;let c;return c=i.length>0?a.map(((e,t)=>{let a;return a=void 0!==n&&void 0!==n[e]?n[e]:function(e){const t={filter_type:ah.d.INCLUDE,enabled:!1};return void 0!==e&&e.length>0&&(t.filter_id=e[0]),t}(i),Object(g.jsx)(scope_expression_ScopeExpression,{key:t,fieldName:e,filterId:a.filter_id,filterType:a.filter_type,enabled:a.enabled,filterListIds:i,updateScope:r})})):!1===l?Object(g.jsx)(fh,null):Object(g.jsx)(bh,null),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiTitle,null,Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.scopeTitle",defaultMessage:"Scope"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiCheckbox,{id:"enable_scope_checkbox",label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.addFilterListLabel",defaultMessage:"Add a filter list to limit where the job rule applies."}),checked:e,onChange:t}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),e&&Object(g.jsx)(s.a.Fragment,null,c),Object(g.jsx)(o.EuiSpacer,{size:"xxl"}))}function gh({fieldValue:e,filterId:t,addItemToFilterList:a}){return Object(g.jsx)(o.EuiLink,{onClick:()=>a(e,t,!0)},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.addValueToFilterListLinkText",defaultMessage:"Add {fieldValue} to {filterId}",values:{fieldValue:e,filterId:t}}))}class delete_rule_modal_DeleteRuleModal extends n.Component{constructor(e){super(e),Y()(this,"deleteRule",(()=>{const{ruleIndex:e,deleteRuleAtIndex:t}=this.props;t(e),this.closeModal()})),Y()(this,"closeModal",(()=>{this.setState({isModalVisible:!1})})),Y()(this,"showModal",(()=>{this.setState({isModalVisible:!0})})),this.state={isModalVisible:!1}}render(){let e;return this.state.isModalVisible&&(e=Object(g.jsx)(o.EuiConfirmModal,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.deleteRuleModal.deleteRuleTitle",defaultMessage:"Delete rule?"}),onCancel:this.closeModal,onConfirm:this.deleteRule,buttonColor:"danger",cancelButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.deleteRuleModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.deleteRuleModal.deleteButtonLabel",defaultMessage:"Delete"}),defaultFocusedButton:o.EUI_MODAL_CONFIRM_BUTTON})),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiLink,{color:"danger",onClick:()=>this.showModal()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.deleteRuleModal.deleteRuleLinkText",defaultMessage:"Delete rule"})),e)}}class edit_condition_link_EditConditionLink extends n.Component{constructor(e){super(e),Y()(this,"onChangeValue",(e=>{const t=e.target.value;this.setState({value:""!==t?+t:""})})),Y()(this,"onUpdateClick",(()=>{const{conditionIndex:e,updateConditionValue:t}=this.props;t(e,this.state.value)}));let t="";const a=this.props.anomaly,i=function(e,t){let a,i;const n=e.actual;void 0!==n&&(a=Array.isArray(n)?n[0]:n);const s=e.typical;switch(void 0!==s&&(i=Array.isArray(s)?s[0]:s),t){case ah.b.ACTUAL:return a;case ah.b.TYPICAL:return i;case ah.b.DIFF_FROM_TYPICAL:if(void 0!==n&&void 0!==s)return Math.abs(a-i)}}(a,e.appliesTo);void 0!==i&&(t=+Object(Df.b)(i,a.source.function)),this.state={value:t}}render(){const e=this.state.value;return Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"s"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.editConditionLink.updateRuleConditionFromText",defaultMessage:"Update rule condition from {conditionValue} to",values:{conditionValue:this.props.conditionValue}}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1,className:"condition-edit-value-field"},Object(g.jsx)(o.EuiFieldNumber,{placeholder:r.i18n.translate("xpack.ml.ruleEditor.editConditionLink.enterValuePlaceholder",{defaultMessage:"Enter value"}),compressed:!0,value:e,onChange:this.onChangeValue,"aria-label":r.i18n.translate("xpack.ml.ruleEditor.editConditionLink.enterNumericValueForConditionAriaLabel",{defaultMessage:"Enter numeric value for condition"})})),""!==e&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiLink,{size:"s",onClick:()=>this.onUpdateClick()},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.editConditionLink.updateLinkText",defaultMessage:"Update"}))))}}class rule_action_panel_RuleActionPanel extends n.Component{constructor(e){super(e),Y()(this,"getEditRuleLink",(()=>{const{ruleIndex:e,setEditRuleIndex:t}=this.props;return Object(g.jsx)(o.EuiLink,{onClick:()=>t(e)},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleActionPanel.editRuleLinkText",defaultMessage:"Edit rule"}))})),Y()(this,"getDeleteRuleLink",(()=>{const{ruleIndex:e,deleteRuleAtIndex:t}=this.props;return Object(g.jsx)(delete_rule_modal_DeleteRuleModal,{ruleIndex:e,deleteRuleAtIndex:t})})),Y()(this,"getQuickEditConditionLink",(()=>{const e=this.rule.conditions;let t=null;return void 0!==this.rule.conditions&&1===e.length&&(t=Object(g.jsx)(edit_condition_link_EditConditionLink,{conditionIndex:0,conditionValue:e[0].value,appliesTo:e[0].applies_to,anomaly:this.props.anomaly,updateConditionValue:this.updateConditionValue})),t})),Y()(this,"getQuickAddToFilterListLink",(()=>{const{anomaly:e,addItemToFilterList:t}=this.props,a=this.rule.scope,i=Object.keys(a)[0],n=e.source[i],s=a[i].filter_id;return Object(g.jsx)(gh,{fieldValue:n[0],filterId:s,addItemToFilterList:t})})),Y()(this,"updateConditionValue",((e,t)=>{const{job:a,anomaly:i,ruleIndex:n,updateRuleAtIndex:s}=this.props,o=a.analysis_config.detectors[i.detectorIndex],r=Object(Q.cloneDeep)(o.custom_rules[n]),l=r.conditions;e<l.length&&(l[e].value=t),s(n,r)}));const{job:t,anomaly:a,ruleIndex:i}=this.props,n=t.analysis_config.detectors[a.detectorIndex].custom_rules;void 0!==n&&i<n.length&&(this.rule=n[i]),this.state={showAddToFilterListLink:!1}}componentDidMount(){const e=this.rule.scope;if(void 0!==e&&1===Object.keys(e).length){const t=Object.keys(e)[0],a=this.props.anomaly.source[t];if(void 0!==e[t]&&void 0!==a&&1===a.length&&a[0].length>0){const i=e[t].filter_id;X.ml.filters.filters({filterId:i}).then((e=>{-1===e.items.indexOf(a[0])&&this.setState({showAddToFilterListLink:!0})})).catch((e=>{console.log(`Error loading filter ${i}:`,e)}))}}}render(){if(void 0===this.rule)return null;const e=[{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleActionPanel.ruleTitle",defaultMessage:"Rule"}),description:lh(this.rule,this.props.anomaly)},{title:"",description:this.getEditRuleLink()},{title:"",description:this.getDeleteRuleLink()}],t=this.getQuickEditConditionLink();if(null!==t&&e.splice(1,0,{title:"",description:t}),!0===this.state.showAddToFilterListLink){const t=this.getQuickAddToFilterListLink();e.splice(e.length-2,0,{title:"",description:t})}return e[1].title=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleActionPanel.actionsTitle",defaultMessage:"Actions"}),Object(g.jsx)(o.EuiPanel,{paddingSize:"m",className:"select-rule-action-panel"},Object(g.jsx)(o.EuiDescriptionList,{type:"column",listItems:e}))}}function jh({job:e,anomaly:t,setEditRuleIndex:a,updateRuleAtIndex:i,deleteRuleAtIndex:n,addItemToFilterList:r}){const l=t.detectorIndex,c=e.analysis_config.detectors[l],d=c.custom_rules||[];let u;return d.length>0&&(u=d.map(((l,c)=>Object(g.jsx)(s.a.Fragment,{key:`rule_panel_${c}_${d.length}`},Object(g.jsx)(rule_action_panel_RuleActionPanel,{job:e,ruleIndex:c,anomaly:t,setEditRuleIndex:a,updateRuleAtIndex:i,deleteRuleAtIndex:n,addItemToFilterList:r}),Object(g.jsx)(o.EuiSpacer,{size:"l"}))))),Object(g.jsx)("div",{className:"select-rule-action"},d.length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(th,{job:e,detector:c,anomaly:t}),Object(g.jsx)(o.EuiSpacer,{size:"m"}),u,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiText,{style:{display:"inline"}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.selectRuleAction.orText",defaultMessage:"Or "}))),Object(g.jsx)(o.EuiLink,{onClick:()=>a(d.length)},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.selectRuleAction.createRuleLinkText",defaultMessage:"create a rule"})))}class rule_editor_flyout_RuleEditorFlyoutUI extends n.Component{constructor(e){super(e),Y()(this,"showFlyout",(e=>{let t=-1;const a=K.a.getJob(e.jobId);if(void 0===a){const{toasts:t}=this.props.kibana.services.notifications;return t.addDanger(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.unableToConfigureRulesNotificationMesssage",{defaultMessage:"Unable to configure job rules as an error occurred obtaining details for job ID {jobId}",values:{jobId:e.jobId}})),void this.setState({job:a,isFlyoutVisible:!1})}this.partitioningFieldNames=Object(Qe.j)(a,e.detectorIndex);const i=e.detectorIndex;void 0===a.analysis_config.detectors[i].custom_rules&&(t=0);let n=!1;0===t&&(n=0===this.partitioningFieldNames.length),this.setState({anomaly:e,job:a,ruleIndex:t,isConditionsEnabled:n,isScopeEnabled:!1,isFlyoutVisible:!0}),this.partitioningFieldNames.length>0&&this.canGetFilters&&X.ml.filters.filters().then((e=>{const t=e.map((e=>e.filter_id));this.setState({filterListIds:t})})).catch((e=>{console.log("Error loading list of filters:",e);const{toasts:t}=this.props.kibana.services.notifications;t.addDanger(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithLoadingFilterListsNotificationMesssage",{defaultMessage:"Error loading the filter lists used in the job rule scope"}))}))})),Y()(this,"closeFlyout",(()=>{this.setState({isFlyoutVisible:!1})})),Y()(this,"setEditRuleIndex",(e=>{const t=this.state.anomaly.detectorIndex,a=this.state.job.analysis_config.detectors[t].custom_rules,i=void 0===a||e>=a.length?sh():a[e],n=0===this.partitioningFieldNames.length||void 0!==i.conditions&&i.conditions.length>0,s=void 0!==i.scope&&Object.keys(i.scope).length>0;!0===s&&Object.keys(i.scope).forEach((e=>{i.scope[e].enabled=!0})),this.setState({ruleIndex:e,rule:i,isConditionsEnabled:n,isScopeEnabled:s})})),Y()(this,"onSkipResultChange",(e=>{const t=e.target.checked;this.setState((e=>{const a=[...e.rule.actions],i=a.indexOf(ah.a.SKIP_RESULT);return-1===i&&t?a.push(ah.a.SKIP_RESULT):i>-1&&!t&&a.splice(i,1),{rule:{...e.rule,actions:a}}}))})),Y()(this,"onSkipModelUpdateChange",(e=>{const t=e.target.checked;this.setState((e=>{const a=[...e.rule.actions],i=a.indexOf(ah.a.SKIP_MODEL_UPDATE);return-1===i&&t?a.push(ah.a.SKIP_MODEL_UPDATE):i>-1&&!t&&a.splice(i,1),{rule:{...e.rule,actions:a}}}))})),Y()(this,"onConditionsEnabledChange",(e=>{const t=e.target.checked;this.setState((e=>{let a;return a=!1===t?[]:[nh()],{rule:{...e.rule,conditions:a},isConditionsEnabled:t}}))})),Y()(this,"addCondition",(()=>{this.setState((e=>{const t=[...e.rule.conditions];return t.push(nh()),{rule:{...e.rule,conditions:t}}}))})),Y()(this,"updateCondition",((e,t,a,i)=>{this.setState((n=>{const s=[...n.rule.conditions];return e<s.length&&(s[e]={applies_to:t,operator:a,value:i}),{rule:{...n.rule,conditions:s}}}))})),Y()(this,"deleteCondition",(e=>{this.setState((t=>{const a=[...t.rule.conditions];return e<a.length&&a.splice(e,1),{rule:{...t.rule,conditions:a}}}))})),Y()(this,"onScopeEnabledChange",(e=>{const t=e.target.checked;this.setState((e=>{const a={...e.rule};return!1===t&&delete a.scope,{rule:a,isScopeEnabled:t}}))})),Y()(this,"updateScope",((e,t,a,i)=>{this.setState((n=>{let s={...n.rule.scope};return void 0===s&&(s={}),s[e]={filter_id:t,filter_type:a,enabled:i},{rule:{...n.rule,scope:s}}}))})),Y()(this,"saveEdit",(()=>{const{rule:e,ruleIndex:t}=this.state;this.updateRuleAtIndex(t,e)})),Y()(this,"updateRuleAtIndex",((e,t)=>{const{toasts:a}=this.props.kibana.services.notifications,{job:i,anomaly:n}=this.state,s=i.job_id;(function(e,t,a,i){const n=e.analysis_config.detectors[t],s=Object(Q.cloneDeep)(i),o=s.scope;void 0!==o&&Object.keys(o).forEach((e=>{!1===o[e].enabled?delete o[e]:delete o[e].enabled}));let r=[];return void 0===n.custom_rules?r=[s]:(r=Object(Q.cloneDeep)(n.custom_rules),a<r.length?r[a]=s:r.push(s)),rh(e,t,r)})(i,n.detectorIndex,e,t).then((e=>{e.success?(a.add({title:r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.changesToJobDetectorRulesSavedNotificationMessageTitle",{defaultMessage:"Changes to {jobId} detector rules saved",values:{jobId:s}}),color:"success",iconType:"check",text:r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.changesToJobDetectorRulesSavedNotificationMessageDescription",{defaultMessage:"Note that changes will take effect for new results only."})}),this.closeFlyout()):a.addDanger(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithSavingChangesToJobDetectorRulesNotificationMessage",{defaultMessage:"Error saving changes to {jobId} detector rules",values:{jobId:s}}))})).catch((e=>{console.error(e),a.addDanger(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithSavingChangesToJobDetectorRulesNotificationMessage",{defaultMessage:"Error saving changes to {jobId} detector rules",values:{jobId:s}}))}))})),Y()(this,"deleteRuleAtIndex",(e=>{const{toasts:t}=this.props.kibana.services.notifications,{job:a,anomaly:i}=this.state,n=a.job_id,s=i.detectorIndex;(function(e,t,a){const i=e.analysis_config.detectors[t];let n=[];return void 0!==i.custom_rules&&a<i.custom_rules.length?(n=Object(Q.cloneDeep)(i.custom_rules),n.splice(a,1),rh(e,t,n)):Promise.reject(new Error(r.i18n.translate("xpack.ml.ruleEditor.deleteJobRule.ruleNoLongerExistsErrorMessage",{defaultMessage:"Rule no longer exists for detector index {detectorIndex} in job {jobId}",values:{detectorIndex:t,jobId:e.job_id}})))})(a,s,e).then((e=>{if(e.success){t.addSuccess(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.ruleDeletedFromJobDetectorNotificationMessage",{defaultMessage:"Rule deleted from {jobId} detector",values:{jobId:n}}));const e=K.a.getJob(i.jobId);e.analysis_config.detectors[s].custom_rules?this.setState({job:{...e}}):this.closeFlyout()}else t.addDanger(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithDeletingRuleFromJobDetectorNotificationMessage",{defaultMessage:"Error deleting rule from {jobId} detector",values:{jobId:n}}))})).catch((e=>{console.error(e);let a=r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithDeletingRuleFromJobDetectorNotificationMessage",{defaultMessage:"Error deleting rule from {jobId} detector",values:{jobId:n}});e.error&&(a+=` : ${Object(da.b)(e.error)}`),t.addDanger(a)}))})),Y()(this,"addItemToFilterList",((e,t,a)=>{const{toasts:i}=this.props.kibana.services.notifications;(function(e,t){return new Promise(((a,i)=>{X.ml.filters.updateFilter(t,void 0,[e],void 0).then((e=>{a(e)})).catch((e=>{i(e)}))}))})(e,t).then((()=>{!0===a&&(i.add({title:r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.addedItemToFilterListNotificationMessageTitle",{defaultMessage:"Added {item} to {filterId}",values:{item:e,filterId:t}}),color:"success",iconType:"check",text:r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.addedItemToFilterListNotificationMessageDescription",{defaultMessage:"Note that changes will take effect for new results only."})}),this.closeFlyout())})).catch((a=>{console.log(`Error adding ${e} to filter ${t}:`,a),i.addDanger(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithAddingItemToFilterListNotificationMessage",{defaultMessage:"An error occurred adding {item} to filter {filterId}",values:{item:e,filterId:t}}))}))})),this.state={anomaly:{},job:{},ruleIndex:-1,rule:sh(),skipModelUpdate:!1,isConditionsEnabled:!1,isScopeEnabled:!1,filterListIds:[],isFlyoutVisible:!1},this.partitioningFieldNames=[],this.canGetFilters=Object(w.e)("canGetFilters")}componentDidMount(){"function"==typeof this.props.setShowFunction&&this.props.setShowFunction(this.showFlyout)}componentWillUnmount(){"function"==typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}render(){const e=this.props.kibana.services.docLinks.links.ml.customRules,{isFlyoutVisible:t,job:a,anomaly:i,ruleIndex:n,rule:l,filterListIds:c,isConditionsEnabled:d,isScopeEnabled:u}=this.state;if(!1===t)return null;let p;if(-1===n)p=Object(g.jsx)(o.EuiFlyout,{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},Object(g.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(g.jsx)(o.EuiTitle,{size:"m"},Object(g.jsx)("h1",{id:"flyoutTitle"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.editRulesTitle",defaultMessage:"Edit job rules"})))),Object(g.jsx)(o.EuiFlyoutBody,null,Object(g.jsx)(jh,{job:a,anomaly:i,setEditRuleIndex:this.setEditRuleIndex,updateRuleAtIndex:this.updateRuleAtIndex,deleteRuleAtIndex:this.deleteRuleAtIndex,addItemToFilterList:this.addItemToFilterList})),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.closeButtonLabel",defaultMessage:"Close"}))))));else{const t=i.detectorIndex,s=a.analysis_config.detectors[t],b=s.custom_rules,f=void 0===b||n>=b.length,h=this.partitioningFieldNames&&this.partitioningFieldNames.length>0,j=-1===ah.c.indexOf(i.source.function),x=r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.conditionsDescription",{defaultMessage:"Add numeric conditions for when the job rule applies. Multiple conditions are combined using AND."});p=Object(g.jsx)(o.EuiFlyout,{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},Object(g.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(g.jsx)(o.EuiTitle,{size:"m"},Object(g.jsx)("h1",{id:"flyoutTitle"},!0===f?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.createRuleTitle",defaultMessage:"Create job rule"}):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.editRuleTitle",defaultMessage:"Edit job rule"})))),Object(g.jsx)(o.EuiFlyoutBody,null,Object(g.jsx)(th,{job:a,detector:s,anomaly:i}),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiText,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.rulesDescription",defaultMessage:"Job rules instruct anomaly detectors to change their behavior based on domain-specific knowledge that you provide. When you create a job rule, you can specify conditions, scope, and actions. When the conditions of a job rule are satisfied, its actions are triggered. {learnMoreLink}",values:{learnMoreLink:Object(g.jsx)(o.EuiLink,{href:e,target:"_blank"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.rulesDescription.learnMoreLinkText",defaultMessage:"Learn more"}))}}))),Object(g.jsx)(o.EuiSpacer,null),Object(g.jsx)(o.EuiTitle,null,Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.actionTitle",defaultMessage:"Action"}))),Object(g.jsx)(ih,{actions:l.actions,onSkipResultChange:this.onSkipResultChange,onSkipModelUpdateChange:this.onSkipModelUpdateChange}),Object(g.jsx)(o.EuiSpacer,{size:"xl"}),Object(g.jsx)(o.EuiTitle,null,Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.conditionsTitle",defaultMessage:"Conditions"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),!0===j?Object(g.jsx)(o.EuiCheckbox,{id:"enable_conditions_checkbox",className:"scope-enable-checkbox",label:x,checked:d,onChange:this.onConditionsEnabledChange,disabled:!j||!h}):Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.conditionsNotSupportedTitle",defaultMessage:"Conditions are not supported for detectors using the {functionName} function",values:{functionName:i.source.function}}),iconType:"iInCircle"}),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(ph,{isEnabled:d,conditions:l.conditions,addCondition:this.addCondition,updateCondition:this.updateCondition,deleteCondition:this.deleteCondition}),Object(g.jsx)(o.EuiSpacer,{size:"xl"}),Object(g.jsx)(hh,{isEnabled:u,onEnabledChange:this.onScopeEnabledChange,partitioningFieldNames:this.partitioningFieldNames,filterListIds:c,scope:l.scope,updateScope:this.updateScope}),Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.rerunJobTitle",defaultMessage:"Rerun job"}),color:"warning",iconType:"help"},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.whenChangesTakeEffectDescription",defaultMessage:"Changes to job rules take effect for new results only."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.howToApplyChangesToExistingResultsDescription",defaultMessage:"To apply these changes to existing results you must clone and rerun the job. Note rerunning the job may take some time and should only be done once you have completed all your changes to the rules for this job."})))),Object(g.jsx)(o.EuiFlyoutFooter,null,Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.closeButtonLabel",defaultMessage:"Close"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{onClick:this.saveEdit,isDisabled:!oh(l),fill:!0},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.saveButtonLabel",defaultMessage:"Save"}))))))}return Object(g.jsx)(s.a.Fragment,null,p)}}const xh=Object(c.withKibana)(rule_editor_flyout_RuleEditorFlyoutUI);class anomalies_table_AnomaliesTableInternal extends n.Component{constructor(e){super(e),Y()(this,"isShowingAggregatedData",(()=>"second"!==this.props.tableData.interval)),Y()(this,"toggleRow",(async(e,t=0)=>{const a={...this.state.itemIdToExpandedRowMap};if(a[e.rowId])delete a[e.rowId];else{const i="mlcategory"===e.entityName?Object(Q.get)(this.props.tableData,["examplesByJobId",e.jobId,e.entityValue]):void 0;let n;if(void 0!==i)try{n=await X.ml.results.getCategoryDefinition(e.jobId,e.source.mlcategory[0]),n.terms&&n.terms.length>Af&&(n.terms=`${n.terms.substring(0,Af)}...`),n.regex&&n.regex.length>Af&&(n.terms=`${n.regex.substring(0,Af)}...`)}catch(e){console.log("Error fetching category definition for row item.",e)}const s=this.props.selectedJobs.find((({id:t})=>t===e.jobId));a[e.rowId]=Object(g.jsx)(Yf,{tabIndex:t,anomaly:e,examples:i,definition:n,isAggregatedData:this.isShowingAggregatedData(),filter:this.props.filter,influencerFilter:this.props.influencerFilter,influencersLimit:5,job:s})}this.setState({itemIdToExpandedRowMap:a})})),Y()(this,"onMouseOverRow",(e=>{void 0!==this.mouseOverRecord?this.mouseOverRecord.rowId!==e.rowId&&(it.rowMouseleave$.next({record:this.mouseOverRecord}),it.rowMouseenter$.next({record:e})):it.rowMouseenter$.next({record:e}),this.mouseOverRecord=e})),Y()(this,"onMouseLeaveRow",(()=>{void 0!==this.mouseOverRecord&&(it.rowMouseleave$.next({record:this.mouseOverRecord}),this.mouseOverRecord=void 0)})),Y()(this,"setShowRuleEditorFlyoutFunction",(e=>{this.setState({showRuleEditorFlyout:e})})),Y()(this,"unsetShowRuleEditorFlyoutFunction",(()=>{this.setState({showRuleEditorFlyout:()=>{}})})),Y()(this,"onTableChange",(({page:e,sort:t})=>{const{tableState:a,updateTableState:i}=this.props;i({pageIndex:e&&void 0!==e.index?e.index:a.pageIndex,pageSize:e&&void 0!==e.size?e.size:a.pageSize,sortField:t&&void 0!==t.field&&"string"==typeof t.field?t.field:a.sortField,sortDirection:t&&void 0!==t.direction?t.direction:a.sortDirection})})),this.state={itemIdToExpandedRowMap:{},showRuleEditorFlyout:()=>{}}}static getDerivedStateFromProps(e,t){const a=t.itemIdToExpandedRowMap;return void 0!==Object.keys(a).find((t=>void 0===e.tableData.anomalies.find((e=>e.rowId===t))))?{itemIdToExpandedRowMap:{}}:null}render(){const{bounds:e,tableData:t,filter:a,influencerFilter:i,tableState:n}=this.props;if(void 0===t||void 0===t.anomalies||0===t.anomalies.length)return Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,null,Object(g.jsx)("h4",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.noMatchingAnomaliesFoundTitle",defaultMessage:"No matching anomalies found"})))));const l=function(e,t,a,i,n,s,l,c,d,u,p,b,f){const h=[{name:Object(g.jsx)(o.EuiScreenReaderOnly,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.showDetailsColumn.screenReaderDescription",defaultMessage:"This column contains clickable controls for showing more details on each anomaly"}))),render:e=>Object(g.jsx)(o.EuiButtonIcon,{onClick:()=>u(e),iconType:d[e.rowId]?"arrowDown":"arrowRight","aria-label":d[e.rowId]?r.i18n.translate("xpack.ml.anomaliesTable.hideDetailsAriaLabel",{defaultMessage:"Hide details"}):r.i18n.translate("xpack.ml.anomaliesTable.showDetailsAriaLabel",{defaultMessage:"Show details"}),"data-row-id":e.rowId,"data-test-subj":"mlAnomaliesListRowDetailsToggle"})},{field:"time","data-test-subj":"mlAnomaliesListColumnTime",name:r.i18n.translate("xpack.ml.anomaliesTable.timeColumnName",{defaultMessage:"Time"}),dataType:"date",scope:"row",render:e=>function(e,t){return"hour"===t?Object(Je.c)(e):"second"===t?Object(Je.d)(e):Object(Je.b)(e)}(e,n),textOnly:!0,sortable:!0},{field:"severity","data-test-subj":"mlAnomaliesListColumnSeverity",name:Object(g.jsx)(o.EuiToolTip,{content:r.i18n.translate("xpack.ml.overview.anomalyDetection.tableSeverityTooltip",{defaultMessage:"A normalized score between 0-100, which indicates the relative significance of the anomaly record results."})},Object(g.jsx)("span",null,r.i18n.translate("xpack.ml.anomaliesTable.severityColumnName",{defaultMessage:"Severity"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:(e,t)=>Object(g.jsx)(Rf,{score:e,multiBucketImpact:t.source.multi_bucket_impact}),sortable:!0},{field:"detector","data-test-subj":"mlAnomaliesListColumnDetector",name:r.i18n.translate("xpack.ml.anomaliesTable.detectorColumnName",{defaultMessage:"Detector"}),render:(e,t)=>Object(g.jsx)(yf,{detectorDescription:e,numberOfRules:t.rulesLength}),textOnly:!0,sortable:!0}];return e.some((e=>void 0!==e.entityValue))&&h.push({field:"entityValue","data-test-subj":"mlAnomaliesListColumnFoundFor",name:r.i18n.translate("xpack.ml.anomaliesTable.entityValueColumnName",{defaultMessage:"Found for"}),render:(e,t)=>Object(g.jsx)(Mf,{entityName:t.entityName,entityValue:e,filter:p,wrapText:!0}),textOnly:!0,sortable:!0}),e.some((e=>void 0!==e.influencers))&&h.push({field:"influencers","data-test-subj":"mlAnomaliesListColumnInfluencers",name:r.i18n.translate("xpack.ml.anomaliesTable.influencersColumnName",{defaultMessage:"Influenced by"}),render:e=>Object(g.jsx)(influencers_cell_InfluencersCell,{limit:5,influencers:e,influencerFilter:b}),textOnly:!0,sortable:!0}),e.some((e=>void 0!==e.actual))&&h.push({field:"actualSort","data-test-subj":"mlAnomaliesListColumnActual",name:Object(g.jsx)(o.EuiToolTip,{content:r.i18n.translate("xpack.ml.overview.anomalyDetection.tableActualTooltip",{defaultMessage:"The actual values in the anomaly record results."})},Object(g.jsx)("span",null,r.i18n.translate("xpack.ml.anomaliesTable.actualSortColumnName",{defaultMessage:"Actual"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:(e,t)=>{const a=If.a.getFieldFormat(t.jobId,t.source.detector_index);return Object(Df.b)(t.actual,t.source.function,a,t.source)},sortable:!0}),e.some((e=>void 0!==e.typical))&&(h.push({field:"typicalSort","data-test-subj":"mlAnomaliesListColumnTypical",name:Object(g.jsx)(o.EuiToolTip,{content:r.i18n.translate("xpack.ml.overview.anomalyDetection.tableTypicalTooltip",{defaultMessage:"The typical values in the anomaly record results."})},Object(g.jsx)("span",null,r.i18n.translate("xpack.ml.anomaliesTable.typicalSortColumnName",{defaultMessage:"Typical"}),Object(g.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:(e,t)=>{const a=If.a.getFieldFormat(t.jobId,t.source.detector_index);return Object(Df.b)(t.typical,t.source.function,a,t.source)},sortable:!0}),!0===e.some((e=>{const t=e.source.function;return"time_of_day"!==t&&"time_of_week"!==t}))&&h.push({field:"metricDescriptionSort","data-test-subj":"mlAnomaliesListColumnDescription",name:r.i18n.translate("xpack.ml.anomaliesTable.metricDescriptionSortColumnName",{defaultMessage:"Description"}),render:(e,t)=>Object(g.jsx)(vf,{actual:t.actual,typical:t.typical}),textOnly:!0,sortable:!0})),t&&t.length>1&&h.push({field:"jobId","data-test-subj":"mlAnomaliesListColumnJobID",name:r.i18n.translate("xpack.ml.anomaliesTable.jobIdColumnName",{defaultMessage:"Job ID"}),sortable:!0}),!0===e.some((e=>"mlcategory"===e.entityName))&&h.push({"data-test-subj":"mlAnomaliesListColumnCategoryExamples",name:r.i18n.translate("xpack.ml.anomaliesTable.categoryExamplesColumnName",{defaultMessage:"Category examples"}),truncateText:!0,render:e=>{const t=Object(Q.get)(a,[e.jobId,e.entityValue],[]);return Object(g.jsx)(o.EuiLink,{className:"mlAnomalyCategoryExamples__link",onClick:()=>u(e,1)},t.map(((e,t)=>Object(g.jsx)("span",{key:`example${t}`,className:"category-example"},e))))},width:"13%"}),!0===e.some((e=>Nf(e,l,f)))&&h.push({"data-test-subj":"mlAnomaliesListColumnAction",name:r.i18n.translate("xpack.ml.anomaliesTable.actionsColumnName",{defaultMessage:"Actions"}),render:e=>!0===Nf(e,l,f)?Object(g.jsx)(Ff,{anomaly:e,bounds:s,showViewSeriesLink:l,isAggregatedData:i,interval:n,showRuleEditorFlyout:c,sourceIndicesWithGeoFields:f}):null}),h}(t.anomalies,t.jobIds,t.examplesByJobId,this.isShowingAggregatedData(),t.interval,e,t.showViewSeriesLink,this.state.showRuleEditorFlyout,this.state.itemIdToExpandedRowMap,this.toggleRow,a,i,this.props.sourceIndicesWithGeoFields),c={sort:{field:n.sortField,direction:n.sortDirection}},d={pageIndex:n.pageIndex,pageSize:n.pageSize,totalItemCount:t.anomalies.length,pageSizeOptions:[10,25,100]};return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(xh,{setShowFunction:this.setShowRuleEditorFlyoutFunction,unsetShowFunction:this.unsetShowRuleEditorFlyoutFunction}),Object(g.jsx)(o.EuiInMemoryTable,{className:"ml-anomalies-table eui-textBreakWord",items:t.anomalies,columns:l,pagination:d,sorting:c,itemId:"rowId",itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,compressed:!0,rowProps:e=>({onMouseOver:()=>this.onMouseOverRow(e),onMouseLeave:()=>this.onMouseLeaveRow(),"data-test-subj":`mlAnomaliesListRow row-${e.rowId}`}),"data-test-subj":"mlAnomaliesTable",onTableChange:this.onTableChange}))}}const vh=e=>{const[t,a]=Object(v.b)("mlAnomaliesTable",{pageIndex:0,pageSize:25,sortField:"severity",sortDirection:"desc"});return Object(g.jsx)(anomalies_table_AnomaliesTableInternal,_()({},e,{tableState:t,updateTableState:a}))},yh="error",Oh="warning";function Eh({message:e,status:t,...a}){return Object(g.jsx)(o.EuiCallOut,_()({size:"s"},function(e,t){switch(t){case yh:return{title:e,iconType:"cross",color:"danger"};case Oh:return{title:e,iconType:"alert",color:"warning"};case"success":return{title:e,iconType:"check",color:"success"};case"info":return{title:e,iconType:"iInCircle",color:"primary"}}}(e,t),a))}function wh(e){return[{field:"forecast_create_timestamp",name:r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastsList.createdColumnName",{defaultMessage:"Created"}),dataType:"date",render:e=>Object(Je.d)(e),sortable:!0},{field:"forecast_start_timestamp",name:r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastsList.fromColumnName",{defaultMessage:"From"}),dataType:"date",render:e=>Object(Je.d)(e),sortable:!0},{field:"forecast_end_timestamp",name:r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastsList.toColumnName",{defaultMessage:"To"}),dataType:"date",render:e=>Object(Je.d)(e),sortable:!0},{name:r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastsList.viewColumnName",{defaultMessage:"View"}),width:"60px",render:t=>{const a=r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastsList.viewForecastAriaLabel",{defaultMessage:"View forecast created at {createdDate}",values:{createdDate:Object(Je.d)(t.forecast_create_timestamp)}});return Object(g.jsx)(o.EuiButtonIcon,{onClick:()=>e(t.forecast_id),iconType:"visLine","aria-label":a})}}]}function Mh({forecasts:e,viewForecast:t}){return Object(g.jsx)(o.EuiText,null,Object(g.jsx)("h3",{"aria-describedby":"ml_aria_description_forecasting_modal_view_list",style:{display:"inline",paddingRight:"5px"}},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.forecastsList.previousForecastsTitle",defaultMessage:"Previous forecasts"})),Object(g.jsx)(o.EuiToolTip,{position:"right",content:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.forecastsList.listsOfFiveRecentlyRunForecastsTooltip",defaultMessage:"Lists a maximum of five of the most recently run forecasts."})},Object(g.jsx)(o.EuiIcon,{type:"questionInCircle",size:"s"})),Object(g.jsx)(o.EuiInMemoryTable,{items:e,columns:wh(t),pagination:!1,"data-test-subj":"mlModalForecastTable",rowProps:e=>({"data-test-subj":`mlForecastsListRow row-${e.rowId}`})}))}Mh.propType={forecasts:Zr.a.array,viewForecast:Zr.a.func.isRequired};const Sh=-1,_h=-10;function Th({state:e}){return 0===e?Object(g.jsx)(o.EuiLoadingSpinner,{size:"m"}):1===e?Object(g.jsx)(o.EuiIcon,{type:"check",size:"m",color:"primary"}):e===_h?Object(g.jsx)(o.EuiIcon,{type:"cross",size:"m",color:"danger"}):void 0}function Ch({forecastProgress:e,jobOpeningState:t,jobClosingState:a}){return Object(g.jsx)("div",null,t!==Sh&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"m"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.forecastingModal.openingJobTitle",defaultMessage:"Opening job…"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Th,{state:t}))),Object(g.jsx)(o.EuiSpacer,{size:"s"})),e!==Sh&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"m"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.forecastingModal.runningForecastTitle",defaultMessage:"Running forecast…"}))),e>=0&&Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiToolTip,{position:"top",content:e+"%"},Object(g.jsx)(o.EuiProgress,{size:"l",value:e,max:100}))),e===_h&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Th,{state:_h}))),Object(g.jsx)(o.EuiSpacer,{size:"s"})),a!==Sh&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"m"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.forecastingModal.closingJobTitle",defaultMessage:"Closing job…"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Th,{state:a})))))}function kh({job:e,newForecastDuration:t,isNewForecastDurationValid:a,newForecastDurationErrors:i,onNewForecastDurationChange:n,runForecast:s,isForecastRequested:l,forecastProgress:c,jobOpeningState:d,jobClosingState:u}){const p=function(e,t){return!1===Object($.b)()?{isDisabled:!0,isDisabledToolTipText:r.i18n.translate("xpack.ml.timeSeriesExplorer.runControls.noMLNodesAvailableTooltip",{defaultMessage:"There are no ML nodes available."})}:!1===Object(w.e)("canForecastJob")?{isDisabled:!0,isDisabledToolTipText:Object(w.f)("canForecastJob")}:e.state!==ae.c.OPENED&&e.state!==ae.c.CLOSED?{isDisabled:!0,isDisabledToolTipText:r.i18n.translate("xpack.ml.timeSeriesExplorer.runControls.forecastsCanNotBeRunOnJobsTooltip",{defaultMessage:"Forecasts cannot be run on {jobState} jobs",values:{jobState:e.state}})}:{isDisabled:t}}(e,l),b=Object(g.jsx)(o.EuiFieldText,{name:"forecastDuration",value:t,disabled:p.isDisabled,isInvalid:!a,onChange:n,fullWidth:!0}),f=Object(g.jsx)(o.EuiButton,{onClick:s,isDisabled:p.isDisabled||!a,"data-test-subj":"mlModalForecastButtonRun"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.runControls.runButtonLabel",defaultMessage:"Run"}));return Object(g.jsx)("div",null,Object(g.jsx)(o.EuiText,null,Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.runControls.runNewForecastTitle",defaultMessage:"Run a new forecast"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiForm,null,Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.runControls.durationLabel",defaultMessage:"Duration"}),fullWidth:!0,isInvalid:!a,error:i,helpText:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.runControls.forecastMaximumLengthHelpText",defaultMessage:"Length of forecast, up to a maximum of {maximumForecastDurationDays} days. Use s for seconds, m for minutes, h for hours, d for days, w for weeks.",values:{maximumForecastDurationDays:Ih}})},void 0===p.isDisabledToolTipText?b:Object(g.jsx)(o.EuiToolTip,{position:"right",content:p.isDisabledToolTipText},b))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{hasEmptyLabelSpace:!0},void 0===p.isDisabledToolTipText?f:Object(g.jsx)(o.EuiToolTip,{position:"left",content:p.isDisabledToolTipText},f))))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),!0===l&&Object(g.jsx)(Ch,{forecastProgress:c,jobOpeningState:d,jobClosingState:u}))}function Fh(e){return Object(g.jsx)(o.EuiModal,{onClose:e.close,maxWidth:860,"data-test-subj":"mlModalForecast"},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.forecastingModal.forecastingTitle",defaultMessage:"Forecasting"}))),Object(g.jsx)(o.EuiModalBody,null,e.messages.map(((e,t)=>Object(g.jsx)(s.a.Fragment,{key:t},Object(g.jsx)(Eh,e),Object(g.jsx)(o.EuiSpacer,{size:"m"})))),e.forecasts.length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(Mh,{forecasts:e.forecasts,viewForecast:e.viewForecast}),Object(g.jsx)(o.EuiSpacer,null)),Object(g.jsx)(kh,e)),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:e.close,size:"s","data-test-subj":"mlModalForecastButtonClose"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.forecastingModal.closeButtonLabel",defaultMessage:"Close"}))))}Ch.propType={forecastProgress:Zr.a.number,jobOpeningState:Zr.a.number,jobClosingState:Zr.a.number},kh.propType={job:Zr.a.object,newForecastDuration:Zr.a.string,isNewForecastDurationValid:Zr.a.bool,newForecastDurationErrors:Zr.a.array,onNewForecastDurationChange:Zr.a.func.isRequired,runForecast:Zr.a.func.isRequired,isForecastRequested:Zr.a.bool,forecastProgress:Zr.a.number,jobOpeningState:Zr.a.number,jobClosingState:Zr.a.number},Fh.propType={job:Zr.a.object,forecasts:Zr.a.array,close:Zr.a.func.isRequired,viewForecast:Zr.a.func.isRequired,runForecast:Zr.a.func.isRequired,newForecastDuration:Zr.a.string,isNewForecastDurationValid:Zr.a.bool,newForecastDurationErrors:Zr.a.array,onNewForecastDurationChange:Zr.a.func.isRequired,isForecastRequested:Zr.a.bool,forecastProgress:Zr.a.number,jobOpeningState:Zr.a.number,jobClosingState:Zr.a.number,messages:Zr.a.array};const Ih=3650,Dh="6.1.0",Ah=864e5*Ih,Lh=12e4;function Rh(){return{isModalVisible:!1,previousForecasts:[],isForecastRequested:!1,forecastProgress:Sh,jobOpeningState:Sh,jobClosingState:Sh,newForecastDuration:"1d",isNewForecastDurationValid:!0,newForecastDurationErrors:[],messages:[]}}class forecasting_modal_ForecastingModalUI extends n.Component{constructor(e){super(e),Y()(this,"addMessage",((e,t,a=!1)=>{const i={message:e,status:t};this.setState((e=>({messages:a?[i]:[...e.messages,i]})))})),Y()(this,"viewForecast",(e=>{this.props.setForecastId(e),this.closeModal()})),Y()(this,"onNewForecastDurationChange",(e=>{const t=[];let a=!0;const i=Object(se.a)(e.target.value);null===i?(a=!1,t.push(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.invalidDurationFormatErrorMessage",{defaultMessage:"Invalid duration format"}))):i.asMilliseconds()>Ah?(a=!1,t.push(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.forecastDurationMustNotBeGreaterThanMaximumErrorMessage",{defaultMessage:"Forecast duration must not be greater than {maximumForecastDurationDays} days",values:{maximumForecastDurationDays:Ih}}))):0===i.asMilliseconds()&&(a=!1,t.push(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.forecastDurationMustNotBeZeroErrorMessage",{defaultMessage:"Forecast duration must not be zero"}))),this.setState({newForecastDuration:e.target.value,isNewForecastDurationValid:a,newForecastDurationErrors:t})})),Y()(this,"checkJobStateAndRunForecast",(()=>{this.setState({isForecastRequested:!0,messages:[]}),this.props.job.state===ae.c.CLOSED?this.openJobAndRunForecast():this.runForecast(!1)})),Y()(this,"openJobAndRunForecast",(()=>{this.setState({jobOpeningState:0}),K.a.openJob(this.props.job.job_id).then((()=>{this.setState({jobOpeningState:1}),this.runForecast(!0)})).catch((e=>{console.log("Time series forecast modal - could not open job:",e),this.addMessage(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithOpeningJobBeforeRunningForecastErrorMessage",{defaultMessage:"Error opening job before running forecast"}),yh),this.setState({jobOpeningState:_h})}))})),Y()(this,"runForecastErrorHandler",((e,t)=>{this.setState({forecastProgress:_h}),console.log("Time series forecast modal - error running forecast:",e);const a=e?Object(da.b)(e):void 0;a&&a.length>0?this.addMessage(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorRunningForecastMessage",{defaultMessage:"An error has occurred running the forecast: {errorMessage}",values:{errorMessage:a}}),yh,!0):this.addMessage(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.unexpectedResponseFromRunningForecastErrorMessage",{defaultMessage:"Unexpected response from running forecast. The request may have failed."}),yh,!0),!0===t&&(this.setState({jobClosingState:0}),K.a.closeJob(this.props.job.job_id).then((()=>{this.setState({jobClosingState:1})})).catch((e=>{console.log("Time series forecast modal - could not close job:",e),this.addMessage(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithClosingJobErrorMessage",{defaultMessage:"Error closing job"}),yh),this.setState({jobClosingState:_h})})))})),Y()(this,"runForecast",(e=>{this.setState({forecastProgress:0});const t=Object(se.a)(this.state.newForecastDuration).asSeconds();Ua(this.props.job.job_id,`${t}s`).then((t=>{void 0!==t.forecast_id?this.waitForForecastResults(t.forecast_id,e):this.runForecastErrorHandler(t,e)})).catch((t=>this.runForecastErrorHandler(t,e)))})),Y()(this,"waitForForecastResults",((e,t)=>{let a=0,i=0;this.forecastChecker=setInterval((()=>{Ga(this.props.job,e).then((n=>{const s=Object(Q.get)(n,["stats","forecast_progress"],a),o=Object(Q.get)(n,["stats","forecast_status"]);s>a&&this.setState({forecastProgress:Math.round(100*s)});let l=Object(Q.get)(n,["stats","forecast_messages"],[]);l=l.map((e=>({message:e,status:Oh}))),this.setState({messages:l}),o===ae.b.FINISHED?(clearInterval(this.forecastChecker),!0===t?(this.setState({jobClosingState:0}),K.a.closeJob(this.props.job.job_id).then((()=>{this.setState({jobClosingState:1}),this.props.setForecastId(e),this.closeAfterRunningForecast()})).catch((t=>{console.log("Time series forecast modal - could not close job:",t),this.addMessage(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithClosingJobAfterRunningForecastErrorMessage",{defaultMessage:"Error closing job after running forecast"}),yh),this.setState({jobClosingState:_h}),this.props.setForecastId(e)}))):(this.props.setForecastId(e),this.closeAfterRunningForecast())):s===a?(i+=250,i>Lh&&(console.log("Forecast request has not progressed for 120000ms. Cancelling check."),this.addMessage(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.noProgressReportedForNewForecastErrorMessage",{defaultMessage:"No progress reported for the new forecast for {WarnNoProgressMs}ms.An error may have occurred whilst running the forecast.",values:{WarnNoProgressMs:Lh}}),yh),this.props.setForecastId(e),this.setState({forecastProgress:_h}),clearInterval(this.forecastChecker))):(s>a&&(a=s),i=0)})).catch((e=>{console.log("Time series forecast modal - error loading stats of forecast from elasticsearch:",e),this.addMessage(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithLoadingStatsOfRunningForecastErrorMessage",{defaultMessage:"Error loading stats of running forecast."}),yh),this.setState({forecastProgress:_h}),clearInterval(this.forecastChecker)}))}),250)})),Y()(this,"openModal",(()=>{const e=this.props.job;if("object"==typeof e){const{timefilter:t}=this.props.kibana.services.data.query.timefilter,a=t.getActiveBounds(),i={term:{forecast_status:ae.b.FINISHED}};Ba(e,i,a.min.valueOf(),5).then((e=>{this.setState({previousForecasts:e.forecasts})})).catch((e=>{console.log("Time series forecast modal - error obtaining forecasts summary:",e),this.addMessage(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithObtainingListOfPreviousForecastsErrorMessage",{defaultMessage:"Error obtaining list of previous forecasts"}),yh)}));const n=this.props.entities.map((e=>e.fieldName));n.length>0&&X.ml.getCardinalityOfFields({index:e.datafeed_config.indices,fieldNames:n,query:e.datafeed_config.query,timeFieldName:e.data_description.time_field,earliestMs:e.data_counts.earliest_record_timestamp,latestMs:e.data_counts.latest_record_timestamp}).then((e=>{let t=1;Object.values(e).forEach((e=>{t*=e})),t>100&&this.addMessage(r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.dataContainsMorePartitionsMessage",{defaultMessage:"Note that this data contains more than {warnNumPartitions} partitions so running a forecast may take a long time and consume a high amount of resource",values:{warnNumPartitions:100}}),Oh)})).catch((e=>{console.log("Time series forecast modal - error obtaining cardinality of fields:",e)})),this.setState({isModalVisible:!0})}})),Y()(this,"closeAfterRunningForecast",(()=>{0===this.state.messages.length&&setTimeout((()=>{this.closeModal()}),1e3)})),Y()(this,"closeModal",(()=>{null!==this.forecastChecker&&clearInterval(this.forecastChecker),this.setState(Rh())})),this.state=Rh(),this.forecastChecker=null}render(){let e=!1,t=null;const{job:a}=this.props;void 0!==a&&(void 0!==a.analysis_config.detectors[this.props.detectorIndex].over_field_name?(e=!0,t=r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.forecastingNotAvailableForPopulationDetectorsMessage",{defaultMessage:"Forecasting is not available for population detectors with an over field"})):!1===Object(Qe.l)(a,Dh)&&(e=!0,t=r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastingModal.forecastingOnlyAvailableForJobsCreatedInSpecifiedVersionMessage",{defaultMessage:"Forecasting is only available for jobs created in version {minVersion} or later",values:{minVersion:Dh}})));const i=Object(g.jsx)(o.EuiButton,{onClick:this.openModal,isDisabled:e,"data-test-subj":"mlSingleMetricViewerButtonForecast"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.forecastingModal.forecastButtonLabel",defaultMessage:"Forecast"}));return Object(g.jsx)("div",null,e?Object(g.jsx)(o.EuiToolTip,{position:"left",content:t},i):i,this.state.isModalVisible&&Object(g.jsx)(Fh,{job:this.props.job,forecasts:this.state.previousForecasts,close:this.closeModal,viewForecast:this.viewForecast,runForecast:this.checkJobStateAndRunForecast,newForecastDuration:this.state.newForecastDuration,onNewForecastDurationChange:this.onNewForecastDurationChange,isNewForecastDurationValid:this.state.isNewForecastDurationValid,newForecastDurationErrors:this.state.newForecastDurationErrors,isForecastRequested:this.state.isForecastRequested,forecastProgress:this.state.forecastProgress,jobOpeningState:this.state.jobOpeningState,jobClosingState:this.state.jobClosingState,messages:this.state.messages}))}}const Nh=Object(c.withKibana)(forecasting_modal_ForecastingModalUI);var Ph=a(242);const zh=[{value:"auto",text:r.i18n.translate("xpack.ml.controls.selectInterval.autoLabel",{defaultMessage:"Auto"})},{value:"hour",text:r.i18n.translate("xpack.ml.controls.selectInterval.hourLabel",{defaultMessage:"1 hour"})},{value:"day",text:r.i18n.translate("xpack.ml.controls.selectInterval.dayLabel",{defaultMessage:"1 day"})},{value:"second",text:r.i18n.translate("xpack.ml.controls.selectInterval.showAllLabel",{defaultMessage:"Show all"})}];function Bh(e){const t=zh.find((t=>t.value===e));let a={display:zh[0].text,val:zh[0].value};return void 0!==t&&(a={display:t.text,val:t.value}),a}const Vh=Bh("auto"),Jh=()=>{const[e,t]=Object(v.b)("mlSelectInterval",Vh);return[e,t]},Uh=()=>{const[e,t]=Jh();return Object(g.jsx)(Gh,{interval:e,onChange:t})},Gh=({interval:e,onChange:t})=>Object(g.jsx)(o.EuiSelect,{prepend:r.i18n.translate("xpack.ml.explorer.intervalLabel",{defaultMessage:"Interval"}),append:Object(g.jsx)(o.EuiToolTip,{content:r.i18n.translate("xpack.ml.explorer.intervalTooltip",{defaultMessage:"Show only the highest severity anomaly for each interval (such as hour or day) or show all anomalies in the selected time period."})},Object(g.jsx)(o.EuiIcon,{type:"questionInCircle",color:"subdued"})),compressed:!0,id:"selectInterval",options:zh,value:e.val,onChange:e=>{t(Bh(e.target.value))}});var qh=a(147);const $h=({dataNotChartable:e,entities:t})=>Object(g.jsx)(o.EuiEmptyPrompt,{iconType:"iInCircle",title:Object(g.jsx)("h2",null,r.i18n.translate("xpack.ml.timeSeriesExplorer.noResultsFoundLabel",{defaultMessage:"No results found"})),body:e?Object(g.jsx)("p",null,r.i18n.translate("xpack.ml.timeSeriesExplorer.dataNotChartableDescription",{defaultMessage:"Model plot is not collected for the selected {entityCount, plural, one {entity} other {entities}}\nand the source data cannot be plotted for this detector.",values:{entityCount:t.length}})):Object(g.jsx)("p",null,r.i18n.translate("xpack.ml.timeSeriesExplorer.tryWideningTheTimeSelectionDescription",{defaultMessage:"Try widening the time selection or moving further back in time."}))}),Wh=({viewId:e,selectedJobs:t})=>{const a=Object(y.d)(),i=Object(y.e)(),s=0===(null!=t?t:[]).filter((e=>e.isSingleMetricViewerJob)).length,l=Object(n.useMemo)((()=>{var a;return[{id:"timeseriesexplorer",label:"explorer"===e&&s?r.i18n.translate("xpack.ml.anomalyResultsViewSelector.singleMetricViewerDisabledLabel",{defaultMessage:"Selected {jobsCount, plural, one {job is} other {jobs are}} not viewable in the Single Metric Viewer",values:{jobsCount:null!==(a=null==t?void 0:t.length)&&void 0!==a?a:0}}):r.i18n.translate("xpack.ml.anomalyResultsViewSelector.singleMetricViewerLabel",{defaultMessage:"View results in the Single Metric Viewer"}),iconType:"visLine",value:E.b.SINGLE_METRIC_VIEWER,"data-test-subj":"mlAnomalyResultsViewSelectorSingleMetricViewer",isDisabled:"explorer"===e&&s},{id:"explorer",label:r.i18n.translate("xpack.ml.anomalyResultsViewSelector.anomalyExplorerLabel",{defaultMessage:"View results in the Anomaly Explorer"}),iconType:"visTable",value:E.b.ANOMALY_EXPLORER,"data-test-subj":"mlAnomalyResultsViewSelectorExplorer"}]}),[s,null==t?void 0:t.length]),[c]=Object(v.c)("_g");return Object(g.jsx)(o.EuiButtonGroup,{legend:r.i18n.translate("xpack.ml.anomalyResultsViewSelector.buttonGroupLegend",{defaultMessage:"Anomaly results view selector"}),name:"anomalyResultsViewSelector","data-test-subj":"mlAnomalyResultsViewSelector",options:l,idSelected:e,onChange:e=>(async e=>{const t=await a.getUrl({page:e,pageState:{globalState:c}});await i(t)})(e),isIconOnly:!0})};var Hh=a(182);const Yh=({children:e,dateFormatTz:t,resizeRef:a,noSingleMetricJobsFound:i})=>{const{services:{docLinks:n}}=Object(y.b)(),r=n.links.ml.anomalyDetection;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("div",{className:"ml-time-series-explorer",ref:a,"data-test-subj":"mlPageSingleMetricViewer"},Object(g.jsx)(on.a,null,Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Wh,{viewId:"timeseriesexplorer"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.pageTitle",defaultMessage:"Single Metric Viewer"})))),i?null:Object(g.jsx)(Hh.a,{dateFormatTz:t,singleSelection:!0,timeseriesOnly:!0}),e,Object(g.jsx)(sn.a,{docLink:r})))},Xh="CLEAR",Qh="SET_DETECTOR_INDEX",Kh="SET_ENTITIES",Zh="SET_FORECAST_ID",eg="SET_ZOOM",tg="SET_FUNCTION_DESCRIPTION",ag=500;function ig(e,t){const a=e.analysis_config,i=a.detectors[t],n={jobId:e.job_id,detectorIndex:t,metricFunction:i.function===xt.b.LAT_LONG?xt.b.LAT_LONG:Object(Qe.r)(i.function),timeField:e.data_description.time_field,interval:e.analysis_config.bucket_span,datafeedConfig:e.datafeed_config,summaryCountFieldName:e.analysis_config.summary_count_field_name};void 0!==i.field_name&&(n.metricFieldName=i.field_name);const s=a.summary_count_field_name;if(n.metricFunction===xt.a.COUNT&&void 0!==s&&s!==Ft.a&&s!==Ft.d){let t;const a=Object(Q.get)(e.datafeed_config,"aggregations")||Object(Q.get)(e.datafeed_config,"aggs");void 0!==a&&Object.values(a).length>0&&(t=Object(Q.get)(Object.values(a)[0],["aggregations",s,xt.a.CARDINALITY,"field"])||Object(Q.get)(Object.values(a)[0],["aggs",s,xt.a.CARDINALITY,"field"])),i.function!==xt.b.NON_ZERO_COUNT&&i.function!==xt.b.LOW_NON_ZERO_COUNT&&i.function!==xt.b.HIGH_NON_ZERO_COUNT&&i.function!==xt.b.COUNT&&i.function!==xt.b.HIGH_COUNT&&i.function!==xt.b.LOW_COUNT||void 0===t?(n.metricFunction=xt.a.SUM,n.metricFieldName=s):(n.metricFunction=xt.a.CARDINALITY,n.metricFieldName=void 0)}return n}const ng=function(e,t,a,i,n,s,o){if(Object(Qe.m)(e,t)&&Object(Qe.n)(e,t,a)){const o=[],r=e.analysis_config.detectors[t];if(void 0!==r.partition_field_name){const e=Object(Q.find)(a,{fieldName:r.partition_field_name});void 0!==e&&o.push({fieldName:"partition_field_name",fieldValue:e.fieldName},{fieldName:"partition_field_value",fieldValue:e.fieldValue})}if(void 0!==r.over_field_name){const e=Object(Q.find)(a,{fieldName:r.over_field_name});void 0!==e&&o.push({fieldName:"over_field_name",fieldValue:e.fieldName},{fieldName:"over_field_value",fieldValue:e.fieldValue})}if(void 0!==r.by_field_name){const e=Object(Q.find)(a,{fieldName:r.by_field_name});void 0!==e&&o.push({fieldName:"by_field_name",fieldValue:e.fieldName},{fieldName:"by_field_value",fieldValue:e.fieldValue})}return mt.mlResultsService.getModelPlotOutput(e.job_id,t,o,i,n,s)}{const r={success:!0,results:{}},l=ig(e,t);return mt.mlResultsService.getMetricData(l.datafeedConfig.indices,a,l.datafeedConfig.query,null!=o?o:l.metricFunction,l.metricFieldName,l.summaryCountFieldName,l.timeField,i,n,s,null==l?void 0:l.datafeedConfig).pipe(Object(za.map)((e=>(Object(Q.each)(e.results,((e,t)=>{r.results[t]={actual:e}})),r))))}},sg=function(e,t,a,i,n){return new Promise(((s,o)=>{const r={success:!0,results:{functionLabel:"",entityData:{entities:[]}}},l=ig(e,t);let c=l.metricFunction;void 0!==l.metricFieldName&&(c+=" ",c+=l.metricFieldName),r.results.functionLabel=c;const d=Object(Q.filter)(a,(e=>null===e.fieldValue));if(0===d.length)r.results.entityData.count=1,r.results.entityData.entities=a,s(r);else{const e=d.map((e=>e.fieldName));X.ml.getCardinalityOfFields({index:l.datafeedConfig.indices,fieldNames:e,query:l.datafeedConfig.query,timeFieldName:l.timeField,earliestMs:i,latestMs:n}).then((e=>{Object(Q.each)(d,(t=>{r.results.entityData.entities.push({fieldName:t.fieldName,cardinality:Object(Q.get)(e,t.fieldName,0)})})),s(r)})).catch((e=>{o(e)}))}}))};function og(e){return e.filter(Qe.q).map((e=>{const t=Object(se.a)(e.analysis_config.bucket_span);return{id:e.job_id,selected:!1,bucketSpanSeconds:t.asSeconds()}}))}function rg(e,t){const a=[];return!0===t?Object(Q.each)(e,((e,t)=>{a.push({date:new Date(+t),lower:e.modelLower,value:e.actual,upper:e.modelUpper})})):Object(Q.each)(e,((e,t)=>{a.push({date:new Date(+t),value:e.actual})})),a}function lg(e){const t=[];return Object(Q.each)(e,((e,a)=>{t.push({date:new Date(+a),isForecast:!0,lower:e.forecastLower,value:e.prediction,upper:e.forecastUpper})})),t}function cg(e,t,a){let i;if(void 0===e)return i;for(let a=0;a<e.length;a++)if(e[a].date.getTime()===t){i=e[a];break}if(void 0===i){let n;const s=a.asMilliseconds();for(let a=0;a<e.length;a++)if(t-e[a].date.getTime()<s){n=e[a];break}i=n}return i}function dg(e,t,a,i){const n=void 0!==t?t:100,s=Math.floor(1.1*n),o=Object(Gt.c)();o.setInterval("auto"),o.setBounds(e),o.setBarTarget(Math.floor(n)),o.setMaxBars(s);const r=Object(Q.find)(a,{id:i.job_id}).bucketSpanSeconds;let l=o.getIntervalToNearestMultiple(r);return l.asSeconds()<r&&(o.setInterval(r+"s"),l=o.getInterval()),l}function ug(e,t,a,i,n,s,o,r,l){const c=void 0!==l?pt.c.toES(l):l;return Object(at.forkJoin)([ng(r,t,s,o.min.valueOf(),o.max.valueOf(),a.asMilliseconds(),c),X.ml.results.getAnomalyRecords$([r.job_id],e,0,o.min.valueOf(),o.max.valueOf(),a.expression,l),mt.mlResultsService.getScheduledEventsByBucket([r.job_id],o.min.valueOf(),o.max.valueOf(),a.asMilliseconds(),1,10),X.ml.annotations.getAnnotations$({jobIds:[r.job_id],earliestMs:o.min.valueOf(),latestMs:o.max.valueOf(),maxAnnotations:nt.a,detectorIndex:t,entities:s}).pipe(Object(za.catchError)((e=>Object(at.of)({annotations:{},totalCount:0,error:Object(da.b)(e),success:!1})))),void 0!==i?(()=>{let e;const l=r.analysis_config.detectors[t],c=Object(Qe.r)(l.function);return n||"sum"!==c&&"count"!==c||(e={avg:"sum",max:"sum",min:"sum"}),Ja(r,t,i,s,o.min.valueOf(),o.max.valueOf(),a.asMilliseconds(),e)})():Object(at.of)(null)]).pipe(Object(za.map)((([e,t,i,s,o])=>{const c=t.records.sort(((e,t)=>e.timestamp-t.timestamp)).reverse(),d=i.events[r.job_id];let u=rg(e.results,n);u=function(e,t,a,i,n){const s=[],o=a.asMilliseconds();let r;return void 0!==e&&e.length>0&&(r=e[e.length-1].date.getTime()),t.forEach((t=>{const i=t.timestamp;if(void 0===cg(e,i,a)){const e=Math.floor(i/o)*o;-1===s.indexOf(e)&&e!==r&&s.push(e)}})),s.sort(((e,t)=>e-t)),s.forEach((t=>{const a={date:new Date(t),value:null};!0===i&&(a.upper=null,a.lower=null),e.push(a)})),t.forEach((t=>{const i=t.timestamp;if(t.function===xt.b.METRIC&&t.function_description!==n)return;const s=cg(e,i,a);if(void 0!==s){const e=t.record_score,a=s.anomalyScore;if(void 0===a||a<e){if(s.anomalyScore=e,s.function=t.function,void 0!==t.actual)null===s.value&&(s.value=t.actual),t.function===xt.b.METRIC&&(s.value=Array.isArray(t.actual)?t.actual[0]:t.actual),s.actual=t.actual,s.typical=t.typical;else{const e=Object(Q.get)(t,"causes",[]);if(e.length>0&&(s.byFieldName=t.by_field_name,s.numberOfCauses=e.length,1===e.length)){const e=t.causes[0];s.actual=e.actual,s.typical=e.typical,null===s.value&&(s.value=e.actual)}}void 0!==t.multi_bucket_impact&&(s.multiBucketImpact=t.multi_bucket_impact)}}})),e}(u,c,a,n,l),u=function(e,t,a){if(void 0!==t){const i=[],n=a.asMilliseconds();let s;void 0!==e&&e.length>0&&(s=e[e.length-1].date.getTime());let o=!1;Object(Q.each)(t,((t,a)=>{const r=function(e,t){let a;if(void 0===e)return a;for(let i=0;i<e.length;i++)if(e[i].date.getTime()===t){a=e[i];break}return a}(e,+a);if(void 0!==r)r.scheduledEvents=t;else{const r=Math.floor(a/n)*n;if(-1===i.indexOf(r)&&r!==s){const a={date:new Date(r),value:null,scheduledEvents:t};e.push(a),o=!0}}})),!0===o&&e.sort(((e,t)=>e.date.getTime()-t.date.getTime()))}return e}(u,d,a);const p={scheduledEvents:d,anomalyRecords:c,focusChartData:u};var m;return s&&(void 0!==s.error?(p.focusAnnotationError=s.error,p.focusAnnotationData=[]):p.focusAnnotationData=(null!==(m=s.annotations[r.job_id])&&void 0!==m?m:[]).sort(((e,t)=>e.timestamp-t.timestamp)).map(((e,t)=>(e.key=(t+1).toString(),e)))),o&&(p.focusForecastData=lg(o.results),p.showForecastCheckbox=p.focusForecastData.length>0),p})))}function pg(e,t,a){const i=K.a.getJob(a),n=[];if(void 0===i)return n;const s=e,o=i.analysis_config.detectors[s],r=t,l=null==o?void 0:o.partition_field_name,c=null==o?void 0:o.over_field_name,d=null==o?void 0:o.by_field_name;if(void 0!==l){var u;const e=null!==(u=null==r?void 0:r[l])&&void 0!==u?u:null;n.push({fieldType:"partition_field",fieldName:l,fieldValue:e})}if(void 0!==c){var p;const e=null!==(p=null==r?void 0:r[c])&&void 0!==p?p:null;n.push({fieldType:"over_field",fieldName:c,fieldValue:e})}if(void 0!==d&&void 0===c){var m;const e=null!==(m=null==r?void 0:r[d])&&void 0!==m?m:null;n.push({fieldType:"by_field",fieldName:d,fieldValue:e})}return n}function mg(e,t){const a=gf(e);if(Array.isArray(a)&&a.length>=t){const a=e.analysis_config.detectors[t];if((null==a?void 0:a.function)===xt.b.METRIC)return!0}return!1}const bg=[{value:"mean",text:r.i18n.translate("xpack.ml.timeSeriesExplorer.plotByAvgOptionLabel",{defaultMessage:"mean"})},{value:"min",text:r.i18n.translate("xpack.ml.timeSeriesExplorer.plotByMinOptionLabel",{defaultMessage:"min"})},{value:"max",text:r.i18n.translate("xpack.ml.timeSeriesExplorer.plotByMaxOptionLabel",{defaultMessage:"max"})}],fg=({functionDescription:e,setFunctionDescription:t,selectedDetectorIndex:a,selectedJobId:i,selectedEntities:s,entityControlsCount:l})=>{const c=Object(Z.c)(),d=Object(n.useCallback)((async(e,a,i,n)=>{const s=await(async({selectedDetectorIndex:e,selectedEntities:t,selectedJobId:a,selectedJob:i},n)=>{if(!mg(i,e))return;const s=[{fieldName:"detector_index",fieldValue:e},...pg(e,t,a).filter((e=>null!==e.fieldValue))];try{const e=await Object(at.lastValueFrom)(mt.mlResultsService.getRecordsForCriteria([i.job_id],s,0,null,null,1));if(Array.isArray(null==e?void 0:e.records)&&1===e.records.length){const t=e.records[0];return null==t?void 0:t.function_description}return xt.a.AVG}catch(e){n.displayErrorToast(e,r.i18n.translate("xpack.ml.timeSeriesExplorer.highestAnomalyScoreErrorToastTitle",{defaultMessage:"An error occurred getting record with the highest anomaly score"}))}})({selectedDetectorIndex:e,selectedEntities:a,selectedJobId:i,selectedJob:n},c);t(s)}),[t,c]);return Object(n.useEffect)((()=>{if(void 0!==e)return;const t=K.a.getJob(i);if((0===l||l>0&&void 0!==s)&&void 0===e&&mg(t,a)){const e=t.analysis_config.detectors[a];(null==e?void 0:e.function)===xt.b.METRIC&&d(a,s,i,t)}}),[t,a,s,i,e,l]),void 0===e?null:Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{label:r.i18n.translate("xpack.ml.timeSeriesExplorer.metricPlotByOption",{defaultMessage:"Function"})},Object(g.jsx)(o.EuiSelect,{options:bg,value:e,onChange:e=>t(e.target.value),"aria-label":r.i18n.translate("xpack.ml.timeSeriesExplorer.metricPlotByOptionLabel",{defaultMessage:"Pick function to plot by (min, max, or average) if metric function"})})))},hg=({bounds:e,selectedDetectorIndex:t,selectedJobId:a,appStateHandler:i,children:s,selectedEntities:r,functionDescription:l,setFunctionDescription:c})=>{var d;const{services:{mlServices:{mlApiServices:{results:u}}}}=Object(y.b)(),p=Object(n.useMemo)((()=>K.a.getJob(a)),[a]),b=!(null===(d=p.model_plot_config)||void 0===d||!d.enabled),[f,h]=Object(n.useState)(!1),[j,x]=Object(n.useState)({}),v=Object(n.useMemo)((()=>gf(p)),[p]),O=Object(n.useMemo)((()=>pg(t,r,a)),[t,r,a]),[E,w]=Object(ts.b)(as.c),M=Object(n.useMemo)((()=>{return{...(e=O.map((e=>e.fieldType)),t=!E||Object.values(E).some((e=>!(null==e||!e.anomalousOnly))),a=!E||Object.values(E).some((e=>!(null==e||!e.applyTimeRange))),e.reduce(((e,i)=>(e[i]={applyTimeRange:a,anomalousOnly:t,sort:{by:"anomaly_score",order:"desc"}},e)),{})),...E||{}};var e,t,a}),[O,E]),S=async(a={})=>{h(!0);const i=t,n=M?Object.fromEntries(Object.entries(M).filter((([e])=>O.some((t=>t.fieldType===e))))):void 0,{partition_field:s,over_field:o,by_field:r}=await Object(at.lastValueFrom)(u.fetchPartitionFieldsValues(p.job_id,a,[{fieldName:"detector_index",fieldValue:i}],e.min.valueOf(),e.max.valueOf(),n)),l={};O.forEach((e=>{let t;(null==s?void 0:s.name)===e.fieldName&&(t=s.values),(null==o?void 0:o.name)===e.fieldName&&(t=o.values),(null==r?void 0:r.name)===e.fieldName&&(t=r.values),l[e.fieldName]=t})),h(!1),x(l)};Object(n.useEffect)((()=>{S()}),[a,t,JSON.stringify(r),M]);const _=Object(Q.debounce)((async(e,t)=>{await S({[e.fieldType]:t})}),500),T=(e,t)=>{const a={...O.reduce(((e,t)=>(e[t.fieldName]=t.fieldValue,e)),{}),[e.fieldName]:t};i(Kh,a)},C=Object(n.useCallback)((e=>{const t=e.target.value;void 0!==t&&i(Qh,+t)}),[i]),k=v.map((e=>({value:e.index,text:e.detector_description}))),F=Object(n.useCallback)(((e,t)=>{var a,i;const n={...M[e]?M[e]:{},...t},s={...M};if((null===(a=M[e])||void 0===a?void 0:a.anomalousOnly)!==n.anomalousOnly)for(const e in s)s.hasOwnProperty(e)&&(s[e].anomalousOnly=n.anomalousOnly);if((null===(i=M[e])||void 0===i?void 0:i.applyTimeRange)!==n.applyTimeRange)for(const e in s)s.hasOwnProperty(e)&&(s[e].applyTimeRange=n.applyTimeRange);w({...s,[e]:n})}),[M,w]);let I=!1;return Object(g.jsx)("div",{"data-test-subj":"mlSingleMetricViewerSeriesControls"},Object(g.jsx)(o.EuiFlexGroup,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.detectorLabel",defaultMessage:"Detector"})},Object(g.jsx)(o.EuiSelect,{onChange:C,value:t,options:k,"data-test-subj":"mlSingleMetricViewerDetectorSelect"}))),O.map((e=>{const t=`${e.fieldName}`,a=!I&&null===e.fieldValue;return I=!I&&a,Object(g.jsx)(Of.b,{entity:e,entityFieldValueChanged:T,isLoading:f,onSearchChange:_,config:M[e.fieldType],onConfigChange:F,forceSelection:a,key:t,options:(i=j[e.fieldName],Array.isArray(i)?i.map((e=>({label:""===e.value?Of.a:e.value,value:e}))):[]),isModelPlotEnabled:b});var i})),Object(g.jsx)(fg,{selectedJobId:a,selectedDetectorIndex:t,selectedEntities:r,functionDescription:l,setFunctionDescription:c,entityControlsCount:O.length}),s))};var gg=a(243),jg=a(120),xg=a.n(jg),vg=a(179);function yg(e,t,a,i){this.contextGroup=e,this.data=t,this.drawBounds=a,this.swimlaneHeight=i,this.mask=this.contextGroup.append("g").attr("class","mask"),this.leftGroup=this.mask.append("g").attr("class","left-mask"),this.rightGroup=this.mask.append("g").attr("class","right-mask"),this.leftPolygon=this.leftGroup.append("polygon"),this.rightPolygon=this.rightGroup.append("polygon"),!0===this.drawBounds&&(this.leftGroup.append("path").attr("class","left area bounds"),this.rightGroup.append("path").attr("class","right area bounds")),this.leftGroup.append("path").attr("class","left values-line"),this.rightGroup.append("path").attr("class","right values-line"),this._x=null,this._y=null}yg.prototype.style=function(e,t){return this.leftGroup.style(e,t),this.rightGroup.style(e,t),this},yg.prototype.x=function(e){return null==e?this._x:(this._x=e,this)},yg.prototype.y=function(e){return null==e?this._y:(this._y=e,this)},yg.prototype.redraw=function(){const e=this._y.domain(),t=e[0],a=e[1],i=this._x.domain(),n=i[0],s=i[1],o=this,r=this.data.filter((function(e){return e.date<o.from})),l=this.data.filter((function(e){return e.date>o.to}));if(!0===this.drawBounds){const e=xg.a.svg.area().x((function(e){return o._x(e.date)||1})).y0((function(e){return o._y(Math.min(a,Math.max(e.lower,t)))})).y1((function(e){return o._y(Math.max(t,Math.min(e.upper,a)))})).defined((e=>null!==e.lower&&null!==e.upper));this.leftGroup.select(".left.area.bounds").attr("d",e(r)),this.rightGroup.select(".right.area.bounds").attr("d",e(l))}const c=xg.a.svg.line().x((function(e){return o._x(e.date)})).y((function(e){return o._y(e.value)})).defined((e=>null!==e.value));this.leftGroup.select(".left.values-line").attr("d",c(r)),Object(vg.f)(r,this.leftGroup,c,1),this.rightGroup.select(".right.values-line").attr("d",c(l)),Object(vg.f)(l,this.rightGroup,c,1);const d=this._x(n),u=this._y(t)+this.swimlaneHeight,p=this._x(this.from),m=this._x(this.to),b=this._y(t)+this.swimlaneHeight,f=this._x(s);return this.leftPolygon.attr("points",d+","+u+"  "+p+","+u+"  "+p+",0  "+d+",0"),this.rightPolygon.attr("points",m+","+b+"  "+f+","+b+"  "+f+",0  "+m+",0"),this},yg.prototype.reveal=function(e){return this.from=e[0],this.to=e[1],this.redraw(),this};function Og(){const{annotationUpdatesService:e}=this.props,t=this.focusXScale,a=xg.a.svg.brush().x(t).on("brushend",function(){const{selectedJob:t}=this.props,i=a.extent(),n=i[0].getTime(),s=i[1].getTime();if(n===s)return void e.setValue(null);const o={timestamp:n,end_timestamp:s,annotation:"",job_id:t.job_id,type:ot.ANNOTATION};e.setValue(o)}.bind(this));return a}function Eg(e){const t={};return e.forEach(((a,i)=>{if(void 0!==a.key){const n=e.filter(((e,t)=>t<i));t[a.key]=n.reduce(((e,i)=>void 0===a.end_timestamp||void 0===i.end_timestamp||void 0===i.key||i.timestamp<a.timestamp&&i.end_timestamp<a.timestamp||i.timestamp>a.end_timestamp&&i.end_timestamp>a.end_timestamp?e:t[i.key]+1),0)}})),t}function wg(e){xg.a.selectAll(".mlAnnotation").each((function(t){const a=xg.a.select(this);t._id===e._id?a.selectAll(".mlAnnotationRect").classed("mlAnnotationRect-isHighlight",!0):(a.selectAll(".mlAnnotationTextRect").classed("mlAnnotationTextRect-isBlur",!0),a.selectAll(".mlAnnotationText").classed("mlAnnotationText-isBlur",!0),a.selectAll(".mlAnnotationRect").classed("mlAnnotationRect-isBlur",!0))}))}function Mg(){xg.a.selectAll(".mlAnnotation").each((function(){const e=xg.a.select(this);e.selectAll(".mlAnnotationTextRect").classed("mlAnnotationTextRect-isBlur",!1),e.selectAll(".mlAnnotationRect").classed("mlAnnotationRect-isHighlight",!1).classed("mlAnnotationRect-isBlur",!1),e.selectAll(".mlAnnotationText").classed("mlAnnotationText-isBlur",!1)}))}const Sg=335,_g=25,Tg=vg.a+4,Cg={top:10,right:10,bottom:15,left:40},kg=[{duration:Oe.a.duration(1,"h"),label:"1h"},{duration:Oe.a.duration(12,"h"),label:"12h"},{duration:Oe.a.duration(1,"d"),label:"1d"},{duration:Oe.a.duration(1,"w"),label:"1w"},{duration:Oe.a.duration(2,"w"),label:"2w"},{duration:Oe.a.duration(1,"M"),label:"1M"}],Fg=xg.a.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]),Ig=xg.a.scale.threshold().domain([3,25,50,75,100]).range(["#dce7ed","#b0c5d6","#b1a34e","#b17f4e","#c88686"]);class timeseries_chart_TimeseriesChartIntl extends n.Component{constructor(...e){super(...e),Y()(this,"rowMouseenterSubscriber",null),Y()(this,"rowMouseleaveSubscriber",null),Y()(this,"contextChartInitialized",!1),Y()(this,"drawContextBrush",(e=>{const{contextChartSelected:t}=this.props,a=this.brush,i=this.contextXScale,n=this.mask;a.x(i).on("brush",c).on("brushend",(function(){const n=a.empty()?i.domain():a.extent(),s=n[0].getTime(),o=n[1].getTime();void 0!==d.selectedBounds&&d.selectedBounds.min.valueOf()===s&&d.selectedBounds.max.valueOf()===o||(e.selectAll(".swimlane-cell").style("fill",(e=>{const t=e.date.getTime();return t<s||t>o?Ig(e.score):Fg(e.score)})),d.selectedBounds={min:Oe()(s),max:Oe()(o)},t({from:n[0],to:n[1]}))})),e.append("g").attr("class","x brush").call(a).selectAll("rect").attr("y",-1).attr("height",91).attr("width",this.vizWidth);const s=a.extent();e.selectAll(".w rect").attr("x",-10).attr("width",10),e.selectAll(".e rect").attr("transform",null).attr("width",10);const o=e.append("rect").attr("class","top-border").attr("y",-2).attr("height",3),r=e.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").attr("x",i(s[0])-10).html('\n        <div class="brush-handle-inner brush-handle-inner-left" style="padding-top: 27px">\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="6" height="9">\n            <polygon points="5,0 5,8 0,4" />\n          </svg>\n        </div>'),l=e.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").attr("x",i(s[1])+0).html('\n        <div class="brush-handle-inner brush-handle-inner-right" style="padding-top: 27px">\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="6" height="9">\n            <polygon points="0,0 0,8 5,4" />\n          </svg>\n        </div>');function c(){const e=a.extent();n.reveal(e),r.attr("x",i(e[0])-10),l.attr("x",i(e[1])+0),o.attr("x",i(e[0])+1);const t=Math.max(0,i(e[1])-i(e[0])-2);o.attr("width",t);const s=a.empty();xg.a.selectAll(".brush-handle").style("visibility",s?"hidden":"visible")}c();const d=this})),Y()(this,"drawSwimlane",((e,t,a)=>{const{contextAggregationInterval:i,swimlaneData:n}=this.props,s=n;if(void 0===s)return;const o=this.calculateContextXAxisDomain(),r=xg.a.time.scale().range([0,t]).domain(o),l=xg.a.scale.linear().range([a,0]).domain([0,a]),c=xg.a.svg.axis().scale(r).orient("bottom").innerTickSize(-a).outerTickSize(0),d=xg.a.svg.axis().scale(l).orient("left").tickValues(l.domain()).innerTickSize(-t).outerTickSize(0),u=e.append("g");u.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(c),u.append("g").attr("class","y axis").call(d);const p=o[0].getTime();let m=t/((o[1].getTime()-p)/i.asMilliseconds());m<1&&(m=1),e.append("g").attr("class","swimlane-cells").selectAll("rect").data(s).enter().append("rect").attr("x",(e=>r(e.date))).attr("y",0).attr("rx",0).attr("ry",0).attr("class",(e=>e.score>0?"swimlane-cell":"swimlane-cell-hidden")).attr("width",m).attr("height",a).style("fill",(e=>Fg(e.score)))})),Y()(this,"calculateContextXAxisDomain",(()=>{const{bounds:e,contextAggregationInterval:t,swimlaneData:a}=this.props;let i=e.min.valueOf();void 0!==a&&a.length>0&&(i=Math.min(a[0].date.getTime(),e.min.valueOf()));const n=t.asMilliseconds(),s=Math.floor(i/n)*n,o=Math.ceil(e.max.valueOf()/n)*n;return[new Date(s),new Date(o)]})),Y()(this,"setContextBrushExtent",((e,t)=>{const a=this.brush,i=a.extent(),n=[e,t];a.extent(n),a(xg.a.select(".brush")),n[0].getTime()===i[0].getTime()&&n[1].getTime()===i[1].getTime()||a.event(xg.a.select(".brush"))}))}componentWillUnmount(){xg.a.select(this.rootNode).html(""),null!==this.rowMouseenterSubscriber&&this.rowMouseenterSubscriber.unsubscribe(),null!==this.rowMouseleaveSubscriber&&this.rowMouseleaveSubscriber.unsubscribe()}componentDidMount(){const{svgWidth:e}=this.props;this.vizWidth=e-Cg.left-Cg.right;const t=this.vizWidth;this.focusXScale=xg.a.time.scale().range([0,t]),this.focusYScale=xg.a.scale.linear().range([Sg,25]);const a=this.focusXScale,i=this.focusYScale;this.focusXAxis=xg.a.svg.axis().scale(a).orient("bottom").innerTickSize(-310).outerTickSize(0).tickPadding(10),this.focusYAxis=xg.a.svg.axis().scale(i).orient("left").innerTickSize(-t).outerTickSize(0).tickPadding(10),this.focusValuesLine=xg.a.svg.line().x((function(e){return a(e.date)})).y((function(e){return i(e.value)})).defined((e=>null!==e.value)),this.focusBoundedArea=xg.a.svg.area().x((function(e){return a(e.date)||1})).y0((function(e){return i(e.upper)})).y1((function(e){return i(e.lower)})).defined((e=>null!==e.lower&&null!==e.upper)),this.contextXScale=xg.a.time.scale().range([0,t]),this.contextYScale=xg.a.scale.linear().range([60,3]),this.fieldFormat=void 0,this.annotateBrush=Og.call(this),this.brush=xg.a.svg.brush(),this.mask=void 0;const n=this.highlightFocusChartAnomaly.bind(this),s=wg.bind(this),o=this.unhighlightFocusChartAnomaly.bind(this),r=Mg.bind(this);this.rowMouseenterSubscriber=it.rowMouseenter$.subscribe((function({record:e,type:t="anomaly"}){"anomaly"===t?n(e):"annotation"===t&&s(e)})),this.rowMouseleaveSubscriber=it.rowMouseleave$.subscribe((function({record:e,type:t="anomaly"}){"anomaly"===t?o(e):r(e)})),this.renderChart(),this.drawContextChartSelection(),this.renderFocusChart()}componentDidUpdate(e){!1!==this.props.renderFocusChartOnly&&e.svgWidth===this.props.svgWidth&&e.showAnnotations===this.props.showAnnotations&&e.annotationData===this.props.annotationData||(this.renderChart(),this.drawContextChartSelection()),this.renderFocusChart(),null===this.props.annotation&&xg.a.select(this.rootNode).select("g.mlAnnotationBrush").call(this.annotateBrush.extent([0,0]))}renderChart(){const{contextChartData:e,contextForecastData:t,detectorIndex:a,modelPlotEnabled:i,selectedJob:n,svgWidth:s,showAnnotations:o}=this.props,r=this.createFocusChart.bind(this),l=this.drawContextElements.bind(this),c=this.focusXScale,d=this.focusYAxis,u=this.focusYScale,p=function(e){return 425+(e?Tg:0)+_g+Cg.top+Cg.bottom}(o),m=xg.a.select(this.rootNode);if(m.selectAll("*").remove(),void 0===n)return;if(this.fieldFormat=If.a.getFieldFormat(n.job_id,a),void 0===e)return;const b=this.fieldFormat,f=m.append("svg").attr("width",s).attr("height",p);let h,g;if(!0===i||void 0!==t&&t.length>0){const a=void 0===t?e:e.concat(t);h=xg.a.min(a,(e=>Math.min(e.value,e.lower))),g=xg.a.max(a,(e=>Math.max(e.value,e.upper)))}else h=xg.a.min(e,(e=>e.value)),g=xg.a.max(e,(e=>e.value));const j=g>0?Math.pow(10,Math.ceil(Math.log10(Math.abs(g)))):g,x=h>=0?h:-1*Math.pow(10,Math.ceil(Math.log10(Math.abs(h))));u.domain([x,j]);let v=0;f.append("g").attr("class","temp-axis-label tick").selectAll("text.temp.axis").data(u.ticks()).enter().append("text").text((e=>void 0!==b?b.convert(e,"text"):u.tickFormat()(e))).each((function(){v=Math.max(this.getBBox().width+d.tickPadding(),v)})).remove(),xg.a.select(".temp-axis-label").remove(),Cg.left=Math.max(v,40),this.vizWidth=Math.max(s-Cg.left-Cg.right,0),c.range([0,this.vizWidth]),d.innerTickSize(-this.vizWidth);const y=f.append("g").attr("class","focus-chart").attr("transform","translate("+Cg.left+","+Cg.top+")"),O=f.append("g").attr("class","context-chart").attr("transform","translate("+Cg.left+","+(Sg+Cg.top+_g)+")");f.append("defs").append("mask").attr("id","mlAnnotationMask").append("rect").attr("x",0).attr("y",0).attr("width",this.vizWidth).attr("height",Sg).style("fill","white"),r(y,this.vizWidth,Sg),l(O,this.vizWidth,60,30,Tg)}drawContextChartSelection(){const{contextChartData:e,contextForecastData:t,zoomFrom:a,zoomTo:i}=this.props;if(void 0===e)return;let n,s;const o=this.contextXScale.domain()[0].getTime(),r=this.contextXScale.domain()[1].getTime();let l=e;if(void 0!==t&&(l=l.concat(t)),n=a?a.getTime():Object(Q.reduce)(l,((e,t)=>Math.min(e,t.date.getTime())),new Date(2099,12,31).getTime()),n=Math.max(n,o),s=i?i.getTime():Object(Q.reduce)(l,((e,t)=>Math.max(e,t.date.getTime())),0),s=Math.min(s,r),n!==o||s!==r){this.setContextBrushExtent(new Date(n),new Date(s));const e={min:Oe()(new Date(n)),max:Oe()(n)};this.selectedBounds=e}else{const e=this.contextXScale.domain(),t={min:Oe()(new Date(e[0])),max:Oe()(e[1])};Object(Q.isEqual)(t,this.selectedBounds)||(this.selectedBounds=t,this.setContextBrushExtent(new Date(e[0]),new Date(e[1])))}}createFocusChart(e,t,a){const{contextForecastData:i}=this.props,n=e.append("g").attr("class","focus-zoom");n.append("rect").attr("x",0).attr("y",0).attr("width",t).attr("height",25).attr("class","chart-border"),this.createZoomInfoElements(n,t);const s=this.annotateBrush.bind(this);let o=0,r=0;null!==this.props.annotation&&(o=this.focusXScale(this.props.annotation.timestamp),r=function(e,t){const a=t(e.timestamp)+1,i=void 0!==e.end_timestamp?t(e.end_timestamp)-1:a+8;return Math.max(8,i-a)}(this.props.annotation,this.focusXScale)),e.append("g").attr("class","mlAnnotationBrush").call(s).selectAll("rect").attr("x",o).attr("y",25).attr("width",r).attr("height",310),e.append("g").classed("mlAnnotations",!0),e.append("rect").attr("x",0).attr("y",25).attr("width",t).attr("height",310).attr("class","chart-border");const l=e.append("g").attr("class","x-axis-background");l.append("rect").attr("x",0).attr("y",a).attr("width",t).attr("height",_g),l.append("line").attr("x1",0).attr("y1",a).attr("x2",0).attr("y2",a+_g),l.append("line").attr("x1",t).attr("y1",a).attr("x2",t).attr("y2",a+_g),l.append("line").attr("x1",0).attr("y1",a+_g).attr("x2",t).attr("y2",a+_g);const c=e.append("g");c.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")"),c.append("g").attr("class","y axis"),e.append("path").attr("class","area bounds"),e.append("path").attr("class","values-line"),e.append("g").attr("class","focus-chart-markers"),i&&(e.append("path").attr("class","area forecast").attr("data-test-subj","mlForecastArea"),e.append("path").attr("class","values-line forecast").attr("data-test-subj","mlForecastValuesline"),e.append("g").attr("class","focus-chart-markers forecast").attr("data-test-subj","mlForecastMarkers")),e.append("rect").attr("x",0).attr("y",0).attr("width",t).attr("height",a+24).attr("class","chart-border chart-border-highlight")}renderFocusChart(){const{focusAggregationInterval:e,focusAnnotationData:t,focusChartData:a,focusForecastData:i,modelPlotEnabled:n,selectedJob:s,showAnnotations:o,showForecast:l,showModelBounds:c,zoomFromFocusLoaded:d,zoomToFocusLoaded:u}=this.props,p=Array.isArray(t)?t:[];if(void 0===a)return;const m=a,b=this.contextYScale,f=this.showFocusChartTooltip.bind(this),h=this.props.tooltipService.hide.bind(this.props.tooltipService),g=xg.a.select(".focus-chart"),j=e.expression,x=s.analysis_config.bucket_span;if(xg.a.select(this.rootNode).select(".zoom-aggregation-interval").text(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.zoomAggregationIntervalLabel",{defaultMessage:"(aggregation interval: {focusAggInt}, bucket span: {bucketSpan})",values:{focusAggInt:j,bucketSpan:x}})),void 0===d||void 0===u)return;const v={min:Oe()(d.getTime()),max:Oe()(u.getTime())},y=e.asMilliseconds(),O=Oe()(Math.floor(v.min.valueOf()/y)*y),E=Oe()(Math.ceil(v.max.valueOf()/y)*y);if(this.focusXScale.domain([O.toDate(),E.toDate()]),a.length>0||void 0!==i&&i.length>0){void 0!==this.fieldFormat?this.focusYAxis.tickFormat((e=>this.fieldFormat.convert(e,"text"))):this.focusYAxis.tickFormat(null);let e=0,t=0,a=m;if(l&&void 0!==i&&i.length>0&&(a=m.concat(i)),e=xg.a.min(a,(e=>{let t=e.value;return null===t&&void 0!==e.anomalyScore&&void 0!==e.actual&&(t=Array.isArray(e.actual)?e.actual[0]:e.actual),void 0!==e.lower?null!=t?Math.min(t,e.lower):e.lower:t||0})),t=xg.a.max(a,(e=>{let t=e.value;return null===t&&void 0!==e.anomalyScore&&void 0!==e.actual&&(t=Array.isArray(e.actual)?e.actual[0]:e.actual),void 0!==e.upper?Math.max(t,e.upper):t||0})),t===e&&(this.contextYScale.domain()[0]!==b.domain()[1]&&e>=b.domain()[0]&&t<=b.domain()[1]?(e=b.domain()[0],t=b.domain()[1]):(e-=.05*e,t+=.05*t)),o&&p&&p.length>0){const a=Eg(p),i=xg.a.max(Object.keys(a).map((e=>a[e])));t+=Math.abs(t-e)*((i+1)/5)}this.focusYScale.domain([e,t])}else this.focusYScale.domain([0,10]),this.focusYAxis.tickFormat("");const w=Object(Gt.c)();w.setInterval("auto"),w.setBounds(v);const M=w.getScaledDateFormat();g.select(".x.axis").call(this.focusXAxis.ticks(Object(vg.l)(this.vizWidth),M).tickFormat((e=>Oe()(e).format(M)))),g.select(".y.axis").call(this.focusYAxis),Object(vg.g)(g.select(".x.axis"),this.vizWidth),!0===n&&g.select(".area.bounds").attr("d",this.focusBoundedArea(m)).classed("hidden",!c),function(e,t,a,i,n,s,o,r,l){const c={};t.forEach((e=>{if(void 0!==e.key){const t=(e.end_timestamp||0)-e.timestamp;c[e.key]=t}})),t.sort(((e,t)=>void 0===e.key||void 0===t.key?0:c[t.key]-c[e.key]));const d=Eg(t),u=function(e){o(e,this)},p=e=>{l.setValue(null),l.setValue(e)},m=e.select(".mlAnnotations").selectAll("g.mlAnnotation").data(t||[],(e=>e._id||""));m.enter().append("g").classed("mlAnnotation",!0);const b=m.selectAll(".mlAnnotationRect").data((e=>[e]));b.enter().append("rect").classed("mlAnnotationRect",!0).attr("mask","url(#mlAnnotationMask)").on("mouseover",u).on("mouseout",r).on("click",p),b.attr("x",(e=>{const t=Oe()(e.timestamp);return n(t)})).attr("y",(e=>26+28*(void 0!==e.key?d[e.key]:1))).attr("height",(e=>308-28*(void 0!==e.key?d[e.key]:1))).attr("width",(e=>{const t=n(Oe()(e.timestamp))+1,a=void 0!==e.end_timestamp?n(Oe()(e.end_timestamp))-1:t+8;return Math.max(8,a-t)})),b.exit().remove();const f=m.selectAll(".mlAnnotationTextRect").data((e=>[e])),h=m.selectAll(".mlAnnotationText").data((e=>[e]));function g(e){const t=n.domain()[0],a=n.domain()[1],i=Oe()(e),s=Math.max(n(t),n(i));return Math.min(n(a)-32,s)}f.enter().append("rect").classed("mlAnnotationTextRect",!0).attr("width",24).attr("height",20).on("mouseover",u).on("mouseout",r).on("click",p),h.enter().append("text").classed("mlAnnotationText",!0).on("mouseover",u).on("mouseout",r).on("click",p),h.attr("x",(e=>g(e.timestamp)+17)).attr("y",(e=>44+28*(void 0!==e.key?d[e.key]:1))).text((e=>e.key)),f.attr("x",(e=>g(e.timestamp)+5)).attr("y",(e=>30+28*(void 0!==e.key?d[e.key]:1))),f.exit().remove(),h.exit().remove(),m.classed("mlAnnotationHidden",!s),m.exit().remove()}(g,p,0,0,this.focusXScale,o,f,h,this.props.annotationUpdatesService),g.select(".mlAnnotationBrush").style("display",o?null:"none"),g.select(".values-line").attr("d",this.focusValuesLine(m)),Object(vg.f)(m,g,this.focusValuesLine);const S=xg.a.select(".focus-chart-markers").selectAll(".metric-value").data(m.filter((e=>(null!==e.value||"number"==typeof e.anomalyScore)&&!Object(vg.n)(e))));S.exit().remove(),S.enter().append("circle").attr("r",vg.b).on("mouseover",(function(e){f(e,this)})).on("mouseout",(()=>this.props.tooltipService.hide())),S.attr("cx",(e=>this.focusXScale(e.date))).attr("cy",(e=>this.focusYScale(e.value))).attr("class",(e=>{let t="metric-value";return void 0!==e.anomalyScore&&(t+=` anomaly-marker ${Object(pt.l)(e.anomalyScore).id}`),t}));const _=xg.a.select(".focus-chart-markers").selectAll(".multi-bucket").data(m.filter((e=>null!==e.anomalyScore&&!0===Object(vg.n)(e))));_.exit().remove(),_.enter().append("path").attr("d",xg.a.svg.symbol().size(vg.c).type("cross")).on("mouseover",(function(e){f(e,this)})).on("mouseout",(()=>this.props.tooltipService.hide())),_.attr("transform",(e=>`translate(${this.focusXScale(e.date)}, ${this.focusYScale(e.value)})`)).attr("class",(e=>`anomaly-marker multi-bucket ${Object(pt.l)(e.anomalyScore).id}`));const T=xg.a.select(".focus-chart-markers").selectAll(".scheduled-event-marker").data(m.filter((e=>void 0!==e.scheduledEvents)));if(T.exit().remove(),T.enter().append("rect").on("mouseover",(function(e){f(e,this)})).on("mouseout",(()=>h())).attr("width",2*vg.b).attr("height",vg.d).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1),T.attr("x",(e=>this.focusXScale(e.date)-vg.b)).attr("y",(e=>{const t=this.focusYScale(e.value);return isNaN(t)?-338:t-3})),void 0!==i){g.select(".area.forecast").attr("d",this.focusBoundedArea(i)).classed("hidden",!l),g.select(".values-line.forecast").attr("d",this.focusValuesLine(i)).classed("hidden",!l);const e=xg.a.select(".focus-chart-markers.forecast").selectAll(".metric-value").data(i);e.exit().remove(),e.enter().append("circle").attr("r",vg.b).on("mouseover",(function(e){f(e,this)})).on("mouseout",(()=>this.props.tooltipService.hide())),e.attr("cx",(e=>this.focusXScale(e.date))).attr("cy",(e=>this.focusYScale(e.value))).attr("class","metric-value").classed("hidden",!l)}}createZoomInfoElements(e,t){const{autoZoomDuration:a,bounds:i,modelPlotEnabled:n}=this.props,s=this.setZoomInterval.bind(this),o=i.max.unix()-i.min.unix(),l=10/this.vizWidth*o;let c=10;const d=e.append("text").attr("x",c).attr("y",17).attr("class","zoom-info-text").text(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.zoomLabel",{defaultMessage:"Zoom:"})),u=[{durationMs:a,label:"auto"}];if(Object(Q.each)(kg,(e=>{e.duration.asSeconds()>l&&e.duration.asSeconds()<o&&u.push({durationMs:e.duration.asMilliseconds(),label:e.label})})),c+=d.node().getBBox().width+4,Object(Q.each)(u,(t=>{const a=e.append("a").attr("data-ms",t.durationMs).attr("href","").append("text").attr("x",c).attr("y",17).attr("class","zoom-info-text").text(t.label);c+=a.node().getBBox().width+4})),e.append("text").attr("x",c+6).attr("y",17).attr("class","zoom-info-text zoom-aggregation-interval").text(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.zoomGroupAggregationIntervalLabel",{defaultMessage:"(aggregation interval: , bucket span: )"})),!1===n){const a=e.append("text").attr("x",300).attr("y",17).attr("class","zoom-info-text").text(r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.modelBoundsNotAvailableLabel",{defaultMessage:"Model bounds are not available"}));a.attr("x",t-(a.node().getBBox().width+10))}xg.a.select(this.rootNode).selectAll(".focus-zoom a").on("click",(function(){xg.a.event.preventDefault(),s(xg.a.select(this).attr("data-ms"))}))}drawContextElements(e,t,a,i){const{bounds:n,contextChartData:s,contextForecastData:o,modelPlotEnabled:r,annotationData:l}=this.props,c=s,d=Array.isArray(l)?[...l].sort(((e,t)=>e.timestamp-t.timestamp)):[];let u=[];if(d.length>0){u=[{start:d[0].timestamp,end:d[0].end_timestamp,annotations:[d[0]]}];let e=d[0].end_timestamp;for(let t=1;t<d.length;t++){if(d[t].timestamp<e){const a=u.pop(),i={...a,end:e,annotations:[...a.annotations,d[t]]};u.push(i)}else u.push({start:d[t].timestamp,end:d[t].end_timestamp,annotations:[d[t]]});e=d[t].end_timestamp}}const p=this.showFocusChartTooltip.bind(this),m=this.props.tooltipService.hide.bind(this.props.tooltipService);this.contextXScale=xg.a.time.scale().range([0,t]).domain(this.calculateContextXAxisDomain());const b=void 0===o?c:c.concat(o),f={min:Number.MAX_VALUE,max:Number.MIN_VALUE};Object(Q.each)(b,(e=>{var t,a;const i=null!==(t=e.lower)&&void 0!==t?t:Number.MAX_VALUE,n=null!==(a=e.upper)&&void 0!==a?a:Number.MIN_VALUE;f.min=Math.min(e.value,i,f.min),f.max=Math.max(e.value,n,f.max)}));let h=f.min,g=f.max;const j={min:h,max:g};if(!0===r||void 0!==o&&o.length>0){const e={min:Number.MAX_VALUE,max:Number.MIN_VALUE};Object(Q.each)(b,(t=>{e.min=Math.min(t.lower,e.min),e.max=Math.max(t.upper,e.max)})),h=Math.min(h,e.min),g=Math.max(g,e.max),f.max-f.min<.5*(g-h)&&(f.min>h&&(j.min=f.min-.5*(f.max-f.min)),f.max<g&&(j.max=f.max+.5*(f.max-f.min)))}this.contextYScale=xg.a.scale.linear().range([a,3]).domain([j.min,j.max]);const x=e.append("g").attr("class","axis"),v=a+i+Tg;x.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",v),x.append("line").attr("x1",t).attr("y1",0).attr("x2",t).attr("y2",v),x.append("line").attr("x1",0).attr("y1",v).attr("x2",t).attr("y2",v);const y=Object(Gt.c)();y.setInterval("auto"),y.setBounds(n);const O=y.getScaledDateFormat(),E=xg.a.svg.axis().scale(this.contextXScale).orient("top").innerTickSize(-a).outerTickSize(0).tickPadding(0).ticks(Object(vg.l)(t,O)).tickFormat((e=>Oe()(e).format(O)));e.datum(c);const w=xg.a.svg.area().x((e=>this.contextXScale(e.date))).y0((e=>this.contextYScale(Math.min(j.max,Math.max(e.lower,j.min))))).y1((e=>this.contextYScale(Math.max(j.min,Math.min(e.upper,j.max))))).defined((e=>null!==e.lower&&null!==e.upper));!0===r&&e.append("path").datum(c).attr("class","area bounds").attr("d",w);const M=xg.a.svg.line().x((e=>this.contextXScale(e.date))).y((e=>this.contextYScale(e.value))).defined((e=>null!==e.value));e.append("path").datum(c).attr("class","values-line").attr("d",M),Object(vg.f)(c,e,M,1),e.append("g").classed("mlContextAnnotations",!0);const[S,_]=this.contextXScale.range(),T=e.select(".mlContextAnnotations").selectAll("g.mlContextAnnotation").data(u,(e=>`${e.start}-${e.end}`||""));T.enter().append("g").classed("mlContextAnnotation",!0);const C=T.selectAll(".mlContextAnnotationRect").data((e=>[e]));C.enter().append("rect").on("mouseover",(function(e){p(1===e.annotations.length?e.annotations[0]:e,this)})).on("mouseout",(()=>m())).classed("mlContextAnnotationRect",!0),C.attr("x",(e=>{const t=Oe()(e.start);let a=this.contextXScale(t);return a-vg.a<=S&&(a=0),a+vg.a>=_&&(a=_-vg.a),a})).attr("y",a+i+2).attr("height",vg.a).attr("width",(e=>{const t=Math.max(this.contextXScale(Oe()(e.start))+1,S),a=Math.min(_,void 0!==e.end?this.contextXScale(Oe()(e.end))-1:t+8);return Math.max(8,a-t)})),C.exit().remove(),void 0!==o&&(e.append("path").datum(o).attr("class","area forecast").attr("d",w),e.append("path").datum(o).attr("class","values-line forecast").attr("d",M));const k=e.append("g").attr("class","swimlane").attr("transform","translate(0,"+a+")");this.drawSwimlane(k,t,i),this.mask=new yg(e,s,r,i).x(this.contextXScale).y(this.contextYScale),e.append("g").attr("class","x axis context-chart-axis").call(E),e.selectAll(".x.context-chart-axis text").attr("dy",a-5),Object(vg.g)(e.selectAll(".x.context-chart-axis"),t),this.drawContextBrush(e)}setZoomInterval(e){const{bounds:t,zoomTo:a}=this.props,i=t.min.valueOf(),n=t.max.valueOf(),s=+e;let o=a.getTime(),r=o-s;r<i&&(r=i,o=Math.min(i+s,n)),this.setContextBrushExtent(new Date(r),new Date(o))}showFocusChartTooltip(e,t){var a;const{modelPlotEnabled:i}=this.props,n=this.fieldFormat,s="single_metric_viewer",o=[{label:Object(Je.d)(e.date)}];if(void 0!==e.anomalyScore){const t=parseInt(e.anomalyScore);if(o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.anomalyScoreLabel",{defaultMessage:"anomaly score"}),value:Object(pt.g)(t),color:Fg(t),seriesIdentifier:{key:s},valueAccessor:"anomaly_score"}),!0===Object(vg.o)(e)&&o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.multiBucketImpactLabel",{defaultMessage:"multi-bucket impact"}),value:Object(pt.h)(e.multiBucketImpact),seriesIdentifier:{key:s},valueAccessor:"multi_bucket_impact"}),e.metricFunction&&o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.metricActualPlotFunctionLabel",{defaultMessage:"function"}),value:e.metricFunction,seriesIdentifier:{key:s},valueAccessor:"metric_function"}),!1===i){if(void 0!==e.actual&&"rare"!==e.function)o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.actualLabel",{defaultMessage:"actual"}),value:Object(Df.b)(e.actual,e.function,n),seriesIdentifier:{key:s},valueAccessor:"actual"}),o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.typicalLabel",{defaultMessage:"typical"}),value:Object(Df.b)(e.typical,e.function,n),seriesIdentifier:{key:s},valueAccessor:"typical"});else if(void 0!==e.value&&o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.valueLabel",{defaultMessage:"value"}),value:Object(Df.b)(e.value,e.function,n),seriesIdentifier:{key:s},valueAccessor:"value"}),void 0!==e.byFieldName&&void 0!==e.numberOfCauses){const t=e.numberOfCauses,a=Object(te.e)(e.byFieldName);o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.moreThanOneUnusualByFieldValuesLabel",{defaultMessage:"{numberOfCauses}{plusSign} unusual {byFieldName} values",values:{numberOfCauses:t,byFieldName:a,plusSign:t<10?"":"+"}}),seriesIdentifier:{key:s},valueAccessor:"numberOfCauses"})}}else e.annotations||(o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.modelPlotEnabled.actualLabel",{defaultMessage:"actual"}),value:Object(Df.b)(e.actual,e.function,n),seriesIdentifier:{key:s},valueAccessor:"actual"}),o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.modelPlotEnabled.upperBoundsLabel",{defaultMessage:"upper bounds"}),value:Object(Df.b)(e.upper,e.function,n),seriesIdentifier:{key:s},valueAccessor:"upper_bounds"}),o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.modelPlotEnabled.lowerBoundsLabel",{defaultMessage:"lower bounds"}),value:Object(Df.b)(e.lower,e.function,n),seriesIdentifier:{key:s},valueAccessor:"lower_bounds"}))}else!0===Object(Q.get)(e,"isForecast",!1)?o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.withoutAnomalyScore.predictionLabel",{defaultMessage:"prediction"}),value:Object(Df.b)(e.value,e.function,n),seriesIdentifier:{key:s},valueAccessor:"prediction"}):void 0!==e.value&&null!==e.value&&o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.withoutAnomalyScore.valueLabel",{defaultMessage:"value"}),value:Object(Df.b)(e.value,e.function,n),seriesIdentifier:{key:s},valueAccessor:"value"}),e.annotations||!0!==i||(o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.withoutAnomalyScoreAndModelPlotEnabled.upperBoundsLabel",{defaultMessage:"upper bounds"}),value:Object(Df.b)(e.upper,e.function,n),seriesIdentifier:{key:s},valueAccessor:"upper_bounds"}),o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.withoutAnomalyScoreAndModelPlotEnabled.lowerBoundsLabel",{defaultMessage:"lower bounds"}),value:Object(Df.b)(e.lower,e.function,n),seriesIdentifier:{key:s},valueAccessor:"lower_bounds"}));if(void 0!==e.scheduledEvents&&e.scheduledEvents.forEach(((t,a)=>{o.push({label:r.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.scheduledEventsLabel",{defaultMessage:"scheduled event{counter}",values:{counter:e.scheduledEvents.length>1?` #${a+1}`:""}}),value:t,seriesIdentifier:{key:s},valueAccessor:`scheduled_events_${a+1}`})})),void 0!==e.annotation){o.length=0,o.push({label:e.annotation});let t=Oe()(e.timestamp).format("MMMM Do YYYY, HH:mm");void 0!==e.end_timestamp&&(t+=` - ${Oe()(e.end_timestamp).format("MMMM Do YYYY, HH:mm")}`),o.push({label:t,seriesIdentifier:{key:s},valueAccessor:"timespan"})}(null===(a=e.annotations)||void 0===a?void 0:a.length)>1&&e.annotations.forEach((e=>{var t;let a=Oe()(e.timestamp).format("MMMM Do YYYY, HH:mm");void 0!==e.end_timestamp&&(a+=` - ${Oe()(e.end_timestamp).format("HH:mm")}`),o.push({label:a,value:`${e.annotation}`,seriesIdentifier:{key:"anomaly_timeline",specId:null!==(t=e._id)&&void 0!==t?t:`${e.annotation}-${e.timestamp}-label`},valueAccessor:"annotation"})}));let l=2*vg.b;if("rect"===t.tagName.toLowerCase()){const e=Number(t.getAttribute("x"));e<0&&(l=Math.abs(e))}this.props.tooltipService.show(o,t,{x:l,y:0})}highlightFocusChartAnomaly(e){const{focusChartData:t,focusAggregationInterval:a}=this.props,i=this.focusXScale,n=this.focusYScale,s=this.showFocusChartTooltip.bind(this),o=cg(t,e.source.timestamp,a);if(void 0!==o){const e=xg.a.select(".focus-chart-markers").selectAll(".focus-chart-highlighted-marker").data([o]);!0===Object(vg.n)(o)?e.enter().append("path").attr("d",xg.a.svg.symbol().size(vg.c).type("cross")).attr("transform",(e=>`translate(${i(e.date)}, ${n(e.value)})`)).attr("class",(e=>`anomaly-marker multi-bucket ${Object(pt.l)(e.anomalyScore).id} highlighted`)):e.enter().append("circle").attr("r",vg.b).attr("cx",(e=>i(e.date))).attr("cy",(e=>n(e.value))).attr("class",(e=>`anomaly-marker metric-value ${Object(pt.l)(e.anomalyScore).id} highlighted`));const t=xg.a.select(this.rootNode).selectAll(".focus-chart-markers .anomaly-marker.highlighted");t.length&&s(o,t[0][0])}}unhighlightFocusChartAnomaly(){xg.a.select(".focus-chart-markers").selectAll(".anomaly-marker.highlighted").remove(),this.props.tooltipService.hide()}shouldComponentUpdate(){return!0}setRef(e){this.rootNode=e}render(){return Object(g.jsx)("div",{className:"ml-timeseries-chart-react",ref:this.setRef.bind(this)})}}const Dg=e=>{const t=Object(n.useContext)(ct),a=G()(t.isAnnotationInitialized$());return void 0===a?null:Object(g.jsx)(timeseries_chart_TimeseriesChartIntl,_()({annotation:a},e,{annotationUpdatesService:t}))},Ag=({bounds:e,detectorIndex:t,renderFocusChartOnly:a,selectedJob:i,selectedEntities:s,showAnnotations:o,showForecast:l,showModelBounds:c,chartProps:d,lastRefresh:u,contextAggregationInterval:p})=>{const{toasts:m}=Object(y.f)(),{services:{mlServices:{mlApiServices:b}}}=Object(y.b)(),f=Object(n.useContext)(ct),[h,j]=Object(n.useState)([]),x=Object(n.useCallback)((e=>{m.addDanger({title:r.i18n.translate("xpack.ml.timeSeriesExplorer.mlSingleMetricViewerChart.annotationsErrorTitle",{defaultMessage:"An error occurred fetching annotations"}),...e?{text:Object(da.b)(e)}:{}})}),[]);return Object(n.useEffect)((()=>{let a=!1;const n=pg(t,s,i.job_id),o=Array.isArray(n)?n.filter((e=>null!==e.fieldValue)):void 0,r=Object(Gt.b)(e,p,!1);return(async e=>{try{const i=await b.annotations.getAnnotations({jobIds:[e],earliestMs:r.min.valueOf(),latestMs:r.max.valueOf(),maxAnnotations:nt.a,detectorIndex:t,entities:o});a||Array.isArray(i.annotations[e])&&j(i.annotations[e])}catch(e){x(e)}})(i.job_id),()=>{a=!0}}),[i.job_id,t,u,s,e,p]),Object(g.jsx)("div",{className:"ml-timeseries-chart","data-test-subj":"mlSingleMetricViewerChart"},Object(g.jsx)(gg.a,null,(n=>Object(g.jsx)(Dg,_()({},d,{annotationUpdatesService:f,annotationData:h,bounds:e,detectorIndex:t,renderFocusChartOnly:a,selectedJob:i,showAnnotations:o,showForecast:l,showModelBounds:c,tooltipService:n})))))},Lg=({errorMsg:e})=>Object(g.jsx)(o.EuiEmptyPrompt,{iconType:"alert",title:Object(g.jsx)("h2",null,e)}),Rg=({viewBySwimlaneFieldName:e,showFilterMessage:t=!1})=>!1===t?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.noInfluencersFoundTitle",defaultMessage:"No {viewBySwimlaneFieldName} influencers found",values:{viewBySwimlaneFieldName:e}}):Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.noInfluencersFoundTitleFilterMessage",defaultMessage:"No {viewBySwimlaneFieldName} influencers found for specified filter",values:{viewBySwimlaneFieldName:e}}),Ng=()=>Object(g.jsx)(o.EuiEmptyPrompt,{iconType:"alert",title:Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.noJobSelectedLabel",defaultMessage:"No jobs selected"})),"data-test-subj":"mlNoJobsFound"}),Pg=({hasResults:e,selectedJobsRunning:t})=>{const a=!0===e,i=!1===e;return Object(g.jsx)(o.EuiEmptyPrompt,{iconType:"iInCircle",title:Object(g.jsx)("h2",null,a&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.noAnomaliesFoundLabel",defaultMessage:"No anomalies found"}),i&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.noResultsFoundLabel",defaultMessage:"No results found"})),body:Object(g.jsx)(s.a.Fragment,null,t&&i&&Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.selectedJobsRunningLabel",defaultMessage:"One or more selected jobs are still running and results may not be available yet."})),!t&&Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.tryWideningTimeSelectionLabel",defaultMessage:"Try widening the time selection or moving further back in time"})))})},zg=r.i18n.translate("xpack.ml.timeSeriesExplorer.allPartitionValuesLabel",{defaultMessage:"all"});class timeseriesexplorer_TimeSeriesExplorer extends s.a.Component{constructor(...e){super(...e),Y()(this,"state",{chartDetails:void 0,contextAggregationInterval:void 0,contextChartData:void 0,contextForecastData:void 0,dataNotChartable:!1,entitiesLoading:!1,entityValues:{},focusAnnotationData:[],focusAggregationInterval:{},focusChartData:void 0,focusForecastData:void 0,fullRefresh:!0,hasResults:!1,loadCounter:0,loading:!1,modelPlotEnabled:!1,showAnnotations:!0,showAnnotationsCheckbox:!0,showForecast:!0,showForecastCheckbox:!1,showModelBounds:!0,showModelBoundsCheckbox:!1,svgWidth:0,tableData:void 0,zoomFrom:void 0,zoomTo:void 0,zoomFromFocusLoaded:void 0,zoomToFocusLoaded:void 0,chartDataError:void 0,sourceIndicesWithGeoFields:{}}),Y()(this,"subscriptions",new at.Subscription),Y()(this,"resizeRef",Object(n.createRef)()),Y()(this,"resizeChecker",void 0),Y()(this,"resizeHandler",(()=>{this.setState({svgWidth:null!==this.resizeRef.current?this.resizeRef.current.offsetWidth-34:0})})),Y()(this,"unmounted",!1),Y()(this,"contextChart$",new at.Subject),Y()(this,"getFieldNamesWithEmptyValues",(()=>this.getControlsForDetector().filter((({fieldValue:e})=>null===e)).map((({fieldName:e})=>e)))),Y()(this,"arePartitioningFieldsProvided",(()=>0===this.getFieldNamesWithEmptyValues().length)),Y()(this,"toggleShowAnnotationsHandler",(()=>{this.setState((e=>({showAnnotations:!e.showAnnotations})))})),Y()(this,"toggleShowForecastHandler",(()=>{this.setState((e=>({showForecast:!e.showForecast})))})),Y()(this,"toggleShowModelBoundsHandler",(()=>{this.setState({showModelBounds:!this.state.showModelBounds})})),Y()(this,"setFunctionDescription",(e=>{this.props.appStateHandler(tg,e)})),Y()(this,"previousChartProps",{}),Y()(this,"previousShowAnnotations",void 0),Y()(this,"previousShowForecast",void 0),Y()(this,"previousShowModelBounds",void 0),Y()(this,"tableFilter",((e,t,a)=>{const i=this.getControlsForDetector(),n=i.find((({fieldName:t})=>t===e));if(void 0===n)return;const{appStateHandler:s}=this.props;let o="";if("+"===a&&n.fieldValue!==t)o=t;else{if("-"!==a||n.fieldValue!==t)return;o=null}const r={...i.reduce(((e,t)=>(e[t.fieldName]=t.fieldValue,e)),{}),[n.fieldName]:o};s(Kh,r)})),Y()(this,"contextChartSelectedInitCallDone",!1),Y()(this,"contextChartSelected",(e=>{const t={from:e.from.toISOString(),to:e.to.toISOString()};Object(Q.isEqual)(this.props.zoom,t)&&void 0!==this.state.focusChartData&&this.props.previousRefresh===this.props.lastRefresh||(this.contextChart$.next(e),this.props.appStateHandler(eg,t))})),Y()(this,"loadAnomaliesTableData",((e,t)=>{const{dateFormatTz:a,selectedDetectorIndex:i,selectedJobId:n,tableInterval:s,tableSeverity:o,functionDescription:r}=this.props,l=K.a.getJob(n),c=this.getControlsForDetector();return X.ml.results.getAnomaliesTableData([l.job_id],this.getCriteriaFields(i,c),[],s,o,e,t,a,nt.b,void 0,void 0,r).pipe(Object(za.map)((e=>{const t=e.anomalies,a=K.a.detectorsByJob;return t.forEach((e=>{const t=e.jobId,i=Object(Q.get)(a,[t,e.detectorIndex]);e.detector=Object(Q.get)(i,["detector_description"],e.source.function_description);const n=i.custom_rules;void 0!==n&&(e.rulesLength=n.length),Object(Q.has)(K.a.customUrlsByJob,t)&&(e.customUrls=K.a.customUrlsByJob[t])})),{tableData:{anomalies:t,interval:e.interval,examplesByJobId:e.examplesByJobId,showViewSeriesLink:!1}}})))})),Y()(this,"setForecastId",(e=>{this.props.appStateHandler(Zh,e)})),Y()(this,"displayErrorToastMessages",((e,t)=>{this.props.toastNotificationService&&this.props.toastNotificationService.displayErrorToast(e,t,2e3),this.setState({loading:!1,chartDataError:t})})),Y()(this,"loadSingleMetricData",((e=!0)=>{const{autoZoomDuration:t,bounds:a,selectedDetectorIndex:i,selectedForecastId:n,selectedJobId:s,zoom:o,functionDescription:l}=this.props,{loadCounter:c}=this.state,d=K.a.getJob(s);if(void 0===d)return;if(mg(d,i)&&void 0===l)return;const u=pt.c.toES(l);this.contextChartSelectedInitCallDone=!1;const p=this.getControlsForDetector();this.setState({fullRefresh:e,loadCounter:c+1,loading:!0,chartDataError:void 0,...e?{chartDetails:void 0,contextChartData:void 0,contextForecastData:void 0,focusChartData:void 0,focusForecastData:void 0,modelPlotEnabled:Object(Qe.m)(d,i)&&Object(Qe.n)(d,i,p),hasResults:!1,dataNotChartable:!1}:{}},(()=>{const{loadCounter:e,modelPlotEnabled:l}=this.state,c=og(K.a.jobs),d=K.a.getJob(s),m=i;let b=3;const f={},h=i=>{if(b--,0===b&&i===e){if(f.hasResults=Array.isArray(f.contextChartData)&&f.contextChartData.length>0||Array.isArray(f.contextForecastData)&&f.contextForecastData.length>0,f.loading=!1,f.contextChartData.length&&!0===this.arePartitioningFieldsProvided()){let e=function(e,t,a){if(void 0!==e){const i=qd()(e.from,"YYYY-MM-DDTHH:mm:ss.SSSZ",!0),n=qd()(e.to,"YYYY-MM-DDTHH:mm:ss.SSSZ",!0),s=Object(Gt.b)(a,t,!0),o=s.min,r=s.max;if(i.isValid()&&n.isValid&&n.isAfter(i)&&i.isBetween(o,r,null,"[]")&&n.isBetween(o,r,null,"[]"))return[i.toDate(),n.toDate()]}}(o,f.contextAggregationInterval,a);void 0!==e&&this.previousSelectedForecastId===this.props.selectedForecastId||(e=function(e,t,a,i){const n=void 0!==i&&i.length>0,s=!1===n?a:a.concat(i),o=s[0].date,r=s[s.length-1].date;let l,c;if(!0===n){const t=i[0].date,a=i[i.length-1].date;c=Math.min(t.getTime()+e/2,a.getTime()),l=Math.max(c-e,o.getTime())}else c=r.getTime()+t.asMilliseconds(),l=Math.max(o.getTime(),c-e);return[new Date(l),new Date(c)]}(t,f.contextAggregationInterval,f.contextChartData,f.contextForecastData),this.previousSelectedForecastId=this.props.selectedForecastId),this.contextChartSelected({from:e[0],to:e[1]})}this.setState(f)}},g=p.filter((e=>null!==e.fieldValue));if(!1===l&&!1===Object(Qe.o)(d,m)&&g.length>0)return f.hasResults=!1,f.loading=!1,f.dataNotChartable=!0,void this.setState(f);f.contextAggregationInterval=dg(a,ag,c,d);const j=Object(Gt.b)(a,f.contextAggregationInterval,!1),x=e;if(ng(d,m,g,j.min.valueOf(),j.max.valueOf(),f.contextAggregationInterval.asMilliseconds(),u).toPromise().then((e=>{const t=rg(e.results,l);f.contextChartData=t,h(x)})).catch((e=>{const t=r.i18n.translate("xpack.ml.timeSeriesExplorer.metricDataErrorMessage",{defaultMessage:"Error getting metric data"});this.displayErrorToastMessages(e,t)})),mt.mlResultsService.getRecordMaxScoreByTime(d.job_id,this.getCriteriaFields(m,p),j.min.valueOf(),j.max.valueOf(),f.contextAggregationInterval.asMilliseconds(),u).then((e=>{const t=function(e){const t=[];return Object(Q.each)(e,((e,a)=>{t.push({date:new Date(+a),score:e.score})})),t}(e.results);f.swimlaneData=t,h(x)})).catch((e=>{const t=r.i18n.translate("xpack.ml.timeSeriesExplorer.bucketAnomalyScoresErrorMessage",{defaultMessage:"Error getting bucket anomaly scores"});this.displayErrorToastMessages(e,t)})),sg(d,m,p,j.min.valueOf(),j.max.valueOf()).then((e=>{f.chartDetails=e.results,h(x)})).catch((e=>{this.displayErrorToastMessages(e,r.i18n.translate("xpack.ml.timeSeriesExplorer.entityCountsErrorMessage",{defaultMessage:"Error getting entity counts"}))})),void 0!==n){let e;b++;const t=d.analysis_config.detectors[m],a=Object(Qe.r)(t.function);!1!==l||"sum"!==a&&"count"!==a||(e={avg:"sum",max:"sum",min:"sum"}),Ja(d,m,n,g,j.min.valueOf(),j.max.valueOf(),f.contextAggregationInterval.asMilliseconds(),e).toPromise().then((e=>{f.contextForecastData=lg(e.results),h(x)})).catch((e=>{this.displayErrorToastMessages(e,r.i18n.translate("xpack.ml.timeSeriesExplorer.forecastDataErrorMessage",{defaultMessage:"Error loading forecast data for forecast ID {forecastId}",values:{forecastId:n}}))}))}}))})),Y()(this,"getControlsForDetector",(()=>{const{selectedDetectorIndex:e,selectedEntities:t,selectedJobId:a}=this.props;return pg(e,t,a)}))}getFocusAggregationInterval(e){const{selectedJobId:t}=this.props,a=og(K.a.jobs),i=K.a.getJob(t);return dg({min:qd()(e.from),max:qd()(e.to)},ag,a,i)}getFocusData(e){const{selectedJobId:t,selectedForecastId:a,selectedDetectorIndex:i,functionDescription:n}=this.props,{modelPlotEnabled:s}=this.state,o=K.a.getJob(t);if(mg(o,i)&&void 0===n)return;const r=this.getControlsForDetector(),l={min:qd()(e.from),max:qd()(e.to)},c=this.getFocusAggregationInterval(e),d=Object(Gt.b)(l,c,!1);return ug(this.getCriteriaFields(i,r),i,c,a,s,r.filter((e=>null!==e.fieldValue)),d,o,n)}getCriteriaFields(e,t){return[{fieldName:"detector_index",fieldValue:e},...t.filter((e=>null!==e.fieldValue))]}loadForJobId(e){const{appStateHandler:t,selectedDetectorIndex:a}=this.props,i=K.a.getJob(e);if(void 0===i)return;const n=gf(i);let s=void 0!==a?a:n[0].index;if(void 0===Object(Q.find)(n,{index:s})){const e=r.i18n.translate("xpack.ml.timeSeriesExplorer.requestedDetectorIndexNotValidWarningMessage",{defaultMessage:"Requested detector index {detectorIndex} is not valid for job {jobId}",values:{detectorIndex:s,jobId:i.job_id}});this.props.toastNotificationService&&this.props.toastNotificationService.displayWarningToast(e),s=n[0].index}s!==a&&t(Qh,s),If.a.populateFormats([e])}componentDidMount(){const{invalidTimeRangeError:e}=this.props;e&&this.props.toastNotificationService&&this.props.toastNotificationService.displayWarningToast(r.i18n.translate("xpack.ml.timeSeriesExplorer.invalidTimeRangeInUrlCallout",{defaultMessage:"The time filter was changed to the full range for this job due to an invalid default time filter. Check the advanced settings for {field}.",values:{field:_e}})),this.resizeChecker=new pi.ResizeChecker(this.resizeRef.current),this.resizeChecker.on("resize",(()=>{this.resizeHandler()})),this.resizeHandler(),this.subscriptions.add(this.contextChart$.pipe(Object(za.tap)((e=>{this.setState({zoomFrom:e.from,zoomTo:e.to})})),Object(za.debounceTime)(500),Object(za.tap)((e=>{const{contextChartData:t,contextForecastData:a,focusChartData:i,zoomFromFocusLoaded:n,zoomToFocusLoaded:s}=this.state;(void 0!==t&&0!==t.length||void 0!==a&&0!==a.length)&&(!1===this.contextChartSelectedInitCallDone&&void 0===i||n.getTime()!==e.from.getTime()||s.getTime()!==e.to.getTime())&&(this.contextChartSelectedInitCallDone=!0,this.setState({loading:!0,fullRefresh:!1}))})),Object(za.switchMap)((e=>{const{selectedJobId:t}=this.props,a=og(K.a.jobs),i=K.a.getJob(t),n={min:qd()(e.from),max:qd()(e.to)},s=dg(n,ag,a,i),o=Object(Gt.b)(n,s,!1);return Object(at.forkJoin)([this.getFocusData(e),this.loadAnomaliesTableData(o.min.valueOf(),o.max.valueOf())])})),Object(za.withLatestFrom)(this.contextChart$)).subscribe((([[e,t],a])=>{const{modelPlotEnabled:i}=this.state;this.setState({focusAggregationInterval:this.getFocusAggregationInterval({from:a.from,to:a.to}),loading:!1,showModelBoundsCheckbox:i&&e.focusChartData.length>0,zoomFromFocusLoaded:a.from,zoomToFocusLoaded:a.to,...e,...t})}))),this.componentDidUpdate()}componentDidUpdate(e){if(void 0===e||e.selectedJobId!==this.props.selectedJobId){const e=K.a.getJob(this.props.selectedJobId);this.contextChartSelectedInitCallDone=!1,Object(xp.k)([e],this.props.dataViewsService).then((e=>this.setState({fullRefresh:!1,loading:!0,sourceIndicesWithGeoFields:e},(()=>{this.loadForJobId(this.props.selectedJobId)})))).catch(console.error)}if(void 0!==e&&e.selectedForecastId===this.props.selectedForecastId||void 0!==this.props.selectedForecastId&&(this.setState({showForecast:!0}),void 0!==e&&(this.previousSelectedForecastId=e.selectedForecastId)),void 0===e||!Object(Q.isEqual)(e.bounds,this.props.bounds)||!Object(Q.isEqual)(e.lastRefresh,this.props.lastRefresh)&&0!==e.lastRefresh||!Object(Q.isEqual)(e.selectedDetectorIndex,this.props.selectedDetectorIndex)||!Object(Q.isEqual)(e.selectedEntities,this.props.selectedEntities)||e.selectedForecastId!==this.props.selectedForecastId||e.selectedJobId!==this.props.selectedJobId||e.functionDescription!==this.props.functionDescription){const t=void 0===e||!Object(Q.isEqual)(e.bounds,this.props.bounds)||!Object(Q.isEqual)(e.selectedDetectorIndex,this.props.selectedDetectorIndex)||!Object(Q.isEqual)(e.selectedEntities,this.props.selectedEntities)||e.selectedForecastId!==this.props.selectedForecastId||e.selectedJobId!==this.props.selectedJobId||e.functionDescription!==this.props.functionDescription;this.loadSingleMetricData(t)}if(void 0===e)return;e.tableInterval===this.props.tableInterval&&e.tableSeverity===this.props.tableSeverity||(()=>{const{zoomFrom:e,zoomTo:t}=this.state;void 0!==e&&void 0!==t&&this.loadAnomaliesTableData(e.getTime(),t.getTime()).subscribe((e=>this.setState(e)))})()}componentWillUnmount(){this.subscriptions.unsubscribe(),this.resizeChecker.destroy(),this.unmounted=!0}render(){const{autoZoomDuration:e,bounds:t,dateFormatTz:a,lastRefresh:i,selectedDetectorIndex:l,selectedJobId:c}=this.props,{chartDetails:d,contextAggregationInterval:u,contextChartData:p,contextForecastData:b,dataNotChartable:f,focusAggregationInterval:h,focusAnnotationError:j,focusAnnotationData:x,focusChartData:v,focusForecastData:y,fullRefresh:O,hasResults:E,loading:w,modelPlotEnabled:M,showAnnotations:S,showAnnotationsCheckbox:_,showForecast:T,showForecastCheckbox:C,showModelBounds:k,showModelBoundsCheckbox:F,svgWidth:I,swimlaneData:D,tableData:A,zoomFrom:L,zoomTo:R,zoomFromFocusLoaded:N,zoomToFocusLoaded:P,chartDataError:z,sourceIndicesWithGeoFields:B}=this.state,V={modelPlotEnabled:M,contextChartData:p,contextChartSelected:this.contextChartSelected,contextForecastData:b,contextAggregationInterval:u,swimlaneData:D,focusAnnotationData:x,focusChartData:v,focusForecastData:y,focusAggregationInterval:h,svgWidth:I,zoomFrom:L,zoomTo:R,zoomFromFocusLoaded:N,zoomToFocusLoaded:P,autoZoomDuration:e},J=og(K.a.jobs);if(void 0===l||void 0===K.a.getJob(c))return Object(g.jsx)(Yh,{dateFormatTz:a,resizeRef:this.resizeRef},Object(g.jsx)(Ng,null));const U=K.a.getJob(c),G=this.getControlsForDetector(),q=this.getFieldNamesWithEmptyValues(),$=this.arePartitioningFieldsProvided(),W=gf(U);let H=!0;return Object(Q.isEqual)(this.previousChartProps.focusForecastData,V.focusForecastData)&&Object(Q.isEqual)(this.previousChartProps.focusChartData,V.focusChartData)&&Object(Q.isEqual)(this.previousChartProps.focusAnnotationData,V.focusAnnotationData)&&this.previousShowForecast===T&&this.previousShowModelBounds===k&&this.props.previousRefresh===i&&(H=!1),this.previousChartProps=V,this.previousShowForecast=T,this.previousShowModelBounds=k,Object(g.jsx)(Yh,{dateFormatTz:a,resizeRef:this.resizeRef},q.length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiCallOut,{title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.singleMetricRequiredMessage",defaultMessage:"To view a single metric, select {missingValuesCount, plural, one {a value for {fieldName1}} other {values for {fieldName1} and {fieldName2}}}.",values:{missingValuesCount:q.length,fieldName1:q[0],fieldName2:q[1]}}),iconType:"help",size:"s"}),Object(g.jsx)(o.EuiSpacer,{size:"m"})),Object(g.jsx)(hg,{selectedJobId:c,appStateHandler:this.props.appStateHandler,selectedDetectorIndex:l,selectedEntities:this.props.selectedEntities,bounds:t,functionDescription:this.props.functionDescription,setFunctionDescription:this.setFunctionDescription},$&&Object(g.jsx)(o.EuiFlexItem,{style:{textAlign:"right"}},Object(g.jsx)(o.EuiFormRow,{hasEmptyLabelSpace:!0,style:{maxWidth:"100%"}},Object(g.jsx)(Nh,{job:U,detectorIndex:l,entities:G,setForecastId:this.setForecastId,className:"forecast-controls"})))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),O&&!0===w&&Object(g.jsx)(Ph.a,{label:r.i18n.translate("xpack.ml.timeSeriesExplorer.loadingLabel",{defaultMessage:"Loading"})}),!1===w&&void 0!==z&&Object(g.jsx)(Lg,{errorMsg:z}),$&&J.length>0&&(!1===O||!1===w)&&!1===E&&void 0===z&&Object(g.jsx)($h,{dataNotChartable:f,entities:G}),$&&J.length>0&&(!1===O||!1===w)&&!0===E&&Object(g.jsx)("div",null,Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)("span",null,r.i18n.translate("xpack.ml.timeSeriesExplorer.singleTimeSeriesAnalysisTitle",{defaultMessage:"Single time series analysis of {functionLabel}",values:{functionLabel:d.functionLabel}}))," ",1===d.entityData.count&&Object(g.jsx)(o.EuiTextColor,{color:"success",size:"s",component:"span"},d.entityData.entities.length>0&&"(",d.entityData.entities.map((e=>`${e.fieldName}: ${e.fieldValue}`)).join(", "),d.entityData.entities.length>0&&")"),1!==d.entityData.count&&Object(g.jsx)(o.EuiTextColor,{color:"success",size:"s",component:"span"},d.entityData.entities.map(((e,t)=>Object(g.jsx)(n.Fragment,{key:e.fieldName},r.i18n.translate("xpack.ml.timeSeriesExplorer.countDataInChartDetailsDescription",{defaultMessage:"{openBrace}{cardinalityValue} distinct {fieldName} {cardinality, plural, one {} other { values}}{closeBrace}",values:{openBrace:0===t?"(":"",closeBrace:t===d.entityData.entities.length-1?")":"",cardinalityValue:0===e.cardinality?zg:e.cardinality,cardinality:e.cardinality,fieldName:e.fieldName}}),t!==d.entityData.entities.length-1?", ":""))))))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(jf,null))),Object(g.jsx)(o.EuiFlexGroup,{style:{float:"right"}},F&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiCheckbox,{id:"toggleModelBoundsCheckbox",label:r.i18n.translate("xpack.ml.timeSeriesExplorer.showModelBoundsLabel",{defaultMessage:"show model bounds"}),checked:k,onChange:this.toggleShowModelBoundsHandler})),_&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiCheckbox,{id:"toggleAnnotationsCheckbox",label:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationsLabel",{defaultMessage:"annotations"}),checked:S,onChange:this.toggleShowAnnotationsHandler})),C&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiCheckbox,{id:"toggleShowForecastCheckbox",label:Object(g.jsx)("span",{"data-test-subj":"mlForecastCheckbox"},r.i18n.translate("xpack.ml.timeSeriesExplorer.showForecastLabel",{defaultMessage:"show forecast"})),checked:T,onChange:this.toggleShowForecastHandler}))),Object(g.jsx)(Ag,{chartProps:V,contextAggregationInterval:u,bounds:t,detectorIndex:l,renderFocusChartOnly:H,selectedJob:U,selectedEntities:this.props.selectedEntities,showAnnotations:S,showForecast:T,showModelBounds:k,lastRefresh:i}),void 0!==j&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiTitle,{"data-test-subj":"mlAnomalyExplorerAnnotations error",size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationsErrorTitle",defaultMessage:"Annotations"}))),Object(g.jsx)(o.EuiPanel,null,Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.timeSeriesExplorer.annotationsErrorCallOutTitle",{defaultMessage:"An error occurred loading annotations:"}),color:"danger",iconType:"alert"},Object(g.jsx)("p",null,j))),Object(g.jsx)(o.EuiSpacer,{size:"m"})),x&&x.length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiAccordion,{id:"mlAnnotationsAccordion",buttonContent:Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationsTitle",defaultMessage:"Annotations {badge}",values:{badge:Object(g.jsx)(o.EuiBadge,{color:"hollow"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.annotationsTitleTotalCount",defaultMessage:"Total: {count}",values:{count:x.length}}))}}))),"data-test-subj":"mlAnomalyExplorerAnnotations loaded"},Object(g.jsx)(_a,{chartDetails:d,detectorIndex:l,detectors:W,jobIds:[this.props.selectedJobId],annotations:x,isSingleMetricViewerLinkVisible:!1,isNumberBadgeVisible:!0})),Object(g.jsx)(o.EuiSpacer,{size:"m"})),Object(g.jsx)(Ia,{chartDetails:d,detectorIndex:l,detectors:W}),Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.anomaliesTitle",defaultMessage:"Anomalies"}))),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{direction:"row",gutterSize:"l",responsive:!0},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(qh.a,null)),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Uh,null))),Object(g.jsx)(o.EuiSpacer,{size:"m"})),$&&J.length>0&&!0===E&&Object(g.jsx)(vh,{bounds:t,tableData:A,filter:this.tableFilter,sourceIndicesWithGeoFields:B,selectedJobs:[{id:U.job_id,modelPlotEnabled:M}]}))}}const Bg=()=>{const e=Object(y.c)({page:E.b.ANOMALY_DETECTION_CREATE_JOB}),t=!Object(w.e)("canCreateJob")||!Object(D.c)();return Object(g.jsx)(o.EuiEmptyPrompt,{"data-test-subj":"mlNoSingleMetricJobsFound",iconType:"alert",title:Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.noSingleMetricJobsFoundLabel",defaultMessage:"No single metric jobs found"})),actions:Object(g.jsx)(o.EuiButton,{color:"primary",fill:!0,href:e,disabled:t},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.createNewSingleMetricJobLinkText",defaultMessage:"Create new single metric job"}))})};var Vg=a(248);function Jg(){const{overlays:e,services:t}=Object(y.b)(),a=Object(n.useRef)();return Object(n.useEffect)((function(){return()=>{a.current&&a.current.close()}}),[]),Object(n.useCallback)(((i={singleSelection:!1,withTimeRangeSelector:!0,timeseriesOnly:!1})=>{const{uiSettings:n}=t,s=n.get("dateFormat:tz"),o="Browser"!==s?s:Oe.a.tz.guess(),r={groupsMap:Object(Hh.b)([]),jobsMap:{}};return new Promise((async(n,s)=>{try{a.current=e.openFlyout(Object(g.jsx)(c.KibanaContextProvider,{services:t},Object(g.jsx)(Vg.a,{selectedIds:[],withTimeRangeSelector:i.withTimeRangeSelector,dateFormatTz:o,singleSelection:!!i.singleSelection,timeseriesOnly:!!i.timeseriesOnly,onFlyoutClose:()=>{s(),a.current.close()},onSelectionConfirmed:e=>{n(e),a.current.close()},maps:r})))}catch(e){s(e)}}))}),[e,t])}const Ug=(e,t)=>({id:"timeseriesexplorer",path:"/timeseriesexplorer",title:r.i18n.translate("xpack.ml.anomalyDetection.singleMetricViewerLabel",{defaultMessage:"Single Metric Viewer"}),render:(e,t)=>Object(g.jsx)(Gg,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.anomalyDetection.singleMetricViewerLabel",{defaultMessage:"Single Metric Viewer"})}],enableDatePicker:!0}),Gg=({deps:e})=>{const{context:t,results:a}=I(void 0,void 0,e.config,e.dataViewsContract,{...W(e),jobs:K.a.loadJobsWrapper,jobsWithTimeRange:()=>X.ml.jobs.jobsWithTimerange(Object(xp.e)())}),i=Object(n.useMemo)((()=>new st.a),[]);return Object(g.jsx)(T.b,{context:t},Object(g.jsx)(ct.Provider,{value:i},Object(g.jsx)(qg,{config:e.config,jobsWithTimeRange:a.jobsWithTimeRange.jobs})))},qg=({config:e,jobsWithTimeRange:t})=>{var a,i,s,o,l,c,d,u,p,m,b,f,h,j,x,O,w;const M=Object(Cn.b)().dataViewsContract,{toasts:S}=Object(y.f)(),_=Object(Z.c)(),[T,C]=Object(v.b)(E.b.SINGLE_METRIC_VIEWER),[k,F]=Object(v.c)("_g"),[I,D]=Object(n.useState)(),A=Object(y.g)({timeRangeSelector:!0,autoRefreshSelector:!0}),[L,R]=Object(n.useState)(!1),N=Object(su.a)(),P=hf()(null!==(a=null==N?void 0:N.lastRefresh)&&void 0!==a?a:0),[z,B]=Object(n.useState)(void 0);Object(n.useEffect)((()=>{if(void 0!==(null==k?void 0:k.time)){"invalid"===k.time.mode&&R(!0);const e=A.getBounds();void 0!==(null==e?void 0:e.min)&&void 0!==(null==e?void 0:e.max)&&B(A.getBounds())}}),[null==k||null===(i=k.time)||void 0===i?void 0:i.from,null==k||null===(s=k.time)||void 0===s?void 0:s.to,null==k||null===(o=k.time)||void 0===o?void 0:o.ts]);const V=null==k||null===(l=k.ml)||void 0===l?void 0:l.jobIds;Array.isArray(V)&&V.sort();const J=hf()(V),U=!Object(Q.isEqual)(J,V),G=U||null==T||null===(c=T.mlTimeSeriesExplorer)||void 0===c?void 0:c.entities,q=U||null==T||null===(d=T.mlTimeSeriesExplorer)||void 0===d?void 0:d.forecastId,$=U||null==T||null===(u=T.mlTimeSeriesExplorer)||void 0===u?void 0:u.functionDescription,W=U||null==T||null===(p=T.mlTimeSeriesExplorer)||void 0===p?void 0:p.zoom,H=void 0!==I?K.a.getJob(I):void 0,Y=og(K.a.jobs),X=H&&null!==(m=null===(b=gf(H)[0])||void 0===b?void 0:b.index)&&void 0!==m?m:0,ee=U?X:null!==(f=null==T||null===(h=T.mlTimeSeriesExplorer)||void 0===h?void 0:h.detectorIndex)&&void 0!==f?f:X;let te;void 0!==I&&void 0!==H&&(te=function(e,t){const a=Object(Q.find)(e,{id:t.job_id}).bucketSpanSeconds;let i=1e3*a*499;const n=Math.floor(550),s=Object(Gt.c)();s.setInterval("auto"),s.setBarTarget(Math.floor(ag)),s.setMaxBars(n);const o=(new Date).getTime(),r=qd()(o),l=qd()(o-i);s.setBounds({min:l,max:r});const c=s.getIntervalToNearestMultiple(a).asSeconds();return c!==a&&(i*=a/c),i}(Y,H));const ae=Object(n.useCallback)(((e,t)=>{var a;const i=void 0===(null==T||null===(a=T.mlTimeSeriesExplorer)||void 0===a?void 0:a.zoom),n=void 0!==(null==T?void 0:T.mlTimeSeriesExplorer)?{...T.mlTimeSeriesExplorer}:{};switch(e){case Xh:delete n.detectorIndex,delete n.entities,delete n.forecastId,delete n.zoom,delete n.functionDescription;break;case Qh:n.detectorIndex=t,delete n.functionDescription;break;case Kh:n.entities=t,delete n.functionDescription;break;case Zh:n.forecastId=t,delete n.zoom;break;case eg:n.zoom=t;break;case"UNSET_ZOOM":delete n.zoom;break;case tg:n.functionDescription=t}C({mlTimeSeriesExplorer:n},i)}),[JSON.stringify(null==T?void 0:T.mlTimeSeriesExplorer),C]),ie=Jg();Object(n.useEffect)((()=>{void 0!==V&&void 0!==J&&ae(Xh);const e=function(e,t,a,i,n){const s=og(K.a.jobs),o=s.map((e=>e.id)),l=Object(Q.difference)(t,o),c=Object(Q.without)(t,...l);if(1===l.length){const t=l[0],a=e.find((e=>e.id===t));if(void 0!==a&&void 0!==a.isNotSingleMetricViewerJobMessage){const e=r.i18n.translate("xpack.ml.timeSeriesExplorer.canNotViewRequestedJobsWarningWithReasonMessage",{defaultMessage:"You can't view {selectedJobId} in this dashboard because {reason}.",values:{selectedJobId:t,reason:a.isNotSingleMetricViewerJobMessage}});i.addWarning({title:e,"data-test-subj":"mlTimeSeriesExplorerDisabledJobReasonWarningToast"})}}if(l.length>1){let e=r.i18n.translate("xpack.ml.timeSeriesExplorer.canNotViewRequestedJobsWarningMessage",{defaultMessage:"You can't view requested {invalidIdsCount, plural, one {job} other {jobs}} {invalidIds} in this dashboard",values:{invalidIdsCount:l.length,invalidIds:l.join(", ")}});0===c.length&&o.length>0&&(e+=r.i18n.translate("xpack.ml.timeSeriesExplorer.autoSelectingFirstJobText",{defaultMessage:", auto selecting first job"})),i.addWarning(e)}return c.length>1?(i.addWarning(r.i18n.translate("xpack.ml.timeSeriesExplorer.youCanViewOneJobAtTimeWarningMessage",{defaultMessage:"You can only view one job at a time in this dashboard"})),a("ml",{jobIds:[c[0]]}),!0):l.length>0&&c.length>0?(a("ml",{jobIds:[c[0]]}),!0):1===c.length?c[0]:0===c.length&&s.length>0&&(n({singleSelection:!0,timeseriesOnly:!0}).then((({jobIds:e,time:t})=>{a({ml:{jobIds:e},...void 0!==t?{time:t}:{}})})).catch((e=>{})),!0)}(t,V,F,S,ie);"string"==typeof e&&D(e)}),[JSON.stringify(V)]);const ne=null==z||null===(j=z.min)||void 0===j?void 0:j.valueOf(),se=null==z||null===(x=z.max)||void 0===x?void 0:x.valueOf(),[oe,re]=Object(n.useState)(null==T||null===(O=T.mlTimeSeriesExplorer)||void 0===O?void 0:O.forecastId);Object(n.useEffect)((()=>{void 0!==te&&void 0!==ne&&void 0!==se&&void 0!==H&&void 0!==q&&(oe!==q&&re(void 0),Va(H,q).then((e=>{if(void 0===te)return;const t=Oe()(e.earliest||ne),a=Oe()(e.latest||se);if(t.isBefore(Oe()(ne))||a.isAfter(Oe()(se))){const e=Math.min(t.valueOf(),ne),i=Math.max(a.valueOf(),se);F("time",{from:Oe()(e).toISOString(),to:Oe()(i).toISOString()})}re(q)})).catch((e=>{console.error("Time series explorer - error loading time range of forecast from elasticsearch:",e)})))}),[q]);const[le]=Jh(),[ce]=Object(qh.d)(),de=e.get("dateFormat:tz"),ue="Browser"!==de?de:Oe.a.tz.guess();if(0===Y.length)return Object(g.jsx)(Yh,{dateFormatTz:ue,noSingleMetricJobsFound:!0},Object(g.jsx)(Bg,null));if(!z)return Object(g.jsx)(Yh,{dateFormatTz:ue},Object(g.jsx)($h,null));const pe="string"==typeof q&&void 0===oe?void 0:W;return Object(g.jsx)(timeseriesexplorer_TimeSeriesExplorer,{dataViewsService:M,toastNotificationService:_,appStateHandler:ae,autoZoomDuration:te,bounds:z,dateFormatTz:ue,lastRefresh:null!==(w=null==N?void 0:N.lastRefresh)&&void 0!==w?w:0,previousRefresh:P,selectedJobId:I,selectedDetectorIndex:ee,selectedEntities:G,selectedForecastId:oe,tableInterval:le.val,tableSeverity:ce.val,timefilter:A,zoom:pe,invalidTimeRangeError:L,functionDescription:$})};var $g=a(76);const Wg=({influencerFieldName:e,influencerFilter:t,valueData:a})=>{const i=Math.floor(a.maxAnomalyScore),n=Object(pt.g)(a.maxAnomalyScore),r=Object(pt.i)(i),l=Math.floor(a.sumAnomalyScore),c=Object(pt.g)(a.sumAnomalyScore),d={width:`${0!==i?i:1}%`},u=function(e,t){return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.influencersList.maxAnomalyScoreTooltipDescription",defaultMessage:"Maximum anomaly score: {maxScoreLabel}",values:{maxScoreLabel:e}})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.influencersList.totalAnomalyScoreTooltipDescription",defaultMessage:"Total anomaly score: {totalScoreLabel}",values:{totalScoreLabel:t}})))}(n,c);return Object(g.jsx)("div",{"data-test-subj":`mlInfluencerEntry field-${e}`},Object(g.jsx)("div",{className:"field-label","data-test-subj":"mlInfluencerEntryFieldLabel"},Object(g.jsx)(Mf,{entityName:e,entityValue:a.influencerFieldValue,filter:t})),Object(g.jsx)("div",{className:`progress ${r.id}`},Object(g.jsx)("div",{className:"progress-bar-holder"},Object(g.jsx)("div",{className:"progress-bar",style:d})),Object(g.jsx)("div",{className:"score-label"},Object(g.jsx)(o.EuiToolTip,{position:"right",className:"ml-influencers-list-tooltip",title:`${e}: ${a.influencerFieldValue}`,content:u},Object(g.jsx)("span",null,n)))),Object(g.jsx)("div",{className:"total-score-label"},Object(g.jsx)(o.EuiToolTip,{position:"right",className:"ml-influencers-list-tooltip",title:`${e}: ${a.influencerFieldValue}`,content:u},Object(g.jsx)("span",null,l>0?function(e,t=3){return Math.abs(e)<Math.pow(10,t)?e:Be()(e).format("0a")}(l,4):c))))},Hg=({influencerFieldName:e,influencerFilter:t,fieldValues:a})=>{const i=a.map((a=>Object(g.jsx)(Wg,{key:a.influencerFieldValue,influencerFieldName:e,influencerFilter:t,valueData:a})));return Object(g.jsx)(s.a.Fragment,{key:e},Object(g.jsx)(o.EuiTitle,{size:"xxs","data-test-subj":`mlInfluencerFieldName ${e}`},Object(g.jsx)("h3",null,e)),Object(g.jsx)(o.EuiSpacer,{size:"xs"}),i,Object(g.jsx)(o.EuiSpacer,{size:"m"}))},Yg=({influencers:e,influencerFilter:t})=>{if(void 0===e||0===Object.keys(e).length)return Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround",className:"ml-influencers-list"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiSpacer,{size:"xxl"}),Object(g.jsx)(o.EuiTitle,{size:"xxs",className:"influencer-title"},Object(g.jsx)("h3",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.influencersList.noInfluencersFoundTitle",defaultMessage:"No influencers found"})))));const a=Object.keys(e).map((a=>Object(g.jsx)(Hg,{key:a,influencerFieldName:a,influencerFilter:t,fieldValues:e[a]})));return Object(g.jsx)("div",{className:"ml-influencers-list"},a)};var Xg=a(100);class state_service_StateService{constructor(){Y()(this,"subscriptions$",new at.Subscription)}_init(){this.subscriptions$=this._initSubscriptions()}destroy(){this.subscriptions$.unsubscribe()}}class anomaly_timeline_state_service_AnomalyTimelineStateService extends state_service_StateService{constructor(e,t,a,i){super(),Y()(this,"_explorerURLStateCallback",void 0),Y()(this,"_overallSwimLaneData$",new at.BehaviorSubject(null)),Y()(this,"_viewBySwimLaneData$",new at.BehaviorSubject(void 0)),Y()(this,"_swimLaneUrlState$",new at.BehaviorSubject(null)),Y()(this,"_containerWidth$",new at.BehaviorSubject(0)),Y()(this,"_selectedCells$",new at.BehaviorSubject(void 0)),Y()(this,"_swimLaneSeverity$",new at.BehaviorSubject(0)),Y()(this,"_swimLanePagination$",new at.BehaviorSubject({viewByFromPage:1,viewByPerPage:10})),Y()(this,"_swimLaneCardinality$",new at.BehaviorSubject(void 0)),Y()(this,"_viewBySwimlaneFieldName$",new at.BehaviorSubject(void 0)),Y()(this,"_viewBySwimLaneOptions$",new at.BehaviorSubject([])),Y()(this,"_topFieldValues$",new at.BehaviorSubject([])),Y()(this,"_isOverallSwimLaneLoading$",new at.BehaviorSubject(!0)),Y()(this,"_isViewBySwimLaneLoading$",new at.BehaviorSubject(!0)),Y()(this,"_swimLaneBucketInterval$",new at.BehaviorSubject(null)),Y()(this,"_timeBounds$",void 0),Y()(this,"_refreshSubject$",void 0),this.anomalyExplorerUrlStateService=e,this.anomalyExplorerCommonStateService=t,this.anomalyTimelineService=a,this.timefilter=i,this._timeBounds$=this.timefilter.getTimeUpdate$().pipe(Object(za.startWith)(null),Object(za.map)((()=>this.timefilter.getBounds()))),this._refreshSubject$=q.a.pipe(Object(za.startWith)({lastRefresh:0})),this._explorerURLStateCallback=(e,t)=>{const a=this.anomalyExplorerUrlStateService.getPageUrlState(),i=null==a?void 0:a.mlExplorerSwimlane,n=t?e:{...i,...e};return this.anomalyExplorerUrlStateService.updateUrlState({...a,mlExplorerSwimlane:n})},this._init()}_initSubscriptions(){const e=new at.Subscription;return e.add(this.anomalyExplorerUrlStateService.getPageUrlState$().pipe(Object(za.map)((e=>null==e?void 0:e.mlExplorerSwimlane)),Object(za.distinctUntilChanged)(Q.isEqual)).subscribe(this._swimLaneUrlState$)),e.add(this._initViewByData()),e.add(this._swimLaneUrlState$.pipe(Object(za.map)((e=>{var t;return null!==(t=null==e?void 0:e.severity)&&void 0!==t?t:0})),Object(za.distinctUntilChanged)()).subscribe(this._swimLaneSeverity$)),e.add(this._initSwimLanePagination()),e.add(this._initOverallSwimLaneData()),e.add(this._initTopFieldValues()),e.add(this._initViewBySwimLaneData()),e.add(Object(at.combineLatest)([this.anomalyExplorerCommonStateService.getSelectedJobs$(),this.getContainerWidth$(),this._timeBounds$]).subscribe((([e,t])=>{this._swimLaneBucketInterval$.next(this.anomalyTimelineService.getSwimlaneBucketInterval(e,t))}))),e.add(this._initSelectedCells()),e}_initViewByData(){return Object(at.combineLatest)([this._swimLaneUrlState$.pipe(Object(za.map)((e=>null==e?void 0:e.viewByFieldName)),Object(za.distinctUntilChanged)()),this.anomalyExplorerCommonStateService.getSelectedJobs$(),this.anomalyExplorerCommonStateService.getFilterSettings$(),this._selectedCells$]).subscribe((([e,t,a,i])=>{const{viewBySwimlaneFieldName:n,viewBySwimlaneOptions:s}=this._getViewBySwimlaneOptions(e,a.filterActive,a.filteredFields,!1,i,t);this._viewBySwimlaneFieldName$.next(n),this._viewBySwimLaneOptions$.next(s)}))}_initSwimLanePagination(){return Object(at.combineLatest)([this._swimLaneUrlState$.pipe(Object(za.map)((e=>{var t,a;return{viewByFromPage:null!==(t=null==e?void 0:e.viewByFromPage)&&void 0!==t?t:1,viewByPerPage:null!==(a=null==e?void 0:e.viewByPerPage)&&void 0!==a?a:10}})),Object(za.distinctUntilChanged)(Q.isEqual)),this.anomalyExplorerCommonStateService.getInfluencerFilterQuery$(),this._timeBounds$]).subscribe((([e,t])=>{let a=e;t&&(a={viewByPerPage:e.viewByPerPage,viewByFromPage:1}),this._swimLanePagination$.next(a)}))}_initOverallSwimLaneData(){return Object(at.combineLatest)([this.anomalyExplorerCommonStateService.getSelectedJobs$(),this._swimLaneSeverity$,this.getSwimLaneBucketInterval$(),this._timeBounds$,this._refreshSubject$]).pipe(Object(za.tap)((()=>{this._isOverallSwimLaneLoading$.next(!0)})),Object(za.switchMap)((([e,t,a])=>Object(at.from)(this.anomalyTimelineService.loadOverallData(e,void 0,a,t))))).subscribe((e=>{this._overallSwimLaneData$.next(e),this._isOverallSwimLaneLoading$.next(!1)}))}_initTopFieldValues(){return Object(at.combineLatest)([this.anomalyExplorerCommonStateService.getSelectedJobs$(),this.anomalyExplorerCommonStateService.getInfluencerFilterQuery$(),this.getViewBySwimlaneFieldName$(),this.getSwimLanePagination$(),this.getSwimLaneCardinality$(),this.getSelectedCells$(),this.getSwimLaneBucketInterval$(),this._timeBounds$,this._refreshSubject$]).pipe(Object(za.switchMap)((([e,t,a,i,n,s,o])=>{if(null==s||!s.showTopFieldValues)return Object(at.of)([]);const r=Object(xp.h)(s,a),l=Object(xp.j)(s,this.timefilter.getBounds());return Object(at.from)(this.anomalyTimelineService.loadViewByTopFieldValuesForSelectedTime(l.earliestMs,l.latestMs,e,a,Xg.a,i.viewByPerPage,i.viewByFromPage,o,r,t))}))).subscribe(this._topFieldValues$)}_initViewBySwimLaneData(){return Object(at.combineLatest)([this._overallSwimLaneData$.pipe(Object(za.skipWhile)((e=>!e))),this.anomalyExplorerCommonStateService.getSelectedJobs$(),this.anomalyExplorerCommonStateService.getInfluencerFilterQuery$(),this._swimLaneSeverity$,this.getSwimLaneBucketInterval$(),this.getViewBySwimlaneFieldName$(),this.getSwimLanePagination$(),this._topFieldValues$.pipe(Object(za.distinctUntilChanged)(Q.isEqual)),this._timeBounds$,this._refreshSubject$]).pipe(Object(za.tap)((()=>{this._isViewBySwimLaneLoading$.next(!0)})),Object(za.switchMap)((([e,t,a,i,n,s,o,r])=>Object(at.from)(this.anomalyTimelineService.loadViewBySwimlane(r,{earliest:e.earliest,latest:e.latest},t,s,Xg.a,o.viewByPerPage,o.viewByFromPage,void 0,a,n,i))))).subscribe((e=>{this._viewBySwimLaneData$.next(e),this._isViewBySwimLaneLoading$.next(!1),this._swimLaneCardinality$.next(null==e?void 0:e.cardinality)}))}_initSelectedCells(){return Object(at.combineLatest)([this._viewBySwimlaneFieldName$,this._swimLaneUrlState$,this.getSwimLaneBucketInterval$(),this._timeBounds$]).pipe(Object(za.map)((([e,t,a])=>{var i,n;if(null==t||!t.selectedType)return null;let s=null!==(i=t.selectedTimes)&&void 0!==i?i:t.selectedTime;"number"==typeof s&&(s=[s,s+a.asSeconds()]);let o=null!==(n=t.selectedLanes)&&void 0!==n?n:t.selectedLane;return"string"==typeof o&&(o=[o]),s=this._getAdjustedTimeSelection(s,this.timefilter.getBounds()),s?{type:t.selectedType,lanes:o,times:s,showTopFieldValues:t.showTopFieldValues,viewByFieldName:e}:null})),Object(za.distinctUntilChanged)(Q.isEqual)).subscribe(this._selectedCells$)}_getAdjustedTimeSelection(e,t){const[a,i]=e,n=this.getSwimLaneBucketInterval().asSeconds(),s=t.min.unix()-n,o=t.max.unix()+n,r=Math.max(a,s),l=Math.min(i,o);if(!(s>l||o<r))return a===r&&i===l?e:r!==s||l!==o?[r,l]:void 0}_getViewBySwimlaneOptions(e,t,a,i,n,s){var o;const r=null!==(o=null==s?void 0:s.map((e=>e.id)))&&void 0!==o?o:[],l=Object(Q.sortBy)(Object(Q.uniq)(K.a.jobs.reduce(((e,t)=>r.some((e=>e===t.job_id))?e.concat(t.analysis_config.influencers||[]):e),[])),(e=>e.toLowerCase()));l.push(Xg.j);let c,d=l;if(-1!==d.indexOf(e))c=e;else if(r.length>1)c=Xg.j;else if(K.a.jobs.length>0&&r.length>0){var u;const e=K.a.jobs.find((e=>e.job_id===r[0])),t=null!==(u=null==e?void 0:e.analysis_config.influencers)&&void 0!==u?u:[];null==e||e.analysis_config.detectors.forEach((e=>void 0!==e.partition_field_name&&-1!==t.indexOf(e.partition_field_name)?(c=e.partition_field_name,!1):void 0!==e.over_field_name&&-1!==t.indexOf(e.over_field_name)?(c=e.over_field_name,!1):void 0!==e.by_field_name&&void 0===e.over_field_name&&-1!==t.indexOf(e.by_field_name)?(c=e.by_field_name,!1):void 0)),void 0===c&&(c=t.length>0?t[0]:d.length>0?d[0]:void 0)}if(!0!==t||!0!==i||n){if(!0===t&&Array.isArray(d)&&Array.isArray(a)){const e=d.filter((e=>a.includes(e)||e===Xg.j||n&&n.viewByFieldName===e));e.length>1&&(d=e,d.includes(c)||(c=d[0]))}}else d=[Xg.j];return{viewBySwimlaneFieldName:c,viewBySwimlaneOptions:d}}getOverallSwimLaneData$(){return this._overallSwimLaneData$.asObservable()}getViewBySwimLaneData$(){return this._viewBySwimLaneData$.asObservable()}getContainerWidth$(){return this._containerWidth$.pipe(Object(za.debounceTime)(500),Object(za.distinctUntilChanged)(((e,t)=>Math.abs(e-t)<20)))}getContainerWidth(){return this._containerWidth$.getValue()}getSelectedCells$(){return this._selectedCells$.asObservable()}getSelectedCells(){return this._selectedCells$.getValue()}getSwimLaneSeverity$(){return this._swimLaneSeverity$.asObservable()}getSwimLaneSeverity(){return this._swimLaneSeverity$.getValue()}getSwimLanePagination$(){return this._swimLanePagination$.asObservable()}getSwimLanePagination(){return this._swimLanePagination$.getValue()}setSwimLanePagination(e){const t=e;t.viewByPerPage&&(t.viewByFromPage=1),this._explorerURLStateCallback(t)}getSwimLaneCardinality$(){return this._swimLaneCardinality$.pipe(Object(za.distinctUntilChanged)())}getViewBySwimlaneFieldName$(){return this._viewBySwimlaneFieldName$.pipe(Object(za.distinctUntilChanged)())}getViewBySwimLaneOptions$(){return this._viewBySwimLaneOptions$.asObservable()}getViewBySwimLaneOptions(){return this._viewBySwimLaneOptions$.getValue()}isOverallSwimLaneLoading$(){return this._isOverallSwimLaneLoading$.asObservable()}isViewBySwimLaneLoading$(){return this._isViewBySwimLaneLoading$.asObservable()}setContainerWidth(e){this._containerWidth$.next(e)}setSeverity(e){this._explorerURLStateCallback({severity:e,viewByFromPage:1})}setSelectedCells(e){const t={...this._swimLaneUrlState$.getValue()};if(void 0!==e){var a,i;e.showTopFieldValues=!1;const n=null===(a=this._selectedCells$.getValue())||void 0===a?void 0:a.type,s=null===(i=this._selectedCells$.getValue())||void 0===i?void 0:i.showTopFieldValues,o=null==e?void 0:e.type;(n===Xg.h.OVERALL&&o===Xg.h.VIEW_BY||o===Xg.h.OVERALL||!0===s)&&(e.showTopFieldValues=!0),t.selectedType=e.type,t.selectedLanes=e.lanes,t.selectedTimes=e.times,t.showTopFieldValues=e.showTopFieldValues,this._explorerURLStateCallback(t)}else delete t.selectedType,delete t.selectedLanes,delete t.selectedTimes,delete t.showTopFieldValues,this._explorerURLStateCallback(t,!0)}setViewBySwimLaneFieldName(e){this._explorerURLStateCallback({viewByFromPage:1,viewByPerPage:this._swimLanePagination$.getValue().viewByPerPage,viewByFieldName:e},!0)}getSwimLaneBucketInterval$(){return this._swimLaneBucketInterval$.pipe(Object(za.filter)((e=>!!e)),Object(za.distinctUntilChanged)(((e,t)=>e.asSeconds()===t.asSeconds())))}getSwimLaneBucketInterval(){return this._swimLaneBucketInterval$.getValue()}}class anomaly_explorer_common_state_AnomalyExplorerCommonStateService extends state_service_StateService{_getDefaultFilterSettings(){return{filterActive:!1,filteredFields:[],queryString:"",influencersFilterQuery:void 0}}constructor(e){super(),Y()(this,"_selectedJobs$",new at.BehaviorSubject(void 0)),Y()(this,"_filterSettings$",new at.BehaviorSubject(this._getDefaultFilterSettings())),Y()(this,"_smvJobs$",this.getSelectedJobs$().pipe(Object(za.map)((e=>e.filter((e=>e.isSingleMetricViewerJob)))),Object(za.shareReplay)(1))),this.anomalyExplorerUrlStateService=e,this._init()}_initSubscriptions(){return this.anomalyExplorerUrlStateService.getPageUrlState$().pipe(Object(za.map)((e=>null==e?void 0:e.mlExplorerFilter)),Object(za.distinctUntilChanged)(Q.isEqual)).subscribe((e=>{const t={...this._getDefaultFilterSettings(),...e};this._filterSettings$.next(t)}))}setSelectedJobs(e){this._selectedJobs$.next(e)}getSelectedJobs$(){return this._selectedJobs$.pipe(Object(za.filter)((e=>Array.isArray(e)&&e.length>0)),Object(za.distinctUntilChanged)(Q.isEqual),Object(za.shareReplay)(1))}getSingleMetricJobs$(){return this._smvJobs$}getSelectedJobs(){return this._selectedJobs$.getValue()}getInfluencerFilterQuery$(){return this._filterSettings$.pipe(Object(za.map)((e=>null==e?void 0:e.influencersFilterQuery)),Object(za.distinctUntilChanged)(Q.isEqual))}getFilterSettings$(){return this._filterSettings$.asObservable()}getFilterSettings(){return this._filterSettings$.getValue()}setFilterSettings(e){this.anomalyExplorerUrlStateService.updateUrlState({mlExplorerFilter:{influencersFilterQuery:e.filterQuery,filterActive:!0,filteredFields:e.filteredFields,queryString:e.queryString}})}clearFilterSettings(){this.anomalyExplorerUrlStateService.updateUrlState({mlExplorerFilter:{}})}}var Qg=a(206);class anomaly_charts_state_service_AnomalyChartsStateService extends state_service_StateService{constructor(e,t,a,i,n){super(),Y()(this,"_isChartsDataLoading$",new at.BehaviorSubject(!1)),Y()(this,"_chartsData$",new at.BehaviorSubject({chartsPerRow:1,errorMessages:void 0,seriesToPlot:[],tooManyBuckets:!1,timeFieldName:"timestamp"})),Y()(this,"_showCharts$",new at.BehaviorSubject(!0)),this._anomalyExplorerCommonStateService=e,this._anomalyTimelineStateServices=t,this._anomalyExplorerChartsService=a,this._anomalyExplorerUrlStateService=i,this._tableSeverityState=n,this._init()}_initSubscriptions(){const e=new at.Subscription;return e.add(this._anomalyExplorerUrlStateService.getPageUrlState$().pipe(Object(za.map)((e=>{var t;return null===(t=null==e?void 0:e.mlShowCharts)||void 0===t||t})),Object(za.distinctUntilChanged)()).subscribe(this._showCharts$)),e.add(this.initChartDataSubscription()),e}initChartDataSubscription(){return Object(at.combineLatest)([this._anomalyExplorerCommonStateService.getSelectedJobs$(),this._anomalyExplorerCommonStateService.getInfluencerFilterQuery$(),this._anomalyTimelineStateServices.getContainerWidth$().pipe(Object(za.skipWhile)((e=>0===e))),this._anomalyTimelineStateServices.getSelectedCells$(),this._anomalyTimelineStateServices.getViewBySwimlaneFieldName$(),this._tableSeverityState.getPageUrlState$()]).pipe(Object(za.switchMap)((([e,t,a,i,n,s])=>{if(!i)return Object(at.of)({chartsPerRow:1,errorMessages:void 0,seriesToPlot:[],tooManyBuckets:!1,timeFieldName:"timestamp"});const o=Object(xp.i)(i,e);this._isChartsDataLoading$.next(!0);const r=Object(xp.h)(i,n);return this._anomalyExplorerChartsService.getAnomalyData$(o,a,1e3*(null==i?void 0:i.times[0]),1e3*(null==i?void 0:i.times[1]),t,r,s.val,6)}))).subscribe((e=>{this._chartsData$.next(e),this._isChartsDataLoading$.next(!1)}))}getChartsData$(){return this._chartsData$.asObservable()}getChartsData(){return this._chartsData$.getValue()}getShowCharts$(){return this._showCharts$.asObservable()}getShowCharts(){return this._showCharts$.getValue()}setShowCharts(e){this._anomalyExplorerUrlStateService.updateUrlState({mlShowCharts:e})}}var Kg=a(164);const Zg=s.a.createContext(void 0);function ej(){const e=Object(n.useContext)(Zg);if(void 0===e)throw new Error("AnomalyExplorerContext has not been initialized.");return e}const tj=()=>{const{chartsStateService:e}=ej(),t=G()(e.getShowCharts$(),e.getShowCharts()),a=Object(n.useCallback)((t=>{e.setShowCharts(t.target.checked)}),[]),i=Object(n.useMemo)((()=>Object(o.htmlIdGenerator)()()),[]);return Object(g.jsx)(o.EuiCheckbox,{id:i,label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.controls.checkboxShowCharts.showChartsCheckboxLabel",defaultMessage:"Show charts"}),checked:t,onChange:a})},aj=nt.c.KUERY;function ij({inputString:e,queryLanguage:t,indexPattern:a}){var i;let n={};const s=[],o=Object(bi.fromKueryExpression)(e),r=o&&"and"===o.function;return o&&Array.isArray(o.arguments)&&o.arguments.forEach((e=>{void 0!==e.arguments?e.arguments.forEach((e=>{"string"==typeof e.value&&s.push(e.value)})):"string"==typeof e.value&&s.push(e.value)})),t===nt.c.KUERY?n=Object(bi.toElasticsearchQuery)(Object(bi.fromKueryExpression)(e),a):t===nt.c.LUCENE&&(n=Object(bi.luceneStringToDsl)(e)),{clearSettings:Boolean((null===(i=n)||void 0===i?void 0:i.match_all)&&0===Object.keys(n.match_all).length),settings:{filterQuery:n,queryString:e,tableQueryString:e,isAndOperator:r,filteredFields:s}}}function nj({filterActive:e,queryString:t}){return void 0!==t&&!0===e?{language:nt.c.KUERY,query:t}:{query:"",language:aj}}var sj={name:"qhxz92",styles:"max-width:100%"};const oj=({filterActive:e,filterPlaceHolder:t,indexPattern:a,queryString:i,updateLanguage:s})=>{const{anomalyExplorerCommonStateService:l}=ej(),{services:c}=Object(y.b)(),{unifiedSearch:d,data:u,storage:p,appName:m,notifications:b,http:f,docLinks:h,uiSettings:j,dataViews:x}=c,[v,O]=Object(n.useState)(nj({filterActive:e,queryString:i})),[E,w]=Object(n.useState)(void 0);return Object(n.useEffect)((function(){O(nj({filterActive:e,queryString:i}))}),[e,i]),Object(g.jsx)(o.EuiInputPopover,{css:sj,closePopover:w.bind(null,void 0),input:Object(g.jsx)(jp.QueryStringInput,{bubbleSubmitEvent:!1,query:v,indexPatterns:[],onChange:e=>{v.language!==e.language&&s(e.language),O(e)},onSubmit:e=>{try{const{clearSettings:t,settings:i}=ij({inputString:e.query,queryLanguage:e.language,indexPattern:a});!0===t?l.clearFilterSettings():l.setFilterSettings(i)}catch(t){console.log("Invalid query syntax in search bar",t),w({query:e.query,message:t.message})}},placeholder:t,disableAutoFocus:!0,dataTestSubj:"explorerQueryInput",languageSwitcherPopoverAnchorPosition:"rightDown",appName:m,deps:{unifiedSearch:d,notifications:b,http:f,docLinks:h,uiSettings:j,data:u,storage:p,dataViews:x}}),isOpen:(null==E?void 0:E.query)===v.query&&""!==(null==E?void 0:E.message)},Object(g.jsx)(o.EuiCode,null,r.i18n.translate("xpack.ml.explorer.invalidKuerySyntaxErrorMessageQueryBar",{defaultMessage:"Invalid query"}),": ",null==E?void 0:E.message.split("\n")[0]))};var rj=a(166),lj=a.n(rj),cj=a(77),dj=a(131);const uj=e=>{const{services:{cases:t}}=Object(dj.a)(),a=null==t?void 0:t.hooks.getUseCasesAddToExistingCaseModal();return Object(n.useCallback)((t=>{const i={...t,id:Object(Ru.stringHash)(JSON.stringify(t)).toString()};if(!a)throw new Error("Cases modal is not available");a.open({attachments:[{type:cj.CommentType.persistableState,persistableStateAttachmentTypeId:e,persistableStateAttachmentState:JSON.parse(JSON.stringify(i))}]})}),[e])};var pj=a(40),mj=a(265),bj=a(109),fj=a(53);function hj(){const{services:{savedObjects:{client:e},dashboard:{locator:t}}}=Object(y.b)();return Object(n.useMemo)((()=>function(e,t){return{fetchDashboards:async t=>await e.find({type:"dashboard",perPage:1e3,search:t?`${t}*`:"",searchFields:["title^3","description"]}),getDashboardEditUrl:async e=>await t.getUrl({dashboardId:e,viewMode:fj.ViewMode.EDIT,useHash:!1})}}(e,t)),[e,t])}const gj=()=>{const{notifications:{toasts:e}}=Object(y.b)(),t=hj(),[a,i]=Object(n.useState)(!1);Object(n.useEffect)((()=>(l(),()=>{l.cancel()})),[]);const s=Object(n.useMemo)((()=>({onChange:({queryText:e})=>{i(!0),l(e)},box:{incremental:!0,"data-test-subj":"mlDashboardsSearchBox"}})),[]),[o,r]=Object(n.useState)([]),l=Object(n.useCallback)(Object(Q.debounce)((async a=>{try{const e=(await t.fetchDashboards(a)).savedObjects.map((e=>({id:e.id,title:e.attributes.title,description:e.attributes.description,attributes:e.attributes})));r(e)}catch(t){e.danger({body:t})}i(!1)}),500),[]);return{dashboardItems:o,search:s,isLoading:a}},jj=({onClose:e,dashboardItems:t,isLoading:a,search:i,addToDashboardAndEditCallback:n,title:s,disabled:l,children:c})=>{const d=[{field:"title",name:r.i18n.translate("xpack.ml.explorer.dashboardsTable.titleColumnHeader",{defaultMessage:"Title"}),sortable:!0,truncateText:!0},{field:"description",name:r.i18n.translate("xpack.ml.explorer.dashboardsTable.descriptionColumnHeader",{defaultMessage:"Description"}),truncateText:!0},{field:"description",name:r.i18n.translate("xpack.ml.explorer.dashboardsTable.actionsHeader",{defaultMessage:"Actions"}),width:"80px",actions:[{name:r.i18n.translate("xpack.ml.explorer.dashboardsTable.editActionName",{defaultMessage:"Add to dashboard"}),description:r.i18n.translate("xpack.ml.explorer.dashboardsTable.editActionName",{defaultMessage:"Add to dashboard"}),icon:"documentEdit",type:"icon",enabled:()=>!l,onClick:async e=>{await n(e)},"data-test-subj":"mlEmbeddableAddAndEditDashboard"}]}];return Object(g.jsx)(o.EuiModal,{onClose:e.bind(null,void 0),"data-test-subj":"mlAddToDashboardModal"},Object(g.jsx)(o.EuiModalHeader,null,Object(g.jsx)(o.EuiModalHeaderTitle,null,s)),Object(g.jsx)(o.EuiModalBody,null,c,Object(g.jsx)(o.EuiFormRow,{fullWidth:!0,label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.addToDashboard.selectDashboardsLabel",defaultMessage:"Select dashboards:"}),"data-test-subj":"mlDashboardSelectionContainer"},Object(g.jsx)(o.EuiInMemoryTable,{itemId:"id",isSelectable:!1,hasActions:!0,items:t,loading:a,columns:d,search:i,pagination:!0,sorting:!0,"data-test-subj":"mlDashboardSelectionTable"+(a?" loading":" loaded"),rowProps:e=>({"data-test-subj":`mlDashboardSelectionTableRow row-${e.id}`})}))),Object(g.jsx)(o.EuiModalFooter,null,Object(g.jsx)(o.EuiButtonEmpty,{onClick:e.bind(null,void 0)},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.addToDashboard.cancelButtonLabel",defaultMessage:"Cancel"}))))};function xj(e,t){const{services:{embeddable:a}}=Object(y.b)(),i=hj();return{addToDashboardAndEditCallback:Object(n.useCallback)((async n=>{const s=a.getStateTransfer(),o=n.id,r=await i.getDashboardEditUrl(o);await s.navigateToWithEmbeddablePackage(mi.DashboardConstants.DASHBOARDS_ID,{path:r,state:{type:e,input:t()}})}),[t])}}const vj=({onClose:e,jobIds:t,viewBy:a,queryString:i})=>{const{dashboardItems:l,isLoading:c,search:d}=gj(),[u,p]=Object(n.useState)(Xg.h.OVERALL),b=Object(n.useCallback)((()=>{const e=function(e,t){return{title:Object(mj.getDefaultSwimlanePanelTitle)(e).concat(t?`- ${t}`:""),id:Object(o.htmlIdGenerator)()()}}(t,i);return{...e,jobIds:t,swimlaneType:u,...u===Xg.h.VIEW_BY?{viewBy:a}:{},...void 0!==i?{query:{query:i,language:nt.c.KUERY}}:{}}}),[u]),{addToDashboardAndEditCallback:f}=xj(bj.b,b),h=[{id:Xg.h.OVERALL,label:r.i18n.translate("xpack.ml.explorer.overallLabel",{defaultMessage:"Overall"})},{id:Xg.h.VIEW_BY,label:r.i18n.translate("xpack.ml.explorer.viewByFieldLabel",{defaultMessage:"View by {viewByField}",values:{viewByField:a}})}],j=Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.addToDashboard.swimlanes.selectSwimlanesLabel",defaultMessage:"Select swim lane view:"})},Object(g.jsx)(o.EuiRadioGroup,{options:h,idSelected:u,onChange:e=>{p(e)},"data-test-subj":"mlAddToDashboardSwimlaneTypeSelector"})),Object(g.jsx)(o.EuiSpacer,{size:"m"})),x=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.addToDashboard.swimlanes.dashboardsTitle",defaultMessage:"Add swim lane to a dashboard"});return Object(g.jsx)(jj,{onClose:e,dashboardItems:l,isLoading:c,search:d,addToDashboardAndEditCallback:f,disabled:!1,title:x},j)};var yj=a(184);const Oj=()=>Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.anomalySwimLane.noOverallDataMessage",defaultMessage:"No anomalies found in the overall bucket results for this time range"});var Ej=a(266);const wj=()=>Object(g.jsx)(dm,{anchorPosition:"upCenter",title:r.i18n.translate("xpack.ml.explorer.anomalyTimelinePopoverTitle",{defaultMessage:"Anomaly timelines"})},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.anomalyTimelinePopoverBasicExplanation",defaultMessage:"Swim lanes provide an overview of the buckets of data that have been analyzed within the selected time period. You can view an overall swim lane or view them by job or influencer."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.anomalyTimelinePopoverScoreExplanation",defaultMessage:"Each block in a swim lane is colored according to its anomaly score, which is a value from 0 to 100. The blocks with high scores are shown in red and low scores are indicated in blue."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.anomalyTimelinePopoverAdvancedExplanation",defaultMessage:"The anomaly scores that you see in each section of the Anomaly Explorer might differ slightly. This disparity occurs because for each job there are bucket results, overall bucket results, influencer results, and record results. Anomaly scores are generated for each type of result. The overall swim lane shows the maximum overall bucket score for each block. When you view a swim lane by job, it shows the maximum bucket score in each block. When you view by influencer, it shows the maximum influencer score in each block."})),Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.anomalyTimelinePopoverSelectionExplanation",defaultMessage:"When you select one or more blocks in the swim lanes, the list of anomalies and top influencers is likewise filtered to provide information relative to that selection."})));var Mj=a(116),Sj=a(249),_j={name:"1np9cuq",styles:"margin-left:auto !important;align-self:baseline"},Tj={name:"vavmm1",styles:"max-width:500px"};const Cj=s.a.memo((({explorerState:e})=>{var t,a,i;const{services:{application:{capabilities:l},charts:c,cases:d}}=Object(y.b)(),u=Object(un.b)(!0),p=null==d?void 0:d.hooks.getUseCasesAddToExistingCaseModal(),{anomalyExplorerCommonStateService:b,anomalyTimelineStateService:f}=ej(),h=f.setSelectedCells.bind(f),[j,x]=Object(n.useState)(!1),[v,O]=Object(n.useState)(!1),E=null!==(t=null===(a=l.dashboard)||void 0===a?void 0:a.createNew)&&void 0!==t&&t,w=Object(Bn.a)(),{overallAnnotations:M}=e,{filterActive:S,queryString:_}=G()(b.getFilterSettings$(),b.getFilterSettings()),T=G()(f.getSwimLaneCardinality$()),C=G()(b.getSelectedJobs$(),b.getSelectedJobs()),k=G()(f.isOverallSwimLaneLoading$(),!0),F=G()(f.getContainerWidth$(),f.getContainerWidth()),I=G()(f.isViewBySwimLaneLoading$(),!0),D=G()(f.getOverallSwimLaneData$()),A=G()(f.getViewBySwimLaneData$()),L=G()(f.getSelectedCells$(),f.getSelectedCells()),R=G()(f.getSwimLaneSeverity$()),N=G()(f.getViewBySwimlaneFieldName$()),P=G()(f.getViewBySwimLaneOptions$(),f.getViewBySwimLaneOptions()),{viewByPerPage:z,viewByFromPage:B}=G()(f.getSwimLanePagination$(),f.getSwimLanePagination()),[V,J]=Object(n.useState)(f.getSwimLaneSeverity()),U=function(e){if(void 0!==(null==e?void 0:e.times))return{earliestMs:1e3*e.times[0],latestMs:1e3*e.times[1]-1}}(L),q=U?`${Object(Je.c)(U.earliestMs)} - ${Object(Je.c)(U.latestMs)}`:null;lj()((()=>{V!==R&&f.setSeverity(V)}),500,[V,R]);const $=uj(pj.ANOMALY_SWIMLANE_EMBEDDABLE_TYPE),W=Object(n.useCallback)((e=>{$({swimlaneType:e,...e===Xg.h.VIEW_BY?{viewBy:N}:{},jobIds:null==C?void 0:C.map((e=>e.id)),timeRange:u,...Object(Mj.a)(_)&&""!==_?{query:{query:_,language:nt.c.KUERY}}:{}})}),[$,C,u,N,_]),H=Object(n.useMemo)((()=>M.annotationsData),[M]),Y=Object(n.useCallback)((e=>()=>{x(!1),e()}),[x]),X=Object(n.useMemo)((()=>{const e=[],t=[{id:0,items:e}];E&&e.push({name:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.addToDashboardLabel",defaultMessage:"Add to dashboard"}),onClick:Y(O.bind(null,!0)),"data-test-subj":"mlAnomalyTimelinePanelAddToDashboardButton"});const a=null==d?void 0:d.helpers.canUseCases();return(null!=a&&a.create||null!=a&&a.update)&&p&&(e.push({panel:1,name:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.attachToCaseLabel",defaultMessage:"Add to case"}),"data-test-subj":"mlAnomalyTimelinePanelAttachToCaseButton"}),t.push({id:1,initialFocusedItemIndex:0,title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.attachToCaseLabel",defaultMessage:"Add to case"}),items:[{name:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.attachOverallSwimLane",defaultMessage:"Overall"}),onClick:Y(W.bind(null,"overall")),"data-test-subj":"mlAnomalyTimelinePanelAttachOverallButton"},{name:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.attachViewBySwimLane",defaultMessage:"View by {viewByField}",values:{viewByField:N}}),onClick:Y(W.bind(null,"viewBy")),"data-test-subj":"mlAnomalyTimelinePanelAttachViewByButton"}]})),t}),[E,W,N]),Q=Object(n.useMemo)((()=>{if(L)return L.type===Xg.h.OVERALL?L:{type:Xg.h.OVERALL,lanes:[Xg.g],times:L.times}}),[L]),K=Object(n.useMemo)((()=>Qg.AnomalyTimelineService.isOverallSwimlaneData(D)?{min:1e3*D.earliest,max:1e3*D.latest,minInterval:1e3*D.interval}:void 0),[D]),Z=Object(n.useCallback)((e=>{f.setContainerWidth(e)}),[]);return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiPanel,{paddingSize:"m",hasShadow:!1,hasBorder:!0},Object(g.jsx)(o.EuiFlexGroup,{direction:"row",gutterSize:"xs",responsive:!1,alignItems:"baseline"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.anomalyTimelineTitle",defaultMessage:"Anomaly timeline"})))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(wj,null)),X[0].items.length>0?Object(g.jsx)(o.EuiFlexItem,{grow:!1,css:_j},Object(g.jsx)(o.EuiPopover,{button:Object(g.jsx)(o.EuiButtonIcon,{size:"s","aria-label":r.i18n.translate("xpack.ml.explorer.swimlaneActions",{defaultMessage:"Actions"}),color:"text",iconType:"boxesHorizontal",onClick:x.bind(null,!j),"data-test-subj":"mlAnomalyTimelinePanelMenu"}),isOpen:j,closePopover:x.bind(null,!1),panelPaddingSize:"none",anchorPosition:"downLeft"},Object(g.jsx)(o.EuiContextMenu,{initialPanelId:0,panels:X}))):null),Object(g.jsx)(o.EuiSpacer,{size:"s"}),Object(g.jsx)(o.EuiFlexGroup,{direction:"row",gutterSize:"m",responsive:!1,alignItems:"baseline"},P.length>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiSelect,{prepend:r.i18n.translate("xpack.ml.explorer.viewByLabel",{defaultMessage:"View by"}),compressed:!0,id:"selectViewBy",options:(ee=P,ee.map((e=>({value:e,text:e})))),value:N,onChange:e=>{f.setViewBySwimLaneFieldName(e.target.value)}}))),Object(g.jsx)(o.EuiFlexItem,{grow:!0,css:Tj},Object(g.jsx)(Ej.a,{value:null!=V?V:0,onChange:Object(n.useCallback)((e=>{J(e)}),[])}))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiFlexGroup,{direction:"row",gutterSize:"m",responsive:!1,alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiText,{size:"xs",color:"subdued"},q&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.sortedByMaxAnomalyScoreForTimeFormattedLabel",defaultMessage:"(Sorted by max anomaly score for {viewByLoadedForTimeFormatted})",values:{viewByLoadedForTimeFormatted:q}}),Object(Mj.a)(q)?null:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.sortedByMaxAnomalyScoreLabel",defaultMessage:"(Sorted by max anomaly score)"}),!0===S&&N===Xg.j&&Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.jobScoreAcrossAllInfluencersLabel",defaultMessage:"(Job score across all influencers)"}))),Object(g.jsx)(o.EuiFlexItem,{grow:!1,css:Object(g.css)({visibility:L?"visible":"hidden"},"","")},Object(g.jsx)(o.EuiButtonEmpty,{size:"xs",onClick:h.bind(f,void 0),"data-test-subj":"mlAnomalyTimelineClearSelection"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.clearSelectionLabel",defaultMessage:"Clear selection"})))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),K&&Array.isArray(H)&&H.length>0?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(gg.a,null,(e=>Object(g.jsx)(Sj.a,{chartWidth:F,domain:K,annotationsData:H,tooltipService:e}))),Object(g.jsx)(o.EuiSpacer,{size:"m"})):null,Object(g.jsx)(yj.b,{id:"overall","data-test-subj":"mlAnomalyExplorerSwimlaneOverall",filterActive:S,timeBuckets:w,swimlaneData:D,swimlaneType:Xg.h.OVERALL,selection:Q,onCellsSelection:h,onResize:Z,isLoading:k,noDataWarning:Object(g.jsx)(o.EuiText,{textAlign:"center"},Object(g.jsx)("h5",null,Object(g.jsx)(Oj,null))),showTimeline:!1,showLegend:!1,yAxisWidth:Sj.c,chartsService:c}),Object(g.jsx)(o.EuiSpacer,{size:"m"}),P.length>0&&Object(g.jsx)(yj.b,{id:"view_by","data-test-subj":"mlAnomalyExplorerSwimlaneViewBy",filterActive:S,timeBuckets:w,showLegend:!1,swimlaneData:A,swimlaneType:Xg.h.VIEW_BY,selection:L,onCellsSelection:h,onResize:Z,fromPage:B,perPage:z,swimlaneLimit:T,chartsService:c,onPaginationChange:({perPage:e,fromPage:t})=>{e&&f.setSwimLanePagination({viewByPerPage:e}),t&&f.setSwimLanePagination({viewByFromPage:t})},isLoading:k||I,yAxisWidth:Sj.c,noDataWarning:Object(g.jsx)(o.EuiText,{textAlign:"center"},Object(g.jsx)("h5",null,"string"==typeof N?N===Xg.j?Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.noResultForSelectedJobsMessage",defaultMessage:"No results found for selected {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:null!==(i=null==C?void 0:C.length)&&void 0!==i?i:1}}):Object(g.jsx)(Rg,{viewBySwimlaneFieldName:N,showFilterMessage:!0===S}):null))})),v&&C&&Object(g.jsx)(vj,{onClose:async e=>{O(!1),e&&await e()},jobIds:C.map((({id:e})=>e)),viewBy:N,queryString:_}));var ee}),((e,t)=>Object(Q.isEqual)(e.explorerState,t.explorerState)));var kj=a(338),Fj=a(349);function Ij(e,t){const a={};for(let i=0;i<e.length;i++){const n=e[i],s=n.entityValue;n.jobId===t&&(void 0===a[s]?a[s]={count:1,entityValue:s,max_severity:Math.floor(n.severity)}:(a[s].count+=1,n.severity>a[s].max_severity&&(a[s].max_severity=Math.floor(n.severity))))}return Object.values(a)}const Dj=({anomalies:e,jobIds:t})=>{const[a,i]=Object(n.useState)(),{services:{maps:l}}=Object(y.b)(),c=Object(n.useCallback)((async()=>{if(!l)return;const a=await Promise.all(t.map((async t=>{const a=new Set;let i;for(let n=0;n<e.length&&(t===e[n].jobId&&""!==e[n].entityValue&&void 0!==e[n].entityValue&&""!==e[n].entityName&&void 0!==e[n].entityName&&(a.add(e[n].entityValue),i||(i=e[n].entityName)),3!==a.size);n++);const n=await l.suggestEMSTermJoinConfig({sampleValues:Array.from(a),sampleValuesColumnName:i||""});return n?{jobId:t,...n}:n})));i(a.filter(Mj.a))}),[...t]);Object(n.useEffect)((function(){e&&e.length>0&&c()}),[...t]);const d=Object(n.useMemo)((()=>null!=a&&a.length?a.map((t=>((e,{layerId:t,field:a,jobId:i})=>({id:Object(o.htmlIdGenerator)()(),label:r.i18n.translate("xpack.ml.explorer.anomaliesMap.anomaliesCount",{defaultMessage:"Anomalies count: {jobId}",values:{jobId:i}}),joins:[{leftField:a,right:{id:"anomaly_count",type:Sf.SOURCE_TYPES.TABLE_SOURCE,__rows:Ij(e,i),__columns:[{name:"entityValue",type:"string"},{name:"count",type:"number"},{name:"max_severity",type:"number"}],term:"entityValue"}}],sourceDescriptor:{type:"EMS_FILE",id:t},style:{type:"VECTOR",properties:{icon:{type:Sf.STYLE_TYPE.STATIC,options:{value:"marker"}},fillColor:{type:Sf.STYLE_TYPE.DYNAMIC,options:{color:"Blue to Red",colorCategory:"palette_0",fieldMetaOptions:{isEnabled:!0,sigma:3},type:Sf.COLOR_MAP_TYPE.ORDINAL,field:{name:"count",origin:Sf.FIELD_ORIGIN.JOIN},useCustomColorRamp:!1}},lineColor:{type:Sf.STYLE_TYPE.DYNAMIC,options:{fieldMetaOptions:{isEnabled:!0}}},lineWidth:{type:Sf.STYLE_TYPE.STATIC,options:{size:1}}},isTimeAware:!0},visible:!1,type:Sf.LAYER_TYPE.GEOJSON_VECTOR}))(e,t)),[]):[]),[a,e]),u=d.filter((e=>{var t,a;return(Array.isArray(e.joins)?null===(t=e.joins[0])||void 0===t||null===(a=t.right)||void 0===a?void 0:a.__rows:[]).length}));return u.length>0&&(u[0].visible=!0),0===(null==a?void 0:a.length)||0===u.length?null:Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiPanel,{"data-test-subj":"mlAnomaliesMapContainer",hasShadow:!1,hasBorder:!0},Object(g.jsx)(o.EuiAccordion,{id:"mlAnomalyExplorerAnomaliesMapAccordionId",initialIsOpen:!0,buttonContent:Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.mapTitle",defaultMessage:"Anomaly count by location {infoTooltip}",values:{infoTooltip:Object(g.jsx)(o.EuiIconTip,{content:"Map colors indicate the number of anomalies in each area.",position:"top",type:"iInCircle"})}})))},Object(g.jsx)("div",{"data-test-subj":"mlAnomalyExplorerAnomaliesMap",style:{width:"100%",height:300}},Object(g.jsx)(Fj.a,{layerList:d})))),Object(g.jsx)(o.EuiSpacer,{size:"m"}))};var Aj=a(267),Lj=a(336);const Rj=({onClose:e,jobIds:t})=>{const[a]=Object(qh.d)(),[i,s]=Object(n.useState)(Kg.b),{anomalyExplorerCommonStateService:r,anomalyTimelineStateService:l}=ej(),{queryString:c}=G()(r.getFilterSettings$(),r.getFilterSettings()),d=G()(l.getSelectedCells$(),l.getSelectedCells()),u=Object(n.useCallback)((()=>{const e=Object(xp.h)(d,null==d?void 0:d.viewByFieldName),n=null!=e?e:[],s=function(e,t){return{id:Object(o.htmlIdGenerator)()(),title:Object(Aj.getDefaultExplorerChartsPanelTitle)(e).concat(t?`- ${t}`:"")}}(t,c),r=n.map((e=>Object(te.d)(e.fieldName,e.fieldValue))).join(" or ");return{...s,jobIds:t,maxSeriesToPlot:null!=i?i:Kg.b,severityThreshold:a.val,...Object(Mj.a)(c)&&""!==c||void 0!==r&&""!==r?{query:{query:""===c?r:c,language:nt.c.KUERY}}:{}}}),[t,i,a,c,d]),{dashboardItems:p,isLoading:b,search:f}=gj(),{addToDashboardAndEditCallback:h}=xj(bj.a,u),j=Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.addToDashboard.anomalyCharts.dashboardsTitle",defaultMessage:"Add anomaly charts to dashboards"}),x=Object(g.jsx)(o.EuiFormRow,{label:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.addToDashboard.anomalyCharts.maxSeriesToPlotLabel",defaultMessage:"Maximum number of series to plot"})},Object(g.jsx)(o.EuiFieldNumber,{"data-test-subj":"mlAnomalyChartsInitializerMaxSeries",id:"selectMaxSeriesToPlot",name:"selectMaxSeriesToPlot",value:i,onChange:e=>s(parseInt(e.target.value,10)),min:0,max:Lj.b}));return Object(g.jsx)(jj,{onClose:e,dashboardItems:p,isLoading:b,search:f,addToDashboardAndEditCallback:h,disabled:!1,title:j},x)};var Nj={name:"1ktfjpo",styles:"margin-left:auto;align-self:baseline"};const Pj=({selectedJobs:e,selectedCells:t,bounds:a,interval:i,chartsCount:l})=>{var c,d;const{services:{application:{capabilities:u},cases:p}}=Object(y.b)(),b=Object(un.b)(!0),[f,h]=Object(n.useState)(!1),[j,x]=Object(n.useState)(!1),v=Object(n.useCallback)((e=>{h(!1),e()}),[h]),O=uj(bj.a),E=null!==(c=null===(d=u.dashboard)||void 0===d?void 0:d.createNew)&&void 0!==c&&c,w=null==p?void 0:p.helpers.canUseCases(),{anomalyExplorerCommonStateService:M,chartsStateService:S}=ej(),{queryString:_}=G()(M.getFilterSettings$(),M.getFilterSettings()),T=G()(S.getChartsData$(),S.getChartsData()),C=Object(n.useMemo)((()=>{if(T.seriesToPlot.length>0)return{from:Object(o.formatDate)(T.seriesToPlot[0].plotEarliest,"MMM D, YYYY @ HH:mm:ss.SSS"),to:Object(o.formatDate)(T.seriesToPlot[0].plotLatest,"MMM D, YYYY @ HH:mm:ss.SSS")};if(t&&void 0!==i&&void 0!==a){const{earliestMs:e,latestMs:i}=Object(xp.j)(t,a);return{from:Object(o.formatDate)(e,"MMM D, YYYY @ HH:mm:ss.SSS"),to:Object(o.formatDate)(i,"MMM D, YYYY @ HH:mm:ss.SSS"),mode:"absolute"}}return b}),[T.seriesToPlot,b,t,a,i]),k=Object(n.useMemo)((()=>{const a=[];if(E&&a.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"addToDashboard",onClick:v.bind(null,x.bind(null,!0)),"data-test-subj":"mlAnomalyAddChartsToDashboardButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.anomalies.addToDashboardLabel",defaultMessage:"Add to dashboard"}))),null!=w&&w.create||null!=w&&w.update){const i=Object(xp.h)(t,null==t?void 0:t.viewByFieldName),n=Array.isArray(i)?i.map((e=>Object(te.d)(e.fieldName,e.fieldValue))).join(" or "):"";a.push(Object(g.jsx)(o.EuiContextMenuItem,{key:"attachToCase",onClick:v.bind(null,O.bind(null,{jobIds:null==e?void 0:e.map((e=>e.id)),timeRange:C,maxSeriesToPlot:Kg.b,...Object(Mj.a)(_)&&""!==_||""!==n?{query:{query:""===_?n:_,language:nt.c.KUERY}}:{}})),"data-test-subj":"mlAnomalyAttachChartsToCasesButton"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.attachToCaseLabel",defaultMessage:"Add to case"})))}return a}),[E,b,v,e,t,_,C]),F=e.map((({id:e})=>e));return Object(g.jsx)(s.a.Fragment,null,k.length>0&&l>0?Object(g.jsx)(o.EuiFlexItem,{grow:!1,css:Nj},Object(g.jsx)(o.EuiPopover,{button:Object(g.jsx)(o.EuiButtonIcon,{size:"s","aria-label":r.i18n.translate("xpack.ml.explorer.anomalies.actionsAriaLabel",{defaultMessage:"Actions"}),color:"text",iconType:"boxesHorizontal",onClick:h.bind(null,!f),"data-test-subj":"mlExplorerAnomalyPanelMenu",disabled:l<1}),isOpen:f,closePopover:h.bind(null,!1),panelPaddingSize:"none",anchorPosition:"downLeft"},Object(g.jsx)(o.EuiPopoverTitle,{paddingSize:"s"},r.i18n.translate("xpack.ml.explorer.anomalies.actionsPopoverLabel",{defaultMessage:"Anomaly charts"})),Object(g.jsx)(o.EuiContextMenuPanel,{items:k}))):null,j&&e?Object(g.jsx)(Rj,{onClose:async()=>{x(!1)},jobIds:F}):null)},zj=({children:e,jobSelectorProps:t,noInfluencersConfigured:a,influencers:i,filterActive:n,filterPlaceHolder:r,indexPattern:l,queryString:c,updateLanguage:d})=>Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiPageHeader,null,Object(g.jsx)(o.EuiPageHeaderSection,{style:{width:"100%"}},Object(g.jsx)(Hh.a,t),l&&d?Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(oj,{filterActive:!!n,filterPlaceHolder:r,indexPattern:l,queryString:c,updateLanguage:d}),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(o.EuiHorizontalRule,{margin:"none"})):null)),e),Bj=({invalidTimeRangeError:e,showCharts:t,severity:a,stoppedPartitions:i,selectedJobsRunning:l,timefilter:c,timeBuckets:d,selectedCells:u,swimLaneSeverity:p,explorerState:b,overallSwimlaneData:f})=>{var h,j;const x=Object(o.useIsWithinBreakpoints)(["xs","s"]),[v,O]=Object(ts.b)(as.a,{topInfluencers:{isCollapsed:!1,size:20},mainPage:{size:80}}),E=Object(n.useRef)(null),w=Object(n.useRef)(),M=Object(n.useRef)(!1);Object(n.useEffect)((function(){!M.current&&w.current&&E.current&&(M.current=!0,v.topInfluencers.isCollapsed&&setTimeout((()=>{w.current&&w.current()}),0))}),[w.current,M,E.current,v]);const S=Object(n.useCallback)((e=>{O({mainPage:{size:e.mainPage},topInfluencers:{...v.topInfluencers,size:e.topInfluencers}})}),[v]),T=Object(n.useCallback)((()=>{M.current=!0;const e=v.topInfluencers.isCollapsed;O(e?{mainPage:{size:80},topInfluencers:{size:20,isCollapsed:!e}}:{mainPage:v.mainPage,topInfluencers:{...v.topInfluencers,isCollapsed:!e}})}),[v]),{displayWarningToast:C,displayDangerToast:k}=Object(Z.c)(),{anomalyTimelineStateService:F,anomalyExplorerCommonStateService:I,chartsStateService:D}=ej(),A=Object(n.useMemo)((()=>Object(o.htmlIdGenerator)()),[]),[L,R]=Object(n.useState)(aj),[N,P]=Object(n.useState)({}),z=G()(I.getFilterSettings$(),I.getFilterSettings()),B=G()(I.getSelectedJobs$(),I.getSelectedJobs()),V=Object(n.useCallback)(((e,t,a)=>{const{filterActive:i,queryString:n}=z,s=b.indexPattern;let o="";const l=Object(xp.c)(e),c=Object(xp.b)(t);if(a===Xg.d.ADD){const a=Object(xp.g)(e,t);if(null!==n.match(a))return;o=`${n?`${n} and `:""}${l}:"${c}"`}else if(a===Xg.d.REMOVE){if(!1===i)return;o=Object(xp.q)(n,l,c)}try{const{clearSettings:e,settings:t}=ij({inputString:`${o}`,queryLanguage:L,indexPattern:s});!0===e?I.clearFilterSettings():I.setFilterSettings(t)}catch(e){console.log("Invalid query syntax from table",e),k(r.i18n.translate("xpack.ml.explorer.invalidKuerySyntaxErrorMessageFromTable",{defaultMessage:"Invalid syntax in query bar. The input must be valid Kibana Query Language (KQL)"}))}}),[b,L,z]);Object(n.useEffect)((()=>{e&&C(r.i18n.translate("xpack.ml.explorer.invalidTimeRangeInUrlCallout",{defaultMessage:"The time filter was changed to the full range due to an invalid default time filter. Check the advanced settings for {field}.",values:{field:_e}}))}),[]);const{services:{charts:J}}=Object(y.b)(),{euiTheme:U}=Object(o.useEuiTheme)(),q=Object(y.d)(),$=Object(Cn.b)().dataViewsContract,{annotations:W,filterPlaceHolder:H,indexPattern:Y,influencers:X,loading:Q,noInfluencersConfigured:K,tableData:ee}=b,te=G()(D.getChartsData$(),D.getChartsData()),{filterActive:ae,queryString:ie}=z,ne=G()(F.isOverallSwimLaneLoading$(),!0),se=G()(F.isViewBySwimLaneLoading$(),!0),oe=Q||ne||se,re=G()(F.getSwimLaneBucketInterval$(),F.getSwimLaneBucketInterval()),{annotationsData:le,totalCount:ce,error:de}=W,ue=Array.isArray(le)?le.length:0,pe=(null!=ce?ce:0)>ue?Object(g.jsx)(o.EuiBadge,{color:"hollow"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.annotationsOutOfTotalCountTitle",defaultMessage:"First {visibleCount} out of a total of {totalCount}",values:{visibleCount:ue,totalCount:ce}})):Object(g.jsx)(o.EuiBadge,{color:"hollow"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.annotationsTitleTotalCount",defaultMessage:"Total: {count}",values:{count:ue}})),me={dateFormatTz:Object(xp.e)()},be=!B||0===B.length,fe=!(null==f||!f.points)&&f.points.length>0,he=fe&&f.points.some((e=>e.value>0))||(null===(h=ee.anomalies)||void 0===h?void 0:h.length)>0,ge=Object(Mj.a)(p),je=Array.isArray(B)?B.map((e=>e.id)):[];if(Object(n.useEffect)((()=>{be||Object(xp.k)(B,$).then((e=>P(e))).catch(console.error)}),[JSON.stringify(je)]),be&&!Q)return Object(g.jsx)(zj,{jobSelectorProps:me},Object(g.jsx)(Ng,null));if(!he&&!oe&&!ge)return Object(g.jsx)(zj,{jobSelectorProps:me},Object(g.jsx)(Pg,{hasResults:fe,selectedJobsRunning:l}));const xe=c.getActiveBounds(),ve=Object(g.jsx)("div",null,i&&Object(g.jsx)(o.EuiCallOut,{size:"s",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.stoppedPartitionsExistCallout",defaultMessage:"There may be fewer results than there could have been because stop_on_warn is turned on. Both categorization and subsequent anomaly detection have stopped for some partitions in {jobsWithStoppedPartitions, plural, one {job} other {jobs}} [{stoppedPartitions}] where the categorization status has changed to warn.",values:{jobsWithStoppedPartitions:i.length,stoppedPartitions:i.join(", ")}})}),Object(g.jsx)(Cj,{explorerState:b}),Object(g.jsx)(o.EuiSpacer,{size:"m"}),void 0!==de&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiTitle,{"data-test-subj":"mlAnomalyExplorerAnnotationsPanel error",size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.annotationsErrorTitle",defaultMessage:"Annotations"}))),Object(g.jsx)(o.EuiPanel,null,Object(g.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.ml.explorer.annotationsErrorCallOutTitle",{defaultMessage:"An error occurred loading annotations:"}),color:"danger",iconType:"alert"},Object(g.jsx)("p",null,de))),Object(g.jsx)(o.EuiSpacer,{size:"m"})),!1===Q&&null!==(j=ee.anomalies)&&void 0!==j&&j.length?Object(g.jsx)(Dj,{anomalies:ee.anomalies,jobIds:je}):null,ue>0&&Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiPanel,{"data-test-subj":"mlAnomalyExplorerAnnotationsPanel loaded",hasBorder:!0,hasShadow:!1},Object(g.jsx)(o.EuiAccordion,{id:A(),buttonContent:Object(g.jsx)(o.EuiTitle,{"data-test-subj":"mlAnomalyExplorerAnnotationsPanelButton",size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.annotationsTitle",defaultMessage:"Annotations {badge}",values:{badge:pe}})))},Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(_a,{jobIds:je,annotations:le,drillDown:!0,numberBadge:!1})))),Object(g.jsx)(Ia,null),Object(g.jsx)(o.EuiSpacer,{size:"m"})),!1===Q&&Object(g.jsx)(o.EuiPanel,{hasBorder:!0,hasShadow:!1},Object(g.jsx)(o.EuiFlexGroup,{direction:"row",gutterSize:"m",responsive:!1,alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.anomaliesTitle",defaultMessage:"Anomalies"})))),Object(g.jsx)(o.EuiFlexItem,{grow:!1,style:{marginLeft:"auto",alignSelf:"baseline"}},Object(g.jsx)(Pj,{selectedJobs:B,selectedCells:u,bounds:xe,interval:re?re.asSeconds():void 0,chartsCount:te.seriesToPlot.length}))),Object(g.jsx)(o.EuiFlexGroup,{direction:"row",gutterSize:"l",responsive:!0,alignItems:"center"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(qh.a,null)),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Uh,null)),te.seriesToPlot.length>0&&void 0!==u&&Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(tj,null))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),t?Object(g.jsx)(kj.a,_()({},te,{severity:a,timefilter:c,mlLocator:q,timeBuckets:d,onSelectEntity:V,chartsService:J})):null,Object(g.jsx)(o.EuiSpacer,{size:"m"}),Object(g.jsx)(vh,{bounds:xe,tableData:ee,influencerFilter:V,sourceIndicesWithGeoFields:N,selectedJobs:B})));return Object(g.jsx)(zj,{jobSelectorProps:me,noInfluencersConfigured:K,influencers:X,filterActive:ae,filterPlaceHolder:H,indexPattern:Y,queryString:ie,updateLanguage:R},Object(g.jsx)(o.EuiSpacer,{size:"m"}),K?Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiIconTip,{content:r.i18n.translate("xpack.ml.explorer.noConfiguredInfluencersTooltip",{defaultMessage:"The Top Influencers list is hidden because no influencers have been configured for the selected jobs."}),position:"right",type:"iInCircle"})),Object(g.jsx)(o.EuiFlexItem,null,ve)):Object(g.jsx)("div",null,Object(g.jsx)(o.EuiResizableContainer,{direction:x?"vertical":"horizontal",onPanelWidthChange:S},((e,t,a)=>(w.current=()=>a.togglePanel("topInfluencers",{direction:"left"}),Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(e,{panelRef:E,id:"topInfluencers",mode:["collapsible",{"data-test-subj":"mlTopInfluencersToggle",position:"top"}],minSize:"200px",initialSize:20,paddingSize:"none",onToggleCollapsed:T},Object(g.jsx)("div",{"data-test-subj":"mlAnomalyExplorerInfluencerList",css:Object(g.css)("padding:calc(",U.size.base," + ",U.border.width.thin,") ",U.size.l," ",U.size.l," 0;","")},Object(g.jsx)(o.EuiFlexGroup,{direction:"row",gutterSize:"xs",responsive:!1,alignItems:"baseline"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiTitle,{size:"xs"},Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.topInfuencersTitle",defaultMessage:"Top influencers"})))),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(dm,{anchorPosition:"upCenter",title:r.i18n.translate("xpack.ml.explorer.topInfluencersPopoverTitle",{defaultMessage:"Top influencers"})},Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.topInfluencersTooltip",defaultMessage:"View the relative impact of the top influencers in the selected time period and add them as filters on the results. Each influencer has a maximum anomaly score between 0-100 and a total anomaly score for that period."}))))),Object(g.jsx)(o.EuiSpacer,{size:"m"}),Q?Object(g.jsx)(o.EuiLoadingContent,{lines:10}):Object(g.jsx)(Yg,{influencers:X,influencerFilter:V}))),Object(g.jsx)(t,null),Object(g.jsx)(e,{id:"mainPage",mode:"main",minSize:"70%",initialSize:80,paddingSize:"none"},ve)))))))},Vj=(e,t)=>Object(Q.isEqual)(e,t),Jj=(e,t)=>Ze()(((e,t=null)=>function(a,...i){return e.apply(t,i)})(e,t),Vj),Uj=Jj(xp.o),Gj=Jj(xp.l),qj=Jj(xp.n),$j=Jj(xp.p),Wj=Jj(xp.m);var Hj=a(205),Yj=a(330);function Xj(){return{overallAnnotations:{error:void 0,annotationsData:[]},annotations:{error:void 0,annotationsData:[]},anomalyChartsDataLoading:!0,chartsData:{chartsPerRow:1,errorMessages:void 0,seriesToPlot:[],tooManyBuckets:!1,timeFieldName:"timestamp"},fieldFormatsLoading:!1,filterPlaceHolder:void 0,indexPattern:{title:Yj.a,fields:[]},influencers:{},isAndOperator:!1,loading:!0,maskAll:!1,noInfluencersConfigured:!0,queryString:"",selectedJobs:null,tableData:{anomalies:[],examplesByJobId:[""],interval:0,jobIds:[],showViewSeriesLink:!1},tableQueryString:""}}const Qj=e=>{const{influencers:t,noInfluencersConfigured:a}=e;if(void 0!==t&&!a)for(const e in t)if(t[e][0]&&t[e][0].influencerFieldValue)return{filterPlaceHolder:r.i18n.translate("xpack.ml.explorer.kueryBar.filterPlaceholder",{defaultMessage:"Filter by influencer fields… ({queryExample})",values:{queryExample:`${e} : ${t[e][0].influencerFieldValue}`}})};return{}},Kj=new at.Subject,Zj={state$:Kj.pipe(Object(za.flatMap)((e=>Object(at.isObservable)(e)?e:Object(at.from)([e]))),Object(za.distinctUntilChanged)(Q.isEqual)).pipe(Object(za.scan)(((e,t)=>{const{type:a,payload:i}=t;let n;switch(a){case Xg.c.CLEAR_EXPLORER_DATA:n=Xj();break;case Xg.c.CLEAR_INFLUENCER_FILTER_SETTINGS:n=function(e){return{...e,isAndOperator:!1,maskAll:!1,queryString:"",tableQueryString:"",...Object(xp.d)()}}(e);break;case Xg.c.CLEAR_JOBS:n={...e,...Object(xp.d)(),loading:!1,selectedJobs:[]};break;case Xg.c.JOB_SELECTION_CHANGE:n=((e,t)=>{const{selectedJobs:a}=t,i={...e,noInfluencersConfigured:0===Object(xp.f)(a).length,selectedJobs:a};if(!0===i.noInfluencersConfigured){const e={filterActive:!1,filteredFields:[],influencersFilterQuery:void 0,maskAll:!1,queryString:"",tableQueryString:""};Object.assign(i,e)}else i.indexPattern=Object(Hj.a)(a);return i.loading=!0,i})(e,i);break;case Xg.c.SET_CHARTS_DATA_LOADING:n={...e,anomalyChartsDataLoading:!0,chartsData:{chartsPerRow:1,errorMessages:void 0,seriesToPlot:[],tooManyBuckets:!1,timeFieldName:"timestamp"}};break;case Xg.c.SET_EXPLORER_DATA:n={...e,...i};break;default:n=e}return null===n.selectedJobs?n:{...n,...Qj(n)}}),Xj()),Object(za.shareReplay)(1)),clearExplorerData:()=>{Kj.next({type:Xg.c.CLEAR_EXPLORER_DATA})},clearInfluencerFilterSettings:()=>{Kj.next({type:Xg.c.CLEAR_INFLUENCER_FILTER_SETTINGS})},clearJobs:()=>{Kj.next({type:Xg.c.CLEAR_JOBS})},updateJobSelection:e=>{Kj.next(function(e){return Object(at.from)(If.a.populateFormats(e)).pipe(Object(za.map)((t=>{if(t.error)return null;const a=Object(xp.a)(K.a.jobs).map((t=>(t.selected=e.some((e=>t.id===e)),t))).filter((e=>e.selected));return{type:Xg.c.JOB_SELECTION_CHANGE,payload:{loading:!1,selectedJobs:a}}})))}(e))},setExplorerData:e=>{Kj.next((e=>({type:Xg.c.SET_EXPLORER_DATA,payload:e}))(e))},setChartsDataLoading:()=>{Kj.next({type:Xg.c.SET_CHARTS_DATA_LOADING})}},ex=(e,t)=>({id:"explorer",path:"/explorer",title:r.i18n.translate("xpack.ml.anomalyDetection.anomalyExplorer.docTitle",{defaultMessage:"Anomaly Explorer"}),render:(e,t)=>Object(g.jsx)(tx,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("ANOMALY_DETECTION_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.anomalyDetection.anomalyExplorerLabel",{defaultMessage:"Anomaly Explorer"})}],enableDatePicker:!0,"data-test-subj":"mlPageAnomalyExplorer"}),tx=({deps:e})=>{const{context:t,results:a}=I(void 0,void 0,e.config,e.dataViewsContract,{...W(e),jobs:K.a.loadJobsWrapper,jobsWithTimeRange:()=>X.ml.jobs.jobsWithTimerange(Object(xp.e)())}),i=Object(n.useMemo)((()=>new st.a),[]);return Object(g.jsx)(T.b,{context:t},Object(g.jsx)(ct.Provider,{value:i},Object(g.jsx)(ax,{jobsWithTimeRange:a.jobsWithTimeRange.jobs})))},ax=({jobsWithTimeRange:e})=>{var t,a,i,l,c;const{services:{cases:d}}=Object(y.b)(),[,,u]=function(){const[e]=Object(v.b)("mlExplorerSwimlane");return Object(v.b)(E.b.ANOMALY_EXPLORER,{mlExplorerSwimlane:e,mlExplorerFilter:{}})}(),p=function(e){const t=Object(y.g)(),{services:{mlServices:{mlApiServices:a},uiSettings:i}}=Object(y.b)(),[,,s]=Object(qh.d)(),o=Object(n.useMemo)((()=>Object(mt.mlResultsServiceProvider)(a)),[]),r=Object(n.useMemo)((()=>new Qg.AnomalyTimelineService(t,i,o)),[]);return Object(n.useMemo)((()=>{const i=new anomaly_explorer_common_state_AnomalyExplorerCommonStateService(e),n=new anomaly_timeline_state_service_AnomalyTimelineStateService(e,i,r,t),l=new Kg.a(t,a,o);return{anomalyExplorerCommonStateService:i,anomalyTimelineStateService:n,chartsStateService:new anomaly_charts_state_service_AnomalyChartsStateService(i,n,l,e,s)}}),[])}(u),[b]=Object(v.c)("_g"),[f,h]=Object(n.useState)(),[j,x]=Object(n.useState)(!1),O=Object(Bn.a)(),w=Object(y.g)({timeRangeSelector:!0,autoRefreshSelector:!0}),{jobIds:M}=(e=>{var t,a;const[i,s]=Object(v.c)("_g"),{toasts:o}=Object(y.f)(),l=Jg(),c=Object(n.useMemo)((()=>{var e;const t=(null==i||null===(e=i.ml)||void 0===e?void 0:e.jobIds)||[];return("string"==typeof t?[t]:t).map((e=>String(e)))}),[null==i||null===(t=i.ml)||void 0===t?void 0:t.jobIds]),d=Object(n.useMemo)((()=>function(e,t){return t.filter((t=>!1===e.some((e=>e.job_id===t))&&"*"!==t))}(e,c)),[c]),u=Object(n.useMemo)((()=>{const e=Object(Q.difference)(c,d);return e.sort(),e}),[c,d]),p=Object(n.useMemo)((()=>{var e,t;const a=null!==(e=null==i||null===(t=i.ml)||void 0===t?void 0:t.groups)&&void 0!==e?e:[];return{jobIds:u,selectedGroups:a}}),[u,null==i||null===(a=i.ml)||void 0===a?void 0:a.groups]);return Object(n.useEffect)((()=>{d.length>0&&o.addWarning(r.i18n.translate("xpack.ml.jobSelect.requestedJobsDoesNotExistWarningMessage",{defaultMessage:"Requested\n{invalidIdsLength, plural, one {job {invalidIds} does not exist} other {jobs {invalidIds} do not exist}}",values:{invalidIdsLength:d.length,invalidIds:d.join()}}))}),[d]),Object(n.useEffect)((()=>{0===u.length&&e.length>0&&l({singleSelection:!1}).then((({jobIds:e,time:t})=>{const a=(null==i?void 0:i.ml)||{};a.jobIds=e,s({ml:a,...void 0!==t?{time:t}:{}})})).catch((()=>{}))}),[e,u,s,null==i?void 0:i.ml]),p})(e),S=e.some((e=>M.includes(e.id)&&!0===e.isRunning)),_=G()(Zj.state$),T=Object(su.a)(),C=null!==(t=null==T?void 0:T.lastRefresh)&&void 0!==t?t:0;Object(n.useEffect)((()=>{void 0!==(null==b?void 0:b.time)&&"invalid"===b.time.mode&&x(!0)}),[null==b||null===(a=b.time)||void 0===a?void 0:a.from,null==b||null===(i=b.time)||void 0===i?void 0:i.to,null==b||null===(l=b.time)||void 0===l?void 0:l.ts]);const k=Object(n.useCallback)((async e=>{try{const t=await X.ml.results.getCategoryStoppedPartitions(e,Qt.d);t&&Array.isArray(t.jobs)&&t.jobs.length>0?h(t.jobs):h(void 0)}catch(e){console.error(e)}}),[]);Object(n.useEffect)((function(){M.length>0?(Zj.updateJobSelection(M),k(M)):Zj.clearJobs()}),[JSON.stringify(M)]),Object(n.useEffect)((()=>()=>{Zj.clearExplorerData(),p.anomalyExplorerCommonStateService.destroy(),p.anomalyTimelineStateService.destroy(),p.chartsStateService.destroy()}),[]);const[F,I]=(()=>{const e=Object(y.g)(),{services:{mlServices:{mlApiServices:t}}}=Object(y.b)(),a=Object(n.useMemo)((()=>{const a=Object(mt.mlResultsServiceProvider)(t);return((e,t,a)=>i=>{if(void 0===(n=i)||void 0===n.selectedJobs||null===n.selectedJobs||void 0===n.viewBySwimlaneFieldName)return Object(at.of)({});var n;const{lastRefresh:s,influencersFilterQuery:o,noInfluencersConfigured:r,selectedCells:l,selectedJobs:c,tableInterval:d,tableSeverity:u,viewBySwimlaneFieldName:p}=i,m=Object(xp.h)(l,p),b=Object(xp.i)(l,c),f=a.getBounds(),h=Object(xp.j)(l,f),g=Object(xp.e)();return Object(at.forkJoin)({overallAnnotations:Uj(s,c,f),annotationsData:Gj(s,l,c,f),anomalyChartRecords:t.loadDataForCharts$(b,h.earliestMs,h.latestMs,m,l,o),influencers:0===m.length?$j(s,e,b,h.earliestMs,h.latestMs,[],r,o):Promise.resolve({}),tableData:Wj(s,l,c,g,f,p,d,u,o)}).pipe(Object(za.switchMap)((({overallAnnotations:t,anomalyChartRecords:a,influencers:i,annotationsData:n,tableData:l})=>Object(at.forkJoin)({filteredTopInfluencers:(m.length>0||void 0!==o)&&void 0!==a&&a.length>0?qj(s,e,b,h.earliestMs,h.latestMs,a,m,r,o):Promise.resolve(i)}).pipe(Object(za.map)((({filteredTopInfluencers:e})=>({overallAnnotations:t,annotations:n,influencers:e,loading:!1,anomalyChartsDataLoading:!1,tableData:l})))))))})(a,new Kg.a(e,t,a),e)}),[]),i=Object(n.useMemo)((()=>new at.Subject),[]),s=Object(n.useMemo)((()=>i.pipe(Object(za.switchMap)(a))),[]);return[G()(s),Object(n.useCallback)((e=>{i.next(e)}),[])]})();Object(n.useEffect)((()=>{void 0!==F&&Object.keys(F).length>0&&Zj.setExplorerData(F)}),[F]);const[D]=Jh(),[A]=Object(qh.d)(),L=G()(p.chartsStateService.getShowCharts$(),p.chartsStateService.getShowCharts()),R=G()(p.anomalyTimelineStateService.getSelectedCells$(),p.anomalyTimelineStateService.getSelectedCells()),N=G()(p.anomalyTimelineStateService.getViewBySwimlaneFieldName$()),P=G()(p.anomalyTimelineStateService.getSwimLaneSeverity$(),p.anomalyTimelineStateService.getSwimLaneSeverity()),z=G()(p.anomalyExplorerCommonStateService.getInfluencerFilterQuery$()),B=void 0!==_?{lastRefresh:C,influencersFilterQuery:z,noInfluencersConfigured:_.noInfluencersConfigured,selectedCells:R,selectedJobs:_.selectedJobs,tableInterval:D.val,tableSeverity:A.val,viewBySwimlaneFieldName:N}:void 0;Object(n.useEffect)((function(){p.anomalyExplorerCommonStateService.setSelectedJobs(null==B?void 0:B.selectedJobs)}),[B]),Object(n.useEffect)((()=>{B&&void 0!==(null==B?void 0:B.selectedCells)&&I(B)}),[JSON.stringify(B)]);const V=G()(p.anomalyTimelineStateService.getOverallSwimLaneData$(),null);if(void 0===_||void 0===T)return null;const J=null!==(c=null==d?void 0:d.ui.getCasesContext())&&void 0!==c?c:s.a.Fragment,U=null==d?void 0:d.helpers.canUseCases();return Object(g.jsx)("div",{className:"ml-explorer"},Object(g.jsx)(on.a,null,Object(g.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(Wh,{viewId:"explorer",selectedJobs:_.selectedJobs})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.explorer.pageTitle",defaultMessage:"Anomaly Explorer"})))),Object(g.jsx)($g.EuiThemeProvider,null,Object(g.jsx)(J,{owner:[],permissions:U},Object(g.jsx)(Zg.Provider,{value:p},0===e.length?Object(g.jsx)(an.a,null):Object(g.jsx)(Bj,{explorerState:_,overallSwimlaneData:V,showCharts:L,severity:A.val,stoppedPartitions:f,invalidTimeRangeError:j,selectedJobsRunning:S,timeBuckets:O,timefilter:w,selectedCells:R,swimLaneSeverity:P})))))},ix=()=>{const{services:{docLinks:e}}=Object(y.b)(),t=e.links.ml.guide;return Object(g.jsx)(s.a.Fragment,null,Object(g.jsx)(o.EuiSpacer,{size:"xxl"}),Object(g.jsx)(o.EuiFlexGroup,{justifyContent:"spaceAround"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiPageContent_Deprecated,{verticalPosition:"center",horizontalPosition:"center",color:"danger"},Object(g.jsx)(o.EuiEmptyPrompt,{iconType:"alert",title:Object(g.jsx)("h2",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.management.jobsList.accessDeniedTitle",defaultMessage:"Access denied"})),body:Object(g.jsx)("p",null,Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.accessDenied.description",defaultMessage:"You don’t have permission to view the Machine Learning plugin. Access to the plugin requires the Machine Learning feature to be visible in this space."}))})))),Object(g.jsx)(sn.a,{docLink:t}))},nx=[{text:r.i18n.translate("xpack.ml.accessDeniedLabel",{defaultMessage:"Access denied"})}],sx=()=>({path:"/access-denied",title:r.i18n.translate("xpack.ml.accessDeniedLabel",{defaultMessage:"Access denied"}),render:(e,t)=>Object(g.jsx)(ox,_()({},e,{deps:t})),breadcrumbs:nx}),ox=({deps:e})=>{const{context:t}=I(void 0,void 0,e.config,e.dataViewsContract,{});return Object(g.jsx)(T.b,{context:t},Object(g.jsx)(ix,null))},rx=(e,t)=>({id:"trained_models",path:"/trained_models",title:r.i18n.translate("xpack.ml.modelManagement.trainedModels.docTitle",{defaultMessage:"Trained Models"}),render:(e,t)=>Object(g.jsx)(lx,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("TRAINED_MODELS",e,t),{text:r.i18n.translate("xpack.ml.trainedModelsBreadcrumbs.trainedModelsLabel",{defaultMessage:"Trained Models"})}],enableDatePicker:!0,"data-test-subj":"mlPageModelManagement"}),lx=({location:e,deps:t})=>{const{context:a}=I(void 0,void 0,t.config,t.dataViewsContract,W(t));return Object(g.jsx)(T.b,{context:a},Object(g.jsx)(ym.a,null),Object(g.jsx)(on.a,null,Object(g.jsx)(o.EuiFlexGroup,{responsive:!1,wrap:!1,alignItems:"center",gutterSize:"m"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.modelManagement.trainedModelsHeader",defaultMessage:"Trained Models"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(sf,null)))))};var cx=a(342);const dx=(e,t)=>({path:"/trained_models/nodes",render:(e,t)=>Object(g.jsx)(ux,_()({},e,{deps:t})),title:r.i18n.translate("xpack.ml.modelManagement.nodesOverview.docTitle",{defaultMessage:"Nodes"}),breadcrumbs:[N("ML_BREADCRUMB",e,t),N("TRAINED_MODELS",e,t),{text:r.i18n.translate("xpack.ml.trainedModelsBreadcrumbs.nodeOverviewLabel",{defaultMessage:"Nodes"})}],enableDatePicker:!0}),ux=({location:e,deps:t})=>{const{context:a}=I(void 0,void 0,t.config,t.dataViewsContract,W(t));return Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!0}),Object(g.jsx)(T.b,{context:a},Object(g.jsx)(on.a,null,Object(g.jsx)(o.EuiFlexGroup,{responsive:!1,wrap:!1,alignItems:"center",gutterSize:"m"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.modelManagement.nodesOverviewHeader",defaultMessage:"Nodes"})),Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(sf,null)))),Object(g.jsx)(cx.a,null))},px=s.a.lazy((()=>a.e(21).then(a.bind(null,646)))),mx=(e,t)=>({id:"notifications",path:"/notifications",title:r.i18n.translate("xpack.ml.notifications.notificationsLabel",{defaultMessage:"Notifications"}),enableDatePicker:!0,render:(e,t)=>Object(g.jsx)(bx,_()({},e,{deps:t})),breadcrumbs:[N("ML_BREADCRUMB",e,t),{text:r.i18n.translate("xpack.ml.overview.notificationsLabel",{defaultMessage:"Notifications"})}],"data-test-subj":"mlPageNotifications"}),bx=({deps:e})=>{const{redirectToMlAccessDeniedPage:t}=e,{context:a}=I(void 0,void 0,e.config,e.dataViewsContract,{checkFullLicense:O.b,checkGetJobsCapabilities:()=>Object(w.c)(t),getMlNodeCount:D.a,loadMlServerInfo:A.g});return Object(y.g)({timeRangeSelector:!1,autoRefreshSelector:!1}),Object(g.jsx)(T.b,{context:a},Object(g.jsx)(n.Suspense,{fallback:null},Object(g.jsx)(px,null)))};var fx=a(78);const hx=({path:e,children:t})=>Object(g.jsx)(fx.TrackApplicationView,{viewId:e},t);var gx=a(32);function jx(e){q.a.next({lastRefresh:Date.now(),...e?{timeRange:e}:{}})}const xx=5e3,vx=()=>{var e,t,a;const{services:i}=Object(y.b)(),s=i.uiSettings,l=i.theme.theme$,{httpService:d}=i.mlServices,{timefilter:u,history:p}=i.data.query.timefilter,{displayWarningToast:b}=Object(Z.c)(),[f,h]=Object(v.c)("_g"),j=(x=p,function(){var e,t;return null!==(e=null===(t=x.get())||void 0===t?void 0:t.map((({from:e,to:t})=>({start:e,end:t}))))&&void 0!==e?e:[]});var x;const O=Object(un.a)(),E=Object(un.b)();Object(n.useEffect)((function(){void 0!==(null==f?void 0:f.time)&&u.setTime({from:f.time.from,to:f.time.to})}),[null==f||null===(e=f.time)||void 0===e?void 0:e.from,null==f||null===(t=f.time)||void 0===t?void 0:t.to,null==f||null===(a=f.time)||void 0===a?void 0:a.ts]),Object(n.useEffect)((function(){var e,t;void 0!==(null==f?void 0:f.refreshInterval)&&u.setRefreshInterval({pause:!(null==f||null===(e=f.refreshInterval)||void 0===e||!e.pause),value:null==f||null===(t=f.refreshInterval)||void 0===t?void 0:t.value})}),[null==f?void 0:f.refreshInterval]);const w=Object(n.useCallback)(Object(Q.debounce)((e=>{h("refreshInterval",e,!0)}),200),[h]),[M,S]=Object(n.useState)(!1),[_,T]=Object(n.useState)(j()),[C,k]=Object(n.useState)(u.isAutoRefreshSelectorEnabled()),[F,I]=Object(n.useState)(u.isTimeRangeSelectorEnabled()),D=Object(n.useMemo)((()=>{var e;return null!==(e=null==f?void 0:f.refreshInterval)&&void 0!==e?e:O}),[JSON.stringify(null==f?void 0:f.refreshInterval),O]);Object(n.useEffect)((function(){const e=!(null==f||!f.refreshInterval);D.value<xx&&!D.pause&&b({title:e?r.i18n.translate("xpack.ml.datePicker.shortRefreshIntervalURLWarningMessage",{defaultMessage:"The refresh interval in the URL is shorter than the minimum supported by Machine Learning."}):r.i18n.translate("xpack.ml.datePicker.shortRefreshIntervalTimeFilterWarningMessage",{defaultMessage:"The refresh interval in Advanced Settings is shorter than the minimum supported by Machine Learning."}),text:Object(c.toMountPoint)(Object(c.wrapWithTheme)(Object(g.jsx)(o.EuiButton,{onClick:w.bind(null,{pause:D.pause,value:xx})},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.pageRefreshResetButton",defaultMessage:"Set to {defaultInterval}",values:{defaultInterval:"5s"}})),l))},{toastLifeTimeMs:3e4})}),[JSON.stringify(D),JSON.stringify(null==f?void 0:f.refreshInterval),w]);const A=s.get("dateFormat"),L=s.get(gx.UI_SETTINGS.TIMEPICKER_QUICK_RANGES),R=Object(n.useMemo)((()=>L.map((({from:e,to:t,display:a})=>({start:e,end:t,label:a})))),[L]);Object(n.useEffect)((()=>{const e=new at.Subscription;e.add(d.getLoadingCount$.subscribe((e=>{S(0!==e)})));const t=u.getEnabledUpdated$();return void 0!==t&&e.add(t.subscribe((e=>{k(u.isAutoRefreshSelectorEnabled()),I(u.isTimeRangeSelectorEnabled())}))),function(){e.unsubscribe()}}),[]);const N=Object(n.useCallback)((({start:e,end:t})=>{T(j()),h("time",{from:e,to:t,..."now"===e||"now"===t?{ts:Date.now()}:{}})}),[h]);return C||F?Object(g.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center",className:"mlNavigationMenu__datePickerWrapper"},Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiSuperDatePicker,{isLoading:M,start:E.from,end:E.to,isPaused:D.pause,isAutoRefreshOnly:!F,refreshInterval:D.value||xx,onTimeChange:N,onRefresh:jx,onRefreshChange:function({isPaused:e,refreshInterval:t}){!1===e&&t<=0&&w({pause:e,value:5e3}),w({pause:e,value:t})},recentlyUsedRanges:_,dateFormat:A,commonlyUsedRanges:R})),F?null:Object(g.jsx)(o.EuiFlexItem,{grow:!1},Object(g.jsx)(o.EuiButton,{fill:!0,color:"primary",iconType:"refresh",onClick:()=>jx(),"data-test-subj":"mlRefreshPageButton"+(M?" loading":" loaded"),isLoading:M},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.pageRefreshButton",defaultMessage:"Refresh"})))):null},yx=Object(n.createContext)({setHeaderActionMenu:()=>{},headerPortal:Object(d.c)(),isHeaderMounted:!1,setIsHeaderMounted:()=>{}}),Ox=s.a.memo((({pageDeps:e})=>{const t=Object(y.e)(),{services:{http:{basePath:a}}}=Object(y.b)(),s=Object(n.useMemo)((()=>Object(d.c)()),[]),[p,b]=Object(n.useState)(!1),f=Object(n.useMemo)((()=>Object.values(i).map((e=>e(t,a.get()))).filter((e=>!e.disabled))),[]),h=(e=>{var t;const{pathname:a}=Object(l.useLocation)(),{services:{executionContext:i,overlays:s,theme:r}}=Object(y.b)(),d=Object(l.useRouteMatch)("/settings/calendars_list/edit_calendar/:calendarId"),u=Object(l.useRouteMatch)("/settings/filter_lists/edit_filter_list/:filterId"),p=Object(n.useMemo)((()=>Object(Q.keyBy)(e,"path")),[]),b=Object(n.useMemo)((()=>{if(d)return p[d.path];if(u)return p[u.path];const e=a.replace(/\/$/,"");return p[e]}),[a]),f=Object(n.useRef)();return Object(n.useEffect)((function(){!b&&a&&(f.current=s.banners.replace(f.current,Object(c.toMountPoint)(Object(g.jsx)(o.EuiCallOut,{color:"warning",iconType:"iInCircle",title:Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.notFoundPage.title",defaultMessage:"Page Not Found"}),"data-test-subj":"mlPageNotFoundBanner"},Object(g.jsx)("p",{"data-test-subj":"mlPageNotFoundBannerText"},Object(g.jsx)(m.FormattedMessage,{id:"xpack.ml.notFoundPage.bannerText",defaultMessage:"The Machine Learning application doesn't recognize this route: {route}. You've been redirected to the Overview page.",values:{route:a}}))),{theme$:r.theme$})),setTimeout((()=>{f.current&&s.banners.remove(f.current)}),15e3))}),[b,s,r,a]),Object(c.useExecutionContext)(i,{name:le.e,type:"application",page:null!==(t=null==b?void 0:b.path)&&void 0!==t?t:"/overview"}),null!=b?b:p["/overview"]})(f),j=Object(n.useMemo)((()=>[...h.enableDatePicker?[Object(g.jsx)(vx,null)]:[]]),[h.enableDatePicker]);return(e=>{const t=null==e?void 0:e.title,{services:{chrome:{docTitle:a}}}=Object(y.b)(),i=Object(n.useCallback)((e=>{a.change([e,le.a])}),[a]);Object(n.useEffect)((()=>{t&&i(t)}),[i,t])})(h),Object(g.jsx)(yx.Provider,{value:{setHeaderActionMenu:e.setHeaderActionMenu,headerPortal:s,setIsHeaderMounted:b,isHeaderMounted:p}},Object(g.jsx)(c.KibanaPageTemplate,{className:"ml-app","data-test-subj":"mlApp",restrictWidth:!1,pageContentProps:{className:"kbnAppWrapper"},pageContentBodyProps:{className:"kbnAppWrapper"},solutionNav:{name:r.i18n.translate("xpack.ml.plugin.title",{defaultMessage:"Machine Learning"}),icon:"machineLearningApp",items:M(h)},pageHeader:{pageTitle:Object(g.jsx)(u.b,null),rightSideItems:j,restrictWidth:!1},pageBodyProps:{"data-test-subj":null==h?void 0:h["data-test-subj"]}},Object(g.jsx)(Ex,{headerPortal:s,setIsHeaderMounted:b,pageDeps:e,routeList:f})))})),Ex=s.a.memo((({pageDeps:e,routeList:t})=>{const{services:{application:a}}=Object(y.b)();return Object(g.jsx)(c.RedirectAppLinks,{application:a},Object(g.jsx)(o.EuiPageContentBody_Deprecated,{restrictWidth:!1},Object(g.jsx)(l.Switch,null,t.map((t=>Object(g.jsx)(l.Route,{key:t.id,path:t.path,exact:!0,render:a=>(window.setTimeout((()=>{e.setBreadcrumbs(t.breadcrumbs)})),Object(g.jsx)(hx,{path:t.path},t.render(a,e)))}))),Object(g.jsx)(l.Redirect,{to:"/overview"}))))}))},function(e,t,a){"use strict";a.d(t,"c",(function(){return V})),a.d(t,"b",(function(){return J})),a.d(t,"d",(function(){return U})),a.d(t,"a",(function(){return q})),a.d(t,"e",(function(){return $}));var i=a(17),n=a.n(i),s=a(2),o=a(45),r=a(44),l=a(92),c=a(115),d=a(84),u=a(215),p=a(347),m=a(343),b=a(80),f=a(81),h=a(85),g=a(20),j=a(83),x=a(13);let v;const y=({closeFlyout:e,item:t})=>{const{id:a,config:n}=t,{state:o}=t.stats,l=void 0!==n.allow_lazy_start?String(n.allow_lazy_start):"",[d,u]=Object(i.useState)(l),[p,m]=Object(i.useState)(n.description||""),[y,O]=Object(i.useState)(n.model_memory_limit),[E,w]=Object(i.useState)(),[M,S]=Object(i.useState)(n.max_num_threads),{services:{notifications:_}}=Object(b.b)(),{refresh:T}=Object(j.E)(),C=Object(h.c)(),k=void 0!==E||0===M;return Object(i.useEffect)((()=>{if(void 0===v&&(v=Object(g.c)()),""!==y){const e=v(y);null!==e&&e.invalidUnits?w(s.i18n.translate("xpack.ml.dataframe.analytics.create.modelMemoryUnitsInvalidError",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:e.invalidUnits.allowedUnits}})):w(void 0)}else w(s.i18n.translate("xpack.ml.dataframe.analytics.create.modelMemoryEmptyError",{defaultMessage:"Model memory limit must not be empty"}))}),[y]),Object(x.jsx)(r.EuiFlyout,{onClose:e,hideCloseButton:!0,"aria-labelledby":"analyticsEditFlyoutTitle","data-test-subj":"mlAnalyticsEditFlyout"},Object(x.jsx)(r.EuiFlyoutHeader,{hasBorder:!0},Object(x.jsx)(r.EuiTitle,{size:"m"},Object(x.jsx)("h2",{id:"analyticsEditFlyoutTitle"},s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyoutTitle",{defaultMessage:"Edit {jobId}",values:{jobId:a}})))),Object(x.jsx)(r.EuiFlyoutBody,null,Object(x.jsx)(r.EuiForm,null,Object(x.jsx)(r.EuiFormRow,{label:s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.allowLazyStartLabel",{defaultMessage:"Allow lazy start"})},Object(x.jsx)(r.EuiSelect,{"aria-label":s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.allowLazyStartAriaLabel",{defaultMessage:"Update allow lazy start."}),"data-test-subj":"mlAnalyticsEditFlyoutAllowLazyStartInput",options:[{value:"true",text:s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.allowLazyStartTrueValue",{defaultMessage:"True"})},{value:"false",text:s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.allowLazyStartFalseValue",{defaultMessage:"False"})}],value:d,onChange:e=>u(e.target.value)})),Object(x.jsx)(r.EuiFormRow,{label:s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.descriptionLabel",{defaultMessage:"Description"})},Object(x.jsx)(r.EuiFieldText,{"data-test-subj":"mlAnalyticsEditFlyoutDescriptionInput",value:p,onChange:e=>m(e.target.value),"aria-label":s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.descriptionAriaLabel",{defaultMessage:"Update the job description."})})),Object(x.jsx)(r.EuiFormRow,{helpText:o!==c.b.STOPPED&&s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.modelMemoryHelpText",{defaultMessage:"Model memory limit cannot be edited until the job has stopped."}),label:s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.modelMemoryLimitLabel",{defaultMessage:"Model memory limit"}),isInvalid:void 0!==E,error:E},Object(x.jsx)(r.EuiFieldText,{"data-test-subj":"mlAnalyticsEditFlyoutmodelMemoryLimitInput",isInvalid:void 0!==E,readOnly:o!==c.b.STOPPED,value:y,onChange:e=>O(e.target.value),"aria-label":s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.modelMemoryLimitAriaLabel",{defaultMessage:"Update the model memory limit."})})),Object(x.jsx)(r.EuiFormRow,{helpText:o!==c.b.STOPPED&&s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.maxNumThreadsHelpText",{defaultMessage:"Maximum number of threads cannot be edited until the job has stopped."}),label:s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.maxNumThreadsLabel",{defaultMessage:"Maximum number of threads"}),isInvalid:0===M,error:0===M&&s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.maxNumThreadsError",{defaultMessage:"The minimum value is 1."})},Object(x.jsx)(r.EuiFieldNumber,{"aria-label":s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyout.maxNumThreadsAriaLabel",{defaultMessage:"Update the maximum number of threads to be used by the analysis."}),"data-test-subj":"mlAnalyticsEditFlyoutMaxNumThreadsLimitInput",onChange:e=>S(""===e.target.value?void 0:+e.target.value),step:1,min:1,readOnly:o!==c.b.STOPPED,value:M})))),Object(x.jsx)(r.EuiFlyoutFooter,null,Object(x.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(x.jsx)(r.EuiFlexItem,{grow:!1},Object(x.jsx)(r.EuiButtonEmpty,{iconType:"cross",onClick:e,flush:"left"},s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyoutCancelButtonText",{defaultMessage:"Cancel"}))),Object(x.jsx)(r.EuiFlexItem,{grow:!1},Object(x.jsx)(r.EuiButton,{"data-test-subj":"mlAnalyticsEditFlyoutUpdateButton",onClick:async()=>{const t=Object.assign({allow_lazy_start:d,description:p},y&&{model_memory_limit:y},M&&{max_num_threads:M});try{await f.ml.dataFrameAnalytics.updateDataFrameAnalytics(a,t),_.toasts.addSuccess(s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyoutSuccessMessage",{defaultMessage:"Analytics job {jobId} has been updated.",values:{jobId:a}})),T(),e()}catch(e){console.error(e),C.displayErrorToast(e,s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyoutErrorMessage",{defaultMessage:"Could not save changes to analytics job {jobId}",values:{jobId:a}}))}},fill:!0,isDisabled:k},s.i18n.translate("xpack.ml.dataframe.analyticsList.editFlyoutUpdateButtonText",{defaultMessage:"Update"}))))))},O=s.i18n.translate("xpack.ml.dataframe.analyticsList.editActionNameText",{defaultMessage:"Edit"}),E=({isDisabled:e})=>e?Object(x.jsx)(r.EuiToolTip,{position:"top",content:s.i18n.translate("xpack.ml.dataframe.analyticsList.editActionPermissionTooltip",{defaultMessage:"You do not have permission to edit analytics jobs."})},Object(x.jsx)(n.a.Fragment,null,O)):Object(x.jsx)(n.a.Fragment,null,O);var w=a(181);const M=s.i18n.translate("xpack.ml.dataframe.analyticsList.startActionNameText",{defaultMessage:"Start"}),S=({canStartStopDataFrameAnalytics:e,isDisabled:t,item:a})=>t?Object(x.jsx)(r.EuiToolTip,{position:"top",content:e?s.i18n.translate("xpack.ml.dataframe.analyticsList.completeBatchAnalyticsToolTip",{defaultMessage:"{analyticsId} is a completed analytics job and cannot be restarted.",values:{analyticsId:a.config.id}}):Object(d.f)("canStartStopDataFrameAnalytics")},Object(x.jsx)(n.a.Fragment,null,M)):Object(x.jsx)(n.a.Fragment,null,M),_=({closeModal:e,item:t,startAndCloseModal:a})=>Object(x.jsx)(n.a.Fragment,null,void 0!==t&&Object(x.jsx)(r.EuiConfirmModal,{title:s.i18n.translate("xpack.ml.dataframe.analyticsList.startModalTitle",{defaultMessage:"Start {analyticsId}?",values:{analyticsId:t.config.id}}),onCancel:e,onConfirm:a,cancelButtonText:s.i18n.translate("xpack.ml.dataframe.analyticsList.startModalCancelButton",{defaultMessage:"Cancel"}),confirmButtonText:s.i18n.translate("xpack.ml.dataframe.analyticsList.startModalStartButton",{defaultMessage:"Start"}),defaultFocusedButton:r.EUI_MODAL_CONFIRM_BUTTON,buttonColor:"primary"},Object(x.jsx)("p",null,s.i18n.translate("xpack.ml.dataframe.analyticsList.startModalBody",{defaultMessage:"A data frame analytics job increases search and indexing load in your cluster. If excessive load occurs, stop the job."})))),T=s.i18n.translate("xpack.ml.dataframe.analyticsList.stopActionNameText",{defaultMessage:"Stop"}),C=({isDisabled:e})=>e?Object(x.jsx)(r.EuiToolTip,{position:"top",content:Object(d.f)("canStartStopDataFrameAnalytics")},Object(x.jsx)(n.a.Fragment,null,T)):Object(x.jsx)(n.a.Fragment,null,T),k=({closeModal:e,item:t,forceStopAndCloseModal:a})=>Object(x.jsx)(n.a.Fragment,null,void 0!==t&&Object(x.jsx)(r.EuiConfirmModal,{title:s.i18n.translate("xpack.ml.dataframe.analyticsList.forceStopModalTitle",{defaultMessage:"Force this job to stop?"}),onCancel:e,onConfirm:a,cancelButtonText:s.i18n.translate("xpack.ml.dataframe.analyticsList.forceStopModalCancelButton",{defaultMessage:"Cancel"}),confirmButtonText:s.i18n.translate("xpack.ml.dataframe.analyticsList.forceStopModalStartButton",{defaultMessage:"Stop"}),defaultFocusedButton:r.EUI_MODAL_CONFIRM_BUTTON,buttonColor:"primary"},Object(x.jsx)("p",null,Object(x.jsx)(o.FormattedMessage,{id:"xpack.ml.dataframe.analyticsList.forceStopModalBody",defaultMessage:"{analyticsId} is in a failed state. You must stop the job and fix the failure.",values:{analyticsId:t.config.id}}))));var F=a(197);const I=s.i18n.translate("xpack.ml.dataframe.analyticsList.viewActionName",{defaultMessage:"View"}),D=({item:e})=>{const{disabled:t,tooltipContent:a}=Object(F.a)(e);return t?Object(x.jsx)(r.EuiToolTip,{position:"top",content:a},Object(x.jsx)(n.a.Fragment,null,I)):Object(x.jsx)(n.a.Fragment,null,I)};var A=a(0);const L=s.i18n.translate("xpack.ml.dataframe.analyticsList.mapActionName",{defaultMessage:"Map"}),R=({item:e})=>{if(!Object(j.y)(e.config.analysis)&&!Object(j.x)(e.config.analysis)&&!Object(j.v)(e.config.analysis)){const e=s.i18n.translate("xpack.ml.dataframe.analyticsList.mapActionDisabledTooltipContent",{defaultMessage:"Unknown analysis type."});return Object(x.jsx)(r.EuiToolTip,{position:"top",content:e},Object(x.jsx)(n.a.Fragment,null,L))}return Object(x.jsx)(n.a.Fragment,null,L)};var N=a(8),P=a(96);const z=()=>{var e;const t=Object(d.e)("canCreateDataFrameAnalytics"),a=Object(d.e)("canDeleteDataFrameAnalytics"),s=Object(d.e)("canStartStopDataFrameAnalytics"),o=(()=>{const e=Object(b.d)(),t=Object(b.e)(),a=Object(i.useCallback)((a=>{const i=Object(j.m)(a.config.analysis);(async(a,i)=>{const n=await e.getUrl({page:A.b.DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:a,analysisType:i}});await t(n,!1)})(a.id,i)}),[]);return{action:Object(i.useMemo)((()=>({isPrimary:!0,name:e=>Object(x.jsx)(D,{item:e}),enabled:e=>!Object(F.a)(e).disabled,description:I,icon:"visTable",type:"icon",onClick:a,"data-test-subj":"mlAnalyticsJobViewButton"})),[a])}})(),r=(()=>{const e=Object(b.d)(),t=Object(b.e)(),[a]=Object(P.c)("_g"),n=Object(i.useCallback)((async i=>{const n=Object(N.cloneDeep)(a||{});delete n.ml;const s=await e.getUrl({page:A.b.DATA_FRAME_ANALYTICS_MAP,pageState:{jobId:i.id,globalState:n}});await t(s,!1)}),[a]);return{action:Object(i.useMemo)((()=>({isPrimary:!0,name:e=>Object(x.jsx)(R,{item:e}),enabled:e=>!Object(F.a)(e).disabled,description:L,icon:"graphApp",type:"icon",onClick:n,"data-test-subj":"mlAnalyticsJobMapButton"})),[n])}})(),l=Object(p.c)(t),f=Object(m.b)(a),g=(e=>{const[t,a]=Object(i.useState)(),[n,s]=Object(i.useState)(!1),o=e=>{a(e),s(!0)};return{action:Object(i.useMemo)((()=>({name:()=>Object(x.jsx)(E,{isDisabled:!e}),enabled:()=>e,description:O,icon:"pencil",type:"icon",onClick:e=>o(e),"data-test-subj":"mlAnalyticsJobEditButton"})),[e]),isFlyoutVisible:n,item:t,closeFlyout:()=>s(!1),openFlyout:o}})(s),v=(e=>{const[t,a]=Object(i.useState)(!1),[n,s]=Object(i.useState)(),o=Object(h.c)(),r=e=>{s(e),a(!0)},l=t=>{if(!Object(c.g)(t.stats.state)){const a=Object(c.e)(t.stats);return e&&!a}return e};return{action:Object(i.useMemo)((()=>({name:t=>Object(x.jsx)(S,{isDisabled:!l(t),item:t,canStartStopDataFrameAnalytics:e}),available:e=>!Object(c.g)(e.stats.state)&&!Object(c.f)(e.stats.state),enabled:l,description:M,icon:"play",type:"icon",onClick:r,"data-test-subj":"mlAnalyticsJobStartButton"})),[]),closeModal:()=>a(!1),isModalVisible:t,item:n,openModal:r,startAndCloseModal:()=>{void 0!==n&&(a(!1),Object(w.e)(n,o))}}})(s),z=(e=>{const[t,a]=Object(i.useState)(!1),[n,s]=Object(i.useState)(),o=e=>{s(e),a(!0)},r=Object(i.useCallback)((t=>{e&&(Object(c.f)(t.stats.state)?o(t):Object(w.f)(t))}),[w.f]);return{action:Object(i.useMemo)((()=>({name:()=>Object(x.jsx)(C,{isDisabled:!e}),available:e=>Object(c.g)(e.stats.state)||Object(c.f)(e.stats.state),enabled:()=>e,description:T,icon:"stop",type:"icon",onClick:r,"data-test-subj":"mlAnalyticsJobStopButton"})),[r]),closeModal:()=>a(!1),isModalVisible:t,item:n,openModal:o,forceStopAndCloseModal:()=>{void 0!==n&&(a(!1),Object(w.f)(n))}}})(s),{refresh:B}=Object(j.E)(),V=[o.action,r.action],J=Object(x.jsx)(n.a.Fragment,null,v.isModalVisible&&Object(x.jsx)(_,v),z.isModalVisible&&Object(x.jsx)(k,z),f.isDeleteJobCheckModalVisible&&(null==f||null===(e=f.item)||void 0===e?void 0:e.config)&&Object(x.jsx)(u.a,{onCloseCallback:f.closeDeleteJobCheckModal,canDeleteCallback:()=>{f.openModal(f.item),f.closeDeleteJobCheckModal()},refreshJobsCallback:B,mlSavedObjectType:f.jobType,ids:[f.item.config.id]}),f.isModalVisible&&Object(x.jsx)(m.a,f),(e=>!0===e.isFlyoutVisible&&void 0!==e.item)(g)&&Object(x.jsx)(y,g));return V.push(v.action,z.action,g.action,l.action,f.action),{actions:V,modals:J}};var B;!function(e){e.analyzing="primary",e.failed="danger",e.reindexing="primary",e.started="primary",e.starting="primary",e.stopped="hollow",e.stopping="hollow"}(B||(B={}));const V=(e,t)=>{const a=B[e];return Object(c.f)(e)&&void 0!==t?Object(x.jsx)(r.EuiToolTip,{content:t},Object(x.jsx)(r.EuiBadge,{className:"mlTaskStateBadge",color:a},e)):Object(x.jsx)(r.EuiBadge,{className:"mlTaskStateBadge",color:a},e)},J=e=>Object(x.jsx)(r.EuiBadge,{className:"mlTaskStateBadge",color:"hollow"},e),U={name:s.i18n.translate("xpack.ml.dataframe.analyticsList.progress",{defaultMessage:"Progress"}),truncateText:!0,render(e){const{currentPhase:t,progress:a,totalPhases:n}=Object(c.d)(e.stats);return Object(x.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},Object(x.jsx)(i.Fragment,null,Object(x.jsx)(r.EuiFlexItem,{style:{width:"60px"},grow:!1},Object(x.jsx)(r.EuiText,{size:"xs"},"Phase ",t,"/",n)),Object(x.jsx)(r.EuiFlexItem,{style:{width:"40px"},grow:!1},Object(x.jsx)(r.EuiToolTip,{content:s.i18n.translate("xpack.ml.dataframe.analyticsList.progressOfPhase",{defaultMessage:"Progress of phase {currentPhase}: {progress}%",values:{currentPhase:t,progress:a}})},Object(x.jsx)(r.EuiProgress,{value:a,max:100,color:"primary",size:"m","data-test-subj":"mlAnalyticsTableProgress"})))),!1)},width:"130px","data-test-subj":"mlAnalyticsTableColumnProgress"};var G={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const q=({jobId:e})=>{const t=Object(b.c)({page:A.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE,pageState:{jobId:e}});return Object(x.jsx)(r.EuiLink,{href:t,css:G,title:e},e)},$=(e,t,a=!0,i=(()=>{}))=>{const{actions:n,modals:d}=z();return{columns:[{name:Object(x.jsx)(r.EuiScreenReaderOnly,null,Object(x.jsx)("p",null,Object(x.jsx)(o.FormattedMessage,{id:"xpack.ml.dataframe.analyticsList.showDetailsColumn.screenReaderDescription",defaultMessage:"This column contains clickable controls for showing more details on each job"}))),align:r.RIGHT_ALIGNMENT,width:"40px",isExpander:!0,render:a=>Object(x.jsx)(r.EuiButtonIcon,{onClick:()=>function(a){const i=e.indexOf(a.config.id);-1!==i?(e.splice(i,1),t([...e])):e.push(a.config.id),t([...e])}(a),"aria-label":e.includes(a.config.id)?s.i18n.translate("xpack.ml.dataframe.analyticsList.rowCollapse",{defaultMessage:"Hide details for {analyticsId}",values:{analyticsId:a.config.id}}):s.i18n.translate("xpack.ml.dataframe.analyticsList.rowExpand",{defaultMessage:"Show details for {analyticsId}",values:{analyticsId:a.config.id}}),iconType:e.includes(a.config.id)?"arrowDown":"arrowRight"}),"data-test-subj":"mlAnalyticsTableRowDetailsToggle"},{field:c.c.id,name:s.i18n.translate("xpack.ml.dataframe.analyticsList.id",{defaultMessage:"ID"}),sortable:e=>e.id,truncateText:!0,"data-test-subj":"mlAnalyticsTableColumnId",scope:"row"},{field:c.c.description,name:s.i18n.translate("xpack.ml.dataframe.analyticsList.description",{defaultMessage:"Description"}),sortable:!0,truncateText:!0,"data-test-subj":"mlAnalyticsTableColumnJobDescription"},{field:c.c.memoryStatus,name:s.i18n.translate("xpack.ml.dataframe.analyticsList.memoryStatus",{defaultMessage:"Memory status"}),truncateText:!0,"data-test-subj":"mlAnalyticsTableColumnJobMemoryStatus"},{field:c.c.configSourceIndex,name:s.i18n.translate("xpack.ml.dataframe.analyticsList.sourceIndex",{defaultMessage:"Source index"}),sortable:!0,truncateText:!0,"data-test-subj":"mlAnalyticsTableColumnSourceIndex"},{field:c.c.configDestIndex,name:s.i18n.translate("xpack.ml.dataframe.analyticsList.destinationIndex",{defaultMessage:"Destination index"}),sortable:!0,truncateText:!0,"data-test-subj":"mlAnalyticsTableColumnDestIndex"},{name:s.i18n.translate("xpack.ml.dataframe.analyticsList.type",{defaultMessage:"Type"}),sortable:e=>Object(l.h)(e.config.analysis),truncateText:!0,render:e=>J(Object(l.h)(e.config.analysis)),width:"150px","data-test-subj":"mlAnalyticsTableColumnType"},{name:s.i18n.translate("xpack.ml.dataframe.analyticsList.status",{defaultMessage:"Status"}),sortable:e=>e.stats.state,truncateText:!0,render:e=>V(e.stats.state,e.stats.failure_reason),width:"100px","data-test-subj":"mlAnalyticsTableColumnStatus"},U,{name:s.i18n.translate("xpack.ml.dataframe.analyticsList.tableActionLabel",{defaultMessage:"Actions"}),actions:n,width:"150px","data-test-subj":"mlAnalyticsTableColumnActions"}],modals:d}}},function(e,t,a){"use strict";a.r(t),a.d(t,"getMlGlobalServices",(function(){return y})),a.d(t,"renderApp",(function(){return E}));var i=a(17),n=a.n(i),s=(a(370),a(55)),o=a.n(s),r=a(3),l=a(46),c=a(158),d=a(27),u=a(105),p=a(73),m=a(4);function b(e){if(void 0===e){const e=(e,t)=>{};return{click:e,count:e}}return{click:(t,a)=>e.reportUiCounter(m.e,p.METRIC_TYPE.CLICK,t,a),count:(t,a)=>e.reportUiCounter(m.e,p.METRIC_TYPE.COUNT,t,a)}}var f=a(89),h=a(81),g=a(121),j=a(0),x=a(13);const v=new r.Storage(window.localStorage);function y(e,t){const a=new g.a(e);return{httpService:a,mlApiServices:Object(h.mlApiServicesProvider)(a),mlUsageCollection:b(t)}}const O=({coreStart:e,deps:t,appMountParams:a})=>{var i,s;const o={history:a.history,setHeaderActionMenu:a.setHeaderActionMenu,dataViewsContract:t.data.dataViews,config:e.uiSettings,setBreadcrumbs:e.chrome.setBreadcrumbs,redirectToMlAccessDeniedPage:async()=>{const a=await t.share.url.locators.get(j.a).getUrl({page:j.b.ACCESS_DENIED});await e.application.navigateToUrl(a)}},r={kibanaVersion:t.kibanaVersion,share:t.share,data:t.data,security:t.security,licenseManagement:t.licenseManagement,storage:v,embeddable:t.embeddable,maps:t.maps,triggersActionsUi:t.triggersActionsUi,dataVisualizer:t.dataVisualizer,usageCollection:t.usageCollection,fieldFormats:t.fieldFormats,dashboard:t.dashboard,charts:t.charts,cases:t.cases,unifiedSearch:t.unifiedSearch,licensing:t.licensing,lens:t.lens,...e},d=e.i18n.Context,u=null!==(i=null===(s=t.usageCollection)||void 0===s?void 0:s.components.ApplicationUsageTrackingProvider)&&void 0!==i?i:n.a.Fragment;return Object(x.jsx)(u,null,Object(x.jsx)(d,null,Object(x.jsx)(l.KibanaThemeProvider,{theme$:a.theme$},Object(x.jsx)(l.KibanaContextProvider,{services:{...r,mlServices:y(e.http,t.usageCollection)}},Object(x.jsx)(c.a,null,Object(x.jsx)(f.a,{pageDeps:o}))))))},E=(e,t,a)=>{Object(d.p)({timefilter:t.data.query.timefilter,fieldFormats:t.fieldFormats,autocomplete:t.unifiedSearch.autocomplete,config:e.uiSettings,chrome:e.chrome,docLinks:e.docLinks,toastNotifications:e.notifications.toasts,overlays:e.overlays,theme:e.theme,recentlyAccessed:e.chrome.recentlyAccessed,basePath:e.http.basePath,savedObjectsClient:e.savedObjects.client,application:e.application,http:e.http,security:t.security,dashboard:t.dashboard,maps:t.maps,dataVisualizer:t.dataVisualizer,dataViews:t.data.dataViews,share:t.share}),a.onAppLeave((e=>e.default()));const i=Object(u.e)(t.licensing,e.application,[()=>o.a.render(Object(x.jsx)(O,{coreStart:e,deps:t,appMountParams:a}),a.element)]);return()=>{i.unsubscribe(),Object(d.a)(),o.a.unmountComponentAtNode(a.element),t.data.search.session.clear()}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var i=a(82),n=a.n(i),s=(a(17),a(44)),o=a(2),r=a(153),l=a(13);const c=({icon:e,id:t,isGroup:a=!1,numJobs:i,removeId:c})=>{let d,u={color:a?Object(r.a)(t):"hollow"};return!0===e&&c&&(u={...u,iconType:"cross",iconSide:"right",onClick:()=>c(t),onClickAriaLabel:"Remove id"}),void 0!==i&&(d=o.i18n.translate("xpack.ml.jobSelector.selectedGroupJobs",{defaultMessage:"({jobsCount, plural, one {# job} other {# jobs}})",values:{jobsCount:i}})),Object(l.jsx)(s.EuiBadge,n()({key:`${t}-id`,"data-test-subj":`mlJobSelectionBadge ${t}`},u),`${t}${d||""}`)}},function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a(17);var i=a(44),n=a(153),s=a(13);const o=({name:e})=>Object(s.jsx)(i.EuiBadge,{key:`${e}-id`,"data-test-subj":"mlJobGroup",color:Object(n.a)(e)},e)},function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var i=a(17),n=a.n(i),s=a(44),o=a(2),r=a(45),l=a(411),c=a.n(l),d=a(133),u=a(80),p=a(0),m=a(84),b=a(13);const f=()=>{const{services:{docLinks:e,http:{basePath:t}}}=Object(u.b)(),a=!Object(d.c)()||!Object(m.e)("canCreateDataFrameAnalytics")||!Object(m.e)("canStartStopDataFrameAnalytics"),i=`${t.get()}/app/management/data/transform`,l=Object(u.e)();return Object(b.jsx)(s.EuiEmptyPrompt,{layout:"horizontal",hasBorder:!1,hasShadow:!1,icon:Object(b.jsx)(s.EuiImage,{size:"fullWidth",src:c.a,alt:o.i18n.translate("xpack.ml.dataFrame.analyticsList.emptyPromptTitle",{defaultMessage:"Create your first data frame analytics job"})}),color:"subdued",title:Object(b.jsx)("h2",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.dataFrame.analyticsList.emptyPromptTitle",defaultMessage:"Create your first data frame analytics job"})),body:Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)("p",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.overview.analyticsList.emptyPromptText",defaultMessage:"Train outlier detection, regression, or classification machine learning models using data frame analytics."})),Object(b.jsx)(s.EuiCallOut,{size:"s",title:Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.overview.analyticsList.emptyPromptHelperText",defaultMessage:"Before building a data frame analytics job, use {transforms} to construct an {sourcedata}.",values:{transforms:Object(b.jsx)(s.EuiLink,{href:i,target:"blank",color:"accent"},Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionTransforms",defaultMessage:"transforms"})),sourcedata:Object(b.jsx)(s.EuiLink,{href:e.links.ml.dFAPrepareData,target:"blank",color:"accent",external:!0},Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionSourceData",defaultMessage:"entity-centric source data set"}))}}),iconType:"iInCircle"})),actions:[Object(b.jsx)(s.EuiButton,{onClick:async()=>{await l(p.b.DATA_FRAME_ANALYTICS_SOURCE_SELECTION)},isDisabled:a,color:"primary",iconType:"plusInCircle",fill:!0,"data-test-subj":"mlAnalyticsCreateFirstButton"},o.i18n.translate("xpack.ml.dataFrame.analyticsList.emptyPromptButtonText",{defaultMessage:"Create job"}))],footer:Object(b.jsx)(s.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(b.jsx)(s.EuiFlexItem,{grow:!1},Object(b.jsx)(s.EuiTitle,{size:"xxs"},Object(b.jsx)("h3",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.common.learnMoreQuestion",defaultMessage:"Want to learn more?"})))),Object(b.jsx)(s.EuiFlexItem,{grow:!1},Object(b.jsx)(s.EuiLink,{href:e.links.ml.dataFrameAnalytics,target:"_blank",external:!0},Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.common.readDocumentationLink",defaultMessage:"Read documentation"})))),"data-test-subj":"mlNoDataFrameAnalyticsFound"})}},function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var i=a(17),n=a.n(i),s=a(45),o=a(2),r=a(44),l=a(80),c=a(85),d=a(155),u=a(13);const p=o.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.shouldUnTagLabel.job",{defaultMessage:"Remove job from current space"}),m=o.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.shouldUnTagLabel.model",{defaultMessage:"Remove model from current space"}),b=({canDeleteCallback:e,onCloseCallback:t,refreshJobsCallback:a,mlSavedObjectType:b,ids:f,setDidUntag:h,hasManagedJob:g})=>{const[j,x]=Object(i.useState)(),[v,y]=Object(i.useState)(),[O,E]=Object(i.useState)(!1),[w,M]=Object(i.useState)(!1),[S,_]=Object(i.useState)(!1),[T,C]=Object(i.useState)(),{savedObjects:{canDeleteMLSpaceAwareItems:k,removeItemFromCurrentSpace:F}}=Object(l.a)(),{displayErrorToast:I,displaySuccessToast:D}=Object(c.c)();Object(i.useEffect)((()=>{_(!0),k(b,f).then((t=>{const a=function(e){const t=Object.keys(e),{canDelete:a,canRemoveFromSpace:i}=e[t[0]];let n=!0;return t.length>1&&(n=t.every((t=>e[t].canDelete===a&&e[t].canRemoveFromSpace===i))),{canDelete:a,canRemoveFromSpace:i,canTakeAnyAction:n}}(t),{canDelete:i,canRemoveFromSpace:l,canTakeAnyAction:c}=a;if(c&&i&&!l)return void e();C(a);const{buttonText:p,modalText:m}=function(e,t,a,i){const{canDelete:l,canRemoveFromSpace:c,canTakeAnyAction:p}=a;if(!1===p)return{buttonText:Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextNoAction",defaultMessage:"Close"}),modalText:Object(u.jsx)(r.EuiText,null,Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextNoAction",defaultMessage:"{ids} have different space permissions. ",values:{ids:e.join(", ")}}),"trained-model"===t?Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextNoAction.model",defaultMessage:"When you delete multiple models, they must have the same permissions. Deselect the models and try deleting each model individually."}):Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextNoAction.job",defaultMessage:"When you delete multiple jobs, they must have the same permissions. Deselect the jobs and try deleting each job individually."}))};const m={buttonText:Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextClose",defaultMessage:"Close"}),modalText:Object(u.jsx)(r.EuiText,null,Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextClose",defaultMessage:"{ids} cannot be deleted and cannot be removed from the current space. ",values:{ids:e.join(", ")}}),"trained-model"===t?Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextClose.model",defaultMessage:"This model is assigned to the * space and you do not have access to all spaces."}):Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextClose.job",defaultMessage:"This job is assigned to the * space and you do not have access to all spaces."}))};return l?{buttonText:"trained-model"===t?Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextCanDelete.model",defaultMessage:"Continue to delete {length, plural, one {# model} other {# models}}",values:{length:e.length}}):Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextCanDelete.job",defaultMessage:"Continue to delete {length, plural, one {# job} other {# jobs}}",values:{length:e.length}}),modalText:Object(u.jsx)(n.a.Fragment,null,i?Object(u.jsx)(n.a.Fragment,null,Object(u.jsx)(d.a,{jobsCount:e.length,action:o.i18n.translate("xpack.ml.jobsList.deleteJobCheckModal.removeOrDeleteAction",{defaultMessage:"removing or deleting"})}),Object(u.jsx)(r.EuiSpacer,{size:"s"})):null,Object(u.jsx)(r.EuiText,null,Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextCanDelete",defaultMessage:"{ids} can be deleted.",values:{ids:e.join(", ")}})))}:c?{buttonText:Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextCanUnTagConfirm",defaultMessage:"Remove from current space"}),modalText:Object(u.jsx)(n.a.Fragment,null,i?Object(u.jsx)(n.a.Fragment,null,Object(u.jsx)(d.a,{jobsCount:e.length,action:o.i18n.translate("xpack.ml.jobsList.deleteJobCheckModal.removeAction",{defaultMessage:"removing"})}),Object(u.jsx)(r.EuiSpacer,{size:"s"})):null,Object(u.jsx)(r.EuiText,null,Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextCanUnTag",defaultMessage:"{ids} cannot be deleted but can be removed from the current space.",values:{ids:e.join(", ")}})))}:m}(f,b,a,g);x(p),y(m)})),"function"==typeof h&&h(!1),_(!1)}),[g]);const A=async()=>{M(!0);const e=await F(b,f);M(!1),"function"==typeof h&&h(!0),Object.entries(e).forEach((([e,{success:t,error:a}])=>{if(!1===t){const t=o.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.unTagErrorTitle",{defaultMessage:"Error updating {id}",values:{id:e}});I(a,t)}else{E(!0);const t=o.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.unTagSuccessTitle",{defaultMessage:"Successfully updated {id}",values:{id:e}});D(t)}})),t(),"function"==typeof a&&a()};return Object(u.jsx)(r.EuiModal,{onClose:t,"data-test-subj":"mlDeleteSpaceAwareItemCheckModalOverlay"},!0===S&&Object(u.jsx)(n.a.Fragment,null,Object(u.jsx)(r.EuiModalBody,null,Object(u.jsx)(r.EuiFlexGroup,{justifyContent:"spaceAround"},Object(u.jsx)(r.EuiFlexItem,{grow:!1},Object(u.jsx)(r.EuiLoadingSpinner,{size:"xl"}))))),!1===S&&Object(u.jsx)(n.a.Fragment,null,Object(u.jsx)(r.EuiModalHeader,null,Object(u.jsx)(r.EuiModalHeaderTitle,null,Object(u.jsx)(s.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTitle",defaultMessage:"Checking space permissions"}))),Object(u.jsx)(r.EuiModalBody,null,v),Object(u.jsx)(r.EuiModalFooter,null,Object(u.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(u.jsx)(r.EuiFlexItem,{grow:!1},!O&&(null==T?void 0:T.canTakeAnyAction)&&(null==T?void 0:T.canRemoveFromSpace)&&(null==T?void 0:T.canDelete)&&Object(u.jsx)(r.EuiButtonEmpty,{isLoading:w,color:"primary",size:"s",onClick:A},"trained-model"===b?m:p)),Object(u.jsx)(r.EuiFlexItem,{grow:!1},Object(u.jsx)(r.EuiButton,{size:"s",onClick:null==T||!T.canTakeAnyAction||null==T||!T.canRemoveFromSpace||null!=T&&T.canDelete?async()=>{null!=T&&T.canTakeAnyAction&&null!=T&&T.canDelete?e():t()}:A,fill:!0},j))))))}},,,,,,,,,function(e,t,a){"use strict";a.d(t,"c",(function(){return p})),a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return u}));var i,n=a(17),s=a(55),o=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},i(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),r="html",l="svg",c=function(e,t){var a,i,n,s={};if(e===r)n=document.createElement("div");else{if(e!==l)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');n=document.createElementNS("http://www.w3.org/2000/svg","g")}if(t&&"object"==typeof t)for(var o=0,c=Object.entries(t.attributes);o<c.length;o++){var d=c[o],u=d[0],p=d[1];n.setAttribute(u,p)}var m={element:n,elementType:e,setPortalProps:function(e){s=e},getInitialPortalProps:function(){return s},mount:function(t,n){if(n!==i){if(m.unmount(),t!==a&&!function(e,t){if(t===r)return e instanceof HTMLElement;if(t===l)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(t,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+t.tagName+">.");t.replaceChild(m.element,n),a=t,i=n}},unmount:function(e){e&&e!==i||a&&i&&(a.replaceChild(i,m.element),a=void 0,i=void 0)}};return m},d=function(e){function t(t){var a=e.call(this,t)||this;return a.addPropsChannel=function(){Object.assign(a.props.node,{setPortalProps:function(e){a.setState({nodeProps:e})}})},a.state={nodeProps:a.props.node.getInitialPortalProps()},a}return o(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,a=t.children,i=t.node;return s.createPortal(n.Children.map(a,(function(t){return n.isValidElement(t)?n.cloneElement(t,e.state.nodeProps):t})),i.element)},t}(n.PureComponent),u=function(e){function t(t){var a=e.call(this,t)||this;return a.placeholderNode=n.createRef(),a.passPropsThroughPortal(),a}return o(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,a=t.parentNode;e.mount(a,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode=e);var t=this.placeholderNode.current,a=t.parentNode;e.mount(a,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){this.props.node.unmount(this.placeholderNode.current)},t.prototype.render=function(){return n.createElement("div",{ref:this.placeholderNode})},t}(n.PureComponent),p=c.bind(null,r);c.bind(null,l)},function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return c}));var i=a(17),n=a(224),s=a(44),o=a(209),r=a(13);const l=({children:e})=>{const{headerPortal:t,setIsHeaderMounted:a}=Object(i.useContext)(o.b);return Object(i.useEffect)((()=>(a(!0),()=>{a(!1)})),[]),Object(r.jsx)(n.a,{node:t},e)},c=()=>{const{headerPortal:e,isHeaderMounted:t}=Object(i.useContext)(o.b);return t?Object(r.jsx)(n.b,{node:e}):Object(r.jsx)(s.EuiLoadingContent,{lines:1})}},function(e,t,a){"use strict";var i=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function n(e,t){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!((n=e[a])===(s=t[a])||i(n)&&i(s)))return!1;var n,s;return!0}e.exports=function(e,t){void 0===t&&(t=n);var a=null;function i(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];if(a&&a.lastThis===this&&t(i,a.lastArgs))return a.lastResult;var s=e.apply(this,i);return a={lastResult:s,lastArgs:i,lastThis:this},s}return i.clear=function(){a=null},i}},function(e,t,a){"use strict";(function(t){var i=a(398);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function n(e,t){if(e===t)return 0;for(var a=e.length,i=t.length,n=0,s=Math.min(a,i);n<s;++n)if(e[n]!==t[n]){a=e[n],i=t[n];break}return a<i?-1:i<a?1:0}function s(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var o=a(175),r=Object.prototype.hasOwnProperty,l=Array.prototype.slice,c="foo"===function(){}.name;function d(e){return Object.prototype.toString.call(e)}function u(e){return!s(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var p=e.exports=j,m=/\s*function\s+([^\(\s]*)\s*/;function b(e){if(o.isFunction(e)){if(c)return e.name;var t=e.toString().match(m);return t&&t[1]}}function f(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function h(e){if(c||!o.isFunction(e))return o.inspect(e);var t=b(e);return"[Function"+(t?": "+t:"")+"]"}function g(e,t,a,i,n){throw new p.AssertionError({message:a,actual:e,expected:t,operator:i,stackStartFunction:n})}function j(e,t){e||g(e,!0,t,"==",p.ok)}function x(e,t,a,i){if(e===t)return!0;if(s(e)&&s(t))return 0===n(e,t);if(o.isDate(e)&&o.isDate(t))return e.getTime()===t.getTime();if(o.isRegExp(e)&&o.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(u(e)&&u(t)&&d(e)===d(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(s(e)!==s(t))return!1;var r=(i=i||{actual:[],expected:[]}).actual.indexOf(e);return-1!==r&&r===i.expected.indexOf(t)||(i.actual.push(e),i.expected.push(t),function(e,t,a,i){if(null==e||null==t)return!1;if(o.isPrimitive(e)||o.isPrimitive(t))return e===t;if(a&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var n=v(e),s=v(t);if(n&&!s||!n&&s)return!1;if(n)return x(e=l.call(e),t=l.call(t),a);var r,c,d=E(e),u=E(t);if(d.length!==u.length)return!1;for(d.sort(),u.sort(),c=d.length-1;c>=0;c--)if(d[c]!==u[c])return!1;for(c=d.length-1;c>=0;c--)if(!x(e[r=d[c]],t[r],a,i))return!1;return!0}(e,t,a,i))}return a?e===t:e==t}function v(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function y(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function O(e,t,a,i){var n;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof a&&(i=a,a=null),n=function(e){var t;try{e()}catch(e){t=e}return t}(t),i=(a&&a.name?" ("+a.name+").":".")+(i?" "+i:"."),e&&!n&&g(n,a,"Missing expected exception"+i);var s="string"==typeof i,r=!e&&n&&!a;if((!e&&o.isError(n)&&s&&y(n,a)||r)&&g(n,a,"Got unwanted exception"+i),e&&n&&a&&!y(n,a)||!e&&n)throw n}p.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return f(h(e.actual),128)+" "+e.operator+" "+f(h(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var a=new Error;if(a.stack){var i=a.stack,n=b(t),s=i.indexOf("\n"+n);if(s>=0){var o=i.indexOf("\n",s+1);i=i.substring(o+1)}this.stack=i}}},o.inherits(p.AssertionError,Error),p.fail=g,p.ok=j,p.equal=function(e,t,a){e!=t&&g(e,t,a,"==",p.equal)},p.notEqual=function(e,t,a){e==t&&g(e,t,a,"!=",p.notEqual)},p.deepEqual=function(e,t,a){x(e,t,!1)||g(e,t,a,"deepEqual",p.deepEqual)},p.deepStrictEqual=function(e,t,a){x(e,t,!0)||g(e,t,a,"deepStrictEqual",p.deepStrictEqual)},p.notDeepEqual=function(e,t,a){x(e,t,!1)&&g(e,t,a,"notDeepEqual",p.notDeepEqual)},p.notDeepStrictEqual=function e(t,a,i){x(t,a,!0)&&g(t,a,i,"notDeepStrictEqual",e)},p.strictEqual=function(e,t,a){e!==t&&g(e,t,a,"===",p.strictEqual)},p.notStrictEqual=function(e,t,a){e===t&&g(e,t,a,"!==",p.notStrictEqual)},p.throws=function(e,t,a){O(!0,e,t,a)},p.doesNotThrow=function(e,t,a){O(!1,e,t,a)},p.ifError=function(e){if(e)throw e},p.strict=i((function e(t,a){t||g(t,!0,a,"==",e)}),p,{equal:p.strictEqual,deepEqual:p.deepStrictEqual,notEqual:p.notStrictEqual,notDeepEqual:p.notDeepStrictEqual}),p.strict.strict=p.strict;var E=Object.keys||function(e){var t=[];for(var a in e)r.call(e,a)&&t.push(a);return t}}).call(this,a(171))},function(e,t,a){"use strict";var i=a(123);e.exports=s;var n="\0";function s(e){this._isDirected=!i.has(e,"directed")||e.directed,this._isMultigraph=!!i.has(e,"multigraph")&&e.multigraph,this._isCompound=!!i.has(e,"compound")&&e.compound,this._label=void 0,this._defaultNodeLabelFn=i.constant(void 0),this._defaultEdgeLabelFn=i.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children["\0"]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function o(e,t){e[t]?e[t]++:e[t]=1}function r(e,t){--e[t]||delete e[t]}function l(e,t,a,n){var s=""+t,o=""+a;if(!e&&s>o){var r=s;s=o,o=r}return s+""+o+""+(i.isUndefined(n)?"\0":n)}function c(e,t,a,i){var n=""+t,s=""+a;if(!e&&n>s){var o=n;n=s,s=o}var r={v:n,w:s};return i&&(r.name=i),r}function d(e,t){return l(e,t.v,t.w,t.name)}s.prototype._nodeCount=0,s.prototype._edgeCount=0,s.prototype.isDirected=function(){return this._isDirected},s.prototype.isMultigraph=function(){return this._isMultigraph},s.prototype.isCompound=function(){return this._isCompound},s.prototype.setGraph=function(e){return this._label=e,this},s.prototype.graph=function(){return this._label},s.prototype.setDefaultNodeLabel=function(e){return i.isFunction(e)||(e=i.constant(e)),this._defaultNodeLabelFn=e,this},s.prototype.nodeCount=function(){return this._nodeCount},s.prototype.nodes=function(){return i.keys(this._nodes)},s.prototype.sources=function(){var e=this;return i.filter(this.nodes(),(function(t){return i.isEmpty(e._in[t])}))},s.prototype.sinks=function(){var e=this;return i.filter(this.nodes(),(function(t){return i.isEmpty(e._out[t])}))},s.prototype.setNodes=function(e,t){var a=arguments,n=this;return i.each(e,(function(e){a.length>1?n.setNode(e,t):n.setNode(e)})),this},s.prototype.setNode=function(e,t){return i.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=n,this._children[e]={},this._children["\0"][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)},s.prototype.node=function(e){return this._nodes[e]},s.prototype.hasNode=function(e){return i.has(this._nodes,e)},s.prototype.removeNode=function(e){var t=this;if(i.has(this._nodes,e)){var a=function(e){t.removeEdge(t._edgeObjs[e])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],i.each(this.children(e),(function(e){t.setParent(e)})),delete this._children[e]),i.each(i.keys(this._in[e]),a),delete this._in[e],delete this._preds[e],i.each(i.keys(this._out[e]),a),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this},s.prototype.setParent=function(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(i.isUndefined(t))t=n;else{for(var a=t+="";!i.isUndefined(a);a=this.parent(a))if(a===e)throw new Error("Setting "+t+" as parent of "+e+" would create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this},s.prototype._removeFromParentsChildList=function(e){delete this._children[this._parent[e]][e]},s.prototype.parent=function(e){if(this._isCompound){var t=this._parent[e];if(t!==n)return t}},s.prototype.children=function(e){if(i.isUndefined(e)&&(e=n),this._isCompound){var t=this._children[e];if(t)return i.keys(t)}else{if(e===n)return this.nodes();if(this.hasNode(e))return[]}},s.prototype.predecessors=function(e){var t=this._preds[e];if(t)return i.keys(t)},s.prototype.successors=function(e){var t=this._sucs[e];if(t)return i.keys(t)},s.prototype.neighbors=function(e){var t=this.predecessors(e);if(t)return i.union(t,this.successors(e))},s.prototype.isLeaf=function(e){return 0===(this.isDirected()?this.successors(e):this.neighbors(e)).length},s.prototype.filterNodes=function(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var a=this;i.each(this._nodes,(function(a,i){e(i)&&t.setNode(i,a)})),i.each(this._edgeObjs,(function(e){t.hasNode(e.v)&&t.hasNode(e.w)&&t.setEdge(e,a.edge(e))}));var n={};function s(e){var i=a.parent(e);return void 0===i||t.hasNode(i)?(n[e]=i,i):i in n?n[i]:s(i)}return this._isCompound&&i.each(t.nodes(),(function(e){t.setParent(e,s(e))})),t},s.prototype.setDefaultEdgeLabel=function(e){return i.isFunction(e)||(e=i.constant(e)),this._defaultEdgeLabelFn=e,this},s.prototype.edgeCount=function(){return this._edgeCount},s.prototype.edges=function(){return i.values(this._edgeObjs)},s.prototype.setPath=function(e,t){var a=this,n=arguments;return i.reduce(e,(function(e,i){return n.length>1?a.setEdge(e,i,t):a.setEdge(e,i),i})),this},s.prototype.setEdge=function(){var e,t,a,n,s=!1,r=arguments[0];"object"==typeof r&&null!==r&&"v"in r?(e=r.v,t=r.w,a=r.name,2===arguments.length&&(n=arguments[1],s=!0)):(e=r,t=arguments[1],a=arguments[3],arguments.length>2&&(n=arguments[2],s=!0)),e=""+e,t=""+t,i.isUndefined(a)||(a=""+a);var d=l(this._isDirected,e,t,a);if(i.has(this._edgeLabels,d))return s&&(this._edgeLabels[d]=n),this;if(!i.isUndefined(a)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[d]=s?n:this._defaultEdgeLabelFn(e,t,a);var u=c(this._isDirected,e,t,a);return e=u.v,t=u.w,Object.freeze(u),this._edgeObjs[d]=u,o(this._preds[t],e),o(this._sucs[e],t),this._in[t][d]=u,this._out[e][d]=u,this._edgeCount++,this},s.prototype.edge=function(e,t,a){var i=1===arguments.length?d(this._isDirected,arguments[0]):l(this._isDirected,e,t,a);return this._edgeLabels[i]},s.prototype.hasEdge=function(e,t,a){var n=1===arguments.length?d(this._isDirected,arguments[0]):l(this._isDirected,e,t,a);return i.has(this._edgeLabels,n)},s.prototype.removeEdge=function(e,t,a){var i=1===arguments.length?d(this._isDirected,arguments[0]):l(this._isDirected,e,t,a),n=this._edgeObjs[i];return n&&(e=n.v,t=n.w,delete this._edgeLabels[i],delete this._edgeObjs[i],r(this._preds[t],e),r(this._sucs[e],t),delete this._in[t][i],delete this._out[e][i],this._edgeCount--),this},s.prototype.inEdges=function(e,t){var a=this._in[e];if(a){var n=i.values(a);return t?i.filter(n,(function(e){return e.v===t})):n}},s.prototype.outEdges=function(e,t){var a=this._out[e];if(a){var n=i.values(a);return t?i.filter(n,(function(e){return e.w===t})):n}},s.prototype.nodeEdges=function(e,t){var a=this.inEdges(e,t);if(a)return a.concat(this.outEdges(e,t))}},function(e,t,a){var i=a(230),n=a(176);e.exports=function(e,t){return e&&i(e,t,n)}},function(e,t,a){var i=a(423)();e.exports=i},function(e,t,a){e.exports=a(39)(1155)},function(e,t,a){e.exports=a(39)(1502)},function(e,t,a){e.exports=a(39)(1544)},function(e,t,a){e.exports=a(39)(1137)},function(e,t,a){e.exports=a(39)(1504)},function(e,t,a){e.exports=a(39)(888)},function(e,t,a){e.exports=a(39)(1545)},function(e,t,a){e.exports=a(39)(3441)},function(e,t,a){var i=a(317);e.exports=function(e,t,a){for(var n=-1,s=e.length;++n<s;){var o=e[n],r=t(o);if(null!=r&&(void 0===l?r==r&&!i(r):a(r,l)))var l=r,c=o}return c}},,,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var i=a(17),n=a(340),s=a(13);const o=({selectedIds:e,withTimeRangeSelector:t,dateFormatTz:a,singleSelection:o,timeseriesOnly:r,onFlyoutClose:l,onSelectionConfirmed:c,maps:d})=>{const[u,p]=Object(i.useState)(!0);return Object(s.jsx)(n.b,{selectedIds:e,withTimeRangeSelector:t,dateFormatTz:a,singleSelection:o,timeseriesOnly:r,onFlyoutClose:l,onSelectionConfirmed:c,onTimeRangeConfigChange:p,applyTimeRangeConfig:u,maps:d})}},,,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(17);t.default=function(e,t){void 0===t&&(t=0);var a=i.useRef(!1),n=i.useRef(),s=i.useRef(e),o=i.useCallback((function(){return a.current}),[]),r=i.useCallback((function(){a.current=!1,n.current&&clearTimeout(n.current),n.current=setTimeout((function(){a.current=!0,s.current()}),t)}),[t]),l=i.useCallback((function(){a.current=null,n.current&&clearTimeout(n.current)}),[]);return i.useEffect((function(){s.current=e}),[e]),i.useEffect((function(){return r(),l}),[t]),[o,l,r]}},,,,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return Pe})),a.d(t,"b",(function(){return Ve})),a.d(t,"c",(function(){return Be}));var i=a(17),n=a.n(i),s=a(44),o=a(2),r=a(45),l=a(48),c=a(6),d=a(97),u=a(137),p=a(46),m=a(13);const b=({model:e,onConfirm:t,onCancel:a})=>Object(m.jsx)(s.EuiConfirmModal,{title:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.forceStopDialog.title",defaultMessage:"Stop model {modelId}?",values:{modelId:e.model_id}}),onCancel:a,onConfirm:t,cancelButtonText:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.forceStopDialog.cancelText",defaultMessage:"Cancel"}),confirmButtonText:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.forceStopDialog.confirmText",defaultMessage:"Stop"}),buttonColor:"danger"},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.forceStopDialog.pipelinesWarning",defaultMessage:"You can't use these ingest pipelines until you restart the model:"}),Object(m.jsx)("ul",null,Object.keys(e.pipelines).sort().map((e=>Object(m.jsx)("li",{key:e},e)))));var f=a(85),h=a(324),g=a(99),j=a(20);const x=({config:e,onConfigChange:t})=>{const a=e.numOfAllocations,n=e.threadsPerAllocations,l=Object(i.useMemo)((()=>new Array(4).fill(null).map(((e,t)=>{const a=Math.pow(2,t),i=a.toString();return{id:i,label:i,value:a}}))),[]),c="low"===e.priority;return Object(m.jsx)(s.EuiForm,{component:"form",id:"startDeploymentForm"},void 0!==e.priority?Object(m.jsx)(s.EuiDescribedFormGroup,{titleSize:"xxs",title:Object(m.jsx)("h3",null,Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.priorityLabel",defaultMessage:"Priority"})),description:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.priorityHelp",defaultMessage:"Select low priority for demonstrations where each model will be very lightly used."})},Object(m.jsx)(s.EuiFormRow,{label:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.priorityLabel",defaultMessage:"Priority"}),hasChildLabel:!1},Object(m.jsx)(s.EuiButtonGroup,{legend:o.i18n.translate("xpack.ml.trainedModels.modelsList.startDeployment.priorityLegend",{defaultMessage:"Priority selector"}),name:"priority",isFullWidth:!0,idSelected:e.priority,onChange:a=>{t({...e,priority:a})},options:[{id:"low",value:"low",label:o.i18n.translate("xpack.ml.trainedModels.modelsList.startDeployment.lowPriorityLabel",{defaultMessage:"low"})},{id:"normal",value:"normal",label:o.i18n.translate("xpack.ml.trainedModels.modelsList.startDeployment.normalPriorityLabel",{defaultMessage:"normal"})}],"data-test-subj":"mlModelsStartDeploymentModalPriority"}))):null,Object(m.jsx)(s.EuiDescribedFormGroup,{titleSize:"xxs",title:Object(m.jsx)("h3",null,Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.numbersOfAllocationsLabel",defaultMessage:"Number of allocations"})),description:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.numbersOfAllocationsHelp",defaultMessage:"Increase to improve throughput of all requests."})},Object(m.jsx)(s.EuiFormRow,{label:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.numbersOfAllocationsLabel",defaultMessage:"Number of allocations"}),hasChildLabel:!1,isDisabled:c},Object(m.jsx)(s.EuiFieldNumber,{disabled:c,fullWidth:!0,min:1,step:1,name:"numOfAllocations",value:c?1:a,onChange:a=>{t({...e,numOfAllocations:Number(a.target.value)})},"data-test-subj":"mlModelsStartDeploymentModalNumOfAllocations"}))),void 0!==n?Object(m.jsx)(s.EuiDescribedFormGroup,{titleSize:"xxs",title:Object(m.jsx)("h3",null,Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.threadsPerAllocationLabel",defaultMessage:"Threads per allocation"})),description:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.threadsPerAllocationHelp",defaultMessage:"Increase to improve latency for each request."})},Object(m.jsx)(s.EuiFormRow,{label:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.threadsPerAllocationLabel",defaultMessage:"Threads per allocation"}),hasChildLabel:!1,isDisabled:c},Object(m.jsx)(s.EuiButtonGroup,{isDisabled:c,legend:o.i18n.translate("xpack.ml.trainedModels.modelsList.startDeployment.threadsPerAllocationLegend",{defaultMessage:"Threads per allocation selector"}),name:"threadsPerAllocation",isFullWidth:!0,idSelected:c?"1":l.find((e=>e.value===n)).id,onChange:a=>{const i=l.find((e=>e.id===a)).value;t({...e,threadsPerAllocations:i})},options:l,"data-test-subj":"mlModelsStartDeploymentModalThreadsPerAllocation"}))):null)};var v={name:"zdrr8d",styles:"align-self:center;margin-right:auto"};const y=({modelId:e,onConfigChange:t,onClose:a,startModelDeploymentDocUrl:n,initialParams:o})=>{const[l,c]=Object(i.useState)(null!=o?o:{numOfAllocations:1,threadsPerAllocations:1,priority:Object(g.f)()?"low":"normal"}),d=void 0!==o,u=Object(j.a)(Object(j.e)(),Object(h.numberValidator)({min:1,integerOnly:!0}))(l.numOfAllocations);return Object(m.jsx)(s.EuiModal,{onClose:a,initialFocus:"[name=numOfAllocations]",maxWidth:!1,"data-test-subj":"mlModelsStartDeploymentModal"},Object(m.jsx)(s.EuiModalHeader,null,Object(m.jsx)(s.EuiModalHeaderTitle,null,Object(m.jsx)(s.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(m.jsx)(s.EuiFlexItem,{grow:!1},Object(m.jsx)(s.EuiTitle,{size:"s"},Object(m.jsx)("h2",null,d?Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.updateDeployment.modalTitle",defaultMessage:"Update {modelId} deployment",values:{modelId:e}}):Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.modalTitle",defaultMessage:"Start {modelId} deployment",values:{modelId:e}})))),Object(m.jsx)(s.EuiFlexItem,{grow:!1})))),Object(m.jsx)(s.EuiModalBody,null,Object(m.jsx)(s.EuiCallOut,{size:"s",title:Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.maxNumOfProcessorsWarning",defaultMessage:"The product of the number of allocations and threads per allocation should be less than the total number of processors on your ML nodes."}),iconType:"iInCircle",color:"primary"}),Object(m.jsx)(s.EuiSpacer,{size:"m"}),Object(m.jsx)(x,{config:l,onConfigChange:c}),Object(m.jsx)(s.EuiSpacer,{size:"m"})),Object(m.jsx)(s.EuiModalFooter,null,Object(m.jsx)(s.EuiLink,{href:n,external:!0,target:"_blank",css:v},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.docLinkTitle",defaultMessage:"Learn more"})),Object(m.jsx)(s.EuiButtonEmpty,{onClick:a},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.cancelButton",defaultMessage:"Cancel"})),Object(m.jsx)(s.EuiButton,{type:"submit",form:"startDeploymentForm",onClick:t.bind(null,l),fill:!0,disabled:!!u,"data-test-subj":"mlModelsStartDeploymentModalStartButton"},d?Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.updateButton",defaultMessage:"Update"}):Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.startButton",defaultMessage:"Start"}))))};var O=a(80),E=a(114),w=a(0);const M="started",S="pytorch",_="lang_ident",T={NER:"ner",QUESTION_ANSWERING:"question_answering",ZERO_SHOT_CLASSIFICATION:"zero_shot_classification",TEXT_CLASSIFICATION:"text_classification",TEXT_EMBEDDING:"text_embedding",FILL_MASK:"fill_mask"},C=o.i18n.translate("xpack.ml.trainedModels.modelsList.builtInModelLabel",{defaultMessage:"built-in"});var k=a(5),F=a.n(k),I=a(23),D=a(25);const A=({taskLabel:e,info:t})=>0===t.length?null:Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiCallOut,{title:e},t.map((e=>Object(m.jsx)(s.EuiText,{size:"s"},e)))),Object(m.jsx)(s.EuiSpacer,null));let L,R;!function(e){e[e.STOPPED=0]="STOPPED",e[e.RUNNING=1]="RUNNING",e[e.FINISHED=2]="FINISHED",e[e.FINISHED_WITH_ERRORS=3]="FINISHED_WITH_ERRORS"}(L||(L={})),function(e){e[e.TEXT=0]="TEXT",e[e.INDEX=1]="INDEX"}(R||(R={}));class inference_base_InferenceBase{constructor(e,t,a){var i,n;F()(this,"inferenceType",void 0),F()(this,"inferenceTypeLabel",void 0),F()(this,"modelInputField",void 0),F()(this,"inputText$",new I.BehaviorSubject([])),F()(this,"inputField$",new I.BehaviorSubject("")),F()(this,"inferenceResult$",new I.BehaviorSubject(null)),F()(this,"inferenceError$",new I.BehaviorSubject(null)),F()(this,"runningState$",new I.BehaviorSubject(L.STOPPED)),F()(this,"isValid$",new I.BehaviorSubject(!1)),F()(this,"pipeline$",new I.BehaviorSubject({})),F()(this,"info",[]),F()(this,"subscriptions$",new I.Subscription),this.trainedModelsApi=e,this.model=t,this.inputType=a,this.modelInputField=null!==(i=null===(n=t.input)||void 0===n?void 0:n.field_names[0])&&void 0!==i?i:"text_field",this.inputField$.next(this.modelInputField)}destroy(){this.subscriptions$.unsubscribe()}initialize(e,t){this.initializeValidators(e),this.initializePipeline(t)}initializeValidators(e){const t=[this.inputText$.pipe(Object(D.map)((e=>e.some((e=>""!==e))))),...e||[]];this.subscriptions$.add(Object(I.combineLatest)(t).pipe(Object(D.map)((e=>e.every((e=>!!e))))).subscribe(this.isValid$))}initializePipeline(e){const t=[this.inputField$.asObservable(),...e||[]];this.subscriptions$.add(Object(I.combineLatest)(t).subscribe((()=>{this.pipeline$.next(this.generatePipeline())})))}setStopped(){this.inferenceError$.next(null),this.runningState$.next(L.STOPPED)}setRunning(){this.inferenceError$.next(null),this.runningState$.next(L.RUNNING)}setFinished(){this.runningState$.next(L.FINISHED)}setFinishedWithErrors(e){this.inferenceError$.next(e),this.runningState$.next(L.FINISHED_WITH_ERRORS)}getInfoComponent(){return e=this.inferenceTypeLabel,t=this.info,Object(m.jsx)(A,{taskLabel:e,info:t});var e,t}getInputType(){return this.inputType}reset(){this.inputText$.next([]),this.inferenceResult$.next(null),this.inferenceError$.next(null),this.runningState$.next(L.STOPPED)}setInputField(e){this.inputField$.next(void 0===e?this.modelInputField:e)}getInputField(){return this.inputField$.getValue()}getInputField$(){return this.inputField$.asObservable()}setInputText(e){this.inputText$.next(e)}getInputText$(){return this.inputText$.asObservable()}getInputText(){return this.inputText$.getValue()}getInferenceResult$(){return this.inferenceResult$.asObservable()}getInferenceResult(){return this.inferenceResult$.getValue()}getInferenceError$(){return this.inferenceError$.asObservable()}getInferenceError(){return this.inferenceError$.getValue()}getRunningState$(){return this.runningState$.asObservable()}getRunningState(){return this.runningState$.getValue()}getIsValid$(){return this.isValid$.asObservable()}getIsValid(){return this.isValid$.getValue()}async infer(){return this.inputType===R.TEXT?this.inferText():this.inferIndex()}generatePipeline(){return{processors:this.getProcessors()}}getPipeline$(){return this.pipeline$.asObservable()}getPipeline(){return this.pipeline$.getValue()}getBasicProcessors(e){return[{inference:{model_id:this.model.model_id,target_field:this.inferenceType,field_map:{[this.inputField$.getValue()]:this.modelInputField},...e&&Object.keys(e).length?{inference_config:this.getInferenceConfig(e)}:{}}}]}getInferenceConfig(e){return{[this.inferenceType]:{...e}}}async runInfer(e,t){try{this.setRunning();const a=this.inputText$.getValue()[0],i=e(),n=t(await this.trainedModelsApi.inferTrainedModel(this.model.model_id,{docs:this.getInferDocs(),...i?{inference_config:i}:{}},"30s"),a);return this.inferenceResult$.next([n]),this.setFinished(),[n]}catch(e){throw this.setFinishedWithErrors(e),e}}async runPipelineSimulate(e){try{this.setRunning();const{docs:t}=await this.trainedModelsApi.trainedModelPipelineSimulate(this.getPipeline(),this.getPipelineDocs()),a=t.map((t=>e(this.getDocFromResponse(t))));return this.inferenceResult$.next(a),this.setFinished(),a}catch(e){throw this.setFinishedWithErrors(e),e}}getInferDocs(){return[{[this.inputField$.getValue()]:this.inputText$.getValue()[0]}]}getPipelineDocs(){return this.inputText$.getValue().map((e=>({_source:{[this.inputField$.getValue()]:e}})))}getDefaultInferenceConfig(){return this.model.inference_config[this.inferenceType]}getNumTopClassesConfig(e=5){var t;const a=this.getDefaultInferenceConfig();return a&&"num_top_classes"in a&&null!==(t=null==a?void 0:a.num_top_classes)&&void 0!==t&&t?{}:{num_top_classes:e}}getDocFromResponse({doc:e,error:t}){if(void 0===e){if(t)throw this.setFinishedWithErrors(t),Error(t.reason);throw Error(o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.pipelineSimulate.unknownError",{defaultMessage:"Error simulating ingest pipeline"}))}return e}}var N=a(90),P=a.n(N);const z=({placeholder:e,inferrer:t})=>{const[a,n]=Object(i.useState)("");Object(i.useEffect)((()=>{t.setInputText([a])}),[a,t]);const r=P()(t.getRunningState$(),t.getRunningState());return Object(m.jsx)(s.EuiFormRow,{label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.generalTextInput.inputTitle",{defaultMessage:"Input text"}),fullWidth:!0},Object(m.jsx)(s.EuiTextArea,{placeholder:null!=e?e:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.generalTextInput.inputText",{defaultMessage:"Input text"}),value:a,disabled:r===L.RUNNING,fullWidth:!0,onChange:e=>{n(e.target.value)},"data-test-subj":"mlTestModelInputText"}))},B=(e,t)=>Object(m.jsx)(z,{placeholder:t,inferrer:e});var V=a(140);const J="2px",U={PER:{label:"Person",icon:"user",color:"euiColorVis5_behindText",borderColor:"euiColorVis5"},LOC:{label:"Location",icon:"visMapCoordinate",color:"euiColorVis1_behindText",borderColor:"euiColorVis1"},ORG:{label:"Organization",icon:"home",color:"euiColorVis0_behindText",borderColor:"euiColorVis0"},MISC:{label:"Miscellaneous",icon:"questionInCircle",color:"euiColorVis7_behindText",borderColor:"euiColorVis7"}},G=({inferrer:e})=>{const t=P()(e.getInferenceResult$(),e.getInferenceResult());return t?e.getInputType()===R.INDEX?Object(m.jsx)(n.a.Fragment,null,t.map((e=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(q,{result:e}),Object(m.jsx)(s.EuiHorizontalRule,null))))):Object(m.jsx)(q,{result:t[0]}):null},q=({result:e})=>{const{euiTheme:t}=Object(V.d)(),a=[];return e.response.forEach((({value:e,entity:i})=>{if(null===i){const t=e.split(/(\n)/).map((e=>"\n"===e?Object(m.jsx)("br",null):Object(m.jsx)("span",null,e)));a.push(...t)}else a.push(Object(m.jsx)(s.EuiToolTip,{position:"top",content:Object(m.jsx)("div",null,Object(m.jsx)("div",null,Object(m.jsx)(s.EuiIcon,{size:"m",type:W(i.class_name),style:{marginRight:J,verticalAlign:"text-top"}}),e),Object(m.jsx)(s.EuiHorizontalRule,{margin:"none"}),Object(m.jsx)("div",{style:{fontSize:t.euiFontSizeXS,marginTop:J}},Object(m.jsx)("div",null,Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.ner.output.typeTitle",defaultMessage:"Type"}),": ",H(i.class_name)),Object(m.jsx)("div",null,Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.ner.output.probabilityTitle",defaultMessage:"Probability"}),": ",Number(i.class_probability).toPrecision(3))))},Object(m.jsx)($,{entity:i},e)))})),Object(m.jsx)("div",{style:{lineHeight:"24px"}},a)},$=({entity:e,children:t})=>{const{euiTheme:a}=Object(V.d)();return Object(m.jsx)(s.EuiBadge,{color:Y(a,e.class_name),style:{marginRight:J,marginTop:"-2px",border:`1px solid ${Y(a,e.class_name,!0)}`,fontSize:a.euiFontSizeXS,padding:"0px 6px",pointerEvents:"none"}},Object(m.jsx)(s.EuiFlexGroup,{gutterSize:"none"},Object(m.jsx)(s.EuiFlexItem,{grow:!1},Object(m.jsx)(s.EuiIcon,{size:"s",type:W(e.class_name),style:{marginRight:J,marginTop:J}})),Object(m.jsx)(s.EuiFlexItem,null,t)))};function W(e){var t;const a=U[e];return null!==(t=null==a?void 0:a.icon)&&void 0!==t?t:"questionInCircle"}function H(e){var t;const a=U[e];return null!==(t=null==a?void 0:a.label)&&void 0!==t?t:e}function Y(e,t,a=!1){var i;const n=U[t];let s=null!==(i=null==n?void 0:n.color)&&void 0!==i?i:"euiColorVis5_behindText";var o;return a&&(s=null!==(o=null==n?void 0:n.borderColor)&&void 0!==o?o:"euiColorVis5"),e[s]}class ner_inference_NerInference extends inference_base_InferenceBase{constructor(e,t,a){super(e,t,a),F()(this,"inferenceType",T.NER),F()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.ner.label",{defaultMessage:"Named entity recognition"})),F()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.ner.info1",{defaultMessage:"Test how well the model identifies named entities in your input text."})]),this.initialize()}async inferText(){return this.runInfer((()=>{}),((e,t)=>({response:X(e),rawResponse:e,inputText:t})))}async inferIndex(){return this.runPipelineSimulate((e=>({response:X({inference_results:[e._source[this.inferenceType]]}),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}getProcessors(){return this.getBasicProcessors()}getInputComponent(){if(this.inputType===R.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.ner.inputText",{defaultMessage:"Enter a phrase to test"});return B(this,e)}return null}getOutputComponent(){return this,Object(m.jsx)(G,{inferrer:this})}}function X(e){const[{predicted_value:t,entities:a}]=e.inference_results,i=/(\[.*?\])\((.*?)&(.*?)\)/;if(void 0===t||void 0===a)return[];const n=t.split(/(\[.*?\]\(.*?&.*?\))/);let s=0;return n.map((e=>{const t=e.match(i);if(t){const e=t[3],i=a[s];return e!==i.entity&&e.replaceAll("+"," ")!==i.entity&&console.error("mismatch entity",i),s++,{value:i.entity,entity:i}}return{value:e,entity:null}}))}const Q=({inferrer:e})=>{const t=P()(e.getQuestionText$(),e.getQuestionText()),a=P()(e.getRunningState$(),e.getRunningState());return Object(m.jsx)(s.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.questionAnswering.questionInput",{defaultMessage:"Question"})},Object(m.jsx)(s.EuiFieldText,{value:t,disabled:a===L.RUNNING,fullWidth:!0,onChange:t=>{e.setQuestionText(t.target.value)}}))},K=200,Z=({inferrer:e})=>{const t=P()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(m.jsx)(n.a.Fragment,null,t.map((({response:e,inputText:t})=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(n.a.Fragment,null,function(e,t){const a=t.slice(0,e.startOffset),i=t.slice(e.endOffset,t.length),n=a.length>K?`...${a.slice(a.length-K,a.length)}`:a,s=i.length>K?`${i.slice(0,K)}...`:i;return Object(m.jsx)("div",{style:{lineHeight:"24px"}},n,Object(m.jsx)(ee,null,e.value),s)}(e[0],t)),Object(m.jsx)(s.EuiHorizontalRule,null))))):null},ee=({children:e})=>{const{euiTheme:t}=Object(V.d)();return Object(m.jsx)(s.EuiBadge,{color:t.euiColorVis5_behindText,style:{marginRight:"2px",marginTop:"-2px",border:`1px solid ${t.euiColorVis5}`,fontSize:t.euiFontSizeXS,padding:"0px 6px",pointerEvents:"none"}},e)};class question_answering_inference_QuestionAnsweringInference extends inference_base_InferenceBase{constructor(e,t,a){super(e,t,a),F()(this,"inferenceType",T.QUESTION_ANSWERING),F()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.questionAnswer.label",{defaultMessage:"Question answering"})),F()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.questionAnswer.info1",{defaultMessage:"Provide a question and test how well the model extracts an answer from your input text."})]),F()(this,"questionText$",new I.BehaviorSubject("")),this.initialize([this.questionText$.pipe(Object(D.map)((e=>""!==e)))],[this.questionText$])}async inferText(){return this.runInfer((()=>{const e=this.questionText$.value;return this.getInferenceConfig({...this.getNumTopClassesConfig(),question:e})}),((e,t)=>te(e,t)))}async inferIndex(){return this.runPipelineSimulate((e=>te({inference_results:[e._source[this.inferenceType]]},e._source[this.getInputField()])))}getProcessors(){const e=this.questionText$.value;return this.getBasicProcessors({...this.getNumTopClassesConfig(),question:e})}setQuestionText(e){this.questionText$.next(e)}getQuestionText$(){return this.questionText$.asObservable()}getQuestionText(){return this.questionText$.getValue()}getInputComponent(){return e=this,t=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.questionAnswer.inputText",{defaultMessage:"Enter unstructured text phrases related to the answers you're seeking"}),Object(m.jsx)(n.a.Fragment,null,e.getInputType()===R.TEXT?Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(z,{placeholder:t,inferrer:e}),Object(m.jsx)(s.EuiSpacer,null)):null,Object(m.jsx)(Q,{inferrer:e}));var e,t}getOutputComponent(){return this,Object(m.jsx)(Z,{inferrer:this})}}function te(e,t){const{inference_results:[a]}=e;let i=[{value:a.predicted_value,predictionProbability:a.prediction_probability,startOffset:a.start_offset,endOffset:a.end_offset}];return void 0!==a.top_classes&&(i=a.top_classes.map((e=>({value:e.answer,predictionProbability:e.score,startOffset:e.start_offset,endOffset:e.end_offset})))),{response:i,rawResponse:e,inputText:t}}function ae(e,t,a){const{inference_results:[i]}=e;return{response:ie(i,t),rawResponse:e,inputText:a}}function ie(e,t){var a,i;const n=null!==(a=null===(i=t.inference_config.text_classification)||void 0===i?void 0:i.classification_labels)&&void 0!==a?a:[];let s=[{value:e.predicted_value,predictionProbability:e.prediction_probability}];return void 0!==e.top_classes?s=e.top_classes.map((e=>({value:e.class_name,predictionProbability:e.class_probability}))):2===n.length&&(s=n.map((t=>({value:t,predictionProbability:e.predicted_value===t?e.prediction_probability:1-e.prediction_probability})))),s.map((({value:e,predictionProbability:t})=>({value:e,predictionProbability:Number(t.toPrecision(3))}))).sort(((e,t)=>e.predictionProbability-t.predictionProbability)).reverse()}const ne=e=>Object(m.jsx)(se,{inferrer:e}),se=({inferrer:e})=>{const t=P()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(m.jsx)(n.a.Fragment,null,t.map((({response:e,inputText:t})=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(oe,{response:e,inputText:t}),Object(m.jsx)(s.EuiHorizontalRule,null))))):null},oe=({response:e,inputText:t})=>Object(m.jsx)(n.a.Fragment,null,void 0!==t?Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiTitle,{size:"xxs"},Object(m.jsx)("span",null,t)),Object(m.jsx)(s.EuiSpacer,null)):null,e.map((({value:e,predictionProbability:t})=>Object(m.jsx)(i.Fragment,{key:e},Object(m.jsx)(s.EuiProgress,{value:100*t,max:100,size:"m"}),Object(m.jsx)(s.EuiSpacer,{size:"s"}),Object(m.jsx)(s.EuiFlexGroup,null,Object(m.jsx)(s.EuiFlexItem,{"data-test-subj":"mlTestModelLangIdentInputValue"},e),Object(m.jsx)(s.EuiFlexItem,{"data-test-subj":"mlTestModelLangIdentInputProbability",grow:!1},t)),Object(m.jsx)(s.EuiSpacer,null)))));class text_classification_inference_TextClassificationInference extends inference_base_InferenceBase{constructor(e,t,a){super(e,t,a),F()(this,"inferenceType",T.TEXT_CLASSIFICATION),F()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.label",{defaultMessage:"Text classification"})),F()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.info1",{defaultMessage:"Test how well the model classifies your input text."})]),this.initialize()}async inferText(){return this.runInfer((()=>this.getInferenceConfig(this.getNumTopClassesConfig())),((e,t)=>ae(e,this.model,t)))}async inferIndex(){return this.runPipelineSimulate((e=>({response:ie(e._source[this.inferenceType],this.model),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}getProcessors(){return this.getBasicProcessors(this.getNumTopClassesConfig())}getInputComponent(){if(this.inputType===R.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.inputText",{defaultMessage:"Enter a phrase to test"});return B(this,e)}return null}getOutputComponent(){return ne(this)}}const re=({inferrer:e})=>{const t=P()(e.getRunningState$(),e.getRunningState()),a=P()(e.getLabelsText$(),e.getLabelsText()),i=P()(e.getMultiLabel$(),e.getMultiLabel());return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.classNamesInput",{defaultMessage:"Class labels"}),helpText:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.classNamesHelpText",{defaultMessage:"Separate the labels with commas"})},Object(m.jsx)(s.EuiFieldText,{value:a,disabled:t===L.RUNNING,fullWidth:!0,onChange:t=>e.setLabelsText(t.target.value)})),Object(m.jsx)(s.EuiSpacer,{size:"m"}),Object(m.jsx)(s.EuiFormRow,{fullWidth:!0,helpText:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.multiLabelHelpText",{defaultMessage:"Enable the input text to match more than one label."})},Object(m.jsx)(s.EuiSwitch,{label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.multiLabelSwitch",{defaultMessage:"Multi label"}),checked:i,onChange:t=>e.setMultiLabel(t.target.checked)})))};class zero_shot_classification_inference_ZeroShotClassificationInference extends inference_base_InferenceBase{constructor(e,t,a){super(e,t,a),F()(this,"inferenceType",T.ZERO_SHOT_CLASSIFICATION),F()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.zeroShotClassification.label",{defaultMessage:"Zero shot classification"})),F()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.zeroShotClassification.info1",{defaultMessage:"Provide a set of labels and test how well the model classifies your input text."})]),F()(this,"labelsText$",new I.BehaviorSubject("")),F()(this,"multiLabel$",new I.BehaviorSubject(!1)),this.initialize([this.labelsText$.pipe(Object(D.map)((e=>""!==e)))],[this.labelsText$,this.multiLabel$])}async inferText(){return this.runInfer((()=>{const e=this.labelsText$.getValue(),t=this.multiLabel$.getValue(),a=null==e?void 0:e.split(",").map((e=>e.trim()));return this.getInferenceConfig({labels:a,multi_label:t})}),((e,t)=>ae(e,this.model,t)))}async inferIndex(){return this.runPipelineSimulate((e=>({response:ie(e._source[this.inferenceType],this.model),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}getInputLabels(){const e=this.labelsText$.getValue();return null==e?void 0:e.split(",").map((e=>e.trim()))}getProcessors(){const e=this.getInputLabels(),t=this.multiLabel$.getValue();return this.getBasicProcessors({labels:e,multi_label:t})}setLabelsText(e){this.labelsText$.next(e)}getLabelsText$(){return this.labelsText$.asObservable()}getLabelsText(){return this.labelsText$.getValue()}setMultiLabel(e){this.multiLabel$.next(e)}getMultiLabel$(){return this.multiLabel$.asObservable()}getMultiLabel(){return this.multiLabel$.getValue()}getInputComponent(){return e=this,t=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.zeroShotClassification.inputText",{defaultMessage:"Enter a phrase to test"}),Object(m.jsx)(n.a.Fragment,null,e.getInputType()===R.TEXT?Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(z,{placeholder:t,inferrer:e}),Object(m.jsx)(s.EuiSpacer,null)):null,Object(m.jsx)(re,{inferrer:e}));var e,t}getOutputComponent(){return ne(this)}}const le=({inferrer:e})=>{const t=P()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(m.jsx)(n.a.Fragment,null,t.map((t=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(oe,{response:t.response,inputText:e.predictedValue(t)}),Object(m.jsx)(s.EuiHorizontalRule,null))))):null},ce="[MASK]";class fill_mask_inference_FillMaskInference extends inference_base_InferenceBase{constructor(e,t,a){super(e,t,a),F()(this,"inferenceType",T.FILL_MASK),F()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.fillMask.label",{defaultMessage:"Fill mask"})),F()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.fillMask.info1",{defaultMessage:"Test how well the model predicts a missing word in a phrase."})]),this.initialize([this.inputText$.pipe(Object(D.map)((e=>e.every((e=>e.includes(ce))))))])}async inferText(){return this.runInfer((()=>this.getInferenceConfig(this.getNumTopClassesConfig())),((e,t)=>ae(e,this.model,t)))}async inferIndex(){return this.runPipelineSimulate((e=>({response:ie(e._source[this.inferenceType],this.model),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}getProcessors(){return this.getBasicProcessors(this.getNumTopClassesConfig())}predictedValue(e){var t;const{response:a,inputText:i}=e;return null!==(t=a[0])&&void 0!==t&&t.value?i.replace(ce,a[0].value):i}getInputComponent(){if(this.inputType===R.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.fillMask.inputText",{defaultMessage:"Enter a phrase to test. Use [MASK] as a placeholder for the missing words."});return B(this,e)}return null}getOutputComponent(){return this,Object(m.jsx)(le,{inferrer:this})}}const de={af:"Afrikaans",hr:"Croatian",pa:"Punjabi",am:"Amharic",ht:"Haitian",pl:"Polish",ar:"Arabic",hu:"Hungarian",ps:"Pashto",az:"Azerbaijani",hy:"Armenian",pt:"Portuguese",be:"Belarusian",id:"Indonesian",ro:"Romanian",bg:"Bulgarian",ig:"Igbo",ru:"Russian","bg-Latn":"Bulgarian",is:"Icelandic","ru-Latn":"Russian",bn:"Bengali",it:"Italian",sd:"Sindhi",bs:"Bosnian",iw:"Hebrew",si:"Sinhala",ca:"Catalan",ja:"Japanese",sk:"Slovak",ceb:"Cebuano","ja-Latn":"Japanese",sl:"Slovenian",co:"Corsican",jv:"Javanese",sm:"Samoan",cs:"Czech",ka:"Georgian",sn:"Shona",cy:"Welsh",kk:"Kazakh",so:"Somali",da:"Danish",km:"Central Khmer",sq:"Albanian",de:"German",kn:"Kannada",sr:"Serbian",el:"Greek,modern",ko:"Korean",st:"Southern Sotho","el-Latn":"Greek,modern",ku:"Kurdish",su:"Sundanese",en:"English",ky:"Kirghiz",sv:"Swedish",eo:"Esperanto",la:"Latin",sw:"Swahili",es:"Spanish,Castilian",lb:"Luxembourgish",ta:"Tamil",et:"Estonian",lo:"Lao",te:"Telugu",eu:"Basque",lt:"Lithuanian",tg:"Tajik",fa:"Persian",lv:"Latvian",th:"Thai",fi:"Finnish",mg:"Malagasy",tr:"Turkish",fil:"Filipino",mi:"Maori",uk:"Ukrainian",fr:"French",mk:"Macedonian",ur:"Urdu",fy:"Western Frisian",ml:"Malayalam",uz:"Uzbek",ga:"Irish",mn:"Mongolian",vi:"Vietnamese",gd:"Gaelic",mr:"Marathi",xh:"Xhosa",gl:"Galician",ms:"Malay",yi:"Yiddish",gu:"Gujarati",mt:"Maltese",yo:"Yoruba",ha:"Hausa",my:"Burmese",zh:"Chinese",haw:"Hawaiian",ne:"Nepali","zh-Latn":"Chinese",hi:"Hindi",nl:"Dutch,Flemish",zu:"Zulu","hi-Latn":"Hindi",no:"Norwegian",hmn:"Hmong",ny:"Chichewa",zxx:"unknown"},ue=({inferrer:e})=>{const t=P()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(m.jsx)(n.a.Fragment,null,t.map((({response:e,inputText:t})=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(pe,{response:e,inputText:t}),Object(m.jsx)(s.EuiHorizontalRule,null))))):null},pe=({response:e,inputText:t})=>{const a=e[0].value,i=null!==(r=de[a])&&void 0!==r?r:"unknown";var r;const l="unknown"!==i?o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.output.title",{defaultMessage:"This looks like {lang}",values:{lang:i}}):o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.output.titleUnknown",{defaultMessage:"Language code unknown: {langCode}",values:{langCode:a}});return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiText,{size:"s","data-test-subj":"mlTestModelLangIdentInputText"},t),Object(m.jsx)(s.EuiSpacer,{size:"s"}),Object(m.jsx)(s.EuiTitle,{size:"xxs"},Object(m.jsx)("h4",{"data-test-subj":"mlTestModelLangIdentTitle"},l)),Object(m.jsx)(s.EuiSpacer,null),Object(m.jsx)(oe,{response:e}))};class lang_ident_inference_LangIdentInference extends inference_base_InferenceBase{constructor(e,t,a){super(e,t,a),F()(this,"inferenceType","classification"),F()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.label",{defaultMessage:"Language identification"})),F()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.info1",{defaultMessage:"Test how well the model identifies the language of your text."})]),this.initialize()}async inferText(){try{return await this.runInfer((()=>this.getInferenceConfig(this.getNumTopClassesConfig())),((e,t)=>ae(e,this.model,t)))}catch(e){throw this.setFinishedWithErrors(e),e}}async inferIndex(){try{return await this.runPipelineSimulate((e=>({response:ie(e._source[this.inferenceType],this.model),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}catch(e){throw this.setFinishedWithErrors(e),e}}getProcessors(){return this.getBasicProcessors(this.getNumTopClassesConfig())}getInputComponent(){if(this.inputType===R.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.inputText",{defaultMessage:"Enter a phrase to test"});return B(this,e)}return null}getOutputComponent(){return this,Object(m.jsx)(ue,{inferrer:this})}}const me=({inferrer:e})=>{const t=P()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(m.jsx)(n.a.Fragment,null,t.map((({response:e,inputText:t})=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(be,{value:e.predictedValue.toString(),inputText:t}),Object(m.jsx)(s.EuiHorizontalRule,null))))):null},be=({value:e,inputText:t})=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiText,{size:"s"},t),Object(m.jsx)(s.EuiSpacer,{size:"s"}),Object(m.jsx)(s.EuiTextArea,{value:e,fullWidth:!0,style:{height:300}}),Object(m.jsx)(s.EuiCopy,{textToCopy:e},(e=>Object(m.jsx)(s.EuiButton,{size:"s",onClick:e},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.textEmbedding.copyButton",defaultMessage:"Copy to clipboard"})))));class text_embedding_inference_TextEmbeddingInference extends inference_base_InferenceBase{constructor(e,t,a){super(e,t,a),F()(this,"inferenceType",T.TEXT_EMBEDDING),F()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textEmbedding.label",{defaultMessage:"Text embedding"})),F()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textEmbedding.info1",{defaultMessage:"Test how well the model generates embeddings for your text."})]),this.initialize()}async inferText(){return this.runInfer((()=>{}),((e,t)=>function(e,t){return{response:{predictedValue:e.inference_results[0].predicted_value},rawResponse:e,inputText:t}}(e,t)))}async inferIndex(){return this.runPipelineSimulate((e=>{const t=e._source[this.getInputField()];return function(e,t){const a=e.predicted_value;return{response:{predictedValue:a},rawResponse:{inference_results:[{predicted_value:a}]},inputText:t}}(e._source[this.inferenceType],t)}))}getProcessors(){return this.getBasicProcessors()}getInputComponent(){if(this.inputType===R.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textEmbedding.inputText",{defaultMessage:"Enter a phrase to test"});return B(this,e)}return null}getOutputComponent(){return this,Object(m.jsx)(me,{inferrer:this})}}const fe=({errorText:e})=>null===e?null:Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiCallOut,{title:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.inferenceError",{defaultMessage:"An error occurred"}),color:"danger",iconType:"cross"},Object(m.jsx)("p",null,e)));var he=a(18);const ge=({text:e})=>{const t=e.split(/\r\n|\r|\n/).length+1,a=t>4&&t<=10?t:4;return Object(m.jsx)(s.EuiLoadingContent,{"data-test-subj":"mlTestModelLoadingContent",lines:a})};var je=a(143);const xe=({inferrer:e})=>{var t;const a=P()(e.getInferenceError$(),e.getInferenceError()),i=P()(e.getRunningState$(),e.getRunningState()),s=P()(e.getInferenceResult$(),e.getInferenceResult());if(i===L.FINISHED_WITH_ERRORS&&!a||i===L.FINISHED&&!s)return null;const o=[];if(s)for(const{rawResponse:e}of s)o.push(e);const r=i===L.FINISHED_WITH_ERRORS?JSON.stringify(null!==(t=null==a?void 0:a.body)&&void 0!==t?t:a,null,2):JSON.stringify(e.getInputType()===R.TEXT?o[0]:o,null,2);return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(je.a,{"data-test-subj":"mlTestModelRawOutput",value:null!=r?r:"",readOnly:!0}))};var ve;!function(e){e[e.TEXT=0]="TEXT",e[e.RAW=1]="RAW"}(ve||(ve={}));const ye=({inferrer:e})=>{const[t,a]=Object(i.useState)(ve.TEXT),[o,l]=Object(i.useState)(null),c=P()(e.getIsValid$(),e.getIsValid()),d=P()(e.getRunningState$(),e.getRunningState()),u=Object(i.useMemo)((()=>e.getInputComponent()),[e]),p=Object(i.useMemo)((()=>e.getOutputComponent()),[e]),b=Object(i.useMemo)((()=>e.getInfoComponent()),[e]),f=Object(i.useCallback)((async t=>{t.preventDefault(),l(null);try{await e.infer()}catch(e){l(Object(he.extractErrorMessage)(e))}}),[e]);return Object(m.jsx)(s.EuiForm,{component:"form",onSubmit:f},Object(m.jsx)(n.a.Fragment,null,b),Object(m.jsx)(n.a.Fragment,null,u),Object(m.jsx)(s.EuiSpacer,{size:"m"}),Object(m.jsx)("div",null,Object(m.jsx)(s.EuiButton,{disabled:d===L.RUNNING||!1===c,fullWidth:!1,"data-test-subj":"mlTestModelTestButton",type:"submit"},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.runButton",defaultMessage:"Test"}))),d!==L.STOPPED?Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiSpacer,{size:"m"}),Object(m.jsx)(s.EuiTabs,{size:"s"},Object(m.jsx)(s.EuiTab,{isSelected:t===ve.TEXT,onClick:a.bind(null,ve.TEXT)},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.markupTab",defaultMessage:"Output"})),Object(m.jsx)(s.EuiTab,{isSelected:t===ve.RAW,onClick:a.bind(null,ve.RAW)},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.rawOutput",defaultMessage:"Raw output"}))),Object(m.jsx)(s.EuiSpacer,{size:"m"}),t===ve.TEXT?Object(m.jsx)(n.a.Fragment,null,d===L.RUNNING?Object(m.jsx)(ge,{text:""}):null,null!==o||d===L.FINISHED_WITH_ERRORS?Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(fe,{errorText:o}),Object(m.jsx)(s.EuiSpacer,null)):null,d===L.FINISHED?Object(m.jsx)("div",{"data-test-subj":"mlTestModelOutput"},p):null):Object(m.jsx)(xe,{inferrer:e})):null)},Oe=({inferrer:e,data:t})=>{const{dataViewListItems:a,fieldNames:r,selectedDataViewId:l,setSelectedDataViewId:c,selectedField:d,setSelectedField:u}=t,p=P()(e.getRunningState$(),e.getRunningState()),b=P()(e.getPipeline$(),e.getPipeline()),f=Object(i.useMemo)((()=>e.getInputComponent()),[e]);return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiFormRow,{label:"Index",fullWidth:!0},Object(m.jsx)(s.EuiSelect,{options:a,value:l,onChange:e=>c(e.target.value),hasNoInitialSelection:!0,disabled:p===L.RUNNING,fullWidth:!0})),Object(m.jsx)(s.EuiSpacer,{size:"m"}),Object(m.jsx)(s.EuiFormRow,{label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.indexInput.fieldInput",{defaultMessage:"Field"}),fullWidth:!0},Object(m.jsx)(s.EuiSelect,{options:r,value:d,onChange:e=>u(e.target.value),hasNoInitialSelection:!0,disabled:p===L.RUNNING,fullWidth:!0})),Object(m.jsx)(n.a.Fragment,null,f),Object(m.jsx)(s.EuiSpacer,{size:"m"}),Object(m.jsx)(s.EuiAccordion,{id:"simpleAccordionId",buttonContent:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.indexInput.viewPipeline",{defaultMessage:"View pipeline"})},Object(m.jsx)(s.EuiCodeBlock,{language:"json",fontSize:"s",paddingSize:"s",lineNumbers:!0,isCopyable:!0},JSON.stringify(b,null,2))))},Ee=({inferrer:e})=>{const t=function({inferrer:e}){const{services:{data:{dataViews:t,search:{search:a}}}}=Object(O.b)(),[n,s]=Object(i.useState)([]),[o,r]=Object(i.useState)(void 0),[l,d]=Object(i.useState)(null),[u,p]=Object(i.useState)([]),m=P()(e.getInputField$(),e.getInputField()),b=Object(i.useCallback)((t=>e.setInputField(t)),[e]);Object(i.useEffect)((function(){t.getIdsWithTitle().then((e=>{s(e.sort(((e,t)=>e.title.localeCompare(t.title))).map((({id:e,title:t})=>({text:t,value:e}))))}))}),[t]),Object(i.useEffect)((function(){e.reset(),p([]),void 0!==o&&t.get(o).then((e=>d(e)))}),[o,t,e]);const f=Object(i.useCallback)((()=>{e.setInputText([]),void 0!==m&&null!==l&&Object(I.firstValueFrom)(a({params:{index:l.getIndexPattern(),body:{fields:[m],query:{function_score:{functions:[{random_score:{}}]}}}}})).then((t=>{const a=t.rawResponse.hits.hits.filter((({fields:e})=>Object(c.isPopulatedObject)(e,[m]))).map((({fields:e})=>e[m][0]));e.setInputText(a)}))}),[e,l,a,m]);return Object(i.useEffect)((function(){if(null!==l){const t=l.fields.filter((({displayName:e,esTypes:t})=>t&&t.includes("text")&&!["_id","_index"].includes(e))).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).map((({displayName:e})=>({value:e,text:e})));p(t);const a=1===t.length?t[0].value:void 0;e.setInputField(a)}}),[l,e]),Object(i.useEffect)((function(){f()}),[m]),{fieldNames:u,dataViewListItems:n,reloadExamples:function(){e.reset(),f()},selectedDataViewId:o,setSelectedDataViewId:r,selectedField:m,setSelectedField:b}}({inferrer:e}),{reloadExamples:a,selectedField:o}=t,[l,d]=Object(i.useState)(null),u=P()(e.getRunningState$(),e.getRunningState()),p=P()(e.getInputText$(),e.getInputText()),b=P()(e.getIsValid$(),e.getIsValid()),f=Object(i.useMemo)((()=>e.getOutputComponent()),[e]),h=Object(i.useMemo)((()=>e.getInfoComponent()),[e]),g=Object(i.useCallback)((async t=>{t.preventDefault(),d(null);try{await e.infer()}catch(e){d(Object(he.extractErrorMessage)(e))}}),[e]);return Object(m.jsx)(s.EuiForm,{component:"form",onSubmit:g},Object(m.jsx)(n.a.Fragment,null,h),Object(m.jsx)(Oe,{inferrer:e,data:t}),Object(m.jsx)(s.EuiSpacer,{size:"m"}),Object(m.jsx)(s.EuiFlexGroup,null,Object(m.jsx)(s.EuiFlexItem,{grow:!1},Object(m.jsx)(s.EuiButton,{disabled:u===L.RUNNING||!1===b,fullWidth:!1,"data-test-subj":"mlTestModelTestButton",type:"submit"},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.runButton",defaultMessage:"Test"}))),Object(m.jsx)(s.EuiFlexItem,{grow:!1},u===L.RUNNING?Object(m.jsx)(s.EuiLoadingSpinner,{size:"xl"}):null),Object(m.jsx)(s.EuiFlexItem,null),Object(m.jsx)(s.EuiFlexItem,{grow:!1},Object(m.jsx)(s.EuiButtonEmpty,{onClick:a,disabled:u===L.RUNNING||void 0===o},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.reloadButton",defaultMessage:"Reload examples"})))),Object(m.jsx)(s.EuiSpacer,{size:"m"}),null!==l||u===L.FINISHED_WITH_ERRORS?Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(fe,{errorText:l}),Object(m.jsx)(s.EuiSpacer,null)):null,u!==L.FINISHED?p.map((e=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiText,{size:"s"},e),Object(m.jsx)(s.EuiHorizontalRule,null)))):null,u===L.FINISHED?Object(m.jsx)(n.a.Fragment,null,f):null)},we=({inferrer:e,inputType:t})=>t===R.TEXT?Object(m.jsx)(ye,{inferrer:e}):Object(m.jsx)(Ee,{inferrer:e}),Me=({model:e,inputType:t})=>{const{trainedModels:a}=Object(O.a)(),n=Object(i.useMemo)((()=>{if(e.model_type===S)switch(Object.keys(e.inference_config)[0]){case T.NER:return new ner_inference_NerInference(a,e,t);case T.TEXT_CLASSIFICATION:return new text_classification_inference_TextClassificationInference(a,e,t);case T.ZERO_SHOT_CLASSIFICATION:return new zero_shot_classification_inference_ZeroShotClassificationInference(a,e,t);case T.TEXT_EMBEDDING:return new text_embedding_inference_TextEmbeddingInference(a,e,t);case T.FILL_MASK:return new fill_mask_inference_FillMaskInference(a,e,t);case T.QUESTION_ANSWERING:return new question_answering_inference_QuestionAnsweringInference(a,e,t)}else if(e.model_type===_)return new lang_ident_inference_LangIdentInference(a,e,t)}),[t,e,a]);return Object(i.useEffect)((()=>()=>{null==n||n.destroy()}),[n]),void 0!==n?Object(m.jsx)(we,{inferrer:n,inputType:t}):null},Se=({modelId:e,onClose:t})=>{const a=Object(s.useEuiPaddingSize)("m"),o=Object(u.b)(),[l,c]=Object(i.useState)(R.TEXT),[d,p]=Object(i.useState)(null);return Object(i.useEffect)((function(){o.getTrainedModels(e).then((e=>{e.length&&p(e[0])}))}),[e,o]),null===d?null:Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiFlyout,{maxWidth:600,onClose:t,"data-test-subj":"mlTestModelsFlyout"},Object(m.jsx)(s.EuiFlyoutHeader,{hasBorder:!0},Object(m.jsx)(s.EuiTitle,{size:"m"},Object(m.jsx)("h2",null,Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.headerLabel",defaultMessage:"Test trained model"}))),Object(m.jsx)(s.EuiSpacer,{size:"s"}),Object(m.jsx)(s.EuiTitle,{size:"xs"},Object(m.jsx)("h4",null,d.model_id))),Object(m.jsx)(s.EuiFlyoutBody,null,Object(m.jsx)(s.EuiTabs,{size:"m",css:Object(m.css)({marginTop:`-${a}`},"","")},Object(m.jsx)(s.EuiTab,{isSelected:l===R.TEXT,onClick:()=>c(R.TEXT)},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.textTab",defaultMessage:"Test using text"})),Object(m.jsx)(s.EuiTab,{isSelected:l===R.INDEX,onClick:()=>c(R.INDEX)},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.indexTab",defaultMessage:"Test using existing index"}))),Object(m.jsx)(s.EuiSpacer,{size:"m"}),Object(m.jsx)(Me,{model:d,inputType:l}))))},_e=Object.values(T);function Te(e,t=!1){var a,i;return!(e.model_type!==S||!_e.includes(Object.keys(e.inference_config)[0])||!1!==t&&(null===(a=e.stats)||void 0===a||null===(i=a.deployment_stats)||void 0===i?void 0:i.state)!==M)||e.model_type===_}var Ce=a(168),ke=a(215);const Fe=({modelIds:e,onClose:t})=>{const a=Object(u.b)(),{displayErrorToast:n,displaySuccessToast:l}=Object(f.c)(),[c,d]=Object(i.useState)(!1),p=Object(i.useCallback)((async()=>{try{await Promise.all(e.map((e=>a.deleteTrainedModel(e)))),l(o.i18n.translate("xpack.ml.trainedModels.modelsList.successfullyDeletedMessage",{defaultMessage:"{modelsCount, plural, one {Model {modelIds}} other {# models}} {modelsCount, plural, one {has} other {have}} been successfully deleted",values:{modelsCount:e.length,modelIds:e.join(", ")}}))}catch(t){n(t,o.i18n.translate("xpack.ml.trainedModels.modelsList.fetchDeletionErrorMessage",{defaultMessage:"{modelsCount, plural, one {Model} other {Models}} deletion failed",values:{modelsCount:e.length}}))}t(!0)}),[e,a]);return c?Object(m.jsx)(s.EuiModal,{onClose:t.bind(null,!1),initialFocus:"[name=cancelModelDeletion]","data-test-subj":"mlModelsDeleteModal"},Object(m.jsx)(s.EuiModalHeader,null,Object(m.jsx)(s.EuiModalHeaderTitle,null,Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.header",defaultMessage:"Delete {modelsCount, plural, one {{modelId}} other {# models}}?",values:{modelId:e[0],modelsCount:e.length}}))),Object(m.jsx)(s.EuiModalFooter,null,Object(m.jsx)(s.EuiButtonEmpty,{onClick:t.bind(null,!1),name:"cancelModelDeletion"},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(m.jsx)(s.EuiButton,{onClick:p.bind(null),fill:!0,color:"danger","data-test-subj":"mlModelsDeleteModalConfirmButton"},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.deleteButtonLabel",defaultMessage:"Delete"})))):Object(m.jsx)(ke.a,{ids:e,mlSavedObjectType:"trained-model",canDeleteCallback:d.bind(null,!0),onCloseCallback:t.bind(null,!0),refreshJobsCallback:()=>{},hasManagedJob:!1})};var Ie=a(96),De=a(341),Ae=a(198),Le=a(126),Re=a(141),Ne=a(159);const Pe=({pageState:e,updatePageState:t})=>{var a;const{services:{application:{capabilities:h}}}=Object(O.b)();Object(O.g)({timeRangeSelector:!1,autoRefreshSelector:!0});const g=Object(Le.a)(l.FIELD_FORMAT_IDS.DATE),[j,x]=Object(Ie.b)(w.b.TRAINED_MODELS_MANAGE,{pageIndex:0,pageSize:10,sortField:Ve.id,sortDirection:"asc"}),[v,_]=e&&t?[e,t]:[j,x],T=Object(Re.a)(),k=null!==(a=v.queryText)&&void 0!==a?a:"",F=h.ml.canDeleteTrainedModels,I=Object(u.b)(),{displayErrorToast:D}=Object(f.c)(),[A,L]=Object(i.useState)(!1),[R,N]=Object(i.useState)([]),[P,z]=Object(i.useState)([]),[B,V]=Object(i.useState)([]),[J,U]=Object(i.useState)({}),[G,q]=Object(i.useState)(null),$=Object(i.useCallback)((e=>e.tags.includes(d.b)),[]),W=Object(i.useCallback)((async()=>{L(!0);try{const e=await I.getTrainedModels(void 0,{with_pipelines:!0,size:1e3}),t=[],a=[];for(const i of e){const e={...i,..."object"==typeof i.inference_config?{type:[i.model_type,...Object.keys(i.inference_config),...$(i)?[C]:[]]}:{}};t.push(e),J[i.model_id]&&a.push(e)}await Y(t),N(t),a.length>0&&(await Y(a),U(a.reduce(((e,t)=>(e[t.model_id]=Object(m.jsx)(De.a,{item:t}),e)),{})))}catch(e){D(e,o.i18n.translate("xpack.ml.trainedModels.modelsList.fetchFailedErrorMessage",{defaultMessage:"Models fetch failed"}))}L(!1)}),[J]);Object(i.useEffect)((function(){T&&W()}),[T]);const H=Object(i.useMemo)((()=>({total:{show:!0,value:R.length,label:o.i18n.translate("xpack.ml.trainedModels.modelsList.totalAmountLabel",{defaultMessage:"Total trained models"})}})),[R]),Y=Object(i.useCallback)((async e=>{try{if(e){const{trained_model_stats:a}=await I.getTrainedModelStats(e.map((e=>e.model_id)));for(const{model_id:i,...n}of a){const a=e.find((e=>e.model_id===i));var t;a&&(a.stats={...null!==(t=a.stats)&&void 0!==t?t:{},...n})}}return!0}catch(e){return D(e,o.i18n.translate("xpack.ml.trainedModels.modelsList.fetchModelStatsErrorMessage",{defaultMessage:"Fetch model stats failed"})),!1}}),[]),X=Object(i.useMemo)((()=>[...R.reduce(((e,t)=>{const a=t.inference_config&&Object.keys(t.inference_config)[0];return a&&e.add(a),e.add(t.model_type),e}),new Set)].sort(((e,t)=>e.localeCompare(t))).map((e=>({value:e,name:e})))),[R]),Q=function({onTestAction:e,onModelsDeleteRequest:t,onLoading:a,isLoading:r,fetchModels:l}){const{services:{application:{navigateToUrl:h,capabilities:g},overlays:j,theme:x,docLinks:v}}=Object(O.b)(),_=v.links.ml.startTrainedModelsDeployment,T=Object(O.e)(),{displayErrorToast:C,displaySuccessToast:k}=Object(f.c)(),F=Object(O.d)(),I=Object(u.b)(),D=g.ml.canStartStopTrainedModels,A=g.ml.canTestTrainedModels,L=g.ml.canDeleteTrainedModels,R=Object(i.useMemo)((()=>((e,t)=>async a=>new Promise((async(i,n)=>{try{const n=e.openModal(Object(p.toMountPoint)(Object(p.wrapWithTheme)(Object(m.jsx)(b,{model:a,onCancel:()=>{n.close(),i(!1)},onConfirm:()=>{n.close(),i(!0)}}),t.theme$)))}catch(e){i(!1)}})))(j,x)),[j,x]),N=Object(i.useMemo)((()=>((e,t,a)=>(i,n)=>new Promise((async s=>{try{const o=e.openModal(Object(p.toMountPoint)(Object(p.wrapWithTheme)(Object(m.jsx)(y,{startModelDeploymentDocUrl:a,initialParams:n,modelId:i,onConfigChange:e=>{o.close();const t={...e};"low"===t.priority&&(t.numOfAllocations=1,t.threadsPerAllocations=1),s(t)},onClose:()=>{o.close(),s()}}),t)))}catch(e){s()}})))(j,x.theme$,_)),[j,x.theme$,_]),P=Object(i.useCallback)((e=>e.tags.includes(d.b)),[]);return Object(i.useMemo)((()=>[{name:o.i18n.translate("xpack.ml.trainedModels.modelsList.viewTrainingDataActionLabel",{defaultMessage:"View training data"}),description:o.i18n.translate("xpack.ml.trainedModels.modelsList.viewTrainingDataActionLabel",{defaultMessage:"View training data"}),icon:"visTable",type:"icon",available:e=>{var t,a;return!(null===(t=e.metadata)||void 0===t||null===(a=t.analytics_config)||void 0===a||!a.id)},onClick:async e=>{var t,a,i,n;if(void 0===(null===(t=e.metadata)||void 0===t?void 0:t.analytics_config))return;const s=Object(E.a)(null===(a=e.metadata)||void 0===a?void 0:a.analytics_config.analysis),o=await F.getUrl({page:w.b.DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:null===(i=e.metadata)||void 0===i?void 0:i.analytics_config.id,analysisType:s,..."classification"===s||"regression"===s?{queryText:`${null===(n=e.metadata)||void 0===n?void 0:n.analytics_config.dest.results_field}.is_training : true`}:{}}});await h(o)},isPrimary:!0},{name:o.i18n.translate("xpack.ml.inference.modelsList.analyticsMapActionLabel",{defaultMessage:"Analytics map"}),description:o.i18n.translate("xpack.ml.inference.modelsList.analyticsMapActionLabel",{defaultMessage:"Analytics map"}),icon:"graphApp",type:"icon",isPrimary:!0,available:e=>{var t,a;return!(null===(t=e.metadata)||void 0===t||null===(a=t.analytics_config)||void 0===a||!a.id)},onClick:async e=>{const t=await F.getUrl({page:w.b.DATA_FRAME_ANALYTICS_MAP,pageState:{modelId:e.model_id}});await T(t,!1)}},{name:o.i18n.translate("xpack.ml.inference.modelsList.startModelDeploymentActionLabel",{defaultMessage:"Start deployment"}),description:o.i18n.translate("xpack.ml.inference.modelsList.startModelDeploymentActionLabel",{defaultMessage:"Start deployment"}),"data-test-subj":"mlModelsTableRowStartDeploymentAction",icon:"play",type:"icon",isPrimary:!0,enabled:e=>{var t,a;const{state:i}=null!==(t=null===(a=e.stats)||void 0===a?void 0:a.deployment_stats)&&void 0!==t?t:{};return D&&!r&&i!==M&&"starting"!==i},available:e=>e.model_type===S,onClick:async e=>{const t=await N(e.model_id);if(t)try{a(!0),await I.startModelAllocation(e.model_id,{number_of_allocations:t.numOfAllocations,threads_per_allocation:t.threadsPerAllocations,priority:t.priority}),k(o.i18n.translate("xpack.ml.trainedModels.modelsList.startSuccess",{defaultMessage:'Deployment for "{modelId}" has been started successfully.',values:{modelId:e.model_id}})),await l()}catch(t){C(t,o.i18n.translate("xpack.ml.trainedModels.modelsList.startFailed",{defaultMessage:'Failed to start "{modelId}"',values:{modelId:e.model_id}})),a(!1)}}},{name:o.i18n.translate("xpack.ml.inference.modelsList.updateModelDeploymentActionLabel",{defaultMessage:"Update deployment"}),description:o.i18n.translate("xpack.ml.inference.modelsList.updateModelDeploymentActionLabel",{defaultMessage:"Update deployment"}),"data-test-subj":"mlModelsTableRowUpdateDeploymentAction",icon:"documentEdit",type:"icon",isPrimary:!1,available:e=>{var t,a;return e.model_type===S&&D&&!r&&(null===(t=e.stats)||void 0===t||null===(a=t.deployment_stats)||void 0===a?void 0:a.state)===M},onClick:async e=>{var t,i;const n=await N(e.model_id,{numOfAllocations:null===(t=e.stats)||void 0===t||null===(i=t.deployment_stats)||void 0===i?void 0:i.number_of_allocations});if(n)try{a(!0),await I.updateModelDeployment(e.model_id,{number_of_allocations:n.numOfAllocations}),k(o.i18n.translate("xpack.ml.trainedModels.modelsList.updateSuccess",{defaultMessage:'Deployment for "{modelId}" has been updated successfully.',values:{modelId:e.model_id}})),await l()}catch(t){C(t,o.i18n.translate("xpack.ml.trainedModels.modelsList.updateFailed",{defaultMessage:'Failed to update "{modelId}"',values:{modelId:e.model_id}})),a(!1)}}},{name:o.i18n.translate("xpack.ml.inference.modelsList.stopModelDeploymentActionLabel",{defaultMessage:"Stop deployment"}),description:o.i18n.translate("xpack.ml.inference.modelsList.stopModelDeploymentActionLabel",{defaultMessage:"Stop deployment"}),"data-test-subj":"mlModelsTableRowStopDeploymentAction",icon:"stop",type:"icon",isPrimary:!0,available:e=>e.model_type===S,enabled:e=>{var t,a,i;return D&&!r&&Object(c.isPopulatedObject)(null===(t=e.stats)||void 0===t?void 0:t.deployment_stats)&&"stopping"!==(null===(a=e.stats)||void 0===a||null===(i=a.deployment_stats)||void 0===i?void 0:i.state)},onClick:async e=>{const t=Object(c.isPopulatedObject)(e.pipelines);if((!t||await R(e))&&(!t||await R(e)))try{a(!0),await I.stopModelAllocation(e.model_id,{force:t}),k(o.i18n.translate("xpack.ml.trainedModels.modelsList.stopSuccess",{defaultMessage:'Deployment for "{modelId}" has been stopped successfully.',values:{modelId:e.model_id}})),await l()}catch(t){C(t,o.i18n.translate("xpack.ml.trainedModels.modelsList.stopFailed",{defaultMessage:'Failed to stop "{modelId}"',values:{modelId:e.model_id}})),a(!1)}}},{name:e=>{const t=!Object(c.isPopulatedObject)(e.pipelines);return Object(m.jsx)(s.EuiToolTip,{position:"left",content:t?null:o.i18n.translate("xpack.ml.trainedModels.modelsList.deleteDisabledTooltip",{defaultMessage:"Model has associated pipelines"})},Object(m.jsx)(n.a.Fragment,null,o.i18n.translate("xpack.ml.trainedModels.modelsList.deleteModelActionLabel",{defaultMessage:"Delete model"})))},description:o.i18n.translate("xpack.ml.trainedModels.modelsList.deleteModelActionLabel",{defaultMessage:"Delete model"}),"data-test-subj":"mlModelsTableRowDeleteAction",icon:"trash",type:"icon",color:"danger",isPrimary:!1,onClick:e=>{t([e.model_id])},available:e=>L&&!P(e),enabled:e=>!Object(c.isPopulatedObject)(e.pipelines)},{name:o.i18n.translate("xpack.ml.inference.modelsList.testModelActionLabel",{defaultMessage:"Test model"}),description:o.i18n.translate("xpack.ml.inference.modelsList.testModelActionLabel",{defaultMessage:"Test model"}),"data-test-subj":"mlModelsTableRowTestAction",icon:"inputOutput",type:"icon",isPrimary:!0,available:Te,onClick:t=>e(t.model_id),enabled:e=>A&&Te(e,!0)}]),[L,D,A,C,k,R,N,P,T,h,e,I,F,t,a,l,r])}({isLoading:A,fetchModels:W,onTestAction:q,onModelsDeleteRequest:V,onLoading:L}),K=async e=>{const t={...J};t[e.model_id]?delete t[e.model_id]:(await Y([e]),t[e.model_id]=Object(m.jsx)(De.a,{item:e})),U(t)},Z=[{align:"left",width:"40px",isExpander:!0,render:e=>Object(m.jsx)(s.EuiButtonIcon,{onClick:K.bind(null,e),"aria-label":J[e.model_id]?o.i18n.translate("xpack.ml.trainedModels.modelsList.collapseRow",{defaultMessage:"Collapse"}):o.i18n.translate("xpack.ml.trainedModels.modelsList.expandRow",{defaultMessage:"Expand"}),iconType:J[e.model_id]?"arrowDown":"arrowRight"}),"data-test-subj":"mlModelsTableRowDetailsToggle"},{field:Ve.id,name:o.i18n.translate("xpack.ml.trainedModels.modelsList.modelIdHeader",{defaultMessage:"ID"}),sortable:!0,truncateText:!1,"data-test-subj":"mlModelsTableColumnId"},{field:Ve.description,width:"350px",name:o.i18n.translate("xpack.ml.trainedModels.modelsList.modelDescriptionHeader",{defaultMessage:"Description"}),sortable:!1,truncateText:!1,"data-test-subj":"mlModelsTableColumnDescription"},{field:Ve.type,name:o.i18n.translate("xpack.ml.trainedModels.modelsList.typeHeader",{defaultMessage:"Type"}),sortable:!0,truncateText:!0,align:"left",render:e=>Object(m.jsx)(s.EuiFlexGroup,{gutterSize:"xs",wrap:!0},e.map((e=>Object(m.jsx)(s.EuiFlexItem,{key:e,grow:!1},Object(m.jsx)(s.EuiBadge,{color:"hollow","data-test-subj":"mlModelType"},e))))),"data-test-subj":"mlModelsTableColumnType"},{name:o.i18n.translate("xpack.ml.trainedModels.modelsList.stateHeader",{defaultMessage:"State"}),sortable:e=>{var t,a;return null===(t=e.stats)||void 0===t||null===(a=t.deployment_stats)||void 0===a?void 0:a.state},align:"left",truncateText:!0,render:e=>{var t,a;const i=null===(t=e.stats)||void 0===t||null===(a=t.deployment_stats)||void 0===a?void 0:a.state;return i?Object(m.jsx)(s.EuiBadge,{color:"hollow"},i):null},"data-test-subj":"mlModelsTableColumnDeploymentState"},{field:Ve.createdAt,name:o.i18n.translate("xpack.ml.trainedModels.modelsList.createdAtHeader",{defaultMessage:"Created at"}),dataType:"date",render:e=>g(e),sortable:!0,"data-test-subj":"mlModelsTableColumnCreatedAt"},{name:o.i18n.translate("xpack.ml.trainedModels.modelsList.actionsHeader",{defaultMessage:"Actions"}),actions:Q,"data-test-subj":"mlModelsTableColumnActions"}],ee=X&&X.length>0?[{type:"field_value_selection",field:"type",name:o.i18n.translate("xpack.ml.dataframe.analyticsList.typeFilter",{defaultMessage:"Type"}),multiSelect:"or",options:X}]:[],te=Object(m.jsx)(s.EuiFlexItem,{grow:!1},Object(m.jsx)(s.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},Object(m.jsx)(s.EuiFlexItem,{grow:!1},Object(m.jsx)(s.EuiTitle,{size:"s"},Object(m.jsx)("h5",null,Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.selectedModelsMessage",defaultMessage:"{modelsCount, plural, one{# model} other {# models}} selected",values:{modelsCount:P.length}})))),Object(m.jsx)(s.EuiFlexItem,null,Object(m.jsx)(s.EuiButton,{color:"danger",onClick:V.bind(null,P.map((e=>e.model_id)))},Object(m.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModelsButtonLabel",defaultMessage:"Delete"}))))),ae=F?{selectableMessage:(e,t)=>e?o.i18n.translate("xpack.ml.trainedModels.modelsList.selectableMessage",{defaultMessage:"Select a model"}):Object(c.isPopulatedObject)(t.pipelines)?o.i18n.translate("xpack.ml.trainedModels.modelsList.disableSelectableMessage",{defaultMessage:"Model has associated pipelines"}):$(t)?o.i18n.translate("xpack.ml.trainedModels.modelsList.builtInModelMessage",{defaultMessage:"Built-in model"}):"",selectable:e=>!Object(c.isPopulatedObject)(e.pipelines)&&!$(e),onSelectionChange:e=>{z(e)}}:void 0,{onTableChange:ie,pagination:ne,sorting:se}=Object(Ae.a)(R.length,v,_),oe={query:k,onChange:e=>null===e.error&&(_({queryText:e.queryText,pageIndex:0}),!0),box:{incremental:!0},...X&&X.length>0?{filters:ee}:{},...P.length>0?{toolsLeft:te}:{}};return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(Ne.a,{onCloseFlyout:W,forceRefresh:A}),Object(m.jsx)(s.EuiFlexGroup,{justifyContent:"spaceBetween"},H&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(s.EuiFlexItem,{grow:!1},Object(m.jsx)(Ce.a,{stats:H,dataTestSub:"mlInferenceModelsStatsBar"})))),Object(m.jsx)(s.EuiSpacer,{size:"m"}),Object(m.jsx)("div",{"data-test-subj":"mlModelsTableContainer"},Object(m.jsx)(s.EuiInMemoryTable,{allowNeutralSort:!1,columns:Z,hasActions:!0,isExpandable:!0,itemIdToExpandedRowMap:J,isSelectable:!1,items:R,itemId:Ve.id,loading:A,search:oe,selection:ae,rowProps:e=>({"data-test-subj":`mlModelsTableRow row-${e.model_id}`}),pagination:ne,onTableChange:ie,sorting:se,"data-test-subj":A?"mlModelsTable loading":"mlModelsTable loaded"})),B.length>0&&Object(m.jsx)(Fe,{onClose:e=>{V([]),e&&W()},modelIds:B}),null===G?null:Object(m.jsx)(Se,{modelId:G,onClose:q.bind(null,null)}))};var ze={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const Be=({id:e})=>{const t=Object(O.c)({page:w.b.TRAINED_MODELS_MANAGE,pageState:{modelId:e}});return Object(m.jsx)(s.EuiLink,{href:t,css:ze,title:e},e)},Ve={id:"model_id",description:"description",createdAt:"create_time",type:"type",modelType:"model_type"}},,,function(e,t,a){"use strict";a.d(t,"a",(function(){return h})),a.d(t,"b",(function(){return g}));var i=a(17),n=a.n(i),s=a(23),o=a(25),r=a(24),l=a.n(r),c=a(6),d=a(80),u=a(158),p=a(152),m=a(13);const b={info:0,error:0,warning:0},f=n.a.createContext({notificationsCounts:b,lastCheckedAt:null,latestRequestedAt:null,setLastCheckedAt:()=>{}}),h=({children:e})=>{const{services:{mlServices:{mlApiServices:t},application:{capabilities:a}}}=Object(d.b)(),n=a.ml.canGetJobs,r=a.ml.canGetDataFrameAnalytics,h=a.ml.canGetTrainedModels,g=n&&r&&h,[j,x]=Object(u.b)(p.f),v=function(e){const t=Object(i.useMemo)((()=>new s.BehaviorSubject(e)),[]);return Object(i.useEffect)((function(){t.next(e)}),[t,e]),Object(i.useMemo)((()=>t.asObservable()),[t])}(j),[y,O]=Object(i.useState)(null),[E,w]=Object(i.useState)(b);return Object(i.useEffect)((function(){if(!g)return;const e=Object(s.combineLatest)([v,Object(s.timer)(0,6e4)]).pipe(Object(o.map)((([e])=>null!=e?e:l()().subtract(7,"d").valueOf())),Object(o.tap)((e=>{O(e)})),Object(o.switchMap)((e=>t.notifications.countMessages$({lastCheckedAt:e}))),Object(o.retry)({delay:6e4})).subscribe((e=>{w(Object(c.isPopulatedObject)(e)?e:b)}));return()=>{e.unsubscribe()}}),[g,v,t.notifications]),Object(m.jsx)(f.Provider,{value:{notificationsCounts:E,lastCheckedAt:j,setLastCheckedAt:x,latestRequestedAt:y}},e)};function g(){return Object(i.useContext)(f)}},function(e,t,a){"use strict";a.r(t),a.d(t,"getDefaultSwimlanePanelTitle",(function(){return j})),a.d(t,"AnomalySwimlaneEmbeddable",(function(){return anomaly_swimlane_embeddable_AnomalySwimlaneEmbeddable}));var i=a(5),n=a.n(i),s=a(17),o=a.n(s),r=a(55),l=a.n(r),c=a(2),d=a(23),u=a(46),p=a(53);const m=o.a.lazy((()=>a.e(15).then(a.bind(null,650))));var b=a(180),f=a(109),h=a(165),g=a(13);const j=e=>c.i18n.translate("xpack.ml.swimlaneEmbeddable.title",{defaultMessage:"ML anomaly swim lane for {jobIds}",values:{jobIds:e.join(", ")}});class anomaly_swimlane_embeddable_AnomalySwimlaneEmbeddable extends p.Embeddable{constructor(e,t,a){super(e,{defaultTitle:e.title},a),n()(this,"node",void 0),n()(this,"reload$",new d.Subject),n()(this,"type",f.b),this.services=t}reportsEmbeddableLoad(){return!0}onLoading(){this.renderComplete.dispatchInProgress(),this.updateOutput({loading:!0,error:void 0})}onError(e){this.renderComplete.dispatchError(),this.updateOutput({loading:!1,error:{name:e.name,message:e.message}})}onRenderComplete(){this.renderComplete.dispatchComplete(),this.updateOutput({loading:!1,error:void 0})}render(e){super.render(e),this.node=e,this.node.setAttribute("data-shared-item","");const t=this.services[0].i18n.Context,a=this.services[0].theme.theme$;l.a.render(Object(g.jsx)(t,null,Object(g.jsx)(u.KibanaThemeProvider,{theme$:a},Object(g.jsx)(u.KibanaContextProvider,{services:{...this.services[0]}},Object(g.jsx)(s.Suspense,{fallback:Object(g.jsx)(h.a,null)},Object(g.jsx)(m,{id:this.input.id,embeddableContext:this,embeddableInput$:this.getInput$(),services:this.services,refresh:this.reload$.asObservable(),onInputChange:this.updateInput.bind(this),onOutputChange:this.updateOutput.bind(this),onRenderComplete:this.onRenderComplete.bind(this),onLoading:this.onLoading.bind(this),onError:this.onError.bind(this)}))))),e)}destroy(){super.destroy(),this.node&&l.a.unmountComponentAtNode(this.node)}reload(){this.reload$.next()}supportedTriggers(){return[b.a]}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var i=a(17),n=a.n(i),s=a(2),o=a(44),r=a(18),l=a(13);const c=n.a.memo((({value:e,onChange:t})=>{const a=[{min:r.ANOMALY_THRESHOLD.LOW,max:r.ANOMALY_THRESHOLD.MINOR,color:"#8BC8FB"},{min:r.ANOMALY_THRESHOLD.MINOR,max:r.ANOMALY_THRESHOLD.MAJOR,color:"#FDEC25"},{min:r.ANOMALY_THRESHOLD.MAJOR,max:r.ANOMALY_THRESHOLD.CRITICAL,color:"#FBA740"},{min:r.ANOMALY_THRESHOLD.CRITICAL,max:100,color:"#FE5050"}],i=s.i18n.translate("xpack.ml.severitySelector.formControlLabel",{defaultMessage:"Severity"}),n=null!=e?e:r.ANOMALY_THRESHOLD.LOW,c=e=>{t(Number(e.target.value))},d=new Array(5).fill(null).map(((e,t)=>{const a=25*t;return{value:a,label:a}}));return Object(l.jsx)(o.EuiFormRow,{fullWidth:!0},Object(l.jsx)(o.EuiFlexGroup,{gutterSize:"s"},Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiFieldNumber,{id:"severityControl",style:{width:"70px"},compressed:!0,prepend:i,value:n,onChange:c,min:r.ANOMALY_THRESHOLD.LOW,max:100})),Object(l.jsx)(o.EuiFlexItem,{grow:!0},Object(l.jsx)(o.EuiRange,{className:"mlSeverityControl",fullWidth:!0,min:r.ANOMALY_THRESHOLD.LOW,max:100,value:n,onChange:c,"aria-label":s.i18n.translate("xpack.ml.severitySelector.formControlAriaLabel",{defaultMessage:"Select severity threshold"}),showTicks:!0,ticks:d,showRange:!1,levels:a,"data-test-subj":"mlAnomalyAlertScoreSelection"}))))}))},function(e,t,a){"use strict";a.r(t),a.d(t,"getDefaultExplorerChartsPanelTitle",(function(){return g})),a.d(t,"AnomalyChartsEmbeddable",(function(){return anomaly_charts_embeddable_AnomalyChartsEmbeddable}));var i=a(5),n=a.n(i),s=a(17),o=a.n(s),r=a(55),l=a.n(r),c=a(2),d=a(23),u=a(46),p=a(53);const m=o.a.lazy((()=>Promise.all([a.e(1),a.e(17)]).then(a.bind(null,647))));var b=a(109),f=a(165),h=a(13);const g=e=>c.i18n.translate("xpack.ml.anomalyChartsEmbeddable.title",{defaultMessage:"ML anomaly charts for {jobIds}",values:{jobIds:e.join(", ")}});class anomaly_charts_embeddable_AnomalyChartsEmbeddable extends p.Embeddable{constructor(e,t,a){super(e,{defaultTitle:e.title},a),n()(this,"node",void 0),n()(this,"reload$",new d.Subject),n()(this,"type",b.a),this.services=t,this.initializeOutput(e)}async initializeOutput(e){const{anomalyExplorerService:t}=this.services[2],{jobIds:a}=e;try{const e=await t.getCombinedJobs(a),i=this.services[1].data.dataViews,n=new Set(e.map((e=>e.datafeed_config.indices)).flat()),s={};for(const e of n){const t=(await i.find(`"${e}"`)).find((t=>t.title.toLowerCase()===e.toLowerCase()));void 0!==t&&(s[t.id]=t)}this.updateOutput({...this.getOutput(),indexPatterns:Object.values(s)})}catch(e){console.error(`Unable to load data views for ${a}`,e)}}onLoading(){this.renderComplete.dispatchInProgress(),this.updateOutput({loading:!0,error:void 0})}onError(e){this.renderComplete.dispatchError(),this.updateOutput({loading:!1,error:{name:e.name,message:e.message}})}onRenderComplete(){this.renderComplete.dispatchComplete(),this.updateOutput({loading:!1,error:void 0})}render(e){super.render(e),this.node=e,this.node.setAttribute("data-shared-item","");const t=this.services[0].i18n.Context,a=this.services[0].theme.theme$;l.a.render(Object(h.jsx)(t,null,Object(h.jsx)(u.KibanaThemeProvider,{theme$:a},Object(h.jsx)(u.KibanaContextProvider,{services:{...this.services[0]}},Object(h.jsx)(s.Suspense,{fallback:Object(h.jsx)(f.a,null)},Object(h.jsx)(m,{id:this.input.id,embeddableContext:this,embeddableInput:this.getInput$(),services:this.services,refresh:this.reload$.asObservable(),onInputChange:this.updateInput.bind(this),onOutputChange:this.updateOutput.bind(this),onRenderComplete:this.onRenderComplete.bind(this),onLoading:this.onLoading.bind(this),onError:this.onError.bind(this)}))))),e)}destroy(){super.destroy(),this.node&&l.a.unmountComponentAtNode(this.node)}reload(){this.reload$.next()}supportedTriggers(){return[]}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var i=a(17),n=a.n(i),s=a(45),o=a(44),r=a(392),l=a.n(r),c=a(0),d=a(80),u=a(84),p=a(133),m=a(13);const b=()=>{const e=!Object(u.e)("canCreateJob")||!Object(p.c)(),{services:{docLinks:t}}=Object(d.b)(),a=Object(d.d)(),i=Object(d.e)();return Object(m.jsx)(o.EuiEmptyPrompt,{layout:"horizontal",hasBorder:!1,hasShadow:!1,icon:Object(m.jsx)(o.EuiImage,{size:"fullWidth",src:l.a,alt:"anomaly_detection"}),color:"subdued",title:Object(m.jsx)("h2",null,Object(m.jsx)(s.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.createFirstJobMessage",defaultMessage:"Create your first anomaly detection job"})),body:Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)("p",null,Object(m.jsx)(s.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.emptyPromptText",defaultMessage:"Anomaly detection enables you to find unusual behavior in time series data. Start automatically spotting the anomalies hiding in your data and resolve issues faster."}))),actions:Object(m.jsx)(o.EuiButton,{color:"primary",onClick:async()=>{if(!a)return;const e=await a.getUrl({page:c.b.ANOMALY_DETECTION_CREATE_JOB_SELECT_INDEX});await i(e,!0)},fill:!0,iconType:"plusInCircle",isDisabled:e,"data-test-subj":"mlCreateNewJobButton"},Object(m.jsx)(s.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.createJobButtonText",defaultMessage:"Create job"})),footer:Object(m.jsx)(o.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(m.jsx)(o.EuiFlexItem,{grow:!1},Object(m.jsx)(o.EuiTitle,{size:"xxs"},Object(m.jsx)("h3",null,Object(m.jsx)(s.FormattedMessage,{id:"xpack.ml.common.learnMoreQuestion",defaultMessage:"Want to learn more?"})))),Object(m.jsx)(o.EuiFlexItem,{grow:!1},Object(m.jsx)(o.EuiLink,{href:t.links.ml.anomalyDetection,target:"_blank",external:!0},Object(m.jsx)(s.FormattedMessage,{id:"xpack.ml.common.readDocumentationLink",defaultMessage:"Read documentation"})))),"data-test-subj":"mlAnomalyDetectionEmptyState"})}},,,,,function(e,t,a){"use strict";var i=a(209);a.d(t,"b",(function(){return i.b})),a.d(t,"a",(function(){return i.a}))},function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return s}));let i=!1;function n(e){i=e}function s(){return i}},function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var i=a(17),n=a(44),s=a(80),o=a(0),r=a(213),l=a(13);function c(e){return void 0!==e.groupId}var d={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const u=e=>{const t=Object(s.d)(),[a,u]=Object(i.useState)("");return Object(i.useEffect)((()=>{let a=!1;return(async()=>{const i={};if(c(e)?i.groupIds=[e.groupId]:i.jobId=e.id,t){const e=await t.getUrl({page:o.b.ANOMALY_DETECTION_JOBS_MANAGE,pageState:i});a||u(e)}})(),()=>{a=!0}}),[e,t]),c(e)?Object(l.jsx)(n.EuiLink,{key:e.groupId,href:a},Object(l.jsx)(r.a,{name:e.groupId})):Object(l.jsx)(n.EuiLink,{key:e.id,href:a,css:d,title:e.id},e.id)}},function(e,t,a){t.format_value=a(174).format_value,t.parse_value=a(174).parse_value,t.RRule=a(195).RRule,t.parse_calendar=a(277).parse_calendar,t.ParseError=a(277).ParseError,t.CalendarObject=a(122).CalendarObject,t.CalendarProperty=a(122).CalendarProperty,t.iCalendar=a(196).iCalendar,t.VEvent=a(399).VEvent,t.VTimezone=a(400).VTimezone,t.PRODID="-//Tri Tech Computers//node-icalendar//EN"},function(e,t,a){a(227);var i=a(175),n=a(174),s=a(122).CalendarObject,o=a(122).schema,r=a(122).properties,l=a(196).iCalendar,c=n.parse_value,d=(n.format_value,t.ParseError=function(){Error.apply(this,arguments)});function u(e,t){var a=e.calendar;return function i(n,l,d){if("BEGIN"==n){var p=(o[l]||{}).factory,m=void 0!==p?new p(a):new s(a,l);return u(m,(function(){return e.addComponent(m),i.apply(this,arguments)}))}if("END"==n)return t;var b=r[n]||{};return l=c(b.type,l,d,a,b.list),e.addProperty(n,l,d),i}}function p(e){var t,a,i={},n=PROP_NAME,s=0;function o(e){n=e,s=l+1}function r(){return e.substr(s,l-s)}for(var l=0,c=e.length;l<c;++l){var d=e[l];switch(n){case PROP_NAME:":"!=d&&";"!=d||(t=r(),n=PARAM_OR_VALUE,--l);break;case PARAM_OR_VALUE:if(":"==d)o(PROP_VALUE);else{if(";"!=d)throw new Error("Parse error");o(PARAM_NAME)}break;case PARAM_NAME:"="==d&&(a=r(),o(MAYBE_QUOTED_PARAM));break;case MAYBE_QUOTED_PARAM:'"'==d?o(QUOTED_PARAM_VALUE):n=PARAM_VALUE;break;case PARAM_VALUE:":"!=d&&";"!=d||(i[a]=r(),n=PARAM_OR_VALUE,--l);break;case QUOTED_PARAM_VALUE:'"'==d&&(i[a]=r(),n=PARAM_OR_VALUE);break;case PROP_VALUE:l=c;break;default:throw new Error("Invalid parser state")}}return[t,r(),i]}i.inherits(d,Error),PROP_NAME=0,PARAM_NAME=1,PARAM_VALUE=2,MAYBE_QUOTED_PARAM=3,QUOTED_PARAM_VALUE=4,PARAM_OR_VALUE=5,PROP_VALUE=6,t.parse_calendar=function(e,a){e=e.split(/\r?\n/);var i=new l(!0);if(a)if("string"==typeof a&&(a=t.parse_calendar(a)),a instanceof l)for(var n=a.getComponents("VTIMEZONE"),s=0;s<n.length;++s)i.addComponent(n[s]);else i.addComponent(n[s]);var o,r,c,m=(o="BEGIN",r="VCALENDAR",c=u(i),function(e,t,a){if(e!=o)throw new d("Expected BEGIN got "+e);if(r!=t)throw new d("Expected VCALENDAR got "+t);return c});for(s=0;s<e.length-1;++s)if(e[s].length){if(void 0===m)throw new d("Mismatched BEGIN/END tags");for(var b=s;b+1<e.length&&(" "===e[b+1][0]||"\t"===e[b+1][0]);)++b;var f=e[s];if(b!=s){for(var h=e.slice(s,b+1),g=1;g<h.length;++g)h[g]=h[g].substr(1);f=h.join(""),s=b}m=m.apply(null,p(f))}if(void 0!==m)throw new d("Unable to parse calendar data; END:VCALENDAR not found!");return i}},function(e,t,a){"use strict";let i;a.d(t,"a",(function(){return i})),function(e){e[e.ADD_REQUEST_MESSAGE=0]="ADD_REQUEST_MESSAGE",e[e.RESET_REQUEST_MESSAGES=1]="RESET_REQUEST_MESSAGES",e[e.CLOSE_MODAL=2]="CLOSE_MODAL",e[e.OPEN_MODAL=3]="OPEN_MODAL",e[e.RESET_ADVANCED_EDITOR_MESSAGES=4]="RESET_ADVANCED_EDITOR_MESSAGES",e[e.RESET_FORM=5]="RESET_FORM",e[e.SET_ADVANCED_EDITOR_RAW_STRING=6]="SET_ADVANCED_EDITOR_RAW_STRING",e[e.SET_FORM_STATE=7]="SET_FORM_STATE",e[e.SET_INDEX_PATTERN_TITLES=8]="SET_INDEX_PATTERN_TITLES",e[e.SET_IS_JOB_CREATED=9]="SET_IS_JOB_CREATED",e[e.SET_IS_JOB_STARTED=10]="SET_IS_JOB_STARTED",e[e.SET_IS_MODAL_BUTTON_DISABLED=11]="SET_IS_MODAL_BUTTON_DISABLED",e[e.SET_IS_MODAL_VISIBLE=12]="SET_IS_MODAL_VISIBLE",e[e.SET_JOB_CONFIG=13]="SET_JOB_CONFIG",e[e.SET_JOB_IDS=14]="SET_JOB_IDS",e[e.SWITCH_TO_ADVANCED_EDITOR=15]="SWITCH_TO_ADVANCED_EDITOR",e[e.SWITCH_TO_FORM=16]="SWITCH_TO_FORM",e[e.SET_ESTIMATED_MODEL_MEMORY_LIMIT=17]="SET_ESTIMATED_MODEL_MEMORY_LIMIT",e[e.SET_JOB_CLONE=18]="SET_JOB_CLONE"}(i||(i={}))},function(e,t,a){"use strict";a.d(t,"a",(function(){return y})),a.d(t,"b",(function(){return C}));var i=a(2),n=a(8),s=a(61),o=a.n(s),r=a(47),l=a(60),c=a(280),d=a(278),u=a(135),p=a(88),m=a(20),b=a(29),f=a(97),h=a(83),g=a(161);const{collapseLiteralStrings:j}=l.XJson,x=`${b.a.slice(0,b.a.length-1).join(", ")} or ${[...b.a].pop()}`,v=i.i18n.translate("xpack.ml.dataframe.analytics.create.modelMemoryUnitsInvalidError",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:x}});function y(e){return null===e?null:Object.keys(e).reduce(((t,a)=>("min"===a&&t.push(i.i18n.translate("xpack.ml.dataframe.analytics.create.modelMemoryUnitsMinError",{defaultMessage:"Model memory limit is lower than estimated value {mml}",values:{mml:e.min.minValue}})),"invalidUnits"===a&&t.push(i.i18n.translate("xpack.ml.dataframe.analytics.create.modelMemoryUnitsInvalidError",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:x}})),t)),[])}const O=e=>{var t;const{jobConfig:a}=e,i=null==a||null===(t=a.source)||void 0===t?void 0:t.index;return"string"==typeof i?i:Array.isArray(i)?i.join(","):""},E=(e,t)=>{let a=0===Object.keys(r.indexPatterns.validate(e)).length;return a&&("string"==typeof t&&(a=!t.includes(",")),Array.isArray(t)&&(a=!t.some((e=>null==e?void 0:e.includes(","))))),a},w=e=>"number"==typeof e&&e>=h.e&&Number.isInteger(e),M=e=>{var t,a,n,s,o,r;const{jobIdEmpty:l,jobIdValid:d,jobIdExists:u,jobType:m,createIndexPattern:b}=e.form,{jobConfig:g}=e;e.advancedEditorMessages=[];const j=O(e),x=""===j,y=null==g||null===(t=g.source)||void 0===t?void 0:t.index,M=E(j,y),S=null!==(a=null==g||null===(n=g.dest)||void 0===n?void 0:n.index)&&void 0!==a?a:"",_=""===S,T=Object(c.a)(S),C=void 0!==e.indexPatternsMap[S],k=(null==g||null===(s=g.analyzed_fields)||void 0===s?void 0:s.includes)||[],F="string"==typeof(null==g||null===(o=g.dest)||void 0===o?void 0:o.results_field)&&""===(null==g||null===(r=g.dest)||void 0===r?void 0:r.results_field.trim()),I=g.model_memory_limit,D=""===I||void 0===I;if(!D&&void 0!==I){const{valid:t}=Object(p.x)(I);e.form.modelMemoryLimitUnitValid=t}let A=!1,L=!0,R=!0,N=!0;if(void 0!==g.analysis||m!==f.a.CLASSIFICATION&&m!==f.a.REGRESSION||(A=!0),void 0!==g.analysis&&(Object(h.y)(g.analysis)||Object(h.v)(g.analysis))){const t=Object(h.o)(g.analysis)||"";A=""===t,!A&&Array.isArray(k)&&k.length>0&&!k.includes(t)&&(L=!1,e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.includesInvalid",{defaultMessage:"The dependent variable must be included."}),message:""}));const a=Object(h.t)(g.analysis);void 0!==a&&(isNaN(a)||"number"!=typeof a||a<h.k||a>h.j)&&(R=!1,e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.trainingPercentInvalid",{defaultMessage:"The training percent must be a number between {min} and {max}.",values:{min:h.k,max:h.j}}),message:""}));const n=Object(h.q)(g.analysis);void 0!==n&&(N=w(n),!1===N&&e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.numTopFeatureImportanceValuesInvalid",{defaultMessage:"The value for num_top_feature_importance_values must be an integer of {min} or higher.",values:{min:0}}),message:""}))}return x?e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.sourceIndexNameEmpty",{defaultMessage:"The source index name must not be empty."}),message:""}):M||e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.sourceIndexNameValid",{defaultMessage:"Invalid source index name."}),message:""}),_?e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.destinationIndexNameEmpty",{defaultMessage:"The destination index name must not be empty."}),message:""}):C&&!b?e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.destinationIndexNameExistsWarn",{defaultMessage:"An index with this destination index name already exists. Be aware that running this analytics job will modify this destination index."}),message:""}):T||e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.destinationIndexNameValid",{defaultMessage:"Invalid destination index name."}),message:""}),F&&e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.resultsFieldEmptyString",{defaultMessage:"The results field must not be an empty string."}),message:""}),A&&e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.dependentVariableEmpty",{defaultMessage:"The dependent variable field must not be empty."}),message:""}),D&&e.advancedEditorMessages.push({error:i.i18n.translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.modelMemoryLimitEmpty",{defaultMessage:"The model memory limit field must not be empty."}),message:""}),e.form.modelMemoryLimitUnitValid||e.advancedEditorMessages.push({error:v,message:""}),e.form.destinationIndexPatternTitleExists=C,e.isValid=L&&R&&e.form.modelMemoryLimitUnitValid&&!l&&d&&!u&&!x&&M&&!_&&T&&!F&&!A&&!D&&N&&(!C||!b),e},S=Object(n.memoize)((e=>Object(m.a)(Object(m.e)(),function(e){return t=>{if(!t||!e)return null;const a=o()(t.toUpperCase()).value();return o()(e.toUpperCase()).value()>a?{min:{minValue:e,actualValue:t}}:null}}(e),Object(m.c)()))),_=Object(n.memoize)(((e,t)=>S(e)(t)),((...e)=>e.join("_"))),T=e=>{const{jobIdEmpty:t,jobIdValid:a,jobIdExists:i,jobType:n,sourceIndexNameEmpty:s,sourceIndexNameValid:o,destinationIndexNameEmpty:r,destinationIndexNameValid:l,destinationIndexPatternTitleExists:c,createIndexPattern:d,dependentVariable:u,modelMemoryLimit:p,numTopFeatureImportanceValuesValid:m}=e.form,{estimatedModelMemoryLimit:b}=e,h=void 0===n,g=(n===f.a.REGRESSION||n===f.a.CLASSIFICATION)&&""===u,j=_(b,p),x=null!==j&&(void 0!==j.invalidUnits||!0===j.required);return e.form.modelMemoryLimitValidationResult=j,e.isValid=!h&&!x&&!t&&a&&!i&&!s&&o&&!r&&l&&!g&&m&&(!c||!d),e};function C(e,t){var a;switch(t.type){case d.a.ADD_REQUEST_MESSAGE:const i=e.requestMessages;return i.push(t.requestMessage),{...e,requestMessages:i};case d.a.RESET_REQUEST_MESSAGES:return{...e,requestMessages:[]};case d.a.RESET_ADVANCED_EDITOR_MESSAGES:return{...e,advancedEditorMessages:[]};case d.a.RESET_FORM:return Object(u.e)();case d.a.SET_ADVANCED_EDITOR_RAW_STRING:let s,o=!1;try{s=JSON.parse(j(t.advancedEditorRawString));const a=e.form.runtimeMappings&&s.source.runtime_mappings&&!Object(n.isEqual)(e.form.runtimeMappings,s.source.runtime_mappings);o=Object(g.d)(s)||a}catch(a){return{...e,advancedEditorRawString:t.advancedEditorRawString,isAdvancedEditorValidJson:!1,disableSwitchToForm:!0,advancedEditorMessages:[]}}return{...M({...e,jobConfig:s}),advancedEditorRawString:t.advancedEditorRawString,isAdvancedEditorValidJson:!0,disableSwitchToForm:o};case d.a.SET_FORM_STATE:const l={...e.form,...t.payload};if(void 0!==t.payload.destinationIndex&&(l.destinationIndexNameEmpty=""===l.destinationIndex,l.destinationIndexNameValid=Object(c.a)(l.destinationIndex),l.destinationIndexPatternTitleExists=void 0!==e.indexPatternsMap[l.destinationIndex]),void 0!==t.payload.jobId&&(l.jobIdEmpty=""===l.jobId,l.jobIdValid=Object(p.k)(l.jobId),l.jobIdInvalidMaxLength=!!Object(m.b)(b.b)(l.jobId)),void 0!==t.payload.sourceIndex){l.sourceIndexNameEmpty=""===l.sourceIndex;const e=r.indexPatterns.validate(l.sourceIndex);l.sourceIndexNameValid=0===Object.keys(e).length}return void 0!==t.payload.numTopFeatureImportanceValues&&(l.numTopFeatureImportanceValuesValid=w(null==l?void 0:l.numTopFeatureImportanceValues)),e.isAdvancedEditorEnabled?M({...e,form:l}):T({...e,form:l});case d.a.SET_INDEX_PATTERN_TITLES:{const a={...e,...t.payload};return a.form.destinationIndexPatternTitleExists=void 0!==a.indexPatternsMap[a.form.destinationIndex],a}case d.a.SET_IS_JOB_CREATED:return{...e,isJobCreated:t.isJobCreated};case d.a.SET_IS_JOB_STARTED:return{...e,isJobStarted:t.isJobStarted};case d.a.SET_JOB_CONFIG:return M({...e,jobConfig:t.payload});case d.a.SWITCH_TO_ADVANCED_EDITOR:const f=Object(u.f)(e.form),h=Object(g.d)(f);return M({...e,advancedEditorRawString:JSON.stringify(f,null,2),isAdvancedEditorEnabled:!0,disableSwitchToForm:h,hasSwitchedToEditor:!0,jobConfig:f});case d.a.SWITCH_TO_FORM:const{jobConfig:x}=e,{jobId:v}=e.form,y=Object(u.d)(x,!1);"string"==typeof v&&""!==v.trim()&&(y.jobId=v),y.jobIdEmpty=""===v,y.jobIdValid=Object(p.k)(v),y.jobIdInvalidMaxLength=!!Object(m.b)(b.b)(v),y.destinationIndexNameEmpty=""===y.destinationIndex,y.destinationIndexNameValid=Object(c.a)(y.destinationIndex||""),y.destinationIndexPatternTitleExists=void 0!==e.indexPatternsMap[y.destinationIndex||""],void 0!==y.numTopFeatureImportanceValues&&(y.numTopFeatureImportanceValuesValid=w(y.numTopFeatureImportanceValues));const S=O(e),_=null==x||null===(a=x.source)||void 0===a?void 0:a.index,C=E(S,_);return y.sourceIndexNameValid=C,T({...e,form:y,isAdvancedEditorEnabled:!1,advancedEditorRawString:JSON.stringify(x,null,2),jobConfig:x});case d.a.SET_ESTIMATED_MODEL_MEMORY_LIMIT:return{...e,estimatedModelMemoryLimit:t.value};case d.a.SET_JOB_CLONE:return{...e,cloneJob:t.cloneJob}}return e}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const i=window;function n(e){return"string"==typeof e&&e===e.toLowerCase()&&/^[^\*\\/\?"<>|\s,#:]+$/.test(e)&&/^[^-_\+]+$/.test(e.charAt(0))&&"."!==e&&".."!==e&&function(e){return!(i.TextEncoder&&new i.TextEncoder("utf-8").encode(e).length>255)&&e.length<=255}(e)}},function(e,t,a){e.exports=a(39)(3399)},function(e,t,a){e.exports=a(39)(3435)},function(e,t,a){e.exports=a(284)},function(e,t,a){var i=a(285),n=a(199),s=a(286),o=a(129);e.exports=function(e,t){return(o(e)?i:n)(e,s(t))}},function(e,t,a){e.exports=a(39)(3400)},function(e,t,a){e.exports=a(39)(3383)},function(e,t,a){var i=a(425),n=a(426),s=a(142),o=a(129);e.exports=function(e,t){return(o(e)?i:n)(e,s(t,3))}},function(e,t,a){e.exports=a(39)(1493)},function(e,t,a){e.exports=a(39)(3065)},function(e,t,a){var i=a(177);e.exports=function(e){return e==e&&!i(e)}},function(e,t){e.exports=function(e,t){return function(a){return null!=a&&a[e]===t&&(void 0!==t||e in Object(a))}}},,function(e,t,a){var i=a(431),n=a(294);e.exports=function(e,t){return null!=e&&n(e,t,i)}},function(e,t,a){var i=a(231),n=a(232),s=a(129),o=a(295),r=a(432),l=a(200);e.exports=function(e,t,a){for(var c=-1,d=(t=i(t,e)).length,u=!1;++c<d;){var p=l(t[c]);if(!(u=null!=e&&a(e,p)))break;e=e[p]}return u||++c!=d?u:!!(d=null==e?0:e.length)&&r(d)&&o(p,d)&&(s(e)||n(e))}},function(e,t,a){e.exports=a(39)(1503)},function(e,t,a){e.exports=a(39)(3394)},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,a){var i=a(435),n=a(294);e.exports=function(e,t){return null!=e&&n(e,t,i)}},function(e,t,a){e.exports=a(39)(3106)},function(e,t,a){e.exports=a(39)(760)},function(e,t){e.exports=function(e){return void 0===e}},function(e,t,a){var i=a(237),n=a(142),s=a(303),o=a(129);e.exports=function(e,t){return(o(e)?i:s)(e,n(t,3))}},function(e,t,a){var i=a(199),n=a(162);e.exports=function(e,t){var a=-1,s=n(e)?Array(e.length):[];return i(e,(function(e,i,n){s[++a]=t(e,i,n)})),s}},function(e,t,a){var i=a(438),n=a(199),s=a(142),o=a(439),r=a(129);e.exports=function(e,t,a){var l=r(e)?i:o,c=arguments.length<3;return l(e,s(t,4),a,c,n)}},function(e,t,a){e.exports=a(39)(3429)},function(e,t){e.exports=function(e,t,a,i){for(var n=e.length,s=a+(i?1:-1);i?s--:++s<n;)if(t(e[s],s,e))return s;return-1}},function(e,t,a){e.exports=a(39)(3100)},function(e,t,a){var i=a(162),n=a(463);e.exports=function(e){return n(e)&&i(e)}},function(e,t,a){var i=a(464),n=a(176);e.exports=function(e){return null==e?[]:i(e,n(e))}},function(e,t,a){var i=a(123),n=a(311);e.exports=function(e,t,a,i){return function(e,t,a,i){var s,o,r={},l=new n,c=function(e){var t=e.v!==s?e.v:e.w,i=r[t],n=a(e),c=o.distance+n;if(n<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+n);c<i.distance&&(i.distance=c,i.predecessor=s,l.decrease(t,c))};for(e.nodes().forEach((function(e){var a=e===t?0:Number.POSITIVE_INFINITY;r[e]={distance:a},l.add(e,a)}));l.size()>0&&(s=l.removeMin(),(o=r[s]).distance!==Number.POSITIVE_INFINITY);)i(s).forEach(c);return r}(e,String(t),a||s,i||function(t){return e.outEdges(t)})};var s=i.constant(1)},function(e,t,a){var i=a(123);function n(){this._arr=[],this._keyIndices={}}e.exports=n,n.prototype.size=function(){return this._arr.length},n.prototype.keys=function(){return this._arr.map((function(e){return e.key}))},n.prototype.has=function(e){return i.has(this._keyIndices,e)},n.prototype.priority=function(e){var t=this._keyIndices[e];if(void 0!==t)return this._arr[t].priority},n.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},n.prototype.add=function(e,t){var a=this._keyIndices;if(e=String(e),!i.has(a,e)){var n=this._arr,s=n.length;return a[e]=s,n.push({key:e,priority:t}),this._decrease(s),!0}return!1},n.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key},n.prototype.decrease=function(e,t){var a=this._keyIndices[e];if(t>this._arr[a].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[a].priority+" New: "+t);this._arr[a].priority=t,this._decrease(a)},n.prototype._heapify=function(e){var t=this._arr,a=2*e,i=a+1,n=e;a<t.length&&(n=t[a].priority<t[n].priority?a:n,i<t.length&&(n=t[i].priority<t[n].priority?i:n),n!==e&&(this._swap(e,n),this._heapify(n)))},n.prototype._decrease=function(e){for(var t,a=this._arr,i=a[e].priority;0!==e&&!(a[t=e>>1].priority<i);)this._swap(e,t),e=t},n.prototype._swap=function(e,t){var a=this._arr,i=this._keyIndices,n=a[e],s=a[t];a[e]=s,a[t]=n,i[s.key]=e,i[n.key]=t}},function(e,t,a){var i=a(123);e.exports=function(e){var t=0,a=[],n={},s=[];function o(r){var l=n[r]={onStack:!0,lowlink:t,index:t++};if(a.push(r),e.successors(r).forEach((function(e){i.has(n,e)?n[e].onStack&&(l.lowlink=Math.min(l.lowlink,n[e].index)):(o(e),l.lowlink=Math.min(l.lowlink,n[e].lowlink))})),l.lowlink===l.index){var c,d=[];do{c=a.pop(),n[c].onStack=!1,d.push(c)}while(r!==c);s.push(d)}}return e.nodes().forEach((function(e){i.has(n,e)||o(e)})),s}},function(e,t,a){var i=a(123);function n(e){var t={},a={},n=[];if(i.each(e.sinks(),(function o(r){if(i.has(a,r))throw new s;i.has(t,r)||(a[r]=!0,t[r]=!0,i.each(e.predecessors(r),o),delete a[r],n.push(r))})),i.size(t)!==e.nodeCount())throw new s;return n}function s(){}e.exports=n,n.CycleException=s,s.prototype=new Error},function(e,t,a){var i=a(123);function n(e,t,a,s,o,r){i.has(s,t)||(s[t]=!0,a||r.push(t),i.each(o(t),(function(t){n(e,t,a,s,o,r)})),a&&r.push(t))}e.exports=function(e,t,a){i.isArray(t)||(t=[t]);var s=(e.isDirected()?e.successors:e.neighbors).bind(e),o=[],r={};return i.each(t,(function(t){if(!e.hasNode(t))throw new Error("Graph does not have node: "+t);n(e,t,"post"===a,r,s,o)})),o}},function(e,t,a){e.exports=a(39)(757)},function(e,t,a){e.exports=a(39)(1548)},function(e,t,a){e.exports=a(39)(770)},function(e,t,a){var i=a(316),n=a(315);e.exports=function(e,t,a){(void 0!==a&&!n(e[t],a)||void 0===a&&!(t in e))&&i(e,t,a)}},function(e,t){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},function(e,t){e.exports=function(e,t){return e<t}},function(e,t,a){e.exports=a(39)(1547)},function(e,t,a){"use strict";var i=a(98),n=a(128).Graph,s=a(203).slack;function o(e,t){return i.forEach(e.nodes(),(function a(n){i.forEach(t.nodeEdges(n),(function(i){var o=i.v,r=n===o?i.w:o;e.hasNode(r)||s(t,i)||(e.setNode(r,{}),e.setEdge(n,r,{}),a(r))}))})),e.nodeCount()}function r(e,t){return i.minBy(t.edges(),(function(a){if(e.hasNode(a.v)!==e.hasNode(a.w))return s(t,a)}))}function l(e,t,a){i.forEach(e.nodes(),(function(e){t.node(e).rank+=a}))}e.exports=function(e){var t,a,i=new n({directed:!1}),c=e.nodes()[0],d=e.nodeCount();for(i.setNode(c,{});o(i,e)<d;)t=r(i,e),a=i.hasNode(t.v)?s(e,t):-s(e,t),l(i,e,a);return i}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(556);case"v8light":return a(558)}},,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var i=a(13),n=(a(17),a(44)),s=a(2),o=a(45),r=a(48),l=a(126),c={name:"ovk77c",styles:"min-width:0"},d={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"},u={name:"1qmr6ab",styles:"overflow:auto"};const p=({models:e,hideColumns:t=["node_name"]})=>{const a=Object(l.a)(r.FIELD_FORMAT_IDS.BYTES),p=Object(l.a)(r.FIELD_FORMAT_IDS.DATE),m=Object(l.a)(r.FIELD_FORMAT_IDS.DURATION),b=Object(n.useEuiTheme)(),f=[{id:"node_name",field:"node.name",name:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.nodeNameHeader",{defaultMessage:"Node name"}),width:"150px",sortable:!0,truncateText:!1,"data-test-subj":"mlAllocatedModelsTableNodeName"},{id:"model_id",field:"model_id",name:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.modelNameHeader",{defaultMessage:"Name"}),width:"250px",sortable:!0,truncateText:!1,"data-test-subj":"mlAllocatedModelsTableName"},{name:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.modelSizeHeader",{defaultMessage:"Size"}),width:"100px",truncateText:!0,"data-test-subj":"mlAllocatedModelsTableSize",render:e=>a(e.required_native_memory_bytes)},{name:Object(i.jsx)(n.EuiToolTip,{content:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.allocationTooltip",{defaultMessage:"number_of_allocations times threads_per_allocation"})},Object(i.jsx)("span",null,s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.allocationHeader",{defaultMessage:"Allocation"}),Object(i.jsx)(n.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),width:"100px",truncateText:!1,"data-test-subj":"mlAllocatedModelsTableAllocation",render:e=>`${e.node.number_of_allocations} * ${e.node.threads_per_allocation}`},{field:"node.throughput_last_minute",name:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.throughputLastMinuteHeader",{defaultMessage:"Throughput"}),width:"100px",truncateText:!1,"data-test-subj":"mlAllocatedModelsTableThroughput"},{name:Object(i.jsx)(n.EuiToolTip,{display:"block",title:Object(i.jsx)(o.FormattedMessage,{id:"xpack.ml.trainedModels.nodesList.modelsList.modelAvgInferenceTimeTooltipHeader",defaultMessage:"Average inference time"}),content:Object(i.jsx)(o.FormattedMessage,{id:"xpack.ml.trainedModels.nodesList.modelsList.modelAvgInferenceTimeTooltipMessage",defaultMessage:"If caching is enabled, fast cache hits are included when calculating the average inference time."})},Object(i.jsx)(n.EuiFlexGroup,{gutterSize:"xs"},Object(i.jsx)(n.EuiFlexItem,{grow:!1,css:c},Object(i.jsx)("span",{css:d},Object(i.jsx)(o.FormattedMessage,{id:"xpack.ml.trainedModels.nodesList.modelsList.modelAvgInferenceTimeHeader",defaultMessage:"Avg inference time"}))),Object(i.jsx)(n.EuiFlexItem,{grow:!1,css:Object(i.css)({minWidth:b.euiTheme.size.m},"","")},Object(i.jsx)(n.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"})))),width:"100px",truncateText:!1,"data-test-subj":"mlAllocatedModelsTableAvgInferenceTime",render:e=>e.node.average_inference_time_ms?m(e.node.average_inference_time_ms):"-"},{name:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.modelInferenceCountHeader",{defaultMessage:"Inference count"}),width:"100px","data-test-subj":"mlAllocatedModelsTableInferenceCount",render:e=>e.node.inference_count},{name:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.modelStartTimeHeader",{defaultMessage:"Start time"}),width:"200px","data-test-subj":"mlAllocatedModelsTableStartedTime",render:e=>p(e.node.start_time)},{name:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.modelLastAccessHeader",{defaultMessage:"Last access"}),width:"200px","data-test-subj":"mlAllocatedModelsTableInferenceCount",render:e=>e.node.last_access?p(e.node.last_access):"-"},{name:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.modelNumberOfPendingRequestsHeader",{defaultMessage:"Pending requests"}),width:"100px","data-test-subj":"mlAllocatedModelsTableNumberOfPendingRequests",render:e=>e.node.number_of_pending_requests},{name:s.i18n.translate("xpack.ml.trainedModels.nodesList.modelsList.modelRoutingStateHeader",{defaultMessage:"Routing state"}),width:"100px","data-test-subj":"mlAllocatedModelsTableRoutingState",render:e=>{const{routing_state:t,reason:a}=e.node.routing_state;return Object(i.jsx)(n.EuiToolTip,{content:a||""},Object(i.jsx)(n.EuiBadge,{color:a?"danger":"hollow"},t))}}].filter((e=>!t.includes(e.id)));return Object(i.jsx)(n.EuiInMemoryTable,{allowNeutralSort:!1,columns:f,hasActions:!1,isExpandable:!1,isSelectable:!1,items:e,itemId:"model_id",rowProps:e=>({"data-test-subj":`mlAllocatedModelTableRow row-${e.model_id}`}),onTableChange:()=>{},"data-test-subj":"mlNodesAllocatedModels",css:u})}},,,,,,,function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c}));var i=a(17),n=a(44),s=a(45),o=a(164),r=a(13);const l=48,c=({defaultTitle:e,initialInput:t,onCreate:a,onCancel:c})=>{var d;const[u,p]=Object(i.useState)(e),[m,b]=Object(i.useState)(null!==(d=null==t?void 0:t.maxSeriesToPlot)&&void 0!==d?d:o.b),f=u.length>0,h=f&&m>0;return Object(r.jsx)(n.EuiModal,{initialFocus:"[name=panelTitle]",onClose:c,"data-test-subj":"mlAnomalyChartsEmbeddableInitializer"},Object(r.jsx)(n.EuiModalHeader,null,Object(r.jsx)(n.EuiModalHeaderTitle,null,Object(r.jsx)("h2",null,Object(r.jsx)(s.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.setupModal.title",defaultMessage:"Anomaly explorer charts configuration"})))),Object(r.jsx)(n.EuiModalBody,null,Object(r.jsx)(n.EuiForm,null,Object(r.jsx)(n.EuiFormRow,{label:Object(r.jsx)(s.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.panelTitleLabel",defaultMessage:"Panel title"}),isInvalid:!f},Object(r.jsx)(n.EuiFieldText,{"data-test-subj":"panelTitleInput",id:"panelTitle",name:"panelTitle",value:u,onChange:e=>p(e.target.value),isInvalid:!f})),Object(r.jsx)(n.EuiFormRow,{label:Object(r.jsx)(s.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.maxSeriesToPlotLabel",defaultMessage:"Maximum number of series to plot"})},Object(r.jsx)(n.EuiFieldNumber,{"data-test-subj":"mlAnomalyChartsInitializerMaxSeries",id:"selectMaxSeriesToPlot",name:"selectMaxSeriesToPlot",value:m,onChange:e=>b(parseInt(e.target.value,10)),min:0,max:l})))),Object(r.jsx)(n.EuiModalFooter,null,Object(r.jsx)(n.EuiButtonEmpty,{onClick:c,"data-test-subj":"mlAnomalyChartsInitializerCancelButton"},Object(r.jsx)(s.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.setupModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(r.jsx)(n.EuiButton,{"data-test-subj":"mlAnomalyChartsInitializerConfirmButton",isDisabled:!h,onClick:a.bind(null,{panelTitle:u,maxSeriesToPlot:m}),fill:!0},Object(r.jsx)(s.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.setupModal.confirmButtonLabel",defaultMessage:"Confirm configurations"}))))}},,,function(e,t,a){"use strict";a.d(t,"a",(function(){return w}));var i=a(190),n=a.n(i),s=n.a.acequire("ace/mode/text_highlight_rules").TextHighlightRules,o=n.a.acequire("ace/lib/oop"),r=function(){var e=this.createKeywordMapper({keyword:["describe|between|in|like|not|and|or|desc|select|from|where|having|group|by|orderasc|desc|pivot|for|in|as|show|columns|include|frozen|tables|escape|limit|rlike|all|distinct|is","avg|count|first|first_value|last|last_value|max|min|sum|kurtosis|mad|percentile|percentile_rank|skewness|stddev_pop|sum_of_squares|var_pop|histogram|case|coalesce|greatest|ifnull|iif|isnull|least|nullif|nvl|curdate|current_date|current_time|current_timestamp|curtime|dateadd|datediff|datepart|datetrunc|date_add|date_diff|date_part|date_trunc|day|dayname|dayofmonth|dayofweek|dayofyear|day_name|day_of_month|day_of_week|day_of_year|dom|dow|doy|hour|hour_of_day|idow|isodayofweek|isodow|isoweek|isoweekofyear|iso_day_of_week|iso_week_of_year|iw|iwoy|minute|minute_of_day|minute_of_hour|month|monthname|month_name|month_of_year|now|quarter|second|second_of_minute|timestampadd|timestampdiff|timestamp_add|timestamp_diff|today|week|week_of_year|year|abs|acos|asin|atan|atan2|cbrt|ceil|ceiling|cos|cosh|cot|degrees|e|exp|expm1|floor|log|log10|mod|pi|power|radians|rand|random|round|sign|signum|sin|sinh|sqrt|tan|truncate|ascii|bit_length|char|character_length|char_length|concat|insert|lcase|left|length|locate|ltrim|octet_length|position|repeat|replace|right|rtrim|space|substring|ucase|cast|convert|database|user|st_astext|st_aswkt|st_distance|st_geometrytype|st_geomfromtext|st_wkttosql|st_x|st_y|st_z|score","true|false","null|boolean|byte|short|integer|long|double|float|half_float|scaled_float|keyword|text|binary|date|ip|object|nested|time|interval_year|interval_month|interval_day|interval_hour|interval_minute|interval_second|interval_year_to_monthinteval_day_to_hour|interval_day_to_minute|interval_day_to_second|interval_hour_to_minute|interval_hour_to_secondinterval_minute_to_second|geo_point|geo_shape|shape"].join("|")},"identifier",!0);this.$rules={start:[{token:"comment",regex:"--.*$"},{token:"comment",start:"/\\*",end:"\\*/"},{token:"string",regex:'".*?"'},{token:"constant",regex:"'.*?'"},{token:"string",regex:"`.*?`"},{token:"entity.name.function",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:e,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"⇐|<⇒|\\*|\\.|\\:\\:|\\+|\\-|\\/|\\/\\/|%|&|\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\(]"},{token:"paren.rparen",regex:"[\\)]"},{token:"text",regex:"\\s+"}]},this.normalizeRules()};o.inherits(r,s);var l=n.a.acequire("ace/lib/oop"),c=n.a.acequire("ace/mode/text_highlight_rules").TextHighlightRules;function d(){this.name="ScriptHighlightRules",this.$rules={start:[{token:"script.comment",regex:"\\/\\/.*$"},{token:"script.string.regexp",regex:"[/](?:(?:\\[(?:\\\\]|[^\\]])+\\])|(?:\\\\/|[^\\]/]))*[/]\\w*\\s*(?=[).,;]|$)"},{token:"script.string",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"script.constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"script.constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"script.constant.language.boolean",regex:"(?:true|false)\\b"},{token:"script.keyword",regex:"def|int|long|byte|String|float|double|char|null|if|else|while|do|for|continue|break|new|try|catch|throw|this|instanceof|return|ctx"},{token:"script.text",regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"script.keyword.operator",regex:"\\?\\.|\\*\\.|=~|==~|!|%|&|\\*|\\-\\-|\\-|\\+\\+|\\+|~|===|==|=|!=|!==|<=|>=|<<=|>>=|>>>=|<>|<|>|->|!|&&|\\|\\||\\?\\:|\\*=|%=|\\+=|\\-=|&=|\\^=|\\b(?:in|instanceof|new|typeof|void)"},{token:"script.lparen",regex:"[[({]"},{token:"script.rparen",regex:"[\\])}]"},{token:"script.text",regex:"\\s+"}]}}l.inherits(d,c);var u=a(378),p=a.n(u),m=(a(8),a(379),n.a.acequire("ace/mode/json_highlight_rules").JsonHighlightRules),b=n.a.acequire("ace/lib/oop");function f(){var e,t,a;this.$rules=p()({},(a=[{token:["variable","whitespace","ace.punctuation.colon","whitespace","punctuation.start_triple_quote"],regex:'("(?:[^"]*_)?script"|"inline"|"source")(\\s*?)(:)(\\s*?)(""")',next:"script-start",merge:!1,push:!0},{token:"variable",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]\\s*(?=:)'},{token:"punctuation.start_triple_quote",regex:'"""',next:"string_literal",merge:!1,push:!0},{token:"string",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:"invalid.illegal",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"invalid.illegal",regex:"\\/\\/.*$"},{token:"paren.lparen",merge:!1,regex:"{",next:e=(e="start")||"json",push:!0},{token:"paren.lparen",merge:!1,regex:"[[(]"},{token:"paren.rparen",merge:!1,regex:"[\\])]"},{token:"paren.rparen",regex:"}",merge:!1,next:"pop"},{token:"punctuation.comma",regex:","},{token:"punctuation.colon",regex:":"},{token:"whitespace",regex:"\\s+"},{token:"text",regex:".+?"}],(t={})[e]=a,t[e+"-sql"]=[{token:["variable","whitespace","ace.punctuation.colon","whitespace","punctuation.start_triple_quote"],regex:'("query")(\\s*?)(:)(\\s*?)(""")',next:"sql-start",merge:!1,push:!0}].concat(a),t.string_literal=[{token:"punctuation.end_triple_quote",regex:'"""',next:"pop"},{token:"multi_string",regex:"."}],t)),this.embedRules(d,"script-",[{token:"punctuation.end_triple_quote",regex:'"""',next:"pop"}]),this.embedRules(r,"sql-",[{token:"punctuation.end_triple_quote",regex:'"""',next:"pop"}])}b.inherits(f,m);var h={id:"ace/mode/json_worker",src:'/*\n * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n * or more contributor license agreements. Licensed under the Elastic License\n * 2.0 and the Server Side Public License, v 1; you may not use this file except\n * in compliance with, at your election, the Elastic License 2.0 or the Server\n * Side Public License, v 1.\n */\n\n/* @notice\n *\n * This product includes code that is based on Ace editor, which was available\n * under a "BSD" license.\n *\n * Distributed under the BSD license:\n *\n * Copyright (c) 2010, Ajax.org B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/* eslint-disable prettier/prettier,no-var,eqeqeq,no-use-before-define,block-scoped-var,no-undef,\n    guard-for-in,one-var,strict,no-redeclare,no-sequences,no-proto,new-cap,no-nested-ternary,no-unused-vars,\n    prefer-const,no-empty,no-extend-native,camelcase */\n/*\n  This file is loaded up as a blob by Brace to hand to Ace to load as Jsonp\n  (hence the redefining of everything).  It is based on the json\n  mode from the brace distro.\n\n  It is very likely that this file will be removed in future but for now it enables\n  extended JSON parsing, like e.g. """{}""" (triple quotes)\n*/\n// @internal\n// @ts-nocheck\n"no use strict";\n! function(window) {\n  function resolveModuleId(id, paths) {\n    for (var testPath = id, tail = ""; testPath;) {\n      var alias = paths[testPath];\n      if ("string" == typeof alias) return alias + tail;\n      if (alias) return alias.location.replace(/\\/*$/, "/") + (tail || alias.main || alias.name);\n      if (alias === !1) return "";\n      var i = testPath.lastIndexOf("/");\n      if (-1 === i) break;\n      tail = testPath.substr(i) + tail, testPath = testPath.slice(0, i)\n    }\n    return id\n  }\n  if (!(void 0 !== window.window && window.document || window.acequire && window.define)) {\n    window.console || (window.console = function() {\n      var msgs = Array.prototype.slice.call(arguments, 0);\n      postMessage({\n        type: "log",\n        data: msgs\n      })\n    }, window.console.error = window.console.warn = window.console.log = window.console.trace = window.console), window.window = window, window.ace = window, window.onerror = function(message, file, line, col, err) {\n      postMessage({\n        type: "error",\n        data: {\n          message: message,\n          data: err.data,\n          file: file,\n          line: line,\n          col: col,\n          stack: err.stack\n        }\n      })\n    }, window.normalizeModule = function(parentId, moduleName) {\n      if (-1 !== moduleName.indexOf("!")) {\n        var chunks = moduleName.split("!");\n        return window.normalizeModule(parentId, chunks[0]) + "!" + window.normalizeModule(parentId, chunks[1])\n      }\n      if ("." == moduleName.charAt(0)) {\n        var base = parentId.split("/").slice(0, -1).join("/");\n        for (moduleName = (base ? base + "/" : "") + moduleName; - 1 !== moduleName.indexOf(".") && previous != moduleName;) {\n          var previous = moduleName;\n          moduleName = moduleName.replace(/^\\.\\//, "").replace(/\\/\\.\\//, "/").replace(/[^\\/]+\\/\\.\\.\\//, "")\n        }\n      }\n      return moduleName\n    }, window.acequire = function acequire(parentId, id) {\n      if (id || (id = parentId, parentId = null), !id.charAt) throw Error("worker.js acequire() accepts only (parentId, id) as arguments");\n      id = window.normalizeModule(parentId, id);\n      var module = window.acequire.modules[id];\n      if (module) return module.initialized || (module.initialized = !0, module.exports = module.factory().exports), module.exports;\n      if (!window.acequire.tlns) return console.log("unable to load " + id);\n      var path = resolveModuleId(id, window.acequire.tlns);\n      return ".js" != path.slice(-3) && (path += ".js"), window.acequire.id = id, window.acequire.modules[id] = {}, importScripts(path), window.acequire(parentId, id)\n    }, window.acequire.modules = {}, window.acequire.tlns = {}, window.define = function(id, deps, factory) {\n      if (2 == arguments.length ? (factory = deps, "string" != typeof id && (deps = id, id = window.acequire.id)) : 1 == arguments.length && (factory = id, deps = [], id = window.acequire.id), "function" != typeof factory) return window.acequire.modules[id] = {\n        exports: factory,\n        initialized: !0\n      }, void 0;\n      deps.length || (deps = ["require", "exports", "module"]);\n      var req = function(childId) {\n        return window.acequire(id, childId)\n      };\n      window.acequire.modules[id] = {\n        exports: {},\n        factory: function() {\n          var module = this,\n            returnExports = factory.apply(this, deps.map(function(dep) {\n              switch (dep) {\n                case "require":\n                  return req;\n                case "exports":\n                  return module.exports;\n                case "module":\n                  return module;\n                default:\n                  return req(dep)\n              }\n            }));\n          return returnExports && (module.exports = returnExports), module\n        }\n      }\n    }, window.define.amd = {}, acequire.tlns = {}, window.initBaseUrls = function(topLevelNamespaces) {\n      for (var i in topLevelNamespaces) acequire.tlns[i] = topLevelNamespaces[i]\n    }, window.initSender = function() {\n      var EventEmitter = window.acequire("ace/lib/event_emitter").EventEmitter,\n        oop = window.acequire("ace/lib/oop"),\n        Sender = function() {};\n      return function() {\n        oop.implement(this, EventEmitter), this.callback = function(data, callbackId) {\n          postMessage({\n            type: "call",\n            id: callbackId,\n            data: data\n          })\n        }, this.emit = function(name, data) {\n          postMessage({\n            type: "event",\n            name: name,\n            data: data\n          })\n        }\n      }.call(Sender.prototype), new Sender\n    };\n    var main = window.main = null,\n      sender = window.sender = null;\n    window.onmessage = function(e) {\n      var msg = e.data;\n      if (msg.event && sender) sender._signal(msg.event, msg.data);\n      else if (msg.command)\n        if (main[msg.command]) main[msg.command].apply(main, msg.args);\n        else {\n          if (!window[msg.command]) throw Error("Unknown command:" + msg.command);\n          window[msg.command].apply(window, msg.args)\n        }\n      else if (msg.init) {\n        window.initBaseUrls(msg.tlns), acequire("ace/lib/es5-shim"), sender = window.sender = window.initSender();\n        var clazz = acequire(msg.module)[msg.classname];\n        main = window.main = new clazz(sender)\n      }\n    }\n  }\n}(this), ace.define("ace/lib/oop", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  exports.inherits = function(ctor, superCtor) {\n    ctor.super_ = superCtor, ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: !1,\n        writable: !0,\n        configurable: !0\n      }\n    })\n  }, exports.mixin = function(obj, mixin) {\n    for (var key in mixin) obj[key] = mixin[key];\n    return obj\n  }, exports.implement = function(proto, mixin) {\n    exports.mixin(proto, mixin)\n  }\n}), ace.define("ace/range", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  var comparePoints = function(p1, p2) {\n      return p1.row - p2.row || p1.column - p2.column\n    },\n    Range = function(startRow, startColumn, endRow, endColumn) {\n      this.start = {\n        row: startRow,\n        column: startColumn\n      }, this.end = {\n        row: endRow,\n        column: endColumn\n      }\n    };\n  (function() {\n    this.isEqual = function(range) {\n      return this.start.row === range.start.row && this.end.row === range.end.row && this.start.column === range.start.column && this.end.column === range.end.column\n    }, this.toString = function() {\n      return "Range: [" + this.start.row + "/" + this.start.column + "] -> [" + this.end.row + "/" + this.end.column + "]"\n    }, this.contains = function(row, column) {\n      return 0 == this.compare(row, column)\n    }, this.compareRange = function(range) {\n      var cmp, end = range.end,\n        start = range.start;\n      return cmp = this.compare(end.row, end.column), 1 == cmp ? (cmp = this.compare(start.row, start.column), 1 == cmp ? 2 : 0 == cmp ? 1 : 0) : -1 == cmp ? -2 : (cmp = this.compare(start.row, start.column), -1 == cmp ? -1 : 1 == cmp ? 42 : 0)\n    }, this.comparePoint = function(p) {\n      return this.compare(p.row, p.column)\n    }, this.containsRange = function(range) {\n      return 0 == this.comparePoint(range.start) && 0 == this.comparePoint(range.end)\n    }, this.intersects = function(range) {\n      var cmp = this.compareRange(range);\n      return -1 == cmp || 0 == cmp || 1 == cmp\n    }, this.isEnd = function(row, column) {\n      return this.end.row == row && this.end.column == column\n    }, this.isStart = function(row, column) {\n      return this.start.row == row && this.start.column == column\n    }, this.setStart = function(row, column) {\n      "object" == typeof row ? (this.start.column = row.column, this.start.row = row.row) : (this.start.row = row, this.start.column = column)\n    }, this.setEnd = function(row, column) {\n      "object" == typeof row ? (this.end.column = row.column, this.end.row = row.row) : (this.end.row = row, this.end.column = column)\n    }, this.inside = function(row, column) {\n      return 0 == this.compare(row, column) ? this.isEnd(row, column) || this.isStart(row, column) ? !1 : !0 : !1\n    }, this.insideStart = function(row, column) {\n      return 0 == this.compare(row, column) ? this.isEnd(row, column) ? !1 : !0 : !1\n    }, this.insideEnd = function(row, column) {\n      return 0 == this.compare(row, column) ? this.isStart(row, column) ? !1 : !0 : !1\n    }, this.compare = function(row, column) {\n      return this.isMultiLine() || row !== this.start.row ? this.start.row > row ? -1 : row > this.end.row ? 1 : this.start.row === row ? column >= this.start.column ? 0 : -1 : this.end.row === row ? this.end.column >= column ? 0 : 1 : 0 : this.start.column > column ? -1 : column > this.end.column ? 1 : 0\n    }, this.compareStart = function(row, column) {\n      return this.start.row == row && this.start.column == column ? -1 : this.compare(row, column)\n    }, this.compareEnd = function(row, column) {\n      return this.end.row == row && this.end.column == column ? 1 : this.compare(row, column)\n    }, this.compareInside = function(row, column) {\n      return this.end.row == row && this.end.column == column ? 1 : this.start.row == row && this.start.column == column ? -1 : this.compare(row, column)\n    }, this.clipRows = function(firstRow, lastRow) {\n      if (this.end.row > lastRow) var end = {\n        row: lastRow + 1,\n        column: 0\n      };\n      else if (firstRow > this.end.row) var end = {\n        row: firstRow,\n        column: 0\n      };\n      if (this.start.row > lastRow) var start = {\n        row: lastRow + 1,\n        column: 0\n      };\n      else if (firstRow > this.start.row) var start = {\n        row: firstRow,\n        column: 0\n      };\n      return Range.fromPoints(start || this.start, end || this.end)\n    }, this.extend = function(row, column) {\n      var cmp = this.compare(row, column);\n      if (0 == cmp) return this;\n      if (-1 == cmp) var start = {\n        row: row,\n        column: column\n      };\n      else var end = {\n        row: row,\n        column: column\n      };\n      return Range.fromPoints(start || this.start, end || this.end)\n    }, this.isEmpty = function() {\n      return this.start.row === this.end.row && this.start.column === this.end.column\n    }, this.isMultiLine = function() {\n      return this.start.row !== this.end.row\n    }, this.clone = function() {\n      return Range.fromPoints(this.start, this.end)\n    }, this.collapseRows = function() {\n      return 0 == this.end.column ? new Range(this.start.row, 0, Math.max(this.start.row, this.end.row - 1), 0) : new Range(this.start.row, 0, this.end.row, 0)\n    }, this.toScreenRange = function(session) {\n      var screenPosStart = session.documentToScreenPosition(this.start),\n        screenPosEnd = session.documentToScreenPosition(this.end);\n      return new Range(screenPosStart.row, screenPosStart.column, screenPosEnd.row, screenPosEnd.column)\n    }, this.moveBy = function(row, column) {\n      this.start.row += row, this.start.column += column, this.end.row += row, this.end.column += column\n    }\n  }).call(Range.prototype), Range.fromPoints = function(start, end) {\n    return new Range(start.row, start.column, end.row, end.column)\n  }, Range.comparePoints = comparePoints, Range.comparePoints = function(p1, p2) {\n    return p1.row - p2.row || p1.column - p2.column\n  }, exports.Range = Range\n}), ace.define("ace/apply_delta", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  exports.applyDelta = function(docLines, delta) {\n    var row = delta.start.row,\n      startColumn = delta.start.column,\n      line = docLines[row] || "";\n    switch (delta.action) {\n      case "insert":\n        var lines = delta.lines;\n        if (1 === lines.length) docLines[row] = line.substring(0, startColumn) + delta.lines[0] + line.substring(startColumn);\n        else {\n          var args = [row, 1].concat(delta.lines);\n          docLines.splice.apply(docLines, args), docLines[row] = line.substring(0, startColumn) + docLines[row], docLines[row + delta.lines.length - 1] += line.substring(startColumn)\n        }\n        break;\n      case "remove":\n        var endColumn = delta.end.column,\n          endRow = delta.end.row;\n        row === endRow ? docLines[row] = line.substring(0, startColumn) + line.substring(endColumn) : docLines.splice(row, endRow - row + 1, line.substring(0, startColumn) + docLines[endRow].substring(endColumn))\n    }\n  }\n}), ace.define("ace/lib/event_emitter", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  var EventEmitter = {},\n    stopPropagation = function() {\n      this.propagationStopped = !0\n    },\n    preventDefault = function() {\n      this.defaultPrevented = !0\n    };\n  EventEmitter._emit = EventEmitter._dispatchEvent = function(eventName, e) {\n    this._eventRegistry || (this._eventRegistry = {}), this._defaultHandlers || (this._defaultHandlers = {});\n    var listeners = this._eventRegistry[eventName] || [],\n      defaultHandler = this._defaultHandlers[eventName];\n    if (listeners.length || defaultHandler) {\n      "object" == typeof e && e || (e = {}), e.type || (e.type = eventName), e.stopPropagation || (e.stopPropagation = stopPropagation), e.preventDefault || (e.preventDefault = preventDefault), listeners = listeners.slice();\n      for (var i = 0; listeners.length > i && (listeners[i](e, this), !e.propagationStopped); i++);\n      return defaultHandler && !e.defaultPrevented ? defaultHandler(e, this) : void 0\n    }\n  }, EventEmitter._signal = function(eventName, e) {\n    var listeners = (this._eventRegistry || {})[eventName];\n    if (listeners) {\n      listeners = listeners.slice();\n      for (var i = 0; listeners.length > i; i++) listeners[i](e, this)\n    }\n  }, EventEmitter.once = function(eventName, callback) {\n    var _self = this;\n    callback && this.addEventListener(eventName, function newCallback() {\n      _self.removeEventListener(eventName, newCallback), callback.apply(null, arguments)\n    })\n  }, EventEmitter.setDefaultHandler = function(eventName, callback) {\n    var handlers = this._defaultHandlers;\n    if (handlers || (handlers = this._defaultHandlers = {\n        _disabled_: {}\n      }), handlers[eventName]) {\n      var old = handlers[eventName],\n        disabled = handlers._disabled_[eventName];\n      disabled || (handlers._disabled_[eventName] = disabled = []), disabled.push(old);\n      var i = disabled.indexOf(callback); - 1 != i && disabled.splice(i, 1)\n    }\n    handlers[eventName] = callback\n  }, EventEmitter.removeDefaultHandler = function(eventName, callback) {\n    var handlers = this._defaultHandlers;\n    if (handlers) {\n      var disabled = handlers._disabled_[eventName];\n      if (handlers[eventName] == callback) handlers[eventName], disabled && this.setDefaultHandler(eventName, disabled.pop());\n      else if (disabled) {\n        var i = disabled.indexOf(callback); - 1 != i && disabled.splice(i, 1)\n      }\n    }\n  }, EventEmitter.on = EventEmitter.addEventListener = function(eventName, callback, capturing) {\n    this._eventRegistry = this._eventRegistry || {};\n    var listeners = this._eventRegistry[eventName];\n    return listeners || (listeners = this._eventRegistry[eventName] = []), -1 == listeners.indexOf(callback) && listeners[capturing ? "unshift" : "push"](callback), callback\n  }, EventEmitter.off = EventEmitter.removeListener = EventEmitter.removeEventListener = function(eventName, callback) {\n    this._eventRegistry = this._eventRegistry || {};\n    var listeners = this._eventRegistry[eventName];\n    if (listeners) {\n      var index = listeners.indexOf(callback); - 1 !== index && listeners.splice(index, 1)\n    }\n  }, EventEmitter.removeAllListeners = function(eventName) {\n    this._eventRegistry && (this._eventRegistry[eventName] = [])\n  }, exports.EventEmitter = EventEmitter\n}), ace.define("ace/anchor", ["require", "exports", "module", "ace/lib/oop", "ace/lib/event_emitter"], function(acequire, exports) {\n  "use strict";\n  var oop = acequire("./lib/oop"),\n    EventEmitter = acequire("./lib/event_emitter").EventEmitter,\n    Anchor = exports.Anchor = function(doc, row, column) {\n      this.$onChange = this.onChange.bind(this), this.attach(doc), column === void 0 ? this.setPosition(row.row, row.column) : this.setPosition(row, column)\n    };\n  (function() {\n    function $pointsInOrder(point1, point2, equalPointsInOrder) {\n      var bColIsAfter = equalPointsInOrder ? point1.column <= point2.column : point1.column < point2.column;\n      return point1.row < point2.row || point1.row == point2.row && bColIsAfter\n    }\n\n    function $getTransformedPoint(delta, point, moveIfEqual) {\n      var deltaIsInsert = "insert" == delta.action,\n        deltaRowShift = (deltaIsInsert ? 1 : -1) * (delta.end.row - delta.start.row),\n        deltaColShift = (deltaIsInsert ? 1 : -1) * (delta.end.column - delta.start.column),\n        deltaStart = delta.start,\n        deltaEnd = deltaIsInsert ? deltaStart : delta.end;\n      return $pointsInOrder(point, deltaStart, moveIfEqual) ? {\n        row: point.row,\n        column: point.column\n      } : $pointsInOrder(deltaEnd, point, !moveIfEqual) ? {\n        row: point.row + deltaRowShift,\n        column: point.column + (point.row == deltaEnd.row ? deltaColShift : 0)\n      } : {\n        row: deltaStart.row,\n        column: deltaStart.column\n      }\n    }\n    oop.implement(this, EventEmitter), this.getPosition = function() {\n      return this.$clipPositionToDocument(this.row, this.column)\n    }, this.getDocument = function() {\n      return this.document\n    }, this.$insertRight = !1, this.onChange = function(delta) {\n      if (!(delta.start.row == delta.end.row && delta.start.row != this.row || delta.start.row > this.row)) {\n        var point = $getTransformedPoint(delta, {\n          row: this.row,\n          column: this.column\n        }, this.$insertRight);\n        this.setPosition(point.row, point.column, !0)\n      }\n    }, this.setPosition = function(row, column, noClip) {\n      var pos;\n      if (pos = noClip ? {\n          row: row,\n          column: column\n        } : this.$clipPositionToDocument(row, column), this.row != pos.row || this.column != pos.column) {\n        var old = {\n          row: this.row,\n          column: this.column\n        };\n        this.row = pos.row, this.column = pos.column, this._signal("change", {\n          old: old,\n          value: pos\n        })\n      }\n    }, this.detach = function() {\n      this.document.removeEventListener("change", this.$onChange)\n    }, this.attach = function(doc) {\n      this.document = doc || this.document, this.document.on("change", this.$onChange)\n    }, this.$clipPositionToDocument = function(row, column) {\n      var pos = {};\n      return row >= this.document.getLength() ? (pos.row = Math.max(0, this.document.getLength() - 1), pos.column = this.document.getLine(pos.row).length) : 0 > row ? (pos.row = 0, pos.column = 0) : (pos.row = row, pos.column = Math.min(this.document.getLine(pos.row).length, Math.max(0, column))), 0 > column && (pos.column = 0), pos\n    }\n  }).call(Anchor.prototype)\n}), ace.define("ace/document", ["require", "exports", "module", "ace/lib/oop", "ace/apply_delta", "ace/lib/event_emitter", "ace/range", "ace/anchor"], function(acequire, exports) {\n  "use strict";\n  var oop = acequire("./lib/oop"),\n    applyDelta = acequire("./apply_delta").applyDelta,\n    EventEmitter = acequire("./lib/event_emitter").EventEmitter,\n    Range = acequire("./range").Range,\n    Anchor = acequire("./anchor").Anchor,\n    Document = function(textOrLines) {\n      this.$lines = [""], 0 === textOrLines.length ? this.$lines = [""] : Array.isArray(textOrLines) ? this.insertMergedLines({\n        row: 0,\n        column: 0\n      }, textOrLines) : this.insert({\n        row: 0,\n        column: 0\n      }, textOrLines)\n    };\n  (function() {\n    oop.implement(this, EventEmitter), this.setValue = function(text) {\n      var len = this.getLength() - 1;\n      this.remove(new Range(0, 0, len, this.getLine(len).length)), this.insert({\n        row: 0,\n        column: 0\n      }, text)\n    }, this.getValue = function() {\n      return this.getAllLines().join(this.getNewLineCharacter())\n    }, this.createAnchor = function(row, column) {\n      return new Anchor(this, row, column)\n    }, this.$split = 0 === "aaa".split(/a/).length ? function(text) {\n      return text.replace(/\\r\\n|\\r/g, "\\n").split("\\n")\n    } : function(text) {\n      return text.split(/\\r\\n|\\r|\\n/)\n    }, this.$detectNewLine = function(text) {\n      var match = text.match(/^.*?(\\r\\n|\\r|\\n)/m);\n      this.$autoNewLine = match ? match[1] : "\\n", this._signal("changeNewLineMode")\n    }, this.getNewLineCharacter = function() {\n      switch (this.$newLineMode) {\n        case "windows":\n          return "\\r\\n";\n        case "unix":\n          return "\\n";\n        default:\n          return this.$autoNewLine || "\\n"\n      }\n    }, this.$autoNewLine = "", this.$newLineMode = "auto", this.setNewLineMode = function(newLineMode) {\n      this.$newLineMode !== newLineMode && (this.$newLineMode = newLineMode, this._signal("changeNewLineMode"))\n    }, this.getNewLineMode = function() {\n      return this.$newLineMode\n    }, this.isNewLine = function(text) {\n      return "\\r\\n" == text || "\\r" == text || "\\n" == text\n    }, this.getLine = function(row) {\n      return this.$lines[row] || ""\n    }, this.getLines = function(firstRow, lastRow) {\n      return this.$lines.slice(firstRow, lastRow + 1)\n    }, this.getAllLines = function() {\n      return this.getLines(0, this.getLength())\n    }, this.getLength = function() {\n      return this.$lines.length\n    }, this.getTextRange = function(range) {\n      return this.getLinesForRange(range).join(this.getNewLineCharacter())\n    }, this.getLinesForRange = function(range) {\n      var lines;\n      if (range.start.row === range.end.row) lines = [this.getLine(range.start.row).substring(range.start.column, range.end.column)];\n      else {\n        lines = this.getLines(range.start.row, range.end.row), lines[0] = (lines[0] || "").substring(range.start.column);\n        var l = lines.length - 1;\n        range.end.row - range.start.row == l && (lines[l] = lines[l].substring(0, range.end.column))\n      }\n      return lines\n    }, this.insertLines = function(row, lines) {\n      return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."), this.insertFullLines(row, lines)\n    }, this.removeLines = function(firstRow, lastRow) {\n      return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."), this.removeFullLines(firstRow, lastRow)\n    }, this.insertNewLine = function(position) {\n      return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, [\'\', \'\']) instead."), this.insertMergedLines(position, ["", ""])\n    }, this.insert = function(position, text) {\n      return 1 >= this.getLength() && this.$detectNewLine(text), this.insertMergedLines(position, this.$split(text))\n    }, this.insertInLine = function(position, text) {\n      var start = this.clippedPos(position.row, position.column),\n        end = this.pos(position.row, position.column + text.length);\n      return this.applyDelta({\n        start: start,\n        end: end,\n        action: "insert",\n        lines: [text]\n      }, !0), this.clonePos(end)\n    }, this.clippedPos = function(row, column) {\n      var length = this.getLength();\n      void 0 === row ? row = length : 0 > row ? row = 0 : row >= length && (row = length - 1, column = void 0);\n      var line = this.getLine(row);\n      return void 0 == column && (column = line.length), column = Math.min(Math.max(column, 0), line.length), {\n        row: row,\n        column: column\n      }\n    }, this.clonePos = function(pos) {\n      return {\n        row: pos.row,\n        column: pos.column\n      }\n    }, this.pos = function(row, column) {\n      return {\n        row: row,\n        column: column\n      }\n    }, this.$clipPosition = function(position) {\n      var length = this.getLength();\n      return position.row >= length ? (position.row = Math.max(0, length - 1), position.column = this.getLine(length - 1).length) : (position.row = Math.max(0, position.row), position.column = Math.min(Math.max(position.column, 0), this.getLine(position.row).length)), position\n    }, this.insertFullLines = function(row, lines) {\n      row = Math.min(Math.max(row, 0), this.getLength());\n      var column = 0;\n      this.getLength() > row ? (lines = lines.concat([""]), column = 0) : (lines = [""].concat(lines), row--, column = this.$lines[row].length), this.insertMergedLines({\n        row: row,\n        column: column\n      }, lines)\n    }, this.insertMergedLines = function(position, lines) {\n      var start = this.clippedPos(position.row, position.column),\n        end = {\n          row: start.row + lines.length - 1,\n          column: (1 == lines.length ? start.column : 0) + lines[lines.length - 1].length\n        };\n      return this.applyDelta({\n        start: start,\n        end: end,\n        action: "insert",\n        lines: lines\n      }), this.clonePos(end)\n    }, this.remove = function(range) {\n      var start = this.clippedPos(range.start.row, range.start.column),\n        end = this.clippedPos(range.end.row, range.end.column);\n      return this.applyDelta({\n        start: start,\n        end: end,\n        action: "remove",\n        lines: this.getLinesForRange({\n          start: start,\n          end: end\n        })\n      }), this.clonePos(start)\n    }, this.removeInLine = function(row, startColumn, endColumn) {\n      var start = this.clippedPos(row, startColumn),\n        end = this.clippedPos(row, endColumn);\n      return this.applyDelta({\n        start: start,\n        end: end,\n        action: "remove",\n        lines: this.getLinesForRange({\n          start: start,\n          end: end\n        })\n      }, !0), this.clonePos(start)\n    }, this.removeFullLines = function(firstRow, lastRow) {\n      firstRow = Math.min(Math.max(0, firstRow), this.getLength() - 1), lastRow = Math.min(Math.max(0, lastRow), this.getLength() - 1);\n      var deleteFirstNewLine = lastRow == this.getLength() - 1 && firstRow > 0,\n        deleteLastNewLine = this.getLength() - 1 > lastRow,\n        startRow = deleteFirstNewLine ? firstRow - 1 : firstRow,\n        startCol = deleteFirstNewLine ? this.getLine(startRow).length : 0,\n        endRow = deleteLastNewLine ? lastRow + 1 : lastRow,\n        endCol = deleteLastNewLine ? 0 : this.getLine(endRow).length,\n        range = new Range(startRow, startCol, endRow, endCol),\n        deletedLines = this.$lines.slice(firstRow, lastRow + 1);\n      return this.applyDelta({\n        start: range.start,\n        end: range.end,\n        action: "remove",\n        lines: this.getLinesForRange(range)\n      }), deletedLines\n    }, this.removeNewLine = function(row) {\n      this.getLength() - 1 > row && row >= 0 && this.applyDelta({\n        start: this.pos(row, this.getLine(row).length),\n        end: this.pos(row + 1, 0),\n        action: "remove",\n        lines: ["", ""]\n      })\n    }, this.replace = function(range, text) {\n      if (range instanceof Range || (range = Range.fromPoints(range.start, range.end)), 0 === text.length && range.isEmpty()) return range.start;\n      if (text == this.getTextRange(range)) return range.end;\n      this.remove(range);\n      var end;\n      return end = text ? this.insert(range.start, text) : range.start\n    }, this.applyDeltas = function(deltas) {\n      for (var i = 0; deltas.length > i; i++) this.applyDelta(deltas[i])\n    }, this.revertDeltas = function(deltas) {\n      for (var i = deltas.length - 1; i >= 0; i--) this.revertDelta(deltas[i])\n    }, this.applyDelta = function(delta, doNotValidate) {\n      var isInsert = "insert" == delta.action;\n      (isInsert ? 1 >= delta.lines.length && !delta.lines[0] : !Range.comparePoints(delta.start, delta.end)) || (isInsert && delta.lines.length > 2e4 && this.$splitAndapplyLargeDelta(delta, 2e4), applyDelta(this.$lines, delta, doNotValidate), this._signal("change", delta))\n    }, this.$splitAndapplyLargeDelta = function(delta, MAX) {\n      for (var lines = delta.lines, l = lines.length, row = delta.start.row, column = delta.start.column, from = 0, to = 0;;) {\n        from = to, to += MAX - 1;\n        var chunk = lines.slice(from, to);\n        if (to > l) {\n          delta.lines = chunk, delta.start.row = row + from, delta.start.column = column;\n          break\n        }\n        chunk.push(""), this.applyDelta({\n          start: this.pos(row + from, column),\n          end: this.pos(row + to, column = 0),\n          action: delta.action,\n          lines: chunk\n        }, !0)\n      }\n    }, this.revertDelta = function(delta) {\n      this.applyDelta({\n        start: this.clonePos(delta.start),\n        end: this.clonePos(delta.end),\n        action: "insert" == delta.action ? "remove" : "insert",\n        lines: delta.lines.slice()\n      })\n    }, this.indexToPosition = function(index, startRow) {\n      for (var lines = this.$lines || this.getAllLines(), newlineLength = this.getNewLineCharacter().length, i = startRow || 0, l = lines.length; l > i; i++)\n        if (index -= lines[i].length + newlineLength, 0 > index) return {\n          row: i,\n          column: index + lines[i].length + newlineLength\n        };\n      return {\n        row: l - 1,\n        column: lines[l - 1].length\n      }\n    }, this.positionToIndex = function(pos, startRow) {\n      for (var lines = this.$lines || this.getAllLines(), newlineLength = this.getNewLineCharacter().length, index = 0, row = Math.min(pos.row, lines.length), i = startRow || 0; row > i; ++i) index += lines[i].length + newlineLength;\n      return index + pos.column\n    }\n  }).call(Document.prototype), exports.Document = Document\n}), ace.define("ace/lib/lang", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  exports.last = function(a) {\n    return a[a.length - 1]\n  }, exports.stringReverse = function(string) {\n    return string.split("").reverse().join("")\n  }, exports.stringRepeat = function(string, count) {\n    for (var result = ""; count > 0;) 1 & count && (result += string), (count >>= 1) && (string += string);\n    return result\n  };\n  var trimBeginRegexp = /^\\s\\s*/,\n    trimEndRegexp = /\\s\\s*$/;\n  exports.stringTrimLeft = function(string) {\n    return string.replace(trimBeginRegexp, "")\n  }, exports.stringTrimRight = function(string) {\n    return string.replace(trimEndRegexp, "")\n  }, exports.copyObject = function(obj) {\n    var copy = {};\n    for (var key in obj) copy[key] = obj[key];\n    return copy\n  }, exports.copyArray = function(array) {\n    for (var copy = [], i = 0, l = array.length; l > i; i++) copy[i] = array[i] && "object" == typeof array[i] ? this.copyObject(array[i]) : array[i];\n    return copy\n  }, exports.deepCopy = function deepCopy(obj) {\n    if ("object" != typeof obj || !obj) return obj;\n    var copy;\n    if (Array.isArray(obj)) {\n      copy = [];\n      for (var key = 0; obj.length > key; key++) copy[key] = deepCopy(obj[key]);\n      return copy\n    }\n    if ("[object Object]" !== Object.prototype.toString.call(obj)) return obj;\n    copy = {};\n    for (var key in obj) copy[key] = deepCopy(obj[key]);\n    return copy\n  }, exports.arrayToMap = function(arr) {\n    for (var map = {}, i = 0; arr.length > i; i++) map[arr[i]] = 1;\n    return map\n  }, exports.createMap = function(props) {\n    var map = Object.create(null);\n    for (var i in props) map[i] = props[i];\n    return map\n  }, exports.arrayRemove = function(array, value) {\n    for (var i = 0; array.length >= i; i++) value === array[i] && array.splice(i, 1)\n  }, exports.escapeRegExp = function(str) {\n    return str.replace(/([.*+?^${}()|[\\]\\/\\\\])/g, "\\\\$1")\n  }, exports.escapeHTML = function(str) {\n    return str.replace(/&/g, "&#38;").replace(/"/g, "&#34;").replace(/\'/g, "&#39;").replace(/</g, "&#60;")\n  }, exports.getMatchOffsets = function(string, regExp) {\n    var matches = [];\n    return string.replace(regExp, function(str) {\n      matches.push({\n        offset: arguments[arguments.length - 2],\n        length: str.length\n      })\n    }), matches\n  }, exports.deferredCall = function(fcn) {\n    var timer = null,\n      callback = function() {\n        timer = null, fcn()\n      },\n      deferred = function(timeout) {\n        return deferred.cancel(), timer = setTimeout(callback, timeout || 0), deferred\n      };\n    return deferred.schedule = deferred, deferred.call = function() {\n      return this.cancel(), fcn(), deferred\n    }, deferred.cancel = function() {\n      return clearTimeout(timer), timer = null, deferred\n    }, deferred.isPending = function() {\n      return timer\n    }, deferred\n  }, exports.delayedCall = function(fcn, defaultTimeout) {\n    var timer = null,\n      callback = function() {\n        timer = null, fcn()\n      },\n      _self = function(timeout) {\n        null == timer && (timer = setTimeout(callback, timeout || defaultTimeout))\n      };\n    return _self.delay = function(timeout) {\n      timer && clearTimeout(timer), timer = setTimeout(callback, timeout || defaultTimeout)\n    }, _self.schedule = _self, _self.call = function() {\n      this.cancel(), fcn()\n    }, _self.cancel = function() {\n      timer && clearTimeout(timer), timer = null\n    }, _self.isPending = function() {\n      return timer\n    }, _self\n  }\n}), ace.define("ace/worker/mirror", ["require", "exports", "module", "ace/range", "ace/document", "ace/lib/lang"], function(acequire, exports) {\n  "use strict";\n  acequire("../range").Range;\n  var Document = acequire("../document").Document,\n    lang = acequire("../lib/lang"),\n    Mirror = exports.Mirror = function(sender) {\n      this.sender = sender;\n      var doc = this.doc = new Document(""),\n        deferredUpdate = this.deferredUpdate = lang.delayedCall(this.onUpdate.bind(this)),\n        _self = this;\n      sender.on("change", function(e) {\n        var data = e.data;\n        if (data[0].start) doc.applyDeltas(data);\n        else\n          for (var i = 0; data.length > i; i += 2) {\n            if (Array.isArray(data[i + 1])) var d = {\n              action: "insert",\n              start: data[i],\n              lines: data[i + 1]\n            };\n            else var d = {\n              action: "remove",\n              start: data[i],\n              end: data[i + 1]\n            };\n            doc.applyDelta(d, !0)\n          }\n        return _self.$timeout ? deferredUpdate.schedule(_self.$timeout) : (_self.onUpdate(), void 0)\n      })\n    };\n  (function() {\n    this.$timeout = 500, this.setTimeout = function(timeout) {\n      this.$timeout = timeout\n    }, this.setValue = function(value) {\n      this.doc.setValue(value), this.deferredUpdate.schedule(this.$timeout)\n    }, this.getValue = function(callbackId) {\n      this.sender.callback(this.doc.getValue(), callbackId)\n    }, this.onUpdate = function() {}, this.isPending = function() {\n      return this.deferredUpdate.isPending()\n    }\n  }).call(Mirror.prototype)\n}), ace.define("ace/mode/json/json_parse", ["require", "exports", "module"], function() {\n  "use strict";\n  var at, ch, text, value, escapee = {\n      \'"\': \'"\',\n      "\\\\": "\\\\",\n      "/": "/",\n      b: "\\b",\n      f: "\\f",\n      n: "\\n",\n      r: "\\r",\n      t: "\t"\n    },\n    error = function(m) {\n      throw {\n        name: "SyntaxError",\n        message: m,\n        at: at,\n        text: text\n      }\n    },\n    reset = function (newAt) {\n      ch = text.charAt(newAt);\n      at = newAt + 1;\n    },\n    next = function(c) {\n      return c && c !== ch && error("Expected \'" + c + "\' instead of \'" + ch + "\'"), ch = text.charAt(at), at += 1, ch\n    },\n    nextUpTo = function (upTo, errorMessage) {\n      let currentAt = at,\n        i = text.indexOf(upTo, currentAt);\n      if (i < 0) {\n        error(errorMessage || \'Expected \\\'\' + upTo + \'\\\'\');\n      }\n      reset(i + upTo.length);\n      return text.substring(currentAt, i);\n    },\n    peek = function (c) {\n      return text.substr(at, c.length) === c; // nocommit - double check\n    },\n    number = function() {\n      var number, string = "";\n      for ("-" === ch && (string = "-", next("-")); ch >= "0" && "9" >= ch;) string += ch, next();\n      if ("." === ch)\n        for (string += "."; next() && ch >= "0" && "9" >= ch;) string += ch;\n      if ("e" === ch || "E" === ch)\n        for (string += ch, next(), ("-" === ch || "+" === ch) && (string += ch, next()); ch >= "0" && "9" >= ch;) string += ch, next();\n      return number = +string, isNaN(number) ? (error("Bad number"), void 0) : number\n    },\n    string = function() {\n      var hex, i, uffff, string = "";\n      if (\'"\' === ch) {\n        if (peek(\'""\')) {\n          // literal\n          next(\'"\');\n          next(\'"\');\n          return nextUpTo(\'"""\', \'failed to find closing \\\'"""\\\'\');\n        } else {\n          for (; next();) {\n            if (\'"\' === ch) return next(), string;\n            if ("\\\\" === ch)\n              if (next(), "u" === ch) {\n                for (uffff = 0, i = 0; 4 > i && (hex = parseInt(next(), 16), isFinite(hex)); i += 1) uffff = 16 * uffff + hex;\n                string += String.fromCharCode(uffff)\n              } else {\n                if ("string" != typeof escapee[ch]) break;\n                string += escapee[ch]\n              }\n            else string += ch\n          }\n        }\n      }\n      error("Bad string")\n    },\n    white = function() {\n      for (; ch && " " >= ch;) next()\n    },\n    word = function() {\n      switch (ch) {\n        case "t":\n          return next("t"), next("r"), next("u"), next("e"), !0;\n        case "f":\n          return next("f"), next("a"), next("l"), next("s"), next("e"), !1;\n        case "n":\n          return next("n"), next("u"), next("l"), next("l"), null\n      }\n      error("Unexpected \'" + ch + "\'")\n    },\n    array = function() {\n      var array = [];\n      if ("[" === ch) {\n        if (next("["), white(), "]" === ch) return next("]"), array;\n        for (; ch;) {\n          if (array.push(value()), white(), "]" === ch) return next("]"), array;\n          next(","), white()\n        }\n      }\n      error("Bad array")\n    },\n    object = function() {\n      var key, object = {};\n      if ("{" === ch) {\n        if (next("{"), white(), "}" === ch) return next("}"), object;\n        for (; ch;) {\n          if (key = string(), white(), next(":"), Object.hasOwnProperty.call(object, key) && error(\'Duplicate key "\' + key + \'"\'), object[key] = value(), white(), "}" === ch) return next("}"), object;\n          next(","), white()\n        }\n      }\n      error("Bad object")\n    };\n  return value = function() {\n      switch (white(), ch) {\n        case "{":\n          return object();\n        case "[":\n          return array();\n        case \'"\':\n          return string();\n        case "-":\n          return number();\n        default:\n          return ch >= "0" && "9" >= ch ? number() : word()\n      }\n    },\n    function(source, reviver) {\n      var result;\n      return text = source, at = 0, ch = " ", result = value(), white(), ch && error("Syntax error"), "function" == typeof reviver ? function walk(holder, key) {\n        var k, v, value = holder[key];\n        if (value && "object" == typeof value)\n          for (k in value) Object.hasOwnProperty.call(value, k) && (v = walk(value, k), void 0 !== v ? value[k] = v : delete value[k]);\n        return reviver.call(holder, key, value)\n      }({\n        "": result\n      }, "") : result\n    }\n}), ace.define("ace/mode/json_worker", ["require", "exports", "module", "ace/lib/oop", "ace/worker/mirror", "ace/mode/json/json_parse"], function(acequire, exports) {\n  "use strict";\n  var oop = acequire("../lib/oop"),\n    Mirror = acequire("../worker/mirror").Mirror,\n    parse = acequire("./json/json_parse"),\n    JsonWorker = exports.JsonWorker = function(sender) {\n      Mirror.call(this, sender), this.setTimeout(200)\n    };\n  oop.inherits(JsonWorker, Mirror),\n    function() {\n      this.onUpdate = function() {\n        var value = this.doc.getValue(),\n          errors = [];\n        try {\n          value && parse(value)\n        } catch (e) {\n          var pos = this.doc.indexToPosition(e.at - 1);\n          errors.push({\n            row: pos.row,\n            column: pos.column,\n            text: e.message,\n            type: "error"\n          })\n        }\n        this.sender.emit("annotate", errors)\n      }\n    }.call(JsonWorker.prototype)\n}), ace.define("ace/lib/es5-shim", ["require", "exports", "module"], function() {\n  function Empty() {}\n\n  function doesDefinePropertyWork(object) {\n    try {\n      return Object.defineProperty(object, "sentinel", {}), "sentinel" in object\n    } catch (exception) {}\n  }\n\n  function toInteger(n) {\n    return n = +n, n !== n ? n = 0 : 0 !== n && n !== 1 / 0 && n !== -(1 / 0) && (n = (n > 0 || -1) * Math.floor(Math.abs(n))), n\n  }\n  Function.prototype.bind || (Function.prototype.bind = function(that) {\n    var target = this;\n    if ("function" != typeof target) throw new TypeError("Function.prototype.bind called on incompatible " + target);\n    var args = slice.call(arguments, 1),\n      bound = function() {\n        if (this instanceof bound) {\n          var result = target.apply(this, args.concat(slice.call(arguments)));\n          return Object(result) === result ? result : this\n        }\n        return target.apply(that, args.concat(slice.call(arguments)))\n      };\n    return target.prototype && (Empty.prototype = target.prototype, bound.prototype = new Empty, Empty.prototype = null), bound\n  });\n  var defineGetter, defineSetter, lookupGetter, lookupSetter, supportsAccessors, call = Function.prototype.call,\n    prototypeOfArray = Array.prototype,\n    prototypeOfObject = Object.prototype,\n    slice = prototypeOfArray.slice,\n    _toString = call.bind(prototypeOfObject.toString),\n    owns = call.bind(prototypeOfObject.hasOwnProperty);\n  if ((supportsAccessors = owns(prototypeOfObject, "__defineGetter__")) && (defineGetter = call.bind(prototypeOfObject.__defineGetter__), defineSetter = call.bind(prototypeOfObject.__defineSetter__), lookupGetter = call.bind(prototypeOfObject.__lookupGetter__), lookupSetter = call.bind(prototypeOfObject.__lookupSetter__)), 2 != [1, 2].splice(0).length)\n    if (function() {\n        function makeArray(l) {\n          var a = Array(l + 2);\n          return a[0] = a[1] = 0, a\n        }\n        var lengthBefore, array = [];\n        return array.splice.apply(array, makeArray(20)), array.splice.apply(array, makeArray(26)), lengthBefore = array.length, array.splice(5, 0, "XXX"), lengthBefore + 1 == array.length, lengthBefore + 1 == array.length ? !0 : void 0\n      }()) {\n      var array_splice = Array.prototype.splice;\n      Array.prototype.splice = function(start, deleteCount) {\n        return arguments.length ? array_splice.apply(this, [void 0 === start ? 0 : start, void 0 === deleteCount ? this.length - start : deleteCount].concat(slice.call(arguments, 2))) : []\n      }\n    } else Array.prototype.splice = function(pos, removeCount) {\n      var length = this.length;\n      pos > 0 ? pos > length && (pos = length) : void 0 == pos ? pos = 0 : 0 > pos && (pos = Math.max(length + pos, 0)), length > pos + removeCount || (removeCount = length - pos);\n      var removed = this.slice(pos, pos + removeCount),\n        insert = slice.call(arguments, 2),\n        add = insert.length;\n      if (pos === length) add && this.push.apply(this, insert);\n      else {\n        var remove = Math.min(removeCount, length - pos),\n          tailOldPos = pos + remove,\n          tailNewPos = tailOldPos + add - remove,\n          tailCount = length - tailOldPos,\n          lengthAfterRemove = length - remove;\n        if (tailOldPos > tailNewPos)\n          for (var i = 0; tailCount > i; ++i) this[tailNewPos + i] = this[tailOldPos + i];\n        else if (tailNewPos > tailOldPos)\n          for (i = tailCount; i--;) this[tailNewPos + i] = this[tailOldPos + i];\n        if (add && pos === lengthAfterRemove) this.length = lengthAfterRemove, this.push.apply(this, insert);\n        else\n          for (this.length = lengthAfterRemove + add, i = 0; add > i; ++i) this[pos + i] = insert[i]\n      }\n      return removed\n    };\n  Array.isArray || (Array.isArray = function(obj) {\n    return "[object Array]" == _toString(obj)\n  });\n  var boxedString = Object("a"),\n    splitString = "a" != boxedString[0] || !(0 in boxedString);\n  if (Array.prototype.forEach || (Array.prototype.forEach = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        thisp = arguments[1],\n        i = -1,\n        length = self.length >>> 0;\n      if ("[object Function]" != _toString(fun)) throw new TypeError;\n      for (; length > ++i;) i in self && fun.call(thisp, self[i], i, object)\n    }), Array.prototype.map || (Array.prototype.map = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0,\n        result = Array(length),\n        thisp = arguments[1];\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      for (var i = 0; length > i; i++) i in self && (result[i] = fun.call(thisp, self[i], i, object));\n      return result\n    }), Array.prototype.filter || (Array.prototype.filter = function(fun) {\n      var value, object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0,\n        result = [],\n        thisp = arguments[1];\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      for (var i = 0; length > i; i++) i in self && (value = self[i], fun.call(thisp, value, i, object) && result.push(value));\n      return result\n    }), Array.prototype.every || (Array.prototype.every = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0,\n        thisp = arguments[1];\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      for (var i = 0; length > i; i++)\n        if (i in self && !fun.call(thisp, self[i], i, object)) return !1;\n      return !0\n    }), Array.prototype.some || (Array.prototype.some = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0,\n        thisp = arguments[1];\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      for (var i = 0; length > i; i++)\n        if (i in self && fun.call(thisp, self[i], i, object)) return !0;\n      return !1\n    }), Array.prototype.reduce || (Array.prototype.reduce = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0;\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      if (!length && 1 == arguments.length) throw new TypeError("reduce of empty array with no initial value");\n      var result, i = 0;\n      if (arguments.length >= 2) result = arguments[1];\n      else\n        for (;;) {\n          if (i in self) {\n            result = self[i++];\n            break\n          }\n          if (++i >= length) throw new TypeError("reduce of empty array with no initial value")\n        }\n      for (; length > i; i++) i in self && (result = fun.call(void 0, result, self[i], i, object));\n      return result\n    }), Array.prototype.reduceRight || (Array.prototype.reduceRight = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0;\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      if (!length && 1 == arguments.length) throw new TypeError("reduceRight of empty array with no initial value");\n      var result, i = length - 1;\n      if (arguments.length >= 2) result = arguments[1];\n      else\n        for (;;) {\n          if (i in self) {\n            result = self[i--];\n            break\n          }\n          if (0 > --i) throw new TypeError("reduceRight of empty array with no initial value")\n        }\n      do i in this && (result = fun.call(void 0, result, self[i], i, object)); while (i--);\n      return result\n    }), Array.prototype.indexOf && -1 == [0, 1].indexOf(1, 2) || (Array.prototype.indexOf = function(sought) {\n      var self = splitString && "[object String]" == _toString(this) ? this.split("") : toObject(this),\n        length = self.length >>> 0;\n      if (!length) return -1;\n      var i = 0;\n      for (arguments.length > 1 && (i = toInteger(arguments[1])), i = i >= 0 ? i : Math.max(0, length + i); length > i; i++)\n        if (i in self && self[i] === sought) return i;\n      return -1\n    }), Array.prototype.lastIndexOf && -1 == [0, 1].lastIndexOf(0, -3) || (Array.prototype.lastIndexOf = function(sought) {\n      var self = splitString && "[object String]" == _toString(this) ? this.split("") : toObject(this),\n        length = self.length >>> 0;\n      if (!length) return -1;\n      var i = length - 1;\n      for (arguments.length > 1 && (i = Math.min(i, toInteger(arguments[1]))), i = i >= 0 ? i : length - Math.abs(i); i >= 0; i--)\n        if (i in self && sought === self[i]) return i;\n      return -1\n    }), Object.getPrototypeOf || (Object.getPrototypeOf = function(object) {\n      return object.__proto__ || (object.constructor ? object.constructor.prototype : prototypeOfObject)\n    }), !Object.getOwnPropertyDescriptor) {\n    var ERR_NON_OBJECT = "Object.getOwnPropertyDescriptor called on a non-object: ";\n    Object.getOwnPropertyDescriptor = function(object, property) {\n      if ("object" != typeof object && "function" != typeof object || null === object) throw new TypeError(ERR_NON_OBJECT + object);\n      if (owns(object, property)) {\n        var descriptor, getter, setter;\n        if (descriptor = {\n            enumerable: !0,\n            configurable: !0\n          }, supportsAccessors) {\n          var prototype = object.__proto__;\n          object.__proto__ = prototypeOfObject;\n          var getter = lookupGetter(object, property),\n            setter = lookupSetter(object, property);\n          if (object.__proto__ = prototype, getter || setter) return getter && (descriptor.get = getter), setter && (descriptor.set = setter), descriptor\n        }\n        return descriptor.value = object[property], descriptor\n      }\n    }\n  }\n  if (Object.getOwnPropertyNames || (Object.getOwnPropertyNames = function(object) {\n      return Object.keys(object)\n    }), !Object.create) {\n    var createEmpty;\n    createEmpty = null === Object.prototype.__proto__ ? function() {\n      return {\n        __proto__: null\n      }\n    } : function() {\n      var empty = {};\n      for (var i in empty) empty[i] = null;\n      return empty.constructor = empty.hasOwnProperty = empty.propertyIsEnumerable = empty.isPrototypeOf = empty.toLocaleString = empty.toString = empty.valueOf = empty.__proto__ = null, empty\n    }, Object.create = function(prototype, properties) {\n      var object;\n      if (null === prototype) object = createEmpty();\n      else {\n        if ("object" != typeof prototype) throw new TypeError("typeof prototype[" + typeof prototype + "] != \'object\'");\n        var Type = function() {};\n        Type.prototype = prototype, object = new Type, object.__proto__ = prototype\n      }\n      return void 0 !== properties && Object.defineProperties(object, properties), object\n    }\n  }\n  if (Object.defineProperty) {\n    var definePropertyWorksOnObject = doesDefinePropertyWork({}),\n      definePropertyWorksOnDom = "undefined" == typeof document || doesDefinePropertyWork(document.createElement("div"));\n    if (!definePropertyWorksOnObject || !definePropertyWorksOnDom) var definePropertyFallback = Object.defineProperty\n  }\n  if (!Object.defineProperty || definePropertyFallback) {\n    var ERR_NON_OBJECT_DESCRIPTOR = "Property description must be an object: ",\n      ERR_NON_OBJECT_TARGET = "Object.defineProperty called on non-object: ",\n      ERR_ACCESSORS_NOT_SUPPORTED = "getters & setters can not be defined on this javascript engine";\n    Object.defineProperty = function(object, property, descriptor) {\n      if ("object" != typeof object && "function" != typeof object || null === object) throw new TypeError(ERR_NON_OBJECT_TARGET + object);\n      if ("object" != typeof descriptor && "function" != typeof descriptor || null === descriptor) throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR + descriptor);\n      if (definePropertyFallback) try {\n        return definePropertyFallback.call(Object, object, property, descriptor)\n      } catch (exception) {}\n      if (owns(descriptor, "value"))\n        if (supportsAccessors && (lookupGetter(object, property) || lookupSetter(object, property))) {\n          var prototype = object.__proto__;\n          object.__proto__ = prototypeOfObject, delete object[property], object[property] = descriptor.value, object.__proto__ = prototype\n        } else object[property] = descriptor.value;\n      else {\n        if (!supportsAccessors) throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);\n        owns(descriptor, "get") && defineGetter(object, property, descriptor.get), owns(descriptor, "set") && defineSetter(object, property, descriptor.set)\n      }\n      return object\n    }\n  }\n  Object.defineProperties || (Object.defineProperties = function(object, properties) {\n    for (var property in properties) owns(properties, property) && Object.defineProperty(object, property, properties[property]);\n    return object\n  }), Object.seal || (Object.seal = function(object) {\n    return object\n  }), Object.freeze || (Object.freeze = function(object) {\n    return object\n  });\n  try {\n    Object.freeze(function() {})\n  } catch (exception) {\n    Object.freeze = function(freezeObject) {\n      return function(object) {\n        return "function" == typeof object ? object : freezeObject(object)\n      }\n    }(Object.freeze)\n  }\n  if (Object.preventExtensions || (Object.preventExtensions = function(object) {\n      return object\n    }), Object.isSealed || (Object.isSealed = function() {\n      return !1\n    }), Object.isFrozen || (Object.isFrozen = function() {\n      return !1\n    }), Object.isExtensible || (Object.isExtensible = function(object) {\n      if (Object(object) === object) throw new TypeError;\n      for (var name = ""; owns(object, name);) name += "?";\n      object[name] = !0;\n      var returnValue = owns(object, name);\n      return delete object[name], returnValue\n    }), !Object.keys) {\n    var hasDontEnumBug = !0,\n      dontEnums = ["toString", "toLocaleString", "valueOf", "hasOwnProperty", "isPrototypeOf", "propertyIsEnumerable", "constructor"],\n      dontEnumsLength = dontEnums.length;\n    for (var key in {\n        toString: null\n      }) hasDontEnumBug = !1;\n    Object.keys = function(object) {\n      if ("object" != typeof object && "function" != typeof object || null === object) throw new TypeError("Object.keys called on a non-object");\n      var keys = [];\n      for (var name in object) owns(object, name) && keys.push(name);\n      if (hasDontEnumBug)\n        for (var i = 0, ii = dontEnumsLength; ii > i; i++) {\n          var dontEnum = dontEnums[i];\n          owns(object, dontEnum) && keys.push(dontEnum)\n        }\n      return keys\n    }\n  }\n  Date.now || (Date.now = function() {\n    return (new Date).getTime()\n  });\n  var ws = "\t\\n\v\\f\\r   ᠎             　\\u2028\\u2029\ufeff";\n  if (!String.prototype.trim || ws.trim()) {\n    ws = "[" + ws + "]";\n    var trimBeginRegexp = RegExp("^" + ws + ws + "*"),\n      trimEndRegexp = RegExp(ws + ws + "*$");\n    String.prototype.trim = function() {\n      return (this + "").replace(trimBeginRegexp, "").replace(trimEndRegexp, "")\n    }\n  }\n  var toObject = function(o) {\n    if (null == o) throw new TypeError("can\'t convert " + o + " to object");\n    return Object(o)\n  }\n});\n'},g=n.a.acequire("ace/worker/worker_client").WorkerClient,j=n.a.acequire("ace/lib/oop"),x=n.a.acequire("ace/mode/json").Mode,v=n.a.acequire("ace/tokenizer").Tokenizer,y=n.a.acequire("ace/mode/matching_brace_outdent").MatchingBraceOutdent,O=n.a.acequire("ace/mode/behaviour/cstyle").CstyleBehaviour,E=n.a.acequire("ace/mode/folding/cstyle").FoldMode,w=function(){var e=new f;e.normalizeRules(),this.$tokenizer=new v(e.getRules()),this.$outdent=new y,this.$behaviour=new O,this.foldingRules=new E};j.inherits(w,x),w.prototype.createWorker=function(e){var t=new g(["ace"],h,"JsonWorker");return t.attachToDocument(e.getDocument()),t.on("annotate",(function(t){e.setAnnotations(t.data)})),t.on("terminate",(function(){e.clearAnnotations()})),t}},function(e,t,a){"use strict";a.d(t,"a",(function(){return S})),a.d(t,"b",(function(){return _}));var i=a(17),n=a.n(i),s=a(2),o=a(44),r=a(212),l=a(13);const c=({limit:e,maps:t,newSelection:a,onDeleteClick:i,onLinkClick:c,showAllBadges:d})=>{const u=[];for(let n=0;n<a.length&&!(n>=e&&!1===d);n++)u.push(Object(l.jsx)(o.EuiFlexItem,{grow:!1,key:a[n]},Object(l.jsx)(r.a,{id:a[n],icon:!0,isGroup:void 0!==t.groupsMap[a[n]],removeId:i})));return!1===d&&a.length>e?u.push(Object(l.jsx)(o.EuiLink,{key:"more-badges-link",onClick:c},Object(l.jsx)(o.EuiText,{grow:!1,size:"xs"},s.i18n.translate("xpack.ml.jobSelector.showFlyoutBadges",{defaultMessage:"And {overFlow} more",values:{overFlow:a.length-e}})))):!0===d&&a.length>e&&u.push(Object(l.jsx)(o.EuiLink,{key:"hide-badges-link",onClick:c},Object(l.jsx)(o.EuiText,{grow:!1,size:"xs"},s.i18n.translate("xpack.ml.jobSelector.hideFlyoutBadges",{defaultMessage:"Hide"})))),Object(l.jsx)(n.a.Fragment,null,u)};var d=a(346);function u({isRunning:e,timerange:t,ganttBarWidth:a}){const n={width:t.widthPx,marginLeft:t.fromPx},s="mlJobSelector__ganttBar"+(e?" mlJobSelector__ganttBarRunning":"");return Object(l.jsx)(o.EuiToolTip,{position:"top",content:t.label},Object(l.jsx)(i.Fragment,null,Object(l.jsx)("div",{className:"mlJobSelector__ganttBarBackEdge"},Object(l.jsx)("div",{className:"mlJobSelector__ganttBarDashed",style:{width:`${a}px`}})),Object(l.jsx)("div",{style:n,className:s})))}var p=a(45),m=a(63),b=a(80),f=a(0),h=a(4);const g=["job_id","groups"],j=["id"];function x({ganttBarWidth:e,groupsList:t,jobs:a,onSelection:n,selectedIds:c,singleSelection:x,timeseriesOnly:v,withTimeRangeSelector:y}){const[O,E]=Object(i.useState)(),[w,M]=Object(i.useState)("Jobs"),{services:{application:{navigateToApp:S}}}=Object(b.b)();Object(i.useEffect)((()=>{let e=[],t="job_id";"Jobs"===w||x?e=[{name:"job_id",getValue:e=>e.job_id.toLowerCase(),isAscending:!0},{name:"groups",getValue:e=>e.groups&&e.groups[0]?e.groups[0].toLowerCase():"",isAscending:!0}]:"Groups"===w&&(t="id",e=[{name:"id",getValue:e=>e.id.toLowerCase(),isAscending:!0}]);const a=new m.SortableProperties(e,t);E(a)}),[a,w]);const _=[{id:"Jobs",name:s.i18n.translate("xpack.ml.jobSelector.jobsTab",{defaultMessage:"Jobs"}),content:T()},{id:"Groups",name:s.i18n.translate("xpack.ml.jobSelector.groupsTab",{defaultMessage:"Groups"}),content:function(){const a=[{id:"checkbox",isCheckbox:!0,textOnly:!1,width:"32px"},{label:"group ID",id:"id",isSortable:!0,alignment:m.LEFT_ALIGNMENT,render:({id:e})=>Object(l.jsx)(r.a,{id:e,isGroup:!0})},{id:"jobs in group",label:"jobs in group",isSortable:!1,alignment:m.CENTER_ALIGNMENT,render:({jobIds:e=[]})=>e.length}];return y&&a.push({label:"time range",id:"timerange",alignment:m.LEFT_ALIGNMENT,render:({timeRange:t={}})=>Object(l.jsx)(u,{timerange:t,ganttBarWidth:e})}),Object(l.jsx)(d.a,{columns:a,filterDefaultFields:x?void 0:j,items:t,onTableChange:e=>n({selectionFromTable:e}),selectedIds:c,sortableProperties:O})}()}];function T(){const p=[{id:"checkbox",isCheckbox:!0,textOnly:!1,width:"32px"},{label:"job ID",id:"job_id",isSortable:!0,alignment:m.LEFT_ALIGNMENT},{id:"groups",label:"groups",isSortable:!0,alignment:m.LEFT_ALIGNMENT,render:({groups:e=[]})=>e.map((e=>Object(l.jsx)(r.a,{key:`${e}-key`,id:e,isGroup:!0})))}];y&&p.push({label:"time range",id:"timerange",alignment:m.LEFT_ALIGNMENT,render:({timeRange:t={},isRunning:a})=>Object(l.jsx)(u,{timerange:t,isRunning:a,ganttBarWidth:e})});const b=[{type:"field_value_selection",field:"groups",name:s.i18n.translate("xpack.ml.jobSelector.filterBar.groupLabel",{defaultMessage:"Group"}),loadingMessage:"Loading...",noOptionsMessage:"No groups found.",multiSelect:"or",cache:1e4,options:t.map((e=>({value:e.id,view:Object(l.jsx)(i.Fragment,null,Object(l.jsx)(o.EuiFlexGroup,{gutterSize:"s"},Object(l.jsx)(o.EuiFlexItem,{key:e.id,grow:!1},Object(l.jsx)(r.a,{id:e.id,isGroup:!0})),Object(l.jsx)(o.EuiFlexItem,{grow:!1},s.i18n.translate("xpack.ml.jobSelector.filterBar.jobGroupTitle",{defaultMessage:"({jobsCount, plural, one {# job} other {# jobs}})",values:{jobsCount:e.jobIds.length}}))))})))}];return Object(l.jsx)(d.a,{columns:p,filters:b,filterDefaultFields:x?void 0:g,items:a,onTableChange:e=>n({selectionFromTable:e}),radioDisabledCheck:e=>v&&!1===e.isSingleMetricViewerJob,selectedIds:c,singleSelection:x,sortableProperties:O,timeseriesOnly:v})}return Object(l.jsx)(i.Fragment,null,0===a.length&&Object(l.jsx)(o.EuiCallOut,{title:Object(l.jsx)(p.FormattedMessage,{id:"xpack.ml.jobSelector.noJobsFoundTitle",defaultMessage:"No anomaly detection jobs found"}),iconType:"iInCircle"},Object(l.jsx)(o.EuiText,{textAlign:"center"},Object(l.jsx)(o.EuiButton,{color:"primary",onClick:async()=>{await S(h.e,{path:f.b.ANOMALY_DETECTION_CREATE_JOB})}},Object(l.jsx)(p.FormattedMessage,{id:"xpack.ml.jobSelector.createJobButtonLabel",defaultMessage:"Create job"})))),0!==a.length&&!0===x&&T(),0!==a.length&&!x&&Object(l.jsx)(o.EuiTabbedContent,{size:"s",tabs:_,initialSelectedTab:_[0],onTabClick:e=>{M(e.id)}}))}var v=a(24),y=a.n(v),O=a(120),E=a.n(O);function w(e){const t={},a={};return e.forEach((e=>{void 0!==e.groups&&e.groups.forEach((i=>{void 0===t[i]?(t[i]={id:i,jobIds:[e.job_id],timeRange:{to:e.timeRange.to,toMoment:null,from:e.timeRange.from,fromMoment:null,fromPx:e.timeRange.fromPx,toPx:e.timeRange.toPx,widthPx:null}},a[i]=[e.job_id]):(t[i].jobIds.push(e.job_id),a[i].push(e.job_id),(null===t[i].timeRange.to||e.timeRange.to>t[i].timeRange.to)&&(t[i].timeRange.to=e.timeRange.to,t[i].timeRange.toMoment=e.timeRange.toMoment),(null===t[i].timeRange.from||e.timeRange.from<t[i].timeRange.from)&&(t[i].timeRange.from=e.timeRange.from,t[i].timeRange.fromMoment=e.timeRange.fromMoment),(null===t[i].timeRange.toPx||e.timeRange.toPx>t[i].timeRange.toPx)&&(t[i].timeRange.toPx=e.timeRange.toPx),(null===t[i].timeRange.fromPx||e.timeRange.fromPx<t[i].timeRange.fromPx)&&(t[i].timeRange.fromPx=e.timeRange.fromPx))}))})),Object.keys(t).forEach((e=>{const a=t[e];a.timeRange.widthPx=a.timeRange.toPx-a.timeRange.fromPx,a.timeRange.toMoment=y()(a.timeRange.to),a.timeRange.fromMoment=y()(a.timeRange.from);const i=a.timeRange.fromMoment.format("MMM Do YYYY, HH:mm"),n=a.timeRange.toMoment.format("MMM Do YYYY, HH:mm");a.timeRange.label=s.i18n.translate("xpack.ml.jobSelectList.groupTimeRangeLabel",{defaultMessage:"{fromString} to {toString}",values:{fromString:i,toString:n}})})),{groups:Object.keys(t).map((e=>t[e])),groupsMap:a}}function M(e,t,a){const i=e.filter((e=>void 0!==e.timeRange.to&&void 0!==e.timeRange.from)),n=Math.min(...i.map((e=>+e.timeRange.from))),o=Math.max(...i.map((e=>+e.timeRange.to))),r=E.a.scale.linear().domain([n,o]).range([1,a]);return e.forEach((e=>{if(void 0!==e.timeRange.to&&void 0!==e.timeRange.from){e.timeRange.fromPx=r(e.timeRange.from),e.timeRange.toPx=r(e.timeRange.to),e.timeRange.widthPx=e.timeRange.toPx-e.timeRange.fromPx,e.timeRange.widthPx<1&&(e.timeRange.widthPx=1),e.timeRange.toMoment=y()(e.timeRange.to).tz(t),e.timeRange.fromMoment=y()(e.timeRange.from).tz(t);const a=e.timeRange.fromMoment.format("MMM Do YYYY, HH:mm"),i=e.timeRange.toMoment.format("MMM Do YYYY, HH:mm");e.timeRange.label=s.i18n.translate("xpack.ml.jobSelector.jobTimeRangeLabel",{defaultMessage:"{fromString} to {toString}",values:{fromString:a,toString:i}})}else e.timeRange.widthPx=0,e.timeRange.fromPx=0,e.timeRange.toPx=0,e.timeRange.label=s.i18n.translate("xpack.ml.jobSelector.noResultsForJobLabel",{defaultMessage:"No results"})})),e}const S=10,_=({dateFormatTz:e,selectedIds:t=[],singleSelection:a,timeseriesOnly:r,onJobsFetched:d,onSelectionConfirmed:u,onFlyoutClose:p,maps:m,applyTimeRangeConfig:f,onTimeRangeConfigChange:h,withTimeRangeSelector:g=!0})=>{const{services:{notifications:j,mlServices:{mlApiServices:v}}}=Object(b.b)(),[O,_]=Object(i.useState)(t),[T,C]=Object(i.useState)(!0),[k,F]=Object(i.useState)(!1),[I,D]=Object(i.useState)([]),[A,L]=Object(i.useState)([]),[R,N]=Object(i.useState)(299),[P,z]=Object(i.useState)(m),B=Object(i.useRef)(null),V=Object(i.useCallback)((()=>{const e=[],t=[];O.forEach((a=>{void 0!==P.groupsMap[a]?(e.push(...P.groupsMap[a]),t.push({groupId:a,jobIds:P.groupsMap[a]})):e.push(a)}));const a=Array.from(new Set(e)),i=f?function(e,t){if(e.length>0){const a=[];if(e.forEach((e=>{t.includes(e.job_id)&&(void 0!==e.timeRange.from&&a.push(e.timeRange.from),void 0!==e.timeRange.to&&a.push(e.timeRange.to))})),a.length){const e=E.a.extent(a);return{from:y()(e[0]).toISOString(),to:y()(e[1]).toISOString()}}}}(I,a):void 0;u({newSelection:a,jobIds:a,groups:t,time:i})}),[u,O,P,f]);function J(e){_(O.filter((t=>t!==e)))}function U(){h&&h(!f)}function G(){_([])}function q({selectionFromTable:e}){_(e)}const $=Object(i.useCallback)((()=>{if(0===I.length||!B.current)return;const t=B.current.querySelectorAll("table thead th"),a=t[t.length-1].offsetWidth-16,i=M(I,e,a);D(i);const{groups:n}=w(i);L(n),N(a)}),[e,I]);return Object(i.useEffect)((()=>{!async function(){try{const t=await v.jobs.jobsWithTimerange(e),a=M(t.jobs,e,299),{groups:i,groupsMap:n}=w(a);D(a),L(i),z({groupsMap:n,jobsMap:t.jobsMap}),d&&d({groupsMap:n,jobsMap:t.jobsMap})}catch(e){console.error("Error fetching jobs with time range",e);const{toasts:t}=j;t.addDanger({title:s.i18n.translate("xpack.ml.jobSelector.jobFetchErrorMessage",{defaultMessage:"An error occurred fetching jobs. Refresh and try again."})})}C(!1)}()}),[]),Object(l.jsx)(n.a.Fragment,null,Object(l.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(l.jsx)(o.EuiTitle,{size:"m"},Object(l.jsx)("h2",{id:"flyoutTitle"},s.i18n.translate("xpack.ml.jobSelector.flyoutTitle",{defaultMessage:"Job selection"})))),Object(l.jsx)(o.EuiFlyoutBody,{className:"mlJobSelectorFlyoutBody","data-test-subj":"mlJobSelectorFlyoutBody"},Object(l.jsx)(o.EuiResizeObserver,{onResize:$},(e=>Object(l.jsx)("div",{ref:t=>{B.current=t,e(t)}},T?Object(l.jsx)(o.EuiProgress,{size:"xs",color:"accent"}):Object(l.jsx)(n.a.Fragment,null,Object(l.jsx)(o.EuiFlexGroup,{direction:"column",responsive:!1},Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiFlexGroup,{wrap:!0,responsive:!1,gutterSize:"xs",alignItems:"center"},Object(l.jsx)(c,{limit:S,maps:P,newSelection:O,onDeleteClick:J,onLinkClick:()=>F(!k),showAllBadges:k}))),Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiFlexGroup,{direction:"row",justifyContent:"spaceBetween",responsive:!1},Object(l.jsx)(o.EuiFlexItem,{grow:!1},!a&&O.length>0&&Object(l.jsx)(o.EuiButtonEmpty,{onClick:G,size:"xs","data-test-subj":"mlFlyoutJobSelectorButtonClearSelection"},s.i18n.translate("xpack.ml.jobSelector.clearAllFlyoutButton",{defaultMessage:"Clear all"}))),g&&void 0!==f&&Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiSwitch,{label:s.i18n.translate("xpack.ml.jobSelector.applyTimerangeSwitchLabel",{defaultMessage:"Apply time range"}),checked:f,onChange:U,"data-test-subj":"mlFlyoutJobSelectorSwitchApplyTimeRange"}))))),Object(l.jsx)(x,{jobs:I,ganttBarWidth:R,groupsList:A,onSelection:q,selectedIds:O,singleSelection:a,timeseriesOnly:r,withTimeRangeSelector:g})))))),Object(l.jsx)(o.EuiFlyoutFooter,null,Object(l.jsx)(o.EuiFlexGroup,null,Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiButton,{onClick:V,fill:!0,isDisabled:0===O.length,"data-test-subj":"mlFlyoutJobSelectorButtonApply"},s.i18n.translate("xpack.ml.jobSelector.applyFlyoutButton",{defaultMessage:"Apply"}))),Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:p,"data-test-subj":"mlFlyoutJobSelectorButtonClose"},s.i18n.translate("xpack.ml.jobSelector.closeFlyoutButton",{defaultMessage:"Close"}))))))}},function(e,t,a){"use strict";a.d(t,"b",(function(){return v})),a.d(t,"a",(function(){return y}));var i=a(17),n=a.n(i),s=a(8),o=a(44),r=a(45),l=a(48),c=a(6),d=a(116),u=a(80),p=a(2),m=a(126),b=a(13);const f=({content:e})=>Object(b.jsx)(o.EuiToolTip,{position:"top",content:e},Object(b.jsx)(o.EuiIcon,{tabIndex:0,type:"questionInCircle",color:"subdued",className:"eui-alignTop",size:"s"})),h=({stats:e})=>{Object(m.a)(l.FIELD_FORMAT_IDS.DURATION);const t=e.map(((e,t)=>{const a=Object.keys(e)[0];return{...e[a],id:`${a}_${t}`}})),a=[{field:"type",name:p.i18n.translate("xpack.ml.trainedModels.modelsList.pipelines.processorStats.typeHeader",{defaultMessage:"Processor type"}),width:"100px",sortable:!0,truncateText:!1,render:e=>Object(b.jsx)(o.EuiBadge,{color:"hollow"},e),"data-test-subj":"mlProcessorStatsType"},{field:"stats.count",name:Object(b.jsx)(o.EuiFlexGroup,{gutterSize:"xs"},Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.pipelines.processorStats.countHeader",defaultMessage:"Count"})),Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(f,{content:Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.pipelines.processorStats.countDescription",defaultMessage:"Total number of documents ingested during the lifetime of this node"})}))),width:"100px",truncateText:!0,"data-test-subj":"mlProcessorStatsCount"},{field:"stats.current",name:Object(b.jsx)(o.EuiFlexGroup,{gutterSize:"xs"},Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.pipelines.processorStats.currentHeader",defaultMessage:"Current"})),Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(f,{content:Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.pipelines.processorStats.currentDescription",defaultMessage:"Total number of documents currently being ingested"})}))),width:"100px",truncateText:!1,"data-test-subj":"mlProcessorStatsCurrent"},{field:"stats.failed",name:Object(b.jsx)(o.EuiFlexGroup,{gutterSize:"xs"},Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.pipelines.processorStats.failedHeader",defaultMessage:"Failed"})),Object(b.jsx)(o.EuiFlexItem,{grow:!1},Object(b.jsx)(f,{content:Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.pipelines.processorStats.failedDescription",defaultMessage:"Total number of failed ingest operations during the lifetime of this node"})}))),width:"100px","data-test-subj":"mlProcessorStatsFailed"}];return Object(b.jsx)(o.EuiInMemoryTable,{allowNeutralSort:!1,columns:a,hasActions:!1,isExpandable:!1,isSelectable:!1,items:t,itemId:"id",rowProps:e=>({"data-test-subj":`mlProcessorStatsTableRow row-${e.id}`}),onTableChange:()=>{},"data-test-subj":"mlProcessorStatsTable"})},g=({pipelines:e,ingestStats:t})=>{var a;const{services:{share:i}}=Object(u.b)(),s=Object.keys(null!==(a=null!=e?e:null==t?void 0:t.pipelines)&&void 0!==a?a:{});return s.length?Object(b.jsx)(n.a.Fragment,null,s.map(((a,s)=>{const l=s<=2,c=null==e?void 0:e[a];return Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(o.EuiAccordion,{key:a,id:a,buttonContent:Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,a)),extraAction:c?Object(b.jsx)(o.EuiButtonEmpty,{"data-test-subj":`mlTrainedModelPipelineEditButton_${a}`,onClick:()=>{const e=i.url.locators.get("INGEST_PIPELINES_APP_LOCATOR");e&&e.navigate({page:"pipeline_edit",pipelineId:a,absolute:!0})},iconType:"documentEdit",iconSide:"left"},Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.editPipelineLabel",defaultMessage:"Edit"})):void 0,paddingSize:"l",initialIsOpen:l},Object(b.jsx)(o.EuiFlexGrid,{columns:2},null!=t&&t.pipelines?Object(b.jsx)(o.EuiFlexItem,{"data-test-subj":`mlTrainedModelPipelineIngestStats_${a}`},Object(b.jsx)(o.EuiPanel,null,Object(b.jsx)(o.EuiTitle,{size:"xxs"},Object(b.jsx)("h6",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.ingestStatsTitle",defaultMessage:"Ingest stats"}))),Object(b.jsx)(h,{stats:t.pipelines[a].processors}))):null,c?Object(b.jsx)(o.EuiFlexItem,{"data-test-subj":`mlTrainedModelPipelineDefinition_${a}`},Object(b.jsx)(o.EuiPanel,null,Object(b.jsx)(o.EuiTitle,{size:"xxs"},Object(b.jsx)("h6",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.processorsTitle",defaultMessage:"Definition"}))),Object(b.jsx)(o.EuiCodeBlock,{language:"json",fontSize:"m",paddingSize:"m",overflowHeight:300,isCopyable:!0},JSON.stringify(c,null,2)))):null)))}))):null};var j=a(329);const x=e=>{if(0!==e.length)return Object(b.jsx)("div",null,e.map((e=>Object(b.jsx)(o.EuiBadge,{key:e,color:"hollow"},e))))};function v(){const e=Object(m.a)(l.FIELD_FORMAT_IDS.BYTES),t=Object(m.a)(l.FIELD_FORMAT_IDS.DATE),a=Object(i.useMemo)((()=>({tags:x,roles:x,create_time:t,timestamp:t,model_size_bytes:e,required_native_memory_bytes:e})),[]);return Object(i.useCallback)((e=>Object.entries(e).filter((([,e])=>Object(d.a)(e))).map((([e,t])=>e in a?{title:e,description:a[e](t)}:{title:e,description:"object"==typeof t?Object(b.jsx)(o.EuiCodeBlock,{language:"json",fontSize:"s",paddingSize:"s",overflowHeight:300,isCopyable:!1},JSON.stringify(t,null,2)):t.toString()}))),[a])}const y=({item:e})=>{const[t,a]=Object(i.useState)([]),l=v(),{inference_config:d,stats:u,metadata:p,tags:m,version:f,estimated_operations:h,estimated_heap_memory_usage_bytes:x,default_field_map:y,license_level:O,pipelines:E,description:w}=e,{analytics_config:M,...S}=null!=p?p:{},_={description:w,tags:m,version:f,estimated_operations:h,estimated_heap_memory_usage_bytes:x,default_field_map:y,license_level:O};Object(i.useEffect)((function(){!async function(){const e=u.deployment_stats,t=u.model_size_stats;if(!e||!t)return;const i=e.nodes.map((a=>{const i=Object.values(a.node)[0].name;return{...e,...t,node:{...Object(s.pick)(a,["average_inference_time_ms","inference_count","routing_state","last_access","number_of_pending_requests","start_time","throughput_last_minute","number_of_allocations","threads_per_allocation"]),name:i}}}));a(i)}()}),[u.deployment_stats]);const T=[{id:"details","data-test-subj":"mlTrainedModelDetails",name:Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.detailsTabLabel",defaultMessage:"Details"}),content:Object(b.jsx)("div",{"data-test-subj":"mlTrainedModelDetailsContent"},Object(b.jsx)(o.EuiSpacer,{size:"s"}),Object(b.jsx)(o.EuiFlexGrid,{columns:2,gutterSize:"m"},Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiPanel,null,Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.detailsTitle",defaultMessage:"Details"}))),Object(b.jsx)(o.EuiSpacer,{size:"m"}),Object(b.jsx)(o.EuiDescriptionList,{compressed:!0,type:"column",listItems:l(_)}))),Object(c.isPopulatedObject)(S)?Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiPanel,null,Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.metadataTitle",defaultMessage:"Metadata"}))),Object(b.jsx)(o.EuiSpacer,{size:"m"}),Object(b.jsx)(o.EuiDescriptionList,{compressed:!0,type:"column",listItems:l(S)}))):null))},...d?[{id:"config","data-test-subj":"mlTrainedModelInferenceConfig",name:Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.configTabLabel",defaultMessage:"Config"}),content:Object(b.jsx)("div",{"data-test-subj":"mlTrainedModelInferenceConfigContent"},Object(b.jsx)(o.EuiSpacer,{size:"s"}),Object(b.jsx)(o.EuiFlexGrid,{columns:2,gutterSize:"m"},Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiPanel,null,Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.inferenceConfigTitle",defaultMessage:"Inference configuration"}))),Object(b.jsx)(o.EuiSpacer,{size:"m"}),Object(b.jsx)(o.EuiDescriptionList,{compressed:!0,type:"column",listItems:l(d[Object.keys(d)[0]])}))),M&&Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiPanel,null,Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.analyticsConfigTitle",defaultMessage:"Analytics configuration"}))),Object(b.jsx)(o.EuiSpacer,{size:"m"}),Object(b.jsx)(o.EuiDescriptionList,{compressed:!0,type:"column",listItems:l(M)})))))}]:[],...Object(c.isPopulatedObject)(Object(s.omit)(u,["pipeline_count","ingest"]))?[{id:"stats","data-test-subj":"mlTrainedModelStats",name:Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.statsTabLabel",defaultMessage:"Stats"}),content:Object(b.jsx)("div",{"data-test-subj":"mlTrainedModelStatsContent"},Object(b.jsx)(o.EuiSpacer,{size:"s"}),Object(b.jsx)(o.EuiFlexGrid,{columns:2,gutterSize:"m"},null!=t&&t.length?Object(b.jsx)(o.EuiFlexItem,{grow:2},Object(b.jsx)(o.EuiPanel,null,Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.deploymentStatsTitle",defaultMessage:"Deployment stats"}))),Object(b.jsx)(o.EuiSpacer,{size:"m"}),Object(b.jsx)(j.a,{models:t,hideColumns:["model_id"]}))):null,u.inference_stats?Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiPanel,null,Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.inferenceStatsTitle",defaultMessage:"Inference stats"}))),Object(b.jsx)(o.EuiSpacer,{size:"m"}),Object(b.jsx)(o.EuiDescriptionList,{compressed:!0,type:"column",listItems:l(u.inference_stats)}))):null,Object(c.isPopulatedObject)(u.model_size_stats)&&!Object(c.isPopulatedObject)(u.inference_stats)?Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiPanel,null,Object(b.jsx)(o.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.modelSizeStatsTitle",defaultMessage:"Model size stats"}))),Object(b.jsx)(o.EuiSpacer,{size:"m"}),Object(b.jsx)(o.EuiDescriptionList,{compressed:!0,type:"column",listItems:l(u.model_size_stats)}))):null))}]:[],...E&&Object.keys(E).length>0||u.ingest?[{id:"pipelines","data-test-subj":"mlTrainedModelPipelines",name:Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.expandedRow.pipelinesTabLabel",defaultMessage:"Pipelines"})," ",Object(b.jsx)(o.EuiNotificationBadge,null,u.pipeline_count)),content:Object(b.jsx)("div",{"data-test-subj":"mlTrainedModelPipelinesContent"},Object(b.jsx)(o.EuiSpacer,{size:"s"}),Object(b.jsx)(g,{pipelines:E,ingestStats:u.ingest}))}]:[]];return Object(b.jsx)(o.EuiTabbedContent,{size:"s",style:{width:"100%"},tabs:T,initialSelectedTab:T[0],autoFocus:"selected",onTabClick:e=>{},"data-test-subj":"mlTrainedModelRowDetails"})}},function(e,t,a){"use strict";a.d(t,"a",(function(){return T}));var i=a(82),n=a.n(i),s=a(17),o=a.n(s),r=a(44),l=a(2),c=a(8),d=a(48),u=a(168),p=a(96),m=a(0),b=a(137),f=a(198),h=a(45),g=a(13),j=a(341),x=a(329),v=a(126),y={name:"1d3w5wq",styles:"width:100%"};const O=({item:e})=>{const t=Object(v.a)(d.FIELD_FORMAT_IDS.BYTES),a=Object(j.b)(),{allocated_models:i,attributes:n,memory_overview:s,id:l,...u}=Object(c.cloneDeep)(e);return n["ml.machine_memory"]=t(n["ml.machine_memory"]),n["ml.max_jvm_size"]=t(n["ml.max_jvm_size"]),Object(g.jsx)("div",{css:y},Object(g.jsx)(r.EuiFlexGrid,{columns:2,gutterSize:"s"},Object(g.jsx)(r.EuiFlexItem,null,Object(g.jsx)(r.EuiPanel,null,Object(g.jsx)(r.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(h.FormattedMessage,{id:"xpack.ml.trainedModels.nodesList.expandedRow.detailsTitle",defaultMessage:"Details"}))),Object(g.jsx)(r.EuiSpacer,{size:"m"}),Object(g.jsx)(r.EuiDescriptionList,{compressed:!0,type:"column",listItems:a(u)}))),Object(g.jsx)(r.EuiFlexItem,null,Object(g.jsx)(r.EuiPanel,null,Object(g.jsx)(r.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(h.FormattedMessage,{id:"xpack.ml.trainedModels.nodesList.expandedRow.attributesTitle",defaultMessage:"Attributes"}))),Object(g.jsx)(r.EuiSpacer,{size:"m"}),Object(g.jsx)(r.EuiDescriptionList,{compressed:!0,type:"column",listItems:a(n)})))),i.length>0?Object(g.jsx)(o.a.Fragment,null,Object(g.jsx)(r.EuiSpacer,{size:"s"}),Object(g.jsx)(r.EuiPanel,null,Object(g.jsx)(r.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(h.FormattedMessage,{id:"xpack.ml.trainedModels.nodesList.expandedRow.allocatedModelsTitle",defaultMessage:"Allocated models"}))),Object(g.jsx)(r.EuiSpacer,{size:"m"}),Object(g.jsx)(x.a,{models:i}))):null)};var E=a(49),w=a(125);const M=({memoryOverview:e})=>{const t=Object(v.a)(d.FIELD_FORMAT_IDS.BYTES),{euiTheme:a}=Object(w.e)(),i=Object(s.useMemo)((()=>({jvm:{name:l.i18n.translate("xpack.ml.trainedModels.nodesList.jvmHeapSIze",{defaultMessage:"JVM heap size"}),colour:a.euiColorVis1},trained_models:{name:l.i18n.translate("xpack.ml.trainedModels.nodesList.modelsMemoryUsage",{defaultMessage:"Trained models"}),colour:a.euiColorVis2},anomaly_detection:{name:l.i18n.translate("xpack.ml.trainedModels.nodesList.adMemoryUsage",{defaultMessage:"Anomaly detection jobs"}),colour:a.euiColorVis6},dfa_training:{name:l.i18n.translate("xpack.ml.trainedModels.nodesList.dfaMemoryUsage",{defaultMessage:"Data frame analytics jobs"}),colour:a.euiColorVis4},available:{name:l.i18n.translate("xpack.ml.trainedModels.nodesList.availableMemory",{defaultMessage:"Estimated available memory"}),colour:Object(r.euiPaletteGray)(5)[0]}})),[]),n=[{x:0,y:e.trained_models.total,g:i.trained_models.name},{x:0,y:e.anomaly_detection.total,g:i.anomaly_detection.name},{x:0,y:e.dfa_training.total,g:i.dfa_training.name},{x:0,y:e.machine_memory.total-e.machine_memory.jvm-e.trained_models.total-e.dfa_training.total-e.anomaly_detection.total,g:i.available.name},{x:0,y:e.machine_memory.jvm,g:i.jvm.name}];return Object(g.jsx)(E.Chart,{size:["100%",50]},Object(g.jsx)(E.Settings,{rotation:90,tooltip:{headerFormatter:({value:e})=>l.i18n.translate("xpack.ml.trainedModels.nodesList.memoryBreakdown",{defaultMessage:"Approximate memory breakdown"})}}),Object(g.jsx)(E.Axis,{id:"ml_memory",position:E.Position.Bottom,hide:!0,tickFormat:e=>t(e)}),Object(g.jsx)(E.LineAnnotation,{id:"line_annotation",domainType:E.AnnotationDomainType.YDomain,dataValues:[{dataValue:e.ml_max_in_bytes,details:t(e.ml_max_in_bytes),header:l.i18n.translate("xpack.ml.trainedModels.nodesList.mlMaxMemory",{defaultMessage:"Maximum memory permitted for ML native processes"})}],marker:Object(g.jsx)(r.EuiIcon,{type:"arrowDown"}),markerPosition:E.Position.Top}),Object(g.jsx)(E.BarSeries,{id:"bars",xScaleType:E.ScaleType.Linear,yScaleType:E.ScaleType.Linear,xAccessor:"x",yAccessors:["y"],splitSeriesAccessors:["g"],stackAccessors:["x"],data:n,color:({specId:e,yAccessor:t,splitAccessors:a})=>{const n=a.get("g");return Object.values(i).find((e=>e.name===n)).colour}}))};var S=a(85),_=a(141);const T=({compactView:e=!1})=>{var t;const a=Object(b.b)(),i=Object(_.a)(),{displayErrorToast:o}=Object(S.c)(),h=Object(v.a)(d.FIELD_FORMAT_IDS.BYTES),[j,x]=Object(s.useState)([]),[y,E]=Object(s.useState)(!0),[w,T]=Object(s.useState)({}),[C,k]=Object(p.b)(m.b.TRAINED_MODELS_NODES,{pageIndex:0,pageSize:10,sortField:"name",sortDirection:"asc"}),F=null!==(t=C.queryText)&&void 0!==t?t:"",I=Object(s.useCallback)((async()=>{try{const e=await a.getTrainedModelsNodesOverview();x(e.nodes),e.nodes.forEach((e=>{w[e.id]&&(w[e.id]=Object(g.jsx)(O,{item:e}))})),E(!1)}catch(e){o(e,l.i18n.translate("xpack.ml.trainedModels.nodesList.nodesFetchError",{defaultMessage:"Nodes fetch failed"})),E(!1)}}),[w]),D=e=>{const t=Object(c.cloneDeep)(w);t[e.id]?delete t[e.id]:t[e.id]=Object(g.jsx)(O,{item:e}),T(t)},A=[{align:"left",width:"40px",isExpander:!0,render:e=>Object(g.jsx)(r.EuiButtonIcon,{onClick:D.bind(null,e),"aria-label":w[e.id]?l.i18n.translate("xpack.ml.trainedModels.nodesList.collapseRow",{defaultMessage:"Collapse"}):l.i18n.translate("xpack.ml.trainedModels.nodesList.expandRow",{defaultMessage:"Expand"}),iconType:w[e.id]?"arrowDown":"arrowRight"}),"data-test-subj":"mlNodesTableRowDetailsToggle"},{field:"name",name:l.i18n.translate("xpack.ml.trainedModels.nodesList.nodeNameHeader",{defaultMessage:"Name"}),width:"200px",sortable:!0,truncateText:!0,"data-test-subj":"mlNodesTableColumnName"},{name:l.i18n.translate("xpack.ml.trainedModels.nodesList.nodeTotalMemoryHeader",{defaultMessage:"Total memory"}),width:"200px",truncateText:!0,"data-test-subj":"mlNodesTableColumnTotalMemory",render:e=>h(e.attributes["ml.machine_memory"])},{name:l.i18n.translate("xpack.ml.trainedModels.nodesList.nodeMemoryUsageHeader",{defaultMessage:"Memory usage"}),truncateText:!0,"data-test-subj":"mlNodesTableColumnMemoryUsage",render:e=>Object(g.jsx)(M,{memoryOverview:e.memory_overview})}],L=Object(s.useMemo)((()=>({total:{show:!0,value:j.length,label:l.i18n.translate("xpack.ml.trainedModels.nodesList.totalAmountLabel",{defaultMessage:"Total machine learning nodes"}),"data-test-subj":"mlTotalNodesCount"}})),[j]);let R=Object(f.a)(j.length,C,k);const N={query:F,onChange:e=>null===e.error&&(k({queryText:e.queryText,pageIndex:0}),!0),box:{incremental:!0}};return Object(s.useEffect)((function(){I()}),[i]),e&&(R={}),Object(g.jsx)("div",{"data-test-subj":"mlNodesOverviewPanel"},Object(g.jsx)(r.EuiSpacer,{size:"m"}),Object(g.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},L&&Object(g.jsx)(r.EuiFlexItem,{grow:!1},Object(g.jsx)(u.a,{stats:L,dataTestSub:"mlTrainedModelsNodesStatsBar"}))),Object(g.jsx)(r.EuiSpacer,{size:"m"}),Object(g.jsx)("div",{"data-test-subj":"mlNodesTableContainer"},Object(g.jsx)(r.EuiInMemoryTable,n()({allowNeutralSort:!1,columns:A,hasActions:!1,isExpandable:!0,itemIdToExpandedRowMap:w,isSelectable:!1,items:j,itemId:"id",loading:y,search:e?void 0:N},R,{rowProps:e=>({"data-test-subj":`mlNodesTableRow row-${e.id}`}),"data-test-subj":y?"mlNodesTable loading":"mlNodesTable loaded"}))))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return g}));var i=a(17),n=a.n(i),s=a(2),o=a(44),r=a(84),l=a(115),c=a(13);const d=s.i18n.translate("xpack.ml.dataframe.analyticsList.deleteActionNameText",{defaultMessage:"Delete"}),u=({isDisabled:e,item:t})=>e?Object(c.jsx)(o.EuiToolTip,{position:"top",content:Object(l.g)(t.stats.state)?s.i18n.translate("xpack.ml.dataframe.analyticsList.deleteActionDisabledToolTipContent",{defaultMessage:"Stop the data frame analytics job in order to delete it."}):Object(r.f)("canStartStopDataFrameAnalytics")},Object(c.jsx)(n.a.Fragment,null,d)):Object(c.jsx)(n.a.Fragment,null,d),p=({closeModal:e,deleteAndCloseModal:t,deleteTargetIndex:a,deleteIndexPattern:i,indexPatternExists:n,isLoading:r,item:l,toggleDeleteIndex:d,toggleDeleteIndexPattern:u,userCanDeleteIndex:p,userCanDeleteDataView:m})=>{if(void 0===l)return null;const b=l.config.dest.index;return Object(c.jsx)(o.EuiConfirmModal,{"data-test-subj":"mlAnalyticsJobDeleteModal",title:s.i18n.translate("xpack.ml.dataframe.analyticsList.deleteModalTitle",{defaultMessage:"Delete {analyticsId}?",values:{analyticsId:l.config.id}}),onCancel:e,onConfirm:t,cancelButtonText:s.i18n.translate("xpack.ml.dataframe.analyticsList.deleteModalCancelButton",{defaultMessage:"Cancel"}),confirmButtonText:s.i18n.translate("xpack.ml.dataframe.analyticsList.deleteModalDeleteButton",{defaultMessage:"Delete"}),defaultFocusedButton:o.EUI_MODAL_CONFIRM_BUTTON,buttonColor:"danger",confirmButtonDisabled:r},Object(c.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(c.jsx)(o.EuiFlexItem,null,p&&Object(c.jsx)(o.EuiSwitch,{"data-test-subj":"mlAnalyticsJobDeleteIndexSwitch",style:{paddingBottom:10},label:s.i18n.translate("xpack.ml.dataframe.analyticsList.deleteDestinationIndexTitle",{defaultMessage:"Delete destination index {indexName}",values:{indexName:b}}),checked:a,onChange:d})),Object(c.jsx)(o.EuiFlexItem,null,p&&n&&Object(c.jsx)(o.EuiSwitch,{"data-test-subj":"mlAnalyticsJobDeleteIndexPatternSwitch",label:s.i18n.translate("xpack.ml.dataframe.analyticsList.deleteTargetDataViewTitle",{defaultMessage:"Delete data view {dataView}",values:{dataView:b}}),checked:i,onChange:u,disabled:!1===m}))))};var m=a(26),b=a(80),f=a(85),h=a(181);const g=e=>{var t;const[a,n]=Object(i.useState)(),[o,r]=Object(i.useState)(!1),[p,g]=Object(i.useState)(!1),[j,x]=Object(i.useState)(!1),[v,y]=Object(i.useState)(!0),[O,E]=Object(i.useState)(!0),[w,M]=Object(i.useState)(!1),[S,_]=Object(i.useState)(!1),[T,C]=Object(i.useState)(!1),[k,F]=Object(i.useState)(!1),{data:{dataViews:I},application:{capabilities:D}}=Object(b.b)().services,A=null!==(t=null==a?void 0:a.config.dest.index)&&void 0!==t?t:"",L=Object(f.c)();Object(i.useEffect)((()=>{F(!0),(async()=>{try{const e=(await I.getIdsWithTitle()).find((({title:e})=>e===A));C(void 0!==e),F(!1)}catch(e){const t=Object(m.b)(e);F(!1),L.displayDangerToast(s.i18n.translate("xpack.ml.dataframe.analyticsList.errorWithCheckingIfDataViewExistsNotificationErrorMessage",{defaultMessage:"An error occurred checking if data view {dataView} exists: {error}",values:{dataView:A,error:t}}))}})(),(async()=>{try{await Object(h.a)(A,L)&&M(!0);const e=!0===D.savedObjectsManagement.delete||!0===D.indexPatterns.save;_(e),!1===e&&E(!1)}catch(e){const t=Object(m.b)(e);F(!1),L.displayDangerToast(s.i18n.translate("xpack.ml.dataframe.analyticsList.errorWithCheckingIfUserCanDeleteIndexNotificationErrorMessage",{defaultMessage:"An error occurred checking if user can delete {destinationIndex}: {error}",values:{destinationIndex:A,error:t}}))}})()}),[o]);const R=e=>{n(e),g(!0)};return{action:Object(i.useMemo)((()=>({name:t=>Object(c.jsx)(u,{isDisabled:Object(l.g)(t.stats.state)||!e,item:t}),enabled:t=>!Object(l.g)(t.stats.state)&&e,description:d,icon:"trash",type:"icon",onClick:e=>R(e),"data-test-subj":"mlAnalyticsJobDeleteButton"})),[]),closeDeleteJobCheckModal:()=>g(!1),closeModal:()=>r(!1),deleteAndCloseModal:()=>{x(!0),r(!1),void 0!==a&&(w&&v||w&&O?Object(h.c)(a.config,a.stats,v,T&&O,L):Object(h.b)(a.config,a.stats,L))},deleteTargetIndex:v,deleteIndexPattern:O,deleteItem:j,indexPatternExists:T,isDeleteJobCheckModalVisible:p,isModalVisible:o,isLoading:k,item:a,jobType:"data-frame-analytics",openModal:e=>{n(e),r(!0)},openDeleteJobCheckModal:R,toggleDeleteIndex:()=>y(!v),toggleDeleteIndexPattern:()=>E(!O),userCanDeleteIndex:w,userCanDeleteDataView:S}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));var i=a(17),n=a.n(i),s=a(2),o=a(45),r=a(44),l=a(80),c=a(13);const d=({syncItems:e})=>null===e?null:Object(c.jsx)(n.a.Fragment,null,Object(c.jsx)(u,{syncItems:e}),Object(c.jsx)(r.EuiHorizontalRule,{margin:"l"}),Object(c.jsx)(p,{syncItems:e}),Object(c.jsx)(r.EuiHorizontalRule,{margin:"l"}),Object(c.jsx)(m,{syncItems:e}),Object(c.jsx)(r.EuiHorizontalRule,{margin:"l"}),Object(c.jsx)(b,{syncItems:e}),Object(c.jsx)(r.EuiHorizontalRule,{margin:"l"})),u=({syncItems:e})=>{const t=h(e.savedObjectsCreated),a=Object(c.jsx)(n.a.Fragment,null,Object(c.jsx)(r.EuiTitle,{size:"xs","data-test-subj":"mlJobMgmtSyncFlyoutMissingObjectsTitle"},Object(c.jsx)("h3",null,Object(c.jsx)(r.EuiTextColor,{color:t?"default":"subdued"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.savedObjectsCreated.title",defaultMessage:"Missing saved objects ({count})",values:{count:t}})))),Object(c.jsx)(r.EuiText,{size:"s"},Object(c.jsx)("p",null,Object(c.jsx)(r.EuiTextColor,{color:"subdued"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.savedObjectsCreated.description",defaultMessage:"If there are jobs that do not have accompanying saved objects, they will be created in the current space."})))));return Object(c.jsx)(f,{id:"savedObjectsCreated",title:a,results:e.savedObjectsCreated})},p=({syncItems:e})=>{const t=h(e.savedObjectsDeleted),a=Object(c.jsx)(n.a.Fragment,null,Object(c.jsx)(r.EuiTitle,{size:"xs","data-test-subj":"mlJobMgmtSyncFlyoutUnmatchedObjectsTitle"},Object(c.jsx)("h3",null,Object(c.jsx)(r.EuiTextColor,{color:t?"default":"subdued"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.savedObjectsDeleted.title",defaultMessage:"Unmatched saved objects ({count})",values:{count:t}})))),Object(c.jsx)(r.EuiText,{size:"s"},Object(c.jsx)("p",null,Object(c.jsx)(r.EuiTextColor,{color:"subdued"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.savedObjectsDeleted.description",defaultMessage:"If there are saved objects that do not have an accompanying job, they will be deleted."})))));return Object(c.jsx)(f,{id:"savedObjectsDeleted",title:a,results:e.savedObjectsDeleted})},m=({syncItems:e})=>{const t=h(e.datafeedsAdded),a=Object(c.jsx)(n.a.Fragment,null,Object(c.jsx)(r.EuiTitle,{size:"xs","data-test-subj":"mlJobMgmtSyncFlyoutObjectsMissingDatafeedTitle"},Object(c.jsx)("h3",null,Object(c.jsx)(r.EuiTextColor,{color:t?"default":"subdued"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.datafeedsAdded.title",defaultMessage:"Saved objects with missing datafeeds ({count})",values:{count:t}})))),Object(c.jsx)(r.EuiText,{size:"s"},Object(c.jsx)("p",null,Object(c.jsx)(r.EuiTextColor,{color:"subdued"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.datafeedsAdded.description",defaultMessage:"If there are saved objects that are missing the datafeed ID for anomaly detection jobs, the ID will be added."})))));return Object(c.jsx)(f,{id:"datafeedsAdded",title:a,results:e.datafeedsAdded})},b=({syncItems:e})=>{const t=h(e.datafeedsRemoved),a=Object(c.jsx)(n.a.Fragment,null,Object(c.jsx)(r.EuiTitle,{size:"xs","data-test-subj":"mlJobMgmtSyncFlyoutObjectsUnmatchedDatafeedTitle"},Object(c.jsx)("h3",null,Object(c.jsx)(r.EuiTextColor,{color:t?"default":"subdued"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.datafeedsRemoved.title",defaultMessage:"Saved objects with unmatched datafeed IDs ({count})",values:{count:t}})))),Object(c.jsx)(r.EuiText,{size:"s"},Object(c.jsx)("p",null,Object(c.jsx)(r.EuiTextColor,{color:"subdued"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.datafeedsRemoved.description",defaultMessage:"If there are saved objects that use a datafeed that does not exist, they will be deleted."})))));return Object(c.jsx)(f,{id:"datafeedsRemoved",title:a,results:e.datafeedsRemoved})},f=({id:e,title:t,results:a})=>Object(c.jsx)(r.EuiAccordion,{id:e,buttonContent:t,paddingSize:"l"},Object.entries(a).map((([e,t])=>Object(c.jsx)(i.Fragment,{key:e},Object(c.jsx)(r.EuiText,{size:"s"},Object(c.jsx)("h4",null,e),Object(c.jsx)("ul",null,Object.keys(t).map((e=>Object(c.jsx)("li",{key:e},e))))),Object(c.jsx)(r.EuiSpacer,{size:"s"})))));function h(e){return Object.values(e).flatMap((e=>Object.keys(e))).length}var g=a(85);const j=({onClose:e})=>{const{displayErrorToast:t,displaySuccessToast:a}=Object(g.c)(),[u,p]=Object(i.useState)(!1),[m,b]=Object(i.useState)(!1),[f,h]=Object(i.useState)(null),{savedObjects:{syncSavedObjects:j}}=Object(l.a)();async function x(e=!0){p(!0);try{const t=await j(e);h(t);const a=Object.values(t).reduce(((e,t)=>e+Object.keys(t).length),0);return b(a>0),p(!1),t}catch(e){t(e),p(!1)}return null}return Object(i.useEffect)((()=>{x()}),[]),Object(c.jsx)(n.a.Fragment,null,Object(c.jsx)(r.EuiFlyout,{maxWidth:600,onClose:e,"data-test-subj":"mlJobMgmtSyncFlyout"},Object(c.jsx)(r.EuiFlyoutHeader,{hasBorder:!0},Object(c.jsx)(r.EuiTitle,{size:"m"},Object(c.jsx)("h2",null,Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.headerLabel",defaultMessage:"Synchronize saved objects"})))),Object(c.jsx)(r.EuiFlyoutBody,null,Object(c.jsx)(r.EuiCallOut,{color:"primary"},Object(c.jsx)(r.EuiText,{size:"s"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.description",defaultMessage:"Synchronize the saved objects if they are out of sync with the machine learning jobs in Elasticsearch."}))),Object(c.jsx)(r.EuiSpacer,null),Object(c.jsx)(d,{syncItems:f})),Object(c.jsx)(r.EuiFlyoutFooter,null,Object(c.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(c.jsx)(r.EuiFlexItem,{grow:!1},Object(c.jsx)(r.EuiButtonEmpty,{iconType:"cross",onClick:e,flush:"left","data-test-subj":"mlJobMgmtSyncFlyoutCloseButton"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.closeButton",defaultMessage:"Close"}))),Object(c.jsx)(r.EuiFlexItem,{grow:!1},Object(c.jsx)(r.EuiButton,{onClick:async function(){if(m){const e=await x(!1);if(await x(!0),null===e)return;const{successCount:i,errorCount:n}=function(e){let t=0,a=0;return Object.values(e).forEach((e=>{Object.values(e).forEach((e=>{Object.values(e).forEach((({success:e,error:i})=>{!0===e?t++:void 0!==i&&a++}))}))})),{successCount:t,errorCount:a}}(e);if(n>0){const a=s.i18n.translate("xpack.ml.management.syncSavedObjectsFlyout.sync.error",{defaultMessage:"Some jobs or trained models cannot be synchronized."});return void t(e,a)}a(s.i18n.translate("xpack.ml.management.syncSavedObjectsFlyout.sync.success",{defaultMessage:"{successCount} {successCount, plural, one {item} other {items}} synchronized",values:{successCount:i}}))}},fill:!0,isDisabled:!1===m||!0===u,"data-test-subj":"mlJobMgmtSyncFlyoutSyncButton"},Object(c.jsx)(o.FormattedMessage,{id:"xpack.ml.management.syncSavedObjectsFlyout.syncButton",defaultMessage:"Synchronize"})))))))}},,function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var i=a(17),n=a(44),s=a(63),o=a(2),r=a(13);function l(e){return null!==e?o.i18n.translate("xpack.ml.jobSelector.filterBar.invalidSearchErrorMessage",{defaultMessage:"Invalid search: {errorMessage}",values:{errorMessage:e.message}}):""}function c({checkboxDisabledCheck:e,columns:t,currentPage:a=0,filterDefaultFields:c,filters:d,items:u,itemsPerPage:p=20,onTableChange:m,radioDisabledCheck:b,selectedIds:f,setCurrentPaginationData:h,singleSelection:g,sortableProperties:j,tableItemId:x="id"}){const[v,y]=Object(i.useState)(R()),[O,E]=Object(i.useState)(u),[w,M]=Object(i.useState)(f),[S,_]=Object(i.useState)(""),[T,C]=Object(i.useState)(),[k,F]=Object(i.useState)({itemsPerPage:p,firstItemIndex:0,lastItemIndex:1}),[I,D]=Object(i.useState)(n.EuiSearchBar.Query.MATCH_ALL),[A,L]=Object(i.useState)(null);function R(){const e={all:!1};return f.forEach((t=>{e[t]=!0})),e}function N({isSelected:e,itemId:t}){const a=Object.getOwnPropertyNames(v),i=O.map((e=>e[x]));let n=a.filter((e=>!0===v[e]&&e!==t));"all"!==t?!0===e&&n.push(t):!1===e?n=n.filter((e=>!1===i.includes(e))):(n=[...n,...i],n=[...new Set(n)]),h&&h({pageIndex:T.getCurrentPageIndex(),itemsPerPage:k.itemsPerPage}),m(n)}function P({query:e,error:t}){if(t)L(t);else{const t=n.EuiSearchBar.Query.execute(e,u,{defaultFields:c});L(null),E(t),D(e)}}function z(e){return!0===v[e]}function B(){return-1===O.findIndex((e=>!z(e[x])))}Object(i.useEffect)((()=>{E(u),P({query:I})}),[u]),Object(i.useEffect)((()=>{y(R())}),[f]),Object(i.useEffect)((()=>{const e=new s.Pager(O.length,p,a);F({itemsPerPage:p,firstItemIndex:e.getFirstItemIndex(),lastItemIndex:e.getLastItemIndex()}),C(e)}),[O]);const V=Object(i.useMemo)((()=>Object(n.htmlIdGenerator)()()),[]);function J(e){const t=o.i18n.translate("xpack.ml.jobSelector.customTable.selectAllCheckboxLabel",{defaultMessage:"Select all"});return Object(r.jsx)(n.EuiCheckbox,{id:`${e?"mobile-":""}${V}`,label:e?t:null,checked:B(),onChange:G,type:e?null:"inList"})}function U(e){if(g){const t=w[0];y({...v,[t]:!1,[e]:!0}),function(e){m([e])}(e),M([e])}else{const t=!z(e);y({...v,[e]:t}),N({isSelected:t,itemId:e})}}function G(){const e=B()||!0===v.all,t={};O.forEach((a=>t[a[x]]=!e)),y(t),N({isSelected:!e,itemId:"all"})}return Object(r.jsx)(i.Fragment,null,Object(r.jsx)(n.EuiSpacer,{size:"s"}),Object(r.jsx)(n.EuiFlexGroup,{direction:"column"},Object(r.jsx)(n.EuiFlexItem,{grow:!1,"data-test-subj":"mlCustomSelectionTableSearchBar"},Object(r.jsx)(n.EuiSearchBar,{defaultQuery:I,box:{incremental:!0,placeholder:o.i18n.translate("xpack.ml.jobSelector.customTable.searchBarPlaceholder",{defaultMessage:"Search..."})},filters:d,onChange:P}),Object(r.jsx)(n.EuiFormRow,{fullWidth:!0,isInvalid:null!==A,error:l(A),style:{maxHeight:"0px"}},Object(r.jsx)(i.Fragment,null)))),Object(r.jsx)(n.EuiSpacer,{size:"m"}),Object(r.jsx)(n.EuiTableHeaderMobile,null,Object(r.jsx)(n.EuiFlexGroup,{responsive:!1,justifyContent:"spaceBetween",alignItems:"baseline"},Object(r.jsx)(n.EuiFlexItem,{grow:!1},J(!0)))),Object(r.jsx)(n.EuiTable,{"data-test-subj":"mlCustomSelectionTable"},Object(r.jsx)(n.EuiTableHeader,null,function(){const e=[];return t.forEach(((a,i)=>{a.isCheckbox&&!g?e.push(Object(r.jsx)(n.EuiTableHeaderCellCheckbox,{key:a.id,width:a.width},J())):e.push(Object(r.jsx)(n.EuiTableHeaderCell,{key:a.id,align:t[i].alignment,width:a.width,onSort:a.isSortable?()=>function(e){j.sortOn(e);const t=j.sortItems(O);E(t),_(e)}(a.id):void 0,isSorted:S===a.id,isSortAscending:!j||j.isAscendingByName(a.id),mobileOptions:a.mobileOptions},a.label))})),e.length?e:null}()),Object(r.jsx)(n.EuiTableBody,null,function(){const a=a=>{const i=t.map((t=>{const i=a[t.id];let s;return t.isCheckbox?Object(r.jsx)(n.EuiTableRowCellCheckbox,{key:t.id},!g&&Object(r.jsx)(n.EuiCheckbox,{disabled:void 0!==e?e(a):void 0,id:`${a[x]}-checkbox`,"data-test-subj":`${a[x]}-checkbox`,checked:z(a[x]),onChange:()=>U(a[x]),type:"inList"}),g&&Object(r.jsx)(n.EuiRadio,{id:a[x],"data-test-subj":`${a[x]}-radio-button`,checked:z(a[x]),onChange:()=>U(a[x]),disabled:void 0!==b?b(a):void 0})):(s=t.render?t.render(a):i,Object(r.jsx)(n.EuiTableRowCell,{key:t.id,align:t.alignment,truncateText:i&&i.truncateText,textOnly:!i||i.textOnly,mobileOptions:{header:t.label,...t.mobileOptions}},s))}));return Object(r.jsx)(n.EuiTableRow,{key:a[x],isSelected:z(a[x]),isSelectable:!0,hasActions:!0,"data-test-subj":`mlCustomSelectionTableRow row-${a[x]}`},i)},i=[];for(let e=k.firstItemIndex;e<=k.lastItemIndex;e++){const t=O[e];if(void 0===t)break;i.push(a(t))}return i}())),Object(r.jsx)(n.EuiSpacer,{size:"m"}),void 0!==T&&Object(r.jsx)(n.EuiTablePagination,{activePage:T.getCurrentPageIndex(),itemsPerPage:k.itemsPerPage,itemsPerPageOptions:[5,10,20,50],pageCount:T.getTotalPages(),onChangeItemsPerPage:function(e){T.setItemsPerPage(e),F({...k,itemsPerPage:e,firstItemIndex:T.getFirstItemIndex(),lastItemIndex:T.getLastItemIndex()})},onChangePage:e=>function(e){T.goToPageIndex(e),F({...k,firstItemIndex:T.getFirstItemIndex(),lastItemIndex:T.getLastItemIndex()})}(e)}))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return i.c})),a.d(t,"b",(function(){return i.d})),a.d(t,"c",(function(){return o}));var i=a(161),n=a(17),s=a(13);const o=e=>{const t=Object(i.e)(),a=Object(n.useCallback)((e=>{t(e)}),[]);return{action:Object(n.useMemo)((()=>({name:()=>Object(s.jsx)(i.a,{isDisabled:!e}),enabled:()=>e,description:i.b,icon:"copy",type:"icon",onClick:a,"data-test-subj":"mlAnalyticsJobCloneButton"})),[])}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return i.b})),a.d(t,"b",(function(){return h}));var i=a(135),n=a(17),s=a(2),o=a(47),r=a(26),l=a(81),c=a(102),d=a(92),u=a(347),p=a(278),m=a(279);async function b(e){let t,a;try{t=await l.ml.checkIndicesExists({indices:[e]})}catch(e){a=Object(r.b)(e)}return{resp:t,errorMessage:a}}function f(e=1e3){return new Promise((t=>{setTimeout(t,e)}))}const h=()=>{const e=Object(c.b)(),[t,a]=Object(n.useReducer)(m.b,Object(i.e)()),{refresh:h}=Object(d.x)(),{form:g,jobConfig:j,isAdvancedEditorEnabled:x}=t,{createIndexPattern:v,jobId:y}=g;let{destinationIndex:O}=g;const E=e=>a({type:p.a.ADD_REQUEST_MESSAGE,requestMessage:e}),w=e=>{a({type:p.a.SET_FORM_STATE,payload:e})},M=()=>{a({type:p.a.SWITCH_TO_ADVANCED_EDITOR})},S=e=>{a({type:p.a.SET_ESTIMATED_MODEL_MEMORY_LIMIT,value:null!=e?e:""})};return{state:t,actions:{closeModal:()=>a({type:p.a.CLOSE_MODAL}),createAnalyticsJob:async()=>{a({type:p.a.RESET_REQUEST_MESSAGES});const t=x?j:Object(i.f)(g);x&&(O=t.dest.index);try{return await l.ml.dataFrameAnalytics.createDataFrameAnalytics(y,t),E({message:s.i18n.translate("xpack.ml.dataframe.stepCreateForm.createDataFrameAnalyticsSuccessMessage",{defaultMessage:"Request to create data frame analytics {jobId} acknowledged.",values:{jobId:y}})}),!0,a({type:p.a.SET_IS_JOB_CREATED,isJobCreated:true}),v&&(async()=>{const t=O,a=await async function(e){let t=15,a=await b(e),i=a.resp&&a.resp[e]&&a.resp[e].exists;for(;t>1&&!i;)t--,await f(1e3),a=await b(e),i=a.resp&&a.resp[e]&&a.resp[e].exists;return i?{success:!0,indexExists:!0}:{success:!1,indexExists:!1,...void 0!==a.errorMessage?{errorMessage:a.errorMessage}:{}}}(O);if(!0===(null==a?void 0:a.success)){if(!0===(null==a?void 0:a.indexExists))try{await e.dataViewsContract.createAndSave({title:t},!1,!0),E({message:s.i18n.translate("xpack.ml.dataframe.analytics.create.createDataViewSuccessMessage",{defaultMessage:"Kibana data view {dataViewName} created.",values:{dataViewName:t}})})}catch(e){e instanceof o.DuplicateDataViewError?E({error:s.i18n.translate("xpack.ml.dataframe.analytics.create.duplicateDataViewErrorMessageError",{defaultMessage:"The data view {dataViewName} already exists.",values:{dataViewName:t}}),message:s.i18n.translate("xpack.ml.dataframe.analytics.create.duplicateDataViewErrorMessage",{defaultMessage:"An error occurred creating the Kibana data view:"})}):E({error:Object(r.b)(e),message:s.i18n.translate("xpack.ml.dataframe.analytics.create.createDataViewErrorMessage",{defaultMessage:"An error occurred creating the Kibana data view:"})})}}else null!=a&&a.errorMessage?E({error:s.i18n.translate("xpack.ml.dataframe.analytics.create.errorCheckingDestinationIndexDataFrameAnalyticsJob",{defaultMessage:"{errorMessage}",values:{errorMessage:a.errorMessage}}),message:s.i18n.translate("xpack.ml.dataframe.analytics.create.errorOccurredCheckingDestinationIndexDataFrameAnalyticsJob",{defaultMessage:"An error occurred checking destination index exists."})}):E({error:s.i18n.translate("xpack.ml.dataframe.analytics.create.destinationIndexNotCreatedForDataFrameAnalyticsJob",{defaultMessage:"Destination index has not yet been created."}),message:s.i18n.translate("xpack.ml.dataframe.analytics.create.unableToCreateDataViewForDataFrameAnalyticsJob",{defaultMessage:"Unable to create data view."})})})(),h(),!0}catch(e){return E({error:Object(r.b)(e),message:s.i18n.translate("xpack.ml.dataframe.analytics.create.errorCreatingDataFrameAnalyticsJob",{defaultMessage:"An error occurred creating the data frame analytics job:"})}),!1}},initiateWizard:async()=>{await e.dataViewsContract.clearCache(),await(async()=>{try{const i={};(await e.dataViewsContract.getCache()||[]).forEach((e=>{var t;const a=null==e||null===(t=e.attributes)||void 0===t?void 0:t.title;if(void 0!==a){const t=(null==e?void 0:e.id)||"";i[a]={label:a,value:t}}})),t={indexPatternsMap:i},a({type:p.a.SET_INDEX_PATTERN_TITLES,payload:t})}catch(e){E({error:Object(r.b)(e),message:s.i18n.translate("xpack.ml.dataframe.analytics.create.errorGettingDataViewNames",{defaultMessage:"An error occurred getting the existing data view names:"})})}var t})()},resetAdvancedEditorMessages:()=>a({type:p.a.RESET_ADVANCED_EDITOR_MESSAGES}),setAdvancedEditorRawString:e=>a({type:p.a.SET_ADVANCED_EDITOR_RAW_STRING,advancedEditorRawString:e}),setFormState:w,setJobConfig:e=>{a({type:p.a.SET_JOB_CONFIG,payload:e})},startAnalyticsJob:async()=>{try{const e=await l.ml.dataFrameAnalytics.startDataFrameAnalytics(y);if(!0!==e.acknowledged)throw new Error(e);E({message:s.i18n.translate("xpack.ml.dataframe.analytics.create.startDataFrameAnalyticsSuccessMessage",{defaultMessage:"Request to start data frame analytics {jobId} acknowledged.",values:{jobId:y}})}),!0,a({type:p.a.SET_IS_JOB_STARTED,isJobStarted:true}),h()}catch(e){E({error:Object(r.b)(e),message:s.i18n.translate("xpack.ml.dataframe.analytics.create.errorStartingDataFrameAnalyticsJob",{defaultMessage:"An error occurred starting the data frame analytics job:"})})}},switchToAdvancedEditor:M,switchToForm:()=>{a({type:p.a.SWITCH_TO_FORM})},setEstimatedModelMemoryLimit:S,setJobClone:async e=>{a({type:p.a.RESET_FORM});const t=Object(u.a)(e);Object(u.b)(t)?(w(Object(i.d)(t)),M()):(w(Object(i.d)(t)),S(t.model_memory_limit)),a({type:p.a.SET_JOB_CLONE,cloneJob:e})}}}}},,,,,,,,,,,,,,,,,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(371);case"v8light":return a(373)}},function(e,t,a){var i=a(86),n=a(372);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,'.ml-app .ml-icon-severity-critical,.ml-app .ml-icon-severity-major,.ml-app .ml-icon-severity-minor,.ml-app .ml-icon-severity-unknown,.ml-app .ml-icon-severity-warning{text-shadow:1px 1px 1px #343741}.ml-app .ml-icon-severity-critical{color:#fe5050}.ml-app .ml-icon-severity-major{color:#fba740}.ml-app .ml-icon-severity-minor{color:#fdec25}.ml-app .ml-icon-severity-warning{color:#8bc8fb}.ml-app .ml-icon-severity-unknown{color:#98a2b3}.ml-app .mlDataFrameAnalyticsRegression__evaluateStat{padding-top:24px}.ml-app .mlJobMapLegend__container{background-color:"#FFFFFF"}.ml-app .mlJobMapLegend__indexPattern{background-color:#fff;border:2px solid #d36086;display:"inline-block";height:12px;transform:rotate(45deg);width:12px}.ml-app .mlJobMapLegend__transform{background-color:#fff;border:2px solid #6092c0;display:"inline-block";height:12px;width:12px}.ml-app .mlJobMapLegend__analytics{background-color:#fff;border:2px solid #54b399;border-radius:50%;display:"inline-block";height:12px;width:12px}.ml-app .mlJobMapLegend__sourceNode{background-color:#f3d371;border:1px solid #343741;border-radius:6px;display:"inline-block";height:12px;width:12px}.ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent{animation:none!important}.ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent .euiTableCellContent__text{width:100%}.ml-app .mlAnalyticsTable .euiIcon[data-is-loaded]{animation:none!important}.ml-app .mlTaskModeBadge,.ml-app .mlTaskStateBadge{max-width:100px}.ml-app .dataFrameAnalyticsCreateSearchDialog{min-height:600px;width:720px}.ml-app .dfAnalyticsCreationWizard__card{width:300px}.ml-app .mlSwimLaneContainer .echLegendListContainer{height:34px!important}.ml-app .mlSwimLaneContainer .echLegendList{display:flex!important;flex-wrap:nowrap;justify-content:space-between!important;position:absolute;right:0}.ml-app .ml-explorer-chart-eui-icon-tip{max-width:none}.ml-app .ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}.ml-app .ml-reset-font-weight{font-weight:400}.ml-app .ml-explorer-chart-container{overflow:hidden}.ml-app .ml-explorer-chart-container .ml-explorer-chart-svg{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:12px}.ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect{fill:#1d1e24;opacity:1}.ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval{fill:#c8c8c81a;stroke:#98a2b3;stroke-width:2px;stroke-opacity:.8}.ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker{stroke-width:1px;stroke:#98a2b3;fill:#343741;pointer-events:none}.ml-app .ml-explorer-chart-container .axis line,.ml-app .ml-explorer-chart-container .axis path{fill:none;stroke:#343741;shape-rendering:crispEdges}.ml-app .ml-explorer-chart-container .axis .tick line.ml-tick-emphasis{stroke:#0003}.ml-app .ml-explorer-chart-container .axis text{fill:#98a2b3}.ml-app .ml-explorer-chart-container .axis .tick line{stroke:#343741;stroke-width:1px}.ml-app .ml-explorer-chart-container .values-line{fill:none;stroke:#36a2ef;stroke-width:2}.ml-app .ml-explorer-chart-container .values-dots circle,.ml-app .ml-explorer-chart-container .values-dots-circle{fill:#36a2ef;stroke-width:0}.ml-app .ml-explorer-chart-container .values-dots circle.values-dots-circle-blur{fill:#535966}.ml-app .ml-explorer-chart-container .metric-value{fill:#0000;stroke:#36a2ef;stroke-width:0;opacity:1}.ml-app .ml-explorer-chart-container .anomaly-marker{stroke-width:1px;stroke:#535966}.ml-app .ml-explorer-chart-container .anomaly-marker:hover{stroke-width:6px;stroke:#36a2ef}.ml-app .ml-explorer-chart-container .anomaly-marker.critical{fill:#fe5050}.ml-app .ml-explorer-chart-container .anomaly-marker.major{fill:#fba740}.ml-app .ml-explorer-chart-container .anomaly-marker.minor{fill:#fdec25}.ml-app .ml-explorer-chart-container .anomaly-marker.warning{fill:#8bc8fb}.ml-app .ml-explorer-chart-container .anomaly-marker.low{fill:#d2e9f7}.ml-app .ml-explorer-chart-container .anomaly-marker:hover,.ml-app .ml-explorer-chart-container .metric-value:hover{stroke-width:6px;stroke-opacity:.65}.ml-app .ml-explorer-chart{overflow:hidden}.ml-app .ml-explorer-chart-content-wrapper{height:215px}.ml-app .ml-explorer-chart-axis-emphasis{font-weight:700}.ml-app .ml-edit-url-form .url-label{width:250px}.ml-app .ml-edit-url-form .url-link-to-radio .euiRadio{display:inline-block;padding-right:24px}.ml-app .ml-edit-url-form .url-time-range{width:150px}.ml-app .new-job-button-container{float:right}.ml-app .edit-custom-url-panel .close-editor-button{float:right;position:relative;right:0;top:-4px}.ml-app .tab-contents{background-color:#1d1e24;margin:-8px;padding:8px}.ml-app .tab-contents .col-md-6:first-child{padding-right:7px}.ml-app .tab-contents .col-md-6:nth-child(2){padding-left:7px}.ml-app .tab-contents .job-section{background-color:#25262e;border:1px solid #343741;border-radius:6px;margin:4px 0;overflow:auto;padding:5px 15px}.ml-app .tab-contents .job-section .euiTable{background-color:initial}.ml-app .tab-contents .job-section .euiTable .euiTableRow:first-child .euiTableRowCell{border-top:0}.ml-app .tab-contents .job-section .euiTable .euiTableRow:last-child .euiTableRowCell{border-bottom:0}.ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell{border-bottom:1px solid #343741;vertical-align:top}.ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell .euiTableCellContent__text{word-wrap:break-word}.ml-app .tab-contents .job-section .euiTable .euiTableRow:hover{background-color:inherit}.ml-app .tab-contents .job-section .job-item{font-size:12px}.ml-app .tab-contents .job-section .job-item.header{font-weight:700}.ml-app .tab-contents .json-textarea{height:500px}.ml-app .job-messages-table{max-height:500px;overflow:auto;text-align:left}.ml-app .job-messages-table tr:last-child td{border-bottom:none}.ml-app .job-messages-table .euiTableRowCell{background-color:#1d1e24}.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .group-item{padding:8px 16px}.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .inline-group{border:1px solid #1d1e24;border-radius:6px}.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus,.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover{text-decoration:none}.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus .inline-group,.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover .inline-group{border:1px solid #98a2b3;box-shadow:0 1px 2px #535966}.ml-app .inline-group{background-color:#343741;border-radius:2px;color:#1d1e24;display:inline-block;font-size:12px;margin:0 3px;padding:2px 5px;vertical-align:text-top}.ml-app .actions-bar{align-items:center;display:flex;min-height:60px}.ml-app .job-management{padding:20px}.ml-app .multi-select-actions .actions-border,.ml-app .multi-select-actions .actions-border-large{border-right:1px solid #343741;display:inline-block;height:20px;margin:0 5px;vertical-align:middle;width:1px}.ml-app .multi-select-actions .actions-border-large{height:35px;margin:0 15px}.ml-app .multi-select-actions .results-button{margin-right:5px}.ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem__text{white-space:nowrap}.ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled){color:#f86b63}.ml-app .multi-select-actions-no-display{display:none}.ml-app .group-selector{max-width:300px}.ml-app .group-selector .euiPopoverTitle{margin-bottom:8px!important}.ml-app .group-list{max-height:350px;overflow:auto}.ml-app .group-list .group-item{border-bottom:1px solid #343741;cursor:pointer;line-height:18px;padding:6px 0}.ml-app .group-list .group-item:focus{background-color:#eef6f9;box-shadow:none}.ml-app .group-list .group-item .check{display:inline-block;width:20px}.ml-app .group-list .group-item .inline-group{border:1px solid #1d1e24;border-radius:6px}.ml-app .group-list .group-item:hover .inline-group{border:1px solid #98a2b3;box-shadow:0 1px 2px #535966}.ml-app .group-list .group-item:last-child{border-bottom:none;margin-bottom:0}.ml-app .new-group-input{padding-bottom:0}.ml-app .ml-custom-urls-selection>.euiFlexGroup>.euiFlexItem:first-child{max-width:388px}.ml-app .ml-custom-urls-selection>.euiFlexGroup>.euiFlexItem:last-child{flex-basis:50%}.ml-app .mlOverviewPanel__isLoading{padding:10%;text-align:center}.ml-app .mlOverviewPanel__spinner{display:inline-block}.ml-app .ml-time-series-explorer{color:#98a2b3}.ml-app .ml-time-series-explorer .forecast-controls{float:right}.ml-app .ml-time-series-explorer .ml-timeseries-chart svg{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:12px}.ml-app .ml-time-series-explorer .ml-timeseries-chart .axis line,.ml-app .ml-time-series-explorer .ml-timeseries-chart .axis path{fill:none;stroke:#343741;shape-rendering:crispEdges;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .axis text{fill:#dfe5ef}.ml-app .ml-time-series-explorer .ml-timeseries-chart .axis .tick line{stroke:#343741}.ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border{stroke:#343741;fill:none;stroke-width:1;shape-rendering:crispEdges}.ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight{stroke:#98a2b3;stroke-width:2}.ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight:hover{opacity:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .area{stroke-width:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .area.bounds{fill:#36a2ef33;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line{fill:none;stroke:#36a2ef;stroke-width:2;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line.forecast{stroke:#d6bf57;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .hidden{visibility:hidden}.ml-app .ml-time-series-explorer .ml-timeseries-chart .area.forecast{fill:#d6bf574d;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value{fill:#0000;stroke:#36a2ef;stroke-width:0;opacity:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker{stroke-width:1px;stroke:#535966}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.critical{fill:#fe5050}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.major{fill:#fba740}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.minor{fill:#fdec25}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.warning{fill:#8bc8fb}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.low{fill:#d2e9f7}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.highlighted,.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker:hover,.ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value:hover{stroke-width:6px;stroke-opacity:.65;stroke:#36a2ef}.ml-app .ml-time-series-explorer .ml-timeseries-chart rect.scheduled-event-marker{stroke-width:1px;stroke:#98a2b3;fill:#343741}.ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value,.ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value:hover{stroke:#d6bf57}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background line{fill:none;shape-rendering:crispEdges;stroke:#25262e}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background rect{fill:#25262e}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom{fill:#98a2b3}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a text{fill:#36a2ef;cursor:pointer}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:active,.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:focus,.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:hover{text-decoration:underline}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .x.axis path{display:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .axis text{fill:#dfe5ef;font-size:10px}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .values-line{stroke-width:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask polygon{fill-opacity:.1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .area.bounds{fill:#343741}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-line{stroke-width:1;stroke:#535966}.ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane .axis text,.ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane rect.swimlane-cell-hidden{display:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent{fill-opacity:0;shape-rendering:crispEdges;stroke:#98a2b3;stroke-width:2;cursor:move}.ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent:hover{opacity:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .top-border{fill:#1d1e24}.ml-app .ml-time-series-explorer .ml-timeseries-chart foreignObject.brush-handle{padding-top:1px;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner{fill:#98a2b3;background-color:#343741;border:1px solid #98a2b3;cursor:ew-resize;font-size:14px;height:70px;margin-top:9px;text-align:center;width:10px}.ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-left{border-radius:6px 0 0 6px}.ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-right{border-radius:0 6px 6px 0}.ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle{stroke-width:1;stroke:#98a2b3;fill:#343741;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle:hover{opacity:1}.ml-app .mlTimeSeriesExplorerProgress{background-color:#1d1e24}.ml-app .mlTimeSeriesExplorerProgress::-moz-progress-bar,.ml-app .mlTimeSeriesExplorerProgress::-webkit-progress-bar{background-color:#1d1e24}.ml-app .mlAnnotationBrush .extent{stroke:#343741;stroke-width:2px;stroke-dasharray:2 2;fill:#25262e;shape-rendering:geometricPrecision}.ml-app .mlAnnotationRect{stroke:#fff;stroke-width:2px;stroke-opacity:.2;fill:#fff;fill-opacity:.05;shape-rendering:geometricPrecision;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .mlAnnotationRect-isHighlight{stroke-opacity:.4;fill-opacity:.1;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .mlAnnotationRect-isBlur{stroke-opacity:.1;fill-opacity:.025;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .mlAnnotationText{text-anchor:middle;fill:#fff;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:12px;font-weight:500;transition:fill .15s;-webkit-user-select:none;user-select:none}.ml-app .mlAnnotationText-isBlur{fill:#535966;transition:fill .15s}.ml-app .mlAnnotationTextRect{fill:#343741;transition:fill .15s}.ml-app .mlAnnotationTextRect-isBlur{fill:#25262e;transition:fill .15s}.ml-app .mlAnnotationHidden{display:none}.ml-app .mlContextAnnotationRect{stroke:#fff;stroke-width:2px;stroke-opacity:.2;fill:#fff;fill-opacity:.05;shape-rendering:geometricPrecision;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .mlContextAnnotationRect-isBlur{stroke-opacity:.1;fill-opacity:.025;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__title{flex-basis:30%}.ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__description{flex-basis:70%}.ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list>*{margin-top:4px}.ml-app .ml-anomalies-table .ml-icon-severity-critical,.ml-app .ml-anomalies-table .ml-icon-severity-major,.ml-app .ml-anomalies-table .ml-icon-severity-minor,.ml-app .ml-anomalies-table .ml-icon-severity-unknown,.ml-app .ml-anomalies-table .ml-icon-severity-warning{color:inherit;text-shadow:none}.ml-app .ml-anomalies-table .ml-icon-severity-critical .euiIcon{fill:#fe5050}.ml-app .ml-anomalies-table .ml-icon-severity-major .euiIcon{fill:#fba740}.ml-app .ml-anomalies-table .ml-icon-severity-minor .euiIcon{fill:#fdec25}.ml-app .ml-anomalies-table .ml-icon-severity-warning .euiIcon{fill:#8bc8fb}.ml-app .ml-anomalies-table .ml-icon-severity-unknown .euiIcon{fill:#98a2b3}.ml-app .ml-anomalies-table tr td:first-child,.ml-app .ml-anomalies-table tr th:first-child{width:32px}.ml-app .ml-anomalies-table .euiTableCellContent .euiHealth{font-size:inherit}.ml-app .ml-anomalies-table .euiTableCellContent .detector-rules-icon{margin-left:4px;opacity:.5}.ml-app .ml-anomalies-table .euiContextMenuItem{min-width:150px}.ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__header{display:inline}.ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__link{width:100%}.ml-app .ml-anomalies-table .category-example{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ml-app .ml-anomalies-table .mlAnomalyCategoryExamples{padding:24px}.ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__item{display:block;font-family:Roboto Mono,Consolas,Menlo,Courier,monospace;white-space:wrap}.ml-app .ml-anomalies-table .interim-result{font-style:italic}.ml-app .ml-anomalies-table .ml-anomalies-table-details{padding:12px}.ml-app .mlColorRangeLegend text{fill:#98a2b3;font-size:10px;font-size:.71429rem}.ml-app .mlColorRangeLegend .axis path{fill:none;stroke:none}.ml-app .mlColorRangeLegend .axis line{fill:none;stroke:#535966;shape-rendering:crispEdges}.ml-app .ml-table-controls label{font-size:12px;padding:0 0 4px 4px}.ml-app .ml-table-controls .ml-table-controls-element{display:inline-block;padding-left:16px}.ml-app .ml-table-controls select{font-size:12px;font-style:normal}.ml-app .ml-select-severity .euiFormControlLayoutClearButton{display:none}.ml-app .field-value-short{display:inline-block;max-width:100%;overflow:hidden!important;text-overflow:ellipsis!important;vertical-align:bottom;white-space:nowrap!important}.ml-app .field-value-long{overflow-wrap:break-word}.ml-app .filter-button{height:16px;opacity:.5;transform:translateY(-1px);width:16px}.ml-app .filter-button .euiIcon{height:12px;width:12px}.ml-app .filter-button:hover{opacity:1}.ml-app .ml-influencers-list{line-height:1.45}.ml-app .ml-influencers-list .field-label{font-size:12px;max-height:14px;max-width:calc(100% - 102px);text-align:left}.ml-app .ml-influencers-list .field-label .field-value{display:inline-block;max-width:100%;overflow:hidden!important;text-overflow:ellipsis!important;vertical-align:bottom;white-space:nowrap!important}.ml-app .ml-influencers-list .progress{background-color:initial;color:#98a2b3;display:inline-block;height:22px;margin-bottom:0;min-width:70px;width:calc(100% - 34px)}.ml-app .ml-influencers-list .progress .progress-bar-holder{width:calc(100% - 28px)}.ml-app .ml-influencers-list .progress .progress-bar{display:inline-block;height:2px;line-height:18px;margin-top:12px;text-align:right;transition:none}.ml-app .ml-influencers-list .progress.critical .progress-bar{background-color:#fe5050}.ml-app .ml-influencers-list .progress.critical .score-label{border-color:#fe5050}.ml-app .ml-influencers-list .progress.major .progress-bar{background-color:#fba740}.ml-app .ml-influencers-list .progress.major .score-label{border-color:#fba740}.ml-app .ml-influencers-list .progress.minor .progress-bar{background-color:#fdec25}.ml-app .ml-influencers-list .progress.minor .score-label{border-color:#fdec25}.ml-app .ml-influencers-list .progress.warning .progress-bar{background-color:#8bc8fb}.ml-app .ml-influencers-list .progress.warning .score-label{border-color:#8bc8fb}.ml-app .ml-influencers-list .score-label{display:inline;font-size:12px;line-height:14px;margin-left:4px;text-align:center;white-space:nowrap}.ml-app .ml-influencers-list .total-score-label{border:1px solid #343741;border-radius:6px;color:#98a2b3;display:inline-block;font-size:11px;line-height:14px;margin-top:4px;padding:2px;text-align:center;vertical-align:top;width:32px}.ml-app .ml-influencers-list-tooltip{word-break:break-all}.ml-app .ml-items-grid-page-size-menu{width:140px}.ml-app .mlJobSelectorFlyoutBody>.euiFlyoutBody__overflow{padding-top:8px}.ml-app .mlJobSelector__ganttBar{background-color:#79adda;border-radius:2px;height:12px}.ml-app .mlJobSelector__ganttBarBackEdge{border-left:1px solid #d6d6d6;border-right:1px solid #d6d6d6;height:16px;margin-bottom:-14px;padding-top:8px}.ml-app .mlJobSelector__ganttBarDashed{border-top:1px dashed #d6d6d6;height:1px}.ml-app .mlJobSelector__ganttBarRunning{animation:progress-bar-stripes 2s linear infinite;background-image:linear-gradient(45deg,#ffffff26 25%,#0000 0,#0000 50%,#ffffff26 0,#ffffff26 75%,#0000 0,#0000);background-size:40px 40px}.ml-app .ml-loading-indicator{align-items:center;display:flex;flex-direction:column;font-size:17px;justify-content:center;text-align:center}.ml-app .ml-rule-editor-flyout{font-size:14px}.ml-app .ml-rule-editor-flyout .select-rule-action .rule-detector-description-list{padding-left:16px}.ml-app .ml-rule-editor-flyout .select-rule-action-panel{padding:8px 0}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title{flex-basis:15%;padding:0 16px}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description{flex-basis:85%}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(2),.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:first-child{border-bottom:1px solid #343741;color:#dfe5ef;font-weight:700;padding-bottom:12px}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(4),.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(3){padding-top:8px}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList.euiDescriptionList--column>*{margin-top:4px}.ml-app .ml-rule-editor-flyout .scope-enable-checkbox .euiCheckbox__input[disabled]~.euiCheckbox__label{color:inherit}.ml-app .ml-rule-editor-flyout .scope-field-checkbox{margin-right:2px}.ml-app .ml-rule-editor-flyout .scope-field-checkbox .euiCheckbox{margin-top:4px}.ml-app .ml-rule-editor-flyout .scope-field-button{border-bottom:none;pointer-events:none}.ml-app .ml-rule-editor-flyout .scope-edit-filter-link{font-size:12px;line-height:32px}.ml-app .ml-rule-editor-flyout .condition-edit-value-field{height:28px;margin:0 2px;width:170px}.ml-app .ml-rule-editor-flyout .condition-edit-value-field input{height:28px}.ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled{pointer-events:none}.ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__description,.ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__value{color:#343741}.ml-app .ml-rule-editor-flyout .text-highlight{font-weight:700}.ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__title{flex-basis:15%}.ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__description{flex-basis:85%}.ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list>*{margin-top:4px}.ml-app .stat{margin-right:8px}.ml-app .mlStatsBar{background-color:#25262e;height:42px;padding:14px}.ml-app .mlEmbeddedMapContent{display:flex;flex:1 1 100%;height:100%;min-height:0;width:100%;z-index:1}.ml-app .tab-datavisualizer_index_select,.ml-app .tab-explorer,.ml-app .tab-timeseriesexplorer{background-color:#1d1e24}.ml-app .button-wrapper{display:inline}.ml-app .button-wrapper.disabled .kuiButton[disabled]{pointer-events:none}.ml-app .button-wrapper.disabled{cursor:not-allowed}.ml-app .clear,.ml-app .clearfix{clear:both}.ml-app .mlDisableAntiAliasing{-webkit-font-smoothing:none}.ml-app .mlDisableAntiAliasing * canvas{image-rendering:pixelated}',""]),e.exports=t},function(e,t,a){var i=a(86),n=a(374);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,'.ml-app .ml-icon-severity-critical,.ml-app .ml-icon-severity-major,.ml-app .ml-icon-severity-minor,.ml-app .ml-icon-severity-unknown,.ml-app .ml-icon-severity-warning{text-shadow:1px 1px 1px #d3dae6}.ml-app .ml-icon-severity-critical{color:#cf4141}.ml-app .ml-icon-severity-major{color:#9e6929}.ml-app .ml-icon-severity-minor{color:#7c7313}.ml-app .ml-icon-severity-warning{color:#537896}.ml-app .ml-icon-severity-unknown{color:#69707d}.ml-app .mlDataFrameAnalyticsRegression__evaluateStat{padding-top:24px}.ml-app .mlJobMapLegend__container{background-color:"#FFFFFF"}.ml-app .mlJobMapLegend__indexPattern{background-color:#fff;border:2px solid #d36086;display:"inline-block";height:12px;transform:rotate(45deg);width:12px}.ml-app .mlJobMapLegend__transform{background-color:#fff;border:2px solid #6092c0;display:"inline-block";height:12px;width:12px}.ml-app .mlJobMapLegend__analytics{background-color:#fff;border:2px solid #54b399;border-radius:50%;display:"inline-block";height:12px;width:12px}.ml-app .mlJobMapLegend__sourceNode{background-color:#fec514;border:1px solid #d3dae6;border-radius:6px;display:"inline-block";height:12px;width:12px}.ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent{animation:none!important}.ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent .euiTableCellContent__text{width:100%}.ml-app .mlAnalyticsTable .euiIcon[data-is-loaded]{animation:none!important}.ml-app .mlTaskModeBadge,.ml-app .mlTaskStateBadge{max-width:100px}.ml-app .dataFrameAnalyticsCreateSearchDialog{min-height:600px;width:720px}.ml-app .dfAnalyticsCreationWizard__card{width:300px}.ml-app .mlSwimLaneContainer .echLegendListContainer{height:34px!important}.ml-app .mlSwimLaneContainer .echLegendList{display:flex!important;flex-wrap:nowrap;justify-content:space-between!important;position:absolute;right:0}.ml-app .ml-explorer-chart-eui-icon-tip{max-width:none}.ml-app .ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}.ml-app .ml-reset-font-weight{font-weight:400}.ml-app .ml-explorer-chart-container{overflow:hidden}.ml-app .ml-explorer-chart-container .ml-explorer-chart-svg{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:12px}.ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect{fill:#fff;opacity:1}.ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval{fill:#c8c8c81a;stroke:#69707d;stroke-width:2px;stroke-opacity:.8}.ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker{stroke-width:1px;stroke:#69707d;fill:#d3dae6;pointer-events:none}.ml-app .ml-explorer-chart-container .axis line,.ml-app .ml-explorer-chart-container .axis path{fill:none;stroke:#d3dae6;shape-rendering:crispEdges}.ml-app .ml-explorer-chart-container .axis .tick line.ml-tick-emphasis{stroke:#0003}.ml-app .ml-explorer-chart-container .axis text{fill:#69707d}.ml-app .ml-explorer-chart-container .axis .tick line{stroke:#d3dae6;stroke-width:1px}.ml-app .ml-explorer-chart-container .values-line{fill:none;stroke:#07c;stroke-width:2}.ml-app .ml-explorer-chart-container .values-dots circle,.ml-app .ml-explorer-chart-container .values-dots-circle{fill:#07c;stroke-width:0}.ml-app .ml-explorer-chart-container .values-dots circle.values-dots-circle-blur{fill:#98a2b3}.ml-app .ml-explorer-chart-container .metric-value{fill:#0000;stroke:#07c;stroke-width:0;opacity:1}.ml-app .ml-explorer-chart-container .anomaly-marker{stroke-width:1px;stroke:#98a2b3}.ml-app .ml-explorer-chart-container .anomaly-marker:hover{stroke-width:6px;stroke:#07c}.ml-app .ml-explorer-chart-container .anomaly-marker.critical{fill:#fe5050}.ml-app .ml-explorer-chart-container .anomaly-marker.major{fill:#fba740}.ml-app .ml-explorer-chart-container .anomaly-marker.minor{fill:#fdec25}.ml-app .ml-explorer-chart-container .anomaly-marker.warning{fill:#8bc8fb}.ml-app .ml-explorer-chart-container .anomaly-marker.low{fill:#d2e9f7}.ml-app .ml-explorer-chart-container .anomaly-marker:hover,.ml-app .ml-explorer-chart-container .metric-value:hover{stroke-width:6px;stroke-opacity:.65}.ml-app .ml-explorer-chart{overflow:hidden}.ml-app .ml-explorer-chart-content-wrapper{height:215px}.ml-app .ml-explorer-chart-axis-emphasis{font-weight:700}.ml-app .ml-edit-url-form .url-label{width:250px}.ml-app .ml-edit-url-form .url-link-to-radio .euiRadio{display:inline-block;padding-right:24px}.ml-app .ml-edit-url-form .url-time-range{width:150px}.ml-app .new-job-button-container{float:right}.ml-app .edit-custom-url-panel .close-editor-button{float:right;position:relative;right:0;top:-4px}.ml-app .tab-contents{background-color:#fff;margin:-8px;padding:8px}.ml-app .tab-contents .col-md-6:first-child{padding-right:7px}.ml-app .tab-contents .col-md-6:nth-child(2){padding-left:7px}.ml-app .tab-contents .job-section{background-color:#f5f7fa;border:1px solid #d3dae6;border-radius:6px;margin:4px 0;overflow:auto;padding:5px 15px}.ml-app .tab-contents .job-section .euiTable{background-color:initial}.ml-app .tab-contents .job-section .euiTable .euiTableRow:first-child .euiTableRowCell{border-top:0}.ml-app .tab-contents .job-section .euiTable .euiTableRow:last-child .euiTableRowCell{border-bottom:0}.ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell{border-bottom:1px solid #d3dae6;vertical-align:top}.ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell .euiTableCellContent__text{word-wrap:break-word}.ml-app .tab-contents .job-section .euiTable .euiTableRow:hover{background-color:inherit}.ml-app .tab-contents .job-section .job-item{font-size:12px}.ml-app .tab-contents .job-section .job-item.header{font-weight:700}.ml-app .tab-contents .json-textarea{height:500px}.ml-app .job-messages-table{max-height:500px;overflow:auto;text-align:left}.ml-app .job-messages-table tr:last-child td{border-bottom:none}.ml-app .job-messages-table .euiTableRowCell{background-color:#fff}.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .group-item{padding:8px 16px}.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .inline-group{border:1px solid #fff;border-radius:6px}.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus,.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover{text-decoration:none}.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus .inline-group,.ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover .inline-group{border:1px solid #69707d;box-shadow:0 1px 2px #98a2b3}.ml-app .inline-group{background-color:#d3dae6;border-radius:2px;color:#fff;display:inline-block;font-size:12px;margin:0 3px;padding:2px 5px;vertical-align:text-top}.ml-app .actions-bar{align-items:center;display:flex;min-height:60px}.ml-app .job-management{padding:20px}.ml-app .multi-select-actions .actions-border,.ml-app .multi-select-actions .actions-border-large{border-right:1px solid #d3dae6;display:inline-block;height:20px;margin:0 5px;vertical-align:middle;width:1px}.ml-app .multi-select-actions .actions-border-large{height:35px;margin:0 15px}.ml-app .multi-select-actions .results-button{margin-right:5px}.ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem__text{white-space:nowrap}.ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled){color:#bd271e}.ml-app .multi-select-actions-no-display{display:none}.ml-app .group-selector{max-width:300px}.ml-app .group-selector .euiPopoverTitle{margin-bottom:8px!important}.ml-app .group-list{max-height:350px;overflow:auto}.ml-app .group-list .group-item{border-bottom:1px solid #d3dae6;cursor:pointer;line-height:18px;padding:6px 0}.ml-app .group-list .group-item:focus{background-color:#eef6f9;box-shadow:none}.ml-app .group-list .group-item .check{display:inline-block;width:20px}.ml-app .group-list .group-item .inline-group{border:1px solid #fff;border-radius:6px}.ml-app .group-list .group-item:hover .inline-group{border:1px solid #69707d;box-shadow:0 1px 2px #98a2b3}.ml-app .group-list .group-item:last-child{border-bottom:none;margin-bottom:0}.ml-app .new-group-input{padding-bottom:0}.ml-app .ml-custom-urls-selection>.euiFlexGroup>.euiFlexItem:first-child{max-width:388px}.ml-app .ml-custom-urls-selection>.euiFlexGroup>.euiFlexItem:last-child{flex-basis:50%}.ml-app .mlOverviewPanel__isLoading{padding:10%;text-align:center}.ml-app .mlOverviewPanel__spinner{display:inline-block}.ml-app .ml-time-series-explorer{color:#69707d}.ml-app .ml-time-series-explorer .forecast-controls{float:right}.ml-app .ml-time-series-explorer .ml-timeseries-chart svg{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:12px}.ml-app .ml-time-series-explorer .ml-timeseries-chart .axis line,.ml-app .ml-time-series-explorer .ml-timeseries-chart .axis path{fill:none;stroke:#d3dae6;shape-rendering:crispEdges;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .axis text{fill:#343741}.ml-app .ml-time-series-explorer .ml-timeseries-chart .axis .tick line{stroke:#d3dae6}.ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border{stroke:#d3dae6;fill:none;stroke-width:1;shape-rendering:crispEdges}.ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight{stroke:#69707d;stroke-width:2}.ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight:hover{opacity:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .area{stroke-width:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .area.bounds{fill:#07c3;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line{fill:none;stroke:#07c;stroke-width:2;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line.forecast{stroke:#d6bf57;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .hidden{visibility:hidden}.ml-app .ml-time-series-explorer .ml-timeseries-chart .area.forecast{fill:#d6bf574d;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value{fill:#0000;stroke:#07c;stroke-width:0;opacity:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker{stroke-width:1px;stroke:#98a2b3}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.critical{fill:#fe5050}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.major{fill:#fba740}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.minor{fill:#fdec25}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.warning{fill:#8bc8fb}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.low{fill:#d2e9f7}.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.highlighted,.ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker:hover,.ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value:hover{stroke-width:6px;stroke-opacity:.65;stroke:#07c}.ml-app .ml-time-series-explorer .ml-timeseries-chart rect.scheduled-event-marker{stroke-width:1px;stroke:#69707d;fill:#d3dae6}.ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value,.ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value:hover{stroke:#d6bf57}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background line{fill:none;shape-rendering:crispEdges;stroke:#f5f7fa}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background rect{fill:#f5f7fa}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom{fill:#69707d}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a text{fill:#07c;cursor:pointer}.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:active,.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:focus,.ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:hover{text-decoration:underline}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .x.axis path{display:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .axis text{fill:#343741;font-size:10px}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .values-line{stroke-width:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask polygon{fill-opacity:.1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .area.bounds{fill:#d3dae6}.ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-line{stroke-width:1;stroke:#98a2b3}.ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane .axis text,.ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane rect.swimlane-cell-hidden{display:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent{fill-opacity:0;shape-rendering:crispEdges;stroke:#69707d;stroke-width:2;cursor:move}.ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent:hover{opacity:1}.ml-app .ml-time-series-explorer .ml-timeseries-chart .top-border{fill:#fff}.ml-app .ml-time-series-explorer .ml-timeseries-chart foreignObject.brush-handle{padding-top:1px;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner{fill:#69707d;background-color:#d3dae6;border:1px solid #69707d;cursor:ew-resize;font-size:14px;height:70px;margin-top:9px;text-align:center;width:10px}.ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-left{border-radius:6px 0 0 6px}.ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-right{border-radius:0 6px 6px 0}.ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle{stroke-width:1;stroke:#69707d;fill:#d3dae6;pointer-events:none}.ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle:hover{opacity:1}.ml-app .mlTimeSeriesExplorerProgress{background-color:#fff}.ml-app .mlTimeSeriesExplorerProgress::-moz-progress-bar,.ml-app .mlTimeSeriesExplorerProgress::-webkit-progress-bar{background-color:#fff}.ml-app .mlAnnotationBrush .extent{stroke:#d3dae6;stroke-width:2px;stroke-dasharray:2 2;fill:#f5f7fa;shape-rendering:geometricPrecision}.ml-app .mlAnnotationRect{stroke:#000;stroke-width:2px;stroke-opacity:.2;fill:#000;fill-opacity:.05;shape-rendering:geometricPrecision;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .mlAnnotationRect-isHighlight{stroke-opacity:.4;fill-opacity:.1;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .mlAnnotationRect-isBlur{stroke-opacity:.1;fill-opacity:.025;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .mlAnnotationText{text-anchor:middle;fill:#000;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:12px;font-weight:500;transition:fill .15s;-webkit-user-select:none;user-select:none}.ml-app .mlAnnotationText-isBlur{fill:#98a2b3;transition:fill .15s}.ml-app .mlAnnotationTextRect{fill:#d3dae6;transition:fill .15s}.ml-app .mlAnnotationTextRect-isBlur{fill:#f5f7fa;transition:fill .15s}.ml-app .mlAnnotationHidden{display:none}.ml-app .mlContextAnnotationRect{stroke:#000;stroke-width:2px;stroke-opacity:.2;fill:#000;fill-opacity:.05;shape-rendering:geometricPrecision;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .mlContextAnnotationRect-isBlur{stroke-opacity:.1;fill-opacity:.025;transition:stroke-opacity .15s;transition:fill-opacity .15s}.ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__title{flex-basis:30%}.ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__description{flex-basis:70%}.ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list>*{margin-top:4px}.ml-app .ml-anomalies-table .ml-icon-severity-critical,.ml-app .ml-anomalies-table .ml-icon-severity-major,.ml-app .ml-anomalies-table .ml-icon-severity-minor,.ml-app .ml-anomalies-table .ml-icon-severity-unknown,.ml-app .ml-anomalies-table .ml-icon-severity-warning{color:inherit;text-shadow:none}.ml-app .ml-anomalies-table .ml-icon-severity-critical .euiIcon{fill:#cf4141}.ml-app .ml-anomalies-table .ml-icon-severity-major .euiIcon{fill:#9e6929}.ml-app .ml-anomalies-table .ml-icon-severity-minor .euiIcon{fill:#7c7313}.ml-app .ml-anomalies-table .ml-icon-severity-warning .euiIcon{fill:#537896}.ml-app .ml-anomalies-table .ml-icon-severity-unknown .euiIcon{fill:#69707d}.ml-app .ml-anomalies-table tr td:first-child,.ml-app .ml-anomalies-table tr th:first-child{width:32px}.ml-app .ml-anomalies-table .euiTableCellContent .euiHealth{font-size:inherit}.ml-app .ml-anomalies-table .euiTableCellContent .detector-rules-icon{margin-left:4px;opacity:.5}.ml-app .ml-anomalies-table .euiContextMenuItem{min-width:150px}.ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__header{display:inline}.ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__link{width:100%}.ml-app .ml-anomalies-table .category-example{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ml-app .ml-anomalies-table .mlAnomalyCategoryExamples{padding:24px}.ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__item{display:block;font-family:Roboto Mono,Consolas,Menlo,Courier,monospace;white-space:wrap}.ml-app .ml-anomalies-table .interim-result{font-style:italic}.ml-app .ml-anomalies-table .ml-anomalies-table-details{padding:12px}.ml-app .mlColorRangeLegend text{fill:#69707d;font-size:10px;font-size:.71429rem}.ml-app .mlColorRangeLegend .axis path{fill:none;stroke:none}.ml-app .mlColorRangeLegend .axis line{fill:none;stroke:#98a2b3;shape-rendering:crispEdges}.ml-app .ml-table-controls label{font-size:12px;padding:0 0 4px 4px}.ml-app .ml-table-controls .ml-table-controls-element{display:inline-block;padding-left:16px}.ml-app .ml-table-controls select{font-size:12px;font-style:normal}.ml-app .ml-select-severity .euiFormControlLayoutClearButton{display:none}.ml-app .field-value-short{display:inline-block;max-width:100%;overflow:hidden!important;text-overflow:ellipsis!important;vertical-align:bottom;white-space:nowrap!important}.ml-app .field-value-long{overflow-wrap:break-word}.ml-app .filter-button{height:16px;opacity:.5;transform:translateY(-1px);width:16px}.ml-app .filter-button .euiIcon{height:12px;width:12px}.ml-app .filter-button:hover{opacity:1}.ml-app .ml-influencers-list{line-height:1.45}.ml-app .ml-influencers-list .field-label{font-size:12px;max-height:14px;max-width:calc(100% - 102px);text-align:left}.ml-app .ml-influencers-list .field-label .field-value{display:inline-block;max-width:100%;overflow:hidden!important;text-overflow:ellipsis!important;vertical-align:bottom;white-space:nowrap!important}.ml-app .ml-influencers-list .progress{background-color:initial;color:#69707d;display:inline-block;height:22px;margin-bottom:0;min-width:70px;width:calc(100% - 34px)}.ml-app .ml-influencers-list .progress .progress-bar-holder{width:calc(100% - 28px)}.ml-app .ml-influencers-list .progress .progress-bar{display:inline-block;height:2px;line-height:18px;margin-top:12px;text-align:right;transition:none}.ml-app .ml-influencers-list .progress.critical .progress-bar{background-color:#fe5050}.ml-app .ml-influencers-list .progress.critical .score-label{border-color:#fe5050}.ml-app .ml-influencers-list .progress.major .progress-bar{background-color:#fba740}.ml-app .ml-influencers-list .progress.major .score-label{border-color:#fba740}.ml-app .ml-influencers-list .progress.minor .progress-bar{background-color:#fdec25}.ml-app .ml-influencers-list .progress.minor .score-label{border-color:#fdec25}.ml-app .ml-influencers-list .progress.warning .progress-bar{background-color:#8bc8fb}.ml-app .ml-influencers-list .progress.warning .score-label{border-color:#8bc8fb}.ml-app .ml-influencers-list .score-label{display:inline;font-size:12px;line-height:14px;margin-left:4px;text-align:center;white-space:nowrap}.ml-app .ml-influencers-list .total-score-label{border:1px solid #d3dae6;border-radius:6px;color:#69707d;display:inline-block;font-size:11px;line-height:14px;margin-top:4px;padding:2px;text-align:center;vertical-align:top;width:32px}.ml-app .ml-influencers-list-tooltip{word-break:break-all}.ml-app .ml-items-grid-page-size-menu{width:140px}.ml-app .mlJobSelectorFlyoutBody>.euiFlyoutBody__overflow{padding-top:8px}.ml-app .mlJobSelector__ganttBar{background-color:#79adda;border-radius:2px;height:12px}.ml-app .mlJobSelector__ganttBarBackEdge{border-left:1px solid #d6d6d6;border-right:1px solid #d6d6d6;height:16px;margin-bottom:-14px;padding-top:8px}.ml-app .mlJobSelector__ganttBarDashed{border-top:1px dashed #d6d6d6;height:1px}.ml-app .mlJobSelector__ganttBarRunning{animation:progress-bar-stripes 2s linear infinite;background-image:linear-gradient(45deg,#ffffff26 25%,#0000 0,#0000 50%,#ffffff26 0,#ffffff26 75%,#0000 0,#0000);background-size:40px 40px}.ml-app .ml-loading-indicator{align-items:center;display:flex;flex-direction:column;font-size:17px;justify-content:center;text-align:center}.ml-app .ml-rule-editor-flyout{font-size:14px}.ml-app .ml-rule-editor-flyout .select-rule-action .rule-detector-description-list{padding-left:16px}.ml-app .ml-rule-editor-flyout .select-rule-action-panel{padding:8px 0}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title{flex-basis:15%;padding:0 16px}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description{flex-basis:85%}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(2),.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:first-child{border-bottom:1px solid #d3dae6;color:#1a1c21;font-weight:700;padding-bottom:12px}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(4),.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(3){padding-top:8px}.ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList.euiDescriptionList--column>*{margin-top:4px}.ml-app .ml-rule-editor-flyout .scope-enable-checkbox .euiCheckbox__input[disabled]~.euiCheckbox__label{color:inherit}.ml-app .ml-rule-editor-flyout .scope-field-checkbox{margin-right:2px}.ml-app .ml-rule-editor-flyout .scope-field-checkbox .euiCheckbox{margin-top:4px}.ml-app .ml-rule-editor-flyout .scope-field-button{border-bottom:none;pointer-events:none}.ml-app .ml-rule-editor-flyout .scope-edit-filter-link{font-size:12px;line-height:32px}.ml-app .ml-rule-editor-flyout .condition-edit-value-field{height:28px;margin:0 2px;width:170px}.ml-app .ml-rule-editor-flyout .condition-edit-value-field input{height:28px}.ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled{pointer-events:none}.ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__description,.ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__value{color:#d3dae6}.ml-app .ml-rule-editor-flyout .text-highlight{font-weight:700}.ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__title{flex-basis:15%}.ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__description{flex-basis:85%}.ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list>*{margin-top:4px}.ml-app .stat{margin-right:8px}.ml-app .mlStatsBar{background-color:#f5f7fa;height:42px;padding:14px}.ml-app .mlEmbeddedMapContent{display:flex;flex:1 1 100%;height:100%;min-height:0;width:100%;z-index:1}.ml-app .tab-datavisualizer_index_select,.ml-app .tab-explorer,.ml-app .tab-timeseriesexplorer{background-color:#fff}.ml-app .button-wrapper{display:inline}.ml-app .button-wrapper.disabled .kuiButton[disabled]{pointer-events:none}.ml-app .button-wrapper.disabled{cursor:not-allowed}.ml-app .clear,.ml-app .clearfix{clear:both}.ml-app .mlDisableAntiAliasing{-webkit-font-smoothing:none}.ml-app .mlDisableAntiAliasing * canvas{image-rendering:pixelated}',""]),e.exports=t},,,,function(e,t,a){e.exports=a(39)(2745)},function(e,t,a){ace.define("ace/mode/json_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],(function(e,t,a){"use strict";var i=e("../lib/oop"),n=e("./text_highlight_rules").TextHighlightRules,s=function(){this.$rules={start:[{token:"variable",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]\\s*(?=:)'},{token:"string",regex:'"',next:"string"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:"text",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"comment",regex:"\\/\\/.*$"},{token:"comment.start",regex:"\\/\\*",next:"comment"},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"}],string:[{token:"constant.language.escape",regex:/\\(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|["\\\/bfnrt])/},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],comment:[{token:"comment.end",regex:"\\*\\/",next:"start"},{defaultToken:"comment"}]}};i.inherits(s,n),t.JsonHighlightRules=s})),ace.define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"],(function(e,t,a){"use strict";var i=e("../range").Range,n=function(){};(function(){this.checkOutdent=function(e,t){return!!/^\s+$/.test(e)&&/^\s*\}/.test(t)},this.autoOutdent=function(e,t){var a=e.getLine(t).match(/^(\s*\})/);if(!a)return 0;var n=a[1].length,s=e.findMatchingBracket({row:t,column:n});if(!s||s.row==t)return 0;var o=this.$getIndent(e.getLine(s.row));e.replace(new i(t,0,t,n-1),o)},this.$getIndent=function(e){return e.match(/^\s*/)[0]}}).call(n.prototype),t.MatchingBraceOutdent=n})),ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"],(function(e,t,a){"use strict";var i=e("../../lib/oop"),n=e("../../range").Range,s=e("./fold_mode").FoldMode,o=t.FoldMode=function(e){e&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+e.end)))};i.inherits(o,s),function(){this.foldingStartMarker=/([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/,this.foldingStopMarker=/^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/,this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/,this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/,this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/,this._getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(e,t,a){var i=e.getLine(a);if(this.singleLineBlockCommentRe.test(i)&&!this.startRegionRe.test(i)&&!this.tripleStarBlockCommentRe.test(i))return"";var n=this._getFoldWidgetBase(e,t,a);return!n&&this.startRegionRe.test(i)?"start":n},this.getFoldWidgetRange=function(e,t,a,i){var n,s=e.getLine(a);if(this.startRegionRe.test(s))return this.getCommentRegionBlock(e,s,a);if(n=s.match(this.foldingStartMarker)){var o=n.index;if(n[1])return this.openingBracketBlock(e,n[1],a,o);var r=e.getCommentFoldRange(a,o+n[0].length,1);return r&&!r.isMultiLine()&&(i?r=this.getSectionRange(e,a):"all"!=t&&(r=null)),r}return"markbegin"!==t&&(n=s.match(this.foldingStopMarker))?(o=n.index+n[0].length,n[1]?this.closingBracketBlock(e,n[1],a,o):e.getCommentFoldRange(a,o,-1)):void 0},this.getSectionRange=function(e,t){for(var a=e.getLine(t),i=a.search(/\S/),s=t,o=a.length,r=t+=1,l=e.getLength();++t<l;){var c=(a=e.getLine(t)).search(/\S/);if(-1!==c){if(i>c)break;var d=this.getFoldWidgetRange(e,"all",t);if(d){if(d.start.row<=s)break;if(d.isMultiLine())t=d.end.row;else if(i==c)break}r=t}}return new n(s,o,r,e.getLine(r).length)},this.getCommentRegionBlock=function(e,t,a){for(var i=t.search(/\s*$/),s=e.getLength(),o=a,r=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/,l=1;++a<s;){t=e.getLine(a);var c=r.exec(t);if(c&&(c[1]?l--:l++,!l))break}if(a>o)return new n(o,i,a,t.length)}}.call(o.prototype)})),ace.define("ace/mode/json",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/json_highlight_rules","ace/mode/matching_brace_outdent","ace/mode/behaviour/cstyle","ace/mode/folding/cstyle","ace/worker/worker_client"],(function(e,t,i){"use strict";var n=e("../lib/oop"),s=e("./text").Mode,o=e("./json_highlight_rules").JsonHighlightRules,r=e("./matching_brace_outdent").MatchingBraceOutdent,l=e("./behaviour/cstyle").CstyleBehaviour,c=e("./folding/cstyle").FoldMode,d=e("../worker/worker_client").WorkerClient,u=function(){this.HighlightRules=o,this.$outdent=new r,this.$behaviour=new l,this.foldingRules=new c};n.inherits(u,s),function(){this.getNextLineIndent=function(e,t,a){var i=this.$getIndent(t);return"start"==e&&t.match(/^.*[\{\(\[]\s*$/)&&(i+=a),i},this.checkOutdent=function(e,t,a){return this.$outdent.checkOutdent(t,a)},this.autoOutdent=function(e,t,a){this.$outdent.autoOutdent(t,a)},this.createWorker=function(e){var t=new d(["ace"],a(380),"JsonWorker");return t.attachToDocument(e.getDocument()),t.on("annotate",(function(t){e.setAnnotations(t.data)})),t.on("terminate",(function(){e.clearAnnotations()})),t},this.$id="ace/mode/json"}.call(u.prototype),t.Mode=u}))},function(e,t){e.exports.id="ace/mode/json_worker",e.exports.src='"no use strict";!function(window){function resolveModuleId(id,paths){for(var testPath=id,tail="";testPath;){var alias=paths[testPath];if("string"==typeof alias)return alias+tail;if(alias)return alias.location.replace(/\\/*$/,"/")+(tail||alias.main||alias.name);if(alias===!1)return"";var i=testPath.lastIndexOf("/");if(-1===i)break;tail=testPath.substr(i)+tail,testPath=testPath.slice(0,i)}return id}if(!(void 0!==window.window&&window.document||window.acequire&&window.define)){window.console||(window.console=function(){var msgs=Array.prototype.slice.call(arguments,0);postMessage({type:"log",data:msgs})},window.console.error=window.console.warn=window.console.log=window.console.trace=window.console),window.window=window,window.ace=window,window.onerror=function(message,file,line,col,err){postMessage({type:"error",data:{message:message,data:err.data,file:file,line:line,col:col,stack:err.stack}})},window.normalizeModule=function(parentId,moduleName){if(-1!==moduleName.indexOf("!")){var chunks=moduleName.split("!");return window.normalizeModule(parentId,chunks[0])+"!"+window.normalizeModule(parentId,chunks[1])}if("."==moduleName.charAt(0)){var base=parentId.split("/").slice(0,-1).join("/");for(moduleName=(base?base+"/":"")+moduleName;-1!==moduleName.indexOf(".")&&previous!=moduleName;){var previous=moduleName;moduleName=moduleName.replace(/^\\.\\//,"").replace(/\\/\\.\\//,"/").replace(/[^\\/]+\\/\\.\\.\\//,"")}}return moduleName},window.acequire=function acequire(parentId,id){if(id||(id=parentId,parentId=null),!id.charAt)throw Error("worker.js acequire() accepts only (parentId, id) as arguments");id=window.normalizeModule(parentId,id);var module=window.acequire.modules[id];if(module)return module.initialized||(module.initialized=!0,module.exports=module.factory().exports),module.exports;if(!window.acequire.tlns)return console.log("unable to load "+id);var path=resolveModuleId(id,window.acequire.tlns);return".js"!=path.slice(-3)&&(path+=".js"),window.acequire.id=id,window.acequire.modules[id]={},importScripts(path),window.acequire(parentId,id)},window.acequire.modules={},window.acequire.tlns={},window.define=function(id,deps,factory){if(2==arguments.length?(factory=deps,"string"!=typeof id&&(deps=id,id=window.acequire.id)):1==arguments.length&&(factory=id,deps=[],id=window.acequire.id),"function"!=typeof factory)return window.acequire.modules[id]={exports:factory,initialized:!0},void 0;deps.length||(deps=["require","exports","module"]);var req=function(childId){return window.acequire(id,childId)};window.acequire.modules[id]={exports:{},factory:function(){var module=this,returnExports=factory.apply(this,deps.map(function(dep){switch(dep){case"require":return req;case"exports":return module.exports;case"module":return module;default:return req(dep)}}));return returnExports&&(module.exports=returnExports),module}}},window.define.amd={},acequire.tlns={},window.initBaseUrls=function(topLevelNamespaces){for(var i in topLevelNamespaces)acequire.tlns[i]=topLevelNamespaces[i]},window.initSender=function(){var EventEmitter=window.acequire("ace/lib/event_emitter").EventEmitter,oop=window.acequire("ace/lib/oop"),Sender=function(){};return function(){oop.implement(this,EventEmitter),this.callback=function(data,callbackId){postMessage({type:"call",id:callbackId,data:data})},this.emit=function(name,data){postMessage({type:"event",name:name,data:data})}}.call(Sender.prototype),new Sender};var main=window.main=null,sender=window.sender=null;window.onmessage=function(e){var msg=e.data;if(msg.event&&sender)sender._signal(msg.event,msg.data);else if(msg.command)if(main[msg.command])main[msg.command].apply(main,msg.args);else{if(!window[msg.command])throw Error("Unknown command:"+msg.command);window[msg.command].apply(window,msg.args)}else if(msg.init){window.initBaseUrls(msg.tlns),acequire("ace/lib/es5-shim"),sender=window.sender=window.initSender();var clazz=acequire(msg.module)[msg.classname];main=window.main=new clazz(sender)}}}}(this),ace.define("ace/lib/oop",["require","exports","module"],function(acequire,exports){"use strict";exports.inherits=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})},exports.mixin=function(obj,mixin){for(var key in mixin)obj[key]=mixin[key];return obj},exports.implement=function(proto,mixin){exports.mixin(proto,mixin)}}),ace.define("ace/range",["require","exports","module"],function(acequire,exports){"use strict";var comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column},Range=function(startRow,startColumn,endRow,endColumn){this.start={row:startRow,column:startColumn},this.end={row:endRow,column:endColumn}};(function(){this.isEqual=function(range){return this.start.row===range.start.row&&this.end.row===range.end.row&&this.start.column===range.start.column&&this.end.column===range.end.column},this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(row,column){return 0==this.compare(row,column)},this.compareRange=function(range){var cmp,end=range.end,start=range.start;return cmp=this.compare(end.row,end.column),1==cmp?(cmp=this.compare(start.row,start.column),1==cmp?2:0==cmp?1:0):-1==cmp?-2:(cmp=this.compare(start.row,start.column),-1==cmp?-1:1==cmp?42:0)},this.comparePoint=function(p){return this.compare(p.row,p.column)},this.containsRange=function(range){return 0==this.comparePoint(range.start)&&0==this.comparePoint(range.end)},this.intersects=function(range){var cmp=this.compareRange(range);return-1==cmp||0==cmp||1==cmp},this.isEnd=function(row,column){return this.end.row==row&&this.end.column==column},this.isStart=function(row,column){return this.start.row==row&&this.start.column==column},this.setStart=function(row,column){"object"==typeof row?(this.start.column=row.column,this.start.row=row.row):(this.start.row=row,this.start.column=column)},this.setEnd=function(row,column){"object"==typeof row?(this.end.column=row.column,this.end.row=row.row):(this.end.row=row,this.end.column=column)},this.inside=function(row,column){return 0==this.compare(row,column)?this.isEnd(row,column)||this.isStart(row,column)?!1:!0:!1},this.insideStart=function(row,column){return 0==this.compare(row,column)?this.isEnd(row,column)?!1:!0:!1},this.insideEnd=function(row,column){return 0==this.compare(row,column)?this.isStart(row,column)?!1:!0:!1},this.compare=function(row,column){return this.isMultiLine()||row!==this.start.row?this.start.row>row?-1:row>this.end.row?1:this.start.row===row?column>=this.start.column?0:-1:this.end.row===row?this.end.column>=column?0:1:0:this.start.column>column?-1:column>this.end.column?1:0},this.compareStart=function(row,column){return this.start.row==row&&this.start.column==column?-1:this.compare(row,column)},this.compareEnd=function(row,column){return this.end.row==row&&this.end.column==column?1:this.compare(row,column)},this.compareInside=function(row,column){return this.end.row==row&&this.end.column==column?1:this.start.row==row&&this.start.column==column?-1:this.compare(row,column)},this.clipRows=function(firstRow,lastRow){if(this.end.row>lastRow)var end={row:lastRow+1,column:0};else if(firstRow>this.end.row)var end={row:firstRow,column:0};if(this.start.row>lastRow)var start={row:lastRow+1,column:0};else if(firstRow>this.start.row)var start={row:firstRow,column:0};return Range.fromPoints(start||this.start,end||this.end)},this.extend=function(row,column){var cmp=this.compare(row,column);if(0==cmp)return this;if(-1==cmp)var start={row:row,column:column};else var end={row:row,column:column};return Range.fromPoints(start||this.start,end||this.end)},this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return Range.fromPoints(this.start,this.end)},this.collapseRows=function(){return 0==this.end.column?new Range(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new Range(this.start.row,0,this.end.row,0)},this.toScreenRange=function(session){var screenPosStart=session.documentToScreenPosition(this.start),screenPosEnd=session.documentToScreenPosition(this.end);return new Range(screenPosStart.row,screenPosStart.column,screenPosEnd.row,screenPosEnd.column)},this.moveBy=function(row,column){this.start.row+=row,this.start.column+=column,this.end.row+=row,this.end.column+=column}}).call(Range.prototype),Range.fromPoints=function(start,end){return new Range(start.row,start.column,end.row,end.column)},Range.comparePoints=comparePoints,Range.comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column},exports.Range=Range}),ace.define("ace/apply_delta",["require","exports","module"],function(acequire,exports){"use strict";exports.applyDelta=function(docLines,delta){var row=delta.start.row,startColumn=delta.start.column,line=docLines[row]||"";switch(delta.action){case"insert":var lines=delta.lines;if(1===lines.length)docLines[row]=line.substring(0,startColumn)+delta.lines[0]+line.substring(startColumn);else{var args=[row,1].concat(delta.lines);docLines.splice.apply(docLines,args),docLines[row]=line.substring(0,startColumn)+docLines[row],docLines[row+delta.lines.length-1]+=line.substring(startColumn)}break;case"remove":var endColumn=delta.end.column,endRow=delta.end.row;row===endRow?docLines[row]=line.substring(0,startColumn)+line.substring(endColumn):docLines.splice(row,endRow-row+1,line.substring(0,startColumn)+docLines[endRow].substring(endColumn))}}}),ace.define("ace/lib/event_emitter",["require","exports","module"],function(acequire,exports){"use strict";var EventEmitter={},stopPropagation=function(){this.propagationStopped=!0},preventDefault=function(){this.defaultPrevented=!0};EventEmitter._emit=EventEmitter._dispatchEvent=function(eventName,e){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var listeners=this._eventRegistry[eventName]||[],defaultHandler=this._defaultHandlers[eventName];if(listeners.length||defaultHandler){"object"==typeof e&&e||(e={}),e.type||(e.type=eventName),e.stopPropagation||(e.stopPropagation=stopPropagation),e.preventDefault||(e.preventDefault=preventDefault),listeners=listeners.slice();for(var i=0;listeners.length>i&&(listeners[i](e,this),!e.propagationStopped);i++);return defaultHandler&&!e.defaultPrevented?defaultHandler(e,this):void 0}},EventEmitter._signal=function(eventName,e){var listeners=(this._eventRegistry||{})[eventName];if(listeners){listeners=listeners.slice();for(var i=0;listeners.length>i;i++)listeners[i](e,this)}},EventEmitter.once=function(eventName,callback){var _self=this;callback&&this.addEventListener(eventName,function newCallback(){_self.removeEventListener(eventName,newCallback),callback.apply(null,arguments)})},EventEmitter.setDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(handlers||(handlers=this._defaultHandlers={_disabled_:{}}),handlers[eventName]){var old=handlers[eventName],disabled=handlers._disabled_[eventName];disabled||(handlers._disabled_[eventName]=disabled=[]),disabled.push(old);var i=disabled.indexOf(callback);-1!=i&&disabled.splice(i,1)}handlers[eventName]=callback},EventEmitter.removeDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(handlers){var disabled=handlers._disabled_[eventName];if(handlers[eventName]==callback)handlers[eventName],disabled&&this.setDefaultHandler(eventName,disabled.pop());else if(disabled){var i=disabled.indexOf(callback);-1!=i&&disabled.splice(i,1)}}},EventEmitter.on=EventEmitter.addEventListener=function(eventName,callback,capturing){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];return listeners||(listeners=this._eventRegistry[eventName]=[]),-1==listeners.indexOf(callback)&&listeners[capturing?"unshift":"push"](callback),callback},EventEmitter.off=EventEmitter.removeListener=EventEmitter.removeEventListener=function(eventName,callback){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];if(listeners){var index=listeners.indexOf(callback);-1!==index&&listeners.splice(index,1)}},EventEmitter.removeAllListeners=function(eventName){this._eventRegistry&&(this._eventRegistry[eventName]=[])},exports.EventEmitter=EventEmitter}),ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(acequire,exports){"use strict";var oop=acequire("./lib/oop"),EventEmitter=acequire("./lib/event_emitter").EventEmitter,Anchor=exports.Anchor=function(doc,row,column){this.$onChange=this.onChange.bind(this),this.attach(doc),column===void 0?this.setPosition(row.row,row.column):this.setPosition(row,column)};(function(){function $pointsInOrder(point1,point2,equalPointsInOrder){var bColIsAfter=equalPointsInOrder?point1.column<=point2.column:point1.column<point2.column;return point1.row<point2.row||point1.row==point2.row&&bColIsAfter}function $getTransformedPoint(delta,point,moveIfEqual){var deltaIsInsert="insert"==delta.action,deltaRowShift=(deltaIsInsert?1:-1)*(delta.end.row-delta.start.row),deltaColShift=(deltaIsInsert?1:-1)*(delta.end.column-delta.start.column),deltaStart=delta.start,deltaEnd=deltaIsInsert?deltaStart:delta.end;return $pointsInOrder(point,deltaStart,moveIfEqual)?{row:point.row,column:point.column}:$pointsInOrder(deltaEnd,point,!moveIfEqual)?{row:point.row+deltaRowShift,column:point.column+(point.row==deltaEnd.row?deltaColShift:0)}:{row:deltaStart.row,column:deltaStart.column}}oop.implement(this,EventEmitter),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(delta){if(!(delta.start.row==delta.end.row&&delta.start.row!=this.row||delta.start.row>this.row)){var point=$getTransformedPoint(delta,{row:this.row,column:this.column},this.$insertRight);this.setPosition(point.row,point.column,!0)}},this.setPosition=function(row,column,noClip){var pos;if(pos=noClip?{row:row,column:column}:this.$clipPositionToDocument(row,column),this.row!=pos.row||this.column!=pos.column){var old={row:this.row,column:this.column};this.row=pos.row,this.column=pos.column,this._signal("change",{old:old,value:pos})}},this.detach=function(){this.document.removeEventListener("change",this.$onChange)},this.attach=function(doc){this.document=doc||this.document,this.document.on("change",this.$onChange)},this.$clipPositionToDocument=function(row,column){var pos={};return row>=this.document.getLength()?(pos.row=Math.max(0,this.document.getLength()-1),pos.column=this.document.getLine(pos.row).length):0>row?(pos.row=0,pos.column=0):(pos.row=row,pos.column=Math.min(this.document.getLine(pos.row).length,Math.max(0,column))),0>column&&(pos.column=0),pos}}).call(Anchor.prototype)}),ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],function(acequire,exports){"use strict";var oop=acequire("./lib/oop"),applyDelta=acequire("./apply_delta").applyDelta,EventEmitter=acequire("./lib/event_emitter").EventEmitter,Range=acequire("./range").Range,Anchor=acequire("./anchor").Anchor,Document=function(textOrLines){this.$lines=[""],0===textOrLines.length?this.$lines=[""]:Array.isArray(textOrLines)?this.insertMergedLines({row:0,column:0},textOrLines):this.insert({row:0,column:0},textOrLines)};(function(){oop.implement(this,EventEmitter),this.setValue=function(text){var len=this.getLength()-1;this.remove(new Range(0,0,len,this.getLine(len).length)),this.insert({row:0,column:0},text)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(row,column){return new Anchor(this,row,column)},this.$split=0==="aaa".split(/a/).length?function(text){return text.replace(/\\r\\n|\\r/g,"\\n").split("\\n")}:function(text){return text.split(/\\r\\n|\\r|\\n/)},this.$detectNewLine=function(text){var match=text.match(/^.*?(\\r\\n|\\r|\\n)/m);this.$autoNewLine=match?match[1]:"\\n",this._signal("changeNewLineMode")},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\\r\\n";case"unix":return"\\n";default:return this.$autoNewLine||"\\n"}},this.$autoNewLine="",this.$newLineMode="auto",this.setNewLineMode=function(newLineMode){this.$newLineMode!==newLineMode&&(this.$newLineMode=newLineMode,this._signal("changeNewLineMode"))},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(text){return"\\r\\n"==text||"\\r"==text||"\\n"==text},this.getLine=function(row){return this.$lines[row]||""},this.getLines=function(firstRow,lastRow){return this.$lines.slice(firstRow,lastRow+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(range){return this.getLinesForRange(range).join(this.getNewLineCharacter())},this.getLinesForRange=function(range){var lines;if(range.start.row===range.end.row)lines=[this.getLine(range.start.row).substring(range.start.column,range.end.column)];else{lines=this.getLines(range.start.row,range.end.row),lines[0]=(lines[0]||"").substring(range.start.column);var l=lines.length-1;range.end.row-range.start.row==l&&(lines[l]=lines[l].substring(0,range.end.column))}return lines},this.insertLines=function(row,lines){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(row,lines)},this.removeLines=function(firstRow,lastRow){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(firstRow,lastRow)},this.insertNewLine=function(position){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, [\'\', \'\']) instead."),this.insertMergedLines(position,["",""])},this.insert=function(position,text){return 1>=this.getLength()&&this.$detectNewLine(text),this.insertMergedLines(position,this.$split(text))},this.insertInLine=function(position,text){var start=this.clippedPos(position.row,position.column),end=this.pos(position.row,position.column+text.length);return this.applyDelta({start:start,end:end,action:"insert",lines:[text]},!0),this.clonePos(end)},this.clippedPos=function(row,column){var length=this.getLength();void 0===row?row=length:0>row?row=0:row>=length&&(row=length-1,column=void 0);var line=this.getLine(row);return void 0==column&&(column=line.length),column=Math.min(Math.max(column,0),line.length),{row:row,column:column}},this.clonePos=function(pos){return{row:pos.row,column:pos.column}},this.pos=function(row,column){return{row:row,column:column}},this.$clipPosition=function(position){var length=this.getLength();return position.row>=length?(position.row=Math.max(0,length-1),position.column=this.getLine(length-1).length):(position.row=Math.max(0,position.row),position.column=Math.min(Math.max(position.column,0),this.getLine(position.row).length)),position},this.insertFullLines=function(row,lines){row=Math.min(Math.max(row,0),this.getLength());var column=0;this.getLength()>row?(lines=lines.concat([""]),column=0):(lines=[""].concat(lines),row--,column=this.$lines[row].length),this.insertMergedLines({row:row,column:column},lines)},this.insertMergedLines=function(position,lines){var start=this.clippedPos(position.row,position.column),end={row:start.row+lines.length-1,column:(1==lines.length?start.column:0)+lines[lines.length-1].length};return this.applyDelta({start:start,end:end,action:"insert",lines:lines}),this.clonePos(end)},this.remove=function(range){var start=this.clippedPos(range.start.row,range.start.column),end=this.clippedPos(range.end.row,range.end.column);return this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})}),this.clonePos(start)},this.removeInLine=function(row,startColumn,endColumn){var start=this.clippedPos(row,startColumn),end=this.clippedPos(row,endColumn);return this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})},!0),this.clonePos(start)},this.removeFullLines=function(firstRow,lastRow){firstRow=Math.min(Math.max(0,firstRow),this.getLength()-1),lastRow=Math.min(Math.max(0,lastRow),this.getLength()-1);var deleteFirstNewLine=lastRow==this.getLength()-1&&firstRow>0,deleteLastNewLine=this.getLength()-1>lastRow,startRow=deleteFirstNewLine?firstRow-1:firstRow,startCol=deleteFirstNewLine?this.getLine(startRow).length:0,endRow=deleteLastNewLine?lastRow+1:lastRow,endCol=deleteLastNewLine?0:this.getLine(endRow).length,range=new Range(startRow,startCol,endRow,endCol),deletedLines=this.$lines.slice(firstRow,lastRow+1);return this.applyDelta({start:range.start,end:range.end,action:"remove",lines:this.getLinesForRange(range)}),deletedLines},this.removeNewLine=function(row){this.getLength()-1>row&&row>=0&&this.applyDelta({start:this.pos(row,this.getLine(row).length),end:this.pos(row+1,0),action:"remove",lines:["",""]})},this.replace=function(range,text){if(range instanceof Range||(range=Range.fromPoints(range.start,range.end)),0===text.length&&range.isEmpty())return range.start;if(text==this.getTextRange(range))return range.end;this.remove(range);var end;return end=text?this.insert(range.start,text):range.start},this.applyDeltas=function(deltas){for(var i=0;deltas.length>i;i++)this.applyDelta(deltas[i])},this.revertDeltas=function(deltas){for(var i=deltas.length-1;i>=0;i--)this.revertDelta(deltas[i])},this.applyDelta=function(delta,doNotValidate){var isInsert="insert"==delta.action;(isInsert?1>=delta.lines.length&&!delta.lines[0]:!Range.comparePoints(delta.start,delta.end))||(isInsert&&delta.lines.length>2e4&&this.$splitAndapplyLargeDelta(delta,2e4),applyDelta(this.$lines,delta,doNotValidate),this._signal("change",delta))},this.$splitAndapplyLargeDelta=function(delta,MAX){for(var lines=delta.lines,l=lines.length,row=delta.start.row,column=delta.start.column,from=0,to=0;;){from=to,to+=MAX-1;var chunk=lines.slice(from,to);if(to>l){delta.lines=chunk,delta.start.row=row+from,delta.start.column=column;break}chunk.push(""),this.applyDelta({start:this.pos(row+from,column),end:this.pos(row+to,column=0),action:delta.action,lines:chunk},!0)}},this.revertDelta=function(delta){this.applyDelta({start:this.clonePos(delta.start),end:this.clonePos(delta.end),action:"insert"==delta.action?"remove":"insert",lines:delta.lines.slice()})},this.indexToPosition=function(index,startRow){for(var lines=this.$lines||this.getAllLines(),newlineLength=this.getNewLineCharacter().length,i=startRow||0,l=lines.length;l>i;i++)if(index-=lines[i].length+newlineLength,0>index)return{row:i,column:index+lines[i].length+newlineLength};return{row:l-1,column:lines[l-1].length}},this.positionToIndex=function(pos,startRow){for(var lines=this.$lines||this.getAllLines(),newlineLength=this.getNewLineCharacter().length,index=0,row=Math.min(pos.row,lines.length),i=startRow||0;row>i;++i)index+=lines[i].length+newlineLength;return index+pos.column}}).call(Document.prototype),exports.Document=Document}),ace.define("ace/lib/lang",["require","exports","module"],function(acequire,exports){"use strict";exports.last=function(a){return a[a.length-1]},exports.stringReverse=function(string){return string.split("").reverse().join("")},exports.stringRepeat=function(string,count){for(var result="";count>0;)1&count&&(result+=string),(count>>=1)&&(string+=string);return result};var trimBeginRegexp=/^\\s\\s*/,trimEndRegexp=/\\s\\s*$/;exports.stringTrimLeft=function(string){return string.replace(trimBeginRegexp,"")},exports.stringTrimRight=function(string){return string.replace(trimEndRegexp,"")},exports.copyObject=function(obj){var copy={};for(var key in obj)copy[key]=obj[key];return copy},exports.copyArray=function(array){for(var copy=[],i=0,l=array.length;l>i;i++)copy[i]=array[i]&&"object"==typeof array[i]?this.copyObject(array[i]):array[i];return copy},exports.deepCopy=function deepCopy(obj){if("object"!=typeof obj||!obj)return obj;var copy;if(Array.isArray(obj)){copy=[];for(var key=0;obj.length>key;key++)copy[key]=deepCopy(obj[key]);return copy}if("[object Object]"!==Object.prototype.toString.call(obj))return obj;copy={};for(var key in obj)copy[key]=deepCopy(obj[key]);return copy},exports.arrayToMap=function(arr){for(var map={},i=0;arr.length>i;i++)map[arr[i]]=1;return map},exports.createMap=function(props){var map=Object.create(null);for(var i in props)map[i]=props[i];return map},exports.arrayRemove=function(array,value){for(var i=0;array.length>=i;i++)value===array[i]&&array.splice(i,1)},exports.escapeRegExp=function(str){return str.replace(/([.*+?^${}()|[\\]\\/\\\\])/g,"\\\\$1")},exports.escapeHTML=function(str){return str.replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/\'/g,"&#39;").replace(/</g,"&#60;")},exports.getMatchOffsets=function(string,regExp){var matches=[];return string.replace(regExp,function(str){matches.push({offset:arguments[arguments.length-2],length:str.length})}),matches},exports.deferredCall=function(fcn){var timer=null,callback=function(){timer=null,fcn()},deferred=function(timeout){return deferred.cancel(),timer=setTimeout(callback,timeout||0),deferred};return deferred.schedule=deferred,deferred.call=function(){return this.cancel(),fcn(),deferred},deferred.cancel=function(){return clearTimeout(timer),timer=null,deferred},deferred.isPending=function(){return timer},deferred},exports.delayedCall=function(fcn,defaultTimeout){var timer=null,callback=function(){timer=null,fcn()},_self=function(timeout){null==timer&&(timer=setTimeout(callback,timeout||defaultTimeout))};return _self.delay=function(timeout){timer&&clearTimeout(timer),timer=setTimeout(callback,timeout||defaultTimeout)},_self.schedule=_self,_self.call=function(){this.cancel(),fcn()},_self.cancel=function(){timer&&clearTimeout(timer),timer=null},_self.isPending=function(){return timer},_self}}),ace.define("ace/worker/mirror",["require","exports","module","ace/range","ace/document","ace/lib/lang"],function(acequire,exports){"use strict";acequire("../range").Range;var Document=acequire("../document").Document,lang=acequire("../lib/lang"),Mirror=exports.Mirror=function(sender){this.sender=sender;var doc=this.doc=new Document(""),deferredUpdate=this.deferredUpdate=lang.delayedCall(this.onUpdate.bind(this)),_self=this;sender.on("change",function(e){var data=e.data;if(data[0].start)doc.applyDeltas(data);else for(var i=0;data.length>i;i+=2){if(Array.isArray(data[i+1]))var d={action:"insert",start:data[i],lines:data[i+1]};else var d={action:"remove",start:data[i],end:data[i+1]};doc.applyDelta(d,!0)}return _self.$timeout?deferredUpdate.schedule(_self.$timeout):(_self.onUpdate(),void 0)})};(function(){this.$timeout=500,this.setTimeout=function(timeout){this.$timeout=timeout},this.setValue=function(value){this.doc.setValue(value),this.deferredUpdate.schedule(this.$timeout)},this.getValue=function(callbackId){this.sender.callback(this.doc.getValue(),callbackId)},this.onUpdate=function(){},this.isPending=function(){return this.deferredUpdate.isPending()}}).call(Mirror.prototype)}),ace.define("ace/mode/json/json_parse",["require","exports","module"],function(){"use strict";var at,ch,text,value,escapee={\'"\':\'"\',"\\\\":"\\\\","/":"/",b:"\\b",f:"\\f",n:"\\n",r:"\\r",t:"\t"},error=function(m){throw{name:"SyntaxError",message:m,at:at,text:text}},next=function(c){return c&&c!==ch&&error("Expected \'"+c+"\' instead of \'"+ch+"\'"),ch=text.charAt(at),at+=1,ch},number=function(){var number,string="";for("-"===ch&&(string="-",next("-"));ch>="0"&&"9">=ch;)string+=ch,next();if("."===ch)for(string+=".";next()&&ch>="0"&&"9">=ch;)string+=ch;if("e"===ch||"E"===ch)for(string+=ch,next(),("-"===ch||"+"===ch)&&(string+=ch,next());ch>="0"&&"9">=ch;)string+=ch,next();return number=+string,isNaN(number)?(error("Bad number"),void 0):number},string=function(){var hex,i,uffff,string="";if(\'"\'===ch)for(;next();){if(\'"\'===ch)return next(),string;if("\\\\"===ch)if(next(),"u"===ch){for(uffff=0,i=0;4>i&&(hex=parseInt(next(),16),isFinite(hex));i+=1)uffff=16*uffff+hex;string+=String.fromCharCode(uffff)}else{if("string"!=typeof escapee[ch])break;string+=escapee[ch]}else string+=ch}error("Bad string")},white=function(){for(;ch&&" ">=ch;)next()},word=function(){switch(ch){case"t":return next("t"),next("r"),next("u"),next("e"),!0;case"f":return next("f"),next("a"),next("l"),next("s"),next("e"),!1;case"n":return next("n"),next("u"),next("l"),next("l"),null}error("Unexpected \'"+ch+"\'")},array=function(){var array=[];if("["===ch){if(next("["),white(),"]"===ch)return next("]"),array;for(;ch;){if(array.push(value()),white(),"]"===ch)return next("]"),array;next(","),white()}}error("Bad array")},object=function(){var key,object={};if("{"===ch){if(next("{"),white(),"}"===ch)return next("}"),object;for(;ch;){if(key=string(),white(),next(":"),Object.hasOwnProperty.call(object,key)&&error(\'Duplicate key "\'+key+\'"\'),object[key]=value(),white(),"}"===ch)return next("}"),object;next(","),white()}}error("Bad object")};return value=function(){switch(white(),ch){case"{":return object();case"[":return array();case\'"\':return string();case"-":return number();default:return ch>="0"&&"9">=ch?number():word()}},function(source,reviver){var result;return text=source,at=0,ch=" ",result=value(),white(),ch&&error("Syntax error"),"function"==typeof reviver?function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}({"":result},""):result}}),ace.define("ace/mode/json_worker",["require","exports","module","ace/lib/oop","ace/worker/mirror","ace/mode/json/json_parse"],function(acequire,exports){"use strict";var oop=acequire("../lib/oop"),Mirror=acequire("../worker/mirror").Mirror,parse=acequire("./json/json_parse"),JsonWorker=exports.JsonWorker=function(sender){Mirror.call(this,sender),this.setTimeout(200)};oop.inherits(JsonWorker,Mirror),function(){this.onUpdate=function(){var value=this.doc.getValue(),errors=[];try{value&&parse(value)}catch(e){var pos=this.doc.indexToPosition(e.at-1);errors.push({row:pos.row,column:pos.column,text:e.message,type:"error"})}this.sender.emit("annotate",errors)}}.call(JsonWorker.prototype)}),ace.define("ace/lib/es5-shim",["require","exports","module"],function(){function Empty(){}function doesDefinePropertyWork(object){try{return Object.defineProperty(object,"sentinel",{}),"sentinel"in object}catch(exception){}}function toInteger(n){return n=+n,n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n))),n}Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw new TypeError("Function.prototype.bind called on incompatible "+target);var args=slice.call(arguments,1),bound=function(){if(this instanceof bound){var result=target.apply(this,args.concat(slice.call(arguments)));return Object(result)===result?result:this}return target.apply(that,args.concat(slice.call(arguments)))};return target.prototype&&(Empty.prototype=target.prototype,bound.prototype=new Empty,Empty.prototype=null),bound});var defineGetter,defineSetter,lookupGetter,lookupSetter,supportsAccessors,call=Function.prototype.call,prototypeOfArray=Array.prototype,prototypeOfObject=Object.prototype,slice=prototypeOfArray.slice,_toString=call.bind(prototypeOfObject.toString),owns=call.bind(prototypeOfObject.hasOwnProperty);if((supportsAccessors=owns(prototypeOfObject,"__defineGetter__"))&&(defineGetter=call.bind(prototypeOfObject.__defineGetter__),defineSetter=call.bind(prototypeOfObject.__defineSetter__),lookupGetter=call.bind(prototypeOfObject.__lookupGetter__),lookupSetter=call.bind(prototypeOfObject.__lookupSetter__)),2!=[1,2].splice(0).length)if(function(){function makeArray(l){var a=Array(l+2);return a[0]=a[1]=0,a}var lengthBefore,array=[];return array.splice.apply(array,makeArray(20)),array.splice.apply(array,makeArray(26)),lengthBefore=array.length,array.splice(5,0,"XXX"),lengthBefore+1==array.length,lengthBefore+1==array.length?!0:void 0\n}()){var array_splice=Array.prototype.splice;Array.prototype.splice=function(start,deleteCount){return arguments.length?array_splice.apply(this,[void 0===start?0:start,void 0===deleteCount?this.length-start:deleteCount].concat(slice.call(arguments,2))):[]}}else Array.prototype.splice=function(pos,removeCount){var length=this.length;pos>0?pos>length&&(pos=length):void 0==pos?pos=0:0>pos&&(pos=Math.max(length+pos,0)),length>pos+removeCount||(removeCount=length-pos);var removed=this.slice(pos,pos+removeCount),insert=slice.call(arguments,2),add=insert.length;if(pos===length)add&&this.push.apply(this,insert);else{var remove=Math.min(removeCount,length-pos),tailOldPos=pos+remove,tailNewPos=tailOldPos+add-remove,tailCount=length-tailOldPos,lengthAfterRemove=length-remove;if(tailOldPos>tailNewPos)for(var i=0;tailCount>i;++i)this[tailNewPos+i]=this[tailOldPos+i];else if(tailNewPos>tailOldPos)for(i=tailCount;i--;)this[tailNewPos+i]=this[tailOldPos+i];if(add&&pos===lengthAfterRemove)this.length=lengthAfterRemove,this.push.apply(this,insert);else for(this.length=lengthAfterRemove+add,i=0;add>i;++i)this[pos+i]=insert[i]}return removed};Array.isArray||(Array.isArray=function(obj){return"[object Array]"==_toString(obj)});var boxedString=Object("a"),splitString="a"!=boxedString[0]||!(0 in boxedString);if(Array.prototype.forEach||(Array.prototype.forEach=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,thisp=arguments[1],i=-1,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError;for(;length>++i;)i in self&&fun.call(thisp,self[i],i,object)}),Array.prototype.map||(Array.prototype.map=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,result=Array(length),thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)i in self&&(result[i]=fun.call(thisp,self[i],i,object));return result}),Array.prototype.filter||(Array.prototype.filter=function(fun){var value,object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,result=[],thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)i in self&&(value=self[i],fun.call(thisp,value,i,object)&&result.push(value));return result}),Array.prototype.every||(Array.prototype.every=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)if(i in self&&!fun.call(thisp,self[i],i,object))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)if(i in self&&fun.call(thisp,self[i],i,object))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");if(!length&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var result,i=0;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i++];break}if(++i>=length)throw new TypeError("reduce of empty array with no initial value")}for(;length>i;i++)i in self&&(result=fun.call(void 0,result,self[i],i,object));return result}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");if(!length&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var result,i=length-1;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i--];break}if(0>--i)throw new TypeError("reduceRight of empty array with no initial value")}do i in this&&(result=fun.call(void 0,result,self[i],i,object));while(i--);return result}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(sought){var self=splitString&&"[object String]"==_toString(this)?this.split(""):toObject(this),length=self.length>>>0;if(!length)return-1;var i=0;for(arguments.length>1&&(i=toInteger(arguments[1])),i=i>=0?i:Math.max(0,length+i);length>i;i++)if(i in self&&self[i]===sought)return i;return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(sought){var self=splitString&&"[object String]"==_toString(this)?this.split(""):toObject(this),length=self.length>>>0;if(!length)return-1;var i=length-1;for(arguments.length>1&&(i=Math.min(i,toInteger(arguments[1]))),i=i>=0?i:length-Math.abs(i);i>=0;i--)if(i in self&&sought===self[i])return i;return-1}),Object.getPrototypeOf||(Object.getPrototypeOf=function(object){return object.__proto__||(object.constructor?object.constructor.prototype:prototypeOfObject)}),!Object.getOwnPropertyDescriptor){var ERR_NON_OBJECT="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(object,property){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT+object);if(owns(object,property)){var descriptor,getter,setter;if(descriptor={enumerable:!0,configurable:!0},supportsAccessors){var prototype=object.__proto__;object.__proto__=prototypeOfObject;var getter=lookupGetter(object,property),setter=lookupSetter(object,property);if(object.__proto__=prototype,getter||setter)return getter&&(descriptor.get=getter),setter&&(descriptor.set=setter),descriptor}return descriptor.value=object[property],descriptor}}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(object){return Object.keys(object)}),!Object.create){var createEmpty;createEmpty=null===Object.prototype.__proto__?function(){return{__proto__:null}}:function(){var empty={};for(var i in empty)empty[i]=null;return empty.constructor=empty.hasOwnProperty=empty.propertyIsEnumerable=empty.isPrototypeOf=empty.toLocaleString=empty.toString=empty.valueOf=empty.__proto__=null,empty},Object.create=function(prototype,properties){var object;if(null===prototype)object=createEmpty();else{if("object"!=typeof prototype)throw new TypeError("typeof prototype["+typeof prototype+"] != \'object\'");var Type=function(){};Type.prototype=prototype,object=new Type,object.__proto__=prototype}return void 0!==properties&&Object.defineProperties(object,properties),object}}if(Object.defineProperty){var definePropertyWorksOnObject=doesDefinePropertyWork({}),definePropertyWorksOnDom="undefined"==typeof document||doesDefinePropertyWork(document.createElement("div"));if(!definePropertyWorksOnObject||!definePropertyWorksOnDom)var definePropertyFallback=Object.defineProperty}if(!Object.defineProperty||definePropertyFallback){var ERR_NON_OBJECT_DESCRIPTOR="Property description must be an object: ",ERR_NON_OBJECT_TARGET="Object.defineProperty called on non-object: ",ERR_ACCESSORS_NOT_SUPPORTED="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(object,property,descriptor){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT_TARGET+object);if("object"!=typeof descriptor&&"function"!=typeof descriptor||null===descriptor)throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR+descriptor);if(definePropertyFallback)try{return definePropertyFallback.call(Object,object,property,descriptor)}catch(exception){}if(owns(descriptor,"value"))if(supportsAccessors&&(lookupGetter(object,property)||lookupSetter(object,property))){var prototype=object.__proto__;object.__proto__=prototypeOfObject,delete object[property],object[property]=descriptor.value,object.__proto__=prototype}else object[property]=descriptor.value;else{if(!supportsAccessors)throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);owns(descriptor,"get")&&defineGetter(object,property,descriptor.get),owns(descriptor,"set")&&defineSetter(object,property,descriptor.set)}return object}}Object.defineProperties||(Object.defineProperties=function(object,properties){for(var property in properties)owns(properties,property)&&Object.defineProperty(object,property,properties[property]);return object}),Object.seal||(Object.seal=function(object){return object}),Object.freeze||(Object.freeze=function(object){return object});try{Object.freeze(function(){})}catch(exception){Object.freeze=function(freezeObject){return function(object){return"function"==typeof object?object:freezeObject(object)}}(Object.freeze)}if(Object.preventExtensions||(Object.preventExtensions=function(object){return object}),Object.isSealed||(Object.isSealed=function(){return!1}),Object.isFrozen||(Object.isFrozen=function(){return!1}),Object.isExtensible||(Object.isExtensible=function(object){if(Object(object)===object)throw new TypeError;for(var name="";owns(object,name);)name+="?";object[name]=!0;var returnValue=owns(object,name);return delete object[name],returnValue}),!Object.keys){var hasDontEnumBug=!0,dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;for(var key in{toString:null})hasDontEnumBug=!1;Object.keys=function(object){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError("Object.keys called on a non-object");var keys=[];for(var name in object)owns(object,name)&&keys.push(name);if(hasDontEnumBug)for(var i=0,ii=dontEnumsLength;ii>i;i++){var dontEnum=dontEnums[i];owns(object,dontEnum)&&keys.push(dontEnum)}return keys}}Date.now||(Date.now=function(){return(new Date).getTime()});var ws="\t\\n\v\\f\\r   ᠎             　\\u2028\\u2029\ufeff";if(!String.prototype.trim||ws.trim()){ws="["+ws+"]";var trimBeginRegexp=RegExp("^"+ws+ws+"*"),trimEndRegexp=RegExp(ws+ws+"*$");String.prototype.trim=function(){return(this+"").replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}}var toObject=function(o){if(null==o)throw new TypeError("can\'t convert "+o+" to object");return Object(o)}});'},function(e,t,a){"use strict";var i=a(382),n=a(383);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=x,t.resolve=function(e,t){return x(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?x(e,!1,!0).resolveObject(t):t},t.format=function(e){return n.isString(e)&&(e=x(e)),e instanceof s?e.format():s.prototype.format.call(e)},t.Url=s;var o=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),d=["'"].concat(c),u=["%","/","?",";","#"].concat(d),p=["/","?","#"],m=/^[+a-z0-9A-Z_-]{0,63}$/,b=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},h={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},j=a(384);function x(e,t,a){if(e&&n.isObject(e)&&e instanceof s)return e;var i=new s;return i.parse(e,t,a),i}s.prototype.parse=function(e,t,a){if(!n.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),r=-1!==s&&s<e.indexOf("#")?"?":"#",c=e.split(r);c[0]=c[0].replace(/\\/g,"/");var x=e=c.join(r);if(x=x.trim(),!a&&1===e.split("#").length){var v=l.exec(x);if(v)return this.path=x,this.href=x,this.pathname=v[1],v[2]?(this.search=v[2],this.query=t?j.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var y=o.exec(x);if(y){var O=(y=y[0]).toLowerCase();this.protocol=O,x=x.substr(y.length)}if(a||y||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===x.substr(0,2);!E||y&&h[y]||(x=x.substr(2),this.slashes=!0)}if(!h[y]&&(E||y&&!g[y])){for(var w,M,S=-1,_=0;_<p.length;_++)-1!==(T=x.indexOf(p[_]))&&(-1===S||T<S)&&(S=T);for(-1!==(M=-1===S?x.lastIndexOf("@"):x.lastIndexOf("@",S))&&(w=x.slice(0,M),x=x.slice(M+1),this.auth=decodeURIComponent(w)),S=-1,_=0;_<u.length;_++){var T;-1!==(T=x.indexOf(u[_]))&&(-1===S||T<S)&&(S=T)}-1===S&&(S=x.length),this.host=x.slice(0,S),x=x.slice(S),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var k=this.hostname.split(/\./),F=(_=0,k.length);_<F;_++){var I=k[_];if(I&&!I.match(m)){for(var D="",A=0,L=I.length;A<L;A++)I.charCodeAt(A)>127?D+="x":D+=I[A];if(!D.match(m)){var R=k.slice(0,_),N=k.slice(_+1),P=I.match(b);P&&(R.push(P[1]),N.unshift(P[2])),N.length&&(x="/"+N.join(".")+x),this.hostname=R.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=i.toASCII(this.hostname));var z=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+z,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==x[0]&&(x="/"+x))}if(!f[O])for(_=0,F=d.length;_<F;_++){var V=d[_];if(-1!==x.indexOf(V)){var J=encodeURIComponent(V);J===V&&(J=escape(V)),x=x.split(V).join(J)}}var U=x.indexOf("#");-1!==U&&(this.hash=x.substr(U),x=x.slice(0,U));var G=x.indexOf("?");if(-1!==G?(this.search=x.substr(G),this.query=x.substr(G+1),t&&(this.query=j.parse(this.query)),x=x.slice(0,G)):t&&(this.search="",this.query={}),x&&(this.pathname=x),g[O]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){z=this.pathname||"";var q=this.search||"";this.path=z+q}return this.href=this.format(),this},s.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",a=this.pathname||"",i=this.hash||"",s=!1,o="";this.host?s=e+this.host:this.hostname&&(s=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&n.isObject(this.query)&&Object.keys(this.query).length&&(o=j.stringify(this.query));var r=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||g[t])&&!1!==s?(s="//"+(s||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):s||(s=""),i&&"#"!==i.charAt(0)&&(i="#"+i),r&&"?"!==r.charAt(0)&&(r="?"+r),t+s+(a=a.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(r=r.replace("#","%23"))+i},s.prototype.resolve=function(e){return this.resolveObject(x(e,!1,!0)).format()},s.prototype.resolveObject=function(e){if(n.isString(e)){var t=new s;t.parse(e,!1,!0),e=t}for(var a=new s,i=Object.keys(this),o=0;o<i.length;o++){var r=i[o];a[r]=this[r]}if(a.hash=e.hash,""===e.href)return a.href=a.format(),a;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var d=l[c];"protocol"!==d&&(a[d]=e[d])}return g[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a}if(e.protocol&&e.protocol!==a.protocol){if(!g[e.protocol]){for(var u=Object.keys(e),p=0;p<u.length;p++){var m=u[p];a[m]=e[m]}return a.href=a.format(),a}if(a.protocol=e.protocol,e.host||h[e.protocol])a.pathname=e.pathname;else{for(var b=(e.pathname||"").split("/");b.length&&!(e.host=b.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==b[0]&&b.unshift(""),b.length<2&&b.unshift(""),a.pathname=b.join("/")}if(a.search=e.search,a.query=e.query,a.host=e.host||"",a.auth=e.auth,a.hostname=e.hostname||e.host,a.port=e.port,a.pathname||a.search){var f=a.pathname||"",j=a.search||"";a.path=f+j}return a.slashes=a.slashes||e.slashes,a.href=a.format(),a}var x=a.pathname&&"/"===a.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),y=v||x||a.host&&e.pathname,O=y,E=a.pathname&&a.pathname.split("/")||[],w=(b=e.pathname&&e.pathname.split("/")||[],a.protocol&&!g[a.protocol]);if(w&&(a.hostname="",a.port=null,a.host&&(""===E[0]?E[0]=a.host:E.unshift(a.host)),a.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===b[0]?b[0]=e.host:b.unshift(e.host)),e.host=null),y=y&&(""===b[0]||""===E[0])),v)a.host=e.host||""===e.host?e.host:a.host,a.hostname=e.hostname||""===e.hostname?e.hostname:a.hostname,a.search=e.search,a.query=e.query,E=b;else if(b.length)E||(E=[]),E.pop(),E=E.concat(b),a.search=e.search,a.query=e.query;else if(!n.isNullOrUndefined(e.search))return w&&(a.hostname=a.host=E.shift(),(C=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=C.shift(),a.host=a.hostname=C.shift())),a.search=e.search,a.query=e.query,n.isNull(a.pathname)&&n.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a;if(!E.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var M=E.slice(-1)[0],S=(a.host||e.host||E.length>1)&&("."===M||".."===M)||""===M,_=0,T=E.length;T>=0;T--)"."===(M=E[T])?E.splice(T,1):".."===M?(E.splice(T,1),_++):_&&(E.splice(T,1),_--);if(!y&&!O)for(;_--;_)E.unshift("..");!y||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),S&&"/"!==E.join("/").substr(-1)&&E.push("");var C,k=""===E[0]||E[0]&&"/"===E[0].charAt(0);return w&&(a.hostname=a.host=k?"":E.length?E.shift():"",(C=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=C.shift(),a.host=a.hostname=C.shift())),(y=y||a.host&&E.length)&&!k&&E.unshift(""),E.length?a.pathname=E.join("/"):(a.pathname=null,a.path=null),n.isNull(a.pathname)&&n.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=e.auth||a.auth,a.slashes=a.slashes||e.slashes,a.href=a.format(),a},s.prototype.parseHost=function(){var e=this.host,t=r.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,a){e.exports=a(39)(2732)},function(e,t,a){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,a){"use strict";t.decode=t.parse=a(385),t.encode=t.stringify=a(386)},function(e,t,a){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,a,s){t=t||"&",a=a||"=";var o={};if("string"!=typeof e||0===e.length)return o;var r=/\+/g;e=e.split(t);var l=1e3;s&&"number"==typeof s.maxKeys&&(l=s.maxKeys);var c=e.length;l>0&&c>l&&(c=l);for(var d=0;d<c;++d){var u,p,m,b,f=e[d].replace(r,"%20"),h=f.indexOf(a);h>=0?(u=f.substr(0,h),p=f.substr(h+1)):(u=f,p=""),m=decodeURIComponent(u),b=decodeURIComponent(p),i(o,m)?n(o[m])?o[m].push(b):o[m]=[o[m],b]:o[m]=b}return o};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,a){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,a,r){return t=t||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e?s(o(e),(function(o){var r=encodeURIComponent(i(o))+a;return n(e[o])?s(e[o],(function(e){return r+encodeURIComponent(i(e))})).join(t):r+encodeURIComponent(i(e[o]))})).join(t):r?encodeURIComponent(i(r))+a+encodeURIComponent(i(e)):""};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function s(e,t){if(e.map)return e.map(t);for(var a=[],i=0;i<e.length;i++)a.push(t(e[i],i));return a}var o=Object.keys||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.push(a);return t}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(388);case"v8light":return a(390)}},function(e,t,a){var i=a(86),n=a(389);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".time-range-selector .time-range-section-title{font-weight:700;margin-bottom:8px}.time-range-selector .time-range-section{border-right:1px solid #343741;flex:50%;padding:0 8px}.time-range-selector .tab-stack{list-style:none;margin-bottom:0;padding-left:0}.time-range-selector .tab-stack>li{display:block;float:none;margin-bottom:4px;position:relative}.time-range-selector .tab-stack>li>a{border-radius:4px;display:block;padding:8px 16px;position:relative}.time-range-selector .tab-stack>li>a:hover{background-color:#25262e}.time-range-selector .tab-stack>li .body{display:none}.time-range-selector .tab-stack>li.active>a{background-color:#36a2ef;color:#1d1e24}.time-range-selector .tab-stack>li.active .body{display:block}.time-range-selector .tab-stack>li.has-body.active>a{border-radius:6px 6px 0 0}.time-range-selector .tab-stack>li.has-body.active .react-datepicker{border-radius:0 0 6px 6px;border-top:none}.time-range-selector .time-range-section:last-child{border-right:none}",""]),e.exports=t},function(e,t,a){var i=a(86),n=a(391);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".time-range-selector .time-range-section-title{font-weight:700;margin-bottom:8px}.time-range-selector .time-range-section{border-right:1px solid #d3dae6;flex:50%;padding:0 8px}.time-range-selector .tab-stack{list-style:none;margin-bottom:0;padding-left:0}.time-range-selector .tab-stack>li{display:block;float:none;margin-bottom:4px;position:relative}.time-range-selector .tab-stack>li>a{border-radius:4px;display:block;padding:8px 16px;position:relative}.time-range-selector .tab-stack>li>a:hover{background-color:#f5f7fa}.time-range-selector .tab-stack>li .body{display:none}.time-range-selector .tab-stack>li.active>a{background-color:#07c;color:#fff}.time-range-selector .tab-stack>li.active .body{display:block}.time-range-selector .tab-stack>li.has-body.active>a{border-radius:6px 6px 0 0}.time-range-selector .tab-stack>li.has-body.active .react-datepicker{border-radius:0 0 6px 6px;border-top:none}.time-range-selector .time-range-section:last-child{border-right:none}",""]),e.exports=t},function(e,t,a){e.exports=a.p+"7a4082435b3e1246960afd2e97c6c091.png"},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(394);case"v8light":return a(396)}},function(e,t,a){var i=a(86),n=a(395);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlPickFields__splitCard{border:1px solid #343741;padding-top:4px}",""]),e.exports=t},function(e,t,a){var i=a(86),n=a(397);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlPickFields__splitCard{border:1px solid #d3dae6;padding-top:4px}",""]),e.exports=t},function(e,t,a){e.exports=a(39)(1081)},function(e,t,a){"use strict";var i=a(175),n=a(122).CalendarObject,s=a(122).schema,o=a(196).iCalendar,r=a(195).RRule,l=t.VEvent=function(e,t){e instanceof o||null==e||(t=e,e=null),n.call(this,e,"VEVENT"),void 0!==t&&(this.addProperty("DTSTAMP",new Date),this.addProperty("UID",t))};i.inherits(l,n),l.prototype.setSummary=function(e){this.addProperty("SUMMARY",e)},l.prototype.setLocation=function(e){this.addProperty("LOCATION",e)},l.prototype.setDescription=function(e){this.addProperty("DESCRIPTION",e)},l.prototype.setDate=function(e,t){this.addProperty("DTSTART",e),t instanceof Date?this.addProperty("DTEND",t):this.addProperty("DURATION",t)},l.prototype.rrule=function(){var e=this.getPropertyValue("RRULE");if(!e)return null;for(var t,a=[],i=0;t=this.getPropertyValue("EXDATE",i++);)a.push.apply(a,t);return new r(e,{DTSTART:this.getPropertyValue("DTSTART"),DTEND:this.getPropertyValue("DTEND"),EXDATE:a})},l.prototype.inTimeRange=function(e,t){var a=this.rrule();if(a){var i=a.next(e);return null!==i&&(!t||i<=t)}var n=this.getPropertyValue("DTSTART"),s=this.getPropertyValue("DTEND");if(!s){var o=this.getPropertyValue("DURATION");if(0===o)return(!e||e<=n)&&(!t||t>n);s=o?new Date(n.valueOf()+1e3*this.getPropertyValue("DURATION")):new Date(n.valueOf()+864e5)}return(!e||e<s)&&(!t||t>n)},l.prototype.reply=function(e,t,a){var i=this.clone(!0);a=a||{},!0===t||void 0===t?t="ACCEPTED":!1===t&&(t="DECLINED"),i.setProperty("ATTENDEE",e,{PARTSTAT:t,CN:a.CN||e}),i.setProperty("DTSTAMP",new Date),i.setProperty("LAST-MODIFIED",new Date);var n=new o;return n.addProperty("METHOD","REPLY"),this.calendar&&n.addComponents(this.calendar.getComponents("VTIMEZONE")),n.addComponent(i),n},s.VEVENT={factory:l,valid_properties:[],required_properties:["DTSTAMP","UID"],valid_children:[],required_children:[]}},function(e,t,a){var i=a(227),n=a(175),s=a(122).CalendarObject,o=a(122).schema,r=a(195).RRule,l=t.VTimezone=function(e,t){s.call(this,e,"VTIMEZONE"),this.addProperty("TZID",t)};n.inherits(l,s),l.prototype.getRRule=function(e){var t=this.getComponents(e)[0];return t&&t.getPropertyValue("RRULE")?new r(t.getPropertyValue("RRULE"),t.getPropertyValue("DTSTART"),t.getPropertyValue("DTEND")):null},l.prototype.getOffsetForDate=function(e){if(!this.getComponents("DAYLIGHT").length)return this.getComponents("STANDARD")[0].getPropertyValue("TZOFFSETTO");i.equal(1,this.components.STANDARD.length),i.equal(1,this.components.DAYLIGHT.length);var t=this.getRRule("STANDARD"),a=this.getRRule("DAYLIGHT");return null===t||null===a?this.getComponents("STANDARD")[0].getPropertyValue("TZOFFSETTO"):(t=t.next(e),a=a.next(e),this.getComponents(a<t?"STANDARD":"DAYLIGHT")[0].getPropertyValue("TZOFFSETTO"))},l.prototype.fromLocalTime=function(e){var t=this.getOffsetForDate(e),a=t%100;return t=(t-a)/100,new Date(Date.UTC(e[0],e[1]-1,e[2],e[3]-t,e[4]-a,e[5]))},o.VTIMEZONE={factory:l}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(402);case"v8light":return a(404)}},function(e,t,a){var i=a(86),n=a(403);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlExpandedRowDetails{padding:0 8px 8px}.mlExpandedRowDetailsSection thead{display:none}",""]),e.exports=t},function(e,t,a){var i=a(86),n=a(405);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlExpandedRowDetails{padding:0 8px 8px}.mlExpandedRowDetailsSection thead{display:none}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(407);case"v8light":return a(409)}},function(e,t,a){var i=a(86),n=a(408);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlExpandedRowJobMessages{padding:0 8px 8px}.mlExpandedRowJobMessages .euiTable,.mlExpandedRowJobMessages .euiTableRowCell{background-color:initial!important}",""]),e.exports=t},function(e,t,a){var i=a(86),n=a(410);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlExpandedRowJobMessages{padding:0 8px 8px}.mlExpandedRowJobMessages .euiTable,.mlExpandedRowJobMessages .euiTableRowCell{background-color:initial!important}",""]),e.exports=t},function(e,t,a){e.exports=a.p+"bd21a7c05ddd7f5b46fe03d98fd506c9.png"},function(e,t,a){"use strict";(function(t){function i(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var n=i(a(415)),s=i(a(416));function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,a){return t&&l(e.prototype,t),a&&l(e,a),e}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],i=!0,n=!1,s=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done)&&(a.push(o.value),!t||a.length!==t);i=!0);}catch(e){n=!0,s=e}finally{try{i||null==r.return||r.return()}finally{if(n)throw s}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var u="undefined"==typeof window?null:window,p=u?u.navigator:null,m=(u&&u.document,o("")),b=o({}),f=o((function(){})),h="undefined"==typeof HTMLElement?"undefined":o(HTMLElement),g=function(e){return e&&e.instanceString&&x(e.instanceString)?e.instanceString():null},j=function(e){return null!=e&&o(e)==m},x=function(e){return null!=e&&o(e)===f},v=function(e){return Array.isArray?Array.isArray(e):null!=e&&e instanceof Array},y=function(e){return null!=e&&o(e)===b&&!v(e)&&e.constructor===Object},O=function(e){return null!=e&&o(e)===o(1)&&!isNaN(e)},E=function(e){return"undefined"===h?void 0:null!=e&&e instanceof HTMLElement},w=function(e){return M(e)||S(e)},M=function(e){return"collection"===g(e)&&e._private.single},S=function(e){return"collection"===g(e)&&!e._private.single},_=function(e){return"core"===g(e)},T=function(e){return"stylesheet"===g(e)},C=function(e){return null==e||!(""!==e&&!e.match(/^\s+$/))},k=function(e){return function(e){return null!=e&&o(e)===b}(e)&&x(e.then)},F=function(e,t){t||(t=function(){if(1===arguments.length)return arguments[0];if(0===arguments.length)return"undefined";for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);return e.join("$")});var a=function a(){var i,n=this,s=arguments,o=t.apply(n,s),r=a.cache;return(i=r[o])||(i=r[o]=e.apply(n,s)),i};return a.cache={},a},I=F((function(e){return e.replace(/([A-Z])/g,(function(e){return"-"+e.toLowerCase()}))})),D=F((function(e){return e.replace(/(-\w)/g,(function(e){return e[1].toUpperCase()}))})),A=F((function(e,t){return e+t[0].toUpperCase()+t.substring(1)}),(function(e,t){return e+"$"+t})),L=function(e){return C(e)?e:e.charAt(0).toUpperCase()+e.substring(1)},R="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",N=function(e,t){return e<t?-1:e>t?1:0},P=null!=Object.assign?Object.assign.bind(Object):function(e){for(var t=arguments,a=1;a<t.length;a++){var i=t[a];if(null!=i)for(var n=Object.keys(i),s=0;s<n.length;s++){var o=n[s];e[o]=i[o]}}return e},z={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},B=function(e){for(var t=e.map,a=e.keys,i=a.length,n=0;n<i;n++){var s=a[n];if(y(s))throw Error("Tried to set map with object key");n<a.length-1?(null==t[s]&&(t[s]={}),t=t[s]):t[s]=e.value}},V=function(e){for(var t=e.map,a=e.keys,i=a.length,n=0;n<i;n++){var s=a[n];if(y(s))throw Error("Tried to get map with object key");if(null==(t=t[s]))return t}return t},J=u?u.performance:null,U=J&&J.now?function(){return J.now()}:function(){return Date.now()},G=function(){if(u){if(u.requestAnimationFrame)return function(e){u.requestAnimationFrame(e)};if(u.mozRequestAnimationFrame)return function(e){u.mozRequestAnimationFrame(e)};if(u.webkitRequestAnimationFrame)return function(e){u.webkitRequestAnimationFrame(e)};if(u.msRequestAnimationFrame)return function(e){u.msRequestAnimationFrame(e)}}return function(e){e&&setTimeout((function(){e(U())}),1e3/60)}}(),q=function(e){return G(e)},$=U,W=5381,H=function(e){for(var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W,i=a;!(t=e.next()).done;)i=(i<<5)+i+t.value|0;return i},Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;return(t<<5)+t+e|0},X=function(e,t){var a={value:0,done:!1},i=0,n=e.length;return H({next:function(){return i<n?a.value=e[i++]:a.done=!0,a}},t)},Q=function(e,t){var a={value:0,done:!1},i=0,n=e.length;return H({next:function(){return i<n?a.value=e.charCodeAt(i++):a.done=!0,a}},t)},K=function(){return Z(arguments)},Z=function(e){for(var t,a=0;a<e.length;a++){var i=e[a];t=0===a?Q(i):Q(i,t)}return t},ee=!0,te=null!=console.warn,ae=null!=console.trace,ie=Number.MAX_SAFE_INTEGER||9007199254740991,ne=function(){return!0},se=function(){return!1},oe=function(){return 0},re=function(){},le=function(e){throw new Error(e)},ce=function(e){if(void 0===e)return ee;ee=!!e},de=function(e){ce()&&(te?console.warn(e):(console.log(e),ae&&console.trace()))},ue=function(e){return null==e?e:v(e)?e.slice():y(e)?function(e){return P({},e)}(e):e},pe=function(e,t){for(t=e="";e++<36;t+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return t},me={},be=function(){return me},fe=function(e){var t=Object.keys(e);return function(a){for(var i={},n=0;n<t.length;n++){var s=t[n],o=null==a?void 0:a[s];i[s]=void 0===o?e[s]:o}return i}},he=function(e,t,a){for(var i=e.length;i>=0&&(e[i]!==t||(e.splice(i,1),a));i--);},ge=function(e){e.splice(0,e.length)},je=function(e,t,a){return a&&(t=A(a,t)),e[t]},xe=function(e,t,a,i){a&&(t=A(a,t)),e[t]=i},ve="undefined"!=typeof Map?Map:function(){function e(){r(this,e),this._obj={}}return c(e,[{key:"set",value:function(e,t){return this._obj[e]=t,this}},{key:"delete",value:function(e){return this._obj[e]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(e){return void 0!==this._obj[e]}},{key:"get",value:function(e){return this._obj[e]}}]),e}(),ye=function(){function e(t){if(r(this,e),this._obj=Object.create(null),this.size=0,null!=t){var a;a=null!=t.instanceString&&t.instanceString()===this.instanceString()?t.toArray():t;for(var i=0;i<a.length;i++)this.add(a[i])}}return c(e,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(e){var t=this._obj;1!==t[e]&&(t[e]=1,this.size++)}},{key:"delete",value:function(e){var t=this._obj;1===t[e]&&(t[e]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(e){return 1===this._obj[e]}},{key:"toArray",value:function(){var e=this;return Object.keys(this._obj).filter((function(t){return e.has(t)}))}},{key:"forEach",value:function(e,t){return this.toArray().forEach(e,t)}}]),e}(),Oe="undefined"!==("undefined"==typeof Set?"undefined":o(Set))?Set:ye,Ee=function(e,t,a){if(a=!(void 0!==a&&!a),void 0!==e&&void 0!==t&&_(e)){var i=t.group;if(null==i&&(i=t.data&&null!=t.data.source&&null!=t.data.target?"edges":"nodes"),"nodes"===i||"edges"===i){this.length=1,this[0]=this;var n=this._private={cy:e,single:!0,data:t.data||{},position:t.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:i,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!t.selected,selectable:void 0===t.selectable||!!t.selectable,locked:!!t.locked,grabbed:!1,grabbable:void 0===t.grabbable||!!t.grabbable,pannable:void 0===t.pannable?"edges"===i:!!t.pannable,active:!1,classes:new Oe,animation:{current:[],queue:[]},rscratch:{},scratch:t.scratch||{},edges:[],children:[],parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(null==n.position.x&&(n.position.x=0),null==n.position.y&&(n.position.y=0),t.renderedPosition){var s=t.renderedPosition,o=e.pan(),r=e.zoom();n.position={x:(s.x-o.x)/r,y:(s.y-o.y)/r}}var l=[];v(t.classes)?l=t.classes:j(t.classes)&&(l=t.classes.split(/\s+/));for(var c=0,d=l.length;c<d;c++){var u=l[c];u&&""!==u&&n.classes.add(u)}this.createEmitter();var p=t.style||t.css;p&&(de("Setting a `style` bypass at element creation is deprecated"),this.style(p)),(void 0===a||a)&&this.restore()}else le("An element must be of type `nodes` or `edges`; you specified `"+i+"`")}else le("An element must have a core reference and parameters set")},we=function(e){return e={bfs:e.bfs||!e.dfs,dfs:e.dfs||!e.bfs},function(t,a,i){var n;y(t)&&!w(t)&&(t=(n=t).roots||n.root,a=n.visit,i=n.directed),i=2!==arguments.length||x(a)?i:a,a=x(a)?a:function(){};for(var s,o=this._private.cy,r=t=j(t)?this.filter(t):t,l=[],c=[],d={},u={},p={},m=0,b=this.byGroup(),f=b.nodes,h=b.edges,g=0;g<r.length;g++){var v=r[g],O=v.id();v.isNode()&&(l.unshift(v),e.bfs&&(p[O]=!0,c.push(v)),u[O]=0)}var E=function(){var t=e.bfs?l.shift():l.pop(),n=t.id();if(e.dfs){if(p[n])return"continue";p[n]=!0,c.push(t)}var o,r=u[n],b=d[n],g=null!=b?b.source():null,j=null!=b?b.target():null,x=null==b?void 0:t.same(g)?j[0]:g[0];if(!0===(o=a(t,b,x,m++,r)))return s=t,"break";if(!1===o)return"break";for(var v=t.connectedEdges().filter((function(e){return(!i||e.source().same(t))&&h.has(e)})),y=0;y<v.length;y++){var O=v[y],E=O.connectedNodes().filter((function(e){return!e.same(t)&&f.has(e)})),w=E.id();0===E.length||p[w]||(E=E[0],l.push(E),e.bfs&&(p[w]=!0,c.push(E)),d[w]=O,u[w]=u[n]+1)}};e:for(;0!==l.length;){var M=E();switch(M){case"continue":continue;case"break":break e}}for(var S=o.collection(),_=0;_<c.length;_++){var T=c[_],C=d[T.id()];null!=C&&S.merge(C),S.merge(T)}return{path:o.collection(S),found:o.collection(s)}}},Me={breadthFirstSearch:we({bfs:!0}),depthFirstSearch:we({dfs:!0})};Me.bfs=Me.breadthFirstSearch,Me.dfs=Me.depthFirstSearch;var Se=fe({root:null,weight:function(e){return 1},directed:!1}),_e={dijkstra:function(e){if(!y(e)){var t=arguments;e={root:t[0],weight:t[1],directed:t[2]}}var a=Se(e),i=a.root,n=a.weight,o=a.directed,r=this,l=n,c=j(i)?this.filter(i)[0]:i[0],d={},u={},p={},m=this.byGroup(),b=m.nodes,f=m.edges;f.unmergeBy((function(e){return e.isLoop()}));for(var h=function(e){return d[e.id()]},g=function(e,t){d[e.id()]=t,x.updateItem(e)},x=new s((function(e,t){return h(e)-h(t)})),v=0;v<b.length;v++){var O=b[v];d[O.id()]=O.same(c)?0:1/0,x.push(O)}for(var E=function(e,t){for(var a,i=(o?e.edgesTo(t):e.edgesWith(t)).intersect(f),n=1/0,s=0;s<i.length;s++){var r=i[s],c=l(r);(c<n||!a)&&(n=c,a=r)}return{edge:a,dist:n}};x.size()>0;){var w=x.pop(),M=h(w),S=w.id();if(p[S]=M,M!==1/0)for(var _=w.neighborhood().intersect(b),T=0;T<_.length;T++){var C=_[T],k=C.id(),F=E(w,C),I=M+F.dist;I<h(C)&&(g(C,I),u[k]={node:w,edge:F.edge})}}return{distanceTo:function(e){var t=j(e)?b.filter(e)[0]:e[0];return p[t.id()]},pathTo:function(e){var t=j(e)?b.filter(e)[0]:e[0],a=[],i=t,n=i.id();if(t.length>0)for(a.unshift(t);u[n];){var s=u[n];a.unshift(s.edge),a.unshift(s.node),n=(i=s.node).id()}return r.spawn(a)}}}},Te={kruskal:function(e){e=e||function(e){return 1};for(var t=this.byGroup(),a=t.nodes,i=t.edges,n=a.length,s=new Array(n),o=a,r=function(e){for(var t=0;t<s.length;t++)if(s[t].has(e))return t},l=0;l<n;l++)s[l]=this.spawn(a[l]);for(var c=i.sort((function(t,a){return e(t)-e(a)})),d=0;d<c.length;d++){var u=c[d],p=u.source()[0],m=u.target()[0],b=r(p),f=r(m),h=s[b],g=s[f];b!==f&&(o.merge(u),h.merge(g),s.splice(f,1))}return o}},Ce=fe({root:null,goal:null,weight:function(e){return 1},heuristic:function(e){return 0},directed:!1}),ke={aStar:function(e){var t=this.cy(),a=Ce(e),i=a.root,n=a.goal,o=a.heuristic,r=a.directed,l=a.weight;i=t.collection(i)[0],n=t.collection(n)[0];var c,d,u=i.id(),p=n.id(),m={},b={},f={},h=new s((function(e,t){return b[e.id()]-b[t.id()]})),g=new Oe,j={},x={},v=function(e,t){h.push(e),g.add(t)};v(i,u),m[u]=0,b[u]=o(i);for(var y,O=0;h.size()>0;){if(d=(c=h.pop()).id(),g.delete(d),O++,d===p){for(var E=[],w=n,M=p,S=x[M];E.unshift(w),null!=S&&E.unshift(S),null!=(w=j[M]);)S=x[M=w.id()];return{found:!0,distance:m[d],path:this.spawn(E),steps:O}}f[d]=!0;for(var _=c._private.edges,T=0;T<_.length;T++){var C=_[T];if(this.hasElementWithId(C.id())&&(!r||C.data("source")===d)){var k=C.source(),F=C.target(),I=k.id()!==d?k:F,D=I.id();if(this.hasElementWithId(D)&&!f[D]){var A=m[d]+l(C);y=D,g.has(y)?A<m[D]&&(m[D]=A,b[D]=A+o(I),j[D]=c):(m[D]=A,b[D]=A+o(I),v(I,D),j[D]=c,x[D]=C)}}}}return{found:!1,distance:void 0,path:void 0,steps:O}}},Fe=fe({weight:function(e){return 1},directed:!1}),Ie={floydWarshall:function(e){for(var t=this.cy(),a=Fe(e),i=a.weight,n=a.directed,s=i,o=this.byGroup(),r=o.nodes,l=o.edges,c=r.length,d=c*c,u=function(e){return r.indexOf(e)},p=function(e){return r[e]},m=new Array(d),b=0;b<d;b++){var f=b%c,h=(b-f)/c;m[b]=h===f?0:1/0}for(var g=new Array(d),x=new Array(d),v=0;v<l.length;v++){var y=l[v],O=y.source()[0],E=y.target()[0];if(O!==E){var w=u(O),M=u(E),S=w*c+M,_=s(y);if(m[S]>_&&(m[S]=_,g[S]=M,x[S]=y),!n){var T=M*c+w;!n&&m[T]>_&&(m[T]=_,g[T]=w,x[T]=y)}}}for(var C=0;C<c;C++)for(var k=0;k<c;k++)for(var F=k*c+C,I=0;I<c;I++){var D=k*c+I,A=C*c+I;m[F]+m[A]<m[D]&&(m[D]=m[F]+m[A],g[D]=g[F])}var L=function(e){return u(function(e){return(j(e)?t.filter(e):e)[0]}(e))},R={distance:function(e,t){var a=L(e),i=L(t);return m[a*c+i]},path:function(e,a){var i=L(e),n=L(a),s=p(i);if(i===n)return s.collection();if(null==g[i*c+n])return t.collection();var o,r=t.collection(),l=i;for(r.merge(s);i!==n;)l=i,i=g[i*c+n],o=x[l*c+i],r.merge(o),r.merge(p(i));return r}};return R}},De=fe({weight:function(e){return 1},directed:!1,root:null}),Ae={bellmanFord:function(e){var t=this,a=De(e),i=a.weight,n=a.directed,s=a.root,o=i,r=this,l=this.cy(),c=this.byGroup(),d=c.edges,u=c.nodes,p=u.length,m=new ve,b=!1;s=l.collection(s)[0],d.unmergeBy((function(e){return e.isLoop()}));for(var f=d.length,h=function(e){var t=m.get(e.id());return t||(t={},m.set(e.id(),t)),t},g=function(e){return(j(e)?l.$(e):e)[0]},x=0;x<p;x++){var v=u[x],y=h(v);v.same(s)?y.dist=0:y.dist=1/0,y.pred=null,y.edge=null}for(var O=!1,E=function(e,t,a,i,n,s){var o=i.dist+s;o<n.dist&&!a.same(i.edge)&&(n.dist=o,n.pred=e,n.edge=a,O=!0)},w=1;w<p;w++){O=!1;for(var M=0;M<f;M++){var S=d[M],_=S.source(),T=S.target(),C=o(S),k=h(_),F=h(T);E(_,0,S,k,F,C),n||E(T,0,S,F,k,C)}if(!O)break}if(O)for(var I=0;I<f;I++){var D=d[I],A=D.source(),L=D.target(),R=o(D),N=h(A).dist,P=h(L).dist;if(N+R<P||!n&&P+R<N){de("Graph contains a negative weight cycle for Bellman-Ford"),b=!0;break}}return{distanceTo:function(e){return h(g(e)).dist},pathTo:function(e){for(var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,i=g(e),n=[],o=i;;){if(null==o)return t.spawn();var l=h(o),c=l.edge,d=l.pred;if(n.unshift(o[0]),o.same(a)&&n.length>0)break;null!=c&&n.unshift(c),o=d}return r.spawn(n)},hasNegativeWeightCycle:b,negativeWeightCycles:[]}}},Le=Math.sqrt(2),Re=function(e,t,a){0===a.length&&le("Karger-Stein must be run on a connected (sub)graph");for(var i=a[e],n=i[1],s=i[2],o=t[n],r=t[s],l=a,c=l.length-1;c>=0;c--){var d=l[c],u=d[1],p=d[2];(t[u]===o&&t[p]===r||t[u]===r&&t[p]===o)&&l.splice(c,1)}for(var m=0;m<l.length;m++){var b=l[m];b[1]===r?(l[m]=b.slice(),l[m][1]=o):b[2]===r&&(l[m]=b.slice(),l[m][2]=o)}for(var f=0;f<t.length;f++)t[f]===r&&(t[f]=o);return l},Ne=function(e,t,a,i){for(;a>i;){var n=Math.floor(Math.random()*t.length);t=Re(n,e,t),a--}return t},Pe={kargerStein:function(){var e=this.byGroup(),t=e.nodes,a=e.edges;a.unmergeBy((function(e){return e.isLoop()}));var i=t.length,n=a.length,s=Math.ceil(Math.pow(Math.log(i)/Math.LN2,2)),o=Math.floor(i/Le);if(!(i<2)){for(var r=[],l=0;l<n;l++){var c=a[l];r.push([l,t.indexOf(c.source()),t.indexOf(c.target())])}for(var d=1/0,u=[],p=new Array(i),m=new Array(i),b=new Array(i),f=function(e,t){for(var a=0;a<i;a++)t[a]=e[a]},h=0;h<=s;h++){for(var g=0;g<i;g++)m[g]=g;var j=Ne(m,r.slice(),i,o),x=j.slice();f(m,b);var v=Ne(m,j,o,2),y=Ne(b,x,o,2);v.length<=y.length&&v.length<d?(d=v.length,u=v,f(m,p)):y.length<=v.length&&y.length<d&&(d=y.length,u=y,f(b,p))}for(var O=this.spawn(u.map((function(e){return a[e[0]]}))),E=this.spawn(),w=this.spawn(),M=p[0],S=0;S<p.length;S++){var _=p[S],T=t[S];_===M?E.merge(T):w.merge(T)}return{cut:O,partition1:E,partition2:w}}le("At least 2 nodes are required for Karger-Stein algorithm")}},ze=function(e,t,a){return{x:e.x*t+a.x,y:e.y*t+a.y}},Be=function(e,t,a){return{x:(e.x-a.x)/t,y:(e.y-a.y)/t}},Ve=function(e){return{x:e[0],y:e[1]}},Je=function(e,t){return Math.atan2(t,e)-Math.PI/2},Ue=Math.log2||function(e){return Math.log(e)/Math.log(2)},Ge=function(e){return e>0?1:e<0?-1:0},qe=function(e,t){return Math.sqrt($e(e,t))},$e=function(e,t){var a=t.x-e.x,i=t.y-e.y;return a*a+i*i},We=function(e){for(var t=e.length,a=0,i=0;i<t;i++)a+=e[i];for(var n=0;n<t;n++)e[n]=e[n]/a;return e},He=function(e,t,a,i){return(1-i)*(1-i)*e+2*(1-i)*i*t+i*i*a},Ye=function(e,t,a,i){return{x:He(e.x,t.x,a.x,i),y:He(e.y,t.y,a.y,i)}},Xe=function(e,t,a){return Math.max(e,Math.min(a,t))},Qe=function(e){if(null==e)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(null!=e.x1&&null!=e.y1){if(null!=e.x2&&null!=e.y2&&e.x2>=e.x1&&e.y2>=e.y1)return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,w:e.x2-e.x1,h:e.y2-e.y1};if(null!=e.w&&null!=e.h&&e.w>=0&&e.h>=0)return{x1:e.x1,y1:e.y1,x2:e.x1+e.w,y2:e.y1+e.h,w:e.w,h:e.h}}},Ke=function(e,t,a){e.x1=Math.min(e.x1,t),e.x2=Math.max(e.x2,t),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,a),e.y2=Math.max(e.y2,a),e.h=e.y2-e.y1},Ze=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.x1-=t,e.x2+=t,e.y1-=t,e.y2+=t,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},et=function(e){var t,a,i,n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0];if(1===s.length)t=a=i=n=s[0];else if(2===s.length)t=i=s[0],n=a=s[1];else if(4===s.length){var o=d(s,4);t=o[0],a=o[1],i=o[2],n=o[3]}return e.x1-=n,e.x2+=a,e.y1-=t,e.y2+=i,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},tt=function(e,t){e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1},at=function(e,t){e.x1+=t.x,e.x2+=t.x,e.y1+=t.y,e.y2+=t.y},it=function(e,t){return!(e.x1>t.x2||t.x1>e.x2||e.x2<t.x1||t.x2<e.x1||e.y2<t.y1||t.y2<e.y1||e.y1>t.y2||t.y1>e.y2)},nt=function(e,t,a){return e.x1<=t&&t<=e.x2&&e.y1<=a&&a<=e.y2},st=function(e,t){return nt(e,t.x1,t.y1)&&nt(e,t.x2,t.y2)},ot=function(e,t,a,i,n,s,o){var r,l=wt(n,s),c=n/2,d=s/2,u=i-d-o;if((r=jt(e,t,a,i,a-c+l-o,u,a+c-l+o,u,!1)).length>0)return r;var p=a+c+o;if((r=jt(e,t,a,i,p,i-d+l-o,p,i+d-l+o,!1)).length>0)return r;var m=i+d+o;if((r=jt(e,t,a,i,a-c+l-o,m,a+c-l+o,m,!1)).length>0)return r;var b,f=a-c-o;if((r=jt(e,t,a,i,f,i-d+l-o,f,i+d-l+o,!1)).length>0)return r;var h=a-c+l,g=i-d+l;if((b=ht(e,t,a,i,h,g,l+o)).length>0&&b[0]<=h&&b[1]<=g)return[b[0],b[1]];var j=a+c-l,x=i-d+l;if((b=ht(e,t,a,i,j,x,l+o)).length>0&&b[0]>=j&&b[1]<=x)return[b[0],b[1]];var v=a+c-l,y=i+d-l;if((b=ht(e,t,a,i,v,y,l+o)).length>0&&b[0]>=v&&b[1]>=y)return[b[0],b[1]];var O=a-c+l,E=i+d-l;return(b=ht(e,t,a,i,O,E,l+o)).length>0&&b[0]<=O&&b[1]>=E?[b[0],b[1]]:[]},rt=function(e,t,a,i,n,s,o){var r=o,l=Math.min(a,n),c=Math.max(a,n),d=Math.min(i,s),u=Math.max(i,s);return l-r<=e&&e<=c+r&&d-r<=t&&t<=u+r},lt=function(e,t,a,i,n,s,o,r,l){var c=Math.min(a,o,n)-l,d=Math.max(a,o,n)+l,u=Math.min(i,r,s)-l,p=Math.max(i,r,s)+l;return!(e<c||e>d||t<u||t>p)},ct=function(e,t,a,i,n,s,o,r){var l,c,d,u,p,m,b,f,h,g,j,x,v,y=[];c=9*a*n-3*a*a-3*a*o-6*n*n+3*n*o+9*i*s-3*i*i-3*i*r-6*s*s+3*s*r,d=3*a*a-6*a*n+a*o-a*e+2*n*n+2*n*e-o*e+3*i*i-6*i*s+i*r-i*t+2*s*s+2*s*t-r*t,u=1*a*n-a*a+a*e-n*e+i*s-i*i+i*t-s*t,0===(l=1*a*a-4*a*n+2*a*o+4*n*n-4*n*o+o*o+i*i-4*i*s+2*i*r+4*s*s-4*s*r+r*r)&&(l=1e-5),f=-27*(u/=l)+(c/=l)*(9*(d/=l)-c*c*2),m=(b=(3*d-c*c)/9)*b*b+(f/=54)*f,(p=y)[1]=0,x=c/3,m>0?(g=(g=f+Math.sqrt(m))<0?-Math.pow(-g,1/3):Math.pow(g,1/3),j=(j=f-Math.sqrt(m))<0?-Math.pow(-j,1/3):Math.pow(j,1/3),p[0]=-x+g+j,x+=(g+j)/2,p[4]=p[2]=-x,x=Math.sqrt(3)*(-j+g)/2,p[3]=x,p[5]=-x):(p[5]=p[3]=0,0===m?(v=f<0?-Math.pow(-f,1/3):Math.pow(f,1/3),p[0]=2*v-x,p[4]=p[2]=-(v+x)):(h=(b=-b)*b*b,h=Math.acos(f/Math.sqrt(h)),v=2*Math.sqrt(b),p[0]=-x+v*Math.cos(h/3),p[2]=-x+v*Math.cos((h+2*Math.PI)/3),p[4]=-x+v*Math.cos((h+4*Math.PI)/3)));for(var O=[],E=0;E<6;E+=2)Math.abs(y[E+1])<1e-7&&y[E]>=0&&y[E]<=1&&O.push(y[E]);O.push(1),O.push(0);for(var w,M,S,_=-1,T=0;T<O.length;T++)w=Math.pow(1-O[T],2)*a+2*(1-O[T])*O[T]*n+O[T]*O[T]*o,M=Math.pow(1-O[T],2)*i+2*(1-O[T])*O[T]*s+O[T]*O[T]*r,S=Math.pow(w-e,2)+Math.pow(M-t,2),_>=0?S<_&&(_=S):_=S;return _},dt=function(e,t,a,i,n,s){var o=[e-a,t-i],r=[n-a,s-i],l=r[0]*r[0]+r[1]*r[1],c=o[0]*o[0]+o[1]*o[1],d=o[0]*r[0]+o[1]*r[1],u=d*d/l;return d<0?c:u>l?(e-n)*(e-n)+(t-s)*(t-s):c-u},ut=function(e,t,a){for(var i,n,s,o,r=0,l=0;l<a.length/2;l++)if(i=a[2*l],n=a[2*l+1],l+1<a.length/2?(s=a[2*(l+1)],o=a[2*(l+1)+1]):(s=a[2*(l+1-a.length/2)],o=a[2*(l+1-a.length/2)+1]),i==e&&s==e);else{if(!(i>=e&&e>=s||i<=e&&e<=s))continue;(e-i)/(s-i)*(o-n)+n>t&&r++}return r%2!=0},pt=function(e,t,a,i,n,s,o,r,l){var c,d=new Array(a.length);null!=r[0]?(c=Math.atan(r[1]/r[0]),r[0]<0?c+=Math.PI/2:c=-c-Math.PI/2):c=r;for(var u,p=Math.cos(-c),m=Math.sin(-c),b=0;b<d.length/2;b++)d[2*b]=s/2*(a[2*b]*p-a[2*b+1]*m),d[2*b+1]=o/2*(a[2*b+1]*p+a[2*b]*m),d[2*b]+=i,d[2*b+1]+=n;if(l>0){var f=bt(d,-l);u=mt(f)}else u=d;return ut(e,t,u)},mt=function(e){for(var t,a,i,n,s,o,r,l,c=new Array(e.length/2),d=0;d<e.length/4;d++){t=e[4*d],a=e[4*d+1],i=e[4*d+2],n=e[4*d+3],d<e.length/4-1?(s=e[4*(d+1)],o=e[4*(d+1)+1],r=e[4*(d+1)+2],l=e[4*(d+1)+3]):(s=e[0],o=e[1],r=e[2],l=e[3]);var u=jt(t,a,i,n,s,o,r,l,!0);c[2*d]=u[0],c[2*d+1]=u[1]}return c},bt=function(e,t){for(var a,i,n,s,o=new Array(2*e.length),r=0;r<e.length/2;r++){a=e[2*r],i=e[2*r+1],r<e.length/2-1?(n=e[2*(r+1)],s=e[2*(r+1)+1]):(n=e[0],s=e[1]);var l=s-i,c=-(n-a),d=Math.sqrt(l*l+c*c),u=l/d,p=c/d;o[4*r]=a+u*t,o[4*r+1]=i+p*t,o[4*r+2]=n+u*t,o[4*r+3]=s+p*t}return o},ft=function(e,t,a,i,n,s,o){return e-=n,t-=s,(e/=a/2+o)*e+(t/=i/2+o)*t<=1},ht=function(e,t,a,i,n,s,o){var r=[a-e,i-t],l=[e-n,t-s],c=r[0]*r[0]+r[1]*r[1],d=2*(l[0]*r[0]+l[1]*r[1]),u=d*d-4*c*(l[0]*l[0]+l[1]*l[1]-o*o);if(u<0)return[];var p=(-d+Math.sqrt(u))/(2*c),m=(-d-Math.sqrt(u))/(2*c),b=Math.min(p,m),f=Math.max(p,m),h=[];if(b>=0&&b<=1&&h.push(b),f>=0&&f<=1&&h.push(f),0===h.length)return[];var g=h[0]*r[0]+e,j=h[0]*r[1]+t;return h.length>1?h[0]==h[1]?[g,j]:[g,j,h[1]*r[0]+e,h[1]*r[1]+t]:[g,j]},gt=function(e,t,a){return t<=e&&e<=a||a<=e&&e<=t?e:e<=t&&t<=a||a<=t&&t<=e?t:a},jt=function(e,t,a,i,n,s,o,r,l){var c=e-n,d=a-e,u=o-n,p=t-s,m=i-t,b=r-s,f=u*p-b*c,h=d*p-m*c,g=b*d-u*m;if(0!==g){var j=f/g,x=h/g,v=-.001;return v<=j&&j<=1.001&&v<=x&&x<=1.001||l?[e+j*d,t+j*m]:[]}return 0===f||0===h?gt(e,a,o)===o?[o,r]:gt(e,a,n)===n?[n,s]:gt(n,o,a)===a?[a,i]:[]:[]},xt=function(e,t,a,i,n,s,o,r){var l,c,d,u,p,m,b=[],f=new Array(a.length),h=!0;if(null==s&&(h=!1),h){for(var g=0;g<f.length/2;g++)f[2*g]=a[2*g]*s+i,f[2*g+1]=a[2*g+1]*o+n;if(r>0){var j=bt(f,-r);c=mt(j)}else c=f}else c=a;for(var x=0;x<c.length/2;x++)d=c[2*x],u=c[2*x+1],x<c.length/2-1?(p=c[2*(x+1)],m=c[2*(x+1)+1]):(p=c[0],m=c[1]),0!==(l=jt(e,t,i,n,d,u,p,m)).length&&b.push(l[0],l[1]);return b},vt=function(e,t,a){var i=[e[0]-t[0],e[1]-t[1]],n=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=(n-a)/n;return s<0&&(s=1e-5),[t[0]+s*i[0],t[1]+s*i[1]]},yt=function(e,t){var a=Et(e,t);return Ot(a)},Ot=function(e){for(var t,a,i=e.length/2,n=1/0,s=1/0,o=-1/0,r=-1/0,l=0;l<i;l++)t=e[2*l],a=e[2*l+1],n=Math.min(n,t),o=Math.max(o,t),s=Math.min(s,a),r=Math.max(r,a);for(var c=2/(o-n),d=2/(r-s),u=0;u<i;u++)t=e[2*u]=e[2*u]*c,a=e[2*u+1]=e[2*u+1]*d,n=Math.min(n,t),o=Math.max(o,t),s=Math.min(s,a),r=Math.max(r,a);if(s<-1)for(var p=0;p<i;p++)a=e[2*p+1]=e[2*p+1]+(-1-s);return e},Et=function(e,t){var a=1/e*2*Math.PI,i=e%2==0?Math.PI/2+a/2:Math.PI/2;i+=t;for(var n,s=new Array(2*e),o=0;o<e;o++)n=o*a+i,s[2*o]=Math.cos(n),s[2*o+1]=Math.sin(-n);return s},wt=function(e,t){return Math.min(e/4,t/4,8)},Mt=function(e,t){return{heightOffset:Math.min(15,.05*t),widthOffset:Math.min(100,.25*e),ctrlPtOffsetPct:.05}},St=fe({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(e){return 1}}),_t={pageRank:function(e){for(var t=St(e),a=t.dampingFactor,i=t.precision,n=t.iterations,s=t.weight,o=this._private.cy,r=this.byGroup(),l=r.nodes,c=r.edges,d=l.length,u=d*d,p=c.length,m=new Array(u),b=new Array(d),f=(1-a)/d,h=0;h<d;h++){for(var g=0;g<d;g++)m[h*d+g]=0;b[h]=0}for(var j=0;j<p;j++){var x=c[j],v=x.data("source"),y=x.data("target");if(v!==y){var O=l.indexOfId(v),E=l.indexOfId(y),w=s(x);m[E*d+O]+=w,b[O]+=w}}for(var M=1/d+f,S=0;S<d;S++)if(0===b[S])for(var _=0;_<d;_++)m[_*d+S]=M;else for(var T=0;T<d;T++){var C=T*d+S;m[C]=m[C]/b[S]+f}for(var k,F=new Array(d),I=new Array(d),D=0;D<d;D++)F[D]=1;for(var A=0;A<n;A++){for(var L=0;L<d;L++)I[L]=0;for(var R=0;R<d;R++)for(var N=0;N<d;N++){var P=R*d+N;I[R]+=m[P]*F[N]}We(I),k=F,F=I,I=k;for(var z=0,B=0;B<d;B++){var V=k[B]-F[B];z+=V*V}if(z<i)break}return{rank:function(e){return e=o.collection(e)[0],F[l.indexOf(e)]}}}},Tt=fe({root:null,weight:function(e){return 1},directed:!1,alpha:0}),Ct={degreeCentralityNormalized:function(e){e=Tt(e);var t=this.cy(),a=this.nodes(),i=a.length;if(e.directed){for(var n={},s={},o=0,r=0,l=0;l<i;l++){var c=a[l],d=c.id();e.root=c;var u=this.degreeCentrality(e);o<u.indegree&&(o=u.indegree),r<u.outdegree&&(r=u.outdegree),n[d]=u.indegree,s[d]=u.outdegree}return{indegree:function(e){return 0==o?0:(j(e)&&(e=t.filter(e)),n[e.id()]/o)},outdegree:function(e){return 0===r?0:(j(e)&&(e=t.filter(e)),s[e.id()]/r)}}}for(var p={},m=0,b=0;b<i;b++){var f=a[b];e.root=f;var h=this.degreeCentrality(e);m<h.degree&&(m=h.degree),p[f.id()]=h.degree}return{degree:function(e){return 0===m?0:(j(e)&&(e=t.filter(e)),p[e.id()]/m)}}},degreeCentrality:function(e){e=Tt(e);var t=this.cy(),a=this,i=e,n=i.root,s=i.weight,o=i.directed,r=i.alpha;if(n=t.collection(n)[0],o){for(var l=n.connectedEdges(),c=l.filter((function(e){return e.target().same(n)&&a.has(e)})),d=l.filter((function(e){return e.source().same(n)&&a.has(e)})),u=c.length,p=d.length,m=0,b=0,f=0;f<c.length;f++)m+=s(c[f]);for(var h=0;h<d.length;h++)b+=s(d[h]);return{indegree:Math.pow(u,1-r)*Math.pow(m,r),outdegree:Math.pow(p,1-r)*Math.pow(b,r)}}for(var g=n.connectedEdges().intersection(a),j=g.length,x=0,v=0;v<g.length;v++)x+=s(g[v]);return{degree:Math.pow(j,1-r)*Math.pow(x,r)}}};Ct.dc=Ct.degreeCentrality,Ct.dcn=Ct.degreeCentralityNormalised=Ct.degreeCentralityNormalized;var kt=fe({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),Ft={closenessCentralityNormalized:function(e){for(var t=kt(e),a=t.harmonic,i=t.weight,n=t.directed,s=this.cy(),o={},r=0,l=this.nodes(),c=this.floydWarshall({weight:i,directed:n}),d=0;d<l.length;d++){for(var u=0,p=l[d],m=0;m<l.length;m++)if(d!==m){var b=c.distance(p,l[m]);u+=a?1/b:b}a||(u=1/u),r<u&&(r=u),o[p.id()]=u}return{closeness:function(e){return 0==r?0:(e=j(e)?s.filter(e)[0].id():e.id(),o[e]/r)}}},closenessCentrality:function(e){var t=kt(e),a=t.root,i=t.weight,n=t.directed,s=t.harmonic;a=this.filter(a)[0];for(var o=this.dijkstra({root:a,weight:i,directed:n}),r=0,l=this.nodes(),c=0;c<l.length;c++){var d=l[c];if(!d.same(a)){var u=o.distanceTo(d);r+=s?1/u:u}}return s?r:1/r}};Ft.cc=Ft.closenessCentrality,Ft.ccn=Ft.closenessCentralityNormalised=Ft.closenessCentralityNormalized;var It=fe({weight:null,directed:!1}),Dt={betweennessCentrality:function(e){for(var t=It(e),a=t.directed,i=t.weight,n=null!=i,o=this.cy(),r=this.nodes(),l={},c={},d=0,u=function(e,t){c[e]=t,t>d&&(d=t)},p=function(e){return c[e]},m=0;m<r.length;m++){var b=r[m],f=b.id();l[f]=a?b.outgoers().nodes():b.openNeighborhood().nodes(),u(f,0)}for(var h=function(e){for(var t=r[e].id(),a=[],c={},d={},m={},b=new s((function(e,t){return m[e]-m[t]})),f=0;f<r.length;f++){var h=r[f].id();c[h]=[],d[h]=0,m[h]=1/0}for(d[t]=1,m[t]=0,b.push(t);!b.empty();){var g=b.pop();if(a.push(g),n)for(var j=0;j<l[g].length;j++){var x,v=l[g][j],y=o.getElementById(g);x=y.edgesTo(v).length>0?y.edgesTo(v)[0]:v.edgesTo(y)[0];var O=i(x);v=v.id(),m[v]>m[g]+O&&(m[v]=m[g]+O,b.nodes.indexOf(v)<0?b.push(v):b.updateItem(v),d[v]=0,c[v]=[]),m[v]==m[g]+O&&(d[v]=d[v]+d[g],c[v].push(g))}else for(var E=0;E<l[g].length;E++){var w=l[g][E].id();m[w]==1/0&&(b.push(w),m[w]=m[g]+1),m[w]==m[g]+1&&(d[w]=d[w]+d[g],c[w].push(g))}}for(var M={},S=0;S<r.length;S++)M[r[S].id()]=0;for(;a.length>0;)for(var _=a.pop(),T=0;T<c[_].length;T++){var C=c[_][T];M[C]=M[C]+d[C]/d[_]*(1+M[_]),_!=r[e].id()&&u(_,p(_)+M[_])}},g=0;g<r.length;g++)h(g);var j={betweenness:function(e){var t=o.collection(e).id();return p(t)},betweennessNormalized:function(e){if(0==d)return 0;var t=o.collection(e).id();return p(t)/d}};return j.betweennessNormalised=j.betweennessNormalized,j}};Dt.bc=Dt.betweennessCentrality;var At=fe({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(e){return 1}]}),Lt=function(e,t){for(var a=0,i=0;i<t.length;i++)a+=t[i](e);return a},Rt=function(e,t){for(var a,i=0;i<t;i++){a=0;for(var n=0;n<t;n++)a+=e[n*t+i];for(var s=0;s<t;s++)e[s*t+i]=e[s*t+i]/a}},Nt=function(e,t,a){for(var i=new Array(a*a),n=0;n<a;n++){for(var s=0;s<a;s++)i[n*a+s]=0;for(var o=0;o<a;o++)for(var r=0;r<a;r++)i[n*a+r]+=e[n*a+o]*t[o*a+r]}return i},Pt=function(e,t,a){for(var i=e.slice(0),n=1;n<a;n++)e=Nt(e,i,t);return e},zt=function(e,t,a){for(var i=new Array(t*t),n=0;n<t*t;n++)i[n]=Math.pow(e[n],a);return Rt(i,t),i},Bt=function(e,t,a,i){for(var n=0;n<a;n++)if(Math.round(e[n]*Math.pow(10,i))/Math.pow(10,i)!=Math.round(t[n]*Math.pow(10,i))/Math.pow(10,i))return!1;return!0},Vt=function(e,t){for(var a=0;a<e.length;a++)if(!t[a]||e[a].id()!==t[a].id())return!1;return!0},Jt=function(e){for(var t=this.nodes(),a=this.edges(),i=this.cy(),n=function(e){return At(e)}(e),s={},o=0;o<t.length;o++)s[t[o].id()]=o;for(var r,l=t.length,c=l*l,d=new Array(c),u=0;u<c;u++)d[u]=0;for(var p=0;p<a.length;p++){var m=a[p],b=s[m.source().id()],f=s[m.target().id()],h=Lt(m,n.attributes);d[b*l+f]+=h,d[f*l+b]+=h}!function(e,t,a){for(var i=0;i<t;i++)e[i*t+i]=a}(d,l,n.multFactor),Rt(d,l);for(var g=!0,j=0;g&&j<n.maxIterations;)g=!1,r=Pt(d,l,n.expandFactor),d=zt(r,l,n.inflateFactor),Bt(d,r,c,4)||(g=!0),j++;var x=function(e,t,a,i){for(var n=[],s=0;s<t;s++){for(var o=[],r=0;r<t;r++)Math.round(1e3*e[s*t+r])/1e3>0&&o.push(a[r]);0!==o.length&&n.push(i.collection(o))}return n}(d,l,t,i);return x=function(e){for(var t=0;t<e.length;t++)for(var a=0;a<e.length;a++)t!=a&&Vt(e[t],e[a])&&e.splice(a,1);return e}(x),x},Ut={markovClustering:Jt,mcl:Jt},Gt=function(e){return e},qt=function(e,t){return Math.abs(t-e)},$t=function(e,t,a){return e+qt(t,a)},Wt=function(e,t,a){return e+Math.pow(a-t,2)},Ht=function(e){return Math.sqrt(e)},Yt=function(e,t,a){return Math.max(e,qt(t,a))},Xt=function(e,t,a,i,n){for(var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Gt,o=i,r=0;r<e;r++)o=n(o,t(r),a(r));return s(o)},Qt={euclidean:function(e,t,a){return e>=2?Xt(e,t,a,0,Wt,Ht):Xt(e,t,a,0,$t)},squaredEuclidean:function(e,t,a){return Xt(e,t,a,0,Wt)},manhattan:function(e,t,a){return Xt(e,t,a,0,$t)},max:function(e,t,a){return Xt(e,t,a,-1/0,Yt)}};function Kt(e,t,a,i,n,s){var o;return o=x(e)?e:Qt[e]||Qt.euclidean,0===t&&x(e)?o(n,s):o(t,a,i,n,s)}Qt["squared-euclidean"]=Qt.squaredEuclidean,Qt.squaredeuclidean=Qt.squaredEuclidean;var Zt=fe({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),ea=function(e){return Zt(e)},ta=function(e,t,a,i,n){var s="kMedoids"!==n?function(e){return a[e]}:function(e){return i[e](a)},o=a,r=t;return Kt(e,i.length,s,(function(e){return i[e](t)}),o,r)},aa=function(e,t,a){for(var i=a.length,n=new Array(i),s=new Array(i),o=new Array(t),r=null,l=0;l<i;l++)n[l]=e.min(a[l]).value,s[l]=e.max(a[l]).value;for(var c=0;c<t;c++){r=[];for(var d=0;d<i;d++)r[d]=Math.random()*(s[d]-n[d])+n[d];o[c]=r}return o},ia=function(e,t,a,i,n){for(var s=1/0,o=0,r=0;r<t.length;r++){var l=ta(a,e,t[r],i,n);l<s&&(s=l,o=r)}return o},na=function(e,t,a){for(var i=[],n=null,s=0;s<t.length;s++)a[(n=t[s]).id()]===e&&i.push(n);return i},sa=function(e,t,a){for(var i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++)if(Math.abs(e[i][n]-t[i][n])>a)return!1;return!0},oa=function(e,t,a){for(var i=0;i<a;i++)if(e===t[i])return!0;return!1},ra=function(e,t){var a=new Array(t);if(e.length<50)for(var i=0;i<t;i++){for(var n=e[Math.floor(Math.random()*e.length)];oa(n,a,i);)n=e[Math.floor(Math.random()*e.length)];a[i]=n}else for(var s=0;s<t;s++)a[s]=e[Math.floor(Math.random()*e.length)];return a},la=function(e,t,a){for(var i=0,n=0;n<t.length;n++)i+=ta("manhattan",t[n],e,a,"kMedoids");return i},ca=function(e,t,a,i,n){for(var s,o,r=0;r<t.length;r++)for(var l=0;l<e.length;l++)i[r][l]=Math.pow(a[r][l],n.m);for(var c=0;c<e.length;c++)for(var d=0;d<n.attributes.length;d++){s=0,o=0;for(var u=0;u<t.length;u++)s+=i[u][c]*n.attributes[d](t[u]),o+=i[u][c];e[c][d]=s/o}},da=function(e,t,a,i,n){for(var s=0;s<e.length;s++)t[s]=e[s].slice();for(var o,r,l,c=2/(n.m-1),d=0;d<a.length;d++)for(var u=0;u<i.length;u++){o=0;for(var p=0;p<a.length;p++)r=ta(n.distance,i[u],a[d],n.attributes,"cmeans"),l=ta(n.distance,i[u],a[p],n.attributes,"cmeans"),o+=Math.pow(r/l,c);e[u][d]=1/o}},ua=function(e){var t,a,i,n,s,o=this.cy(),r=this.nodes(),l=ea(e);n=new Array(r.length);for(var c=0;c<r.length;c++)n[c]=new Array(l.k);i=new Array(r.length);for(var d=0;d<r.length;d++)i[d]=new Array(l.k);for(var u=0;u<r.length;u++){for(var p=0,m=0;m<l.k;m++)i[u][m]=Math.random(),p+=i[u][m];for(var b=0;b<l.k;b++)i[u][b]=i[u][b]/p}a=new Array(l.k);for(var f=0;f<l.k;f++)a[f]=new Array(l.attributes.length);s=new Array(r.length);for(var h=0;h<r.length;h++)s[h]=new Array(l.k);for(var g=!0,j=0;g&&j<l.maxIterations;)g=!1,ca(a,r,i,s,l),da(i,n,a,r,l),sa(i,n,l.sensitivityThreshold)||(g=!0),j++;return t=function(e,t,a,i){for(var n,s,o=new Array(a.k),r=0;r<o.length;r++)o[r]=[];for(var l=0;l<t.length;l++){n=-1/0,s=-1;for(var c=0;c<t[0].length;c++)t[l][c]>n&&(n=t[l][c],s=c);o[s].push(e[l])}for(var d=0;d<o.length;d++)o[d]=i.collection(o[d]);return o}(r,i,l,o),{clusters:t,degreeOfMembership:i}},pa={kMeans:function(e){var t,a=this.cy(),i=this.nodes(),n=null,s=ea(e),r=new Array(s.k),l={};t=s.testMode?"number"==typeof s.testCentroids?aa(i,s.k,s.attributes):"object"===o(s.testCentroids)?s.testCentroids:aa(i,s.k,s.attributes):aa(i,s.k,s.attributes);for(var c,d,u,p=!0,m=0;p&&m<s.maxIterations;){for(var b=0;b<i.length;b++)l[(n=i[b]).id()]=ia(n,t,s.distance,s.attributes,"kMeans");p=!1;for(var f=0;f<s.k;f++){var h=na(f,i,l);if(0!==h.length){for(var g=s.attributes.length,j=t[f],x=new Array(g),v=new Array(g),y=0;y<g;y++){v[y]=0;for(var O=0;O<h.length;O++)n=h[O],v[y]+=s.attributes[y](n);x[y]=v[y]/h.length,c=x[y],d=j[y],u=s.sensitivityThreshold,Math.abs(d-c)<=u||(p=!0)}t[f]=x,r[f]=a.collection(h)}}m++}return r},kMedoids:function(e){var t,a,i=this.cy(),n=this.nodes(),s=null,r=ea(e),l=new Array(r.k),c={},d=new Array(r.k);r.testMode?"number"==typeof r.testCentroids||(t="object"===o(r.testCentroids)?r.testCentroids:ra(n,r.k)):t=ra(n,r.k);for(var u=!0,p=0;u&&p<r.maxIterations;){for(var m=0;m<n.length;m++)c[(s=n[m]).id()]=ia(s,t,r.distance,r.attributes,"kMedoids");u=!1;for(var b=0;b<t.length;b++){var f=na(b,n,c);if(0!==f.length){d[b]=la(t[b],f,r.attributes);for(var h=0;h<f.length;h++)(a=la(f[h],f,r.attributes))<d[b]&&(d[b]=a,t[b]=f[h],u=!0);l[b]=i.collection(f)}}p++}return l},fuzzyCMeans:ua,fcm:ua},ma=fe({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),ba={single:"min",complete:"max"},fa=function(e,t,a,i,n){for(var s,o=0,r=1/0,l=n.attributes,c=function(e,t){return Kt(n.distance,l.length,(function(t){return l[t](e)}),(function(e){return l[e](t)}),e,t)},d=0;d<e.length;d++){var u=e[d].key,p=a[u][i[u]];p<r&&(o=u,r=p)}if("threshold"===n.mode&&r>=n.threshold||"dendrogram"===n.mode&&1===e.length)return!1;var m,b=t[o],f=t[i[o]];m="dendrogram"===n.mode?{left:b,right:f,key:b.key}:{value:b.value.concat(f.value),key:b.key},e[b.index]=m,e.splice(f.index,1),t[b.key]=m;for(var h=0;h<e.length;h++){var g=e[h];b.key===g.key?s=1/0:"min"===n.linkage?(s=a[b.key][g.key],a[b.key][g.key]>a[f.key][g.key]&&(s=a[f.key][g.key])):"max"===n.linkage?(s=a[b.key][g.key],a[b.key][g.key]<a[f.key][g.key]&&(s=a[f.key][g.key])):s="mean"===n.linkage?(a[b.key][g.key]*b.size+a[f.key][g.key]*f.size)/(b.size+f.size):"dendrogram"===n.mode?c(g.value,b.value):c(g.value[0],b.value[0]),a[b.key][g.key]=a[g.key][b.key]=s}for(var j=0;j<e.length;j++){var x=e[j].key;if(i[x]===b.key||i[x]===f.key){for(var v=x,y=0;y<e.length;y++){var O=e[y].key;a[x][O]<a[x][v]&&(v=O)}i[x]=v}e[j].index=j}return b.key=f.key=b.index=f.index=null,!0},ha=function e(t,a,i){t&&(t.value?a.push(t.value):(t.left&&e(t.left,a),t.right&&e(t.right,a)))},ga=function e(t,a){if(!t)return"";if(t.left&&t.right){var i=e(t.left,a),n=e(t.right,a),s=a.add({group:"nodes",data:{id:i+","+n}});return a.add({group:"edges",data:{source:i,target:s.id()}}),a.add({group:"edges",data:{source:n,target:s.id()}}),s.id()}return t.value?t.value.id():void 0},ja=function e(t,a,i){if(!t)return[];var n=[],s=[],o=[];return 0===a?(t.left&&ha(t.left,n),t.right&&ha(t.right,s),o=n.concat(s),[i.collection(o)]):1===a?t.value?[i.collection(t.value)]:(t.left&&ha(t.left,n),t.right&&ha(t.right,s),[i.collection(n),i.collection(s)]):t.value?[i.collection(t.value)]:(t.left&&(n=e(t.left,a-1,i)),t.right&&(s=e(t.right,a-1,i)),n.concat(s))},xa=function(e){for(var t=this.cy(),a=this.nodes(),i=function(e){var t=ma(e),a=ba[t.linkage];return null!=a&&(t.linkage=a),t}(e),n=i.attributes,s=function(e,t){return Kt(i.distance,n.length,(function(t){return n[t](e)}),(function(e){return n[e](t)}),e,t)},o=[],r=[],l=[],c=[],d=0;d<a.length;d++){var u={value:"dendrogram"===i.mode?a[d]:[a[d]],key:d,index:d};o[d]=u,c[d]=u,r[d]=[],l[d]=0}for(var p=0;p<o.length;p++)for(var m=0;m<=p;m++){var b;b="dendrogram"===i.mode?p===m?1/0:s(o[p].value,o[m].value):p===m?1/0:s(o[p].value[0],o[m].value[0]),r[p][m]=b,r[m][p]=b,b<r[p][l[p]]&&(l[p]=m)}for(var f,h=fa(o,c,r,l,i);h;)h=fa(o,c,r,l,i);return"dendrogram"===i.mode?(f=ja(o[0],i.dendrogramDepth,t),i.addDendrogram&&ga(o[0],t)):(f=new Array(o.length),o.forEach((function(e,a){e.key=e.index=null,f[a]=t.collection(e.value)}))),f},va={hierarchicalClustering:xa,hca:xa},ya=fe({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),Oa=function(e,t,a,i){var n=function(e,t){return i[t](e)};return-Kt(e,i.length,(function(e){return n(t,e)}),(function(e){return n(a,e)}),t,a)},Ea=function(e,t,a){for(var i=[],n=0;n<e;n++){for(var s=-1,o=-1/0,r=0;r<a.length;r++){var l=a[r];t[n*e+l]>o&&(s=l,o=t[n*e+l])}s>0&&i.push(s)}for(var c=0;c<a.length;c++)i[a[c]]=a[c];return i},wa=function(e){for(var t,a,i,n,s,o,r=this.cy(),l=this.nodes(),c=function(e){var t=e.damping,a=e.preference;.5<=t&&t<1||le("Damping must range on [0.5, 1).  Got: ".concat(t));var i=["median","mean","min","max"];return i.some((function(e){return e===a}))||O(a)||le("Preference must be one of [".concat(i.map((function(e){return"'".concat(e,"'")})).join(", "),"] or a number.  Got: ").concat(a)),ya(e)}(e),d={},u=0;u<l.length;u++)d[l[u].id()]=u;a=(t=l.length)*t,i=new Array(a);for(var p=0;p<a;p++)i[p]=-1/0;for(var m=0;m<t;m++)for(var b=0;b<t;b++)m!==b&&(i[m*t+b]=Oa(c.distance,l[m],l[b],c.attributes));n=function(e,t){var a;return a="median"===t?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];arguments.length>3&&void 0!==arguments[3]&&!arguments[3]?(a<e.length&&e.splice(a,e.length-a),t>0&&e.splice(0,t)):e=e.slice(t,a);for(var s=0,o=e.length-1;o>=0;o--){var r=e[o];n?isFinite(r)||(e[o]=-1/0,s++):e.splice(o,1)}i&&e.sort((function(e,t){return e-t}));var l=e.length,c=Math.floor(l/2);return l%2!=0?e[c+1+s]:(e[c-1+s]+e[c+s])/2}(e):"mean"===t?function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,i=0,n=0,s=t;s<a;s++){var o=e[s];isFinite(o)&&(i+=o,n++)}return i/n}(e):"min"===t?function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,i=1/0,n=t;n<a;n++){var s=e[n];isFinite(s)&&(i=Math.min(s,i))}return i}(e):"max"===t?function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,i=-1/0,n=t;n<a;n++){var s=e[n];isFinite(s)&&(i=Math.max(s,i))}return i}(e):t,a}(i,c.preference);for(var f=0;f<t;f++)i[f*t+f]=n;s=new Array(a);for(var h=0;h<a;h++)s[h]=0;o=new Array(a);for(var g=0;g<a;g++)o[g]=0;for(var j=new Array(t),x=new Array(t),v=new Array(t),y=0;y<t;y++)j[y]=0,x[y]=0,v[y]=0;for(var E,w=new Array(t*c.minIterations),M=0;M<w.length;M++)w[M]=0;for(E=0;E<c.maxIterations;E++){for(var S=0;S<t;S++){for(var _=-1/0,T=-1/0,C=-1,k=0,F=0;F<t;F++)j[F]=s[S*t+F],(k=o[S*t+F]+i[S*t+F])>=_?(T=_,_=k,C=F):k>T&&(T=k);for(var I=0;I<t;I++)s[S*t+I]=(1-c.damping)*(i[S*t+I]-_)+c.damping*j[I];s[S*t+C]=(1-c.damping)*(i[S*t+C]-T)+c.damping*j[C]}for(var D=0;D<t;D++){for(var A=0,L=0;L<t;L++)j[L]=o[L*t+D],x[L]=Math.max(0,s[L*t+D]),A+=x[L];A-=x[D],x[D]=s[D*t+D],A+=x[D];for(var R=0;R<t;R++)o[R*t+D]=(1-c.damping)*Math.min(0,A-x[R])+c.damping*j[R];o[D*t+D]=(1-c.damping)*(A-x[D])+c.damping*j[D]}for(var N=0,P=0;P<t;P++){var z=o[P*t+P]+s[P*t+P]>0?1:0;w[E%c.minIterations*t+P]=z,N+=z}if(N>0&&(E>=c.minIterations-1||E==c.maxIterations-1)){for(var B=0,V=0;V<t;V++){v[V]=0;for(var J=0;J<c.minIterations;J++)v[V]+=w[J*t+V];0!==v[V]&&v[V]!==c.minIterations||B++}if(B===t)break}}for(var U=function(e,t,a){for(var i=[],n=0;n<e;n++)t[n*e+n]+a[n*e+n]>0&&i.push(n);return i}(t,s,o),G=function(e,t,a){for(var i=Ea(e,t,a),n=0;n<a.length;n++){for(var s=[],o=0;o<i.length;o++)i[o]===a[n]&&s.push(o);for(var r=-1,l=-1/0,c=0;c<s.length;c++){for(var d=0,u=0;u<s.length;u++)d+=t[s[u]*e+s[c]];d>l&&(r=c,l=d)}a[n]=s[r]}return Ea(e,t,a)}(t,i,U),q={},$=0;$<U.length;$++)q[U[$]]=[];for(var W=0;W<l.length;W++){var H=G[d[l[W].id()]];null!=H&&q[H].push(l[W])}for(var Y=new Array(U.length),X=0;X<U.length;X++)Y[X]=r.collection(q[U[X]]);return Y},Ma={};[Me,_e,Te,ke,Ie,Ae,Pe,_t,Ct,Ft,Dt,Ut,pa,va,{affinityPropagation:wa,ap:wa}].forEach((function(e){P(Ma,e)}));
/*!
Embeddable Minimum Strictly-Compliant Promises/A+ 1.1.1 Thenable
Copyright (c) 2013-2014 Ralf S. Engelschall (http://engelschall.com)
Licensed under The MIT License (http://opensource.org/licenses/MIT)
*/
var Sa=function e(t){if(!(this instanceof e))return new e(t);this.id="Thenable/1.0.7",this.state=0,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},"function"==typeof t&&t.call(this,this.fulfill.bind(this),this.reject.bind(this))};Sa.prototype={fulfill:function(e){return _a(this,1,"fulfillValue",e)},reject:function(e){return _a(this,2,"rejectReason",e)},then:function(e,t){var a=this,i=new Sa;return a.onFulfilled.push(ka(e,i,"fulfill")),a.onRejected.push(ka(t,i,"reject")),Ta(a),i.proxy}};var _a=function(e,t,a,i){return 0===e.state&&(e.state=t,e[a]=i,Ta(e)),e},Ta=function(e){1===e.state?Ca(e,"onFulfilled",e.fulfillValue):2===e.state&&Ca(e,"onRejected",e.rejectReason)},Ca=function(e,a,i){if(0!==e[a].length){var n=e[a];e[a]=[];var s=function(){for(var e=0;e<n.length;e++)n[e](i)};"function"==typeof t?t(s):setTimeout(s,0)}},ka=function(e,t,a){return function(i){if("function"!=typeof e)t[a].call(t,i);else{var n;try{n=e(i)}catch(e){return void t.reject(e)}Fa(t,n)}}},Fa=function e(t,a){if(t!==a&&t.proxy!==a){var i;if("object"===o(a)&&null!==a||"function"==typeof a)try{i=a.then}catch(e){return void t.reject(e)}if("function"!=typeof i)t.fulfill(a);else{var n=!1;try{i.call(a,(function(i){n||(n=!0,i===a?t.reject(new TypeError("circular thenable chain")):e(t,i))}),(function(e){n||(n=!0,t.reject(e))}))}catch(e){n||t.reject(e)}}}else t.reject(new TypeError("cannot resolve promise with itself"))};Sa.all=function(e){return new Sa((function(t,a){for(var i=new Array(e.length),n=0,s=function(a,s){i[a]=s,++n===e.length&&t(i)},o=0;o<e.length;o++)!function(t){var i=e[t];null!=i&&null!=i.then?i.then((function(e){s(t,e)}),(function(e){a(e)})):s(t,i)}(o)}))},Sa.resolve=function(e){return new Sa((function(t,a){t(e)}))},Sa.reject=function(e){return new Sa((function(t,a){a(e)}))};var Ia="undefined"!=typeof Promise?Promise:Sa,Da=function(e,t,a){var i=_(e),n=!i,s=this._private=P({duration:1e3},t,a);if(s.target=e,s.style=s.style||s.css,s.started=!1,s.playing=!1,s.hooked=!1,s.applying=!1,s.progress=0,s.completes=[],s.frames=[],s.complete&&x(s.complete)&&s.completes.push(s.complete),n){var o=e.position();s.startPosition=s.startPosition||{x:o.x,y:o.y},s.startStyle=s.startStyle||e.cy().style().getAnimationStartStyle(e,s.style)}if(i){var r=e.pan();s.startPan={x:r.x,y:r.y},s.startZoom=e.zoom()}this.length=1,this[0]=this},Aa=Da.prototype;P(Aa,{instanceString:function(){return"animation"},hook:function(){var e=this._private;if(!e.hooked){var t=e.target._private.animation;(e.queue?t.queue:t.current).push(this),w(e.target)&&e.target.cy().addToAnimationPool(e.target),e.hooked=!0}return this},play:function(){var e=this._private;return 1===e.progress&&(e.progress=0),e.playing=!0,e.started=!1,e.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var e=this._private;return e.applying=!0,e.started=!1,e.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var e=this._private;return e.playing=!1,e.started=!1,this},stop:function(){var e=this._private;return e.playing=!1,e.started=!1,e.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(e){var t=this._private;return void 0===e?t.progress*t.duration:this.progress(e/t.duration)},progress:function(e){var t=this._private,a=t.playing;return void 0===e?t.progress:(a&&this.pause(),t.progress=e,t.started=!1,a&&this.play(),this)},completed:function(){return 1===this._private.progress},reverse:function(){var e=this._private,t=e.playing;t&&this.pause(),e.progress=1-e.progress,e.started=!1;var a=function(t,a){var i=e[t];null!=i&&(e[t]=e[a],e[a]=i)};if(a("zoom","startZoom"),a("pan","startPan"),a("position","startPosition"),e.style)for(var i=0;i<e.style.length;i++){var n=e.style[i],s=n.name,o=e.startStyle[s];e.startStyle[s]=n,e.style[i]=o}return t&&this.play(),this},promise:function(e){var t,a=this._private;return t="frame"===e?a.frames:a.completes,new Ia((function(e,a){t.push((function(){e()}))}))}}),Aa.complete=Aa.completed,Aa.run=Aa.play,Aa.running=Aa.playing;var La={animated:function(){return function(){var e=this,t=void 0!==e.length?e:[e];if(!(this._private.cy||this).styleEnabled())return!1;var a=t[0];return a?a._private.animation.current.length>0:void 0}},clearQueue:function(){return function(){var e=this,t=void 0!==e.length?e:[e];if(!(this._private.cy||this).styleEnabled())return this;for(var a=0;a<t.length;a++)t[a]._private.animation.queue=[];return this}},delay:function(){return function(e,t){return(this._private.cy||this).styleEnabled()?this.animate({delay:e,duration:e,complete:t}):this}},delayAnimation:function(){return function(e,t){return(this._private.cy||this).styleEnabled()?this.animation({delay:e,duration:e,complete:t}):this}},animation:function(){return function(e,t){var a=this,i=void 0!==a.length,n=i?a:[a],s=this._private.cy||this,o=!i,r=!o;if(!s.styleEnabled())return this;var l=s.style();if(e=P({},e,t),0===Object.keys(e).length)return new Da(n[0],e);switch(void 0===e.duration&&(e.duration=400),e.duration){case"slow":e.duration=600;break;case"fast":e.duration=200}if(r&&(e.style=l.getPropsList(e.style||e.css),e.css=void 0),r&&null!=e.renderedPosition){var c=e.renderedPosition,d=s.pan(),u=s.zoom();e.position=Be(c,u,d)}if(o&&null!=e.panBy){var p=e.panBy,m=s.pan();e.pan={x:m.x+p.x,y:m.y+p.y}}var b=e.center||e.centre;if(o&&null!=b){var f=s.getCenterPan(b.eles,e.zoom);null!=f&&(e.pan=f)}if(o&&null!=e.fit){var h=e.fit,g=s.getFitViewport(h.eles||h.boundingBox,h.padding);null!=g&&(e.pan=g.pan,e.zoom=g.zoom)}if(o&&y(e.zoom)){var j=s.getZoomedViewport(e.zoom);null!=j&&(j.zoomed&&(e.zoom=j.zoom),j.panned&&(e.pan=j.pan))}return new Da(n[0],e)}},animate:function(){return function(e,t){var a=this,i=void 0!==a.length?a:[a];if(!(this._private.cy||this).styleEnabled())return this;t&&(e=P({},e,t));for(var n=0;n<i.length;n++){var s=i[n],o=s.animated()&&(void 0===e.queue||e.queue);s.animation(e,o?{queue:!0}:void 0).play()}return this}},stop:function(){return function(e,t){var a=this,i=void 0!==a.length?a:[a],n=this._private.cy||this;if(!n.styleEnabled())return this;for(var s=0;s<i.length;s++){for(var o=i[s]._private,r=o.animation.current,l=0;l<r.length;l++){var c=r[l]._private;t&&(c.duration=0)}e&&(o.animation.queue=[]),t||(o.animation.current=[])}return n.notify("draw"),this}}},Ra={data:function(e){return e=P({},{field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(e){},beforeSet:function(e,t){},onSet:function(e){},canSet:function(e){return!0}},e),function(t,a){var i=e,n=this,s=void 0!==n.length,o=s?n:[n],r=s?n[0]:n;if(j(t)){var l;if(i.allowGetting&&void 0===a)return r&&(i.beforeGet(r),l=r._private[i.field][t]),l;if(i.allowSetting&&void 0!==a&&!i.immutableKeys[t]){var c=function(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}({},t,a);i.beforeSet(n,c);for(var d=0,u=o.length;d<u;d++){var p=o[d];i.canSet(p)&&(p._private[i.field][t]=a)}i.updateStyle&&n.updateStyle(),i.onSet(n),i.settingTriggersEvent&&n[i.triggerFnName](i.settingEvent)}}else if(i.allowSetting&&y(t)){var m,b,f=t,h=Object.keys(f);i.beforeSet(n,f);for(var g=0;g<h.length;g++)if(b=f[m=h[g]],!i.immutableKeys[m])for(var v=0;v<o.length;v++){var O=o[v];i.canSet(O)&&(O._private[i.field][m]=b)}i.updateStyle&&n.updateStyle(),i.onSet(n),i.settingTriggersEvent&&n[i.triggerFnName](i.settingEvent)}else if(i.allowBinding&&x(t)){var E=t;n.on(i.bindingEvent,E)}else if(i.allowGetting&&void 0===t){var w;return r&&(i.beforeGet(r),w=r._private[i.field]),w}return n}},removeData:function(e){return e=P({},{field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}},e),function(t){var a=e,i=this,n=void 0!==i.length?i:[i];if(j(t)){for(var s=t.split(/\s+/),o=s.length,r=0;r<o;r++){var l=s[r];if(!C(l)&&!a.immutableKeys[l])for(var c=0,d=n.length;c<d;c++)n[c]._private[a.field][l]=void 0}a.triggerEvent&&i[a.triggerFnName](a.event)}else if(void 0===t){for(var u=0,p=n.length;u<p;u++)for(var m=n[u]._private[a.field],b=Object.keys(m),f=0;f<b.length;f++){var h=b[f];!a.immutableKeys[h]&&(m[h]=void 0)}a.triggerEvent&&i[a.triggerFnName](a.event)}return i}}},Na={eventAliasesOn:function(e){var t=e;t.addListener=t.listen=t.bind=t.on,t.unlisten=t.unbind=t.off=t.removeListener,t.trigger=t.emit,t.pon=t.promiseOn=function(e,t){var a=this,i=Array.prototype.slice.call(arguments,0);return new Ia((function(e,t){var n=i.concat([function(t){a.off.apply(a,s),e(t)}]),s=n.concat([]);a.on.apply(a,n)}))}}},Pa={};[La,Ra,Na].forEach((function(e){P(Pa,e)}));var za={animate:Pa.animate(),animation:Pa.animation(),animated:Pa.animated(),clearQueue:Pa.clearQueue(),delay:Pa.delay(),delayAnimation:Pa.delayAnimation(),stop:Pa.stop()},Ba={classes:function(e){var t=this;if(void 0===e){var a=[];return t[0]._private.classes.forEach((function(e){return a.push(e)})),a}v(e)||(e=(e||"").match(/\S+/g)||[]);for(var i=[],n=new Oe(e),s=0;s<t.length;s++){for(var o=t[s],r=o._private,l=r.classes,c=!1,d=0;d<e.length;d++){var u=e[d];if(!l.has(u)){c=!0;break}}c||(c=l.size!==e.length),c&&(r.classes=n,i.push(o))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),t},addClass:function(e){return this.toggleClass(e,!0)},hasClass:function(e){var t=this[0];return null!=t&&t._private.classes.has(e)},toggleClass:function(e,t){v(e)||(e=e.match(/\S+/g)||[]);for(var a=this,i=void 0===t,n=[],s=0,o=a.length;s<o;s++)for(var r=a[s],l=r._private.classes,c=!1,d=0;d<e.length;d++){var u=e[d],p=l.has(u),m=!1;t||i&&!p?(l.add(u),m=!0):(!t||i&&p)&&(l.delete(u),m=!0),!c&&m&&(n.push(r),c=!0)}return n.length>0&&this.spawn(n).updateStyle().emit("class"),a},removeClass:function(e){return this.toggleClass(e,!1)},flashClass:function(e,t){var a=this;if(null==t)t=250;else if(0===t)return a;return a.addClass(e),setTimeout((function(){a.removeClass(e)}),t),a}};Ba.className=Ba.classNames=Ba.classes;var Va={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:"\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'",number:R,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};Va.variable="(?:[\\w-]|(?:\\\\"+Va.metaChar+"))+",Va.value=Va.string+"|"+Va.number,Va.className=Va.variable,Va.id=Va.variable,function(){var e,t,a;for(e=Va.comparatorOp.split("|"),a=0;a<e.length;a++)t=e[a],Va.comparatorOp+="|@"+t;for(e=Va.comparatorOp.split("|"),a=0;a<e.length;a++)(t=e[a]).indexOf("!")>=0||"="!==t&&(Va.comparatorOp+="|\\!"+t)}();var Ja=20,Ua=[{selector:":selected",matches:function(e){return e.selected()}},{selector:":unselected",matches:function(e){return!e.selected()}},{selector:":selectable",matches:function(e){return e.selectable()}},{selector:":unselectable",matches:function(e){return!e.selectable()}},{selector:":locked",matches:function(e){return e.locked()}},{selector:":unlocked",matches:function(e){return!e.locked()}},{selector:":visible",matches:function(e){return e.visible()}},{selector:":hidden",matches:function(e){return!e.visible()}},{selector:":transparent",matches:function(e){return e.transparent()}},{selector:":grabbed",matches:function(e){return e.grabbed()}},{selector:":free",matches:function(e){return!e.grabbed()}},{selector:":removed",matches:function(e){return e.removed()}},{selector:":inside",matches:function(e){return!e.removed()}},{selector:":grabbable",matches:function(e){return e.grabbable()}},{selector:":ungrabbable",matches:function(e){return!e.grabbable()}},{selector:":animated",matches:function(e){return e.animated()}},{selector:":unanimated",matches:function(e){return!e.animated()}},{selector:":parent",matches:function(e){return e.isParent()}},{selector:":childless",matches:function(e){return e.isChildless()}},{selector:":child",matches:function(e){return e.isChild()}},{selector:":orphan",matches:function(e){return e.isOrphan()}},{selector:":nonorphan",matches:function(e){return e.isChild()}},{selector:":compound",matches:function(e){return e.isNode()?e.isParent():e.source().isParent()||e.target().isParent()}},{selector:":loop",matches:function(e){return e.isLoop()}},{selector:":simple",matches:function(e){return e.isSimple()}},{selector:":active",matches:function(e){return e.active()}},{selector:":inactive",matches:function(e){return!e.active()}},{selector:":backgrounding",matches:function(e){return e.backgrounding()}},{selector:":nonbackgrounding",matches:function(e){return!e.backgrounding()}}].sort((function(e,t){return function(e,t){return-1*N(e,t)}(e.selector,t.selector)})),Ga=function(){for(var e,t={},a=0;a<Ua.length;a++)t[(e=Ua[a]).selector]=e.matches;return t}(),qa="("+Ua.map((function(e){return e.selector})).join("|")+")",$a=function(e){return e.replace(new RegExp("\\\\("+Va.metaChar+")","g"),(function(e,t){return t}))},Wa=function(e,t,a){e[e.length-1]=a},Ha=[{name:"group",query:!0,regex:"("+Va.group+")",populate:function(e,t,a){var i=d(a,1)[0];t.checks.push({type:0,value:"*"===i?i:i+"s"})}},{name:"state",query:!0,regex:qa,populate:function(e,t,a){var i=d(a,1)[0];t.checks.push({type:7,value:i})}},{name:"id",query:!0,regex:"\\#("+Va.id+")",populate:function(e,t,a){var i=d(a,1)[0];t.checks.push({type:8,value:$a(i)})}},{name:"className",query:!0,regex:"\\.("+Va.className+")",populate:function(e,t,a){var i=d(a,1)[0];t.checks.push({type:9,value:$a(i)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+Va.variable+")\\s*\\]",populate:function(e,t,a){var i=d(a,1)[0];t.checks.push({type:4,field:$a(i)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+Va.variable+")\\s*("+Va.comparatorOp+")\\s*("+Va.value+")\\s*\\]",populate:function(e,t,a){var i=d(a,3),n=i[0],s=i[1],o=i[2];o=null!=new RegExp("^"+Va.string+"$").exec(o)?o.substring(1,o.length-1):parseFloat(o),t.checks.push({type:3,field:$a(n),operator:s,value:o})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+Va.boolOp+")\\s*("+Va.variable+")\\s*\\]",populate:function(e,t,a){var i=d(a,2),n=i[0],s=i[1];t.checks.push({type:5,field:$a(s),operator:n})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+Va.meta+")\\s*("+Va.comparatorOp+")\\s*("+Va.number+")\\s*\\]\\]",populate:function(e,t,a){var i=d(a,3),n=i[0],s=i[1],o=i[2];t.checks.push({type:6,field:$a(n),operator:s,value:parseFloat(o)})}},{name:"nextQuery",separator:!0,regex:Va.separator,populate:function(e,t){var a=e.currentSubject,i=e.edgeCount,n=e.compoundCount,s=e[e.length-1];return null!=a&&(s.subject=a,e.currentSubject=null),s.edgeCount=i,s.compoundCount=n,e.edgeCount=0,e.compoundCount=0,e[e.length++]={checks:[]}}},{name:"directedEdge",separator:!0,regex:Va.directedEdge,populate:function(e,t){if(null==e.currentSubject){var a={checks:[]},i=t,n={checks:[]};return a.checks.push({type:11,source:i,target:n}),Wa(e,0,a),e.edgeCount++,n}var s={checks:[]},o=t,r={checks:[]};return s.checks.push({type:12,source:o,target:r}),Wa(e,0,s),e.edgeCount++,r}},{name:"undirectedEdge",separator:!0,regex:Va.undirectedEdge,populate:function(e,t){if(null==e.currentSubject){var a={checks:[]},i=t,n={checks:[]};return a.checks.push({type:10,nodes:[i,n]}),Wa(e,0,a),e.edgeCount++,n}var s={checks:[]},o=t,r={checks:[]};return s.checks.push({type:14,node:o,neighbor:r}),Wa(e,0,s),r}},{name:"child",separator:!0,regex:Va.child,populate:function(e,t){if(null==e.currentSubject){var a={checks:[]},i={checks:[]},n=e[e.length-1];return a.checks.push({type:15,parent:n,child:i}),Wa(e,0,a),e.compoundCount++,i}if(e.currentSubject===t){var s={checks:[]},o=e[e.length-1],r={checks:[]},l={checks:[]},c={checks:[]},d={checks:[]};return s.checks.push({type:19,left:o,right:r,subject:l}),l.checks=t.checks,t.checks=[{type:Ja}],d.checks.push({type:Ja}),r.checks.push({type:17,parent:d,child:c}),Wa(e,0,s),e.currentSubject=l,e.compoundCount++,c}var u={checks:[]},p={checks:[]},m=[{type:17,parent:u,child:p}];return u.checks=t.checks,t.checks=m,e.compoundCount++,p}},{name:"descendant",separator:!0,regex:Va.descendant,populate:function(e,t){if(null==e.currentSubject){var a={checks:[]},i={checks:[]},n=e[e.length-1];return a.checks.push({type:16,ancestor:n,descendant:i}),Wa(e,0,a),e.compoundCount++,i}if(e.currentSubject===t){var s={checks:[]},o=e[e.length-1],r={checks:[]},l={checks:[]},c={checks:[]},d={checks:[]};return s.checks.push({type:19,left:o,right:r,subject:l}),l.checks=t.checks,t.checks=[{type:Ja}],d.checks.push({type:Ja}),r.checks.push({type:18,ancestor:d,descendant:c}),Wa(e,0,s),e.currentSubject=l,e.compoundCount++,c}var u={checks:[]},p={checks:[]},m=[{type:18,ancestor:u,descendant:p}];return u.checks=t.checks,t.checks=m,e.compoundCount++,p}},{name:"subject",modifier:!0,regex:Va.subject,populate:function(e,t){if(null!=e.currentSubject&&e.currentSubject!==t)return de("Redefinition of subject in selector `"+e.toString()+"`"),!1;e.currentSubject=t;var a=e[e.length-1].checks[0],i=null==a?null:a.type;11===i?a.type=13:10===i&&(a.type=14,a.node=a.nodes[1],a.neighbor=a.nodes[0],a.nodes=null)}}];Ha.forEach((function(e){return e.regexObj=new RegExp("^"+e.regex)}));var Ya=function(e){for(var t,a,i,n=0;n<Ha.length;n++){var s=Ha[n],o=s.name,r=e.match(s.regexObj);if(null!=r){a=r,t=s,i=o;var l=r[0];e=e.substring(l.length);break}}return{expr:t,match:a,name:i,remaining:e}},Xa={parse:function(e){var t=this,a=t.inputText=e,i=t[0]={checks:[]};for(t.length=1,a=function(e){var t=e.match(/^\s+/);if(t){var a=t[0];e=e.substring(a.length)}return e}(a);;){var n=Ya(a);if(null==n.expr)return de("The selector `"+e+"`is invalid"),!1;var s=n.match.slice(1),o=n.expr.populate(t,i,s);if(!1===o)return!1;if(null!=o&&(i=o),(a=n.remaining).match(/^\s*$/))break}var r=t[t.length-1];null!=t.currentSubject&&(r.subject=t.currentSubject),r.edgeCount=t.edgeCount,r.compoundCount=t.compoundCount;for(var l=0;l<t.length;l++){var c=t[l];if(c.compoundCount>0&&c.edgeCount>0)return de("The selector `"+e+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(c.edgeCount>1)return de("The selector `"+e+"` is invalid because it uses multiple edge selectors"),!1;1===c.edgeCount&&de("The selector `"+e+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},toString:function(){if(null!=this.toStringCache)return this.toStringCache;for(var e=function(e){return null==e?"":e},t=function(t){return j(t)?'"'+t+'"':e(t)},a=function(e){return" "+e+" "},i=function(n,s){return n.checks.reduce((function(o,r,l){return o+(s===n&&0===l?"$":"")+function(n,s){var o=n.type,r=n.value;switch(o){case 0:var l=e(r);return l.substring(0,l.length-1);case 3:var c=n.field,d=n.operator;return"["+c+a(e(d))+t(r)+"]";case 5:var u=n.operator,p=n.field;return"["+e(u)+p+"]";case 4:return"["+n.field+"]";case 6:var m=n.operator;return"[["+n.field+a(e(m))+t(r)+"]]";case 7:return r;case 8:return"#"+r;case 9:return"."+r;case 17:case 15:return i(n.parent,s)+a(">")+i(n.child,s);case 18:case 16:return i(n.ancestor,s)+" "+i(n.descendant,s);case 19:var b=i(n.left,s),f=i(n.subject,s),h=i(n.right,s);return b+(b.length>0?" ":"")+f+h;case Ja:return""}}(r,s)}),"")},n="",s=0;s<this.length;s++){var o=this[s];n+=i(o,o.subject),this.length>1&&s<this.length-1&&(n+=", ")}return this.toStringCache=n,n}},Qa=function(e,t,a){var i,n,s,o=j(e),r=O(e),l=j(a),c=!1,d=!1,u=!1;switch(t.indexOf("!")>=0&&(t=t.replace("!",""),d=!0),t.indexOf("@")>=0&&(t=t.replace("@",""),c=!0),(o||l||c)&&(n=o||r?""+e:"",s=""+a),c&&(e=n=n.toLowerCase(),a=s=s.toLowerCase()),t){case"*=":i=n.indexOf(s)>=0;break;case"$=":i=n.indexOf(s,n.length-s.length)>=0;break;case"^=":i=0===n.indexOf(s);break;case"=":i=e===a;break;case">":u=!0,i=e>a;break;case">=":u=!0,i=e>=a;break;case"<":u=!0,i=e<a;break;case"<=":u=!0,i=e<=a;break;default:i=!1}return!d||null==e&&u||(i=!i),i},Ka=function(e,t){return e.data(t)},Za=[],ei=function(e,t){return e.checks.every((function(e){return Za[e.type](e,t)}))};Za[0]=function(e,t){var a=e.value;return"*"===a||a===t.group()},Za[7]=function(e,t){return function(e,t){return Ga[e](t)}(e.value,t)},Za[8]=function(e,t){var a=e.value;return t.id()===a},Za[9]=function(e,t){var a=e.value;return t.hasClass(a)},Za[6]=function(e,t){var a=e.field,i=e.operator,n=e.value;return Qa(function(e,t){return e[t]()}(t,a),i,n)},Za[3]=function(e,t){var a=e.field,i=e.operator,n=e.value;return Qa(Ka(t,a),i,n)},Za[5]=function(e,t){var a=e.field,i=e.operator;return function(e,t){switch(t){case"?":return!!e;case"!":return!e;case"^":return void 0===e}}(Ka(t,a),i)},Za[4]=function(e,t){var a=e.field;return e.operator,void 0!==Ka(t,a)},Za[10]=function(e,t){var a=e.nodes[0],i=e.nodes[1],n=t.source(),s=t.target();return ei(a,n)&&ei(i,s)||ei(i,n)&&ei(a,s)},Za[14]=function(e,t){return ei(e.node,t)&&t.neighborhood().some((function(t){return t.isNode()&&ei(e.neighbor,t)}))},Za[11]=function(e,t){return ei(e.source,t.source())&&ei(e.target,t.target())},Za[12]=function(e,t){return ei(e.source,t)&&t.outgoers().some((function(t){return t.isNode()&&ei(e.target,t)}))},Za[13]=function(e,t){return ei(e.target,t)&&t.incomers().some((function(t){return t.isNode()&&ei(e.source,t)}))},Za[15]=function(e,t){return ei(e.child,t)&&ei(e.parent,t.parent())},Za[17]=function(e,t){return ei(e.parent,t)&&t.children().some((function(t){return ei(e.child,t)}))},Za[16]=function(e,t){return ei(e.descendant,t)&&t.ancestors().some((function(t){return ei(e.ancestor,t)}))},Za[18]=function(e,t){return ei(e.ancestor,t)&&t.descendants().some((function(t){return ei(e.descendant,t)}))},Za[19]=function(e,t){return ei(e.subject,t)&&ei(e.left,t)&&ei(e.right,t)},Za[20]=function(){return!0},Za[1]=function(e,t){return e.value.has(t)},Za[2]=function(e,t){return(0,e.value)(t)};var ti={matches:function(e){for(var t=0;t<this.length;t++){var a=this[t];if(ei(a,e))return!0}return!1},filter:function(e){var t=this;if(1===t.length&&1===t[0].checks.length&&8===t[0].checks[0].type)return e.getElementById(t[0].checks[0].value).collection();var a=function(e){for(var a=0;a<t.length;a++){var i=t[a];if(ei(i,e))return!0}return!1};return null==t.text()&&(a=function(){return!0}),e.filter(a)}},ai=function(e){this.inputText=e,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,null==e||j(e)&&e.match(/^\s*$/)||(w(e)?this.addQuery({checks:[{type:1,value:e.collection()}]}):x(e)?this.addQuery({checks:[{type:2,value:e}]}):j(e)?this.parse(e)||(this.invalid=!0):le("A selector must be created from a string; found "))},ii=ai.prototype;[Xa,ti].forEach((function(e){return P(ii,e)})),ii.text=function(){return this.inputText},ii.size=function(){return this.length},ii.eq=function(e){return this[e]},ii.sameText=function(e){return!this.invalid&&!e.invalid&&this.text()===e.text()},ii.addQuery=function(e){this[this.length++]=e},ii.selector=ii.toString;var ni={allAre:function(e){var t=new ai(e);return this.every((function(e){return t.matches(e)}))},is:function(e){var t=new ai(e);return this.some((function(e){return t.matches(e)}))},some:function(e,t){for(var a=0;a<this.length;a++)if(t?e.apply(t,[this[a],a,this]):e(this[a],a,this))return!0;return!1},every:function(e,t){for(var a=0;a<this.length;a++)if(!(t?e.apply(t,[this[a],a,this]):e(this[a],a,this)))return!1;return!0},same:function(e){if(this===e)return!0;e=this.cy().collection(e);var t=this.length;return t===e.length&&(1===t?this[0]===e[0]:this.every((function(t){return e.hasElementWithId(t.id())})))},anySame:function(e){return e=this.cy().collection(e),this.some((function(t){return e.hasElementWithId(t.id())}))},allAreNeighbors:function(e){e=this.cy().collection(e);var t=this.neighborhood();return e.every((function(e){return t.hasElementWithId(e.id())}))},contains:function(e){e=this.cy().collection(e);var t=this;return e.every((function(e){return t.hasElementWithId(e.id())}))}};ni.allAreNeighbours=ni.allAreNeighbors,ni.has=ni.contains,ni.equal=ni.equals=ni.same;var si,oi,ri=function(e,t){return function(a,i,n,s){var o,r=a,l=this;if(null==r?o="":w(r)&&1===r.length&&(o=r.id()),1===l.length&&o){var c=l[0]._private,d=c.traversalCache=c.traversalCache||{},u=d[t]=d[t]||[],p=Q(o);return u[p]||(u[p]=e.call(l,a,i,n,s))}return e.call(l,a,i,n,s)}},li={parent:function(e){var t=[];if(1===this.length){var a=this[0]._private.parent;if(a)return a}for(var i=0;i<this.length;i++){var n=this[i]._private.parent;n&&t.push(n)}return this.spawn(t,{unique:!0}).filter(e)},parents:function(e){for(var t=[],a=this.parent();a.nonempty();){for(var i=0;i<a.length;i++){var n=a[i];t.push(n)}a=a.parent()}return this.spawn(t,{unique:!0}).filter(e)},commonAncestors:function(e){for(var t,a=0;a<this.length;a++){var i=this[a].parents();t=(t=t||i).intersect(i)}return t.filter(e)},orphans:function(e){return this.stdFilter((function(e){return e.isOrphan()})).filter(e)},nonorphans:function(e){return this.stdFilter((function(e){return e.isChild()})).filter(e)},children:ri((function(e){for(var t=[],a=0;a<this.length;a++)for(var i=this[a]._private.children,n=0;n<i.length;n++)t.push(i[n]);return this.spawn(t,{unique:!0}).filter(e)}),"children"),siblings:function(e){return this.parent().children().not(this).filter(e)},isParent:function(){var e=this[0];if(e)return e.isNode()&&0!==e._private.children.length},isChildless:function(){var e=this[0];if(e)return e.isNode()&&0===e._private.children.length},isChild:function(){var e=this[0];if(e)return e.isNode()&&null!=e._private.parent},isOrphan:function(){var e=this[0];if(e)return e.isNode()&&null==e._private.parent},descendants:function(e){var t=[];return function e(a){for(var i=0;i<a.length;i++){var n=a[i];t.push(n),n.children().nonempty()&&e(n.children())}}(this.children()),this.spawn(t,{unique:!0}).filter(e)}};function ci(e,t,a,i){for(var n=[],s=new Oe,o=e.cy().hasCompoundNodes(),r=0;r<e.length;r++){var l=e[r];a?n.push(l):o&&i(n,s,l)}for(;n.length>0;){var c=n.shift();t(c),s.add(c.id()),o&&i(n,s,c)}return e}function di(e,t,a){if(a.isParent())for(var i=a._private.children,n=0;n<i.length;n++){var s=i[n];t.has(s.id())||e.push(s)}}function ui(e,t,a){if(a.isChild()){var i=a._private.parent;t.has(i.id())||e.push(i)}}function pi(e,t,a){ui(e,t,a),di(e,t,a)}li.forEachDown=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ci(this,e,t,di)},li.forEachUp=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ci(this,e,t,ui)},li.forEachUpAndDown=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ci(this,e,t,pi)},li.ancestors=li.parents,(si=oi={data:Pa.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:Pa.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:Pa.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:Pa.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:Pa.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:Pa.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var e=this[0];if(e)return e._private.data.id}}).attr=si.data,si.removeAttr=si.removeData;var mi,bi,fi=oi,hi={};function gi(e){return function(t){var a=this;if(void 0===t&&(t=!0),0!==a.length&&a.isNode()&&!a.removed()){for(var i=0,n=a[0],s=n._private.edges,o=0;o<s.length;o++){var r=s[o];!t&&r.isLoop()||(i+=e(n,r))}return i}}}function ji(e,t){return function(a){for(var i,n=this.nodes(),s=0;s<n.length;s++){var o=n[s][e](a);void 0===o||void 0!==i&&!t(o,i)||(i=o)}return i}}P(hi,{degree:gi((function(e,t){return t.source().same(t.target())?2:1})),indegree:gi((function(e,t){return t.target().same(e)?1:0})),outdegree:gi((function(e,t){return t.source().same(e)?1:0}))}),P(hi,{minDegree:ji("degree",(function(e,t){return e<t})),maxDegree:ji("degree",(function(e,t){return e>t})),minIndegree:ji("indegree",(function(e,t){return e<t})),maxIndegree:ji("indegree",(function(e,t){return e>t})),minOutdegree:ji("outdegree",(function(e,t){return e<t})),maxOutdegree:ji("outdegree",(function(e,t){return e>t}))}),P(hi,{totalDegree:function(e){for(var t=0,a=this.nodes(),i=0;i<a.length;i++)t+=a[i].degree(e);return t}});var xi=function(e,t,a){for(var i=0;i<e.length;i++){var n=e[i];if(!n.locked()){var s=n._private.position,o={x:null!=t.x?t.x-s.x:0,y:null!=t.y?t.y-s.y:0};!n.isParent()||0===o.x&&0===o.y||n.children().shift(o,a),n.shiftCachedBoundingBox(o)}}},vi={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(e){e.updateCompoundBounds()},beforeSet:function(e,t){xi(e,t,!1)},onSet:function(e){e.dirtyCompoundBoundsCache()},canSet:function(e){return!e.locked()}};mi=bi={position:Pa.data(vi),silentPosition:Pa.data(P({},vi,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(e,t){xi(e,t,!0)}})),positions:function(e,t){if(y(e))t?this.silentPosition(e):this.position(e);else if(x(e)){var a=e,i=this.cy();i.startBatch();for(var n=0;n<this.length;n++){var s,o=this[n];(s=a(o,n))&&(t?o.silentPosition(s):o.position(s))}i.endBatch()}return this},silentPositions:function(e){return this.positions(e,!0)},shift:function(e,t,a){var i;if(y(e)?(i={x:O(e.x)?e.x:0,y:O(e.y)?e.y:0},a=t):j(e)&&O(t)&&((i={x:0,y:0})[e]=t),null!=i){var n=this.cy();n.startBatch();for(var s=0;s<this.length;s++){var o=this[s],r=o.position(),l={x:r.x+i.x,y:r.y+i.y};a?o.silentPosition(l):o.position(l)}n.endBatch()}return this},silentShift:function(e,t){return y(e)?this.shift(e,!0):j(e)&&O(t)&&this.shift(e,t,!0),this},renderedPosition:function(e,t){var a=this[0],i=this.cy(),n=i.zoom(),s=i.pan(),o=y(e)?e:void 0,r=void 0!==o||void 0!==t&&j(e);if(a&&a.isNode()){if(!r){var l=a.position();return o=ze(l,n,s),void 0===e?o:o[e]}for(var c=0;c<this.length;c++){var d=this[c];void 0!==t?d.position(e,(t-s[e])/n):void 0!==o&&d.position(Be(o,n,s))}}else if(!r)return;return this},relativePosition:function(e,t){var a=this[0],i=this.cy(),n=y(e)?e:void 0,s=void 0!==n||void 0!==t&&j(e),o=i.hasCompoundNodes();if(a&&a.isNode()){if(!s){var r=a.position(),l=o?a.parent():null,c=l&&l.length>0,d=c;c&&(l=l[0]);var u=d?l.position():{x:0,y:0};return n={x:r.x-u.x,y:r.y-u.y},void 0===e?n:n[e]}for(var p=0;p<this.length;p++){var m=this[p],b=o?m.parent():null,f=b&&b.length>0,h=f;f&&(b=b[0]);var g=h?b.position():{x:0,y:0};void 0!==t?m.position(e,t+g[e]):void 0!==n&&m.position({x:n.x+g.x,y:n.y+g.y})}}else if(!s)return;return this}},mi.modelPosition=mi.point=mi.position,mi.modelPositions=mi.points=mi.positions,mi.renderedPoint=mi.renderedPosition,mi.relativePoint=mi.relativePosition;var yi,Oi,Ei=bi;yi=Oi={},Oi.renderedBoundingBox=function(e){var t=this.boundingBox(e),a=this.cy(),i=a.zoom(),n=a.pan(),s=t.x1*i+n.x,o=t.x2*i+n.x,r=t.y1*i+n.y,l=t.y2*i+n.y;return{x1:s,x2:o,y1:r,y2:l,w:o-s,h:l-r}},Oi.dirtyCompoundBoundsCache=function(){var e=this.cy();return e.styleEnabled()&&e.hasCompoundNodes()?(this.forEachUp((function(e){if(e.isParent()){var t=e._private;t.compoundBoundsClean=!1,t.bbCache=null,e.emitAndNotify("bounds")}})),this):this},Oi.updateCompoundBounds=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.cy();if(!t.styleEnabled()||!t.hasCompoundNodes())return this;if(!e&&t.batching())return this;function a(e){if(e.isParent()){var t=e._private,a=e.children(),i="include"===e.pstyle("compound-sizing-wrt-labels").value,n={width:{val:e.pstyle("min-width").pfValue,left:e.pstyle("min-width-bias-left"),right:e.pstyle("min-width-bias-right")},height:{val:e.pstyle("min-height").pfValue,top:e.pstyle("min-height-bias-top"),bottom:e.pstyle("min-height-bias-bottom")}},s=a.boundingBox({includeLabels:i,includeOverlays:!1,useCache:!1}),o=t.position;0!==s.w&&0!==s.h||((s={w:e.pstyle("width").pfValue,h:e.pstyle("height").pfValue}).x1=o.x-s.w/2,s.x2=o.x+s.w/2,s.y1=o.y-s.h/2,s.y2=o.y+s.h/2);var r=n.width.left.value;"px"===n.width.left.units&&n.width.val>0&&(r=100*r/n.width.val);var l=n.width.right.value;"px"===n.width.right.units&&n.width.val>0&&(l=100*l/n.width.val);var c=n.height.top.value;"px"===n.height.top.units&&n.height.val>0&&(c=100*c/n.height.val);var d=n.height.bottom.value;"px"===n.height.bottom.units&&n.height.val>0&&(d=100*d/n.height.val);var u=g(n.width.val-s.w,r,l),p=u.biasDiff,m=u.biasComplementDiff,b=g(n.height.val-s.h,c,d),f=b.biasDiff,h=b.biasComplementDiff;t.autoPadding=function(e,t,a,i){if("%"!==a.units)return"px"===a.units?a.pfValue:0;switch(i){case"width":return e>0?a.pfValue*e:0;case"height":return t>0?a.pfValue*t:0;case"average":return e>0&&t>0?a.pfValue*(e+t)/2:0;case"min":return e>0&&t>0?e>t?a.pfValue*t:a.pfValue*e:0;case"max":return e>0&&t>0?e>t?a.pfValue*e:a.pfValue*t:0;default:return 0}}(s.w,s.h,e.pstyle("padding"),e.pstyle("padding-relative-to").value),t.autoWidth=Math.max(s.w,n.width.val),o.x=(-p+s.x1+s.x2+m)/2,t.autoHeight=Math.max(s.h,n.height.val),o.y=(-f+s.y1+s.y2+h)/2}function g(e,t,a){var i=0,n=0,s=t+a;return e>0&&s>0&&(i=t/s*e,n=a/s*e),{biasDiff:i,biasComplementDiff:n}}}for(var i=0;i<this.length;i++){var n=this[i],s=n._private;s.compoundBoundsClean||(a(n),t.batching()||(s.compoundBoundsClean=!0))}return this};var wi=function(e){return e===1/0||e===-1/0?0:e},Mi=function(e,t,a,i,n){i-t!=0&&n-a!=0&&null!=t&&null!=a&&null!=i&&null!=n&&(e.x1=t<e.x1?t:e.x1,e.x2=i>e.x2?i:e.x2,e.y1=a<e.y1?a:e.y1,e.y2=n>e.y2?n:e.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1)},Si=function(e,t){return null==t?e:Mi(e,t.x1,t.y1,t.x2,t.y2)},_i=function(e,t,a){return je(e,t,a)},Ti=function(e,t,a){if(!t.cy().headless()){var i,n,s=t._private,o=s.rstyle,r=o.arrowWidth/2;if("none"!==t.pstyle(a+"-arrow-shape").value){"source"===a?(i=o.srcX,n=o.srcY):"target"===a?(i=o.tgtX,n=o.tgtY):(i=o.midX,n=o.midY);var l=s.arrowBounds=s.arrowBounds||{},c=l[a]=l[a]||{};c.x1=i-r,c.y1=n-r,c.x2=i+r,c.y2=n+r,c.w=c.x2-c.x1,c.h=c.y2-c.y1,Ze(c,1),Mi(e,c.x1,c.y1,c.x2,c.y2)}}},Ci=function(e,t,a){if(!t.cy().headless()){var i;i=a?a+"-":"";var n=t._private,s=n.rstyle;if(t.pstyle(i+"label").strValue){var o,r,l,c,d=t.pstyle("text-halign"),u=t.pstyle("text-valign"),p=_i(s,"labelWidth",a),m=_i(s,"labelHeight",a),b=_i(s,"labelX",a),f=_i(s,"labelY",a),h=t.pstyle(i+"text-margin-x").pfValue,g=t.pstyle(i+"text-margin-y").pfValue,j=t.isEdge(),x=t.pstyle(i+"text-rotation"),v=t.pstyle("text-outline-width").pfValue,y=t.pstyle("text-border-width").pfValue/2,O=t.pstyle("text-background-padding").pfValue,E=m,w=p,M=w/2,S=E/2;if(j)o=b-M,r=b+M,l=f-S,c=f+S;else{switch(d.value){case"left":o=b-w,r=b;break;case"center":o=b-M,r=b+M;break;case"right":o=b,r=b+w}switch(u.value){case"top":l=f-E,c=f;break;case"center":l=f-S,c=f+S;break;case"bottom":l=f,c=f+E}}o+=h-Math.max(v,y)-O,r+=h+Math.max(v,y)+O,l+=g-Math.max(v,y)-O,c+=g+Math.max(v,y)+O;var _=a||"main",T=n.labelBounds,C=T[_]=T[_]||{};C.x1=o,C.y1=l,C.x2=r,C.y2=c,C.w=r-o,C.h=c-l,Ze(C,1);var k=j&&"autorotate"===x.strValue,F=null!=x.pfValue&&0!==x.pfValue;if(k||F){var I=k?_i(n.rstyle,"labelAngle",a):x.pfValue,D=Math.cos(I),A=Math.sin(I),L=(o+r)/2,R=(l+c)/2;if(!j){switch(d.value){case"left":L=r;break;case"right":L=o}switch(u.value){case"top":R=c;break;case"bottom":R=l}}var N=function(e,t){return{x:(e-=L)*D-(t-=R)*A+L,y:e*A+t*D+R}},P=N(o,l),z=N(o,c),B=N(r,l),V=N(r,c);o=Math.min(P.x,z.x,B.x,V.x),r=Math.max(P.x,z.x,B.x,V.x),l=Math.min(P.y,z.y,B.y,V.y),c=Math.max(P.y,z.y,B.y,V.y)}Mi(e,o,l,r,c),Mi(n.labelBounds.all,o,l,r,c)}return e}},ki=function(e){var t=0,a=function(e){return(e?1:0)<<t++},i=0;return i+=a(e.incudeNodes),i+=a(e.includeEdges),i+=a(e.includeLabels),i+=a(e.includeMainLabels),i+=a(e.includeSourceLabels),(i+=a(e.includeTargetLabels))+a(e.includeOverlays)},Fi=function(e){if(e.isEdge()){var t=e.source().position(),a=e.target().position(),i=function(e){return Math.round(e)};return X([i(t.x),i(t.y),i(a.x),i(a.y)])}return 0},Ii=function(e,t){var a,i=e._private,n=e.isEdge(),s=(null==t?Ai:ki(t))===Ai,o=Fi(e),r=i.bbCachePosKey===o,l=!(t.useCache&&r)||null==i.bbCache;if(l?(r||e.recalculateRenderedStyle(),a=function(e,t){var a,i,n,s,o,r,l,c=e._private.cy,d=c.styleEnabled(),u=c.headless(),p=Qe(),m=e._private,b=e.isNode(),f=e.isEdge(),h=m.rstyle,g=b&&d?e.pstyle("bounds-expansion").pfValue:[0],j=function(e){return"none"!==e.pstyle("display").value},x=!d||j(e)&&(!f||j(e.source())&&j(e.target()));if(x){var v=0;d&&t.includeOverlays&&0!==e.pstyle("overlay-opacity").value&&(v=e.pstyle("overlay-padding").value);var y=0;if(d&&(y=e.pstyle("width").pfValue/2),b&&t.includeNodes){var O=e.position();o=O.x,r=O.y;var E=e.outerWidth()/2,w=e.outerHeight()/2;Mi(p,a=o-E,n=r-w,i=o+E,s=r+w)}else if(f&&t.includeEdges)if(d&&!u&&(a=Math.min(h.srcX,h.midX,h.tgtX),i=Math.max(h.srcX,h.midX,h.tgtX),n=Math.min(h.srcY,h.midY,h.tgtY),s=Math.max(h.srcY,h.midY,h.tgtY),Mi(p,a-=y,n-=y,i+=y,s+=y)),d&&!u&&"haystack"===e.pstyle("curve-style").strValue){var M=h.haystackPts||[];if(a=M[0].x,n=M[0].y,a>(i=M[1].x)){var S=a;a=i,i=S}if(n>(s=M[1].y)){var _=n;n=s,s=_}Mi(p,a-y,n-y,i+y,s+y)}else{for(var T=h.bezierPts||h.linePts||[],C=0;C<T.length;C++){var k=T[C];a=k.x-y,i=k.x+y,n=k.y-y,s=k.y+y,Mi(p,a,n,i,s)}if(0===T.length){var F=e.source().position(),I=e.target().position();if((a=F.x)>(i=I.x)){var D=a;a=i,i=D}if((n=F.y)>(s=I.y)){var A=n;n=s,s=A}Mi(p,a-=y,n-=y,i+=y,s+=y)}}if(d&&t.includeEdges&&f&&(Ti(p,e,"mid-source"),Ti(p,e,"mid-target"),Ti(p,e,"source"),Ti(p,e,"target")),d&&"yes"===e.pstyle("ghost").value){var L=e.pstyle("ghost-offset-x").pfValue,R=e.pstyle("ghost-offset-y").pfValue;Mi(p,p.x1+L,p.y1+R,p.x2+L,p.y2+R)}var N=m.bodyBounds=m.bodyBounds||{};tt(N,p),et(N,g),Ze(N,1),d&&(a=p.x1,i=p.x2,n=p.y1,s=p.y2,Mi(p,a-v,n-v,i+v,s+v));var P=m.overlayBounds=m.overlayBounds||{};tt(P,p),et(P,g),Ze(P,1);var z=m.labelBounds=m.labelBounds||{};null!=z.all?((l=z.all).x1=1/0,l.y1=1/0,l.x2=-1/0,l.y2=-1/0,l.w=0,l.h=0):z.all=Qe(),d&&t.includeLabels&&(t.includeMainLabels&&Ci(p,e,null),f&&(t.includeSourceLabels&&Ci(p,e,"source"),t.includeTargetLabels&&Ci(p,e,"target")))}return p.x1=wi(p.x1),p.y1=wi(p.y1),p.x2=wi(p.x2),p.y2=wi(p.y2),p.w=wi(p.x2-p.x1),p.h=wi(p.y2-p.y1),p.w>0&&p.h>0&&x&&(et(p,g),Ze(p,1)),p}(e,Di),i.bbCache=a,i.bbCacheShift.x=i.bbCacheShift.y=0,i.bbCachePosKey=o):a=i.bbCache,!l&&(0!==i.bbCacheShift.x||0!==i.bbCacheShift.y)){var c=at,d=i.bbCacheShift,u=function(e,t){null!=e&&c(e,t)};c(a,d);var p=i.bodyBounds,m=i.overlayBounds,b=i.labelBounds,f=i.arrowBounds;u(p,d),u(m,d),null!=f&&(u(f.source,d),u(f.target,d),u(f["mid-source"],d),u(f["mid-target"],d)),null!=b&&(u(b.main,d),u(b.all,d),u(b.source,d),u(b.target,d))}if(i.bbCacheShift.x=i.bbCacheShift.y=0,!s){var h=e.isNode();a=Qe(),(t.includeNodes&&h||t.includeEdges&&!h)&&(t.includeOverlays?Si(a,i.overlayBounds):Si(a,i.bodyBounds)),t.includeLabels&&(t.includeMainLabels&&(!n||t.includeSourceLabels&&t.includeTargetLabels)?Si(a,i.labelBounds.all):(t.includeMainLabels&&Si(a,i.labelBounds.main),t.includeSourceLabels&&Si(a,i.labelBounds.source),t.includeTargetLabels&&Si(a,i.labelBounds.target))),a.w=a.x2-a.x1,a.h=a.y2-a.y1}return a},Di={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,useCache:!0},Ai=ki(Di),Li=fe(Di);Oi.boundingBox=function(e){var t;if(1!==this.length||null==this[0]._private.bbCache||void 0!==e&&void 0!==e.useCache&&!0!==e.useCache){t=Qe();var a=Li(e=e||Di),i=this;if(i.cy().styleEnabled())for(var n=0;n<i.length;n++){var s=i[n],o=s._private,r=Fi(s),l=o.bbCachePosKey===r,c=a.useCache&&l;s.recalculateRenderedStyle(c)}this.updateCompoundBounds();for(var d=0;d<i.length;d++){var u=i[d];Si(t,Ii(u,a))}}else e=void 0===e?Di:Li(e),t=Ii(this[0],e);return t.x1=wi(t.x1),t.y1=wi(t.y1),t.x2=wi(t.x2),t.y2=wi(t.y2),t.w=wi(t.x2-t.x1),t.h=wi(t.y2-t.y1),t},Oi.dirtyBoundingBoxCache=function(){for(var e=0;e<this.length;e++){var t=this[e]._private;t.bbCache=null,t.bbCacheShift.x=t.bbCacheShift.y=0,t.bbCachePosKey=null,t.bodyBounds=null,t.overlayBounds=null,t.labelBounds.all=null,t.labelBounds.source=null,t.labelBounds.target=null,t.labelBounds.main=null,t.arrowBounds.source=null,t.arrowBounds.target=null,t.arrowBounds["mid-source"]=null,t.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this},Oi.shiftCachedBoundingBox=function(e){for(var t=0;t<this.length;t++){var a=this[t]._private;null!=a.bbCache&&(a.bbCacheShift.x+=e.x,a.bbCacheShift.y+=e.y)}return this.emitAndNotify("bounds"),this},Oi.boundingBoxAt=function(e){var t=this.nodes(),a=this.cy(),i=a.hasCompoundNodes();if(i&&(t=t.filter((function(e){return!e.isParent()}))),y(e)){var n=e;e=function(){return n}}a.startBatch(),t.forEach((function(t,a){return t._private.bbAtOldPos=e(t,a)})).silentPositions(e),i&&this.updateCompoundBounds(!0);var s=function(e){return{x1:e.x1,x2:e.x2,w:e.w,y1:e.y1,y2:e.y2,h:e.h}}(this.boundingBox({useCache:!1}));return t.silentPositions((function(e){return e._private.bbAtOldPos})),a.endBatch(),s},yi.boundingbox=yi.bb=yi.boundingBox,yi.renderedBoundingbox=yi.renderedBoundingBox;var Ri,Ni,Pi=Oi;Ri=Ni={};var zi=function(e){e.uppercaseName=L(e.name),e.autoName="auto"+e.uppercaseName,e.labelName="label"+e.uppercaseName,e.outerName="outer"+e.uppercaseName,e.uppercaseOuterName=L(e.outerName),Ri[e.name]=function(){var t=this[0],a=t._private,i=a.cy._private.styleEnabled;if(t){if(i){if(t.isParent())return t.updateCompoundBounds(),a[e.autoName]||0;var n=t.pstyle(e.name);return"label"===n.strValue?(t.recalculateRenderedStyle(),a.rstyle[e.labelName]||0):n.pfValue}return 1}},Ri["outer"+e.uppercaseName]=function(){var t=this[0],a=t._private.cy._private.styleEnabled;if(t)return a?t[e.name]()+t.pstyle("border-width").pfValue+2*t.padding():1},Ri["rendered"+e.uppercaseName]=function(){var t=this[0];if(t)return t[e.name]()*this.cy().zoom()},Ri["rendered"+e.uppercaseOuterName]=function(){var t=this[0];if(t)return t[e.outerName]()*this.cy().zoom()}};zi({name:"width"}),zi({name:"height"}),Ni.padding=function(){var e=this[0],t=e._private;return e.isParent()?(e.updateCompoundBounds(),void 0!==t.autoPadding?t.autoPadding:e.pstyle("padding").pfValue):e.pstyle("padding").pfValue},Ni.paddedHeight=function(){var e=this[0];return e.height()+2*e.padding()},Ni.paddedWidth=function(){var e=this[0];return e.width()+2*e.padding()};var Bi=Ni,Vi={controlPoints:{get:function(e){return e.renderer().getControlPoints(e)},mult:!0},segmentPoints:{get:function(e){return e.renderer().getSegmentPoints(e)},mult:!0},sourceEndpoint:{get:function(e){return e.renderer().getSourceEndpoint(e)}},targetEndpoint:{get:function(e){return e.renderer().getTargetEndpoint(e)}},midpoint:{get:function(e){return e.renderer().getEdgeMidpoint(e)}}},Ji=Object.keys(Vi).reduce((function(e,t){var a=Vi[t],i=function(e){return"rendered"+e[0].toUpperCase()+e.substr(1)}(t);return e[t]=function(){return function(e,t){if(e.isEdge())return t(e)}(this,a.get)},a.mult?e[i]=function(){return function(e,t){if(e.isEdge()){var a=e.cy(),i=a.pan(),n=a.zoom();return t(e).map((function(e){return ze(e,n,i)}))}}(this,a.get)}:e[i]=function(){return function(e,t){if(e.isEdge()){var a=e.cy();return ze(t(e),a.zoom(),a.pan())}}(this,a.get)},e}),{}),Ui=P({},Ei,Pi,Bi,Ji),Gi=function(e,t){this.recycle(e,t)};function qi(){return!1}function $i(){return!0}Gi.prototype={instanceString:function(){return"event"},recycle:function(e,t){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=qi,null!=e&&e.preventDefault?(this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?$i:qi):null!=e&&e.type?t=e:this.type=e,null!=t&&(this.originalEvent=t.originalEvent,this.type=null!=t.type?t.type:this.type,this.cy=t.cy,this.target=t.target,this.position=t.position,this.renderedPosition=t.renderedPosition,this.namespace=t.namespace,this.layout=t.layout),null!=this.cy&&null!=this.position&&null==this.renderedPosition){var a=this.position,i=this.cy.zoom(),n=this.cy.pan();this.renderedPosition={x:a.x*i+n.x,y:a.y*i+n.y}}this.timeStamp=e&&e.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=$i;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=$i;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=$i,this.stopPropagation()},isDefaultPrevented:qi,isPropagationStopped:qi,isImmediatePropagationStopped:qi};var Wi=/^([^.]+)(\.(?:[^.]+))?$/,Hi={qualifierCompare:function(e,t){return e===t},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(e){return e},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},Yi=Object.keys(Hi),Xi={};function Qi(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xi,t=arguments.length>1?arguments[1]:void 0,a=0;a<Yi.length;a++){var i=Yi[a];this[i]=e[i]||Hi[i]}this.context=t||this.context,this.listeners=[],this.emitting=0}var Ki=Qi.prototype,Zi=function(e,t,a,i,n,s,o){x(i)&&(n=i,i=null),o&&(s=null==s?o:P({},s,o));for(var r=v(a)?a:a.split(/\s+/),l=0;l<r.length;l++){var c=r[l];if(!C(c)){var d=c.match(Wi);if(d&&!1===t(e,c,d[1],d[2]?d[2]:null,i,n,s))break}}},en=function(e,t){return e.addEventFields(e.context,t),new Gi(t.type,t)};Ki.on=Ki.addListener=function(e,t,a,i,n){return Zi(this,(function(e,t,a,i,n,s,o){x(s)&&e.listeners.push({event:t,callback:s,type:a,namespace:i,qualifier:n,conf:o})}),e,t,a,i,n),this},Ki.one=function(e,t,a,i){return this.on(e,t,a,i,{one:!0})},Ki.removeListener=Ki.off=function(e,t,a,i){var n=this;0!==this.emitting&&(this.listeners=this.listeners.slice());for(var s=this.listeners,o=function(o){var r=s[o];Zi(n,(function(t,a,i,n,l,c){if((r.type===i||"*"===e)&&(!n&&".*"!==r.namespace||r.namespace===n)&&(!l||t.qualifierCompare(r.qualifier,l))&&(!c||r.callback===c))return s.splice(o,1),!1}),e,t,a,i)},r=s.length-1;r>=0;r--)o(r);return this},Ki.removeAllListeners=function(){return this.removeListener("*")},Ki.emit=Ki.trigger=function(e,t,a){var i=this.listeners,n=i.length;return this.emitting++,v(t)||(t=[t]),function(e,t,a){if("event"!==g(a))if(y(a))t(e,en(e,a));else for(var i=v(a)?a:a.split(/\s+/),n=0;n<i.length;n++){var s=i[n];if(!C(s)){var o=s.match(Wi);if(o){var r=o[1],l=o[2]?o[2]:null;t(e,en(e,{type:r,namespace:l,target:e.context}))}}}else t(e,a)}(this,(function(e,s){null!=a&&(i=[{event:s.event,type:s.type,namespace:s.namespace,callback:a}],n=i.length);for(var o=function(a){var n=i[a];if(n.type===s.type&&(!n.namespace||n.namespace===s.namespace||".*"===n.namespace)&&e.eventMatches(e.context,n,s)){var o=[s];null!=t&&function(e,t){for(var a=0;a<t.length;a++){var i=t[a];e.push(i)}}(o,t),e.beforeEmit(e.context,n,s),n.conf&&n.conf.one&&(e.listeners=e.listeners.filter((function(e){return e!==n})));var r=e.callbackContext(e.context,n,s),l=n.callback.apply(r,o);e.afterEmit(e.context,n,s),!1===l&&(s.stopPropagation(),s.preventDefault())}},r=0;r<n;r++)o(r);e.bubble(e.context)&&!s.isPropagationStopped()&&e.parent(e.context).emit(s,t)}),e),this.emitting--,this};var tn={qualifierCompare:function(e,t){return null==e||null==t?null==e&&null==t:e.sameText(t)},eventMatches:function(e,t,a){var i=t.qualifier;return null==i||e!==a.target&&M(a.target)&&i.matches(a.target)},addEventFields:function(e,t){t.cy=e.cy(),t.target=e},callbackContext:function(e,t,a){return null!=t.qualifier?a.target:e},beforeEmit:function(e,t){t.conf&&t.conf.once&&t.conf.onceCollection.removeListener(t.event,t.qualifier,t.callback)},bubble:function(){return!0},parent:function(e){return e.isChild()?e.parent():e.cy()}},an=function(e){return j(e)?new ai(e):e},nn={createEmitter:function(){for(var e=0;e<this.length;e++){var t=this[e],a=t._private;a.emitter||(a.emitter=new Qi(tn,t))}return this},emitter:function(){return this._private.emitter},on:function(e,t,a){for(var i=an(t),n=0;n<this.length;n++)this[n].emitter().on(e,i,a);return this},removeListener:function(e,t,a){for(var i=an(t),n=0;n<this.length;n++)this[n].emitter().removeListener(e,i,a);return this},removeAllListeners:function(){for(var e=0;e<this.length;e++)this[e].emitter().removeAllListeners();return this},one:function(e,t,a){for(var i=an(t),n=0;n<this.length;n++)this[n].emitter().one(e,i,a);return this},once:function(e,t,a){for(var i=an(t),n=0;n<this.length;n++)this[n].emitter().on(e,i,a,{once:!0,onceCollection:this})},emit:function(e,t){for(var a=0;a<this.length;a++)this[a].emitter().emit(e,t);return this},emitAndNotify:function(e,t){if(0!==this.length)return this.cy().notify(e,this),this.emit(e,t),this}};Pa.eventAliasesOn(nn);var sn={nodes:function(e){return this.filter((function(e){return e.isNode()})).filter(e)},edges:function(e){return this.filter((function(e){return e.isEdge()})).filter(e)},byGroup:function(){for(var e=this.spawn(),t=this.spawn(),a=0;a<this.length;a++){var i=this[a];i.isNode()?e.merge(i):t.merge(i)}return{nodes:e,edges:t}},filter:function(e,t){if(void 0===e)return this;if(j(e)||w(e))return new ai(e).filter(this);if(x(e)){for(var a=this.spawn(),i=this,n=0;n<i.length;n++){var s=i[n];(t?e.apply(t,[s,n,i]):e(s,n,i))&&a.merge(s)}return a}return this.spawn()},not:function(e){if(e){j(e)&&(e=this.filter(e));for(var t=[],a=e._private.map,i=0;i<this.length;i++){var n=this[i];a.has(n.id())||t.push(n)}return this.spawn(t)}return this},absoluteComplement:function(){return this.cy().mutableElements().not(this)},intersect:function(e){if(j(e)){var t=e;return this.filter(t)}for(var a=[],i=e,n=this.length<e.length,s=n?i._private.map:this._private.map,o=n?this:i,r=0;r<o.length;r++){var l=o[r]._private.data.id,c=s.get(l);c&&a.push(c.ele)}return this.spawn(a)},xor:function(e){var t=this._private.cy;j(e)&&(e=t.$(e));var a=[],i=e,n=function(e,t){for(var i=0;i<e.length;i++){var n=e[i],s=n._private.data.id;t.hasElementWithId(s)||a.push(n)}};return n(this,i),n(i,this),this.spawn(a)},diff:function(e){var t=this._private.cy;j(e)&&(e=t.$(e));var a=[],i=[],n=[],s=e,o=function(e,t,a){for(var i=0;i<e.length;i++){var s=e[i],o=s._private.data.id;t.hasElementWithId(o)?n.push(s):a.push(s)}};return o(this,s,a),o(s,this,i),{left:this.spawn(a,{unique:!0}),right:this.spawn(i,{unique:!0}),both:this.spawn(n,{unique:!0})}},add:function(e){var t=this._private.cy;if(!e)return this;if(j(e)){var a=e;e=t.mutableElements().filter(a)}for(var i=[],n=0;n<this.length;n++)i.push(this[n]);for(var s=this._private.map,o=0;o<e.length;o++){!s.has(e[o].id())&&i.push(e[o])}return this.spawn(i)},merge:function(e){var t=this._private,a=t.cy;if(!e)return this;if(e&&j(e)){var i=e;e=a.mutableElements().filter(i)}for(var n=t.map,s=0;s<e.length;s++){var o=e[s],r=o._private.data.id;if(n.has(r)){var l=n.get(r).index;this[l]=o,n.set(r,{ele:o,index:l})}else{var c=this.length++;this[c]=o,n.set(r,{ele:o,index:c})}}return this},unmergeAt:function(e){var t=this[e].id(),a=this._private.map;this[e]=void 0,a.delete(t);var i=e===this.length-1;if(this.length>1&&!i){var n=this.length-1,s=this[n],o=s._private.data.id;this[n]=void 0,this[e]=s,a.set(o,{ele:s,index:e})}return this.length--,this},unmergeOne:function(e){e=e[0];var t=this._private,a=e._private.data.id,i=t.map.get(a);if(!i)return this;var n=i.index;return this.unmergeAt(n),this},unmerge:function(e){var t=this._private.cy;if(!e)return this;if(e&&j(e)){var a=e;e=t.mutableElements().filter(a)}for(var i=0;i<e.length;i++)this.unmergeOne(e[i]);return this},unmergeBy:function(e){for(var t=this.length-1;t>=0;t--)e(this[t])&&this.unmergeAt(t);return this},map:function(e,t){for(var a=[],i=this,n=0;n<i.length;n++){var s=i[n],o=t?e.apply(t,[s,n,i]):e(s,n,i);a.push(o)}return a},reduce:function(e,t){for(var a=t,i=this,n=0;n<i.length;n++)a=e(a,i[n],n,i);return a},max:function(e,t){for(var a,i=-1/0,n=this,s=0;s<n.length;s++){var o=n[s],r=t?e.apply(t,[o,s,n]):e(o,s,n);r>i&&(i=r,a=o)}return{value:i,ele:a}},min:function(e,t){for(var a,i=1/0,n=this,s=0;s<n.length;s++){var o=n[s],r=t?e.apply(t,[o,s,n]):e(o,s,n);r<i&&(i=r,a=o)}return{value:i,ele:a}}},on=sn;on.u=on["|"]=on["+"]=on.union=on.or=on.add,on["\\"]=on["!"]=on["-"]=on.difference=on.relativeComplement=on.subtract=on.not,on.n=on["&"]=on["."]=on.and=on.intersection=on.intersect,on["^"]=on["(+)"]=on["(-)"]=on.symmetricDifference=on.symdiff=on.xor,on.fnFilter=on.filterFn=on.stdFilter=on.filter,on.complement=on.abscomp=on.absoluteComplement;var rn=function(e,t){var a=e.cy().hasCompoundNodes();function i(e){var t=e.pstyle("z-compound-depth");return"auto"===t.value?a?e.zDepth():0:"bottom"===t.value?-1:"top"===t.value?ie:0}var n=i(e)-i(t);if(0!==n)return n;function s(e){return"auto"===e.pstyle("z-index-compare").value&&e.isNode()?1:0}var o=s(e)-s(t);if(0!==o)return o;var r=e.pstyle("z-index").value-t.pstyle("z-index").value;return 0!==r?r:e.poolIndex()-t.poolIndex()},ln={forEach:function(e,t){if(x(e))for(var a=this.length,i=0;i<a;i++){var n=this[i];if(!1===(t?e.apply(t,[n,i,this]):e(n,i,this)))break}return this},toArray:function(){for(var e=[],t=0;t<this.length;t++)e.push(this[t]);return e},slice:function(e,t){var a=[],i=this.length;null==t&&(t=i),null==e&&(e=0),e<0&&(e=i+e),t<0&&(t=i+t);for(var n=e;n>=0&&n<t&&n<i;n++)a.push(this[n]);return this.spawn(a)},size:function(){return this.length},eq:function(e){return this[e]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return 0===this.length},nonempty:function(){return!this.empty()},sort:function(e){if(!x(e))return this;var t=this.toArray().sort(e);return this.spawn(t)},sortByZIndex:function(){return this.sort(rn)},zDepth:function(){var e=this[0];if(e){var t=e._private;if("nodes"===t.group){var a=t.data.parent?e.parents().size():0;return e.isParent()?a:ie-1}var i=t.source,n=t.target,s=i.zDepth(),o=n.zDepth();return Math.max(s,o,0)}}};ln.each=ln.forEach;var cn=fe({nodeDimensionsIncludeLabels:!1}),dn={layoutDimensions:function(e){var t;if(e=cn(e),this.takesUpSpace())if(e.nodeDimensionsIncludeLabels){var a=this.boundingBox();t={w:a.w,h:a.h}}else t={w:this.outerWidth(),h:this.outerHeight()};else t={w:0,h:0};return 0!==t.w&&0!==t.h||(t.w=t.h=1),t},layoutPositions:function(e,t,a){var i=this.nodes(),n=this.cy(),s=t.eles,o=function(e){return e.id()},r=F(a,o);e.emit({type:"layoutstart",layout:e}),e.animations=[];var l=t.spacingFactor&&1!==t.spacingFactor,c=function(){if(!l)return null;for(var e=Qe(),t=0;t<i.length;t++){var a=i[t],n=r(a,t);Ke(e,n.x,n.y)}return e}(),d=F((function(e,a){var i,n,s,o,d,u=r(e,a);return l&&(i=Math.abs(t.spacingFactor),s=u,o=(n=c).x1+n.w/2,d=n.y1+n.h/2,u={x:o+(s.x-o)*i,y:d+(s.y-d)*i}),null!=t.transform&&(u=t.transform(e,u)),u}),o);if(t.animate){for(var u=0;u<i.length;u++){var p=i[u],m=d(p,u);if(null==t.animateFilter||t.animateFilter(p,u)){var b=p.animation({position:m,duration:t.animationDuration,easing:t.animationEasing});e.animations.push(b)}else p.position(m)}if(t.fit){var f=n.animation({fit:{boundingBox:s.boundingBoxAt(d),padding:t.padding},duration:t.animationDuration,easing:t.animationEasing});e.animations.push(f)}else if(void 0!==t.zoom&&void 0!==t.pan){var h=n.animation({zoom:t.zoom,pan:t.pan,duration:t.animationDuration,easing:t.animationEasing});e.animations.push(h)}e.animations.forEach((function(e){return e.play()})),e.one("layoutready",t.ready),e.emit({type:"layoutready",layout:e}),Ia.all(e.animations.map((function(e){return e.promise()}))).then((function(){e.one("layoutstop",t.stop),e.emit({type:"layoutstop",layout:e})}))}else i.positions(d),t.fit&&n.fit(t.eles,t.padding),null!=t.zoom&&n.zoom(t.zoom),t.pan&&n.pan(t.pan),e.one("layoutready",t.ready),e.emit({type:"layoutready",layout:e}),e.one("layoutstop",t.stop),e.emit({type:"layoutstop",layout:e});return this},layout:function(e){return this.cy().makeLayout(P({},e,{eles:this}))}};function un(e,t,a){var i,n=a._private,s=n.styleCache=n.styleCache||[];return null!=(i=s[e])?i:i=s[e]=t(a)}function pn(e,t){return e=Q(e),function(a){return un(e,t,a)}}function mn(e,t){e=Q(e);var a=function(e){return t.call(e)};return function(){var t=this[0];if(t)return un(e,a,t)}}dn.createLayout=dn.makeLayout=dn.layout;var bn={recalculateRenderedStyle:function(e){var t=this.cy(),a=t.renderer(),i=t.styleEnabled();return a&&i&&a.recalculateRenderedStyle(this,e),this},dirtyStyleCache:function(){var e,t=this.cy(),a=function(e){return e._private.styleCache=null};return t.hasCompoundNodes()?((e=this.spawnSelf().merge(this.descendants()).merge(this.parents())).merge(e.connectedEdges()),e.forEach(a)):this.forEach((function(e){a(e),e.connectedEdges().forEach(a)})),this},updateStyle:function(e){var t=this._private.cy;if(!t.styleEnabled())return this;if(t.batching())return t._private.batchStyleEles.merge(this),this;var a=t.hasCompoundNodes(),i=t.style(),n=this;e=!(!e&&void 0!==e),a&&(n=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var s=i.apply(n);return e?s.emitAndNotify("style"):s.emit("style"),this},parsedStyle:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this[0],i=a.cy();if(i.styleEnabled()&&a){var n=a._private.style[e];return null!=n?n:t?i.style().getDefaultProperty(e):null}},numericStyle:function(e){var t=this[0];if(t.cy().styleEnabled()&&t){var a=t.pstyle(e);return void 0!==a.pfValue?a.pfValue:a.value}},numericStyleUnits:function(e){var t=this[0];if(t.cy().styleEnabled())return t?t.pstyle(e).units:void 0},renderedStyle:function(e){var t=this.cy();if(!t.styleEnabled())return this;var a=this[0];return a?t.style().getRenderedStyle(a,e):void 0},style:function(e,t){var a=this.cy();if(!a.styleEnabled())return this;var i=a.style();if(y(e)){var n=e;i.applyBypass(this,n,!1),this.emitAndNotify("style")}else if(j(e)){if(void 0===t){var s=this[0];return s?i.getStylePropertyValue(s,e):void 0}i.applyBypass(this,e,t,!1),this.emitAndNotify("style")}else if(void 0===e){var o=this[0];return o?i.getRawStyle(o):void 0}return this},removeStyle:function(e){var t=this.cy();if(!t.styleEnabled())return this;var a=t.style(),i=this;if(void 0===e)for(var n=0;n<i.length;n++){var s=i[n];a.removeAllBypasses(s,!1)}else{e=e.split(/\s+/);for(var o=0;o<i.length;o++){var r=i[o];a.removeBypasses(r,e,!1)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var e=this.cy();if(!e.styleEnabled())return 1;var t=e.hasCompoundNodes(),a=this[0];if(a){var i=a._private,n=a.pstyle("opacity").value;if(!t)return n;var s=i.data.parent?a.parents():null;if(s)for(var o=0;o<s.length;o++)n*=s[o].pstyle("opacity").value;return n}},transparent:function(){if(!this.cy().styleEnabled())return!1;var e=this[0],t=e.cy().hasCompoundNodes();return e?t?0===e.effectiveOpacity():0===e.pstyle("opacity").value:void 0},backgrounding:function(){return!!this.cy().styleEnabled()&&!!this[0]._private.backgrounding}};function fn(e,t){var a=e._private.data.parent?e.parents():null;if(a)for(var i=0;i<a.length;i++)if(!t(a[i]))return!1;return!0}function hn(e){var t=e.ok,a=e.edgeOkViaNode||e.ok,i=e.parentOk||e.ok;return function(){var e=this.cy();if(!e.styleEnabled())return!0;var n=this[0],s=e.hasCompoundNodes();if(n){var o=n._private;if(!t(n))return!1;if(n.isNode())return!s||fn(n,i);var r=o.source,l=o.target;return a(r)&&(!s||fn(r,a))&&(r===l||a(l)&&(!s||fn(l,a)))}}}var gn=pn("eleTakesUpSpace",(function(e){return"element"===e.pstyle("display").value&&0!==e.width()&&(!e.isNode()||0!==e.height())}));bn.takesUpSpace=mn("takesUpSpace",hn({ok:gn}));var jn=pn("eleInteractive",(function(e){return"yes"===e.pstyle("events").value&&"visible"===e.pstyle("visibility").value&&gn(e)})),xn=pn("parentInteractive",(function(e){return"visible"===e.pstyle("visibility").value&&gn(e)}));bn.interactive=mn("interactive",hn({ok:jn,parentOk:xn,edgeOkViaNode:gn})),bn.noninteractive=function(){var e=this[0];if(e)return!e.interactive()};var vn=pn("eleVisible",(function(e){return"visible"===e.pstyle("visibility").value&&0!==e.pstyle("opacity").pfValue&&gn(e)})),yn=gn;bn.visible=mn("visible",hn({ok:vn,edgeOkViaNode:yn})),bn.hidden=function(){var e=this[0];if(e)return!e.visible()},bn.isBundledBezier=mn("isBundledBezier",(function(){return!!this.cy().styleEnabled()&&!this.removed()&&"bezier"===this.pstyle("curve-style").value&&this.takesUpSpace()})),bn.bypass=bn.css=bn.style,bn.renderedCss=bn.renderedStyle,bn.removeBypass=bn.removeCss=bn.removeStyle,bn.pstyle=bn.parsedStyle;var On={};function En(e){return function(){var t=arguments,a=[];if(2===t.length){var i=t[0],n=t[1];this.on(e.event,i,n)}else if(1===t.length&&x(t[0])){var s=t[0];this.on(e.event,s)}else if(0===t.length||1===t.length&&v(t[0])){for(var o=1===t.length?t[0]:null,r=0;r<this.length;r++){var l=this[r],c=!e.ableField||l._private[e.ableField],d=l._private[e.field]!=e.value;if(e.overrideAble){var u=e.overrideAble(l);if(void 0!==u&&(c=u,!u))return this}c&&(l._private[e.field]=e.value,d&&a.push(l))}var p=this.spawn(a);p.updateStyle(),p.emit(e.event),o&&p.emit(o)}return this}}function wn(e){On[e.field]=function(){var t=this[0];if(t){if(e.overrideField){var a=e.overrideField(t);if(void 0!==a)return a}return t._private[e.field]}},On[e.on]=En({event:e.on,field:e.field,ableField:e.ableField,overrideAble:e.overrideAble,value:!0}),On[e.off]=En({event:e.off,field:e.field,ableField:e.ableField,overrideAble:e.overrideAble,value:!1})}wn({field:"locked",overrideField:function(e){return!!e.cy().autolock()||void 0},on:"lock",off:"unlock"}),wn({field:"grabbable",overrideField:function(e){return!e.cy().autoungrabify()&&!e.pannable()&&void 0},on:"grabify",off:"ungrabify"}),wn({field:"selected",ableField:"selectable",overrideAble:function(e){return!e.cy().autounselectify()&&void 0},on:"select",off:"unselect"}),wn({field:"selectable",overrideField:function(e){return!e.cy().autounselectify()&&void 0},on:"selectify",off:"unselectify"}),On.deselect=On.unselect,On.grabbed=function(){var e=this[0];if(e)return e._private.grabbed},wn({field:"active",on:"activate",off:"unactivate"}),wn({field:"pannable",on:"panify",off:"unpanify"}),On.inactive=function(){var e=this[0];if(e)return!e._private.active};var Mn={},Sn=function(e){return function(t){for(var a=[],i=0;i<this.length;i++){var n=this[i];if(n.isNode()){for(var s=!1,o=n.connectedEdges(),r=0;r<o.length;r++){var l=o[r],c=l.source(),d=l.target();if(e.noIncomingEdges&&d===n&&c!==n||e.noOutgoingEdges&&c===n&&d!==n){s=!0;break}}s||a.push(n)}}return this.spawn(a,{unique:!0}).filter(t)}},_n=function(e){return function(t){for(var a=[],i=0;i<this.length;i++){var n=this[i];if(n.isNode())for(var s=n.connectedEdges(),o=0;o<s.length;o++){var r=s[o],l=r.source(),c=r.target();e.outgoing&&l===n?(a.push(r),a.push(c)):e.incoming&&c===n&&(a.push(r),a.push(l))}}return this.spawn(a,{unique:!0}).filter(t)}},Tn=function(e){return function(t){for(var a=this,i=[],n={};;){var s=e.outgoing?a.outgoers():a.incomers();if(0===s.length)break;for(var o=!1,r=0;r<s.length;r++){var l=s[r],c=l.id();n[c]||(n[c]=!0,i.push(l),o=!0)}if(!o)break;a=s}return this.spawn(i,{unique:!0}).filter(t)}};function Cn(e){return function(t){for(var a=[],i=0;i<this.length;i++){var n=this[i]._private[e.attr];n&&a.push(n)}return this.spawn(a,{unique:!0}).filter(t)}}function kn(e){return function(t){var a=[],i=this._private.cy,n=e||{};j(t)&&(t=i.$(t));for(var s=0;s<t.length;s++)for(var o=t[s]._private.edges,r=0;r<o.length;r++){var l=o[r],c=l._private.data,d=this.hasElementWithId(c.source)&&t.hasElementWithId(c.target),u=t.hasElementWithId(c.source)&&this.hasElementWithId(c.target);if(d||u){if(n.thisIsSrc||n.thisIsTgt){if(n.thisIsSrc&&!d)continue;if(n.thisIsTgt&&!u)continue}a.push(l)}}return this.spawn(a,{unique:!0})}}function Fn(e){return e=P({},{codirected:!1},e),function(t){for(var a=[],i=this.edges(),n=e,s=0;s<i.length;s++)for(var o=i[s]._private,r=o.source,l=r._private.data.id,c=o.data.target,d=r._private.edges,u=0;u<d.length;u++){var p=d[u],m=p._private.data,b=m.target,f=m.source,h=b===c&&f===l,g=l===b&&c===f;(n.codirected&&h||!n.codirected&&(h||g))&&a.push(p)}return this.spawn(a,{unique:!0}).filter(t)}}Mn.clearTraversalCache=function(){for(var e=0;e<this.length;e++)this[e]._private.traversalCache=null},P(Mn,{roots:Sn({noIncomingEdges:!0}),leaves:Sn({noOutgoingEdges:!0}),outgoers:ri(_n({outgoing:!0}),"outgoers"),successors:Tn({outgoing:!0}),incomers:ri(_n({incoming:!0}),"incomers"),predecessors:Tn({incoming:!0})}),P(Mn,{neighborhood:ri((function(e){for(var t=[],a=this.nodes(),i=0;i<a.length;i++)for(var n=a[i],s=n.connectedEdges(),o=0;o<s.length;o++){var r=s[o],l=r.source(),c=r.target(),d=n===l?c:l;d.length>0&&t.push(d[0]),t.push(r[0])}return this.spawn(t,{unique:!0}).filter(e)}),"neighborhood"),closedNeighborhood:function(e){return this.neighborhood().add(this).filter(e)},openNeighborhood:function(e){return this.neighborhood(e)}}),Mn.neighbourhood=Mn.neighborhood,Mn.closedNeighbourhood=Mn.closedNeighborhood,Mn.openNeighbourhood=Mn.openNeighborhood,P(Mn,{source:ri((function(e){var t,a=this[0];return a&&(t=a._private.source||a.cy().collection()),t&&e?t.filter(e):t}),"source"),target:ri((function(e){var t,a=this[0];return a&&(t=a._private.target||a.cy().collection()),t&&e?t.filter(e):t}),"target"),sources:Cn({attr:"source"}),targets:Cn({attr:"target"})}),P(Mn,{edgesWith:ri(kn(),"edgesWith"),edgesTo:ri(kn({thisIsSrc:!0}),"edgesTo")}),P(Mn,{connectedEdges:ri((function(e){for(var t=[],a=0;a<this.length;a++){var i=this[a];if(i.isNode())for(var n=i._private.edges,s=0;s<n.length;s++){var o=n[s];t.push(o)}}return this.spawn(t,{unique:!0}).filter(e)}),"connectedEdges"),connectedNodes:ri((function(e){for(var t=[],a=0;a<this.length;a++){var i=this[a];i.isEdge()&&(t.push(i.source()[0]),t.push(i.target()[0]))}return this.spawn(t,{unique:!0}).filter(e)}),"connectedNodes"),parallelEdges:ri(Fn(),"parallelEdges"),codirectedEdges:ri(Fn({codirected:!0}),"codirectedEdges")}),P(Mn,{components:function(e){var t=this,a=t.cy(),i=a.collection(),n=null==e?t.nodes():e.nodes(),s=[];null!=e&&n.empty()&&(n=e.sources());var o=function(e,t){i.merge(e),n.unmerge(e),t.merge(e)};if(n.empty())return t.spawn();var r=function(){var e=a.collection();s.push(e);var i=n[0];o(i,e),t.bfs({directed:!1,roots:i,visit:function(t){return o(t,e)}}),e.forEach((function(t){t.connectedEdges().forEach((function(t){e.has(t.source())&&e.has(t.target())&&e.merge(t)}))}))};do{r()}while(n.length>0);return s},component:function(){var e=this[0];return e.cy().mutableElements().components(e)[0]}}),Mn.componentsOf=Mn.components;var In=function(e,t,a){for(var i=null!=a?a:pe();e.hasElementWithId(i);)i=pe();return i},Dn=function(e,t,a){if(void 0!==e&&_(e)){var i=new ve,n=!1;if(t){if(t.length>0&&y(t[0])&&!M(t[0])){n=!0;for(var s=[],o=new Oe,r=0,l=t.length;r<l;r++){var c=t[r];null==c.data&&(c.data={});var d=c.data;if(null==d.id)d.id=In(e);else if(e.hasElementWithId(d.id)||o.has(d.id))continue;var u=new Ee(e,c,!1);s.push(u),o.add(d.id)}t=s}}else t=[];this.length=0;for(var p=0,m=t.length;p<m;p++){var b=t[p][0];if(null!=b){var f=b._private.data.id;(null==a||a.unique&&!i.has(f))&&(i.set(f,{index:this.length,ele:b}),this[this.length]=b,this.length++)}}this._private={cy:e,map:i},n&&this.restore()}else le("A collection must have a reference to the core")},An=Ee.prototype=Dn.prototype;An.instanceString=function(){return"collection"},An.spawn=function(e,t,a){return _(e)||(a=t,t=e,e=this.cy()),new Dn(e,t,a)},An.spawnSelf=function(){return this.spawn(this)},An.cy=function(){return this._private.cy},An.renderer=function(){return this._private.cy.renderer()},An.element=function(){return this[0]},An.collection=function(){return S(this)?this:new Dn(this._private.cy,[this])},An.unique=function(){return new Dn(this._private.cy,this,{unique:!0})},An.hasElementWithId=function(e){return e=""+e,this._private.map.has(e)},An.getElementById=function(e){e=""+e;var t=this._private.cy,a=this._private.map.get(e);return a?a.ele:new Dn(t)},An.$id=An.getElementById,An.poolIndex=function(){var e=this._private.cy._private.elements,t=this[0]._private.data.id;return e._private.map.get(t).index},An.indexOf=function(e){var t=e[0]._private.data.id;return this._private.map.get(t).index},An.indexOfId=function(e){return e=""+e,this._private.map.get(e).index},An.json=function(e){var t=this.element(),a=this.cy();if(null==t&&e)return this;if(null!=t){var i=t._private;if(y(e)){if(a.startBatch(),e.data){t.data(e.data);var n=i.data;if(t.isEdge()){var s=!1,o={},r=e.data.source,l=e.data.target;null!=r&&r!=n.source&&(o.source=""+r,s=!0),null!=l&&l!=n.target&&(o.target=""+l,s=!0),s&&(t=t.move(o))}else{var c=e.data.parent;null==c&&null==n.parent||c==n.parent||(void 0===c&&(c=null),null!=c&&(c=""+c),t=t.move({parent:c}))}}e.position&&t.position(e.position);var d=function(a,n,s){var o=e[a];null!=o&&o!==i[a]&&(o?t[n]():t[s]())};return d("removed","remove","restore"),d("selected","select","unselect"),d("selectable","selectify","unselectify"),d("locked","lock","unlock"),d("grabbable","grabify","ungrabify"),d("pannable","panify","unpanify"),null!=e.classes&&t.classes(e.classes),a.endBatch(),this}if(void 0===e){var u={data:ue(i.data),position:ue(i.position),group:i.group,removed:i.removed,selected:i.selected,selectable:i.selectable,locked:i.locked,grabbable:i.grabbable,pannable:i.pannable,classes:null};u.classes="";var p=0;return i.classes.forEach((function(e){return u.classes+=0==p++?e:" "+e})),u}}},An.jsons=function(){for(var e=[],t=0;t<this.length;t++){var a=this[t].json();e.push(a)}return e},An.clone=function(){for(var e=this.cy(),t=[],a=0;a<this.length;a++){var i=this[a].json(),n=new Ee(e,i,!1);t.push(n)}return new Dn(e,t)},An.copy=An.clone,An.restore=function(){for(var e,t,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this,s=n.cy(),o=s._private,r=[],l=[],c=0,d=n.length;c<d;c++){var u=n[c];i&&!u.removed()||(u.isNode()?r.push(u):l.push(u))}e=r.concat(l);var p=function(){e.splice(t,1),t--};for(t=0;t<e.length;t++){var m=e[t],b=m._private,f=b.data;if(m.clearTraversalCache(),i||b.removed)if(void 0===f.id)f.id=In(s);else if(O(f.id))f.id=""+f.id;else{if(C(f.id)||!j(f.id)){le("Can not create element with invalid string ID `"+f.id+"`"),p();continue}if(s.hasElementWithId(f.id)){le("Can not create second element with ID `"+f.id+"`"),p();continue}}var h=f.id;if(m.isNode()){var g=b.position;null==g.x&&(g.x=0),null==g.y&&(g.y=0)}if(m.isEdge()){for(var x=m,v=["source","target"],y=v.length,E=!1,w=0;w<y;w++){var M=v[w],S=f[M];O(S)&&(S=f[M]=""+f[M]),null==S||""===S?(le("Can not create edge `"+h+"` with unspecified "+M),E=!0):s.hasElementWithId(S)||(le("Can not create edge `"+h+"` with nonexistant "+M+" `"+S+"`"),E=!0)}if(E){p();continue}var _=s.getElementById(f.source),T=s.getElementById(f.target);_.same(T)?_._private.edges.push(x):(_._private.edges.push(x),T._private.edges.push(x)),x._private.source=_,x._private.target=T}b.map=new ve,b.map.set(h,{ele:m,index:0}),b.removed=!1,i&&s.addToPool(m)}for(var k=0;k<r.length;k++){var F=r[k],I=F._private.data;O(I.parent)&&(I.parent=""+I.parent);var D=I.parent,A=null!=D;if(A){var L=s.getElementById(D);if(L.empty())I.parent=void 0;else{for(var R=!1,N=L;!N.empty();){if(F.same(N)){R=!0,I.parent=void 0;break}N=N.parent()}R||(L[0]._private.children.push(F),F._private.parent=L[0],o.hasCompoundNodes=!0)}}}if(e.length>0){for(var P=new Dn(s,e),z=0;z<P.length;z++){var B=P[z];B.isNode()||(B.parallelEdges().clearTraversalCache(),B.source().clearTraversalCache(),B.target().clearTraversalCache())}(o.hasCompoundNodes?s.collection().merge(P).merge(P.connectedNodes()).merge(P.parent()):P).dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(a),a?P.emitAndNotify("add"):i&&P.emit("add")}return n},An.removed=function(){var e=this[0];return e&&e._private.removed},An.inside=function(){var e=this[0];return e&&!e._private.removed},An.remove=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this,i=[],n={},s=a._private.cy;function o(e){for(var t=e._private.edges,a=0;a<t.length;a++)l(t[a])}function r(e){for(var t=e._private.children,a=0;a<t.length;a++)l(t[a])}function l(e){var a=n[e.id()];t&&e.removed()||a||(n[e.id()]=!0,e.isNode()?(i.push(e),o(e),r(e)):i.unshift(e))}for(var c=0,d=a.length;c<d;c++){var u=a[c];l(u)}function p(e,t){var a=e._private.edges;he(a,t),e.clearTraversalCache()}function m(e){e.clearTraversalCache()}var b=[];function f(e,t){t=t[0];var a=(e=e[0])._private.children,i=e.id();he(a,t),t._private.parent=null,b.ids[i]||(b.ids[i]=!0,b.push(e))}b.ids={},a.dirtyCompoundBoundsCache(),t&&s.removeFromPool(i);for(var h=0;h<i.length;h++){var g=i[h];if(g.isEdge()){var j=g.source()[0],x=g.target()[0];p(j,g),p(x,g);for(var v=g.parallelEdges(),y=0;y<v.length;y++){var O=v[y];m(O),O.isBundledBezier()&&O.dirtyBoundingBoxCache()}}else{var E=g.parent();0!==E.length&&f(E,g)}t&&(g._private.removed=!0)}var w=s._private.elements;s._private.hasCompoundNodes=!1;for(var M=0;M<w.length;M++){var S=w[M];if(S.isParent()){s._private.hasCompoundNodes=!0;break}}var _=new Dn(this.cy(),i);_.size()>0&&(e?_.emitAndNotify("remove"):t&&_.emit("remove"));for(var T=0;T<b.length;T++){var C=b[T];t&&C.removed()||C.updateStyle()}return _},An.move=function(e){var t=this._private.cy,a=this,i=!1,n=!1,s=function(e){return null==e?e:""+e};if(void 0!==e.source||void 0!==e.target){var o=s(e.source),r=s(e.target),l=null!=o&&t.hasElementWithId(o),c=null!=r&&t.hasElementWithId(r);(l||c)&&(t.batch((function(){a.remove(i,n),a.emitAndNotify("moveout");for(var e=0;e<a.length;e++){var t=a[e],s=t._private.data;t.isEdge()&&(l&&(s.source=o),c&&(s.target=r))}a.restore(i,n)})),a.emitAndNotify("move"))}else if(void 0!==e.parent){var d=s(e.parent);if(null===d||t.hasElementWithId(d)){var u=null===d?void 0:d;t.batch((function(){var e=a.remove(i,n);e.emitAndNotify("moveout");for(var t=0;t<a.length;t++){var s=a[t],o=s._private.data;s.isNode()&&(o.parent=u)}e.restore(i,n)})),a.emitAndNotify("move")}}return this},[Ma,za,Ba,ni,li,fi,hi,Ui,nn,sn,{isNode:function(){return"nodes"===this.group()},isEdge:function(){return"edges"===this.group()},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var e=this[0];if(e)return e._private.group}},ln,dn,bn,On,Mn].forEach((function(e){P(An,e)}));var Ln={add:function(e){var t,a=this;if(w(e)){var i=e;if(i._private.cy===a)t=i.restore();else{for(var n=[],s=0;s<i.length;s++){var o=i[s];n.push(o.json())}t=new Dn(a,n)}}else if(v(e))t=new Dn(a,e);else if(y(e)&&(v(e.nodes)||v(e.edges))){for(var r=e,l=[],c=["nodes","edges"],d=0,u=c.length;d<u;d++){var p=c[d],m=r[p];if(v(m))for(var b=0,f=m.length;b<f;b++){var h=P({group:p},m[b]);l.push(h)}}t=new Dn(a,l)}else t=new Ee(a,e).collection();return t},remove:function(e){if(w(e));else if(j(e)){var t=e;e=this.$(t)}return e.remove()}},Rn=function(){function e(e){return-e.tension*e.x-e.friction*e.v}function t(t,a,i){var n={x:t.x+i.dx*a,v:t.v+i.dv*a,tension:t.tension,friction:t.friction};return{dx:n.v,dv:e(n)}}function a(a,i){var n={dx:a.v,dv:e(a)},s=t(a,.5*i,n),o=t(a,.5*i,s),r=t(a,i,o),l=1/6*(n.dx+2*(s.dx+o.dx)+r.dx),c=1/6*(n.dv+2*(s.dv+o.dv)+r.dv);return a.x=a.x+l*i,a.v=a.v+c*i,a}return function e(t,i,n){var s,o,r,l={x:-1,v:0,tension:null,friction:null},c=[0],d=0,u=1e-4;for(t=parseFloat(t)||500,i=parseFloat(i)||20,n=n||null,l.tension=t,l.friction=i,o=(s=null!==n)?(d=e(t,i))/n*.016:.016;r=a(r||l,o),c.push(1+r.x),d+=16,Math.abs(r.x)>u&&Math.abs(r.v)>u;);return s?function(e){return c[e*(c.length-1)|0]}:d}}(),Nn=function(e,t,a,i){var n=
/*! Bezier curve function generator. Copyright Gaetan Renaudeau. MIT License: http://en.wikipedia.org/wiki/MIT_License */
function(e,t,a,i){var n=4,s=.001,o=1e-7,r=10,l=11,c=1/(l-1),d="undefined"!=typeof Float32Array;if(4!==arguments.length)return!1;for(var u=0;u<4;++u)if("number"!=typeof arguments[u]||isNaN(arguments[u])||!isFinite(arguments[u]))return!1;e=Math.min(e,1),a=Math.min(a,1),e=Math.max(e,0),a=Math.max(a,0);var p=d?new Float32Array(l):new Array(l);function m(e,t){return 1-3*t+3*e}function b(e,t){return 3*t-6*e}function f(e){return 3*e}function h(e,t,a){return((m(t,a)*e+b(t,a))*e+f(t))*e}function g(e,t,a){return 3*m(t,a)*e*e+2*b(t,a)*e+f(t)}function j(t,i){for(var s=0;s<n;++s){var o=g(i,e,a);if(0===o)return i;i-=(h(i,e,a)-t)/o}return i}function x(){for(var t=0;t<l;++t)p[t]=h(t*c,e,a)}function v(t,i,n){var s,l,c=0;do{(s=h(l=i+(n-i)/2,e,a)-t)>0?n=l:i=l}while(Math.abs(s)>o&&++c<r);return l}function y(t){for(var i=0,n=1,o=l-1;n!==o&&p[n]<=t;++n)i+=c;--n;var r=i+(t-p[n])/(p[n+1]-p[n])*c,d=g(r,e,a);return d>=s?j(t,r):0===d?r:v(t,i,i+c)}var O=!1;function E(){O=!0,e===t&&a===i||x()}var w=function(n){return O||E(),e===t&&a===i?n:0===n?0:1===n?1:h(y(n),t,i)};w.getControlPoints=function(){return[{x:e,y:t},{x:a,y:i}]};var M="generateBezier("+[e,t,a,i]+")";return w.toString=function(){return M},w}
/*! Runge-Kutta spring physics function generator. Adapted from Framer.js, copyright Koen Bok. MIT License: http://en.wikipedia.org/wiki/MIT_License */(e,t,a,i);return function(e,t,a){return e+(t-e)*n(a)}},Pn={linear:function(e,t,a){return e+(t-e)*a},ease:Nn(.25,.1,.25,1),"ease-in":Nn(.42,0,1,1),"ease-out":Nn(0,0,.58,1),"ease-in-out":Nn(.42,0,.58,1),"ease-in-sine":Nn(.47,0,.745,.715),"ease-out-sine":Nn(.39,.575,.565,1),"ease-in-out-sine":Nn(.445,.05,.55,.95),"ease-in-quad":Nn(.55,.085,.68,.53),"ease-out-quad":Nn(.25,.46,.45,.94),"ease-in-out-quad":Nn(.455,.03,.515,.955),"ease-in-cubic":Nn(.55,.055,.675,.19),"ease-out-cubic":Nn(.215,.61,.355,1),"ease-in-out-cubic":Nn(.645,.045,.355,1),"ease-in-quart":Nn(.895,.03,.685,.22),"ease-out-quart":Nn(.165,.84,.44,1),"ease-in-out-quart":Nn(.77,0,.175,1),"ease-in-quint":Nn(.755,.05,.855,.06),"ease-out-quint":Nn(.23,1,.32,1),"ease-in-out-quint":Nn(.86,0,.07,1),"ease-in-expo":Nn(.95,.05,.795,.035),"ease-out-expo":Nn(.19,1,.22,1),"ease-in-out-expo":Nn(1,0,0,1),"ease-in-circ":Nn(.6,.04,.98,.335),"ease-out-circ":Nn(.075,.82,.165,1),"ease-in-out-circ":Nn(.785,.135,.15,.86),spring:function(e,t,a){if(0===a)return Pn.linear;var i=Rn(e,t,a);return function(e,t,a){return e+(t-e)*i(a)}},"cubic-bezier":Nn};function zn(e,t,a,i,n){if(1===i)return a;var s=n(t,a,i);return null==e||((e.roundValue||e.color)&&(s=Math.round(s)),void 0!==e.min&&(s=Math.max(s,e.min)),void 0!==e.max&&(s=Math.min(s,e.max))),s}function Bn(e,t){return null!=e.pfValue||null!=e.value?null==e.pfValue||null!=t&&"%"===t.type.units?e.value:e.pfValue:e}function Vn(e,t,a,i,n){var s=null!=n?n.type:null;a<0?a=0:a>1&&(a=1);var o=Bn(e,n),r=Bn(t,n);if(O(o)&&O(r))return zn(s,o,r,a,i);if(v(o)&&v(r)){for(var l=[],c=0;c<r.length;c++){var d=o[c],u=r[c];if(null!=d&&null!=u){var p=zn(s,d,u,a,i);l.push(p)}else l.push(u)}return l}}function Jn(e,t,a,i){var n=!i,s=e._private,o=t._private,r=o.easing,l=o.startTime,c=(i?e:e.cy()).style();if(!o.easingImpl)if(null==r)o.easingImpl=Pn.linear;else{var d,u,p;d=j(r)?c.parse("transition-timing-function",r).value:r,j(d)?(u=d,p=[]):(u=d[1],p=d.slice(2).map((function(e){return+e}))),p.length>0?("spring"===u&&p.push(o.duration),o.easingImpl=Pn[u].apply(null,p)):o.easingImpl=Pn[u]}var m,b=o.easingImpl;if(m=0===o.duration?1:(a-l)/o.duration,o.applying&&(m=o.progress),m<0?m=0:m>1&&(m=1),null==o.delay){var f=o.startPosition,h=o.position;if(h&&n&&!e.locked()){var g={};Un(f.x,h.x)&&(g.x=Vn(f.x,h.x,m,b)),Un(f.y,h.y)&&(g.y=Vn(f.y,h.y,m,b)),e.position(g)}var x=o.startPan,v=o.pan,y=s.pan,O=null!=v&&i;O&&(Un(x.x,v.x)&&(y.x=Vn(x.x,v.x,m,b)),Un(x.y,v.y)&&(y.y=Vn(x.y,v.y,m,b)),e.emit("pan"));var E=o.startZoom,w=o.zoom,M=null!=w&&i;M&&(Un(E,w)&&(s.zoom=Xe(s.minZoom,Vn(E,w,m,b),s.maxZoom)),e.emit("zoom")),(O||M)&&e.emit("viewport");var S=o.style;if(S&&S.length>0&&n){for(var _=0;_<S.length;_++){var T=S[_],C=T.name,k=T,F=o.startStyle[C],I=Vn(F,k,m,b,c.properties[F.name]);c.overrideBypass(e,C,I)}e.emit("style")}}return o.progress=m,m}function Un(e,t){return!!(null!=e&&null!=t&&(O(e)&&O(t)||e&&t))}function Gn(e,t,a,i){var n=t._private;n.started=!0,n.startTime=a-n.progress*n.duration}function qn(e,t){var a=t._private.aniEles,i=[];function n(t,a){var n=t._private,s=n.animation.current,o=n.animation.queue,r=!1;if(!a&&"none"===t.pstyle("display").value){s=s.splice(0,s.length).concat(o.splice(0,o.length));for(var l=0;l<s.length;l++)s[l].stop()}if(0===s.length){var c=o.shift();c&&s.push(c)}for(var d=function(e){for(var t=e.length-1;t>=0;t--)(0,e[t])();e.splice(0,e.length)},u=s.length-1;u>=0;u--){var p=s[u],m=p._private;m.stopped?(s.splice(u,1),m.hooked=!1,m.playing=!1,m.started=!1,d(m.frames)):(m.playing||m.applying)&&(m.playing&&m.applying&&(m.applying=!1),m.started||Gn(0,p,e),Jn(t,p,e,a),m.applying&&(m.applying=!1),d(m.frames),null!=m.step&&m.step(e),p.completed()&&(s.splice(u,1),m.hooked=!1,m.playing=!1,m.started=!1,d(m.completes)),r=!0)}return a||0!==s.length||0!==o.length||i.push(t),r}for(var s=!1,o=0;o<a.length;o++){var r=n(a[o]);s=s||r}var l=n(t,!0);(s||l)&&(a.length>0?t.notify("draw",a):t.notify("draw")),a.unmerge(i),t.emit("step")}var $n={animate:Pa.animate(),animation:Pa.animation(),animated:Pa.animated(),clearQueue:Pa.clearQueue(),delay:Pa.delay(),delayAnimation:Pa.delayAnimation(),stop:Pa.stop(),addToAnimationPool:function(e){this.styleEnabled()&&this._private.aniEles.merge(e)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var e=this;if(e._private.animationsRunning=!0,e.styleEnabled()){var t=e.renderer();t&&t.beforeRender?t.beforeRender((function(t,a){qn(a,e)}),t.beforeRenderPriorities.animations):function t(){e._private.animationsRunning&&q((function(a){qn(a,e),t()}))}()}}},Wn={qualifierCompare:function(e,t){return null==e||null==t?null==e&&null==t:e.sameText(t)},eventMatches:function(e,t,a){var i=t.qualifier;return null==i||e!==a.target&&M(a.target)&&i.matches(a.target)},addEventFields:function(e,t){t.cy=e,t.target=e},callbackContext:function(e,t,a){return null!=t.qualifier?a.target:e}},Hn=function(e){return j(e)?new ai(e):e},Yn={createEmitter:function(){var e=this._private;return e.emitter||(e.emitter=new Qi(Wn,this)),this},emitter:function(){return this._private.emitter},on:function(e,t,a){return this.emitter().on(e,Hn(t),a),this},removeListener:function(e,t,a){return this.emitter().removeListener(e,Hn(t),a),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(e,t,a){return this.emitter().one(e,Hn(t),a),this},once:function(e,t,a){return this.emitter().one(e,Hn(t),a),this},emit:function(e,t){return this.emitter().emit(e,t),this},emitAndNotify:function(e,t){return this.emit(e),this.notify(e,t),this}};Pa.eventAliasesOn(Yn);var Xn={png:function(e){return e=e||{},this._private.renderer.png(e)},jpg:function(e){var t=this._private.renderer;return(e=e||{}).bg=e.bg||"#fff",t.jpg(e)}};Xn.jpeg=Xn.jpg;var Qn={layout:function(e){var t=this;if(null!=e)if(null!=e.name){var a,i=e.name,n=t.extension("layout",i);if(null!=n)return a=j(e.eles)?t.$(e.eles):null!=e.eles?e.eles:t.$(),new n(P({},e,{cy:t,eles:a}));le("No such layout `"+i+"` found.  Did you forget to import it and `cytoscape.use()` it?")}else le("A `name` must be specified to make a layout");else le("Layout options must be specified to make a layout")}};Qn.createLayout=Qn.makeLayout=Qn.layout;var Kn={notify:function(e,t){var a=this._private;if(this.batching()){a.batchNotifications=a.batchNotifications||{};var i=a.batchNotifications[e]=a.batchNotifications[e]||this.collection();null!=t&&i.merge(t)}else if(a.notificationsEnabled){var n=this.renderer();!this.destroyed()&&n&&n.notify(e,t)}},notifications:function(e){var t=this._private;return void 0===e?t.notificationsEnabled:(t.notificationsEnabled=!!e,this)},noNotifications:function(e){this.notifications(!1),e(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var e=this._private;return null==e.batchCount&&(e.batchCount=0),0===e.batchCount&&(e.batchStyleEles=this.collection(),e.batchNotifications={}),e.batchCount++,this},endBatch:function(){var e=this._private;if(0===e.batchCount)return this;if(e.batchCount--,0===e.batchCount){e.batchStyleEles.updateStyle();var t=this.renderer();Object.keys(e.batchNotifications).forEach((function(a){var i=e.batchNotifications[a];i.empty()?t.notify(a):t.notify(a,i)}))}return this},batch:function(e){return this.startBatch(),e(),this.endBatch(),this},batchData:function(e){var t=this;return this.batch((function(){for(var a=Object.keys(e),i=0;i<a.length;i++){var n=a[i],s=e[n];t.getElementById(n).data(s)}}))}},Zn=fe({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1}),es={renderTo:function(e,t,a,i){return this._private.renderer.renderTo(e,t,a,i),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(e){var t=this,a=t.extension("renderer",e.name);if(null!=a){void 0!==e.wheelSensitivity&&de("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=Zn(e);i.cy=t,t._private.renderer=new a(i),this.notify("init")}else le("Can not initialise: No such renderer `".concat(e.name,"` found. Did you forget to import it and `cytoscape.use()` it?"))},destroyRenderer:function(){var e=this;e.notify("destroy");var t=e.container();if(t)for(t._cyreg=null;t.childNodes.length>0;)t.removeChild(t.childNodes[0]);e._private.renderer=null,e.mutableElements().forEach((function(e){var t=e._private;t.rscratch={},t.rstyle={},t.animation.current=[],t.animation.queue=[]}))},onRender:function(e){return this.on("render",e)},offRender:function(e){return this.off("render",e)}};es.invalidateDimensions=es.resize;var ts={collection:function(e,t){return j(e)?this.$(e):w(e)?e.collection():v(e)?new Dn(this,e,t):new Dn(this)},nodes:function(e){var t=this.$((function(e){return e.isNode()}));return e?t.filter(e):t},edges:function(e){var t=this.$((function(e){return e.isEdge()}));return e?t.filter(e):t},$:function(e){var t=this._private.elements;return e?t.filter(e):t.spawnSelf()},mutableElements:function(){return this._private.elements}};ts.elements=ts.filter=ts.$;var as={},is="t";as.apply=function(e){var t=this,a=t._private,i=a.cy.collection();a.newStyle&&(a.contextStyles={},a.propDiffs={},t.cleanElements(e,!0));for(var n=0;n<e.length;n++){var s=e[n],o=t.getContextMeta(s);if(!o.empty){var r=t.getContextStyle(o),l=t.applyContextStyle(o,r,s);a.newStyle||t.updateTransitions(s,l.diffProps),t.updateStyleHints(s)&&i.merge(s)}}return a.newStyle=!1,i},as.getPropertiesDiff=function(e,t){var a=this,i=a._private.propDiffs=a._private.propDiffs||{},n=e+"-"+t,s=i[n];if(s)return s;for(var o=[],r={},l=0;l<a.length;l++){var c=a[l],d=e[l]===is,u=t[l]===is,p=d!==u,m=c.mappedProperties.length>0;if(p||u&&m){var b=void 0;p&&m||p?b=c.properties:m&&(b=c.mappedProperties);for(var f=0;f<b.length;f++){for(var h=b[f],g=h.name,j=!1,x=l+1;x<a.length;x++){var v=a[x];if(t[x]===is&&(j=null!=v.properties[h.name]))break}r[g]||j||(r[g]=!0,o.push(g))}}}return i[n]=o,o},as.getContextMeta=function(e){var t,a=this,i="",n=e._private.styleCxtKey||"";a._private.newStyle&&(n="");for(var s=0;s<a.length;s++){var o=a[s];i+=o.selector&&o.selector.matches(e)?is:"f"}return t=a.getPropertiesDiff(n,i),e._private.styleCxtKey=i,{key:i,diffPropNames:t,empty:0===t.length}},as.getContextStyle=function(e){var t=e.key,a=this._private.contextStyles=this._private.contextStyles||{};if(a[t])return a[t];for(var i={_private:{key:t}},n=0;n<this.length;n++){var s=this[n];if(t[n]===is)for(var o=0;o<s.properties.length;o++){var r=s.properties[o];i[r.name]=r}}return a[t]=i,i},as.applyContextStyle=function(e,t,a){for(var i=e.diffPropNames,n={},s=this.types,o=0;o<i.length;o++){var r=i[o],l=t[r],c=a.pstyle(r);if(!l){if(!c)continue;l=c.bypass?{name:r,deleteBypassed:!0}:{name:r,delete:!0}}if(c!==l){if(l.mapped===s.fn&&null!=c&&null!=c.mapping&&c.mapping.value===l.value){var d=c.mapping;if((d.fnValue=l.value(a))===d.prevFnValue)continue}var u=n[r]={prev:c};this.applyParsedProperty(a,l),u.next=a.pstyle(r),u.next&&u.next.bypass&&(u.next=u.next.bypassed)}}return{diffProps:n}},as.updateStyleHints=function(e){var t=e._private,a=this,i=a.propertyGroupNames,n=a.propertyGroupKeys,s=function(e,t,i){return a.getPropertiesHash(e,t,i)},o=t.styleKey;if(e.removed())return!1;var r="nodes"===t.group,l=e._private.style;i=Object.keys(l);for(var c=0;c<n.length;c++){var d=n[c];t.styleKeys[d]=0}for(var u=function(e,a){return t.styleKeys[a]=Y(e,t.styleKeys[a])},p=function(e,t){for(var a=0;a<e.length;a++)u(e.charCodeAt(a),t)},m=function(e){return-128<e&&e<128&&Math.floor(e)!==e?2e9-(1024*e|0):e},b=0;b<i.length;b++){var f=i[b],h=l[f];if(null!=h){var g=this.properties[f],j=g.type,x=g.groupKey,v=void 0;null!=g.hashOverride?v=g.hashOverride(e,h):null!=h.pfValue&&(v=h.pfValue);var y=null==g.enums?h.value:null,O=null!=v,E=O||null!=y,w=h.units;if(j.number&&E){var M=O?v:y;if(j.multiple)for(var S=0;S<M.length;S++)u(m(M[S]),x);else u(m(M),x);O||null==w||p(w,x)}else p(h.strValue,x)}}for(var _=0,T=0;T<n.length;T++){var C=n[T],k=t.styleKeys[C];_=Y(k,_)}t.styleKey=_;var F=t.labelDimsKey=t.styleKeys.labelDimensions;if(t.labelKey=s(e,["label"],F),t.labelStyleKey=Y(t.styleKeys.commonLabel,t.labelKey),r||(t.sourceLabelKey=s(e,["source-label"],F),t.sourceLabelStyleKey=Y(t.styleKeys.commonLabel,t.sourceLabelKey),t.targetLabelKey=s(e,["target-label"],F),t.targetLabelStyleKey=Y(t.styleKeys.commonLabel,t.targetLabelKey)),r){var I=t.styleKeys,D=I.nodeBody,A=I.nodeBorder,L=I.backgroundImage,R=I.compound,N=I.pie;t.nodeKey=X([A,L,R,N],D),t.hasPie=0!=N}return o!==t.styleKey},as.clearStyleHints=function(e){var t=e._private;t.styleKeys={},t.styleKey=null,t.labelKey=null,t.labelStyleKey=null,t.sourceLabelKey=null,t.sourceLabelStyleKey=null,t.targetLabelKey=null,t.targetLabelStyleKey=null,t.nodeKey=null,t.hasPie=null},as.applyParsedProperty=function(e,t){var a,i=this,n=t,s=e._private.style,o=i.types,r=i.properties[n.name].type,l=n.bypass,c=s[n.name],d=c&&c.bypass,u=e._private,p="mapping",m=function(e){return null==e?null:null!=e.pfValue?e.pfValue:e.value},b=function(){var t=m(c),a=m(n);i.checkTriggers(e,n.name,t,a)};if("curve-style"===t.name&&e.isEdge()&&("bezier"!==t.value&&e.isLoop()||"haystack"===t.value&&(e.source().isParent()||e.target().isParent()))&&(n=t=this.parse(t.name,"bezier",l)),n.delete)return s[n.name]=void 0,b(),!0;if(n.deleteBypassed)return c?!!c.bypass&&(c.bypassed=void 0,b(),!0):(b(),!0);if(n.deleteBypass)return c?!!c.bypass&&(s[n.name]=c.bypassed,b(),!0):(b(),!0);var f=function(){de("Do not assign mappings to elements without corresponding data (i.e. ele `"+e.id()+"` has no mapping for property `"+n.name+"` with data field `"+n.field+"`); try a `["+n.field+"]` selector to limit scope to elements with `"+n.field+"` defined")};switch(n.mapped){case o.mapData:for(var h,g=n.field.split("."),j=u.data,x=0;x<g.length&&j;x++)j=j[g[x]];if(null==j)return f(),!1;if(!O(j))return de("Do not use continuous mappers without specifying numeric data (i.e. `"+n.field+": "+j+"` for `"+e.id()+"` is non-numeric)"),!1;var v=n.fieldMax-n.fieldMin;if((h=0===v?0:(j-n.fieldMin)/v)<0?h=0:h>1&&(h=1),r.color){var y=n.valueMin[0],E=n.valueMax[0],w=n.valueMin[1],M=n.valueMax[1],S=n.valueMin[2],_=n.valueMax[2],T=null==n.valueMin[3]?1:n.valueMin[3],C=null==n.valueMax[3]?1:n.valueMax[3],k=[Math.round(y+(E-y)*h),Math.round(w+(M-w)*h),Math.round(S+(_-S)*h),Math.round(T+(C-T)*h)];a={bypass:n.bypass,name:n.name,value:k,strValue:"rgb("+k[0]+", "+k[1]+", "+k[2]+")"}}else{if(!r.number)return!1;var F=n.valueMin+(n.valueMax-n.valueMin)*h;a=this.parse(n.name,F,n.bypass,p)}if(!a)return f(),!1;a.mapping=n,n=a;break;case o.data:for(var I=n.field.split("."),D=u.data,A=0;A<I.length&&D;A++)D=D[I[A]];if(null!=D&&(a=this.parse(n.name,D,n.bypass,p)),!a)return f(),!1;a.mapping=n,n=a;break;case o.fn:var L=n.value,R=null!=n.fnValue?n.fnValue:L(e);if(n.prevFnValue=R,null==R)return de("Custom function mappers may not return null (i.e. `"+n.name+"` for ele `"+e.id()+"` is null)"),!1;if(!(a=this.parse(n.name,R,n.bypass,p)))return de("Custom function mappers may not return invalid values for the property type (i.e. `"+n.name+"` for ele `"+e.id()+"` is invalid)"),!1;a.mapping=ue(n),n=a;break;case void 0:break;default:return!1}return l?(n.bypassed=d?c.bypassed:c,s[n.name]=n):d?c.bypassed=n:s[n.name]=n,b(),!0},as.cleanElements=function(e,t){for(var a=0;a<e.length;a++){var i=e[a];if(this.clearStyleHints(i),i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),t)for(var n=i._private.style,s=Object.keys(n),o=0;o<s.length;o++){var r=s[o],l=n[r];null!=l&&(l.bypass?l.bypassed=null:n[r]=null)}else i._private.style={}}},as.update=function(){this._private.cy.mutableElements().updateStyle()},as.updateTransitions=function(e,t){var a=this,i=e._private,n=e.pstyle("transition-property").value,s=e.pstyle("transition-duration").pfValue,o=e.pstyle("transition-delay").pfValue;if(n.length>0&&s>0){for(var r={},l=!1,c=0;c<n.length;c++){var d=n[c],u=e.pstyle(d),p=t[d];if(p){var m=p.prev,b=null!=p.next?p.next:u,f=!1,h=void 0,g=1e-6;m&&(O(m.pfValue)&&O(b.pfValue)?(f=b.pfValue-m.pfValue,h=m.pfValue+g*f):O(m.value)&&O(b.value)?(f=b.value-m.value,h=m.value+g*f):v(m.value)&&v(b.value)&&(f=m.value[0]!==b.value[0]||m.value[1]!==b.value[1]||m.value[2]!==b.value[2],h=m.strValue),f&&(r[d]=b.strValue,this.applyBypass(e,d,h),l=!0))}}if(!l)return;i.transitioning=!0,new Ia((function(t){o>0?e.delayAnimation(o).play().promise().then(t):t()})).then((function(){return e.animation({style:r,duration:s,easing:e.pstyle("transition-timing-function").value,queue:!1}).play().promise()})).then((function(){a.removeBypasses(e,n),e.emitAndNotify("style"),i.transitioning=!1}))}else i.transitioning&&(this.removeBypasses(e,n),e.emitAndNotify("style"),i.transitioning=!1)},as.checkTrigger=function(e,t,a,i,n,s){var o=this.properties[t],r=n(o);null!=r&&r(a,i)&&s(o)},as.checkZOrderTrigger=function(e,t,a,i){var n=this;this.checkTrigger(e,t,a,i,(function(e){return e.triggersZOrder}),(function(){n._private.cy.notify("zorder",e)}))},as.checkBoundsTrigger=function(e,t,a,i){this.checkTrigger(e,t,a,i,(function(e){return e.triggersBounds}),(function(n){e.dirtyCompoundBoundsCache(),e.dirtyBoundingBoxCache(),"bezier"!==e.pstyle("curve-style").value&&("curve-style"!==t||"bezier"!==a&&"bezier"!==i)||!n.triggersBoundsOfParallelBeziers||e.parallelEdges().forEach((function(e){e.isBundledBezier()&&e.dirtyBoundingBoxCache()}))}))},as.checkTriggers=function(e,t,a,i){e.dirtyStyleCache(),this.checkZOrderTrigger(e,t,a,i),this.checkBoundsTrigger(e,t,a,i)};var ns={applyBypass:function(e,t,a,i){var n=[];if("*"===t||"**"===t){if(void 0!==a)for(var s=0;s<this.properties.length;s++){var o=this.properties[s].name,r=this.parse(o,a,!0);r&&n.push(r)}}else if(j(t)){var l=this.parse(t,a,!0);l&&n.push(l)}else{if(!y(t))return!1;var c=t;i=a;for(var d=Object.keys(c),u=0;u<d.length;u++){var p=d[u],m=c[p];if(void 0===m&&(m=c[D(p)]),void 0!==m){var b=this.parse(p,m,!0);b&&n.push(b)}}}if(0===n.length)return!1;for(var f=!1,h=0;h<e.length;h++){for(var g=e[h],x={},v=void 0,O=0;O<n.length;O++){var E=n[O];if(i){var w=g.pstyle(E.name);v=x[E.name]={prev:w}}f=this.applyParsedProperty(g,E)||f,i&&(v.next=g.pstyle(E.name))}f&&this.updateStyleHints(g),i&&this.updateTransitions(g,x,!0)}return f},overrideBypass:function(e,t,a){t=I(t);for(var i=0;i<e.length;i++){var n=e[i],s=n._private.style[t],o=this.properties[t].type,r=o.color,l=o.mutiple,c=s?null!=s.pfValue?s.pfValue:s.value:null;s&&s.bypass?(s.value=a,null!=s.pfValue&&(s.pfValue=a),s.strValue=r?"rgb("+a.join(",")+")":l?a.join(" "):""+a,this.updateStyleHints(n)):this.applyBypass(n,t,a),this.checkTriggers(n,t,c,a)}},removeAllBypasses:function(e,t){return this.removeBypasses(e,this.propertyNames,t)},removeBypasses:function(e,t,a){for(var i=0;i<e.length;i++){for(var n=e[i],s={},o=0;o<t.length;o++){var r=t[o],l=this.properties[r],c=n.pstyle(l.name);if(c&&c.bypass){var d=this.parse(r,"",!0),u=s[l.name]={prev:c};this.applyParsedProperty(n,d),u.next=n.pstyle(l.name)}}this.updateStyleHints(n),a&&this.updateTransitions(n,s,!0)}}},ss={getEmSizeInPixels:function(){var e=this.containerCss("font-size");return null!=e?parseFloat(e):1},containerCss:function(e){var t=this._private.cy.container();if(u&&t&&u.getComputedStyle)return u.getComputedStyle(t).getPropertyValue(e)}},os={getRenderedStyle:function(e,t){return t?this.getStylePropertyValue(e,t,!0):this.getRawStyle(e,!0)},getRawStyle:function(e,t){var a=this;if(e=e[0]){for(var i={},n=0;n<a.properties.length;n++){var s=a.properties[n],o=a.getStylePropertyValue(e,s.name,t);null!=o&&(i[s.name]=o,i[D(s.name)]=o)}return i}},getIndexedStyle:function(e,t,a,i){var n=e.pstyle(t)[a][i];return null!=n?n:e.cy().style().getDefaultProperty(t)[a][0]},getStylePropertyValue:function(e,t,a){if(e=e[0]){var i=this.properties[t];i.alias&&(i=i.pointsTo);var n=i.type,s=e.pstyle(i.name);if(s){var o=s.value,r=s.units,l=s.strValue;if(a&&n.number&&null!=o&&O(o)){var c=e.cy().zoom(),d=function(e){return e*c},u=function(e,t){return d(e)+t},p=v(o);return(p?r.every((function(e){return null!=e})):null!=r)?p?o.map((function(e,t){return u(e,r[t])})).join(" "):u(o,r):p?o.map((function(e){return j(e)?e:""+d(e)})).join(" "):""+d(o)}if(null!=l)return l}return null}},getAnimationStartStyle:function(e,t){for(var a={},i=0;i<t.length;i++){var n=t[i].name,s=e.pstyle(n);void 0!==s&&(s=y(s)?this.parse(n,s.strValue):this.parse(n,s)),s&&(a[n]=s)}return a},getPropsList:function(e){var t=[],a=e,i=this.properties;if(a)for(var n=Object.keys(a),s=0;s<n.length;s++){var o=n[s],r=a[o],l=i[o]||i[I(o)],c=this.parse(l.name,r);c&&t.push(c)}return t},getNonDefaultPropertiesHash:function(e,t,a){var i,n,s,o,r,l,c=a;for(r=0;r<t.length;r++)if(i=t[r],null!=(n=e.pstyle(i,!1)))if(null!=n.pfValue)c=Y(o,c);else for(s=n.strValue,l=0;l<s.length;l++)o=s.charCodeAt(l),c=Y(o,c);return c}};os.getPropertiesHash=os.getNonDefaultPropertiesHash;var rs={appendFromJson:function(e){for(var t=this,a=0;a<e.length;a++){var i=e[a],n=i.selector,s=i.style||i.css,o=Object.keys(s);t.selector(n);for(var r=0;r<o.length;r++){var l=o[r],c=s[l];t.css(l,c)}}return t},fromJson:function(e){var t=this;return t.resetToDefault(),t.appendFromJson(e),t},json:function(){for(var e=[],t=this.defaultLength;t<this.length;t++){for(var a=this[t],i=a.selector,n=a.properties,s={},o=0;o<n.length;o++){var r=n[o];s[r.name]=r.strValue}e.push({selector:i?i.toString():"core",style:s})}return e}},ls={appendFromString:function(e){var t,a,i,n=this,s=""+e;function o(){s=s.length>t.length?s.substr(t.length):""}function r(){a=a.length>i.length?a.substr(i.length):""}for(s=s.replace(/[/][*](\s|.)+?[*][/]/g,"");!s.match(/^\s*$/);){var l=s.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!l){de("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+s);break}t=l[0];var c=l[1];if("core"!==c&&new ai(c).invalid)de("Skipping parsing of block: Invalid selector found in string stylesheet: "+c),o();else{var d=l[2],u=!1;a=d;for(var p=[];!a.match(/^\s*$/);){var m=a.match(/^\s*(.+?)\s*:\s*(.+?)\s*;/);if(!m){de("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+d),u=!0;break}i=m[0];var b=m[1],f=m[2];this.properties[b]?n.parse(b,f)?(p.push({name:b,val:f}),r()):(de("Skipping property: Invalid property definition in: "+i),r()):(de("Skipping property: Invalid property name in: "+i),r())}if(u){o();break}n.selector(c);for(var h=0;h<p.length;h++){var g=p[h];n.css(g.name,g.val)}o()}}return n},fromString:function(e){var t=this;return t.resetToDefault(),t.appendFromString(e),t}},cs={};!function(){var e=R,t=function(e){return"^"+e+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},a=function(t){var a=e+"|\\w+|rgb[a]?\\((?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)(?:\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))))?\\)|hsl[a]?\\((?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?)))\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%])\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%])(?:\\s*,\\s*(?:(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))))?\\)|\\#[0-9a-fA-F]{3}|\\#[0-9a-fA-F]{6}";return"^"+t+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+e+")\\s*\\,\\s*("+e+")\\s*,\\s*("+a+")\\s*\\,\\s*("+a+")\\)$"},i=["^url\\s*\\(\\s*['\"]?(.+?)['\"]?\\s*\\)$","^(none)$","^(.+)$"];cs.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","taxi"]},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","square","pentagon","hexagon","concavehexagon","concave-hexagon","heptagon","octagon","tag","star","diamond","vee","rhomboid","polygon"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:t("data")},layoutData:{mapping:!0,regex:t("layoutData")},scratch:{mapping:!0,regex:t("scratch")},mapData:{mapping:!0,regex:a("mapData")},mapLayoutData:{mapping:!0,regex:a("mapLayoutData")},mapScratch:{mapping:!0,regex:a("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:i,singleRegexMatchValue:!0},urls:{regexes:i,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(e,t){switch(e.length){case 2:return"deg"!==t[0]&&"rad"!==t[0]&&"deg"!==t[1]&&"rad"!==t[1];case 1:return j(e[0])||"deg"===t[0]||"rad"===t[0];default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+e+")\\s*,\\s*("+e+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+e+")\\s*,\\s*("+e+")\\s*,\\s*("+e+")\\s*,\\s*("+e+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(e){var t=e.length;return 1===t||2===t||4===t}}};var n={zeroNonZero:function(e,t){return(null==e||null==t)&&e!==t||0==e&&0!=t||0!=e&&0==t},any:function(e,t){return e!=t}},s=cs.types,o=[{name:"label",type:s.text,triggersBounds:n.any},{name:"text-rotation",type:s.textRotation,triggersBounds:n.any},{name:"text-margin-x",type:s.bidirectionalSize,triggersBounds:n.any},{name:"text-margin-y",type:s.bidirectionalSize,triggersBounds:n.any}],r=[{name:"source-label",type:s.text,triggersBounds:n.any},{name:"source-text-rotation",type:s.textRotation,triggersBounds:n.any},{name:"source-text-margin-x",type:s.bidirectionalSize,triggersBounds:n.any},{name:"source-text-margin-y",type:s.bidirectionalSize,triggersBounds:n.any},{name:"source-text-offset",type:s.size,triggersBounds:n.any}],l=[{name:"target-label",type:s.text,triggersBounds:n.any},{name:"target-text-rotation",type:s.textRotation,triggersBounds:n.any},{name:"target-text-margin-x",type:s.bidirectionalSize,triggersBounds:n.any},{name:"target-text-margin-y",type:s.bidirectionalSize,triggersBounds:n.any},{name:"target-text-offset",type:s.size,triggersBounds:n.any}],c=[{name:"font-family",type:s.fontFamily,triggersBounds:n.any},{name:"font-style",type:s.fontStyle,triggersBounds:n.any},{name:"font-weight",type:s.fontWeight,triggersBounds:n.any},{name:"font-size",type:s.size,triggersBounds:n.any},{name:"text-transform",type:s.textTransform,triggersBounds:n.any},{name:"text-wrap",type:s.textWrap,triggersBounds:n.any},{name:"text-overflow-wrap",type:s.textOverflowWrap,triggersBounds:n.any},{name:"text-max-width",type:s.size,triggersBounds:n.any},{name:"text-outline-width",type:s.size,triggersBounds:n.any},{name:"line-height",type:s.positiveNumber,triggersBounds:n.any}],d=[{name:"text-valign",type:s.valign,triggersBounds:n.any},{name:"text-halign",type:s.halign,triggersBounds:n.any},{name:"color",type:s.color},{name:"text-outline-color",type:s.color},{name:"text-outline-opacity",type:s.zeroOneNumber},{name:"text-background-color",type:s.color},{name:"text-background-opacity",type:s.zeroOneNumber},{name:"text-background-padding",type:s.size,triggersBounds:n.any},{name:"text-border-opacity",type:s.zeroOneNumber},{name:"text-border-color",type:s.color},{name:"text-border-width",type:s.size,triggersBounds:n.any},{name:"text-border-style",type:s.borderStyle,triggersBounds:n.any},{name:"text-background-shape",type:s.textBackgroundShape,triggersBounds:n.any},{name:"text-justification",type:s.justification}],u=[{name:"events",type:s.bool},{name:"text-events",type:s.bool}],p=[{name:"display",type:s.display,triggersZOrder:n.any,triggersBounds:n.any,triggersBoundsOfParallelBeziers:!0},{name:"visibility",type:s.visibility,triggersZOrder:n.any},{name:"opacity",type:s.zeroOneNumber,triggersZOrder:n.zeroNonZero},{name:"text-opacity",type:s.zeroOneNumber},{name:"min-zoomed-font-size",type:s.size},{name:"z-compound-depth",type:s.zCompoundDepth,triggersZOrder:n.any},{name:"z-index-compare",type:s.zIndexCompare,triggersZOrder:n.any},{name:"z-index",type:s.nonNegativeInt,triggersZOrder:n.any}],m=[{name:"overlay-padding",type:s.size,triggersBounds:n.any},{name:"overlay-color",type:s.color},{name:"overlay-opacity",type:s.zeroOneNumber,triggersBounds:n.zeroNonZero}],b=[{name:"transition-property",type:s.propList},{name:"transition-duration",type:s.time},{name:"transition-delay",type:s.time},{name:"transition-timing-function",type:s.easing}],f=function(e,t){return"label"===t.value?-e.poolIndex():t.pfValue},h=[{name:"height",type:s.nodeSize,triggersBounds:n.any,hashOverride:f},{name:"width",type:s.nodeSize,triggersBounds:n.any,hashOverride:f},{name:"shape",type:s.nodeShape,triggersBounds:n.any},{name:"shape-polygon-points",type:s.polygonPointList,triggersBounds:n.any},{name:"background-color",type:s.color},{name:"background-fill",type:s.fill},{name:"background-opacity",type:s.zeroOneNumber},{name:"background-blacken",type:s.nOneOneNumber},{name:"background-gradient-stop-colors",type:s.colors},{name:"background-gradient-stop-positions",type:s.percentages},{name:"background-gradient-direction",type:s.gradientDirection},{name:"padding",type:s.sizeMaybePercent,triggersBounds:n.any},{name:"padding-relative-to",type:s.paddingRelativeTo,triggersBounds:n.any},{name:"bounds-expansion",type:s.boundsExpansion,triggersBounds:n.any}],g=[{name:"border-color",type:s.color},{name:"border-opacity",type:s.zeroOneNumber},{name:"border-width",type:s.size,triggersBounds:n.any},{name:"border-style",type:s.borderStyle}],x=[{name:"background-image",type:s.urls},{name:"background-image-crossorigin",type:s.bgCrossOrigin},{name:"background-image-opacity",type:s.zeroOneNumbers},{name:"background-position-x",type:s.bgPos},{name:"background-position-y",type:s.bgPos},{name:"background-width-relative-to",type:s.bgRelativeTo},{name:"background-height-relative-to",type:s.bgRelativeTo},{name:"background-repeat",type:s.bgRepeat},{name:"background-fit",type:s.bgFit},{name:"background-clip",type:s.bgClip},{name:"background-width",type:s.bgWH},{name:"background-height",type:s.bgWH},{name:"background-offset-x",type:s.bgPos},{name:"background-offset-y",type:s.bgPos}],v=[{name:"position",type:s.position,triggersBounds:n.any},{name:"compound-sizing-wrt-labels",type:s.compoundIncludeLabels,triggersBounds:n.any},{name:"min-width",type:s.size,triggersBounds:n.any},{name:"min-width-bias-left",type:s.sizeMaybePercent,triggersBounds:n.any},{name:"min-width-bias-right",type:s.sizeMaybePercent,triggersBounds:n.any},{name:"min-height",type:s.size,triggersBounds:n.any},{name:"min-height-bias-top",type:s.sizeMaybePercent,triggersBounds:n.any},{name:"min-height-bias-bottom",type:s.sizeMaybePercent,triggersBounds:n.any}],y=[{name:"line-style",type:s.lineStyle},{name:"line-color",type:s.color},{name:"line-fill",type:s.fill},{name:"line-cap",type:s.lineCap},{name:"line-dash-pattern",type:s.numbers},{name:"line-dash-offset",type:s.number},{name:"line-gradient-stop-colors",type:s.colors},{name:"line-gradient-stop-positions",type:s.percentages},{name:"curve-style",type:s.curveStyle,triggersBounds:n.any,triggersBoundsOfParallelBeziers:!0},{name:"haystack-radius",type:s.zeroOneNumber,triggersBounds:n.any},{name:"source-endpoint",type:s.edgeEndpoint,triggersBounds:n.any},{name:"target-endpoint",type:s.edgeEndpoint,triggersBounds:n.any},{name:"control-point-step-size",type:s.size,triggersBounds:n.any},{name:"control-point-distances",type:s.bidirectionalSizes,triggersBounds:n.any},{name:"control-point-weights",type:s.numbers,triggersBounds:n.any},{name:"segment-distances",type:s.bidirectionalSizes,triggersBounds:n.any},{name:"segment-weights",type:s.numbers,triggersBounds:n.any},{name:"taxi-turn",type:s.sizeMaybePercent,triggersBounds:n.any},{name:"taxi-turn-min-distance",type:s.size,triggersBounds:n.any},{name:"taxi-direction",type:s.axisDirection,triggersBounds:n.any},{name:"edge-distances",type:s.edgeDistances,triggersBounds:n.any},{name:"arrow-scale",type:s.positiveNumber,triggersBounds:n.any},{name:"loop-direction",type:s.angle,triggersBounds:n.any},{name:"loop-sweep",type:s.angle,triggersBounds:n.any},{name:"source-distance-from-node",type:s.size,triggersBounds:n.any},{name:"target-distance-from-node",type:s.size,triggersBounds:n.any}],O=[{name:"ghost",type:s.bool,triggersBounds:n.any},{name:"ghost-offset-x",type:s.bidirectionalSize,triggersBounds:n.any},{name:"ghost-offset-y",type:s.bidirectionalSize,triggersBounds:n.any},{name:"ghost-opacity",type:s.zeroOneNumber}],E=[{name:"selection-box-color",type:s.color},{name:"selection-box-opacity",type:s.zeroOneNumber},{name:"selection-box-border-color",type:s.color},{name:"selection-box-border-width",type:s.size},{name:"active-bg-color",type:s.color},{name:"active-bg-opacity",type:s.zeroOneNumber},{name:"active-bg-size",type:s.size},{name:"outside-texture-bg-color",type:s.color},{name:"outside-texture-bg-opacity",type:s.zeroOneNumber}],w=[];cs.pieBackgroundN=16,w.push({name:"pie-size",type:s.sizeMaybePercent});for(var M=1;M<=cs.pieBackgroundN;M++)w.push({name:"pie-"+M+"-background-color",type:s.color}),w.push({name:"pie-"+M+"-background-size",type:s.percent}),w.push({name:"pie-"+M+"-background-opacity",type:s.zeroOneNumber});var S=[],_=cs.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:s.arrowShape,triggersBounds:n.any},{name:"arrow-color",type:s.color},{name:"arrow-fill",type:s.arrowFill}].forEach((function(e){_.forEach((function(t){var a=t+"-"+e.name,i=e.type,n=e.triggersBounds;S.push({name:a,type:i,triggersBounds:n})}))}),{});var T=cs.properties=[].concat(u,b,p,m,O,d,c,o,r,l,h,g,x,w,v,y,S,E),C=cs.propertyGroups={behavior:u,transition:b,visibility:p,overlay:m,ghost:O,commonLabel:d,labelDimensions:c,mainLabel:o,sourceLabel:r,targetLabel:l,nodeBody:h,nodeBorder:g,backgroundImage:x,pie:w,compound:v,edgeLine:y,edgeArrow:S,core:E},k=cs.propertyGroupNames={};(cs.propertyGroupKeys=Object.keys(C)).forEach((function(e){k[e]=C[e].map((function(e){return e.name})),C[e].forEach((function(t){return t.groupKey=e}))}));var F=cs.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];cs.propertyNames=T.map((function(e){return e.name}));for(var I=0;I<T.length;I++){var D=T[I];T[D.name]=D}for(var A=0;A<F.length;A++){var L=F[A],N=T[L.pointsTo],P={name:L.name,alias:!0,pointsTo:N};T.push(P),T[L.name]=P}}(),cs.getDefaultProperty=function(e){return this.getDefaultProperties()[e]},cs.getDefaultProperties=function(){var e=this._private;if(null!=e.defaultProperties)return e.defaultProperties;for(var t=P({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce((function(e,t){for(var a=1;a<=cs.pieBackgroundN;a++){var i=t.name.replace("{{i}}",a),n=t.value;e[i]=n}return e}),{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"taxi-turn":"50%","taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"}].reduce((function(e,t){return cs.arrowPrefixes.forEach((function(a){var i=a+"-"+t.name,n=t.value;e[i]=n})),e}),{})),a={},i=0;i<this.properties.length;i++){var n=this.properties[i];if(!n.pointsTo){var s=n.name,o=t[s],r=this.parse(s,o);a[s]=r}}return e.defaultProperties=a,e.defaultProperties},cs.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var ds={parse:function(e,t,a,i){var n=this;if(x(t))return n.parseImplWarn(e,t,a,i);var s,o=K(e,""+t,a?"t":"f","mapping"===i||!0===i||!1===i||null==i?"dontcare":i),r=n.propCache=n.propCache||[];return(s=r[o])||(s=r[o]=n.parseImplWarn(e,t,a,i)),(a||"mapping"===i)&&(s=ue(s))&&(s.value=ue(s.value)),s},parseImplWarn:function(e,t,a,i){var n=this.parseImpl(e,t,a,i);return n||null==t||de("The style property `".concat(e,": ").concat(t,"` is invalid")),n}};ds.parseImpl=function(e,t,a,i){var n=this;e=I(e);var s=n.properties[e],o=t,r=n.types;if(!s)return null;if(void 0===t)return null;s.alias&&(s=s.pointsTo,e=s.name);var l=j(t);l&&(t=t.trim());var c,d,u=s.type;if(!u)return null;if(a&&(""===t||null===t))return{name:e,value:t,bypass:!0,deleteBypass:!0};if(x(t))return{name:e,value:t,strValue:"fn",mapped:r.fn,bypass:a};if(!l||i||t.length<7||"a"!==t[1]);else{if(t.length>=7&&"d"===t[0]&&(c=new RegExp(r.data.regex).exec(t))){if(a)return!1;var p=r.data;return{name:e,value:c,strValue:""+t,mapped:p,field:c[1],bypass:a}}if(t.length>=10&&"m"===t[0]&&(d=new RegExp(r.mapData.regex).exec(t))){if(a)return!1;if(u.multiple)return!1;var m=r.mapData;if(!u.color&&!u.number)return!1;var b=this.parse(e,d[4]);if(!b||b.mapped)return!1;var f=this.parse(e,d[5]);if(!f||f.mapped)return!1;if(b.pfValue===f.pfValue||b.strValue===f.strValue)return de("`"+e+": "+t+"` is not a valid mapper because the output range is zero; converting to `"+e+": "+b.strValue+"`"),this.parse(e,b.strValue);if(u.color){var h=b.value,g=f.value;if(!(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]&&(null!=h[3]&&1!==h[3]||null!=g[3]&&1!==g[3])))return!1}return{name:e,value:d,strValue:""+t,mapped:m,field:d[1],fieldMin:parseFloat(d[2]),fieldMax:parseFloat(d[3]),valueMin:b.value,valueMax:f.value,bypass:a}}}if(u.multiple&&"multiple"!==i){var y;if(y=l?t.split(/\s+/):v(t)?t:[t],u.evenMultiple&&y.length%2!=0)return null;for(var E=[],w=[],M=[],S="",_=!1,T=0;T<y.length;T++){var C=n.parse(e,y[T],a,"multiple");_=_||j(C.value),E.push(C.value),M.push(null!=C.pfValue?C.pfValue:C.value),w.push(C.units),S+=(T>0?" ":"")+C.strValue}return u.validate&&!u.validate(E,w)?null:u.singleEnum&&_?1===E.length&&j(E[0])?{name:e,value:E[0],strValue:E[0],bypass:a}:null:{name:e,value:E,pfValue:M,strValue:S,bypass:a,units:w}}var k,F,D,A=function(){for(var i=0;i<u.enums.length;i++)if(u.enums[i]===t)return{name:e,value:t,strValue:""+t,bypass:a};return null};if(u.number){var L,N="px";if(u.units&&(L=u.units),u.implicitUnits&&(N=u.implicitUnits),!u.unitless)if(l){var P="px|em"+(u.allowPercent?"|\\%":"");L&&(P=L);var B=t.match("^("+R+")("+P+")?$");B&&(t=B[1],L=B[2]||N)}else L&&!u.implicitUnits||(L=N);if(t=parseFloat(t),isNaN(t)&&void 0===u.enums)return null;if(isNaN(t)&&void 0!==u.enums)return t=o,A();if(u.integer&&(!O(F=t)||Math.floor(F)!==F))return null;if(void 0!==u.min&&(t<u.min||u.strictMin&&t===u.min)||void 0!==u.max&&(t>u.max||u.strictMax&&t===u.max))return null;var V={name:e,value:t,strValue:""+t+(L||""),units:L,bypass:a};return u.unitless||"px"!==L&&"em"!==L?V.pfValue=t:V.pfValue="px"!==L&&L?this.getEmSizeInPixels()*t:t,"ms"!==L&&"s"!==L||(V.pfValue="ms"===L?t:1e3*t),"deg"!==L&&"rad"!==L||(V.pfValue="rad"===L?t:(k=t,Math.PI*k/180)),"%"===L&&(V.pfValue=t/100),V}if(u.propList){var J=[],U=""+t;if("none"===U);else{for(var G=U.split(/\s*,\s*|\s+/),q=0;q<G.length;q++){var $=G[q].trim();n.properties[$]?J.push($):de("`"+$+"` is not a valid property name")}if(0===J.length)return null}return{name:e,value:J,strValue:0===J.length?"none":J.join(" "),bypass:a}}if(u.color){var W=(v(D=t)?D:null)||function(e){return z[e.toLowerCase()]}(D)||function(e){if((4===e.length||7===e.length)&&"#"===e[0]){var t,a,i,n=16;return 4===e.length?(t=parseInt(e[1]+e[1],n),a=parseInt(e[2]+e[2],n),i=parseInt(e[3]+e[3],n)):(t=parseInt(e[1]+e[2],n),a=parseInt(e[3]+e[4],n),i=parseInt(e[5]+e[6],n)),[t,a,i]}}(D)||function(e){var t,a=new RegExp("^rgb[a]?\\(((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%]?)(?:\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))))?\\)$").exec(e);if(a){t=[];for(var i=[],n=1;n<=3;n++){var s=a[n];if("%"===s[s.length-1]&&(i[n]=!0),s=parseFloat(s),i[n]&&(s=s/100*255),s<0||s>255)return;t.push(Math.floor(s))}var o=i[1]||i[2]||i[3],r=i[1]&&i[2]&&i[3];if(o&&!r)return;var l=a[4];if(void 0!==l){if((l=parseFloat(l))<0||l>1)return;t.push(l)}}return t}(D)||function(e){var t,a,i,n,s,o,r,l;function c(e,t,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?e+6*(t-e)*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e}var d=new RegExp("^hsl[a]?\\(((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?)))\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%])\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))[%])(?:\\s*,\\s*((?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))))?\\)$").exec(e);if(d){if((a=parseInt(d[1]))<0?a=(360- -1*a%360)%360:a>360&&(a%=360),a/=360,(i=parseFloat(d[2]))<0||i>100)return;if(i/=100,(n=parseFloat(d[3]))<0||n>100)return;if(n/=100,void 0!==(s=d[4])&&((s=parseFloat(s))<0||s>1))return;if(0===i)o=r=l=Math.round(255*n);else{var u=n<.5?n*(1+i):n+i-n*i,p=2*n-u;o=Math.round(255*c(p,u,a+1/3)),r=Math.round(255*c(p,u,a)),l=Math.round(255*c(p,u,a-1/3))}t=[o,r,l,s]}return t}(D);return W?{name:e,value:W,pfValue:W,strValue:"rgb("+W[0]+","+W[1]+","+W[2]+")",bypass:a}:null}if(u.regex||u.regexes){if(u.enums){var H=A();if(H)return H}for(var Y=u.regexes?u.regexes:[u.regex],X=0;X<Y.length;X++){var Q=new RegExp(Y[X]).exec(t);if(Q)return{name:e,value:u.singleRegexMatchValue?Q[1]:Q,strValue:""+t,bypass:a}}return null}return u.string?{name:e,value:""+t,strValue:""+t,bypass:a}:u.enums?A():null};var us=function e(t){if(!(this instanceof e))return new e(t);_(t)?(this._private={cy:t,coreStyle:{}},this.length=0,this.resetToDefault()):le("A style must have a core reference")},ps=us.prototype;ps.instanceString=function(){return"style"},ps.clear=function(){for(var e=0;e<this.length;e++)this[e]=void 0;return this.length=0,this._private.newStyle=!0,this},ps.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this},ps.core=function(e){return this._private.coreStyle[e]||this.getDefaultProperty(e)},ps.selector=function(e){var t="core"===e?null:new ai(e),a=this.length++;return this[a]={selector:t,properties:[],mappedProperties:[],index:a},this},ps.css=function(){var e=this,t=arguments;if(1===t.length)for(var a=t[0],i=0;i<e.properties.length;i++){var n=e.properties[i],s=a[n.name];void 0===s&&(s=a[D(n.name)]),void 0!==s&&this.cssRule(n.name,s)}else 2===t.length&&this.cssRule(t[0],t[1]);return this},ps.style=ps.css,ps.cssRule=function(e,t){var a=this.parse(e,t);if(a){var i=this.length-1;this[i].properties.push(a),this[i].properties[a.name]=a,a.name.match(/pie-(\d+)-background-size/)&&a.value&&(this._private.hasPie=!0),a.mapped&&this[i].mappedProperties.push(a),!this[i].selector&&(this._private.coreStyle[a.name]=a)}return this},ps.append=function(e){return T(e)?e.appendToStyle(this):v(e)?this.appendFromJson(e):j(e)&&this.appendFromString(e),this},us.fromJson=function(e,t){var a=new us(e);return a.fromJson(t),a},us.fromString=function(e,t){return new us(e).fromString(t)},[as,ns,ss,os,rs,ls,cs,ds].forEach((function(e){P(ps,e)})),us.types=ps.types,us.properties=ps.properties,us.propertyGroups=ps.propertyGroups,us.propertyGroupNames=ps.propertyGroupNames,us.propertyGroupKeys=ps.propertyGroupKeys;var ms={style:function(e){return e&&this.setStyle(e).update(),this._private.style},setStyle:function(e){var t=this._private;return T(e)?t.style=e.generateStyle(this):v(e)?t.style=us.fromJson(this,e):j(e)?t.style=us.fromString(this,e):t.style=us(this),t.style}},bs={autolock:function(e){return void 0===e?this._private.autolock:(this._private.autolock=!!e,this)},autoungrabify:function(e){return void 0===e?this._private.autoungrabify:(this._private.autoungrabify=!!e,this)},autounselectify:function(e){return void 0===e?this._private.autounselectify:(this._private.autounselectify=!!e,this)},selectionType:function(e){var t=this._private;return null==t.selectionType&&(t.selectionType="single"),void 0===e?t.selectionType:("additive"!==e&&"single"!==e||(t.selectionType=e),this)},panningEnabled:function(e){return void 0===e?this._private.panningEnabled:(this._private.panningEnabled=!!e,this)},userPanningEnabled:function(e){return void 0===e?this._private.userPanningEnabled:(this._private.userPanningEnabled=!!e,this)},zoomingEnabled:function(e){return void 0===e?this._private.zoomingEnabled:(this._private.zoomingEnabled=!!e,this)},userZoomingEnabled:function(e){return void 0===e?this._private.userZoomingEnabled:(this._private.userZoomingEnabled=!!e,this)},boxSelectionEnabled:function(e){return void 0===e?this._private.boxSelectionEnabled:(this._private.boxSelectionEnabled=!!e,this)},pan:function(){var e,t,a,i,n,s=arguments,o=this._private.pan;switch(s.length){case 0:return o;case 1:if(j(s[0]))return o[e=s[0]];if(y(s[0])){if(!this._private.panningEnabled)return this;i=(a=s[0]).x,n=a.y,O(i)&&(o.x=i),O(n)&&(o.y=n),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;e=s[0],t=s[1],"x"!==e&&"y"!==e||!O(t)||(o[e]=t),this.emit("pan viewport")}return this.notify("viewport"),this},panBy:function(e,t){var a,i,n,s,o,r=arguments,l=this._private.pan;if(!this._private.panningEnabled)return this;switch(r.length){case 1:y(e)&&(s=(n=r[0]).x,o=n.y,O(s)&&(l.x+=s),O(o)&&(l.y+=o),this.emit("pan viewport"));break;case 2:i=t,"x"!==(a=e)&&"y"!==a||!O(i)||(l[a]+=i),this.emit("pan viewport")}return this.notify("viewport"),this},fit:function(e,t){var a=this.getFitViewport(e,t);if(a){var i=this._private;i.zoom=a.zoom,i.pan=a.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(e,t){if(O(e)&&void 0===t&&(t=e,e=void 0),this._private.panningEnabled&&this._private.zoomingEnabled){var a,i;if(j(e)){var n=e;e=this.$(n)}else if(y(i=e)&&O(i.x1)&&O(i.x2)&&O(i.y1)&&O(i.y2)){var s=e;(a={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2}).w=a.x2-a.x1,a.h=a.y2-a.y1}else w(e)||(e=this.mutableElements());if(!w(e)||!e.empty()){a=a||e.boundingBox();var o,r=this.width(),l=this.height();if(t=O(t)?t:0,!isNaN(r)&&!isNaN(l)&&r>0&&l>0&&!isNaN(a.w)&&!isNaN(a.h)&&a.w>0&&a.h>0)return{zoom:o=(o=(o=Math.min((r-2*t)/a.w,(l-2*t)/a.h))>this._private.maxZoom?this._private.maxZoom:o)<this._private.minZoom?this._private.minZoom:o,pan:{x:(r-o*(a.x1+a.x2))/2,y:(l-o*(a.y1+a.y2))/2}}}}},zoomRange:function(e,t){var a=this._private;if(null==t){var i=e;e=i.min,t=i.max}return O(e)&&O(t)&&e<=t?(a.minZoom=e,a.maxZoom=t):O(e)&&void 0===t&&e<=a.maxZoom?a.minZoom=e:O(t)&&void 0===e&&t>=a.minZoom&&(a.maxZoom=t),this},minZoom:function(e){return void 0===e?this._private.minZoom:this.zoomRange({min:e})},maxZoom:function(e){return void 0===e?this._private.maxZoom:this.zoomRange({max:e})},getZoomedViewport:function(e){var t,a,i=this._private,n=i.pan,s=i.zoom,o=!1;if(i.zoomingEnabled||(o=!0),O(e)?a=e:y(e)&&(a=e.level,null!=e.position?t=ze(e.position,s,n):null!=e.renderedPosition&&(t=e.renderedPosition),null==t||i.panningEnabled||(o=!0)),a=(a=a>i.maxZoom?i.maxZoom:a)<i.minZoom?i.minZoom:a,o||!O(a)||a===s||null!=t&&(!O(t.x)||!O(t.y)))return null;if(null!=t){var r=n,l=s,c=a;return{zoomed:!0,panned:!0,zoom:c,pan:{x:-c/l*(t.x-r.x)+t.x,y:-c/l*(t.y-r.y)+t.y}}}return{zoomed:!0,panned:!1,zoom:a,pan:n}},zoom:function(e){if(void 0===e)return this._private.zoom;var t=this.getZoomedViewport(e),a=this._private;return null!=t&&t.zoomed?(a.zoom=t.zoom,t.panned&&(a.pan.x=t.pan.x,a.pan.y=t.pan.y),this.emit("zoom"+(t.panned?" pan":"")+" viewport"),this.notify("viewport"),this):this},viewport:function(e){var t=this._private,a=!0,i=!0,n=[],s=!1,o=!1;if(!e)return this;if(O(e.zoom)||(a=!1),y(e.pan)||(i=!1),!a&&!i)return this;if(a){var r=e.zoom;r<t.minZoom||r>t.maxZoom||!t.zoomingEnabled?s=!0:(t.zoom=r,n.push("zoom"))}if(i&&(!s||!e.cancelOnFailedZoom)&&t.panningEnabled){var l=e.pan;O(l.x)&&(t.pan.x=l.x,o=!1),O(l.y)&&(t.pan.y=l.y,o=!1),o||n.push("pan")}return n.length>0&&(n.push("viewport"),this.emit(n.join(" ")),this.notify("viewport")),this},center:function(e){var t=this.getCenterPan(e);return t&&(this._private.pan=t,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(e,t){if(this._private.panningEnabled){if(j(e)){var a=e;e=this.mutableElements().filter(a)}else w(e)||(e=this.mutableElements());if(0!==e.length){var i=e.boundingBox(),n=this.width(),s=this.height();return{x:(n-(t=void 0===t?this._private.zoom:t)*(i.x1+i.x2))/2,y:(s-t*(i.y1+i.y2))/2}}}},reset:function(){return this._private.panningEnabled&&this._private.zoomingEnabled?(this.viewport({pan:{x:0,y:0},zoom:1}),this):this},invalidateSize:function(){this._private.sizeCache=null},size:function(){var e,t,a=this._private,i=a.container;return a.sizeCache=a.sizeCache||(i?(e=u.getComputedStyle(i),t=function(t){return parseFloat(e.getPropertyValue(t))},{width:i.clientWidth-t("padding-left")-t("padding-right"),height:i.clientHeight-t("padding-top")-t("padding-bottom")}):{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var e=this._private.pan,t=this._private.zoom,a=this.renderedExtent(),i={x1:(a.x1-e.x)/t,x2:(a.x2-e.x)/t,y1:(a.y1-e.y)/t,y2:(a.y2-e.y)/t};return i.w=i.x2-i.x1,i.h=i.y2-i.y1,i},renderedExtent:function(){var e=this.width(),t=this.height();return{x1:0,y1:0,x2:e,y2:t,w:e,h:t}}};bs.centre=bs.center,bs.autolockNodes=bs.autolock,bs.autoungrabifyNodes=bs.autoungrabify;var fs={data:Pa.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0}),removeData:Pa.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0}),scratch:Pa.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0}),removeScratch:Pa.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0})};fs.attr=fs.data,fs.removeAttr=fs.removeData;var hs=function(e){var t=this,a=(e=P({},e)).container;a&&!E(a)&&E(a[0])&&(a=a[0]);var i=a?a._cyreg:null;(i=i||{})&&i.cy&&(i.cy.destroy(),i={});var n=i.readies=i.readies||[];a&&(a._cyreg=i),i.cy=t;var s=void 0!==u&&void 0!==a&&!e.headless,o=e;o.layout=P({name:s?"grid":"null"},o.layout),o.renderer=P({name:s?"canvas":"null"},o.renderer);var r=function(e,t,a){return void 0!==t?t:void 0!==a?a:e},l=this._private={container:a,ready:!1,options:o,elements:new Dn(this),listeners:[],aniEles:new Dn(this),data:{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:r(!0,o.zoomingEnabled),userZoomingEnabled:r(!0,o.userZoomingEnabled),panningEnabled:r(!0,o.panningEnabled),userPanningEnabled:r(!0,o.userPanningEnabled),boxSelectionEnabled:r(!0,o.boxSelectionEnabled),autolock:r(!1,o.autolock,o.autolockNodes),autoungrabify:r(!1,o.autoungrabify,o.autoungrabifyNodes),autounselectify:r(!1,o.autounselectify),styleEnabled:void 0===o.styleEnabled?s:o.styleEnabled,zoom:O(o.zoom)?o.zoom:1,pan:{x:y(o.pan)&&O(o.pan.x)?o.pan.x:0,y:y(o.pan)&&O(o.pan.y)?o.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1};this.createEmitter(),this.selectionType(o.selectionType),this.zoomRange({min:o.minZoom,max:o.maxZoom}),l.styleEnabled&&t.setStyle([]);var c=P({},o,o.renderer);t.initRenderer(c),function(e,t){if(e.some(k))return Ia.all(e).then(t);t(e)}([o.style,o.elements],(function(e){var a=e[0],s=e[1];l.styleEnabled&&t.style().append(a),function(e,a,i){t.notifications(!1);var n=t.mutableElements();n.length>0&&n.remove(),null!=e&&(y(e)||v(e))&&t.add(e),t.one("layoutready",(function(e){t.notifications(!0),t.emit(e),t.one("load",a),t.emitAndNotify("load")})).one("layoutstop",(function(){t.one("done",i),t.emit("done")}));var s=P({},t._private.options.layout);s.eles=t.elements(),t.layout(s).run()}(s,(function(){t.startAnimationLoop(),l.ready=!0,x(o.ready)&&t.on("ready",o.ready);for(var e=0;e<n.length;e++){var a=n[e];t.on("ready",a)}i&&(i.readies=[]),t.emit("ready")}),o.done)}))},gs=hs.prototype;P(gs,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(e){return this.isReady()?this.emitter().emit("ready",[],e):this.on("ready",e),this},destroy:function(){var e=this;if(!e.destroyed())return e.stopAnimationLoop(),e.destroyRenderer(),this.emit("destroy"),e._private.destroyed=!0,e},hasElementWithId:function(e){return this._private.elements.hasElementWithId(e)},getElementById:function(e){return this._private.elements.getElementById(e)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(e){return this._private.elements.merge(e),this},removeFromPool:function(e){return this._private.elements.unmerge(e),this},container:function(){return this._private.container||null},mount:function(e){if(null!=e){var t=this,a=t._private,i=a.options;return!E(e)&&E(e[0])&&(e=e[0]),t.stopAnimationLoop(),t.destroyRenderer(),a.container=e,a.styleEnabled=!0,t.invalidateSize(),t.initRenderer(P({},i,i.renderer,{name:"null"===i.renderer.name?"canvas":i.renderer.name})),t.startAnimationLoop(),t.style(i.style),t.emit("mount"),t}},unmount:function(){var e=this;return e.stopAnimationLoop(),e.destroyRenderer(),e.initRenderer({name:"null"}),e.emit("unmount"),e},options:function(){return ue(this._private.options)},json:function(e){var t=this,a=t._private,i=t.mutableElements();if(y(e)){if(t.startBatch(),e.elements){var n={},s=function(e,a){for(var i=[],s=[],o=0;o<e.length;o++){var r=e[o],l=""+r.data.id,c=t.getElementById(l);n[l]=!0,0!==c.length?s.push({ele:c,json:r}):a?(r.group=a,i.push(r)):i.push(r)}t.add(i);for(var d=0;d<s.length;d++){var u=s[d],p=u.ele,m=u.json;p.json(m)}};if(v(e.elements))s(e.elements);else for(var o=["nodes","edges"],r=0;r<o.length;r++){var l=o[r],c=e.elements[l];v(c)&&s(c,l)}var d=t.collection();i.filter((function(e){return!n[e.id()]})).forEach((function(e){e.isParent()?d.merge(e):e.remove()})),d.forEach((function(e){return e.children().move({parent:null})})),d.forEach((function(e){return function(e){return t.getElementById(e.id())}(e).remove()}))}e.style&&t.style(e.style),null!=e.zoom&&e.zoom!==a.zoom&&t.zoom(e.zoom),e.pan&&(e.pan.x===a.pan.x&&e.pan.y===a.pan.y||t.pan(e.pan)),e.data&&t.data(e.data);for(var u=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify"],p=0;p<u.length;p++){var m=u[p];null!=e[m]&&t[m](e[m])}return t.endBatch(),this}var b={};e?b.elements=this.elements().map((function(e){return e.json()})):(b.elements={},i.forEach((function(e){var t=e.group();b.elements[t]||(b.elements[t]=[]),b.elements[t].push(e.json())}))),this._private.styleEnabled&&(b.style=t.style().json()),b.data=ue(t.data());var f=a.options;return b.zoomingEnabled=a.zoomingEnabled,b.userZoomingEnabled=a.userZoomingEnabled,b.zoom=a.zoom,b.minZoom=a.minZoom,b.maxZoom=a.maxZoom,b.panningEnabled=a.panningEnabled,b.userPanningEnabled=a.userPanningEnabled,b.pan=ue(a.pan),b.boxSelectionEnabled=a.boxSelectionEnabled,b.renderer=ue(f.renderer),b.hideEdgesOnViewport=f.hideEdgesOnViewport,b.textureOnViewport=f.textureOnViewport,b.wheelSensitivity=f.wheelSensitivity,b.motionBlur=f.motionBlur,b}}),gs.$id=gs.getElementById,[Ln,$n,Yn,Xn,Qn,Kn,es,ts,ms,bs,fs].forEach((function(e){P(gs,e)}));var js={fit:!0,directed:!1,padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,maximal:!1,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}},xs=function(e){return e.scratch("breadthfirst")},vs=function(e,t){return e.scratch("breadthfirst",t)};function ys(e){this.options=P({},js,e)}ys.prototype.run=function(){var e,t=this.options,a=t,i=t.cy,n=a.eles,s=n.nodes().filter((function(e){return!e.isParent()})),o=n,r=a.directed,l=a.maximal||a.maximalAdjustments>0,c=Qe(a.boundingBox?a.boundingBox:{x1:0,y1:0,w:i.width(),h:i.height()});if(w(a.roots))e=a.roots;else if(v(a.roots)){for(var d=[],u=0;u<a.roots.length;u++){var p=a.roots[u],m=i.getElementById(p);d.push(m)}e=i.collection(d)}else if(j(a.roots))e=i.$(a.roots);else if(r)e=s.roots();else{var b=n.components();e=i.collection();for(var f=function(t){var a=b[t],i=a.maxDegree(!1),n=a.filter((function(e){return e.degree(!1)===i}));e=e.add(n)},h=0;h<b.length;h++)f(h)}var g=[],x={},y=function(e,t){null==g[t]&&(g[t]=[]);var a=g[t].length;g[t].push(e),vs(e,{index:a,depth:t})};o.bfs({roots:e,directed:a.directed,visit:function(e,t,a,i,n){var s=e[0],o=s.id();y(s,n),x[o]=!0}});for(var O=[],E=0;E<s.length;E++){var M=s[E];x[M.id()]||O.push(M)}var S=function(e){for(var t=g[e],a=0;a<t.length;a++){var i=t[a];null!=i?vs(i,{depth:e,index:a}):(t.splice(a,1),a--)}},_=function(){for(var e=0;e<g.length;e++)S(e)},T=function(e,t){for(var a=xs(e),i=e.incomers().filter((function(e){return e.isNode()&&n.has(e)})),s=-1,o=e.id(),r=0;r<i.length;r++){var l=i[r],c=xs(l);s=Math.max(s,c.depth)}return a.depth<=s&&(t[o]?null:(function(e,t){var a=xs(e),i=a.depth,n=a.index;g[i][n]=null,y(e,t)}(e,s+1),t[o]=!0,!0))};if(r&&l){var C=[],k={},F=function(e){return C.push(e)};for(s.forEach((function(e){return C.push(e)}));C.length>0;){var I=C.shift(),D=T(I,k);if(D)I.outgoers().filter((function(e){return e.isNode()&&n.has(e)})).forEach(F);else if(null===D){de("Detected double maximal shift for node `"+I.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}_();var A=0;if(a.avoidOverlap)for(var L=0;L<s.length;L++){var R=s[L].layoutDimensions(a),P=R.w,z=R.h;A=Math.max(A,P,z)}for(var B={},V=function(e){if(B[e.id()])return B[e.id()];for(var t=xs(e).depth,a=e.neighborhood(),i=0,n=0,o=0;o<a.length;o++){var r=a[o];if(!r.isEdge()&&!r.isParent()&&s.has(r)){var l=xs(r),c=l.index,d=l.depth;if(null!=c&&null!=d){var u=g[d].length;d<t&&(i+=c/u,n++)}}}return i/=n=Math.max(1,n),0===n&&(i=0),B[e.id()]=i,i},J=function(e,t){var a=V(e)-V(t);return 0===a?N(e.id(),t.id()):a},U=0;U<g.length;U++)g[U].sort(J),S(U);for(var G=[],q=0;q<O.length;q++)G.push(O[q]);g.unshift(G),_();for(var $=0,W=0;W<g.length;W++)$=Math.max(g[W].length,$);var H=c.x1+c.w/2,Y=c.x1+c.h/2,X=g.reduce((function(e,t){return Math.max(e,t.length)}),0);return s.layoutPositions(this,a,(function(e){var t=xs(e),i=t.depth,n=t.index,s=g[i].length,o=Math.max(c.w/((a.grid?X:s)+1),A),r=Math.max(c.h/(g.length+1),A),l=Math.min(c.w/2/g.length,c.h/2/g.length);if(l=Math.max(l,A),a.circle){var d=l*i+l-(g.length>0&&g[0].length<=3?l/2:0),u=2*Math.PI/g[i].length*n;return 0===i&&1===g[0].length&&(d=1),{x:H+d*Math.cos(u),y:Y+d*Math.sin(u)}}return{x:H+(n+1-(s+1)/2)*o,y:(i+1)*r}})),this};var Os={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function Es(e){this.options=P({},Os,e)}Es.prototype.run=function(){var e=this.options,t=e,a=e.cy,i=t.eles,n=void 0!==t.counterclockwise?!t.counterclockwise:t.clockwise,s=i.nodes().not(":parent");t.sort&&(s=s.sort(t.sort));for(var o,r=Qe(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:a.width(),h:a.height()}),l=r.x1+r.w/2,c=r.y1+r.h/2,d=(void 0===t.sweep?2*Math.PI-2*Math.PI/s.length:t.sweep)/Math.max(1,s.length-1),u=0,p=0;p<s.length;p++){var m=s[p].layoutDimensions(t),b=m.w,f=m.h;u=Math.max(u,b,f)}if(o=O(t.radius)?t.radius:s.length<=1?0:Math.min(r.h,r.w)/2-u,s.length>1&&t.avoidOverlap){u*=1.75;var h=Math.cos(d)-Math.cos(0),g=Math.sin(d)-Math.sin(0),j=Math.sqrt(u*u/(h*h+g*g));o=Math.max(j,o)}return s.layoutPositions(this,t,(function(e,a){var i=t.startAngle+a*d*(n?1:-1),s=o*Math.cos(i),r=o*Math.sin(i);return{x:l+s,y:c+r}})),this};var ws,Ms={fit:!0,padding:30,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(e){return e.degree()},levelWidth:function(e){return e.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function Ss(e){this.options=P({},Ms,e)}Ss.prototype.run=function(){for(var e=this.options,t=e,a=void 0!==t.counterclockwise?!t.counterclockwise:t.clockwise,i=e.cy,n=t.eles.nodes().not(":parent"),s=Qe(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:i.width(),h:i.height()}),o=s.x1+s.w/2,r=s.y1+s.h/2,l=[],c=0,d=0;d<n.length;d++){var u,p=n[d];u=t.concentric(p),l.push({value:u,node:p}),p._private.scratch.concentric=u}n.updateStyle();for(var m=0;m<n.length;m++){var b=n[m].layoutDimensions(t);c=Math.max(c,b.w,b.h)}l.sort((function(e,t){return t.value-e.value}));for(var f=t.levelWidth(n),h=[[]],g=h[0],j=0;j<l.length;j++){var x=l[j];g.length>0&&Math.abs(g[0].value-x.value)>=f&&(g=[],h.push(g)),g.push(x)}var v=c+t.minNodeSpacing;if(!t.avoidOverlap){var y=h.length>0&&h[0].length>1,O=(Math.min(s.w,s.h)/2-v)/(h.length+y?1:0);v=Math.min(v,O)}for(var E=0,w=0;w<h.length;w++){var M=h[w],S=void 0===t.sweep?2*Math.PI-2*Math.PI/M.length:t.sweep,_=M.dTheta=S/Math.max(1,M.length-1);if(M.length>1&&t.avoidOverlap){var T=Math.cos(_)-Math.cos(0),C=Math.sin(_)-Math.sin(0),k=Math.sqrt(v*v/(T*T+C*C));E=Math.max(k,E)}M.r=E,E+=v}if(t.equidistant){for(var F=0,I=0,D=0;D<h.length;D++){var A=h[D].r-I;F=Math.max(F,A)}I=0;for(var L=0;L<h.length;L++){var R=h[L];0===L&&(I=R.r),R.r=I,I+=F}}for(var N={},P=0;P<h.length;P++)for(var z=h[P],B=z.dTheta,V=z.r,J=0;J<z.length;J++){var U=z[J],G=t.startAngle+(a?1:-1)*B*J,q={x:o+V*Math.cos(G),y:r+V*Math.sin(G)};N[U.node.id()]=q}return n.layoutPositions(this,t,(function(e){var t=e.id();return N[t]})),this};var _s={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(e,t){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(e){return 2048},nodeOverlap:4,idealEdgeLength:function(e){return 32},edgeElasticity:function(e){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function Ts(e){this.options=P({},_s,e),this.options.layout=this}Ts.prototype.run=function(){var e=this.options,t=e.cy,a=this;a.stopped=!1,!0!==e.animate&&!1!==e.animate||a.emit({type:"layoutstart",layout:a}),ws=!0===e.debug;var i=Cs(t,a,e);ws&&(void 0)(i),e.randomize&&Is(i);var n=$(),s=function(){As(i,t,e),!0===e.fit&&t.fit(e.padding)},o=function(t){return!(a.stopped||t>=e.numIter||(Ls(i,e),i.temperature=i.temperature*e.coolingFactor,i.temperature<e.minTemp))},r=function(){if(!0===e.animate||!1===e.animate)s(),a.one("layoutstop",e.stop),a.emit({type:"layoutstop",layout:a});else{var t=e.eles.nodes(),n=Ds(i,e,t);t.layoutPositions(a,e,n)}},l=0,c=!0;if(!0===e.animate)!function t(){for(var a=0;c&&a<e.refresh;)c=o(l),l++,a++;c?($()-n>=e.animationThreshold&&s(),q(t)):(Ws(i,e),r())}();else{for(;c;)c=o(l),l++;Ws(i,e),r()}return this},Ts.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this},Ts.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var Cs=function(e,t,a){for(var i=a.eles.edges(),n=a.eles.nodes(),s={isCompound:e.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:n.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:i.size(),temperature:a.initialTemp,clientWidth:e.width(),clientHeight:e.width(),boundingBox:Qe(a.boundingBox?a.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()})},o=a.eles.components(),r={},l=0;l<o.length;l++)for(var c=o[l],d=0;d<c.length;d++)r[c[d].id()]=l;for(l=0;l<s.nodeSize;l++){var u=(h=n[l]).layoutDimensions(a);(D={}).isLocked=h.locked(),D.id=h.data("id"),D.parentId=h.data("parent"),D.cmptId=r[h.id()],D.children=[],D.positionX=h.position("x"),D.positionY=h.position("y"),D.offsetX=0,D.offsetY=0,D.height=u.w,D.width=u.h,D.maxX=D.positionX+D.width/2,D.minX=D.positionX-D.width/2,D.maxY=D.positionY+D.height/2,D.minY=D.positionY-D.height/2,D.padLeft=parseFloat(h.style("padding")),D.padRight=parseFloat(h.style("padding")),D.padTop=parseFloat(h.style("padding")),D.padBottom=parseFloat(h.style("padding")),D.nodeRepulsion=x(a.nodeRepulsion)?a.nodeRepulsion(h):a.nodeRepulsion,s.layoutNodes.push(D),s.idToIndex[D.id]=l}var p=[],m=0,b=-1,f=[];for(l=0;l<s.nodeSize;l++){var h,g=(h=s.layoutNodes[l]).parentId;null!=g?s.layoutNodes[s.idToIndex[g]].children.push(h.id):(p[++b]=h.id,f.push(h.id))}for(s.graphSet.push(f);m<=b;){var j=p[m++],v=s.idToIndex[j],y=s.layoutNodes[v].children;if(y.length>0)for(s.graphSet.push(y),l=0;l<y.length;l++)p[++b]=y[l]}for(l=0;l<s.graphSet.length;l++){var O=s.graphSet[l];for(d=0;d<O.length;d++){var E=s.idToIndex[O[d]];s.indexToGraph[E]=l}}for(l=0;l<s.edgeSize;l++){var w=i[l],M={};M.id=w.data("id"),M.sourceId=w.data("source"),M.targetId=w.data("target");var S=x(a.idealEdgeLength)?a.idealEdgeLength(w):a.idealEdgeLength,_=x(a.edgeElasticity)?a.edgeElasticity(w):a.edgeElasticity,T=s.idToIndex[M.sourceId],C=s.idToIndex[M.targetId];if(s.indexToGraph[T]!=s.indexToGraph[C]){for(var k=ks(M.sourceId,M.targetId,s),F=s.graphSet[k],I=0,D=s.layoutNodes[T];-1===F.indexOf(D.id);)D=s.layoutNodes[s.idToIndex[D.parentId]],I++;for(D=s.layoutNodes[C];-1===F.indexOf(D.id);)D=s.layoutNodes[s.idToIndex[D.parentId]],I++;S*=I*a.nestingFactor}M.idealLength=S,M.elasticity=_,s.layoutEdges.push(M)}return s},ks=function(e,t,a){var i=Fs(e,t,0,a);return 2>i.count?0:i.graph},Fs=function e(t,a,i,n){var s=n.graphSet[i];if(-1<s.indexOf(t)&&-1<s.indexOf(a))return{count:2,graph:i};for(var o=0,r=0;r<s.length;r++){var l=s[r],c=n.idToIndex[l],d=n.layoutNodes[c].children;if(0!==d.length){var u=e(t,a,n.indexToGraph[n.idToIndex[d[0]]],n);if(0!==u.count){if(1!==u.count)return u;if(2==++o)break}}}return{count:o,graph:i}},Is=function(e,t){for(var a=e.clientWidth,i=e.clientHeight,n=0;n<e.nodeSize;n++){var s=e.layoutNodes[n];0!==s.children.length||s.isLocked||(s.positionX=Math.random()*a,s.positionY=Math.random()*i)}},Ds=function(e,t,a){var i=e.boundingBox,n={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return t.boundingBox&&(a.forEach((function(t){var a=e.layoutNodes[e.idToIndex[t.data("id")]];n.x1=Math.min(n.x1,a.positionX),n.x2=Math.max(n.x2,a.positionX),n.y1=Math.min(n.y1,a.positionY),n.y2=Math.max(n.y2,a.positionY)})),n.w=n.x2-n.x1,n.h=n.y2-n.y1),function(a,s){var o=e.layoutNodes[e.idToIndex[a.data("id")]];if(t.boundingBox){var r=(o.positionX-n.x1)/n.w,l=(o.positionY-n.y1)/n.h;return{x:i.x1+r*i.w,y:i.y1+l*i.h}}return{x:o.positionX,y:o.positionY}}},As=function(e,t,a){var i=a.layout,n=a.eles.nodes(),s=Ds(e,a,n);n.positions(s),!0!==e.ready&&(e.ready=!0,i.one("layoutready",a.ready),i.emit({type:"layoutready",layout:this}))},Ls=function(e,t,a){Rs(e,t),Vs(e),Js(e,t),Us(e),Gs(e)},Rs=function(e,t){for(var a=0;a<e.graphSet.length;a++)for(var i=e.graphSet[a],n=i.length,s=0;s<n;s++)for(var o=e.layoutNodes[e.idToIndex[i[s]]],r=s+1;r<n;r++){var l=e.layoutNodes[e.idToIndex[i[r]]];Ps(o,l,e,t)}},Ns=function(e){return-e+2*e*Math.random()},Ps=function(e,t,a,i){if(e.cmptId===t.cmptId||a.isCompound){var n=t.positionX-e.positionX,s=t.positionY-e.positionY;0===n&&0===s&&(n=Ns(1),s=Ns(1));var o=zs(e,t,n,s);if(o>0)var r=(c=i.nodeOverlap*o)*n/(f=Math.sqrt(n*n+s*s)),l=c*s/f;else{var c,d=Bs(e,n,s),u=Bs(t,-1*n,-1*s),p=u.x-d.x,m=u.y-d.y,b=p*p+m*m,f=Math.sqrt(b);r=(c=(e.nodeRepulsion+t.nodeRepulsion)/b)*p/f,l=c*m/f}e.isLocked||(e.offsetX-=r,e.offsetY-=l),t.isLocked||(t.offsetX+=r,t.offsetY+=l)}},zs=function(e,t,a,i){if(a>0)var n=e.maxX-t.minX;else n=t.maxX-e.minX;if(i>0)var s=e.maxY-t.minY;else s=t.maxY-e.minY;return n>=0&&s>=0?Math.sqrt(n*n+s*s):0},Bs=function(e,t,a){var i=e.positionX,n=e.positionY,s=e.height||1,o=e.width||1,r=a/t,l=s/o,c={};return 0===t&&0<a||0===t&&0>a?(c.x=i,c.y=n+s/2,c):0<t&&-1*l<=r&&r<=l?(c.x=i+o/2,c.y=n+o*a/2/t,c):0>t&&-1*l<=r&&r<=l?(c.x=i-o/2,c.y=n-o*a/2/t,c):0<a&&(r<=-1*l||r>=l)?(c.x=i+s*t/2/a,c.y=n+s/2,c):0>a&&(r<=-1*l||r>=l)?(c.x=i-s*t/2/a,c.y=n-s/2,c):c},Vs=function(e,t){for(var a=0;a<e.edgeSize;a++){var i=e.layoutEdges[a],n=e.idToIndex[i.sourceId],s=e.layoutNodes[n],o=e.idToIndex[i.targetId],r=e.layoutNodes[o],l=r.positionX-s.positionX,c=r.positionY-s.positionY;if(0!==l||0!==c){var d=Bs(s,l,c),u=Bs(r,-1*l,-1*c),p=u.x-d.x,m=u.y-d.y,b=Math.sqrt(p*p+m*m),f=Math.pow(i.idealLength-b,2)/i.elasticity;if(0!==b)var h=f*p/b,g=f*m/b;else h=0,g=0;s.isLocked||(s.offsetX+=h,s.offsetY+=g),r.isLocked||(r.offsetX-=h,r.offsetY-=g)}}},Js=function(e,t){for(var a=0;a<e.graphSet.length;a++){var i=e.graphSet[a],n=i.length;if(0===a)var s=e.clientHeight/2,o=e.clientWidth/2;else{var r=e.layoutNodes[e.idToIndex[i[0]]],l=e.layoutNodes[e.idToIndex[r.parentId]];s=l.positionX,o=l.positionY}for(var c=0;c<n;c++){var d=e.layoutNodes[e.idToIndex[i[c]]];if(!d.isLocked){var u=s-d.positionX,p=o-d.positionY,m=Math.sqrt(u*u+p*p);if(m>1){var b=t.gravity*u/m,f=t.gravity*p/m;d.offsetX+=b,d.offsetY+=f}}}}},Us=function(e,t){var a=[],i=0,n=-1;for(a.push.apply(a,e.graphSet[0]),n+=e.graphSet[0].length;i<=n;){var s=a[i++],o=e.idToIndex[s],r=e.layoutNodes[o],l=r.children;if(0<l.length&&!r.isLocked){for(var c=r.offsetX,d=r.offsetY,u=0;u<l.length;u++){var p=e.layoutNodes[e.idToIndex[l[u]]];p.offsetX+=c,p.offsetY+=d,a[++n]=l[u]}r.offsetX=0,r.offsetY=0}}},Gs=function(e,t){for(var a=0;a<e.nodeSize;a++)0<(n=e.layoutNodes[a]).children.length&&(n.maxX=void 0,n.minX=void 0,n.maxY=void 0,n.minY=void 0);for(a=0;a<e.nodeSize;a++)if(!(0<(n=e.layoutNodes[a]).children.length||n.isLocked)){var i=qs(n.offsetX,n.offsetY,e.temperature);n.positionX+=i.x,n.positionY+=i.y,n.offsetX=0,n.offsetY=0,n.minX=n.positionX-n.width,n.maxX=n.positionX+n.width,n.minY=n.positionY-n.height,n.maxY=n.positionY+n.height,$s(n,e)}for(a=0;a<e.nodeSize;a++){var n;0<(n=e.layoutNodes[a]).children.length&&!n.isLocked&&(n.positionX=(n.maxX+n.minX)/2,n.positionY=(n.maxY+n.minY)/2,n.width=n.maxX-n.minX,n.height=n.maxY-n.minY)}},qs=function(e,t,a){var i=Math.sqrt(e*e+t*t);if(i>a)var n={x:a*e/i,y:a*t/i};else n={x:e,y:t};return n},$s=function e(t,a){var i=t.parentId;if(null!=i){var n=a.layoutNodes[a.idToIndex[i]],s=!1;return(null==n.maxX||t.maxX+n.padRight>n.maxX)&&(n.maxX=t.maxX+n.padRight,s=!0),(null==n.minX||t.minX-n.padLeft<n.minX)&&(n.minX=t.minX-n.padLeft,s=!0),(null==n.maxY||t.maxY+n.padBottom>n.maxY)&&(n.maxY=t.maxY+n.padBottom,s=!0),(null==n.minY||t.minY-n.padTop<n.minY)&&(n.minY=t.minY-n.padTop,s=!0),s?e(n,a):void 0}},Ws=function(e,t){for(var a=e.layoutNodes,i=[],n=0;n<a.length;n++){var s=a[n],o=s.cmptId;(i[o]=i[o]||[]).push(s)}var r=0;for(n=0;n<i.length;n++)if(f=i[n]){f.x1=1/0,f.x2=-1/0,f.y1=1/0,f.y2=-1/0;for(var l=0;l<f.length;l++){var c=f[l];f.x1=Math.min(f.x1,c.positionX-c.width/2),f.x2=Math.max(f.x2,c.positionX+c.width/2),f.y1=Math.min(f.y1,c.positionY-c.height/2),f.y2=Math.max(f.y2,c.positionY+c.height/2)}f.w=f.x2-f.x1,f.h=f.y2-f.y1,r+=f.w*f.h}i.sort((function(e,t){return t.w*t.h-e.w*e.h}));var d=0,u=0,p=0,m=0,b=Math.sqrt(r)*e.clientWidth/e.clientHeight;for(n=0;n<i.length;n++){var f;if(f=i[n]){for(l=0;l<f.length;l++)(c=f[l]).isLocked||(c.positionX+=d-f.x1,c.positionY+=u-f.y1);d+=f.w+t.componentSpacing,p+=f.w+t.componentSpacing,m=Math.max(m,f.h),p>b&&(u+=m+t.componentSpacing,d=0,p=0,m=0)}}},Hs={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(e){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function Ys(e){this.options=P({},Hs,e)}Ys.prototype.run=function(){var e=this.options,t=e,a=e.cy,i=t.eles.nodes().not(":parent");t.sort&&(i=i.sort(t.sort));var n=Qe(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:a.width(),h:a.height()});if(0===n.h||0===n.w)i.layoutPositions(this,t,(function(e){return{x:n.x1,y:n.y1}}));else{var s=i.size(),o=Math.sqrt(s*n.h/n.w),r=Math.round(o),l=Math.round(n.w/n.h*o),c=function(e){if(null==e)return Math.min(r,l);Math.min(r,l)==r?r=e:l=e},d=function(e){if(null==e)return Math.max(r,l);Math.max(r,l)==r?r=e:l=e},u=t.rows,p=null!=t.cols?t.cols:t.columns;if(null!=u&&null!=p)r=u,l=p;else if(null!=u&&null==p)r=u,l=Math.ceil(s/r);else if(null==u&&null!=p)l=p,r=Math.ceil(s/l);else if(l*r>s){var m=c(),b=d();(m-1)*b>=s?c(m-1):(b-1)*m>=s&&d(b-1)}else for(;l*r<s;){var f=c(),h=d();(h+1)*f>=s?d(h+1):c(f+1)}var g=n.w/l,j=n.h/r;if(t.condense&&(g=0,j=0),t.avoidOverlap)for(var x=0;x<i.length;x++){var v=i[x],y=v._private.position;null!=y.x&&null!=y.y||(y.x=0,y.y=0);var O=v.layoutDimensions(t),E=t.avoidOverlapPadding,w=O.w+E,M=O.h+E;g=Math.max(g,w),j=Math.max(j,M)}for(var S={},_=function(e,t){return!!S["c-"+e+"-"+t]},T=function(e,t){S["c-"+e+"-"+t]=!0},C=0,k=0,F=function(){++k>=l&&(k=0,C++)},I={},D=0;D<i.length;D++){var A=i[D],L=t.position(A);if(L&&(void 0!==L.row||void 0!==L.col)){var R={row:L.row,col:L.col};if(void 0===R.col)for(R.col=0;_(R.row,R.col);)R.col++;else if(void 0===R.row)for(R.row=0;_(R.row,R.col);)R.row++;I[A.id()]=R,T(R.row,R.col)}}i.layoutPositions(this,t,(function(e,t){var a,i;if(e.locked()||e.isParent())return!1;var s=I[e.id()];if(s)a=s.col*g+g/2+n.x1,i=s.row*j+j/2+n.y1;else{for(;_(C,k);)F();a=k*g+g/2+n.x1,i=C*j+j/2+n.y1,T(C,k),F()}return{x:a,y:i}}))}return this};var Xs={ready:function(){},stop:function(){}};function Qs(e){this.options=P({},Xs,e)}Qs.prototype.run=function(){var e=this.options,t=e.eles,a=this;return e.cy,a.emit("layoutstart"),t.nodes().positions((function(){return{x:0,y:0}})),a.one("layoutready",e.ready),a.emit("layoutready"),a.one("layoutstop",e.stop),a.emit("layoutstop"),this},Qs.prototype.stop=function(){return this};var Ks={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function Zs(e){this.options=P({},Ks,e)}Zs.prototype.run=function(){var e=this.options,t=e.eles.nodes(),a=x(e.positions);return t.layoutPositions(this,e,(function(t,i){var n=function(t){if(null==e.positions)return function(e){return{x:e.x,y:e.y}}(t.position());if(a)return e.positions(t);var i=e.positions[t._private.data.id];return null==i?null:i}(t);return!t.locked()&&null!=n&&n})),this};var eo={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function to(e){this.options=P({},eo,e)}to.prototype.run=function(){var e=this.options,t=e.cy,a=e.eles.nodes().not(":parent"),i=Qe(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()});return a.layoutPositions(this,e,(function(e,t){return{x:i.x1+Math.round(Math.random()*i.w),y:i.y1+Math.round(Math.random()*i.h)}})),this};var ao=[{name:"breadthfirst",impl:ys},{name:"circle",impl:Es},{name:"concentric",impl:Ss},{name:"cose",impl:Ts},{name:"grid",impl:Ys},{name:"null",impl:Qs},{name:"preset",impl:Zs},{name:"random",impl:to}];function io(e){this.options=e,this.notifications=0}var no=function(){};io.prototype={recalculateRenderedStyle:no,notify:function(){this.notifications++},init:no,isHeadless:function(){return!0}};var so={arrowShapeWidth:.3,registerArrowShapes:function(){var e=this.arrowShapes={},t=this,a=function(e,t,a,i,n,s,o){var r=n.x-a/2-o,l=n.x+a/2+o,c=n.y-a/2-o,d=n.y+a/2+o;return r<=e&&e<=l&&c<=t&&t<=d},i=function(e,t,a,i,n){var s=e*Math.cos(i)-t*Math.sin(i),o=(e*Math.sin(i)+t*Math.cos(i))*a;return{x:s*a+n.x,y:o+n.y}},n=function(e,t,a,n){for(var s=[],o=0;o<e.length;o+=2){var r=e[o],l=e[o+1];s.push(i(r,l,t,a,n))}return s},s=function(e){for(var t=[],a=0;a<e.length;a++){var i=e[a];t.push(i.x,i.y)}return t},o=function(e){return e.pstyle("width").pfValue*e.pstyle("arrow-scale").pfValue*2},r=function(i,r){j(r)&&(r=e[r]),e[i]=P({name:i,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(e,t,a,i,o,r){var l=s(n(this.points,a+2*r,i,o));return ut(e,t,l)},roughCollide:a,draw:function(e,a,i,s){var o=n(this.points,a,i,s);t.arrowShapeImpl("polygon")(e,o)},spacing:function(e){return 0},gap:o},r)};r("none",{collide:se,roughCollide:se,draw:re,spacing:oe,gap:oe}),r("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),r("arrow","triangle"),r("triangle-backcurve",{points:e.triangle.points,controlPoint:[0,-.15],roughCollide:a,draw:function(e,a,s,o,r){var l=n(this.points,a,s,o),c=this.controlPoint,d=i(c[0],c[1],a,s,o);t.arrowShapeImpl(this.name)(e,l,d)},gap:function(e){return.8*o(e)}}),r("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(e,t,a,i,o,r,l){var c=s(n(this.points,a+2*l,i,o)),d=s(n(this.pointsTee,a+2*l,i,o));return ut(e,t,c)||ut(e,t,d)},draw:function(e,a,i,s,o){var r=n(this.points,a,i,s),l=n(this.pointsTee,a,i,s);t.arrowShapeImpl(this.name)(e,r,l)}}),r("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(e,t){var a=this.baseCrossLinePts.slice(),i=t/e;return a[3]=a[3]-i,a[5]=a[5]-i,a},collide:function(e,t,a,i,o,r,l){var c=s(n(this.points,a+2*l,i,o)),d=s(n(this.crossLinePts(a,r),a+2*l,i,o));return ut(e,t,c)||ut(e,t,d)},draw:function(e,a,i,s,o){var r=n(this.points,a,i,s),l=n(this.crossLinePts(a,o),a,i,s);t.arrowShapeImpl(this.name)(e,r,l)}}),r("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(e){return.525*o(e)}}),r("circle",{radius:.15,collide:function(e,t,a,i,n,s,o){var r=n;return Math.pow(r.x-e,2)+Math.pow(r.y-t,2)<=Math.pow((a+2*o)*this.radius,2)},draw:function(e,a,i,n,s){t.arrowShapeImpl(this.name)(e,n.x,n.y,this.radius*a)},spacing:function(e){return t.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.radius}}),r("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(e){return 1},gap:function(e){return 1}}),r("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),r("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(e){return e.pstyle("width").pfValue*e.pstyle("arrow-scale").value}}),r("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(e){return.95*e.pstyle("width").pfValue*e.pstyle("arrow-scale").value}})}},oo={projectIntoViewport:function(e,t){var a=this.cy,i=this.findContainerClientCoords(),n=i[0],s=i[1],o=i[4],r=a.pan(),l=a.zoom();return[((e-n)/o-r.x)/l,((t-s)/o-r.y)/l]},findContainerClientCoords:function(){if(this.containerBB)return this.containerBB;var e=this.container,t=e.getBoundingClientRect(),a=u.getComputedStyle(e),i=function(e){return parseFloat(a.getPropertyValue(e))},n=i("padding-left"),s=i("padding-right"),o=i("padding-top"),r=i("padding-bottom"),l=i("border-left-width"),c=i("border-right-width"),d=i("border-top-width"),p=(i("border-bottom-width"),e.clientWidth),m=e.clientHeight,b=n+s,f=o+r,h=l+c,g=t.width/(p+h),j=p-b,x=m-f,v=t.left+n+l,y=t.top+o+d;return this.containerBB=[v,y,j,x,g]},invalidateContainerClientCoordsCache:function(){this.containerBB=null},findNearestElement:function(e,t,a,i){return this.findNearestElements(e,t,a,i)[0]},findNearestElements:function(e,t,a,i){var n,s,o=this,r=this,l=r.getCachedZSortedEles(),c=[],d=r.cy.zoom(),u=r.cy.hasCompoundNodes(),p=(i?24:8)/d,m=(i?8:2)/d,b=(i?8:2)/d,f=1/0;function h(e,t){if(e.isNode()){if(s)return;s=e,c.push(e)}if(e.isEdge()&&(null==t||t<f))if(n){if(n.pstyle("z-compound-depth").value===e.pstyle("z-compound-depth").value&&n.pstyle("z-compound-depth").value===e.pstyle("z-compound-depth").value)for(var a=0;a<c.length;a++)if(c[a].isEdge()){c[a]=e,n=e,f=null!=t?t:f;break}}else c.push(e),n=e,f=null!=t?t:f}function g(a){var i=a.outerWidth()+2*m,n=a.outerHeight()+2*m,s=i/2,l=n/2,c=a.position();if(c.x-s<=e&&e<=c.x+s&&c.y-l<=t&&t<=c.y+l&&r.nodeShapes[o.getNodeShape(a)].checkPoint(e,t,0,i,n,c.x,c.y))return h(a,0),!0}function j(a){var i,n=a._private,s=n.rscratch,l=a.pstyle("width").pfValue,d=a.pstyle("arrow-scale").value,m=l/2+p,b=m*m,f=2*m,j=n.source,x=n.target;if("segments"===s.edgeType||"straight"===s.edgeType||"haystack"===s.edgeType){for(var v=s.allpts,y=0;y+3<v.length;y+=2)if(rt(e,t,v[y],v[y+1],v[y+2],v[y+3],f)&&b>(i=dt(e,t,v[y],v[y+1],v[y+2],v[y+3])))return h(a,i),!0}else if("bezier"===s.edgeType||"multibezier"===s.edgeType||"self"===s.edgeType||"compound"===s.edgeType)for(v=s.allpts,y=0;y+5<s.allpts.length;y+=4)if(lt(e,t,v[y],v[y+1],v[y+2],v[y+3],v[y+4],v[y+5],f)&&b>(i=ct(e,t,v[y],v[y+1],v[y+2],v[y+3],v[y+4],v[y+5])))return h(a,i),!0;j=j||n.source,x=x||n.target;var O=o.getArrowWidth(l,d),E=[{name:"source",x:s.arrowStartX,y:s.arrowStartY,angle:s.srcArrowAngle},{name:"target",x:s.arrowEndX,y:s.arrowEndY,angle:s.tgtArrowAngle},{name:"mid-source",x:s.midX,y:s.midY,angle:s.midsrcArrowAngle},{name:"mid-target",x:s.midX,y:s.midY,angle:s.midtgtArrowAngle}];for(y=0;y<E.length;y++){var w=E[y],M=r.arrowShapes[a.pstyle(w.name+"-arrow-shape").value],S=a.pstyle("width").pfValue;if(M.roughCollide(e,t,O,w.angle,{x:w.x,y:w.y},S,p)&&M.collide(e,t,O,w.angle,{x:w.x,y:w.y},S,p))return h(a),!0}u&&c.length>0&&(g(j),g(x))}function x(e,t,a){return je(e,t,a)}function v(a,i){var n,s=a._private,o=b;n=i?i+"-":"";var r=s.labelBounds[i||"main"],l=a.pstyle(n+"label").value;if("yes"===a.pstyle("text-events").strValue&&l){var c=s.rstyle,d=x(c,"labelX",i),u=x(c,"labelY",i),p=x(s.rscratch,"labelAngle",i),m=r.x1-o,f=r.x2+o,g=r.y1-o,j=r.y2+o;if(p){var v=Math.cos(p),y=Math.sin(p),O=function(e,t){return{x:(e-=d)*v-(t-=u)*y+d,y:e*y+t*v+u}},E=O(m,g),w=O(m,j),M=O(f,g),S=O(f,j),_=[E.x,E.y,M.x,M.y,S.x,S.y,w.x,w.y];if(ut(e,t,_))return h(a),!0}else if(nt(r,e,t))return h(a),!0}}a&&(l=l.interactive);for(var y=l.length-1;y>=0;y--){var O=l[y];O.isNode()?g(O)||v(O):j(O)||v(O)||v(O,"source")||v(O,"target")}return c},getAllInBox:function(e,t,a,i){for(var n,s,o=this.getCachedZSortedEles().interactive,r=[],l=Math.min(e,a),c=Math.max(e,a),d=Math.min(t,i),u=Math.max(t,i),p=Qe({x1:e=l,y1:t=d,x2:a=c,y2:i=u}),m=0;m<o.length;m++){var b=o[m];if(b.isNode()){var f=b,h=f.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:!1});it(p,h)&&!st(h,p)&&r.push(f)}else{var g=b,j=g._private,x=j.rscratch;if(null!=x.startX&&null!=x.startY&&!nt(p,x.startX,x.startY))continue;if(null!=x.endX&&null!=x.endY&&!nt(p,x.endX,x.endY))continue;if("bezier"===x.edgeType||"multibezier"===x.edgeType||"self"===x.edgeType||"compound"===x.edgeType||"segments"===x.edgeType||"haystack"===x.edgeType){for(var v=j.rstyle.bezierPts||j.rstyle.linePts||j.rstyle.haystackPts,y=!0,O=0;O<v.length;O++)if(n=p,s=v[O],!nt(n,s.x,s.y)){y=!1;break}y&&r.push(g)}else"haystack"!==x.edgeType&&"straight"!==x.edgeType||r.push(g)}}return r}},ro={calculateArrowAngles:function(e){var t,a,i,n,s,o,r=e._private.rscratch,l="haystack"===r.edgeType,c="bezier"===r.edgeType,d="multibezier"===r.edgeType,u="segments"===r.edgeType,p="compound"===r.edgeType,m="self"===r.edgeType;if(l?(i=r.haystackPts[0],n=r.haystackPts[1],s=r.haystackPts[2],o=r.haystackPts[3]):(i=r.arrowStartX,n=r.arrowStartY,s=r.arrowEndX,o=r.arrowEndY),f=r.midX,h=r.midY,u)t=i-r.segpts[0],a=n-r.segpts[1];else if(d||p||m||c){var b=r.allpts;t=i-He(b[0],b[2],b[4],.1),a=n-He(b[1],b[3],b[5],.1)}else t=i-f,a=n-h;r.srcArrowAngle=Je(t,a);var f=r.midX,h=r.midY;if(l&&(f=(i+s)/2,h=(n+o)/2),t=s-i,a=o-n,u)if((b=r.allpts).length/2%2==0){var g=(j=b.length/2)-2;t=b[j]-b[g],a=b[j+1]-b[g+1]}else{g=(j=b.length/2-1)-2;var j,x=j+2;t=b[j]-b[g],a=b[j+1]-b[g+1]}else if(d||p||m){var v,y,O,E;b=r.allpts;if(r.ctrlpts.length/2%2==0){var w=2+(M=2+(S=b.length/2-1));v=He(b[S],b[M],b[w],0),y=He(b[S+1],b[M+1],b[w+1],0),O=He(b[S],b[M],b[w],1e-4),E=He(b[S+1],b[M+1],b[w+1],1e-4)}else{var M,S;w=2+(M=b.length/2-1),v=He(b[S=M-2],b[M],b[w],.4999),y=He(b[S+1],b[M+1],b[w+1],.4999),O=He(b[S],b[M],b[w],.5),E=He(b[S+1],b[M+1],b[w+1],.5)}t=O-v,a=E-y}if(r.midtgtArrowAngle=Je(t,a),r.midDispX=t,r.midDispY=a,t*=-1,a*=-1,u&&((b=r.allpts).length/2%2==0||(t=-(b[x=2+(j=b.length/2-1)]-b[j]),a=-(b[x+1]-b[j+1]))),r.midsrcArrowAngle=Je(t,a),u)t=s-r.segpts[r.segpts.length-2],a=o-r.segpts[r.segpts.length-1];else if(d||p||m||c){var _=(b=r.allpts).length;t=s-He(b[_-6],b[_-4],b[_-2],.9),a=o-He(b[_-5],b[_-3],b[_-1],.9)}else t=s-f,a=o-h;r.tgtArrowAngle=Je(t,a)}};ro.getArrowWidth=ro.getArrowHeight=function(e,t){var a=this.arrowWidthCache=this.arrowWidthCache||{},i=a[e+", "+t];return i||(i=Math.max(Math.pow(13.37*e,.9),29)*t,a[e+", "+t]=i,i)};var lo={};function co(e){var t=[];if(null!=e){for(var a=0;a<e.length;a+=2){var i=e[a],n=e[a+1];t.push({x:i,y:n})}return t}}lo.findHaystackPoints=function(e){for(var t=0;t<e.length;t++){var a=e[t],i=a._private,n=i.rscratch;if(!n.haystack){var s=2*Math.random()*Math.PI;n.source={x:Math.cos(s),y:Math.sin(s)},s=2*Math.random()*Math.PI,n.target={x:Math.cos(s),y:Math.sin(s)}}var o=i.source,r=i.target,l=o.position(),c=r.position(),d=o.width(),u=r.width(),p=o.height(),m=r.height(),b=a.pstyle("haystack-radius").value/2;n.haystackPts=n.allpts=[n.source.x*d*b+l.x,n.source.y*p*b+l.y,n.target.x*u*b+c.x,n.target.y*m*b+c.y],n.midX=(n.allpts[0]+n.allpts[2])/2,n.midY=(n.allpts[1]+n.allpts[3])/2,n.edgeType="haystack",n.haystack=!0,this.storeEdgeProjections(a),this.calculateArrowAngles(a),this.recalculateEdgeLabelProjections(a),this.calculateLabelAngles(a)}},lo.findSegmentsPoints=function(e,t){var a=e._private.rscratch,i=t.posPts,n=t.intersectionPts,s=t.vectorNormInverse,o=e.pstyle("edge-distances").value,r=e.pstyle("segment-weights"),l=e.pstyle("segment-distances"),c=Math.min(r.pfValue.length,l.pfValue.length);a.edgeType="segments",a.segpts=[];for(var d=0;d<c;d++){var u=r.pfValue[d],p=l.pfValue[d],m=1-u,b=u,f="node-position"===o?i:n,h={x:f.x1*m+f.x2*b,y:f.y1*m+f.y2*b};a.segpts.push(h.x+s.x*p,h.y+s.y*p)}},lo.findLoopPoints=function(e,t,a,i){var n=e._private.rscratch,s=t.dirCounts,o=t.srcPos,r=e.pstyle("control-point-distances"),l=r?r.pfValue[0]:void 0,c=e.pstyle("loop-direction").pfValue,d=e.pstyle("loop-sweep").pfValue,u=e.pstyle("control-point-step-size").pfValue;n.edgeType="self";var p=a,m=u;i&&(p=0,m=l);var b=c-Math.PI/2,f=b-d/2,h=b+d/2,g=String(c+"_"+d);p=void 0===s[g]?s[g]=0:++s[g],n.ctrlpts=[o.x+1.4*Math.cos(f)*m*(p/3+1),o.y+1.4*Math.sin(f)*m*(p/3+1),o.x+1.4*Math.cos(h)*m*(p/3+1),o.y+1.4*Math.sin(h)*m*(p/3+1)]},lo.findCompoundLoopPoints=function(e,t,a,i){var n=e._private.rscratch;n.edgeType="compound";var s=t.srcPos,o=t.tgtPos,r=t.srcW,l=t.srcH,c=t.tgtW,d=t.tgtH,u=e.pstyle("control-point-step-size").pfValue,p=e.pstyle("control-point-distances"),m=p?p.pfValue[0]:void 0,b=a,f=u;i&&(b=0,f=m);var h={x:s.x-r/2,y:s.y-l/2},g={x:o.x-c/2,y:o.y-d/2},j={x:Math.min(h.x,g.x),y:Math.min(h.y,g.y)},x=Math.max(.5,Math.log(.01*r)),v=Math.max(.5,Math.log(.01*c));n.ctrlpts=[j.x,j.y-(1+Math.pow(50,1.12)/100)*f*(b/3+1)*x,j.x-(1+Math.pow(50,1.12)/100)*f*(b/3+1)*v,j.y]},lo.findStraightEdgePoints=function(e){e._private.rscratch.edgeType="straight"},lo.findBezierPoints=function(e,t,a,i,n){var s=e._private.rscratch,o=t.vectorNormInverse,r=t.posPts,l=t.intersectionPts,c=e.pstyle("edge-distances").value,d=e.pstyle("control-point-step-size").pfValue,u=e.pstyle("control-point-distances"),p=e.pstyle("control-point-weights"),m=u&&p?Math.min(u.value.length,p.value.length):1,b=u?u.pfValue[0]:void 0,f=p.value[0],h=i;s.edgeType=h?"multibezier":"bezier",s.ctrlpts=[];for(var g=0;g<m;g++){var j,x=(.5-t.eles.length/2+a)*d*(n?-1:1),v=Ge(x);h&&(b=u?u.pfValue[g]:d,f=p.value[g]);var y=void 0!==(j=i?b:void 0!==b?v*b:void 0)?j:x,O=1-f,E=f,w="node-position"===c?r:l,M={x:w.x1*O+w.x2*E,y:w.y1*O+w.y2*E};s.ctrlpts.push(M.x+o.x*y,M.y+o.y*y)}},lo.findTaxiPoints=function(e,t){var a=e._private.rscratch;a.edgeType="segments";var i="vertical",n="horizontal",s="leftward",o="rightward",r="downward",l="upward",c=t.posPts,d=t.srcW,u=t.srcH,p=t.tgtW,m=t.tgtH,b="node-position"!==e.pstyle("edge-distances").value,f=e.pstyle("taxi-direction").value,h=f,g=e.pstyle("taxi-turn"),j=g.pfValue,x=e.pstyle("taxi-turn-min-distance").pfValue,v="%"===g.units,y=b?(d+p)/2:0,O=b?(u+m)/2:0,E=c.x2-c.x1,w=c.y2-c.y1,M=function(e,t){return e>0?Math.max(e-t,0):Math.min(e+t,0)},S=M(E,y),_=M(w,O),T=!1;"auto"===f?f=Math.abs(S)>Math.abs(_)?n:i:f===l||f===r?(f=i,T=!0):f!==s&&f!==o||(f=n,T=!0);var C=f===i,k=C?_:S,F=C?w:E,I=Ge(F),D=!1;T&&v||!(h===r&&F<0||h===l&&F>0||h===s&&F>0||h===o&&F<0)||(k=(I*=-1)*Math.abs(k),D=!0);var A=v?j*k:j*I,L=function(e){return Math.abs(e)<x||Math.abs(e)>=Math.abs(k)},R=L(A),N=L(k-A);if(!R&&!N||D)if(C){var P=c.y1+A+(b?u/2*I:0),z=c.x1,B=c.x2;a.segpts=[z,P,B,P]}else{var V=c.x1+A+(b?d/2*I:0),J=c.y1,U=c.y2;a.segpts=[V,J,V,U]}else if(C){var G=Math.abs(F)<=u/2,q=Math.abs(E)<=p/2;if(G){var $=(c.x1+c.x2)/2,W=c.y1,H=c.y2;a.segpts=[$,W,$,H]}else if(q){var Y=(c.y1+c.y2)/2,X=c.x1,Q=c.x2;a.segpts=[X,Y,Q,Y]}else a.segpts=[c.x1,c.y2]}else{var K=Math.abs(F)<=d/2,Z=Math.abs(w)<=m/2;if(K){var ee=(c.y1+c.y2)/2,te=c.x1,ae=c.x2;a.segpts=[te,ee,ae,ee]}else if(Z){var ie=(c.x1+c.x2)/2,ne=c.y1,se=c.y2;a.segpts=[ie,ne,ie,se]}else a.segpts=[c.x2,c.y1]}},lo.tryToCorrectInvalidPoints=function(e,t){var a=e._private.rscratch;if("bezier"===a.edgeType){var i=t.srcPos,n=t.tgtPos,s=t.srcW,o=t.srcH,r=t.tgtW,l=t.tgtH,c=t.srcShape,d=t.tgtShape,u=!O(a.startX)||!O(a.startY),p=!O(a.arrowStartX)||!O(a.arrowStartY),m=!O(a.endX)||!O(a.endY),b=!O(a.arrowEndX)||!O(a.arrowEndY),f=this.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.arrowShapeWidth*3,h=qe({x:a.ctrlpts[0],y:a.ctrlpts[1]},{x:a.startX,y:a.startY}),g=h<f,j=qe({x:a.ctrlpts[0],y:a.ctrlpts[1]},{x:a.endX,y:a.endY}),x=j<f,v=!1;if(u||p||g){v=!0;var y={x:a.ctrlpts[0]-i.x,y:a.ctrlpts[1]-i.y},E=Math.sqrt(y.x*y.x+y.y*y.y),w={x:y.x/E,y:y.y/E},M=Math.max(s,o),S={x:a.ctrlpts[0]+2*w.x*M,y:a.ctrlpts[1]+2*w.y*M},_=c.intersectLine(i.x,i.y,s,o,S.x,S.y,0);g?(a.ctrlpts[0]=a.ctrlpts[0]+w.x*(f-h),a.ctrlpts[1]=a.ctrlpts[1]+w.y*(f-h)):(a.ctrlpts[0]=_[0]+w.x*f,a.ctrlpts[1]=_[1]+w.y*f)}if(m||b||x){v=!0;var T={x:a.ctrlpts[0]-n.x,y:a.ctrlpts[1]-n.y},C=Math.sqrt(T.x*T.x+T.y*T.y),k={x:T.x/C,y:T.y/C},F=Math.max(s,o),I={x:a.ctrlpts[0]+2*k.x*F,y:a.ctrlpts[1]+2*k.y*F},D=d.intersectLine(n.x,n.y,r,l,I.x,I.y,0);x?(a.ctrlpts[0]=a.ctrlpts[0]+k.x*(f-j),a.ctrlpts[1]=a.ctrlpts[1]+k.y*(f-j)):(a.ctrlpts[0]=D[0]+k.x*f,a.ctrlpts[1]=D[1]+k.y*f)}v&&this.findEndpoints(e)}},lo.storeAllpts=function(e){var t=e._private.rscratch;if("multibezier"===t.edgeType||"bezier"===t.edgeType||"self"===t.edgeType||"compound"===t.edgeType){t.allpts=[],t.allpts.push(t.startX,t.startY);for(var a=0;a+1<t.ctrlpts.length;a+=2)t.allpts.push(t.ctrlpts[a],t.ctrlpts[a+1]),a+3<t.ctrlpts.length&&t.allpts.push((t.ctrlpts[a]+t.ctrlpts[a+2])/2,(t.ctrlpts[a+1]+t.ctrlpts[a+3])/2);var i;t.allpts.push(t.endX,t.endY),t.ctrlpts.length/2%2==0?(i=t.allpts.length/2-1,t.midX=t.allpts[i],t.midY=t.allpts[i+1]):(i=t.allpts.length/2-3,t.midX=He(t.allpts[i],t.allpts[i+2],t.allpts[i+4],.5),t.midY=He(t.allpts[i+1],t.allpts[i+3],t.allpts[i+5],.5))}else if("straight"===t.edgeType)t.allpts=[t.startX,t.startY,t.endX,t.endY],t.midX=(t.startX+t.endX+t.arrowStartX+t.arrowEndX)/4,t.midY=(t.startY+t.endY+t.arrowStartY+t.arrowEndY)/4;else if("segments"===t.edgeType)if(t.allpts=[],t.allpts.push(t.startX,t.startY),t.allpts.push.apply(t.allpts,t.segpts),t.allpts.push(t.endX,t.endY),t.segpts.length%4==0){var n=t.segpts.length/2,s=n-2;t.midX=(t.segpts[s]+t.segpts[n])/2,t.midY=(t.segpts[s+1]+t.segpts[n+1])/2}else{var o=t.segpts.length/2-1;t.midX=t.segpts[o],t.midY=t.segpts[o+1]}},lo.checkForInvalidEdgeWarning=function(e){var t=e[0]._private.rscratch;t.nodesOverlap||O(t.startX)&&O(t.startY)&&O(t.endX)&&O(t.endY)?t.loggedErr=!1:t.loggedErr||(t.loggedErr=!0,de("Edge `"+e.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))},lo.findEdgeControlPoints=function(e){var t=this;if(e&&0!==e.length){for(var a=this,i=a.cy.hasCompoundNodes(),n={map:new ve,get:function(e){var t=this.map.get(e[0]);return null!=t?t.get(e[1]):null},set:function(e,t){var a=this.map.get(e[0]);null==a&&(a=new ve,this.map.set(e[0],a)),a.set(e[1],t)}},s=[],o=[],r=0;r<e.length;r++){var l=e[r],c=l._private,d=l.pstyle("curve-style").value;if(!l.removed()&&l.takesUpSpace())if("haystack"!==d){var u="unbundled-bezier"===d||"segments"===d||"straight"===d||"taxi"===d,p="unbundled-bezier"===d||"bezier"===d,m=c.source,b=c.target,f=[m.poolIndex(),b.poolIndex()].sort(),h=n.get(f);null==h&&(h={eles:[]},n.set(f,h),s.push(f)),h.eles.push(l),u&&(h.hasUnbundled=!0),p&&(h.hasBezier=!0)}else o.push(l)}for(var g=function(e){var o=s[e],r=n.get(o),l=void 0;if(!r.hasUnbundled){var c=r.eles[0].parallelEdges().filter((function(e){return e.isBundledBezier()}));ge(r.eles),c.forEach((function(e){return r.eles.push(e)})),r.eles.sort((function(e,t){return e.poolIndex()-t.poolIndex()}))}var d=r.eles[0],u=d.source(),p=d.target();if(u.poolIndex()>p.poolIndex()){var m=u;u=p,p=m}var b=r.srcPos=u.position(),f=r.tgtPos=p.position(),h=r.srcW=u.outerWidth(),g=r.srcH=u.outerHeight(),j=r.tgtW=p.outerWidth(),x=r.tgtH=p.outerHeight(),v=r.srcShape=a.nodeShapes[t.getNodeShape(u)],y=r.tgtShape=a.nodeShapes[t.getNodeShape(p)];r.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var E=0;E<r.eles.length;E++){var w=r.eles[E],M=w[0]._private.rscratch,S=w.pstyle("curve-style").value,_="unbundled-bezier"===S||"segments"===S||"taxi"===S,T=!u.same(w.source());if(!r.calculatedIntersection&&u!==p&&(r.hasBezier||r.hasUnbundled)){r.calculatedIntersection=!0;var C=v.intersectLine(b.x,b.y,h,g,f.x,f.y,0),k=r.srcIntn=C,F=y.intersectLine(f.x,f.y,j,x,b.x,b.y,0),I=r.tgtIntn=F,D=r.intersectionPts={x1:C[0],x2:F[0],y1:C[1],y2:F[1]},A=r.posPts={x1:b.x,x2:f.x,y1:b.y,y2:f.y},L=F[1]-C[1],R=F[0]-C[0],N=Math.sqrt(R*R+L*L),P=r.vector={x:R,y:L},z=r.vectorNorm={x:P.x/N,y:P.y/N},B={x:-z.y,y:z.x};r.nodesOverlap=!O(N)||y.checkPoint(C[0],C[1],0,j,x,f.x,f.y)||v.checkPoint(F[0],F[1],0,h,g,b.x,b.y),r.vectorNormInverse=B,l={nodesOverlap:r.nodesOverlap,dirCounts:r.dirCounts,calculatedIntersection:!0,hasBezier:r.hasBezier,hasUnbundled:r.hasUnbundled,eles:r.eles,srcPos:f,tgtPos:b,srcW:j,srcH:x,tgtW:h,tgtH:g,srcIntn:I,tgtIntn:k,srcShape:y,tgtShape:v,posPts:{x1:A.x2,y1:A.y2,x2:A.x1,y2:A.y1},intersectionPts:{x1:D.x2,y1:D.y2,x2:D.x1,y2:D.y1},vector:{x:-P.x,y:-P.y},vectorNorm:{x:-z.x,y:-z.y},vectorNormInverse:{x:-B.x,y:-B.y}}}var V=T?l:r;M.nodesOverlap=V.nodesOverlap,M.srcIntn=V.srcIntn,M.tgtIntn=V.tgtIntn,i&&(u.isParent()||u.isChild()||p.isParent()||p.isChild())&&(u.parents().anySame(p)||p.parents().anySame(u)||u.same(p)&&u.isParent())?t.findCompoundLoopPoints(w,V,E,_):u===p?t.findLoopPoints(w,V,E,_):"segments"===S?t.findSegmentsPoints(w,V):"taxi"===S?t.findTaxiPoints(w,V):"straight"===S||!_&&r.eles.length%2==1&&E===Math.floor(r.eles.length/2)?t.findStraightEdgePoints(w):t.findBezierPoints(w,V,E,_,T),t.findEndpoints(w),t.tryToCorrectInvalidPoints(w,V),t.checkForInvalidEdgeWarning(w),t.storeAllpts(w),t.storeEdgeProjections(w),t.calculateArrowAngles(w),t.recalculateEdgeLabelProjections(w),t.calculateLabelAngles(w)}},j=0;j<s.length;j++)g(j);this.findHaystackPoints(o)}},lo.getSegmentPoints=function(e){var t=e[0]._private.rscratch;if("segments"===t.edgeType)return this.recalculateRenderedStyle(e),co(t.segpts)},lo.getControlPoints=function(e){var t=e[0]._private.rscratch,a=t.edgeType;if("bezier"===a||"multibezier"===a||"self"===a||"compound"===a)return this.recalculateRenderedStyle(e),co(t.ctrlpts)},lo.getEdgeMidpoint=function(e){var t=e[0]._private.rscratch;return this.recalculateRenderedStyle(e),{x:t.midX,y:t.midY}};var uo={manualEndptToPx:function(e,t){var a=e.position(),i=e.outerWidth(),n=e.outerHeight();if(2===t.value.length){var s=[t.pfValue[0],t.pfValue[1]];return"%"===t.units[0]&&(s[0]=s[0]*i),"%"===t.units[1]&&(s[1]=s[1]*n),s[0]+=a.x,s[1]+=a.y,s}var o=t.pfValue[0];o=-Math.PI/2+o;var r=2*Math.max(i,n),l=[a.x+Math.cos(o)*r,a.y+Math.sin(o)*r];return this.nodeShapes[this.getNodeShape(e)].intersectLine(a.x,a.y,i,n,l[0],l[1],0)},findEndpoints:function(e){var t,a,i,n,s,o=this,r=e.source()[0],l=e.target()[0],c=r.position(),d=l.position(),u=e.pstyle("target-arrow-shape").value,p=e.pstyle("source-arrow-shape").value,m=e.pstyle("target-distance-from-node").pfValue,b=e.pstyle("source-distance-from-node").pfValue,f=e.pstyle("curve-style").value,h=e._private.rscratch,g=h.edgeType,j="self"===g||"compound"===g,x="bezier"===g||"multibezier"===g||j,v="bezier"!==g,y="straight"===g||"segments"===g,E="segments"===g,w=x||v||y,M=j||"taxi"===f,S=e.pstyle("source-endpoint"),_=M?"outside-to-node":S.value,T=e.pstyle("target-endpoint"),C=M?"outside-to-node":T.value;if(h.srcManEndpt=S,h.tgtManEndpt=T,x){var k=[h.ctrlpts[0],h.ctrlpts[1]];a=v?[h.ctrlpts[h.ctrlpts.length-2],h.ctrlpts[h.ctrlpts.length-1]]:k,i=k}else if(y){var F=E?h.segpts.slice(0,2):[d.x,d.y];a=E?h.segpts.slice(h.segpts.length-2):[c.x,c.y],i=F}if("inside-to-node"===C)t=[d.x,d.y];else if(T.units)t=this.manualEndptToPx(l,T);else if("outside-to-line"===C)t=h.tgtIntn;else if("outside-to-node"===C||"outside-to-node-or-label"===C?n=a:"outside-to-line"!==C&&"outside-to-line-or-label"!==C||(n=[c.x,c.y]),t=o.nodeShapes[this.getNodeShape(l)].intersectLine(d.x,d.y,l.outerWidth(),l.outerHeight(),n[0],n[1],0),"outside-to-node-or-label"===C||"outside-to-line-or-label"===C){var I=l._private.rscratch,D=I.labelWidth,A=I.labelHeight,L=I.labelX,R=I.labelY,N=l.pstyle("text-valign").value;"top"===N?R-=A/2:"bottom"===N&&(R+=A/2);var P=l.pstyle("text-halign").value;"left"===P?L-=D/2:"right"===P&&(L+=D/2);var z=o.nodeShapes.rectangle.intersectLine(L,R,D,A,n[0],n[1],0),B=c,V=$e(B,Ve(t));$e(B,Ve(z))<V&&(t=z)}var J=vt(t,a,o.arrowShapes[u].spacing(e)+m),U=vt(t,a,o.arrowShapes[u].gap(e)+m);if(h.endX=U[0],h.endY=U[1],h.arrowEndX=J[0],h.arrowEndY=J[1],"inside-to-node"===_)t=[c.x,c.y];else if(S.units)t=this.manualEndptToPx(r,S);else if("outside-to-line"===_)t=h.srcIntn;else if("outside-to-node"===_||"outside-to-node-or-label"===_?s=i:"outside-to-line"!==_&&"outside-to-line-or-label"!==_||(s=[d.x,d.y]),t=o.nodeShapes[this.getNodeShape(r)].intersectLine(c.x,c.y,r.outerWidth(),r.outerHeight(),s[0],s[1],0),"outside-to-node-or-label"===_||"outside-to-line-or-label"===_){var G=r._private.rscratch,q=G.labelWidth,$=G.labelHeight,W=G.labelX,H=G.labelY,Y=r.pstyle("text-valign").value;"top"===Y?H-=$/2:"bottom"===Y&&(H+=$/2);var X=r.pstyle("text-halign").value;"left"===X?W-=q/2:"right"===X&&(W+=q/2);var Q=o.nodeShapes.rectangle.intersectLine(W,H,q,$,s[0],s[1],0),K=d,Z=$e(K,Ve(t));$e(K,Ve(Q))<Z&&(t=Q)}var ee=vt(t,i,o.arrowShapes[p].spacing(e)+b),te=vt(t,i,o.arrowShapes[p].gap(e)+b);h.startX=te[0],h.startY=te[1],h.arrowStartX=ee[0],h.arrowStartY=ee[1],w&&(O(h.startX)&&O(h.startY)&&O(h.endX)&&O(h.endY)?h.badLine=!1:h.badLine=!0)},getSourceEndpoint:function(e){var t=e[0]._private.rscratch;return this.recalculateRenderedStyle(e),"haystack"===t.edgeType?{x:t.haystackPts[0],y:t.haystackPts[1]}:{x:t.arrowStartX,y:t.arrowStartY}},getTargetEndpoint:function(e){var t=e[0]._private.rscratch;return this.recalculateRenderedStyle(e),"haystack"===t.edgeType?{x:t.haystackPts[2],y:t.haystackPts[3]}:{x:t.arrowEndX,y:t.arrowEndY}}},po={};function mo(e,t,a){for(var i=function(e,t,a,i){return He(e,t,a,i)},n=t._private.rstyle.bezierPts,s=0;s<e.bezierProjPcts.length;s++){var o=e.bezierProjPcts[s];n.push({x:i(a[0],a[2],a[4],o),y:i(a[1],a[3],a[5],o)})}}po.storeEdgeProjections=function(e){var t=e._private,a=t.rscratch,i=a.edgeType;if(t.rstyle.bezierPts=null,t.rstyle.linePts=null,t.rstyle.haystackPts=null,"multibezier"===i||"bezier"===i||"self"===i||"compound"===i){t.rstyle.bezierPts=[];for(var n=0;n+5<a.allpts.length;n+=4)mo(this,e,a.allpts.slice(n,n+6))}else if("segments"===i){var s=t.rstyle.linePts=[];for(n=0;n+1<a.allpts.length;n+=2)s.push({x:a.allpts[n],y:a.allpts[n+1]})}else if("haystack"===i){var o=a.haystackPts;t.rstyle.haystackPts=[{x:o[0],y:o[1]},{x:o[2],y:o[3]}]}t.rstyle.arrowWidth=this.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.arrowShapeWidth},po.recalculateEdgeProjections=function(e){this.findEdgeControlPoints(e)};var bo={recalculateNodeLabelProjection:function(e){var t=e.pstyle("label").strValue;if(!C(t)){var a,i,n=e._private,s=e.width(),o=e.height(),r=e.padding(),l=e.position(),c=e.pstyle("text-halign").strValue,d=e.pstyle("text-valign").strValue,u=n.rscratch,p=n.rstyle;switch(c){case"left":a=l.x-s/2-r;break;case"right":a=l.x+s/2+r;break;default:a=l.x}switch(d){case"top":i=l.y-o/2-r;break;case"bottom":i=l.y+o/2+r;break;default:i=l.y}u.labelX=a,u.labelY=i,p.labelX=a,p.labelY=i,this.applyLabelDimensions(e)}}},fo=function(e,t){var a=Math.atan(t/e);return 0===e&&a<0&&(a*=-1),a},ho=function(e,t){var a=t.x-e.x,i=t.y-e.y;return fo(a,i)};bo.recalculateEdgeLabelProjections=function(e){var t,a=e._private,i=a.rscratch,n=this,s={mid:e.pstyle("label").strValue,source:e.pstyle("source-label").strValue,target:e.pstyle("target-label").strValue};if(s.mid||s.source||s.target){t={x:i.midX,y:i.midY};var o=function(e,t,i){xe(a.rscratch,e,t,i),xe(a.rstyle,e,t,i)};o("labelX",null,t.x),o("labelY",null,t.y);var r=fo(i.midDispX,i.midDispY);o("labelAutoAngle",null,r);var l=function e(){if(e.cache)return e.cache;for(var t=[],s=0;s+5<i.allpts.length;s+=4){var o={x:i.allpts[s],y:i.allpts[s+1]},r={x:i.allpts[s+2],y:i.allpts[s+3]},l={x:i.allpts[s+4],y:i.allpts[s+5]};t.push({p0:o,p1:r,p2:l,startDist:0,length:0,segments:[]})}var c=a.rstyle.bezierPts,d=n.bezierProjPcts.length;function u(e,t,a,i,n){var s=qe(t,a),o=e.segments[e.segments.length-1],r={p0:t,p1:a,t0:i,t1:n,startDist:o?o.startDist+o.length:0,length:s};e.segments.push(r),e.length+=s}for(var p=0;p<t.length;p++){var m=t[p],b=t[p-1];b&&(m.startDist=b.startDist+b.length),u(m,m.p0,c[p*d],0,n.bezierProjPcts[0]);for(var f=0;f<d-1;f++)u(m,c[p*d+f],c[p*d+f+1],n.bezierProjPcts[f],n.bezierProjPcts[f+1]);u(m,c[p*d+d-1],m.p2,n.bezierProjPcts[d-1],1)}return e.cache=t},c=function(a){var n,r="source"===a;if(s[a]){var c=e.pstyle(a+"-text-offset").pfValue;switch(i.edgeType){case"self":case"compound":case"bezier":case"multibezier":for(var d,u=l(),p=0,m=0,b=0;b<u.length;b++){for(var f=u[r?b:u.length-1-b],h=0;h<f.segments.length;h++){var g=f.segments[r?h:f.segments.length-1-h],j=b===u.length-1&&h===f.segments.length-1;if(p=m,(m+=g.length)>=c||j){d={cp:f,segment:g};break}}if(d)break}var x=d.cp,v=d.segment,y=(c-p)/v.length,O=v.t1-v.t0,E=r?v.t0+O*y:v.t1-O*y;E=Xe(0,E,1),t=Ye(x.p0,x.p1,x.p2,E),n=function(e,t,a,i){var n=Xe(0,i-.001,1),s=Xe(0,i+.001,1),o=Ye(e,t,a,n),r=Ye(e,t,a,s);return ho(o,r)}(x.p0,x.p1,x.p2,E);break;case"straight":case"segments":case"haystack":for(var w,M,S,_,T=0,C=i.allpts.length,k=0;k+3<C&&(r?(S={x:i.allpts[k],y:i.allpts[k+1]},_={x:i.allpts[k+2],y:i.allpts[k+3]}):(S={x:i.allpts[C-2-k],y:i.allpts[C-1-k]},_={x:i.allpts[C-4-k],y:i.allpts[C-3-k]}),M=T,!((T+=w=qe(S,_))>=c));k+=2);var F=(c-M)/w;F=Xe(0,F,1),t=function(e,t,a,i){var n=t.x-e.x,s=t.y-e.y,o=qe(e,t),r=n/o,l=s/o;return a=null==a?0:a,i=null!=i?i:a*o,{x:e.x+r*i,y:e.y+l*i}}(S,_,F),n=ho(S,_)}o("labelX",a,t.x),o("labelY",a,t.y),o("labelAutoAngle",a,n)}};c("source"),c("target"),this.applyLabelDimensions(e)}},bo.applyLabelDimensions=function(e){this.applyPrefixedLabelDimensions(e),e.isEdge()&&(this.applyPrefixedLabelDimensions(e,"source"),this.applyPrefixedLabelDimensions(e,"target"))},bo.applyPrefixedLabelDimensions=function(e,t){var a=e._private,i=this.getLabelText(e,t),n=this.calculateLabelDimensions(e,i),s=e.pstyle("line-height").pfValue,o=e.pstyle("text-wrap").strValue,r=je(a.rscratch,"labelWrapCachedLines",t)||[],l="wrap"!==o?1:Math.max(r.length,1),c=n.height/l,d=c*s,u=n.width,p=n.height+(l-1)*(s-1)*c;xe(a.rstyle,"labelWidth",t,u),xe(a.rscratch,"labelWidth",t,u),xe(a.rstyle,"labelHeight",t,p),xe(a.rscratch,"labelHeight",t,p),xe(a.rscratch,"labelLineHeight",t,d)},bo.getLabelText=function(e,t){var a=e._private,i=t?t+"-":"",n=e.pstyle(i+"label").strValue,s=e.pstyle("text-transform").value,o=function(e,i){return i?(xe(a.rscratch,e,t,i),i):je(a.rscratch,e,t)};if(!n)return"";"none"==s||("uppercase"==s?n=n.toUpperCase():"lowercase"==s&&(n=n.toLowerCase()));var r=e.pstyle("text-wrap").value;if("wrap"===r){var l=o("labelKey");if(null!=l&&o("labelWrapKey")===l)return o("labelWrapCachedText");for(var c=n.split("\n"),d=e.pstyle("text-max-width").pfValue,u="anywhere"===e.pstyle("text-overflow-wrap").value,p=[],m=/[\s\u200b]+/,b=u?"":" ",f=0;f<c.length;f++){var h=c[f],g=this.calculateLabelDimensions(e,h).width;if(u){var j=h.split("").join("​");h=j}if(g>d){for(var x=h.split(m),v="",y=0;y<x.length;y++){var O=x[y],E=0===v.length?O:v+b+O;this.calculateLabelDimensions(e,E).width<=d?v+=O+b:(p.push(v),v=O+b)}v.match(/^[\s\u200b]+$/)||p.push(v)}else p.push(h)}o("labelWrapCachedLines",p),n=o("labelWrapCachedText",p.join("\n")),o("labelWrapKey",l)}else if("ellipsis"===r){for(var w=e.pstyle("text-max-width").pfValue,M="",S=!1,_=0;_<n.length&&!(this.calculateLabelDimensions(e,M+n[_]+"…").width>w);_++)M+=n[_],_===n.length-1&&(S=!0);return S||(M+="…"),M}return n},bo.getLabelJustification=function(e){var t=e.pstyle("text-justification").strValue,a=e.pstyle("text-halign").strValue;if("auto"!==t)return t;if(!e.isNode())return"center";switch(a){case"left":return"right";case"right":return"left";default:return"center"}},bo.calculateLabelDimensions=function(e,t){var a=Q(t,e._private.labelDimsKey),i=this.labelDimCache||(this.labelDimCache=[]),n=i[a];if(null!=n)return n;var s=e.pstyle("font-style").strValue,o=1*e.pstyle("font-size").pfValue+"px",r=e.pstyle("font-family").strValue,l=e.pstyle("font-weight").strValue,c=this.labelCalcDiv;c||(c=this.labelCalcDiv=document.createElement("div"),document.body.appendChild(c));var d=c.style;return d.fontFamily=r,d.fontStyle=s,d.fontSize=o,d.fontWeight=l,d.position="absolute",d.left="-9999px",d.top="-9999px",d.zIndex="-1",d.visibility="hidden",d.pointerEvents="none",d.padding="0",d.lineHeight="1","wrap"===e.pstyle("text-wrap").value?d.whiteSpace="pre":d.whiteSpace="normal",c.textContent=t,i[a]={width:Math.ceil(c.clientWidth/1),height:Math.ceil(c.clientHeight/1)}},bo.calculateLabelAngle=function(e,t){var a=e._private.rscratch,i=e.isEdge(),n=t?t+"-":"",s=e.pstyle(n+"text-rotation"),o=s.strValue;return"none"===o?0:i&&"autorotate"===o?a.labelAutoAngle:"autorotate"===o?0:s.pfValue},bo.calculateLabelAngles=function(e){var t=this,a=e.isEdge(),i=e._private.rscratch;i.labelAngle=t.calculateLabelAngle(e),a&&(i.sourceLabelAngle=t.calculateLabelAngle(e,"source"),i.targetLabelAngle=t.calculateLabelAngle(e,"target"))};var go={},jo=!1;go.getNodeShape=function(e){var t=e.pstyle("shape").value;if("cutrectangle"===t&&(e.width()<28||e.height()<28))return jo||(de("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),jo=!0),"rectangle";if(e.isParent())return"rectangle"===t||"roundrectangle"===t||"cutrectangle"===t||"barrel"===t?t:"rectangle";if("polygon"===t){var a=e.pstyle("shape-polygon-points").value;return this.nodeShapes.makePolygon(a).name}return t};var xo={updateCachedGrabbedEles:function(){var e=this.cachedZSortedEles;if(e){e.drag=[],e.nondrag=[];for(var t=[],a=0;a<e.length;a++){var i=(n=e[a])._private.rscratch;n.grabbed()&&!n.isParent()?t.push(n):i.inDragLayer?e.drag.push(n):e.nondrag.push(n)}for(a=0;a<t.length;a++){var n=t[a];e.drag.push(n)}}},invalidateCachedZSortedEles:function(){this.cachedZSortedEles=null},getCachedZSortedEles:function(e){if(e||!this.cachedZSortedEles){var t=this.cy.mutableElements().toArray();t.sort(rn),t.interactive=t.filter((function(e){return e.interactive()})),this.cachedZSortedEles=t,this.updateCachedGrabbedEles()}else t=this.cachedZSortedEles;return t}},vo={};[oo,ro,lo,uo,po,bo,go,{registerCalculationListeners:function(){var e=this.cy,t=e.collection(),a=this,i=function(e){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t.merge(e),a)for(var i=0;i<e.length;i++){var n=e[i],s=n._private,o=s.rstyle;o.clean=!1,o.cleanConnected=!1}};a.binder(e).on("bounds.* dirty.*",(function(e){var t=e.target;i(t)})).on("style.* background.*",(function(e){var t=e.target;i(t,!1)}));var n=function(n){if(n){for(var s=a.onUpdateEleCalcsFns,o=0;o<t.length;o++){var r=t[o],l=r._private.rstyle;r.isNode()&&!l.cleanConnected&&(i(r.connectedEdges()),l.cleanConnected=!0)}if(s)for(o=0;o<s.length;o++)(0,s[o])(n,t);a.recalculateRenderedStyle(t),t=e.collection()}};a.flushRenderedStyleQueue=function(){n(!0)},a.beforeRender(n,a.beforeRenderPriorities.eleCalcs)},onUpdateEleCalcs:function(e){(this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[]).push(e)},recalculateRenderedStyle:function(e,t){var a=[],i=[];if(!this.destroyed){void 0===t&&(t=!0);for(var n=0;n<e.length;n++){var s=(l=(r=e[n])._private).rstyle;t&&s.clean||r.removed()||"none"!==r.pstyle("display").value&&("nodes"===l.group?i.push(r):a.push(r),s.clean=!0)}for(n=0;n<i.length;n++){s=(l=(r=i[n])._private).rstyle;var o=r.position();this.recalculateNodeLabelProjection(r),s.nodeX=o.x,s.nodeY=o.y,s.nodeW=r.pstyle("width").pfValue,s.nodeH=r.pstyle("height").pfValue}for(this.recalculateEdgeProjections(a),n=0;n<a.length;n++){s=(l=(r=a[n])._private).rstyle;var r,l,c=l.rscratch;s.srcX=c.arrowStartX,s.srcY=c.arrowStartY,s.tgtX=c.arrowEndX,s.tgtY=c.arrowEndY,s.midX=c.midX,s.midY=c.midY,s.labelAngle=c.labelAngle,s.sourceLabelAngle=c.sourceLabelAngle,s.targetLabelAngle=c.targetLabelAngle}}}},xo].forEach((function(e){P(vo,e)}));var yo={getCachedImage:function(e,t,a){var i=this.imageCache=this.imageCache||{},n=i[e];if(n)return n.image.complete||n.image.addEventListener("load",a),n.image;var s=(n=i[e]=i[e]||{}).image=new Image;s.addEventListener("load",a),s.addEventListener("error",(function(){s.error=!0}));var o="data:";return e.substring(0,o.length).toLowerCase()===o||(s.crossOrigin=t),s.src=e,s}},Oo={registerBinding:function(e,t,a,i){var n=Array.prototype.slice.apply(arguments,[1]),s=this.binder(e);return s.on.apply(s,n)},binder:function(e){var t=this,a=e===window||e===document||e===document.body||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement;if(null==t.supportsPassiveEvents){var i=!1;try{var n=Object.defineProperty({},"passive",{get:function(){return i=!0,!0}});window.addEventListener("test",null,n)}catch(e){}t.supportsPassiveEvents=i}var s=function(i,n,s){var o=Array.prototype.slice.call(arguments);return a&&t.supportsPassiveEvents&&(o[2]={capture:null!=s&&s,passive:!1,once:!1}),t.bindings.push({target:e,args:o}),(e.addEventListener||e.on).apply(e,o),this};return{on:s,addEventListener:s,addListener:s,bind:s}},nodeIsDraggable:function(e){return e&&e.isNode()&&!e.locked()&&e.grabbable()},nodeIsGrabbable:function(e){return this.nodeIsDraggable(e)&&e.interactive()}};Oo.load=function(){var e=this,t=function(e){return e.selected()},a=function(t,a,i,n){null==t&&(t=e.cy);for(var s=0;s<a.length;s++){var o=a[s];t.emit({originalEvent:i,type:o,position:n})}},i=function(e){return e.shiftKey||e.metaKey||e.ctrlKey},s=function(t,a){var i=!0;if(e.cy.hasCompoundNodes()&&t&&t.pannable()){for(var n=0;a&&n<a.length;n++)if((t=a[n]).isNode()&&t.isParent()){i=!1;break}}else i=!0;return i},o=function(e){e[0]._private.rscratch.inDragLayer=!0},r=function(e){e[0]._private.rscratch.isGrabTarget=!0},l=function(e,t){var a=t.addToList;a.has(e)||(a.merge(e),function(e){e[0]._private.grabbed=!0}(e))},c=function(t,a){a=a||{};var i=t.cy().hasCompoundNodes();a.inDragLayer&&(t.forEach(o),t.neighborhood().stdFilter((function(e){return!i||e.isEdge()})).forEach(o)),a.addToList&&t.forEach((function(e){l(e,a)})),function(e,t){if(e.cy().hasCompoundNodes()&&(null!=t.inDragLayer||null!=t.addToList)){var a=e.descendants();t.inDragLayer&&(a.forEach(o),a.connectedEdges().forEach(o)),t.addToList&&t.addToList.unmerge(a)}}(t,a),p(t,{inDragLayer:a.inDragLayer}),e.updateCachedGrabbedEles()},d=c,u=function(t){t&&(e.getCachedZSortedEles().forEach((function(e){!function(e){e[0]._private.grabbed=!1}(e),function(e){e[0]._private.rscratch.inDragLayer=!1}(e),function(e){e[0]._private.rscratch.isGrabTarget=!1}(e)})),e.updateCachedGrabbedEles())},p=function(e,t){if((null!=t.inDragLayer||null!=t.addToList)&&e.cy().hasCompoundNodes()){var a=e.ancestors().orphans();if(!a.same(e)){var i=a.descendants().spawnSelf().merge(a).unmerge(e).unmerge(e.descendants()),n=i.connectedEdges();t.inDragLayer&&(n.forEach(o),i.forEach(o)),t.addToList&&i.forEach((function(e){l(e,t)}))}}},m=function(){null!=document.activeElement&&null!=document.activeElement.blur&&document.activeElement.blur()},b="undefined"!=typeof MutationObserver,f="undefined"!=typeof ResizeObserver;b?(e.removeObserver=new MutationObserver((function(t){for(var a=0;a<t.length;a++){var i=t[a].removedNodes;if(i)for(var n=0;n<i.length;n++)if(i[n]===e.container){e.destroy();break}}})),e.container.parentNode&&e.removeObserver.observe(e.container.parentNode,{childList:!0})):e.registerBinding(e.container,"DOMNodeRemoved",(function(t){e.destroy()}));var h=n((function(){e.cy.resize()}),100);b&&(e.styleObserver=new MutationObserver(h),e.styleObserver.observe(e.container,{attributes:!0})),e.registerBinding(window,"resize",h),f&&(e.resizeObserver=new ResizeObserver(h),e.resizeObserver.observe(e.container));var g=function(){e.invalidateContainerClientCoordsCache()};!function(e,t){for(;null!=e;)t(e),e=e.parentNode}(e.container,(function(t){e.registerBinding(t,"transitionend",g),e.registerBinding(t,"animationend",g),e.registerBinding(t,"scroll",g)})),e.registerBinding(e.container,"contextmenu",(function(e){e.preventDefault()}));var j,x,v,y,E,w,M,S,_,T,C,k,F,I=function(t){for(var a=e.findContainerClientCoords(),i=a[0],n=a[1],s=a[2],o=a[3],r=t.touches?t.touches:[t],l=!1,c=0;c<r.length;c++){var d=r[c];if(i<=d.clientX&&d.clientX<=i+s&&n<=d.clientY&&d.clientY<=n+o){l=!0;break}}if(!l)return!1;for(var u=e.container,p=t.target.parentNode,m=!1;p;){if(p===u){m=!0;break}p=p.parentNode}return!!m};e.registerBinding(e.container,"mousedown",(function(t){if(I(t)){t.preventDefault(),m(),e.hoverData.capture=!0,e.hoverData.which=t.which;var i=e.cy,n=[t.clientX,t.clientY],s=e.projectIntoViewport(n[0],n[1]),o=e.selection,l=e.findNearestElements(s[0],s[1],!0,!1),u=l[0],p=e.dragData.possibleDragElements;if(e.hoverData.mdownPos=s,e.hoverData.mdownGPos=n,3==t.which){e.hoverData.cxtStarted=!0;var b={originalEvent:t,type:"cxttapstart",position:{x:s[0],y:s[1]}};u?(u.activate(),u.emit(b),e.hoverData.down=u):i.emit(b),e.hoverData.downTime=(new Date).getTime(),e.hoverData.cxtDragged=!1}else if(1==t.which){if(u&&u.activate(),null!=u&&e.nodeIsGrabbable(u)){var f=function(e){return{originalEvent:t,type:e,position:{x:s[0],y:s[1]}}};if(r(u),u.selected()){p=e.dragData.possibleDragElements=i.collection();var h=i.$((function(t){return t.isNode()&&t.selected()&&e.nodeIsGrabbable(t)}));c(h,{addToList:p}),u.emit(f("grabon")),h.forEach((function(e){e.emit(f("grab"))}))}else p=e.dragData.possibleDragElements=i.collection(),d(u,{addToList:p}),u.emit(f("grabon")).emit(f("grab"));e.redrawHint("eles",!0),e.redrawHint("drag",!0)}e.hoverData.down=u,e.hoverData.downs=l,e.hoverData.downTime=(new Date).getTime(),a(u,["mousedown","tapstart","vmousedown"],t,{x:s[0],y:s[1]}),null==u?(o[4]=1,e.data.bgActivePosistion={x:s[0],y:s[1]},e.redrawHint("select",!0),e.redraw()):u.pannable()&&(o[4]=1),e.hoverData.tapholdCancelled=!1,clearTimeout(e.hoverData.tapholdTimeout),e.hoverData.tapholdTimeout=setTimeout((function(){if(!e.hoverData.tapholdCancelled){var a=e.hoverData.down;a?a.emit({originalEvent:t,type:"taphold",position:{x:s[0],y:s[1]}}):i.emit({originalEvent:t,type:"taphold",position:{x:s[0],y:s[1]}})}}),e.tapholdDuration)}o[0]=o[2]=s[0],o[1]=o[3]=s[1]}}),!1),e.registerBinding(window,"mousemove",(function(t){if(e.hoverData.capture||I(t)){var n=!1,o=e.cy,r=o.zoom(),l=[t.clientX,t.clientY],d=e.projectIntoViewport(l[0],l[1]),p=e.hoverData.mdownPos,m=e.hoverData.mdownGPos,b=e.selection,f=null;e.hoverData.draggingEles||e.hoverData.dragging||e.hoverData.selecting||(f=e.findNearestElement(d[0],d[1],!0,!1));var h,g=e.hoverData.last,j=e.hoverData.down,x=[d[0]-b[2],d[1]-b[3]],v=e.dragData.possibleDragElements;if(m){var y=l[0]-m[0],E=y*y,w=l[1]-m[1],M=E+w*w;e.hoverData.isOverThresholdDrag=h=M>=e.desktopTapThreshold2}var S=i(t);h&&(e.hoverData.tapholdCancelled=!0),n=!0,a(f,["mousemove","vmousemove","tapdrag"],t,{x:d[0],y:d[1]});var _=function(){e.data.bgActivePosistion=void 0,e.hoverData.selecting||o.emit({originalEvent:t,type:"boxstart",position:{x:d[0],y:d[1]}}),b[4]=1,e.hoverData.selecting=!0,e.redrawHint("select",!0),e.redraw()};if(3===e.hoverData.which){if(h){var T={originalEvent:t,type:"cxtdrag",position:{x:d[0],y:d[1]}};j?j.emit(T):o.emit(T),e.hoverData.cxtDragged=!0,e.hoverData.cxtOver&&f===e.hoverData.cxtOver||(e.hoverData.cxtOver&&e.hoverData.cxtOver.emit({originalEvent:t,type:"cxtdragout",position:{x:d[0],y:d[1]}}),e.hoverData.cxtOver=f,f&&f.emit({originalEvent:t,type:"cxtdragover",position:{x:d[0],y:d[1]}}))}}else if(e.hoverData.dragging){if(n=!0,o.panningEnabled()&&o.userPanningEnabled()){var C;if(e.hoverData.justStartedPan){var k=e.hoverData.mdownPos;C={x:(d[0]-k[0])*r,y:(d[1]-k[1])*r},e.hoverData.justStartedPan=!1}else C={x:x[0]*r,y:x[1]*r};o.panBy(C),e.hoverData.dragged=!0}d=e.projectIntoViewport(t.clientX,t.clientY)}else if(1!=b[4]||null!=j&&!j.pannable()){if(j&&j.pannable()&&j.active()&&j.unactivate(),j&&j.grabbed()||f==g||(g&&a(g,["mouseout","tapdragout"],t,{x:d[0],y:d[1]}),f&&a(f,["mouseover","tapdragover"],t,{x:d[0],y:d[1]}),e.hoverData.last=f),j)if(h){if(o.boxSelectionEnabled()&&S)j&&j.grabbed()&&(u(v),j.emit("freeon"),v.emit("free"),e.dragData.didDrag&&(j.emit("dragfreeon"),v.emit("dragfree"))),_();else if(j&&j.grabbed()&&e.nodeIsDraggable(j)){var F=!e.dragData.didDrag;F&&e.redrawHint("eles",!0),e.dragData.didDrag=!0;var D=o.collection();e.hoverData.draggingEles||c(v,{inDragLayer:!0});var A={x:0,y:0};if(O(x[0])&&O(x[1])&&(A.x+=x[0],A.y+=x[1],F)){var L=e.hoverData.dragDelta;L&&O(L[0])&&O(L[1])&&(A.x+=L[0],A.y+=L[1])}for(var R=0;R<v.length;R++){var N=v[R];e.nodeIsDraggable(N)&&N.grabbed()&&D.merge(N)}e.hoverData.draggingEles=!0,D.silentShift(A).emit("position drag"),e.redrawHint("drag",!0),e.redraw()}}else!function(){var t=e.hoverData.dragDelta=e.hoverData.dragDelta||[];0===t.length?(t.push(x[0]),t.push(x[1])):(t[0]+=x[0],t[1]+=x[1])}();n=!0}else h&&(e.hoverData.dragging||!o.boxSelectionEnabled()||!S&&o.panningEnabled()&&o.userPanningEnabled()?!e.hoverData.selecting&&o.panningEnabled()&&o.userPanningEnabled()&&s(j,e.hoverData.downs)&&(e.hoverData.dragging=!0,e.hoverData.justStartedPan=!0,b[4]=0,e.data.bgActivePosistion=Ve(p),e.redrawHint("select",!0),e.redraw()):_(),j&&j.pannable()&&j.active()&&j.unactivate());return b[2]=d[0],b[3]=d[1],n?(t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),!1):void 0}}),!1),e.registerBinding(window,"mouseup",(function(n){if(e.hoverData.capture){e.hoverData.capture=!1;var s=e.cy,o=e.projectIntoViewport(n.clientX,n.clientY),r=e.selection,l=e.findNearestElement(o[0],o[1],!0,!1),c=e.dragData.possibleDragElements,d=e.hoverData.down,p=i(n);if(e.data.bgActivePosistion&&(e.redrawHint("select",!0),e.redraw()),e.hoverData.tapholdCancelled=!0,e.data.bgActivePosistion=void 0,d&&d.unactivate(),3===e.hoverData.which){var m={originalEvent:n,type:"cxttapend",position:{x:o[0],y:o[1]}};if(d?d.emit(m):s.emit(m),!e.hoverData.cxtDragged){var b={originalEvent:n,type:"cxttap",position:{x:o[0],y:o[1]}};d?d.emit(b):s.emit(b)}e.hoverData.cxtDragged=!1,e.hoverData.which=null}else if(1===e.hoverData.which){if(a(l,["mouseup","tapend","vmouseup"],n,{x:o[0],y:o[1]}),e.dragData.didDrag||e.hoverData.dragged||e.hoverData.selecting||e.hoverData.isOverThresholdDrag||a(d,["click","tap","vclick"],n,{x:o[0],y:o[1]}),null!=d||e.dragData.didDrag||e.hoverData.selecting||e.hoverData.dragged||i(n)||(s.$(t).unselect(["tapunselect"]),c.length>0&&e.redrawHint("eles",!0),e.dragData.possibleDragElements=c=s.collection()),l!=d||e.dragData.didDrag||e.hoverData.selecting||null!=l&&l._private.selectable&&(e.hoverData.dragging||("additive"===s.selectionType()||p?l.selected()?l.unselect(["tapunselect"]):l.select(["tapselect"]):p||(s.$(t).unmerge(l).unselect(["tapunselect"]),l.select(["tapselect"]))),e.redrawHint("eles",!0)),e.hoverData.selecting){var f=s.collection(e.getAllInBox(r[0],r[1],r[2],r[3]));e.redrawHint("select",!0),f.length>0&&e.redrawHint("eles",!0),s.emit({type:"boxend",originalEvent:n,position:{x:o[0],y:o[1]}});"additive"===s.selectionType()||p||s.$(t).unmerge(f).unselect(),f.emit("box").stdFilter((function(e){return e.selectable()&&!e.selected()})).select().emit("boxselect"),e.redraw()}if(e.hoverData.dragging&&(e.hoverData.dragging=!1,e.redrawHint("select",!0),e.redrawHint("eles",!0),e.redraw()),!r[4]){e.redrawHint("drag",!0),e.redrawHint("eles",!0);var h=d&&d.grabbed();u(c),h&&(d.emit("freeon"),c.emit("free"),e.dragData.didDrag&&(d.emit("dragfreeon"),c.emit("dragfree")))}}r[4]=0,e.hoverData.down=null,e.hoverData.cxtStarted=!1,e.hoverData.draggingEles=!1,e.hoverData.selecting=!1,e.hoverData.isOverThresholdDrag=!1,e.dragData.didDrag=!1,e.hoverData.dragged=!1,e.hoverData.dragDelta=[],e.hoverData.mdownPos=null,e.hoverData.mdownGPos=null}}),!1),e.registerBinding(e.container,"wheel",(function(t){if(!e.scrollingPage){var a,i=e.cy,n=e.projectIntoViewport(t.clientX,t.clientY),s=[n[0]*i.zoom()+i.pan().x,n[1]*i.zoom()+i.pan().y];e.hoverData.draggingEles||e.hoverData.dragging||e.hoverData.cxtStarted||0!==e.selection[4]?t.preventDefault():i.panningEnabled()&&i.userPanningEnabled()&&i.zoomingEnabled()&&i.userZoomingEnabled()&&(t.preventDefault(),e.data.wheelZooming=!0,clearTimeout(e.data.wheelTimeout),e.data.wheelTimeout=setTimeout((function(){e.data.wheelZooming=!1,e.redrawHint("eles",!0),e.redraw()}),150),a=null!=t.deltaY?t.deltaY/-250:null!=t.wheelDeltaY?t.wheelDeltaY/1e3:t.wheelDelta/1e3,a*=e.wheelSensitivity,1===t.deltaMode&&(a*=33),i.zoom({level:i.zoom()*Math.pow(10,a),renderedPosition:{x:s[0],y:s[1]}}))}}),!0),e.registerBinding(window,"scroll",(function(t){e.scrollingPage=!0,clearTimeout(e.scrollingPageTimeout),e.scrollingPageTimeout=setTimeout((function(){e.scrollingPage=!1}),250)}),!0),e.registerBinding(e.container,"mouseout",(function(t){var a=e.projectIntoViewport(t.clientX,t.clientY);e.cy.emit({originalEvent:t,type:"mouseout",position:{x:a[0],y:a[1]}})}),!1),e.registerBinding(e.container,"mouseover",(function(t){var a=e.projectIntoViewport(t.clientX,t.clientY);e.cy.emit({originalEvent:t,type:"mouseover",position:{x:a[0],y:a[1]}})}),!1);var D,A,L,R,N=function(e,t,a,i){return Math.sqrt((a-e)*(a-e)+(i-t)*(i-t))},P=function(e,t,a,i){return(a-e)*(a-e)+(i-t)*(i-t)};if(e.registerBinding(e.container,"touchstart",D=function(t){if(I(t)){m(),e.touchData.capture=!0,e.data.bgActivePosistion=void 0;var i=e.cy,n=e.touchData.now,s=e.touchData.earlier;if(t.touches[0]){var o=e.projectIntoViewport(t.touches[0].clientX,t.touches[0].clientY);n[0]=o[0],n[1]=o[1]}if(t.touches[1]&&(o=e.projectIntoViewport(t.touches[1].clientX,t.touches[1].clientY),n[2]=o[0],n[3]=o[1]),t.touches[2]&&(o=e.projectIntoViewport(t.touches[2].clientX,t.touches[2].clientY),n[4]=o[0],n[5]=o[1]),t.touches[1]){e.touchData.singleTouchMoved=!0,u(e.dragData.touchDragEles);var l=e.findContainerClientCoords();_=l[0],T=l[1],C=l[2],k=l[3],j=t.touches[0].clientX-_,x=t.touches[0].clientY-T,v=t.touches[1].clientX-_,y=t.touches[1].clientY-T,F=0<=j&&j<=C&&0<=v&&v<=C&&0<=x&&x<=k&&0<=y&&y<=k;var p=i.pan(),b=i.zoom();if(E=N(j,x,v,y),w=P(j,x,v,y),S=[((M=[(j+v)/2,(x+y)/2])[0]-p.x)/b,(M[1]-p.y)/b],w<4e4&&!t.touches[2]){var f=e.findNearestElement(n[0],n[1],!0,!0),h=e.findNearestElement(n[2],n[3],!0,!0);return f&&f.isNode()?(f.activate().emit({originalEvent:t,type:"cxttapstart",position:{x:n[0],y:n[1]}}),e.touchData.start=f):h&&h.isNode()?(h.activate().emit({originalEvent:t,type:"cxttapstart",position:{x:n[0],y:n[1]}}),e.touchData.start=h):i.emit({originalEvent:t,type:"cxttapstart",position:{x:n[0],y:n[1]}}),e.touchData.start&&(e.touchData.start._private.grabbed=!1),e.touchData.cxt=!0,e.touchData.cxtDragged=!1,e.data.bgActivePosistion=void 0,void e.redraw()}}if(t.touches[2])i.boxSelectionEnabled()&&t.preventDefault();else if(t.touches[1]);else if(t.touches[0]){var g=e.findNearestElements(n[0],n[1],!0,!0),O=g[0];if(null!=O&&(O.activate(),e.touchData.start=O,e.touchData.starts=g,e.nodeIsGrabbable(O))){var D=e.dragData.touchDragEles=i.collection(),A=null;e.redrawHint("eles",!0),e.redrawHint("drag",!0),O.selected()?(A=i.$((function(t){return t.selected()&&e.nodeIsGrabbable(t)})),c(A,{addToList:D})):d(O,{addToList:D}),r(O);var L=function(e){return{originalEvent:t,type:e,position:{x:n[0],y:n[1]}}};O.emit(L("grabon")),A?A.forEach((function(e){e.emit(L("grab"))})):O.emit(L("grab"))}a(O,["touchstart","tapstart","vmousedown"],t,{x:n[0],y:n[1]}),null==O&&(e.data.bgActivePosistion={x:o[0],y:o[1]},e.redrawHint("select",!0),e.redraw()),e.touchData.singleTouchMoved=!1,e.touchData.singleTouchStartTime=+new Date,clearTimeout(e.touchData.tapholdTimeout),e.touchData.tapholdTimeout=setTimeout((function(){!1!==e.touchData.singleTouchMoved||e.pinching||e.touchData.selecting||a(e.touchData.start,["taphold"],t,{x:n[0],y:n[1]})}),e.tapholdDuration)}if(t.touches.length>=1){for(var R=e.touchData.startPosition=[],z=0;z<n.length;z++)R[z]=s[z]=n[z];var B=t.touches[0];e.touchData.startGPosition=[B.clientX,B.clientY]}}},!1),e.registerBinding(window,"touchmove",A=function(t){var i=e.touchData.capture;if(i||I(t)){var n=e.selection,o=e.cy,r=e.touchData.now,l=e.touchData.earlier,d=o.zoom();if(t.touches[0]){var p=e.projectIntoViewport(t.touches[0].clientX,t.touches[0].clientY);r[0]=p[0],r[1]=p[1]}t.touches[1]&&(p=e.projectIntoViewport(t.touches[1].clientX,t.touches[1].clientY),r[2]=p[0],r[3]=p[1]),t.touches[2]&&(p=e.projectIntoViewport(t.touches[2].clientX,t.touches[2].clientY),r[4]=p[0],r[5]=p[1]);var m,b=e.touchData.startGPosition;if(i&&t.touches[0]&&b){for(var f=[],h=0;h<r.length;h++)f[h]=r[h]-l[h];var g=t.touches[0].clientX-b[0],M=g*g,C=t.touches[0].clientY-b[1];m=M+C*C>=e.touchTapThreshold2}if(i&&e.touchData.cxt){t.preventDefault();var k=t.touches[0].clientX-_,D=t.touches[0].clientY-T,A=t.touches[1].clientX-_,L=t.touches[1].clientY-T,R=P(k,D,A,L);if(R/w>=2.25||R>=22500){e.touchData.cxt=!1,e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);var z={originalEvent:t,type:"cxttapend",position:{x:r[0],y:r[1]}};e.touchData.start?(e.touchData.start.unactivate().emit(z),e.touchData.start=null):o.emit(z)}}if(i&&e.touchData.cxt){z={originalEvent:t,type:"cxtdrag",position:{x:r[0],y:r[1]}},e.data.bgActivePosistion=void 0,e.redrawHint("select",!0),e.touchData.start?e.touchData.start.emit(z):o.emit(z),e.touchData.start&&(e.touchData.start._private.grabbed=!1),e.touchData.cxtDragged=!0;var B=e.findNearestElement(r[0],r[1],!0,!0);e.touchData.cxtOver&&B===e.touchData.cxtOver||(e.touchData.cxtOver&&e.touchData.cxtOver.emit({originalEvent:t,type:"cxtdragout",position:{x:r[0],y:r[1]}}),e.touchData.cxtOver=B,B&&B.emit({originalEvent:t,type:"cxtdragover",position:{x:r[0],y:r[1]}}))}else if(i&&t.touches[2]&&o.boxSelectionEnabled())t.preventDefault(),e.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,e.touchData.selecting||o.emit({originalEvent:t,type:"boxstart",position:{x:r[0],y:r[1]}}),e.touchData.selecting=!0,e.touchData.didSelect=!0,n[4]=1,n&&0!==n.length&&void 0!==n[0]?(n[2]=(r[0]+r[2]+r[4])/3,n[3]=(r[1]+r[3]+r[5])/3):(n[0]=(r[0]+r[2]+r[4])/3,n[1]=(r[1]+r[3]+r[5])/3,n[2]=(r[0]+r[2]+r[4])/3+1,n[3]=(r[1]+r[3]+r[5])/3+1),e.redrawHint("select",!0),e.redraw();else if(i&&t.touches[1]&&!e.touchData.didSelect&&o.zoomingEnabled()&&o.panningEnabled()&&o.userZoomingEnabled()&&o.userPanningEnabled()){if(t.preventDefault(),e.data.bgActivePosistion=void 0,e.redrawHint("select",!0),ee=e.dragData.touchDragEles){e.redrawHint("drag",!0);for(var V=0;V<ee.length;V++){var J=ee[V]._private;J.grabbed=!1,J.rscratch.inDragLayer=!1}}var U=e.touchData.start,G=(k=t.touches[0].clientX-_,D=t.touches[0].clientY-T,A=t.touches[1].clientX-_,L=t.touches[1].clientY-T,N(k,D,A,L)),q=G/E;if(F){var $=(k-j+(A-v))/2,W=(D-x+(L-y))/2,H=o.zoom(),Y=H*q,X=o.pan(),Q=S[0]*H+X.x,K=S[1]*H+X.y,Z={x:-Y/H*(Q-X.x-$)+Q,y:-Y/H*(K-X.y-W)+K};if(U&&U.active()){var ee=e.dragData.touchDragEles;u(ee),e.redrawHint("drag",!0),e.redrawHint("eles",!0),U.unactivate().emit("freeon"),ee.emit("free"),e.dragData.didDrag&&(U.emit("dragfreeon"),ee.emit("dragfree"))}o.viewport({zoom:Y,pan:Z,cancelOnFailedZoom:!0}),E=G,j=k,x=D,v=A,y=L,e.pinching=!0}t.touches[0]&&(p=e.projectIntoViewport(t.touches[0].clientX,t.touches[0].clientY),r[0]=p[0],r[1]=p[1]),t.touches[1]&&(p=e.projectIntoViewport(t.touches[1].clientX,t.touches[1].clientY),r[2]=p[0],r[3]=p[1]),t.touches[2]&&(p=e.projectIntoViewport(t.touches[2].clientX,t.touches[2].clientY),r[4]=p[0],r[5]=p[1])}else if(t.touches[0]&&!e.touchData.didSelect){var te=e.touchData.start,ae=e.touchData.last;if(e.hoverData.draggingEles||e.swipePanning||(B=e.findNearestElement(r[0],r[1],!0,!0)),i&&null!=te&&t.preventDefault(),i&&null!=te&&e.nodeIsDraggable(te))if(m){ee=e.dragData.touchDragEles;var ie=!e.dragData.didDrag;ie&&c(ee,{inDragLayer:!0}),e.dragData.didDrag=!0;var ne={x:0,y:0};O(f[0])&&O(f[1])&&(ne.x+=f[0],ne.y+=f[1],ie&&(e.redrawHint("eles",!0),(se=e.touchData.dragDelta)&&O(se[0])&&O(se[1])&&(ne.x+=se[0],ne.y+=se[1]))),e.hoverData.draggingEles=!0,ee.silentShift(ne).emit("position drag"),e.redrawHint("drag",!0),e.touchData.startPosition[0]==l[0]&&e.touchData.startPosition[1]==l[1]&&e.redrawHint("eles",!0),e.redraw()}else{var se;0===(se=e.touchData.dragDelta=e.touchData.dragDelta||[]).length?(se.push(f[0]),se.push(f[1])):(se[0]+=f[0],se[1]+=f[1])}if(a(te||B,["touchmove","tapdrag","vmousemove"],t,{x:r[0],y:r[1]}),te&&te.grabbed()||B==ae||(ae&&ae.emit({originalEvent:t,type:"tapdragout",position:{x:r[0],y:r[1]}}),B&&B.emit({originalEvent:t,type:"tapdragover",position:{x:r[0],y:r[1]}})),e.touchData.last=B,i)for(V=0;V<r.length;V++)r[V]&&e.touchData.startPosition[V]&&m&&(e.touchData.singleTouchMoved=!0);i&&(null==te||te.pannable())&&o.panningEnabled()&&o.userPanningEnabled()&&(s(te,e.touchData.starts)&&(t.preventDefault(),e.data.bgActivePosistion||(e.data.bgActivePosistion=Ve(e.touchData.startPosition)),e.swipePanning?o.panBy({x:f[0]*d,y:f[1]*d}):m&&(e.swipePanning=!0,o.panBy({x:g*d,y:C*d}),te&&(te.unactivate(),e.redrawHint("select",!0),e.touchData.start=null))),p=e.projectIntoViewport(t.touches[0].clientX,t.touches[0].clientY),r[0]=p[0],r[1]=p[1])}for(h=0;h<r.length;h++)l[h]=r[h];i&&t.touches.length>0&&!e.hoverData.draggingEles&&!e.swipePanning&&null!=e.data.bgActivePosistion&&(e.data.bgActivePosistion=void 0,e.redrawHint("select",!0),e.redraw())}},!1),e.registerBinding(window,"touchcancel",L=function(t){var a=e.touchData.start;e.touchData.capture=!1,a&&a.unactivate()}),e.registerBinding(window,"touchend",R=function(i){var n=e.touchData.start;if(e.touchData.capture){0===i.touches.length&&(e.touchData.capture=!1),i.preventDefault();var s=e.selection;e.swipePanning=!1,e.hoverData.draggingEles=!1;var o,r=e.cy,l=r.zoom(),c=e.touchData.now,d=e.touchData.earlier;if(i.touches[0]){var p=e.projectIntoViewport(i.touches[0].clientX,i.touches[0].clientY);c[0]=p[0],c[1]=p[1]}if(i.touches[1]&&(p=e.projectIntoViewport(i.touches[1].clientX,i.touches[1].clientY),c[2]=p[0],c[3]=p[1]),i.touches[2]&&(p=e.projectIntoViewport(i.touches[2].clientX,i.touches[2].clientY),c[4]=p[0],c[5]=p[1]),n&&n.unactivate(),e.touchData.cxt){if(o={originalEvent:i,type:"cxttapend",position:{x:c[0],y:c[1]}},n?n.emit(o):r.emit(o),!e.touchData.cxtDragged){var m={originalEvent:i,type:"cxttap",position:{x:c[0],y:c[1]}};n?n.emit(m):r.emit(m)}return e.touchData.start&&(e.touchData.start._private.grabbed=!1),e.touchData.cxt=!1,e.touchData.start=null,void e.redraw()}if(!i.touches[2]&&r.boxSelectionEnabled()&&e.touchData.selecting){e.touchData.selecting=!1;var b=r.collection(e.getAllInBox(s[0],s[1],s[2],s[3]));s[0]=void 0,s[1]=void 0,s[2]=void 0,s[3]=void 0,s[4]=0,e.redrawHint("select",!0),r.emit({type:"boxend",originalEvent:i,position:{x:c[0],y:c[1]}}),b.emit("box").stdFilter((function(e){return e.selectable()&&!e.selected()})).select().emit("boxselect"),b.nonempty()&&e.redrawHint("eles",!0),e.redraw()}if(null!=n&&n.unactivate(),i.touches[2])e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);else if(i.touches[1]);else if(i.touches[0]);else if(!i.touches[0]){e.data.bgActivePosistion=void 0,e.redrawHint("select",!0);var f=e.dragData.touchDragEles;if(null!=n){var h=n._private.grabbed;u(f),e.redrawHint("drag",!0),e.redrawHint("eles",!0),h&&(n.emit("freeon"),f.emit("free"),e.dragData.didDrag&&(n.emit("dragfreeon"),f.emit("dragfree"))),a(n,["touchend","tapend","vmouseup","tapdragout"],i,{x:c[0],y:c[1]}),n.unactivate(),e.touchData.start=null}else{var g=e.findNearestElement(c[0],c[1],!0,!0);a(g,["touchend","tapend","vmouseup","tapdragout"],i,{x:c[0],y:c[1]})}var j=e.touchData.startPosition[0]-c[0],x=j*j,v=e.touchData.startPosition[1]-c[1],y=(x+v*v)*l*l;e.touchData.singleTouchMoved||(n||r.$(":selected").unselect(["tapunselect"]),a(n,["tap","vclick"],i,{x:c[0],y:c[1]})),null!=n&&!e.dragData.didDrag&&n._private.selectable&&y<e.touchTapThreshold2&&!e.pinching&&("single"===r.selectionType()?(r.$(t).unmerge(n).unselect(["tapunselect"]),n.select(["tapselect"])):n.selected()?n.unselect(["tapunselect"]):n.select(["tapselect"]),e.redrawHint("eles",!0)),e.touchData.singleTouchMoved=!0}for(var O=0;O<c.length;O++)d[O]=c[O];e.dragData.didDrag=!1,0===i.touches.length&&(e.touchData.dragDelta=[],e.touchData.startPosition=null,e.touchData.startGPosition=null,e.touchData.didSelect=!1),i.touches.length<2&&(1===i.touches.length&&(e.touchData.startGPosition=[i.touches[0].clientX,i.touches[0].clientY]),e.pinching=!1,e.redrawHint("eles",!0),e.redraw())}},!1),"undefined"==typeof TouchEvent){var z=[],B=function(e){return{clientX:e.clientX,clientY:e.clientY,force:1,identifier:e.pointerId,pageX:e.pageX,pageY:e.pageY,radiusX:e.width/2,radiusY:e.height/2,screenX:e.screenX,screenY:e.screenY,target:e.target}},V=function(e){for(var t=0;t<z.length;t++)if(z[t].event.pointerId===e.pointerId)return void z.splice(t,1)},J=function(e){e.touches=z.map((function(e){return e.touch}))},U=function(e){return"mouse"===e.pointerType||4===e.pointerType};e.registerBinding(e.container,"pointerdown",(function(e){U(e)||(e.preventDefault(),function(e){z.push(function(e){return{event:e,touch:B(e)}}(e))}(e),J(e),D(e))})),e.registerBinding(e.container,"pointerup",(function(e){U(e)||(V(e),J(e),R(e))})),e.registerBinding(e.container,"pointercancel",(function(e){U(e)||(V(e),J(e),L())})),e.registerBinding(e.container,"pointermove",(function(e){U(e)||(e.preventDefault(),function(e){var t=z.filter((function(t){return t.event.pointerId===e.pointerId}))[0];t.event=e,t.touch=B(e)}(e),J(e),A(e))}))}};var Eo={generatePolygon:function(e,t){return this.nodeShapes[e]={renderer:this,name:e,points:t,draw:function(e,t,a,i,n){this.renderer.nodeShapeImpl("polygon",e,t,a,i,n,this.points)},intersectLine:function(e,t,a,i,n,s,o){return xt(n,s,this.points,e,t,a/2,i/2,o)},checkPoint:function(e,t,a,i,n,s,o){return pt(e,t,this.points,s,o,i,n,[0,-1],a)}}},generateEllipse:function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(e,t,a,i,n){this.renderer.nodeShapeImpl(this.name,e,t,a,i,n)},intersectLine:function(e,t,a,i,n,s,o){return function(e,t,a,i,n,s){var o=a-e,r=i-t;o/=n,r/=s;var l=Math.sqrt(o*o+r*r),c=l-1;if(c<0)return[];var d=c/l;return[(a-e)*d+e,(i-t)*d+t]}(n,s,e,t,a/2+o,i/2+o)},checkPoint:function(e,t,a,i,n,s,o){return ft(e,t,i,n,s,o,a)}}},generateRoundRectangle:function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:yt(4,0),draw:function(e,t,a,i,n){this.renderer.nodeShapeImpl(this.name,e,t,a,i,n)},intersectLine:function(e,t,a,i,n,s,o){return ot(n,s,e,t,a,i,o)},checkPoint:function(e,t,a,i,n,s,o){var r=wt(i,n),l=2*r;return!!(pt(e,t,this.points,s,o,i,n-l,[0,-1],a)||pt(e,t,this.points,s,o,i-l,n,[0,-1],a)||ft(e,t,l,l,s-i/2+r,o-n/2+r,a)||ft(e,t,l,l,s+i/2-r,o-n/2+r,a)||ft(e,t,l,l,s+i/2-r,o+n/2-r,a)||ft(e,t,l,l,s-i/2+r,o+n/2-r,a))}}},generateCutRectangle:function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:8,points:yt(4,0),draw:function(e,t,a,i,n){this.renderer.nodeShapeImpl(this.name,e,t,a,i,n)},generateCutTrianglePts:function(e,t,a,i){var n=this.cornerLength,s=t/2,o=e/2,r=a-o,l=a+o,c=i-s,d=i+s;return{topLeft:[r,c+n,r+n,c,r+n,c+n],topRight:[l-n,c,l,c+n,l-n,c+n],bottomRight:[l,d-n,l-n,d,l-n,d-n],bottomLeft:[r+n,d,r,d-n,r+n,d-n]}},intersectLine:function(e,t,a,i,n,s,o){var r=this.generateCutTrianglePts(a+2*o,i+2*o,e,t),l=[].concat.apply([],[r.topLeft.splice(0,4),r.topRight.splice(0,4),r.bottomRight.splice(0,4),r.bottomLeft.splice(0,4)]);return xt(n,s,l,e,t)},checkPoint:function(e,t,a,i,n,s,o){if(pt(e,t,this.points,s,o,i,n-2*this.cornerLength,[0,-1],a))return!0;if(pt(e,t,this.points,s,o,i-2*this.cornerLength,n,[0,-1],a))return!0;var r=this.generateCutTrianglePts(i,n,s,o);return ut(e,t,r.topLeft)||ut(e,t,r.topRight)||ut(e,t,r.bottomRight)||ut(e,t,r.bottomLeft)}}},generateBarrel:function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:yt(4,0),draw:function(e,t,a,i,n){this.renderer.nodeShapeImpl(this.name,e,t,a,i,n)},intersectLine:function(e,t,a,i,n,s,o){var r=this.generateBarrelBezierPts(a+2*o,i+2*o,e,t),l=function(e){var t=Ye({x:e[0],y:e[1]},{x:e[2],y:e[3]},{x:e[4],y:e[5]},.15),a=Ye({x:e[0],y:e[1]},{x:e[2],y:e[3]},{x:e[4],y:e[5]},.5),i=Ye({x:e[0],y:e[1]},{x:e[2],y:e[3]},{x:e[4],y:e[5]},.85);return[e[0],e[1],t.x,t.y,a.x,a.y,i.x,i.y,e[4],e[5]]},c=[].concat(l(r.topLeft),l(r.topRight),l(r.bottomRight),l(r.bottomLeft));return xt(n,s,c,e,t)},generateBarrelBezierPts:function(e,t,a,i){var n=t/2,s=e/2,o=a-s,r=a+s,l=i-n,c=i+n,d=Mt(e,t),u=d.heightOffset,p=d.widthOffset,m=d.ctrlPtOffsetPct*e,b={topLeft:[o,l+u,o+m,l,o+p,l],topRight:[r-p,l,r-m,l,r,l+u],bottomRight:[r,c-u,r-m,c,r-p,c],bottomLeft:[o+p,c,o+m,c,o,c-u]};return b.topLeft.isTop=!0,b.topRight.isTop=!0,b.bottomLeft.isBottom=!0,b.bottomRight.isBottom=!0,b},checkPoint:function(e,t,a,i,n,s,o){var r=Mt(i,n),l=r.heightOffset,c=r.widthOffset;if(pt(e,t,this.points,s,o,i,n-2*l,[0,-1],a))return!0;if(pt(e,t,this.points,s,o,i-2*c,n,[0,-1],a))return!0;for(var d=this.generateBarrelBezierPts(i,n,s,o),u=function(e,t,a){var i,n,s=a[4],o=a[2],r=a[0],l=a[5],c=a[1],d=Math.min(s,r),u=Math.max(s,r),p=Math.min(l,c),m=Math.max(l,c);if(d<=e&&e<=u&&p<=t&&t<=m){var b=[(i=s)-2*(n=o)+r,2*(n-i),i],f=function(e,t,a,i){var n=t*t-4*e*(a-=i);if(n<0)return[];var s=Math.sqrt(n),o=2*e;return[(-t+s)/o,(-t-s)/o]}(b[0],b[1],b[2],e).filter((function(e){return 0<=e&&e<=1}));if(f.length>0)return f[0]}return null},p=Object.keys(d),m=0;m<p.length;m++){var b=d[p[m]],f=u(e,t,b);if(null!=f){var h=b[5],g=b[3],j=b[1],x=He(h,g,j,f);if(b.isTop&&x<=t)return!0;if(b.isBottom&&t<=x)return!0}}return!1}}},generateBottomRoundrectangle:function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:yt(4,0),draw:function(e,t,a,i,n){this.renderer.nodeShapeImpl(this.name,e,t,a,i,n)},intersectLine:function(e,t,a,i,n,s,o){var r=t-(i/2+o),l=jt(n,s,e,t,e-(a/2+o),r,e+(a/2+o),r,!1);return l.length>0?l:ot(n,s,e,t,a,i,o)},checkPoint:function(e,t,a,i,n,s,o){var r=wt(i,n),l=2*r;if(pt(e,t,this.points,s,o,i,n-l,[0,-1],a))return!0;if(pt(e,t,this.points,s,o,i-l,n,[0,-1],a))return!0;var c=i/2+2*a,d=n/2+2*a;return!!ut(e,t,[s-c,o-d,s-c,o,s+c,o,s+c,o-d])||!!ft(e,t,l,l,s+i/2-r,o+n/2-r,a)||!!ft(e,t,l,l,s-i/2+r,o+n/2-r,a)}}},registerNodeShapes:function(){var e=this.nodeShapes={},t=this;this.generateEllipse(),this.generatePolygon("triangle",yt(3,0)),this.generatePolygon("rectangle",yt(4,0)),e.square=e.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle(),this.generatePolygon("diamond",[0,1,1,0,0,-1,-1,0]),this.generatePolygon("pentagon",yt(5,0)),this.generatePolygon("hexagon",yt(6,0)),this.generatePolygon("heptagon",yt(7,0)),this.generatePolygon("octagon",yt(8,0));var a=new Array(20),i=Et(5,0),n=Et(5,Math.PI/5),s=.5*(3-Math.sqrt(5));s*=1.57;for(var o=0;o<n.length/2;o++)n[2*o]*=s,n[2*o+1]*=s;for(o=0;o<5;o++)a[4*o]=i[2*o],a[4*o+1]=i[2*o+1],a[4*o+2]=n[2*o],a[4*o+3]=n[2*o+1];a=Ot(a),this.generatePolygon("star",a),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]),this.generatePolygon("tag",[-1,-1,.25,-1,1,0,.25,1,-1,1]),e.makePolygon=function(e){var a,i="polygon-"+e.join("$");return(a=this[i])?a:t.generatePolygon(i,e)}}},wo={timeToRender:function(){return this.redrawTotalTime/this.redrawCount},redraw:function(e){e=e||be();var t=this;void 0===t.averageRedrawTime&&(t.averageRedrawTime=0),void 0===t.lastRedrawTime&&(t.lastRedrawTime=0),void 0===t.lastDrawTime&&(t.lastDrawTime=0),t.requestedFrame=!0,t.renderOptions=e},beforeRender:function(e,t){if(!this.destroyed){null==t&&le("Priority is not optional for beforeRender");var a=this.beforeRenderCallbacks;a.push({fn:e,priority:t}),a.sort((function(e,t){return t.priority-e.priority}))}}},Mo=function(e,t,a){for(var i=e.beforeRenderCallbacks,n=0;n<i.length;n++)i[n].fn(t,a)};wo.startRenderLoop=function(){var e=this,t=e.cy;e.renderLoopStarted||(e.renderLoopStarted=!0,q((function a(i){if(!e.destroyed){if(t.batching());else if(e.requestedFrame&&!e.skipFrame){Mo(e,!0,i);var n=$();e.render(e.renderOptions);var s=e.lastDrawTime=$();void 0===e.averageRedrawTime&&(e.averageRedrawTime=s-n),void 0===e.redrawCount&&(e.redrawCount=0),e.redrawCount++,void 0===e.redrawTotalTime&&(e.redrawTotalTime=0);var o=s-n;e.redrawTotalTime+=o,e.lastRedrawTime=o,e.averageRedrawTime=e.averageRedrawTime/2+o/2,e.requestedFrame=!1}else Mo(e,!1,i);e.skipFrame=!1,q(a)}})))};var So=function(e){this.init(e)},_o=So.prototype;_o.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"],_o.init=function(e){var t=this;t.options=e,t.cy=e.cy;var a=t.container=e.cy.container();if(u){var i=u.document,n=i.head,s="__________cytoscape_stylesheet",o="__________cytoscape_container",r=null!=i.getElementById(s);if(a.className.indexOf(o)<0&&(a.className=(a.className||"")+" "+o),!r){var l=i.createElement("style");l.id=s,l.innerHTML="."+o+" { position: relative; }",n.insertBefore(l,n.children[0])}"static"===u.getComputedStyle(a).getPropertyValue("position")&&de("A Cytoscape container has style position:static and so can not use UI extensions properly")}t.selection=[void 0,void 0,void 0,void 0,0],t.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],t.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},t.dragData={possibleDragElements:[]},t.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},t.redraws=0,t.showFps=e.showFps,t.debug=e.debug,t.hideEdgesOnViewport=e.hideEdgesOnViewport,t.hideLabelsOnViewport=e.hideLabelsOnViewport,t.textureOnViewport=e.textureOnViewport,t.wheelSensitivity=e.wheelSensitivity,t.motionBlurEnabled=e.motionBlur,t.forcedPixelRatio=O(e.pixelRatio)?e.pixelRatio:null,t.motionBlur=e.motionBlur,t.motionBlurOpacity=e.motionBlurOpacity,t.motionBlurTransparency=1-t.motionBlurOpacity,t.motionBlurPxRatio=1,t.mbPxRBlurry=1,t.minMbLowQualFrames=4,t.fullQualityMb=!1,t.clearedForMotionBlur=[],t.desktopTapThreshold=e.desktopTapThreshold,t.desktopTapThreshold2=e.desktopTapThreshold*e.desktopTapThreshold,t.touchTapThreshold=e.touchTapThreshold,t.touchTapThreshold2=e.touchTapThreshold*e.touchTapThreshold,t.tapholdDuration=500,t.bindings=[],t.beforeRenderCallbacks=[],t.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},t.registerNodeShapes(),t.registerArrowShapes(),t.registerCalculationListeners()},_o.notify=function(e,t){var a=this,i=a.cy;this.destroyed||("init"!==e?"destroy"!==e?(("add"===e||"remove"===e||"move"===e&&i.hasCompoundNodes()||"load"===e||"zorder"===e||"mount"===e)&&a.invalidateCachedZSortedEles(),"viewport"===e&&a.redrawHint("select",!0),"load"!==e&&"resize"!==e&&"mount"!==e||(a.invalidateContainerClientCoordsCache(),a.matchCanvasSize(a.container)),a.redrawHint("eles",!0),a.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()):a.destroy():a.load())},_o.destroy=function(){var e=this;e.destroyed=!0,e.cy.stopAnimationLoop();for(var t=0;t<e.bindings.length;t++){var a=e.bindings[t],i=a.target;(i.off||i.removeEventListener).apply(i,a.args)}if(e.bindings=[],e.beforeRenderCallbacks=[],e.onUpdateEleCalcsFns=[],e.removeObserver&&e.removeObserver.disconnect(),e.styleObserver&&e.styleObserver.disconnect(),e.resizeObserver&&e.resizeObserver.disconnect(),e.labelCalcDiv)try{document.body.removeChild(e.labelCalcDiv)}catch(e){}},_o.isHeadless=function(){return!1},[so,vo,yo,Oo,Eo,wo].forEach((function(e){P(_o,e)}));var To=1e3/60,Co=function(e){return function(){var t=this,a=this.renderer;if(!t.dequeueingSetup){t.dequeueingSetup=!0;var i=n((function(){a.redrawHint("eles",!0),a.redrawHint("drag",!0),a.redraw()}),e.deqRedrawThreshold),s=e.priority||re;a.beforeRender((function(n,s){var o=$(),r=a.averageRedrawTime,l=a.lastRedrawTime,c=[],d=a.cy.extent(),u=a.getPixelRatio();for(n||a.flushRenderedStyleQueue();;){var p=$(),m=p-o,b=p-s;if(l<To){var f=To-(n?r:0);if(b>=e.deqFastCost*f)break}else if(n){if(m>=e.deqCost*l||m>=e.deqAvgCost*r)break}else if(b>=e.deqNoDrawCost*To)break;var h=e.deq(t,u,d);if(!(h.length>0))break;for(var g=0;g<h.length;g++)c.push(h[g])}c.length>0&&(e.onDeqd(t,c),!n&&e.shouldRedraw(t,c,u,d)&&i())}),s(t))}}},ko=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:se;r(this,e),this.idsByKey=new ve,this.keyForId=new ve,this.cachesByLvl=new ve,this.lvls=[],this.getKey=t,this.doesEleInvalidateKey=a}return c(e,[{key:"getIdsFor",value:function(e){null==e&&le("Can not get id list for null key");var t=this.idsByKey,a=this.idsByKey.get(e);return a||(a=new Oe,t.set(e,a)),a}},{key:"addIdForKey",value:function(e,t){null!=e&&this.getIdsFor(e).add(t)}},{key:"deleteIdForKey",value:function(e,t){null!=e&&this.getIdsFor(e).delete(t)}},{key:"getNumberOfIdsForKey",value:function(e){return null==e?0:this.getIdsFor(e).size}},{key:"updateKeyMappingFor",value:function(e){var t=e.id(),a=this.keyForId.get(t),i=this.getKey(e);this.deleteIdForKey(a,t),this.addIdForKey(i,t),this.keyForId.set(t,i)}},{key:"deleteKeyMappingFor",value:function(e){var t=e.id(),a=this.keyForId.get(t);this.deleteIdForKey(a,t),this.keyForId.delete(t)}},{key:"keyHasChangedFor",value:function(e){var t=e.id();return this.keyForId.get(t)!==this.getKey(e)}},{key:"isInvalid",value:function(e){return this.keyHasChangedFor(e)||this.doesEleInvalidateKey(e)}},{key:"getCachesAt",value:function(e){var t=this.cachesByLvl,a=this.lvls,i=t.get(e);return i||(i=new ve,t.set(e,i),a.push(e)),i}},{key:"getCache",value:function(e,t){return this.getCachesAt(t).get(e)}},{key:"get",value:function(e,t){var a=this.getKey(e),i=this.getCache(a,t);return null!=i&&this.updateKeyMappingFor(e),i}},{key:"getForCachedKey",value:function(e,t){var a=this.keyForId.get(e.id());return this.getCache(a,t)}},{key:"hasCache",value:function(e,t){return this.getCachesAt(t).has(e)}},{key:"has",value:function(e,t){var a=this.getKey(e);return this.hasCache(a,t)}},{key:"setCache",value:function(e,t,a){a.key=e,this.getCachesAt(t).set(e,a)}},{key:"set",value:function(e,t,a){var i=this.getKey(e);this.setCache(i,t,a),this.updateKeyMappingFor(e)}},{key:"deleteCache",value:function(e,t){this.getCachesAt(t).delete(e)}},{key:"delete",value:function(e,t){var a=this.getKey(e);this.deleteCache(a,t)}},{key:"invalidateKey",value:function(e){var t=this;this.lvls.forEach((function(a){return t.deleteCache(e,a)}))}},{key:"invalidate",value:function(e){var t=e.id(),a=this.keyForId.get(t);this.deleteKeyMappingFor(e);var i=this.doesEleInvalidateKey(e);return i&&this.invalidateKey(a),i||0===this.getNumberOfIdsForKey(a)}}]),e}(),Fo={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},Io=fe({getKey:null,doesEleInvalidateKey:se,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:ne,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),Do=function(e,t){var a=this;a.renderer=e,a.onDequeues=[];var i=Io(t);P(a,i),a.lookup=new ko(i.getKey,i.doesEleInvalidateKey),a.setupDequeueing()},Ao=Do.prototype;Ao.reasons=Fo,Ao.getTextureQueue=function(e){var t=this;return t.eleImgCaches=t.eleImgCaches||{},t.eleImgCaches[e]=t.eleImgCaches[e]||[]},Ao.getRetiredTextureQueue=function(e){var t=this.eleImgCaches.retired=this.eleImgCaches.retired||{};return t[e]=t[e]||[]},Ao.getElementQueue=function(){return this.eleCacheQueue=this.eleCacheQueue||new s((function(e,t){return t.reqs-e.reqs}))},Ao.getElementKeyToQueue=function(){return this.eleKeyToCacheQueue=this.eleKeyToCacheQueue||{}},Ao.getElement=function(e,t,a,i,n){var s=this,o=this.renderer,r=o.cy.zoom(),l=this.lookup;if(0===t.w||0===t.h||isNaN(t.w)||isNaN(t.h)||!e.visible())return null;if(!s.allowEdgeTxrCaching&&e.isEdge()||!s.allowParentTxrCaching&&e.isParent())return null;if(null==i&&(i=Math.ceil(Ue(r*a))),i<-4)i=-4;else if(r>=7.99||i>3)return null;var c=Math.pow(2,i),d=t.h*c,u=t.w*c,p=o.eleTextBiggerThanMin(e,c);if(!this.isVisible(e,p))return null;var m,b=l.get(e,i);if(b&&b.invalidated&&(b.invalidated=!1,b.texture.invalidatedWidth-=b.width),b)return b;if(m=d<=25?25:d<=50?50:50*Math.ceil(d/50),d>1024||u>1024)return null;var f=s.getTextureQueue(m),h=f[f.length-2],g=function(){return s.recycleTexture(m,u)||s.addTexture(m,u)};h||(h=f[f.length-1]),h||(h=g()),h.width-h.usedWidth<u&&(h=g());for(var j,x=function(e){return e&&e.scaledLabelShown===p},v=n&&n===Fo.dequeue,y=n&&n===Fo.highQuality,O=n&&n===Fo.downscale,E=i+1;E<=3;E++){var w=l.get(e,E);if(w){j=w;break}}var M=j&&j.level===i+1?j:null,S=function(){h.context.drawImage(M.texture.canvas,M.x,0,M.width,M.height,h.usedWidth,0,u,d)};if(h.context.setTransform(1,0,0,1,0,0),h.context.clearRect(h.usedWidth,0,u,m),x(M))S();else if(x(j)){if(!y)return s.queueElement(e,j.level-1),j;for(var _=j.level;_>i;_--)M=s.getElement(e,t,a,_,Fo.downscale);S()}else{var T;if(!v&&!y&&!O)for(var C=i-1;C>=-4;C--){var k=l.get(e,C);if(k){T=k;break}}if(x(T))return s.queueElement(e,i),T;h.context.translate(h.usedWidth,0),h.context.scale(c,c),this.drawElement(h.context,e,t,p,!1),h.context.scale(1/c,1/c),h.context.translate(-h.usedWidth,0)}return b={x:h.usedWidth,texture:h,level:i,scale:c,width:u,height:d,scaledLabelShown:p},h.usedWidth+=Math.ceil(u+8),h.eleCaches.push(b),l.set(e,i,b),s.checkTextureFullness(h),b},Ao.invalidateElements=function(e){for(var t=0;t<e.length;t++)this.invalidateElement(e[t])},Ao.invalidateElement=function(e){var t=this,a=t.lookup,i=[];if(a.isInvalid(e)){for(var n=-4;n<=3;n++){var s=a.getForCachedKey(e,n);s&&i.push(s)}if(a.invalidate(e))for(var o=0;o<i.length;o++){var r=i[o],l=r.texture;l.invalidatedWidth+=r.width,r.invalidated=!0,t.checkTextureUtility(l)}t.removeFromQueue(e)}},Ao.checkTextureUtility=function(e){e.invalidatedWidth>=.2*e.width&&this.retireTexture(e)},Ao.checkTextureFullness=function(e){var t=this.getTextureQueue(e.height);e.usedWidth/e.width>.8&&e.fullnessChecks>=10?he(t,e):e.fullnessChecks++},Ao.retireTexture=function(e){var t=e.height,a=this.getTextureQueue(t),i=this.lookup;he(a,e),e.retired=!0;for(var n=e.eleCaches,s=0;s<n.length;s++){var o=n[s];i.deleteCache(o.key,o.level)}ge(n),this.getRetiredTextureQueue(t).push(e)},Ao.addTexture=function(e,t){var a={};return this.getTextureQueue(e).push(a),a.eleCaches=[],a.height=e,a.width=Math.max(1024,t),a.usedWidth=0,a.invalidatedWidth=0,a.fullnessChecks=0,a.canvas=this.renderer.makeOffscreenCanvas(a.width,a.height),a.context=a.canvas.getContext("2d"),a},Ao.recycleTexture=function(e,t){for(var a=this.getTextureQueue(e),i=this.getRetiredTextureQueue(e),n=0;n<i.length;n++){var s=i[n];if(s.width>=t)return s.retired=!1,s.usedWidth=0,s.invalidatedWidth=0,s.fullnessChecks=0,ge(s.eleCaches),s.context.setTransform(1,0,0,1,0,0),s.context.clearRect(0,0,s.width,s.height),he(i,s),a.push(s),s}},Ao.queueElement=function(e,t){var a=this.getElementQueue(),i=this.getElementKeyToQueue(),n=this.getKey(e),s=i[n];if(s)s.level=Math.max(s.level,t),s.eles.merge(e),s.reqs++,a.updateItem(s);else{var o={eles:e.spawn().merge(e),level:t,reqs:1,key:n};a.push(o),i[n]=o}},Ao.dequeue=function(e){for(var t=this,a=t.getElementQueue(),i=t.getElementKeyToQueue(),n=[],s=t.lookup,o=0;o<1&&a.size()>0;o++){var r=a.pop(),l=r.key,c=r.eles[0],d=s.hasCache(c,r.level);if(i[l]=null,!d){n.push(r);var u=t.getBoundingBox(c);t.getElement(c,u,e,r.level,Fo.dequeue)}}return n},Ao.removeFromQueue=function(e){var t=this.getElementQueue(),a=this.getElementKeyToQueue(),i=this.getKey(e),n=a[i];null!=n&&(1===n.eles.length?(n.reqs=ie,t.updateItem(n),t.pop(),a[i]=null):n.eles.unmerge(e))},Ao.onDequeue=function(e){this.onDequeues.push(e)},Ao.offDequeue=function(e){he(this.onDequeues,e)},Ao.setupDequeueing=Co({deqRedrawThreshold:100,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function(e,t,a){return e.dequeue(t,a)},onDeqd:function(e,t){for(var a=0;a<e.onDequeues.length;a++)(0,e.onDequeues[a])(t)},shouldRedraw:function(e,t,a,i){for(var n=0;n<t.length;n++)for(var s=t[n].eles,o=0;o<s.length;o++){var r=s[o].boundingBox();if(it(r,i))return!0}return!1},priority:function(e){return e.renderer.beforeRenderPriorities.eleTxrDeq}});var Lo=function(e){var t=this,a=t.renderer=e,i=a.cy;t.layersByLevel={},t.firstGet=!0,t.lastInvalidationTime=$()-500,t.skipping=!1,t.eleTxrDeqs=i.collection(),t.scheduleElementRefinement=n((function(){t.refineElementTextures(t.eleTxrDeqs),t.eleTxrDeqs.unmerge(t.eleTxrDeqs)}),50),a.beforeRender((function(e,a){a-t.lastInvalidationTime<=250?t.skipping=!0:t.skipping=!1}),a.beforeRenderPriorities.lyrTxrSkip),t.layersQueue=new s((function(e,t){return t.reqs-e.reqs})),t.setupDequeueing()},Ro=Lo.prototype,No=0,Po=Math.pow(2,53)-1;Ro.makeLayer=function(e,t){var a=Math.pow(2,t),i=Math.ceil(e.w*a),n=Math.ceil(e.h*a),s=this.renderer.makeOffscreenCanvas(i,n),o={id:No=++No%Po,bb:e,level:t,width:i,height:n,canvas:s,context:s.getContext("2d"),eles:[],elesQueue:[],reqs:0},r=o.context,l=-o.bb.x1,c=-o.bb.y1;return r.scale(a,a),r.translate(l,c),o},Ro.getLayers=function(e,t,a){var i=this,n=i.renderer.cy.zoom(),s=i.firstGet;if(i.firstGet=!1,null==a)if((a=Math.ceil(Ue(n*t)))<-4)a=-4;else if(n>=3.99||a>2)return null;i.validateLayersElesOrdering(a,e);var o,r,l=i.layersByLevel,c=Math.pow(2,a),d=l[a]=l[a]||[];if(i.levelIsComplete(a,e))return d;!function(){var t=function(t){if(i.validateLayersElesOrdering(t,e),i.levelIsComplete(t,e))return r=l[t],!0},n=function(e){if(!r)for(var i=a+e;-4<=i&&i<=2&&!t(i);i+=e);};n(1),n(-1);for(var s=d.length-1;s>=0;s--){var o=d[s];o.invalid&&he(d,o)}}();var u=function(t){var n=(t=t||{}).after;if(function(){if(!o){o=Qe();for(var t=0;t<e.length;t++)a=o,i=e[t].boundingBox(),a.x1=Math.min(a.x1,i.x1),a.x2=Math.max(a.x2,i.x2),a.w=a.x2-a.x1,a.y1=Math.min(a.y1,i.y1),a.y2=Math.max(a.y2,i.y2),a.h=a.y2-a.y1}var a,i}(),o.w*c*(o.h*c)>16e6)return null;var s=i.makeLayer(o,a);if(null!=n){var r=d.indexOf(n)+1;d.splice(r,0,s)}else(void 0===t.insert||t.insert)&&d.unshift(s);return s};if(i.skipping&&!s)return null;for(var p=null,m=e.length/1,b=!s,f=0;f<e.length;f++){var h=e[f],g=h._private.rscratch,j=g.imgLayerCaches=g.imgLayerCaches||{},x=j[a];if(x)p=x;else{if((!p||p.eles.length>=m||!st(p.bb,h.boundingBox()))&&!(p=u({insert:!0,after:p})))return null;r||b?i.queueLayer(p,h):i.drawEleInLayer(p,h,a,t),p.eles.push(h),j[a]=p}}return r||(b?null:d)},Ro.getEleLevelForLayerLevel=function(e,t){return e},Ro.drawEleInLayer=function(e,t,a,i){var n=this.renderer,s=e.context,o=t.boundingBox();0!==o.w&&0!==o.h&&t.visible()&&(a=this.getEleLevelForLayerLevel(a,i),n.setImgSmoothing(s,!1),n.drawCachedElement(s,t,null,null,a,!0),n.setImgSmoothing(s,!0))},Ro.levelIsComplete=function(e,t){var a=this.layersByLevel[e];if(!a||0===a.length)return!1;for(var i=0,n=0;n<a.length;n++){var s=a[n];if(s.reqs>0)return!1;if(s.invalid)return!1;i+=s.eles.length}return i===t.length},Ro.validateLayersElesOrdering=function(e,t){var a=this.layersByLevel[e];if(a)for(var i=0;i<a.length;i++){for(var n=a[i],s=-1,o=0;o<t.length;o++)if(n.eles[0]===t[o]){s=o;break}if(s<0)this.invalidateLayer(n);else{var r=s;for(o=0;o<n.eles.length;o++)if(n.eles[o]!==t[r+o]){this.invalidateLayer(n);break}}}},Ro.updateElementsInLayers=function(e,t){for(var a=M(e[0]),i=0;i<e.length;i++)for(var n=a?null:e[i],s=a?e[i]:e[i].ele,o=s._private.rscratch,r=o.imgLayerCaches=o.imgLayerCaches||{},l=-4;l<=2;l++){var c=r[l];c&&(n&&this.getEleLevelForLayerLevel(c.level)!==n.level||t(c,s,n))}},Ro.haveLayers=function(){for(var e=!1,t=-4;t<=2;t++){var a=this.layersByLevel[t];if(a&&a.length>0){e=!0;break}}return e},Ro.invalidateElements=function(e){var t=this;0!==e.length&&(t.lastInvalidationTime=$(),0!==e.length&&t.haveLayers()&&t.updateElementsInLayers(e,(function(e,a,i){t.invalidateLayer(e)})))},Ro.invalidateLayer=function(e){if(this.lastInvalidationTime=$(),!e.invalid){var t=e.level,a=e.eles,i=this.layersByLevel[t];he(i,e),e.elesQueue=[],e.invalid=!0,e.replacement&&(e.replacement.invalid=!0);for(var n=0;n<a.length;n++){var s=a[n]._private.rscratch.imgLayerCaches;s&&(s[t]=null)}}},Ro.refineElementTextures=function(e){var t=this;t.updateElementsInLayers(e,(function(e,a,i){var n=e.replacement;if(n||((n=e.replacement=t.makeLayer(e.bb,e.level)).replaces=e,n.eles=e.eles),!n.reqs)for(var s=0;s<n.eles.length;s++)t.queueLayer(n,n.eles[s])}))},Ro.enqueueElementRefinement=function(e){this.eleTxrDeqs.merge(e),this.scheduleElementRefinement()},Ro.queueLayer=function(e,t){var a=this.layersQueue,i=e.elesQueue,n=i.hasId=i.hasId||{};if(!e.replacement){if(t){if(n[t.id()])return;i.push(t),n[t.id()]=!0}e.reqs?(e.reqs++,a.updateItem(e)):(e.reqs=1,a.push(e))}},Ro.dequeue=function(e){for(var t=this,a=t.layersQueue,i=[],n=0;n<1&&0!==a.size();){var s=a.peek();if(s.replacement)a.pop();else if(s.replaces&&s!==s.replaces.replacement)a.pop();else if(s.invalid)a.pop();else{var o=s.elesQueue.shift();o&&(t.drawEleInLayer(s,o,s.level,e),n++),0===i.length&&i.push(!0),0===s.elesQueue.length&&(a.pop(),s.reqs=0,s.replaces&&t.applyLayerReplacement(s),t.requestRedraw())}}return i},Ro.applyLayerReplacement=function(e){var t=this.layersByLevel[e.level],a=e.replaces,i=t.indexOf(a);if(!(i<0||a.invalid)){t[i]=e;for(var n=0;n<e.eles.length;n++){var s=e.eles[n]._private,o=s.imgLayerCaches=s.imgLayerCaches||{};o&&(o[e.level]=e)}this.requestRedraw()}},Ro.requestRedraw=n((function(){var e=this.renderer;e.redrawHint("eles",!0),e.redrawHint("drag",!0),e.redraw()}),100),Ro.setupDequeueing=Co({deqRedrawThreshold:50,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function(e,t){return e.dequeue(t)},onDeqd:re,shouldRedraw:ne,priority:function(e){return e.renderer.beforeRenderPriorities.lyrTxrDeq}});var zo,Bo={};function Vo(e,t){for(var a=0;a<t.length;a++){var i=t[a];e.lineTo(i.x,i.y)}}function Jo(e,t,a){for(var i,n=0;n<t.length;n++){var s=t[n];0===n&&(i=s),e.lineTo(s.x,s.y)}e.quadraticCurveTo(a.x,a.y,i.x,i.y)}function Uo(e,t,a){e.beginPath&&e.beginPath();for(var i=t,n=0;n<i.length;n++){var s=i[n];e.lineTo(s.x,s.y)}var o=a,r=a[0];for(e.moveTo(r.x,r.y),n=1;n<o.length;n++)s=o[n],e.lineTo(s.x,s.y);e.closePath&&e.closePath()}function Go(e,t,a,i){e.arc(t,a,i,0,2*Math.PI,!1)}Bo.arrowShapeImpl=function(e){return(zo||(zo={polygon:Vo,"triangle-backcurve":Jo,"triangle-tee":Uo,"triangle-cross":Uo,circle:Go}))[e]};var qo={drawElement:function(e,t,a,i,n,s){t.isNode()?this.drawNode(e,t,a,i,n,s):this.drawEdge(e,t,a,i,n,s)},drawElementOverlay:function(e,t){t.isNode()?this.drawNodeOverlay(e,t):this.drawEdgeOverlay(e,t)},drawCachedElementPortion:function(e,t,a,i,n,s,o,r){var l=this,c=a.getBoundingBox(t);if(0!==c.w&&0!==c.h){var d=a.getElement(t,c,i,n,s);if(null!=d){var u=r(l,t);if(0===u)return;var p,m,b,f,h,g,j=o(l,t),x=c.x1,v=c.y1,y=c.w,O=c.h;if(0!==j){var E=a.getRotationPoint(t);b=E.x,f=E.y,e.translate(b,f),e.rotate(j),(h=l.getImgSmoothing(e))||l.setImgSmoothing(e,!0);var w=a.getRotationOffset(t);p=w.x,m=w.y}else p=x,m=v;1!==u&&(g=e.globalAlpha,e.globalAlpha=g*u),e.drawImage(d.texture.canvas,d.x,0,d.width,d.height,p,m,y,O),1!==u&&(e.globalAlpha=g),0!==j&&(e.rotate(-j),e.translate(-b,-f),h||l.setImgSmoothing(e,!1))}else a.drawElement(e,t)}}},$o=function(){return 0},Wo=function(e,t){return e.getTextAngle(t,null)},Ho=function(e,t){return e.getTextAngle(t,"source")},Yo=function(e,t){return e.getTextAngle(t,"target")},Xo=function(e,t){return t.effectiveOpacity()},Qo=function(e,t){return t.pstyle("text-opacity").pfValue*t.effectiveOpacity()};qo.drawCachedElement=function(e,t,a,i,n,s){var o=this,r=o.data,l=r.eleTxrCache,c=r.lblTxrCache,d=r.slbTxrCache,u=r.tlbTxrCache,p=t.boundingBox(),m=!0===s?l.reasons.highQuality:null;0!==p.w&&0!==p.h&&t.visible()&&(i&&!it(p,i)||(o.drawCachedElementPortion(e,t,l,a,n,m,$o,Xo),o.drawCachedElementPortion(e,t,c,a,n,m,Wo,Qo),t.isEdge()&&(o.drawCachedElementPortion(e,t,d,a,n,m,Ho,Qo),o.drawCachedElementPortion(e,t,u,a,n,m,Yo,Qo)),o.drawElementOverlay(e,t)))},qo.drawElements=function(e,t){for(var a=0;a<t.length;a++){var i=t[a];this.drawElement(e,i)}},qo.drawCachedElements=function(e,t,a,i){for(var n=0;n<t.length;n++){var s=t[n];this.drawCachedElement(e,s,a,i)}},qo.drawCachedNodes=function(e,t,a,i){for(var n=0;n<t.length;n++){var s=t[n];s.isNode()&&this.drawCachedElement(e,s,a,i)}},qo.drawLayeredElements=function(e,t,a,i){var n=this.data.lyrTxrCache.getLayers(t,a);if(n)for(var s=0;s<n.length;s++){var o=n[s],r=o.bb;0!==r.w&&0!==r.h&&e.drawImage(o.canvas,r.x1,r.y1,r.w,r.h)}else this.drawCachedElements(e,t,a,i)};var Ko={drawEdge:function(e,t,a){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=this,r=t._private.rscratch;if((!s||t.visible())&&!r.badLine&&null!=r.allpts&&!isNaN(r.allpts[0])){var l;a&&(l=a,e.translate(-l.x1,-l.y1));var c=s?t.pstyle("opacity").value:1,d=t.pstyle("line-style").value,u=t.pstyle("width").pfValue,p=t.pstyle("line-cap").value,m=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;e.lineWidth=u,e.lineCap=p,o.eleStrokeStyle(e,t,a),o.drawEdgePath(t,e,r.allpts,d),e.lineCap="butt"},b=function(){n&&o.drawEdgeOverlay(e,t)},f=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;o.drawArrowheads(e,t,a)},h=function(){o.drawElementText(e,t,null,i)};e.lineJoin="round";var g="yes"===t.pstyle("ghost").value;if(g){var j=t.pstyle("ghost-offset-x").pfValue,x=t.pstyle("ghost-offset-y").pfValue,v=t.pstyle("ghost-opacity").value,y=c*v;e.translate(j,x),m(y),f(y),e.translate(-j,-x)}m(),f(),b(),h(),a&&e.translate(l.x1,l.y1)}},drawEdgeOverlay:function(e,t){if(t.visible()){var a=t.pstyle("overlay-opacity").value;if(0!==a){var i=this,n=i.usePaths(),s=t._private.rscratch,o=2*t.pstyle("overlay-padding").pfValue,r=t.pstyle("overlay-color").value;e.lineWidth=o,"self"!==s.edgeType||n?e.lineCap="round":e.lineCap="butt",i.colorStrokeStyle(e,r[0],r[1],r[2],a),i.drawEdgePath(t,e,s.allpts,"solid")}}},drawEdgePath:function(e,t,a,i){var n,s=e._private.rscratch,o=t,r=!1,l=this.usePaths(),c=e.pstyle("line-dash-pattern").pfValue,d=e.pstyle("line-dash-offset").pfValue;if(l){var u=a.join("$");s.pathCacheKey&&s.pathCacheKey===u?(n=t=s.pathCache,r=!0):(n=t=new Path2D,s.pathCacheKey=u,s.pathCache=n)}if(o.setLineDash)switch(i){case"dotted":o.setLineDash([1,1]);break;case"dashed":o.setLineDash(c),o.lineDashOffset=d;break;case"solid":o.setLineDash([])}if(!r&&!s.badLine)switch(t.beginPath&&t.beginPath(),t.moveTo(a[0],a[1]),s.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var p=2;p+3<a.length;p+=4)t.quadraticCurveTo(a[p],a[p+1],a[p+2],a[p+3]);break;case"straight":case"segments":case"haystack":for(var m=2;m+1<a.length;m+=2)t.lineTo(a[m],a[m+1])}t=o,l?t.stroke(n):t.stroke(),t.setLineDash&&t.setLineDash([])},drawArrowheads:function(e,t,a){var i=t._private.rscratch,n="haystack"===i.edgeType;n||this.drawArrowhead(e,t,"source",i.arrowStartX,i.arrowStartY,i.srcArrowAngle,a),this.drawArrowhead(e,t,"mid-target",i.midX,i.midY,i.midtgtArrowAngle,a),this.drawArrowhead(e,t,"mid-source",i.midX,i.midY,i.midsrcArrowAngle,a),n||this.drawArrowhead(e,t,"target",i.arrowEndX,i.arrowEndY,i.tgtArrowAngle,a)},drawArrowhead:function(e,t,a,i,n,s,o){if(!(isNaN(i)||null==i||isNaN(n)||null==n||isNaN(s)||null==s)){var r=this,l=t.pstyle(a+"-arrow-shape").value;if("none"!==l){var c="hollow"===t.pstyle(a+"-arrow-fill").value?"both":"filled",d=t.pstyle(a+"-arrow-fill").value,u=t.pstyle("width").pfValue,p=t.pstyle("opacity").value;void 0===o&&(o=p);var m=e.globalCompositeOperation;1===o&&"hollow"!==d||(e.globalCompositeOperation="destination-out",r.colorFillStyle(e,255,255,255,1),r.colorStrokeStyle(e,255,255,255,1),r.drawArrowShape(t,e,c,u,l,i,n,s),e.globalCompositeOperation=m);var b=t.pstyle(a+"-arrow-color").value;r.colorFillStyle(e,b[0],b[1],b[2],o),r.colorStrokeStyle(e,b[0],b[1],b[2],o),r.drawArrowShape(t,e,d,u,l,i,n,s)}}},drawArrowShape:function(e,t,a,i,n,s,o,r){var l,c=this,d=this.usePaths()&&"triangle-cross"!==n,u=!1,p=t,m={x:s,y:o},b=e.pstyle("arrow-scale").value,f=this.getArrowWidth(i,b),h=c.arrowShapes[n];if(d){var g=c.arrowPathCache=c.arrowPathCache||[],j=Q(n),x=g[j];null!=x?(l=t=x,u=!0):(l=t=new Path2D,g[j]=l)}t.beginPath&&t.beginPath(),u||(d?h.draw(t,1,0,{x:0,y:0},1):h.draw(t,f,r,m,i)),t.closePath&&t.closePath(),t=p,d&&(t.translate(s,o),t.rotate(r),t.scale(f,f)),"filled"!==a&&"both"!==a||(d?t.fill(l):t.fill()),"hollow"!==a&&"both"!==a||(t.lineWidth=(h.matchEdgeWidth?i:1)/(d?f:1),t.lineJoin="miter",d?t.stroke(l):t.stroke()),d&&(t.scale(1/f,1/f),t.rotate(-r),t.translate(-s,-o))}},Zo={safeDrawImage:function(e,t,a,i,n,s,o,r,l,c){n<=0||s<=0||l<=0||c<=0||e.drawImage(t,a,i,n,s,o,r,l,c)},drawInscribedImage:function(e,t,a,i,n){var s=this,o=a.position(),r=o.x,l=o.y,c=a.cy().style(),d=c.getIndexedStyle.bind(c),u=d(a,"background-fit","value",i),p=d(a,"background-repeat","value",i),m=a.width(),b=a.height(),f=2*a.padding(),h=m+("inner"===d(a,"background-width-relative-to","value",i)?0:f),g=b+("inner"===d(a,"background-height-relative-to","value",i)?0:f),j=a._private.rscratch,x="node"===d(a,"background-clip","value",i),v=d(a,"background-image-opacity","value",i)*n,y=t.width||t.cachedW,O=t.height||t.cachedH;null!=y&&null!=O||(document.body.appendChild(t),y=t.cachedW=t.width||t.offsetWidth,O=t.cachedH=t.height||t.offsetHeight,document.body.removeChild(t));var E=y,w=O;if("auto"!==d(a,"background-width","value",i)&&(E="%"===d(a,"background-width","units",i)?d(a,"background-width","pfValue",i)*h:d(a,"background-width","pfValue",i)),"auto"!==d(a,"background-height","value",i)&&(w="%"===d(a,"background-height","units",i)?d(a,"background-height","pfValue",i)*g:d(a,"background-height","pfValue",i)),0!==E&&0!==w){if("contain"===u)E*=M=Math.min(h/E,g/w),w*=M;else if("cover"===u){var M;E*=M=Math.max(h/E,g/w),w*=M}var S=r-h/2,_=d(a,"background-position-x","units",i),T=d(a,"background-position-x","pfValue",i);S+="%"===_?(h-E)*T:T;var C=d(a,"background-offset-x","units",i),k=d(a,"background-offset-x","pfValue",i);S+="%"===C?(h-E)*k:k;var F=l-g/2,I=d(a,"background-position-y","units",i),D=d(a,"background-position-y","pfValue",i);F+="%"===I?(g-w)*D:D;var A=d(a,"background-offset-y","units",i),L=d(a,"background-offset-y","pfValue",i);F+="%"===A?(g-w)*L:L,j.pathCache&&(S-=r,F-=l,r=0,l=0);var R=e.globalAlpha;if(e.globalAlpha=v,"no-repeat"===p)x&&(e.save(),j.pathCache?e.clip(j.pathCache):(s.nodeShapes[s.getNodeShape(a)].draw(e,r,l,h,g),e.clip())),s.safeDrawImage(e,t,0,0,y,O,S,F,E,w),x&&e.restore();else{var N=e.createPattern(t,p);e.fillStyle=N,s.nodeShapes[s.getNodeShape(a)].draw(e,r,l,h,g),e.translate(S,F),e.fill(),e.translate(-S,-F)}e.globalAlpha=R}}},er={};function tr(e,t,a,i,n){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5;e.beginPath(),e.moveTo(t+s,a),e.lineTo(t+i-s,a),e.quadraticCurveTo(t+i,a,t+i,a+s),e.lineTo(t+i,a+n-s),e.quadraticCurveTo(t+i,a+n,t+i-s,a+n),e.lineTo(t+s,a+n),e.quadraticCurveTo(t,a+n,t,a+n-s),e.lineTo(t,a+s),e.quadraticCurveTo(t,a,t+s,a),e.closePath(),e.fill()}er.eleTextBiggerThanMin=function(e,t){if(!t){var a=e.cy().zoom(),i=this.getPixelRatio(),n=Math.ceil(Ue(a*i));t=Math.pow(2,n)}return!(e.pstyle("font-size").pfValue*t<e.pstyle("min-zoomed-font-size").pfValue)},er.drawElementText=function(e,t,a,i,n){var s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=this;if(null==i){if(s&&!o.eleTextBiggerThanMin(t))return}else if(!1===i)return;if(t.isNode()){var r=t.pstyle("label");if(!r||!r.value)return;var l=o.getLabelJustification(t);e.textAlign=l,e.textBaseline="bottom"}else{var c=t.pstyle("label"),d=t.pstyle("source-label"),u=t.pstyle("target-label");if(!(c&&c.value||d&&d.value||u&&u.value))return;e.textAlign="center",e.textBaseline="bottom"}var p,m=!a;a&&(p=a,e.translate(-p.x1,-p.y1)),null==n?(o.drawText(e,t,null,m,s),t.isEdge()&&(o.drawText(e,t,"source",m,s),o.drawText(e,t,"target",m,s))):o.drawText(e,t,n,m,s),a&&e.translate(p.x1,p.y1)},er.getFontCache=function(e){var t;this.fontCaches=this.fontCaches||[];for(var a=0;a<this.fontCaches.length;a++)if((t=this.fontCaches[a]).context===e)return t;return t={context:e},this.fontCaches.push(t),t},er.setupTextStyle=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t.pstyle("font-style").strValue,n=t.pstyle("font-size").pfValue+"px",s=t.pstyle("font-family").strValue,o=t.pstyle("font-weight").strValue,r=a?t.effectiveOpacity()*t.pstyle("text-opacity").value:1,l=t.pstyle("text-outline-opacity").value*r,c=t.pstyle("color").value,d=t.pstyle("text-outline-color").value;e.font=i+" "+o+" "+n+" "+s,e.lineJoin="round",this.colorFillStyle(e,c[0],c[1],c[2],r),this.colorStrokeStyle(e,d[0],d[1],d[2],l)},er.getTextAngle=function(e,t){var a=e._private.rscratch,i=t?t+"-":"",n=e.pstyle(i+"text-rotation"),s=je(a,"labelAngle",t);return"autorotate"===n.strValue?e.isEdge()?s:0:"none"===n.strValue?0:n.pfValue},er.drawText=function(e,t,a){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=t._private,o=s.rscratch,r=n?t.effectiveOpacity():1;if(!n||0!==r&&0!==t.pstyle("text-opacity").value){"main"===a&&(a=null);var l,c,d=je(o,"labelX",a),u=je(o,"labelY",a),p=this.getLabelText(t,a);if(null!=p&&""!==p&&!isNaN(d)&&!isNaN(u)){this.setupTextStyle(e,t,n);var m,b=a?a+"-":"",f=je(o,"labelWidth",a),h=je(o,"labelHeight",a),g=t.pstyle(b+"text-margin-x").pfValue,j=t.pstyle(b+"text-margin-y").pfValue,x=t.isEdge(),v=t.pstyle("text-halign").value,y=t.pstyle("text-valign").value;switch(x&&(v="center",y="center"),d+=g,u+=j,0!==(m=i?this.getTextAngle(t,a):0)&&(l=d,c=u,e.translate(l,c),e.rotate(m),d=0,u=0),y){case"top":break;case"center":u+=h/2;break;case"bottom":u+=h}var O=t.pstyle("text-background-opacity").value,E=t.pstyle("text-border-opacity").value,w=t.pstyle("text-border-width").pfValue,M=t.pstyle("text-background-padding").pfValue;if(O>0||w>0&&E>0){var S=d-M;switch(v){case"left":S-=f;break;case"center":S-=f/2}var _=u-h-M,T=f+2*M,C=h+2*M;if(O>0){var k=e.fillStyle,F=t.pstyle("text-background-color").value;e.fillStyle="rgba("+F[0]+","+F[1]+","+F[2]+","+O*r+")";var I=t.pstyle("text-background-shape").strValue;"roundrectangle"==I?tr(e,S,_,T,C,2):e.fillRect(S,_,T,C),e.fillStyle=k}if(w>0&&E>0){var D=e.strokeStyle,A=e.lineWidth,L=t.pstyle("text-border-color").value,R=t.pstyle("text-border-style").value;if(e.strokeStyle="rgba("+L[0]+","+L[1]+","+L[2]+","+E*r+")",e.lineWidth=w,e.setLineDash)switch(R){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash([4,2]);break;case"double":e.lineWidth=w/4,e.setLineDash([]);break;case"solid":e.setLineDash([])}if(e.strokeRect(S,_,T,C),"double"===R){var N=w/2;e.strokeRect(S+N,_+N,T-2*N,C-2*N)}e.setLineDash&&e.setLineDash([]),e.lineWidth=A,e.strokeStyle=D}}var P=2*t.pstyle("text-outline-width").pfValue;if(P>0&&(e.lineWidth=P),"wrap"===t.pstyle("text-wrap").value){var z=je(o,"labelWrapCachedLines",a),B=je(o,"labelLineHeight",a),V=f/2,J=this.getLabelJustification(t);switch("auto"===J||("left"===v?"left"===J?d+=-f:"center"===J&&(d+=-V):"center"===v?"left"===J?d+=-V:"right"===J&&(d+=V):"right"===v&&("center"===J?d+=V:"right"===J&&(d+=f))),y){case"top":case"center":case"bottom":u-=(z.length-1)*B}for(var U=0;U<z.length;U++)P>0&&e.strokeText(z[U],d,u),e.fillText(z[U],d,u),u+=B}else P>0&&e.strokeText(p,d,u),e.fillText(p,d,u);0!==m&&(e.rotate(-m),e.translate(-l,-c))}}};for(var ar={drawNode:function(e,t,a){var i,n,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=this,c=t._private,d=c.rscratch,u=t.position();if(O(u.x)&&O(u.y)&&(!r||t.visible())){var p,m,b=r?t.effectiveOpacity():1,f=l.usePaths(),h=!1,g=t.padding();i=t.width()+2*g,n=t.height()+2*g,a&&(m=a,e.translate(-m.x1,-m.y1));for(var j=t.pstyle("background-image"),x=j.value,v=new Array(x.length),y=new Array(x.length),E=0,w=0;w<x.length;w++){var M=x[w],S=v[w]=null!=M&&"none"!==M;if(S){var _=t.cy().style().getIndexedStyle(t,"background-image-crossorigin","value",w);E++,y[w]=l.getCachedImage(M,_,(function(){c.backgroundTimestamp=Date.now(),t.emitAndNotify("background")}))}}var T=t.pstyle("background-blacken").value,C=t.pstyle("border-width").pfValue,k=t.pstyle("background-opacity").value*b,F=t.pstyle("border-color").value,I=t.pstyle("border-style").value,D=t.pstyle("border-opacity").value*b;e.lineJoin="miter";var A=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k;l.eleFillStyle(e,t,a)},L=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;l.colorStrokeStyle(e,F[0],F[1],F[2],t)},R=t.pstyle("shape").strValue,N=t.pstyle("shape-polygon-points").pfValue;if(f){e.translate(u.x,u.y);var P=l.nodePathCache=l.nodePathCache||[],z=K("polygon"===R?R+","+N.join(","):R,""+n,""+i),B=P[z];null!=B?(p=B,h=!0,d.pathCache=p):(p=new Path2D,P[z]=d.pathCache=p)}var V=function(){if(!h){var a=u;f&&(a={x:0,y:0}),l.nodeShapes[l.getNodeShape(t)].draw(p||e,a.x,a.y,i,n)}f?e.fill(p):e.fill()},J=function(){for(var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,i=c.backgrounding,n=0,s=0;s<y.length;s++)v[s]&&y[s].complete&&!y[s].error&&(n++,l.drawInscribedImage(e,y[s],t,s,a));c.backgrounding=!(n===E),i!==c.backgrounding&&t.updateStyle(!1)},U=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;l.hasPie(t)&&(l.drawPie(e,t,s),a&&(f||l.nodeShapes[l.getNodeShape(t)].draw(e,u.x,u.y,i,n)))},G=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,a=(T>0?T:-T)*t,i=T>0?0:255;0!==T&&(l.colorFillStyle(e,i,i,i,a),f?e.fill(p):e.fill())},q=function(){if(C>0){if(e.lineWidth=C,e.lineCap="butt",e.setLineDash)switch(I){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash([4,2]);break;case"solid":case"double":e.setLineDash([])}if(f?e.stroke(p):e.stroke(),"double"===I){e.lineWidth=C/3;var t=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",f?e.stroke(p):e.stroke(),e.globalCompositeOperation=t}e.setLineDash&&e.setLineDash([])}},$=function(){o&&l.drawNodeOverlay(e,t,u,i,n)},W=function(){l.drawElementText(e,t,null,s)},H="yes"===t.pstyle("ghost").value;if(H){var Y=t.pstyle("ghost-offset-x").pfValue,X=t.pstyle("ghost-offset-y").pfValue,Q=t.pstyle("ghost-opacity").value,Z=Q*b;e.translate(Y,X),A(Q*k),V(),J(Z),U(0!==T||0!==C),G(Z),L(Q*D),q(),e.translate(-Y,-X)}A(),V(),J(),U(0!==T||0!==C),G(),L(),q(),f&&e.translate(-u.x,-u.y),W(),$(),a&&e.translate(m.x1,m.y1)}},drawNodeOverlay:function(e,t,a,i,n){if(t.visible()){var s=t.pstyle("overlay-padding").pfValue,o=t.pstyle("overlay-opacity").value,r=t.pstyle("overlay-color").value;if(o>0){if(a=a||t.position(),null==i||null==n){var l=t.padding();i=t.width()+2*l,n=t.height()+2*l}this.colorFillStyle(e,r[0],r[1],r[2],o),this.nodeShapes.roundrectangle.draw(e,a.x,a.y,i+2*s,n+2*s),e.fill()}}},hasPie:function(e){return(e=e[0])._private.hasPie},drawPie:function(e,t,a,i){t=t[0],i=i||t.position();var n=t.cy().style(),s=t.pstyle("pie-size"),o=i.x,r=i.y,l=t.width(),c=t.height(),d=Math.min(l,c)/2,u=0;this.usePaths()&&(o=0,r=0),"%"===s.units?d*=s.pfValue:void 0!==s.pfValue&&(d=s.pfValue/2);for(var p=1;p<=n.pieBackgroundN;p++){var m=t.pstyle("pie-"+p+"-background-size").value,b=t.pstyle("pie-"+p+"-background-color").value,f=t.pstyle("pie-"+p+"-background-opacity").value*a,h=m/100;h+u>1&&(h=1-u);var g=1.5*Math.PI+2*Math.PI*u,j=g+2*Math.PI*h;0===m||u>=1||u+h>1||(e.beginPath(),e.moveTo(o,r),e.arc(o,r,d,g,j),e.closePath(),this.colorFillStyle(e,b[0],b[1],b[2],f),e.fill(),u+=h)}}},ir={getPixelRatio:function(){var e=this.data.contexts[0];if(null!=this.forcedPixelRatio)return this.forcedPixelRatio;var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},paintCache:function(e){for(var t,a=this.paintCaches=this.paintCaches||[],i=!0,n=0;n<a.length;n++)if((t=a[n]).context===e){i=!1;break}return i&&(t={context:e},a.push(t)),t},createGradientStyleFor:function(e,t,a,i,n){var s,o=this.usePaths(),r=a.pstyle(t+"-gradient-stop-colors").value,l=a.pstyle(t+"-gradient-stop-positions").pfValue;if("radial-gradient"===i)if(a.isEdge()){var c=a.sourceEndpoint(),d=a.targetEndpoint(),u=a.midpoint(),p=qe(c,u),m=qe(d,u);s=e.createRadialGradient(u.x,u.y,0,u.x,u.y,Math.max(p,m))}else{var b=o?{x:0,y:0}:a.position(),f=a.paddedWidth(),h=a.paddedHeight();s=e.createRadialGradient(b.x,b.y,0,b.x,b.y,Math.max(f,h))}else if(a.isEdge()){var g=a.sourceEndpoint(),j=a.targetEndpoint();s=e.createLinearGradient(g.x,g.y,j.x,j.y)}else{var x=o?{x:0,y:0}:a.position(),v=a.paddedWidth()/2,y=a.paddedHeight()/2;switch(a.pstyle("background-gradient-direction").value){case"to-bottom":s=e.createLinearGradient(x.x,x.y-y,x.x,x.y+y);break;case"to-top":s=e.createLinearGradient(x.x,x.y+y,x.x,x.y-y);break;case"to-left":s=e.createLinearGradient(x.x+v,x.y,x.x-v,x.y);break;case"to-right":s=e.createLinearGradient(x.x-v,x.y,x.x+v,x.y);break;case"to-bottom-right":case"to-right-bottom":s=e.createLinearGradient(x.x-v,x.y-y,x.x+v,x.y+y);break;case"to-top-right":case"to-right-top":s=e.createLinearGradient(x.x-v,x.y+y,x.x+v,x.y-y);break;case"to-bottom-left":case"to-left-bottom":s=e.createLinearGradient(x.x+v,x.y-y,x.x-v,x.y+y);break;case"to-top-left":case"to-left-top":s=e.createLinearGradient(x.x+v,x.y+y,x.x-v,x.y-y)}}if(!s)return null;for(var O=l.length===r.length,E=r.length,w=0;w<E;w++)s.addColorStop(O?l[w]:w/(E-1),"rgba("+r[w][0]+","+r[w][1]+","+r[w][2]+","+n+")");return s},gradientFillStyle:function(e,t,a,i){var n=this.createGradientStyleFor(e,"background",t,a,i);if(!n)return null;e.fillStyle=n},colorFillStyle:function(e,t,a,i,n){e.fillStyle="rgba("+t+","+a+","+i+","+n+")"},eleFillStyle:function(e,t,a){var i=t.pstyle("background-fill").value;if("linear-gradient"===i||"radial-gradient"===i)this.gradientFillStyle(e,t,i,a);else{var n=t.pstyle("background-color").value;this.colorFillStyle(e,n[0],n[1],n[2],a)}},gradientStrokeStyle:function(e,t,a,i){var n=this.createGradientStyleFor(e,"line",t,a,i);if(!n)return null;e.strokeStyle=n},colorStrokeStyle:function(e,t,a,i,n){e.strokeStyle="rgba("+t+","+a+","+i+","+n+")"},eleStrokeStyle:function(e,t,a){var i=t.pstyle("line-fill").value;if("linear-gradient"===i||"radial-gradient"===i)this.gradientStrokeStyle(e,t,i,a);else{var n=t.pstyle("line-color").value;this.colorStrokeStyle(e,n[0],n[1],n[2],a)}},matchCanvasSize:function(e){var t=this,a=t.data,i=t.findContainerClientCoords(),n=i[2],s=i[3],o=t.getPixelRatio(),r=t.motionBlurPxRatio;e!==t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_NODE]&&e!==t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_DRAG]||(o=r);var l,c=n*o,d=s*o;if(c!==t.canvasWidth||d!==t.canvasHeight){t.fontCaches=null;var u=a.canvasContainer;u.style.width=n+"px",u.style.height=s+"px";for(var p=0;p<t.CANVAS_LAYERS;p++)(l=a.canvases[p]).width=c,l.height=d,l.style.width=n+"px",l.style.height=s+"px";for(p=0;p<t.BUFFER_COUNT;p++)(l=a.bufferCanvases[p]).width=c,l.height=d,l.style.width=n+"px",l.style.height=s+"px";t.textureMult=1,o<=1&&(l=a.bufferCanvases[t.TEXTURE_BUFFER],t.textureMult=2,l.width=c*t.textureMult,l.height=d*t.textureMult),t.canvasWidth=c,t.canvasHeight=d}},renderTo:function(e,t,a,i){this.render({forcedContext:e,forcedZoom:t,forcedPan:a,drawAllLayers:!0,forcedPxRatio:i})},render:function(e){var t=(e=e||be()).forcedContext,a=e.drawAllLayers,i=e.drawOnlyNodeLayer,n=e.forcedZoom,s=e.forcedPan,o=this,r=void 0===e.forcedPxRatio?this.getPixelRatio():e.forcedPxRatio,l=o.cy,c=o.data,d=c.canvasNeedsRedraw,u=o.textureOnViewport&&!t&&(o.pinching||o.hoverData.dragging||o.swipePanning||o.data.wheelZooming),p=void 0!==e.motionBlur?e.motionBlur:o.motionBlur,m=o.motionBlurPxRatio,b=l.hasCompoundNodes(),f=o.hoverData.draggingEles,h=!(!o.hoverData.selecting&&!o.touchData.selecting),g=p=p&&!t&&o.motionBlurEnabled&&!h;t||(o.prevPxRatio!==r&&(o.invalidateContainerClientCoordsCache(),o.matchCanvasSize(o.container),o.redrawHint("eles",!0),o.redrawHint("drag",!0)),o.prevPxRatio=r),!t&&o.motionBlurTimeout&&clearTimeout(o.motionBlurTimeout),p&&(null==o.mbFrames&&(o.mbFrames=0),o.mbFrames++,o.mbFrames<3&&(g=!1),o.mbFrames>o.minMbLowQualFrames&&(o.motionBlurPxRatio=o.mbPxRBlurry)),o.clearingMotionBlur&&(o.motionBlurPxRatio=1),o.textureDrawLastFrame&&!u&&(d[o.NODE]=!0,d[o.SELECT_BOX]=!0);var j=l.style(),x=l.zoom(),v=void 0!==n?n:x,y=l.pan(),O={x:y.x,y:y.y},E={zoom:x,pan:{x:y.x,y:y.y}},w=o.prevViewport;void 0===w||E.zoom!==w.zoom||E.pan.x!==w.pan.x||E.pan.y!==w.pan.y||f&&!b||(o.motionBlurPxRatio=1),s&&(O=s),v*=r,O.x*=r,O.y*=r;var M=o.getCachedZSortedEles();function S(e,t,a,i,n){var s=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",o.colorFillStyle(e,255,255,255,o.motionBlurTransparency),e.fillRect(t,a,i,n),e.globalCompositeOperation=s}function _(e,i){var r,l,d,u;o.clearingMotionBlur||e!==c.bufferContexts[o.MOTIONBLUR_BUFFER_NODE]&&e!==c.bufferContexts[o.MOTIONBLUR_BUFFER_DRAG]?(r=O,l=v,d=o.canvasWidth,u=o.canvasHeight):(r={x:y.x*m,y:y.y*m},l=x*m,d=o.canvasWidth*m,u=o.canvasHeight*m),e.setTransform(1,0,0,1,0,0),"motionBlur"===i?S(e,0,0,d,u):t||void 0!==i&&!i||e.clearRect(0,0,d,u),a||(e.translate(r.x,r.y),e.scale(l,l)),s&&e.translate(s.x,s.y),n&&e.scale(n,n)}if(u||(o.textureDrawLastFrame=!1),u){if(o.textureDrawLastFrame=!0,!o.textureCache){o.textureCache={},o.textureCache.bb=l.mutableElements().boundingBox(),o.textureCache.texture=o.data.bufferCanvases[o.TEXTURE_BUFFER];var T=o.data.bufferContexts[o.TEXTURE_BUFFER];T.setTransform(1,0,0,1,0,0),T.clearRect(0,0,o.canvasWidth*o.textureMult,o.canvasHeight*o.textureMult),o.render({forcedContext:T,drawOnlyNodeLayer:!0,forcedPxRatio:r*o.textureMult}),(E=o.textureCache.viewport={zoom:l.zoom(),pan:l.pan(),width:o.canvasWidth,height:o.canvasHeight}).mpan={x:(0-E.pan.x)/E.zoom,y:(0-E.pan.y)/E.zoom}}d[o.DRAG]=!1,d[o.NODE]=!1;var C=c.contexts[o.NODE],k=o.textureCache.texture;E=o.textureCache.viewport,C.setTransform(1,0,0,1,0,0),p?S(C,0,0,E.width,E.height):C.clearRect(0,0,E.width,E.height);var F=j.core("outside-texture-bg-color").value,I=j.core("outside-texture-bg-opacity").value;o.colorFillStyle(C,F[0],F[1],F[2],I),C.fillRect(0,0,E.width,E.height),x=l.zoom(),_(C,!1),C.clearRect(E.mpan.x,E.mpan.y,E.width/E.zoom/r,E.height/E.zoom/r),C.drawImage(k,E.mpan.x,E.mpan.y,E.width/E.zoom/r,E.height/E.zoom/r)}else o.textureOnViewport&&!t&&(o.textureCache=null);var D=l.extent(),A=o.pinching||o.hoverData.dragging||o.swipePanning||o.data.wheelZooming||o.hoverData.draggingEles||o.cy.animated(),L=o.hideEdgesOnViewport&&A,R=[];if(R[o.NODE]=!d[o.NODE]&&p&&!o.clearedForMotionBlur[o.NODE]||o.clearingMotionBlur,R[o.NODE]&&(o.clearedForMotionBlur[o.NODE]=!0),R[o.DRAG]=!d[o.DRAG]&&p&&!o.clearedForMotionBlur[o.DRAG]||o.clearingMotionBlur,R[o.DRAG]&&(o.clearedForMotionBlur[o.DRAG]=!0),d[o.NODE]||a||i||R[o.NODE]){var N=p&&!R[o.NODE]&&1!==m;_(C=t||(N?o.data.bufferContexts[o.MOTIONBLUR_BUFFER_NODE]:c.contexts[o.NODE]),p&&!N?"motionBlur":void 0),L?o.drawCachedNodes(C,M.nondrag,r,D):o.drawLayeredElements(C,M.nondrag,r,D),o.debug&&o.drawDebugPoints(C,M.nondrag),a||p||(d[o.NODE]=!1)}if(!i&&(d[o.DRAG]||a||R[o.DRAG])&&(N=p&&!R[o.DRAG]&&1!==m,_(C=t||(N?o.data.bufferContexts[o.MOTIONBLUR_BUFFER_DRAG]:c.contexts[o.DRAG]),p&&!N?"motionBlur":void 0),L?o.drawCachedNodes(C,M.drag,r,D):o.drawCachedElements(C,M.drag,r,D),o.debug&&o.drawDebugPoints(C,M.drag),a||p||(d[o.DRAG]=!1)),o.showFps||!i&&d[o.SELECT_BOX]&&!a){if(_(C=t||c.contexts[o.SELECT_BOX]),1==o.selection[4]&&(o.hoverData.selecting||o.touchData.selecting)){x=o.cy.zoom();var P=j.core("selection-box-border-width").value/x;C.lineWidth=P,C.fillStyle="rgba("+j.core("selection-box-color").value[0]+","+j.core("selection-box-color").value[1]+","+j.core("selection-box-color").value[2]+","+j.core("selection-box-opacity").value+")",C.fillRect(o.selection[0],o.selection[1],o.selection[2]-o.selection[0],o.selection[3]-o.selection[1]),P>0&&(C.strokeStyle="rgba("+j.core("selection-box-border-color").value[0]+","+j.core("selection-box-border-color").value[1]+","+j.core("selection-box-border-color").value[2]+","+j.core("selection-box-opacity").value+")",C.strokeRect(o.selection[0],o.selection[1],o.selection[2]-o.selection[0],o.selection[3]-o.selection[1]))}if(c.bgActivePosistion&&!o.hoverData.selecting){x=o.cy.zoom();var z=c.bgActivePosistion;C.fillStyle="rgba("+j.core("active-bg-color").value[0]+","+j.core("active-bg-color").value[1]+","+j.core("active-bg-color").value[2]+","+j.core("active-bg-opacity").value+")",C.beginPath(),C.arc(z.x,z.y,j.core("active-bg-size").pfValue/x,0,2*Math.PI),C.fill()}var B=o.lastRedrawTime;if(o.showFps&&B){B=Math.round(B);var V=Math.round(1e3/B);C.setTransform(1,0,0,1,0,0),C.fillStyle="rgba(255, 0, 0, 0.75)",C.strokeStyle="rgba(255, 0, 0, 0.75)",C.lineWidth=1,C.fillText("1 frame = "+B+" ms = "+V+" fps",0,20),C.strokeRect(0,30,250,20),C.fillRect(0,30,250*Math.min(V/60,1),20)}a||(d[o.SELECT_BOX]=!1)}if(p&&1!==m){var J=c.contexts[o.NODE],U=o.data.bufferCanvases[o.MOTIONBLUR_BUFFER_NODE],G=c.contexts[o.DRAG],q=o.data.bufferCanvases[o.MOTIONBLUR_BUFFER_DRAG],$=function(e,t,a){e.setTransform(1,0,0,1,0,0),a||!g?e.clearRect(0,0,o.canvasWidth,o.canvasHeight):S(e,0,0,o.canvasWidth,o.canvasHeight);var i=m;e.drawImage(t,0,0,o.canvasWidth*i,o.canvasHeight*i,0,0,o.canvasWidth,o.canvasHeight)};(d[o.NODE]||R[o.NODE])&&($(J,U,R[o.NODE]),d[o.NODE]=!1),(d[o.DRAG]||R[o.DRAG])&&($(G,q,R[o.DRAG]),d[o.DRAG]=!1)}o.prevViewport=E,o.clearingMotionBlur&&(o.clearingMotionBlur=!1,o.motionBlurCleared=!0,o.motionBlur=!0),p&&(o.motionBlurTimeout=setTimeout((function(){o.motionBlurTimeout=null,o.clearedForMotionBlur[o.NODE]=!1,o.clearedForMotionBlur[o.DRAG]=!1,o.motionBlur=!1,o.clearingMotionBlur=!u,o.mbFrames=0,d[o.NODE]=!0,d[o.DRAG]=!0,o.redraw()}),100)),t||l.emit("render")}},nr={drawPolygonPath:function(e,t,a,i,n,s){var o=i/2,r=n/2;e.beginPath&&e.beginPath(),e.moveTo(t+o*s[0],a+r*s[1]);for(var l=1;l<s.length/2;l++)e.lineTo(t+o*s[2*l],a+r*s[2*l+1]);e.closePath()},drawRoundRectanglePath:function(e,t,a,i,n){var s=i/2,o=n/2,r=wt(i,n);e.beginPath&&e.beginPath(),e.moveTo(t,a-o),e.arcTo(t+s,a-o,t+s,a,r),e.arcTo(t+s,a+o,t,a+o,r),e.arcTo(t-s,a+o,t-s,a,r),e.arcTo(t-s,a-o,t,a-o,r),e.lineTo(t,a-o),e.closePath()},drawBottomRoundRectanglePath:function(e,t,a,i,n){var s=i/2,o=n/2,r=wt(i,n);e.beginPath&&e.beginPath(),e.moveTo(t,a-o),e.lineTo(t+s,a-o),e.lineTo(t+s,a),e.arcTo(t+s,a+o,t,a+o,r),e.arcTo(t-s,a+o,t-s,a,r),e.lineTo(t-s,a-o),e.lineTo(t,a-o),e.closePath()},drawCutRectanglePath:function(e,t,a,i,n){var s=i/2,o=n/2;e.beginPath&&e.beginPath(),e.moveTo(t-s+8,a-o),e.lineTo(t+s-8,a-o),e.lineTo(t+s,a-o+8),e.lineTo(t+s,a+o-8),e.lineTo(t+s-8,a+o),e.lineTo(t-s+8,a+o),e.lineTo(t-s,a+o-8),e.lineTo(t-s,a-o+8),e.closePath()},drawBarrelPath:function(e,t,a,i,n){var s=i/2,o=n/2,r=t-s,l=t+s,c=a-o,d=a+o,u=Mt(i,n),p=u.widthOffset,m=u.heightOffset,b=u.ctrlPtOffsetPct*p;e.beginPath&&e.beginPath(),e.moveTo(r,c+m),e.lineTo(r,d-m),e.quadraticCurveTo(r+b,d,r+p,d),e.lineTo(l-p,d),e.quadraticCurveTo(l-b,d,l,d-m),e.lineTo(l,c+m),e.quadraticCurveTo(l-b,c,l-p,c),e.lineTo(r+p,c),e.quadraticCurveTo(r+b,c,r,c+m),e.closePath()}},sr=Math.sin(0),or=Math.cos(0),rr={},lr={},cr=Math.PI/40,dr=0*Math.PI;dr<2*Math.PI;dr+=cr)rr[dr]=Math.sin(dr),lr[dr]=Math.cos(dr);nr.drawEllipsePath=function(e,t,a,i,n){if(e.beginPath&&e.beginPath(),e.ellipse)e.ellipse(t,a,i/2,n/2,0,0,2*Math.PI);else for(var s,o,r=i/2,l=n/2,c=0*Math.PI;c<2*Math.PI;c+=cr)s=t-r*rr[c]*sr+r*lr[c]*or,o=a+l*lr[c]*sr+l*rr[c]*or,0===c?e.moveTo(s,o):e.lineTo(s,o);e.closePath()};var ur={};function pr(e){var t=e.indexOf(",");return e.substr(t+1)}function mr(e,t,a){var i=function(){return t.toDataURL(a,e.quality)};switch(e.output){case"blob-promise":return new Ia((function(i,n){try{t.toBlob((function(e){null!=e?i(e):n(new Error("`canvas.toBlob()` sent a null value in its callback"))}),a,e.quality)}catch(e){n(e)}}));case"blob":return function(e,t){for(var a=atob(e),i=new ArrayBuffer(a.length),n=new Uint8Array(i),s=0;s<a.length;s++)n[s]=a.charCodeAt(s);return new Blob([i],{type:t})}(pr(i()),a);case"base64":return pr(i());default:return i()}}ur.createBuffer=function(e,t){var a=document.createElement("canvas");return a.width=e,a.height=t,[a,a.getContext("2d")]},ur.bufferCanvasImage=function(e){var t=this.cy,a=t.mutableElements().boundingBox(),i=this.findContainerClientCoords(),n=e.full?Math.ceil(a.w):i[2],s=e.full?Math.ceil(a.h):i[3],o=O(e.maxWidth)||O(e.maxHeight),r=this.getPixelRatio(),l=1;if(void 0!==e.scale)n*=e.scale,s*=e.scale,l=e.scale;else if(o){var c=1/0,d=1/0;O(e.maxWidth)&&(c=l*e.maxWidth/n),O(e.maxHeight)&&(d=l*e.maxHeight/s),n*=l=Math.min(c,d),s*=l}o||(n*=r,s*=r,l*=r);var u=document.createElement("canvas");u.width=n,u.height=s,u.style.width=n+"px",u.style.height=s+"px";var p=u.getContext("2d");if(n>0&&s>0){p.clearRect(0,0,n,s),p.globalCompositeOperation="source-over";var m=this.getCachedZSortedEles();if(e.full)p.translate(-a.x1*l,-a.y1*l),p.scale(l,l),this.drawElements(p,m),p.scale(1/l,1/l),p.translate(a.x1*l,a.y1*l);else{var b=t.pan(),f={x:b.x*l,y:b.y*l};l*=t.zoom(),p.translate(f.x,f.y),p.scale(l,l),this.drawElements(p,m),p.scale(1/l,1/l),p.translate(-f.x,-f.y)}e.bg&&(p.globalCompositeOperation="destination-over",p.fillStyle=e.bg,p.rect(0,0,n,s),p.fill())}return u},ur.png=function(e){return mr(e,this.bufferCanvasImage(e),"image/png")},ur.jpg=function(e){return mr(e,this.bufferCanvasImage(e),"image/jpeg")};var br=hr,fr=hr.prototype;function hr(e){var t=this;t.data={canvases:new Array(fr.CANVAS_LAYERS),contexts:new Array(fr.CANVAS_LAYERS),canvasNeedsRedraw:new Array(fr.CANVAS_LAYERS),bufferCanvases:new Array(fr.BUFFER_COUNT),bufferContexts:new Array(fr.CANVAS_LAYERS)};var a="-webkit-tap-highlight-color",i="rgba(0,0,0,0)";t.data.canvasContainer=document.createElement("div");var n=t.data.canvasContainer.style;t.data.canvasContainer.style[a]=i,n.position="relative",n.zIndex="0",n.overflow="hidden";var s=e.cy.container();s.appendChild(t.data.canvasContainer),s.style[a]=i;var o={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};p&&p.userAgent.match(/msie|trident|edge/i)&&(o["-ms-touch-action"]="none",o["touch-action"]="none");for(var r=0;r<fr.CANVAS_LAYERS;r++){var l=t.data.canvases[r]=document.createElement("canvas");t.data.contexts[r]=l.getContext("2d"),Object.keys(o).forEach((function(e){l.style[e]=o[e]})),l.style.position="absolute",l.setAttribute("data-id","layer"+r),l.style.zIndex=String(fr.CANVAS_LAYERS-r),t.data.canvasContainer.appendChild(l),t.data.canvasNeedsRedraw[r]=!1}for(t.data.topCanvas=t.data.canvases[0],t.data.canvases[fr.NODE].setAttribute("data-id","layer"+fr.NODE+"-node"),t.data.canvases[fr.SELECT_BOX].setAttribute("data-id","layer"+fr.SELECT_BOX+"-selectbox"),t.data.canvases[fr.DRAG].setAttribute("data-id","layer"+fr.DRAG+"-drag"),r=0;r<fr.BUFFER_COUNT;r++)t.data.bufferCanvases[r]=document.createElement("canvas"),t.data.bufferContexts[r]=t.data.bufferCanvases[r].getContext("2d"),t.data.bufferCanvases[r].style.position="absolute",t.data.bufferCanvases[r].setAttribute("data-id","buffer"+r),t.data.bufferCanvases[r].style.zIndex=String(-r-1),t.data.bufferCanvases[r].style.visibility="hidden";t.pathsEnabled=!0;var c=Qe(),d=function(e){return{x:-e.w/2,y:-e.h/2}},u=function(e){return e.boundingBox(),e[0]._private.bodyBounds},m=function(e){return e.boundingBox(),e[0]._private.labelBounds.main||c},b=function(e){return e.boundingBox(),e[0]._private.labelBounds.source||c},f=function(e){return e.boundingBox(),e[0]._private.labelBounds.target||c},h=function(e,t){return t},g=function(e,t){return{x:e.x+t.pstyle("text-margin-x").pfValue,y:e.y+t.pstyle("text-margin-y").pfValue}},j=function(e,t,a){var i=e[0]._private.rscratch;return{x:i[t],y:i[a]}},x=t.data.eleTxrCache=new Do(t,{getKey:function(e){return e[0]._private.nodeKey},doesEleInvalidateKey:function(e){var t=e[0]._private;return!(t.oldBackgroundTimestamp===t.backgroundTimestamp)},drawElement:function(e,a,i,n,s){return t.drawElement(e,a,i,!1,!1,s)},getBoundingBox:u,getRotationPoint:function(e){return{x:((t=u(e)).x1+t.x2)/2,y:(t.y1+t.y2)/2};var t},getRotationOffset:function(e){return d(u(e))},allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),v=t.data.lblTxrCache=new Do(t,{getKey:function(e){return e[0]._private.labelStyleKey},drawElement:function(e,a,i,n,s){return t.drawElementText(e,a,i,n,"main",s)},getBoundingBox:m,getRotationPoint:function(e){return g(j(e,"labelX","labelY"),e)},getRotationOffset:function(e){var t=m(e),a=d(m(e));if(e.isNode()){switch(e.pstyle("text-halign").value){case"left":a.x=-t.w;break;case"right":a.x=0}switch(e.pstyle("text-valign").value){case"top":a.y=-t.h;break;case"bottom":a.y=0}}return a},isVisible:h}),y=t.data.slbTxrCache=new Do(t,{getKey:function(e){return e[0]._private.sourceLabelStyleKey},drawElement:function(e,a,i,n,s){return t.drawElementText(e,a,i,n,"source",s)},getBoundingBox:b,getRotationPoint:function(e){return g(j(e,"sourceLabelX","sourceLabelY"),e)},getRotationOffset:function(e){return d(b(e))},isVisible:h}),O=t.data.tlbTxrCache=new Do(t,{getKey:function(e){return e[0]._private.targetLabelStyleKey},drawElement:function(e,a,i,n,s){return t.drawElementText(e,a,i,n,"target",s)},getBoundingBox:f,getRotationPoint:function(e){return g(j(e,"targetLabelX","targetLabelY"),e)},getRotationOffset:function(e){return d(f(e))},isVisible:h}),E=t.data.lyrTxrCache=new Lo(t);t.onUpdateEleCalcs((function(e,t){x.invalidateElements(t),v.invalidateElements(t),y.invalidateElements(t),O.invalidateElements(t),E.invalidateElements(t);for(var a=0;a<t.length;a++){var i=t[a]._private;i.oldBackgroundTimestamp=i.backgroundTimestamp}}));var w=function(e){for(var t=0;t<e.length;t++)E.enqueueElementRefinement(e[t].ele)};x.onDequeue(w),v.onDequeue(w),y.onDequeue(w),O.onDequeue(w)}fr.CANVAS_LAYERS=3,fr.SELECT_BOX=0,fr.DRAG=1,fr.NODE=2,fr.BUFFER_COUNT=3,fr.TEXTURE_BUFFER=0,fr.MOTIONBLUR_BUFFER_NODE=1,fr.MOTIONBLUR_BUFFER_DRAG=2,fr.redrawHint=function(e,t){var a=this;switch(e){case"eles":a.data.canvasNeedsRedraw[fr.NODE]=t;break;case"drag":a.data.canvasNeedsRedraw[fr.DRAG]=t;break;case"select":a.data.canvasNeedsRedraw[fr.SELECT_BOX]=t}};var gr="undefined"!=typeof Path2D;fr.path2dEnabled=function(e){if(void 0===e)return this.pathsEnabled;this.pathsEnabled=!!e},fr.usePaths=function(){return gr&&this.pathsEnabled},fr.setImgSmoothing=function(e,t){null!=e.imageSmoothingEnabled?e.imageSmoothingEnabled=t:(e.webkitImageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t,e.msImageSmoothingEnabled=t)},fr.getImgSmoothing=function(e){return null!=e.imageSmoothingEnabled?e.imageSmoothingEnabled:e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled},fr.makeOffscreenCanvas=function(e,t){var a;return"undefined"!==("undefined"==typeof OffscreenCanvas?"undefined":o(OffscreenCanvas))?a=new OffscreenCanvas(e,t):((a=document.createElement("canvas")).width=e,a.height=t),a},[Bo,qo,Ko,Zo,er,ar,ir,nr,ur,{nodeShapeImpl:function(e,t,a,i,n,s,o){switch(e){case"ellipse":return this.drawEllipsePath(t,a,i,n,s);case"polygon":return this.drawPolygonPath(t,a,i,n,s,o);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(t,a,i,n,s);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(t,a,i,n,s);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(t,a,i,n,s);case"barrel":return this.drawBarrelPath(t,a,i,n,s)}}}].forEach((function(e){P(fr,e)}));var jr=[{type:"layout",extensions:ao},{type:"renderer",extensions:[{name:"null",impl:io},{name:"base",impl:So},{name:"canvas",impl:br}]}],xr={},vr={};function yr(e,t,a){var i=a,n=function(a){le("Can not register `"+t+"` for `"+e+"` since `"+a+"` already exists in the prototype and can not be overridden")};if("core"===e){if(hs.prototype[t])return n(t);hs.prototype[t]=a}else if("collection"===e){if(Dn.prototype[t])return n(t);Dn.prototype[t]=a}else if("layout"===e){for(var s=function(e){this.options=e,a.call(this,e),y(this._private)||(this._private={}),this._private.cy=e.cy,this._private.listeners=[],this.createEmitter()},o=s.prototype=Object.create(a.prototype),r=[],l=0;l<r.length;l++){var c=r[l];o[c]=o[c]||function(){return this}}o.start&&!o.run?o.run=function(){return this.start(),this}:!o.start&&o.run&&(o.start=function(){return this.run(),this});var d=a.prototype.stop;o.stop=function(){var e=this.options;if(e&&e.animate){var t=this.animations;if(t)for(var a=0;a<t.length;a++)t[a].stop()}return d?d.call(this):this.emit("layoutstop"),this},o.destroy||(o.destroy=function(){return this}),o.cy=function(){return this._private.cy};var u=function(e){return e._private.cy},p={addEventFields:function(e,t){t.layout=e,t.cy=u(e),t.target=e},bubble:function(){return!0},parent:function(e){return u(e)}};P(o,{createEmitter:function(){return this._private.emitter=new Qi(p,this),this},emitter:function(){return this._private.emitter},on:function(e,t){return this.emitter().on(e,t),this},one:function(e,t){return this.emitter().one(e,t),this},once:function(e,t){return this.emitter().one(e,t),this},removeListener:function(e,t){return this.emitter().removeListener(e,t),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(e,t){return this.emitter().emit(e,t),this}}),Pa.eventAliasesOn(o),i=s}else if("renderer"===e&&"null"!==t&&"base"!==t){var m=Or("renderer","base"),b=m.prototype,f=a,h=a.prototype,g=function(){m.apply(this,arguments),f.apply(this,arguments)},j=g.prototype;for(var x in b){var v=b[x];if(null!=h[x])return n(x);j[x]=v}for(var O in h)j[O]=h[O];b.clientFunctions.forEach((function(e){j[e]=j[e]||function(){le("Renderer does not implement `renderer."+e+"()` on its prototype")}})),i=g}return B({map:xr,keys:[e,t],value:i})}function Or(e,t){return V({map:xr,keys:[e,t]})}function Er(e,t,a,i,n){return B({map:vr,keys:[e,t,a,i],value:n})}function wr(e,t,a,i){return V({map:vr,keys:[e,t,a,i]})}var Mr=function(){return 2===arguments.length?Or.apply(null,arguments):3===arguments.length?yr.apply(null,arguments):4===arguments.length?wr.apply(null,arguments):5===arguments.length?Er.apply(null,arguments):void le("Invalid extension access syntax")};hs.prototype.extension=Mr,jr.forEach((function(e){e.extensions.forEach((function(t){yr(e.type,t.name,t.impl)}))}));var Sr=function e(){if(!(this instanceof e))return new e;this.length=0},_r=Sr.prototype;_r.instanceString=function(){return"stylesheet"},_r.selector=function(e){return this[this.length++]={selector:e,properties:[]},this},_r.css=function(e,t){var a=this.length-1;if(j(e))this[a].properties.push({name:e,value:t});else if(y(e))for(var i=e,n=Object.keys(i),s=0;s<n.length;s++){var o=n[s],r=i[o];if(null!=r){var l=us.properties[o]||us.properties[D(o)];if(null!=l){var c=l.name,d=r;this[a].properties.push({name:c,value:d})}}}return this},_r.style=_r.css,_r.generateStyle=function(e){var t=new us(e);return this.appendToStyle(t)},_r.appendToStyle=function(e){for(var t=0;t<this.length;t++){var a=this[t],i=a.selector,n=a.properties;e.selector(i);for(var s=0;s<n.length;s++){var o=n[s];e.css(o.name,o.value)}}return e};var Tr=function(e){return void 0===e&&(e={}),y(e)?new hs(e):j(e)?Mr.apply(Mr,arguments):void 0};Tr.use=function(e){var t=Array.prototype.slice.call(arguments,1);return t.unshift(Tr),e.apply(null,t),this},Tr.warnings=function(e){return ce(e)},Tr.version="3.10.0",Tr.stylesheet=Tr.Stylesheet=Sr,e.exports=Tr}).call(this,a(413).setImmediate)},function(e,t,a){(function(e){var i=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new n(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new n(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},a(414),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,a(171))},function(e,t,a){(function(e,t){!function(e,a){"use strict";if(!e.setImmediate){var i,n,s,o,r,l=1,c={},d=!1,u=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick((function(){b(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,a=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=a,t}}()?(o="setImmediate$"+Math.random()+"$",r=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&b(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),i=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){b(e.data)},i=function(e){s.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(n=u.documentElement,i=function(e){var t=u.createElement("script");t.onreadystatechange=function(){b(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):i=function(e){setTimeout(b,0,e)},p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),a=0;a<t.length;a++)t[a]=arguments[a+1];var n={callback:e,args:t};return c[l]=n,i(l),l++},p.clearImmediate=m}function m(e){delete c[e]}function b(e){if(d)setTimeout(b,0,e);else{var t=c[e];if(t){d=!0;try{!function(e){var t=e.callback,a=e.args;switch(a.length){case 0:t();break;case 1:t(a[0]);break;case 2:t(a[0],a[1]);break;case 3:t(a[0],a[1],a[2]);break;default:t.apply(void 0,a)}}(t)}finally{m(e),d=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,a(171),a(270))},function(e,t,a){(function(t){var a=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt,r="object"==typeof t&&t&&t.Object===Object&&t,l="object"==typeof self&&self&&self.Object===Object&&self,c=r||l||Function("return this")(),d=Object.prototype.toString,u=Math.max,p=Math.min,m=function(){return c.Date.now()};function b(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function f(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==d.call(e)}(e))return NaN;if(b(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=b(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(a,"");var r=n.test(e);return r||s.test(e)?o(e.slice(2),r?2:8):i.test(e)?NaN:+e}e.exports=function(e,t,a){var i,n,s,o,r,l,c=0,d=!1,h=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function j(t){var a=i,s=n;return i=n=void 0,c=t,o=e.apply(s,a)}function x(e){return c=e,r=setTimeout(y,t),d?j(e):o}function v(e){var a=e-l;return void 0===l||a>=t||a<0||h&&e-c>=s}function y(){var e=m();if(v(e))return O(e);r=setTimeout(y,function(e){var a=t-(e-l);return h?p(a,s-(e-c)):a}(e))}function O(e){return r=void 0,g&&i?j(e):(i=n=void 0,o)}function E(){var e=m(),a=v(e);if(i=arguments,n=this,l=e,a){if(void 0===r)return x(l);if(h)return r=setTimeout(y,t),j(l)}return void 0===r&&(r=setTimeout(y,t)),o}return t=f(t)||0,b(a)&&(d=!!a.leading,s=(h="maxWait"in a)?u(f(a.maxWait)||0,t):s,g="trailing"in a?!!a.trailing:g),E.cancel=function(){void 0!==r&&clearTimeout(r),c=0,i=l=n=r=void 0},E.flush=function(){return void 0===r?o:O(m())},E}}).call(this,a(171))},function(e,t,a){e.exports=a(417)},function(e,t,a){var i,n,s;(function(){var a,o,r,l,c,d,u,p,m,b,f,h,g,j,x;r=Math.floor,b=Math.min,o=function(e,t){return e<t?-1:e>t?1:0},m=function(e,t,a,i,n){var s;if(null==a&&(a=0),null==n&&(n=o),a<0)throw new Error("lo must be non-negative");for(null==i&&(i=e.length);a<i;)n(t,e[s=r((a+i)/2)])<0?i=s:a=s+1;return[].splice.apply(e,[a,a-a].concat(t)),t},d=function(e,t,a){return null==a&&(a=o),e.push(t),j(e,0,e.length-1,a)},c=function(e,t){var a,i;return null==t&&(t=o),a=e.pop(),e.length?(i=e[0],e[0]=a,x(e,0,t)):i=a,i},p=function(e,t,a){var i;return null==a&&(a=o),i=e[0],e[0]=t,x(e,0,a),i},u=function(e,t,a){var i;return null==a&&(a=o),e.length&&a(e[0],t)<0&&(t=(i=[e[0],t])[0],e[0]=i[1],x(e,0,a)),t},l=function(e,t){var a,i,n,s,l,c;for(null==t&&(t=o),l=[],i=0,n=(s=function(){c=[];for(var t=0,a=r(e.length/2);0<=a?t<a:t>a;0<=a?t++:t--)c.push(t);return c}.apply(this).reverse()).length;i<n;i++)a=s[i],l.push(x(e,a,t));return l},g=function(e,t,a){var i;if(null==a&&(a=o),-1!==(i=e.indexOf(t)))return j(e,0,i,a),x(e,i,a)},f=function(e,t,a){var i,n,s,r,c;if(null==a&&(a=o),!(n=e.slice(0,t)).length)return n;for(l(n,a),s=0,r=(c=e.slice(t)).length;s<r;s++)i=c[s],u(n,i,a);return n.sort(a).reverse()},h=function(e,t,a){var i,n,s,r,d,u,p,f,h;if(null==a&&(a=o),10*t<=e.length){if(!(s=e.slice(0,t).sort(a)).length)return s;for(n=s[s.length-1],r=0,u=(p=e.slice(t)).length;r<u;r++)a(i=p[r],n)<0&&(m(s,i,0,null,a),s.pop(),n=s[s.length-1]);return s}for(l(e,a),h=[],d=0,f=b(t,e.length);0<=f?d<f:d>f;0<=f?++d:--d)h.push(c(e,a));return h},j=function(e,t,a,i){var n,s,r;for(null==i&&(i=o),n=e[a];a>t&&i(n,s=e[r=a-1>>1])<0;)e[a]=s,a=r;return e[a]=n},x=function(e,t,a){var i,n,s,r,l;for(null==a&&(a=o),n=e.length,l=t,s=e[t],i=2*t+1;i<n;)(r=i+1)<n&&!(a(e[i],e[r])<0)&&(i=r),e[t]=e[i],i=2*(t=i)+1;return e[t]=s,j(e,l,t,a)},a=function(){function e(e){this.cmp=null!=e?e:o,this.nodes=[]}return e.push=d,e.pop=c,e.replace=p,e.pushpop=u,e.heapify=l,e.updateItem=g,e.nlargest=f,e.nsmallest=h,e.prototype.push=function(e){return d(this.nodes,e,this.cmp)},e.prototype.pop=function(){return c(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return p(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return u(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return l(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return g(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return(t=new e).nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),n=[],void 0===(s="function"==typeof(i=function(){return a})?i.apply(t,n):i)||(e.exports=s)}).call(this)},function(e,t,a){var i;i=function(e){return function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.i=function(e){return e},a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=3)}([function(e,t,a){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=a(2),s=a(1),o=a(4);function r(e){this.options=s({},n,e)}r.prototype.run=function(){var e=this.options,t=e.cy,a=e.eles,n=function(e,t){return"function"==typeof t?t.apply(e,[e]):t},s=e.boundingBox||{x1:0,y1:0,w:t.width(),h:t.height()};void 0===s.x2&&(s.x2=s.x1+s.w),void 0===s.w&&(s.w=s.x2-s.x1),void 0===s.y2&&(s.y2=s.y1+s.h),void 0===s.h&&(s.h=s.y2-s.y1);var r=new o.graphlib.Graph({multigraph:!0,compound:!0}),l={},c=function(e,t){null!=t&&(l[e]=t)};c("nodesep",e.nodeSep),c("edgesep",e.edgeSep),c("ranksep",e.rankSep),c("rankdir",e.rankDir),c("ranker",e.ranker),r.setGraph(l),r.setDefaultEdgeLabel((function(){return{}})),r.setDefaultNodeLabel((function(){return{}}));for(var d=a.nodes(),u=0;u<d.length;u++){var p=d[u],m=p.layoutDimensions(e);r.setNode(p.id(),{width:m.w,height:m.h,name:p.id()})}for(var b=0;b<d.length;b++){var f=d[b];f.isChild()&&r.setParent(f.id(),f.parent().id())}for(var h=a.edges().stdFilter((function(e){return!e.source().isParent()&&!e.target().isParent()})),g=0;g<h.length;g++){var j=h[g];r.setEdge(j.source().id(),j.target().id(),{minlen:n(j,e.minLen),weight:n(j,e.edgeWeight),name:j.id()},j.id())}o.layout(r);for(var x=r.nodes(),v=0;v<x.length;v++){var y=x[v],O=r.node(y);t.getElementById(y).scratch().dagre=O}var E=void 0;return e.boundingBox?(E={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0},d.forEach((function(e){var t=e.scratch().dagre;E.x1=Math.min(E.x1,t.x),E.x2=Math.max(E.x2,t.x),E.y1=Math.min(E.y1,t.y),E.y2=Math.max(E.y2,t.y)})),E.w=E.x2-E.x1,E.h=E.y2-E.y1):E=s,d.layoutPositions(this,e,(function(t){var a=(t="object"===(void 0===t?"undefined":i(t))?t:this).scratch().dagre;return function(t){if(e.boundingBox){var a=0===E.w?0:(t.x-E.x1)/E.w,i=0===E.h?0:(t.y-E.y1)/E.h;return{x:s.x1+a*s.w,y:s.y1+i*s.h}}return t}({x:a.x,y:a.y})})),this},e.exports=r},function(e,t,a){"use strict";e.exports=null!=Object.assign?Object.assign.bind(Object):function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),i=1;i<t;i++)a[i-1]=arguments[i];return a.forEach((function(t){Object.keys(t).forEach((function(a){return e[a]=t[a]}))})),e}},function(e,t,a){"use strict";e.exports={nodeSep:void 0,edgeSep:void 0,rankSep:void 0,rankDir:void 0,ranker:void 0,minLen:function(e){return 1},edgeWeight:function(e){return 1},fit:!0,padding:30,spacingFactor:void 0,nodeDimensionsIncludeLabels:!1,animate:!1,animateFilter:function(e,t){return!0},animationDuration:500,animationEasing:void 0,boundingBox:void 0,transform:function(e,t){return t},ready:function(){},stop:function(){}}},function(e,t,a){"use strict";var i=a(0),n=function(e){e&&e("layout","dagre",i)};"undefined"!=typeof cytoscape&&n(cytoscape),e.exports=n},function(t,a){t.exports=e}])},e.exports=i(a(419))},function(e,t,a){e.exports={graphlib:a(128),layout:a(476),debug:a(541),util:{time:a(117).time,notime:a(117).notime},version:a(542)}},function(e,t,a){var i=a(421);e.exports={Graph:i.Graph,json:a(466),alg:a(467),version:i.version}},function(e,t,a){e.exports={Graph:a(228),version:a(465)}},function(e,t,a){var i=a(281);e.exports=function(e){return i(e,4)}},function(e,t){e.exports=function(e){return function(t,a,i){for(var n=-1,s=Object(t),o=i(t),r=o.length;r--;){var l=o[e?r:++n];if(!1===a(s[l],l,s))break}return t}}},function(e,t,a){var i=a(162);e.exports=function(e,t){return function(a,n){if(null==a)return a;if(!i(a))return e(a,n);for(var s=a.length,o=t?s:-1,r=Object(a);(t?o--:++o<s)&&!1!==n(r[o],o,r););return a}}},function(e,t,a){e.exports=a(39)(3102)},function(e,t,a){var i=a(199);e.exports=function(e,t){var a=[];return i(e,(function(e,i,n){t(e,i,n)&&a.push(e)})),a}},function(e,t,a){var i=a(428),n=a(429),s=a(291);e.exports=function(e){var t=n(e);return 1==t.length&&t[0][2]?s(t[0][0],t[0][1]):function(a){return a===e||i(a,e,t)}}},function(e,t,a){var i=a(288),n=a(289);e.exports=function(e,t,a,s){var o=a.length,r=o,l=!s;if(null==e)return!r;for(e=Object(e);o--;){var c=a[o];if(l&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++o<r;){var d=(c=a[o])[0],u=e[d],p=c[1];if(l&&c[2]){if(void 0===u&&!(d in e))return!1}else{var m=new i;if(s)var b=s(u,p,d,e,t,m);if(!(void 0===b?n(p,u,3,s,m):b))return!1}}return!0}},function(e,t,a){var i=a(290),n=a(176);e.exports=function(e){for(var t=n(e),a=t.length;a--;){var s=t[a],o=e[s];t[a]=[s,o,i(o)]}return t}},function(e,t,a){var i=a(289),n=a(292),s=a(293),o=a(296),r=a(290),l=a(291),c=a(200);e.exports=function(e,t){return o(e)&&r(t)?l(c(e),t):function(a){var o=n(a,e);return void 0===o&&o===t?s(a,e):i(t,o,3)}}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,a){e.exports=a(39)(1505)},function(e,t,a){var i=a(297),n=a(434),s=a(296),o=a(200);e.exports=function(e){return s(e)?i(o(e)):n(e)}},function(e,t,a){var i=a(233);e.exports=function(e){return function(t){return i(t,e)}}},function(e,t){var a=Object.prototype.hasOwnProperty;e.exports=function(e,t){return null!=e&&a.call(e,t)}},function(e,t,a){var i=a(299),n=a(300),s=a(232),o=a(129),r=a(162),l=a(234),c=a(437),d=a(235),u=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(r(e)&&(o(e)||"string"==typeof e||"function"==typeof e.splice||l(e)||d(e)||s(e)))return!e.length;var t=n(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(c(e))return!i(e).length;for(var a in e)if(u.call(e,a))return!1;return!0}},function(e,t,a){e.exports=a(39)(1140)},function(e,t){e.exports=function(e,t,a,i){var n=-1,s=null==e?0:e.length;for(i&&s&&(a=e[++n]);++n<s;)a=t(a,e[n],n,e);return a}},function(e,t){e.exports=function(e,t,a,i,n){return n(e,(function(e,n,s){a=i?(i=!1,e):t(a,e,n,s)})),a}},function(e,t,a){var i=a(299),n=a(300),s=a(162),o=a(441),r=a(442);e.exports=function(e){if(null==e)return 0;if(s(e))return o(e)?r(e):e.length;var t=n(e);return"[object Map]"==t||"[object Set]"==t?e.size:i(e).length}},function(e,t,a){e.exports=a(39)(1768)},function(e,t,a){var i=a(443),n=a(444),s=a(445);e.exports=function(e){return n(e)?s(e):i(e)}},function(e,t,a){var i=a(297)("length");e.exports=i},function(e,t){var a=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return a.test(e)}},function(e,t){var a="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",n="[^\\ud800-\\udfff]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",o="[\\ud800-\\udbff][\\udc00-\\udfff]",r="(?:"+a+"|"+i+")?",l="[\\ufe0e\\ufe0f]?",c=l+r+"(?:\\u200d(?:"+[n,s,o].join("|")+")"+l+r+")*",d="(?:"+[n+a+"?",a,s,o,"[\\ud800-\\udfff]"].join("|")+")",u=RegExp(i+"(?="+i+")|"+d+c,"g");e.exports=function(e){for(var t=u.lastIndex=0;u.test(e);)++t;return t}},function(e,t,a){var i=a(285),n=a(447),s=a(229),o=a(142),r=a(448),l=a(129),c=a(234),d=a(236),u=a(177),p=a(235);e.exports=function(e,t,a){var m=l(e),b=m||c(e)||p(e);if(t=o(t,4),null==a){var f=e&&e.constructor;a=b?m?new f:[]:u(e)&&d(f)?n(r(e)):{}}return(b?i:s)(e,(function(e,i,n){return t(a,e,i,n)})),a}},function(e,t,a){e.exports=a(39)(3416)},function(e,t,a){e.exports=a(39)(1157)},function(e,t,a){var i=a(305),n=a(201),s=a(452),o=a(308),r=n((function(e){return s(i(e,1,o,!0))}));e.exports=r},function(e,t,a){e.exports=a(39)(3431)},function(e,t,a){e.exports=a(39)(3433)},function(e,t,a){var i=a(453),n=a(454),s=a(458),o=a(459),r=a(460),l=a(307);e.exports=function(e,t,a){var c=-1,d=n,u=e.length,p=!0,m=[],b=m;if(a)p=!1,d=s;else if(u>=200){var f=t?null:r(e);if(f)return l(f);p=!1,d=o,b=new i}else b=t?[]:m;e:for(;++c<u;){var h=e[c],g=t?t(h):h;if(h=a||0!==h?h:0,p&&g==g){for(var j=b.length;j--;)if(b[j]===g)continue e;t&&b.push(g),m.push(h)}else d(b,g,a)||(b!==m&&b.push(g),m.push(h))}return m}},function(e,t,a){e.exports=a(39)(3093)},function(e,t,a){var i=a(455);e.exports=function(e,t){return!(null==e||!e.length)&&i(e,t,0)>-1}},function(e,t,a){var i=a(306),n=a(456),s=a(457);e.exports=function(e,t,a){return t==t?s(e,t,a):i(e,n,a)}},function(e,t){e.exports=function(e){return e!=e}},function(e,t){e.exports=function(e,t,a){for(var i=a-1,n=e.length;++i<n;)if(e[i]===t)return i;return-1}},function(e,t){e.exports=function(e,t,a){for(var i=-1,n=null==e?0:e.length;++i<n;)if(a(t,e[i]))return!0;return!1}},function(e,t,a){e.exports=a(39)(3097)},function(e,t,a){var i=a(461),n=a(462),s=a(307),o=i&&1/s(new i([,-0]))[1]==1/0?function(e){return new i(e)}:n;e.exports=o},function(e,t,a){e.exports=a(39)(3110)},function(e,t){e.exports=function(){}},function(e,t,a){e.exports=a(39)(257)},function(e,t,a){var i=a(237);e.exports=function(e,t){return i(t,(function(t){return e[t]}))}},function(e,t){e.exports="2.1.8"},function(e,t,a){var i=a(123),n=a(228);function s(e){return i.map(e.nodes(),(function(t){var a=e.node(t),n=e.parent(t),s={v:t};return i.isUndefined(a)||(s.value=a),i.isUndefined(n)||(s.parent=n),s}))}function o(e){return i.map(e.edges(),(function(t){var a=e.edge(t),n={v:t.v,w:t.w};return i.isUndefined(t.name)||(n.name=t.name),i.isUndefined(a)||(n.value=a),n}))}e.exports={write:function(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:s(e),edges:o(e)};return i.isUndefined(e.graph())||(t.value=i.clone(e.graph())),t},read:function(e){var t=new n(e.options).setGraph(e.value);return i.each(e.nodes,(function(e){t.setNode(e.v,e.value),e.parent&&t.setParent(e.v,e.parent)})),i.each(e.edges,(function(e){t.setEdge({v:e.v,w:e.w,name:e.name},e.value)})),t}}},function(e,t,a){e.exports={components:a(468),dijkstra:a(310),dijkstraAll:a(469),findCycles:a(470),floydWarshall:a(471),isAcyclic:a(472),postorder:a(473),preorder:a(474),prim:a(475),tarjan:a(312),topsort:a(313)}},function(e,t,a){var i=a(123);e.exports=function(e){var t,a={},n=[];function s(n){i.has(a,n)||(a[n]=!0,t.push(n),i.each(e.successors(n),s),i.each(e.predecessors(n),s))}return i.each(e.nodes(),(function(e){t=[],s(e),t.length&&n.push(t)})),n}},function(e,t,a){var i=a(310),n=a(123);e.exports=function(e,t,a){return n.transform(e.nodes(),(function(n,s){n[s]=i(e,s,t,a)}),{})}},function(e,t,a){var i=a(123),n=a(312);e.exports=function(e){return i.filter(n(e),(function(t){return t.length>1||1===t.length&&e.hasEdge(t[0],t[0])}))}},function(e,t,a){var i=a(123);e.exports=function(e,t,a){return function(e,t,a){var i={},n=e.nodes();return n.forEach((function(e){i[e]={},i[e][e]={distance:0},n.forEach((function(t){e!==t&&(i[e][t]={distance:Number.POSITIVE_INFINITY})})),a(e).forEach((function(a){var n=a.v===e?a.w:a.v,s=t(a);i[e][n]={distance:s,predecessor:e}}))})),n.forEach((function(e){var t=i[e];n.forEach((function(a){var s=i[a];n.forEach((function(a){var i=s[e],n=t[a],o=s[a],r=i.distance+n.distance;r<o.distance&&(o.distance=r,o.predecessor=n.predecessor)}))}))})),i}(e,t||n,a||function(t){return e.outEdges(t)})};var n=i.constant(1)},function(e,t,a){var i=a(313);e.exports=function(e){try{i(e)}catch(e){if(e instanceof i.CycleException)return!1;throw e}return!0}},function(e,t,a){var i=a(314);e.exports=function(e,t){return i(e,t,"post")}},function(e,t,a){var i=a(314);e.exports=function(e,t){return i(e,t,"pre")}},function(e,t,a){var i=a(123),n=a(228),s=a(311);e.exports=function(e,t){var a,o=new n,r={},l=new s;function c(e){var i=e.v===a?e.w:e.v,n=l.priority(i);if(void 0!==n){var s=t(e);s<n&&(r[i]=a,l.decrease(i,s))}}if(0===e.nodeCount())return o;i.each(e.nodes(),(function(e){l.add(e,Number.POSITIVE_INFINITY),o.setNode(e)})),l.decrease(e.nodes()[0],0);for(var d=!1;l.size()>0;){if(a=l.removeMin(),i.has(r,a))o.setEdge(a,r[a]);else{if(d)throw new Error("Input graph is not connected: "+e);d=!0}e.nodeEdges(a).forEach(c)}return o}},function(e,t,a){"use strict";var i=a(98),n=a(520),s=a(523),o=a(524),r=a(117).normalizeRanks,l=a(526),c=a(117).removeEmptyRanks,d=a(527),u=a(528),p=a(529),m=a(530),b=a(539),f=a(117),h=a(128).Graph;e.exports=function(e,t){var a=t&&t.debugTiming?f.time:f.notime;a("layout",(function(){var t=a("  buildLayoutGraph",(function(){return function(e){var t=new h({multigraph:!0,compound:!0}),a=S(e.graph());return t.setGraph(i.merge({},j,M(a,g),i.pick(a,x))),i.forEach(e.nodes(),(function(a){var n=S(e.node(a));t.setNode(a,i.defaults(M(n,v),y)),t.setParent(a,e.parent(a))})),i.forEach(e.edges(),(function(a){var n=S(e.edge(a));t.setEdge(a,i.merge({},E,M(n,O),i.pick(n,w)))})),t}(e)}));a("  runLayout",(function(){!function(e,t){t("    makeSpaceForEdgeLabels",(function(){!function(e){var t=e.graph();t.ranksep/=2,i.forEach(e.edges(),(function(a){var i=e.edge(a);i.minlen*=2,"c"!==i.labelpos.toLowerCase()&&("TB"===t.rankdir||"BT"===t.rankdir?i.width+=i.labeloffset:i.height+=i.labeloffset)}))}(e)})),t("    removeSelfEdges",(function(){!function(e){i.forEach(e.edges(),(function(t){if(t.v===t.w){var a=e.node(t.v);a.selfEdges||(a.selfEdges=[]),a.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}}))}(e)})),t("    acyclic",(function(){n.run(e)})),t("    nestingGraph.run",(function(){d.run(e)})),t("    rank",(function(){o(f.asNonCompoundGraph(e))})),t("    injectEdgeLabelProxies",(function(){!function(e){i.forEach(e.edges(),(function(t){var a=e.edge(t);if(a.width&&a.height){var i=e.node(t.v),n={rank:(e.node(t.w).rank-i.rank)/2+i.rank,e:t};f.addDummyNode(e,"edge-proxy",n,"_ep")}}))}(e)})),t("    removeEmptyRanks",(function(){c(e)})),t("    nestingGraph.cleanup",(function(){d.cleanup(e)})),t("    normalizeRanks",(function(){r(e)})),t("    assignRankMinMax",(function(){!function(e){var t=0;i.forEach(e.nodes(),(function(a){var n=e.node(a);n.borderTop&&(n.minRank=e.node(n.borderTop).rank,n.maxRank=e.node(n.borderBottom).rank,t=i.max(t,n.maxRank))})),e.graph().maxRank=t}(e)})),t("    removeEdgeLabelProxies",(function(){!function(e){i.forEach(e.nodes(),(function(t){var a=e.node(t);"edge-proxy"===a.dummy&&(e.edge(a.e).labelRank=a.rank,e.removeNode(t))}))}(e)})),t("    normalize.run",(function(){s.run(e)})),t("    parentDummyChains",(function(){l(e)})),t("    addBorderSegments",(function(){u(e)})),t("    order",(function(){m(e)})),t("    insertSelfEdges",(function(){!function(e){var t=f.buildLayerMatrix(e);i.forEach(t,(function(t){var a=0;i.forEach(t,(function(t,n){var s=e.node(t);s.order=n+a,i.forEach(s.selfEdges,(function(t){f.addDummyNode(e,"selfedge",{width:t.label.width,height:t.label.height,rank:s.rank,order:n+ ++a,e:t.e,label:t.label},"_se")})),delete s.selfEdges}))}))}(e)})),t("    adjustCoordinateSystem",(function(){p.adjust(e)})),t("    position",(function(){b(e)})),t("    positionSelfEdges",(function(){!function(e){i.forEach(e.nodes(),(function(t){var a=e.node(t);if("selfedge"===a.dummy){var i=e.node(a.e.v),n=i.x+i.width/2,s=i.y,o=a.x-n,r=i.height/2;e.setEdge(a.e,a.label),e.removeNode(t),a.label.points=[{x:n+2*o/3,y:s-r},{x:n+5*o/6,y:s-r},{x:n+o,y:s},{x:n+5*o/6,y:s+r},{x:n+2*o/3,y:s+r}],a.label.x=a.x,a.label.y=a.y}}))}(e)})),t("    removeBorderNodes",(function(){!function(e){i.forEach(e.nodes(),(function(t){if(e.children(t).length){var a=e.node(t),n=e.node(a.borderTop),s=e.node(a.borderBottom),o=e.node(i.last(a.borderLeft)),r=e.node(i.last(a.borderRight));a.width=Math.abs(r.x-o.x),a.height=Math.abs(s.y-n.y),a.x=o.x+a.width/2,a.y=n.y+a.height/2}})),i.forEach(e.nodes(),(function(t){"border"===e.node(t).dummy&&e.removeNode(t)}))}(e)})),t("    normalize.undo",(function(){s.undo(e)})),t("    fixupEdgeLabelCoords",(function(){!function(e){i.forEach(e.edges(),(function(t){var a=e.edge(t);if(i.has(a,"x"))switch("l"!==a.labelpos&&"r"!==a.labelpos||(a.width-=a.labeloffset),a.labelpos){case"l":a.x-=a.width/2+a.labeloffset;break;case"r":a.x+=a.width/2+a.labeloffset}}))}(e)})),t("    undoCoordinateSystem",(function(){p.undo(e)})),t("    translateGraph",(function(){!function(e){var t=Number.POSITIVE_INFINITY,a=0,n=Number.POSITIVE_INFINITY,s=0,o=e.graph(),r=o.marginx||0,l=o.marginy||0;function c(e){var i=e.x,o=e.y,r=e.width,l=e.height;t=Math.min(t,i-r/2),a=Math.max(a,i+r/2),n=Math.min(n,o-l/2),s=Math.max(s,o+l/2)}i.forEach(e.nodes(),(function(t){c(e.node(t))})),i.forEach(e.edges(),(function(t){var a=e.edge(t);i.has(a,"x")&&c(a)})),t-=r,n-=l,i.forEach(e.nodes(),(function(a){var i=e.node(a);i.x-=t,i.y-=n})),i.forEach(e.edges(),(function(a){var s=e.edge(a);i.forEach(s.points,(function(e){e.x-=t,e.y-=n})),i.has(s,"x")&&(s.x-=t),i.has(s,"y")&&(s.y-=n)})),o.width=a-t+r,o.height=s-n+l}(e)})),t("    assignNodeIntersects",(function(){!function(e){i.forEach(e.edges(),(function(t){var a,i,n=e.edge(t),s=e.node(t.v),o=e.node(t.w);n.points?(a=n.points[0],i=n.points[n.points.length-1]):(n.points=[],a=o,i=s),n.points.unshift(f.intersectRect(s,a)),n.points.push(f.intersectRect(o,i))}))}(e)})),t("    reversePoints",(function(){!function(e){i.forEach(e.edges(),(function(t){var a=e.edge(t);a.reversed&&a.points.reverse()}))}(e)})),t("    acyclic.undo",(function(){n.undo(e)}))}(t,a)})),a("  updateInputGraph",(function(){!function(e,t){i.forEach(e.nodes(),(function(a){var i=e.node(a),n=t.node(a);i&&(i.x=n.x,i.y=n.y,t.children(a).length&&(i.width=n.width,i.height=n.height))})),i.forEach(e.edges(),(function(a){var n=e.edge(a),s=t.edge(a);n.points=s.points,i.has(s,"x")&&(n.x=s.x,n.y=s.y)})),e.graph().width=t.graph().width,e.graph().height=t.graph().height}(e,t)}))}))};var g=["nodesep","edgesep","ranksep","marginx","marginy"],j={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},x=["acyclicer","ranker","rankdir","align"],v=["width","height"],y={width:0,height:0},O=["minlen","weight","width","height","labeloffset"],E={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},w=["labelpos"];function M(e,t){return i.mapValues(i.pick(e,t),Number)}function S(e){var t={};return i.forEach(e,(function(e,a){t[a.toLowerCase()]=e})),t}},function(e,t,a){var i=a(281);e.exports=function(e){return i(e,5)}},function(e,t,a){var i=a(201),n=a(315),s=a(238),o=a(202),r=Object.prototype,l=r.hasOwnProperty,c=i((function(e,t){e=Object(e);var a=-1,i=t.length,c=i>2?t[2]:void 0;for(c&&s(t[0],t[1],c)&&(i=1);++a<i;)for(var d=t[a],u=o(d),p=-1,m=u.length;++p<m;){var b=u[p],f=e[b];(void 0===f||n(f,r[b])&&!l.call(e,b))&&(e[b]=d[b])}return e}));e.exports=c},function(e,t,a){var i=a(480)(a(481));e.exports=i},function(e,t,a){var i=a(142),n=a(162),s=a(176);e.exports=function(e){return function(t,a,o){var r=Object(t);if(!n(t)){var l=i(a,3);t=s(t),a=function(e){return l(r[e],e,r)}}var c=e(t,a,o);return c>-1?r[l?t[c]:c]:void 0}}},function(e,t,a){var i=a(306),n=a(142),s=a(482),o=Math.max;e.exports=function(e,t,a){var r=null==e?0:e.length;if(!r)return-1;var l=null==a?0:s(a);return l<0&&(l=o(r+l,0)),i(e,n(t,3),l)}},function(e,t,a){e.exports=a(39)(3384)},function(e,t,a){e.exports=a(39)(3428)},function(e,t,a){var i=a(230),n=a(286),s=a(202);e.exports=function(e,t){return null==e?e:i(e,n(t),s)}},function(e,t,a){e.exports=a(39)(3422)},function(e,t,a){var i=a(316),n=a(229),s=a(142);e.exports=function(e,t){var a={};return t=s(t,3),n(e,(function(e,n,s){i(a,n,t(e,n,s))})),a}},function(e,t,a){var i=a(239),n=a(488),s=a(178);e.exports=function(e){return e&&e.length?i(e,s,n):void 0}},function(e,t){e.exports=function(e,t){return e>t}},function(e,t,a){var i=a(490),n=a(499)((function(e,t,a){i(e,t,a)}));e.exports=n},function(e,t,a){var i=a(288),n=a(318),s=a(230),o=a(491),r=a(177),l=a(202),c=a(319);e.exports=function e(t,a,d,u,p){t!==a&&s(a,(function(s,l){if(p||(p=new i),r(s))o(t,a,l,d,e,u,p);else{var m=u?u(c(t,l),s,l+"",t,a,p):void 0;void 0===m&&(m=s),n(t,l,m)}}),l)}},function(e,t,a){var i=a(318),n=a(492),s=a(493),o=a(494),r=a(495),l=a(232),c=a(129),d=a(308),u=a(234),p=a(236),m=a(177),b=a(496),f=a(235),h=a(319),g=a(497);e.exports=function(e,t,a,j,x,v,y){var O=h(e,a),E=h(t,a),w=y.get(E);if(w)i(e,a,w);else{var M=v?v(O,E,a+"",e,t,y):void 0,S=void 0===M;if(S){var _=c(E),T=!_&&u(E),C=!_&&!T&&f(E);M=E,_||T||C?c(O)?M=O:d(O)?M=o(O):T?(S=!1,M=n(E,!0)):C?(S=!1,M=s(E,!0)):M=[]:b(E)||l(E)?(M=O,l(O)?M=g(O):m(O)&&!p(O)||(M=r(E))):S=!1}S&&(y.set(E,M),x(M,E,j,v,y),y.delete(E)),i(e,a,M)}}},function(e,t,a){e.exports=a(39)(3405)},function(e,t,a){e.exports=a(39)(3414)},function(e,t,a){e.exports=a(39)(3406)},function(e,t,a){e.exports=a(39)(3415)},function(e,t,a){e.exports=a(39)(3426)},function(e,t,a){var i=a(498),n=a(202);e.exports=function(e){return i(e,n(e))}},function(e,t,a){e.exports=a(39)(639)},function(e,t,a){var i=a(201),n=a(238);e.exports=function(e){return i((function(t,a){var i=-1,s=a.length,o=s>1?a[s-1]:void 0,r=s>2?a[2]:void 0;for(o=e.length>3&&"function"==typeof o?(s--,o):void 0,r&&n(a[0],a[1],r)&&(o=s<3?void 0:o,s=1),t=Object(t);++i<s;){var l=a[i];l&&e(t,l,i,o)}return t}))}},function(e,t,a){var i=a(239),n=a(320),s=a(178);e.exports=function(e){return e&&e.length?i(e,s,n):void 0}},function(e,t,a){var i=a(239),n=a(142),s=a(320);e.exports=function(e,t){return e&&e.length?i(e,n(t,2),s):void 0}},function(e,t,a){var i=a(503);e.exports=function(){return i.Date.now()}},function(e,t,a){e.exports=a(39)(286)},function(e,t,a){var i=a(505),n=a(508)((function(e,t){return null==e?{}:i(e,t)}));e.exports=n},function(e,t,a){var i=a(506),n=a(293);e.exports=function(e,t){return i(e,t,(function(t,a){return n(e,a)}))}},function(e,t,a){var i=a(233),n=a(507),s=a(231);e.exports=function(e,t,a){for(var o=-1,r=t.length,l={};++o<r;){var c=t[o],d=i(e,c);a(d,c)&&n(l,s(c,e),d)}return l}},function(e,t,a){var i=a(321),n=a(231),s=a(295),o=a(177),r=a(200);e.exports=function(e,t,a,l){if(!o(e))return e;for(var c=-1,d=(t=n(t,e)).length,u=d-1,p=e;null!=p&&++c<d;){var m=r(t[c]),b=a;if("__proto__"===m||"constructor"===m||"prototype"===m)return e;if(c!=u){var f=p[m];void 0===(b=l?l(f,m,p):void 0)&&(b=o(f)?f:s(t[c+1])?[]:{})}i(p,m,b),p=p[m]}return e}},function(e,t,a){e.exports=a(39)(3427)},function(e,t,a){e.exports=a(39)(1816)},function(e,t,a){var i=a(305),n=a(511),s=a(201),o=a(238),r=s((function(e,t){if(null==e)return[];var a=t.length;return a>1&&o(e,t[0],t[1])?t=[]:a>2&&o(t[0],t[1],t[2])&&(t=[t[0]]),n(e,i(t,1),[])}));e.exports=r},function(e,t,a){var i=a(237),n=a(233),s=a(142),o=a(303),r=a(512),l=a(513),c=a(514),d=a(178),u=a(129);e.exports=function(e,t,a){t=t.length?i(t,(function(e){return u(e)?function(t){return n(t,1===e.length?e[0]:e)}:e})):[d];var p=-1;t=i(t,l(s));var m=o(e,(function(e,a,n){return{criteria:i(t,(function(t){return t(e)})),index:++p,value:e}}));return r(m,(function(e,t){return c(e,t,a)}))}},function(e,t){e.exports=function(e,t){var a=e.length;for(e.sort(t);a--;)e[a]=e[a].value;return e}},function(e,t,a){e.exports=a(39)(1138)},function(e,t,a){var i=a(515);e.exports=function(e,t,a){for(var n=-1,s=e.criteria,o=t.criteria,r=s.length,l=a.length;++n<r;){var c=i(s[n],o[n]);if(c)return n>=l?c:c*("desc"==a[n]?-1:1)}return e.index-t.index}},function(e,t,a){var i=a(317);e.exports=function(e,t){if(e!==t){var a=void 0!==e,n=null===e,s=e==e,o=i(e),r=void 0!==t,l=null===t,c=t==t,d=i(t);if(!l&&!d&&!o&&e>t||o&&r&&c&&!l&&!d||n&&r&&c||!a&&c||!s)return 1;if(!n&&!o&&!d&&e<t||d&&a&&s&&!n&&!o||l&&a&&s||!r&&s||!c)return-1}return 0}},function(e,t,a){var i=a(517),n=0;e.exports=function(e){var t=++n;return i(e)+t}},function(e,t,a){e.exports=a(39)(3397)},function(e,t,a){var i=a(321),n=a(519);e.exports=function(e,t){return n(e||[],t||[],i)}},function(e,t){e.exports=function(e,t,a){for(var i=-1,n=e.length,s=t.length,o={};++i<n;){var r=i<s?t[i]:void 0;a(o,e[i],r)}return o}},function(e,t,a){"use strict";var i=a(98),n=a(521);e.exports={run:function(e){var t="greedy"===e.graph().acyclicer?n(e,function(e){return function(t){return e.edge(t).weight}}(e)):function(e){var t=[],a={},n={};return i.forEach(e.nodes(),(function s(o){i.has(n,o)||(n[o]=!0,a[o]=!0,i.forEach(e.outEdges(o),(function(e){i.has(a,e.w)?t.push(e):s(e.w)})),delete a[o])})),t}(e);i.forEach(t,(function(t){var a=e.edge(t);e.removeEdge(t),a.forwardName=t.name,a.reversed=!0,e.setEdge(t.w,t.v,a,i.uniqueId("rev"))}))},undo:function(e){i.forEach(e.edges(),(function(t){var a=e.edge(t);if(a.reversed){e.removeEdge(t);var i=a.forwardName;delete a.reversed,delete a.forwardName,e.setEdge(t.w,t.v,a,i)}}))}}},function(e,t,a){var i=a(98),n=a(128).Graph,s=a(522);e.exports=function(e,t){if(e.nodeCount()<=1)return[];var a=function(e,t){var a=new n,o=0,r=0;i.forEach(e.nodes(),(function(e){a.setNode(e,{v:e,in:0,out:0})})),i.forEach(e.edges(),(function(e){var i=a.edge(e.v,e.w)||0,n=t(e),s=i+n;a.setEdge(e.v,e.w,s),r=Math.max(r,a.node(e.v).out+=n),o=Math.max(o,a.node(e.w).in+=n)}));var c=i.range(r+o+3).map((function(){return new s})),d=o+1;return i.forEach(a.nodes(),(function(e){l(c,d,a.node(e))})),{graph:a,buckets:c,zeroIdx:d}}(e,t||o),c=function(e,t,a){for(var i,n=[],s=t[t.length-1],o=t[0];e.nodeCount();){for(;i=o.dequeue();)r(e,t,a,i);for(;i=s.dequeue();)r(e,t,a,i);if(e.nodeCount())for(var l=t.length-2;l>0;--l)if(i=t[l].dequeue()){n=n.concat(r(e,t,a,i,!0));break}}return n}(a.graph,a.buckets,a.zeroIdx);return i.flatten(i.map(c,(function(t){return e.outEdges(t.v,t.w)})),!0)};var o=i.constant(1);function r(e,t,a,n,s){var o=s?[]:void 0;return i.forEach(e.inEdges(n.v),(function(i){var n=e.edge(i),r=e.node(i.v);s&&o.push({v:i.v,w:i.w}),r.out-=n,l(t,a,r)})),i.forEach(e.outEdges(n.v),(function(i){var n=e.edge(i),s=i.w,o=e.node(s);o.in-=n,l(t,a,o)})),e.removeNode(n.v),o}function l(e,t,a){a.out?a.in?e[a.out-a.in+t].enqueue(a):e[e.length-1].enqueue(a):e[0].enqueue(a)}},function(e,t){function a(){var e={};e._next=e._prev=e,this._sentinel=e}function i(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function n(e,t){if("_next"!==e&&"_prev"!==e)return t}e.exports=a,a.prototype.dequeue=function(){var e=this._sentinel,t=e._prev;if(t!==e)return i(t),t},a.prototype.enqueue=function(e){var t=this._sentinel;e._prev&&e._next&&i(e),e._next=t._next,t._next._prev=e,t._next=e,e._prev=t},a.prototype.toString=function(){for(var e=[],t=this._sentinel,a=t._prev;a!==t;)e.push(JSON.stringify(a,n)),a=a._prev;return"["+e.join(", ")+"]"}},function(e,t,a){"use strict";var i=a(98),n=a(117);e.exports={run:function(e){e.graph().dummyChains=[],i.forEach(e.edges(),(function(t){!function(e,t){var a,i,s,o=t.v,r=e.node(o).rank,l=t.w,c=e.node(l).rank,d=t.name,u=e.edge(t),p=u.labelRank;if(c!==r+1){for(e.removeEdge(t),s=0,++r;r<c;++s,++r)u.points=[],i={width:0,height:0,edgeLabel:u,edgeObj:t,rank:r},a=n.addDummyNode(e,"edge",i,"_d"),r===p&&(i.width=u.width,i.height=u.height,i.dummy="edge-label",i.labelpos=u.labelpos),e.setEdge(o,a,{weight:u.weight},d),0===s&&e.graph().dummyChains.push(a),o=a;e.setEdge(o,l,{weight:u.weight},d)}}(e,t)}))},undo:function(e){i.forEach(e.graph().dummyChains,(function(t){var a,i=e.node(t),n=i.edgeLabel;for(e.setEdge(i.edgeObj,n);i.dummy;)a=e.successors(t)[0],e.removeNode(t),n.points.push({x:i.x,y:i.y}),"edge-label"===i.dummy&&(n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height),t=a,i=e.node(t)}))}}},function(e,t,a){"use strict";var i=a(203).longestPath,n=a(322),s=a(525);e.exports=function(e){switch(e.graph().ranker){case"network-simplex":default:!function(e){s(e)}(e);break;case"tight-tree":!function(e){i(e),n(e)}(e);break;case"longest-path":o(e)}};var o=i},function(e,t,a){"use strict";var i=a(98),n=a(322),s=a(203).slack,o=a(203).longestPath,r=a(128).alg.preorder,l=a(128).alg.postorder,c=a(117).simplify;function d(e){e=c(e),o(e);var t,a=n(e);for(m(a),u(a,e);t=f(a);)g(a,e,t,h(a,e,t))}function u(e,t){var a=l(e,e.nodes());a=a.slice(0,a.length-1),i.forEach(a,(function(a){!function(e,t,a){var i=e.node(a).parent;e.edge(a,i).cutvalue=p(e,t,a)}(e,t,a)}))}function p(e,t,a){var n=e.node(a).parent,s=!0,o=t.edge(a,n),r=0;return o||(s=!1,o=t.edge(n,a)),r=o.weight,i.forEach(t.nodeEdges(a),(function(i){var o,l,c=i.v===a,d=c?i.w:i.v;if(d!==n){var u=c===s,p=t.edge(i).weight;if(r+=u?p:-p,o=a,l=d,e.hasEdge(o,l)){var m=e.edge(a,d).cutvalue;r+=u?-m:m}}})),r}function m(e,t){arguments.length<2&&(t=e.nodes()[0]),b(e,{},1,t)}function b(e,t,a,n,s){var o=a,r=e.node(n);return t[n]=!0,i.forEach(e.neighbors(n),(function(s){i.has(t,s)||(a=b(e,t,a,s,n))})),r.low=o,r.lim=a++,s?r.parent=s:delete r.parent,a}function f(e){return i.find(e.edges(),(function(t){return e.edge(t).cutvalue<0}))}function h(e,t,a){var n=a.v,o=a.w;t.hasEdge(n,o)||(n=a.w,o=a.v);var r=e.node(n),l=e.node(o),c=r,d=!1;r.lim>l.lim&&(c=l,d=!0);var u=i.filter(t.edges(),(function(t){return d===j(0,e.node(t.v),c)&&d!==j(0,e.node(t.w),c)}));return i.minBy(u,(function(e){return s(t,e)}))}function g(e,t,a,n){var s=a.v,o=a.w;e.removeEdge(s,o),e.setEdge(n.v,n.w,{}),m(e),u(e,t),function(e,t){var a=i.find(e.nodes(),(function(e){return!t.node(e).parent})),n=r(e,a);n=n.slice(1),i.forEach(n,(function(a){var i=e.node(a).parent,n=t.edge(a,i),s=!1;n||(n=t.edge(i,a),s=!0),t.node(a).rank=t.node(i).rank+(s?n.minlen:-n.minlen)}))}(e,t)}function j(e,t,a){return a.low<=t.lim&&t.lim<=a.lim}e.exports=d,d.initLowLimValues=m,d.initCutValues=u,d.calcCutValue=p,d.leaveEdge=f,d.enterEdge=h,d.exchangeEdges=g},function(e,t,a){var i=a(98);e.exports=function(e){var t=function(e){var t={},a=0;return i.forEach(e.children(),(function n(s){var o=a;i.forEach(e.children(s),n),t[s]={low:o,lim:a++}})),t}(e);i.forEach(e.graph().dummyChains,(function(a){for(var i=e.node(a),n=i.edgeObj,s=function(e,t,a,i){var n,s,o=[],r=[],l=Math.min(t[a].low,t[i].low),c=Math.max(t[a].lim,t[i].lim);n=a;do{n=e.parent(n),o.push(n)}while(n&&(t[n].low>l||c>t[n].lim));for(s=n,n=i;(n=e.parent(n))!==s;)r.push(n);return{path:o.concat(r.reverse()),lca:s}}(e,t,n.v,n.w),o=s.path,r=s.lca,l=0,c=o[l],d=!0;a!==n.w;){if(i=e.node(a),d){for(;(c=o[l])!==r&&e.node(c).maxRank<i.rank;)l++;c===r&&(d=!1)}if(!d){for(;l<o.length-1&&e.node(c=o[l+1]).minRank<=i.rank;)l++;c=o[l]}e.setParent(a,c),a=e.successors(a)[0]}}))}},function(e,t,a){var i=a(98),n=a(117);function s(e,t,a,o,r,l,c){var d=e.children(c);if(d.length){var u=n.addBorderNode(e,"_bt"),p=n.addBorderNode(e,"_bb"),m=e.node(c);e.setParent(u,c),m.borderTop=u,e.setParent(p,c),m.borderBottom=p,i.forEach(d,(function(i){s(e,t,a,o,r,l,i);var n=e.node(i),d=n.borderTop?n.borderTop:i,m=n.borderBottom?n.borderBottom:i,b=n.borderTop?o:2*o,f=d!==m?1:r-l[c]+1;e.setEdge(u,d,{weight:b,minlen:f,nestingEdge:!0}),e.setEdge(m,p,{weight:b,minlen:f,nestingEdge:!0})})),e.parent(c)||e.setEdge(t,u,{weight:0,minlen:r+l[c]})}else c!==t&&e.setEdge(t,c,{weight:0,minlen:a})}e.exports={run:function(e){var t=n.addDummyNode(e,"root",{},"_root"),a=function(e){var t={};function a(n,s){var o=e.children(n);o&&o.length&&i.forEach(o,(function(e){a(e,s+1)})),t[n]=s}return i.forEach(e.children(),(function(e){a(e,1)})),t}(e),o=i.max(i.values(a))-1,r=2*o+1;e.graph().nestingRoot=t,i.forEach(e.edges(),(function(t){e.edge(t).minlen*=r}));var l=function(e){return i.reduce(e.edges(),(function(t,a){return t+e.edge(a).weight}),0)}(e)+1;i.forEach(e.children(),(function(i){s(e,t,r,l,o,a,i)})),e.graph().nodeRankFactor=r},cleanup:function(e){var t=e.graph();e.removeNode(t.nestingRoot),delete t.nestingRoot,i.forEach(e.edges(),(function(t){e.edge(t).nestingEdge&&e.removeEdge(t)}))}}},function(e,t,a){var i=a(98),n=a(117);function s(e,t,a,i,s,o){var r={width:0,height:0,rank:o,borderType:t},l=s[t][o-1],c=n.addDummyNode(e,"border",r,a);s[t][o]=c,e.setParent(c,i),l&&e.setEdge(l,c,{weight:1})}e.exports=function(e){i.forEach(e.children(),(function t(a){var n=e.children(a),o=e.node(a);if(n.length&&i.forEach(n,t),i.has(o,"minRank")){o.borderLeft=[],o.borderRight=[];for(var r=o.minRank,l=o.maxRank+1;r<l;++r)s(e,"borderLeft","_bl",a,o,r),s(e,"borderRight","_br",a,o,r)}}))}},function(e,t,a){"use strict";var i=a(98);function n(e){i.forEach(e.nodes(),(function(t){s(e.node(t))})),i.forEach(e.edges(),(function(t){s(e.edge(t))}))}function s(e){var t=e.width;e.width=e.height,e.height=t}function o(e){e.y=-e.y}function r(e){var t=e.x;e.x=e.y,e.y=t}e.exports={adjust:function(e){var t=e.graph().rankdir.toLowerCase();"lr"!==t&&"rl"!==t||n(e)},undo:function(e){var t=e.graph().rankdir.toLowerCase();"bt"!==t&&"rl"!==t||function(e){i.forEach(e.nodes(),(function(t){o(e.node(t))})),i.forEach(e.edges(),(function(t){var a=e.edge(t);i.forEach(a.points,o),i.has(a,"y")&&o(a)}))}(e),"lr"!==t&&"rl"!==t||(function(e){i.forEach(e.nodes(),(function(t){r(e.node(t))})),i.forEach(e.edges(),(function(t){var a=e.edge(t);i.forEach(a.points,r),i.has(a,"x")&&r(a)}))}(e),n(e))}}},function(e,t,a){"use strict";var i=a(98),n=a(531),s=a(532),o=a(533),r=a(537),l=a(538),c=a(128).Graph,d=a(117);function u(e,t,a){return i.map(t,(function(t){return r(e,t,a)}))}function p(e,t){var a=new c;i.forEach(e,(function(e){var n=e.graph().root,s=o(e,n,a,t);i.forEach(s.vs,(function(t,a){e.node(t).order=a})),l(e,a,s.vs)}))}function m(e,t){i.forEach(t,(function(t){i.forEach(t,(function(t,a){e.node(t).order=a}))}))}e.exports=function(e){var t=d.maxRank(e),a=u(e,i.range(1,t+1),"inEdges"),o=u(e,i.range(t-1,-1,-1),"outEdges"),r=n(e);m(e,r);for(var l,c=Number.POSITIVE_INFINITY,b=0,f=0;f<4;++b,++f){p(b%2?a:o,b%4>=2),r=d.buildLayerMatrix(e);var h=s(e,r);h<c&&(f=0,l=i.cloneDeep(r),c=h)}m(e,l)}},function(e,t,a){"use strict";var i=a(98);e.exports=function(e){var t={},a=i.filter(e.nodes(),(function(t){return!e.children(t).length})),n=i.max(i.map(a,(function(t){return e.node(t).rank}))),s=i.map(i.range(n+1),(function(){return[]})),o=i.sortBy(a,(function(t){return e.node(t).rank}));return i.forEach(o,(function a(n){if(!i.has(t,n)){t[n]=!0;var o=e.node(n);s[o.rank].push(n),i.forEach(e.successors(n),a)}})),s}},function(e,t,a){"use strict";var i=a(98);function n(e,t,a){for(var n=i.zipObject(a,i.map(a,(function(e,t){return t}))),s=i.flatten(i.map(t,(function(t){return i.sortBy(i.map(e.outEdges(t),(function(t){return{pos:n[t.w],weight:e.edge(t).weight}})),"pos")})),!0),o=1;o<a.length;)o<<=1;var r=2*o-1;o-=1;var l=i.map(new Array(r),(function(){return 0})),c=0;return i.forEach(s.forEach((function(e){var t=e.pos+o;l[t]+=e.weight;for(var a=0;t>0;)t%2&&(a+=l[t+1]),l[t=t-1>>1]+=e.weight;c+=e.weight*a}))),c}e.exports=function(e,t){for(var a=0,i=1;i<t.length;++i)a+=n(e,t[i-1],t[i]);return a}},function(e,t,a){var i=a(98),n=a(534),s=a(535),o=a(536);e.exports=function e(t,a,r,l){var c=t.children(a),d=t.node(a),u=d?d.borderLeft:void 0,p=d?d.borderRight:void 0,m={};u&&(c=i.filter(c,(function(e){return e!==u&&e!==p})));var b=n(t,c);i.forEach(b,(function(a){if(t.children(a.v).length){var n=e(t,a.v,r,l);m[a.v]=n,i.has(n,"barycenter")&&(s=a,o=n,i.isUndefined(s.barycenter)?(s.barycenter=o.barycenter,s.weight=o.weight):(s.barycenter=(s.barycenter*s.weight+o.barycenter*o.weight)/(s.weight+o.weight),s.weight+=o.weight))}var s,o}));var f=s(b,r);!function(e,t){i.forEach(e,(function(e){e.vs=i.flatten(e.vs.map((function(e){return t[e]?t[e].vs:e})),!0)}))}(f,m);var h=o(f,l);if(u&&(h.vs=i.flatten([u,h.vs,p],!0),t.predecessors(u).length)){var g=t.node(t.predecessors(u)[0]),j=t.node(t.predecessors(p)[0]);i.has(h,"barycenter")||(h.barycenter=0,h.weight=0),h.barycenter=(h.barycenter*h.weight+g.order+j.order)/(h.weight+2),h.weight+=2}return h}},function(e,t,a){var i=a(98);e.exports=function(e,t){return i.map(t,(function(t){var a=e.inEdges(t);if(a.length){var n=i.reduce(a,(function(t,a){var i=e.edge(a),n=e.node(a.v);return{sum:t.sum+i.weight*n.order,weight:t.weight+i.weight}}),{sum:0,weight:0});return{v:t,barycenter:n.sum/n.weight,weight:n.weight}}return{v:t}}))}},function(e,t,a){"use strict";var i=a(98);e.exports=function(e,t){var a={};return i.forEach(e,(function(e,t){var n=a[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:t};i.isUndefined(e.barycenter)||(n.barycenter=e.barycenter,n.weight=e.weight)})),i.forEach(t.edges(),(function(e){var t=a[e.v],n=a[e.w];i.isUndefined(t)||i.isUndefined(n)||(n.indegree++,t.out.push(a[e.w]))})),function(e){var t=[];function a(e){return function(t){var a,n,s,o;t.merged||(i.isUndefined(t.barycenter)||i.isUndefined(e.barycenter)||t.barycenter>=e.barycenter)&&(n=t,s=0,o=0,(a=e).weight&&(s+=a.barycenter*a.weight,o+=a.weight),n.weight&&(s+=n.barycenter*n.weight,o+=n.weight),a.vs=n.vs.concat(a.vs),a.barycenter=s/o,a.weight=o,a.i=Math.min(n.i,a.i),n.merged=!0)}}function n(t){return function(a){a.in.push(t),0==--a.indegree&&e.push(a)}}for(;e.length;){var s=e.pop();t.push(s),i.forEach(s.in.reverse(),a(s)),i.forEach(s.out,n(s))}return i.map(i.filter(t,(function(e){return!e.merged})),(function(e){return i.pick(e,["vs","i","barycenter","weight"])}))}(i.filter(a,(function(e){return!e.indegree})))}},function(e,t,a){var i=a(98),n=a(117);function s(e,t,a){for(var n;t.length&&(n=i.last(t)).i<=a;)t.pop(),e.push(n.vs),a++;return a}e.exports=function(e,t){var a,o=n.partition(e,(function(e){return i.has(e,"barycenter")})),r=o.lhs,l=i.sortBy(o.rhs,(function(e){return-e.i})),c=[],d=0,u=0,p=0;r.sort((a=!!t,function(e,t){return e.barycenter<t.barycenter?-1:e.barycenter>t.barycenter?1:a?t.i-e.i:e.i-t.i})),p=s(c,l,p),i.forEach(r,(function(e){p+=e.vs.length,c.push(e.vs),d+=e.barycenter*e.weight,u+=e.weight,p=s(c,l,p)}));var m={vs:i.flatten(c,!0)};return u&&(m.barycenter=d/u,m.weight=u),m}},function(e,t,a){var i=a(98),n=a(128).Graph;e.exports=function(e,t,a){var s=function(e){for(var t;e.hasNode(t=i.uniqueId("_root")););return t}(e),o=new n({compound:!0}).setGraph({root:s}).setDefaultNodeLabel((function(t){return e.node(t)}));return i.forEach(e.nodes(),(function(n){var r=e.node(n),l=e.parent(n);(r.rank===t||r.minRank<=t&&t<=r.maxRank)&&(o.setNode(n),o.setParent(n,l||s),i.forEach(e[a](n),(function(t){var a=t.v===n?t.w:t.v,s=o.edge(a,n),r=i.isUndefined(s)?0:s.weight;o.setEdge(a,n,{weight:e.edge(t).weight+r})})),i.has(r,"minRank")&&o.setNode(n,{borderLeft:r.borderLeft[t],borderRight:r.borderRight[t]}))})),o}},function(e,t,a){var i=a(98);e.exports=function(e,t,a){var n,s={};i.forEach(a,(function(a){for(var i,o,r=e.parent(a);r;){if((i=e.parent(r))?(o=s[i],s[i]=r):(o=n,n=r),o&&o!==r)return void t.setEdge(o,r);r=i}}))}},function(e,t,a){"use strict";var i=a(98),n=a(117),s=a(540).positionX;e.exports=function(e){(function(e){var t=n.buildLayerMatrix(e),a=e.graph().ranksep,s=0;i.forEach(t,(function(t){var n=i.max(i.map(t,(function(t){return e.node(t).height})));i.forEach(t,(function(t){e.node(t).y=s+n/2})),s+=n+a}))})(e=n.asNonCompoundGraph(e)),i.forEach(s(e),(function(t,a){e.node(a).x=t}))}},function(e,t,a){"use strict";var i=a(98),n=a(128).Graph,s=a(117);function o(e,t){var a={};return i.reduce(t,(function(t,n){var s=0,o=0,r=t.length,c=i.last(n);return i.forEach(n,(function(t,d){var u=function(e,t){if(e.node(t).dummy)return i.find(e.predecessors(t),(function(t){return e.node(t).dummy}))}(e,t),p=u?e.node(u).order:r;(u||t===c)&&(i.forEach(n.slice(o,d+1),(function(t){i.forEach(e.predecessors(t),(function(i){var n=e.node(i),o=n.order;!(o<s||p<o)||n.dummy&&e.node(t).dummy||l(a,i,t)}))})),o=d+1,s=p)})),n})),a}function r(e,t){var a={};function n(t,n,s,o,r){var c;i.forEach(i.range(n,s),(function(n){c=t[n],e.node(c).dummy&&i.forEach(e.predecessors(c),(function(t){var i=e.node(t);i.dummy&&(i.order<o||i.order>r)&&l(a,t,c)}))}))}return i.reduce(t,(function(t,a){var s,o=-1,r=0;return i.forEach(a,(function(i,l){if("border"===e.node(i).dummy){var c=e.predecessors(i);c.length&&(s=e.node(c[0]).order,n(a,r,l,o,s),r=l,o=s)}n(a,r,a.length,s,t.length)})),a})),a}function l(e,t,a){if(t>a){var i=t;t=a,a=i}var n=e[t];n||(e[t]=n={}),n[a]=!0}function c(e,t,a){if(t>a){var n=t;t=a,a=n}return i.has(e[t],a)}function d(e,t,a,n){var s={},o={},r={};return i.forEach(t,(function(e){i.forEach(e,(function(e,t){s[e]=e,o[e]=e,r[e]=t}))})),i.forEach(t,(function(e){var t=-1;i.forEach(e,(function(e){var l=n(e);if(l.length){l=i.sortBy(l,(function(e){return r[e]}));for(var d=(l.length-1)/2,u=Math.floor(d),p=Math.ceil(d);u<=p;++u){var m=l[u];o[e]===e&&t<r[m]&&!c(a,e,m)&&(o[m]=e,o[e]=s[e]=s[m],t=r[m])}}}))})),{root:s,align:o}}function u(e,t,a,s,o){var r={},l=function(e,t,a,s){var o=new n,r=e.graph(),l=function(e,t,a){return function(n,s,o){var r,l=n.node(s),c=n.node(o),d=0;if(d+=l.width/2,i.has(l,"labelpos"))switch(l.labelpos.toLowerCase()){case"l":r=-l.width/2;break;case"r":r=l.width/2}if(r&&(d+=a?r:-r),r=0,d+=(l.dummy?t:e)/2,d+=(c.dummy?t:e)/2,d+=c.width/2,i.has(c,"labelpos"))switch(c.labelpos.toLowerCase()){case"l":r=c.width/2;break;case"r":r=-c.width/2}return r&&(d+=a?r:-r),r=0,d}}(r.nodesep,r.edgesep,s);return i.forEach(t,(function(t){var n;i.forEach(t,(function(t){var i=a[t];if(o.setNode(i),n){var s=a[n],r=o.edge(s,i);o.setEdge(s,i,Math.max(l(e,t,n),r||0))}n=t}))})),o}(e,t,a,o),c=o?"borderLeft":"borderRight";function d(e,t){for(var a=l.nodes(),i=a.pop(),n={};i;)n[i]?e(i):(n[i]=!0,a.push(i),a=a.concat(t(i))),i=a.pop()}return d((function(e){r[e]=l.inEdges(e).reduce((function(e,t){return Math.max(e,r[t.v]+l.edge(t))}),0)}),l.predecessors.bind(l)),d((function(t){var a=l.outEdges(t).reduce((function(e,t){return Math.min(e,r[t.w]-l.edge(t))}),Number.POSITIVE_INFINITY),i=e.node(t);a!==Number.POSITIVE_INFINITY&&i.borderType!==c&&(r[t]=Math.max(r[t],a))}),l.successors.bind(l)),i.forEach(s,(function(e){r[e]=r[a[e]]})),r}function p(e,t){return i.minBy(i.values(t),(function(t){var a=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;return i.forIn(t,(function(t,i){var s=function(e,t){return e.node(t).width}(e,i)/2;a=Math.max(t+s,a),n=Math.min(t-s,n)})),a-n}))}function m(e,t){var a=i.values(t),n=i.min(a),s=i.max(a);i.forEach(["u","d"],(function(a){i.forEach(["l","r"],(function(o){var r,l=a+o,c=e[l];if(c!==t){var d=i.values(c);(r="l"===o?n-i.min(d):s-i.max(d))&&(e[l]=i.mapValues(c,(function(e){return e+r})))}}))}))}function b(e,t){return i.mapValues(e.ul,(function(a,n){if(t)return e[t.toLowerCase()][n];var s=i.sortBy(i.map(e,n));return(s[1]+s[2])/2}))}e.exports={positionX:function(e){var t,a=s.buildLayerMatrix(e),n=i.merge(o(e,a),r(e,a)),l={};i.forEach(["u","d"],(function(s){t="u"===s?a:i.values(a).reverse(),i.forEach(["l","r"],(function(a){"r"===a&&(t=i.map(t,(function(e){return i.values(e).reverse()})));var o=("u"===s?e.predecessors:e.successors).bind(e),r=d(0,t,n,o),c=u(e,t,r.root,r.align,"r"===a);"r"===a&&(c=i.mapValues(c,(function(e){return-e}))),l[s+a]=c}))}));var c=p(e,l);return m(l,c),b(l,e.graph().align)},findType1Conflicts:o,findType2Conflicts:r,addConflict:l,hasConflict:c,verticalAlignment:d,horizontalCompaction:u,alignCoordinates:m,findSmallestWidthAlignment:p,balance:b}},function(e,t,a){var i=a(98),n=a(117),s=a(128).Graph;e.exports={debugOrdering:function(e){var t=n.buildLayerMatrix(e),a=new s({compound:!0,multigraph:!0}).setGraph({});return i.forEach(e.nodes(),(function(t){a.setNode(t,{label:t}),a.setParent(t,"layer"+e.node(t).rank)})),i.forEach(e.edges(),(function(e){a.setEdge(e.v,e.w,{},e.name)})),i.forEach(t,(function(e,t){var n="layer"+t;a.setNode(n,{rank:"same"}),i.reduce(e,(function(e,t){return a.setEdge(e,t,{style:"invis"}),t}))})),a}}},function(e,t){e.exports="0.8.5"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiBmaWxsPSIjMzQzNzQxIj4KICA8cGF0aCBkPSJNNi45OTk4NSAxNnY1LjAwMDJIOS4wMzc5QzkuMDEyOCAyMS4zMzAxIDkgMjEuNjYzNiA5IDIyYzAgLjMzNjQuMDEyOC42Njk5LjAzNzkuOTk5OEg2Ljk5OTg1VjI4aC0xLjk5OTd2LTUuMDAwMkgwdi0xLjk5OTZoNS4wMDAxNVYxNmgxLjk5OTd6bTAtMTZ2NS4wMDAxNUgxMnYxLjk5OTdINi45OTk4NVYxMmgtMS45OTk3VjYuOTk5ODVIMHYtMS45OTk3aDUuMDAwMTVWMGgxLjk5OTd6TTIyLjk5OTggMHY1LjAwMDE1SDI4djEuOTk5N2gtNS4wMDAyVjkuMDM3OUMyMi42Njk5IDkuMDEyOCAyMi4zMzY0IDkgMjIgOWMtLjMzNjQgMC0uNjY5OS4wMTI4LS45OTk4LjAzNzlWNi45OTk4NUgxNnYtMS45OTk3aDUuMDAwMlYwaDEuOTk5NnoiIC8+CiAgICA8cGF0aAogICAgICBmaWxsPSIjMDE3RDczIgogICAgICBkPSJNMjIgMTBjMy4wNzM0IDAgNS44NzcgMS4xNTU0IDggMy4wNTU2djMuMjUyNWMtLjMxNS0uNDQyNy0uNjY4Mi0uODYxMy0xLjA1NzUtMS4yNTA2LTEuODQxMy0xLjg0MTMtNC4zMzg2LTIuODc1Ny02Ljk0MjUtMi44NzU3LTUuNDIyNCAwLTkuODE4MiA0LjM5NTgtOS44MTgyIDkuODE4MiAwIDMuMzAwMSAxLjYyODIgNi4yMTk5IDQuMTI1MSA4aC0zLjI1MTNDMTEuMTU1NCAyNy44NzcgMTAgMjUuMDczNCAxMCAyMmMwLTYuNjI3NCA1LjM3MjYtMTIgMTItMTJ6bS45OTk4IDh2My4wMDAySDI2djEuOTk5NmgtMy4wMDAyVjI2aC0xLjk5OTZ2LTMuMDAwMkgxOHYtMS45OTk2aDMuMDAwMlYxOGgxLjk5OTZ6IgogICAgLz4KPC9zdmc+Cg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiBmaWxsPSIjMzQzNzQxIj4KICAgIDxwYXRoIGQ9Ik0yIDEydjZoNnYySDB2LThoMnptMTggMHY4aC04di0yaDZ2LTZoMnpNOCAwdjJIMnY2SDBWMGg4em0xMiAwdjhoLTJWMmgtNlYwaDh6IiAvPgogICAgPHBhdGgKICAgICAgZmlsbD0iIzAxN0Q3MyIKICAgICAgZD0iTTE2IDI0YzIuMjA5MSAwIDQgMS43OTA5IDQgNCAwIDIuMjA5MS0xLjc5MDkgNC00IDQtMi4yMDkxIDAtNC0xLjc5MDktNC00IDAtMi4yMDkxIDEuNzkwOS00IDQtNHptMTIgMGMyLjIwOTEgMCA0IDEuNzkwOSA0IDQgMCAyLjIwOTEtMS43OTA5IDQtNCA0LTIuMjA5MSAwLTQtMS43OTA5LTQtNCAwLTIuMjA5MSAxLjc5MDktNCA0LTR6bS0xMiAxLjc1Yy0xLjI0MjYgMC0yLjI1IDEuMDA3NC0yLjI1IDIuMjVzMS4wMDc0IDIuMjUgMi4yNSAyLjI1IDIuMjUtMS4wMDc0IDIuMjUtMi4yNS0xLjAwNzQtMi4yNS0yLjI1LTIuMjV6bTEyIDBjLTEuMjQyNiAwLTIuMjUgMS4wMDc0LTIuMjUgMi4yNXMxLjAwNzQgMi4yNSAyLjI1IDIuMjUgMi4yNS0xLjAwNzQgMi4yNS0yLjI1LTEuMDA3NC0yLjI1LTIuMjUtMi4yNXpNMjggMTJjMi4yMDkxIDAgNCAxLjc5MDkgNCA0IDAgMi4yMDkxLTEuNzkwOSA0LTQgNC0yLjIwOTEgMC00LTEuNzkwOS00LTQgMC0yLjIwOTEgMS43OTA5LTQgNC00em0wIDEuNzVjLTEuMjQyNiAwLTIuMjUgMS4wMDc0LTIuMjUgMi4yNXMxLjAwNzQgMi4yNSAyLjI1IDIuMjUgMi4yNS0xLjAwNzQgMi4yNS0yLjI1LTEuMDA3NC0yLjI1LTIuMjUtMi4yNXpNMTAgNmMyLjIwOTEgMCA0IDEuNzkwODYgNCA0IDAgMi4yMDkxLTEuNzkwOSA0LTQgNC0yLjIwOTE0IDAtNC0xLjc5MDktNC00IDAtMi4yMDkxNCAxLjc5MDg2LTQgNC00em0wIDEuNzVjLTEuMjQyNjQgMC0yLjI1IDEuMDA3MzYtMi4yNSAyLjI1IDAgMS4yNDI2IDEuMDA3MzYgMi4yNSAyLjI1IDIuMjUgMS4yNDI2IDAgMi4yNS0xLjAwNzQgMi4yNS0yLjI1IDAtMS4yNDI2NC0xLjAwNzQtMi4yNS0yLjI1LTIuMjV6IgogICAgLz4KPC9zdmc+Cg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiBmaWxsPSIjMzQzNzQxIj4KICA8cGF0aCBkPSJNMjQgMGM0LjQxODMgMCA4IDMuNTgxNzIgOCA4IDAgMi4xMjE3LS44NDI5IDQuMTU2Ni0yLjM0MzEgNS42NTY5QzI4LjE1NjYgMTUuMTU3MSAyNi4xMjE3IDE2IDI0IDE2Yy0xLjg0ODcgMC0zLjU1MDktLjYyNzEtNC45MDU2LTEuNjgwMWwtNC43NzQ1IDQuNzc0NUMxNS4zNzI5IDIwLjQ0OTEgMTYgMjIuMTUxMyAxNiAyNGMwIDIuMTIxNy0uODQyOSA0LjE1NjYtMi4zNDMxIDUuNjU2OUMxMi4xNTY2IDMxLjE1NzEgMTAuMTIxNyAzMiA4IDMyYy00LjQxODI4IDAtOC0zLjU4MTctOC04czMuNTgxNzItOCA4LThjMS44NDg3MiAwIDMuNTUxLjYyNzEgNC45MDU3IDEuNjgwMmw0Ljc3NDUtNC43NzQ1QzE2LjYyNzEgMTEuNTUxIDE2IDkuODQ4NzIgMTYgOGMwLTQuNDE4MjggMy41ODE3LTggOC04ek04IDE4Yy0zLjMxMzcxIDAtNiAyLjY4NjMtNiA2czIuNjg2MjkgNiA2IDZjMy4zMTM3IDAgNi0yLjY4NjMgNi02IDAtMS41OTEzLS42MzIxLTMuMTE3NC0xLjc1NzQtNC4yNDI2QzExLjExNzQgMTguNjMyMSA5LjU5MTMgMTggOCAxOHpNMjQgMmMtMy4zMTM3IDAtNiAyLjY4NjI5LTYgNiAwIDMuMzEzNyAyLjY4NjMgNiA2IDZzNi0yLjY4NjMgNi02YzAtMS41OTEzLS42MzIxLTMuMTE3NDItMS43NTc0LTQuMjQyNjRDMjcuMTE3NCAyLjYzMjE0IDI1LjU5MTMgMiAyNCAyeiIvPgogIDxwYXRoIGZpbGw9IiMwMTdENzMiICBkPSJNMzIgMjB2MTJIMjBWMjBoMTJ6bS0yIDJoLTh2OGg4di04ek0xMiAwdjEySDBWMGgxMnptLTIgMkgydjhoOFYyeiIvPgo8L3N2Zz4K"},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(54),n=a(17),s=i.__importDefault(a(547)),o=a(549);t.default=function(e,t){void 0===e&&(e=1/0),void 0===t&&(t=1/0);var a=s.default({width:o.isClient?window.innerWidth:e,height:o.isClient?window.innerHeight:t}),i=a[0],r=a[1];return n.useEffect((function(){if(o.isClient){var e=function(){r({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}}),[]),i}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(54),n=a(17),s=i.__importDefault(a(548));t.default=function(e){var t=n.useRef(0),a=n.useState(e),i=a[0],o=a[1],r=n.useCallback((function(e){cancelAnimationFrame(t.current),t.current=requestAnimationFrame((function(){o(e)}))}),[]);return s.default((function(){cancelAnimationFrame(t.current)})),[i,r]}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(54),n=a(17),s=i.__importDefault(a(204));t.default=function(e){var t=n.useRef(e);t.current=e,s.default((function(){return function(){return t.current()}}))}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDeepEqual=t.off=t.on=t.isClient=void 0;var i=a(54).__importDefault(a(550));t.isClient="object"==typeof window,t.on=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.addEventListener.apply(e,t)},t.off=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.removeEventListener.apply(e,t)},t.isDeepEqual=i.default},function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var i,n,s;if(Array.isArray(t)){if((i=t.length)!=a.length)return!1;for(n=i;0!=n--;)if(!e(t[n],a[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((i=(s=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(n=i;0!=n--;)if(!Object.prototype.hasOwnProperty.call(a,s[n]))return!1;for(n=i;0!=n--;){var o=s[n];if(!("_owner"===o&&t.$$typeof||e(t[o],a[o])))return!1}return!0}return t!=t&&a!=a}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(552);case"v8light":return a(554)}},function(e,t,a){var i=a(86),n=a(553);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlScatterplotMatrix{overflow-x:auto}.mlScatterplotMatrix .vega-bind span{font-size:12px;padding:0 4px}",""]),e.exports=t},function(e,t,a){var i=a(86),n=a(555);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlScatterplotMatrix{overflow-x:auto}.mlScatterplotMatrix .vega-bind span{font-size:12px;padding:0 4px}",""]),e.exports=t},function(e,t,a){var i=a(86),n=a(557);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlExpandableSection{padding:0 8px 8px}.mlExpandableSection-contentPadding{padding:8px}[id^=echTooltipPortal]{z-index:9000!important}",""]),e.exports=t},function(e,t,a){var i=a(86),n=a(559);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlExpandableSection{padding:0 8px 8px}.mlExpandableSection-contentPadding{padding:8px}[id^=echTooltipPortal]{z-index:9000!important}",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(17),n=a(561);t.default=function(e,t){var a=n.useFirstMountState();i.useEffect((function(){if(!a)return e()}),t)}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useFirstMountState=void 0;var i=a(17);t.useFirstMountState=function(){var e=i.useRef(!0);return e.current?(e.current=!1,!0):e.current}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(563);case"v8light":return a(565)}},function(e,t,a){var i=a(86),n=a(564);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,'.mlDataFrameAnalyticsClassification{width:100%}.mlDataFrameAnalyticsClassification__evaluateSectionContent{padding:0 5%}.mlDataFrameAnalyticsClassification__evaluateSectionContent:after{clear:both;content:"";display:table}.mlDataFrameAnalyticsClassification__actualLabel{float:left;padding-top:64px;width:80px}.mlDataFrameAnalyticsClassification__dataGridMinWidth{float:left;min-width:480px;width:calc(100% - 80px)}.mlDataFrameAnalyticsClassification__dataGridMinWidth .euiDataGridRowCell--boolean{text-transform:none}.mlDataFrameAnalyticsClassification__evaluationMetrics{width:60%}',""]),e.exports=t},function(e,t,a){var i=a(86),n=a(566);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,'.mlDataFrameAnalyticsClassification{width:100%}.mlDataFrameAnalyticsClassification__evaluateSectionContent{padding:0 5%}.mlDataFrameAnalyticsClassification__evaluateSectionContent:after{clear:both;content:"";display:table}.mlDataFrameAnalyticsClassification__actualLabel{float:left;padding-top:64px;width:80px}.mlDataFrameAnalyticsClassification__dataGridMinWidth{float:left;min-width:480px;width:calc(100% - 80px)}.mlDataFrameAnalyticsClassification__dataGridMinWidth .euiDataGridRowCell--boolean{text-transform:none}.mlDataFrameAnalyticsClassification__evaluationMetrics{width:60%}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(568);case"v8light":return a(570)}},function(e,t,a){var i=a(86),n=a(569);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,'.mlHelpPopover__panel{max-width:480px}.mlHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:8px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.mlHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.mlHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.mlHelpPopover__content::-webkit-scrollbar-corner,.mlHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.mlHelpPopover__content:focus{outline:none}.mlHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},function(e,t,a){var i=a(86),n=a(571);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,'.mlHelpPopover__panel{max-width:480px}.mlHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:8px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.mlHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.mlHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.mlHelpPopover__content::-webkit-scrollbar-corner,.mlHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.mlHelpPopover__content:focus{outline:none}.mlHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(579);case"v8light":return a(581)}},function(e,t,a){var i=a(86),n=a(580);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlJobSelectorFlyoutBody>.euiFlyoutBody__overflow{padding-top:8px}.mlJobSelector__ganttBar{background-color:#79adda;border-radius:2px;height:12px}.mlJobSelector__ganttBarBackEdge{border-left:1px solid #d6d6d6;border-right:1px solid #d6d6d6;height:16px;margin-bottom:-14px;padding-top:8px}.mlJobSelector__ganttBarDashed{border-top:1px dashed #d6d6d6;height:1px}.mlJobSelector__ganttBarRunning{animation:progress-bar-stripes 2s linear infinite;background-image:linear-gradient(45deg,#ffffff26 25%,#0000 0,#0000 50%,#ffffff26 0,#ffffff26 75%,#0000 0,#0000);background-size:40px 40px}",""]),e.exports=t},function(e,t,a){var i=a(86),n=a(582);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);i(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},function(e,t,a){(t=a(87)(!1)).push([e.i,".mlJobSelectorFlyoutBody>.euiFlyoutBody__overflow{padding-top:8px}.mlJobSelector__ganttBar{background-color:#79adda;border-radius:2px;height:12px}.mlJobSelector__ganttBarBackEdge{border-left:1px solid #d6d6d6;border-right:1px solid #d6d6d6;height:16px;margin-bottom:-14px;padding-top:8px}.mlJobSelector__ganttBarDashed{border-top:1px dashed #d6d6d6;height:1px}.mlJobSelector__ganttBarRunning{animation:progress-bar-stripes 2s linear infinite;background-image:linear-gradient(45deg,#ffffff26 25%,#0000 0,#0000 50%,#ffffff26 0,#ffffff26 75%,#0000 0,#0000);background-size:40px 40px}",""]),e.exports=t},,,,,,,,,,,,,,,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(17);t.default=function(e){var t=i.useRef();return i.useEffect((function(){t.current=e})),t.current}}])]);