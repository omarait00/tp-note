/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[27],{643:function(e,t,a){"use strict";a.r(t),a.d(t,"OverviewPage",(function(){return $}));var s=a(17),i=a.n(s),n=a(44),o=a(45),l=a(84),c=a(133),r=a(80),u=a(158),d=a(152),b=a(13);const m=()=>{const{services:{docLinks:e}}=Object(r.b)(),t=e.links.ml.guide,[a,s]=Object(u.b)(d.e,!1);return a?null:Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(n.EuiCallOut,{"data-test-subj":"mlGettingStartedCallout",title:Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionTitle",defaultMessage:"Getting started"}),iconType:"iInCircle"},Object(b.jsx)("p",null,Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionText",defaultMessage:"Welcome to Machine Learning. Get started by reviewing our {docs} or creating a new job.",values:{docs:Object(b.jsx)(n.EuiLink,{href:t,target:"blank"},Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionDocs",defaultMessage:"documentation"}))}})),Object(b.jsx)("p",null,Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.feedbackSectionText",defaultMessage:"If you have input or suggestions regarding your experience, please submit {feedbackLink}.",values:{feedbackLink:Object(b.jsx)(n.EuiLink,{href:"https://www.elastic.co/community/",target:"blank"},Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.feedbackSectionLink",defaultMessage:"feedback online"}))}})),Object(b.jsx)("p",null,Object(b.jsx)(n.EuiButton,{color:"primary",onClick:s.bind(null,!0),"data-test-subj":"mlDismissGettingStartedCallout"},Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionDismiss",defaultMessage:"Dismiss"})))),Object(b.jsx)(n.EuiSpacer,{size:"m"}))};var j=a(2),g=a(8),p=a(95),v=a(0);function O(){const e=Object(r.d)(),t=Object(r.g)(),a=Object(r.e)();return[{isPrimary:!0,name:j.i18n.translate("xpack.ml.overview.anomalyDetection.viewJobsActionName",{defaultMessage:"View jobs"}),description:j.i18n.translate("xpack.ml.overview.anomalyDetection.resultActions.openInJobManagementText",{defaultMessage:"View jobs"}),icon:"list",type:"icon",onClick:async t=>{const s=await(null==e?void 0:e.getUrl({page:v.b.ANOMALY_DETECTION_JOBS_MANAGE,pageState:{groupIds:[t.id]}}));await a(s)}},{isPrimary:!1,name:j.i18n.translate("xpack.ml.overview.anomalyDetection.viewResultsActionName",{defaultMessage:"View in Anomaly Explorer"}),description:j.i18n.translate("xpack.ml.overview.anomalyDetection.resultActions.openJobsInAnomalyExplorerText",{defaultMessage:"View in Anomaly Explorer"}),icon:"visTable",type:"icon",onClick:async s=>{const i=await(null==e?void 0:e.getUrl({page:v.b.ANOMALY_EXPLORER,pageState:{jobIds:s.jobIds,timeRange:t.getTime()}}));await a(i)}}]}var x=a(168),w=a(212),f=a(106),y=a(184),S=a(192);let h;!function(e){e.id="id",e.maxAnomalyScore="max_anomaly_score",e.overallSwimLane="overallSwimLane",e.jobIds="jobIds",e.latestTimestamp="latest_timestamp",e.docsProcessed="docs_processed",e.jobsInGroup="jobs_in_group"}(h||(h={}));const M=({items:e,statsBarData:t,chartsService:a})=>{const l=Object.values(e),[c,u]=Object(s.useState)(0),[d,m]=Object(s.useState)(10),[g,M]=Object(s.useState)(h.id),[T,A]=Object(s.useState)("asc"),E=Object(S.a)(),k=Object(r.c)({page:v.b.ANOMALY_DETECTION_JOBS_MANAGE}),L=[{field:h.id,name:j.i18n.translate("xpack.ml.overview.anomalyDetection.tableId",{defaultMessage:"Group ID"}),render:e=>Object(b.jsx)(w.a,{id:e,isGroup:"ungrouped"!==e}),sortable:!0,truncateText:!0,width:"15%"},{name:Object(b.jsx)(n.EuiToolTip,{content:j.i18n.translate("xpack.ml.overview.anomalyDetection.tableOverallScoreTooltip",{defaultMessage:"Overall anomaly scores within selected time range"})},Object(b.jsx)("span",null,j.i18n.translate("xpack.ml.overview.anomalyDetection.overallScore",{defaultMessage:"Overall score"}),Object(b.jsx)(n.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:e=>{const t=e.overallSwimLane;return t?t.points.length>0&&t.points.every((e=>0===e.value))?Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.noAnomaliesFoundMessage",defaultMessage:"No anomalies found"}):Object(b.jsx)(y.b,{timeBuckets:E,swimlaneData:e.overallSwimLane,swimlaneType:"overall",onResize:()=>{},isLoading:!1,id:e.id,showTimeline:!1,showYAxis:!1,showLegend:!1,noDataWarning:Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.noResultsFoundMessage",defaultMessage:"No results found"}),chartsService:a}):null},width:"300px"},{field:h.jobsInGroup,name:j.i18n.translate("xpack.ml.overview.anomalyDetection.tableNumJobs",{defaultMessage:"Jobs in group"}),sortable:!0,truncateText:!0,width:"10%"},{field:h.latestTimestamp,name:j.i18n.translate("xpack.ml.overview.anomalyDetection.tableLatestTimestamp",{defaultMessage:"Latest timestamp"}),dataType:"date",render:e=>Object(p.c)(e),textOnly:!0,truncateText:!0,sortable:!0,width:"25%"},{field:h.docsProcessed,name:j.i18n.translate("xpack.ml.overview.anomalyDetection.tableDocsProcessed",{defaultMessage:"Docs processed"}),render:e=>Object(f.h)(e),textOnly:!0,sortable:!0,width:"15%"},{name:j.i18n.translate("xpack.ml.overview.anomalyDetection.tableActionLabel",{defaultMessage:"Actions"}),actions:O(),width:"80px",align:"right"}],_={initialPageIndex:c,initialPageSize:d,totalItemCount:l.length,pageSizeOptions:[10,20,50],showPerPageOptions:!0},D={sort:{field:g,direction:T}};return Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s"},Object(b.jsx)(n.EuiFlexItem,{grow:!1},Object(b.jsx)(n.EuiText,{size:"m"},Object(b.jsx)("h3",null,j.i18n.translate("xpack.ml.overview.anomalyDetection.panelTitle",{defaultMessage:"Anomaly Detection"})))),Object(b.jsx)(n.EuiFlexItem,{grow:!1},Object(b.jsx)(n.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(b.jsx)(n.EuiFlexItem,{grow:!1},Object(b.jsx)(x.a,{stats:t,dataTestSub:"mlOverviewJobStatsBar"})),Object(b.jsx)(n.EuiFlexItem,{grow:!1},Object(b.jsx)(n.EuiButton,{size:"m",fill:!0,href:k},j.i18n.translate("xpack.ml.overview.anomalyDetection.manageJobsButtonText",{defaultMessage:"Manage jobs"})))))),Object(b.jsx)(n.EuiSpacer,null),Object(b.jsx)(n.EuiInMemoryTable,{allowNeutralSort:!1,className:"mlAnomalyDetectionTable",columns:L,hasActions:!0,isExpandable:!1,isSelectable:!1,items:l,itemId:h.id,onTableChange:({page:e={index:0,size:10},sort:t={field:h.id,direction:"asc"}})=>{const{index:a,size:s}=e;u(a),m(s);const{field:i,direction:n}=t;M(i),A(n)},pagination:_,sorting:D,"data-test-subj":"mlOverviewTableAnomalyDetection"}))};var T=a(81),A=a(19),E=a(141),k=a(85),L=a(206),_=a(136),D=a(268);const I=({jobCreationDisabled:e,setLazyJobCount:t})=>{const{services:{uiSettings:a,mlServices:{mlApiServices:i},charts:o}}=Object(r.b)(),{displayErrorToast:l}=Object(k.c)(),c=Object(r.g)(),u=Object(s.useMemo)((()=>new L.AnomalyTimelineService(c,a,Object(_.mlResultsServiceProvider)(i))),[c,a,i]),d=Object(E.a)(),[m,p]=Object(s.useState)(!1),[v,O]=Object(s.useState)({}),[x,w]=Object(s.useState)(0),[f,y]=Object(s.useState)(),[S,h]=Object(s.useState)(),I=async e=>{try{const t=Object.fromEntries(Object.entries(e).filter((([e,t])=>t.jobs.length>0)).map((([e,t])=>[e,u.loadOverallData(t.jobs,300)]))),a=Object(g.zipObject)(Object.keys(t),await Promise.all(Object.values(t))),s={...e};for(const e in s)s.hasOwnProperty(e)&&(s[e].overallSwimLane=a[e]);O(s)}catch(e){l(e,j.i18n.translate("xpack.ml.overview.anomalyDetection.errorWithFetchingSwimLanesData",{defaultMessage:"An error occurred fetching anomaly results"}))}};Object(s.useEffect)((()=>{(async()=>{p(!0);let e=0;try{const a=(await T.ml.jobs.jobsSummary([])).map((t=>(t.latestTimestampSortValue=t.latestTimestampMs||0,t.awaitingNodeAssignment&&e++,t))),{groups:s,count:i}=function(e){const t={ungrouped:{id:"ungrouped",jobs:[],jobIds:[],docs_processed:0,latest_timestamp:0,max_anomaly_score:null,jobs_in_group:0}};e.forEach((e=>{e.groups.length>0?e.groups.forEach((a=>{void 0===t[a]?t[a]={id:a,jobs:[e],jobIds:[e.id],docs_processed:e.processed_record_count,latest_timestamp:e.latestTimestampMs,max_anomaly_score:null,jobs_in_group:1}:(t[a].jobs.push(e),t[a].jobIds.push(e.id),t[a].docs_processed+=e.processed_record_count,t[a].jobs_in_group++,(void 0===t[a].latest_timestamp||e.latestTimestampMs&&e.latestTimestampMs>t[a].latest_timestamp)&&(t[a].latest_timestamp=e.latestTimestampMs))})):(t.ungrouped.jobs.push(e),t.ungrouped.jobIds.push(e.id),t.ungrouped.docs_processed+=e.processed_record_count,t.ungrouped.jobs_in_group++,e.latestTimestampMs&&e.latestTimestampMs>t.ungrouped.latest_timestamp&&(t.ungrouped.latest_timestamp=e.latestTimestampMs))})),0===t.ungrouped.jobIds.length&&delete t.ungrouped;const a=Object.values(t).length;return{groups:t,count:a}}(a),n=function(e){const t={activeNodes:{label:j.i18n.translate("xpack.ml.overviewJobsList.statsBar.activeMLNodesLabel",{defaultMessage:"Active ML nodes"}),value:0,show:!0},total:{label:j.i18n.translate("xpack.ml.overviewJobsList.statsBar.totalJobsLabel",{defaultMessage:"Total jobs"}),value:0,show:!0},open:{label:j.i18n.translate("xpack.ml.overviewJobsList.statsBar.openJobsLabel",{defaultMessage:"Open jobs"}),value:0,show:!0},closed:{label:j.i18n.translate("xpack.ml.overviewJobsList.statsBar.closedJobsLabel",{defaultMessage:"Closed jobs"}),value:0,show:!0},failed:{label:j.i18n.translate("xpack.ml.overviewJobsList.statsBar.failedJobsLabel",{defaultMessage:"Failed jobs"}),value:0,show:!1},activeDatafeeds:{label:j.i18n.translate("xpack.ml.jobsList.statsBar.activeDatafeedsLabel",{defaultMessage:"Active datafeeds"}),value:0,show:!0}};if(void 0===e)return t;const a={};let s=0;return e.forEach((e=>{e.jobState===A.c.OPENED?t.open.value++:e.jobState===A.c.CLOSED?t.closed.value++:e.jobState===A.c.FAILED&&s++,e.hasDatafeed&&e.datafeedState===A.a.STARTED&&t.activeDatafeeds.value++,void 0!==e.nodeName&&(a[e.nodeName]={})})),t.total.value=e.length,s?(t.failed.value=s,t.failed.show=!0):t.failed.show=!1,t.activeNodes.value=Object.keys(a).length,t}(a);p(!1),h(void 0),y(n),w(i),O(s),I(s),t(e)}catch(e){h(void 0!==e.message?e.message:JSON.stringify(e)),p(!1)}})()}),[null==d?void 0:d.timeRange]);const C=Object(b.jsx)(s.Fragment,null,Object(b.jsx)(n.EuiCallOut,{title:j.i18n.translate("xpack.ml.overview.anomalyDetection.errorPromptTitle",{defaultMessage:"An error occurred getting the anomaly detection jobs list."}),color:"danger",iconType:"alert"},Object(b.jsx)("pre",null,S))),N=m?"mlOverviewPanel__isLoading":"mlOverviewPanel";return S||!1!==m||void 0!==S||0!==x?Object(b.jsx)(n.EuiPanel,{className:N,hasShadow:!1,hasBorder:!0},void 0!==S&&C,m&&Object(b.jsx)(n.EuiLoadingSpinner,{className:"mlOverviewPanel__spinner",size:"xl"}),!1===m&&void 0===S&&x>0?Object(b.jsx)(M,{items:v,statsBarData:f,chartsService:o}):null):Object(b.jsx)(D.a,null)};var C=a(83),N=a(115),J=a(210),F=a(197);const P=({item:e})=>{const{disabled:t,tooltipContent:a}=Object(F.a)(e),i=j.i18n.translate("xpack.ml.overview.analytics.resultActions.openJobText",{defaultMessage:"View job results"}),o=!1===t?i:a,l=Object(s.useMemo)((()=>Object(C.m)(e.config.analysis)),[e]),c=Object(r.c)({page:v.b.DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:e.id,analysisType:l}});return Object(b.jsx)(n.EuiToolTip,{position:"top",content:o},Object(b.jsx)(n.EuiButtonIcon,{href:c,size:"xs",iconType:"visTable","aria-label":i,"data-test-subj":"mlOverviewAnalyticsJobViewButton",isDisabled:t}))};function z(){const e=Object(r.d)(),t=Object(r.e)();return[{isPrimary:!1,name:j.i18n.translate("xpack.ml.overview.analytics.viewJobActionName",{defaultMessage:"View job"}),description:j.i18n.translate("xpack.ml.overview.analytics.viewJobActionName",{defaultMessage:"View job"}),type:"icon",icon:"list",onClick:async a=>{const s=await(null==e?void 0:e.getUrl({page:v.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE,pageState:{jobId:a.id}}));await t(s)}},{isPrimary:!1,name:j.i18n.translate("xpack.ml.overview.analytics.viewResultsActionName",{defaultMessage:"View results"}),description:j.i18n.translate("xpack.ml.overview.analytics.resultActions.openJobText",{defaultMessage:"View job results"}),render:e=>Object(b.jsx)(P,{item:e})}]}const B=({items:e})=>{const[t,a]=Object(s.useState)(0),[i,o]=Object(s.useState)(10),[l,c]=Object(s.useState)(N.c.id),[r,u]=Object(s.useState)("asc"),d=[{field:N.c.id,name:j.i18n.translate("xpack.ml.overview.analyticsList.id",{defaultMessage:"ID"}),sortable:!0,truncateText:!1,width:"20%"},{name:j.i18n.translate("xpack.ml.overview.analyticsList.type",{defaultMessage:"Type"}),sortable:e=>Object(C.m)(e.config.analysis),truncateText:!0,render:e=>Object(b.jsx)(n.EuiBadge,{color:"hollow"},Object(C.m)(e.config.analysis)),width:"150px"},{name:j.i18n.translate("xpack.ml.overview.analyticsList.status",{defaultMessage:"Status"}),sortable:e=>e.stats.state,truncateText:!0,render:e=>Object(J.c)(e.stats.state,e.stats.failure_reason),width:"100px"},J.d,{field:N.c.configCreateTime,name:j.i18n.translate("xpack.ml.overview.analyticsList.reatedTimeColumnName",{defaultMessage:"Creation time"}),dataType:"date",render:e=>Object(p.c)(e),textOnly:!0,truncateText:!0,sortable:!0,width:"25%"},{name:j.i18n.translate("xpack.ml.overview.analyticsList.tableActionLabel",{defaultMessage:"Actions"}),actions:z(),width:"80px"}],m={initialPageIndex:t,initialPageSize:i,totalItemCount:e.length,pageSizeOptions:[10,20,50],showPerPageOptions:!0},g={sort:{field:l,direction:r}};return Object(b.jsx)(n.EuiInMemoryTable,{allowNeutralSort:!1,className:"mlAnalyticsTable",columns:d,hasActions:!0,isExpandable:!1,isSelectable:!1,items:e,itemId:N.c.id,onTableChange:({page:e={index:0,size:10},sort:t={field:N.c.id,direction:"asc"}})=>{const{index:s,size:i}=e;a(s),o(i);const{field:n,direction:l}=t;c(n),u(l)},pagination:m,sorting:g,"data-test-subj":"mlOverviewTableAnalytics"})};var R=a(181),G=a(214);const V=({setLazyJobCount:e})=>{const t=Object(E.a)(),[a,o]=Object(s.useState)([]),[l,c]=Object(s.useState)(void 0),[u,d]=Object(s.useState)(),[m,g]=Object(s.useState)(!1),p=Object(r.c)({page:v.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE}),O=Object(R.d)(o,c,d,g,e,!1);Object(s.useEffect)((()=>{O(!0)}),[t]);const w=Object(b.jsx)(n.EuiCallOut,{title:j.i18n.translate("xpack.ml.overview.analyticsList.errorPromptTitle",{defaultMessage:"An error occurred getting the data frame analytics list."}),color:"danger",iconType:"alert"},Object(b.jsx)("pre",null,u&&void 0!==u.message?u.message:JSON.stringify(u))),f=!1===m?"mlOverviewPanel__isLoading":"mlOverviewPanel",y=void 0===u&&!0===m&&0===a.length;return Object(b.jsx)(i.a.Fragment,null,y?Object(b.jsx)(G.a,null):Object(b.jsx)(n.EuiPanel,{className:f,hasShadow:!1,hasBorder:!0},void 0!==u?w:null,!1===m&&Object(b.jsx)(n.EuiLoadingSpinner,{className:"mlOverviewPanel__spinner",size:"xl"}),!0===m&&a.length>0&&Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(b.jsx)(n.EuiFlexItem,{grow:!1},Object(b.jsx)(n.EuiText,{size:"m"},Object(b.jsx)("h3",null,j.i18n.translate("xpack.ml.overview.analyticsList.PanelTitle",{defaultMessage:"Analytics"})))),Object(b.jsx)(n.EuiFlexItem,{grow:!1},Object(b.jsx)(n.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},void 0!==l?Object(b.jsx)(n.EuiFlexItem,{grow:!1},Object(b.jsx)(x.a,{stats:l,dataTestSub:"mlOverviewAnalyticsStatsBar"})):null,Object(b.jsx)(n.EuiFlexItem,{grow:!1},Object(b.jsx)(n.EuiButton,{size:"m",fill:!0,href:p},j.i18n.translate("xpack.ml.overview.analyticsList.manageJobsButtonText",{defaultMessage:"Manage jobs"})))))),Object(b.jsx)(n.EuiSpacer,null),Object(b.jsx)(B,{items:a}))))},Y=({createAnomalyDetectionJobDisabled:e,setAdLazyJobCount:t,setDfaLazyJobCount:a})=>Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(I,{jobCreationDisabled:e,setLazyJobCount:t}),Object(b.jsx)(n.EuiSpacer,{size:"m"}),Object(b.jsx)(V,{setLazyJobCount:a}));var U=a(183),W=a(167),X=a(159),q=a(186),H=a(107),K=a(342),Q=a(170),Z=a(94);const $=()=>{const e=Object(l.e)("canViewMlNodes"),t=!Object(l.e)("canCreateJob")||!Object(c.c)(),{services:{docLinks:a}}=Object(r.b)(),u=a.links.ml.guide,d=Object(r.g)({timeRangeSelector:!0,autoRefreshSelector:!0}),[j,g]=Object(s.useState)(0),[p,v]=Object(s.useState)(0);return Object(b.jsx)("div",null,Object(b.jsx)(Z.a,null,Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.overviewLabel",defaultMessage:"Overview"})),Object(b.jsx)(U.a,null),Object(b.jsx)(W.a,{jobCount:j+p}),Object(b.jsx)(X.a,{onCloseFlyout:()=>{const{from:e,to:t}=d.getTime(),a={start:e,end:t};Q.a.next({lastRefresh:Date.now(),timeRange:a})}}),Object(b.jsx)(q.a,null),Object(b.jsx)(m,null),e?Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(n.EuiPanel,{hasShadow:!1,hasBorder:!0},Object(b.jsx)(K.a,{compactView:!0})),Object(b.jsx)(n.EuiSpacer,{size:"m"})):null,Object(b.jsx)(Y,{createAnomalyDetectionJobDisabled:t,setAdLazyJobCount:g,setDfaLazyJobCount:v}),Object(b.jsx)(H.a,{docLink:u}))};t.default=$}}]);