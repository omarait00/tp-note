/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[5],{265:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(266);case"v8light":return i(268)}},266:function(e,t,i){var s=i(57),a=i(267);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},267:function(e,t,i){(t=i(58)(!1)).push([e.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}",""]),e.exports=t},268:function(e,t,i){var s=i(57),a=i(269);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},269:function(e,t,i){(t=i(58)(!1)).push([e.i,".collapsiblePanel__logo{margin-right:8px;vertical-align:text-bottom}",""]),e.exports=t},270:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(271);case"v8light":return i(273)}},271:function(e,t,i){var s=i(57),a=i(272);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},272:function(e,t,i){(t=i(58)(!1)).push([e.i,".secSpacesPopoverList__buttonText{font-size:12px}",""]),e.exports=t},273:function(e,t,i){var s=i(57),a=i(274);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},274:function(e,t,i){(t=i(58)(!1)).push([e.i,".secSpacesPopoverList__buttonText{font-size:12px}",""]),e.exports=t},275:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(276);case"v8light":return i(278)}},276:function(e,t,i){var s=i(57),a=i(277);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},277:function(e,t,i){(t=i(58)(!1)).push([e.i,".subFeaturePrivilegeExpandedRegion{background-color:#25262e;padding-left:40px;padding-top:8px}",""]),e.exports=t},278:function(e,t,i){var s=i(57),a=i(279);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},279:function(e,t,i){(t=i(58)(!1)).push([e.i,".subFeaturePrivilegeExpandedRegion{background-color:#f5f7fa;padding-left:40px;padding-top:8px}",""]),e.exports=t},280:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(281);case"v8light":return i(283)}},281:function(e,t,i){var s=i(57),a=i(282);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},282:function(e,t,i){(t=i(58)(!1)).push([e.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}",""]),e.exports=t},283:function(e,t,i){var s=i(57),a=i(284);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},284:function(e,t,i){(t=i(58)(!1)).push([e.i,".secPrivilegeFeatureChangeAllLink{margin-left:8px}",""]),e.exports=t},285:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(286);case"v8light":return i(288)}},286:function(e,t,i){var s=i(57),a=i(287);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},287:function(e,t,i){(t=i(58)(!1)).push([e.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#25262e}",""]),e.exports=t},288:function(e,t,i){var s=i(57),a=i(289);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},289:function(e,t,i){(t=i(58)(!1)).push([e.i,".secPrivilegeTable__row--isGlobalSpace{background-color:#f5f7fa}",""]),e.exports=t},298:function(e,t,i){"use strict";i.r(t),i.d(t,"EditRolePage",(function(){return N}));var s=i(12),a=i.n(s),r=i(2),l=i(3),n=i.n(l),o=i(4),c=i(7),u=i(5),d=i(21),p=i(34),g=i(1),h=i.n(g),v=i(50),b=i(25),m=i.n(b);class kibana_privilege_KibanaPrivilege{constructor(e,t=[]){this.id=e,this.actions=t}get name(){return m.a.upperFirst(this.id)}grantsPrivilege(e){return this.checkActions(this.actions,e.actions).hasAllRequested}checkActions(e,t){const i=t.filter((t=>!e.includes(t)));return{missing:i,hasAllRequested:e.length>0&&t.length>0&&0===i.length}}}class primary_feature_privilege_PrimaryFeaturePrivilege extends kibana_privilege_KibanaPrivilege{constructor(e,t,i=[]){super(e,i),this.config=t,this.actions=i}isMinimalFeaturePrivilege(){return this.id.startsWith("minimal_")}getMinimalPrivilegeId(){return this.isMinimalFeaturePrivilege()?this.id:`minimal_${this.id}`}get requireAllSpaces(){var e;return null!==(e=this.config.requireAllSpaces)&&void 0!==e&&e}get disabled(){var e;return null!==(e=this.config.disabled)&&void 0!==e&&e}}class sub_feature_privilege_SubFeaturePrivilege extends kibana_privilege_KibanaPrivilege{constructor(e,t=[]){super(e.id,t),this.subPrivilegeConfig=e,this.actions=t}get name(){return this.subPrivilegeConfig.name}get requireAllSpaces(){var e;return null!==(e=this.subPrivilegeConfig.requireAllSpaces)&&void 0!==e&&e}}class sub_feature_privilege_group_SubFeaturePrivilegeGroup{constructor(e,t={}){this.config=e,this.actionMapping=t}get groupType(){return this.config.groupType}get privileges(){return this.config.privileges.map((e=>new sub_feature_privilege_SubFeaturePrivilege(e,this.actionMapping[e.id]||[])))}}class secured_sub_feature_SecuredSubFeature extends v.SubFeature{constructor(e,t={}){super(e),h()(this,"privileges",void 0),h()(this,"privilegesTooltip",void 0),this.actionMapping=t,this.privilegesTooltip=e.privilegesTooltip||"",this.privileges=[];for(const e of this.privilegeIterator())this.privileges.push(e)}getPrivilegeGroups(){return this.privilegeGroups.map((e=>new sub_feature_privilege_group_SubFeaturePrivilegeGroup(e,this.actionMapping)))}*privilegeIterator({predicate:e=(()=>!0)}={}){for(const t of this.privilegeGroups)yield*t.privileges.map((e=>new sub_feature_privilege_SubFeaturePrivilege(e,this.actionMapping[e.id]))).filter((t=>e(t,this)))}}class secured_feature_SecuredFeature extends v.KibanaFeature{constructor(e,t={}){var i,s;super(e),h()(this,"primaryFeaturePrivileges",void 0),h()(this,"minimalPrimaryFeaturePrivileges",void 0),h()(this,"subFeaturePrivileges",void 0),h()(this,"securedSubFeatures",void 0),this.primaryFeaturePrivileges=Object.entries(this.config.privileges||{}).map((([e,i])=>new primary_feature_privilege_PrimaryFeaturePrivilege(e,i,t[e]))),this.minimalPrimaryFeaturePrivileges=Object.entries(this.config.privileges||{}).map((([e,i])=>new primary_feature_privilege_PrimaryFeaturePrivilege(`minimal_${e}`,i,t[`minimal_${e}`]))),this.securedSubFeatures=null!==(i=null===(s=this.config.subFeatures)||void 0===s?void 0:s.map((e=>new secured_sub_feature_SecuredSubFeature(e,t))))&&void 0!==i?i:[],this.subFeaturePrivileges=this.securedSubFeatures.reduce(((e,t)=>[...e,...t.privilegeIterator()]),[])}getPrivilegesTooltip(){return this.config.privilegesTooltip}getAllPrivileges(){return[...this.primaryFeaturePrivileges,...this.minimalPrimaryFeaturePrivileges,...this.subFeaturePrivileges]}getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:e}={includeMinimalFeaturePrivileges:!1}){return e?[this.primaryFeaturePrivileges,this.minimalPrimaryFeaturePrivileges].flat():[...this.primaryFeaturePrivileges]}getMinimalFeaturePrivileges(){return[...this.minimalPrimaryFeaturePrivileges]}getSubFeaturePrivileges(){return[...this.subFeaturePrivileges]}getSubFeatures(){return[...this.securedSubFeatures]}}function x(e){return!e.spaces||0===e.spaces.length||e.spaces.includes("*")}class privilege_collection_PrivilegeCollection{constructor(e){h()(this,"actions",void 0),this.actions=new Set(e.reduce(((e,t)=>[...e,...t.actions]),[]))}grantsPrivilege(e){return this.checkActions(this.actions,e.actions).hasAllRequested}checkActions(e,t){const i=t.filter((t=>!e.has(t)));return{missing:i,hasAllRequested:e.size>0&&t.length>0&&0===i.length}}}function j(e){return new Map(Object.entries(e).map((e=>function(e){const[t,i]=e;return[t,new kibana_privilege_KibanaPrivilege(t,i)]}(e))))}class kibana_privileges_KibanaPrivileges{constructor(e,t){h()(this,"global",void 0),h()(this,"spaces",void 0),h()(this,"feature",void 0),this.global=j(e.global),this.spaces=j(e.space),this.feature=new Map(t.map((t=>{const i=e.features[t.id];return[t.id,new secured_feature_SecuredFeature(t.toRaw(),i)]})))}getBasePrivileges(e){return x(e)?Array.from(this.global.values()):Array.from(this.spaces.values())}getSecuredFeature(e){return this.feature.get(e)}getSecuredFeatures(){return Array.from(this.feature.values())}createCollectionFromRoleKibanaPrivileges(e){const t=e=>t=>Array.isArray(e)&&e.includes(t.id),i=e.map((e=>[this.getBasePrivileges(e).filter(t(e.base)),Object.entries(e.feature).map((([e,i])=>this.getFeaturePrivileges(e).filter(t(i))))].flat(2))).flat();return new privilege_collection_PrivilegeCollection(i)}getFeaturePrivileges(e){var t,i;return null!==(t=null===(i=this.getSecuredFeature(e))||void 0===i?void 0:i.getAllPrivileges())&&void 0!==t?t:[]}}var f=i(0);class delete_role_button_DeleteRoleButton extends l.Component{constructor(...e){super(...e),h()(this,"state",{showModal:!1}),h()(this,"maybeShowModal",(()=>this.state.showModal?Object(f.jsx)(r.EuiConfirmModal,{title:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deleteRoleTitle",defaultMessage:"Delete Role"}),onCancel:this.closeModal,onConfirm:this.onConfirmDelete,cancelButtonText:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.cancelButtonLabel",defaultMessage:"No, don't delete"}),confirmButtonText:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.confirmButtonLabel",defaultMessage:"Yes, delete role"}),buttonColor:"danger"},Object(f.jsx)("p",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deletingRoleConfirmationText",defaultMessage:"Are you sure you want to delete this role?"})),Object(f.jsx)("p",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deletingRoleWarningText",defaultMessage:"This action cannot be undone!"}))):null)),h()(this,"closeModal",(()=>{this.setState({showModal:!1})})),h()(this,"showModal",(()=>{this.setState({showModal:!0})})),h()(this,"onConfirmDelete",(()=>{this.closeModal(),this.props.onDelete()}))}render(){return this.props.canDelete?Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiButtonEmpty,{color:"danger",onClick:this.showModal},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.deleteRoleButton.deleteRoleButtonLabel",defaultMessage:"Delete role"})),this.maybeShowModal()):null}}i(265);class collapsible_panel_CollapsiblePanel extends l.Component{constructor(e){super(e),h()(this,"state",{collapsed:!1}),h()(this,"getTitle",(()=>Object(f.jsx)(r.EuiFlexGroup,{alignItems:"baseline",gutterSize:"s",responsive:!1},Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(r.EuiTitle,null,Object(f.jsx)("h2",null,this.props.iconType&&Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiIcon,{type:this.props.iconType,size:"xl",className:"collapsiblePanel__logo"})," "),this.props.title))),Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(r.EuiLink,{"data-test-subj":"showHidePrivilege",onClick:this.toggleCollapsed},this.state.collapsed?Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.collapsiblePanel.showLinkText",defaultMessage:"show"}):Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.collapsiblePanel.hideLinkText",defaultMessage:"hide"})))))),h()(this,"getForm",(()=>this.state.collapsed?null:Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiSpacer,null),this.props.children))),h()(this,"toggleCollapsed",(()=>{this.setState({collapsed:!this.state.collapsed})})),this.state={collapsed:e.initiallyCollapsed||!1}}render(){return Object(f.jsx)(r.EuiPanel,{hasShadow:!1,hasBorder:!0},this.getTitle(),this.getForm())}}class cluster_privileges_ClusterPrivileges extends l.Component{constructor(...e){super(...e),h()(this,"buildComboBox",(e=>{const{role:t,editable:i}=this.props,s=e.map((e=>({label:e}))),a=(t.elasticsearch.cluster||[]).map((e=>({label:e})));return Object(f.jsx)(r.EuiFlexItem,{key:"clusterPrivs"},Object(f.jsx)(r.EuiComboBox,{"data-test-subj":"cluster-privileges-combobox",options:s,selectedOptions:a,onChange:this.onClusterPrivilegesChange,onCreateOption:this.onCreateCustomPrivilege,isDisabled:Object(d.l)(t)||!i}))})),h()(this,"onClusterPrivilegesChange",(e=>{this.props.onChange(e.map((e=>e.label)))})),h()(this,"onCreateCustomPrivilege",(e=>{this.props.onChange([...this.props.role.elasticsearch.cluster,e])})),h()(this,"getAvailableClusterPrivileges",(()=>{const e=[...this.props.builtinClusterPrivileges,...this.props.role.elasticsearch.cluster];return m.a.uniq(e)}))}render(){const e=this.getAvailableClusterPrivileges();return Object(f.jsx)(r.EuiFlexGroup,null,this.buildComboBox(e))}}h()(cluster_privileges_ClusterPrivileges,"defaultProps",{editable:!0});const P=e=>e.label,F=e=>({label:e});class index_privilege_form_IndexPrivilegeForm extends l.Component{constructor(e){super(e),h()(this,"isFieldListLoading",!1),h()(this,"getPrivilegeForm",(()=>Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiFlexGroup,null,Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiFormRow,a()({label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.indicesFormRowLabel",defaultMessage:"Indices"}),fullWidth:!0},this.props.validator.validateIndexPrivilege(this.props.indexPrivilege)),Object(f.jsx)(r.EuiComboBox,{"data-test-subj":`indicesInput${this.props.formIndex}`,options:this.props.indexPatterns.map(F),selectedOptions:this.props.indexPrivilege.names.map(F),onCreateOption:this.onCreateIndexPatternOption,onChange:this.onIndexPatternsChange,isDisabled:this.props.isRoleReadOnly}))),Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiFormRow,{label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.privilegesFormRowLabel",defaultMessage:"Privileges"}),fullWidth:!0},Object(f.jsx)(r.EuiComboBox,{"data-test-subj":`privilegesInput${this.props.formIndex}`,options:this.props.availableIndexPrivileges.map(F),selectedOptions:this.props.indexPrivilege.privileges.map(F),onChange:this.onPrivilegeChange,onCreateOption:this.onCreateCustomPrivilege,isDisabled:this.props.isRoleReadOnly})))),Object(f.jsx)(r.EuiSpacer,null),this.getFieldLevelControls(),this.getGrantedDocumentsControl()))),h()(this,"loadFLSOptions",((e,t=!1)=>{(t||!this.isFieldListLoading&&0!==e.length)&&(this.isFieldListLoading=!0,this.setState({isFieldListLoading:!0}),this.props.indicesAPIClient.getFields(e.join(",")).then((e=>{this.isFieldListLoading=!1,this.setState({flsOptions:e,isFieldListLoading:!1})})).catch((()=>{this.isFieldListLoading=!1,this.setState({flsOptions:[],isFieldListLoading:!1})})))})),h()(this,"getFieldLevelControls",(()=>{const{allowFieldLevelSecurity:e,allowDocumentLevelSecurity:t,indexPrivilege:i,isRoleReadOnly:s}=this.props;if(!e)return null;const{grant:a,except:o}=this.getFieldSecurity(i);return Object(f.jsx)(n.a.Fragment,null,Object(f.jsx)(r.EuiFlexGroup,{direction:"column"},!s&&Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiSwitch,{"data-test-subj":`restrictFieldsQuery${this.props.formIndex}`,label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantFieldPrivilegesLabel",defaultMessage:"Grant access to specific fields"}),compressed:!0,checked:this.state.fieldSecurityExpanded,onChange:this.toggleFieldSecurity})),this.state.fieldSecurityExpanded&&Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiFlexGroup,null,Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiFormRow,{label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantedFieldsFormRowLabel",defaultMessage:"Granted fields"}),fullWidth:!0,className:"indexPrivilegeForm__grantedFieldsRow",helpText:s||0!==a.length?void 0:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantedFieldsFormRowHelpText",defaultMessage:"If no fields are granted, then users assigned to this role will not be able to see any data for this index."})},Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiComboBox,{"data-test-subj":`fieldInput${this.props.formIndex}`,options:this.state.flsOptions.map(F),selectedOptions:a.map(F),onCreateOption:this.onCreateGrantedField,onChange:this.onGrantedFieldsChange,isDisabled:this.props.isRoleReadOnly,async:!0,isLoading:this.state.isFieldListLoading})))),Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiFormRow,{label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRoles.indexPrivilegeForm.deniedFieldsFormRowLabel",defaultMessage:"Denied fields"}),fullWidth:!0,className:"indexPrivilegeForm__deniedFieldsRow"},Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiComboBox,{"data-test-subj":`deniedFieldInput${this.props.formIndex}`,options:this.state.flsOptions.map(F),selectedOptions:o.map(F),onCreateOption:this.onCreateDeniedField,onChange:this.onDeniedFieldsChange,isDisabled:s,async:!0,isLoading:this.state.isFieldListLoading}))))))),t&&Object(f.jsx)(r.EuiSpacer,null))})),h()(this,"getGrantedDocumentsControl",(()=>{var e;const{allowDocumentLevelSecurity:t,indexPrivilege:i,isRoleReadOnly:s}=this.props;return t?Object(f.jsx)(r.EuiFlexGroup,{direction:"column"},!this.props.isRoleReadOnly&&Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiSwitch,{"data-test-subj":`restrictDocumentsQuery${this.props.formIndex}`,label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.grantReadPrivilegesLabel",defaultMessage:"Grant read privileges to specific documents"}),compressed:!0,checked:this.state.queryExpanded,onChange:this.toggleDocumentQuery,disabled:s})),this.state.queryExpanded&&Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiFormRow,{label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.indexPrivilegeForm.grantedDocumentsQueryFormRowLabel",defaultMessage:"Granted documents query"}),fullWidth:!0,"data-test-subj":`queryInput${this.props.formIndex}`},Object(f.jsx)(u.CodeEditorField,{languageId:"xjson",width:"100%",fullWidth:!0,height:this.state.documentQueryEditorHeight,"aria-label":o.i18n.translate("xpack.security.management.editRole.indexPrivilegeForm.grantedDocumentsQueryEditorAriaLabel",{defaultMessage:"Granted documents query editor"}),value:null!==(e=i.query)&&void 0!==e?e:"",onChange:this.onQueryChange,options:{readOnly:this.props.isRoleReadOnly,minimap:{enabled:!1},renderValidationDecorations:i.query?"editable":"off"},editorDidMount:this.editorDidMount})))):null})),h()(this,"editorDidMount",(e=>{const t=()=>{const t=Math.min(1e3,Math.max(100,e.getContentHeight()));this.setState({documentQueryEditorHeight:`${t}px`})};e.onDidContentSizeChange(t),t()})),h()(this,"toggleDocumentQuery",(()=>{const e=this.state.queryExpanded,t=!e;this.setState({queryExpanded:!this.state.queryExpanded,documentQuery:e?this.props.indexPrivilege.query:this.state.documentQuery}),e&&this.props.onChange({...this.props.indexPrivilege,query:""}),t&&!this.props.indexPrivilege.query&&this.state.documentQuery&&this.props.onChange({...this.props.indexPrivilege,query:this.state.documentQuery})})),h()(this,"toggleFieldSecurity",(()=>{const e=this.state.fieldSecurityExpanded,t=!e,{grant:i,except:s}=this.getFieldSecurity(this.props.indexPrivilege);this.setState({fieldSecurityExpanded:!this.state.fieldSecurityExpanded,grantedFields:e?i:this.state.grantedFields,exceptedFields:e?s:this.state.exceptedFields}),e&&this.props.onChange({...this.props.indexPrivilege,field_security:{grant:["*"],except:[]}});const a=this.isFieldSecurityConfigured(this.props.indexPrivilege),r=this.state.exceptedFields.length>0||this.state.grantedFields.length>0;t&&this.loadFLSOptions(this.props.indexPrivilege.names),t&&!a&&r&&this.props.onChange({...this.props.indexPrivilege,field_security:{grant:this.state.grantedFields,except:this.state.exceptedFields}})})),h()(this,"onCreateIndexPatternOption",(e=>{const t=this.props.indexPrivilege.names.concat([e]);this.props.onChange({...this.props.indexPrivilege,names:t}),this.state.fieldSecurityExpanded&&this.loadFLSOptions(t,!0)})),h()(this,"onIndexPatternsChange",(e=>{const t=e.map(P);this.props.onChange({...this.props.indexPrivilege,names:t}),this.state.fieldSecurityExpanded&&this.loadFLSOptions(t,!0)})),h()(this,"onPrivilegeChange",(e=>{this.props.onChange({...this.props.indexPrivilege,privileges:e.map(P)})})),h()(this,"onCreateCustomPrivilege",(e=>{this.props.onChange({...this.props.indexPrivilege,privileges:[...this.props.indexPrivilege.privileges,e]})})),h()(this,"onQueryChange",(e=>{this.props.onChange({...this.props.indexPrivilege,query:e})})),h()(this,"onCreateGrantedField",(e=>{if(!this.props.indexPrivilege.field_security||!this.props.indexPrivilege.field_security.grant)return;const t=this.props.indexPrivilege.field_security.grant.concat([e]);this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,grant:t}})})),h()(this,"onGrantedFieldsChange",(e=>{this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,grant:e.map(P)}})})),h()(this,"onCreateDeniedField",(e=>{if(!this.props.indexPrivilege.field_security||!this.props.indexPrivilege.field_security.except)return;const t=this.props.indexPrivilege.field_security.except.concat([e]);this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,except:t}})})),h()(this,"onDeniedFieldsChange",(e=>{this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,except:e.map(P)}})})),h()(this,"getFieldSecurity",(e=>{const{grant:t=[],except:i=[]}=e.field_security||{};return{grant:t,except:i}})),h()(this,"isFieldSecurityConfigured",(e=>{const{grant:t,except:i}=this.getFieldSecurity(e);return i.length>0||t.length>0&&!m.a.isEqual(t,["*"])}));const{grant:t,except:i}=this.getFieldSecurity(e.indexPrivilege);this.state={queryExpanded:!!e.indexPrivilege.query,fieldSecurityExpanded:this.isFieldSecurityConfigured(e.indexPrivilege),grantedFields:t,exceptedFields:i,documentQuery:e.indexPrivilege.query,documentQueryEditorHeight:"100px",isFieldListLoading:!1,flsOptions:[]}}componentDidMount(){this.state.fieldSecurityExpanded&&this.props.allowFieldLevelSecurity&&this.loadFLSOptions(this.props.indexPrivilege.names)}render(){return Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiHorizontalRule,null),Object(f.jsx)(r.EuiFlexGroup,{className:"index-privilege-form"},Object(f.jsx)(r.EuiFlexItem,null,this.getPrivilegeForm()),!this.props.isRoleReadOnly&&Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(r.EuiFormRow,{hasEmptyLabelSpace:!0},Object(f.jsx)(r.EuiButtonIcon,{"aria-label":o.i18n.translate("xpack.security.management.editRole.indexPrivilegeForm.deleteSpacePrivilegeAriaLabel",{defaultMessage:"Delete index privilege"}),color:"danger",onClick:this.props.onDelete,iconType:"trash"})))))}}class index_privileges_IndexPrivileges extends l.Component{constructor(e){super(e),h()(this,"addIndexPrivilege",(()=>{const{role:e}=this.props,t=[...e.elasticsearch.indices,{names:[],privileges:[],field_security:{grant:["*"]}}];this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:t}})})),h()(this,"onIndexPrivilegeChange",(e=>t=>{const{role:i}=this.props,{indices:s}=i.elasticsearch,a=[...s];a[e]=t,this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:a}})})),h()(this,"onIndexPrivilegeDelete",(e=>()=>{const{role:t}=this.props,i=[...t.elasticsearch.indices];i.splice(e,1),this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:i}})})),h()(this,"isPlaceholderPrivilege",(e=>0===e.names.length)),this.state={availableFields:{}}}render(){const{indices:e=[]}=this.props.role.elasticsearch,{indexPatterns:t,license:i,availableIndexPrivileges:s,indicesAPIClient:r}=this.props,{allowRoleDocumentLevelSecurity:n,allowRoleFieldLevelSecurity:o}=i.getFeatures(),c={indexPatterns:t,indicesAPIClient:r,allowDocumentLevelSecurity:n||!Object(d.k)(this.props.role),allowFieldLevelSecurity:o||!Object(d.k)(this.props.role),isRoleReadOnly:!this.props.editable||Object(d.l)(this.props.role)},u=e.map(((e,t)=>Object(f.jsx)(index_privilege_form_IndexPrivilegeForm,a()({key:t},c,{formIndex:t,validator:this.props.validator,availableIndexPrivileges:s,indexPrivilege:e,onChange:this.onIndexPrivilegeChange(t),onDelete:this.onIndexPrivilegeDelete(t)}))));return Object(f.jsx)(l.Fragment,null,u)}}h()(index_privileges_IndexPrivileges,"defaultProps",{editable:!0});class elasticsearch_privileges_ElasticsearchPrivileges extends l.Component{constructor(...e){super(...e),h()(this,"getForm",(()=>{const{role:e,indicesAPIClient:t,docLinks:i,validator:s,onChange:a,editable:u,indexPatterns:d,license:p,builtinESPrivileges:g}=this.props;return Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiDescribedFormGroup,{title:Object(f.jsx)("h3",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.clusterPrivilegesTitle",defaultMessage:"Cluster privileges"})),description:Object(f.jsx)("p",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.manageRoleActionsDescription",defaultMessage:"Manage the actions this role can perform against your cluster. "}),this.learnMore(i.links.security.clusterPrivileges))},Object(f.jsx)(r.EuiFormRow,{fullWidth:!0,hasEmptyLabelSpace:!0},Object(f.jsx)(cluster_privileges_ClusterPrivileges,{role:this.props.role,onChange:this.onClusterPrivilegesChange,builtinClusterPrivileges:g.cluster,editable:u}))),Object(f.jsx)(r.EuiSpacer,null),Object(f.jsx)(r.EuiDescribedFormGroup,{title:Object(f.jsx)("h3",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.runAsPrivilegesTitle",defaultMessage:"Run As privileges"})),description:Object(f.jsx)("p",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.howToBeSubmittedOnBehalfOfOtherUsersDescription",defaultMessage:"Allow requests to be submitted on the behalf of other users. "}),this.learnMore(i.links.security.runAsPrivilege))},Object(f.jsx)(r.EuiFormRow,{hasEmptyLabelSpace:!0},Object(f.jsx)(r.EuiComboBox,{placeholder:this.props.editable?o.i18n.translate("xpack.security.management.editRole.elasticSearchPrivileges.addUserTitle",{defaultMessage:"Add a userâ€¦"}):void 0,options:this.props.runAsUsers.map((e=>({id:e,label:e,isGroupLabelOption:!1}))),selectedOptions:this.props.role.elasticsearch.run_as.map((e=>({label:e}))),onCreateOption:this.onCreateRunAsOption,onChange:this.onRunAsUserChange,isDisabled:!u}))),Object(f.jsx)(r.EuiSpacer,null),Object(f.jsx)(r.EuiTitle,{size:"xs"},Object(f.jsx)("h3",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.indexPrivilegesTitle",defaultMessage:"Index privileges"}))),Object(f.jsx)(r.EuiSpacer,{size:"s"}),Object(f.jsx)(r.EuiText,{size:"s",color:"subdued"},Object(f.jsx)("p",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.controlAccessToClusterDataDescription",defaultMessage:"Control access to the data in your cluster. "}),this.learnMore(i.links.security.indicesPrivileges))),Object(f.jsx)(index_privileges_IndexPrivileges,{role:e,indicesAPIClient:t,validator:s,indexPatterns:d,license:p,onChange:a,availableIndexPrivileges:g.index,editable:u}),u&&Object(f.jsx)(n.a.Fragment,null,Object(f.jsx)(r.EuiHorizontalRule,null),Object(f.jsx)(r.EuiButton,{iconType:"plusInCircle",onClick:this.addIndexPrivilege},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.addIndexPrivilegesButtonLabel",defaultMessage:"Add index privilege"}))))})),h()(this,"learnMore",(e=>Object(f.jsx)(r.EuiLink,{className:"editRole__learnMore",href:e,target:"_blank"},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.elasticSearchPrivileges.learnMoreLinkText",defaultMessage:"Learn more"})))),h()(this,"addIndexPrivilege",(()=>{const{role:e}=this.props,t=[...e.elasticsearch.indices,{names:[],privileges:[],field_security:{grant:["*"]}}];this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:t}})})),h()(this,"onClusterPrivilegesChange",(e=>{const t={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,cluster:e}};this.props.onChange(t)})),h()(this,"onRunAsUserChange",(e=>{const t={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,run_as:e.map((e=>e.label))}};this.props.onChange(t)})),h()(this,"onCreateRunAsOption",(e=>{const t=this.props.role.elasticsearch.run_as.concat(e),i={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,run_as:t}};this.props.onChange(i)}))}render(){return Object(f.jsx)(collapsible_panel_CollapsiblePanel,{iconType:"logoElasticsearch",title:"Elasticsearch"},this.getForm())}}class privilege_form_calculator_PrivilegeFormCalculator{constructor(e,t){this.kibanaPrivileges=e,this.role=t}getBasePrivilege(e){const t=this.role.kibana[e];return this.kibanaPrivileges.getBasePrivileges(t).find((e=>t.base.includes(e.id)))}getDisplayedPrimaryFeaturePrivilegeId(e,t,i){var s;return null===(s=this.getDisplayedPrimaryFeaturePrivilege(e,t,i))||void 0===s?void 0:s.id}hasCustomizedSubFeaturePrivileges(e,t,i){const s=this.kibanaPrivileges.getSecuredFeature(e),a=this.getDisplayedPrimaryFeaturePrivilege(e,t,i),r=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([this.role.kibana[t]]);return s.getSubFeaturePrivileges().some((e=>{var t;const i=r.grantsPrivilege(e);return i!==(null!==(t=null==a?void 0:a.grantsPrivilege(e))&&void 0!==t?t:i)}))}getEffectivePrimaryFeaturePrivilege(e,t,i){const s=this.kibanaPrivileges.getSecuredFeature(e),a=this.getBasePrivilege(t),r=this.getSelectedFeaturePrivileges(e,t),l=s.getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:!0}).find((e=>r.includes(e.id)||(null==a?void 0:a.grantsPrivilege(e))));if((null==l||!l.requireAllSpaces||i)&&(null==l||!l.disabled))return l}isIndependentSubFeaturePrivilegeGranted(e,t,i){const s=this.role.kibana[i],a=this.kibanaPrivileges.getSecuredFeature(e).getSubFeaturePrivileges().find((e=>e.id===t));return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([s]).grantsPrivilege(a)}getSelectedMutuallyExclusiveSubFeaturePrivilege(e,t,i){const s=this.role.kibana[i],a=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([s]);return t.privileges.find((e=>a.grantsPrivilege(e)))}canCustomizeSubFeaturePrivileges(e,t){const i=this.getSelectedFeaturePrivileges(e,t);return this.kibanaPrivileges.getSecuredFeature(e).getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:!0}).some((e=>i.includes(e.id)))}updateSelectedFeaturePrivilegesForCustomization(e,t,i){const s=this.getDisplayedPrimaryFeaturePrivilege(e,t),a=this.getSelectedFeaturePrivileges(e,t);if(!s)return a;const r=[];if(i){const t=this.kibanaPrivileges.getSecuredFeature(e).getSubFeaturePrivileges().filter((e=>s.grantsPrivilege(e))).map((e=>e.id));r.push(s.getMinimalPrivilegeId(),...t)}else r.push(s.id);return r}hasSupersededInheritedPrivileges(e){const t=this.locateGlobalPrivilege(this.role),i=this.role.kibana[e];if(x(i)||!t)return!1;const s=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([t]),a=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([i]),r=this.kibanaPrivileges.getBasePrivileges(i).some((e=>i.base.includes(e.id))),l=this.kibanaPrivileges.getSecuredFeatures().filter((e=>e.getAllPrivileges().some((t=>{var s;return null===(s=i.feature[e.id])||void 0===s?void 0:s.includes(t.id)})))),n=r&&this.kibanaPrivileges.getBasePrivileges(i).some((e=>s.grantsPrivilege(e)&&!a.grantsPrivilege(e))),o=l.some((e=>e.getAllPrivileges().some((e=>s.grantsPrivilege(e)&&!a.grantsPrivilege(e)))));return n||o}getDisplayedPrimaryFeaturePrivilege(e,t,i){const s=this.kibanaPrivileges.getSecuredFeature(e),a=this.getBasePrivilege(t),r=this.getSelectedFeaturePrivileges(e,t),l=s.getPrimaryFeaturePrivileges().find((e=>{const t=e.getMinimalPrivilegeId(),i=s.getMinimalFeaturePrivileges().find((e=>e.id===t)),l=e.grantsPrivilege(i);return r.includes(e.id)||l&&r.includes(t)||(null==a?void 0:a.grantsPrivilege(e))}));if((null==l||!l.requireAllSpaces||i)&&(null==l||!l.disabled))return l}getSelectedFeaturePrivileges(e,t){var i;return null!==(i=this.role.kibana[t].feature[e])&&void 0!==i?i:[]}locateGlobalPrivilege(e){return e.kibana.find((e=>x(e)))}}var y=i(11);const O=({feature:e})=>{let t=null;if(e.getPrivilegesTooltip()){const i=Object(f.jsx)(r.EuiText,null,Object(f.jsx)("p",null,e.getPrivilegesTooltip()));t=Object(f.jsx)(r.EuiIconTip,{iconProps:{className:"eui-alignTop"},type:"iInCircle",color:"subdued",content:i})}return Object(f.jsx)("span",{"data-test-subj":"featureTableCell"},e.name," ",t)};class privilege_summary_calculator_PrivilegeSummaryCalculator{constructor(e,t){this.kibanaPrivileges=e,this.role=t}getEffectiveFeaturePrivileges(e){const t=this.collectAssignedPrivileges(e);return this.kibanaPrivileges.getSecuredFeatures().reduce(((i,s)=>{const a=this.getDisplayedPrimaryFeaturePrivilege(t,s),r=s.getSubFeaturePrivileges().filter((e=>t.grantsPrivilege(e))),l=this.hasCustomizedSubFeaturePrivileges(s,a,e);return{...i,[s.id]:{primary:a,hasCustomizedSubFeaturePrivileges:l,subFeature:r.map((e=>e.id))}}}),{})}hasCustomizedSubFeaturePrivileges(e,t,i){const s=this.collectAssignedPrivileges(i);return e.getSubFeaturePrivileges().some((e=>{var i;const a=s.grantsPrivilege(e);return a!==(null!==(i=null==t?void 0:t.grantsPrivilege(e))&&void 0!==i?i:a)}))}getDisplayedPrimaryFeaturePrivilege(e,t){const i=t.getPrimaryFeaturePrivileges(),s=t.getMinimalFeaturePrivileges(),a=t.subFeatures.length>0;return i.find((t=>{const i=e.grantsPrivilege(t);if(!i&&a){const i=s.find((e=>e.id===t.getMinimalPrivilegeId()));return e.grantsPrivilege(i)}return i}))}collectAssignedPrivileges(e){if(x(e))return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([e]);const t=this.locateGlobalPrivilege(this.role);return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges(t?[t,e]:[e])}locateGlobalPrivilege(e){return e.kibana.find((e=>x(e)))}}const S=e=>Object(f.jsx)(r.EuiFlexGroup,{direction:"column"},e.feature.getSubFeatures().map((t=>Object(f.jsx)(r.EuiFlexItem,{key:t.name,"data-test-subj":"subFeatureEntry"},Object(f.jsx)(r.EuiFlexGroup,null,Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiText,{size:"s","data-test-subj":"subFeatureName"},t.name)),e.effectiveFeaturePrivileges.map(((e,i)=>{return Object(f.jsx)(r.EuiFlexItem,{key:i,"data-test-subj":`entry-${i}`},t.getPrivilegeGroups().map((s=e.subFeature,(e,t)=>{switch(e.groupType){case"independent":return function(e,t,i){return Object(f.jsx)("div",{key:i},t.privileges.map((t=>{const i=e.includes(t.id);return Object(f.jsx)(r.EuiFlexGroup,{gutterSize:"s","data-test-subj":"independentPrivilege",key:t.id},Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(r.EuiIconTip,{type:i?"check":"cross",color:i?"primary":"danger",content:i?o.i18n.translate("xpack.security.management.editRole.privilegeSummary.privilegeGrantedIconTip",{defaultMessage:"Privilege is granted"}):o.i18n.translate("xpack.security.management.editRole.privilegeSummary.privilegeNotGrantedIconTip",{defaultMessage:"Privilege is not granted"})})),Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiText,{size:"s","data-test-subj":"privilegeName"},t.name)))})))}(s,e,t);case"mutually_exclusive":return function(e,t,i){var s;const a=null===(s=t.privileges.find((t=>e.includes(t.id))))||void 0===s?void 0:s.name;return Object(f.jsx)(r.EuiFlexGroup,{gutterSize:"s",key:i,"data-test-subj":"mutexPrivilege"},Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(r.EuiIconTip,{type:a?"check":"cross",color:a?"primary":"danger",content:a?"Privilege is granted":"Privilege is not granted"})),Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiText,{size:"s","data-test-subj":"privilegeName"},null!=a?a:"None")))}(s,e,t);default:throw new Error(`Unsupported privilege group type: ${e.groupType}`)}})));var s})))))));i(270);var C=i(55);class spaces_popover_list_SpacesPopoverList extends l.Component{constructor(...e){super(...e),h()(this,"state",{allowSpacesListFocus:!1,isPopoverOpen:!1}),h()(this,"getMenuPanel",(()=>{const e=this.getSpaceOptions(),t=Object(f.jsx)(r.EuiText,{color:"subdued",className:"eui-textCenter"},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacesPopoverList.noSpacesFoundTitle",defaultMessage:" no spaces found "}));return Object(f.jsx)(r.EuiSelectable,{className:"spcMenu",title:o.i18n.translate("xpack.security.management.editRole.spacesPopoverList.popoverTitle",{defaultMessage:"Spaces"}),searchable:this.props.spaces.length>=C.SPACE_SEARCH_COUNT_THRESHOLD,searchProps:this.props.spaces.length>=C.SPACE_SEARCH_COUNT_THRESHOLD?{placeholder:o.i18n.translate("xpack.security.management.editRole.spacesPopoverList.findSpacePlaceholder",{defaultMessage:"Find a space"}),compressed:!0,isClearable:!0,id:"spacesPopoverListSearch"}:void 0,noMatchesMessage:t,options:e,singleSelection:!0,style:{width:300},listProps:{rowHeight:40,showIcons:!1,onFocusBadge:!1}},((e,t)=>Object(f.jsx)(n.a.Fragment,null,Object(f.jsx)(r.EuiPopoverTitle,{paddingSize:"s"},o.i18n.translate("xpack.security.management.editRole.spacesPopoverList.selectSpacesTitle",{defaultMessage:"Spaces"})),t,e)))})),h()(this,"onButtonClick",(()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})})),h()(this,"closePopover",(()=>{this.setState({isPopoverOpen:!1})})),h()(this,"getSpaceOptions",(()=>{const e=Object(l.memo)(this.props.spacesApiUi.components.getSpaceAvatar);return this.props.spaces.map((t=>{const i=Object(f.jsx)(l.Suspense,{fallback:Object(f.jsx)(r.EuiLoadingSpinner,{size:"m"})},Object(f.jsx)(e,{space:t,size:"s",announceSpaceName:!1}));return{"aria-label":t.name,"aria-roledescription":"space",label:t.name,key:t.id,prepend:i,checked:void 0,"data-test-subj":`${t.id}-selectableSpaceItem`,className:"selectableSpaceItem"}}))}))}render(){const e=Object(f.jsx)(r.EuiButtonEmpty,{size:"xs",onClick:this.onButtonClick},Object(f.jsx)("span",{className:"secSpacesPopoverList__buttonText"},this.props.buttonText));return Object(f.jsx)(r.EuiPopover,{id:"spacesPopoverList",button:e,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft",ownFocus:!1},Object(f.jsx)(r.EuiFocusTrap,null,this.getMenuPanel()))}}const E=e=>{const{spacesApiUi:t}=e,i=x(e.entry),s=e.entry.spaces.map((t=>{var i;return null!==(i=e.spaces.find((e=>e.id===t)))&&void 0!==i?i:{id:t,name:t,disabledFeatures:[]}})),a=Object(l.useMemo)((()=>t.components.getSpaceAvatar),[t]);return Object(f.jsx)("div",null,s.slice(0,4).map((e=>Object(f.jsx)("span",{key:e.id},Object(f.jsx)(a,{size:"s",space:e})," ",i&&Object(f.jsx)("span",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeMatrix.globalSpaceName",defaultMessage:"All Spaces"}))))),s.length>4&&Object(f.jsx)(l.Fragment,null,Object(f.jsx)("br",null),Object(f.jsx)(spaces_popover_list_SpacesPopoverList,{spaces:s,buttonText:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeMatrix.showNMoreSpacesLink",{defaultMessage:"+{count} more",values:{count:s.length-4}}),spacesApiUi:t})))};function _(e){return`privilege_entry_${e.spaces.join("|")}`}const k=e=>{const[t,i]=Object(l.useState)([]),s=Object(l.useMemo)((()=>{const t=new Map;return e.kibanaPrivileges.getSecuredFeatures().filter((e=>null!=e.privileges||null!=e.reserved)).forEach((e=>{t.has(e.category.id)||t.set(e.category.id,[]),t.get(e.category.id).push(e)})),t}),[e.kibanaPrivileges]),a=new privilege_summary_calculator_PrivilegeSummaryCalculator(e.kibanaPrivileges,e.role),o={name:"Feature",field:"feature",render:e=>Object(f.jsx)(O,{feature:e})},u={align:"right",width:"40px",isExpander:!0,field:"featureId",name:"",render:(e,s)=>s.feature.getSubFeaturePrivileges().length>0?Object(f.jsx)(r.EuiButtonIcon,{onClick:()=>(e=>{t.includes(e)?i(t.filter((t=>t!==e))):i([...t,e])})(e),"data-test-subj":"expandPrivilegeSummaryRow","aria-label":t.includes(e)?"Collapse":"Expand",iconType:t.includes(e)?"arrowUp":"arrowDown"}):null},d=[...e.role.kibana].sort(((e,t)=>x(e)?-1:x(t)?1:0)),p=d.map((t=>{const i=_(t);return{name:Object(f.jsx)(E,{entry:t,spaces:e.spaces,spacesApiUi:e.spacesApiUi}),field:i,render:(t,i)=>{const{primary:s,hasCustomizedSubFeaturePrivileges:a}=t[i.featureId];let l=null;return l=a?Object(f.jsx)(r.EuiIconTip,{size:"s",type:"iInCircle",content:Object(f.jsx)("span",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.additionalPrivilegesGrantedIconTip",defaultMessage:"Additional privileges granted. Expand this row for more information."}))}):Object(f.jsx)(r.EuiIcon,{size:"s",type:"empty"}),Object(f.jsx)("span",{"data-test-subj":"privilegeColumn "+(a?"additionalPrivilegesGranted":"")},(n=e.spaces.some((e=>e.id===y.a)),null==(null==(o=s)?void 0:o.name)||null!=o&&o.disabled||o.requireAllSpaces&&!n?"None":null==o?void 0:o.name)," ",l);var n,o}}})),g=[];e.canCustomizeSubFeaturePrivileges&&g.push(u),g.push(o,...p);const h=d.reduce(((e,t)=>({...e,[_(t)]:a.getEffectiveFeaturePrivileges(t)})),{}),v=[];return s.forEach((i=>{const{category:s}=i[0],a=Object(f.jsx)(r.EuiFlexGroup,{"data-test-subj":`featureCategoryButton_${s.id}`,alignItems:"center",responsive:!1,gutterSize:"m"},s.euiIconType?Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(r.EuiIcon,{size:"m",type:s.euiIconType})):null,Object(f.jsx)(r.EuiFlexItem,{grow:1},Object(f.jsx)(r.EuiTitle,{size:"xs"},Object(f.jsx)("h4",{className:"eui-displayInlineBlock"},s.label)))),l=i.map((e=>({feature:e,featureId:e.id,...h})));v.push(Object(f.jsx)(r.EuiAccordion,{id:`privilegeSummaryFeatureCategory_${s.id}`,"data-test-subj":`privilegeSummaryFeatureCategory_${s.id}`,key:s.id,buttonContent:a,initialIsOpen:!0},Object(f.jsx)(r.EuiInMemoryTable,{columns:g,items:l,itemId:"featureId",rowProps:e=>({"data-test-subj":`summaryTableRow-${e.featureId}`}),itemIdToExpandedRowMap:t.reduce(((t,i)=>({...t,[i]:Object(f.jsx)(S,{feature:e.kibanaPrivileges.getSecuredFeature(i),effectiveFeaturePrivileges:Object.values(h).map((e=>e[i]))})})),{})})))})),Object(f.jsx)(n.a.Fragment,null,v.map(((e,t)=>Object(f.jsx)(l.Fragment,{key:t},e,Object(f.jsx)(r.EuiSpacer,null)))))},M=e=>{const[t,i]=Object(l.useState)(!1),s=e.role.kibana.length>5?"l":"m";return Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiButtonEmpty,{onClick:()=>i(!0),"data-test-subj":"viewPrivilegeSummaryButton"},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.viewSummaryButtonText",defaultMessage:"View privilege summary"})),t&&Object(f.jsx)(r.EuiFlyout,{onClose:()=>i(!1),size:s,maskProps:{headerZindexLocation:"below"}},Object(f.jsx)(r.EuiFlyoutHeader,null,Object(f.jsx)(r.EuiTitle,{size:"m"},Object(f.jsx)("h2",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.modalHeaderTitle",defaultMessage:"Privilege summary"})))),Object(f.jsx)(r.EuiFlyoutBody,null,Object(f.jsx)(k,{role:e.role,spaces:e.spaces,kibanaPrivileges:e.kibanaPrivileges,canCustomizeSubFeaturePrivileges:e.canCustomizeSubFeaturePrivileges,spacesApiUi:e.spacesApiUi})),Object(f.jsx)(r.EuiFlyoutFooter,null,Object(f.jsx)(r.EuiButton,{onClick:()=>i(!1)},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.privilegeSummary.closeSummaryButtonText",defaultMessage:"Close"})))))},I="none",R="custom";i(275),i(280);class change_all_privileges_ChangeAllPrivilegesControl extends l.Component{constructor(...e){super(...e),h()(this,"state",{isPopoverOpen:!1}),h()(this,"onSelectPrivilege",(e=>{this.props.onChange(e),this.setState({isPopoverOpen:!1})})),h()(this,"onButtonClick",(()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})})),h()(this,"closePopover",(()=>{this.setState({isPopoverOpen:!1})}))}render(){const e=Object(f.jsx)(r.EuiLink,{onClick:this.onButtonClick,className:"secPrivilegeFeatureChangeAllLink","data-test-subj":"changeAllPrivilegesButton"},Object(f.jsx)(r.EuiText,{size:"xs"},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.changeAllPrivilegesLink",defaultMessage:"Bulk actions"})," ",Object(f.jsx)(r.EuiIcon,{size:"s",type:"arrowDown"}))),t=this.props.privileges.map((e=>Object(f.jsx)(r.EuiContextMenuItem,{key:e.id,"data-test-subj":`changeAllPrivileges-${e.id}`,onClick:()=>{this.onSelectPrivilege(e.id)},disabled:this.props.disabled},m.a.upperFirst(e.id))));return t.push(Object(f.jsx)(r.EuiContextMenuItem,{key:I,"data-test-subj":"changeAllPrivileges-none",onClick:()=>{this.onSelectPrivilege(I)},disabled:this.props.disabled},m.a.upperFirst(I))),Object(f.jsx)(r.EuiPopover,{id:"changeAllFeaturePrivilegesPopover",button:e,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(f.jsx)(r.EuiContextMenuPanel,{items:t}))}}const w=e=>{const t=e.subFeature.getPrivilegeGroups().filter((e=>e.privileges.length>0));return 0===t.length?null:Object(f.jsx)(r.EuiFlexGroup,null,Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiText,{size:"s"},e.subFeature.name," ",(()=>{if(!e.subFeature.privilegesTooltip)return null;const t=Object(f.jsx)(r.EuiText,null,Object(f.jsx)("p",null,e.subFeature.privilegesTooltip));return Object(f.jsx)(r.EuiIconTip,{iconProps:{className:"eui-alignTop"},type:"iInCircle",color:"subdued",content:t})})())),Object(f.jsx)(r.EuiFlexItem,null,t.map((function(t,i){switch(t.groupType){case"independent":return function(t,i){return Object(f.jsx)("div",{key:i},t.privileges.map((t=>{const i=e.privilegeCalculator.isIndependentSubFeaturePrivilegeGranted(e.featureId,t.id,e.privilegeIndex);return Object(f.jsx)(r.EuiCheckbox,{key:t.id,id:`${e.featureId}_${t.id}`,label:t.name,"data-test-subj":"independentSubFeaturePrivilegeControl",onChange:i=>{const{checked:s}=i.target;s?e.onChange([...e.selectedFeaturePrivileges,t.id]):e.onChange(e.selectedFeaturePrivileges.filter((e=>e!==t.id)))},checked:i,disabled:e.disabled,compressed:!0})})))}(t,i);case"mutually_exclusive":return function(t,i){var s;const a=e.privilegeCalculator.getSelectedMutuallyExclusiveSubFeaturePrivilege(e.featureId,t,e.privilegeIndex),l=[...t.privileges.map(((t,i)=>({id:t.id,label:t.name,isDisabled:e.disabled})))];return l.push({id:I,label:"None",isDisabled:e.disabled}),Object(f.jsx)(r.EuiButtonGroup,{key:i,buttonSize:"compressed","data-test-subj":"mutexSubFeaturePrivilegeControl",options:l,idSelected:null!==(s=null==a?void 0:a.id)&&void 0!==s?s:I,isDisabled:e.disabled,onChange:i=>{const s=e.selectedFeaturePrivileges.filter((e=>!t.privileges.some((t=>t.id===e))));i===I?e.onChange(s):e.onChange([...s,i])},legend:o.i18n.translate("xpack.security.management.editRole.subFeatureForm.controlLegendText",{defaultMessage:"{subFeatureName} sub-feature privilege",values:{subFeatureName:e.subFeature.name}})})}(t,i);default:throw new Error(`Unsupported privilege group type: ${t.groupType}`)}}))))},T=({feature:e,onChange:t,privilegeIndex:i,privilegeCalculator:s,selectedFeaturePrivileges:a,allSpacesSelected:n,disabled:u,licenseAllowsSubFeatPrivCustomization:d})=>{const[p,g]=Object(l.useState)((()=>d&&e.getMinimalFeaturePrivileges().some((e=>a.includes(e.id)))));return Object(l.useEffect)((()=>{const t=e.getMinimalFeaturePrivileges().some((e=>a.includes(e.id)));d&&t||!p||g(!1)}),[e,p,a,d]),Object(f.jsx)(r.EuiFlexGroup,{direction:"column"},Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)("div",null,Object(f.jsx)(r.EuiSwitch,{label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.featureTable.customizeSubFeaturePrivilegesSwitchLabel",defaultMessage:"Customize sub-feature privileges"}),checked:p,onChange:a=>{t(e.id,s.updateSelectedFeaturePrivilegesForCustomization(e.id,i,a.target.checked)),g(a.target.checked)},"data-test-subj":"customizeSubFeaturePrivileges",disabled:u||!d||!s.canCustomizeSubFeaturePrivileges(e.id,i)}),d?void 0:Object(f.jsx)(r.EuiIconTip,{"data-test-subj":"subFeaturesTip",position:"right","aria-label":"sub-feature-information-tip",size:"m",type:"iInCircle",color:"subdued",iconProps:{className:"eui-alignTop"},content:o.i18n.translate("xpack.security.management.editRole.featureTable.cannotCustomizeSubFeaturesTooltip",{defaultMessage:"Customization of sub-feature privileges is a subscription feature."})}))),e.getSubFeatures().map((l=>{const o=l.requireAllSpaces&&!n;return Object(f.jsx)(r.EuiFlexItem,{key:l.name},Object(f.jsx)(w,{privilegeCalculator:s,privilegeIndex:i,featureId:e.id,subFeature:l,onChange:i=>t(e.id,i),selectedFeaturePrivileges:a,disabled:u||!p||o}))})))};class feature_table_FeatureTable extends l.Component{constructor(e){super(e),h()(this,"featureCategories",new Map),h()(this,"renderPrivilegeControlsForFeature",(e=>{var t;const i=(t,i,s)=>{var a;const l=e.getSubFeaturePrivileges().length>0;return Object(f.jsx)(r.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(f.jsx)(r.EuiFlexItem,{grow:!1},s),Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiAccordion,{id:`featurePrivilegeControls_${e.id}`,"data-test-subj":"featurePrivilegeControls",buttonContent:t,extraAction:i,forceState:l?void 0:"closed",arrowDisplay:l?"left":"none",onToggle:t=>{t?this.state.expandedPrivilegeControls.add(e.id):this.state.expandedPrivilegeControls.delete(e.id),this.setState({expandedPrivilegeControls:new Set([...this.state.expandedPrivilegeControls])})}},Object(f.jsx)("div",{className:"subFeaturePrivilegeExpandedRegion"},Object(f.jsx)(T,{feature:e,privilegeIndex:this.props.privilegeIndex,onChange:this.props.onChange,privilegeCalculator:this.props.privilegeCalculator,selectedFeaturePrivileges:null!==(a=this.props.role.kibana[this.props.privilegeIndex].feature[e.id])&&void 0!==a?a:[],allSpacesSelected:this.props.allSpacesSelected,disabled:this.props.disabled,licenseAllowsSubFeatPrivCustomization:this.props.canCustomizeSubFeaturePrivileges})))))},s=e.getPrimaryFeaturePrivileges();if(e.reserved&&0===s.length)return i(Object(f.jsx)(n.a.Fragment,null,Object(f.jsx)(r.EuiIcon,{type:"empty",size:"l"})," ",Object(f.jsx)(O,{feature:e})),Object(f.jsx)(r.EuiText,{style:{maxWidth:200},size:"xs","data-test-subj":"reservedFeatureDescription"},e.reserved.description),Object(f.jsx)(r.EuiIcon,{type:"empty"}));if(0===s.length)return null;const a=this.props.privilegeCalculator.getDisplayedPrimaryFeaturePrivilegeId(e.id,this.props.privilegeIndex,this.props.allSpacesSelected),l=s.filter((e=>!e.disabled)).map((t=>{const i=t.requireAllSpaces&&!this.props.allSpacesSelected;return{id:`${e.id}_${t.id}`,label:t.name,isDisabled:this.props.disabled||i}}));l.push({id:`${e.id}_none`,label:"None",isDisabled:null!==(t=this.props.disabled)&&void 0!==t&&t});let u=Object(f.jsx)(r.EuiIconTip,{type:"empty",content:null});!this.state.expandedPrivilegeControls.has(e.id)&&this.props.privilegeCalculator.hasCustomizedSubFeaturePrivileges(e.id,this.props.privilegeIndex,this.props.allSpacesSelected)&&(u=Object(f.jsx)(r.EuiIconTip,{type:"iInCircle",content:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.featureTable.privilegeCustomizationTooltip",defaultMessage:"Feature has customized sub-feature privileges. Expand this row for more information."})}));const d=e.getSubFeaturePrivileges().length>0;return i(Object(f.jsx)(n.a.Fragment,null,!d&&Object(f.jsx)(r.EuiIcon,{type:"empty",size:"l"})," ",Object(f.jsx)(O,{feature:e})),Object(f.jsx)(r.EuiButtonGroup,{name:`featurePrivilege_${e.id}`,"data-test-subj":"primaryFeaturePrivilegeControl",isFullWidth:!0,options:l,idSelected:`${e.id}_${null!=a?a:I}`,onChange:this.onChange(e.id),legend:o.i18n.translate("xpack.security.management.editRole.featureTable.actionLegendText",{defaultMessage:"{featureName} feature privilege",values:{featureName:e.name}}),style:{minWidth:200}}),u)})),h()(this,"onChange",(e=>t=>{const i=t.substr(`${e}_`.length);i===I?this.props.onChange(e,[]):this.props.onChange(e,[i])})),h()(this,"onChangeAllFeaturePrivileges",(e=>{e===I?this.props.onChangeAll([]):this.props.onChangeAll([e])})),h()(this,"getCategoryHelpText",(e=>{if("management"===e.id)return o.i18n.translate("xpack.security.management.editRole.featureTable.managementCategoryHelpText",{defaultMessage:"Access to Stack Management is determined by both Elasticsearch and Kibana privileges, and cannot be explicitly disabled."})})),e.kibanaPrivileges.getSecuredFeatures().filter((e=>null!=e.privileges||null!=e.reserved)).forEach((e=>{this.featureCategories.has(e.category.id)||this.featureCategories.set(e.category.id,[]),this.featureCategories.get(e.category.id).push(e)})),this.state={expandedPrivilegeControls:new Set}}render(){const e=this.props.kibanaPrivileges.getBasePrivileges(this.props.role.kibana[this.props.privilegeIndex]),t=[];return this.featureCategories.forEach((e=>{var i;const{category:s}=e[0],a=e.length,l=e.filter((e=>null!=this.props.privilegeCalculator.getEffectivePrimaryFeaturePrivilege(e.id,this.props.privilegeIndex,this.props.allSpacesSelected))).length,c=Object(f.jsx)(r.EuiFlexGroup,{"data-test-subj":`featureCategoryButton_${s.id}`,alignItems:"center",responsive:!1,gutterSize:"m"},s.euiIconType?Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(r.EuiIcon,{size:"m",type:s.euiIconType})):null,Object(f.jsx)(r.EuiFlexItem,{grow:1},Object(f.jsx)(r.EuiTitle,{size:"xs"},Object(f.jsx)("h4",{className:"eui-displayInlineBlock"},s.label)))),u=o.i18n.translate("xpack.security.management.editRole.featureTable.featureAccordionSwitchLabel",{defaultMessage:"{grantedCount} / {featureCount} {featureCount, plural, one {feature} other {features}} granted",values:{grantedCount:l,featureCount:a}}),d=Object(f.jsx)(r.EuiText,{size:"s","aria-hidden":"true",color:"subdued","data-test-subj":"categoryLabel"},u),p=this.getCategoryHelpText(s),g=Object(f.jsx)(r.EuiAccordion,{id:`featureCategory_${s.id}`,"data-test-subj":`featureCategory_${s.id}`,key:s.id,arrowDisplay:"left",forceState:void 0,buttonContent:c,extraAction:d},Object(f.jsx)("div",null,Object(f.jsx)(r.EuiSpacer,{size:"s"}),p&&Object(f.jsx)(n.a.Fragment,null,Object(f.jsx)(r.EuiCallOut,{iconType:"iInCircle",size:"s"},p),Object(f.jsx)(r.EuiSpacer,{size:"s"})),Object(f.jsx)(r.EuiFlexGroup,{direction:"column",gutterSize:"s"},e.map((e=>Object(f.jsx)(r.EuiFlexItem,{key:e.id},this.renderPrivilegeControlsForFeature(e)))))));t.push({order:null!==(i=s.order)&&void 0!==i?i:Number.MAX_SAFE_INTEGER,element:g})})),t.sort(((e,t)=>e.order-t.order)),Object(f.jsx)("div",null,Object(f.jsx)(r.EuiFlexGroup,{alignItems:"flexEnd"},Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(r.EuiText,{size:"xs"},Object(f.jsx)("b",null,o.i18n.translate("xpack.security.management.editRole.featureTable.featureVisibilityTitle",{defaultMessage:"Customize feature privileges"})))),!this.props.disabled&&Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(change_all_privileges_ChangeAllPrivilegesControl,{privileges:e,onChange:this.onChangeAllFeaturePrivileges}))),Object(f.jsx)(r.EuiHorizontalRule,{margin:"m"}),t.flatMap(((e,t)=>[e.element,Object(f.jsx)(r.EuiHorizontalRule,{key:`accordion-hr-${t}`,margin:"m"})])))}}h()(feature_table_FeatureTable,"defaultProps",{privilegeIndex:-1,showLocks:!0});var A=i(51);const L=(e,t)=>{if(e)return{id:`spaceOption_${e.id}`,label:e.name,color:Object(A.getSpaceColor)(e),disabled:"global"===t&&"*"!==e.id||"spaces"===t&&"*"===e.id}};class space_selector_SpaceSelector extends l.Component{constructor(...e){super(...e),h()(this,"onChange",(e=>{this.props.onChange(e.map((e=>e.id.split("spaceOption_")[1])))})),h()(this,"getOptions",(()=>this.props.spaces.map((e=>L(e,this.props.selectedSpaceIds.includes("*")?"global":this.props.selectedSpaceIds.length>0?"spaces":void 0))).filter(Boolean))),h()(this,"getSelectedOptions",(()=>{var e;return this.props.selectedSpaceIds.map((e=this.props.spaces,t=>L(e.find((e=>e.id===t))))).filter(Boolean)}))}render(){return Object(f.jsx)(r.EuiComboBox,{"data-test-subj":"spaceSelectorComboBox","aria-label":o.i18n.translate("xpack.security.management.editRole.spaceSelectorLabel",{defaultMessage:"Spaces"}),fullWidth:!0,options:this.getOptions(),renderOption:(e,t,i)=>{const{color:s,label:a}=e;return Object(f.jsx)(r.EuiHealth,{color:s},Object(f.jsx)("span",{className:i},Object(f.jsx)(r.EuiHighlight,{search:t},a)))},selectedOptions:this.getSelectedOptions(),isDisabled:this.props.disabled,onChange:this.onChange})}}class privilege_space_form_PrivilegeSpaceForm extends l.Component{constructor(e){super(e),h()(this,"getForm",(()=>{const{spaces:e}=this.props,t=this.state.selectedSpaceIds.length>0;return Object(f.jsx)(r.EuiForm,null,Object(f.jsx)(r.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.spaceSelectorFormLabel",{defaultMessage:"Spaces"}),helpText:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.spaceSelectorFormHelpText",{defaultMessage:"Select one or more Kibana spaces to which you wish to assign privileges."})},Object(f.jsx)(space_selector_SpaceSelector,{selectedSpaceIds:this.state.selectedSpaceIds,onChange:this.onSelectedSpacesChange,spaces:e})),this.getPrivilegeCallout(),Object(f.jsx)(r.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.privilegeSelectorFormLabel",{defaultMessage:"Privileges for all features"}),helpText:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.privilegeSelectorFormHelpText",{defaultMessage:"Assign the privilege level you wish to grant to all present and future features across this space."})},Object(f.jsx)(r.EuiButtonGroup,{name:"basePrivilegeButtonGroup","data-test-subj":"basePrivilegeButtonGroup",isFullWidth:!0,color:"primary",options:[{id:"basePrivilege_all",label:"All","data-test-subj":"basePrivilege_all"},{id:"basePrivilege_read",label:"Read","data-test-subj":"basePrivilege_read"},{id:"basePrivilege_custom",label:"Customize","data-test-subj":"basePrivilege_custom"}],idSelected:this.getDisplayedBasePrivilege(),isDisabled:!t,onChange:this.onSpaceBasePrivilegeChange,legend:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.basePrivilegeControlLegend",{defaultMessage:"Privileges for all features"})})),Object(f.jsx)(r.EuiSpacer,null),Object(f.jsx)(r.EuiTitle,{size:"xxs"},Object(f.jsx)("h3",null,this.getFeatureListLabel(this.state.selectedBasePrivilege.length>0))),Object(f.jsx)(r.EuiSpacer,{size:"xs"}),Object(f.jsx)(r.EuiText,{size:"s"},Object(f.jsx)("p",null,this.getFeatureListDescription(this.state.selectedBasePrivilege.length>0))),Object(f.jsx)(r.EuiSpacer,{size:"l"}),Object(f.jsx)(feature_table_FeatureTable,{role:this.state.role,privilegeCalculator:this.state.privilegeCalculator,onChange:this.onFeaturePrivilegesChange,onChangeAll:this.onChangeAllFeaturePrivileges,kibanaPrivileges:this.props.kibanaPrivileges,privilegeIndex:this.state.privilegeIndex,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges,disabled:this.state.selectedBasePrivilege.length>0||!t,allSpacesSelected:this.state.selectedSpaceIds.includes(y.a)}),this.requiresGlobalPrivilegeWarning()&&Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiSpacer,{size:"l"}),Object(f.jsx)(r.EuiCallOut,{color:"warning",iconType:"alert","data-test-subj":"globalPrivilegeWarning",title:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.globalPrivilegeWarning",defaultMessage:"Creating a global privilege might impact your other space privileges."})})))})),h()(this,"getSaveButton",(()=>{const{mode:e}=this.state,t=this.isDefiningGlobalPrivilege();let i;switch(e){case"create":i=t?Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.createGlobalPrivilegeButton",defaultMessage:"Create global privilege"}):Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.createPrivilegeButton",defaultMessage:"Add Kibana privilege"});break;case"update":i=t?Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.updateGlobalPrivilegeButton",defaultMessage:"Update global privilege"}):Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRolespacePrivilegeForm.updatePrivilegeButton",defaultMessage:"Update space privilege"});break;default:throw new Error(`Unsupported mode: ${e}`)}let s="primary";return this.requiresGlobalPrivilegeWarning()&&(s="warning"),Object(f.jsx)(r.EuiButton,{onClick:this.onSaveClick,fill:!0,disabled:!this.canSave(),color:s,"data-test-subj":"createSpacePrivilegeButton"},i)})),h()(this,"getFeatureListLabel",(e=>e?o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.summaryOfFeaturePrivileges",{defaultMessage:"Summary of feature privileges"}):o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.customizeFeaturePrivileges",{defaultMessage:"Customize by feature"}))),h()(this,"getFeatureListDescription",(e=>e?o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.featurePrivilegeSummaryDescription",{defaultMessage:"Some features might be hidden by the space or affected by a global space privilege."}):o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.customizeFeaturePrivilegeDescription",{defaultMessage:"Increase privilege levels on a per feature basis. Some features might be hidden by the space or affected by a global space privilege."}))),h()(this,"getPrivilegeCallout",(()=>this.isDefiningGlobalPrivilege()?Object(f.jsx)(r.EuiFormRow,{fullWidth:!0},Object(f.jsx)(r.EuiCallOut,{color:"primary",iconType:"iInCircle",title:o.i18n.translate("xpack.security.management.editRole.spacePrivilegeForm.globalPrivilegeNotice",{defaultMessage:"These privileges will apply to all current and future spaces."})})):null)),h()(this,"closeFlyout",(()=>{this.props.onCancel()})),h()(this,"onSaveClick",(()=>{const e=Object(d.d)(this.state.role),t=e.kibana[this.state.privilegeIndex];this.isDefiningGlobalPrivilege()||(t.spaces=t.spaces.filter((e=>this.props.spaces.find((t=>t.id===e))))),this.props.onChange(e)})),h()(this,"onSelectedSpacesChange",(e=>{const t=Object(d.d)(this.state.role),i=t.kibana[this.state.privilegeIndex];i.spaces=[...e],i.feature=this.resetRoleFeature(i.feature,e),this.setState({selectedSpaceIds:e,role:t,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,t)})})),h()(this,"onSpaceBasePrivilegeChange",(e=>{const t=Object(d.d)(this.state.role),i=t.kibana[this.state.privilegeIndex],s=e.split("basePrivilege_")[1];let a=!1;s===R?(i.base=[],a=!0):(i.base=[s],i.feature={}),this.setState({selectedBasePrivilege:s===R?[]:[s],role:t,isCustomizingFeaturePrivileges:a,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,t)})})),h()(this,"resetRoleFeature",((e,t)=>{const i=this.props.kibanaPrivileges.getSecuredFeatures();return Object.entries(e).reduce(((e,[s,a])=>{var r;if(!Array.isArray(a))return e;const l=i.find((e=>e.id===s)),n=null!==(r=null==l?void 0:l.getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:!0}).find((e=>a.includes(e.id))))&&void 0!==r?r:{disabled:!1,requireAllSpaces:!1},o=t.includes(y.a);l&&l.getSubFeatures().forEach((e=>{e.privileges.forEach((t=>{a.includes(t.id)&&e.requireAllSpaces&&!o&&Object(b.remove)(a,(e=>e===t.id))}))}));const c=null!=n&&n.disabled||null!=n&&n.requireAllSpaces&&!o?[]:a;return{...e,...c.length&&{[s]:c}}}),{})})),h()(this,"getDisplayedBasePrivilege",(()=>{const e=this.state.privilegeCalculator.getBasePrivilege(this.state.privilegeIndex);return e?`basePrivilege_${e.id}`:"basePrivilege_custom"})),h()(this,"onFeaturePrivilegesChange",((e,t)=>{this.setRole(t,e)})),h()(this,"onChangeAllFeaturePrivileges",(e=>{this.setRole(e)})),h()(this,"canSave",(()=>{if(0===this.state.selectedSpaceIds.length)return!1;const e=this.state.role.kibana[this.state.privilegeIndex];return 0!==e.base.length||0!==Object.keys(e.feature).length})),h()(this,"isDefiningGlobalPrivilege",(()=>this.state.selectedSpaceIds.includes("*"))),h()(this,"requiresGlobalPrivilegeWarning",(()=>{const e=this.props.role.kibana.length>0;return"create"===this.state.mode&&this.isDefiningGlobalPrivilege()&&e}));const t=Object(d.d)(e.role);let i=e.privilegeIndex;i<0&&(i=t.kibana.push({spaces:[],base:[],feature:{}})-1),this.state={role:t,privilegeIndex:i,selectedSpaceIds:[...t.kibana[i].spaces],selectedBasePrivilege:[...t.kibana[i].base||[]],mode:e.privilegeIndex<0?"create":"update",isCustomizingFeaturePrivileges:!1,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(e.kibanaPrivileges,t)}}render(){return Object(f.jsx)(r.EuiFlyout,{onClose:this.closeFlyout,size:"m",maxWidth:!0,maskProps:{headerZindexLocation:"below"}},Object(f.jsx)(r.EuiFlyoutHeader,{hasBorder:!0},Object(f.jsx)(r.EuiTitle,{size:"m"},Object(f.jsx)("h2",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.modalTitle",defaultMessage:"Kibana privileges"})))),Object(f.jsx)(r.EuiFlyoutBody,null,Object(f.jsx)(r.EuiErrorBoundary,null,this.getForm())),Object(f.jsx)(r.EuiFlyoutFooter,null,this.state.privilegeCalculator.hasSupersededInheritedPrivileges(this.state.privilegeIndex)&&Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiCallOut,{color:"warning",iconType:"alert","data-test-subj":"spaceFormGlobalPermissionsSupersedeWarning",title:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.supersededWarningTitle",defaultMessage:"Superseded by global privileges"})},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.supersededWarning",defaultMessage:"Declared privileges are less permissive than configured global privileges. View the privilege summary to see effective privileges."})),Object(f.jsx)(r.EuiSpacer,{size:"s"})),Object(f.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(r.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left","data-test-subj":"cancelSpacePrivilegeButton"},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeForm.cancelButton",defaultMessage:"Cancel"}))),Object(f.jsx)(r.EuiFlexItem,{grow:!1},this.getSaveButton()))))}setRole(e,t){const i=Object(d.d)(this.state.role),s=i.kibana[this.state.privilegeIndex];if(0===e.length)t?delete s.feature[t]:s.feature={};else{let i=this.props.kibanaPrivileges.getSecuredFeatures();t&&(i=[i.find((e=>e.id===t))]),i.forEach((t=>{const i=t.getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:!0}).find((t=>!(null!=t&&t.disabled||null!=t&&t.requireAllSpaces&&!this.state.selectedSpaceIds.includes(y.a))&&Array.isArray(e)&&e.includes(t.id)));let a=[];i&&(a=[i.id],t.getSubFeaturePrivileges().forEach((t=>{Array.isArray(e)&&e.includes(t.id)&&(!t.requireAllSpaces||t.requireAllSpaces&&this.state.selectedSpaceIds.includes(y.a))&&a.push(t.id)}))),0===a.length?delete s.feature[t.id]:s.feature[t.id]=a}))}this.setState({role:i,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,i)})}}h()(privilege_space_form_PrivilegeSpaceForm,"defaultProps",{privilegeIndex:-1}),i(285);const B=e=>Object(f.jsx)(z,e),z=e=>{const{privilege:t,...i}=e,s=Object(f.jsx)(r.EuiText,i,function(e){const t=function(e){return void 0===e?[]:Array.isArray(e)?e:[e]}(e);let i;return i=0===t.length||1===t.length&&t.includes(I)?Object(f.jsx)(r.EuiIcon,{color:"subdued",type:"minusInCircle"}):t.map((e=>m.a.upperFirst(e))).join(", "),i}(t));return s};B.defaultProps={privilege:[]};class privilege_space_table_PrivilegeSpaceTable extends l.Component{constructor(...e){super(...e),h()(this,"state",{expandedSpacesGroups:[]}),h()(this,"renderKibanaPrivileges",(()=>{const{privilegeCalculator:e,displaySpaces:t}=this.props,i=this.getSortedPrivileges().map(((e,i)=>({spaces:e.spaces.map((e=>t.find((t=>t.id===e))||{id:e,name:e,disabledFeatures:[],deleted:!0})),privilegeIndex:i,isGlobal:x(e),privileges:{spaces:e.spaces,base:e.base||[],feature:e.feature||{},reserved:e._reserved||[]}}))),s=[{field:"spaces",name:"Spaces",width:"60%",render:(e,t)=>{const i=this.state.expandedSpacesGroups.includes(t.privilegeIndex),s=i?e:e.slice(0,4);let l=null;return e.length>s.length?l=Object(f.jsx)(r.EuiButtonEmpty,{size:"xs",onClick:()=>this.toggleExpandSpacesGroup(t.privilegeIndex)},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeTable.showNMoreSpacesLink",defaultMessage:"+{count} more",values:{count:e.length-s.length}})):i&&(l=Object(f.jsx)(r.EuiButtonEmpty,{size:"xs",onClick:()=>this.toggleExpandSpacesGroup(t.privilegeIndex)},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeTable.showLessSpacesLink",defaultMessage:"show less"}))),Object(f.jsx)("div",null,Object(f.jsx)("span",{"data-test-subj":"spacesColumn"},s.map((e=>Object(f.jsx)(r.EuiBadge,a()({key:e.id},(e=>e.deleted?{iconType:"trash"}:{})(e),{color:Object(A.getSpaceColor)(e)}),e.name)))),l)}},{field:"privileges",name:"Privileges",render:(t,i)=>{var s,a;if(t.reserved.length>0)return Object(f.jsx)(B,{privilege:t.reserved,"data-test-subj":"privilegeColumn"});let l=Object(f.jsx)(r.EuiIcon,{type:"empty",size:"s"});return e.hasSupersededInheritedPrivileges(i.privilegeIndex)&&(l=Object(f.jsx)("span",{"data-test-subj":"spaceTablePrivilegeSupersededWarning"},Object(f.jsx)(r.EuiIconTip,{type:"alert",size:"s",content:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeTable.supersededPrivilegeWarning",defaultMessage:"Privileges are superseded by configured global privilege. View the privilege summary to see effective privileges."})}))),Object(f.jsx)(r.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(f.jsx)(r.EuiFlexItem,{grow:!1},l),Object(f.jsx)(r.EuiFlexItem,null,Object(f.jsx)(B,{privilege:null!==(s=null===(a=e.getBasePrivilege(i.privilegeIndex))||void 0===a?void 0:a.id)&&void 0!==s?s:R,"data-test-subj":"privilegeColumn"})))}}];return this.props.disabled||s.push({name:"Actions",actions:[{render:e=>Object(f.jsx)(r.EuiButtonIcon,{"aria-label":o.i18n.translate("xpack.security.management.editRole.spacePrivilegeTable.editPrivilegesLabel",{defaultMessage:"Edit privileges for the following spaces: {spaceNames}.",values:{spaceNames:e.spaces.map((e=>e.name)).join(", ")}}),color:"primary",iconType:"pencil",onClick:()=>this.props.onEdit(e.privilegeIndex)})},{render:e=>Object(f.jsx)(r.EuiButtonIcon,{"aria-label":o.i18n.translate("xpack.security.management.editRole.spacePrivilegeTable.deletePrivilegesLabel",{defaultMessage:"Delete privileges for the following spaces: {spaceNames}.",values:{spaceNames:e.spaces.map((e=>e.name)).join(", ")}}),color:"danger",iconType:"trash",onClick:()=>this.onDeleteSpacePrivilege(e)})}]}),Object(f.jsx)(r.EuiInMemoryTable,{columns:s,items:i,hasActions:!0,rowProps:e=>({className:x(e.privileges)?"secPrivilegeTable__row--isGlobalSpace":""})})})),h()(this,"getSortedPrivileges",(()=>this.props.role.kibana.sort(((e,t)=>x(e)?-1:x(t)?1:0)))),h()(this,"toggleExpandSpacesGroup",(e=>{this.state.expandedSpacesGroups.includes(e)?this.setState({expandedSpacesGroups:this.state.expandedSpacesGroups.filter((t=>t!==e))}):this.setState({expandedSpacesGroups:[...this.state.expandedSpacesGroups,e]})})),h()(this,"onDeleteSpacePrivilege",(e=>{const t=Object(d.d)(this.props.role);t.kibana.splice(e.privilegeIndex,1),this.props.onChange(t),this.setState({expandedSpacesGroups:this.state.expandedSpacesGroups.filter((t=>t!==e.privilegeIndex))})}))}render(){return this.renderKibanaPrivileges()}}class space_aware_privilege_section_SpaceAwarePrivilegeSection extends l.Component{constructor(e){super(e),h()(this,"globalSpaceEntry",{id:"*",name:o.i18n.translate("xpack.security.management.editRole.spaceAwarePrivilegeForm.globalSpacesName",{defaultMessage:"* All Spaces"}),color:"#D3DAE6",initials:"*",disabledFeatures:[]}),h()(this,"renderKibanaPrivileges",(()=>{const{role:e}=this.props;if(e.kibana.length>0){const e=Object(f.jsx)(privilege_space_table_PrivilegeSpaceTable,{role:this.props.role,displaySpaces:this.getDisplaySpaces(),privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,this.props.role),onChange:this.props.onChange,onEdit:this.onEditSpacesPrivileges,disabled:!this.props.editable});return Object(f.jsx)("div",null,e,Object(f.jsx)(r.EuiSpacer,null),this.getAvailablePrivilegeButtons(!0))}return Object(f.jsx)(r.EuiEmptyPrompt,{iconType:"lock",title:Object(f.jsx)("h2",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeSection.noAccessToKibanaTitle",defaultMessage:"This role does not grant access to Kibana"})),titleSize:"xs",actions:this.getAvailablePrivilegeButtons(!1)})})),h()(this,"getAvailablePrivilegeButtons",(e=>{const t=this.getAvailableSpaces().length>0;if(!t&&!e)return null;const i=t&&this.props.editable?Object(f.jsx)(r.EuiButton,{color:"primary",onClick:this.addSpacePrivilege,iconType:"plusInCircle","data-test-subj":"addSpacePrivilegeButton",isDisabled:!t||!this.props.editable},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spacePrivilegeSection.addSpacePrivilegeButton",defaultMessage:"Add Kibana privilege"})):null;if(!e)return i;const s=Object(f.jsx)(M,{role:this.props.role,spaces:this.getDisplaySpaces(),kibanaPrivileges:this.props.kibanaPrivileges,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges,spacesApiUi:this.props.spacesApiUi});return Object(f.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(f.jsx)(r.EuiFlexItem,{grow:!1},i),e&&!Object(d.m)(this.props.role)&&Object(f.jsx)(r.EuiFlexItem,{grow:!1},s))})),h()(this,"getDisplaySpaces",(()=>[this.globalSpaceEntry,...this.props.spaces])),h()(this,"getAvailableSpaces",((e=-1)=>{const t=m.a.uniq(m.a.flatten(this.props.role.kibana.map(((t,i)=>e===i?[]:t.spaces))));return this.getDisplaySpaces().filter((e=>!t.includes(e.id)))})),h()(this,"addSpacePrivilege",(()=>{this.setState({showSpacePrivilegeEditor:!0,privilegeIndex:-1})})),h()(this,"onSpacesPrivilegeChange",(e=>{this.setState({showSpacePrivilegeEditor:!1,privilegeIndex:-1}),this.props.onChange(e)})),h()(this,"onEditSpacesPrivileges",(e=>{this.setState({privilegeIndex:e,showSpacePrivilegeEditor:!0})})),h()(this,"onCancelEditPrivileges",(()=>{this.setState({showSpacePrivilegeEditor:!1})})),this.state={showSpacePrivilegeEditor:!1,showPrivilegeMatrix:!1,role:null,privilegeIndex:-1}}render(){const{uiCapabilities:e}=this.props;return e.spaces.manage?Object(f.jsx)(r.EuiErrorBoundary,null,Object(f.jsx)(l.Fragment,null,this.renderKibanaPrivileges(),this.state.showSpacePrivilegeEditor&&Object(f.jsx)(privilege_space_form_PrivilegeSpaceForm,{role:this.props.role,kibanaPrivileges:this.props.kibanaPrivileges,onChange:this.onSpacesPrivilegeChange,onCancel:this.onCancelEditPrivileges,spaces:this.getAvailableSpaces(this.state.privilegeIndex),privilegeIndex:this.state.privilegeIndex,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges}))):Object(f.jsx)(r.EuiCallOut,{title:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.insufficientPrivilegesDescription",defaultMessage:"Insufficient Privileges"}),iconType:"alert",color:"danger","data-test-subj":"userCannotManageSpacesCallout"},Object(f.jsx)("p",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.howToViewAllAvailableSpacesDescription",defaultMessage:"You are not authorized to view all available spaces."})),Object(f.jsx)("p",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.ensureAccountHasAllPrivilegesGrantedDescription",defaultMessage:"Please ensure your account has all privileges granted by the {kibanaAdmin} role, and try again.",values:{kibanaAdmin:Object(f.jsx)("strong",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.kibanaAdminTitle",defaultMessage:"kibana_admin"}))}})))}}class transform_error_section_TransformErrorSection extends l.PureComponent{render(){return Object(f.jsx)(r.EuiEmptyPrompt,{color:"danger",iconType:"alert",title:Object(f.jsx)("h2",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.transformErrorSectionTitle",defaultMessage:"Malformed role"})),body:Object(f.jsx)("p",null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.transformErrorSectionDescription",defaultMessage:"This role definition is invalid, and cannot be edited through this screen."}))})}}class kibana_privileges_region_KibanaPrivilegesRegion extends l.Component{constructor(...e){super(...e),h()(this,"getForm",(()=>{const{kibanaPrivileges:e,role:t,canCustomizeSubFeaturePrivileges:i,spaces:s=[],uiCapabilities:a,onChange:r,editable:l,validator:n,spacesApiUi:o}=this.props;return t._transform_error&&t._transform_error.includes("kibana")?Object(f.jsx)(transform_error_section_TransformErrorSection,null):Object(f.jsx)(space_aware_privilege_section_SpaceAwarePrivilegeSection,{kibanaPrivileges:e,role:t,spaces:s,uiCapabilities:a,onChange:r,editable:l,canCustomizeSubFeaturePrivileges:i,validator:n,spacesApiUi:o})}))}render(){return Object(f.jsx)(collapsible_panel_CollapsiblePanel,{iconType:"logoKibana",title:"Kibana"},this.getForm())}}const D=e=>{const{role:t}=e;return Object(d.m)(t)?Object(f.jsx)(r.EuiToolTip,{"data-test-subj":"reservedRoleBadgeTooltip",content:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.reversedRoleBadge.reservedRolesCanNotBeModifiedTooltip",defaultMessage:"Reserved roles are built-in and cannot be removed or modified."})},Object(f.jsx)(r.EuiIcon,{style:{verticalAlign:"super"},type:"lock"})):null};class validate_role_RoleValidator{constructor(e={}){h()(this,"shouldValidate",void 0),this.shouldValidate=e.shouldValidate}enableValidation(){this.shouldValidate=!0}disableValidation(){this.shouldValidate=!1}validateRoleName(e){return this.shouldValidate?e.name?e.name.length>y.f?G(o.i18n.translate("xpack.security.management.editRole.validateRole.nameLengthWarningMessage",{defaultMessage:"Name must not exceed {maxLength} characters.",values:{maxLength:y.f}})):e.name.trim()!==e.name?G(o.i18n.translate("xpack.security.management.editRole.validateRole.nameWhitespaceWarningMessage",{defaultMessage:"Name must not contain leading or trailing spaces."})):e.name.match(y.g)?{isInvalid:!1}:G(o.i18n.translate("xpack.security.management.editRole.validateRole.nameAllowedCharactersWarningMessage",{defaultMessage:"Name must contain only letters, numbers, spaces, punctuation and printable symbols."})):G(o.i18n.translate("xpack.security.management.editRole.validateRole.provideRoleNameWarningMessage",{defaultMessage:"Please provide a role name."})):{isInvalid:!1}}validateIndexPrivileges(e){if(!this.shouldValidate)return{isInvalid:!1};if(!Array.isArray(e.elasticsearch.indices))throw new TypeError(o.i18n.translate("xpack.security.management.editRole.validateRole.indicesTypeErrorMessage",{defaultMessage:"Expected {elasticIndices} to be an array",values:{elasticIndices:'"role.elasticsearch.indices"'}}));return null==e.elasticsearch.indices.map((e=>this.validateIndexPrivilege(e))).find((e=>e.isInvalid))?{isInvalid:!1}:G()}validateIndexPrivilege(e){return this.shouldValidate&&e.names.length&&!e.privileges.length?G(o.i18n.translate("xpack.security.management.editRole.validateRole.onePrivilegeRequiredWarningMessage",{defaultMessage:"At least one privilege is required"})):{isInvalid:!1}}validateSelectedSpaces(e,t){return this.shouldValidate&&t?Array.isArray(e)&&e.length>0?{isInvalid:!1}:G(o.i18n.translate("xpack.security.management.editRole.validateRole.oneSpaceRequiredWarningMessage",{defaultMessage:"At least one space is required"})):{isInvalid:!1}}validateSelectedPrivilege(e,t){return this.shouldValidate&&e&&0!==e.length?t?{isInvalid:!1}:G(o.i18n.translate("xpack.security.management.editRole.validateRole.privilegeRequiredWarningMessage",{defaultMessage:"Privilege is required"})):{isInvalid:!1}}validateSpacePrivileges(e){return this.shouldValidate?(e.kibana||[]).every((e=>e.base.length>0||Object.keys(e.feature).length>0))?{isInvalid:!1}:G():{isInvalid:!1}}validateForSave(e){const{isInvalid:t}=this.validateRoleName(e),{isInvalid:i}=this.validateIndexPrivileges(e),{isInvalid:s}=this.validateSpacePrivileges(e);return t||i||s?G():{isInvalid:!1}}}function G(e){return{isInvalid:!0,error:e}}const N=({userAPIClient:e,dataViews:t,rolesAPIClient:i,indicesAPIClient:s,privilegesAPIClient:n,getFeatures:g,http:h,roleName:v,action:b,fatalErrors:m,license:x,docLinks:j,uiCapabilities:P,notifications:F,history:y,spacesApiUi:O})=>{if(!t)throw new Error("The dataViews plugin is required for this page, but it is not available");const S=Object(l.useCallback)((()=>y.push("/")),[y]),C=!Object(p.a)("roles").save,{current:E}=Object(l.useRef)(new validate_role_RoleValidator({shouldValidate:!1})),[_,k]=Object(l.useState)(null),[M,I]=Object(l.useState)(!1),[R,w]=Object(l.useState)(""),T=function(e,t){const[i,s]=Object(l.useState)(null);return Object(l.useEffect)((()=>{e.getUsers().then((e=>s(e.map((e=>e.username)))),(e=>t.add(e)))}),[t,e]),i}(e,m),A=function(e,t,i){const[s,a]=Object(l.useState)(null);return Object(l.useEffect)((()=>{e.getTitles().catch((e=>{var s;if(403===(null===(s=e.response)||void 0===s?void 0:s.status))return i.toasts.addDanger({title:o.i18n.translate("xpack.security.management.roles.noIndexPatternsPermission",{defaultMessage:"You need permission to access the list of available index patterns."})}),[];t.add(e)})).then((e=>a(e.filter(Boolean))))}),[t,e,i]),s}(t,m,F),L=function(e,t){const[i,s]=Object(l.useState)(null);return Object(l.useEffect)((()=>{Promise.all([e.getAll({includeActions:!0,respectLicenseLevel:!1}),e.getBuiltIn()]).then((([e,t])=>s([e,t])),(e=>t.add(e)))}),[e,t]),i}(n,m),B=function(e,t){const[i,s]=Object(l.useState)(null);return Object(l.useEffect)((()=>{e.get("/api/spaces/space").then((e=>s({enabled:!0,list:e})),(e=>{var i;404===(null===(i=e.response)||void 0===i?void 0:i.status)?s({enabled:!1,list:[]}):t.add(e)}))}),[e,t]),i}(h,m),z=function(e,t){const[i,s]=Object(l.useState)(null);return Object(l.useEffect)((()=>{e().catch((e=>{var i;if(403===(null===(i=e.response)||void 0===i?void 0:i.status))return[];t.add(e)})).then((e=>{s(e)}))}),[t,e]),i}(g,m),[G,N]=function(e,t,i,s,a,r,n){const[c,u]=Object(l.useState)(null);return Object(l.useEffect)((()=>{(n?e.getRole(n):Promise.resolve({name:"",elasticsearch:{cluster:[],indices:[],run_as:[]},kibana:[],_unrecognized_applications:[]})).then((e=>{if("clone"===a&&Object(d.m)(e))r();else{if(0===e.elasticsearch.indices.length){const t={names:[],privileges:[]},{allowRoleDocumentLevelSecurity:i,allowRoleFieldLevelSecurity:a}=s.getFeatures();a&&(t.field_security={grant:["*"],except:[]}),i&&(t.query=""),e.elasticsearch.indices.push(t)}u("clone"===a?Object(d.p)(e):Object(d.d)(e))}})).catch((e=>{var s;404===(null===(s=e.response)||void 0===s?void 0:s.status)?(i.toasts.addDanger({title:o.i18n.translate("xpack.security.management.roles.roleNotFound",{defaultMessage:'No "{roleName}" role found.',values:{roleName:n}})}),r()):t.add(e)}))}),[n,a,t,e,i,s,r]),[c,u]}(i,m,F,x,b,S,v),q=!!v&&"edit"===b;if(Object(l.useEffect)((()=>{C&&!q&&S()}),[C,q]),!(G&&T&&A&&L&&B&&z))return null;const $=C||Object(d.l)(G),W=Object(d.m)(G),U=Object(d.j)(G),[K,H]=L,V=e=>N(e),Q=async()=>{E.enableValidation();const e=E.validateForSave(G);if(e.isInvalid)k(e);else{k(null);try{await i.saveRole({role:G,createOnly:!q})}catch(e){var t,s,a;return q||409!==(null==e||null===(t=e.body)||void 0===t?void 0:t.statusCode)?void F.toasts.addDanger(null!==(s=null==e||null===(a=e.body)||void 0===a?void 0:a.message)&&void 0!==s?s:o.i18n.translate("xpack.security.management.editRole.errorSavingRoleError",{defaultMessage:"Error saving role"})):(I(!0),void window.scroll({top:0,behavior:"smooth"}))}F.toasts.addSuccess(o.i18n.translate("xpack.security.management.editRole.roleSuccessfullySavedNotificationMessage",{defaultMessage:"Saved role"})),S()}},Y=async()=>{try{return await i.getRole(G.name),!0}catch(e){return!1}};return Object(f.jsx)("div",{className:"editRolePage"},Object(f.jsx)(r.EuiForm,_,(()=>{let e;const t={tabIndex:0};return W||$?(e=Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.viewingRoleTitle",defaultMessage:"Viewing role"}),t["aria-describedby"]="reservedRoleDescription"):e=q?Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.editRoleTitle",defaultMessage:"Edit role"}):Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.createRoleTitle",defaultMessage:"Create role"}),Object(f.jsx)(r.EuiTitle,{size:"l"},Object(f.jsx)("h1",t,e," ",Object(f.jsx)(D,{role:G})))})(),Object(f.jsx)(r.EuiSpacer,null),Object(f.jsx)(r.EuiText,{size:"s"},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.setPrivilegesToKibanaSpacesDescription",defaultMessage:"Set privileges on your Elasticsearch data and control access to your Kibana spaces."})),W&&Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiSpacer,{size:"s"}),Object(f.jsx)(r.EuiText,{size:"s",color:"subdued"},Object(f.jsx)("p",{id:"reservedRoleDescription",tabIndex:0},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.modifyingReversedRolesDescription",defaultMessage:"Reserved roles are built-in and cannot be removed or modified."})))),U&&Object(f.jsx)(l.Fragment,null,Object(f.jsx)(r.EuiSpacer,{size:"s"}),Object(f.jsx)(r.EuiCallOut,{title:Object(d.e)(G),color:"warning",iconType:"alert"})),Object(f.jsx)(r.EuiSpacer,null),Object(f.jsx)(r.EuiPanel,{hasShadow:!1,hasBorder:!0},Object(f.jsx)(r.EuiFormRow,a()({"data-test-subj":"roleNameFormRow",label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.roleNameFormRowTitle",defaultMessage:"Role name"}),helpText:!W&&q?Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.roleNameFormRowHelpText",defaultMessage:"A role's name cannot be changed once it has been created."}):void 0},E.validateRoleName(G),M?{error:"A role with this name already exists.",isInvalid:!0}:{}),Object(f.jsx)(r.EuiFieldText,{name:"name",value:G.name||"",onChange:e=>N({...G,name:e.target.value}),onBlur:e=>{q||R===G.name||(w(G.name),Y().then((e=>{I(e)})))},"data-test-subj":"roleFormNameInput",disabled:W||q||$,isInvalid:M}))),Object(f.jsx)("div",null,Object(f.jsx)(r.EuiSpacer,null),Object(f.jsx)(elasticsearch_privileges_ElasticsearchPrivileges,{role:G,editable:!$,indicesAPIClient:s,onChange:V,runAsUsers:T,validator:E,indexPatterns:A,builtinESPrivileges:H,license:x,docLinks:j})),Object(f.jsx)("div",null,Object(f.jsx)(r.EuiSpacer,null),Object(f.jsx)(kibana_privileges_region_KibanaPrivilegesRegion,{kibanaPrivileges:new kibana_privileges_KibanaPrivileges(K,z),spaces:B.list,uiCapabilities:P,canCustomizeSubFeaturePrivileges:x.getFeatures().allowSubFeaturePrivileges,editable:!$,role:G,onChange:V,validator:E,spacesApiUi:O})),Object(f.jsx)(r.EuiSpacer,null),$?Object(f.jsx)(r.EuiButton,a()({},Object(u.reactRouterNavigate)(y,""),{iconType:"arrowLeft","data-test-subj":"roleFormReturnButton"}),Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.returnToRoleListButtonLabel",defaultMessage:"Back to roles"})):Object(f.jsx)(r.EuiFlexGroup,{responsive:!1},Object(f.jsx)(r.EuiFlexItem,{grow:!1},(()=>{const e=q?Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.updateRoleText",defaultMessage:"Update role"}):Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.createRoleText",defaultMessage:"Create role"});return Object(f.jsx)(r.EuiButton,{"data-test-subj":"roleFormSaveButton",fill:!0,onClick:Q,disabled:W||M},e)})()),Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(r.EuiButtonEmpty,{"data-test-subj":"roleFormCancelButton",onClick:S},Object(f.jsx)(c.FormattedMessage,{id:"xpack.security.management.editRole.cancelButtonLabel",defaultMessage:"Cancel"}))),Object(f.jsx)(r.EuiFlexItem,{grow:!0}),q&&!$?Object(f.jsx)(r.EuiFlexItem,{grow:!1},Object(f.jsx)(delete_role_button_DeleteRoleButton,{canDelete:!0,onDelete:async()=>{try{await i.deleteRole(G.name)}catch(i){var e,t;return void F.toasts.addDanger(null!==(e=null==i||null===(t=i.data)||void 0===t?void 0:t.message)&&void 0!==e?e:o.i18n.translate("xpack.security.management.editRole.errorDeletingRoleError",{defaultMessage:"Error deleting role"}))}F.toasts.addSuccess(o.i18n.translate("xpack.security.management.editRole.roleSuccessfullyDeletedNotificationMessage",{defaultMessage:"Deleted role"})),S()}})):null)))}},57:function(e,t,i){"use strict";var s,a=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),r=[];function l(e){for(var t=-1,i=0;i<r.length;i++)if(r[i].identifier===e){t=i;break}return t}function n(e,t){for(var i={},s=[],a=0;a<e.length;a++){var n=e[a],o=t.base?n[0]+t.base:n[0],c=i[o]||0,u="".concat(o," ").concat(c);i[o]=c+1;var d=l(u),p={css:n[1],media:n[2],sourceMap:n[3]};-1!==d?(r[d].references++,r[d].updater(p)):r.push({identifier:u,updater:v(p,t),references:1}),s.push(u)}return s}function o(e){var t=document.createElement("style"),s=e.attributes||{};if(void 0===s.nonce){var r=i.nc;r&&(s.nonce=r)}if(Object.keys(s).forEach((function(e){t.setAttribute(e,s[e])})),"function"==typeof e.insert)e.insert(t);else{var l=a(e.insert||"head");if(!l)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");l.appendChild(t)}return t}var c,u=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function d(e,t,i,s){var a=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(e.styleSheet)e.styleSheet.cssText=u(t,a);else{var r=document.createTextNode(a),l=e.childNodes;l[t]&&e.removeChild(l[t]),l.length?e.insertBefore(r,l[t]):e.appendChild(r)}}function p(e,t,i){var s=i.css,a=i.media,r=i.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}var g=null,h=0;function v(e,t){var i,s,a;if(t.singleton){var r=h++;i=g||(g=o(t)),s=d.bind(null,i,r,!1),a=d.bind(null,i,r,!0)}else i=o(t),s=p.bind(null,i,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s));var i=n(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var s=0;s<i.length;s++){var a=l(i[s]);r[a].references--}for(var o=n(e,t),c=0;c<i.length;c++){var u=l(i[c]);0===r[u].references&&(r[u].updater(),r.splice(u,1))}i=o}}}},58:function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i,s,a,r=e[1]||"",l=e[3];if(!l)return r;if(t&&"function"==typeof btoa){var n=(i=l,s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(a," */")),o=l.sources.map((function(e){return"/*# sourceURL=".concat(l.sourceRoot||"").concat(e," */")}));return[r].concat(o).concat([n]).join("\n")}return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,s){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(s)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(a[l]=!0)}for(var n=0;n<e.length;n++){var o=[].concat(e[n]);s&&a[o[0]]||(i&&(o[2]?o[2]="".concat(i," and ").concat(o[2]):o[2]=i),t.push(o))}},t}}}]);